async function arrBuffSha256(l){const A=await crypto.subtle.digest("SHA-256",l),E=Array.from(new Uint8Array(A)),T=E.map(b=>("00"+b.toString(16)).slice(-2)).join("");return T}!function(l,A){typeof exports=="object"&&typeof module!="undefined"?A(exports):typeof define=="function"&&define.amd?define(["exports"],A):A((l=typeof globalThis!="undefined"?globalThis:l||self).uuid={})}(this,function(l){"use strict";var A=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),E=new Uint8Array(16);function T(){if(!A)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return A(E)}var b=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function m(c){return typeof c=="string"&&b.test(c)}for(var U,S,f=[],M=0;M<256;++M)f.push((M+256).toString(16).substr(1));function j(c){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=(f[c[u+0]]+f[c[u+1]]+f[c[u+2]]+f[c[u+3]]+"-"+f[c[u+4]]+f[c[u+5]]+"-"+f[c[u+6]]+f[c[u+7]]+"-"+f[c[u+8]]+f[c[u+9]]+"-"+f[c[u+10]]+f[c[u+11]]+f[c[u+12]]+f[c[u+13]]+f[c[u+14]]+f[c[u+15]]).toLowerCase();if(!m(a))throw TypeError("Stringified UUID is invalid");return a}var P=0,k=0;function L(c){if(!m(c))throw TypeError("Invalid UUID");var u,a=new Uint8Array(16);return a[0]=(u=parseInt(c.slice(0,8),16))>>>24,a[1]=u>>>16&255,a[2]=u>>>8&255,a[3]=255&u,a[4]=(u=parseInt(c.slice(9,13),16))>>>8,a[5]=255&u,a[6]=(u=parseInt(c.slice(14,18),16))>>>8,a[7]=255&u,a[8]=(u=parseInt(c.slice(19,23),16))>>>8,a[9]=255&u,a[10]=(u=parseInt(c.slice(24,36),16))/1099511627776&255,a[11]=u/4294967296&255,a[12]=u>>>24&255,a[13]=u>>>16&255,a[14]=u>>>8&255,a[15]=255&u,a}function B(c,u,a){function t(i,n,e,s){if(typeof i=="string"&&(i=function(p){p=unescape(encodeURIComponent(p));for(var w=[],h=0;h<p.length;++h)w.push(p.charCodeAt(h));return w}(i)),typeof n=="string"&&(n=L(n)),n.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var r=new Uint8Array(16+i.length);if(r.set(n),r.set(i,n.length),(r=a(r))[6]=15&r[6]|u,r[8]=63&r[8]|128,e){s=s||0;for(var o=0;o<16;++o)e[s+o]=r[o];return e}return j(r)}try{t.name=c}catch(i){}return t.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",t.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",t}function K(c){return 14+(c+64>>>9<<4)+1}function C(c,u){var a=(65535&c)+(65535&u);return(c>>16)+(u>>16)+(a>>16)<<16|65535&a}function O(c,u,a,t,i,n){return C((e=C(C(u,c),C(t,n)))<<(s=i)|e>>>32-s,a);var e,s}function d(c,u,a,t,i,n,e){return O(u&a|~u&t,c,u,i,n,e)}function y(c,u,a,t,i,n,e){return O(u&t|a&~t,c,u,i,n,e)}function g(c,u,a,t,i,n,e){return O(u^a^t,c,u,i,n,e)}function v(c,u,a,t,i,n,e){return O(a^(u|~t),c,u,i,n,e)}var G=B("v3",48,function(c){if(typeof c=="string"){var u=unescape(encodeURIComponent(c));c=new Uint8Array(u.length);for(var a=0;a<u.length;++a)c[a]=u.charCodeAt(a)}return function(t){for(var i=[],n=32*t.length,e="0123456789abcdef",s=0;s<n;s+=8){var r=t[s>>5]>>>s%32&255,o=parseInt(e.charAt(r>>>4&15)+e.charAt(15&r),16);i.push(o)}return i}(function(t,i){t[i>>5]|=128<<i%32,t[K(i)-1]=i;for(var n=1732584193,e=-271733879,s=-1732584194,r=271733878,o=0;o<t.length;o+=16){var p=n,w=e,h=s,R=r;n=d(n,e,s,r,t[o],7,-680876936),r=d(r,n,e,s,t[o+1],12,-389564586),s=d(s,r,n,e,t[o+2],17,606105819),e=d(e,s,r,n,t[o+3],22,-1044525330),n=d(n,e,s,r,t[o+4],7,-176418897),r=d(r,n,e,s,t[o+5],12,1200080426),s=d(s,r,n,e,t[o+6],17,-1473231341),e=d(e,s,r,n,t[o+7],22,-45705983),n=d(n,e,s,r,t[o+8],7,1770035416),r=d(r,n,e,s,t[o+9],12,-1958414417),s=d(s,r,n,e,t[o+10],17,-42063),e=d(e,s,r,n,t[o+11],22,-1990404162),n=d(n,e,s,r,t[o+12],7,1804603682),r=d(r,n,e,s,t[o+13],12,-40341101),s=d(s,r,n,e,t[o+14],17,-1502002290),n=y(n,e=d(e,s,r,n,t[o+15],22,1236535329),s,r,t[o+1],5,-165796510),r=y(r,n,e,s,t[o+6],9,-1069501632),s=y(s,r,n,e,t[o+11],14,643717713),e=y(e,s,r,n,t[o],20,-373897302),n=y(n,e,s,r,t[o+5],5,-701558691),r=y(r,n,e,s,t[o+10],9,38016083),s=y(s,r,n,e,t[o+15],14,-660478335),e=y(e,s,r,n,t[o+4],20,-405537848),n=y(n,e,s,r,t[o+9],5,568446438),r=y(r,n,e,s,t[o+14],9,-1019803690),s=y(s,r,n,e,t[o+3],14,-187363961),e=y(e,s,r,n,t[o+8],20,1163531501),n=y(n,e,s,r,t[o+13],5,-1444681467),r=y(r,n,e,s,t[o+2],9,-51403784),s=y(s,r,n,e,t[o+7],14,1735328473),n=g(n,e=y(e,s,r,n,t[o+12],20,-1926607734),s,r,t[o+5],4,-378558),r=g(r,n,e,s,t[o+8],11,-2022574463),s=g(s,r,n,e,t[o+11],16,1839030562),e=g(e,s,r,n,t[o+14],23,-35309556),n=g(n,e,s,r,t[o+1],4,-1530992060),r=g(r,n,e,s,t[o+4],11,1272893353),s=g(s,r,n,e,t[o+7],16,-155497632),e=g(e,s,r,n,t[o+10],23,-1094730640),n=g(n,e,s,r,t[o+13],4,681279174),r=g(r,n,e,s,t[o],11,-358537222),s=g(s,r,n,e,t[o+3],16,-722521979),e=g(e,s,r,n,t[o+6],23,76029189),n=g(n,e,s,r,t[o+9],4,-640364487),r=g(r,n,e,s,t[o+12],11,-421815835),s=g(s,r,n,e,t[o+15],16,530742520),n=v(n,e=g(e,s,r,n,t[o+2],23,-995338651),s,r,t[o],6,-198630844),r=v(r,n,e,s,t[o+7],10,1126891415),s=v(s,r,n,e,t[o+14],15,-1416354905),e=v(e,s,r,n,t[o+5],21,-57434055),n=v(n,e,s,r,t[o+12],6,1700485571),r=v(r,n,e,s,t[o+3],10,-1894986606),s=v(s,r,n,e,t[o+10],15,-1051523),e=v(e,s,r,n,t[o+1],21,-2054922799),n=v(n,e,s,r,t[o+8],6,1873313359),r=v(r,n,e,s,t[o+15],10,-30611744),s=v(s,r,n,e,t[o+6],15,-1560198380),e=v(e,s,r,n,t[o+13],21,1309151649),n=v(n,e,s,r,t[o+4],6,-145523070),r=v(r,n,e,s,t[o+11],10,-1120210379),s=v(s,r,n,e,t[o+2],15,718787259),e=v(e,s,r,n,t[o+9],21,-343485551),n=C(n,p),e=C(e,w),s=C(s,h),r=C(r,R)}return[n,e,s,r]}(function(t){if(t.length===0)return[];for(var i=8*t.length,n=new Uint32Array(K(i)),e=0;e<i;e+=8)n[e>>5]|=(255&t[e/8])<<e%32;return n}(c),8*c.length))});function z(c,u,a,t){switch(c){case 0:return u&a^~u&t;case 1:return u^a^t;case 2:return u&a^u&t^a&t;case 3:return u^a^t}}function J(c,u){return c<<u|c>>>32-u}var Y=B("v5",80,function(c){var u=[1518500249,1859775393,2400959708,3395469782],a=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof c=="string"){var t=unescape(encodeURIComponent(c));c=[];for(var i=0;i<t.length;++i)c.push(t.charCodeAt(i))}else Array.isArray(c)||(c=Array.prototype.slice.call(c));c.push(128);for(var n=c.length/4+2,e=Math.ceil(n/16),s=new Array(e),r=0;r<e;++r){for(var o=new Uint32Array(16),p=0;p<16;++p)o[p]=c[64*r+4*p]<<24|c[64*r+4*p+1]<<16|c[64*r+4*p+2]<<8|c[64*r+4*p+3];s[r]=o}s[e-1][14]=8*(c.length-1)/Math.pow(2,32),s[e-1][14]=Math.floor(s[e-1][14]),s[e-1][15]=8*(c.length-1)&4294967295;for(var w=0;w<e;++w){for(var h=new Uint32Array(80),R=0;R<16;++R)h[R]=s[w][R];for(var I=16;I<80;++I)h[I]=J(h[I-3]^h[I-8]^h[I-14]^h[I-16],1);for(var x=a[0],N=a[1],F=a[2],D=a[3],V=a[4],H=0;H<80;++H){var _=Math.floor(H/20),W=J(x,5)+z(_,N,F,D)+V+u[_]+h[H]>>>0;V=D,D=F,F=J(N,30)>>>0,N=x,x=W}a[0]=a[0]+x>>>0,a[1]=a[1]+N>>>0,a[2]=a[2]+F>>>0,a[3]=a[3]+D>>>0,a[4]=a[4]+V>>>0}return[a[0]>>24&255,a[0]>>16&255,a[0]>>8&255,255&a[0],a[1]>>24&255,a[1]>>16&255,a[1]>>8&255,255&a[1],a[2]>>24&255,a[2]>>16&255,a[2]>>8&255,255&a[2],a[3]>>24&255,a[3]>>16&255,a[3]>>8&255,255&a[3],a[4]>>24&255,a[4]>>16&255,a[4]>>8&255,255&a[4]]});l.NIL="00000000-0000-0000-0000-000000000000",l.parse=L,l.stringify=j,l.v1=function(c,u,a){var t=u&&a||0,i=u||new Array(16),n=(c=c||{}).node||U,e=c.clockseq!==void 0?c.clockseq:S;if(n==null||e==null){var s=c.random||(c.rng||T)();n==null&&(n=U=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),e==null&&(e=S=16383&(s[6]<<8|s[7]))}var r=c.msecs!==void 0?c.msecs:Date.now(),o=c.nsecs!==void 0?c.nsecs:k+1,p=r-P+(o-k)/1e4;if(p<0&&c.clockseq===void 0&&(e=e+1&16383),(p<0||r>P)&&c.nsecs===void 0&&(o=0),o>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");P=r,k=o,S=e;var w=(1e4*(268435455&(r+=122192928e5))+o)%4294967296;i[t++]=w>>>24&255,i[t++]=w>>>16&255,i[t++]=w>>>8&255,i[t++]=255&w;var h=r/4294967296*1e4&268435455;i[t++]=h>>>8&255,i[t++]=255&h,i[t++]=h>>>24&15|16,i[t++]=h>>>16&255,i[t++]=e>>>8|128,i[t++]=255&e;for(var R=0;R<6;++R)i[t+R]=n[R];return u||j(i)},l.v3=G,l.v4=function(c,u,a){var t=(c=c||{}).random||(c.rng||T)();if(t[6]=15&t[6]|64,t[8]=63&t[8]|128,u){a=a||0;for(var i=0;i<16;++i)u[a+i]=t[i];return u}return j(t)},l.v5=Y,l.validate=m,l.version=function(c){if(!m(c))throw TypeError("Invalid UUID");return parseInt(c.substr(14,1),16)},Object.defineProperty(l,"__esModule",{value:!0})});var SHAKV,USERS,API_KEY;const corsHeaders={"Access-Control-Allow-Origin":"https://zed.vision","Access-Control-Allow-Methods":"GET,HEAD,POST,OPTIONS","Access-Control-Max-Age":"86400"};async function handleCloudRequest(l){const A=String(l.headers.get("API_KEY")||""),E=new URL(l.url),{searchParams:T,pathname:b}=E;if(l.method==="GET"&&A&&A===API_KEY){if(b==="/keys/"){const m=T.get("prefix"),U=await SHAKV.list({prefix:m});return new Response(JSON.stringify(U),{headers:{...corsHeaders,"content-type":"application/json;charset=UTF-8"}})}if(b==="/keys/delete/"){const m=T.get("hash"),U=await SHAKV.delete(m);return new Response(JSON.stringify(U),{headers:{...corsHeaders,"content-type":"application/json;charset=UTF-8"}})}}if(l.method==="GET"){const m=T.get("h");if(b==="/robots.txt")return new Response("User-agent: * Disallow: /",{headers:{...corsHeaders,"content-type":"text/html;charset=UTF-8"}});if(b==="/register"){const f=v4();return await USERS.put(f,JSON.stringify({uuid:f,registered:Date.now(),cf:l.cf})),new Response(JSON.stringify({uuid:f}),{headers:{...corsHeaders,"content-type":"application/json;charset=UTF-8"}})}if(m){const f=await SHAKV.get(m,"stream");return f===null?new Response(JSON.stringify({error:"Not found"}),{headers:{...corsHeaders,"content-type":"application/json;charset=UTF-8"}}):new Response(f,{headers:{...corsHeaders,"content-type":"application/json;charset=UTF-8"}})}const U=E.searchParams.get("r");if(U){const f=await SHAKV.get(U,"stream");if(f!==null)return new Response(f,{headers:{...corsHeaders,"Content-Type":"text/html; charset=UTF-8"}})}const S=b.substr(1);if(S){const f=await SHAKV.get(S,"stream");if(f!==null)return new Response(f,{headers:{...corsHeaders,"Content-Type":"text/html; charset=UTF-8"}})}return Response.redirect("https://zed.vision/code",301)}else if(l.method==="POST"){const m=await l.arrayBuffer(),U=await arrBuffSha256(m),S=U.substring(0,8);return await SHAKV.put(S,m),new Response(JSON.stringify({hash:S}),{headers:{...corsHeaders,"content-type":"application/json;charset=UTF-8"}})}return new Response(l.body,{headers:{...l.headers,...corsHeaders,"Access-Control-Allow-Headers":l.headers.get("Access-Control-Request-Headers")}})}addEventListener("fetch",l=>{l.respondWith(handleCloudRequest(l.request))});
