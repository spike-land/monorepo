async function arrBuffSha256(r){const i=await crypto.subtle.digest("SHA-256",r),l=Array.from(new Uint8Array(i)),c=l.map(p=>("00"+p.toString(16)).slice(-2)).join("");return c}(function(r,i){typeof exports=="object"&&typeof module!="undefined"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(r=r||self,i(r.Diff={}))})(this,function(r){"use strict";function i(){}i.prototype={diff:function(e,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=t.callback;typeof t=="function"&&(o=t,t={}),this.options=t;var a=this;function s(y){return o?(setTimeout(function(){o(void 0,y)},0),!0):y}e=this.castInput(e),n=this.castInput(n),e=this.removeEmpty(this.tokenize(e)),n=this.removeEmpty(this.tokenize(n));var u=n.length,f=e.length,d=1,g=u+f,m=[{newPos:-1,components:[]}],S=this.extractCommon(m[0],n,e,0);if(m[0].newPos+1>=u&&S+1>=f)return s([{value:this.join(n),count:n.length}]);function v(){for(var y=-1*d;y<=d;y+=2){var L=void 0,D=m[y-1],F=m[y+1],I=(F?F.newPos:0)-y;D&&(m[y-1]=void 0);var A=D&&D.newPos+1<u,R=F&&0<=I&&I<f;if(!A&&!R){m[y]=void 0;continue}if(!A||R&&D.newPos<F.newPos?(L=c(F),a.pushComponent(L.components,void 0,!0)):(L=D,L.newPos++,a.pushComponent(L.components,!0,void 0)),I=a.extractCommon(L,n,e,y),L.newPos+1>=u&&I+1>=f)return s(l(a,L.components,n,e,a.useLongestToken));m[y]=L}d++}if(o)(function y(){setTimeout(function(){if(d>g)return o();v()||y()},0)})();else for(;d<=g;){var b=v();if(b)return b}},pushComponent:function(e,n,t){var o=e[e.length-1];o&&o.added===n&&o.removed===t?e[e.length-1]={count:o.count+1,added:n,removed:t}:e.push({count:1,added:n,removed:t})},extractCommon:function(e,n,t,o){for(var a=n.length,s=t.length,u=e.newPos,f=u-o,d=0;u+1<a&&f+1<s&&this.equals(n[u+1],t[f+1]);)u++,f++,d++;return d&&e.components.push({count:d}),e.newPos=u,f},equals:function(e,n){return this.options.comparator?this.options.comparator(e,n):e===n||this.options.ignoreCase&&e.toLowerCase()===n.toLowerCase()},removeEmpty:function(e){for(var n=[],t=0;t<e.length;t++)e[t]&&n.push(e[t]);return n},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function l(e,n,t,o,a){for(var s=0,u=n.length,f=0,d=0;s<u;s++){var g=n[s];if(g.removed){if(g.value=e.join(o.slice(d,d+g.count)),d+=g.count,s&&n[s-1].added){var m=n[s-1];n[s-1]=n[s],n[s]=m}}else{if(!g.added&&a){var S=t.slice(f,f+g.count);S=S.map(function(b,y){var L=o[d+y];return L.length>b.length?L:b}),g.value=e.join(S)}else g.value=e.join(t.slice(f,f+g.count));f+=g.count,g.added||(d+=g.count)}}var v=n[u-1];return u>1&&typeof v.value=="string"&&(v.added||v.removed)&&e.equals("",v.value)&&(n[u-2].value+=v.value,n.pop()),n}function c(e){return{newPos:e.newPos,components:e.components.slice(0)}}var p=new i;function w(e,n,t){return p.diff(e,n,t)}function h(e,n){if(typeof e=="function")n.callback=e;else if(e)for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}var x=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,N=/\S/,k=new i;k.equals=function(e,n){return this.options.ignoreCase&&(e=e.toLowerCase(),n=n.toLowerCase()),e===n||this.options.ignoreWhitespace&&!N.test(e)&&!N.test(n)},k.tokenize=function(e){for(var n=e.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<n.length-1;t++)!n[t+1]&&n[t+2]&&x.test(n[t])&&x.test(n[t+2])&&(n[t]+=n[t+2],n.splice(t+1,2),t--);return n};function C(e,n,t){return t=h(t,{ignoreWhitespace:!0}),k.diff(e,n,t)}function M(e,n,t){return k.diff(e,n,t)}var j=new i;j.tokenize=function(e){var n=[],t=e.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var o=0;o<t.length;o++){var a=t[o];o%2&&!this.options.newlineIsToken?n[n.length-1]+=a:(this.options.ignoreWhitespace&&(a=a.trim()),n.push(a))}return n};function ge(e,n,t){return j.diff(e,n,t)}function De(e,n,t){var o=h(t,{ignoreWhitespace:!0});return j.diff(e,n,o)}var ve=new i;ve.tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)};function Te(e,n,t){return ve.diff(e,n,t)}var we=new i;we.tokenize=function(e){return e.split(/([{}:;,]|\s+)/)};function Oe(e,n,t){return we.diff(e,n,t)}function _(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_=function(n){return typeof n}:_=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_(e)}function B(e){return Be(e)||Me(e)||Re(e)||ze()}function Be(e){if(Array.isArray(e))return ne(e)}function Me(e){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(e))return Array.from(e)}function Re(e,n){if(!e)return;if(typeof e=="string")return ne(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ne(e,n)}function ne(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,o=new Array(n);t<n;t++)o[t]=e[t];return o}function ze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var $e=Object.prototype.toString,W=new i;W.useLongestToken=!0,W.tokenize=j.tokenize,W.castInput=function(e){var n=this.options,t=n.undefinedReplacement,o=n.stringifyReplacer,a=o===void 0?function(s,u){return typeof u=="undefined"?t:u}:o;return typeof e=="string"?e:JSON.stringify(K(e,null,null,a),a,"  ")},W.equals=function(e,n){return i.prototype.equals.call(W,e.replace(/,([\r\n])/g,"$1"),n.replace(/,([\r\n])/g,"$1"))};function Ue(e,n,t){return W.diff(e,n,t)}function K(e,n,t,o,a){n=n||[],t=t||[],o&&(e=o(a,e));var s;for(s=0;s<n.length;s+=1)if(n[s]===e)return t[s];var u;if($e.call(e)==="[object Array]"){for(n.push(e),u=new Array(e.length),t.push(u),s=0;s<e.length;s+=1)u[s]=K(e[s],n,t,o,a);return n.pop(),t.pop(),u}if(e&&e.toJSON&&(e=e.toJSON()),_(e)==="object"&&e!==null){n.push(e),u={},t.push(u);var f=[],d;for(d in e)e.hasOwnProperty(d)&&f.push(d);for(f.sort(),s=0;s<f.length;s+=1)d=f[s],u[d]=K(e[d],n,t,o,d);n.pop(),t.pop()}else u=e;return u}var G=new i;G.tokenize=function(e){return e.slice()},G.join=G.removeEmpty=function(e){return e};function We(e,n,t){return G.diff(e,n,t)}function X(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.split(/\r\n|[\n\v\f\r\x85]/),o=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],a=[],s=0;function u(){var g={};for(a.push(g);s<t.length;){var m=t[s];if(/^(\-\-\-|\+\+\+|@@)\s/.test(m))break;var S=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(m);S&&(g.index=S[1]),s++}for(f(g),f(g),g.hunks=[];s<t.length;){var v=t[s];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(v))break;if(/^@@/.test(v))g.hunks.push(d());else{if(v&&n.strict)throw new Error("Unknown line "+(s+1)+" "+JSON.stringify(v));s++}}}function f(g){var m=/^(---|\+\+\+)\s+(.*)$/.exec(t[s]);if(m){var S=m[1]==="---"?"old":"new",v=m[2].split("	",2),b=v[0].replace(/\\\\/g,"\\");/^".*"$/.test(b)&&(b=b.substr(1,b.length-2)),g[S+"FileName"]=b,g[S+"Header"]=(v[1]||"").trim(),s++}}function d(){var g=s,m=t[s++],S=m.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),v={oldStart:+S[1],oldLines:typeof S[2]=="undefined"?1:+S[2],newStart:+S[3],newLines:typeof S[4]=="undefined"?1:+S[4],lines:[],linedelimiters:[]};v.oldLines===0&&(v.oldStart+=1),v.newLines===0&&(v.newStart+=1);for(var b=0,y=0;s<t.length&&!(t[s].indexOf("--- ")===0&&s+2<t.length&&t[s+1].indexOf("+++ ")===0&&t[s+2].indexOf("@@")===0);s++){var L=t[s].length==0&&s!=t.length-1?" ":t[s][0];if(L==="+"||L==="-"||L===" "||L==="\\")v.lines.push(t[s]),v.linedelimiters.push(o[s]||`
`),L==="+"?b++:L==="-"?y++:L===" "&&(b++,y++);else break}if(!b&&v.newLines===1&&(v.newLines=0),!y&&v.oldLines===1&&(v.oldLines=0),n.strict){if(b!==v.newLines)throw new Error("Added line count did not match for hunk at line "+(g+1));if(y!==v.oldLines)throw new Error("Removed line count did not match for hunk at line "+(g+1))}return v}for(;s<t.length;)u();return a}function qe(e,n,t){var o=!0,a=!1,s=!1,u=1;return function f(){if(o&&!s){if(a?u++:o=!1,e+u<=t)return u;s=!0}if(!a)return s||(o=!0),n<=e-u?-u++:(a=!0,f())}}function me(e,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof n=="string"&&(n=X(n)),Array.isArray(n)){if(n.length>1)throw new Error("applyPatch only works with a single input.");n=n[0]}var o=e.split(/\r\n|[\n\v\f\r\x85]/),a=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],s=n.hunks,u=t.compareLine||function(ae,J,ee,U){return J===U},f=0,d=t.fuzzFactor||0,g=0,m=0,S,v;function b(ae,J){for(var ee=0;ee<ae.lines.length;ee++){var U=ae.lines[ee],ue=U.length>0?U[0]:" ",rn=U.length>0?U.substr(1):U;if(ue===" "||ue==="-"){if(!u(J+1,o[J],ue,rn)&&(f++,f>d))return!1;J++}}return!0}for(var y=0;y<s.length;y++){for(var L=s[y],D=o.length-L.oldLines,F=0,I=m+L.oldStart-1,A=qe(I,g,D);F!==void 0;F=A())if(b(L,I+F)){L.offset=m+=F;break}if(F===void 0)return!1;g=L.offset+L.oldStart+L.oldLines}for(var R=0,q=0;q<s.length;q++){var E=s[q],P=E.oldStart+E.offset+R-1;R+=E.newLines-E.oldLines;for(var O=0;O<E.lines.length;O++){var H=E.lines[O],$=H.length>0?H[0]:" ",se=H.length>0?H.substr(1):H,Y=E.linedelimiters[O];if($===" ")P++;else if($==="-")o.splice(P,1),a.splice(P,1);else if($==="+")o.splice(P,0,se),a.splice(P,0,Y),P++;else if($==="\\"){var Q=E.lines[O-1]?E.lines[O-1][0]:null;Q==="+"?S=!0:Q==="-"&&(v=!0)}}}if(S)for(;!o[o.length-1];)o.pop(),a.pop();else v&&(o.push(""),a.push(`
`));for(var V=0;V<o.length-1;V++)o[V]=o[V]+a[V];return o.join("")}function Ve(e,n){typeof e=="string"&&(e=X(e));var t=0;function o(){var a=e[t++];if(!a)return n.complete();n.loadFile(a,function(s,u){if(s)return n.complete(s);var f=me(u,a,n);n.patched(a,f,function(d){if(d)return n.complete(d);o()})})}o()}function te(e,n,t,o,a,s,u){u||(u={}),typeof u.context=="undefined"&&(u.context=4);var f=ge(t,o,u);f.push({value:"",lines:[]});function d(F){return F.map(function(I){return" "+I})}for(var g=[],m=0,S=0,v=[],b=1,y=1,L=function(F){var I=f[F],A=I.lines||I.value.replace(/\n$/,"").split(`
`);if(I.lines=A,I.added||I.removed){var R;if(!m){var q=f[F-1];m=b,S=y,q&&(v=u.context>0?d(q.lines.slice(-u.context)):[],m-=v.length,S-=v.length)}(R=v).push.apply(R,B(A.map(function(Q){return(I.added?"+":"-")+Q}))),I.added?y+=A.length:b+=A.length}else{if(m)if(A.length<=u.context*2&&F<f.length-2){var E;(E=v).push.apply(E,B(d(A)))}else{var P,O=Math.min(A.length,u.context);(P=v).push.apply(P,B(d(A.slice(0,O))));var H={oldStart:m,oldLines:b-m+O,newStart:S,newLines:y-S+O,lines:v};if(F>=f.length-2&&A.length<=u.context){var $=/\n$/.test(t),se=/\n$/.test(o),Y=A.length==0&&v.length>H.oldLines;!$&&Y&&t.length>0&&v.splice(H.oldLines,0,"\\ No newline at end of file"),(!$&&!Y||!se)&&v.push("\\ No newline at end of file")}g.push(H),m=0,S=0,v=[]}b+=A.length,y+=A.length}},D=0;D<f.length;D++)L(D);return{oldFileName:e,newFileName:n,oldHeader:a,newHeader:s,hunks:g}}function Je(e){var n=[];e.oldFileName==e.newFileName&&n.push("Index: "+e.oldFileName),n.push("==================================================================="),n.push("--- "+e.oldFileName+(typeof e.oldHeader=="undefined"?"":"	"+e.oldHeader)),n.push("+++ "+e.newFileName+(typeof e.newHeader=="undefined"?"":"	"+e.newHeader));for(var t=0;t<e.hunks.length;t++){var o=e.hunks[t];o.oldLines===0&&(o.oldStart-=1),o.newLines===0&&(o.newStart-=1),n.push("@@ -"+o.oldStart+","+o.oldLines+" +"+o.newStart+","+o.newLines+" @@"),n.push.apply(n,o.lines)}return n.join(`
`)+`
`}function ye(e,n,t,o,a,s,u){return Je(te(e,n,t,o,a,s,u))}function _e(e,n,t,o,a,s){return ye(e,e,n,t,o,a,s)}function Ke(e,n){return e.length!==n.length?!1:re(e,n)}function re(e,n){if(n.length>e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ge(e){var n=ie(e.lines),t=n.oldLines,o=n.newLines;t!==void 0?e.oldLines=t:delete e.oldLines,o!==void 0?e.newLines=o:delete e.newLines}function Xe(e,n,t){e=Le(e,t),n=Le(n,t);var o={};(e.index||n.index)&&(o.index=e.index||n.index),(e.newFileName||n.newFileName)&&(xe(e)?xe(n)?(o.oldFileName=Z(o,e.oldFileName,n.oldFileName),o.newFileName=Z(o,e.newFileName,n.newFileName),o.oldHeader=Z(o,e.oldHeader,n.oldHeader),o.newHeader=Z(o,e.newHeader,n.newHeader)):(o.oldFileName=e.oldFileName,o.newFileName=e.newFileName,o.oldHeader=e.oldHeader,o.newHeader=e.newHeader):(o.oldFileName=n.oldFileName||e.oldFileName,o.newFileName=n.newFileName||e.newFileName,o.oldHeader=n.oldHeader||e.oldHeader,o.newHeader=n.newHeader||e.newHeader)),o.hunks=[];for(var a=0,s=0,u=0,f=0;a<e.hunks.length||s<n.hunks.length;){var d=e.hunks[a]||{oldStart:Infinity},g=n.hunks[s]||{oldStart:Infinity};if(Se(d,g))o.hunks.push(be(d,u)),a++,f+=d.newLines-d.oldLines;else if(Se(g,d))o.hunks.push(be(g,f)),s++,u+=g.newLines-g.oldLines;else{var m={oldStart:Math.min(d.oldStart,g.oldStart),oldLines:0,newStart:Math.min(d.newStart+u,g.oldStart+f),newLines:0,lines:[]};Ze(m,d.oldStart,d.lines,g.oldStart,g.lines),s++,a++,o.hunks.push(m)}}return o}function Le(e,n){if(typeof e=="string"){if(/^@@/m.test(e)||/^Index:/m.test(e))return X(e)[0];if(!n)throw new Error("Must provide a base reference or pass in a patch");return te(void 0,void 0,n,e)}return e}function xe(e){return e.newFileName&&e.newFileName!==e.oldFileName}function Z(e,n,t){return n===t?n:(e.conflict=!0,{mine:n,theirs:t})}function Se(e,n){return e.oldStart<n.oldStart&&e.oldStart+e.oldLines<n.oldStart}function be(e,n){return{oldStart:e.oldStart,oldLines:e.oldLines,newStart:e.newStart+n,newLines:e.newLines,lines:e.lines}}function Ze(e,n,t,o,a){var s={offset:n,lines:t,index:0},u={offset:o,lines:a,index:0};for(ke(e,s,u),ke(e,u,s);s.index<s.lines.length&&u.index<u.lines.length;){var f=s.lines[s.index],d=u.lines[u.index];if((f[0]==="-"||f[0]==="+")&&(d[0]==="-"||d[0]==="+"))Ye(e,s,u);else if(f[0]==="+"&&d[0]===" "){var g;(g=e.lines).push.apply(g,B(z(s)))}else if(d[0]==="+"&&f[0]===" "){var m;(m=e.lines).push.apply(m,B(z(u)))}else f[0]==="-"&&d[0]===" "?Ne(e,s,u):d[0]==="-"&&f[0]===" "?Ne(e,u,s,!0):f===d?(e.lines.push(f),s.index++,u.index++):oe(e,z(s),z(u))}Fe(e,s),Fe(e,u),Ge(e)}function Ye(e,n,t){var o=z(n),a=z(t);if(Ae(o)&&Ae(a)){if(re(o,a)&&je(t,o,o.length-a.length)){var s;(s=e.lines).push.apply(s,B(o));return}else if(re(a,o)&&je(n,a,a.length-o.length)){var u;(u=e.lines).push.apply(u,B(a));return}}else if(Ke(o,a)){var f;(f=e.lines).push.apply(f,B(o));return}oe(e,o,a)}function Ne(e,n,t,o){var a=z(n),s=Qe(t,a);if(s.merged){var u;(u=e.lines).push.apply(u,B(s.merged))}else oe(e,o?s:a,o?a:s)}function oe(e,n,t){e.conflict=!0,e.lines.push({conflict:!0,mine:n,theirs:t})}function ke(e,n,t){for(;n.offset<t.offset&&n.index<n.lines.length;){var o=n.lines[n.index++];e.lines.push(o),n.offset++}}function Fe(e,n){for(;n.index<n.lines.length;){var t=n.lines[n.index++];e.lines.push(t)}}function z(e){for(var n=[],t=e.lines[e.index][0];e.index<e.lines.length;){var o=e.lines[e.index];if(t==="-"&&o[0]==="+"&&(t="+"),t===o[0])n.push(o),e.index++;else break}return n}function Qe(e,n){for(var t=[],o=[],a=0,s=!1,u=!1;a<n.length&&e.index<e.lines.length;){var f=e.lines[e.index],d=n[a];if(d[0]==="+")break;if(s=s||f[0]!==" ",o.push(d),a++,f[0]==="+")for(u=!0;f[0]==="+";)t.push(f),f=e.lines[++e.index];d.substr(1)===f.substr(1)?(t.push(f),e.index++):u=!0}if((n[a]||"")[0]==="+"&&s&&(u=!0),u)return t;for(;a<n.length;)o.push(n[a++]);return{merged:o,changes:t}}function Ae(e){return e.reduce(function(n,t){return n&&t[0]==="-"},!0)}function je(e,n,t){for(var o=0;o<t;o++){var a=n[n.length-t+o].substr(1);if(e.lines[e.index+o]!==" "+a)return!1}return e.index+=t,!0}function ie(e){var n=0,t=0;return e.forEach(function(o){if(typeof o!="string"){var a=ie(o.mine),s=ie(o.theirs);n!==void 0&&(a.oldLines===s.oldLines?n+=a.oldLines:n=void 0),t!==void 0&&(a.newLines===s.newLines?t+=a.newLines:t=void 0)}else t!==void 0&&(o[0]==="+"||o[0]===" ")&&t++,n!==void 0&&(o[0]==="-"||o[0]===" ")&&n++}),{oldLines:n,newLines:t}}function en(e){for(var n=[],t,o,a=0;a<e.length;a++)t=e[a],t.added?o=1:t.removed?o=-1:o=0,n.push([o,t.value]);return n}function nn(e){for(var n=[],t=0;t<e.length;t++){var o=e[t];o.added?n.push("<ins>"):o.removed&&n.push("<del>"),n.push(tn(o.value)),o.added?n.push("</ins>"):o.removed&&n.push("</del>")}return n.join("")}function tn(e){var n=e;return n=n.replace(/&/g,"&amp;"),n=n.replace(/</g,"&lt;"),n=n.replace(/>/g,"&gt;"),n=n.replace(/"/g,"&quot;"),n}r.Diff=i,r.applyPatch=me,r.applyPatches=Ve,r.canonicalize=K,r.convertChangesToDMP=en,r.convertChangesToXML=nn,r.createPatch=_e,r.createTwoFilesPatch=ye,r.diffArrays=We,r.diffChars=w,r.diffCss=Oe,r.diffJson=Ue,r.diffLines=ge,r.diffSentences=Te,r.diffTrimmedLines=De,r.diffWords=C,r.diffWordsWithSpace=M,r.merge=Xe,r.parsePatch=X,r.structuredPatch=te,Object.defineProperty(r,"__esModule",{value:!0})});async function on(r){const i=await crypto.subtle.digest("SHA-256",r),l=Array.from(new Uint8Array(i)),c=l.map(p=>("00"+p.toString(16)).slice(-2)).join("");return c}const sn=r=>{if(r.length<10)return!1;const i=[...r.slice(0,8)].filter(c=>c<"0"||c>"f").length===0,l=r.slice(8);if(i&&l[0]==="["&&l[l.length-1]==="]")try{return JSON.parse(l).length>1}catch{return!1}return!1},an=(r,i)=>{const l=JSON.parse(i);let c=r.slice(),p="";return l.forEach(w=>{if(Number(w)===w){const h=Math.abs(w),x=c.slice(0,h);c=c.slice(h),w>0&&(p+=String(x))}else p+=String(w)}),p};async function un(r){const i=new TextEncoder().encode(r),l=await on(i);return l.substr(0,8)}const ln=async(r,i)=>{const l=un(r),c=Diff.diffChars(r,i);return{b:await l,c:c.map(p=>p.added?p.value:p.removed?-p.count:p.count)}},fn=(r,i)=>i.some(l=>r instanceof l);let He,Ee;function cn(){return He||(He=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function dn(){return Ee||(Ee=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ce=new WeakMap,le=new WeakMap,Ie=new WeakMap,fe=new WeakMap,ce=new WeakMap;function hn(r){if(le.has(r))return;const i=new Promise((l,c)=>{const p=()=>{r.removeEventListener("complete",w),r.removeEventListener("error",h),r.removeEventListener("abort",h)},w=()=>{l(),p()},h=()=>{c(r.error||new DOMException("AbortError","AbortError")),p()};r.addEventListener("complete",w),r.addEventListener("error",h),r.addEventListener("abort",h)});le.set(r,i)}const de=r=>ce.get(r),pn=["get","getKey","getAll","getAllKeys","count"],gn=["put","add","delete","clear"],he=new Map;function Pe(r,i){if(!(r instanceof IDBDatabase&&!(i in r)&&typeof i=="string"))return;if(he.get(i))return he.get(i);const l=i.replace(/FromIndex$/,""),c=i!==l,p=gn.includes(l);if(!(l in(c?IDBIndex:IDBObjectStore).prototype)||!(p||pn.includes(l)))return;const w=async function(h,...x){const N=this.transaction(h,p?"readwrite":"readonly");let k=N.store;c&&(k=k.index(x.shift()));const C=await k[l](...x);return p&&await N.done,C};return he.set(i,w),w}async function vn(r){const i=await crypto.subtle.digest("SHA-256",r),l=Array.from(new Uint8Array(i)),c=l.map(p=>("00"+p.toString(16)).slice(-2)).join("");return c}async function mn(r){const i=new TextEncoder().encode(r),l=await vn(i);return l.substr(0,8)}const getDbObj=(r,i=!1)=>{const l={async get(c,p="string"){let w;try{if(i?w=await(await r).get("codeStore",c):w=await r.get(c),!w)return null}catch(h){return null}if(p==="json")return JSON.parse(w);if(p==="string"){const h=await w;if(typeof h=="string"&&p==="string"){const k=h;if(sn(h)){const C=h.slice(0,8),M=h.slice(8),j=await l.get(C);return an(j,M)}return h}const x=new TextDecoder,N=x.decode(h);return N}return w},async put(c,p){let w;try{const x=await l.get(c);if(typeof x=="string"&&typeof p=="string"&&x.length===8&&x!==p){const N=await l.get(p),k=await l.get(x);if(typeof k=="string"){const C=await mn(k);if(C===x){const M=await ln(N,k),j=M.b+JSON.stringify(M.c);(await r).put("codeStore",j,C)}}}}catch{w=""}if(w!==""&&p===w)return p;let h;return typeof p!="string"?h=new TextDecoder().decode(p):h=p,i?(await r).put("codeStore",h,c):await r.put(c,h)},async delete(c){return(await r).delete("codeStore",c)},async clear(){return(await r).clear("codeStore")},async keys(){return(await r).getAllKeys("codeStore")}};return l};var getRandomValues,rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const __default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(r){return typeof r=="string"&&__default.test(r)}for(var byteToHex=[],i1=0;i1<256;++i1)byteToHex.push((i1+256).toString(16).substr(1));function stringify(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l=(byteToHex[r[i+0]]+byteToHex[r[i+1]]+byteToHex[r[i+2]]+byteToHex[r[i+3]]+"-"+byteToHex[r[i+4]]+byteToHex[r[i+5]]+"-"+byteToHex[r[i+6]]+byteToHex[r[i+7]]+"-"+byteToHex[r[i+8]]+byteToHex[r[i+9]]+"-"+byteToHex[r[i+10]]+byteToHex[r[i+11]]+byteToHex[r[i+12]]+byteToHex[r[i+13]]+byteToHex[r[i+14]]+byteToHex[r[i+15]]).toLowerCase();if(!validate(l))throw TypeError("Stringified UUID is invalid");return l}function v4(r,i,l){r=r||{};var c=r.random||(r.rng||rng)();if(c[6]=c[6]&15|64,c[8]=c[8]&63|128,i){l=l||0;for(var p=0;p<16;++p)i[l+p]=c[p];return i}return stringify(c)}const v41=()=>v4();var SHAKV,USERS,API_KEY;const corsHeaders={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,HEAD,POST,OPTIONS","Access-Control-Max-Age":"86400"};function json(r){return new Response(JSON.stringify(r),{headers:{...corsHeaders,"Content-Type":"application/json;charset=UTF-8"}})}function text(r){return new Response(r,{headers:{...corsHeaders,"Content-Type":"text/html;charset=UTF-8"}})}function handleOptions(r){const i=r.headers;if(i.get("Origin")!==null&&i.get("Access-Control-Request-Method")!==null&&i.get("Access-Control-Request-Headers")!==null){const l={...corsHeaders,"Access-Control-Allow-Headers":r.headers.get("Access-Control-Request-Headers")};return new Response(null,{headers:l})}else return new Response(null,{headers:{Allow:corsHeaders["Access-Control-Allow-Methods"]}})}async function sha256(r){const i=new TextEncoder().encode(r),l=await arrBuffSha256(i);return l.substr(0,8)}async function handleAdmin(r,i,l,c){if(l==="/keys/"){const p=i.get("prefix"),w=await c.list({prefix:p});return json(w)}if(l==="/keys/delete/"){const p=i.get("hash"),w=await c.delete(p);return json(w)}return json({error:"not implemented"})}async function handleCloudRequest(r){const i=new URL(r.url),{searchParams:l,pathname:c}=i,p=String(r.headers.get("API_KEY")||"");if(r.method==="GET"&&p&&p==API_KEY)return handleAdmin(r,l,c,SHAKV);if(r.method==="GET"){if(c==="/robots.txt")return text("User-agent: * Disallow: /");if(c==="/connect"){const h=l.get("uuid")||v41(),x=await sha256(h);return await SHAKV.put(x,JSON.stringify({uuid:h,connected:l.get("uuid")}),{expirationTtl:60}),json({key:x})}if(c==="/check"){const h=l.get("key");if(h===null)return new Response("500");const x=async()=>{const k=await SHAKV.get(h,"json");return!k||k.connected?k:new Promise(C=>{const M=setInterval(async()=>{const j=await SHAKV.get(h,"json");(!j||j.connected)&&(clearInterval(M),C(j))},1e3)})},N=await x();return json({expired:N===null})}if(c==="/register"){const h=v41();return await USERS.put(h,JSON.stringify({uuid:h,registered:Date.now(),cf:r.cf})),json({uuid:h})}const w=c.substr(1);if(w){const h=getDbObj(SHAKV),x=h.get(w);if(x!==null)return text(await x)}return Response.redirect("https://zed.vision/code",301)}else if(r.method==="POST"){const w=await r.arrayBuffer(),h=await arrBuffSha256(w),x=h.substring(0,8),N=getDbObj(SHAKV),k=await N.put(x,w);return json({hash:x})}return new Response("404")}addEventListener("fetch",r=>{r.request.method==="OPTIONS"?r.respondWith(handleOptions(r.request)):r.respondWith(handleCloudRequest(r.request))});function wn(r){const i=new Promise((l,c)=>{const p=()=>{r.removeEventListener("success",w),r.removeEventListener("error",h)},w=()=>{l(T(r.result)),p()},h=()=>{c(r.error),p()};r.addEventListener("success",w),r.addEventListener("error",h)});return i.then(l=>{l instanceof IDBCursor&&Ce.set(l,r)}).catch(()=>{}),ce.set(i,r),i}let pe={get(r,i,l){if(r instanceof IDBTransaction){if(i==="done")return le.get(r);if(i==="objectStoreNames")return r.objectStoreNames||Ie.get(r);if(i==="store")return l.objectStoreNames[1]?void 0:l.objectStore(l.objectStoreNames[0])}return T(r[i])},set(r,i,l){return r[i]=l,!0},has(r,i){return r instanceof IDBTransaction&&(i==="done"||i==="store")?!0:i in r}};function yn(r){pe=r(pe)}function Sn(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(i,...l){const c=r.call(de(this),i,...l);return Ie.set(c,i.sort?i.sort():[i]),T(c)}:dn().includes(r)?function(...i){return r.apply(de(this),i),T(Ce.get(this))}:function(...i){return T(r.apply(de(this),i))}}function xn(r){return typeof r=="function"?Sn(r):(r instanceof IDBTransaction&&hn(r),fn(r,cn())?new Proxy(r,pe):r)}function T(r){if(r instanceof IDBRequest)return wn(r);if(fe.has(r))return fe.get(r);const i=xn(r);return i!==r&&(fe.set(r,i),ce.set(i,r)),i}function bn(r,i,{blocked:l,upgrade:c,blocking:p,terminated:w}={}){const h=indexedDB.open(r,i),x=T(h);return c&&h.addEventListener("upgradeneeded",N=>{c(T(h.result),N.oldVersion,N.newVersion,T(h.transaction))}),l&&h.addEventListener("blocked",()=>l()),x.then(N=>{w&&N.addEventListener("close",()=>w()),p&&N.addEventListener("versionchange",()=>p())}).catch(()=>{}),x}yn(r=>({...r,get:(i,l,c)=>Pe(i,l)||r.get(i,l,c),has:(i,l)=>!!Pe(i,l)||r.has(i,l)}));
