import e from"through";import r from"html-tokenize";import t from"multipipe";import n from"@zedvision/emotion-cache";import{serializeStyles as i}from"@zedvision/emotion-serialize";import{getRegisteredStyles as o,insertStyles as s}from"@zedvision/emotion-utils";var a=function(e){return function(r){for(var t,n=new RegExp(e.key+"-([a-zA-Z0-9-_]+)","gm"),i={html:r,ids:[],css:""},o={};null!==(t=n.exec(r));)void 0===o[t[1]]&&(o[t[1]]=!0);return i.ids=Object.keys(e.inserted).filter(function(r){if((void 0!==o[r]||void 0===e.registered[e.key+"-"+r])&&!0!==e.inserted[r])return i.css+=e.inserted[r],!0}),i}};function c(e,r,t,n){return'<style data-emotion="'+e+" "+r.substring(1)+'"'+n+">"+t+"</style>"}var u=function(e,r){return function(t){var n=e.inserted,i=e.key,o=e.registered,s=new RegExp("<|"+i+"-([a-zA-Z0-9-_]+)","gm"),a={},u="",d="",l="";for(var f in n)if(n.hasOwnProperty(f)){var v=n[f];!0!==v&&void 0===o[i+"-"+f]&&(l+=v,d+=" "+f)}""!==l&&(u=c(i,d,l,r));for(var m,y="",g="",h=0;null!==(m=s.exec(t));)if("<"!==m[0]){var p=m[1],k=n[p];!0===k||void 0===k||a[p]||(a[p]=!0,g+=k,y+=" "+p)}else""!==y&&(u+=c(i,y,g,r),y="",g=""),u+=t.substring(h,m.index),h=m.index;return u+t.substring(h)}},d=function(n,i){return function(){var o={},s=r(),a=e(function(e){var r=e[1];if("open"===e[0]){for(var t,s="",a={},c=r.toString(),u=new RegExp(n.key+"-([a-zA-Z0-9-_]+)","gm");null!==(t=u.exec(c));)null!==t&&void 0===o[t[1]]&&(a[t[1]]=!0);Object.keys(n.inserted).forEach(function(e){!0!==n.inserted[e]&&void 0===o[e]&&(!0===a[e]||void 0===n.registered[n.key+"-"+e]&&(a[e]=!0))&&(o[e]=!0,s+=n.inserted[e])}),""!==s&&this.queue('<style data-emotion="'+n.key+" "+Object.keys(a).join(" ")+'"'+i+">"+s+"</style>")}this.queue(r)},function(){this.queue(null)});return t(s,a)}};function l(e,r){if(void 0===e.inserted[r.name])return e.insert("",r,e.sheet,!0)}function f(e,r,t){var n=[],i=o(e,n,t);return n.length<2?t:i+r(n)}var v=function e(r){for(var t="",n=0;n<r.length;n++){var i=r[n];if(null!=i){var o=void 0;switch(typeof i){case"boolean":break;case"object":if(Array.isArray(i))o=e(i);else for(var s in o="",i)i[s]&&s&&(o&&(o+=" "),o+=s);break;default:o=i}o&&(t&&(t+=" "),t+=o)}}return t},m=function(e){!0!==e.compat&&(e.compat=!0);var r=void 0!==e.nonce?' nonce="'+e.nonce+'"':"";return{extractCritical:a(e),renderStylesToString:u(e,r),renderStylesToNodeStream:d(e,r)}}(function(e){var r=n({key:"css"});r.sheet.speedy=function(e){if("production"!==process.env.NODE_ENV&&0!==this.ctr)throw new Error("speedy must be changed before any rules are inserted");this.isSpeedy=e},r.compat=!0;var t=function(){var e=i([].slice.call(arguments),r.registered,void 0);return s(r,e,!1),r.key+"-"+e.name};return{css:t,cx:function(){return f(r.registered,t,v([].slice.call(arguments)))},injectGlobal:function(){var e=i([].slice.call(arguments),r.registered);l(r,e)},keyframes:function(){var e=i([].slice.call(arguments),r.registered),t="animation-"+e.name;return l(r,{name:e.name,styles:"@keyframes "+t+"{"+e.styles+"}"}),t},hydrate:function(e){e.forEach(function(e){r.inserted[e]=!0})},flush:function(){r.registered={},r.inserted={},r.sheet.flush()},sheet:r.sheet,cache:r,getRegisteredStyles:o.bind(null,r.registered),merge:f.bind(null,r.registered,t)}}().cache),y=m.extractCritical,g=m.renderStylesToString,h=m.renderStylesToNodeStream;export{y as extractCritical,h as renderStylesToNodeStream,g as renderStylesToString};
//# sourceMappingURL=emotion-server.esm.js.map
