{"version":3,"file":"smart-monaco-editor.modern.js","sources":["../src/importScript.js","../src/monaco.js","../src/editor.ts"],"sourcesContent":["const cache = {};\n\nexport const importScript = (src, res = []) => {\n  const prefix = src.slice(0, 8);\n  if (prefix === \"https://\") {\n    return window.document.head.querySelector(`script[src=\"${src}\"]`) ||\n      new Promise(function (resolve, reject) {\n        const s = window.document.createElement(\"script\");\n        s.src = src;\n        s.type = \"application/javascript\";\n        s.onload = (() => {\n          if (res.length === 0) {\n            resolve(window);\n          }\n          const ret = {};\n          res.forEach((x) => Object.assign(ret, window[x]));\n          resolve(ret);\n        });\n\n        s.onerror = reject;\n        window.document.head.appendChild(s);\n      });\n  }\n};\n","import { importScript } from \"./importScript.js\";\n\nexport const getMonaco = async () => {\n  const vsPath = \"https://unpkg.com/monaco-editor@0.21.2/min/vs\";\n\n  const { require } = await importScript(\n    \"https://unpkg.com/monaco-editor@0.21.2/min/vs/loader.js\",\n  );\n\n  require.config({ paths: { \"vs\": vsPath } });\n  const monaco = await new Promise((resolve) =>\n    require([\"vs/editor/editor.main\"], (_m) => resolve(_m))\n  );\n  return monaco;\n};\n\nexport const isMobile = () => {\n  if (typeof window === \"undefined\") return false;\n\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n    window.navigator.userAgent,\n  );\n};\n","import { importScript } from \"./importScript.js\";\nimport { getMonaco, isMobile } from \"./monaco.js\";\nimport type * as Monaco from \"monaco-editor\";\n\nlet aceEditor = {};\n\ninterface StartMonacoProps {\n  onChange: (code: string) => void;\n  code: string;\n  language: \"html\" | \"javascript\" | \"typescript\";\n  options: {\n    gylph: boolean; \n  };\n}\n\nexport default async (\n  { onChange, code, language, options }: StartMonacoProps,\n) => {\n  var ace: unknown;\n\n  const { document } = window;\n  let container = document.getElementById(\"container\");\n\n  if (!container) {\n    container = document.createElement(\"container\");\n    container.id = \"container\";\n    document.body.appendChild(container);\n  }\n\n  const modelUri = language === \"typescript\"\n    ? \"file:///main.tsx\"\n    : \"file:///main.html\";\n\n  if (isMobile()) {\n    // some code.\n    const aceEl = window.document.createElement(\"div\");\n    aceEl.id = \"ace\";\n    window.document.body.appendChild(aceEl);\n\n    await importScript(\n      \"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js\",\n    );\n\n    language === \"typescript\"\n      ? await importScript(\n        \"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js\",\n      )\n      : await importScript(\n        \"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.min.js\",\n      );\n\n    await importScript(\n      \"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js\",\n    );\n\n    window.document.getElementById(\"ace\")!.style.setProperty(\n      \"display\",\n      \"block\",\n    );\n    container!.style.setProperty(\"display\", \"none\");\n\n    //@ts-ignore\n    aceEditor = window.ace.edit(\"ace\") as AceEditor;\n    //@ts-expect-error\n    aceEditor.getSession().setMode(\"ace/mode/typescript\");\n\n    const setThemeForAce = (wait: number) =>\n      setTimeout(() => {\n        //@ts-ignore\n\n        const aceEditor = ace.edit(\"ace\");\n        const theme = aceEditor.getTheme();\n        if (theme !== \"ace/theme/monokai \") {\n          aceEditor.setOptions({\n            fontSize: \"14pt\",\n          });\n          aceEditor.setTheme(\"ace/theme/monokai\");\n          setThemeForAce(2 * wait);\n        }\n      }, wait);\n\n    setThemeForAce(100);\n    //@ts-expect-error\n    aceEditor && aceEditor.setValue(code);\n    //@ts-ignore\n    aceEditor && aceEditor.blur();\n  }\n\n  const monaco = await getMonaco();\n\n  let model;\n  try {\n    model = monaco.editor.getModel(modelUri);\n    if (model.getValue() !== code) {\n      model.setValue(code);\n    }\n  } catch {\n    model = await monaco.editor.createModel(\n      code,\n      language,\n      monaco.Uri.parse(\n        modelUri,\n      ),\n    );\n  }\n\n  const modules = {\n    monaco: monaco,\n    editor: monaco.editor.create(\n      window.document.getElementById(\"container\"),\n      {\n        formatOnType: false,\n        scrollbar: {\n          horizontal: \"hidden\",\n          verticalHasArrows: true,\n          verticalScrollbarSize: 20,\n        },\n        minimap: {\n          enabled: false,\n        },\n        folding: false,\n        glyphMargin: false,\n        wordWrap: \"off\",\n        mouseWheelZoom: false,\n        wordWrapColumn: 80,\n        useTabStops: false,\n        dragAndDrop: false,\n        disableLayerHinting: true,\n        formatOnPaste: false,\n        disableMonospaceOptimizations: true,\n        showUnused: true,\n\n        //       glyphMargin: true,\n        automaticLayout: true,\n        scrollBeyondLastLine: false,\n        autoIndent: \"full\",\n        accessibilitySupport: \"off\",\n        autoClosingQuotes: \"beforeWhitespace\",\n        padding: {\n          bottom: 300,\n        },\n        lineNumbers: \"on\",\n\n        autoClosingBrackets: \"beforeWhitespace\",\n\n        autoClosingOvertype: \"auto\",\n\n        suggest: {},\n        codeLens: true,\n        autoSurround: \"languageDefined\",\n        // acceptSuggestionOnCommitCharacter: true,\n        trimAutoWhitespace: false,\n        codeActionsOnSaveTimeout: 100,\n        model,\n        value: code,\n        language: language,\n        theme: \"vs-dark\",\n        ...options,\n      },\n    ),\n  };\n\n  modules.editor.onDidChangeModelContent(() =>\n  onChange(modules.editor.getValue())\n);\n\n  if (isMobile()) {\n   \n    //@ts-expect-error\n    aceEditor && aceEditor.session.on(\"change\", function () {\n      //@ts-expect-error\n\n      const value = aceEditor.getValue();\n      modules.editor.setValue(value);\n      onChange(value);\n    });\n\n    aceEditor &&\n      document.getElementById(\"container\")!.replaceWith(\n        document.getElementById(\"ace\")!,\n      );\n  }\n  modules.monaco.languages.typescript.typescriptDefaults\n    .setDiagnosticsOptions({\n      noSuggestionDiagnostics: true,\n      noSemanticValidation: true,\n      noSyntaxValidation: true,\n    });\n\n  if (language === \"typescript\") {\n    const importHelper = [\n      {\n        name: \"react\",\n        url: \"https://unpkg.com/@types/react@17.0.0/index.d.ts\",\n        depend: [\"global\", \"csstype\", \"react-dom\", \"prop-types\"],\n      },\n      {\n        name: \"global\",\n        url: \"https://unpkg.com/@types/react@17.0.0/global.d.ts\",\n        depend: [],\n      },\n      {\n        name: \"prop-types\",\n        url: \"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts\",\n        depend: [],\n      },\n      {\n        name: \"react-dom\",\n        url: \"https://unpkg.com/@types/react-dom@17.0.0/index.d.ts\",\n        depend: [],\n      },\n      {\n        name: \"csstype\",\n        url: \"https://unpkg.com/csstype@3.0.5/index.d.ts\",\n        depend: [],\n      },\n      {\n        name: \"@emotion/styled/base.d.ts\",\n        url: \"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts\",\n        depend: [\n          \"@emotion/react\",\n          \"@emotion/serialize\",\n          \"react\",\n        ],\n      },\n      {\n        name: \"@emotion/styled/index.d.ts\",\n        url: \"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts\",\n        depend: [\n          \"@emotion/react\",\n          \"@emotion/serialize\",\n          \"react\",\n        ],\n      },\n      {\n        name: \"@emotion/cache/index.d.ts\",\n        url: \"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts\",\n        depend: [\"@emotion/utils\"],\n      },\n      {\n        name: \"@emotion/react/index.d.ts\",\n        url: \"https://unpkg.com/@emotion/react@11.1.4/types/index.d.ts\",\n        depend: [\"@emotion/cache\"],\n      },\n      {\n        name: \"@emotion/react/jsx-namespace.d.ts\",\n        url: \"https://unpkg.com/@emotion/react@11.1.4/types/jsx-namespace.d.ts\",\n        depend: [\"@emotion/utils\", \"csstype\"],\n      },\n      {\n        name: \"@emotion/react/css-prop.d.ts\",\n        url: \"https://unpkg.com/@emotion/react@11.1.4/types/css-prop.d.ts\",\n        depend: [\"@emotion/utils\", \"csstype\"],\n      },\n      {\n        name: \"@emotion/react/helper.d.ts\",\n        url: \"https://unpkg.com/@emotion/react@11.1.4/types/helper.d.ts\",\n        depend: [\"@emotion/utils\", \"csstype\"],\n      },\n      {\n        name: \"@emotion/react/theming.d.ts\",\n        url: \"https://unpkg.com/@emotion/react@11.1.4/types/theming.d.ts\",\n        depend: [\"@emotion/utils\", \"csstype\"],\n      },\n      {\n        name: \"@emotion/serialize/index.d.ts\",\n        url: \"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts\",\n\n        depend: [\"@emotion/utils\", \"csstype\"],\n      },\n      {\n        name: \"@emotion/utils/index.d.ts\",\n        url: \"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts\",\n        depend: [],\n      },\n      {\n        name: \"framer-motion\",\n        url: \"https://unpkg.com/framer-motion@3.1.1/dist/framer-motion.d.ts\",\n        depend: [],\n      },\n      {\n        name: \"popmotion\",\n        url: \"https://unpkg.com/popmotion@9.0.2/lib/index.d.ts\",\n      },\n      {\n        name: \"@zedvision/qrious/index.d.ts\",\n        url: \"https://unpkg.com/@zedvision/qrious@10.12.14/dist/qrious.d.ts\",\n      },\n    ];\n    //# sourceMappingURL=importHelper.js.map\n    const dts = importHelper.map(({ name, url }) =>\n      (async () =>\n        modules.monaco.languages.typescript.typescriptDefaults.addExtraLib(\n          await (await fetch(\n            url,\n          )).text(),\n          name.includes(\"@\")\n            ? `file:///node_modules/${name}`\n            : `file:///node_modules/@types/${name}/index.d.ts`,\n        ))()\n    );\n\n    modules.monaco.languages.typescript.typescriptDefaults.setCompilerOptions(\n      {\n        target: modules.monaco.languages.typescript.ScriptTarget.ESNext,\n        allowNonTsExtensions: true,\n        allowUmdGlobalAccess: true,\n        strict: true,\n        allowJs: true,\n        noEmitOnError: true,\n        allowSyntheticDefaultImports: true,\n        moduleResolution:\n          modules.monaco.languages.typescript.ModuleResolutionKind.Nodejs,\n        module: modules.monaco.languages.typescript.ModuleKind.CommonJS,\n        noEmit: true,\n        typeRoots: [\"node_modules/@types\"],\n        jsx: \"react-jsx\",\n        esModuleInterop: true,\n      },\n    );\n\n    await Promise.all(dts);\n\n    modules.monaco.languages.typescript.typescriptDefaults\n      .setDiagnosticsOptions({\n        noSuggestionDiagnostics: false,\n        noSemanticValidation: false,\n        noSyntaxValidation: false,\n      });\n    return modules;\n  }\n};\n"],"names":["importScript","src","res","slice","window","document","head","querySelector","Promise","resolve","reject","s","createElement","type","onload","length","ret","forEach","x","Object","assign","onerror","appendChild","isMobile","test","navigator","userAgent","aceEditor","onChange","code","language","options","container","getElementById","id","body","modelUri","aceEl","style","setProperty","ace","edit","getSession","setMode","setThemeForAce","wait","setTimeout","getTheme","setOptions","fontSize","setTheme","setValue","blur","monaco","async","require","config","paths","vs","_m","getMonaco","model","editor","getModel","getValue","createModel","Uri","parse","modules","create","formatOnType","scrollbar","horizontal","verticalHasArrows","verticalScrollbarSize","minimap","enabled","folding","glyphMargin","wordWrap","mouseWheelZoom","wordWrapColumn","useTabStops","dragAndDrop","disableLayerHinting","formatOnPaste","disableMonospaceOptimizations","showUnused","automaticLayout","scrollBeyondLastLine","autoIndent","accessibilitySupport","autoClosingQuotes","padding","bottom","lineNumbers","autoClosingBrackets","autoClosingOvertype","suggest","codeLens","autoSurround","trimAutoWhitespace","codeActionsOnSaveTimeout","value","theme","onDidChangeModelContent","session","on","replaceWith","languages","typescript","typescriptDefaults","setDiagnosticsOptions","noSuggestionDiagnostics","noSemanticValidation","noSyntaxValidation","dts","name","url","depend","map","addExtraLib","fetch","text","includes","setCompilerOptions","target","ScriptTarget","ESNext","allowNonTsExtensions","allowUmdGlobalAccess","strict","allowJs","noEmitOnError","allowSyntheticDefaultImports","moduleResolution","ModuleResolutionKind","Nodejs","module","ModuleKind","CommonJS","noEmit","typeRoots","jsx","esModuleInterop","all"],"mappings":"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"}