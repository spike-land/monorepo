!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("https://unpkg.com/idb@5.0.8/build/esm/index.js"),require("https://unpkg.com/@zedvision/diff@10.12.3/dist/diff.min.js")):"function"==typeof define&&define.amd?define(["exports","https://unpkg.com/idb@5.0.8/build/esm/index.js","https://unpkg.com/@zedvision/diff@10.12.3/dist/diff.min.js"],n):n((e||self).shadb={},e.index_js,e.diff_min_js)}(this,function(e,n,t){function r(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}e.getDB=function(){return function(e,n){void 0===n&&(n=!1);var o={get:function(i,u){void 0===u&&(u="string");try{var c,f,s=function(e){var n;if(c)return e;if("json"===u)return JSON.parse(f);var r=function(){if("string"===u)return Promise.resolve(f).then(function(e){function r(t){return n=1,(new TextDecoder).decode(e)}var i=function(){if("string"==typeof e&&"string"===u){var r=function(t){return n=1,e},i=e,c=function(){if(t.isDiff(i)){var e=i.slice(0,8),r=i.slice(8);return Promise.resolve(o.get(e)).then(function(e){return n=1,t.assemble(e,r)})}}();return c&&c.then?c.then(r):r()}}();return i&&i.then?i.then(r):r()})}();return r&&r.then?r.then(function(e){return n?e:f}):n?r:f},d=r(function(){function t(){if(!f)return c=1,null}var r=n?Promise.resolve(e).then(function(e){return Promise.resolve(e.get("codeStore",i)).then(function(e){f=e})}):Promise.resolve(e.get(i)).then(function(e){f=e});return r&&r.then?r.then(t):t()},function(){return c=1,null});return Promise.resolve(d&&d.then?d.then(s):s(d))}catch(e){return Promise.reject(e)}},put:function(i,u){try{var c,f=function(){return""!==c&&u===c?u:(t="string"!=typeof u?(new TextDecoder).decode(u):u,n?Promise.resolve(e).then(function(e){return e.put("codeStore",t,i)}):Promise.resolve(e.put(i,t)));var t},s=r(function(){return Promise.resolve(o.get(i)).then(function(e){var n=function(){if("string"==typeof e&&"string"==typeof u&&8===e.length&&e!==u)return Promise.resolve(o.get(u)).then(function(n){return Promise.resolve(o.get(e)).then(function(r){var i=function(){if("string"==typeof r)return Promise.resolve(function(e){try{return Promise.resolve(crypto.subtle.digest("SHA-256","string"==typeof e?(new TextEncoder).encode(e):e)).then(function(e){return Array.from(new Uint8Array(e).slice(0,4)).map(function(e){return("00"+e.toString(16)).slice(-2)}).join("")})}catch(e){return Promise.reject(e)}}(r)).then(function(i){var u=function(){if(i===e)return Promise.resolve(t.diff(n,r)).then(function(e){var n=e.b+JSON.stringify(e.c);o.put(i,n)})}();if(u&&u.then)return u.then(function(){})})}();if(i&&i.then)return i.then(function(){})})})}();if(n&&n.then)return n.then(function(){})})},function(){c=""});return Promise.resolve(s&&s.then?s.then(f):f())}catch(e){return Promise.reject(e)}},delete:function(n){try{return Promise.resolve(e).then(function(e){return e.delete("codeStore",n)})}catch(e){return Promise.reject(e)}},clear:function(){try{return Promise.resolve(e).then(function(e){return e.clear("codeStore")})}catch(e){return Promise.reject(e)}},keys:function(){try{return Promise.resolve(e).then(function(e){return e.getAllKeys("codeStore")})}catch(e){return Promise.reject(e)}}};return o}(n.openDB("localZedCodeStore",1,{upgrade:function(e){e.createObjectStore("codeStore")},blocked:function(){},blocking:function(){},terminated:function(){}}),!0)}});
//# sourceMappingURL=shadb.umd.js.map
