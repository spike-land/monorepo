import{openDB as e}from"https://unpkg.com/idb@5.0.8/build/esm/index.js";import{isDiff as t,assemble as n,diff as r}from"https://unpkg.com/@zedvision/diff@10.12.3/dist/diff.min.js";function o(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function i(){return function(e,i){void 0===i&&(i=!1);var u={get:function(r,c){void 0===c&&(c="string");try{var f,s,h=function(e){var r;if(f)return e;if("json"===c)return JSON.parse(s);var o=function(){if("string"===c)return Promise.resolve(s).then(function(e){function o(t){return r=1,(new TextDecoder).decode(e)}var i=function(){if("string"==typeof e&&"string"===c){var o=function(t){return r=1,e},i=e,f=function(){if(t(i)){var e=i.slice(0,8),o=i.slice(8);return Promise.resolve(u.get(e)).then(function(e){return r=1,n(e,o)})}}();return f&&f.then?f.then(o):o()}}();return i&&i.then?i.then(o):o()})}();return o&&o.then?o.then(function(e){return r?e:s}):r?o:s},l=o(function(){function t(){if(!s)return f=1,null}var n=i?Promise.resolve(e).then(function(e){return Promise.resolve(e.get("codeStore",r)).then(function(e){s=e})}):Promise.resolve(e.get(r)).then(function(e){s=e});return n&&n.then?n.then(t):t()},function(){return f=1,null});return Promise.resolve(l&&l.then?l.then(h):h(l))}catch(e){return Promise.reject(e)}},put:function(t,n){try{var c,f=function(){return""!==c&&n===c?n:(r="string"!=typeof n?(new TextDecoder).decode(n):n,i?Promise.resolve(e).then(function(e){return e.put("codeStore",r,t)}):Promise.resolve(e.put(t,r)));var r},s=o(function(){return Promise.resolve(u.get(t)).then(function(e){var t=function(){if("string"==typeof e&&"string"==typeof n&&8===e.length&&e!==n)return Promise.resolve(u.get(n)).then(function(t){return Promise.resolve(u.get(e)).then(function(n){var o=function(){if("string"==typeof n)return Promise.resolve(function(e){try{return Promise.resolve(crypto.subtle.digest("SHA-256","string"==typeof e?(new TextEncoder).encode(e):e)).then(function(e){return Array.from(new Uint8Array(e).slice(0,4)).map(function(e){return("00"+e.toString(16)).slice(-2)}).join("")})}catch(e){return Promise.reject(e)}}(n)).then(function(o){var i=function(){if(o===e)return Promise.resolve(r(t,n)).then(function(e){var t=e.b+JSON.stringify(e.c);u.put(o,t)})}();if(i&&i.then)return i.then(function(){})})}();if(o&&o.then)return o.then(function(){})})})}();if(t&&t.then)return t.then(function(){})})},function(){c=""});return Promise.resolve(s&&s.then?s.then(f):f())}catch(e){return Promise.reject(e)}},delete:function(t){try{return Promise.resolve(e).then(function(e){return e.delete("codeStore",t)})}catch(e){return Promise.reject(e)}},clear:function(){try{return Promise.resolve(e).then(function(e){return e.clear("codeStore")})}catch(e){return Promise.reject(e)}},keys:function(){try{return Promise.resolve(e).then(function(e){return e.getAllKeys("codeStore")})}catch(e){return Promise.reject(e)}}};return u}(e("localZedCodeStore",1,{upgrade:function(e){e.createObjectStore("codeStore")},blocked:function(){},blocking:function(){},terminated:function(){}}),!0)}export{i as getDB};
//# sourceMappingURL=shadb.esm.js.map
