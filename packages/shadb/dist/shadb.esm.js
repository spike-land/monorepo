import{openDB as e}from"https://unpkg.com/idb@5.0.8/build/esm/index.js";import{isDiff as n,assemble as t,diff as r}from"https://unpkg.com/@zedvision/diff@10.12.3/dist/diff.min.js";function o(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}function i(){return function(e,i){void 0===i&&(i=!1);var u={get:function(r,c){void 0===c&&(c="string");try{var f,s,h=function(e){return f?e:"json"===c?JSON.parse(s):Promise.resolve(s).then(function(e){var r,o=function(){if("string"===c){var o=function(n){return r?n:(r=1,(new TextDecoder).decode(e))},i=function(){if("string"==typeof e&&"string"===c){var o=function(n){return r?n:(r=1,e)},i=e,f=function(){if(n(i)){var e=i.slice(0,8),o=i.slice(8);return Promise.resolve(u.get(e)).then(function(e){return r=1,t(e,o)})}}();return f&&f.then?f.then(o):o(f)}}();return i&&i.then?i.then(o):o(i)}}();return o&&o.then?o.then(function(e){return r?e:s}):r?o:s})},l=o(function(){function n(){if(!s)return f=1,null}var t=i?Promise.resolve(e).then(function(e){return Promise.resolve(e.get("codeStore",r)).then(function(e){s=e})}):Promise.resolve(e.get(r)).then(function(e){s=e});return t&&t.then?t.then(n):n()},function(){return f=1,null});return Promise.resolve(l&&l.then?l.then(h):h(l))}catch(e){return Promise.reject(e)}},put:function(n,t){try{var c,f=function(){return""!==c&&t===c?t:(r="string"!=typeof t?(new TextDecoder).decode(t):t,i?Promise.resolve(e).then(function(e){return e.put("codeStore",r,n)}):Promise.resolve(e.put(n,r)));var r},s=o(function(){return Promise.resolve(u.get(n)).then(function(e){var n=function(){if("string"==typeof e&&"string"==typeof t&&8===e.length&&e!==t)return Promise.resolve(u.get(t)).then(function(n){return Promise.resolve(u.get(e)).then(function(t){var o=function(){if("string"==typeof t)return Promise.resolve(function(e){try{return Promise.resolve(crypto.subtle.digest("SHA-256","string"==typeof e?(new TextEncoder).encode(e):e)).then(function(e){return Array.from(new Uint8Array(e).slice(0,4)).map(function(e){return("00"+e.toString(16)).slice(-2)}).join("")})}catch(e){return Promise.reject(e)}}(t)).then(function(o){var i=function(){if(o===e)return Promise.resolve(r(n,t)).then(function(e){var n=e.b+JSON.stringify(e.c);u.put(o,n)})}();if(i&&i.then)return i.then(function(){})})}();if(o&&o.then)return o.then(function(){})})})}();if(n&&n.then)return n.then(function(){})})},function(){c=""});return Promise.resolve(s&&s.then?s.then(f):f())}catch(e){return Promise.reject(e)}},delete:function(n){try{return Promise.resolve(e).then(function(e){return e.delete("codeStore",n)})}catch(e){return Promise.reject(e)}},clear:function(){try{return Promise.resolve(e).then(function(e){return e.clear("codeStore")})}catch(e){return Promise.reject(e)}},keys:function(){try{return Promise.resolve(e).then(function(e){return e.getAllKeys("codeStore")})}catch(e){return Promise.reject(e)}}};return u}(e("zed-vision-alpha",2,{upgrade:function(e){e.createObjectStore("sha-store")},blocked:function(){},blocking:function(){},terminated:function(){}}),!0)}export{i as getDB};
//# sourceMappingURL=shadb.esm.js.map
