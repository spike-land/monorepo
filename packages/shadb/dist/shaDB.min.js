(function(i,s){typeof exports=="object"&&typeof module!="undefined"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(i=i||self,s(i.Diff={}))})(this,function(i){"use strict";function s(){}s.prototype={diff:function(e,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=t.callback;typeof t=="function"&&(r=t,t={}),this.options=t;var a=this;function o(w){return r?(setTimeout(function(){r(void 0,w)},0),!0):w}e=this.castInput(e),n=this.castInput(n),e=this.removeEmpty(this.tokenize(e)),n=this.removeEmpty(this.tokenize(n));var u=n.length,l=e.length,c=1,d=u+l,v=[{newPos:-1,components:[]}],x=this.extractCommon(v[0],n,e,0);if(v[0].newPos+1>=u&&x+1>=l)return o([{value:this.join(n),count:n.length}]);function h(){for(var w=-1*c;w<=c;w+=2){var y=void 0,H=v[w-1],L=v[w+1],k=(L?L.newPos:0)-w;H&&(v[w-1]=void 0);var N=H&&H.newPos+1<u,M=L&&0<=k&&k<l;if(!N&&!M){v[w]=void 0;continue}if(!N||M&&H.newPos<L.newPos?(y=p(L),a.pushComponent(y.components,void 0,!0)):(y=H,y.newPos++,a.pushComponent(y.components,!0,void 0)),k=a.extractCommon(y,n,e,w),y.newPos+1>=u&&k+1>=l)return o(f(a,y.components,n,e,a.useLongestToken));v[w]=y}c++}if(r)(function w(){setTimeout(function(){if(c>d)return r();h()||w()},0)})();else for(;c<=d;){var b=h();if(b)return b}},pushComponent:function(e,n,t){var r=e[e.length-1];r&&r.added===n&&r.removed===t?e[e.length-1]={count:r.count+1,added:n,removed:t}:e.push({count:1,added:n,removed:t})},extractCommon:function(e,n,t,r){for(var a=n.length,o=t.length,u=e.newPos,l=u-r,c=0;u+1<a&&l+1<o&&this.equals(n[u+1],t[l+1]);)u++,l++,c++;return c&&e.components.push({count:c}),e.newPos=u,l},equals:function(e,n){return this.options.comparator?this.options.comparator(e,n):e===n||this.options.ignoreCase&&e.toLowerCase()===n.toLowerCase()},removeEmpty:function(e){for(var n=[],t=0;t<e.length;t++)e[t]&&n.push(e[t]);return n},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function f(e,n,t,r,a){for(var o=0,u=n.length,l=0,c=0;o<u;o++){var d=n[o];if(d.removed){if(d.value=e.join(r.slice(c,c+d.count)),c+=d.count,o&&n[o-1].added){var v=n[o-1];n[o-1]=n[o],n[o]=v}}else{if(!d.added&&a){var x=t.slice(l,l+d.count);x=x.map(function(b,w){var y=r[c+w];return y.length>b.length?y:b}),d.value=e.join(x)}else d.value=e.join(t.slice(l,l+d.count));l+=d.count,d.added||(c+=d.count)}}var h=n[u-1];return u>1&&typeof h.value=="string"&&(h.added||h.removed)&&e.equals("",h.value)&&(n[u-2].value+=h.value,n.pop()),n}function p(e){return{newPos:e.newPos,components:e.components.slice(0)}}var g=new s;function m(e,n,t){return g.diff(e,n,t)}function S(e,n){if(typeof e=="function")n.callback=e;else if(e)for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}var P=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,D=/\S/,j=new s;j.equals=function(e,n){return this.options.ignoreCase&&(e=e.toLowerCase(),n=n.toLowerCase()),e===n||this.options.ignoreWhitespace&&!D.test(e)&&!D.test(n)},j.tokenize=function(e){for(var n=e.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<n.length-1;t++)!n[t+1]&&n[t+2]&&P.test(n[t])&&P.test(n[t+2])&&(n[t]+=n[t+2],n.splice(t+1,2),t--);return n};function B(e,n,t){return t=S(t,{ignoreWhitespace:!0}),j.diff(e,n,t)}function V(e,n,t){return j.diff(e,n,t)}var K=new s;K.tokenize=function(e){var n=[],t=e.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var a=t[r];r%2&&!this.options.newlineIsToken?n[n.length-1]+=a:(this.options.ignoreWhitespace&&(a=a.trim()),n.push(a))}return n};function ge(e,n,t){return K.diff(e,n,t)}function Ae(e,n,t){var r=S(t,{ignoreWhitespace:!0});return K.diff(e,n,r)}var ve=new s;ve.tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)};function Be(e,n,t){return ve.diff(e,n,t)}var me=new s;me.tokenize=function(e){return e.split(/([{}:;,]|\s+)/)};function Me(e,n,t){return me.diff(e,n,t)}function Z(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Z=function(n){return typeof n}:Z=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Z(e)}function I(e){return Oe(e)||Te(e)||$e(e)||Je()}function Oe(e){if(Array.isArray(e))return ne(e)}function Te(e){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(e))return Array.from(e)}function $e(e,n){if(!e)return;if(typeof e=="string")return ne(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ne(e,n)}function ne(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function Je(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var We=Object.prototype.toString,W=new s;W.useLongestToken=!0,W.tokenize=K.tokenize,W.castInput=function(e){var n=this.options,t=n.undefinedReplacement,r=n.stringifyReplacer,a=r===void 0?function(o,u){return typeof u=="undefined"?t:u}:r;return typeof e=="string"?e:JSON.stringify(_(e,null,null,a),a,"  ")},W.equals=function(e,n){return s.prototype.equals.call(W,e.replace(/,([\r\n])/g,"$1"),n.replace(/,([\r\n])/g,"$1"))};function ze(e,n,t){return W.diff(e,n,t)}function _(e,n,t,r,a){n=n||[],t=t||[],r&&(e=r(a,e));var o;for(o=0;o<n.length;o+=1)if(n[o]===e)return t[o];var u;if(We.call(e)==="[object Array]"){for(n.push(e),u=new Array(e.length),t.push(u),o=0;o<e.length;o+=1)u[o]=_(e[o],n,t,r,a);return n.pop(),t.pop(),u}if(e&&e.toJSON&&(e=e.toJSON()),Z(e)==="object"&&e!==null){n.push(e),u={},t.push(u);var l=[],c;for(c in e)e.hasOwnProperty(c)&&l.push(c);for(l.sort(),o=0;o<l.length;o+=1)c=l[o],u[c]=_(e[c],n,t,r,c);n.pop(),t.pop()}else u=e;return u}var G=new s;G.tokenize=function(e){return e.slice()},G.join=G.removeEmpty=function(e){return e};function Ve(e,n,t){return G.diff(e,n,t)}function X(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.split(/\r\n|[\n\v\f\r\x85]/),r=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],a=[],o=0;function u(){var d={};for(a.push(d);o<t.length;){var v=t[o];if(/^(\-\-\-|\+\+\+|@@)\s/.test(v))break;var x=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(v);x&&(d.index=x[1]),o++}for(l(d),l(d),d.hunks=[];o<t.length;){var h=t[o];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(h))break;if(/^@@/.test(h))d.hunks.push(c());else{if(h&&n.strict)throw new Error("Unknown line "+(o+1)+" "+JSON.stringify(h));o++}}}function l(d){var v=/^(---|\+\+\+)\s+(.*)$/.exec(t[o]);if(v){var x=v[1]==="---"?"old":"new",h=v[2].split("	",2),b=h[0].replace(/\\\\/g,"\\");/^".*"$/.test(b)&&(b=b.substr(1,b.length-2)),d[x+"FileName"]=b,d[x+"Header"]=(h[1]||"").trim(),o++}}function c(){var d=o,v=t[o++],x=v.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),h={oldStart:+x[1],oldLines:typeof x[2]=="undefined"?1:+x[2],newStart:+x[3],newLines:typeof x[4]=="undefined"?1:+x[4],lines:[],linedelimiters:[]};h.oldLines===0&&(h.oldStart+=1),h.newLines===0&&(h.newStart+=1);for(var b=0,w=0;o<t.length&&!(t[o].indexOf("--- ")===0&&o+2<t.length&&t[o+1].indexOf("+++ ")===0&&t[o+2].indexOf("@@")===0);o++){var y=t[o].length==0&&o!=t.length-1?" ":t[o][0];if(y==="+"||y==="-"||y===" "||y==="\\")h.lines.push(t[o]),h.linedelimiters.push(r[o]||`
`),y==="+"?b++:y==="-"?w++:y===" "&&(b++,w++);else break}if(!b&&h.newLines===1&&(h.newLines=0),!w&&h.oldLines===1&&(h.oldLines=0),n.strict){if(b!==h.newLines)throw new Error("Added line count did not match for hunk at line "+(d+1));if(w!==h.oldLines)throw new Error("Removed line count did not match for hunk at line "+(d+1))}return h}for(;o<t.length;)u();return a}function Ue(e,n,t){var r=!0,a=!1,o=!1,u=1;return function l(){if(r&&!o){if(a?u++:r=!1,e+u<=t)return u;o=!0}if(!a)return o||(r=!0),n<=e-u?-u++:(a=!0,l())}}function we(e,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof n=="string"&&(n=X(n)),Array.isArray(n)){if(n.length>1)throw new Error("applyPatch only works with a single input.");n=n[0]}var r=e.split(/\r\n|[\n\v\f\r\x85]/),a=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],o=n.hunks,u=t.compareLine||function(ae,R,ee,J){return R===J},l=0,c=t.fuzzFactor||0,d=0,v=0,x,h;function b(ae,R){for(var ee=0;ee<ae.lines.length;ee++){var J=ae.lines[ee],ue=J.length>0?J[0]:" ",rn=J.length>0?J.substr(1):J;if(ue===" "||ue==="-"){if(!u(R+1,r[R],ue,rn)&&(l++,l>c))return!1;R++}}return!0}for(var w=0;w<o.length;w++){for(var y=o[w],H=r.length-y.oldLines,L=0,k=v+y.oldStart-1,N=Ue(k,d,H);L!==void 0;L=N())if(b(y,k+L)){y.offset=v+=L;break}if(L===void 0)return!1;d=y.offset+y.oldStart+y.oldLines}for(var M=0,z=0;z<o.length;z++){var F=o[z],C=F.oldStart+F.offset+M-1;M+=F.newLines-F.oldLines;for(var E=0;E<F.lines.length;E++){var A=F.lines[E],$=A.length>0?A[0]:" ",se=A.length>0?A.substr(1):A,Q=F.linedelimiters[E];if($===" ")C++;else if($==="-")r.splice(C,1),a.splice(C,1);else if($==="+")r.splice(C,0,se),a.splice(C,0,Q),C++;else if($==="\\"){var Y=F.lines[E-1]?F.lines[E-1][0]:null;Y==="+"?x=!0:Y==="-"&&(h=!0)}}}if(x)for(;!r[r.length-1];)r.pop(),a.pop();else h&&(r.push(""),a.push(`
`));for(var U=0;U<r.length-1;U++)r[U]=r[U]+a[U];return r.join("")}function Re(e,n){typeof e=="string"&&(e=X(e));var t=0;function r(){var a=e[t++];if(!a)return n.complete();n.loadFile(a,function(o,u){if(o)return n.complete(o);var l=we(u,a,n);n.patched(a,l,function(c){if(c)return n.complete(c);r()})})}r()}function te(e,n,t,r,a,o,u){u||(u={}),typeof u.context=="undefined"&&(u.context=4);var l=ge(t,r,u);l.push({value:"",lines:[]});function c(L){return L.map(function(k){return" "+k})}for(var d=[],v=0,x=0,h=[],b=1,w=1,y=function(L){var k=l[L],N=k.lines||k.value.replace(/\n$/,"").split(`
`);if(k.lines=N,k.added||k.removed){var M;if(!v){var z=l[L-1];v=b,x=w,z&&(h=u.context>0?c(z.lines.slice(-u.context)):[],v-=h.length,x-=h.length)}(M=h).push.apply(M,I(N.map(function(Y){return(k.added?"+":"-")+Y}))),k.added?w+=N.length:b+=N.length}else{if(v)if(N.length<=u.context*2&&L<l.length-2){var F;(F=h).push.apply(F,I(c(N)))}else{var C,E=Math.min(N.length,u.context);(C=h).push.apply(C,I(c(N.slice(0,E))));var A={oldStart:v,oldLines:b-v+E,newStart:x,newLines:w-x+E,lines:h};if(L>=l.length-2&&N.length<=u.context){var $=/\n$/.test(t),se=/\n$/.test(r),Q=N.length==0&&h.length>A.oldLines;!$&&Q&&t.length>0&&h.splice(A.oldLines,0,"\\ No newline at end of file"),(!$&&!Q||!se)&&h.push("\\ No newline at end of file")}d.push(A),v=0,x=0,h=[]}b+=N.length,w+=N.length}},H=0;H<l.length;H++)y(H);return{oldFileName:e,newFileName:n,oldHeader:a,newHeader:o,hunks:d}}function Ke(e){var n=[];e.oldFileName==e.newFileName&&n.push("Index: "+e.oldFileName),n.push("==================================================================="),n.push("--- "+e.oldFileName+(typeof e.oldHeader=="undefined"?"":"	"+e.oldHeader)),n.push("+++ "+e.newFileName+(typeof e.newHeader=="undefined"?"":"	"+e.newHeader));for(var t=0;t<e.hunks.length;t++){var r=e.hunks[t];r.oldLines===0&&(r.oldStart-=1),r.newLines===0&&(r.newStart-=1),n.push("@@ -"+r.oldStart+","+r.oldLines+" +"+r.newStart+","+r.newLines+" @@"),n.push.apply(n,r.lines)}return n.join(`
`)+`
`}function ye(e,n,t,r,a,o,u){return Ke(te(e,n,t,r,a,o,u))}function Ze(e,n,t,r,a,o){return ye(e,e,n,t,r,a,o)}function _e(e,n){return e.length!==n.length?!1:re(e,n)}function re(e,n){if(n.length>e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ge(e){var n=oe(e.lines),t=n.oldLines,r=n.newLines;t!==void 0?e.oldLines=t:delete e.oldLines,r!==void 0?e.newLines=r:delete e.newLines}function Xe(e,n,t){e=Se(e,t),n=Se(n,t);var r={};(e.index||n.index)&&(r.index=e.index||n.index),(e.newFileName||n.newFileName)&&(xe(e)?xe(n)?(r.oldFileName=q(r,e.oldFileName,n.oldFileName),r.newFileName=q(r,e.newFileName,n.newFileName),r.oldHeader=q(r,e.oldHeader,n.oldHeader),r.newHeader=q(r,e.newHeader,n.newHeader)):(r.oldFileName=e.oldFileName,r.newFileName=e.newFileName,r.oldHeader=e.oldHeader,r.newHeader=e.newHeader):(r.oldFileName=n.oldFileName||e.oldFileName,r.newFileName=n.newFileName||e.newFileName,r.oldHeader=n.oldHeader||e.oldHeader,r.newHeader=n.newHeader||e.newHeader)),r.hunks=[];for(var a=0,o=0,u=0,l=0;a<e.hunks.length||o<n.hunks.length;){var c=e.hunks[a]||{oldStart:Infinity},d=n.hunks[o]||{oldStart:Infinity};if(be(c,d))r.hunks.push(Le(c,u)),a++,l+=c.newLines-c.oldLines;else if(be(d,c))r.hunks.push(Le(d,l)),o++,u+=d.newLines-d.oldLines;else{var v={oldStart:Math.min(c.oldStart,d.oldStart),oldLines:0,newStart:Math.min(c.newStart+u,d.oldStart+l),newLines:0,lines:[]};qe(v,c.oldStart,c.lines,d.oldStart,d.lines),o++,a++,r.hunks.push(v)}}return r}function Se(e,n){if(typeof e=="string"){if(/^@@/m.test(e)||/^Index:/m.test(e))return X(e)[0];if(!n)throw new Error("Must provide a base reference or pass in a patch");return te(void 0,void 0,n,e)}return e}function xe(e){return e.newFileName&&e.newFileName!==e.oldFileName}function q(e,n,t){return n===t?n:(e.conflict=!0,{mine:n,theirs:t})}function be(e,n){return e.oldStart<n.oldStart&&e.oldStart+e.oldLines<n.oldStart}function Le(e,n){return{oldStart:e.oldStart,oldLines:e.oldLines,newStart:e.newStart+n,newLines:e.newLines,lines:e.lines}}function qe(e,n,t,r,a){var o={offset:n,lines:t,index:0},u={offset:r,lines:a,index:0};for(Ne(e,o,u),Ne(e,u,o);o.index<o.lines.length&&u.index<u.lines.length;){var l=o.lines[o.index],c=u.lines[u.index];if((l[0]==="-"||l[0]==="+")&&(c[0]==="-"||c[0]==="+"))Qe(e,o,u);else if(l[0]==="+"&&c[0]===" "){var d;(d=e.lines).push.apply(d,I(T(o)))}else if(c[0]==="+"&&l[0]===" "){var v;(v=e.lines).push.apply(v,I(T(u)))}else l[0]==="-"&&c[0]===" "?ke(e,o,u):c[0]==="-"&&l[0]===" "?ke(e,u,o,!0):l===c?(e.lines.push(l),o.index++,u.index++):ie(e,T(o),T(u))}De(e,o),De(e,u),Ge(e)}function Qe(e,n,t){var r=T(n),a=T(t);if(Pe(r)&&Pe(a)){if(re(r,a)&&je(t,r,r.length-a.length)){var o;(o=e.lines).push.apply(o,I(r));return}else if(re(a,r)&&je(n,a,a.length-r.length)){var u;(u=e.lines).push.apply(u,I(a));return}}else if(_e(r,a)){var l;(l=e.lines).push.apply(l,I(r));return}ie(e,r,a)}function ke(e,n,t,r){var a=T(n),o=Ye(t,a);if(o.merged){var u;(u=e.lines).push.apply(u,I(o.merged))}else ie(e,r?o:a,r?a:o)}function ie(e,n,t){e.conflict=!0,e.lines.push({conflict:!0,mine:n,theirs:t})}function Ne(e,n,t){for(;n.offset<t.offset&&n.index<n.lines.length;){var r=n.lines[n.index++];e.lines.push(r),n.offset++}}function De(e,n){for(;n.index<n.lines.length;){var t=n.lines[n.index++];e.lines.push(t)}}function T(e){for(var n=[],t=e.lines[e.index][0];e.index<e.lines.length;){var r=e.lines[e.index];if(t==="-"&&r[0]==="+"&&(t="+"),t===r[0])n.push(r),e.index++;else break}return n}function Ye(e,n){for(var t=[],r=[],a=0,o=!1,u=!1;a<n.length&&e.index<e.lines.length;){var l=e.lines[e.index],c=n[a];if(c[0]==="+")break;if(o=o||l[0]!==" ",r.push(c),a++,l[0]==="+")for(u=!0;l[0]==="+";)t.push(l),l=e.lines[++e.index];c.substr(1)===l.substr(1)?(t.push(l),e.index++):u=!0}if((n[a]||"")[0]==="+"&&o&&(u=!0),u)return t;for(;a<n.length;)r.push(n[a++]);return{merged:r,changes:t}}function Pe(e){return e.reduce(function(n,t){return n&&t[0]==="-"},!0)}function je(e,n,t){for(var r=0;r<t;r++){var a=n[n.length-t+r].substr(1);if(e.lines[e.index+r]!==" "+a)return!1}return e.index+=t,!0}function oe(e){var n=0,t=0;return e.forEach(function(r){if(typeof r!="string"){var a=oe(r.mine),o=oe(r.theirs);n!==void 0&&(a.oldLines===o.oldLines?n+=a.oldLines:n=void 0),t!==void 0&&(a.newLines===o.newLines?t+=a.newLines:t=void 0)}else t!==void 0&&(r[0]==="+"||r[0]===" ")&&t++,n!==void 0&&(r[0]==="-"||r[0]===" ")&&n++}),{oldLines:n,newLines:t}}function en(e){for(var n=[],t,r,a=0;a<e.length;a++)t=e[a],t.added?r=1:t.removed?r=-1:r=0,n.push([r,t.value]);return n}function nn(e){for(var n=[],t=0;t<e.length;t++){var r=e[t];r.added?n.push("<ins>"):r.removed&&n.push("<del>"),n.push(tn(r.value)),r.added?n.push("</ins>"):r.removed&&n.push("</del>")}return n.join("")}function tn(e){var n=e;return n=n.replace(/&/g,"&amp;"),n=n.replace(/</g,"&lt;"),n=n.replace(/>/g,"&gt;"),n=n.replace(/"/g,"&quot;"),n}i.Diff=s,i.applyPatch=we,i.applyPatches=Re,i.canonicalize=_,i.convertChangesToDMP=en,i.convertChangesToXML=nn,i.createPatch=Ze,i.createTwoFilesPatch=ye,i.diffArrays=Ve,i.diffChars=m,i.diffCss=Me,i.diffJson=ze,i.diffLines=ge,i.diffSentences=Be,i.diffTrimmedLines=Ae,i.diffWords=B,i.diffWordsWithSpace=V,i.merge=Xe,i.parsePatch=X,i.structuredPatch=te,Object.defineProperty(i,"__esModule",{value:!0})});async function on(i){const s=await crypto.subtle.digest("SHA-256",i),f=Array.from(new Uint8Array(s)),p=f.map(g=>("00"+g.toString(16)).slice(-2)).join("");return p}const sn=i=>{if(i.length<10)return!1;const s=[...i.slice(0,8)].filter(p=>p<"0"||p>"f").length===0,f=i.slice(8);if(s&&f[0]==="["&&f[f.length-1]==="]")try{return JSON.parse(f).length>1}catch{return!1}return!1},an=(i,s)=>{const f=JSON.parse(s);let p=i.slice(),g="";return f.forEach(m=>{if(Number(m)===m){const S=Math.abs(m),P=p.slice(0,S);p=p.slice(S),m>0&&(g+=String(P))}else g+=String(m)}),g};async function un(i){const s=new TextEncoder().encode(i),f=await on(s);return f.substr(0,8)}const ln=async(i,s)=>{const f=un(i),p=Diff.diffChars(i,s);return{b:await f,c:p.map(g=>g.added?g.value:g.removed?-g.count:g.count)}},fn=(i,s)=>s.some(f=>i instanceof f);let Fe,He;function cn(){return Fe||(Fe=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function dn(){return He||(He=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ee=new WeakMap,le=new WeakMap,Ie=new WeakMap,fe=new WeakMap,ce=new WeakMap;function hn(i){if(le.has(i))return;const s=new Promise((f,p)=>{const g=()=>{i.removeEventListener("complete",m),i.removeEventListener("error",S),i.removeEventListener("abort",S)},m=()=>{f(),g()},S=()=>{p(i.error||new DOMException("AbortError","AbortError")),g()};i.addEventListener("complete",m),i.addEventListener("error",S),i.addEventListener("abort",S)});le.set(i,s)}const de=i=>ce.get(i),pn=["get","getKey","getAll","getAllKeys","count"],gn=["put","add","delete","clear"],he=new Map;function Ce(i,s){if(!(i instanceof IDBDatabase&&!(s in i)&&typeof s=="string"))return;if(he.get(s))return he.get(s);const f=s.replace(/FromIndex$/,""),p=s!==f,g=gn.includes(f);if(!(f in(p?IDBIndex:IDBObjectStore).prototype)||!(g||pn.includes(f)))return;const m=async function(S,...P){const D=this.transaction(S,g?"readwrite":"readonly");let j=D.store;p&&(j=j.index(P.shift()));const B=await j[f](...P);return g&&await D.done,B};return he.set(s,m),m}async function vn(i){const s=await crypto.subtle.digest("SHA-256",i),f=Array.from(new Uint8Array(s)),p=f.map(g=>("00"+g.toString(16)).slice(-2)).join("");return p}async function mn(i){const s=new TextEncoder().encode(i),f=await vn(s);return f.substr(0,8)}function wn(i){const s=new Promise((f,p)=>{const g=()=>{i.removeEventListener("success",m),i.removeEventListener("error",S)},m=()=>{f(O(i.result)),g()},S=()=>{p(i.error),g()};i.addEventListener("success",m),i.addEventListener("error",S)});return s.then(f=>{f instanceof IDBCursor&&Ee.set(f,i)}).catch(()=>{}),ce.set(s,i),s}let pe={get(i,s,f){if(i instanceof IDBTransaction){if(s==="done")return le.get(i);if(s==="objectStoreNames")return i.objectStoreNames||Ie.get(i);if(s==="store")return f.objectStoreNames[1]?void 0:f.objectStore(f.objectStoreNames[0])}return O(i[s])},set(i,s,f){return i[s]=f,!0},has(i,s){return i instanceof IDBTransaction&&(s==="done"||s==="store")?!0:s in i}};function yn(i){pe=i(pe)}function Sn(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(s,...f){const p=i.call(de(this),s,...f);return Ie.set(p,s.sort?s.sort():[s]),O(p)}:dn().includes(i)?function(...s){return i.apply(de(this),s),O(Ee.get(this))}:function(...s){return O(i.apply(de(this),s))}}function xn(i){return typeof i=="function"?Sn(i):(i instanceof IDBTransaction&&hn(i),fn(i,cn())?new Proxy(i,pe):i)}function O(i){if(i instanceof IDBRequest)return wn(i);if(fe.has(i))return fe.get(i);const s=xn(i);return s!==i&&(fe.set(i,s),ce.set(s,i)),s}function bn(i,s,{blocked:f,upgrade:p,blocking:g,terminated:m}={}){const S=indexedDB.open(i,s),P=O(S);return p&&S.addEventListener("upgradeneeded",D=>{p(O(S.result),D.oldVersion,D.newVersion,O(S.transaction))}),f&&S.addEventListener("blocked",()=>f()),P.then(D=>{m&&D.addEventListener("close",()=>m()),g&&D.addEventListener("versionchange",()=>g())}).catch(()=>{}),P}yn(i=>({...i,get:(s,f,p)=>Ce(s,f)||i.get(s,f,p),has:(s,f)=>!!Ce(s,f)||i.has(s,f)}));export const getDB=()=>{const i=bn("localZedCodeStore",1,{upgrade(f){f.createObjectStore("codeStore")},blocked(){},blocking(){},terminated(){}}),s={async get(f,p="string"){let g;try{if(g=await(await i).get("codeStore",f),!g)return null}catch(m){return null}if(p==="json")return JSON.parse(g);if(p==="string"){const m=await g;if(typeof m=="string"&&p==="string"){const D=m;if(sn(m)){const j=m.slice(0,8),B=m.slice(8),V=await s.get(j);return an(V,B)}return m}const S=new TextDecoder,P=S.decode(m);return P}return g},async put(f,p){let g;try{const S=await s.get(f);if(typeof S=="string"&&typeof p=="string"&&S.length===8&&S!==p){const P=await s.get(p),D=await s.get(S);if(typeof D=="string"){const j=await mn(D);if(j===S){const B=await ln(P,D),V=B.b+JSON.stringify(B.c);(await i).put("codeStore",V,j)}}}}catch{g=""}if(g!==""&&p===g)return p;let m;return typeof p!="string"?m=new TextDecoder().decode(p):m=p,(await i).put("codeStore",m,f)},async delete(f){return(await i).delete("codeStore",f)},async clear(){return(await i).clear("codeStore")},async keys(){return(await i).getAllKeys("codeStore")}};return s};
