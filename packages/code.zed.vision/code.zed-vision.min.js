"use strict";let $,K;(()=>{const j=new Map;$={register(v,c,g){j.set(v,{d:c,f:g,exp:{}})}};async function G(v,c){let g=v.replace(/\.\w+$/i,"");if(g.includes("./")){const[S,...b]=g.split("/").reverse(),[,...d]=c.split("/").reverse(),D=[S];let U=0,P;for(;P=b.shift();)if(P==="..")U++;else{if(P===".")break;D.push(P)}U<d.length&&D.push(...d.slice(U)),g=D.reverse().join("/")}return j.has(g)?W(g):import(v)}function T(v,c){return{id:v,import:g=>G(g,v),meta:{url:v,main:c}}}function _(v){return(c,g)=>{const S=typeof c=="string"?{[c]:g}:c;for(const[b,d]of Object.entries(S))Object.defineProperty(v,b,{value:d,writable:!0,enumerable:!0});return g}}function I(v){for(const[c,g]of j.entries()){const{f:S,exp:b}=g,{execute:d,setters:D}=S(_(b),T(c,c===v));delete g.f,g.e=d,g.s=D}}async function W(v){if(!j.has(v))return;const c=j.get(v);if(c.s){const{d:g,e:S,s:b}=c;delete c.s,delete c.e;for(let D=0;D<b.length;D++)b[D](await W(g[D]));const d=S();d&&await d}return c.exp}function B(v){if(!j.has(v))return;const c=j.get(v);if(c.s){const{d:g,e:S,s:b}=c;delete c.s,delete c.e;for(let d=0;d<b.length;d++)b[d](B(g[d]));S()}return c.exp}K=(v,c)=>($=K=void 0,I(v),c?W(v):B(v))})(),$.register("diff",[],function(j,G){"use strict";var T,_,I,W=G&&G.id;function B(e,r,n,s){if(e===r)return e?[[I,e]]:[];if(n!=null){var i=J(e,r,n);if(i)return i}var t=S(e,r),a=e.substring(0,t);e=e.substring(t),r=r.substring(t),t=b(e,r);var l=e.substring(e.length-t);e=e.substring(0,e.length-t),r=r.substring(0,r.length-t);var o=v(e,r);return a&&o.unshift([I,a]),l&&o.push([I,l]),D(o,s),o}function v(e,r){var n;if(!e)return[[_,r]];if(!r)return[[T,e]];var s=e.length>r.length?e:r,i=e.length>r.length?r:e,t=s.indexOf(i);if(t!==-1)return n=[[_,s.substring(0,t)],[I,i],[_,s.substring(t+i.length)]],e.length>r.length&&(n[0][0]=n[2][0]=T),n;if(i.length===1)return[[T,e],[_,r]];var a=d(e,r);if(a){var l=a[0],o=a[1],u=a[2],m=a[3],h=a[4],R=B(l,u),A=B(o,m);return R.concat([[I,h]],A)}return c(e,r)}function c(e,r){for(var n=e.length,s=r.length,i=Math.ceil((n+s)/2),t=i,a=2*i,l=new Array(a),o=new Array(a),u=0;u<a;u++)l[u]=-1,o[u]=-1;l[t+1]=0,o[t+1]=0;for(var m=n-s,h=m%2!==0,R=0,A=0,y=0,F=0,C=0;C<i;C++){for(var p=-C+R;p<=C-A;p+=2){var f=t+p,w;p===-C||p!==C&&l[f-1]<l[f+1]?w=l[f+1]:w=l[f-1]+1;for(var E=w-p;w<n&&E<s&&e.charAt(w)===r.charAt(E);)w++,E++;if(l[f]=w,w>n)A+=2;else if(E>s)R+=2;else if(h){var M=t+m-p;if(M>=0&&M<a&&o[M]!==-1){var k=n-o[M];if(w>=k)return g(e,r,w,E)}}}for(var O=-C+y;O<=C-F;O+=2){var M=t+O,k;O===-C||O!==C&&o[M-1]<o[M+1]?k=o[M+1]:k=o[M-1]+1;for(var X=k-O;k<n&&X<s&&e.charAt(n-k-1)===r.charAt(s-X-1);)k++,X++;if(o[M]=k,k>n)F+=2;else if(X>s)y+=2;else if(!h){var f=t+m-O;if(f>=0&&f<a&&l[f]!==-1){var w=l[f],E=t+w-f;if(k=n-k,w>=k)return g(e,r,w,E)}}}}return[[T,e],[_,r]]}function g(e,r,n,s){var i=e.substring(0,n),t=r.substring(0,s),a=e.substring(n),l=r.substring(s),o=B(i,t),u=B(a,l);return o.concat(u)}function S(e,r){if(!e||!r||e.charAt(0)!==r.charAt(0))return 0;for(var n=0,s=Math.min(e.length,r.length),i=s,t=0;n<i;)e.substring(t,i)==r.substring(t,i)?(n=i,t=n):s=i,i=Math.floor((s-n)/2+n);return U(e.charCodeAt(i-1))&&i--,i}function b(e,r){if(!e||!r||e.slice(-1)!==r.slice(-1))return 0;for(var n=0,s=Math.min(e.length,r.length),i=s,t=0;n<i;)e.substring(e.length-i,e.length-t)==r.substring(r.length-i,r.length-t)?(n=i,t=n):s=i,i=Math.floor((s-n)/2+n);return P(e.charCodeAt(e.length-i))&&i--,i}function d(e,r){var n=e.length>r.length?e:r,s=e.length>r.length?r:e;if(n.length<4||s.length*2<n.length)return null;function i(A,y,F){for(var C=A.substring(F,F+Math.floor(A.length/4)),p=-1,f="",w,E,M,k;(p=y.indexOf(C,p+1))!==-1;){var O=S(A.substring(F),y.substring(p)),X=b(A.substring(0,F),y.substring(0,p));f.length<X+O&&(f=y.substring(p-X,p)+y.substring(p,p+O),w=A.substring(0,F-X),E=A.substring(F+O),M=y.substring(0,p-X),k=y.substring(p+O))}return f.length*2>=A.length?[w,E,M,k,f]:null}var t=i(n,s,Math.ceil(n.length/4)),a=i(n,s,Math.ceil(n.length/2)),l;if(!t&&!a)return null;a?t?l=t[4].length>a[4].length?t:a:l=a:l=t;var o,u,m,h;e.length>r.length?(o=l[0],u=l[1],m=l[2],h=l[3]):(m=l[0],h=l[1],o=l[2],u=l[3]);var R=l[4];return[o,u,m,h,R]}function D(e,r){e.push([I,""]);for(var n=0,s=0,i=0,t="",a="",l;n<e.length;){if(n<e.length-1&&!e[n][1]){e.splice(n,1);continue}switch(e[n][0]){case _:i++,a+=e[n][1],n++;break;case T:s++,t+=e[n][1],n++;break;case I:var o=n-i-s-1;if(r){if(o>=0&&Q(e[o][1])){var u=e[o][1].slice(-1);if(e[o][1]=e[o][1].slice(0,-1),t=u+t,a=u+a,!e[o][1]){e.splice(o,1),n--;var m=o-1;e[m]&&e[m][0]===_&&(i++,a=e[m][1]+a,m--),e[m]&&e[m][0]===T&&(s++,t=e[m][1]+t,m--),o=m}}if(H(e[n][1])){var u=e[n][1].charAt(0);e[n][1]=e[n][1].slice(1),t+=u,a+=u}}if(n<e.length-1&&!e[n][1]){e.splice(n,1);break}if(t.length>0||a.length>0){t.length>0&&a.length>0&&(l=S(a,t),l!==0&&(o>=0?e[o][1]+=a.substring(0,l):(e.splice(0,0,[I,a.substring(0,l)]),n++),a=a.substring(l),t=t.substring(l)),l=b(a,t),l!==0&&(e[n][1]=a.substring(a.length-l)+e[n][1],a=a.substring(0,a.length-l),t=t.substring(0,t.length-l)));var h=i+s;t.length===0&&a.length===0?(e.splice(n-h,h),n=n-h):t.length===0?(e.splice(n-h,h,[_,a]),n=n-h+1):a.length===0?(e.splice(n-h,h,[T,t]),n=n-h+1):(e.splice(n-h,h,[T,t],[_,a]),n=n-h+2)}n!==0&&e[n-1][0]===I?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,i=0,s=0,t="",a="";break}}e[e.length-1][1]===""&&e.pop();var R=!1;for(n=1;n<e.length-1;)e[n-1][0]===I&&e[n+1][0]===I&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)===e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),R=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),R=!0)),n++;R&&D(e,r)}j("diff_cleanupMerge",D);function U(e){return e>=55296&&e<=56319}function P(e){return e>=56320&&e<=57343}function H(e){return P(e.charCodeAt(0))}function Q(e){return U(e.charCodeAt(e.length-1))}function N(e){for(var r=[],n=0;n<e.length;n++)e[n][1].length>0&&r.push(e[n]);return r}function z(e,r,n,s){return Q(e)||H(s)?null:N([[I,e],[T,r],[_,n],[I,s]])}function J(e,r,n){var s=typeof n=="number"?{index:n,length:0}:n.oldRange,i=typeof n=="number"?null:n.newRange,t=e.length,a=r.length;if(s.length===0&&(i===null||i.length===0)){var l=s.index,o=e.slice(0,l),u=e.slice(l),m=i?i.index:null;e:{var h=l+a-t;if(m!==null&&m!==h)break e;if(h<0||h>a)break e;var R=r.slice(0,h),A=r.slice(h);if(A!==u)break e;var y=Math.min(l,h),F=o.slice(0,y),C=R.slice(0,y);if(F!==C)break e;var p=o.slice(y),f=R.slice(y);return z(F,p,f,u)}e:{if(m!==null&&m!==l)break e;var w=l,R=r.slice(0,w),A=r.slice(w);if(R!==o)break e;var E=Math.min(t-w,a-w),M=u.slice(u.length-E),k=A.slice(A.length-E);if(M!==k)break e;var p=u.slice(0,u.length-E),f=A.slice(0,A.length-E);return z(o,p,f,M)}}if(s.length>0&&i&&i.length===0){e:{var F=e.slice(0,s.index),M=e.slice(s.index+s.length),y=F.length,E=M.length;if(a<y+E)break e;var C=r.slice(0,y),k=r.slice(a-E);if(F!==C||M!==k)break e;var p=e.slice(y,t-E),f=r.slice(y,a-E);return z(F,p,f,M)}}return null}function L(e,r,n){return B(e,r,n,!0)}return j("diff",L),{setters:[],execute:function(){T=-1,_=1,I=0,L.INSERT=_,L.DELETE=T,L.EQUAL=I}}}),$.register("codeBox",["diff"],function(j,G){"use strict";var T,_,I,W,B,v=G&&G.id;return{setters:[function(c){T=c}],execute:function(){_=async c=>new Promise(function(g,S){const b=document.createElement("script");b.src=c,b.onload=g,b.onerror=S,document.head.appendChild(b)}),j("run",I=async c=>{const g=window.localStorage;await _("https://unpkg.com/@babel/standalone@7.12.4/babel.min.js"),await _("https://unpkg.com/react@17.0.1/umd/react.production.min.js"),await _("https://unpkg.com/react-dom@17.0.1/umd/react-dom.production.min.js"),await _("https://unpkg.com/interactjs@1.10.0/dist/interact.min.js");const S=/import/gi,b="///";setTimeout(()=>L(),100);let d="";const D=n=>window.Babel.transform(n,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(S,b),U=async n=>{const s=new Function("transpileCode",`return function(){ ${n} }`)(),i={codeTranspiled:n,code:d},t=JSON.stringify(i),a=new Request("https://my-ts-project.zed-vision.workers.dev",{body:t,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),l=await fetch(a),{hash:o}=await l.json();try{const u=g.getItem("codeBoXHash")||"zedCodeSTART";g.setItem("codeBoXHash",o),g.setItem(o,d)}catch(u){console.log("no Localstorage")}s()};let P=0,H="",Q="",N=0,z="";(async()=>{const n=r();d=n,z=n;const s=await c({language:"typescript",code:n,onChange:i=>{H=i,console.log(i);const t=async a=>{if(N===1)return;N=1;const l=await J(s),o=document.getElementById("error");try{if(N=0,a!==H)return;if(l&&l.length){if(H!=a)return;if(Q===a)return;document.getElementById("root").classList.add("almosthidden");const u=T.diff(d,a);if(console.log(u),u.length<=3){z=a,window.monaco.editor.setTheme("hc-black");return}o.innerHTML=errors[0].messageText,document.getElementById("root").style.setProperty("dispay","none"),o.style.display="block",Q=a,window.monaco.editor.setTheme("vs-light"),setTimeout(()=>{window.monaco.editor.setTheme("hc-black")},P++);return}d=a,o.style.display="none",window.monaco.editor.setTheme("vs-dark"),document.getElementById("root").classList.remove("almosthidden"),P=0,N=0,U(D(a))}catch(u){if(N=0,a!==H)return;window.monaco.editor.setTheme("vs-light"),setTimeout(()=>{window.monaco.editor.setTheme("hc-black")},10),console.error(u)}};if(!N)t(H);else{const a=i,l=setInterval(()=>{(a!==H||!N)&&clearInterval(l),N||t(H)},100)}}})})(),U(D(r())),document.getElementById("root").setAttribute("style","display:block");async function J(n){const s=n.getModel("file:///main.tsx"),i=await window.monaco.languages.typescript.getTypeScriptWorker(),t=s?.uri;if(!t)return;const a=await(await i(t)).getSemanticDiagnostics("file:///main.tsx"),l=await(await i(t)).getCompilerOptionsDiagnostics("file:///main.tsx"),o=await(await i(t)).getSyntacticDiagnostics("file:///main.tsx");return[...a,...l,...o]}const L=()=>{window.interact(".draggable").draggable({inertia:!0,modifiers:[interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})],autoScroll:!1,listeners:{move:e}})};function e(n){var s=n.target,i=(parseFloat(s.getAttribute("data-x"))||0)+n.dx,t=(parseFloat(s.getAttribute("data-y"))||0)+n.dy;s.style.webkitTransform=s.style.transform="translate("+i+"px, "+t+"px)",s.setAttribute("data-x",i),s.setAttribute("data-y",t)}function r(){const n=g.getItem("codeBoXHash"),s=g.getItem(n);return s||`import * as React from "react";
import ReactDOM from "react-dom";

const Counter = (
    { initial = 0 }
) => {
    const [clicks, setClicks] = React.useState(initial);

    return <div>
        <p>Clicks: <strong>{clicks}</strong></p>
        <button onClick={() => setClicks(clicks + 1)}>+</button>
        <button onClick={() => setClicks(clicks - 1)}>-</button>
    </div>;
};

ReactDOM.render(
    <Counter initial={0} />,
    document.getElementById("root")
);    
`}}),j("css",W=`
`),B=document.createElement("style"),B.appendChild(document.createTextNode(W)),document.getElementsByTagName("head")[0].appendChild(B)}}});const V=K("codeBox",!1);export const run=V.run,css=V.css;
