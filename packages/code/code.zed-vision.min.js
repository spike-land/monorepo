const importScript=async n=>new Promise(function(t,e){const o=document.createElement("script");o.src=n,o.onload=t,o.onerror=e,document.head.appendChild(o)}),makeDraggable=async()=>{const n=await importScript("https://unpkg.com/interactjs@1.10.0/dist/interact.js"),t=window.interact;t(".draggable").draggable({inertia:!0,modifiers:[t.modifiers.restrictRect({restriction:"parent",endOnly:!0})],autoScroll:!1,listeners:{move:dragMoveListener}})};function dragMoveListener(n){const t=n.target,e=(parseFloat(t.getAttribute("data-x"))||0)+n.dx,o=(parseFloat(t.getAttribute("data-y"))||0)+n.dy;t.style.webkitTransform=t.style.transform="translate("+e+"px, "+o+"px)",t.setAttribute("data-x",e),t.setAttribute("data-y",o)}const startMonaco=async({onChange:n,code:t,language:e})=>{const o=e||"typescript";return window&&window.monaco&&window.monaco.editor?window.monaco.editor:new Promise(async function(r){if(window.monaco)return window.monaco;await loadScript("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js");const l="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs";await loadScript("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js"),require.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs"}}),require(["vs/editor/editor.main"],async function(){const s=window.monaco,i=s.editor.create(window.document.getElementById("container"),{cursorStyle:"block",formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;}",mouseWheelZoom:!1,wordWrapColumn:70,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",lineNumbers:"off",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:s.editor.createModel(t,o,s.Uri.parse(o==="typescript"?"file:///main.tsx":"file:///main.html")),value:t,language:o,theme:"vs-dark"});if(s.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),i.onDidChangeModelContent(()=>n(i.getValue())),r(i),o==="typescript"){const a=[{name:"react",url:"https://unpkg.com/@types/react@latest/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@latest/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@latest/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@latest/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@latest/index.d.ts",depend:[]}],g=a.map(({name:f,url:h})=>(async()=>s.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(h)).text(),`file:///node_modules/@types/${f}/index.d.ts`))());s.languages.typescript.typescriptDefaults.setCompilerOptions({target:s.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:s.languages.typescript.ModuleResolutionKind.NodeJs,module:s.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:s.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",jsxFragmentFactory:"React.Fragment",esModuleInterop:!0}),await Promise.all(g),s.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1})}})})};function loadScript(n){return new Promise(function(t,e){var o;o=document.createElement("script"),o.src=n,o.onload=t,o.onerror=e,document.head.appendChild(o)})}const DIFF_DELETE=-1,DIFF_EQUAL=0;function diff_main({text1:n,text2:t,cursor_pos:e}){if(n===t)return n?[[0,n]]:[];if(e){const i=find_cursor_edit_diff(n,t,e);if(i)return i}let o=diff_commonPrefix(n,t);const r=n.substring(0,o);n=n.substring(o),t=t.substring(o),o=diff_commonSuffix(n,t);const l=n.substring(n.length-o);n=n.substring(0,n.length-o),t=t.substring(0,t.length-o);const s=diff_compute_(n,t);return r&&s.unshift([0,r]),l&&s.push([0,l]),diff_cleanupMerge(s),s}function diff_compute_(n,t){let e;if(!n)return[[1,t]];if(!t)return[[DIFF_DELETE,n]];const o=n.length>t.length?n:t,r=n.length>t.length?t:n,l=o.indexOf(r);if(l!==-1)return e=[[1,o.substring(0,l)],[0,r],[1,o.substring(l+r.length)]],n.length>t.length&&(e[0][0]=e[2][0]=DIFF_DELETE),e;if(r.length===1)return[[DIFF_DELETE,n],[1,t]];const s=diff_halfMatch_(n,t);if(s){const i=s[0],a=s[1],g=s[2],f=s[3],h=s[4],b=diff_main({text1:i[1],text2:g[1],cursor_pos:0}),m=diff_main({text1:a[1],text2:f[1],cursor_pos:0});return b.concat([[0,h[1]]],m)}return diff_bisect_(n,t)}function diff_bisect_(n,t){const e=n.length,o=t.length,r=Math.ceil((e+o)/2),l=r,s=2*r,i=new Array(s),a=new Array(s);for(let u=0;u<s;u++)i[u]=-1,a[u]=-1;i[l+1]=0,a[l+1]=0;const g=e-o,f=g%2!==0;let h=0,b=0,m=0,d=0;for(let u=0;u<r;u++){for(let c=-u+h;c<=u-b;c+=2){const p=r+c;let y;c===-u||c!==u&&i[p-1]<i[p+1]?y=i[p+1]:y=i[p-1]+1;let _=y-c;for(;y<e&&_<o&&n.charAt(y)===t.charAt(_);)y++,_++;if(i[p]=y,y>e)b+=2;else if(_>o)h+=2;else if(f){const k=r+g-c;if(k>=0&&k<s&&a[k]!==-1){const S=e-a[k];if(y>=S)return diff_bisectSplit_(n,t,y,_)}}}let w;for(let c=-u+m;c<=u-d;c+=2){const p=r+c;c===-u||c!==u&&a[p-1]<a[p+1]?w=a[p+1]:w=a[p-1]+1;let y=w-c;for(;w<e&&y<o&&n.charAt(e-w-1)===t.charAt(o-y-1);)w++,y++;if(a[p]=w,w>e)d+=2;else if(y>o)m+=2;else if(!f){const _=r+g-c;if(_>=0&&_<s&&i[_]!==-1){const k=i[_],S=r+k-_;if(w=e-w,k>=w)return diff_bisectSplit_(n,t,k,S)}}}}return[[DIFF_DELETE,n],[1,t]]}function diff_bisectSplit_(n,t,e,o){const r=n.substring(0,e),l=t.substring(0,o),s=n.substring(e),i=t.substring(o),a=diff_main({text1:r[1],text2:l[1],cursor_pos:0}),g=diff_main({text1:s[1],text2:i[1],cursor_pos:0});return a.concat(g)}function diff_commonPrefix(n,t){if(!n||!t||n.charAt(0)!==t.charAt(0))return 0;let e=0,o=Math.min(n.length,t.length),r=o,l=0;for(;e<r;)n.substring(l,r)==t.substring(l,r)?(e=r,l=e):o=r,r=Math.floor((o-e)/2+e);return is_surrogate_pair_start(n.charCodeAt(r-1))&&r--,r}function diff_commonSuffix(n,t){if(!n||!t||n.slice(-1)!==t.slice(-1))return 0;let e=0,o=Math.min(n.length,t.length),r=o,l=0;for(;e<r;)n.substring(n.length-r,n.length-l)==t.substring(t.length-r,t.length-l)?(e=r,l=e):o=r,r=Math.floor((o-e)/2+e);return is_surrogate_pair_end(n.charCodeAt(n.length-r))&&r--,r}function diff_halfMatch_(n,t){const e=n.length>t.length?n:t,o=n.length>t.length?t:n;if(e.length<4||o.length*2<e.length)return null;function r(m,d,u){const w=m.substring(u,u+Math.floor(m.length/4));let c=-1,p="",y,_,k,S;for(;(c=d.indexOf(w,c+1))!==-1;){const v=diff_commonPrefix(m.substring(u),d.substring(c)),E=diff_commonSuffix(m.substring(0,u),d.substring(0,c));p.length<E+v&&(p=d.substring(c-E,c)+d.substring(c,c+v),y=m.substring(0,u-E),_=m.substring(u+v),k=d.substring(0,c-E),S=d.substring(c+v))}return p.length*2>=m.length?[y,_,k,S,p]:null}const l=r(e,o,Math.ceil(e.length/4)),s=r(e,o,Math.ceil(e.length/2));let i;if(s===null&&l===null)return null;if(s===null){if(l===null)return null;i=l}else if(l===null){if(s===null)return null;i=s}else i=l[4].length>s[4].length?l:s;let a,g,f,h;n.length>t.length?(a=i[0],g=i[1],f=i[2],h=i[3]):(f=i[0],h=i[1],a=i[2],g=i[3]);const b=i[4];return[a,g,f,h,b]}function diff_cleanupMerge(n){const t=[...n];t.push([0,""]);let e=0,o=0,r=0,l="",s="",i,a;for(;e<t.length;){if(e<t.length-1&&!t[e][1]){t.splice(e,1);continue}switch(t[e][0]){case 1:r++,s+=t[e][1],e++;break;case DIFF_DELETE:o++,l+=t[e][1],e++;break;case 0:if(a=e-r-o-1,e<t.length-1&&!t[e][1]){t.splice(e,1);break}if(l.length>0||s.length>0){l.length>0&&s.length>0&&(i=diff_commonPrefix(s,l),i!==0&&(a>=0?t[a][1]+=s.substring(0,i):(t.splice(0,0,[0,s.substring(0,i)]),e++),s=s.substring(i),l=l.substring(i)),i=diff_commonSuffix(s,l),i!==0&&(t[e][1]=s.substring(s.length-i)+t[e][1],s=s.substring(0,s.length-i),l=l.substring(0,l.length-i)));const f=r+o;l.length===0&&s.length===0?(t.splice(e-f,f),e=e-f):l.length===0?(t.splice(e-f,f,[1,s]),e=e-f+1):s.length===0?(t.splice(e-f,f,[DIFF_DELETE,l]),e=e-f+1):(t.splice(e-f,f,[DIFF_DELETE,l],[1,s]),e=e-f+2)}e!==0&&t[e-1][0]===DIFF_EQUAL?(t[e-1][1]+=t[e][1],t.splice(e,1)):e++,r=0,o=0,l="",s="";break}}t[t.length-1][1]===""&&t.pop();let g=!1;for(e=1;e<t.length-1;)t[e-1][0]===0&&t[e+1][0]===DIFF_EQUAL&&(t[e][1].substring(t[e][1].length-t[e-1][1].length)===t[e-1][1]?(t[e][1]=t[e-1][1]+t[e][1].substring(0,t[e][1].length-t[e-1][1].length),t[e+1][1]=t[e-1][1]+t[e+1][1],t.splice(e-1,1),g=!0):t[e][1].substring(0,t[e+1][1].length)==t[e+1][1]&&(t[e-1][1]+=t[e+1][1],t[e][1]=t[e][1].substring(t[e+1][1].length)+t[e+1][1],t.splice(e+1,1),g=!0)),e++;return g?diff_cleanupMerge(t):t}function is_surrogate_pair_start(n){return n>=55296&&n<=56319}function is_surrogate_pair_end(n){return n>=56320&&n<=57343}function starts_with_pair_end(n){return is_surrogate_pair_end(n.charCodeAt(0))}function ends_with_pair_start(n){return is_surrogate_pair_start(n.charCodeAt(n.length-1))}function remove_empty_tuples(n){const t=[];for(let e=0;e<n.length;e++)n[e][1].length>0&&t.push(n[e]);return t}function make_edit_splice(n,t,e,o){return ends_with_pair_start(n)||starts_with_pair_end(o)?null:remove_empty_tuples([[0,n],[DIFF_DELETE,t],[1,e],[0,o]])}function find_cursor_edit_diff(n,t,e){const o=typeof e=="number"?{index:e,length:0}:e.oldRange,r=typeof e=="number"?null:e.newRange,l=n.length,s=t.length;if(o.length===0&&(r===null||r.length===0)){const i=o.index,a=n.slice(0,i),g=n.slice(i),f=r?r.index:null;t:{const h=i+s-l;if(f!==null&&f!==h)break t;if(h<0||h>s)break t;const b=t.slice(0,h),m=t.slice(h);if(m!==g)break t;const d=Math.min(i,h),u=a.slice(0,d),w=b.slice(0,d);if(u!==w)break t;const c=a.slice(d),p=b.slice(d);return make_edit_splice(u,c,p,g)}t:{if(f!==null&&f!==i)break t;const h=i,b=t.slice(0,i),m=t.slice(i);if(b!==a)break t;const d=Math.min(l-i,s-i),u=g.slice(g.length-d),w=m.slice(m.length-d);if(u!==w)break t;const c=g.slice(0,g.length-d),p=m.slice(0,m.length-d);return make_edit_splice(a,c,p,u)}}if(o.length>0&&r&&r.length===0){t:{const i=n.slice(0,o.index),a=n.slice(o.index+o.length),g=i.length,f=a.length;if(s<g+f)break t;const h=t.slice(0,g),b=t.slice(s-f);if(i!==h||a!==b)break t;const m=n.slice(g,l-f),d=t.slice(g,s-f);return make_edit_splice(i,m,d,a)}}return null}function diff(n,t,e){return diff_main({text1:n,text2:t,cursor_pos:e})}diff.INSERT=1,diff.DELETE=DIFF_DELETE,diff.EQUAL=0;async function run(){await importScript("https://cdnjs.cloudflare.com/ajax/libs/core-js/3.6.5/minified.js"),await importScript("https://unpkg.com/@babel/standalone@7.12.4/babel.min.js"),await importScript("https://unpkg.com/react@17.0.1/umd/react.production.min.js"),await importScript("https://unpkg.com/react-dom@17.0.1/umd/react-dom.production.min.js"),await importScript("https://unpkg.com/interactjs@1.10.0/dist/interact.min.js");const n=/import/gi,t="///";setTimeout(()=>makeDraggable(),100);let e="";const o=h=>window.Babel.transform(h,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(/import/gi,"///"),r=async h=>{const b=new Function("transpileCode",`return function(){ ${h} }`)(),m={codeTranspiled:h,code:e},d=JSON.stringify(m),u=new Request("https://code.zed.vision",{body:d,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),w=await fetch(u),{hash:c}=await w.json();try{const p=window.localStorage;p.getItem("codeBoXHash"),p.setItem("codeBoXHash",c),p.setItem(c,e),location.hash=c}catch(p){console.log("no localStorage")}b()};let l=0,s="",i="",a=0;(async()=>{const h=getCodeToLoad();e=h,await startMonaco({language:"typescript",code:h,onChange:b=>{s=b;const m=async d=>{if(a===1)return;a=1;const u=await f(),w=document.getElementById("error");try{if(a=0,d!==s)return;if(u&&u.length){if(s!=d)return;if(i===d)return;document.getElementById("root").classList.add("transparent");const c=diff(e,d,0);if(console.log(c),c.length<=3){g.editor.setTheme("hc-black");return}w.innerHTML=u[0].messageText.toString(),document.getElementById("root").style.setProperty("dispay","none"),w.style.display="block",i=d,g.editor.setTheme("vs-light"),setTimeout(()=>{g.editor.setTheme("hc-black")},l++);return}e=d,w.style.display="none",window.monaco.editor.setTheme("vs-dark"),document.getElementById("root").classList.remove("transparent"),l=0,a=0,r(o(d))}catch(c){if(a=0,d!==s)return;g.editor.setTheme("vs-light"),setTimeout(()=>{window.monaco.editor.setTheme("hc-black")},10),console.error(c)}};if(!a)m(s);else{const d=b,u=setInterval(()=>{(b!==s||!a)&&clearInterval(u),a||m(s)},100)}}})})();const g=window.monaco;r(o(getCodeToLoad())),document.getElementById("root").setAttribute("style","display:block");async function f(){const h=g.Uri.parse("file:///main.tsx"),b=await window.monaco.languages.typescript.getTypeScriptWorker(),m=await(await b(h)).getSemanticDiagnostics("file:///main.tsx"),d=await(await b(h)).getCompilerOptionsDiagnostics("file:///main.tsx"),u=await(await b(h)).getSyntacticDiagnostics("file:///main.tsx");return[...m,...d,...u]}}function getCodeToLoad(){const n=window.localStorage.getItem("codeBoXHash");return window.localStorage.getItem(location.hash.substring(1))||n&&window.localStorage.getItem(n)||window.localStorage.getItem("STARTER")||"() => <>Hello</>"}run();
