const A=-1,R=0;function S({text1:t,text2:e,cursor_pos:n}){if(t===e)return t?[[0,t]]:[];if(n){const s=W(t,e,n);if(s)return s}let i=C(t,e);const o=t.substring(0,i);t=t.substring(i),e=e.substring(i),i=B(t,e);const l=t.substring(t.length-i);t=t.substring(0,t.length-i),e=e.substring(0,e.length-i);const r=O(t,e);return o&&r.unshift([0,o]),l&&r.push([0,l]),F(r),r}function O(t,e){let n;if(!t)return[[1,e]];if(!e)return[[A,t]];const i=t.length>e.length?t:e,o=t.length>e.length?e:t,l=i.indexOf(o);if(l!==-1)return n=[[1,i.substring(0,l)],[0,o],[1,i.substring(l+o.length)]],t.length>e.length&&(n[0][0]=n[2][0]=A),n;if(o.length===1)return[[A,t],[1,e]];const r=N(t,e);if(r){const s=r[0],g=r[1],u=r[2],h=r[3],_=r[4],k=S({text1:s[1],text2:u[1],cursor_pos:0}),p=S({text1:g[1],text2:h[1],cursor_pos:0});return k.concat([[0,_[1]]],p)}return H(t,e)}function H(t,e){const n=t.length,i=e.length,o=Math.ceil((n+i)/2),l=o,r=2*o,s=new Array(r),g=new Array(r);for(let a=0;a<r;a++)s[a]=-1,g[a]=-1;s[l+1]=0,g[l+1]=0;const u=n-i,h=u%2!==0;let _=0,k=0,p=0,f=0;for(let a=0;a<o;a++){for(let c=-a+_;c<=a-k;c+=2){const m=o+c;let b;c===-a||c!==a&&s[m-1]<s[m+1]?b=s[m+1]:b=s[m-1]+1;let w=b-c;for(;b<n&&w<i&&t.charAt(b)===e.charAt(w);)b++,w++;if(s[m]=b,b>n)k+=2;else if(w>i)_+=2;else if(h){const y=o+u-c;if(y>=0&&y<r&&g[y]!==-1){const M=n-g[y];if(b>=M)return D(t,e,b,w)}}}let d;for(let c=-a+p;c<=a-f;c+=2){const m=o+c;c===-a||c!==a&&g[m-1]<g[m+1]?d=g[m+1]:d=g[m-1]+1;let b=d-c;for(;d<n&&b<i&&t.charAt(n-d-1)===e.charAt(i-b-1);)d++,b++;if(g[m]=d,d>n)f+=2;else if(b>i)p+=2;else if(!h){const w=o+u-c;if(w>=0&&w<r&&s[w]!==-1){const y=s[w],M=o+y-w;if(d=n-d,y>=d)return D(t,e,y,M)}}}}return[[A,t],[1,e]]}function D(t,e,n,i){const o=t.substring(0,n),l=e.substring(0,i),r=t.substring(n),s=e.substring(i),g=S({text1:o[1],text2:l[1],cursor_pos:0}),u=S({text1:r[1],text2:s[1],cursor_pos:0});return g.concat(u)}function C(t,e){if(!t||!e||t.charAt(0)!==e.charAt(0))return 0;let n=0,i=Math.min(t.length,e.length),o=i,l=0;for(;n<o;)t.substring(l,o)==e.substring(l,o)?(n=o,l=n):i=o,o=Math.floor((i-n)/2+n);return j(t.charCodeAt(o-1))&&o--,o}function B(t,e){if(!t||!e||t.slice(-1)!==e.slice(-1))return 0;let n=0,i=Math.min(t.length,e.length),o=i,l=0;for(;n<o;)t.substring(t.length-o,t.length-l)==e.substring(e.length-o,e.length-l)?(n=o,l=n):i=o,o=Math.floor((i-n)/2+n);return P(t.charCodeAt(t.length-o))&&o--,o}function N(t,e){const n=t.length>e.length?t:e,i=t.length>e.length?e:t;if(n.length<4||i.length*2<n.length)return null;function o(p,f,a){const d=p.substring(a,a+Math.floor(p.length/4));let c=-1,m="",b,w,y,M;for(;(c=f.indexOf(d,c+1))!==-1;){const I=C(p.substring(a),f.substring(c)),L=B(p.substring(0,a),f.substring(0,c));m.length<L+I&&(m=f.substring(c-L,c)+f.substring(c,c+I),b=p.substring(0,a-L),w=p.substring(a+I),y=f.substring(0,c-L),M=f.substring(c+I))}return m.length*2>=p.length?[b,w,y,M,m]:null}const l=o(n,i,Math.ceil(n.length/4)),r=o(n,i,Math.ceil(n.length/2));let s;if(r===null&&l===null)return null;if(r===null){if(l===null)return null;s=l}else if(l===null){if(r===null)return null;s=r}else s=l[4].length>r[4].length?l:r;let g,u,h,_;t.length>e.length?(g=s[0],u=s[1],h=s[2],_=s[3]):(h=s[0],_=s[1],g=s[2],u=s[3]);const k=s[4];return[g,u,h,_,k]}function F(t){const e=[...t];e.push([0,""]);let n=0,i=0,o=0,l="",r="",s,g;for(;n<e.length;){if(n<e.length-1&&!e[n][1]){e.splice(n,1);continue}switch(e[n][0]){case 1:o++,r+=e[n][1],n++;break;case A:i++,l+=e[n][1],n++;break;case 0:if(g=n-o-i-1,n<e.length-1&&!e[n][1]){e.splice(n,1);break}if(l.length>0||r.length>0){l.length>0&&r.length>0&&(s=C(r,l),s!==0&&(g>=0?e[g][1]+=r.substring(0,s):(e.splice(0,0,[0,r.substring(0,s)]),n++),r=r.substring(s),l=l.substring(s)),s=B(r,l),s!==0&&(e[n][1]=r.substring(r.length-s)+e[n][1],r=r.substring(0,r.length-s),l=l.substring(0,l.length-s)));const h=o+i;l.length===0&&r.length===0?(e.splice(n-h,h),n=n-h):l.length===0?(e.splice(n-h,h,[1,r]),n=n-h+1):r.length===0?(e.splice(n-h,h,[A,l]),n=n-h+1):(e.splice(n-h,h,[A,l],[1,r]),n=n-h+2)}n!==0&&e[n-1][0]===R?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,o=0,i=0,l="",r="";break}}e[e.length-1][1]===""&&e.pop();let u=!1;for(n=1;n<e.length-1;)e[n-1][0]===0&&e[n+1][0]===R&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)===e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),u=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),u=!0)),n++;return u?F(e):e}function j(t){return t>=55296&&t<=56319}function P(t){return t>=56320&&t<=57343}function U(t){return P(t.charCodeAt(0))}function X(t){return j(t.charCodeAt(t.length-1))}function q(t){const e=[];for(let n=0;n<t.length;n++)t[n][1].length>0&&e.push(t[n]);return e}function T(t,e,n,i){return X(t)||U(i)?null:q([[0,t],[A,e],[1,n],[0,i]])}function W(t,e,n){const i=typeof n=="number"?{index:n,length:0}:n.oldRange,o=typeof n=="number"?null:n.newRange,l=t.length,r=e.length;if(i.length===0&&(o===null||o.length===0)){const s=i.index,g=t.slice(0,s),u=t.slice(s),h=o?o.index:null;e:{const _=s+r-l;if(h!==null&&h!==_)break e;if(_<0||_>r)break e;const k=e.slice(0,_),p=e.slice(_);if(p!==u)break e;const f=Math.min(s,_),a=g.slice(0,f),d=k.slice(0,f);if(a!==d)break e;const c=g.slice(f),m=k.slice(f);return T(a,c,m,u)}e:{if(h!==null&&h!==s)break e;const _=s,k=e.slice(0,s),p=e.slice(s);if(k!==g)break e;const f=Math.min(l-s,r-s),a=u.slice(u.length-f),d=p.slice(p.length-f);if(a!==d)break e;const c=u.slice(0,u.length-f),m=p.slice(0,p.length-f);return T(g,c,m,a)}}if(i.length>0&&o&&o.length===0){e:{const s=t.slice(0,i.index),g=t.slice(i.index+i.length),u=s.length,h=g.length;if(r<u+h)break e;const _=e.slice(0,u),k=e.slice(r-h);if(s!==_||g!==k)break e;const p=t.slice(u,l-h),f=e.slice(u,r-h);return T(s,p,f,g)}}return null}function v(t,e,n){return S({text1:t,text2:e,cursor_pos:n})}v.INSERT=1,v.DELETE=A,v.EQUAL=0;const E=async t=>new Promise(function(e,n){const i=document.createElement("script");i.src=t,i.onload=e,i.onerror=n,document.head.appendChild(i)});export async function run(t){await E("https://cdnjs.cloudflare.com/ajax/libs/core-js/3.6.5/minified.js"),await E("https://unpkg.com/@babel/standalone@7.12.4/babel.min.js"),await E("https://unpkg.com/react@17.0.1/umd/react.production.min.js"),await E("https://unpkg.com/react-dom@17.0.1/umd/react-dom.production.min.js"),await E("https://unpkg.com/interactjs@1.10.0/dist/interact.min.js");const e=/import/gi,n="///";setTimeout(()=>_(),100);let i="";const o=f=>window.Babel.transform(f,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(/import/gi,"///"),l=async f=>{const a=new Function("transpileCode",`return function(){ ${f} }`)(),d={codeTranspiled:f,code:i},c=JSON.stringify(d),m=new Request("https://code.zed.vision",{body:c,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),b=await fetch(m),{hash:w}=await b.json();try{const y=window.localStorage;y.getItem("codeBoXHash"),y.setItem("codeBoXHash",w),y.setItem(w,i),location.hash=w}catch(y){console.log("no Localstorage")}a()};let r=0,s="",g="",u=0;(async()=>{const f=p();i=f,await t({language:"typescript",code:f,onChange:a=>{s=a;const d=async c=>{if(u===1)return;u=1;const m=await h(),b=document.getElementById("error");try{if(u=0,c!==s)return;if(m&&m.length){if(s!=c)return;if(g===c)return;document.getElementById("root").classList.add("almosthidden");const w=v(i,c,0);if(console.log(w),w.length<=3){window.monaco.editor.setTheme("hc-black");return}b.innerHTML=errors[0].messageText,document.getElementById("root").style.setProperty("dispay","none"),b.style.display="block",g=c,window.monaco.editor.setTheme("vs-light"),setTimeout(()=>{window.monaco.editor.setTheme("hc-black")},r++);return}i=c,b.style.display="none",window.monaco.editor.setTheme("vs-dark"),document.getElementById("root").classList.remove("almosthidden"),r=0,u=0,l(o(c))}catch(w){if(u=0,c!==s)return;window.monaco.editor.setTheme("vs-light"),setTimeout(()=>{window.monaco.editor.setTheme("hc-black")},10),console.error(w)}};if(!u)d(s);else{const c=a,m=setInterval(()=>{(a!==s||!u)&&clearInterval(m),u||d(s)},100)}}})})(),l(o(p())),document.getElementById("root").setAttribute("style","display:block");async function h(){const f=window.monaco.editor.getModel("file:///main.tsx"),a=await window.monaco.languages.typescript.getTypeScriptWorker(),d=f?.uri,c=await(await a(d)).getSemanticDiagnostics("file:///main.tsx"),m=await(await a(d)).getCompilerOptionsDiagnostics("file:///main.tsx"),b=await(await a(d)).getSyntacticDiagnostics("file:///main.tsx");return[...c,...m,...b]}const _=()=>{window.interact(".draggable").draggable({inertia:!0,modifiers:[interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})],autoScroll:!1,listeners:{move:k}})};function k(f){const a=f.target,d=(parseFloat(a.getAttribute("data-x"))||0)+f.dx,c=(parseFloat(a.getAttribute("data-y"))||0)+f.dy;a.style.webkitTransform=a.style.transform="translate("+d+"px, "+c+"px)",a.setAttribute("data-x",d),a.setAttribute("data-y",c)}function p(){const f=window.localStorage.getItem("codeBoXHash");return window.localStorage.getItem(location.hash.substring(1))||window.localStorage.getItem(f)||window.localStorage.getItem("STARTER")||"() => <>Hello</>"}}
