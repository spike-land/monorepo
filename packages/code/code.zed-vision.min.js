const startMonaco=async({onChange:n,code:e,language:t})=>{const s=t||"typescript";return window&&window.monaco&&window.monaco.editor?window.monaco.editor:new Promise(async function(r){if(window.monaco)return window.monaco;await loadScript("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js");const l="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs";await loadScript("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js"),require.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs"}}),require(["vs/editor/editor.main"],async function(){const o=window.monaco,i=o.editor.create(window.document.getElementById("container"),{cursorStyle:"block",formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;}",mouseWheelZoom:!1,wordWrapColumn:70,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",lineNumbers:"off",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:o.editor.createModel(e,s,o.Uri.parse(s==="typescript"?"file:///main.tsx":"file:///main.html")),value:e,language:s,theme:"vs-dark"});if(o.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),i.onDidChangeModelContent(()=>n(i.getValue())),r(i),s==="typescript"){const f=[{name:"react",url:"https://unpkg.com/@types/react@latest/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@latest/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@latest/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@latest/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@latest/index.d.ts",depend:[]}],u=f.map(({name:g,url:y})=>(async()=>o.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(y)).text(),`file:///node_modules/@types/${g}/index.d.ts`))());o.languages.typescript.typescriptDefaults.setCompilerOptions({target:o.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:o.languages.typescript.ModuleResolutionKind.NodeJs,module:o.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:o.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",jsxFragmentFactory:"React.Fragment",esModuleInterop:!0}),await Promise.all(u),o.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1})}})})};function loadScript(n){return new Promise(function(e,t){var s;s=document.createElement("script"),s.src=n,s.onload=e,s.onerror=t,document.head.appendChild(s)})}const DIFF_DELETE=-1,DIFF_EQUAL=0;function diff_main({text1:n,text2:e,cursor_pos:t}){if(n===e)return n?[[0,n]]:[];if(t){const i=find_cursor_edit_diff(n,e,t);if(i)return i}let s=diff_commonPrefix(n,e);const r=n.substring(0,s);n=n.substring(s),e=e.substring(s),s=diff_commonSuffix(n,e);const l=n.substring(n.length-s);n=n.substring(0,n.length-s),e=e.substring(0,e.length-s);const o=diff_compute_(n,e);return r&&o.unshift([0,r]),l&&o.push([0,l]),diff_cleanupMerge(o),o}function diff_compute_(n,e){let t;if(!n)return[[1,e]];if(!e)return[[DIFF_DELETE,n]];const s=n.length>e.length?n:e,r=n.length>e.length?e:n,l=s.indexOf(r);if(l!==-1)return t=[[1,s.substring(0,l)],[0,r],[1,s.substring(l+r.length)]],n.length>e.length&&(t[0][0]=t[2][0]=DIFF_DELETE),t;if(r.length===1)return[[DIFF_DELETE,n],[1,e]];const o=diff_halfMatch_(n,e);if(o){const i=o[0],f=o[1],u=o[2],g=o[3],y=o[4],k=diff_main({text1:i[1],text2:u[1],cursor_pos:0}),b=diff_main({text1:f[1],text2:g[1],cursor_pos:0});return k.concat([[0,y[1]]],b)}return diff_bisect_(n,e)}function diff_bisect_(n,e){const t=n.length,s=e.length,r=Math.ceil((t+s)/2),l=r,o=2*r,i=new Array(o),f=new Array(o);for(let c=0;c<o;c++)i[c]=-1,f[c]=-1;i[l+1]=0,f[l+1]=0;const u=t-s,g=u%2!==0;let y=0,k=0,b=0,d=0;for(let c=0;c<r;c++){for(let a=-c+y;a<=c-k;a+=2){const h=r+a;let p;a===-c||a!==c&&i[h-1]<i[h+1]?p=i[h+1]:p=i[h-1]+1;let w=p-a;for(;p<t&&w<s&&n.charAt(p)===e.charAt(w);)p++,w++;if(i[h]=p,p>t)k+=2;else if(w>s)y+=2;else if(g){const _=r+u-a;if(_>=0&&_<o&&f[_]!==-1){const S=t-f[_];if(p>=S)return diff_bisectSplit_(n,e,p,w)}}}let m;for(let a=-c+b;a<=c-d;a+=2){const h=r+a;a===-c||a!==c&&f[h-1]<f[h+1]?m=f[h+1]:m=f[h-1]+1;let p=m-a;for(;m<t&&p<s&&n.charAt(t-m-1)===e.charAt(s-p-1);)m++,p++;if(f[h]=m,m>t)d+=2;else if(p>s)b+=2;else if(!g){const w=r+u-a;if(w>=0&&w<o&&i[w]!==-1){const _=i[w],S=r+_-w;if(m=t-m,_>=m)return diff_bisectSplit_(n,e,_,S)}}}}return[[DIFF_DELETE,n],[1,e]]}function diff_bisectSplit_(n,e,t,s){const r=n.substring(0,t),l=e.substring(0,s),o=n.substring(t),i=e.substring(s),f=diff_main({text1:r[1],text2:l[1],cursor_pos:0}),u=diff_main({text1:o[1],text2:i[1],cursor_pos:0});return f.concat(u)}function diff_commonPrefix(n,e){if(!n||!e||n.charAt(0)!==e.charAt(0))return 0;let t=0,s=Math.min(n.length,e.length),r=s,l=0;for(;t<r;)n.substring(l,r)==e.substring(l,r)?(t=r,l=t):s=r,r=Math.floor((s-t)/2+t);return is_surrogate_pair_start(n.charCodeAt(r-1))&&r--,r}function diff_commonSuffix(n,e){if(!n||!e||n.slice(-1)!==e.slice(-1))return 0;let t=0,s=Math.min(n.length,e.length),r=s,l=0;for(;t<r;)n.substring(n.length-r,n.length-l)==e.substring(e.length-r,e.length-l)?(t=r,l=t):s=r,r=Math.floor((s-t)/2+t);return is_surrogate_pair_end(n.charCodeAt(n.length-r))&&r--,r}function diff_halfMatch_(n,e){const t=n.length>e.length?n:e,s=n.length>e.length?e:n;if(t.length<4||s.length*2<t.length)return null;function r(b,d,c){const m=b.substring(c,c+Math.floor(b.length/4));let a=-1,h="",p,w,_,S;for(;(a=d.indexOf(m,a+1))!==-1;){const v=diff_commonPrefix(b.substring(c),d.substring(a)),E=diff_commonSuffix(b.substring(0,c),d.substring(0,a));h.length<E+v&&(h=d.substring(a-E,a)+d.substring(a,a+v),p=b.substring(0,c-E),w=b.substring(c+v),_=d.substring(0,a-E),S=d.substring(a+v))}return h.length*2>=b.length?[p,w,_,S,h]:null}const l=r(t,s,Math.ceil(t.length/4)),o=r(t,s,Math.ceil(t.length/2));let i;if(o===null&&l===null)return null;if(o===null){if(l===null)return null;i=l}else if(l===null){if(o===null)return null;i=o}else i=l[4].length>o[4].length?l:o;let f,u,g,y;n.length>e.length?(f=i[0],u=i[1],g=i[2],y=i[3]):(g=i[0],y=i[1],f=i[2],u=i[3]);const k=i[4];return[f,u,g,y,k]}function diff_cleanupMerge(n){const e=[...n];e.push([0,""]);let t=0,s=0,r=0,l="",o="",i,f;for(;t<e.length;){if(t<e.length-1&&!e[t][1]){e.splice(t,1);continue}switch(e[t][0]){case 1:r++,o+=e[t][1],t++;break;case DIFF_DELETE:s++,l+=e[t][1],t++;break;case 0:if(f=t-r-s-1,t<e.length-1&&!e[t][1]){e.splice(t,1);break}if(l.length>0||o.length>0){l.length>0&&o.length>0&&(i=diff_commonPrefix(o,l),i!==0&&(f>=0?e[f][1]+=o.substring(0,i):(e.splice(0,0,[0,o.substring(0,i)]),t++),o=o.substring(i),l=l.substring(i)),i=diff_commonSuffix(o,l),i!==0&&(e[t][1]=o.substring(o.length-i)+e[t][1],o=o.substring(0,o.length-i),l=l.substring(0,l.length-i)));const g=r+s;l.length===0&&o.length===0?(e.splice(t-g,g),t=t-g):l.length===0?(e.splice(t-g,g,[1,o]),t=t-g+1):o.length===0?(e.splice(t-g,g,[DIFF_DELETE,l]),t=t-g+1):(e.splice(t-g,g,[DIFF_DELETE,l],[1,o]),t=t-g+2)}t!==0&&e[t-1][0]===DIFF_EQUAL?(e[t-1][1]+=e[t][1],e.splice(t,1)):t++,r=0,s=0,l="",o="";break}}e[e.length-1][1]===""&&e.pop();let u=!1;for(t=1;t<e.length-1;)e[t-1][0]===0&&e[t+1][0]===DIFF_EQUAL&&(e[t][1].substring(e[t][1].length-e[t-1][1].length)===e[t-1][1]?(e[t][1]=e[t-1][1]+e[t][1].substring(0,e[t][1].length-e[t-1][1].length),e[t+1][1]=e[t-1][1]+e[t+1][1],e.splice(t-1,1),u=!0):e[t][1].substring(0,e[t+1][1].length)==e[t+1][1]&&(e[t-1][1]+=e[t+1][1],e[t][1]=e[t][1].substring(e[t+1][1].length)+e[t+1][1],e.splice(t+1,1),u=!0)),t++;return u?diff_cleanupMerge(e):e}function is_surrogate_pair_start(n){return n>=55296&&n<=56319}function is_surrogate_pair_end(n){return n>=56320&&n<=57343}function starts_with_pair_end(n){return is_surrogate_pair_end(n.charCodeAt(0))}function ends_with_pair_start(n){return is_surrogate_pair_start(n.charCodeAt(n.length-1))}function remove_empty_tuples(n){const e=[];for(let t=0;t<n.length;t++)n[t][1].length>0&&e.push(n[t]);return e}function make_edit_splice(n,e,t,s){return ends_with_pair_start(n)||starts_with_pair_end(s)?null:remove_empty_tuples([[0,n],[DIFF_DELETE,e],[1,t],[0,s]])}function find_cursor_edit_diff(n,e,t){const s=typeof t=="number"?{index:t,length:0}:t.oldRange,r=typeof t=="number"?null:t.newRange,l=n.length,o=e.length;if(s.length===0&&(r===null||r.length===0)){const i=s.index,f=n.slice(0,i),u=n.slice(i),g=r?r.index:null;e:{const y=i+o-l;if(g!==null&&g!==y)break e;if(y<0||y>o)break e;const k=e.slice(0,y),b=e.slice(y);if(b!==u)break e;const d=Math.min(i,y),c=f.slice(0,d),m=k.slice(0,d);if(c!==m)break e;const a=f.slice(d),h=k.slice(d);return make_edit_splice(c,a,h,u)}e:{if(g!==null&&g!==i)break e;const y=i,k=e.slice(0,i),b=e.slice(i);if(k!==f)break e;const d=Math.min(l-i,o-i),c=u.slice(u.length-d),m=b.slice(b.length-d);if(c!==m)break e;const a=u.slice(0,u.length-d),h=b.slice(0,b.length-d);return make_edit_splice(f,a,h,c)}}if(s.length>0&&r&&r.length===0){e:{const i=n.slice(0,s.index),f=n.slice(s.index+s.length),u=i.length,g=f.length;if(o<u+g)break e;const y=e.slice(0,u),k=e.slice(o-g);if(i!==y||f!==k)break e;const b=n.slice(u,l-g),d=e.slice(u,o-g);return make_edit_splice(i,b,d,f)}}return null}function diff(n,e,t){return diff_main({text1:n,text2:e,cursor_pos:t})}diff.INSERT=1,diff.DELETE=DIFF_DELETE,diff.EQUAL=0;const importScript=async n=>new Promise(function(e,t){const s=document.createElement("script");s.src=n,s.onload=e,s.onerror=t,document.head.appendChild(s)});async function run(n){await importScript("https://cdnjs.cloudflare.com/ajax/libs/core-js/3.6.5/minified.js"),await importScript("https://unpkg.com/@babel/standalone@7.12.4/babel.min.js"),await importScript("https://unpkg.com/react@17.0.1/umd/react.production.min.js"),await importScript("https://unpkg.com/react-dom@17.0.1/umd/react-dom.production.min.js"),await importScript("https://unpkg.com/interactjs@1.10.0/dist/interact.min.js");const e=/import/gi,t="///";setTimeout(()=>y(),100);let s="";const r=d=>window.Babel.transform(d,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(/import/gi,"///"),l=async d=>{const c=new Function("transpileCode",`return function(){ ${d} }`)(),m={codeTranspiled:d,code:s},a=JSON.stringify(m),h=new Request("https://code.zed.vision",{body:a,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),p=await fetch(h),{hash:w}=await p.json();try{const _=window.localStorage;_.getItem("codeBoXHash"),_.setItem("codeBoXHash",w),_.setItem(w,s),location.hash=w}catch(_){console.log("no Localstorage")}c()};let o=0,i="",f="",u=0;(async()=>{const d=b();s=d,await n({language:"typescript",code:d,onChange:c=>{i=c;const m=async a=>{if(u===1)return;u=1;const h=await g(),p=document.getElementById("error");try{if(u=0,a!==i)return;if(h&&h.length){if(i!=a)return;if(f===a)return;document.getElementById("root").classList.add("almosthidden");const w=diff(s,a,0);if(console.log(w),w.length<=3){window.monaco.editor.setTheme("hc-black");return}p.innerHTML=errors[0].messageText,document.getElementById("root").style.setProperty("dispay","none"),p.style.display="block",f=a,window.monaco.editor.setTheme("vs-light"),setTimeout(()=>{window.monaco.editor.setTheme("hc-black")},o++);return}s=a,p.style.display="none",window.monaco.editor.setTheme("vs-dark"),document.getElementById("root").classList.remove("almosthidden"),o=0,u=0,l(r(a))}catch(w){if(u=0,a!==i)return;window.monaco.editor.setTheme("vs-light"),setTimeout(()=>{window.monaco.editor.setTheme("hc-black")},10),console.error(w)}};if(!u)m(i);else{const a=c,h=setInterval(()=>{(c!==i||!u)&&clearInterval(h),u||m(i)},100)}}})})(),l(r(b())),document.getElementById("root").setAttribute("style","display:block");async function g(){const d=window.monaco.editor.getModel("file:///main.tsx"),c=await window.monaco.languages.typescript.getTypeScriptWorker(),m=d.uri,a=await(await c(m)).getSemanticDiagnostics("file:///main.tsx"),h=await(await c(m)).getCompilerOptionsDiagnostics("file:///main.tsx"),p=await(await c(m)).getSyntacticDiagnostics("file:///main.tsx");return[...a,...h,...p]}const y=()=>{window.interact(".draggable").draggable({inertia:!0,modifiers:[interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})],autoScroll:!1,listeners:{move:k}})};function k(d){const c=d.target,m=(parseFloat(c.getAttribute("data-x"))||0)+d.dx,a=(parseFloat(c.getAttribute("data-y"))||0)+d.dy;c.style.webkitTransform=c.style.transform="translate("+m+"px, "+a+"px)",c.setAttribute("data-x",m),c.setAttribute("data-y",a)}function b(){const d=window.localStorage.getItem("codeBoXHash");return window.localStorage.getItem(location.hash.substring(1))||window.localStorage.getItem(d)||window.localStorage.getItem("STARTER")||"() => <>Hello</>"}}run(startMonaco);
