{
  "version": 3,
  "sources": ["../templates.ts"],
  "sourcesContent": ["import importmapJson from \"./importmap.json\" assert { type: \"json\" };\n\nexport function getCss(session: { html: string; css: string }) {\n  const { html } = session;\n\n  const bodyClass = String(\n    document.getElementById(\"zbody\")?.getAttribute(\"class\"),\n  );\n\n  let css = \"\";\n  const cssRules = document.querySelector(\n    \"head > style[data-emotion=css]\",\n  );\n\n  if (cssRules) {\n    try {\n      const sheet = (document.querySelector(\n        \"head > style[data-emotion=css]\",\n      ) as HTMLStyleElement).sheet;\n      if (sheet) {\n        css = Array.from(\n          // deno-lint-ignore ban-ts-comment\n          // @ts-ignore\n          sheet.cssRules,\n        ).map((x) => x.cssText).filter((cssText) => {\n          const selector = cssText.substring(5, 10);\n          const isSelectorBody = bodyClass.indexOf(selector) !== -1;\n          const isInGeneratedHtml = html.indexOf(selector) !== -1;\n          const isNotMui = cssText.indexOf(\"Mui\") === -1;\n\n          const shouldInclude = isSelectorBody || isInGeneratedHtml;\n\n          return shouldInclude;\n        }).join(\"\\n  \").replace(`#zbody`, \"body\");\n      }\n    } catch (e) {\n      console.error({ e });\n    }\n  }\n\n  const globalCssRules = document.querySelector(\n    \"head > style[data-emotion=css-global]\",\n  );\n\n  if (globalCssRules) {\n    try {\n      const sheet = (document.querySelector(\n        \"head > style[data-emotion=css-global]\",\n      ) as HTMLStyleElement).sheet;\n      if (sheet) {\n        css += Array.from(\n          sheet\n            .cssRules,\n        ).map((x) => x.cssText)\n          .join(\"\\n  \").replace(`#zbody`, \"body\");\n      }\n    } catch (e) {\n      console.error({ e });\n    }\n  }\n  session.css = css;\n}\n\nexport function getHtml({ html, css }: { html: string; css: string }) {\n  //\n  // For some reason, pre-rendering doesn't care about global styles, the site flickers without this patch\n  //\n  // let bodyStylesFix = \"\";\n\n  // const start = js.indexOf(\"body{\");\n  // if (start !== -1) {\n  //   const firstBit = js.slice(start);\n  //   const last = firstBit.indexOf(\"}\");\n  //   bodyStylesFix = firstBit.slice(0, last + 1);\n  // }\n\n  // const imports = globalThis.importMap;\n  const titleStart = html.indexOf(\"<title>\");\n  const titleEnd = html.indexOf(\"</title>\");\n  const hasTitle = titleStart < titleEnd && titleStart >= -1;\n  const title = hasTitle\n    ? html.slice(titleStart, titleEnd)\n    : \"(code).spike.land :)\";\n\n  return `<!DOCTYPE html>\n<html lang=\"en\"> \n<head profile=\"http://www.w3.org/2005/10/profile\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<meta name=\"Description\" content=\"Generated with spike.land\">\n<title>${title}</title>\n<link rel=\"icon\" type=\"image/png\" href=\"https://code.spike.land/assets/zed-icon-big.png\" />\n<link rel=\"stylesheet\" href=\"https://unpkg.com/modern-css-reset@1.4.0/dist/reset.min.css\" />\n\n<script async src=\"https://ga.jspm.io/npm:es-module-shims@1.4.1/dist/es-module-shims.js\"></script>\n<script type=\"esms-options\">\n{\n  \"shimMode\": true,\n  \"polyfillEnable\": [\"css-modules\", \"json-modules\"],\n  \"nonce\": \"n0nce\"\n}\n</script>\n<style>\n.skip-link {\n  position: absolute;\n  top: -40px;\n  left: 0;\n  background: #000000;\n  color: white;\n  padding: 8px;\n  z-index: 100;\n}\n.skip-link:focus {\n  top: 0;\n}\n${css}</style>\n<script crossorigin src=\"https://unpkg.com/react@18.0.0-rc.0-next-f2a59df48-20211208/umd/react.production.min.js\"></script>\n<script crossorigin src=\"https://unpkg.com/react-is@18.0.0-rc.0-next-f2a59df48-20211208/umd/react-is.production.min.js\"></script>\n<script crossorigin src=\"https://unpkg.com/react-dom@18.0.0-rc.0-next-f2a59df48-20211208/umd/react-dom.production.min.js\"></script>\n<script crossorigin src=\"https://unpkg.com/@emotion/react@11.7.1/dist/emotion-react.umd.min.js\"></script>\n</head>\n<body>\n<a class=\"skip-link\" href=\"#zbody\">Jump to the page</a>\n<main id=\"zbody\">\n  ${html}\n</main>\n<script>window.process = {env: {NODE_ENV:\"production\" }}</script>\n<script type=\"importmap-shim\">\n${JSON.stringify({ imports: { ...importmapJson.imports, \"app\": \"./app.js\" } })}\n</script>\n<script type=\"module-shim\">\n  import App from 'app';\n  import {jsx} from \"@emotion/react\"\n  import {createRoot} from \"react-dom\"\n\n  const root = createRoot(document.getElementById('zbody'))\n  root.render(jsx(App));\n</script>\n</body>\n</html>\n`;\n}\n\n/**\n * @param {string}} cid\n * @returns {string}\n */\nexport const getEditorHTML = () =>\n  `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n  <link rel=\"icon\" type=\"image/png\" href=\"https://code.spike.land/assets/zed-icon-big.png\" />\n  \n  <script async src=\"https://ga.jspm.io/npm:es-module-shims@1.4.1/dist/es-module-shims.js\"></script>\n<title>Instant React Editor</title>\n</head>\n<body>\n<script>window.process = {env: {NODE_ENV:\"production\" }}</script>\n<script crossorigin src=\"https://unpkg.com/react@18.0.0-rc.0-next-f2a59df48-20211208/umd/react.production.min.js\"></script>\n<script crossorigin src=\"https://unpkg.com/react-is@18.0.0-rc.0-next-f2a59df48-20211208/umd/react-is.production.min.js\"></script>\n<script crossorigin src=\"https://unpkg.com/react-dom@18.0.0-rc.0-next-f2a59df48-20211208/umd/react-dom.production.min.js\"></script>\n<script crossorigin src=\"https://unpkg.com/@emotion/react@11.7.1/dist/emotion-react.umd.min.js\"></script>\n<script type=\"importmap\">\n${\n    JSON.stringify({\n      imports: { ...importmapJson.imports, \"app\": [\"./app.js\"] },\n    })\n  }\n</script>\n<script type=\"module\">\nimport {edit} from \"https://code.spike.land/data.mjs\"\ntry{\n  edit(location.pathname.slice(42, 52));\n}catch(error){\n  fetch(\"https://code.spike.land/error\", {method: \"POST\",  body: JSON.stringify({error})})\n}\n</script>\n</body>\n</html>`;\n"],
  "mappings": "s3EAEO,WAAgB,EAAwC,CAC7D,GAAM,CAAE,QAAS,EAEX,EAAY,OAChB,SAAS,eAAe,UAAU,aAAa,UAG7C,EAAM,GAKV,GAJiB,SAAS,cACxB,kCAIA,GAAI,CACF,GAAM,GAAS,SAAS,cACtB,kCACqB,MACvB,AAAI,GACF,GAAM,MAAM,KAGV,EAAM,UACN,IAAI,AAAC,GAAM,EAAE,SAAS,OAAO,AAAC,GAAY,CAC1C,GAAM,GAAW,EAAQ,UAAU,EAAG,IAChC,EAAiB,EAAU,QAAQ,KAAc,GACjD,EAAoB,EAAK,QAAQ,KAAc,GAC/C,EAAW,EAAQ,QAAQ,SAAW,GAI5C,MAFsB,IAAkB,IAGvC,KAAK;AAAA,KAAQ,QAAQ,SAAU,eAE7B,EAAP,CACA,QAAQ,MAAM,CAAE,MAQpB,GAJuB,SAAS,cAC9B,yCAIA,GAAI,CACF,GAAM,GAAS,SAAS,cACtB,yCACqB,MACvB,AAAI,GACF,IAAO,MAAM,KACX,EACG,UACH,IAAI,AAAC,GAAM,EAAE,SACZ,KAAK;AAAA,KAAQ,QAAQ,SAAU,eAE7B,EAAP,CACA,QAAQ,MAAM,CAAE,MAGpB,EAAQ,IAAM,EAGT,WAAiB,CAAE,OAAM,OAAsC,CAcpE,GAAM,GAAa,EAAK,QAAQ,WAC1B,EAAW,EAAK,QAAQ,YAM9B,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAJO,AADG,EAAa,GAAY,GAAc,GAEpD,EAAK,MAAM,EAAY,GACvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiCJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IASE;AAAA;AAAA;AAAA;AAAA,EAIF,KAAK,UAAU,CAAE,QAAS,IAAK,EAAc,QAAS,IAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBxD,GAAM,GAAgB,IAC3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBE,KAAK,UAAU,CACb,QAAS,IAAK,EAAc,QAAS,IAAO,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;",
  "names": []
}
