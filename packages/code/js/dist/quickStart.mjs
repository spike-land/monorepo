import{jsx as x}from"https://unpkg.com/@spike.land/esm@0.4.33/dist/emotion-react.mjs";var l,u,w,s,f,p,O=async(e,a)=>(p=p||(await import("./session-QTCJ4MYZ.mjs")).default,p(e,a)),F=async e=>(l=l||(await import("./formatter-LUAJ56NO.mjs")).formatter,await l(e));async function E(e){let a=document.getElementById("shadowEditor"),r=await(await import("./startMonaco-4UBCXQJ3.mjs")).default({language:"typescript",container:a,code:e.code,onChange:(o,i)=>y(o,i,e,++e.i)});e.editor=r(),window.monaco.languages.registerOnTypeFormattingEditProvider("typescript",{autoFormatTriggerCharacters:["}","{",")","(",";"],async provideOnTypeFormattingEdits(o){let i=await l(o.getValue());return[{range:o.getFullModelRange(),text:i}]}}),window.sess=e,e.monaco=window.monaco}async function k({monaco:e,editor:a}){if(!e)return[{messageText:"Error with the error checking. Try to reload!"}];let t=a.getModel(),n=await(await e.languages.typescript.getTypeScriptWorker())(t),o=t.uri.toString(),i=n.getSemanticDiagnostics(o),d=n.getCompilerOptionsDiagnostics(o),c=n.getSyntacticDiagnostics(o),g=await Promise.race([i,d,c]);return console.log(g),[]}async function y(e,a=null,t,r){t.changes.push(a),l=l||(await import("./formatter-LUAJ56NO.mjs")).formatter,w=w||(await import("./esbuildEsm-J5F7TKTE.mjs")).transform,u=w,window.sendChannel,t.errorText="";let{monaco:n}=t;try{let o=await l(e),i=await u(o),d=!1;if(i.length){if(r<t.i)return;try{if(s=s||(await import("./renderToString-PJKHEY26.mjs")).getHtmlAndCss,r<t.i)return;let g=await U(i),{html:m}=s(g);t.transpiled=i,t.html=m;let h=await R(i);t.setChild(v=>[...v,h]),t.children=h,d=!m,t.codeNonFormatted=e,f=f||(await import("./templates-ZH7YTJ5T.mjs")).getCss;let C=f(t),b=o;if(t.i!==r)return;t.saveCode&&await t.saveCode({transpiled:i,code:b,i:r,css:C,html:m}),n.editor.setTheme("vs-dark");return}catch(g){console.log({e:g}),d=!0,console.error({restartError:d})}}if(t.i>r)return;let c=await k(t);if(t.i>r)return;if(d&&c.push({messageText:"Error while starting the app. Check the console!"}),c.length&&console.log({err:c}),c.length===0&&i.length){if(t.i>r)return;t.code=o,t.codeNonFormatted=e,saveCode(t,r)}else{if(console.log({code:e,transpiled:i}),t.i>r)return;if(o.length<1e3&&t.code.length<1e3){let m=await(await import("https://ga.jspm.io/npm:@spike.land/shadb@0.4.15/dist/shaDB.mjs")).diff(t.code,o);if(m.c.length<=3){t.lastErrors=0;return}if(m.c.length==4){t.lastErrors=0,n.editor.setTheme("hc-black");return}}c&&c[0]&&c[0].messageText&&console.error(c[0].messageText.toString());return}n.editor.setTheme("vs-dark")}catch(o){n.editor.setTheme("vs-light"),setTimeout(()=>{n.editor.setTheme("hc-black")},50),t.errorText=o.message,console.error(o.message)}}var L=async({code:e})=>{let a={code:e,i:0,changes:[],saveCode:()=>{},setChild:()=>{}};await y(e,null,a),await S(a)};async function S(e,a,t,r){e.saveCode=r,e.children=null;let{renderPreviewWindow:n}=await import("./renderPreviewWindow-SSB6Q5ZI.mjs");await n(e,a,t),t||await E(e)}async function R(e,a="window"){let t=a==="window"?e.replace("body{","#zbody{"):e,r=T(t),n=await import(r);return URL.revokeObjectURL(r),x(n.default)}function T(e){let a=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(a)}async function U(e,a="window"){let t=a==="window"?e.replace("body{","#zbody{"):e,r=T(t),n=(await import(r)).default;return URL.revokeObjectURL(r),n}export{O as initSession,F as prettier,S as quickStart,L as startFromCode,E as startMonacoWithSession};
//# sourceMappingURL=quickStart.mjs.map
