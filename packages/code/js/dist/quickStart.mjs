import"./chunk-UPO26O35.mjs";import{jsx as x}from"https://unpkg.com/@spike.land/esm@0.3.75/dist/emotion-react.mjs";var m,f,y,g,h,p,u,j=async(e,r)=>(u=u||(await import("./session-C7J2KO4E.mjs")).default,u(e,r)),F=async e=>(m=m||(await import("./formatter-LXFJ4LM5.mjs")).formatter,await m(e));async function S(e){let r=document.getElementById("shadowEditor"),o=await(await import("./startMonaco-2YOX7DPC.mjs")).default({language:"typescript",container:r,code:e.code,onChange:(a,n)=>C(a,n,e,++e.i)});e.editor=o(),window.monaco.languages.registerOnTypeFormattingEditProvider("typescript",{autoFormatTriggerCharacters:["}","{",")","(",";"],async provideOnTypeFormattingEdits(a){let n=await m(a.getValue());return[{range:a.getFullModelRange(),text:n}]}}),window.sess=e,e.monaco=window.monaco}async function E({monaco:e,editor:r}){if(!e)return[{messageText:"Error with the error checking. Try to reload!"}];let t=r.getModel(),i=await(await e.languages.typescript.getTypeScriptWorker())(t),a=t.uri.toString(),n=i.getSemanticDiagnostics(a),d=i.getCompilerOptionsDiagnostics(a),c=i.getSyntacticDiagnostics(a),l=await Promise.race([n,d,c]);return console.log(l),[]}async function C(e,r=null,t,o){if(t.changes.push(r),f=f||(await import("./data-GSA6J3VT.mjs")).saveCode,m=m||(await import("./formatter-LXFJ4LM5.mjs")).formatter,g=g||(await import("./esbuildEsm-QWG4C45E.mjs")).transform,y=g,window.sendChannel){let a=(await import("https://unpkg.com/@spike.land/esm@0.3.75/dist/ipfs-only-hash.mjs")).default,n=await a.of(e);if(window.hashOfCode===window.hashOfStarterCode&&window.hashOfCode===n)return;window[n]=e;let d=await a.of(t.code);if(window[d]=t.code,window.hashOfCode!==n){let c=t.code,l=(await import("https://unpkg.com/@spike.land/esm@0.3.75/dist/textdiff-create.mjs")).default,w=v(c,e,l);if(o<t.i)return;window.sendChannel.send({changes:r,i:t.i,hashOfCode:n,prevHash:d,codeDiff:w})}}t.errorText="";let{monaco:i}=t;try{let a=await m(e),n=await y(a),d=!1;if(n.length){if(o<t.i)return;try{if(h=h||(await import("./renderToString-BMBQKG35.mjs")).getHtmlAndCss,o<t.i)return;let l=await R(n),{html:w}=h(l);t.transpiled=n,t.html=w;let s=await k(n);t.setChild(b=>[...b,s]),t.children=s,d=!w,t.codeNonFormatted=e,p=p||(await import("./templates-6PBUULT4.mjs")).getCss,p(t),await f(t,t.i),i.editor.setTheme("vs-dark");return}catch(l){console.log({e:l}),d=!0,console.error({restartError:d})}}if(t.i>o)return;let c=await E(t);if(t.i>o)return;if(d&&c.push({messageText:"Error while starting the app. Check the console!"}),c.length&&console.log({err:c}),c.length===0&&n.length){if(t.i>o)return;t.code=a,t.codeNonFormatted=e,f(t,o)}else{if(console.log({code:e,transpiled:n}),t.i>o)return;if(a.length<1e3&&t.code.length<1e3){let w=await(await import("https://ga.jspm.io/npm:@spike.land/shadb@0.4.15/dist/shaDB.mjs")).diff(t.code,a);if(w.c.length<=3){t.lastErrors=0;return}if(w.c.length==4){t.lastErrors=0,i.editor.setTheme("hc-black");return}}c&&c[0]&&c[0].messageText&&console.error(c[0].messageText.toString());return}i.editor.setTheme("vs-dark")}catch(a){i.editor.setTheme("vs-light"),setTimeout(()=>{i.editor.setTheme("hc-black")},50),t.errorText=a.message,console.error(a.message)}}var D=async({code:e})=>{let r={code:e,i:0,setChild:()=>{}};await C(e,null,r),await O(r)};async function O(e){e.children=null;let{renderPreviewWindow:r}=await import("./renderPreviewWindow-EGJC2KU7.mjs");if(await r(e,e.room),localStorage&&e){let{code:t,transpiled:o,html:i,css:a,i:n}=e;localStorage.setItem(`state-${e.room}`,JSON.stringify({code:t,transpiled:o,html:i,css:a,i:n}))}await S(e)}async function k(e,r="window"){let t=r==="window"?e.replace("body{","#zbody{"):e,o=T(t),i=await import(o);return URL.revokeObjectURL(o),x(i.default)}function v(e,r,t){return JSON.stringify(t(e,r))}function T(e){let r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}async function R(e,r="window"){let t=r==="window"?e.replace("body{","#zbody{"):e,o=T(t),i=(await import(o)).default;return URL.revokeObjectURL(o),i}export{j as initSession,F as prettier,O as quickStart,D as startFromCode,S as startMonacoWithSession};
//# sourceMappingURL=quickStart.mjs.map
