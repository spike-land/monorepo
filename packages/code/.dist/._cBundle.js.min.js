const importScript=async n=>new Promise(function(e,t){const s=window.document.createElement("script");s.src=n,s.onload=e,s.onerror=t,window.document.head.appendChild(s)}),makeDraggable=async()=>{const n=await importScript("https://unpkg.com/interactjs@1.10.0/dist/interact.js"),e=window.interact;e(".draggable").draggable({inertia:!0,modifiers:[e.modifiers.restrictRect({restriction:"parent",endOnly:!0})],autoScroll:!1,listeners:{move:dragMoveListener}})};function dragMoveListener(n){const e=n.target,t=(parseFloat(e.getAttribute("data-x"))||0)+n.dx,s=(parseFloat(e.getAttribute("data-y"))||0)+n.dy;e.style.webkitTransform=e.style.transform="translate("+t+"px, "+s+"px)",e.setAttribute("data-x",t),e.setAttribute("data-y",s)}let monaco,editor;const startMonaco=async({onChange:n,code:e,language:t})=>{if(window.monaco===void 0){await loadScript("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js");const s=window.require;s.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs"}}),await(()=>new Promise(o=>s(["vs/editor/editor.main"],o)))(),monaco=window.monaco}else return editor.onDidChangeModelContent(()=>n(editor.getValue())),editor.setValue(e),editor;if(editor=monaco.editor.create(window.document.getElementById("container"),{cursorStyle:"block",formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;}",mouseWheelZoom:!1,wordWrapColumn:70,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",lineNumbers:"off",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"l  anguageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:monaco.editor.createModel(e,t,monaco.Uri.parse(t==="typescript"?"file:///main.tsx":"file:///main.html")),value:e,language:t,theme:"vs-dark"}),monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),t==="typescript"){const s=[{name:"react",url:"https://unpkg.com/@types/react@latest/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@latest/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@latest/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@latest/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@latest/index.d.ts",depend:[]}],o=s.map(({name:l,url:i})=>(async()=>monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(i)).text(),`file:///node_modules/@types/${l}/index.d.ts`))());return monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:monaco.languages.typescript.ModuleResolutionKind.NodeJs,module:monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:monaco.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",jsxFragmentFactory:"React.Fragment",esModuleInterop:!0}),await Promise.all(o),monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),editor}};function loadScript(n){return new Promise(function(e,t){var s;s=window.document.createElement("script"),s.src=n,s.onload=e,s.onerror=t,window.document.head.appendChild(s)})}const DIFF_DELETE=-1,DIFF_EQUAL=0;function diff_main({text1:n,text2:e,cursor_pos:t}){if(n===e)return n?[[0,n]]:[];if(t){const r=find_cursor_edit_diff(n,e,t);if(r)return r}let s=diff_commonPrefix(n,e);const o=n.substring(0,s);n=n.substring(s),e=e.substring(s),s=diff_commonSuffix(n,e);const l=n.substring(n.length-s);n=n.substring(0,n.length-s),e=e.substring(0,e.length-s);const i=diff_compute_(n,e);return o&&i.unshift([0,o]),l&&i.push([0,l]),diff_cleanupMerge(i),i}function diff_compute_(n,e){let t;if(!n)return[[1,e]];if(!e)return[[DIFF_DELETE,n]];const s=n.length>e.length?n:e,o=n.length>e.length?e:n,l=s.indexOf(o);if(l!==-1)return t=[[1,s.substring(0,l)],[0,o],[1,s.substring(l+o.length)]],n.length>e.length&&(t[0][0]=t[2][0]=DIFF_DELETE),t;if(o.length===1)return[[DIFF_DELETE,n],[1,e]];const i=diff_halfMatch_(n,e);if(i){const r=i[0],c=i[1],h=i[2],a=i[3],p=i[4],w=diff_main({text1:r[1],text2:h[1],cursor_pos:0}),u=diff_main({text1:c[1],text2:a[1],cursor_pos:0});return w.concat([[0,p[1]]],u)}return diff_bisect_(n,e)}function diff_bisect_(n,e){const t=n.length,s=e.length,o=Math.ceil((t+s)/2),l=o,i=2*o,r=new Array(i),c=new Array(i);for(let d=0;d<i;d++)r[d]=-1,c[d]=-1;r[l+1]=0,c[l+1]=0;const h=t-s,a=h%2!==0;let p=0,w=0,u=0,g=0;for(let d=0;d<o;d++){for(let f=-d+p;f<=d-w;f+=2){const b=o+f;let y;f===-d||f!==d&&r[b-1]<r[b+1]?y=r[b+1]:y=r[b-1]+1;let _=y-f;for(;y<t&&_<s&&n.charAt(y)===e.charAt(_);)y++,_++;if(r[b]=y,y>t)w+=2;else if(_>s)p+=2;else if(a){const k=o+h-f;if(k>=0&&k<i&&c[k]!==-1){const S=t-c[k];if(y>=S)return diff_bisectSplit_(n,e,y,_)}}}let m;for(let f=-d+u;f<=d-g;f+=2){const b=o+f;f===-d||f!==d&&c[b-1]<c[b+1]?m=c[b+1]:m=c[b-1]+1;let y=m-f;for(;m<t&&y<s&&n.charAt(t-m-1)===e.charAt(s-y-1);)m++,y++;if(c[b]=m,m>t)g+=2;else if(y>s)u+=2;else if(!a){const _=o+h-f;if(_>=0&&_<i&&r[_]!==-1){const k=r[_],S=o+k-_;if(m=t-m,k>=m)return diff_bisectSplit_(n,e,k,S)}}}}return[[DIFF_DELETE,n],[1,e]]}function diff_bisectSplit_(n,e,t,s){const o=n.substring(0,t),l=e.substring(0,s),i=n.substring(t),r=e.substring(s),c=diff_main({text1:o[1],text2:l[1],cursor_pos:0}),h=diff_main({text1:i[1],text2:r[1],cursor_pos:0});return c.concat(h)}function diff_commonPrefix(n,e){if(!n||!e||n.charAt(0)!==e.charAt(0))return 0;let t=0,s=Math.min(n.length,e.length),o=s,l=0;for(;t<o;)n.substring(l,o)==e.substring(l,o)?(t=o,l=t):s=o,o=Math.floor((s-t)/2+t);return is_surrogate_pair_start(n.charCodeAt(o-1))&&o--,o}function diff_commonSuffix(n,e){if(!n||!e||n.slice(-1)!==e.slice(-1))return 0;let t=0,s=Math.min(n.length,e.length),o=s,l=0;for(;t<o;)n.substring(n.length-o,n.length-l)==e.substring(e.length-o,e.length-l)?(t=o,l=t):s=o,o=Math.floor((s-t)/2+t);return is_surrogate_pair_end(n.charCodeAt(n.length-o))&&o--,o}function diff_halfMatch_(n,e){const t=n.length>e.length?n:e,s=n.length>e.length?e:n;if(t.length<4||s.length*2<t.length)return null;function o(u,g,d){const m=u.substring(d,d+Math.floor(u.length/4));let f=-1,b="",y,_,k,S;for(;(f=g.indexOf(m,f+1))!==-1;){const E=diff_commonPrefix(u.substring(d),g.substring(f)),v=diff_commonSuffix(u.substring(0,d),g.substring(0,f));b.length<v+E&&(b=g.substring(f-v,f)+g.substring(f,f+E),y=u.substring(0,d-v),_=u.substring(d+E),k=g.substring(0,f-v),S=g.substring(f+E))}return b.length*2>=u.length?[y,_,k,S,b]:null}const l=o(t,s,Math.ceil(t.length/4)),i=o(t,s,Math.ceil(t.length/2));let r;if(i===null&&l===null)return null;if(i===null){if(l===null)return null;r=l}else if(l===null){if(i===null)return null;r=i}else r=l[4].length>i[4].length?l:i;let c,h,a,p;n.length>e.length?(c=r[0],h=r[1],a=r[2],p=r[3]):(a=r[0],p=r[1],c=r[2],h=r[3]);const w=r[4];return[c,h,a,p,w]}function diff_cleanupMerge(n){const e=[...n];e.push([0,""]);let t=0,s=0,o=0,l="",i="",r,c;for(;t<e.length;){if(t<e.length-1&&!e[t][1]){e.splice(t,1);continue}switch(e[t][0]){case 1:o++,i+=e[t][1],t++;break;case DIFF_DELETE:s++,l+=e[t][1],t++;break;case 0:if(c=t-o-s-1,t<e.length-1&&!e[t][1]){e.splice(t,1);break}if(l.length>0||i.length>0){l.length>0&&i.length>0&&(r=diff_commonPrefix(i,l),r!==0&&(c>=0?e[c][1]+=i.substring(0,r):(e.splice(0,0,[0,i.substring(0,r)]),t++),i=i.substring(r),l=l.substring(r)),r=diff_commonSuffix(i,l),r!==0&&(e[t][1]=i.substring(i.length-r)+e[t][1],i=i.substring(0,i.length-r),l=l.substring(0,l.length-r)));const a=o+s;l.length===0&&i.length===0?(e.splice(t-a,a),t=t-a):l.length===0?(e.splice(t-a,a,[1,i]),t=t-a+1):i.length===0?(e.splice(t-a,a,[DIFF_DELETE,l]),t=t-a+1):(e.splice(t-a,a,[DIFF_DELETE,l],[1,i]),t=t-a+2)}t!==0&&e[t-1][0]===DIFF_EQUAL?(e[t-1][1]+=e[t][1],e.splice(t,1)):t++,o=0,s=0,l="",i="";break}}e[e.length-1][1]===""&&e.pop();let h=!1;for(t=1;t<e.length-1;)e[t-1][0]===0&&e[t+1][0]===DIFF_EQUAL&&(e[t][1].substring(e[t][1].length-e[t-1][1].length)===e[t-1][1]?(e[t][1]=e[t-1][1]+e[t][1].substring(0,e[t][1].length-e[t-1][1].length),e[t+1][1]=e[t-1][1]+e[t+1][1],e.splice(t-1,1),h=!0):e[t][1].substring(0,e[t+1][1].length)==e[t+1][1]&&(e[t-1][1]+=e[t+1][1],e[t][1]=e[t][1].substring(e[t+1][1].length)+e[t+1][1],e.splice(t+1,1),h=!0)),t++;return h?diff_cleanupMerge(e):e}function is_surrogate_pair_start(n){return n>=55296&&n<=56319}function is_surrogate_pair_end(n){return n>=56320&&n<=57343}function starts_with_pair_end(n){return is_surrogate_pair_end(n.charCodeAt(0))}function ends_with_pair_start(n){return is_surrogate_pair_start(n.charCodeAt(n.length-1))}function remove_empty_tuples(n){const e=[];for(let t=0;t<n.length;t++)n[t][1].length>0&&e.push(n[t]);return e}function make_edit_splice(n,e,t,s){return ends_with_pair_start(n)||starts_with_pair_end(s)?null:remove_empty_tuples([[0,n],[DIFF_DELETE,e],[1,t],[0,s]])}function find_cursor_edit_diff(n,e,t){const s=typeof t=="number"?{index:t,length:0}:t.oldRange,o=typeof t=="number"?null:t.newRange,l=n.length,i=e.length;if(s.length===0&&(o===null||o.length===0)){const r=s.index,c=n.slice(0,r),h=n.slice(r),a=o?o.index:null;e:{const p=r+i-l;if(a!==null&&a!==p)break e;if(p<0||p>i)break e;const w=e.slice(0,p),u=e.slice(p);if(u!==h)break e;const g=Math.min(r,p),d=c.slice(0,g),m=w.slice(0,g);if(d!==m)break e;const f=c.slice(g),b=w.slice(g);return make_edit_splice(d,f,b,h)}e:{if(a!==null&&a!==r)break e;const p=r,w=e.slice(0,r),u=e.slice(r);if(w!==c)break e;const g=Math.min(l-r,i-r),d=h.slice(h.length-g),m=u.slice(u.length-g);if(d!==m)break e;const f=h.slice(0,h.length-g),b=u.slice(0,u.length-g);return make_edit_splice(c,f,b,d)}}if(s.length>0&&o&&o.length===0){e:{const r=n.slice(0,s.index),c=n.slice(s.index+s.length),h=r.length,a=c.length;if(i<h+a)break e;const p=e.slice(0,h),w=e.slice(i-a);if(r!==p||c!==w)break e;const u=n.slice(h,l-a),g=e.slice(h,i-a);return make_edit_splice(r,u,g,c)}}return null}function diff(n,e,t){return diff_main({text1:n,text2:e,cursor_pos:t})}diff.INSERT=1,diff.DELETE=DIFF_DELETE,diff.EQUAL=0;const document=window.document;let monaco1=null;async function run(){await importScript("https://cdnjs.cloudflare.com/ajax/libs/core-js/3.6.5/minified.js"),await importScript("https://unpkg.com/@babel/standalone@7.12.4/babel.min.js"),await importScript("https://unpkg.com/react@17.0.1/umd/react.production.min.js"),await importScript("https://unpkg.com/react-dom@17.0.1/umd/react-dom.production.min.js"),await importScript("https://unpkg.com/interactjs@1.10.0/dist/interact.min.js");const n=/import/gi,e="///";setTimeout(()=>makeDraggable(),100);let t="";const s=a=>window.Babel.transform(a,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(/import/gi,"///"),o=async a=>{const p=new Function("transpileCode",`return function(){ ${a} }`)(),w={codeTranspiled:a,code:t},u=JSON.stringify(w),g=new Request("https://code.zed.vision",{body:u,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),d=await fetch(g),{hash:m}=await d.json();try{const f=window.localStorage,b=f.getItem("codeBoXHash");b!==m&&(f.setItem("codeBoXHash",m),f.setItem(m,t),window.history.pushState({},"","/?h="+m))}catch(f){console.log("no localStorage")}p()};let l=0,i="",r="",c=0;(async()=>{const a=getCodeToLoad();t=a,await startMonaco({language:"typescript",code:a,onChange:p=>{i=p;const w=async u=>{if(c===1)return;c=1;const g=await h(),d=document.getElementById("error");try{if(c=0,u!==i)return;if(g&&g.length){if(i!=u)return;if(r===u)return;document.getElementById("root").classList.add("transparent");const m=diff(t,u,0);if(console.log(m),m.length<=3){monaco1.editor.setTheme("hc-black");return}d.innerHTML=g[0].messageText.toString(),document.getElementById("root").style.setProperty("dispay","none"),d.style.display="block",r=u,monaco1.editor.setTheme("vs-light"),setTimeout(()=>{monaco1.editor.setTheme("hc-black")},l++);return}t=u,d.style.display="none",window.monaco.editor.setTheme("vs-dark"),document.getElementById("root").classList.remove("transparent"),l=0,c=0,o(s(u))}catch(m){if(c=0,u!==i)return;monaco1.editor.setTheme("vs-light"),setTimeout(()=>{window.monaco.editor.setTheme("hc-black")},10),console.error(m)}};if(!c)w(i);else{const u=p,g=setInterval(()=>{(p!==i||!c)&&clearInterval(g),c||w(i)},100)}}}),monaco1=window.monaco})(),o(s(getCodeToLoad())),document.getElementById("root").setAttribute("style","display:block");async function h(){const a=monaco1.Uri.parse("file:///main.tsx"),p=await window.monaco.languages.typescript.getTypeScriptWorker(),w=await(await p(a)).getSemanticDiagnostics("file:///main.tsx"),u=await(await p(a)).getCompilerOptionsDiagnostics("file:///main.tsx"),g=await(await p(a)).getSyntacticDiagnostics("file:///main.tsx");return[...w,...u,...g]}}function getCodeToLoad(){const n=window.localStorage.getItem("codeBoXHash");return window.localStorage.getItem(location.hash)||n&&window.localStorage.getItem(n)||window.localStorage.getItem("STARTER")||"() => <>Hello</>"}run();
