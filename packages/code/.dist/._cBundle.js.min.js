const importScript=async n=>new Promise(function(e,t){const s=window.document.createElement("script");s.src=n,s.onload=e,s.onerror=t,window.document.head.appendChild(s)}),makeDraggable=async()=>{const n=await importScript("https://unpkg.com/interactjs@1.10.0/dist/interact.js"),e=window.interact;e(".draggable").draggable({inertia:!0,modifiers:[e.modifiers.restrictRect({restriction:"parent",endOnly:!0})],autoScroll:!1,listeners:{move:dragMoveListener}})};function dragMoveListener(n){const e=n.target,t=(parseFloat(e.getAttribute("data-x"))||0)+n.dx,s=(parseFloat(e.getAttribute("data-y"))||0)+n.dy;e.style.webkitTransform=e.style.transform="translate("+t+"px, "+s+"px)",e.setAttribute("data-x",t),e.setAttribute("data-y",s)}let monaco,editor1;const startMonaco=async({onChange:n,code:e,language:t})=>{if(window.monaco===void 0){await loadScript("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js");const s=window.require;s.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs"}}),await(()=>new Promise(o=>s(["vs/editor/editor.main"],o)))(),monaco=window.monaco}else return editor1.onDidChangeModelContent(()=>n(editor1.getValue())),editor1.setValue(e),editor1;if(editor1=monaco.editor.create(window.document.getElementById("container"),{cursorStyle:"block",formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;}",mouseWheelZoom:!1,wordWrapColumn:70,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",lineNumbers:"off",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"l  anguageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:monaco.editor.createModel(e,t,monaco.Uri.parse(t==="typescript"?"file:///main.tsx":"file:///main.html")),value:e,language:t,theme:"vs-dark"}),monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),t==="typescript"){const s=[{name:"react",url:"https://unpkg.com/@types/react@latest/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@latest/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@latest/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@latest/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@latest/index.d.ts",depend:[]}],o=s.map(({name:l,url:i})=>(async()=>monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(i)).text(),`file:///node_modules/@types/${l}/index.d.ts`))());return monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:monaco.languages.typescript.ModuleResolutionKind.NodeJs,module:monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:monaco.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",jsxFragmentFactory:"React.Fragment",esModuleInterop:!0}),await Promise.all(o),monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),editor1}};function loadScript(n){return new Promise(function(e,t){var s;s=window.document.createElement("script"),s.src=n,s.onload=e,s.onerror=t,window.document.head.appendChild(s)})}const DIFFDELETE=-1,DIFFEQUAL=0;function diffMain({text1:n,text2:e,cursorPos:t}){if(n===e)return n?[[0,n]]:[];if(t){const r=findCursorEditDiff(n,e,t);if(r)return r}let s=diffCommonPrefix(n,e);const o=n.substring(0,s);n=n.substring(s),e=e.substring(s),s=diffCommonSuffix(n,e);const l=n.substring(n.length-s);n=n.substring(0,n.length-s),e=e.substring(0,e.length-s);const i=diffCompute_(n,e);return o&&i.unshift([0,o]),l&&i.push([0,l]),diffCleanupMerge(i),i}function diffCompute_(n,e){let t;if(!n)return[[1,e]];if(!e)return[[DIFFDELETE,n]];const s=n.length>e.length?n:e,o=n.length>e.length?e:n,l=s.indexOf(o);if(l!==-1)return t=[[1,s.substring(0,l)],[0,o],[1,s.substring(l+o.length)]],n.length>e.length&&(t[0][0]=t[2][0]=DIFFDELETE),t;if(o.length===1)return[[DIFFDELETE,n],[1,e]];const i=diffHalfMatch_(n,e);if(i){const r=i[0],u=i[1],h=i[2],a=i[3],m=i[4],p=diffMain({text1:r[1],text2:h[1],cursorPos:0}),g=diffMain({text1:u[1],text2:a[1],cursorPos:0});return p.concat([[0,m[1]]],g)}return diffBisect_(n,e)}function diffBisect_(n,e){const t=n.length,s=e.length,o=Math.ceil((t+s)/2),l=o,i=2*o,r=new Array(i),u=new Array(i);for(let f=0;f<i;f++)r[f]=-1,u[f]=-1;r[l+1]=0,u[l+1]=0;const h=t-s,a=h%2!==0;let m=0,p=0,g=0,d=0;for(let f=0;f<o;f++){for(let c=-f+m;c<=f-p;c+=2){const y=o+c;let b;c===-f||c!==f&&r[y-1]<r[y+1]?b=r[y+1]:b=r[y-1]+1;let k=b-c;for(;b<t&&k<s&&n.charAt(b)===e.charAt(k);)b++,k++;if(r[y]=b,b>t)p+=2;else if(k>s)m+=2;else if(a){const S=o+h-c;if(S>=0&&S<i&&u[S]!==-1){const E=t-u[S];if(b>=E)return diffBisectSplit_(n,e,b,k)}}}let w;for(let c=-f+g;c<=f-d;c+=2){const y=o+c;c===-f||c!==f&&u[y-1]<u[y+1]?w=u[y+1]:w=u[y-1]+1;let b=w-c;for(;w<t&&b<s&&n.charAt(t-w-1)===e.charAt(s-b-1);)w++,b++;if(u[y]=w,w>t)d+=2;else if(b>s)g+=2;else if(!a){const k=o+h-c;if(k>=0&&k<i&&r[k]!==-1){const S=r[k],E=o+S-k;if(w=t-w,S>=w)return diffBisectSplit_(n,e,S,E)}}}}return[[DIFFDELETE,n],[1,e]]}function diffBisectSplit_(n,e,t,s){const o=n.substring(0,t),l=e.substring(0,s),i=n.substring(t),r=e.substring(s),u=diffMain({text1:o[1],text2:l[1],cursorPos:0}),h=diffMain({text1:i[1],text2:r[1],cursorPos:0});return u.concat(h)}function diffCommonPrefix(n,e){if(!n||!e||n.charAt(0)!==e.charAt(0))return 0;let t=0,s=Math.min(n.length,e.length),o=s,l=0;for(;t<o;)n.substring(l,o)==e.substring(l,o)?(t=o,l=t):s=o,o=Math.floor((s-t)/2+t);return isSurrogatePairStart(n.charCodeAt(o-1))&&o--,o}function diffCommonSuffix(n,e){if(!n||!e||n.slice(-1)!==e.slice(-1))return 0;let t=0,s=Math.min(n.length,e.length),o=s,l=0;for(;t<o;)n.substring(n.length-o,n.length-l)==e.substring(e.length-o,e.length-l)?(t=o,l=t):s=o,o=Math.floor((s-t)/2+t);return isSurrogatePairEnd(n.charCodeAt(n.length-o))&&o--,o}function diffHalfMatch_(n,e){const t=n.length>e.length?n:e,s=n.length>e.length?e:n;if(t.length<4||s.length*2<t.length)return null;function o(g,d,f){const w=g.substring(f,f+Math.floor(g.length/4));let c=-1,y="",b,k,S,E;for(;(c=d.indexOf(w,c+1))!==-1;){const A=diffCommonPrefix(g.substring(f),d.substring(c)),C=diffCommonSuffix(g.substring(0,f),d.substring(0,c));y.length<C+A&&(y=d.substring(c-C,c)+d.substring(c,c+A),b=g.substring(0,f-C),k=g.substring(f+A),S=d.substring(0,c-C),E=d.substring(c+A))}return y.length*2>=g.length?[b,k,S,E,y]:null}const l=o(t,s,Math.ceil(t.length/4)),i=o(t,s,Math.ceil(t.length/2));let r;if(i===null&&l===null)return null;if(i===null){if(l===null)return null;r=l}else if(l===null){if(i===null)return null;r=i}else r=l[4].length>i[4].length?l:i;let u,h,a,m;n.length>e.length?(u=r[0],h=r[1],a=r[2],m=r[3]):(a=r[0],m=r[1],u=r[2],h=r[3]);const p=r[4];return[u,h,a,m,p]}function diffCleanupMerge(n){const e=[...n];e.push([0,""]);let t=0,s=0,o=0,l="",i="",r,u;for(;t<e.length;){if(t<e.length-1&&!e[t][1]){e.splice(t,1);continue}switch(e[t][0]){case 1:o++,i+=e[t][1],t++;break;case DIFFDELETE:s++,l+=e[t][1],t++;break;case 0:if(u=t-o-s-1,t<e.length-1&&!e[t][1]){e.splice(t,1);break}if(l.length>0||i.length>0){l.length>0&&i.length>0&&(r=diffCommonPrefix(i,l),r!==0&&(u>=0?e[u][1]+=i.substring(0,r):(e.splice(0,0,[0,i.substring(0,r)]),t++),i=i.substring(r),l=l.substring(r)),r=diffCommonSuffix(i,l),r!==0&&(e[t][1]=i.substring(i.length-r)+e[t][1],i=i.substring(0,i.length-r),l=l.substring(0,l.length-r)));const a=o+s;l.length===0&&i.length===0?(e.splice(t-a,a),t=t-a):l.length===0?(e.splice(t-a,a,[1,i]),t=t-a+1):i.length===0?(e.splice(t-a,a,[DIFFDELETE,l]),t=t-a+1):(e.splice(t-a,a,[DIFFDELETE,l],[1,i]),t=t-a+2)}t!==0&&e[t-1][0]===DIFFEQUAL?(e[t-1][1]+=e[t][1],e.splice(t,1)):t++,o=0,s=0,l="",i="";break}}e[e.length-1][1]===""&&e.pop();let h=!1;for(t=1;t<e.length-1;)e[t-1][0]===0&&e[t+1][0]===DIFFEQUAL&&(e[t][1].substring(e[t][1].length-e[t-1][1].length)===e[t-1][1]?(e[t][1]=e[t-1][1]+e[t][1].substring(0,e[t][1].length-e[t-1][1].length),e[t+1][1]=e[t-1][1]+e[t+1][1],e.splice(t-1,1),h=!0):e[t][1].substring(0,e[t+1][1].length)==e[t+1][1]&&(e[t-1][1]+=e[t+1][1],e[t][1]=e[t][1].substring(e[t+1][1].length)+e[t+1][1],e.splice(t+1,1),h=!0)),t++;return h?diffCleanupMerge(e):e}function isSurrogatePairStart(n){return n>=55296&&n<=56319}function isSurrogatePairEnd(n){return n>=56320&&n<=57343}function startsWithPairEnd(n){return isSurrogatePairEnd(n.charCodeAt(0))}function endsWithPairStart(n){return isSurrogatePairStart(n.charCodeAt(n.length-1))}function removeEmptyTuples(n){const e=[];for(let t=0;t<n.length;t++)n[t][1].length>0&&e.push(n[t]);return e}function makeEditSplice(n,e,t,s){return endsWithPairStart(n)||startsWithPairEnd(s)?null:removeEmptyTuples([[0,n],[DIFFDELETE,e],[1,t],[0,s]])}function findCursorEditDiff(n,e,t){const s=typeof t=="number"?{index:t,length:0}:t.oldRange,o=typeof t=="number"?null:t.newRange,l=n.length,i=e.length;if(s.length===0&&(o===null||o.length===0)){const r=s.index,u=n.slice(0,r),h=n.slice(r),a=o?o.index:null;e:{const m=r+i-l;if(a!==null&&a!==m)break e;if(m<0||m>i)break e;const p=e.slice(0,m),g=e.slice(m);if(g!==h)break e;const d=Math.min(r,m),f=u.slice(0,d),w=p.slice(0,d);if(f!==w)break e;const c=u.slice(d),y=p.slice(d);return makeEditSplice(f,c,y,h)}e:{if(a!==null&&a!==r)break e;const m=r,p=e.slice(0,r),g=e.slice(r);if(p!==u)break e;const d=Math.min(l-r,i-r),f=h.slice(h.length-d),w=g.slice(g.length-d);if(f!==w)break e;const c=h.slice(0,h.length-d),y=g.slice(0,g.length-d);return makeEditSplice(u,c,y,f)}}if(s.length>0&&o&&o.length===0){e:{const r=n.slice(0,s.index),u=n.slice(s.index+s.length),h=r.length,a=u.length;if(i<h+a)break e;const m=e.slice(0,h),p=e.slice(i-a);if(r!==m||u!==p)break e;const g=n.slice(h,l-a),d=e.slice(h,i-a);return makeEditSplice(r,g,d,u)}}return null}function diff(n,e,t){return diffMain({text1:n,text2:e,cursorPos:t})}diff.INSERT=1,diff.DELETE=DIFFDELETE,diff.EQUAL=0;const document=window.document;let monaco1=null;async function run(){await importScript("https://cdnjs.cloudflare.com/ajax/libs/core-js/3.6.5/minified.js"),await importScript("https://unpkg.com/@babel/standalone@7.12.4/babel.min.js"),await importScript("https://unpkg.com/react@17.0.1/umd/react.production.min.js"),await importScript("https://unpkg.com/react-dom@17.0.1/umd/react-dom.production.min.js"),await importScript("https://unpkg.com/interactjs@1.10.0/dist/interact.min.js");const n=/import/gi,e="///";setTimeout(()=>makeDraggable(),100);let t="";const s=a=>window.Babel.transform(a,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(/import/gi,"///"),o=async a=>{const m=new Function("transpileCode",`return function(){ ${a} }`)(),p={codeTranspiled:a,code:t},g=JSON.stringify(p),d=new Request("https://code.zed.vision",{body:g,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),f=await fetch(d),{hash:w}=await f.json();try{const c=window.localStorage,y=c.getItem("codeBoXHash");y!==w&&(c.setItem("codeBoXHash",w),c.setItem(w,t),window.history.pushState({},"","/?h="+w))}catch(c){console.log("no localStorage")}m()};let l=0,i="",r="",u=0;(async()=>{const a=getCodeToLoad();if(t=a,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)){await Promise.all([importScript("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"),importScript("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js"),importScript("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js")]),document.getElementById("ace").style.setProperty("display","block"),document.getElementById("container").style.setProperty("display","none");const p=window.ace.edit("ace");p.setTheme("ace/theme/monokai"),p.session.setMode("ace/mode/typescript"),p.setValue(a)}editor=await startMonaco({language:"typescript",code:a,onChange:m}),window.editor=editor,monaco1=window.monaco,ace.session.on("change",function(p){const g=ace.getValue();editor.setValue(g),m(g)});function m(p){i=p;const g=async d=>{if(u===1)return;u=1;const f=await h(),w=document.getElementById("error");try{if(u=0,d!==i)return;if(f&&f.length){if(i!=d)return;if(r===d)return;document.getElementById("root").classList.add("transparent");const c=diff(t,d,0);if(console.log(c),c.length<=3){monaco1.editor.setTheme("hc-black");return}w.innerHTML=f[0].messageText.toString(),document.getElementById("root").style.setProperty("dispay","none"),w.style.display="block",r=d,monaco1.editor.setTheme("vs-light"),setTimeout(()=>{monaco1.editor.setTheme("hc-black")},l++);return}t=d,w.style.display="none",window.monaco.editor.setTheme("vs-dark"),document.getElementById("root").classList.remove("transparent"),l=0,u=0,o(s(d))}catch(c){if(u=0,d!==i)return;monaco1.editor.setTheme("vs-light"),setTimeout(()=>{window.monaco.editor.setTheme("hc-black")},10),console.error(c)}};if(!u)g(i);else{const d=p,f=setInterval(()=>{(p!==i||!u)&&clearInterval(f),u||g(i)},100)}}})(),o(s(getCodeToLoad())),document.getElementById("root").setAttribute("style","display:block");async function h(){const a=monaco1.Uri.parse("file:///main.tsx"),m=await window.monaco.languages.typescript.getTypeScriptWorker(),p=await(await m(a)).getSemanticDiagnostics("file:///main.tsx"),g=await(await m(a)).getCompilerOptionsDiagnostics("file:///main.tsx"),d=await(await m(a)).getSyntacticDiagnostics("file:///main.tsx");return[...p,...g,...d]}}function getCodeToLoad(){const n=new URLSearchParams(window.location.search),e=n.get("h");return e&&window.localStorage.getItem(e)||window.localStorage.getItem("STARTER")||"() => <>Hello</>"}run();
