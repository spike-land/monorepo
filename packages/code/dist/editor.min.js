const l=(a,t=[])=>window.document.head.querySelector(`script[src="${a}"]`)||new Promise(function(n,c){const e=window.document.createElement("script");e.src=a,e.async="async",e.type="application/javascript",e.onload=()=>{t.length===0&&n(window);const i={};t.forEach(m=>Object.assign(i,window[m])),n(i)},e.onerror=c,window.document.head.appendChild(e)}),w=async()=>{const a="https://unpkg.com/monaco-editor@0.21.2/min/vs",{require:t}=await l("https://unpkg.com/monaco-editor@0.21.2/min/vs/loader.js");t.config({paths:{vs:a}});const n=await new Promise(c=>t(["vs/editor/editor.main"],e=>c(e)));return n},x=()=>typeof window=="undefined"?!1:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent);export const startMonaco=async({onChange:a,code:t,language:n,options:c})=>{let e=null;const{document:i}=window,m=i.getElementById("container");if(!m){const s=i.getElementById("container");s.id="container",i.body.appendChild(s)}const h=n==="typescript"?"file:///main.tsx":"file:///main.html";if(x()){const s=window.document.createElement("div");s.id="ace",window.document.body.appendChild(s),await l("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"),n==="typescript"?await l("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js"):await l("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.min.js"),await l("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js"),window.document.getElementById("ace").style.setProperty("display","block"),m.style.setProperty("display","none");const{ace:u}=window;e=u.edit("ace"),e.getSession().setMode("ace/mode/typescript");const d=y=>setTimeout(()=>{const g=u.edit("ace"),f=g.getTheme();f!=="ace/theme/monokai "&&(g.setOptions({fontSize:"14pt"}),g.setTheme("ace/theme/monokai"),d(2*y))},y);d(100),e.setValue(t),e.blur()}const r=await w();let p;try{p=r.editor.getModel(h),p.getValue()!==t&&p.setValue(t)}catch{p=await r.editor.createModel(t,n,r.Uri.parse(h))}const o={monaco:r,editor:r.editor.create(window.document.getElementById("container"),{formatOnType:!1,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,glyphMargin:!1,wordWrap:"off",mouseWheelZoom:!1,wordWrapColumn:80,useTabStops:!1,dragAndDrop:!1,disableLayerHinting:!0,formatOnPaste:!1,disableMonospaceOptimizations:!0,showUnused:!0,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"full",accessibilitySupport:"off",autoClosingQuotes:"beforeWhitespace",padding:{bottom:300},lineNumbers:"on",autoClosingBrackets:"beforeWhitespace",autoClosingOvertype:"auto",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!1,codeActionsOnSaveTimeout:100,model:p,value:t,language:n,theme:"vs-dark",...c})};if(o.editor.onDidChangeModelContent(()=>a(o.editor.getValue())),e&&e.session.on("change",function(){const s=e.getValue();o.editor.setValue(s),a(s)}),e&&i.getElementById("container").replaceWith(i.getElementById("ace")),o.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),n==="typescript"){const s=[{name:"react",url:"https://unpkg.com/@types/react@17.0.0/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@17.0.0/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@17.0.0/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@3.0.5/index.d.ts",depend:[]},{name:"@emotion/styled/base.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/styled/index.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/cache/index.d.ts",url:"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts",depend:["@emotion/utils"]},{name:"@emotion/react/index.d.ts",url:"https://unpkg.com/@emotion/react@11.1.2/types/index.d.ts",depend:["@emotion/cache"]},{name:"@emotion/react/jsx-namespace.d.ts",url:"https://unpkg.com/@emotion/react@11.1.2/types/jsx-namespace.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/css-prop.d.ts",url:"https://unpkg.com/@emotion/react@11.1.2/types/css-prop.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/helper.d.ts",url:"https://unpkg.com/@emotion/react@11.1.2/types/helper.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/theming.d.ts",url:"https://unpkg.com/@emotion/react@11.1.2/types/theming.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/serialize/index.d.ts",url:"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/utils/index.d.ts",url:"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts",depend:[]},{name:"framer-motion",url:"https://unpkg.com/framer-motion@3.1.1/dist/framer-motion.d.ts",depend:[]},{name:"popmotion",url:"https://unpkg.com/popmotion@9.0.2/lib/index.d.ts"},{name:"@zedvision/qrious/index.d.ts",url:"https://unpkg.com/@zedvision/qrious@8.5.7/dist/qrious.d.ts"}],u=s.map(({name:d,url:y})=>(async()=>o.monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(y)).text(),d.includes("@")?`file:///node_modules/${d}`:`file:///node_modules/@types/${d}/index.d.ts`))());return o.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:o.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:o.monaco.languages.typescript.ModuleResolutionKind.Nodejs,module:o.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:"react-jsx",esModuleInterop:!0}),await Promise.all(u),o.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),o}};
