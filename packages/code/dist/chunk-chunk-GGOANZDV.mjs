import{a as Ze}from"./chunk-chunk-MFZRRRQA.mjs";import{a as Se,d as Ot}from"./chunk-chunk-ZBPVZ5QP.mjs";import{a as X,h as j,i as ke,p as Y}from"./chunk-chunk-UNVWRENN.mjs";import{a as Nt,b as C,e as _,f as p,g as we,h as I,i as ye,j as be,k as $e,l as ze}from"./chunk-chunk-L2U7Q2OG.mjs";import{b as Je}from"./chunk-chunk-66EYGUWD.mjs";import{B as A,C as U,H as K,K as Qe,L as $,N as F,a as We,c as ve,d as Ce,f as Ve,g as qe,i as Be,k as Ge,m as Ke,n as Xe,u as L,z as Ye}from"./chunk-chunk-FVOCI6BE.mjs";import{b as Ht,d as ge,j as l}from"./chunk-chunk-FWOMBYHR.mjs";var ct=Ht((Or,st)=>{"use strict";l();var it=Function.prototype.toString,z=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Te,ee;if(typeof z=="function"&&typeof Object.defineProperty=="function")try{Te=Object.defineProperty({},"length",{get:function(){throw ee}}),ee={},z(function(){throw 42},null,Te)}catch(t){t!==ee&&(z=null)}else z=null;var Ut=/^\s*class\b/,Fe=function(e){try{var r=it.call(e);return Ut.test(r)}catch{return!1}},Re=function(e){try{return Fe(e)?!1:(it.call(e),!0)}catch{return!1}},te=Object.prototype.toString,$t="[object Object]",zt="[object Function]",Jt="[object GeneratorFunction]",Wt="[object HTMLAllCollection]",Vt="[object HTML document.all class]",qt="[object HTMLCollection]",Bt=typeof Symbol=="function"&&!!Symbol.toStringTag,Gt=!(0 in[,]),je=function(){return!1};typeof document=="object"&&(at=document.all,te.call(at)===te.call(document.all)&&(je=function(e){if((Gt||!e)&&(typeof e>"u"||typeof e=="object"))try{var r=te.call(e);return(r===Wt||r===Vt||r===qt||r===$t)&&e("")==null}catch{}return!1}));var at;st.exports=z?function(e){if(je(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{z(e,null,Te)}catch(r){if(r!==ee)return!1}return!Fe(e)&&Re(e)}:function(e){if(je(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(Bt)return Re(e);if(Fe(e))return!1;var r=te.call(e);return r!==zt&&r!==Jt&&!/^\[object HTML/.test(r)?!1:Re(e)}});l();F();F();l();F();F();var et=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),xe="html",Ee="svg",It="http://www.w3.org/2000/svg",Lt=function(t,e){if(e===xe)return t instanceof HTMLElement;if(e===Ee)return t instanceof SVGElement;throw new Error('Unrecognized element type "'+e+'" for validateElementType.')},tt=function(t,e){var r={},n,o,i;if(t===xe)i=document.createElement("div");else if(t===Ee)i=document.createElementNS(It,"g");else throw new Error('Invalid element type "'+t+'" for createPortalNode: must be "html" or "svg".');if(e&&typeof e=="object")for(var a=0,s=Object.entries(e.attributes);a<s.length;a++){var c=s[a],g=c[0],u=c[1];i.setAttribute(g,u)}var H={element:i,elementType:t,setPortalProps:function(x){r=x},getInitialPortalProps:function(){return r},mount:function(x,v){if(v!==o){if(H.unmount(),x!==n&&!Lt(x,t))throw new Error('Invalid element type for portal: "'+t+'" portalNodes must be used with '+t+" elements, but OutPortal is within <"+x.tagName+">.");x.replaceChild(H.element,v),n=x,o=v}},unmount:function(x){x&&x!==o||n&&o&&(n.replaceChild(o,H.element),n=void 0,o=void 0)}};return H},rt=function(t){et(e,t);function e(r){var n=t.call(this,r)||this;return n.addPropsChannel=function(){Object.assign(n.props.node,{setPortalProps:function(o){n.setState({nodeProps:o})}})},n.state={nodeProps:n.props.node.getInitialPortalProps()},n}return e.prototype.componentDidMount=function(){this.addPropsChannel()},e.prototype.componentDidUpdate=function(){this.addPropsChannel()},e.prototype.render=function(){var r=this,n=this.props,o=n.children,i=n.node;return Qe(We.map(o,function(a){return Ke(a)?qe(a,r.state.nodeProps):a}),i.element)},e}(Ce),Q=function(t){et(e,t);function e(r){var n=t.call(this,r)||this;return n.placeholderNode=Ge(),n.passPropsThroughPortal(),n}return e.prototype.passPropsThroughPortal=function(){var r=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(r)},e.prototype.componentDidMount=function(){var r=this.props.node;this.currentPortalNode=r;var n=this.placeholderNode.current,o=n.parentNode;r.mount(o,n),this.passPropsThroughPortal()},e.prototype.componentDidUpdate=function(){var r=this.props.node;this.currentPortalNode&&r!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode.setPortalProps({}),this.currentPortalNode=r);var n=this.placeholderNode.current,o=n.parentNode;r.mount(o,n),this.passPropsThroughPortal()},e.prototype.componentWillUnmount=function(){var r=this.props.node;r.unmount(this.placeholderNode.current),r.setPortalProps({})},e.prototype.render=function(){return Be("div",{ref:this.placeholderNode})},e}(Ce),nt=tt.bind(null,xe),vr=tt.bind(null,Ee);l();F();l();F();l();Y();function f(t,e,r){return hasOwnProperty.call(e,"css")?ke(t,e,r):Se(t,e,r)}function R(t,e,r){return hasOwnProperty.call(e,"css")?ke(t,e,r):Se(t,e,r)}var _e=class extends $.Component{constructor(e){super(e),this.state={error:void 0,errorInfo:void 0}}componentDidCatch(e,r){this.setState({error:e,errorInfo:r})}render(){return this.state.errorInfo?R("div",{children:[f("h2",{children:"Something went wrong."}),R("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),f("br",{}),this.state.errorInfo.componentStack]})]}):this.props.children}},ot=_e;Y();l();var Pe=ge(Ot(),1),At=Pe.default.default||Pe.default,Z=At;var dt=ge(ct(),1);var Kt=t=>window.importShim?window.importShim(t):import(t);Object.assign(globalThis,{apps:{},eCaches:{}});var{apps:T,eCaches:V}=globalThis||globalThis.apps,ut=({hash:t,codeSpace:e})=>{let[r,n]=U(C(p().transpiled).slice(0,8));L(()=>{let s=C(p().transpiled).slice(0,8);s!==r&&n(s)},[t]);let o=A(null),i=p().transpiled,a=T[C(i).slice(0,8)];return f(ot,{ref:o,children:f(a,{appId:`${e}-${r}`})},r)},lt=!1;async function J(t="",e){let{transpiled:r,i:n}=p(),o=t.length>0?t:r,i=C(o).slice(0,8);if(!T[i])try{console.log(`i: ${n}: `);let a=(await Kt(Xt(o))).default;if((0,dt.default)(a))V[i]=Z({key:"z",speedy:!1}),V[i].compat=void 0,T[i]=({appId:s})=>s.includes(i)?f(X,{value:V[i],children:f("div",{css:j`height: 100%;`,id:s,children:f(a,{})})}):null;else throw new Error("the default export is not a function!")}catch(a){if(a instanceof SyntaxError){let s=a.name,c=a.message;T[i]=()=>R("div",{css:j`background-color: orange;`,children:[f("h1",{children:"Syntax Error"}),R("h2",{children:[s,": ",c]}),f("p",{children:JSON.stringify({err:a})})]})}else if(a instanceof Error){let s=a.name,c=a.message;T[i]=()=>R("div",{css:j`background-color: orange;`,children:[f("h1",{children:"Syntax Error"}),R("h2",{children:[s,": ",c]}),f("p",{children:JSON.stringify({err:a})})]})}else T[i]=()=>f("div",{css:j`background-color: orange;`,children:R("h1",{children:["Unknown Error: $",i]})})}return!lt&&e&&(lt=!0,await ft({codeSpace:e})),T[i]}function Xt(t,e="index.mjs"){let r=new File([t],e,{type:"application/javascript",lastModified:Date.now()});return URL.createObjectURL(r)}Y();l();F();l();l();var Oe=ge(Nt(),1);l();l();function pt(t,e=r=>r.key){var r=[];return Me(t,"",!0,n=>r.push(n),e),r.join("")}function Me(t,e,r,n,o){if(t){n(`${e}${r?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 "}${o(t)}
`);let i=e+(r?"    ":"\u2502   ");t.left&&Me(t.left,i,!1,n,o),t.right&&Me(t.right,i,!0,n,o)}}function re(t){if(t===null)return!0;var e=ne(t.left),r=ne(t.right);return!!(Math.abs(e-r)<=1&&re(t.left)&&re(t.right))}function ne(t){return t?1+Math.max(ne(t.left),ne(t.right)):0}function oe(t,e,r,n,o){let i=o-n;if(i>0){let a=n+Math.floor(i/2),s=e[a],c=r[a],g={key:s,data:c,parent:t};return g.left=oe(g,e,r,n,a),g.right=oe(g,e,r,a+1,o),g}return null}function ae(t){if(t===null)return 0;let e=ae(t.left),r=ae(t.right);return t.balanceFactor=e-r,Math.max(e,r)+1}function ie(t,e,r,n,o){if(r>=n)return;let i=t[r+n>>1],a=r-1,s=n+1;for(;;){do a++;while(o(t[a],i)<0);do s--;while(o(t[s],i)>0);if(a>=s)break;let c=t[a];t[a]=t[s],t[s]=c,c=e[a],e[a]=e[s],e[s]=c}ie(t,e,r,s,o),ie(t,e,s+1,n,o)}function Yt(t,e){return t>e?1:t<e?-1:0}function se(t){var e=t.right;return t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent,e.parent&&(e.parent.left===t?e.parent.left=e:e.parent.right=e),t.parent=e,e.left=t,t.balanceFactor+=1,e.balanceFactor<0&&(t.balanceFactor-=e.balanceFactor),e.balanceFactor+=1,t.balanceFactor>0&&(e.balanceFactor+=t.balanceFactor),e}function ce(t){var e=t.left;return t.left=e.right,t.left&&(t.left.parent=t),e.parent=t.parent,e.parent&&(e.parent.left===t?e.parent.left=e:e.parent.right=e),t.parent=e,e.right=t,t.balanceFactor-=1,e.balanceFactor>0&&(t.balanceFactor-=e.balanceFactor),e.balanceFactor-=1,t.balanceFactor<0&&(e.balanceFactor+=t.balanceFactor),e}var O=class{constructor(e,r=!1){this._comparator=e||Yt,this._root=null,this._size=0,this._noDuplicates=!!r}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(e){if(this._root)for(var r=this._root,n=this._comparator;r;){var o=n(e,r.key);if(o===0)return!0;o<0?r=r.left:r=r.right}return!1}next(e){var r=e;if(r)if(r.right)for(r=r.right;r.left;)r=r.left;else for(r=e.parent;r&&r.right===e;)e=r,r=r.parent;return r}prev(e){var r=e;if(r)if(r.left)for(r=r.left;r.right;)r=r.right;else for(r=e.parent;r&&r.left===e;)e=r,r=r.parent;return r}forEach(e){for(var r=this._root,n=[],o=!1,i=0;!o;)r?(n.push(r),r=r.left):n.length>0?(r=n.pop(),e(r,i++),r=r.right):o=!0;return this}range(e,r,n,o){let i=[],a=this._comparator,s=this._root,c;for(;i.length!==0||s;)if(s)i.push(s),s=s.left;else{if(s=i.pop(),c=a(s.key,r),c>0)break;if(a(s.key,e)>=0&&n.call(o,s))return this;s=s.right}return this}keys(){for(var e=this._root,r=[],n=[],o=!1;!o;)e?(r.push(e),e=e.left):r.length>0?(e=r.pop(),n.push(e.key),e=e.right):o=!0;return n}values(){for(var e=this._root,r=[],n=[],o=!1;!o;)e?(r.push(e),e=e.left):r.length>0?(e=r.pop(),n.push(e.data),e=e.right):o=!0;return n}at(e){for(var r=this._root,n=[],o=!1,i=0;!o;)if(r)n.push(r),r=r.left;else if(n.length>0){if(r=n.pop(),i===e)return r;i++,r=r.right}else o=!0;return null}minNode(){var e=this._root;if(!e)return null;for(;e.left;)e=e.left;return e}maxNode(){var e=this._root;if(!e)return null;for(;e.right;)e=e.right;return e}min(){var e=this._root;if(!e)return null;for(;e.left;)e=e.left;return e.key}max(){var e=this._root;if(!e)return null;for(;e.right;)e=e.right;return e.key}isEmpty(){return!this._root}pop(){var e=this._root,r=null;if(e){for(;e.left;)e=e.left;r={key:e.key,data:e.data},this.remove(e.key)}return r}popMax(){var e=this._root,r=null;if(e){for(;e.right;)e=e.right;r={key:e.key,data:e.data},this.remove(e.key)}return r}find(e){for(var r=this._root,n=r,o,i=this._comparator;n;){if(o=i(e,n.key),o===0)return n;o<0?n=n.left:n=n.right}return null}insert(e,r){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:e,data:r},this._size++,this._root;var n=this._comparator,o=this._root,i=null,a=0;if(this._noDuplicates)for(;o;){if(a=n(e,o.key),i=o,a===0)return null;a<0?o=o.left:o=o.right}else for(;o;)a=n(e,o.key),i=o,a<=0?o=o.left:o=o.right;var s={left:null,right:null,balanceFactor:0,parent:i,key:e,data:r},c;for(a<=0?i.left=s:i.right=s;i&&(a=n(i.key,e),a<0?i.balanceFactor-=1:i.balanceFactor+=1,i.balanceFactor!==0);){if(i.balanceFactor<-1){i.right.balanceFactor===1&&ce(i.right),c=se(i),i===this._root&&(this._root=c);break}else if(i.balanceFactor>1){i.left.balanceFactor===-1&&se(i.left),c=ce(i),i===this._root&&(this._root=c);break}i=i.parent}return this._size++,s}remove(e){if(!this._root)return null;for(var r=this._root,n=this._comparator,o=0;r&&(o=n(e,r.key),o!==0);)o<0?r=r.left:r=r.right;if(!r)return null;var i=r.key,a,s;if(r.left){for(a=r.left;a.left||a.right;){for(;a.right;)a=a.right;r.key=a.key,r.data=a.data,a.left&&(r=a,a=a.left)}r.key=a.key,r.data=a.data,r=a}if(r.right){for(s=r.right;s.left||s.right;){for(;s.left;)s=s.left;r.key=s.key,r.data=s.data,s.right&&(r=s,s=s.right)}r.key=s.key,r.data=s.data,r=s}for(var c=r.parent,g=r,u;c&&(c.left===g?c.balanceFactor-=1:c.balanceFactor+=1,c.balanceFactor<-1?(c.right.balanceFactor===1&&ce(c.right),u=se(c),c===this._root&&(this._root=u),c=u):c.balanceFactor>1&&(c.left.balanceFactor===-1&&se(c.left),u=ce(c),c===this._root&&(this._root=u),c=u),!(c.balanceFactor===-1||c.balanceFactor===1));)g=c,c=c.parent;return r.parent&&(r.parent.left===r?r.parent.left=null:r.parent.right=null),r===this._root&&(this._root=null),this._size--,i}load(e=[],r=[],n){if(this._size!==0)throw new Error("bulk-load: tree is not empty");let o=e.length;return n&&ie(e,r,0,o-1,this._comparator),this._root=oe(null,e,r,0,o),ae(this._root),this._size=o,this}isBalanced(){return re(this._root)}toString(e){return pt(this._root,e)}};O.default=O;l();var le,Qt=new Uint8Array(16);function Zt(){if(!le&&(le=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!le))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return le(Qt)}var er=/^(?:[\da-f]{8}-[\da-f]{4}-[1-5][\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}|0{8}-(?:0{4}-){3}0{12})$/i;function tr(t){return typeof t=="string"&&er.test(t)}var y=[];for(let t=0;t<256;++t)y.push((t+256).toString(16).slice(1));function rr(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(y[t[e+0]]+y[t[e+1]]+y[t[e+2]]+y[t[e+3]]+"-"+y[t[e+4]]+y[t[e+5]]+"-"+y[t[e+6]]+y[t[e+7]]+"-"+y[t[e+8]]+y[t[e+9]]+"-"+y[t[e+10]]+y[t[e+11]]+y[t[e+12]]+y[t[e+13]]+y[t[e+14]]+y[t[e+15]]).toLowerCase();if(!tr(r))throw new TypeError("Stringified UUID is invalid");return r}function ht(t,e,r){t=t||{};let n=t.random||(t.rng||Zt)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(let o=0;o<16;++o)e[r+o]=n[o];return e}return rr(n)}l();async function N(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}var nr=new O((t,e)=>t===e?0:t<e?1:-1,!0),ue=[],S=(self&&self.crypto&&self.crypto.randomUUID&&self.crypto.randomUUID()||ht()).slice(0,8);nr.insert(S);var d={},q,M,mt="",W=0,fe=0,gt=0,De=0,b=null,wt,D=!1,pe={},P={localStream:null,webRtcArray:ue,tracks:pe,user:S,rtcConns:d,send(t){let e=JSON.stringify({...t,name:t.name||S});ue.map(r=>{try{if(r.readyState!=="open")return;(!t.target||r.target===t.target&&!B.includes(r.target))&&r.send(e)}catch{}})}};Object.assign(globalThis,{sendChannel:P});var ln=async t=>{let{mST:e,address:r}=t;M=t.codeSpace,q=new BroadcastChannel(location.origin),!(location.pathname.endsWith("dehydrated")&&(q.onmessage=n=>{n.data.codeSpace===M&&console.log(n.data)}))&&($e(M,{name:S,state:e},location.origin),await J(e.transpiled,M),await bt(),q=new BroadcastChannel(location.origin),q.onmessage=async n=>{if(!(n.data.ignoreUser&&n.data.ignoreUser===S)&&(n.data.codeSpace===M&&n.data.address&&!r&&b?.send(JSON.stringify({codeSpace:M,address:n.data.address})),n.data.ignoreUser&&!B.includes(n.data.ignoreUser)&&B.push(n.data.ignoreUser),n.data.codeSpace===M&&n.data.sess.code!==p().code)){let o=await be(n.data.sess);await we(o)}},I(()=>{let n=p(),o=C(JSON.stringify(n));o!==mt&&(mt=o,q.postMessage({ignoreUser:S,sess:n,codeSpace:M,address:r}))},"broadcast"))},He=null;async function de(){return!D||b===null?(b=null,await bt()):b}var B=[];function yt(){ar(),or()}var or=(0,Oe.default)(sr,100,{trailing:!0,leading:!0,maxWait:500}),ar=(0,Oe.default)(ir,1200,{trailing:!0,leading:!0,maxWait:2500});async function ir(){try{if(b){if(W===_())return;let t=p(),e=await ye(W,t);if(!e||e.newHash!==_())return;let r=JSON.stringify({...e,name:S});wt(r)}else D=!1,await de()}catch{}}var fn=async()=>{!P.localStream||P.localStream.getTracks().map(t=>t.stop())},dn=async t=>{let e={audio:!0,video:!0},r=await navigator.mediaDevices.getUserMedia(e);t.srcObject=r,r.getTracks().forEach(n=>Object.keys(P.rtcConns).map(o=>{let i=P.rtcConns[o];i.addTrack(n),i.ontrack=({track:a,streams:s})=>pe[o]={track:a,streams:s}}))};async function sr(){try{if(Object.keys(d).length>0){if(fe===_())return;let t=p(),e=fe?await ye(fe,t):await be(t);e&&e.patch&&P.send(e)}}catch{}}async function bt(){if(b!==null)return b;if(D=!0,location.origin.includes("localhost"))return;let t=new WebSocket(`wss://${location.host}/live/`+M+"/websocket");return D=!1,t.addEventListener("open",()=>{b=t,wt=n=>{try{b&&b?.send&&b?.send(n)}catch{b=null,D=!1,de()}};let r=Object.assign(t,{hashCode:_()});return b.addEventListener("message",n=>vt(n,"ws",r)),He&&clearInterval(He),He=setInterval(()=>{let o=Date.now()-De;if(o>4e4)try{if(t.readyState===t.OPEN){t?.send(JSON.stringify({name:S,timestamp:gt+o}));return}D=!1,de()}catch{D=!1,de()}},3e4),t.send(JSON.stringify({name:S})),t}),t}var Ne={};async function vt(t,e,r){if(b==null)return;De=Date.now();let n=JSON.parse(t.data);cr(n,e,r)}async function cr(t,e,r){if(e==="ws"&&t.timestamp&&(De=Date.now(),gt=t.timestamp),(t.hashCode||t.newHash&&r)&&(r.hashCode=t.hashCode||t.newHash),e==="ws"&&t.hashCode&&(W=t.hashCode),e==="ws"&&t.hashCode&&(W=t.hashCode),(e==="rtc"&&t.hashCode||t.newHash)&&(fe=t.hashCode||t.newHash),B.includes(t.name)||t.newHash===_())return;if(t.oldHash&&t.newHash){if(Ne[t.oldHash]&&Ne[t.oldHash]===t.newHash)return;Ne[t.oldHash]=t.newHash}if(t.newHash===_())return;if((async()=>{try{if(t.type==="new-ice-candidate"){await lr(t.candidate,t.name);return}if(t.type==="video-offer"){await i(t.offer,t.name);return}if(t.type==="video-answer"){await o(t.answer,t.name);return}if(t.name&&t.name!==S&&!d[t.name]&&!B.includes(t.name)){await n(t.name);let a=t.users;for(;a.length;){await N(2e3);let s=a.pop();s&&!P.rtcConns[s]&&await n(s)}return}}catch{}})(),t.patch&&t.name!==S){if(t.newHash===_())return;if(await we(t),t.newHash===_()){P&&P.send({hashCode:t.newHash});return}return}if(t.patch&&t.name===S){W=t.newHash;return}if(t.name===S)return;_();function n(a){if(d[a])return;d[a]=new RTCPeerConnection(Ct),d[a].onicecandidate=v=>{v.candidate&&b?.send(JSON.stringify({type:"new-ice-candidate",target:a,name:S,candidate:v.candidate.toJSON()}))},d[a].oniceconnectionstatechange=H,d[a].onicegatheringstatechange=x,d[a].onsignalingstatechange=()=>{switch(d[a].signalingState){case"closed":break}},d[a].onnegotiationneeded=u,d[a].ontrack=function({track:v,streams:E}){pe[a]={track:v,streams:E}},d[a].ondatachannel=v=>{let E=v.channel;E.binaryType="arraybuffer",E.addEventListener("close",g),P&&P.localStream&&P.localStream.active&&P.localStream.getTracks().forEach(me=>{let Ue=d[a];Ue.addTrack(me),Ue.ontrack=({track:jt,streams:Mt})=>pe[a]={track:jt,streams:Mt}}),E.addEventListener("message",async me=>vt(me,"rtc",Object.assign(E,{hashCode:_()})));let Ft=Object.assign(E,{target:a});ue.push(Ft)};let s={ordered:!0,reliable:!0,maxPacketLifeTime:3e3},c=Object.assign(d[a].createDataChannel(a,s),{target:a});return c.binaryType="arraybuffer",c.addEventListener("error",v=>{console.log("xxxxxx-  Data Channel Error:",v)}),c.addEventListener("open",()=>{ue.push(c)}),c.addEventListener("close",()=>{}),d[a];function g(){d[a].close(),delete d[a]}async function u(){try{let v=await d[a].createOffer();if(d[a].signalingState!="stable")return;await d[a].setLocalDescription(v),b?.send(JSON.stringify({target:a,name:S,type:"video-offer",offer:d[a].localDescription}))}catch{}}function H(){switch(d[a].iceConnectionState){case"closed":case"failed":case"disconnected":break}}function x(){}}async function o(a,s){await d[s].setRemoteDescription(new RTCSessionDescription(a)).catch(console.error)}async function i(a,s){d[s]||n(s),await d[s].setRemoteDescription(new RTCSessionDescription(a));let c=await d[s].createAnswer();await d[s].setLocalDescription(c),b?.send(JSON.stringify({target:s,name:S,type:"video-answer",answer:c}))}}var Ct={iceServers:["stun3.l.google.com:19302"].map(t=>({urls:`stun:${t}`}))};Ct.iceServers=[{urls:"stun:stun.stunprotocol.org:3478"},{urls:"stun:stun.l.google.com:19302"}];async function lr(t,e){let r=new RTCIceCandidate(t);await d[e].addIceCandidate(r)}async function un(){try{if(navigator.serviceWorker.onmessage=async t=>{let e=t.source;if(e!=null)switch(t.data.method){case"ipfs-message-port":let r=new MessageChannel;e.postMessage({method:"ipfs-message-port",id:t.data.id,port:r.port2},{transfer:[r.port2]})}},document.documentElement.dataset.viewer){await(async e=>{switch((e&&e.split("/")||[])[0]||""){case"ipfs":case"ipns":document.body.innerHTML=`<iframe id="viewer" style="width:100%;height:100%;position:fixed;top:0;left:0;border:none;" src="/view${e}"></iframe>`}})(location.pathname);return}}catch{}}l();var k={printR(t,e){if(e[t])return"";e[t]=!0;let r=k.data[k.hashMap[t]],n=r.code;return!r.deps||!r.deps.length?n:[...r.deps].map(a=>k.printR(a,e)).join(` 
 `)+`
    
    `+n},async toJs(t){let e=k.printR(t,{}),r=Object.keys(k.data).map(s=>[`"${k.hashMap[s]}"`,s.replace(/[^a-f]/g,"")]).map(s=>s[0]+": "+s[1]).join(`, 
 `),n=`
     ${e}
  function require(name){
    return ({${r}})[name];
  }
  globalThis.UMD_require = require;
  
     `,{transform:o}=await import("./chunk-esbuildEsm-Q5WDOJEJ.mjs"),i=await o(n,{format:"esm",minify:!0,keepNames:!0,platform:"browser",treeShaking:!0});return(await o(i.code,{format:"iife",minify:!0,keepNames:!0,platform:"browser",treeShaking:!0})).code},hashMap:{},data:{}},Ie=async(t,e)=>{let{transform:r}=await import("./chunk-esbuildEsm-Q5WDOJEJ.mjs"),n=C(t);if(k.hashMap={...k.hashMap,[n]:e,[e]:n},!k.data[n]){let o=await r(t,{format:"iife",keepNames:!0,treeShaking:!0,target:"es2018",loader:e.includes(".tsx")?"tsx":e.includes(".ts")?"ts":e.includes(".jsx")?"jsx":"js",globalName:n.replace(/[^a-f]/g,"")});if(!o||!o.code){console.log("transform result -code is empty");return}k.data={...k.data,[n]:{...o,deps:fr(o.code)}},await Promise.all(k.data[n].deps.map(async i=>{if(k.hashMap[i])return;let a=JSON.parse(document.querySelector("script[type=importmap]").innerHTML),s="",c="";if(a.imports[i])s=a.imports[i],c=C(i);else if(i.startsWith("./"))s=new URL(i,location.origin).toString(),c=C(i);else try{s=await import.meta.resolve(i,e),c=C(i)}catch{console.error(`failed to resolve: ${i}`);return}if(k.hashMap[c])return;k.hashMap[i]=s;let g=await(await fetch(s)).text();return Ie(g,i)}))}return k},fr=t=>{let e=/require\("(.+?)"\)/gm,r,n=[];for(;(r=e.exec(t))!==null;){r.index===e.lastIndex&&e.lastIndex++;for(let[o,i]of r.entries())o==1&&n.push(i),console.log(`Found match, group ${o}: ${i}`)}return n};l();F();F();var h={md5Hash:"",wait:1,res:null,codeSpace:"",waitForDiv:async()=>{let t=h.md5Hash;return h.res?.innerHTML||await St(),h.res?.innerHTML.includes(t)||await St(),h.res?.innerHTML.includes(t)||(console.log(`waiting ${h.wait} for ${h.md5Hash} `),await N(h.wait)),h.res?.innerHTML.includes(t)?h.res.innerHTML:(h.wait=h.wait*2,await h.waitForDiv())},setHash:null,setApp:t=>{let e=document.createElement("div");e.style.visibility="hidden",e.style.position="absolute",document.body.appendChild(e);let r=K(e);return r.render(f(ur,{md5Hash:t})),()=>{r.unmount,document.body.removeChild(e),e.remove(),delete T[t],h.setHash=null}}},kt=async(t,e)=>{h.codeSpace=e;let r=C(t).slice(0,8);T[r]||await J(t),h.wait=1;let n=h.setApp(r);try{let o=await h.waitForDiv();if(!o)return{html:null,css:null};let i=dr(V[r]),a=document.querySelector("style[data-emotion=z-global]")?.innerHTML;return{html:o,css:a+" "+i}}finally{n()}};function dr(t){let e=Object.keys(t.inserted).map(r=>`.${t.key}-${r}`);return Array.from(document.styleSheets).map(r=>r.cssRules[0]).filter(r=>r&&e.includes(r.selectorText)).map(r=>r.cssText).join(`
`)}var ur=({md5Hash:t})=>{let e=A(null),[r,n]=U(t);L(()=>{e?.current&&(h.res=e.current),h.md5Hash=r,h.setHash=i=>n(i)},[e,r,n]);let o=T[r];return f("div",{ref:e,children:f(o,{appId:`${h.codeSpace}-${r}`},r)})},St=()=>{let t;console.log("wait for animation");let e=new Promise(r=>t=r);return requestAnimationFrame(()=>t(!0)),e};var he={code:"",olderCode:""};async function Le({code:t,counter:e,codeSpace:r}){he.code=t;let n=p();if(console.log(`${n.i} => ${e}`),!(e<n.i)){setTimeout(()=>{he.code===t&&t!==he.olderCode&&Le({code:t,counter:e,codeSpace:r}),he.olderCode=t},1e3);try{let o=await Ze(t,{loader:"tsx",format:"esm",treeShaking:!0,minify:!0,keepNames:!0,tsconfigRaw:{compilerOptions:{jsx:"react-jsx",module:"ESNext",jsxFragmentFactory:"Fragment",jsxImportSource:"@emotion/react"}},target:"es2018"});Object.assign(globalThis,{umdExp:async()=>{console.log("to UMD");let u=await Ie(o.code,`${r}.tsx`);console.log({UMD:u}),H("coder.js",await u?.toJs(`${r}.tsx`));function H(x,v){var E=document.createElement("a");E.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(v)),E.setAttribute("download",x),E.style.display="none",document.body.appendChild(E),E.click(),document.body.removeChild(E)}}});let a=C(t).slice(0,8),s=`${o.code}//${a}`,{html:c,css:g}=await kt(s,r);if(console.log({html:c,css:g}),!c)return;ze({...p(),code:t,i:e,transpiled:s,html:c,css:g}),yt()}catch(o){console.error({error:o})}finally{}}}F();Y();l();function xt(){let t=/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.userAgent.indexOf("SAMSUNG")===-1,e=!1;return function(r){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[23]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(r.slice(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e&&!t}l();var _t=async t=>pr().prettierJs(t),Ae=null,Et={prettierJs:async t=>{let e=performance.now();Ae=Ae||(await import("./chunk-prettierEsm-Z7NIH6E6.mjs")).prettierJs;let r=performance.now();console.log(`importing took ${r-e} milliseconds.`);let n=Ae(t),o=performance.now();return console.log(`prettier took ${o-r} milliseconds.`),n}},G=null;function pr(){if(G)return G;if(!hr())return G=Et;try{let t=new SharedWorker(new URL("prettierWorker.mjs",location.origin),{type:"module"});return G=Je(t.port)}catch{return G=Et}}function hr(){let t=!1,e={get type(){return t=!0,"module"}};try{new Worker("blob://",e)}finally{return t}}var m={CH(){},getValue:async()=>"",setValue:async t=>{t.length<10&&console.log(t)},getErrors:async()=>[],code:"",counter:0,codeSpace:"",lastKeyDown:0,codeToSet:""},Pt=({codeSpace:t})=>{let e=A(null),{i:r,code:n}=p(),[o,i]=$.useState({lastKeyDown:0,myCode:n,counter:r,started:!1,onChange(u){},engine:xt()?"ace":"monaco"});m.counter=p().i,m.codeSpace=t;let{myCode:a,started:s,engine:c,onChange:g}=o;return m.code=a,$.useEffect(()=>{!e?.current||s||(c==="monaco"?mr():gr()).then(u=>Object.assign(m,u)).then(()=>i(u=>({...u,started:!0})))},[s,e]),$.useEffect(()=>{m.getErrors().then(console.log),g(()=>m.getValue().then(()=>i(u=>({...u,counter:m.counter,myCode:m.code}))))},[g,a,i]),I(()=>{m.counter>=p().i||(m.counter=p().i,m.code=p().code,m.setValue(m.code),i(u=>({...u,counter:m.counter,myCode:m.code})))},"editor"),f("div",{onKeyDown:()=>m.lastKeyDown=Date.now(),id:"editor",css:j`          
      max-width: 640px;
      height: 100%; 
      `,ref:e})};async function Rt(t){let e=await _t(t);if(e===m.code)return;let r=++m.counter;m.code=e,Le({code:e,counter:r,codeSpace:m.codeSpace})}async function mr(){let t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.href=location.origin+"/Editor.css",document.head.append(t);let{startMonaco:e}=await import("./chunk-startMonaco-GMPEUG5F.mjs"),r=window.document.getElementById("editor");return e({container:r,name:m.codeSpace,code:p().code,onChange:Rt})}async function gr(){let{startAce:t}=await import("./chunk-startAce-FV3SITGG.mjs");return await N(100),await t(p().code,Rt)}var wr=Xe(()=>N(1e3).then(()=>import("./chunk-DraggableWindow-L7IEUNLT.mjs"))),yr=({children:t})=>f("div",{css:j`
height: 100%;
width: 100%;
background-blend-mode: overlay;
background:  repeating-radial-gradient(circle at bottom left, 
              #fedc00 0, #fedc00 5.5555555556%, 
              #fcb712 0, #fcb712 11.1111111111%, 
              #f7921e 0, #f7921e 16.6666666667%, 
            #e87f24 0, #e87f24 22.2222222222%, 
            #dd6227 0, #dd6227 27.7777777778%,
             #dc4c27 0, #dc4c27 33.3333333333%, 
            #ca3435 0, #ca3435 38.8888888889%, 
            #b82841 0, #b82841 44.4444444444%, 
            #953751 0, #953751 50%, #364c88 0, 
            #364c88 55.5555555556%, #16599d 0, 
            #16599d 61.1111111111%, #02609e 0, 
            #02609e 66.6666666667%, #0073a9 0, 
            #0073a9 72.2222222222%, #008aa4 0, 
            #008aa4 77.7777777778%, #239a87 0, 
            #239a87 83.3333333333%, #7cba6d 0, 
            #7cba6d 88.8888888889%, #becc2f 0, 
            #becc2f 94.4444444444%, #e0d81d 0, 
            #e0d81d 100%), 
            repeating-radial-gradient(circle at bottom right, 
              #fedc00 0, #fedc00 5.5555555556%, 
              #fcb712 0, #fcb712 11.1111111111%, 
              #f7921e 0, #f7921e 16.6666666667%, 
              #e87f24 0, #e87f24 22.2222222222%, 
              #dd6227 0, #dd6227 27.7777777778%, 
              #dc4c27 0, #dc4c27 33.3333333333%, 
              #ca3435 0, #ca3435 38.8888888889%, 
              #b82841 0, #b82841 44.4444444444%, 
              #953751 0, #953751 50%,
               #364c88 0, #364c88 55.5555555556%, 
               #16599d 0, #16599d 61.1111111111%, 
               #02609e 0, #02609e 66.6666666667%, 
               #0073a9 0, #0073a9 72.2222222222%, 
               #008aa4 0, #008aa4 77.7777777778%,
                #239a87 0, #239a87 83.3333333333%, 
                #7cba6d 0, #7cba6d 88.8888888889%, 
                #becc2f 0, #becc2f 94.4444444444%, 
                #e0d81d 0, #e0d81d 100%);
`,children:t}),br=({codeSpace:t})=>{let e=_(),[r,n]=U(e),o=location.pathname.endsWith("public")||location.pathname.endsWith("hydrated");L(()=>{I(async()=>{let a=_();if(r!==a)try{await J(),n(a)}catch(s){console.error({e:s})}},"myApp")},[r,n]);let i=Ye(()=>nt({attributes:{id:`root-${t}`,style:"height: 100%"}}),[]);return R(ve,{children:[f(rt,{node:i,children:f(ut,{hash:r,codeSpace:t})}),o?f(Q,{node:i}):f(Ve,{fallback:f(Q,{node:i}),children:f(yr,{children:R(ve,{children:[f(Pt,{codeSpace:t}),f(wr,{room:t,children:f(Q,{node:i})})]})})})]})},Tt={started:!1},ft=({codeSpace:t})=>{if(Tt.started)return;Tt.started=!0;let e=document.querySelector("#root"),r=K(e),n=Z({key:"root"});r.render(f(X,{value:n,children:f(br,{codeSpace:t})}))};export{f as a,R as b,ft as c,P as d,ln as e,yt as f,fn as g,dn as h,bt as i,un as j,kt as k,Pt as l};
