import{diff as e}from"https://unpkg.com/@zedvision/diff@8.6.10/dist/diff.min.js";import t from"https://unpkg.com/prettier@2.2.1/esm/standalone.mjs";import n from"https://unpkg.com/prettier@2.2.1/esm/parser-babel.mjs";import r from"https://unpkg.com/prettier@2.2.1/esm/parser-html.mjs";import{motion as o}from"https://cdn.skypack.dev/framer-motion";import{jsx as i,css as s}from"https://cdn.skypack.dev/@emotion/react@11.1.4";import{getDB as a}from"https://unpkg.com/@zedvision/shadb@8.7.2/dist/shaDB.js";import c from"https://unpkg.com/uuid@8.3.2/dist/esm-browser/v4.js";import{wrap as u}from"https://unpkg.com/comlink/dist/esm/comlink.mjs";function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var l=function(e,t){if(void 0===t&&(t=[]),"https://"===e.slice(0,8))return window.document.head.querySelector('script[src="'+e+'"]')||new Promise(function(n,r){var o=window.document.createElement("script");o.src=e,o.type="application/javascript",o.onload=function(){0===t.length&&n(window);var e={};t.forEach(function(t){return Object.assign(e,window[t])}),n(e)},o.onerror=r,window.document.head.appendChild(o)})},m=function(){return"undefined"!=typeof window&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)},p={};function h(){var e,t,n=(e=["\n            background: red;\n            border: 4px solid red;\n            border-radius: 8px;\n          "],t||(t=e.slice(0)),e.raw=t,e);return h=function(){return n},n}var f,g,v,y=function(e){var t=e.onShare;return i("div",null,i(o.div,{css:s(h()),animate:{scale:1,top:1,left:600},dragElastic:.5,dragMomentum:!1,initial:{top:1,left:0,scale:.7},transition:{duration:.5},drag:!0,dragConstraints:{left:200-window.innerWidth,right:0,bottom:window.innerHeight-200,top:0}},i("div",{css:"\n      display: block;\n      with: 100%;\n      text-align: right;\n      background: linear-gradient(0deg, darkred, red);\n    "},i("button",{css:"\n              background: darkred;\n              margin-top: -4px;\n              margin-right: -4px;\n              color: white;\n              cursor: pointer;\n              font-weight: bold;\n              font-family: Roboto;\n              padding: 8px 16px;\n              outline: none;\n              border: none;\n              border-radius: 0px 8px 0px 0px;\n            ",onClick:function(){return t()}},"ðŸŒŽ SHARE")),i("div",{css:"\n      min-width: 200px;\n      padding: 30px;\n      max-width: 600px;\n      background: white;\n      max-height: 800px;\n      border-radius: 0px 0px 8px 8px;\n      overflow-y: overlay;\n    ",id:"zbody"})))},P=function(){try{var e=arguments,t=function(t){var n;return(n=f=t).get.apply(n,[].slice.call(e))},n=f;return Promise.resolve(n?t(n):Promise.resolve(a()).then(t))}catch(e){return Promise.reject(e)}},w=function(){try{var e=arguments,t=function(t){var n;return(n=f=t).put.apply(n,[].slice.call(e))},n=f;return Promise.resolve(n?t(n):Promise.resolve(a()).then(t))}catch(e){return Promise.reject(e)}},b=function(e){try{return Promise.resolve(crypto.subtle.digest("SHA-256","string"==typeof e?(new TextEncoder).encode(e):e)).then(function(e){return Array.from(new Uint8Array(e).slice(0,4)).map(function(e){return("00"+e.toString(16)).slice(-2)}).join("")})}catch(e){return Promise.reject(e)}},x={__proto__:null,sha256:b},j=function(e){try{return Promise.resolve(b(e)).then(function(t){return Promise.resolve(function(){try{return Promise.resolve(function(){try{return Promise.resolve(P("uuid")).then(function(e){var t,n=function(){if(!e)return Promise.resolve(fetch("https://code.zed.vision/register")).then(function(e){return Promise.resolve(e.json()).then(function(e){return Promise.resolve(w("uuid",e.uuid)).then(function(){return t=1,e.uuid})})})}();return n&&n.then?n.then(function(n){return t?n:e}):t?n:e})}catch(e){return Promise.reject(e)}}()).then(function(e){return Promise.resolve(P(e,"json")).then(function(t){var n;function r(e){return n?e:t.list}var o=function(){if("string"==typeof t||null===t||!t.list){var r,o=c();return Promise.resolve(w(e,JSON.stringify((r={list:[o]},r[o]={created:Date.now(),lastOpen:Date.now()},r)))).then(function(){return n=1,[o]})}}();return o&&o.then?o.then(r):r(o)})})}catch(e){return Promise.reject(e)}}()).then(function(n){var r=n[0],o=function(n,o){try{var i=Promise.resolve(P(r)).then(function(n){var o=function(){if(n!==t)return Promise.resolve(w(t,e)).then(function(){return Promise.resolve(w(r,t)).then(function(){})})}();if(o&&o.then)return o.then(function(){})})}catch(e){return o(e)}return i&&i.then?i.then(void 0,o):i}(0,function(e){console.error(e)});if(o&&o.then)return o.then(function(){})})})}catch(e){return Promise.reject(e)}},k=function(e,t){try{var n=function(n){return g=n,Promise.resolve(g(e,t))};return Promise.resolve(g?n(g):Promise.resolve(S()).then(n))}catch(e){return Promise.reject(e)}};function S(){var e=new Worker("./src/transpile.worker.js");return g=u(e)}function E(){var e=new Worker("./src/ipfsKV.worker.js");return v=u(e)}S(),E();var T=function(e,t){try{return Promise.resolve(function(e){try{var t=function(t){return t.add(e)};return Promise.resolve(v?t(v):Promise.resolve(E()).then(t))}catch(e){return Promise.reject(e)}}(URL.createObjectURL(new Blob([e],{type:t})))).then(function(e){return"https://ipfs.io/ipfs/"+e})}catch(e){return Promise.reject(e)}};function M(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}var O=function(t){void 0===t&&(t="window");try{return console.log("Runnnner"),Promise.resolve(getCodeToLoad()).then(function(n){return D.code=L(n),Promise.resolve(k(D.code)).then(function(n){function r(){return"window"===t&&ReactDOM.render(i(y,{onShare:function(){try{return Promise.resolve(function(e){var t=e.code,n=e.HTML;try{var r=M(t);return Promise.resolve(import(r)).then(function(e){var r=Array.from(window.document.querySelector("head > style[data-emotion=css]").sheet.cssRules).map(function(e){return e.cssText}).filter(function(e){return n.includes(e.substring(3,8))}).join("\n  ");return Promise.resolve(import("./templates-7751cd86.js")).then(function(e){var o=e.getHtml,i=e.getCodeForImport;return Promise.resolve(T(t,"application/html")).then(function(e){return console.log({HTML:n,linkToCode:e,css:r,code:t}),Promise.resolve((s=o({HTML:n,css:r,js:i(e)}),T(s,"text/html")));var s})})})}catch(e){return Promise.reject(e)}}({code:D.transpiled,HTML:D.HTML})).then(function(e){window.open(e)})}catch(e){return Promise.reject(e)}}}),window.document.getElementById("dragabbleWindow")),Promise.resolve(k(D.code)).then(function(n){var r=function(e){try{if("string"!=typeof e||""===e)return Promise.resolve(1);var n="window"===t?e.replace("body{","#zbody{"):e,r=window.document.getElementById("zbody");return Promise.resolve(import(M(n))).then(function(e){return ReactDOM.render((0,e.default)(),r),D.HTML=r.innerHTML,!D.preRendered})}catch(e){return Promise.reject(e)}};return r(n),Promise.resolve(function(e){var t=e.onChange,n=e.code,r=e.language,o=e.options;try{var i=function(){return Promise.resolve(function(){try{return Promise.resolve(l("https://unpkg.com/monaco-editor@0.21.2/min/vs/loader.js")).then(function(e){var t=e.require;return t.config({paths:{vs:"https://unpkg.com/monaco-editor@0.21.2/min/vs"}}),Promise.resolve(new Promise(function(e){return t(["vs/editor/editor.main"],function(t){return e(t)})}))})}catch(e){return Promise.reject(e)}}()).then(function(e){function i(){var i={monaco:e,editor:e.editor.create(window.document.getElementById("container"),d({formatOnType:!1,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,glyphMargin:!1,wordWrap:"off",mouseWheelZoom:!1,wordWrapColumn:80,useTabStops:!1,dragAndDrop:!1,disableLayerHinting:!0,formatOnPaste:!1,disableMonospaceOptimizations:!0,showUnused:!0,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"full",accessibilitySupport:"off",autoClosingQuotes:"beforeWhitespace",padding:{bottom:300},lineNumbers:"on",autoClosingBrackets:"beforeWhitespace",autoClosingOvertype:"auto",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!1,codeActionsOnSaveTimeout:100,model:a,value:n,language:r,theme:"vs-dark"},o))};return function(){if(m()&&(i.editor.onDidChangeModelContent(function(){return t(i.editor.getValue())}),p&&p.session.on("change",function(){var e=p.getValue();i.editor.setValue(e),t(e)}),p&&s.getElementById("container").replaceWith(s.getElementById("ace"))),i.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),"typescript"===r){var e=[{name:"react",url:"https://unpkg.com/@types/react@17.0.0/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@17.0.0/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@17.0.0/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@3.0.5/index.d.ts",depend:[]},{name:"@emotion/styled/base.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/styled/index.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/cache/index.d.ts",url:"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts",depend:["@emotion/utils"]},{name:"@emotion/react/index.d.ts",url:"https://unpkg.com/@emotion/react@11.1.3/types/index.d.ts",depend:["@emotion/cache"]},{name:"@emotion/react/jsx-namespace.d.ts",url:"https://unpkg.com/@emotion/react@11.1.3/types/jsx-namespace.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/css-prop.d.ts",url:"https://unpkg.com/@emotion/react@11.1.3/types/css-prop.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/helper.d.ts",url:"https://unpkg.com/@emotion/react@11.1.3/types/helper.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/theming.d.ts",url:"https://unpkg.com/@emotion/react@11.1.3/types/theming.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/serialize/index.d.ts",url:"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/utils/index.d.ts",url:"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts",depend:[]},{name:"framer-motion",url:"https://unpkg.com/framer-motion@3.1.1/dist/framer-motion.d.ts",depend:[]},{name:"popmotion",url:"https://unpkg.com/popmotion@9.0.2/lib/index.d.ts"},{name:"@zedvision/qrious/index.d.ts",url:"https://unpkg.com/@zedvision/qrious@8.5.7/dist/qrious.d.ts"}].map(function(e){var t=e.name,n=e.url;return function(){try{var e=i.monaco.languages.typescript.typescriptDefaults,r=e.addExtraLib;return Promise.resolve(fetch(n)).then(function(n){return Promise.resolve(n.text()).then(function(n){return r.call(e,n,t.includes("@")?"file:///node_modules/"+t:"file:///node_modules/@types/"+t+"/index.d.ts")})})}catch(e){return Promise.reject(e)}}()});return i.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:i.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:i.monaco.languages.typescript.ModuleResolutionKind.Nodejs,module:i.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:"react-jsx",esModuleInterop:!0}),Promise.resolve(Promise.all(e)).then(function(){return i.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),i})}}()}var a,u=function(t,r){try{var o=void((a=e.editor.getModel(c)).getValue()!==n&&a.setValue(n))}catch(e){return r()}return o&&o.then?o.then(void 0,r):o}(0,function(){return Promise.resolve(e.editor.createModel(n,r,e.Uri.parse(c))).then(function(e){a=e})});return u&&u.then?u.then(i):i()})},s=window.document,a=s.getElementById("container");a||((a=s.createElement("container")).id="container",s.body.appendChild(a));var c="typescript"===r?"file:///main.tsx":"file:///main.html",u=function(){if(m()){var e=window.document.createElement("div");return window.document.body.appendChild(e),e.id="ace",Promise.resolve(l("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js")).then(function(){return Promise.resolve(l("typescript"===r?"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js":"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.min.js")).then(function(e){return Promise.resolve(l("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js")).then(function(){window.document.getElementById("ace").style.setProperty("display","block"),a.style.setProperty("display","none"),(p=window.ace.edit("ace")).getSession().setMode("ace/mode/typescript"),function e(t){return setTimeout(function(){var n=(void 0).edit("ace");"ace/theme/monokai "!==n.getTheme()&&(n.setOptions({fontSize:"14pt"}),n.setTheme("ace/theme/monokai"),e(2*t))},t)}(100),p&&p.setValue(n),p&&p.blur()})})})}}();return Promise.resolve(u&&u.then?u.then(i):i())}catch(e){return Promise.reject(e)}}({language:"typescript",code:L(D.code),onChange:function(t){return function(t){try{return Promise.resolve(function(n,o){try{var i=Promise.resolve(k(t,D.lastErrors)).then(function(n){if(D.transpiled!==n){var o=!1;n.length&&0===D.lastErrors&&(o=r(n));var i=o?[{messageText:"Error while starting the app. Check the console!"}]:[];return Promise.resolve(function(e){try{if(!modules||!modules.monaco)return Promise.resolve();var t=modules.monaco;return Promise.resolve(Promise.resolve().then(function(){return x})).then(function(n){return Promise.resolve((0,n.sha256)(e)).then(function(n){function r(e){return Promise.resolve(t.languages.typescript.getTypeScriptWorker()).then(function(t){return Promise.resolve(t(e.uri)).then(function(t){var n=t.getSemanticDiagnostics(o),r=t.getCompilerOptionsDiagnostics(o),i=t.getSyntacticDiagnostics(o);return Promise.resolve(Promise.race([n,r,i])).then(function(t){return e.dispose(),[].concat(t)})})})}var o="file:///"+n+".tsx",i=t.Uri.parse(o),s=t.editor.getModel(i);return s?r(s):Promise.resolve(t.editor.createModel(e,"typescript",i)).then(r)})})}catch(e){return Promise.reject(e)}}(t)).then(function(o){var s;function a(e){if(s)return e;u.style.display="none",modules.monaco.editor.setTheme("vs-dark")}var c=[].concat(i,o);D.lastErrors&&0===c.length&&r(n),D.lastErrors=c.length;var u=window.document.getElementById("error"),d=function(){if(0===c.length&&n.length){var r=function(){return Promise.resolve(j(t)).then(function(){})};D.code=t;var o=function(){if(D.transpiled!==n)return D.transpiled=n,Promise.resolve(j(L(t))).then(function(){})}();return o&&o.then?o.then(r):r()}return D.error=t,Promise.resolve(e(D.code,t)).then(function(e){return e.c.length<=3?(D.lastErrors=0,void(s=1)):4==e.c.length?(D.lastErrors=0,modules.monaco.editor.setTheme("hc-black"),void(s=1)):(u.innerHTML=c[0].messageText.toString(),u.style.display="block",void(s=1))})}();return d&&d.then?d.then(a):a(d)})}})}catch(e){return o(e)}return i&&i.then?i.then(void 0,o):i}(0,function(e){modules.monaco.editor.setTheme("vs-light"),setTimeout(function(){modules.monaco.editor.setTheme("hc-black")},50),console.error(e)}))}catch(e){return Promise.reject(e)}}(L(t))}})).then(function(){})})}D.transpiled=n;var o=function(){if("editor"===t)return Promise.resolve(import("./DraggableEditor-f7ed8817.js")).then(function(e){return Promise.resolve((0,e.renderDraggableEditor)()).then(function(){})})}();return o&&o.then?o.then(r):r()})})}catch(e){return Promise.reject(e)}},D={hydrated:!1,preRendered:!1,lastErrors:0,HTML:"",ipfs:0,transpiled:"",code:""};function L(e){try{return t.format(e,{arrowParens:"always",bracketSpacing:!0,embeddedLanguageFormatting:"auto",htmlWhitespaceSensitivity:"css",insertPragma:!1,jsxBracketSameLine:!0,jsxSingleQuote:!1,printWidth:80,proseWrap:"preserve",quoteProps:"as-needed",requirePragma:!1,semi:!0,singleQuote:!0,tabWidth:2,trailingComma:"all",useTabs:!1,parser:"babel-ts",plugins:[n,r]})}catch(t){return e}}export{O as run};
//# sourceMappingURL=codeLoader.min.esm.js.map
