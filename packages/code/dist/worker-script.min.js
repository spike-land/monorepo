var SHATEST,API_KEY;const corsHeaders={"Access-Control-Allow-Origin":"https://zed.vision","Access-Control-Allow-Methods":"GET,HEAD,POST,OPTIONS","Access-Control-Max-Age":"86400"};function handleOptions(e){const n=e.headers;let s={...n,...corsHeaders,"Access-Control-Allow-Headers":e.headers.get("Access-Control-Request-Headers")};return new Response(e.body,{headers:s})}self.runner=self.runner||"worker-cf";async function handleCloudRequest(e){if(e.method==="GET"){const n=new URL(e.url);if(e.url.includes("?h")){const s=n.searchParams.get("h");if(s!==null){const t=await SHATEST.get(s,"stream");if(t!==null)return new Response(t,{headers:{"content-type":"text/javascript"}})}}if(e.url.includes("?r")){const s=n.searchParams.get("r");if(s!==null){const t=await SHATEST.get(s,"stream");if(t!==null)return new Response(t,{headers:{"content-type":"text/html"}})}}return Response.redirect("https://zed.vision/code",301)}else if(e.method==="POST"){const n=e.headers.get("API_KEY");if(n){if(n!==API_KEY)return new Response("Sorry, you have supplied an invalid key.",{status:403});const o=await e.json();return new Response("NOT implemented yet."+JSON.stringify(o),{status:404})}const s=await e.arrayBuffer(),t=await crypto.subtle.digest({name:"SHA-256"},s),c=Array.from(new Uint8Array(t)),i=c.map(o=>("00"+o.toString(16)).slice(-2)).join(""),a=i.substring(0,8);await SHATEST.put(a,s);const r=new Response(`{"hash":"${a}"}`);return r.headers.append("Access-Control-Allow-Origin","https://zed.vision"),r.headers.append("Access-Control-Allow-Methods","GET,HEAD,POST,OPTIONS"),r.headers.append("Access-Control-Max-Age","86400"),r}return handleOptions(e)}addEventListener("fetch",e=>{if(self.runner!=="worker-cf")return;e.respondWith(handleCloudRequest(e.request))});
