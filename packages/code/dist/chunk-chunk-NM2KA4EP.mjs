import{a as Ye}from"./chunk-chunk-MFZRRRQA.mjs";import{a as f,b as P,c as ve}from"./chunk-chunk-ZTWXNM3U.mjs";import{b as Nt}from"./chunk-chunk-KW2DITXL.mjs";import{a as X,h as M,p as Ce}from"./chunk-chunk-UNVWRENN.mjs";import{a as Ht,b as v,e as _,f as p,g as ge,h as I,i as we,j as ye,k as Ae,l as Ue}from"./chunk-chunk-L2U7Q2OG.mjs";import{b as $e}from"./chunk-chunk-66EYGUWD.mjs";import{B as A,C as U,H as K,K as Xe,L as $,N as F,a as ze,d as be,f as Je,g as We,i as Ve,k as qe,m as Be,n as Ge,u as L,z as Ke}from"./chunk-chunk-FVOCI6BE.mjs";import{b as Mt,d as me,j as l}from"./chunk-chunk-FWOMBYHR.mjs";var it=Mt((Rr,at)=>{"use strict";l();var ot=Function.prototype.toString,z=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Re,Z;if(typeof z=="function"&&typeof Object.defineProperty=="function")try{Re=Object.defineProperty({},"length",{get:function(){throw Z}}),Z={},z(function(){throw 42},null,Re)}catch(t){t!==Z&&(z=null)}else z=null;var Lt=/^\s*class\b/,Pe=function(e){try{var r=ot.call(e);return Lt.test(r)}catch{return!1}},_e=function(e){try{return Pe(e)?!1:(ot.call(e),!0)}catch{return!1}},ee=Object.prototype.toString,At="[object Object]",Ut="[object Function]",$t="[object GeneratorFunction]",zt="[object HTMLAllCollection]",Jt="[object HTML document.all class]",Wt="[object HTMLCollection]",Vt=typeof Symbol=="function"&&!!Symbol.toStringTag,qt=!(0 in[,]),Te=function(){return!1};typeof document=="object"&&(nt=document.all,ee.call(nt)===ee.call(document.all)&&(Te=function(e){if((qt||!e)&&(typeof e>"u"||typeof e=="object"))try{var r=ee.call(e);return(r===zt||r===Jt||r===Wt||r===At)&&e("")==null}catch{}return!1}));var nt;at.exports=z?function(e){if(Te(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{z(e,null,Re)}catch(r){if(r!==Z)return!1}return!Pe(e)&&_e(e)}:function(e){if(Te(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(Vt)return _e(e);if(Pe(e))return!1;var r=ee.call(e);return r!==Ut&&r!==$t&&!/^\[object HTML/.test(r)?!1:_e(e)}});l();F();F();l();F();F();var Qe=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Se="html",ke="svg",Dt="http://www.w3.org/2000/svg",Ot=function(t,e){if(e===Se)return t instanceof HTMLElement;if(e===ke)return t instanceof SVGElement;throw new Error('Unrecognized element type "'+e+'" for validateElementType.')},Ze=function(t,e){var r={},n,o,i;if(t===Se)i=document.createElement("div");else if(t===ke)i=document.createElementNS(Dt,"g");else throw new Error('Invalid element type "'+t+'" for createPortalNode: must be "html" or "svg".');if(e&&typeof e=="object")for(var a=0,s=Object.entries(e.attributes);a<s.length;a++){var c=s[a],g=c[0],u=c[1];i.setAttribute(g,u)}var N={element:i,elementType:t,setPortalProps:function(x){r=x},getInitialPortalProps:function(){return r},mount:function(x,b){if(b!==o){if(N.unmount(),x!==n&&!Ot(x,t))throw new Error('Invalid element type for portal: "'+t+'" portalNodes must be used with '+t+" elements, but OutPortal is within <"+x.tagName+">.");x.replaceChild(N.element,b),n=x,o=b}},unmount:function(x){x&&x!==o||n&&o&&(n.replaceChild(o,N.element),n=void 0,o=void 0)}};return N},et=function(t){Qe(e,t);function e(r){var n=t.call(this,r)||this;return n.addPropsChannel=function(){Object.assign(n.props.node,{setPortalProps:function(o){n.setState({nodeProps:o})}})},n.state={nodeProps:n.props.node.getInitialPortalProps()},n}return e.prototype.componentDidMount=function(){this.addPropsChannel()},e.prototype.componentDidUpdate=function(){this.addPropsChannel()},e.prototype.render=function(){var r=this,n=this.props,o=n.children,i=n.node;return Xe(ze.map(o,function(a){return Be(a)?We(a,r.state.nodeProps):a}),i.element)},e}(be),Y=function(t){Qe(e,t);function e(r){var n=t.call(this,r)||this;return n.placeholderNode=qe(),n.passPropsThroughPortal(),n}return e.prototype.passPropsThroughPortal=function(){var r=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(r)},e.prototype.componentDidMount=function(){var r=this.props.node;this.currentPortalNode=r;var n=this.placeholderNode.current,o=n.parentNode;r.mount(o,n),this.passPropsThroughPortal()},e.prototype.componentDidUpdate=function(){var r=this.props.node;this.currentPortalNode&&r!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode.setPortalProps({}),this.currentPortalNode=r);var n=this.placeholderNode.current,o=n.parentNode;r.mount(o,n),this.passPropsThroughPortal()},e.prototype.componentWillUnmount=function(){var r=this.props.node;r.unmount(this.placeholderNode.current),r.setPortalProps({})},e.prototype.render=function(){return Ve("div",{ref:this.placeholderNode})},e}(be),tt=Ze.bind(null,Se),yr=Ze.bind(null,ke);l();F();l();F();var xe=class extends $.Component{constructor(e){super(e),this.state={error:void 0,errorInfo:void 0}}componentDidCatch(e,r){this.setState({error:e,errorInfo:r})}render(){return this.state.errorInfo?P("div",{children:[f("h2",{children:"Something went wrong."}),P("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),f("br",{}),this.state.errorInfo.componentStack]})]}):this.props.children}},rt=xe;Ce();l();var Ee=me(Nt(),1),It=Ee.default.default||Ee.default,Q=It;var lt=me(it(),1);var Bt=t=>window.importShim?window.importShim(t):import(t);Object.assign(globalThis,{apps:{},eCaches:{}});var{apps:T,eCaches:V}=globalThis||globalThis.apps,ft=({hash:t,codeSpace:e})=>{let[r,n]=U(v(p().transpiled).slice(0,8));L(()=>{let s=v(p().transpiled).slice(0,8);s!==r&&n(s)},[t]);let o=A(null),i=p().transpiled,a=T[v(i).slice(0,8)];return f(rt,{ref:o,children:f(a,{appId:`${e}-${r}`})},r)},st=!1;async function J(t="",e){let{transpiled:r,i:n}=p(),o=t.length>0?t:r,i=v(o).slice(0,8);if(!T[i])try{console.log(`i: ${n}: `);let a=(await Bt(Gt(o))).default;if((0,lt.default)(a))V[i]=Q({key:"z",speedy:!1}),V[i].compat=void 0,T[i]=({appId:s})=>s.includes(i)?f(X,{value:V[i],children:f("div",{css:M`height: 100%;`,id:s,children:f(a,{})})}):null;else throw new Error("the default export is not a function!")}catch(a){if(a instanceof SyntaxError){let s=a.name,c=a.message;T[i]=()=>P("div",{css:M`background-color: orange;`,children:[f("h1",{children:"Syntax Error"}),P("h2",{children:[s,": ",c]}),f("p",{children:JSON.stringify({err:a})})]})}else if(a instanceof Error){let s=a.name,c=a.message;T[i]=()=>P("div",{css:M`background-color: orange;`,children:[f("h1",{children:"Syntax Error"}),P("h2",{children:[s,": ",c]}),f("p",{children:JSON.stringify({err:a})})]})}else T[i]=()=>f("div",{css:M`background-color: orange;`,children:P("h1",{children:["Unknown Error: $",i]})})}return!st&&e&&(st=!0,await ct({codeSpace:e})),T[i]}function Gt(t,e="index.mjs"){let r=new File([t],e,{type:"application/javascript",lastModified:Date.now()});return URL.createObjectURL(r)}Ce();l();F();l();l();var Ne=me(Ht(),1);l();l();function dt(t,e=r=>r.key){var r=[];return Fe(t,"",!0,n=>r.push(n),e),r.join("")}function Fe(t,e,r,n,o){if(t){n(`${e}${r?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 "}${o(t)}
`);let i=e+(r?"    ":"\u2502   ");t.left&&Fe(t.left,i,!1,n,o),t.right&&Fe(t.right,i,!0,n,o)}}function te(t){if(t===null)return!0;var e=re(t.left),r=re(t.right);return!!(Math.abs(e-r)<=1&&te(t.left)&&te(t.right))}function re(t){return t?1+Math.max(re(t.left),re(t.right)):0}function ne(t,e,r,n,o){let i=o-n;if(i>0){let a=n+Math.floor(i/2),s=e[a],c=r[a],g={key:s,data:c,parent:t};return g.left=ne(g,e,r,n,a),g.right=ne(g,e,r,a+1,o),g}return null}function oe(t){if(t===null)return 0;let e=oe(t.left),r=oe(t.right);return t.balanceFactor=e-r,Math.max(e,r)+1}function ae(t,e,r,n,o){if(r>=n)return;let i=t[r+n>>1],a=r-1,s=n+1;for(;;){do a++;while(o(t[a],i)<0);do s--;while(o(t[s],i)>0);if(a>=s)break;let c=t[a];t[a]=t[s],t[s]=c,c=e[a],e[a]=e[s],e[s]=c}ae(t,e,r,s,o),ae(t,e,s+1,n,o)}function Kt(t,e){return t>e?1:t<e?-1:0}function ie(t){var e=t.right;return t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent,e.parent&&(e.parent.left===t?e.parent.left=e:e.parent.right=e),t.parent=e,e.left=t,t.balanceFactor+=1,e.balanceFactor<0&&(t.balanceFactor-=e.balanceFactor),e.balanceFactor+=1,t.balanceFactor>0&&(e.balanceFactor+=t.balanceFactor),e}function se(t){var e=t.left;return t.left=e.right,t.left&&(t.left.parent=t),e.parent=t.parent,e.parent&&(e.parent.left===t?e.parent.left=e:e.parent.right=e),t.parent=e,e.right=t,t.balanceFactor-=1,e.balanceFactor>0&&(t.balanceFactor-=e.balanceFactor),e.balanceFactor-=1,t.balanceFactor<0&&(e.balanceFactor+=t.balanceFactor),e}var D=class{constructor(e,r=!1){this._comparator=e||Kt,this._root=null,this._size=0,this._noDuplicates=!!r}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(e){if(this._root)for(var r=this._root,n=this._comparator;r;){var o=n(e,r.key);if(o===0)return!0;o<0?r=r.left:r=r.right}return!1}next(e){var r=e;if(r)if(r.right)for(r=r.right;r.left;)r=r.left;else for(r=e.parent;r&&r.right===e;)e=r,r=r.parent;return r}prev(e){var r=e;if(r)if(r.left)for(r=r.left;r.right;)r=r.right;else for(r=e.parent;r&&r.left===e;)e=r,r=r.parent;return r}forEach(e){for(var r=this._root,n=[],o=!1,i=0;!o;)r?(n.push(r),r=r.left):n.length>0?(r=n.pop(),e(r,i++),r=r.right):o=!0;return this}range(e,r,n,o){let i=[],a=this._comparator,s=this._root,c;for(;i.length!==0||s;)if(s)i.push(s),s=s.left;else{if(s=i.pop(),c=a(s.key,r),c>0)break;if(a(s.key,e)>=0&&n.call(o,s))return this;s=s.right}return this}keys(){for(var e=this._root,r=[],n=[],o=!1;!o;)e?(r.push(e),e=e.left):r.length>0?(e=r.pop(),n.push(e.key),e=e.right):o=!0;return n}values(){for(var e=this._root,r=[],n=[],o=!1;!o;)e?(r.push(e),e=e.left):r.length>0?(e=r.pop(),n.push(e.data),e=e.right):o=!0;return n}at(e){for(var r=this._root,n=[],o=!1,i=0;!o;)if(r)n.push(r),r=r.left;else if(n.length>0){if(r=n.pop(),i===e)return r;i++,r=r.right}else o=!0;return null}minNode(){var e=this._root;if(!e)return null;for(;e.left;)e=e.left;return e}maxNode(){var e=this._root;if(!e)return null;for(;e.right;)e=e.right;return e}min(){var e=this._root;if(!e)return null;for(;e.left;)e=e.left;return e.key}max(){var e=this._root;if(!e)return null;for(;e.right;)e=e.right;return e.key}isEmpty(){return!this._root}pop(){var e=this._root,r=null;if(e){for(;e.left;)e=e.left;r={key:e.key,data:e.data},this.remove(e.key)}return r}popMax(){var e=this._root,r=null;if(e){for(;e.right;)e=e.right;r={key:e.key,data:e.data},this.remove(e.key)}return r}find(e){for(var r=this._root,n=r,o,i=this._comparator;n;){if(o=i(e,n.key),o===0)return n;o<0?n=n.left:n=n.right}return null}insert(e,r){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:e,data:r},this._size++,this._root;var n=this._comparator,o=this._root,i=null,a=0;if(this._noDuplicates)for(;o;){if(a=n(e,o.key),i=o,a===0)return null;a<0?o=o.left:o=o.right}else for(;o;)a=n(e,o.key),i=o,a<=0?o=o.left:o=o.right;var s={left:null,right:null,balanceFactor:0,parent:i,key:e,data:r},c;for(a<=0?i.left=s:i.right=s;i&&(a=n(i.key,e),a<0?i.balanceFactor-=1:i.balanceFactor+=1,i.balanceFactor!==0);){if(i.balanceFactor<-1){i.right.balanceFactor===1&&se(i.right),c=ie(i),i===this._root&&(this._root=c);break}else if(i.balanceFactor>1){i.left.balanceFactor===-1&&ie(i.left),c=se(i),i===this._root&&(this._root=c);break}i=i.parent}return this._size++,s}remove(e){if(!this._root)return null;for(var r=this._root,n=this._comparator,o=0;r&&(o=n(e,r.key),o!==0);)o<0?r=r.left:r=r.right;if(!r)return null;var i=r.key,a,s;if(r.left){for(a=r.left;a.left||a.right;){for(;a.right;)a=a.right;r.key=a.key,r.data=a.data,a.left&&(r=a,a=a.left)}r.key=a.key,r.data=a.data,r=a}if(r.right){for(s=r.right;s.left||s.right;){for(;s.left;)s=s.left;r.key=s.key,r.data=s.data,s.right&&(r=s,s=s.right)}r.key=s.key,r.data=s.data,r=s}for(var c=r.parent,g=r,u;c&&(c.left===g?c.balanceFactor-=1:c.balanceFactor+=1,c.balanceFactor<-1?(c.right.balanceFactor===1&&se(c.right),u=ie(c),c===this._root&&(this._root=u),c=u):c.balanceFactor>1&&(c.left.balanceFactor===-1&&ie(c.left),u=se(c),c===this._root&&(this._root=u),c=u),!(c.balanceFactor===-1||c.balanceFactor===1));)g=c,c=c.parent;return r.parent&&(r.parent.left===r?r.parent.left=null:r.parent.right=null),r===this._root&&(this._root=null),this._size--,i}load(e=[],r=[],n){if(this._size!==0)throw new Error("bulk-load: tree is not empty");let o=e.length;return n&&ae(e,r,0,o-1,this._comparator),this._root=ne(null,e,r,0,o),oe(this._root),this._size=o,this}isBalanced(){return te(this._root)}toString(e){return dt(this._root,e)}};D.default=D;l();var ce,Xt=new Uint8Array(16);function Yt(){if(!ce&&(ce=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!ce))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ce(Xt)}var Qt=/^(?:[\da-f]{8}-[\da-f]{4}-[1-5][\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}|0{8}-(?:0{4}-){3}0{12})$/i;function Zt(t){return typeof t=="string"&&Qt.test(t)}var w=[];for(let t=0;t<256;++t)w.push((t+256).toString(16).slice(1));function er(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(w[t[e+0]]+w[t[e+1]]+w[t[e+2]]+w[t[e+3]]+"-"+w[t[e+4]]+w[t[e+5]]+"-"+w[t[e+6]]+w[t[e+7]]+"-"+w[t[e+8]]+w[t[e+9]]+"-"+w[t[e+10]]+w[t[e+11]]+w[t[e+12]]+w[t[e+13]]+w[t[e+14]]+w[t[e+15]]).toLowerCase();if(!Zt(r))throw new TypeError("Stringified UUID is invalid");return r}function ut(t,e,r){t=t||{};let n=t.random||(t.rng||Yt)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(let o=0;o<16;++o)e[r+o]=n[o];return e}return er(n)}l();async function j(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}var tr=new D((t,e)=>t===e?0:t<e?1:-1,!0),de=[],S=(self&&self.crypto&&self.crypto.randomUUID&&self.crypto.randomUUID()||ut()).slice(0,8);tr.insert(S);var d={},q,H,pt="",W=0,le=0,ht=0,je=0,y=null,mt,O=!1,ue={},R={localStream:null,webRtcArray:de,tracks:ue,user:S,rtcConns:d,send(t){let e=JSON.stringify({...t,name:t.name||S});de.map(r=>{try{if(r.readyState!=="open")return;(!t.target||r.target===t.target&&!B.includes(r.target))&&r.send(e)}catch{}})}};Object.assign(globalThis,{sendChannel:R});var en=async t=>{let{mST:e,address:r}=t;H=t.codeSpace,q=new BroadcastChannel(location.origin),!(location.pathname.endsWith("dehydrated")&&(q.onmessage=n=>{n.data.codeSpace===H&&console.log(n.data)}))&&(Ae(H,{name:S,state:e},location.origin),await J(e.transpiled,H),await wt(),q=new BroadcastChannel(location.origin),q.onmessage=async n=>{if(!(n.data.ignoreUser&&n.data.ignoreUser===S)&&(n.data.codeSpace===H&&n.data.address&&!r&&y?.send(JSON.stringify({codeSpace:H,address:n.data.address})),n.data.ignoreUser&&!B.includes(n.data.ignoreUser)&&B.push(n.data.ignoreUser),n.data.codeSpace===H&&n.data.sess.code!==p().code)){let o=await ye(n.data.sess);await ge(o)}},I(()=>{let n=p(),o=v(JSON.stringify(n));o!==pt&&(pt=o,q.postMessage({ignoreUser:S,sess:n,codeSpace:H,address:r}))},"broadcast"))},Me=null;async function fe(){return!O||y===null?(y=null,await wt()):y}var B=[];function gt(){nr(),rr()}var rr=(0,Ne.default)(ar,100,{trailing:!0,leading:!0,maxWait:500}),nr=(0,Ne.default)(or,1200,{trailing:!0,leading:!0,maxWait:2500});async function or(){try{if(y){if(W===_())return;let t=p(),e=await we(W,t);if(!e||e.newHash!==_())return;let r=JSON.stringify({...e,name:S});mt(r)}else O=!1,await fe()}catch{}}var tn=async()=>{!R.localStream||R.localStream.getTracks().map(t=>t.stop())},rn=async t=>{let e={audio:!0,video:!0},r=await navigator.mediaDevices.getUserMedia(e);t.srcObject=r,r.getTracks().forEach(n=>Object.keys(R.rtcConns).map(o=>{let i=R.rtcConns[o];i.addTrack(n),i.ontrack=({track:a,streams:s})=>ue[o]={track:a,streams:s}}))};async function ar(){try{if(Object.keys(d).length>0){if(le===_())return;let t=p(),e=le?await we(le,t):await ye(t);e&&e.patch&&R.send(e)}}catch{}}async function wt(){if(y!==null)return y;if(O=!0,location.origin.includes("localhost"))return;let t=new WebSocket(`wss://${location.host}/live/`+H+"/websocket");return O=!1,t.addEventListener("open",()=>{y=t,mt=n=>{try{y&&y?.send&&y?.send(n)}catch{y=null,O=!1,fe()}};let r=Object.assign(t,{hashCode:_()});return y.addEventListener("message",n=>yt(n,"ws",r)),Me&&clearInterval(Me),Me=setInterval(()=>{let o=Date.now()-je;if(o>4e4)try{if(t.readyState===t.OPEN){t?.send(JSON.stringify({name:S,timestamp:ht+o}));return}O=!1,fe()}catch{O=!1,fe()}},3e4),t.send(JSON.stringify({name:S})),t}),t}var He={};async function yt(t,e,r){if(y==null)return;je=Date.now();let n=JSON.parse(t.data);ir(n,e,r)}async function ir(t,e,r){if(e==="ws"&&t.timestamp&&(je=Date.now(),ht=t.timestamp),(t.hashCode||t.newHash&&r)&&(r.hashCode=t.hashCode||t.newHash),e==="ws"&&t.hashCode&&(W=t.hashCode),e==="ws"&&t.hashCode&&(W=t.hashCode),(e==="rtc"&&t.hashCode||t.newHash)&&(le=t.hashCode||t.newHash),B.includes(t.name)||t.newHash===_())return;if(t.oldHash&&t.newHash){if(He[t.oldHash]&&He[t.oldHash]===t.newHash)return;He[t.oldHash]=t.newHash}if(t.newHash===_())return;if((async()=>{try{if(t.type==="new-ice-candidate"){await sr(t.candidate,t.name);return}if(t.type==="video-offer"){await i(t.offer,t.name);return}if(t.type==="video-answer"){await o(t.answer,t.name);return}if(t.name&&t.name!==S&&!d[t.name]&&!B.includes(t.name)){await n(t.name);let a=t.users;for(;a.length;){await j(2e3);let s=a.pop();s&&!R.rtcConns[s]&&await n(s)}return}}catch{}})(),t.patch&&t.name!==S){if(t.newHash===_())return;if(await ge(t),t.newHash===_()){R&&R.send({hashCode:t.newHash});return}return}if(t.patch&&t.name===S){W=t.newHash;return}if(t.name===S)return;_();function n(a){if(d[a])return;d[a]=new RTCPeerConnection(bt),d[a].onicecandidate=b=>{b.candidate&&y?.send(JSON.stringify({type:"new-ice-candidate",target:a,name:S,candidate:b.candidate.toJSON()}))},d[a].oniceconnectionstatechange=N,d[a].onicegatheringstatechange=x,d[a].onsignalingstatechange=()=>{switch(d[a].signalingState){case"closed":break}},d[a].onnegotiationneeded=u,d[a].ontrack=function({track:b,streams:E}){ue[a]={track:b,streams:E}},d[a].ondatachannel=b=>{let E=b.channel;E.binaryType="arraybuffer",E.addEventListener("close",g),R&&R.localStream&&R.localStream.active&&R.localStream.getTracks().forEach(he=>{let Le=d[a];Le.addTrack(he),Le.ontrack=({track:Tt,streams:Ft})=>ue[a]={track:Tt,streams:Ft}}),E.addEventListener("message",async he=>yt(he,"rtc",Object.assign(E,{hashCode:_()})));let Pt=Object.assign(E,{target:a});de.push(Pt)};let s={ordered:!0,reliable:!0,maxPacketLifeTime:3e3},c=Object.assign(d[a].createDataChannel(a,s),{target:a});return c.binaryType="arraybuffer",c.addEventListener("error",b=>{console.log("xxxxxx-  Data Channel Error:",b)}),c.addEventListener("open",()=>{de.push(c)}),c.addEventListener("close",()=>{}),d[a];function g(){d[a].close(),delete d[a]}async function u(){try{let b=await d[a].createOffer();if(d[a].signalingState!="stable")return;await d[a].setLocalDescription(b),y?.send(JSON.stringify({target:a,name:S,type:"video-offer",offer:d[a].localDescription}))}catch{}}function N(){switch(d[a].iceConnectionState){case"closed":case"failed":case"disconnected":break}}function x(){}}async function o(a,s){await d[s].setRemoteDescription(new RTCSessionDescription(a)).catch(console.error)}async function i(a,s){d[s]||n(s),await d[s].setRemoteDescription(new RTCSessionDescription(a));let c=await d[s].createAnswer();await d[s].setLocalDescription(c),y?.send(JSON.stringify({target:s,name:S,type:"video-answer",answer:c}))}}var bt={iceServers:["stun3.l.google.com:19302"].map(t=>({urls:`stun:${t}`}))};bt.iceServers=[{urls:"stun:stun.stunprotocol.org:3478"},{urls:"stun:stun.l.google.com:19302"}];async function sr(t,e){let r=new RTCIceCandidate(t);await d[e].addIceCandidate(r)}async function nn(){try{if(navigator.serviceWorker.onmessage=async t=>{let e=t.source;if(e!=null)switch(t.data.method){case"ipfs-message-port":let r=new MessageChannel;e.postMessage({method:"ipfs-message-port",id:t.data.id,port:r.port2},{transfer:[r.port2]})}},document.documentElement.dataset.viewer){await(async e=>{switch((e&&e.split("/")||[])[0]||""){case"ipfs":case"ipns":document.body.innerHTML=`<iframe id="viewer" style="width:100%;height:100%;position:fixed;top:0;left:0;border:none;" src="/view${e}"></iframe>`}})(location.pathname);return}}catch{}}l();var k={printR(t,e){if(e[t])return"";e[t]=!0;let r=k.data[k.hashMap[t]],n=r.code;return!r.deps||!r.deps.length?n:[...r.deps].map(a=>k.printR(a,e)).join(` 
 `)+`
    
    `+n},async toJs(t){let e=k.printR(t,{}),r=Object.keys(k.data).map(s=>[`"${k.hashMap[s]}"`,s.replace(/[^a-f]/g,"")]).map(s=>s[0]+": "+s[1]).join(`, 
 `),n=`
     ${e}
  function require(name){
    return ({${r}})[name];
  }
  globalThis.UMD_require = require;
  
     `,{transform:o}=await import("./chunk-esbuildEsm-Q5WDOJEJ.mjs"),i=await o(n,{format:"esm",minify:!0,keepNames:!0,platform:"browser",treeShaking:!0});return(await o(i.code,{format:"iife",minify:!0,keepNames:!0,platform:"browser",treeShaking:!0})).code},hashMap:{},data:{}},De=async(t,e)=>{let{transform:r}=await import("./chunk-esbuildEsm-Q5WDOJEJ.mjs"),n=v(t);if(k.hashMap={...k.hashMap,[n]:e,[e]:n},!k.data[n]){let o=await r(t,{format:"iife",keepNames:!0,treeShaking:!0,target:"es2018",loader:e.includes(".tsx")?"tsx":e.includes(".ts")?"ts":e.includes(".jsx")?"jsx":"js",globalName:n.replace(/[^a-f]/g,"")});if(!o||!o.code){console.log("transform result -code is empty");return}k.data={...k.data,[n]:{...o,deps:cr(o.code)}},await Promise.all(k.data[n].deps.map(async i=>{if(k.hashMap[i])return;let a=JSON.parse(document.querySelector("script[type=importmap]").innerHTML),s="",c="";if(a.imports[i])s=a.imports[i],c=v(i);else if(i.startsWith("./"))s=new URL(i,location.origin).toString(),c=v(i);else try{s=await import.meta.resolve(i,e),c=v(i)}catch{console.error(`failed to resolve: ${i}`);return}if(k.hashMap[c])return;k.hashMap[i]=s;let g=await(await fetch(s)).text();return De(g,i)}))}return k},cr=t=>{let e=/require\("(.+?)"\)/gm,r,n=[];for(;(r=e.exec(t))!==null;){r.index===e.lastIndex&&e.lastIndex++;for(let[o,i]of r.entries())o==1&&n.push(i),console.log(`Found match, group ${o}: ${i}`)}return n};l();F();F();var h={md5Hash:"",wait:1,res:null,codeSpace:"",waitForDiv:async()=>{let t=h.md5Hash;return h.res?.innerHTML||await vt(),h.res?.innerHTML.includes(t)||await vt(),h.res?.innerHTML.includes(t)||(console.log(`waiting ${h.wait} for ${h.md5Hash} `),await j(h.wait)),h.res?.innerHTML.includes(t)?h.res.innerHTML:(h.wait=h.wait*2,await h.waitForDiv())},setHash:null,setApp:t=>{let e=document.createElement("div");e.style.visibility="hidden",e.style.position="absolute",document.body.appendChild(e);let r=K(e);return r.render(f(fr,{md5Hash:t})),()=>{r.unmount,document.body.removeChild(e),e.remove(),delete T[t],h.setHash=null}}},Ct=async(t,e)=>{h.codeSpace=e;let r=v(t).slice(0,8);T[r]||await J(t),h.wait=1;let n=h.setApp(r);try{let o=await h.waitForDiv();if(!o)return{html:null,css:null};let i=lr(V[r]),a=document.querySelector("style[data-emotion=z-global]")?.innerHTML;return{html:o,css:a+" "+i}}finally{n()}};function lr(t){let e=Object.keys(t.inserted).map(r=>`.${t.key}-${r}`);return Array.from(document.styleSheets).map(r=>r.cssRules[0]).filter(r=>r&&e.includes(r.selectorText)).map(r=>r.cssText).join(`
`)}var fr=({md5Hash:t})=>{let e=A(null),[r,n]=U(t);L(()=>{e?.current&&(h.res=e.current),h.md5Hash=r,h.setHash=i=>n(i)},[e,r,n]);let o=T[r];return f("div",{ref:e,children:f(o,{appId:`${h.codeSpace}-${r}`},r)})},vt=()=>{let t;console.log("wait for animation");let e=new Promise(r=>t=r);return requestAnimationFrame(()=>t(!0)),e};var pe={code:"",olderCode:""};async function Oe({code:t,counter:e,codeSpace:r}){pe.code=t;let n=p();if(console.log(`${n.i} => ${e}`),!(e<n.i)){setTimeout(()=>{pe.code===t&&t!==pe.olderCode&&Oe({code:t,counter:e,codeSpace:r}),pe.olderCode=t},1e3);try{let o=await Ye(t,{loader:"tsx",format:"esm",treeShaking:!0,minify:!0,keepNames:!0,tsconfigRaw:{compilerOptions:{jsx:"react-jsx",module:"ESNext",jsxFragmentFactory:"Fragment",jsxImportSource:"@emotion/react"}},target:"es2018"});Object.assign(globalThis,{umdExp:async()=>{console.log("to UMD");let u=await De(o.code,`${r}.tsx`);console.log({UMD:u}),N("coder.js",await u?.toJs(`${r}.tsx`));function N(x,b){var E=document.createElement("a");E.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(b)),E.setAttribute("download",x),E.style.display="none",document.body.appendChild(E),E.click(),document.body.removeChild(E)}}});let a=v(t).slice(0,8),s=`${o.code}//${a}`,{html:c,css:g}=await Ct(s,r);if(console.log({html:c,css:g}),!c)return;Ue({...p(),code:t,i:e,transpiled:s,html:c,css:g}),gt()}catch(o){console.error({error:o})}finally{}}}F();Ce();l();function St(){let t=/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.userAgent.indexOf("SAMSUNG")===-1,e=!1;return function(r){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[23]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(r.slice(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e&&!t}l();var xt=async t=>dr().prettierJs(t),Ie=null,kt={prettierJs:async t=>{let e=performance.now();Ie=Ie||(await import("./chunk-prettierEsm-Z7NIH6E6.mjs")).prettierJs;let r=performance.now();console.log(`importing took ${r-e} milliseconds.`);let n=Ie(t),o=performance.now();return console.log(`prettier took ${o-r} milliseconds.`),n}},G=null;function dr(){if(G)return G;if(!ur())return G=kt;try{let t=new SharedWorker(new URL("prettierWorker.mjs",location.origin),{type:"module"});return G=$e(t.port)}catch{return G=kt}}function ur(){let t=!1,e={get type(){return t=!0,"module"}};try{new Worker("blob://",e)}finally{return t}}var m={CH(){},getValue:async()=>"",setValue:async t=>{t.length<10&&console.log(t)},getErrors:async()=>[],code:"",counter:0,codeSpace:"",lastKeyDown:0,codeToSet:""},Et=({codeSpace:t})=>{let e=A(null),{i:r,code:n}=p(),[o,i]=$.useState({lastKeyDown:0,myCode:n,counter:r,started:!1,onChange(u){},engine:St()?"ace":"monaco"});m.counter=p().i,m.codeSpace=t;let{myCode:a,started:s,engine:c,onChange:g}=o;return m.code=a,$.useEffect(()=>{!e?.current||s||(c==="monaco"?pr():hr()).then(u=>Object.assign(m,u)).then(()=>i(u=>({...u,started:!0})))},[s,e]),$.useEffect(()=>{m.getErrors().then(console.log),g(()=>m.getValue().then(()=>i(u=>({...u,counter:m.counter,myCode:m.code}))))},[g,a,i]),I(()=>{m.counter>=p().i||(m.counter=p().i,m.code=p().code,m.setValue(m.code),i(u=>({...u,counter:m.counter,myCode:m.code})))},"editor"),f("div",{onKeyDown:()=>m.lastKeyDown=Date.now(),id:"editor",css:M`          
      max-width: 640px;
      height: 100%; 
      `,ref:e})};async function _t(t){let e=await xt(t);if(e===m.code)return;let r=++m.counter;m.code=e,Oe({code:e,counter:r,codeSpace:m.codeSpace})}async function pr(){let t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.href=location.origin+"/Editor.css",document.head.append(t);let{startMonaco:e}=await import("./chunk-startMonaco-GMPEUG5F.mjs"),r=window.document.getElementById("editor");return e({container:r,name:m.codeSpace,code:p().code,onChange:_t})}async function hr(){let{startAce:t}=await import("./chunk-startAce-FV3SITGG.mjs");return await j(100),await t(p().code,_t)}var mr=Ge(()=>j(1e3).then(()=>import("./chunk-DraggableWindow-73WXOJPB.mjs"))),gr=({children:t})=>f("div",{css:M`
height: 100%;
width: 100%;
background-blend-mode: overlay;
background:  repeating-radial-gradient(circle at bottom left, 
              #fedc00 0, #fedc00 5.5555555556%, 
              #fcb712 0, #fcb712 11.1111111111%, 
              #f7921e 0, #f7921e 16.6666666667%, 
            #e87f24 0, #e87f24 22.2222222222%, 
            #dd6227 0, #dd6227 27.7777777778%,
             #dc4c27 0, #dc4c27 33.3333333333%, 
            #ca3435 0, #ca3435 38.8888888889%, 
            #b82841 0, #b82841 44.4444444444%, 
            #953751 0, #953751 50%, #364c88 0, 
            #364c88 55.5555555556%, #16599d 0, 
            #16599d 61.1111111111%, #02609e 0, 
            #02609e 66.6666666667%, #0073a9 0, 
            #0073a9 72.2222222222%, #008aa4 0, 
            #008aa4 77.7777777778%, #239a87 0, 
            #239a87 83.3333333333%, #7cba6d 0, 
            #7cba6d 88.8888888889%, #becc2f 0, 
            #becc2f 94.4444444444%, #e0d81d 0, 
            #e0d81d 100%), 
            repeating-radial-gradient(circle at bottom right, 
              #fedc00 0, #fedc00 5.5555555556%, 
              #fcb712 0, #fcb712 11.1111111111%, 
              #f7921e 0, #f7921e 16.6666666667%, 
              #e87f24 0, #e87f24 22.2222222222%, 
              #dd6227 0, #dd6227 27.7777777778%, 
              #dc4c27 0, #dc4c27 33.3333333333%, 
              #ca3435 0, #ca3435 38.8888888889%, 
              #b82841 0, #b82841 44.4444444444%, 
              #953751 0, #953751 50%,
               #364c88 0, #364c88 55.5555555556%, 
               #16599d 0, #16599d 61.1111111111%, 
               #02609e 0, #02609e 66.6666666667%, 
               #0073a9 0, #0073a9 72.2222222222%, 
               #008aa4 0, #008aa4 77.7777777778%,
                #239a87 0, #239a87 83.3333333333%, 
                #7cba6d 0, #7cba6d 88.8888888889%, 
                #becc2f 0, #becc2f 94.4444444444%, 
                #e0d81d 0, #e0d81d 100%);
`,children:t}),wr=({codeSpace:t})=>{let e=_(),[r,n]=U(e),o=location.pathname.endsWith("public")||location.pathname.endsWith("hydrated");L(()=>{I(async()=>{let a=_();if(r!==a)try{await J(),n(a)}catch(s){console.error({e:s})}},"myApp")},[r,n]);let i=Ke(()=>tt({attributes:{id:`root-${t}`,style:"height: 100%"}}),[]);return P(ve,{children:[f(et,{node:i,children:f(ft,{hash:r,codeSpace:t})}),o?f(Y,{node:i}):f(Je,{fallback:f(Y,{node:i}),children:f(gr,{children:P(ve,{children:[f(Et,{codeSpace:t}),f(mr,{room:t,children:f(Y,{node:i})})]})})})]})},Rt={started:!1},ct=({codeSpace:t})=>{if(Rt.started)return;Rt.started=!0;let e=document.querySelector("#root"),r=K(e),n=Q({key:"root"});r.render(f(X,{value:n,cj:!0,children:wr}))};export{ct as a,R as b,en as c,gt as d,tn as e,rn as f,wt as g,nn as h,Ct as i,Et as j};
