import{a as Ct}from"./chunk-chunk-IFMJW7GH.mjs";import{a as dt,g as ht,k as gt}from"./chunk-chunk-L5BROTM5.mjs";import{a as tr}from"./chunk-chunk-OOBH5VBY.mjs";import{a as wt}from"./chunk-chunk-73U57KXL.mjs";import{a as mt}from"./chunk-chunk-WNZVI2YQ.mjs";import{a as Zt,b as ve,f as E,g as L,h as Te,i as lt,j as Re,k as Pe,l as ft}from"./chunk-chunk-UDUMOIFY.mjs";import{a as er}from"./chunk-chunk-BBFXSIIJ.mjs";import{a as ut}from"./chunk-chunk-HJDRMN4F.mjs";import{a as c,d as Qt,e as q,f as k,g}from"./chunk-chunk-O6JVKB3A.mjs";var we=Qt((en,Ze)=>{"use strict";g();var u={};u.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};u.localCName=u.generateIdentifier();u.splitLines=function(e){return e.trim().split(`
`).map(t=>t.trim())};u.splitSections=function(e){return e.split(`
m=`).map((r,n)=>(n>0?"m="+r:r).trim()+`\r
`)};u.getDescription=function(e){let t=u.splitSections(e);return t&&t[0]};u.getMediaSections=function(e){let t=u.splitSections(e);return t.shift(),t};u.matchPrefix=function(e,t){return u.splitLines(e).filter(r=>r.indexOf(t)===0)};u.parseCandidate=function(e){let t;e.indexOf("a=candidate:")===0?t=e.substring(12).split(" "):t=e.substring(10).split(" ");let r={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]===void 0&&(r[t[n]]=t[n+1]);break}return r};u.writeCandidate=function(e){let t=[];t.push(e.foundation);let r=e.component;r==="rtp"?t.push(1):r==="rtcp"?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);let n=e.type;return t.push("typ"),t.push(n),n!=="host"&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")};u.parseIceOptions=function(e){return e.substr(14).split(" ")};u.parseRtpMap=function(e){let t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=t.length===3?parseInt(t[2],10):1,r.numChannels=r.channels,r};u.writeRtpMap=function(e){let t=e.payloadType;e.preferredPayloadType!==void 0&&(t=e.preferredPayloadType);let r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(r!==1?"/"+r:"")+`\r
`};u.parseExtmap=function(e){let t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}};u.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+`\r
`};u.parseFmtp=function(e){let t={},r,n=e.substr(e.indexOf(" ")+1).split(";");for(let i=0;i<n.length;i++)r=n[i].trim().split("="),t[r[0].trim()]=r[1];return t};u.writeFmtp=function(e){let t="",r=e.payloadType;if(e.preferredPayloadType!==void 0&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let n=[];Object.keys(e.parameters).forEach(i=>{e.parameters[i]!==void 0?n.push(i+"="+e.parameters[i]):n.push(i)}),t+="a=fmtp:"+r+" "+n.join(";")+`\r
`}return t};u.parseRtcpFb=function(e){let t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};u.writeRtcpFb=function(e){let t="",r=e.payloadType;return e.preferredPayloadType!==void 0&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(n=>{t+="a=rtcp-fb:"+r+" "+n.type+(n.parameter&&n.parameter.length?" "+n.parameter:"")+`\r
`}),t};u.parseSsrcMedia=function(e){let t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r};u.parseSsrcGroup=function(e){let t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(r=>parseInt(r,10))}};u.getMid=function(e){let t=u.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)};u.parseFingerprint=function(e){let t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}};u.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:u.matchPrefix(e+t,"a=fingerprint:").map(u.parseFingerprint)}};u.writeDtlsParameters=function(e,t){let r="a=setup:"+t+`\r
`;return e.fingerprints.forEach(n=>{r+="a=fingerprint:"+n.algorithm+" "+n.value+`\r
`}),r};u.parseCryptoLine=function(e){let t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}};u.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?u.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`};u.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;let t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}};u.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")};u.getCryptoParameters=function(e,t){return u.matchPrefix(e+t,"a=crypto:").map(u.parseCryptoLine)};u.getIceParameters=function(e,t){let r=u.matchPrefix(e+t,"a=ice-ufrag:")[0],n=u.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&n?{usernameFragment:r.substr(12),password:n.substr(10)}:null};u.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`;return e.iceLite&&(t+=`a=ice-lite\r
`),t};u.parseRtpParameters=function(e){let t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=u.splitLines(e)[0].split(" ");for(let i=3;i<n.length;i++){let a=n[i],s=u.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){let o=u.parseRtpMap(s),p=u.matchPrefix(e,"a=fmtp:"+a+" ");switch(o.parameters=p.length?u.parseFmtp(p[0]):{},o.rtcpFeedback=u.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(u.parseRtcpFb),t.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(o.name.toUpperCase());break;default:break}}}return u.matchPrefix(e,"a=extmap:").forEach(i=>{t.headerExtensions.push(u.parseExtmap(i))}),t};u.writeRtpDescription=function(e,t){let r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(i=>i.preferredPayloadType!==void 0?i.preferredPayloadType:i.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,t.codecs.forEach(i=>{r+=u.writeRtpMap(i),r+=u.writeFmtp(i),r+=u.writeRtcpFb(i)});let n=0;return t.codecs.forEach(i=>{i.maxptime>n&&(n=i.maxptime)}),n>0&&(r+="a=maxptime:"+n+`\r
`),t.headerExtensions&&t.headerExtensions.forEach(i=>{r+=u.writeExtmap(i)}),r};u.parseRtpEncodingParameters=function(e){let t=[],r=u.parseRtpParameters(e),n=r.fecMechanisms.indexOf("RED")!==-1,i=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=u.matchPrefix(e,"a=ssrc:").map(f=>u.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),s=a.length>0&&a[0].ssrc,o,p=u.matchPrefix(e,"a=ssrc-group:FID").map(f=>f.substr(17).split(" ").map(m=>parseInt(m,10)));p.length>0&&p[0].length>1&&p[0][0]===s&&(o=p[0][1]),r.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let d={ssrc:s,codecPayloadType:parseInt(f.parameters.apt,10)};s&&o&&(d.rtx={ssrc:o}),t.push(d),n&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:s,mechanism:i?"red+ulpfec":"red"},t.push(d))}}),t.length===0&&s&&t.push({ssrc:s});let l=u.matchPrefix(e,"b=");return l.length&&(l[0].indexOf("b=TIAS:")===0?l=parseInt(l[0].substr(7),10):l[0].indexOf("b=AS:")===0?l=parseInt(l[0].substr(5),10)*1e3*.95-50*40*8:l=void 0,t.forEach(f=>{f.maxBitrate=l})),t};u.parseRtcpParameters=function(e){let t={},r=u.matchPrefix(e,"a=ssrc:").map(a=>u.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);let n=u.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=n.length>0,t.compound=n.length===0;let i=u.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t};u.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+=`a=rtcp-rsize\r
`),e.mux&&(t+=`a=rtcp-mux\r
`),e.ssrc!==void 0&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+`\r
`),t};u.parseMsid=function(e){let t,r=u.matchPrefix(e,"a=msid:");if(r.length===1)return t=r[0].substr(7).split(" "),{stream:t[0],track:t[1]};let n=u.matchPrefix(e,"a=ssrc:").map(i=>u.parseSsrcMedia(i)).filter(i=>i.attribute==="msid");if(n.length>0)return t=n[0].value.split(" "),{stream:t[0],track:t[1]}};u.parseSctpDescription=function(e){let t=u.parseMLine(e),r=u.matchPrefix(e,"a=max-message-size:"),n;r.length>0&&(n=parseInt(r[0].substr(19),10)),isNaN(n)&&(n=65536);let i=u.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:t.fmt,maxMessageSize:n};let a=u.matchPrefix(e,"a=sctpmap:");if(a.length>0){let s=a[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:n}}};u.writeSctpDescription=function(e,t){let r=[];return e.protocol!=="DTLS/SCTP"?r=["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+t.port+`\r
`]:r=["m="+e.kind+" 9 "+e.protocol+" "+t.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+t.port+" "+t.protocol+` 65535\r
`],t.maxMessageSize!==void 0&&r.push("a=max-message-size:"+t.maxMessageSize+`\r
`),r.join("")};u.generateSessionId=function(){return Math.random().toString().substr(2,21)};u.writeSessionBoilerplate=function(e,t,r){let n,i=t!==void 0?t:2;return e?n=e:n=u.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+n+" "+i+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`};u.getDirection=function(e,t){let r=u.splitLines(e);for(let n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2);default:}return t?u.getDirection(t):"sendrecv"};u.getKind=function(e){return u.splitLines(e)[0].split(" ")[0].substr(2)};u.isRejected=function(e){return e.split(" ",2)[1]==="0"};u.parseMLine=function(e){let r=u.splitLines(e)[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}};u.parseOLine=function(e){let r=u.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}};u.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;let t=u.splitLines(e);for(let r=0;r<t.length;r++)if(t[r].length<2||t[r].charAt(1)!=="=")return!1;return!0};typeof Ze=="object"&&(Ze.exports=u)});g();g();g();function yt(e,t=r=>r.key){var r=[];return be(e,"",!0,n=>r.push(n),t),r.join("")}c(yt,"print");function be(e,t,r,n,i){if(e){n(`${t}${r?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 "}${i(e)}
`);let a=t+(r?"    ":"\u2502   ");e.left&&be(e.left,a,!1,n,i),e.right&&be(e.right,a,!0,n,i)}}c(be,"row");function Y(e){if(e===null)return!0;var t=X(e.left),r=X(e.right);return!!(Math.abs(t-r)<=1&&Y(e.left)&&Y(e.right))}c(Y,"isBalanced");function X(e){return e?1+Math.max(X(e.left),X(e.right)):0}c(X,"height");function Q(e,t,r,n,i){let a=i-n;if(a>0){let s=n+Math.floor(a/2),o=t[s],p=r[s],l={key:o,data:p,parent:e};return l.left=Q(l,t,r,n,s),l.right=Q(l,t,r,s+1,i),l}return null}c(Q,"loadRecursive");function Z(e){if(e===null)return 0;let t=Z(e.left),r=Z(e.right);return e.balanceFactor=t-r,Math.max(t,r)+1}c(Z,"markBalance");function w(e,t,r,n,i){if(r>=n)return;let a=e[r+n>>1],s=r-1,o=n+1;for(;;){do s++;while(i(e[s],a)<0);do o--;while(i(e[o],a)>0);if(s>=o)break;let p=e[s];e[s]=e[o],e[o]=p,p=t[s],t[s]=t[o],t[o]=p}w(e,t,r,o,i),w(e,t,o+1,n,i)}c(w,"sort");function rr(e,t){return e>t?1:e<t?-1:0}c(rr,"DEFAULT_COMPARE");function ee(e){var t=e.right;return e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent,t.parent&&(t.parent.left===e?t.parent.left=t:t.parent.right=t),e.parent=t,t.left=e,e.balanceFactor+=1,t.balanceFactor<0&&(e.balanceFactor-=t.balanceFactor),t.balanceFactor+=1,e.balanceFactor>0&&(t.balanceFactor+=e.balanceFactor),t}c(ee,"rotateLeft");function te(e){var t=e.left;return e.left=t.right,e.left&&(e.left.parent=e),t.parent=e.parent,t.parent&&(t.parent.left===e?t.parent.left=t:t.parent.right=t),e.parent=t,t.right=e,e.balanceFactor-=1,t.balanceFactor>0&&(e.balanceFactor-=t.balanceFactor),t.balanceFactor-=1,e.balanceFactor<0&&(t.balanceFactor+=e.balanceFactor),t}c(te,"rotateRight");var I=class{constructor(t,r=!1){this._comparator=t||rr,this._root=null,this._size=0,this._noDuplicates=!!r}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(t){if(this._root)for(var r=this._root,n=this._comparator;r;){var i=n(t,r.key);if(i===0)return!0;i<0?r=r.left:r=r.right}return!1}next(t){var r=t;if(r)if(r.right)for(r=r.right;r.left;)r=r.left;else for(r=t.parent;r&&r.right===t;)t=r,r=r.parent;return r}prev(t){var r=t;if(r)if(r.left)for(r=r.left;r.right;)r=r.right;else for(r=t.parent;r&&r.left===t;)t=r,r=r.parent;return r}forEach(t){for(var r=this._root,n=[],i=!1,a=0;!i;)r?(n.push(r),r=r.left):n.length>0?(r=n.pop(),t(r,a++),r=r.right):i=!0;return this}range(t,r,n,i){let a=[],s=this._comparator,o=this._root,p;for(;a.length!==0||o;)if(o)a.push(o),o=o.left;else{if(o=a.pop(),p=s(o.key,r),p>0)break;if(s(o.key,t)>=0&&n.call(i,o))return this;o=o.right}return this}keys(){for(var t=this._root,r=[],n=[],i=!1;!i;)t?(r.push(t),t=t.left):r.length>0?(t=r.pop(),n.push(t.key),t=t.right):i=!0;return n}values(){for(var t=this._root,r=[],n=[],i=!1;!i;)t?(r.push(t),t=t.left):r.length>0?(t=r.pop(),n.push(t.data),t=t.right):i=!0;return n}at(t){for(var r=this._root,n=[],i=!1,a=0;!i;)if(r)n.push(r),r=r.left;else if(n.length>0){if(r=n.pop(),a===t)return r;a++,r=r.right}else i=!0;return null}minNode(){var t=this._root;if(!t)return null;for(;t.left;)t=t.left;return t}maxNode(){var t=this._root;if(!t)return null;for(;t.right;)t=t.right;return t}min(){var t=this._root;if(!t)return null;for(;t.left;)t=t.left;return t.key}max(){var t=this._root;if(!t)return null;for(;t.right;)t=t.right;return t.key}isEmpty(){return!this._root}pop(){var t=this._root,r=null;if(t){for(;t.left;)t=t.left;r={key:t.key,data:t.data},this.remove(t.key)}return r}popMax(){var t=this._root,r=null;if(t){for(;t.right;)t=t.right;r={key:t.key,data:t.data},this.remove(t.key)}return r}find(t){for(var r=this._root,n=r,i,a=this._comparator;n;){if(i=a(t,n.key),i===0)return n;i<0?n=n.left:n=n.right}return null}insert(t,r){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:t,data:r},this._size++,this._root;var n=this._comparator,i=this._root,a=null,s=0;if(this._noDuplicates)for(;i;){if(s=n(t,i.key),a=i,s===0)return null;s<0?i=i.left:i=i.right}else for(;i;)s=n(t,i.key),a=i,s<=0?i=i.left:i=i.right;var o={left:null,right:null,balanceFactor:0,parent:a,key:t,data:r},p;for(s<=0?a.left=o:a.right=o;a&&(s=n(a.key,t),s<0?a.balanceFactor-=1:a.balanceFactor+=1,a.balanceFactor!==0);){if(a.balanceFactor<-1){a.right.balanceFactor===1&&te(a.right),p=ee(a),a===this._root&&(this._root=p);break}else if(a.balanceFactor>1){a.left.balanceFactor===-1&&ee(a.left),p=te(a),a===this._root&&(this._root=p);break}a=a.parent}return this._size++,o}remove(t){if(!this._root)return null;for(var r=this._root,n=this._comparator,i=0;r&&(i=n(t,r.key),i!==0);)i<0?r=r.left:r=r.right;if(!r)return null;var a=r.key,s,o;if(r.left){for(s=r.left;s.left||s.right;){for(;s.right;)s=s.right;r.key=s.key,r.data=s.data,s.left&&(r=s,s=s.left)}r.key=s.key,r.data=s.data,r=s}if(r.right){for(o=r.right;o.left||o.right;){for(;o.left;)o=o.left;r.key=o.key,r.data=o.data,o.right&&(r=o,o=o.right)}r.key=o.key,r.data=o.data,r=o}for(var p=r.parent,l=r,f;p&&(p.left===l?p.balanceFactor-=1:p.balanceFactor+=1,p.balanceFactor<-1?(p.right.balanceFactor===1&&te(p.right),f=ee(p),p===this._root&&(this._root=f),p=f):p.balanceFactor>1&&(p.left.balanceFactor===-1&&ee(p.left),f=te(p),p===this._root&&(this._root=f),p=f),!(p.balanceFactor===-1||p.balanceFactor===1));)l=p,p=p.parent;return r.parent&&(r.parent.left===r?r.parent.left=null:r.parent.right=null),r===this._root&&(this._root=null),this._size--,a}load(t=[],r=[],n){if(this._size!==0)throw new Error("bulk-load: tree is not empty");let i=t.length;return n&&w(t,r,0,i-1,this._comparator),this._root=Q(null,t,r,0,i),Z(this._root),this._size=i,this}isBalanced(){return Y(this._root)}toString(t){return yt(this._root,t)}};c(I,"AVLTree");I.default=I;var ct=k(Zt(),1);g();g();g();var vt=!0,Tt=!0;function J(e,t,r){let n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}c(J,"extractVersion");function M(e,t,r){if(!e.RTCPeerConnection)return;let n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(s,o){if(s!==t)return i.apply(this,arguments);let p=c(l=>{let f=r(l);f&&(o.handleEvent?o.handleEvent(f):o(f))},"wrappedCallback");return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(o,p),i.apply(this,[s,p])};let a=n.removeEventListener;n.removeEventListener=function(s,o){if(s!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(o))return a.apply(this,arguments);let p=this._eventMap[t].get(o);return this._eventMap[t].delete(o),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[s,p])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(s){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),s&&this.addEventListener(t,this["_on"+t]=s)},enumerable:!0,configurable:!0})}c(M,"wrapPeerConnectionEvent");function Rt(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(vt=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}c(Rt,"disableLog");function Pt(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Tt=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}c(Pt,"disableWarnings");function re(){if(typeof window=="object"){if(vt)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}c(re,"log");function F(e,t){!Tt||console.warn(e+" is deprecated, please use "+t+" instead.")}c(F,"deprecated");function bt(e){let t={browser:null,version:null};if(typeof e>"u"||!e.navigator)return t.browser="Not a browser.",t;let{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=J(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=J(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=J(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}c(bt,"detectBrowser");function St(e){return Object.prototype.toString.call(e)==="[object Object]"}c(St,"isObject");function _e(e){return St(e)?Object.keys(e).reduce(function(t,r){let n=St(e[r]),i=n?_e(e[r]):e[r],a=n&&!Object.keys(i).length;return i===void 0||a?t:Object.assign(t,{[r]:i})},{}):e}c(_e,"compactObject");function xe(e,t,r){!t||r.has(t.id)||(r.set(t.id,t),Object.keys(t).forEach(n=>{n.endsWith("Id")?xe(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(i=>{xe(e,e.get(i),r)})}))}c(xe,"walkStats");function Ee(e,t,r){let n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;let a=[];return e.forEach(s=>{s.type==="track"&&s.trackIdentifier===t.id&&a.push(s)}),a.forEach(s=>{e.forEach(o=>{o.type===n&&o.trackId===s.id&&xe(e,o,i)})}),i}c(Ee,"filterStats");var se={};q(se,{fixNegotiationNeeded:()=>je,shimAddTrackRemoveTrack:()=>Le,shimAddTrackRemoveTrackWithNative:()=>Et,shimGetDisplayMedia:()=>_t,shimGetSendersWithDtmf:()=>De,shimGetStats:()=>Oe,shimGetUserMedia:()=>ne,shimMediaStream:()=>ke,shimOnTrack:()=>Me,shimPeerConnection:()=>ie,shimSenderReceiverGetStats:()=>Ie});g();g();var xt=re;function ne(e,t){let r=e&&e.navigator;if(!r.mediaDevices)return;let n=c(function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;let p={};return Object.keys(o).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;let f=typeof o[l]=="object"?o[l]:{ideal:o[l]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);let d=c(function(m,h){return m?m+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h},"oldname_");if(f.ideal!==void 0){p.optional=p.optional||[];let m={};typeof f.ideal=="number"?(m[d("min",l)]=f.ideal,p.optional.push(m),m={},m[d("max",l)]=f.ideal,p.optional.push(m)):(m[d("",l)]=f.ideal,p.optional.push(m))}f.exact!==void 0&&typeof f.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[d("",l)]=f.exact):["min","max"].forEach(m=>{f[m]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[d(m,l)]=f[m])})}),o.advanced&&(p.optional=(p.optional||[]).concat(o.advanced)),p},"constraintsToChrome_"),i=c(function(o,p){if(t.version>=61)return p(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){let l=c(function(f,d,m){d in f&&!(m in f)&&(f[m]=f[d],delete f[d])},"remap");o=JSON.parse(JSON.stringify(o)),l(o.audio,"autoGainControl","googAutoGainControl"),l(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=n(o.audio)}if(o&&typeof o.video=="object"){let l=o.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});let f=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!f)){delete o.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return r.mediaDevices.enumerateDevices().then(m=>{m=m.filter(y=>y.kind==="videoinput");let h=m.find(y=>d.some(S=>y.label.toLowerCase().includes(S)));return!h&&m.length&&d.includes("back")&&(h=m[m.length-1]),h&&(o.video.deviceId=l.exact?{exact:h.deviceId}:{ideal:h.deviceId}),o.video=n(o.video),xt("chrome: "+JSON.stringify(o)),p(o)})}o.video=n(o.video)}return xt("chrome: "+JSON.stringify(o)),p(o)},"shimConstraints_"),a=c(function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},"shimError_"),s=c(function(o,p,l){i(o,f=>{r.webkitGetUserMedia(f,p,d=>{l&&l(a(d))})})},"getUserMedia_");if(r.getUserMedia=s.bind(r),r.mediaDevices.getUserMedia){let o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(p){return i(p,l=>o(l).then(f=>{if(l.audio&&!f.getAudioTracks().length||l.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return f},f=>Promise.reject(a(f))))}}}c(ne,"shimGetUserMedia");g();function _t(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&!!e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=c(function(n){return t(n).then(i=>{let a=n.video&&n.video.width,s=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:o||3}},a&&(n.video.mandatory.maxWidth=a),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})},"getDisplayMedia")}}c(_t,"shimGetDisplayMedia");function ke(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}c(ke,"shimMediaStream");function Me(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=c(function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let a;e.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(o=>o.track&&o.track.id===i.track.id):a={track:i.track};let s=new Event("track");s.track=i.track,s.receiver=a,s.transceiver={receiver:a},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(i=>{let a;e.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(o=>o.track&&o.track.id===i.id):a={track:i};let s=new Event("track");s.track=i,s.receiver=a,s.transceiver={receiver:a},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)},"setRemoteDescription")}else M(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}c(Me,"shimOnTrack");function De(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=c(function(i,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=i.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:i}},"shimSenderWithDtmf");if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=c(function(){return this._senders=this._senders||[],this._senders.slice()},"getSenders");let i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=c(function(o,p){let l=i.apply(this,arguments);return l||(l=t(this,o),this._senders.push(l)),l},"addTrack");let a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=c(function(o){a.apply(this,arguments);let p=this._senders.indexOf(o);p!==-1&&this._senders.splice(p,1)},"removeTrack")}let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=c(function(a){this._senders=this._senders||[],r.apply(this,[a]),a.getTracks().forEach(s=>{this._senders.push(t(this,s))})},"addStream");let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=c(function(a){this._senders=this._senders||[],n.apply(this,[a]),a.getTracks().forEach(s=>{let o=this._senders.find(p=>p.track===s);o&&this._senders.splice(this._senders.indexOf(o),1)})},"removeStream")}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=c(function(){let n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},"getSenders"),Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}c(De,"shimGetSendersWithDtmf");function Oe(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=c(function(){let[n,i,a]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);let s=c(function(p){let l={};return p.result().forEach(d=>{let m={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(h=>{m[h]=d.stat(h)}),l[m.id]=m}),l},"fixChromeStats_"),o=c(function(p){return new Map(Object.keys(p).map(l=>[l,p[l]]))},"makeMapStats");if(arguments.length>=2){let p=c(function(l){i(o(s(l)))},"successCallbackWrapper_");return t.apply(this,[p,n])}return new Promise((p,l)=>{t.apply(this,[function(f){p(o(s(f)))},l])}).then(i,a)},"getStats")}c(Oe,"shimGetStats");function Ie(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=c(function(){let a=r.apply(this,[]);return a.forEach(s=>s._pc=this),a},"getSenders"));let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=c(function(){let a=n.apply(this,arguments);return a._pc=this,a},"addTrack")),e.RTCRtpSender.prototype.getStats=c(function(){let a=this;return this._pc.getStats().then(s=>Ee(s,a.track,!0))},"getStats")}if(!("getStats"in e.RTCRtpReceiver.prototype)){let r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=c(function(){let i=r.apply(this,[]);return i.forEach(a=>a._pc=this),i},"getReceivers")),M(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=c(function(){let i=this;return this._pc.getStats().then(a=>Ee(a,i.track,!1))},"getStats")}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=c(function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let n=arguments[0],i,a,s;return this.getSenders().forEach(o=>{o.track===n&&(i?s=!0:i=o)}),this.getReceivers().forEach(o=>(o.track===n&&(a?s=!0:a=o),o.track===n)),s||i&&a?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():a?a.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)},"getStats")}c(Ie,"shimSenderReceiverGetStats");function Et(e){e.RTCPeerConnection.prototype.getLocalStreams=c(function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])},"getLocalStreams");let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=c(function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let p=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(p)===-1&&this._shimmedLocalStreams[o.id].push(p):this._shimmedLocalStreams[o.id]=[o,p],p},"addTrack");let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=c(function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});let o=this.getSenders();r.apply(this,arguments);let p=this.getSenders().filter(l=>o.indexOf(l)===-1);this._shimmedLocalStreams[s.id]=[s].concat(p)},"addStream");let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=c(function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],n.apply(this,arguments)},"removeStream");let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=c(function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(o=>{let p=this._shimmedLocalStreams[o].indexOf(s);p!==-1&&this._shimmedLocalStreams[o].splice(p,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)},"removeTrack")}c(Et,"shimAddTrackRemoveTrackWithNative");function Le(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Et(e);let r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=c(function(){let f=r.apply(this);return this._reverseStreams=this._reverseStreams||{},f.map(d=>this._reverseStreams[d.id])},"getLocalStreams");let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=c(function(f){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[f.id]){let d=new e.MediaStream(f.getTracks());this._streams[f.id]=d,this._reverseStreams[d.id]=f,f=d}n.apply(this,[f])},"addStream");let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=c(function(f){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[f.id]||f]),delete this._reverseStreams[this._streams[f.id]?this._streams[f.id].id:f.id],delete this._streams[f.id]},"removeStream"),e.RTCPeerConnection.prototype.addTrack=c(function(f,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(S=>S===f))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===f))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let y=this._streams[d.id];if(y)y.addTrack(f),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let S=new e.MediaStream([f]);this._streams[d.id]=S,this._reverseStreams[S.id]=d,this.addStream(S)}return this.getSenders().find(S=>S.track===f)},"addTrack");function a(l,f){let d=f.sdp;return Object.keys(l._reverseStreams||[]).forEach(m=>{let h=l._reverseStreams[m],y=l._streams[h.id];d=d.replace(new RegExp(y.id,"g"),h.id)}),new RTCSessionDescription({type:f.type,sdp:d})}c(a,"replaceInternalStreamId");function s(l,f){let d=f.sdp;return Object.keys(l._reverseStreams||[]).forEach(m=>{let h=l._reverseStreams[m],y=l._streams[h.id];d=d.replace(new RegExp(h.id,"g"),y.id)}),new RTCSessionDescription({type:f.type,sdp:d})}c(s,"replaceExternalStreamId"),["createOffer","createAnswer"].forEach(function(l){let f=e.RTCPeerConnection.prototype[l],d={[l](){let m=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[y=>{let S=a(this,y);m[0].apply(null,[S])},y=>{m[1]&&m[1].apply(null,y)},arguments[2]]):f.apply(this,arguments).then(y=>a(this,y))}};e.RTCPeerConnection.prototype[l]=d[l]});let o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=c(function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=s(this,arguments[0]),o.apply(this,arguments))},"setLocalDescription");let p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let l=p.get.apply(this);return l.type===""?l:a(this,l)}}),e.RTCPeerConnection.prototype.removeTrack=c(function(f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!f._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(f._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let m;Object.keys(this._streams).forEach(h=>{this._streams[h].getTracks().find(S=>f.track===S)&&(m=this._streams[h])}),m&&(m.getTracks().length===1?this.removeStream(this._reverseStreams[m.id]):m.removeTrack(f.track),this.dispatchEvent(new Event("negotiationneeded")))},"removeTrack")}c(Le,"shimAddTrackRemoveTrack");function ie(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!!e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let n=e.RTCPeerConnection.prototype[r],i={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=i[r]})}c(ie,"shimPeerConnection");function je(e,t){M(e,"negotiationneeded",r=>{let n=r.target;if(!((t.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return r})}c(je,"fixNegotiationNeeded");var ce={};q(ce,{shimAddTransceiver:()=>ze,shimCreateAnswer:()=>He,shimCreateOffer:()=>Je,shimGetDisplayMedia:()=>kt,shimGetParameters:()=>Ve,shimGetUserMedia:()=>oe,shimOnTrack:()=>Ae,shimPeerConnection:()=>ae,shimRTCDataChannel:()=>Ge,shimReceiverGetStats:()=>Ne,shimRemoveStream:()=>Ue,shimSenderGetStats:()=>Fe});g();g();function oe(e,t){let r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(i,a,s){F("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(i).then(a,s)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let i=c(function(s,o,p){o in s&&!(p in s)&&(s[p]=s[o],delete s[o])},"remap"),a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),i(s.audio,"autoGainControl","mozAutoGainControl"),i(s.audio,"noiseSuppression","mozNoiseSuppression")),a(s)},n&&n.prototype.getSettings){let s=n.prototype.getSettings;n.prototype.getSettings=function(){let o=s.apply(this,arguments);return i(o,"mozAutoGainControl","autoGainControl"),i(o,"mozNoiseSuppression","noiseSuppression"),o}}if(n&&n.prototype.applyConstraints){let s=n.prototype.applyConstraints;n.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o,"autoGainControl","mozAutoGainControl"),i(o,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[o])}}}}c(oe,"shimGetUserMedia");g();function kt(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=c(function(n){if(!(n&&n.video)){let i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)},"getDisplayMedia"))}c(kt,"shimGetDisplayMedia");function Ae(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}c(Ae,"shimOnTrack");function ae(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let a=e.RTCPeerConnection.prototype[i],s={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=s[i]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=c(function(){let[a,s,o]=arguments;return n.apply(this,[a||null]).then(p=>{if(t.version<53&&!s)try{p.forEach(l=>{l.type=r[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;p.forEach((f,d)=>{p.set(d,Object.assign({},f,{type:r[f.type]||f.type}))})}return p}).then(s,o)},"getStats")}c(ae,"shimPeerConnection");function Fe(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=c(function(){let i=t.apply(this,[]);return i.forEach(a=>a._pc=this),i},"getSenders"));let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=c(function(){let i=r.apply(this,arguments);return i._pc=this,i},"addTrack")),e.RTCRtpSender.prototype.getStats=c(function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)},"getStats")}c(Fe,"shimSenderGetStats");function Ne(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=c(function(){let n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},"getReceivers")),M(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=c(function(){return this._pc.getStats(this.track)},"getStats")}c(Ne,"shimReceiverGetStats");function Ue(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=c(function(r){F("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&r.getTracks().includes(n.track)&&this.removeTrack(n)})},"removeStream"))}c(Ue,"shimRemoveStream");function Ge(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}c(Ge,"shimRTCDataChannel");function ze(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=c(function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];let i=n.length>0;i&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let a=t.apply(this,arguments);if(i){let{sender:s}=a,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(o).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return a},"addTransceiver"))}c(ze,"shimAddTransceiver");function Ve(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=c(function(){let n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n},"getParameters"))}c(Ve,"shimGetParameters");function Je(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=c(function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)},"createOffer")}c(Je,"shimCreateOffer");function He(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=c(function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)},"createAnswer")}c(He,"shimCreateAnswer");var pe={};q(pe,{shimAudioContext:()=>Qe,shimCallbacksAPI:()=>$e,shimConstraints:()=>Mt,shimCreateOfferLegacy:()=>Xe,shimGetUserMedia:()=>Ke,shimLocalStreamsAPI:()=>We,shimRTCIceServerUrls:()=>qe,shimRemoteStreamsAPI:()=>Be,shimTrackEventTransceiver:()=>Ye});g();function We(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=c(function(){return this._localStreams||(this._localStreams=[]),this._localStreams},"getLocalStreams")),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=c(function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},"addStream"),e.RTCPeerConnection.prototype.addTrack=c(function(n,...i){return i&&i.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),t.apply(this,arguments)},"addTrack")}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=c(function(r){this._localStreams||(this._localStreams=[]);let n=this._localStreams.indexOf(r);if(n===-1)return;this._localStreams.splice(n,1);let i=r.getTracks();this.getSenders().forEach(a=>{i.includes(a.track)&&this.removeTrack(a)})},"removeStream"))}}c(We,"shimLocalStreamsAPI");function Be(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=c(function(){return this._remoteStreams?this._remoteStreams:[]},"getRemoteStreams")),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);let a=new Event("addstream");a.stream=i,this.dispatchEvent(a)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=c(function(){let n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(a=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(a)>=0)return;n._remoteStreams.push(a);let s=new Event("addstream");s.stream=a,n.dispatchEvent(s)})}),t.apply(n,arguments)},"setRemoteDescription")}}c(Be,"shimRemoteStreamsAPI");function $e(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=c(function(l,f){let d=arguments.length>=2?arguments[2]:arguments[0],m=r.apply(this,[d]);return f?(m.then(l,f),Promise.resolve()):m},"createOffer"),t.createAnswer=c(function(l,f){let d=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[d]);return f?(m.then(l,f),Promise.resolve()):m},"createAnswer");let o=c(function(p,l,f){let d=i.apply(this,[p]);return f?(d.then(l,f),Promise.resolve()):d},"withCallback");t.setLocalDescription=o,o=c(function(p,l,f){let d=a.apply(this,[p]);return f?(d.then(l,f),Promise.resolve()):d},"withCallback"),t.setRemoteDescription=o,o=c(function(p,l,f){let d=s.apply(this,[p]);return f?(d.then(l,f),Promise.resolve()):d},"withCallback"),t.addIceCandidate=o}c($e,"shimCallbacksAPI");function Ke(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=i=>n(Mt(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=c(function(n,i,a){t.mediaDevices.getUserMedia(n).then(i,a)},"getUserMedia").bind(t))}c(Ke,"shimGetUserMedia");function Mt(e){return e&&e.video!==void 0?Object.assign({},e,{video:_e(e.video)}):e}c(Mt,"shimConstraints");function qe(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=c(function(n,i){if(n&&n.iceServers){let a=[];for(let s=0;s<n.iceServers.length;s++){let o=n.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(F("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,a.push(o)):a.push(n.iceServers[s])}n.iceServers=a}return new t(n,i)},"RTCPeerConnection"),e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}c(qe,"shimRTCIceServerUrls");function Ye(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}c(Ye,"shimTrackEventTransceiver");function Xe(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=c(function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);let i=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);let a=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveVideo===!0&&!a&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)},"createOffer")}c(Xe,"shimCreateOfferLegacy");function Qe(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}c(Qe,"shimAudioContext");var et={};q(et,{removeExtmapAllowMixed:()=>ue,shimAddIceCandidateNullOrEmpty:()=>$,shimConnectionState:()=>fe,shimMaxMessageSize:()=>W,shimParameterlessSetLocalDescription:()=>K,shimRTCIceCandidate:()=>H,shimRTCIceCandidateRelayProtocol:()=>le,shimSendThrowTypeError:()=>B});g();var N=k(we());function H(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=c(function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){let i=new t(n),a=N.default.parseCandidate(n.candidate),s=Object.assign(i,a);return s.toJSON=c(function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},"toJSON"),s}return new t(n)},"RTCIceCandidate"),e.RTCIceCandidate.prototype=t.prototype,M(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}c(H,"shimRTCIceCandidate");function le(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||M(e,"icecandidate",t=>{if(t.candidate){let r=N.default.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}c(le,"shimRTCIceCandidateRelayProtocol");function W(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});let r=c(function(o){if(!o||!o.sdp)return!1;let p=N.default.splitSections(o.sdp);return p.shift(),p.some(l=>{let f=N.default.parseMLine(l);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1})},"sctpInDescription"),n=c(function(o){let p=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;let l=parseInt(p[1],10);return l!==l?-1:l},"getRemoteFirefoxVersion"),i=c(function(o){let p=65536;return t.browser==="firefox"&&(t.version<57?o===-1?p=16384:p=2147483637:t.version<60?p=t.version===57?65535:65536:p=2147483637),p},"getCanSendMaxMessageSize"),a=c(function(o,p){let l=65536;t.browser==="firefox"&&t.version===57&&(l=65535);let f=N.default.matchPrefix(o.sdp,"a=max-message-size:");return f.length>0?l=parseInt(f[0].substr(19),10):t.browser==="firefox"&&p!==-1&&(l=2147483637),l},"getMaxMessageSize"),s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=c(function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let p=n(arguments[0]),l=i(p),f=a(arguments[0],p),d;l===0&&f===0?d=Number.POSITIVE_INFINITY:l===0||f===0?d=Math.max(l,f):d=Math.min(l,f);let m={};Object.defineProperty(m,"maxMessageSize",{get(){return d}}),this._sctp=m}return s.apply(this,arguments)},"setRemoteDescription")}c(W,"shimMaxMessageSize");function B(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(n,i){let a=n.send;n.send=c(function(){let o=arguments[0],p=o.length||o.size||o.byteLength;if(n.readyState==="open"&&i.sctp&&p>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return a.apply(n,arguments)},"send")}c(t,"wrapDcSend");let r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=c(function(){let i=r.apply(this,arguments);return t(i,this),i},"createDataChannel"),M(e,"datachannel",n=>(t(n.channel,n.target),n))}c(B,"shimSendThrowTypeError");function fe(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{let n=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{let a=i.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;let s=new Event("connectionstatechange",i);a.dispatchEvent(s)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}c(fe,"shimConnectionState");function ue(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=c(function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let a=i.sdp.split(`
`).filter(s=>s.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:a}):i.sdp=a}return r.apply(this,arguments)},"setRemoteDescription")}c(ue,"removeExtmapAllowMixed");function $(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let r=e.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=c(function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())},"addIceCandidate"))}c($,"shimAddIceCandidateNullOrEmpty");function K(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let r=e.RTCPeerConnection.prototype.setLocalDescription;!r||r.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=c(function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return r.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?r.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>r.apply(this,[s]))},"setLocalDescription"))}c(K,"shimParameterlessSetLocalDescription");var nr=k(we());function Dt({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let r=re,n=bt(e),i={browserDetails:n,commonShim:et,extractVersion:J,disableLog:Rt,disableWarnings:Pt,sdp:nr};switch(n.browser){case"chrome":if(!se||!ie||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(n.version===null)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=se,$(e,n),K(e,n),ne(e,n),ke(e,n),ie(e,n),Me(e,n),Le(e,n),De(e,n),Oe(e,n),Ie(e,n),je(e,n),H(e,n),le(e,n),fe(e,n),W(e,n),B(e,n),ue(e,n);break;case"firefox":if(!ce||!ae||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=ce,$(e,n),K(e,n),oe(e,n),ae(e,n),Ae(e,n),Ue(e,n),Fe(e,n),Ne(e,n),Ge(e,n),ze(e,n),Ve(e,n),Je(e,n),He(e,n),H(e,n),fe(e,n),W(e,n),B(e,n);break;case"safari":if(!pe||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=pe,$(e,n),K(e,n),qe(e,n),Xe(e,n),$e(e,n),We(e,n),Be(e,n),Ye(e,n),Ke(e,n),Qe(e,n),H(e,n),le(e,n),W(e,n),B(e,n),ue(e,n);break;default:r("Unsupported browser!");break}return i}c(Dt,"adapterFactory");var ir=Dt({window:typeof window>"u"?void 0:window}),Ot=ir;g();var D=k(ut(),1),Ut=k(tr(),1);g();var _=k(ut()),Lt=k(er());var It=function(){var e=c(function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)i.hasOwnProperty(a)&&(n[a]=i[a])},e(t,r)},"extendStatics");return function(t,r){e(t,r);function n(){this.constructor=t}c(n,"__"),t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),tt="html",rt="svg",sr="http://www.w3.org/2000/svg",or=c(function(e,t){if(t===tt)return e instanceof HTMLElement;if(t===rt)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+t+'" for validateElementType.')},"validateElementType"),jt=c(function(e,t){var r={},n,i,a;if(e===tt)a=document.createElement("div");else if(e===rt)a=document.createElementNS(sr,"g");else throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');if(t&&typeof t=="object")for(var s=0,o=Object.entries(t.attributes);s<o.length;s++){var p=o[s],l=p[0],f=p[1];a.setAttribute(l,f)}var d={element:a,elementType:e,setPortalProps:function(m){r=m},getInitialPortalProps:function(){return r},mount:function(m,h){if(h!==i){if(d.unmount(),m!==n&&!or(m,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+m.tagName+">.");m.replaceChild(d.element,h),n=m,i=h}},unmount:function(m){m&&m!==i||n&&i&&(n.replaceChild(i,d.element),n=void 0,i=void 0)}};return d},"createPortalNode"),At=function(e){It(t,e);function t(r){var n=e.call(this,r)||this;return n.addPropsChannel=function(){Object.assign(n.props.node,{setPortalProps:function(i){n.setState({nodeProps:i})}})},n.state={nodeProps:n.props.node.getInitialPortalProps()},n}return c(t,"InPortal"),t.prototype.componentDidMount=function(){this.addPropsChannel()},t.prototype.componentDidUpdate=function(){this.addPropsChannel()},t.prototype.render=function(){var r=this,n=this.props,i=n.children,a=n.node;return Lt.createPortal(_.Children.map(i,function(s){return _.isValidElement(s)?_.cloneElement(s,r.state.nodeProps):s}),a.element)},t}(_.PureComponent),de=function(e){It(t,e);function t(r){var n=e.call(this,r)||this;return n.placeholderNode=_.createRef(),n.passPropsThroughPortal(),n}return c(t,"OutPortal"),t.prototype.passPropsThroughPortal=function(){var r=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(r)},t.prototype.componentDidMount=function(){var r=this.props.node;this.currentPortalNode=r;var n=this.placeholderNode.current,i=n.parentNode;r.mount(i,n),this.passPropsThroughPortal()},t.prototype.componentDidUpdate=function(){var r=this.props.node;this.currentPortalNode&&r!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode.setPortalProps({}),this.currentPortalNode=r);var n=this.placeholderNode.current,i=n.parentNode;r.mount(i,n),this.passPropsThroughPortal()},t.prototype.componentWillUnmount=function(){var r=this.props.node;r.unmount(this.placeholderNode.current),r.setPortalProps({})},t.prototype.render=function(){return _.createElement("div",{ref:this.placeholderNode})},t}(_.PureComponent),Ft=jt.bind(null,tt),fn=jt.bind(null,rt);var Gt=k(wt(),1);var T=k(mt(),1),ar=(0,D.lazy)(()=>import("./chunk-DraggableWindow-JEDFH6W2.mjs")),cr=c(({children:e})=>(0,T.jsx)("div",{css:Gt.css`
height: 100%;
width: 100%;
background-blend-mode: overlay;
background:  repeating-radial-gradient(circle at bottom left, 
              #fedc00 0, #fedc00 5.5555555556%, 
              #fcb712 0, #fcb712 11.1111111111%, 
              #f7921e 0, #f7921e 16.6666666667%, 
            #e87f24 0, #e87f24 22.2222222222%, 
            #dd6227 0, #dd6227 27.7777777778%,
             #dc4c27 0, #dc4c27 33.3333333333%, 
            #ca3435 0, #ca3435 38.8888888889%, 
            #b82841 0, #b82841 44.4444444444%, 
            #953751 0, #953751 50%, #364c88 0, 
            #364c88 55.5555555556%, #16599d 0, 
            #16599d 61.1111111111%, #02609e 0, 
            #02609e 66.6666666667%, #0073a9 0, 
            #0073a9 72.2222222222%, #008aa4 0, 
            #008aa4 77.7777777778%, #239a87 0, 
            #239a87 83.3333333333%, #7cba6d 0, 
            #7cba6d 88.8888888889%, #becc2f 0, 
            #becc2f 94.4444444444%, #e0d81d 0, 
            #e0d81d 100%), 
            repeating-radial-gradient(circle at bottom right, 
              #fedc00 0, #fedc00 5.5555555556%, 
              #fcb712 0, #fcb712 11.1111111111%, 
              #f7921e 0, #f7921e 16.6666666667%, 
              #e87f24 0, #e87f24 22.2222222222%, 
              #dd6227 0, #dd6227 27.7777777778%, 
              #dc4c27 0, #dc4c27 33.3333333333%, 
              #ca3435 0, #ca3435 38.8888888889%, 
              #b82841 0, #b82841 44.4444444444%, 
              #953751 0, #953751 50%,
               #364c88 0, #364c88 55.5555555556%, 
               #16599d 0, #16599d 61.1111111111%, 
               #02609e 0, #02609e 66.6666666667%, 
               #0073a9 0, #0073a9 72.2222222222%, 
               #008aa4 0, #008aa4 77.7777777778%,
                #239a87 0, #239a87 83.3333333333%, 
                #7cba6d 0, #7cba6d 88.8888888889%, 
                #becc2f 0, #becc2f 94.4444444444%, 
                #e0d81d 0, #e0d81d 100%);
`,children:e}),"RainbowContainer"),pr=c(({codeSpace:e})=>{let t=(0,D.useMemo)(()=>Ft({attributes:{style:"height: 100%"}}),[]),n=!(location.pathname.endsWith("public")||location.pathname.endsWith("hydrated"));return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(At,{node:t,children:(0,T.jsx)(ht,{codeSpace:e})}),(0,T.jsx)(D.Suspense,{fallback:(0,T.jsx)(de,{node:t}),children:n?(0,T.jsx)(cr,{children:(0,T.jsxs)(D.Fragment,{children:[(0,T.jsx)(Ct,{codeSpace:e}),(0,T.jsx)(ar,{room:e,children:(0,T.jsx)(de,{node:t})})]})}):(0,T.jsx)("div",{style:{height:100+"%"},children:(0,T.jsx)(de,{node:t})})})]})},"AppToRender"),Nt={started:!1},zt=c(({codeSpace:e,dry:t})=>{if(Nt.started)return;Nt.started=!0;let r=document.querySelector("#root");r.style.height="100%",(0,Ut.createRoot)(r).render((0,T.jsx)(D.StrictMode,{children:(0,T.jsx)(pr,{codeSpace:e})}))},"renderPreviewWindow");g();g();g();var me,lr=new Uint8Array(16);function nt(){if(!me&&(me=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!me))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return me(lr)}c(nt,"rng");g();var b=[];for(let e=0;e<256;++e)b.push((e+256).toString(16).slice(1));function Vt(e,t=0){return(b[e[t+0]]+b[e[t+1]]+b[e[t+2]]+b[e[t+3]]+"-"+b[e[t+4]]+b[e[t+5]]+"-"+b[e[t+6]]+b[e[t+7]]+"-"+b[e[t+8]]+b[e[t+9]]+"-"+b[e[t+10]]+b[e[t+11]]+b[e[t+12]]+b[e[t+13]]+b[e[t+14]]+b[e[t+15]]).toLowerCase()}c(Vt,"unsafeStringify");g();g();var fr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),it={randomUUID:fr};function ur(e,t,r){if(it.randomUUID&&!t&&!e)return it.randomUUID();e=e||{};let n=e.random||(e.rng||nt)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(let i=0;i<16;++i)t[r+i]=n[i];return t}return Vt(n)}c(ur,"v4");var st=ur;var Jt=st;var Wt=new I((e,t)=>e===t?0:e<t?1:-1,!0),Ce=[],R=ve((self&&self.crypto&&self.crypto.randomUUID&&self.crypto.randomUUID()||Jt()).slice(0,8));Wt.insert(R);var C={},he,O,Ht="",G="",ge="",Bt=0,pt=0,P=null,$t,A=!1,dr={},x={localStream:null,webRtcArray:Ce,tracks:dr,user:R,vidElement:document.createElement("video"),stopVideo:Cr,startVideo:yr,rtcConns:C,send(e){let t=JSON.stringify({...e,name:e.name||R});Ce.map(r=>{try{if(r.readyState!=="open")return;(!e.target||r.target===e.target&&!z.includes(r.target))&&r.send(t)}catch{}})}};x.vidElement.playsInline=!0;x.vidElement.autoplay=!0;Object.assign(globalThis,{sendChannel:x,mST:L});var Yn=c(async e=>{let{mST:t,dry:r,address:n}=e;O=e.codeSpace,ft(O,{name:R,state:t},location.origin),location.pathname===`/live/${O}`&&zt({codeSpace:O,dry:!!r}),await Kt(),console.log("broadcastChannel"),he=new BroadcastChannel(location.origin),he.postMessage({user:R,type:"suggestNeighborsRequest"}),he.onmessage=async i=>{if(!(i.data.ignoreUser&&i.data.ignoreUser===R)&&(i.data.user!==R&&i.data.type,i.data.codeSpace===O&&i.data.address&&!n&&P?.send(JSON.stringify({codeSpace:O,address:i.data.address})),i.data.ignoreUser&&!z.includes(i.data.ignoreUser)&&z.push(i.data.ignoreUser),i.data.codeSpace===O&&i.data.sess.code!==L().code)){let a=Pe(i.data.sess);a&&await Te(a)}},lt(()=>{hr(),mr();let i=L(),a=ve(JSON.stringify(i));a!==Ht&&(Ht=a,he.postMessage({ignoreUser:R,sess:i,codeSpace:O,address:n}))},"broadcast")},"run"),ot;async function U(){return!A||P===null?(P=null,await Kt()):P}c(U,"rejoin");var z=[],mr=(0,ct.default)(Sr,100,{trailing:!0,leading:!0,maxWait:500}),hr=(0,ct.default)(gr,1200,{trailing:!0,leading:!0,maxWait:2500});async function gr(){try{if(P){if(G===E())return;let e=L(),t=await Re(G,e);if(!t||t.newHash!==E())return;let r=JSON.stringify({...t,name:R});$t(r)}else A=!1,await U()}catch{}}c(gr,"syncWS");async function Cr(){x.localStream}c(Cr,"stopVideo");async function yr(){console.log({adapter:Ot});let e=await navigator.mediaDevices.getSupportedConstraints();console.log({supported:e});let t={audio:!1,video:!0},r=await navigator.mediaDevices.getUserMedia(t);n(r);function n(i){let a=x.vidElement,s=i.getVideoTracks();console.log("Got stream with constraints:",t),console.log(`Using video device: ${s[0].label}`),x.localStream=i,a.srcObject=i}c(n,"handleSuccess"),r.getVideoTracks().forEach(i=>Object.keys(x.rtcConns).map(a=>{x.rtcConns[a].addTrack(i)}))}c(yr,"startVideo");async function Sr(){try{if(Object.keys(C).length>0){if(ge===E())return;let e=L(),t=ge?Re(ge,e):Pe(e);t!==null&&t.patch&&x.send(t)}}catch{}}c(Sr,"syncRTC");async function Kt(){if(P!==null)return P;if(A=!0,location.origin.includes("localhost"))return;let e=new WebSocket(`wss://${location.host}/live/`+O+"/websocket");return A=!1,e.addEventListener("open",()=>{P=e,e.onclose=()=>U(),$t=c(n=>{try{P?.readyState===P?.OPEN?P&&P?.send&&P?.send(n):U()}catch{P=null,A=!1,U()}},"mess");let r=Object.assign(e,{hashCode:E()});return P.addEventListener("message",n=>qt(n,"ws",r)),ot&&clearInterval(ot),ot=setInterval(()=>{let i=Date.now()-pt;if(i>4e4)try{if(e.readyState===e.OPEN){e?.send(JSON.stringify({name:R,timestamp:Bt+i}));return}A=!1,U()}catch{A=!1,U()}},3e4),e.send(JSON.stringify({name:R,hashCode:E()})),e}),e}c(Kt,"join");var at={};async function qt(e,t,r){console.log({event:e}),pt=Date.now(),console.log(typeof e.data);let n=JSON.parse(e.data);console.log("WSWSWS",{data:n}),vr(n,t,r)}c(qt,"processWsMessage");async function vr(e,t,r){if(t==="ws"&&e.timestamp&&(pt=Date.now(),Bt=e.timestamp),(e.hashCode||e.newHash&&r)&&(r.hashCode=e.hashCode||e.newHash),t==="ws"&&e.hashCode&&(G=e.hashCode),t==="ws"&&e.hashCode&&(G=e.hashCode),(t==="rtc"&&e.hashCode||e.newHash)&&(ge=e.hashCode||e.newHash),z.includes(e.name)||e.newHash===E())return;if(e.oldHash&&e.newHash){if(at[e.oldHash]&&at[e.oldHash]===e.newHash)return;at[e.oldHash]=e.newHash}if(e.newHash===E())return;if((async()=>{try{if(e.type==="new-ice-candidate"){await Tr(e.candidate,e.name);return}if(e.type==="video-offer"){await a(e.offer,e.name);return}if(e.type==="video-answer"){await i(e.answer,e.name);return}if(e.name&&e.name!==R&&!C[e.name]&&!z.includes(e.name)){await n(e.name);let o=e.users.filter(p=>p!==R&&!z.includes(p));for(;o.length;){let p=o.pop();p&&!x.rtcConns[p]&&n(p),await dt(500)}return}}catch{}})(),e.patch&&e.name!==R){if(e.newHash===E())return;if(await Te(e),e.newHash===E()){x&&x.send({hashCode:e.newHash});return}return}if(e.patch&&e.name===R){G=e.newHash;return}if(e.name===R)return;E();function n(s){if(C[s])return;C[s]=new RTCPeerConnection(Yt),C[s].onicecandidate=h=>{h.candidate&&P?.send(JSON.stringify({type:"new-ice-candidate",target:s,name:R,candidate:h.candidate.toJSON()}))},C[s].oniceconnectionstatechange=d,C[s].onicegatheringstatechange=m,C[s].onsignalingstatechange=()=>{switch(C[s].signalingState){case"closed":break}},C[s].onnegotiationneeded=f,C[s].ontrack=function(h){console.log("OnTack event ",h);let y=document.createElement("video");y.autoplay=!0,y.playsInline=!0;let S;if(h.streams&&h.streams[0])y.srcObject=h.streams[0],S=h.streams[0];else{let V=new MediaStream;V.addTrack(h.track),y.srcObject=V,S=V}h.track.onended=()=>y.srcObject=null,x.tracks[s]={track:h.track,streams:[S],vidElement:y}},C[s].ondatachannel=async h=>{let y=new AbortController,S=await gt(O,L().i,y.signal),V=S.valueOf();console.log({js:S}),Wt.insert(s),h.channel.send(V);let ye=h.channel;ye.binaryType="arraybuffer",ye.addEventListener("close",l),x&&x.localStream&&x.localStream.active&&x.localStream.getTracks().forEach(Se=>{C[s].addTrack(Se)}),ye.addEventListener("message",async Se=>qt(Se,"rtc",Object.assign(p,{hashCode:E()})));let Xt=Object.assign(p,{target:s});Ce.push(Xt)};let o={ordered:!0,reliable:!0,maxPacketLifeTime:3e3},p=Object.assign(C[s].createDataChannel(s,o),{target:s});return p.binaryType="arraybuffer",p.addEventListener("error",h=>{console.log("xxxxxx-  Data Channel Error:",h)}),p.addEventListener("open",()=>{Ce.push(p)}),p.addEventListener("close",()=>{}),C[s];function l(){C[s].close(),delete C[s]}c(l,"onReceiveChannelClosed");async function f(){try{let h=await C[s].createOffer();if(C[s].signalingState!="stable")return;await C[s].setLocalDescription(h),P?.send(JSON.stringify({target:s,name:R,type:"video-offer",offer:C[s].localDescription}))}catch{}}c(f,"handleNegotiationNeededEvent");function d(){switch(C[s].iceConnectionState){case"closed":case"failed":case"disconnected":break}}c(d,"handleICEConnectionStateChangeEvent");function m(){}c(m,"handleICEGatheringStateChangeEvent")}c(n,"createPeerConnection");async function i(s,o){C[o].signalingState!=="stable"&&await C[o].setRemoteDescription(new RTCSessionDescription(s)).catch(console.error)}c(i,"handleChatAnswerMessage");async function a(s,o){C[o]||n(o),await C[o].setRemoteDescription(new RTCSessionDescription(s));let p=await C[o].createAnswer();await C[o].setLocalDescription(p),P?.send(JSON.stringify({target:o,name:R,type:"video-answer",answer:p}))}c(a,"handleChatOffer")}c(vr,"processData");var Yt={iceServers:["stun3.l.google.com:19302"].map(e=>({urls:`stun:${e}`}))};Yt.iceServers=[{urls:"stun:stun.stunprotocol.org:3478"},{urls:"stun:stun.l.google.com:19302"}];async function Tr(e,t){let r=new RTCIceCandidate(e);await C[t].addIceCandidate(r)}c(Tr,"handleNewICECandidateMessage");export{x as a,Yn as b,Kt as c};
