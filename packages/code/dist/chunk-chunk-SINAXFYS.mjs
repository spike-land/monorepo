import{a as it}from"./chunk-chunk-25XHPSDO.mjs";import{a as qt,c as at,d as Vt,e as Bt,f as Gt,g as Kt,h as Xt,i as Yt,j as Qt,k as Re}from"./chunk-chunk-3MUKUM7Q.mjs";import{e as Zt,f as er}from"./chunk-chunk-6DVZZJG6.mjs";import{a as Wt,b as k,e as R,f as d,g as ke,h as A,i as xe,j as Ee,k as Be,l as Ge}from"./chunk-chunk-L2U7Q2OG.mjs";import{b as Ke}from"./chunk-chunk-66EYGUWD.mjs";import{B as $,C as J,H as te,L as ot,M as z,N as Pe,O as F,a as Xe,d as _e,f as Ye,g as Qe,i as Ze,k as et,m as tt,n as rt,u as U,z as nt}from"./chunk-chunk-CE3G72A7.mjs";import{b as Se,d as S,e as Ve,j as l}from"./chunk-chunk-FWOMBYHR.mjs";var ut=Se(X=>{"use strict";l();Object.defineProperty(X,"__esModule",{value:!0});F();at();var W=Qt();Vt();qt();Bt();Gt();Kt();Xt();Yt();var K=(er(),Ve(Zt)),nr=K.Fragment;function or(t,e,r){return W.hasOwnProperty.call(e,"css")?K.jsx(W.Emotion,W.createEmotionProps(t,e),r):K.jsx(t,e,r)}function ar(t,e,r){return W.hasOwnProperty.call(e,"css")?K.jsxs(W.Emotion,W.createEmotionProps(t,e),r):K.jsxs(t,e,r)}X.Fragment=nr;X.jsx=or;X.jsxs=ar});var j=Se((Vr,dt)=>{"use strict";l();dt.exports=ut()});var wt=Se((Zr,gt)=>{"use strict";l();var mt=Function.prototype.toString,V=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Ne,oe;if(typeof V=="function"&&typeof Object.defineProperty=="function")try{Ne=Object.defineProperty({},"length",{get:function(){throw oe}}),oe={},V(function(){throw 42},null,Ne)}catch(t){t!==oe&&(V=null)}else V=null;var sr=/^\s*class\b/,Oe=function(e){try{var r=mt.call(e);return sr.test(r)}catch{return!1}},He=function(e){try{return Oe(e)?!1:(mt.call(e),!0)}catch{return!1}},ae=Object.prototype.toString,cr="[object Object]",lr="[object Function]",fr="[object GeneratorFunction]",ur="[object HTMLAllCollection]",dr="[object HTML document.all class]",pr="[object HTMLCollection]",hr=typeof Symbol=="function"&&!!Symbol.toStringTag,mr=!(0 in[,]),De=function(){return!1};typeof document=="object"&&(ht=document.all,ae.call(ht)===ae.call(document.all)&&(De=function(e){if((mr||!e)&&(typeof e>"u"||typeof e=="object"))try{var r=ae.call(e);return(r===ur||r===dr||r===pr||r===cr)&&e("")==null}catch{}return!1}));var ht;gt.exports=V?function(e){if(De(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{V(e,null,Ne)}catch(r){if(r!==oe)return!1}return!Oe(e)&&He(e)}:function(e){if(De(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(hr)return He(e);if(Oe(e))return!1;var r=ae.call(e);return r!==lr&&r!==fr&&!/^\[object HTML/.test(r)?!1:He(e)}});l();F();F();l();F();F();var st=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Te="html",Fe="svg",tr="http://www.w3.org/2000/svg",rr=function(t,e){if(e===Te)return t instanceof HTMLElement;if(e===Fe)return t instanceof SVGElement;throw new Error('Unrecognized element type "'+e+'" for validateElementType.')},ct=function(t,e){var r={},n,o,i;if(t===Te)i=document.createElement("div");else if(t===Fe)i=document.createElementNS(tr,"g");else throw new Error('Invalid element type "'+t+'" for createPortalNode: must be "html" or "svg".');if(e&&typeof e=="object")for(var a=0,s=Object.entries(e.attributes);a<s.length;a++){var c=s[a],m=c[0],u=c[1];i.setAttribute(m,u)}var N={element:i,elementType:t,setPortalProps:function(_){r=_},getInitialPortalProps:function(){return r},mount:function(_,C){if(C!==o){if(N.unmount(),_!==n&&!rr(_,t))throw new Error('Invalid element type for portal: "'+t+'" portalNodes must be used with '+t+" elements, but OutPortal is within <"+_.tagName+">.");_.replaceChild(N.element,C),n=_,o=C}},unmount:function(_){_&&_!==o||n&&o&&(n.replaceChild(o,N.element),n=void 0,o=void 0)}};return N},lt=function(t){st(e,t);function e(r){var n=t.call(this,r)||this;return n.addPropsChannel=function(){Object.assign(n.props.node,{setPortalProps:function(o){n.setState({nodeProps:o})}})},n.state={nodeProps:n.props.node.getInitialPortalProps()},n}return e.prototype.componentDidMount=function(){this.addPropsChannel()},e.prototype.componentDidUpdate=function(){this.addPropsChannel()},e.prototype.render=function(){var r=this,n=this.props,o=n.children,i=n.node;return ot(Xe.map(o,function(a){return tt(a)?Qe(a,r.state.nodeProps):a}),i.element)},e}(_e),re=function(t){st(e,t);function e(r){var n=t.call(this,r)||this;return n.placeholderNode=et(),n.passPropsThroughPortal(),n}return e.prototype.passPropsThroughPortal=function(){var r=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(r)},e.prototype.componentDidMount=function(){var r=this.props.node;this.currentPortalNode=r;var n=this.placeholderNode.current,o=n.parentNode;r.mount(o,n),this.passPropsThroughPortal()},e.prototype.componentDidUpdate=function(){var r=this.props.node;this.currentPortalNode&&r!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode.setPortalProps({}),this.currentPortalNode=r);var n=this.placeholderNode.current,o=n.parentNode;r.mount(o,n),this.passPropsThroughPortal()},e.prototype.componentWillUnmount=function(){var r=this.props.node;r.unmount(this.placeholderNode.current),r.setPortalProps({})},e.prototype.render=function(){return Ze("div",{ref:this.placeholderNode})},e}(_e),ft=ct.bind(null,Te),$r=ct.bind(null,Fe);l();F();l();F();var q=S(j(),1),je=class extends z.Component{constructor(e){super(e),this.state={error:void 0,errorInfo:void 0}}componentDidCatch(e,r){this.setState({error:e,errorInfo:r})}render(){return this.state.errorInfo?(0,q.jsxs)("div",{children:[(0,q.jsx)("h2",{children:"Something went wrong."}),(0,q.jsxs)("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),(0,q.jsx)("br",{}),this.state.errorInfo.componentStack]})]}):this.props.children}},pt=je;var D=S(Re(),1);l();var Me=S(at(),1),ir=Me.default.default||Me.default,ne=ir;var vt=S(wt(),1),y=S(j(),1),gr=t=>window.importShim?window.importShim(t):import(t);Object.assign(globalThis,{apps:{},eCaches:{}});var{apps:M,eCaches:Y}=globalThis||globalThis.apps,Ct=({hash:t,codeSpace:e})=>{let[r,n]=J(k(d().transpiled).slice(0,8));U(()=>{let s=k(d().transpiled).slice(0,8);s!==r&&n(s)},[t]);let o=$(null),i=d().transpiled,a=M[k(i).slice(0,8)];return(0,y.jsx)(pt,{ref:o,children:(0,y.jsx)(a,{appId:`${e}-${r}`})},r)},yt=!1;async function B(t="",e){let{transpiled:r,i:n}=d(),o=t.length>0?t:r,i=k(o).slice(0,8);if(!M[i])try{console.log(`i: ${n}: `);let a=(await gr(wr(o))).default;if((0,vt.default)(a))Y[i]=ne({key:"z",speedy:!1}),Y[i].compat=void 0,M[i]=({appId:s})=>s.includes(i)?(0,y.jsx)(D.CacheProvider,{value:Y[i],children:(0,y.jsx)("div",{css:D.css`height: 100%;`,id:s,children:(0,y.jsx)(a,{})})}):null;else throw new Error("the default export is not a function!")}catch(a){if(a instanceof SyntaxError){let s=a.name,c=a.message;M[i]=()=>(0,y.jsxs)("div",{css:D.css`background-color: orange;`,children:[(0,y.jsx)("h1",{children:"Syntax Error"}),(0,y.jsxs)("h2",{children:[s,": ",c]}),(0,y.jsx)("p",{children:JSON.stringify({err:a})})]})}else if(a instanceof Error){let s=a.name,c=a.message;M[i]=()=>(0,y.jsxs)("div",{css:D.css`background-color: orange;`,children:[(0,y.jsx)("h1",{children:"Syntax Error"}),(0,y.jsxs)("h2",{children:[s,": ",c]}),(0,y.jsx)("p",{children:JSON.stringify({err:a})})]})}else M[i]=()=>(0,y.jsx)("div",{css:D.css`background-color: orange;`,children:(0,y.jsxs)("h1",{children:["Unknown Error: $",i]})})}return!yt&&e&&(yt=!0,await bt({codeSpace:e})),M[i]}function wr(t,e="index.mjs"){let r=new File([t],e,{type:"application/javascript",lastModified:Date.now()});return URL.createObjectURL(r)}var ve=S(Re(),1);l();F();l();l();var Ue=S(Wt(),1);l();l();function St(t,e=r=>r.key){var r=[];return Ie(t,"",!0,n=>r.push(n),e),r.join("")}function Ie(t,e,r,n,o){if(t){n(`${e}${r?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 "}${o(t)}
`);let i=e+(r?"    ":"\u2502   ");t.left&&Ie(t.left,i,!1,n,o),t.right&&Ie(t.right,i,!0,n,o)}}function ie(t){if(t===null)return!0;var e=se(t.left),r=se(t.right);return!!(Math.abs(e-r)<=1&&ie(t.left)&&ie(t.right))}function se(t){return t?1+Math.max(se(t.left),se(t.right)):0}function ce(t,e,r,n,o){let i=o-n;if(i>0){let a=n+Math.floor(i/2),s=e[a],c=r[a],m={key:s,data:c,parent:t};return m.left=ce(m,e,r,n,a),m.right=ce(m,e,r,a+1,o),m}return null}function le(t){if(t===null)return 0;let e=le(t.left),r=le(t.right);return t.balanceFactor=e-r,Math.max(e,r)+1}function fe(t,e,r,n,o){if(r>=n)return;let i=t[r+n>>1],a=r-1,s=n+1;for(;;){do a++;while(o(t[a],i)<0);do s--;while(o(t[s],i)>0);if(a>=s)break;let c=t[a];t[a]=t[s],t[s]=c,c=e[a],e[a]=e[s],e[s]=c}fe(t,e,r,s,o),fe(t,e,s+1,n,o)}function yr(t,e){return t>e?1:t<e?-1:0}function ue(t){var e=t.right;return t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent,e.parent&&(e.parent.left===t?e.parent.left=e:e.parent.right=e),t.parent=e,e.left=t,t.balanceFactor+=1,e.balanceFactor<0&&(t.balanceFactor-=e.balanceFactor),e.balanceFactor+=1,t.balanceFactor>0&&(e.balanceFactor+=t.balanceFactor),e}function de(t){var e=t.left;return t.left=e.right,t.left&&(t.left.parent=t),e.parent=t.parent,e.parent&&(e.parent.left===t?e.parent.left=e:e.parent.right=e),t.parent=e,e.right=t,t.balanceFactor-=1,e.balanceFactor>0&&(t.balanceFactor-=e.balanceFactor),e.balanceFactor-=1,t.balanceFactor<0&&(e.balanceFactor+=t.balanceFactor),e}var I=class{constructor(e,r=!1){this._comparator=e||yr,this._root=null,this._size=0,this._noDuplicates=!!r}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(e){if(this._root)for(var r=this._root,n=this._comparator;r;){var o=n(e,r.key);if(o===0)return!0;o<0?r=r.left:r=r.right}return!1}next(e){var r=e;if(r)if(r.right)for(r=r.right;r.left;)r=r.left;else for(r=e.parent;r&&r.right===e;)e=r,r=r.parent;return r}prev(e){var r=e;if(r)if(r.left)for(r=r.left;r.right;)r=r.right;else for(r=e.parent;r&&r.left===e;)e=r,r=r.parent;return r}forEach(e){for(var r=this._root,n=[],o=!1,i=0;!o;)r?(n.push(r),r=r.left):n.length>0?(r=n.pop(),e(r,i++),r=r.right):o=!0;return this}range(e,r,n,o){let i=[],a=this._comparator,s=this._root,c;for(;i.length!==0||s;)if(s)i.push(s),s=s.left;else{if(s=i.pop(),c=a(s.key,r),c>0)break;if(a(s.key,e)>=0&&n.call(o,s))return this;s=s.right}return this}keys(){for(var e=this._root,r=[],n=[],o=!1;!o;)e?(r.push(e),e=e.left):r.length>0?(e=r.pop(),n.push(e.key),e=e.right):o=!0;return n}values(){for(var e=this._root,r=[],n=[],o=!1;!o;)e?(r.push(e),e=e.left):r.length>0?(e=r.pop(),n.push(e.data),e=e.right):o=!0;return n}at(e){for(var r=this._root,n=[],o=!1,i=0;!o;)if(r)n.push(r),r=r.left;else if(n.length>0){if(r=n.pop(),i===e)return r;i++,r=r.right}else o=!0;return null}minNode(){var e=this._root;if(!e)return null;for(;e.left;)e=e.left;return e}maxNode(){var e=this._root;if(!e)return null;for(;e.right;)e=e.right;return e}min(){var e=this._root;if(!e)return null;for(;e.left;)e=e.left;return e.key}max(){var e=this._root;if(!e)return null;for(;e.right;)e=e.right;return e.key}isEmpty(){return!this._root}pop(){var e=this._root,r=null;if(e){for(;e.left;)e=e.left;r={key:e.key,data:e.data},this.remove(e.key)}return r}popMax(){var e=this._root,r=null;if(e){for(;e.right;)e=e.right;r={key:e.key,data:e.data},this.remove(e.key)}return r}find(e){for(var r=this._root,n=r,o,i=this._comparator;n;){if(o=i(e,n.key),o===0)return n;o<0?n=n.left:n=n.right}return null}insert(e,r){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:e,data:r},this._size++,this._root;var n=this._comparator,o=this._root,i=null,a=0;if(this._noDuplicates)for(;o;){if(a=n(e,o.key),i=o,a===0)return null;a<0?o=o.left:o=o.right}else for(;o;)a=n(e,o.key),i=o,a<=0?o=o.left:o=o.right;var s={left:null,right:null,balanceFactor:0,parent:i,key:e,data:r},c;for(a<=0?i.left=s:i.right=s;i&&(a=n(i.key,e),a<0?i.balanceFactor-=1:i.balanceFactor+=1,i.balanceFactor!==0);){if(i.balanceFactor<-1){i.right.balanceFactor===1&&de(i.right),c=ue(i),i===this._root&&(this._root=c);break}else if(i.balanceFactor>1){i.left.balanceFactor===-1&&ue(i.left),c=de(i),i===this._root&&(this._root=c);break}i=i.parent}return this._size++,s}remove(e){if(!this._root)return null;for(var r=this._root,n=this._comparator,o=0;r&&(o=n(e,r.key),o!==0);)o<0?r=r.left:r=r.right;if(!r)return null;var i=r.key,a,s;if(r.left){for(a=r.left;a.left||a.right;){for(;a.right;)a=a.right;r.key=a.key,r.data=a.data,a.left&&(r=a,a=a.left)}r.key=a.key,r.data=a.data,r=a}if(r.right){for(s=r.right;s.left||s.right;){for(;s.left;)s=s.left;r.key=s.key,r.data=s.data,s.right&&(r=s,s=s.right)}r.key=s.key,r.data=s.data,r=s}for(var c=r.parent,m=r,u;c&&(c.left===m?c.balanceFactor-=1:c.balanceFactor+=1,c.balanceFactor<-1?(c.right.balanceFactor===1&&de(c.right),u=ue(c),c===this._root&&(this._root=u),c=u):c.balanceFactor>1&&(c.left.balanceFactor===-1&&ue(c.left),u=de(c),c===this._root&&(this._root=u),c=u),!(c.balanceFactor===-1||c.balanceFactor===1));)m=c,c=c.parent;return r.parent&&(r.parent.left===r?r.parent.left=null:r.parent.right=null),r===this._root&&(this._root=null),this._size--,i}load(e=[],r=[],n){if(this._size!==0)throw new Error("bulk-load: tree is not empty");let o=e.length;return n&&fe(e,r,0,o-1,this._comparator),this._root=ce(null,e,r,0,o),le(this._root),this._size=o,this}isBalanced(){return ie(this._root)}toString(e){return St(this._root,e)}};I.default=I;l();var pe,br=new Uint8Array(16);function vr(){if(!pe&&(pe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!pe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return pe(br)}var Cr=/^(?:[\da-f]{8}-[\da-f]{4}-[1-5][\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}|0{8}-(?:0{4}-){3}0{12})$/i;function Sr(t){return typeof t=="string"&&Cr.test(t)}var b=[];for(let t=0;t<256;++t)b.push((t+256).toString(16).slice(1));function kr(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(b[t[e+0]]+b[t[e+1]]+b[t[e+2]]+b[t[e+3]]+"-"+b[t[e+4]]+b[t[e+5]]+"-"+b[t[e+6]]+b[t[e+7]]+"-"+b[t[e+8]]+b[t[e+9]]+"-"+b[t[e+10]]+b[t[e+11]]+b[t[e+12]]+b[t[e+13]]+b[t[e+14]]+b[t[e+15]]).toLowerCase();if(!Sr(r))throw new TypeError("Stringified UUID is invalid");return r}function kt(t,e,r){t=t||{};let n=t.random||(t.rng||vr)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(let o=0;o<16;++o)e[r+o]=n[o];return e}return kr(n)}l();async function O(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}var xr=new I((t,e)=>t===e?0:t<e?1:-1,!0),ge=[],x=(self&&self.crypto&&self.crypto.randomUUID&&self.crypto.randomUUID()||kt()).slice(0,8);xr.insert(x);var f={},Q,H,xt="",G=0,he=0,Et=0,$e=0,v=null,_t,L=!1,we={},T={localStream:null,webRtcArray:ge,tracks:we,user:x,rtcConns:f,send(t){let e=JSON.stringify({...t,name:t.name||x});ge.map(r=>{try{if(r.readyState!=="open")return;(!t.target||r.target===t.target&&!Z.includes(r.target))&&r.send(e)}catch{}})}};Object.assign(globalThis,{sendChannel:T});var En=async t=>{let{mST:e,address:r}=t;H=t.codeSpace,Q=new BroadcastChannel(location.origin),!(location.pathname.endsWith("dehydrated")&&(Q.onmessage=n=>{n.data.codeSpace===H&&console.log(n.data)}))&&(Be(H,{name:x,state:e},location.origin),await B(e.transpiled,H),await Rt(),Q=new BroadcastChannel(location.origin),Q.onmessage=async n=>{if(!(n.data.ignoreUser&&n.data.ignoreUser===x)&&(n.data.codeSpace===H&&n.data.address&&!r&&v?.send(JSON.stringify({codeSpace:H,address:n.data.address})),n.data.ignoreUser&&!Z.includes(n.data.ignoreUser)&&Z.push(n.data.ignoreUser),n.data.codeSpace===H&&n.data.sess.code!==d().code)){let o=await Ee(n.data.sess);await ke(o)}},A(()=>{let n=d(),o=k(JSON.stringify(n));o!==xt&&(xt=o,Q.postMessage({ignoreUser:x,sess:n,codeSpace:H,address:r}))},"broadcast"))},Le=null;async function me(){return!L||v===null?(v=null,await Rt()):v}var Z=[];function Pt(){_r(),Er()}var Er=(0,Ue.default)(Rr,100,{trailing:!0,leading:!0,maxWait:500}),_r=(0,Ue.default)(Pr,1200,{trailing:!0,leading:!0,maxWait:2500});async function Pr(){try{if(v){if(G===R())return;let t=d(),e=await xe(G,t);if(!e||e.newHash!==R())return;let r=JSON.stringify({...e,name:x});_t(r)}else L=!1,await me()}catch{}}var _n=async()=>{!T.localStream||T.localStream.getTracks().map(t=>t.stop())},Pn=async t=>{let e={audio:!0,video:!0},r=await navigator.mediaDevices.getUserMedia(e);t.srcObject=r,r.getTracks().forEach(n=>Object.keys(T.rtcConns).map(o=>{let i=T.rtcConns[o];i.addTrack(n),i.ontrack=({track:a,streams:s})=>we[o]={track:a,streams:s}}))};async function Rr(){try{if(Object.keys(f).length>0){if(he===R())return;let t=d(),e=he?await xe(he,t):await Ee(t);e&&e.patch&&T.send(e)}}catch{}}async function Rt(){if(v!==null)return v;if(L=!0,location.origin.includes("localhost"))return;let t=new WebSocket(`wss://${location.host}/live/`+H+"/websocket");return L=!1,t.addEventListener("open",()=>{v=t,_t=n=>{try{v&&v?.send&&v?.send(n)}catch{v=null,L=!1,me()}};let r=Object.assign(t,{hashCode:R()});return v.addEventListener("message",n=>Tt(n,"ws",r)),Le&&clearInterval(Le),Le=setInterval(()=>{let o=Date.now()-$e;if(o>4e4)try{if(t.readyState===t.OPEN){t?.send(JSON.stringify({name:x,timestamp:Et+o}));return}L=!1,me()}catch{L=!1,me()}},3e4),t.send(JSON.stringify({name:x})),t}),t}var Ae={};async function Tt(t,e,r){if(v==null)return;$e=Date.now();let n=JSON.parse(t.data);Tr(n,e,r)}async function Tr(t,e,r){if(e==="ws"&&t.timestamp&&($e=Date.now(),Et=t.timestamp),(t.hashCode||t.newHash&&r)&&(r.hashCode=t.hashCode||t.newHash),e==="ws"&&t.hashCode&&(G=t.hashCode),e==="ws"&&t.hashCode&&(G=t.hashCode),(e==="rtc"&&t.hashCode||t.newHash)&&(he=t.hashCode||t.newHash),Z.includes(t.name)||t.newHash===R())return;if(t.oldHash&&t.newHash){if(Ae[t.oldHash]&&Ae[t.oldHash]===t.newHash)return;Ae[t.oldHash]=t.newHash}if(t.newHash===R())return;if((async()=>{try{if(t.type==="new-ice-candidate"){await Fr(t.candidate,t.name);return}if(t.type==="video-offer"){await i(t.offer,t.name);return}if(t.type==="video-answer"){await o(t.answer,t.name);return}if(t.name&&t.name!==x&&!f[t.name]&&!Z.includes(t.name)){await n(t.name);let a=t.users;for(;a.length;){await O(2e3);let s=a.pop();s&&!T.rtcConns[s]&&await n(s)}return}}catch{}})(),t.patch&&t.name!==x){if(t.newHash===R())return;if(await ke(t),t.newHash===R()){T&&T.send({hashCode:t.newHash});return}return}if(t.patch&&t.name===x){G=t.newHash;return}if(t.name===x)return;R();function n(a){if(f[a])return;f[a]=new RTCPeerConnection(Ft),f[a].onicecandidate=C=>{C.candidate&&v?.send(JSON.stringify({type:"new-ice-candidate",target:a,name:x,candidate:C.candidate.toJSON()}))},f[a].oniceconnectionstatechange=N,f[a].onicegatheringstatechange=_,f[a].onsignalingstatechange=()=>{switch(f[a].signalingState){case"closed":break}},f[a].onnegotiationneeded=u,f[a].ontrack=function({track:C,streams:P}){we[a]={track:C,streams:P}},f[a].ondatachannel=C=>{let P=C.channel;P.binaryType="arraybuffer",P.addEventListener("close",m),T&&T.localStream&&T.localStream.active&&T.localStream.getTracks().forEach(Ce=>{let qe=f[a];qe.addTrack(Ce),qe.ontrack=({track:Jt,streams:zt})=>we[a]={track:Jt,streams:zt}}),P.addEventListener("message",async Ce=>Tt(Ce,"rtc",Object.assign(P,{hashCode:R()})));let $t=Object.assign(P,{target:a});ge.push($t)};let s={ordered:!0,reliable:!0,maxPacketLifeTime:3e3},c=Object.assign(f[a].createDataChannel(a,s),{target:a});return c.binaryType="arraybuffer",c.addEventListener("error",C=>{console.log("xxxxxx-  Data Channel Error:",C)}),c.addEventListener("open",()=>{ge.push(c)}),c.addEventListener("close",()=>{}),f[a];function m(){f[a].close(),delete f[a]}async function u(){try{let C=await f[a].createOffer();if(f[a].signalingState!="stable")return;await f[a].setLocalDescription(C),v?.send(JSON.stringify({target:a,name:x,type:"video-offer",offer:f[a].localDescription}))}catch{}}function N(){switch(f[a].iceConnectionState){case"closed":case"failed":case"disconnected":break}}function _(){}}async function o(a,s){await f[s].setRemoteDescription(new RTCSessionDescription(a)).catch(console.error)}async function i(a,s){f[s]||n(s),await f[s].setRemoteDescription(new RTCSessionDescription(a));let c=await f[s].createAnswer();await f[s].setLocalDescription(c),v?.send(JSON.stringify({target:s,name:x,type:"video-answer",answer:c}))}}var Ft={iceServers:["stun3.l.google.com:19302"].map(t=>({urls:`stun:${t}`}))};Ft.iceServers=[{urls:"stun:stun.stunprotocol.org:3478"},{urls:"stun:stun.l.google.com:19302"}];async function Fr(t,e){let r=new RTCIceCandidate(t);await f[e].addIceCandidate(r)}async function Rn(){try{if(navigator.serviceWorker.onmessage=async t=>{let e=t.source;if(e!=null)switch(t.data.method){case"ipfs-message-port":let r=new MessageChannel;e.postMessage({method:"ipfs-message-port",id:t.data.id,port:r.port2},{transfer:[r.port2]})}},document.documentElement.dataset.viewer){await(async e=>{switch((e&&e.split("/")||[])[0]||""){case"ipfs":case"ipns":document.body.innerHTML=`<iframe id="viewer" style="width:100%;height:100%;position:fixed;top:0;left:0;border:none;" src="/view${e}"></iframe>`}})(location.pathname);return}}catch{}}l();var E={printR(t,e){if(e[t])return"";e[t]=!0;let r=E.data[E.hashMap[t]],n=r.code;return!r.deps||!r.deps.length?n:[...r.deps].map(a=>E.printR(a,e)).join(` 
 `)+`
    
    `+n},async toJs(t){let e=E.printR(t,{}),r=Object.keys(E.data).map(s=>[`"${E.hashMap[s]}"`,s.replace(/[^a-f]/g,"")]).map(s=>s[0]+": "+s[1]).join(`, 
 `),n=`
     ${e}
  function require(name){
    return ({${r}})[name];
  }
  globalThis.UMD_require = require;
  
     `,{transform:o}=await import("./chunk-esbuildEsm-D7PZNTRQ.mjs"),i=await o(n,{format:"esm",minify:!0,keepNames:!0,platform:"browser",treeShaking:!0});return(await o(i.code,{format:"iife",minify:!0,keepNames:!0,platform:"browser",treeShaking:!0})).code},hashMap:{},data:{}},Je=async(t,e)=>{let{transform:r}=await import("./chunk-esbuildEsm-D7PZNTRQ.mjs"),n=k(t);if(E.hashMap={...E.hashMap,[n]:e,[e]:n},!E.data[n]){let o=await r(t,{format:"iife",keepNames:!0,treeShaking:!0,target:"es2018",loader:e.includes(".tsx")?"tsx":e.includes(".ts")?"ts":e.includes(".jsx")?"jsx":"js",globalName:n.replace(/[^a-f]/g,"")});if(!o||!o.code){console.log("transform result -code is empty");return}E.data={...E.data,[n]:{...o,deps:jr(o.code)}},await Promise.all(E.data[n].deps.map(async i=>{if(E.hashMap[i])return;let a=JSON.parse(document.querySelector("script[type=importmap]").innerHTML),s="",c="";if(a.imports[i])s=a.imports[i],c=k(i);else if(i.startsWith("./"))s=new URL(i,location.origin).toString(),c=k(i);else try{s=await import.meta.resolve(i,e),c=k(i)}catch{console.error(`failed to resolve: ${i}`);return}if(E.hashMap[c])return;E.hashMap[i]=s;let m=await(await fetch(s)).text();return Je(m,i)}))}return E},jr=t=>{let e=/require\("(.+?)"\)/gm,r,n=[];for(;(r=e.exec(t))!==null;){r.index===e.lastIndex&&e.lastIndex++;for(let[o,i]of r.entries())o==1&&n.push(i),console.log(`Found match, group ${o}: ${i}`)}return n};l();F();F();var ye=S(j(),1),p={md5Hash:"",wait:1,res:null,codeSpace:"",waitForDiv:async()=>{let t=p.md5Hash;return p.res?.innerHTML||await jt(),p.res?.innerHTML.includes(t)||await jt(),p.res?.innerHTML.includes(t)||(console.log(`waiting ${p.wait} for ${p.md5Hash} `),await O(p.wait)),p.res?.innerHTML.includes(t)?p.res.innerHTML:(p.wait=p.wait*2,await p.waitForDiv())},setHash:null,setApp:t=>{let e=document.createElement("div");e.style.visibility="hidden",e.style.position="absolute",document.body.appendChild(e);let r=te(e);return r.render((0,ye.jsx)(Hr,{md5Hash:t})),()=>{r.unmount,document.body.removeChild(e),e.remove(),delete M[t],p.setHash=null}}},Mt=async(t,e)=>{p.codeSpace=e;let r=k(t).slice(0,8);M[r]||await B(t),p.wait=1;let n=p.setApp(r);try{let o=await p.waitForDiv();if(!o)return{html:null,css:null};let i=Mr(Y[r]),a=document.querySelector("style[data-emotion=z-global]")?.innerHTML;return{html:o,css:a+" "+i}}finally{n()}};function Mr(t){let e=Object.keys(t.inserted).map(r=>`.${t.key}-${r}`);return Array.from(document.styleSheets).map(r=>r.cssRules[0]).filter(r=>r&&e.includes(r.selectorText)).map(r=>r.cssText).join(`
`)}var Hr=({md5Hash:t})=>{let e=$(null),[r,n]=J(t);U(()=>{e?.current&&(p.res=e.current),p.md5Hash=r,p.setHash=i=>n(i)},[e,r,n]);let o=M[r];return(0,ye.jsx)("div",{ref:e,children:(0,ye.jsx)(o,{appId:`${p.codeSpace}-${r}`},r)})},jt=()=>{let t;console.log("wait for animation");let e=new Promise(r=>t=r);return requestAnimationFrame(()=>t(!0)),e};var be={code:"",olderCode:""};async function ze({code:t,counter:e,codeSpace:r}){be.code=t;let n=d();if(console.log(`${n.i} => ${e}`),!(e<n.i)){setTimeout(()=>{be.code===t&&t!==be.olderCode&&ze({code:t,counter:e,codeSpace:r}),be.olderCode=t},1e3);try{let o=await it(t,{loader:"tsx",format:"esm",treeShaking:!0,minify:!0,keepNames:!0,tsconfigRaw:{compilerOptions:{jsx:"react-jsx",module:"ESNext",jsxFragmentFactory:"Fragment",jsxImportSource:"@emotion/react"}},target:"es2018"});Object.assign(globalThis,{umdExp:async()=>{console.log("to UMD");let u=await Je(o.code,`${r}.tsx`);console.log({UMD:u}),N("coder.js",await u?.toJs(`${r}.tsx`));function N(_,C){var P=document.createElement("a");P.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(C)),P.setAttribute("download",_),P.style.display="none",document.body.appendChild(P),P.click(),document.body.removeChild(P)}}});let a=k(t).slice(0,8),s=`${o.code}//${a}`,{html:c,css:m}=await Mt(s,r);if(console.log({html:c,css:m}),!c)return;Ge({...d(),code:t,i:e,transpiled:s,html:c,css:m}),Pt()}catch(o){console.error({error:o})}finally{}}}F();var Dt=S(Re(),1);l();function Ht(){let t=/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.userAgent.indexOf("SAMSUNG")===-1,e=!1;return function(r){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[23]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(r.slice(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e&&!t}l();var Ot=async t=>Nr().prettierJs(t),We=null,Nt={prettierJs:async t=>{let e=performance.now();We=We||(await import("./chunk-prettierEsm-TP7AMCUV.mjs")).prettierJs;let r=performance.now();console.log(`importing took ${r-e} milliseconds.`);let n=We(t),o=performance.now();return console.log(`prettier took ${o-r} milliseconds.`),n}},ee=null;function Nr(){if(ee)return ee;if(!Or())return ee=Nt;try{let t=new SharedWorker(new URL("prettierWorker.mjs",location.origin),{type:"module"});return ee=Ke(t.port)}catch{return ee=Nt}}function Or(){let t=!1,e={get type(){return t=!0,"module"}};try{new Worker("blob://",e)}finally{return t}}var At=S(j(),1),h={CH(){},getValue:async()=>"",setValue:async t=>{t.length<10&&console.log(t)},getErrors:async()=>[],code:"",counter:0,codeSpace:"",lastKeyDown:0,codeToSet:""},It=({codeSpace:t})=>{let e=$(null),{i:r,code:n}=d(),[o,i]=z.useState({lastKeyDown:0,myCode:n,counter:r,started:!1,onChange(u){},engine:Ht()?"ace":"monaco"});h.counter=d().i,h.codeSpace=t;let{myCode:a,started:s,engine:c,onChange:m}=o;return h.code=a,z.useEffect(()=>{!e?.current||s||(c==="monaco"?Dr():Ir()).then(u=>Object.assign(h,u)).then(()=>i(u=>({...u,started:!0})))},[s,e]),z.useEffect(()=>{h.getErrors().then(console.log),m(()=>h.getValue().then(()=>i(u=>({...u,counter:h.counter,myCode:h.code}))))},[m,a,i]),A(()=>{h.counter>=d().i||(h.counter=d().i,h.code=d().code,h.setValue(h.code),i(u=>({...u,counter:h.counter,myCode:h.code})))},"editor"),(0,At.jsx)("div",{onKeyDown:()=>h.lastKeyDown=Date.now(),id:"editor",css:Dt.css`          
      max-width: 640px;
      height: 100%; 
      `,ref:e})};async function Lt(t){let e=await Ot(t);if(e===h.code)return;let r=++h.counter;h.code=e,ze({code:e,counter:r,codeSpace:h.codeSpace})}async function Dr(){let t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.href=location.origin+"/Editor.css",document.head.append(t);let{startMonaco:e}=await import("./chunk-startMonaco-TZZX7EX2.mjs"),r=window.document.getElementById("editor");return e({container:r,name:h.codeSpace,code:d().code,onChange:Lt})}async function Ir(){let{startAce:t}=await import("./chunk-startAce-FV3SITGG.mjs");return await O(100),await t(d().code,Lt)}var g=S(j(),1),Lr=rt(()=>O(1e3).then(()=>import("./chunk-DraggableWindow-JW3B2TSZ.mjs"))),Ar=({children:t})=>(0,g.jsx)("div",{css:ve.css`
height: 100%;
width: 100%;
background-blend-mode: overlay;
background:  repeating-radial-gradient(circle at bottom left, 
              #fedc00 0, #fedc00 5.5555555556%, 
              #fcb712 0, #fcb712 11.1111111111%, 
              #f7921e 0, #f7921e 16.6666666667%, 
            #e87f24 0, #e87f24 22.2222222222%, 
            #dd6227 0, #dd6227 27.7777777778%,
             #dc4c27 0, #dc4c27 33.3333333333%, 
            #ca3435 0, #ca3435 38.8888888889%, 
            #b82841 0, #b82841 44.4444444444%, 
            #953751 0, #953751 50%, #364c88 0, 
            #364c88 55.5555555556%, #16599d 0, 
            #16599d 61.1111111111%, #02609e 0, 
            #02609e 66.6666666667%, #0073a9 0, 
            #0073a9 72.2222222222%, #008aa4 0, 
            #008aa4 77.7777777778%, #239a87 0, 
            #239a87 83.3333333333%, #7cba6d 0, 
            #7cba6d 88.8888888889%, #becc2f 0, 
            #becc2f 94.4444444444%, #e0d81d 0, 
            #e0d81d 100%), 
            repeating-radial-gradient(circle at bottom right, 
              #fedc00 0, #fedc00 5.5555555556%, 
              #fcb712 0, #fcb712 11.1111111111%, 
              #f7921e 0, #f7921e 16.6666666667%, 
              #e87f24 0, #e87f24 22.2222222222%, 
              #dd6227 0, #dd6227 27.7777777778%, 
              #dc4c27 0, #dc4c27 33.3333333333%, 
              #ca3435 0, #ca3435 38.8888888889%, 
              #b82841 0, #b82841 44.4444444444%, 
              #953751 0, #953751 50%,
               #364c88 0, #364c88 55.5555555556%, 
               #16599d 0, #16599d 61.1111111111%, 
               #02609e 0, #02609e 66.6666666667%, 
               #0073a9 0, #0073a9 72.2222222222%, 
               #008aa4 0, #008aa4 77.7777777778%,
                #239a87 0, #239a87 83.3333333333%, 
                #7cba6d 0, #7cba6d 88.8888888889%, 
                #becc2f 0, #becc2f 94.4444444444%, 
                #e0d81d 0, #e0d81d 100%);
`,children:t}),Ur=({codeSpace:t})=>{let e=R(),[r,n]=J(e),o=location.pathname.endsWith("public")||location.pathname.endsWith("hydrated");U(()=>{A(async()=>{let a=R();if(r!==a)try{await B(),n(a)}catch(s){console.error({e:s})}},"myApp")},[r,n]);let i=nt(()=>ft({attributes:{id:`root-${t}`,style:"height: 100%"}}),[]);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(lt,{node:i,children:(0,g.jsx)(Ct,{hash:r,codeSpace:t})}),o?(0,g.jsx)(re,{node:i}):(0,g.jsx)(Ye,{fallback:(0,g.jsx)(re,{node:i}),children:(0,g.jsx)(Ar,{children:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(It,{codeSpace:t}),(0,g.jsx)(Lr,{room:t,children:(0,g.jsx)(re,{node:i})})]})})})]})},Ut={started:!1},bt=({codeSpace:t})=>{if(Ut.started)return;Ut.started=!0;let e=document.querySelector("#root"),r=te(e),n=ne({key:"root"});r.render((0,g.jsx)(ve.CacheProvider,{value:n,cj:!0,children:(0,g.jsx)(Ur,{codeSpace:t})}))};export{j as a,bt as b,T as c,En as d,Pt as e,_n as f,Pn as g,Rt as h,Rn as i,Mt as j,It as k};
