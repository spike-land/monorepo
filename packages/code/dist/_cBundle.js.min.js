const V=async()=>{const n=window.JSFrame,t=new n,e=t.create({name:"Root",title:"React Component",left:20,top:100,width:300,height:200,minWidth:200,minHeight:110,appearanceName:"yosemite",appearanceParam:{titleBar:{greenButton:"fullscreen"}},html:'<div style="font-size:16px"><div id=root></div></div>'}).show();e.setControl({maximizeButton:"zoomButton",maximizeParam:{fullScreen:!0,restoreKey:"Escape"},demaximizeButton:"dezoomButton",deminimizeButton:"deminimizeButton",hideButton:"minimizeButton",hideParam:{align:"ABSOLUTE",offset:{x:100,y:500},duration:300},dehideParam:{duration:300},styleDisplay:"inline",animation:!0,animationDuration:100}),e.control.on("maximized",(r,s)=>{console.log("'maximized' event fired.The window was maximized."),r.on("#bg","dblclick",function(i,o){i.control.doCommand("restore")})}),e.control.on("demaximized",(r,s)=>{console.log("'demaximized' event fired.The window is now back to its original size from its maximized state.")}),e.control.on("hid",(r,s)=>{console.log("'hid' event fired.The window was hidden.")}),e.control.on("dehided",(r,s)=>{console.log("'dehided' event fired.A hidden window has appeared.")})},J=async({onChange:n,code:t,language:e})=>{const r=window.document.getElementById("container");if(!r){const o=B.getElementById("container");o.id="container",B.body.appendChild(o)}if(window.monaco===void 0){const o="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs",{require:l}=await q("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js");l.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs"}}),await new Promise(c=>l(["vs/editor/editor.main"],d=>{c(d)}))}const s=window.monaco,i={monaco:s,editor:s.editor.create(window.document.getElementById("container"),{formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;}",mouseWheelZoom:!1,wordWrapColumn:80,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",padding:{bottom:300},lineNumbers:"on",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:s.editor.createModel(t,e,s.Uri.parse(e==="typescript"?"file:///main.tsx":"file:///main.html")),value:t,language:e,theme:"vs-dark"})};if(i.editor.onDidChangeModelContent(()=>n(i.editor.getValue())),i.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),e==="typescript"){const o=[{name:"react",url:"https://unpkg.com/@types/react@16.9.56/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@16.9.56/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@16.9.9/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@3.0.5/index.d.ts",depend:[]},{name:"@emotion/styled/base.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/styled/index.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/cache/index.d.ts",url:"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts",depend:["@emotion/utils"]},{name:"@emotion/react/index.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/index.d.ts",depend:["@emotion/cache"]},{name:"@emotion/react/jsx-namespace.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/jsx-namespace.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/css-prop.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/css-prop.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/helper.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/helper.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/theming.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/theming.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/serialize/index.d.ts",url:"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/utils/index.d.ts",url:"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts",depend:[]}],l=o.map(({name:c,url:d})=>(async()=>i.monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(d)).text(),c.includes("@emotion")?`file:///node_modules/${c}`:`file:///node_modules/@types/${c}/index.d.ts`))());return i.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:i.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:i.monaco.languages.typescript.ModuleResolutionKind.NodeJs,module:i.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:i.monaco.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",jsxFragmentFactory:"React.Fragment",esModuleInterop:!0}),await Promise.all(l),i.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),i}};function q(n){return new Promise(function(t,e){var r;r=window.document.createElement("script"),r.src=n,r.onload=()=>t(window),r.onerror=e,window.document.head.appendChild(r)})}const D=async n=>B.querySelector(`script[src="${n}"]`)||new Promise(function(t,e){const r=window.document.createElement("script");r.src=n,r.onload=t,r.onerror=e,window.document.head.appendChild(r)}),$=`import React from "react";
import ReactDOM from "react-dom"
/** @jsx jsx */
import styled from "@emotion/styled"

const Counter = () => {
  const [clicks, setClicks] = React.useState(0);

  return <Container>
    <Button css={\`background: green\`} onClick={() => setClicks(clicks - 1)}>-</Button>
    {clicks}
    <Button css={\`background: red\`} onClick={() => setClicks(clicks + 1)}>+</Button>
  </Container>
}

const Container = styled.div\`
  margin: 2em;
  max-width: 400px;
  background: white;
  border: 6px solid grey;
  border-radius: 20px;
  padding: 1rem;
 \`

const Button = styled.button\`
  text-align: center;
  display: inline-block;
  border-radius: 6px;
  padding: 0.5rem 0;
  margin: 0.5rem 1rem;
  width: 3rem;
  color: white;
  border: none;
  :focus{
    outline: none;
  }
  \`

const elementToRender = document.getElementById("root");
ReactDOM.render(<Counter />, elementToRender);


`,C=-1;function A({text1:n,text2:t,cursorPos:e}){if(n===t)return n?[[0,n]]:[];if(e){const l=ee(n,t,e);if(l)return l}let r=R(n,t);const s=n.substring(0,r);n=n.substring(r),t=t.substring(r),r=T(n,t);const i=n.substring(n.length-r);n=n.substring(0,n.length-r),t=t.substring(0,t.length-r);const o=X(n,t);return s&&o.unshift([0,s]),i&&o.push([0,i]),F(o),o}function X(n,t){let e;if(!n)return[[1,t]];if(!t)return[[C,n]];const r=n.length>t.length?n:t,s=n.length>t.length?t:n,i=r.indexOf(s);if(i!==-1)return e=[[1,r.substring(0,i)],[0,s],[1,r.substring(i+s.length)]],n.length>t.length&&(e[0][0]=e[2][0]=C),e;if(s.length===1)return[[C,n],[1,t]];const o=G(n,t);if(o){const l=o[0]||"",c=o[1]||"",d=o[2]||"",a=o[3]||"",u=o[4]||"",h=A({text1:l,text2:d,cursorPos:0}),m=A({text1:c,text2:a,cursorPos:0});return h.concat([[0,u[1]]],m)}return K(n,t)}function K(n,t){const e=n.length,r=t.length,s=Math.ceil((e+r)/2),i=s,o=2*s,l=new Array(o),c=new Array(o);for(let f=0;f<o;f++)l[f]=-1,c[f]=-1;l[i+1]=0,c[i+1]=0;const d=e-r,a=d%2!==0;let u=0,h=0,m=0,p=0;for(let f=0;f<s;f++){for(let g=-f+u;g<=f-h;g+=2){const y=s+g;let w;g===-f||g!==f&&l[y-1]<l[y+1]?w=l[y+1]:w=l[y-1]+1;let k=w-g;for(;w<e&&k<r&&n.charAt(w)===t.charAt(k);)w++,k++;if(l[y]=w,w>e)h+=2;else if(k>r)u+=2;else if(a){const S=s+d-g;if(S>=0&&S<o&&c[S]!==-1){const M=e-c[S];if(w>=M)return O(n,t,w,k)}}}let b;for(let g=-f+m;g<=f-p;g+=2){const y=s+g;g===-f||g!==f&&c[y-1]<c[y+1]?b=c[y+1]:b=c[y-1]+1;let w=b-g;for(;b<e&&w<r&&n.charAt(e-b-1)===t.charAt(r-w-1);)b++,w++;if(c[y]=b,b>e)p+=2;else if(w>r)m+=2;else if(!a){const k=s+d-g;if(k>=0&&k<o&&l[k]!==-1){const S=l[k],M=s+S-k;if(b=e-b,S>=b)return O(n,t,S,M)}}}}return[[C,n],[1,t]]}function O(n,t,e,r){const s=n.substring(0,e),i=t.substring(0,r),o=n.substring(e),l=t.substring(r),c=A({text1:s,text2:i,cursorPos:0}),d=A({text1:o,text2:l,cursorPos:0});return c.concat(d)}function R(n,t){if(!n||!t||n.charAt(0)!==t.charAt(0))return 0;let e=0,r=Math.min(n.length,t.length),s=r,i=0;for(;e<s;)n.substring(i,s)==t.substring(i,s)?(e=s,i=e):r=s,s=Math.floor((r-e)/2+e);return x(n.charCodeAt(s-1))&&s--,s}function T(n,t){if(!n||!t||n.slice(-1)!==t.slice(-1))return 0;let e=0,r=Math.min(n.length,t.length),s=r,i=0;for(;e<s;)n.substring(n.length-s,n.length-i)==t.substring(t.length-s,t.length-i)?(e=s,i=e):r=s,s=Math.floor((r-e)/2+e);return H(n.charCodeAt(n.length-s))&&s--,s}function G(n,t){const e=n.length>t.length?n:t,r=n.length>t.length?t:n;if(e.length<4||r.length*2<e.length)return null;function s(m,p,f){const b=m.substring(f,f+Math.floor(m.length/4));let g=-1,y="",w,k,S,M;for(;(g=p.indexOf(b,g+1))!==-1;){const L=R(m.substring(f),p.substring(g)),I=T(m.substring(0,f),p.substring(0,g));y.length<I+L&&(y=p.substring(g-I,g)+p.substring(g,g+L),w=m.substring(0,f-I),k=m.substring(f+L),S=p.substring(0,g-I),M=p.substring(g+L))}return y.length*2>=m.length?[w,k,S,M,y]:null}const i=s(e,r,Math.ceil(e.length/4)),o=s(e,r,Math.ceil(e.length/2));let l;if(o===null&&i===null)return null;if(o===null){if(i===null)return null;l=i}else if(i===null){if(o===null)return null;l=o}else l=i[4].length>o[4].length?i:o;let c,d,a,u;n.length>t.length?(c=l[0],d=l[1],a=l[2],u=l[3]):(a=l[0],u=l[1],c=l[2],d=l[3]);const h=l[4];return[c,d,a,u,h]}function F(n){const t=[...n];t.push([0,""]);let e=0,r=0,s=0,i="",o="",l,c;for(;e<t.length;){if(e<t.length-1&&!t[e][1]){t.splice(e,1);continue}switch(t[e][0]){case 1:s++,o+=t[e][1],e++;break;case C:r++,i+=t[e][1],e++;break;case 0:if(c=e-s-r-1,e<t.length-1&&!t[e][1]){t.splice(e,1);break}if(i.length>0||o.length>0){i.length>0&&o.length>0&&(l=R(o,i),l!==0&&(c>=0?t[c][1]+=o.substring(0,l):(t.splice(0,0,[0,o.substring(0,l)]),e++),o=o.substring(l),i=i.substring(l)),l=T(o,i),l!==0&&(t[e][1]=o.substring(o.length-l)+t[e][1],o=o.substring(0,o.length-l),i=i.substring(0,i.length-l)));const a=s+r;i.length===0&&o.length===0?(t.splice(e-a,a),e=e-a):i.length===0?(t.splice(e-a,a,[1,o]),e=e-a+1):o.length===0?(t.splice(e-a,a,[C,i]),e=e-a+1):(t.splice(e-a,a,[C,i],[1,o]),e=e-a+2)}e!==0&&t[e-1][0]===0?(t[e-1][1]+=t[e][1],t.splice(e,1)):e++,s=0,r=0,i="",o="";break}}t[t.length-1][1]===""&&t.pop();let d=!1;for(e=1;e<t.length-1;)t[e-1][0]===0&&t[e+1][0]===0&&(t[e][1].substring(t[e][1].length-t[e-1][1].length)===t[e-1][1]?(t[e][1]=t[e-1][1]+t[e][1].substring(0,t[e][1].length-t[e-1][1].length),t[e+1][1]=t[e-1][1]+t[e+1][1],t.splice(e-1,1),d=!0):t[e][1].substring(0,t[e+1][1].length)==t[e+1][1]&&(t[e-1][1]+=t[e+1][1],t[e][1]=t[e][1].substring(t[e+1][1].length)+t[e+1][1],t.splice(e+1,1),d=!0)),e++;return d?F(t):t}function x(n){return n>=55296&&n<=56319}function H(n){return n>=56320&&n<=57343}function Q(n){return H(n.charCodeAt(0))}function Z(n){return x(n.charCodeAt(n.length-1))}function Y(n){const t=[];for(let e=0;e<n.length;e++)n[e][1].length>0&&t.push(n[e]);return t}function z(n,t,e,r){return Z(n)||Q(r)?null:Y([[0,n],[C,t],[1,e],[0,r]])}function ee(n,t,e){const r=typeof e=="number"?{index:e,length:0}:e.oldRange,s=typeof e=="number"?null:e.newRange,i=n.length,o=t.length;if(r.length===0&&(s===null||s.length===0)){const l=r.index,c=n.slice(0,l),d=n.slice(l),a=s?s.index:null;e:{const u=l+o-i;if(a!==null&&a!==u)break e;if(u<0||u>o)break e;const h=t.slice(0,u),m=t.slice(u);if(m!==d)break e;const p=Math.min(l,u),f=c.slice(0,p),b=h.slice(0,p);if(f!==b)break e;const g=c.slice(p),y=h.slice(p);return z(f,g,y,d)}e:{if(a!==null&&a!==l)break e;const u=l,h=t.slice(0,l),m=t.slice(l);if(h!==c)break e;const p=Math.min(i-l,o-l),f=d.slice(d.length-p),b=m.slice(m.length-p);if(f!==b)break e;const g=d.slice(0,d.length-p),y=m.slice(0,m.length-p);return z(c,g,y,f)}}if(r.length>0&&s&&s.length===0){e:{const l=n.slice(0,r.index),c=n.slice(r.index+r.length),d=l.length,a=c.length;if(o<d+a)break e;const u=t.slice(0,d),h=t.slice(o-a);if(l!==u||c!==h)break e;const m=n.slice(d,i-a),p=t.slice(d,o-a);return z(l,m,p,c)}}return null}function P(n,t,e){return A({text1:n,text2:t,cursorPos:e})}P.INSERT=1,P.DELETE=C,P.EQUAL=0;const B=window.document;let W=!0,v=0,N=0,E="",_="",U="",j="";export async function run(){const n=D("https://unpkg.com/jsframe.js@1.6.2/lib/jsframe.min.js");await D("https://unpkg.com/@babel/standalone@7.12.6/babel.min.js"),window.css=window.emotionReact.css,window.jsx=window.emotionReact.jsx,window.styled=window.emotionStyled,setTimeout(async()=>{await n,V()}),(async()=>{const s=e();j=s;let i;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)&&(await Promise.all([D("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"),D("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js")]),B.getElementById("ace").style.setProperty("display","block"),B.getElementById("container").style.setProperty("display","none"),i=window.ace.edit("ace"),i.setTheme("ace/theme/monokai"),i.session.setMode("ace/mode/typescript"),i.setValue(s));const o=await J({language:"typescript",code:s,onChange:l});i&&i.session.on("change",function(){const a=i.getValue();o.editor.setValue(a),l(a)});function l(a){if(!o)return;if(E=a,!v)d(E);else{const u=a,h=setInterval(()=>{(a!==E||!v)&&clearInterval(h),v||d(E)},100)}}async function c(){if(!o||!o.monaco)return;const a=o.monaco.Uri.parse("file:///main.tsx"),u=await o.monaco.languages.typescript.getTypeScriptWorker(),h=await(await u(a)).getSemanticDiagnostics("file:///main.tsx"),m=await(await u(a)).getCompilerOptionsDiagnostics("file:///main.tsx"),p=await(await u(a)).getSyntacticDiagnostics("file:///main.tsx");return[...h,...m,...p]}async function d(a){if(v===1)return;try{v=1;const u=await c(),h=B.getElementById("error");if(v=0,a!==E)return;if(u&&u.length){if(E!=a)return;if(_===a)return;B.getElementById("root").classList.add("transparent");const m=P(j,a,0);if(m.length<=3){o.monaco.editor.setTheme("hc-black");return}h.innerHTML=u[0].messageText.toString(),B.getElementById("root").style.setProperty("dispay","none"),h.style.display="block",_=a,o.monaco.editor.setTheme("vs-light"),setTimeout(()=>{o.monaco.editor.setTheme("hc-black")},N++);return}j=a,h.style.display="none",o.monaco.editor.setTheme("vs-dark"),B.getElementById("root").classList.remove("transparent"),N=0,v=0,t(r(a))}catch(u){if(v=0,a!==E)return;o.monaco.editor.setTheme("vs-light"),setTimeout(()=>{o.monaco.editor.setTheme("hc-black")},10),console.error(u)}}})(),t(r(e())),B.getElementById("root").setAttribute("style","display:block");async function t(s){console.log(s);const i=new Function("transpileCode",`return function(){ 
        ${s} 
    }`)();if(!W){const o=async c=>{if(c!==j)return;if(U===c)return;U=c;const d={codeTranspiled:s,code:j},a=JSON.stringify(d),u=new Request("https://code.zed.vision",{body:a,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),h=await fetch(u),{hash:m}=await h.json();try{const p=window.localStorage,f=p.getItem("codeBoXHash");f!==m&&(p.setItem("codeBoXHash",m),p.setItem(m,j),window.history.pushState({},"","/?h="+m))}catch(p){console.log("no localStorage")}},l=E;setTimeout(()=>o(E),500)}W=!1,i()}function e(){const s=new URLSearchParams(window.location.search),i=s.get("h")||localStorage.getItem("codeBoXHash");return i&&window.localStorage.getItem(i)||window.localStorage.getItem("STARTER")||$}function r(s){return window.Babel.transform(s,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(/import/gi,"///")}}
