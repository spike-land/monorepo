const E=async n=>new Promise(function(e,t){const s=window.document.createElement("script");s.src=n,s.onload=e,s.onerror=t,window.document.head.appendChild(s)}),J=async()=>{const n=await E("https://unpkg.com/interactjs@1.10.0/dist/interact.min.js"),e=window.interact;e(".draggable").draggable({inertia:!0,modifiers:[e.modifiers.restrictRect({restriction:"parent",endOnly:!0})],autoScroll:!1,listeners:{move:q}})};function q(n){const e=n.target,t=(parseFloat(e.getAttribute("data-x"))||0)+n.dx,s=(parseFloat(e.getAttribute("data-y"))||0)+n.dy;e.style.webkitTransform=e.style.transform="translate("+t+"px, "+s+"px)",e.setAttribute("data-x",t),e.setAttribute("data-y",s)}const k={},X=async({onChange:n,code:e,language:t})=>{const s=window.document.getElementById("container");if(!s){const o=B.getElementById("container");o.id="container",B.body.appendChild(o)}if(window.monaco===void 0){const o="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs",{require:r}=await $("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js");r.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs"}}),await new Promise(a=>r(["vs/editor/editor.main"],i=>{k.monaco=i,a(i)}))}else return k;if(k.editor=k.monaco.editor.create(window.document.getElementById("container"),{cursorStyle:"block",formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!0},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;}",mouseWheelZoom:!1,wordWrapColumn:80,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",padding:{bottom:300},lineNumbers:"on",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:k.monaco.editor.createModel(e,t,k.monaco.Uri.parse(t==="typescript"?"file:///main.tsx":"file:///main.html")),value:e,language:t,theme:"vs-dark"}),k.editor.onDidChangeModelContent(()=>n(k.editor.getValue())),k.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),t==="typescript"){const o=[{name:"react",url:"https://unpkg.com/@types/react@latest/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@latest/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@latest/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@latest/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@latest/index.d.ts",depend:[]},{name:"@emotion/styled/base.d.ts",url:"https://unpkg.com/@emotion/styled@latest/types/base.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/styled/index.d.ts",url:"https://unpkg.com/@emotion/styled@latest/types/index.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/cache/index.d.ts",url:"https://unpkg.com/@emotion/cache@latest/types/index.d.ts",depend:["@emotion/utils"]},{name:"@emotion/react/index.d.ts",url:"https://unpkg.com/@emotion/react@latest/types/index.d.ts",depend:["@emotion/cache"]},{name:"@emotion/react/jsx-namespace.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/jsx-namespace.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/css-prop.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/css-prop.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/helper.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/helper.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/theming.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/theming.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/serialize/index.d.ts",url:"https://unpkg.com/@emotion/serialize@latest/types/index.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/utils/index.d.ts",url:"https://unpkg.com/@emotion/utils@latest/types/index.d.ts",depend:[]}];console.log(o);const r=o.map(({name:a,url:i})=>(async()=>k.monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(i)).text(),a.includes("@emotion")?`file:///node_modules/${a}`:`file:///node_modules/@types/${a}/index.d.ts`))());return k.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:k.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:k.monaco.languages.typescript.ModuleResolutionKind.NodeJs,module:k.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:k.monaco.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",jsxFragmentFactory:"React.Fragment",esModuleInterop:!0}),await Promise.all(r),k.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),k}};function $(n){return new Promise(function(e,t){var s;s=window.document.createElement("script"),s.src=n,s.onload=()=>e(window),s.onerror=t,window.document.head.appendChild(s)})}const G=`import React from "react";
import ReactDOM from "react-dom"
/** @jsx jsx */
import styled from "@emotion/styled"

const Counter = () => {
  const [clicks, setClicks] = React.useState(0);

  return <Container>
    <Button css={\`background: green\`} onClick={() => setClicks(clicks - 1)}>-</Button>
    {clicks}
    <Button css={\`background: red\`} onClick={() => setClicks(clicks + 1)}>+</Button>
  </Container>
}

const Container = styled.div\`
  background: white;
  border: 6px solid grey;
  border-radius: 20px;
  padding: 1rem;
 \`

const Button = styled.a\`
  text-align: center;
  display: inline-block;
  border-radius: 6px;
  padding: 0.5rem 0;
  margin: 0.5rem 1rem;
  width: 3rem;
  background: transparent;
  color: white;
  border: 2px solid white;
  \`

const elementToRender = document.getElementById("root");
ReactDOM.render(<Counter />, elementToRender);


`,M=-1;function L({text1:n,text2:e,cursorPos:t}){if(n===e)return n?[[0,n]]:[];if(t){const i=ne(n,e,t);if(i)return i}let s=P(n,e);const o=n.substring(0,s);n=n.substring(s),e=e.substring(s),s=T(n,e);const r=n.substring(n.length-s);n=n.substring(0,n.length-s),e=e.substring(0,e.length-s);const a=K(n,e);return o&&a.unshift([0,o]),r&&a.push([0,r]),W(a),a}function K(n,e){let t;if(!n)return[[1,e]];if(!e)return[[M,n]];const s=n.length>e.length?n:e,o=n.length>e.length?e:n,r=s.indexOf(o);if(r!==-1)return t=[[1,s.substring(0,r)],[0,o],[1,s.substring(r+o.length)]],n.length>e.length&&(t[0][0]=t[2][0]=M),t;if(o.length===1)return[[M,n],[1,e]];const a=Z(n,e);if(a){const i=a[0]||"",d=a[1]||"",l=a[2]||"",c=a[3]||"",m=a[4]||"",h=L({text1:i,text2:l,cursorPos:0}),g=L({text1:d,text2:c,cursorPos:0});return h.concat([[0,m[1]]],g)}return Q(n,e)}function Q(n,e){const t=n.length,s=e.length,o=Math.ceil((t+s)/2),r=o,a=2*o,i=new Array(a),d=new Array(a);for(let p=0;p<a;p++)i[p]=-1,d[p]=-1;i[r+1]=0,d[r+1]=0;const l=t-s,c=l%2!==0;let m=0,h=0,g=0,f=0;for(let p=0;p<o;p++){for(let u=-p+m;u<=p-h;u+=2){const y=o+u;let b;u===-p||u!==p&&i[y-1]<i[y+1]?b=i[y+1]:b=i[y-1]+1;let S=b-u;for(;b<t&&S<s&&n.charAt(b)===e.charAt(S);)b++,S++;if(i[y]=b,b>t)h+=2;else if(S>s)m+=2;else if(c){const C=o+l-u;if(C>=0&&C<a&&d[C]!==-1){const A=t-d[C];if(b>=A)return H(n,e,b,S)}}}let w;for(let u=-p+g;u<=p-f;u+=2){const y=o+u;u===-p||u!==p&&d[y-1]<d[y+1]?w=d[y+1]:w=d[y-1]+1;let b=w-u;for(;w<t&&b<s&&n.charAt(t-w-1)===e.charAt(s-b-1);)w++,b++;if(d[y]=w,w>t)f+=2;else if(b>s)g+=2;else if(!c){const S=o+l-u;if(S>=0&&S<a&&i[S]!==-1){const C=i[S],A=o+C-S;if(w=t-w,C>=w)return H(n,e,C,A)}}}}return[[M,n],[1,e]]}function H(n,e,t,s){const o=n.substring(0,t),r=e.substring(0,s),a=n.substring(t),i=e.substring(s),d=L({text1:o,text2:r,cursorPos:0}),l=L({text1:a,text2:i,cursorPos:0});return d.concat(l)}function P(n,e){if(!n||!e||n.charAt(0)!==e.charAt(0))return 0;let t=0,s=Math.min(n.length,e.length),o=s,r=0;for(;t<o;)n.substring(r,o)==e.substring(r,o)?(t=o,r=t):s=o,o=Math.floor((s-t)/2+t);return x(n.charCodeAt(o-1))&&o--,o}function T(n,e){if(!n||!e||n.slice(-1)!==e.slice(-1))return 0;let t=0,s=Math.min(n.length,e.length),o=s,r=0;for(;t<o;)n.substring(n.length-o,n.length-r)==e.substring(e.length-o,e.length-r)?(t=o,r=t):s=o,o=Math.floor((s-t)/2+t);return _(n.charCodeAt(n.length-o))&&o--,o}function Z(n,e){const t=n.length>e.length?n:e,s=n.length>e.length?e:n;if(t.length<4||s.length*2<t.length)return null;function o(g,f,p){const w=g.substring(p,p+Math.floor(g.length/4));let u=-1,y="",b,S,C,A;for(;(u=f.indexOf(w,u+1))!==-1;){const D=P(g.substring(p),f.substring(u)),R=T(g.substring(0,p),f.substring(0,u));y.length<R+D&&(y=f.substring(u-R,u)+f.substring(u,u+D),b=g.substring(0,p-R),S=g.substring(p+D),C=f.substring(0,u-R),A=f.substring(u+D))}return y.length*2>=g.length?[b,S,C,A,y]:null}const r=o(t,s,Math.ceil(t.length/4)),a=o(t,s,Math.ceil(t.length/2));let i;if(a===null&&r===null)return null;if(a===null){if(r===null)return null;i=r}else if(r===null){if(a===null)return null;i=a}else i=r[4].length>a[4].length?r:a;let d,l,c,m;n.length>e.length?(d=i[0],l=i[1],c=i[2],m=i[3]):(c=i[0],m=i[1],d=i[2],l=i[3]);const h=i[4];return[d,l,c,m,h]}function W(n){const e=[...n];e.push([0,""]);let t=0,s=0,o=0,r="",a="",i,d;for(;t<e.length;){if(t<e.length-1&&!e[t][1]){e.splice(t,1);continue}switch(e[t][0]){case 1:o++,a+=e[t][1],t++;break;case M:s++,r+=e[t][1],t++;break;case 0:if(d=t-o-s-1,t<e.length-1&&!e[t][1]){e.splice(t,1);break}if(r.length>0||a.length>0){r.length>0&&a.length>0&&(i=P(a,r),i!==0&&(d>=0?e[d][1]+=a.substring(0,i):(e.splice(0,0,[0,a.substring(0,i)]),t++),a=a.substring(i),r=r.substring(i)),i=T(a,r),i!==0&&(e[t][1]=a.substring(a.length-i)+e[t][1],a=a.substring(0,a.length-i),r=r.substring(0,r.length-i)));const c=o+s;r.length===0&&a.length===0?(e.splice(t-c,c),t=t-c):r.length===0?(e.splice(t-c,c,[1,a]),t=t-c+1):a.length===0?(e.splice(t-c,c,[M,r]),t=t-c+1):(e.splice(t-c,c,[M,r],[1,a]),t=t-c+2)}t!==0&&e[t-1][0]===0?(e[t-1][1]+=e[t][1],e.splice(t,1)):t++,o=0,s=0,r="",a="";break}}e[e.length-1][1]===""&&e.pop();let l=!1;for(t=1;t<e.length-1;)e[t-1][0]===0&&e[t+1][0]===0&&(e[t][1].substring(e[t][1].length-e[t-1][1].length)===e[t-1][1]?(e[t][1]=e[t-1][1]+e[t][1].substring(0,e[t][1].length-e[t-1][1].length),e[t+1][1]=e[t-1][1]+e[t+1][1],e.splice(t-1,1),l=!0):e[t][1].substring(0,e[t+1][1].length)==e[t+1][1]&&(e[t-1][1]+=e[t+1][1],e[t][1]=e[t][1].substring(e[t+1][1].length)+e[t+1][1],e.splice(t+1,1),l=!0)),t++;return l?W(e):e}function x(n){return n>=55296&&n<=56319}function _(n){return n>=56320&&n<=57343}function Y(n){return _(n.charCodeAt(0))}function ee(n){return x(n.charCodeAt(n.length-1))}function te(n){const e=[];for(let t=0;t<n.length;t++)n[t][1].length>0&&e.push(n[t]);return e}function F(n,e,t,s){return ee(n)||Y(s)?null:te([[0,n],[M,e],[1,t],[0,s]])}function ne(n,e,t){const s=typeof t=="number"?{index:t,length:0}:t.oldRange,o=typeof t=="number"?null:t.newRange,r=n.length,a=e.length;if(s.length===0&&(o===null||o.length===0)){const i=s.index,d=n.slice(0,i),l=n.slice(i),c=o?o.index:null;e:{const m=i+a-r;if(c!==null&&c!==m)break e;if(m<0||m>a)break e;const h=e.slice(0,m),g=e.slice(m);if(g!==l)break e;const f=Math.min(i,m),p=d.slice(0,f),w=h.slice(0,f);if(p!==w)break e;const u=d.slice(f),y=h.slice(f);return F(p,u,y,l)}e:{if(c!==null&&c!==i)break e;const m=i,h=e.slice(0,i),g=e.slice(i);if(h!==d)break e;const f=Math.min(r-i,a-i),p=l.slice(l.length-f),w=g.slice(g.length-f);if(p!==w)break e;const u=l.slice(0,l.length-f),y=g.slice(0,g.length-f);return F(d,u,y,p)}}if(s.length>0&&o&&o.length===0){e:{const i=n.slice(0,s.index),d=n.slice(s.index+s.length),l=i.length,c=d.length;if(a<l+c)break e;const m=e.slice(0,l),h=e.slice(a-c);if(i!==m||d!==h)break e;const g=n.slice(l,r-c),f=e.slice(l,a-c);return F(i,g,f,d)}}return null}function O(n,e,t){return L({text1:n,text2:e,cursorPos:t})}O.INSERT=1,O.DELETE=M,O.EQUAL=0;const B=window.document;let N=!0,v=0,V=0,j="",z="",U="",I="";export async function run(){await E("https://unpkg.com/@babel/standalone@7.12.6/babel.min.js"),await E("https://unpkg.com/react@17.0.1/umd/react.production.min.js"),await E("https://unpkg.com/react-dom@17.0.1/umd/react-dom.production.min.js"),await E("https://unpkg.com/interactjs@1.10.0/dist/interact.min.js"),await E("https://unpkg.com/@emotion/react@11.0.0/dist/emotion-react.umd.min.js"),window.css=window.emotionReact.css,window.jsx=window.emotionReact.jsx,await E("https://unpkg.com/@emotion/styled@11.0.0/dist/emotion-styled.umd.min.js"),window.styled=window.emotionStyled,setTimeout(()=>J(),100),(async()=>{const s=e();I=s;let o;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)&&(await Promise.all([E("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"),E("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js"),E("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js")]),B.getElementById("ace").style.setProperty("display","block"),B.getElementById("container").style.setProperty("display","none"),o=window.ace.edit("ace"),o.setTheme("ace/theme/monokai"),o.session.setMode("ace/mode/typescript"),o.setValue(s));const r=await X({language:"typescript",code:s,onChange:a});o&&o.session.on("change",function(){const l=o.getValue();r.editor.setValue(l),a(l)});function a(l){if(!r)return;if(j=l,!v)d(j);else{const c=l,m=setInterval(()=>{(l!==j||!v)&&clearInterval(m),v||d(j)},100)}}async function i(){if(!r||!r.monaco)return;const l=r.monaco.Uri.parse("file:///main.tsx"),c=await r.monaco.languages.typescript.getTypeScriptWorker(),m=await(await c(l)).getSemanticDiagnostics("file:///main.tsx"),h=await(await c(l)).getCompilerOptionsDiagnostics("file:///main.tsx"),g=await(await c(l)).getSyntacticDiagnostics("file:///main.tsx");return[...m,...h,...g]}async function d(l){if(v===1)return;try{v=1;const c=await i(),m=B.getElementById("error");if(v=0,l!==j)return;if(c&&c.length){if(j!=l)return;if(z===l)return;B.getElementById("root").classList.add("transparent");const h=O(I,l,0);if(h.length<=3){r.monaco.editor.setTheme("hc-black");return}m.innerHTML=c[0].messageText.toString(),B.getElementById("root").style.setProperty("dispay","none"),m.style.display="block",z=l,r.monaco.editor.setTheme("vs-light"),setTimeout(()=>{r.monaco.editor.setTheme("hc-black")},V++);return}I=l,m.style.display="none",r.monaco.editor.setTheme("vs-dark"),B.getElementById("root").classList.remove("transparent"),V=0,v=0,n(t(l))}catch(c){if(v=0,l!==j)return;r.monaco.editor.setTheme("vs-light"),setTimeout(()=>{r.monaco.editor.setTheme("hc-black")},10),console.error(c)}}})(),n(t(e())),B.getElementById("root").setAttribute("style","display:block");async function n(s){const o=new Function("transpileCode",`return function(){ 
        ${s} 
    }`)();if(!N){const r=async i=>{if(i!==I)return;if(U===i)return;U=i;const d={codeTranspiled:s,code:I},l=JSON.stringify(d),c=new Request("https://code.zed.vision",{body:l,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),m=await fetch(c),{hash:h}=await m.json();try{const g=window.localStorage,f=g.getItem("codeBoXHash");f!==h&&(g.setItem("codeBoXHash",h),g.setItem(h,I),window.history.pushState({},"","/?h="+h))}catch(g){console.log("no localStorage")}},a=j;setTimeout(()=>r(j),500)}N=!1,o()}function e(){const s=new URLSearchParams(window.location.search),o=s.get("h")||localStorage.getItem("codeBoXHash");return o&&window.localStorage.getItem(o)||window.localStorage.getItem("STARTER")||G}function t(s){return window.Babel.transform(s,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(/import/gi,"///")}}
