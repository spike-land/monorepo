const B=async n=>new Promise(function(t,e){const o=window.document.createElement("script");o.src=n,o.onload=t,o.onerror=e,window.document.head.appendChild(o)}),V=async()=>{await B("https://unpkg.com/jsframe.js@1.6.2/lib/jsframe.min.js");const n=window.JSFrame,t=new n,e=t.create({name:"Root",title:"React Component",left:20,top:100,width:400,height:320,minWidth:200,minHeight:110,appearanceName:"yosemite",appearanceParam:{titleBar:{greenButton:"fullscreen"}},html:'<div style="font-size:16px"><div id=root></div></div>'}).show();e.setControl({maximizeButton:"zoomButton",maximizeParam:{fullScreen:!0,restoreKey:"Escape"},demaximizeButton:"dezoomButton",deminimizeButton:"deminimizeButton",hideButton:"minimizeButton",hideParam:{align:"ABSOLUTE",offset:{x:100,y:500},duration:300},dehideParam:{duration:300},styleDisplay:"inline",animation:!0,animationDuration:100}),e.control.on("maximized",(o,i)=>{console.log("'maximized' event fired.The window was maximized."),o.on("#bg","dblclick",function(s,a){s.control.doCommand("restore")})}),e.control.on("demaximized",(o,i)=>{console.log("'demaximized' event fired.The window is now back to its original size from its maximized state.")}),e.control.on("hid",(o,i)=>{console.log("'hid' event fired.The window was hidden.")}),e.control.on("dehided",(o,i)=>{console.log("'dehided' event fired.A hidden window has appeared.")})},J=async({onChange:n,code:t,language:e})=>{const o=window.document.getElementById("container");if(!o){const a=E.getElementById("container");a.id="container",E.body.appendChild(a)}if(window.monaco===void 0){const a="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs",{require:r}=await q("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js");r.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs"}}),await new Promise(d=>r(["vs/editor/editor.main"],l=>{d(l)}))}const i=window.monaco,s={monaco:i,editor:i.editor.create(window.document.getElementById("container"),{cursorStyle:"block",formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!0},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;}",mouseWheelZoom:!1,wordWrapColumn:80,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",padding:{bottom:300},lineNumbers:"on",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:i.editor.createModel(t,e,i.Uri.parse(e==="typescript"?"file:///main.tsx":"file:///main.html")),value:t,language:e,theme:"vs-dark"})};if(s.editor.onDidChangeModelContent(()=>n(s.editor.getValue())),s.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),e==="typescript"){const a=[{name:"react",url:"https://unpkg.com/@types/react@16.9.56/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@16.9.56/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@16.9.9/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@3.0.4/index.d.ts",depend:[]},{name:"@emotion/styled/base.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/styled/index.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/cache/index.d.ts",url:"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts",depend:["@emotion/utils"]},{name:"@emotion/react/index.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/index.d.ts",depend:["@emotion/cache"]},{name:"@emotion/react/jsx-namespace.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/jsx-namespace.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/css-prop.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/css-prop.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/helper.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/helper.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/theming.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/theming.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/serialize/index.d.ts",url:"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/utils/index.d.ts",url:"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts",depend:[]}],r=a.map(({name:d,url:l})=>(async()=>s.monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(l)).text(),d.includes("@emotion")?`file:///node_modules/${d}`:`file:///node_modules/@types/${d}/index.d.ts`))());return s.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:s.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:s.monaco.languages.typescript.ModuleResolutionKind.NodeJs,module:s.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:s.monaco.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",jsxFragmentFactory:"React.Fragment",esModuleInterop:!0}),await Promise.all(r),s.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),s}};function q(n){return new Promise(function(t,e){var o;o=window.document.createElement("script"),o.src=n,o.onload=()=>t(window),o.onerror=e,window.document.head.appendChild(o)})}const X=`import React from "react";
import ReactDOM from "react-dom"
/** @jsx jsx */
import styled from "@emotion/styled"

const Counter = () => {
  const [clicks, setClicks] = React.useState(0);

  return <Container>
    <Button css={\`background: green\`} onClick={() => setClicks(clicks - 1)}>-</Button>
    {clicks}
    <Button css={\`background: red\`} onClick={() => setClicks(clicks + 1)}>+</Button>
  </Container>
}

const Container = styled.div\`
  margin: 2em;
  max-width: 400px;
  background: white;
  border: 6px solid grey;
  border-radius: 20px;
  padding: 1rem;
 \`

const Button = styled.button\`
  text-align: center;
  display: inline-block;
  border-radius: 6px;
  padding: 0.5rem 0;
  margin: 0.5rem 1rem;
  width: 3rem;
  color: white;
  border: none;
  :focus{
    outline: none;
  }
  \`

const elementToRender = document.getElementById("root");
ReactDOM.render(<Counter />, elementToRender);


`,C=-1;function I({text1:n,text2:t,cursorPos:e}){if(n===t)return n?[[0,n]]:[];if(e){const r=ee(n,t,e);if(r)return r}let o=R(n,t);const i=n.substring(0,o);n=n.substring(o),t=t.substring(o),o=x(n,t);const s=n.substring(n.length-o);n=n.substring(0,n.length-o),t=t.substring(0,t.length-o);const a=$(n,t);return i&&a.unshift([0,i]),s&&a.push([0,s]),F(a),a}function $(n,t){let e;if(!n)return[[1,t]];if(!t)return[[C,n]];const o=n.length>t.length?n:t,i=n.length>t.length?t:n,s=o.indexOf(i);if(s!==-1)return e=[[1,o.substring(0,s)],[0,i],[1,o.substring(s+i.length)]],n.length>t.length&&(e[0][0]=e[2][0]=C),e;if(i.length===1)return[[C,n],[1,t]];const a=G(n,t);if(a){const r=a[0]||"",d=a[1]||"",l=a[2]||"",c=a[3]||"",m=a[4]||"",h=I({text1:r,text2:l,cursorPos:0}),f=I({text1:d,text2:c,cursorPos:0});return h.concat([[0,m[1]]],f)}return K(n,t)}function K(n,t){const e=n.length,o=t.length,i=Math.ceil((e+o)/2),s=i,a=2*i,r=new Array(a),d=new Array(a);for(let g=0;g<a;g++)r[g]=-1,d[g]=-1;r[s+1]=0,d[s+1]=0;const l=e-o,c=l%2!==0;let m=0,h=0,f=0,p=0;for(let g=0;g<i;g++){for(let u=-g+m;u<=g-h;u+=2){const y=i+u;let w;u===-g||u!==g&&r[y-1]<r[y+1]?w=r[y+1]:w=r[y-1]+1;let k=w-u;for(;w<e&&k<o&&n.charAt(w)===t.charAt(k);)w++,k++;if(r[y]=w,w>e)h+=2;else if(k>o)m+=2;else if(c){const S=i+l-u;if(S>=0&&S<a&&d[S]!==-1){const j=e-d[S];if(w>=j)return O(n,t,w,k)}}}let b;for(let u=-g+f;u<=g-p;u+=2){const y=i+u;u===-g||u!==g&&d[y-1]<d[y+1]?b=d[y+1]:b=d[y-1]+1;let w=b-u;for(;b<e&&w<o&&n.charAt(e-b-1)===t.charAt(o-w-1);)b++,w++;if(d[y]=b,b>e)p+=2;else if(w>o)f+=2;else if(!c){const k=i+l-u;if(k>=0&&k<a&&r[k]!==-1){const S=r[k],j=i+S-k;if(b=e-b,S>=b)return O(n,t,S,j)}}}}return[[C,n],[1,t]]}function O(n,t,e,o){const i=n.substring(0,e),s=t.substring(0,o),a=n.substring(e),r=t.substring(o),d=I({text1:i,text2:s,cursorPos:0}),l=I({text1:a,text2:r,cursorPos:0});return d.concat(l)}function R(n,t){if(!n||!t||n.charAt(0)!==t.charAt(0))return 0;let e=0,o=Math.min(n.length,t.length),i=o,s=0;for(;e<i;)n.substring(s,i)==t.substring(s,i)?(e=i,s=e):o=i,i=Math.floor((o-e)/2+e);return T(n.charCodeAt(i-1))&&i--,i}function x(n,t){if(!n||!t||n.slice(-1)!==t.slice(-1))return 0;let e=0,o=Math.min(n.length,t.length),i=o,s=0;for(;e<i;)n.substring(n.length-i,n.length-s)==t.substring(t.length-i,t.length-s)?(e=i,s=e):o=i,i=Math.floor((o-e)/2+e);return H(n.charCodeAt(n.length-i))&&i--,i}function G(n,t){const e=n.length>t.length?n:t,o=n.length>t.length?t:n;if(e.length<4||o.length*2<e.length)return null;function i(f,p,g){const b=f.substring(g,g+Math.floor(f.length/4));let u=-1,y="",w,k,S,j;for(;(u=p.indexOf(b,u+1))!==-1;){const L=R(f.substring(g),p.substring(u)),D=x(f.substring(0,g),p.substring(0,u));y.length<D+L&&(y=p.substring(u-D,u)+p.substring(u,u+L),w=f.substring(0,g-D),k=f.substring(g+L),S=p.substring(0,u-D),j=p.substring(u+L))}return y.length*2>=f.length?[w,k,S,j,y]:null}const s=i(e,o,Math.ceil(e.length/4)),a=i(e,o,Math.ceil(e.length/2));let r;if(a===null&&s===null)return null;if(a===null){if(s===null)return null;r=s}else if(s===null){if(a===null)return null;r=a}else r=s[4].length>a[4].length?s:a;let d,l,c,m;n.length>t.length?(d=r[0],l=r[1],c=r[2],m=r[3]):(c=r[0],m=r[1],d=r[2],l=r[3]);const h=r[4];return[d,l,c,m,h]}function F(n){const t=[...n];t.push([0,""]);let e=0,o=0,i=0,s="",a="",r,d;for(;e<t.length;){if(e<t.length-1&&!t[e][1]){t.splice(e,1);continue}switch(t[e][0]){case 1:i++,a+=t[e][1],e++;break;case C:o++,s+=t[e][1],e++;break;case 0:if(d=e-i-o-1,e<t.length-1&&!t[e][1]){t.splice(e,1);break}if(s.length>0||a.length>0){s.length>0&&a.length>0&&(r=R(a,s),r!==0&&(d>=0?t[d][1]+=a.substring(0,r):(t.splice(0,0,[0,a.substring(0,r)]),e++),a=a.substring(r),s=s.substring(r)),r=x(a,s),r!==0&&(t[e][1]=a.substring(a.length-r)+t[e][1],a=a.substring(0,a.length-r),s=s.substring(0,s.length-r)));const c=i+o;s.length===0&&a.length===0?(t.splice(e-c,c),e=e-c):s.length===0?(t.splice(e-c,c,[1,a]),e=e-c+1):a.length===0?(t.splice(e-c,c,[C,s]),e=e-c+1):(t.splice(e-c,c,[C,s],[1,a]),e=e-c+2)}e!==0&&t[e-1][0]===0?(t[e-1][1]+=t[e][1],t.splice(e,1)):e++,i=0,o=0,s="",a="";break}}t[t.length-1][1]===""&&t.pop();let l=!1;for(e=1;e<t.length-1;)t[e-1][0]===0&&t[e+1][0]===0&&(t[e][1].substring(t[e][1].length-t[e-1][1].length)===t[e-1][1]?(t[e][1]=t[e-1][1]+t[e][1].substring(0,t[e][1].length-t[e-1][1].length),t[e+1][1]=t[e-1][1]+t[e+1][1],t.splice(e-1,1),l=!0):t[e][1].substring(0,t[e+1][1].length)==t[e+1][1]&&(t[e-1][1]+=t[e+1][1],t[e][1]=t[e][1].substring(t[e+1][1].length)+t[e+1][1],t.splice(e+1,1),l=!0)),e++;return l?F(t):t}function T(n){return n>=55296&&n<=56319}function H(n){return n>=56320&&n<=57343}function Q(n){return H(n.charCodeAt(0))}function Z(n){return T(n.charCodeAt(n.length-1))}function Y(n){const t=[];for(let e=0;e<n.length;e++)n[e][1].length>0&&t.push(n[e]);return t}function z(n,t,e,o){return Z(n)||Q(o)?null:Y([[0,n],[C,t],[1,e],[0,o]])}function ee(n,t,e){const o=typeof e=="number"?{index:e,length:0}:e.oldRange,i=typeof e=="number"?null:e.newRange,s=n.length,a=t.length;if(o.length===0&&(i===null||i.length===0)){const r=o.index,d=n.slice(0,r),l=n.slice(r),c=i?i.index:null;e:{const m=r+a-s;if(c!==null&&c!==m)break e;if(m<0||m>a)break e;const h=t.slice(0,m),f=t.slice(m);if(f!==l)break e;const p=Math.min(r,m),g=d.slice(0,p),b=h.slice(0,p);if(g!==b)break e;const u=d.slice(p),y=h.slice(p);return z(g,u,y,l)}e:{if(c!==null&&c!==r)break e;const m=r,h=t.slice(0,r),f=t.slice(r);if(h!==d)break e;const p=Math.min(s-r,a-r),g=l.slice(l.length-p),b=f.slice(f.length-p);if(g!==b)break e;const u=l.slice(0,l.length-p),y=f.slice(0,f.length-p);return z(d,u,y,g)}}if(o.length>0&&i&&i.length===0){e:{const r=n.slice(0,o.index),d=n.slice(o.index+o.length),l=r.length,c=d.length;if(a<l+c)break e;const m=t.slice(0,l),h=t.slice(a-c);if(r!==m||d!==h)break e;const f=n.slice(l,s-c),p=t.slice(l,a-c);return z(r,f,p,d)}}return null}function P(n,t,e){return I({text1:n,text2:t,cursorPos:e})}P.INSERT=1,P.DELETE=C,P.EQUAL=0;const E=window.document;let W=!0,M=0,N=0,v="",_="",U="",A="";export async function run(){await B("https://unpkg.com/@babel/standalone@7.12.6/babel.min.js"),await B("https://unpkg.com/react@17.0.1/umd/react.production.min.js"),await B("https://unpkg.com/react-dom@17.0.1/umd/react-dom.production.min.js"),await B("https://unpkg.com/@emotion/react@11.0.0/dist/emotion-react.umd.min.js"),window.css=window.emotionReact.css,window.jsx=window.emotionReact.jsx,await B("https://unpkg.com/@emotion/styled@11.0.0/dist/emotion-styled.umd.min.js"),window.styled=window.emotionStyled,await V(),(async()=>{const o=t();A=o;let i;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)&&(await Promise.all([B("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"),B("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js"),B("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js")]),E.getElementById("ace").style.setProperty("display","block"),E.getElementById("container").style.setProperty("display","none"),i=window.ace.edit("ace"),i.setTheme("ace/theme/monokai"),i.session.setMode("ace/mode/typescript"),i.setValue(o));const s=await J({language:"typescript",code:o,onChange:a});i&&i.session.on("change",function(){const l=i.getValue();s.editor.setValue(l),a(l)});function a(l){if(!s)return;if(v=l,!M)d(v);else{const c=l,m=setInterval(()=>{(l!==v||!M)&&clearInterval(m),M||d(v)},100)}}async function r(){if(!s||!s.monaco)return;const l=s.monaco.Uri.parse("file:///main.tsx"),c=await s.monaco.languages.typescript.getTypeScriptWorker(),m=await(await c(l)).getSemanticDiagnostics("file:///main.tsx"),h=await(await c(l)).getCompilerOptionsDiagnostics("file:///main.tsx"),f=await(await c(l)).getSyntacticDiagnostics("file:///main.tsx");return[...m,...h,...f]}async function d(l){if(M===1)return;try{M=1;const c=await r(),m=E.getElementById("error");if(M=0,l!==v)return;if(c&&c.length){if(v!=l)return;if(_===l)return;E.getElementById("root").classList.add("transparent");const h=P(A,l,0);if(h.length<=3){s.monaco.editor.setTheme("hc-black");return}m.innerHTML=c[0].messageText.toString(),E.getElementById("root").style.setProperty("dispay","none"),m.style.display="block",_=l,s.monaco.editor.setTheme("vs-light"),setTimeout(()=>{s.monaco.editor.setTheme("hc-black")},N++);return}A=l,m.style.display="none",s.monaco.editor.setTheme("vs-dark"),E.getElementById("root").classList.remove("transparent"),N=0,M=0,n(e(l))}catch(c){if(M=0,l!==v)return;s.monaco.editor.setTheme("vs-light"),setTimeout(()=>{s.monaco.editor.setTheme("hc-black")},10),console.error(c)}}})(),n(e(t())),E.getElementById("root").setAttribute("style","display:block");async function n(o){const i=new Function("transpileCode",`return function(){ 
        ${o} 
    }`)();if(!W){const s=async r=>{if(r!==A)return;if(U===r)return;U=r;const d={codeTranspiled:o,code:A},l=JSON.stringify(d),c=new Request("https://code.zed.vision",{body:l,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),m=await fetch(c),{hash:h}=await m.json();try{const f=window.localStorage,p=f.getItem("codeBoXHash");p!==h&&(f.setItem("codeBoXHash",h),f.setItem(h,A),window.history.pushState({},"","/?h="+h))}catch(f){console.log("no localStorage")}},a=v;setTimeout(()=>s(v),500)}W=!1,i()}function t(){const o=new URLSearchParams(window.location.search),i=o.get("h")||localStorage.getItem("codeBoXHash");return i&&window.localStorage.getItem(i)||window.localStorage.getItem("STARTER")||X}function e(o){return window.Babel.transform(o,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(/import/gi,"///")}}
