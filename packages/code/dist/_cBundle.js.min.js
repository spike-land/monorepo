const H=async t=>A.querySelector(`script[src="${t}"]`)||new Promise(function(n,e){const o=window.document.createElement("script");o.src=t,o.onload=n,o.onerror=e,window.document.head.appendChild(o)}),$=`import React from "react";
import ReactDOM from "react-dom"
/** @jsx jsx */
import styled from "@emotion/styled"

const Counter = () => {
  const [clicks, setClicks] = React.useState(0);

  return <Container>
    <Button css={\`background: green\`} onClick={() => setClicks(clicks - 1)}>-</Button>
    {clicks}
    <Button css={\`background: red\`} onClick={() => setClicks(clicks + 1)}>+</Button>
  </Container>
}

const Container = styled.div\`
  margin: 2em;
  display: inline-block;
  min-width: 200px;
  background: white;
  border: 4px dotted red;
  border-radius: 30px;
  padding: 1rem;
\`

const Button = styled.button\`
  text-align: center;
  display: inline-block;
  border-radius: 6px;
  padding: 0.5rem 0;
  margin: 0.5rem 2rem;
  width: 4rem;
  color: white;
  border: none;
  :focus{
    outline: none;
  }
  \`

const elementToRender = document.getElementById("root");
ReactDOM.render(<Counter />, elementToRender);



`,C=-1;function v({text1:t,text2:n,cursorPos:e}){if(t===n)return t?[[0,t]]:[];if(e){const i=Y(t,n,e);if(i)return i}let o=D(t,n);const s=t.substring(0,o);t=t.substring(o),n=n.substring(o),o=O(t,n);const l=t.substring(t.length-o);t=t.substring(0,t.length-o),n=n.substring(0,n.length-o);const r=z(t,n);return s&&r.unshift([0,s]),l&&r.push([0,l]),_(r),r}function z(t,n){let e;if(!t)return[[1,n]];if(!n)return[[C,t]];const o=t.length>n.length?t:n,s=t.length>n.length?n:t,l=o.indexOf(s);if(l!==-1)return e=[[1,o.substring(0,l)],[0,s],[1,o.substring(l+s.length)]],t.length>n.length&&(e[0][0]=e[2][0]=C),e;if(s.length===1)return[[C,t],[1,n]];const r=J(t,n);if(r){const i=r[0]||"",c=r[1]||"",f=r[2]||"",a=r[3]||"",m=r[4]||"",w=v({text1:i,text2:f,cursorPos:0}),d=v({text1:c,text2:a,cursorPos:0});return w.concat([[0,m[1]]],d)}return G(t,n)}function G(t,n){const e=t.length,o=n.length,s=Math.ceil((e+o)/2),l=s,r=2*s,i=new Array(r),c=new Array(r);for(let u=0;u<r;u++)i[u]=-1,c[u]=-1;i[l+1]=0,c[l+1]=0;const f=e-o,a=f%2!==0;let m=0,w=0,d=0,h=0;for(let u=0;u<s;u++){for(let g=-u+m;g<=u-w;g+=2){const p=s+g;let b;g===-u||g!==u&&i[p-1]<i[p+1]?b=i[p+1]:b=i[p-1]+1;let k=b-g;for(;b<e&&k<o&&t.charAt(b)===n.charAt(k);)b++,k++;if(i[p]=b,b>e)w+=2;else if(k>o)m+=2;else if(a){const S=s+f-g;if(S>=0&&S<r&&c[S]!==-1){const E=e-c[S];if(b>=E)return F(t,n,b,k)}}}let y;for(let g=-u+d;g<=u-h;g+=2){const p=s+g;g===-u||g!==u&&c[p-1]<c[p+1]?y=c[p+1]:y=c[p-1]+1;let b=y-g;for(;y<e&&b<o&&t.charAt(e-y-1)===n.charAt(o-b-1);)y++,b++;if(c[p]=y,y>e)h+=2;else if(b>o)d+=2;else if(!a){const k=s+f-g;if(k>=0&&k<r&&i[k]!==-1){const S=i[k],E=s+S-k;if(y=e-y,S>=y)return F(t,n,S,E)}}}}return[[C,t],[1,n]]}function F(t,n,e,o){const s=t.substring(0,e),l=n.substring(0,o),r=t.substring(e),i=n.substring(o),c=v({text1:s,text2:l,cursorPos:0}),f=v({text1:r,text2:i,cursorPos:0});return c.concat(f)}function D(t,n){if(!t||!n||t.charAt(0)!==n.charAt(0))return 0;let e=0,o=Math.min(t.length,n.length),s=o,l=0;for(;e<s;)t.substring(l,s)==n.substring(l,s)?(e=s,l=e):o=s,s=Math.floor((o-e)/2+e);return P(t.charCodeAt(s-1))&&s--,s}function O(t,n){if(!t||!n||t.slice(-1)!==n.slice(-1))return 0;let e=0,o=Math.min(t.length,n.length),s=o,l=0;for(;e<s;)t.substring(t.length-s,t.length-l)==n.substring(n.length-s,n.length-l)?(e=s,l=e):o=s,s=Math.floor((o-e)/2+e);return U(t.charCodeAt(t.length-s))&&s--,s}function J(t,n){const e=t.length>n.length?t:n,o=t.length>n.length?n:t;if(e.length<4||o.length*2<e.length)return null;function s(d,h,u){const y=d.substring(u,u+Math.floor(d.length/4));let g=-1,p="",b,k,S,E;for(;(g=h.indexOf(y,g+1))!==-1;){const I=D(d.substring(u),h.substring(g)),R=O(d.substring(0,u),h.substring(0,g));p.length<R+I&&(p=h.substring(g-R,g)+h.substring(g,g+I),b=d.substring(0,u-R),k=d.substring(u+I),S=h.substring(0,g-R),E=h.substring(g+I))}return p.length*2>=d.length?[b,k,S,E,p]:null}const l=s(e,o,Math.ceil(e.length/4)),r=s(e,o,Math.ceil(e.length/2));let i;if(r===null&&l===null)return null;if(r===null){if(l===null)return null;i=l}else if(l===null){if(r===null)return null;i=r}else i=l[4].length>r[4].length?l:r;let c,f,a,m;t.length>n.length?(c=i[0],f=i[1],a=i[2],m=i[3]):(a=i[0],m=i[1],c=i[2],f=i[3]);const w=i[4];return[c,f,a,m,w]}function _(t){const n=[...t];n.push([0,""]);let e=0,o=0,s=0,l="",r="",i,c;for(;e<n.length;){if(e<n.length-1&&!n[e][1]){n.splice(e,1);continue}switch(n[e][0]){case 1:s++,r+=n[e][1],e++;break;case C:o++,l+=n[e][1],e++;break;case 0:if(c=e-s-o-1,e<n.length-1&&!n[e][1]){n.splice(e,1);break}if(l.length>0||r.length>0){l.length>0&&r.length>0&&(i=D(r,l),i!==0&&(c>=0?n[c][1]+=r.substring(0,i):(n.splice(0,0,[0,r.substring(0,i)]),e++),r=r.substring(i),l=l.substring(i)),i=O(r,l),i!==0&&(n[e][1]=r.substring(r.length-i)+n[e][1],r=r.substring(0,r.length-i),l=l.substring(0,l.length-i)));const a=s+o;l.length===0&&r.length===0?(n.splice(e-a,a),e=e-a):l.length===0?(n.splice(e-a,a,[1,r]),e=e-a+1):r.length===0?(n.splice(e-a,a,[C,l]),e=e-a+1):(n.splice(e-a,a,[C,l],[1,r]),e=e-a+2)}e!==0&&n[e-1][0]===0?(n[e-1][1]+=n[e][1],n.splice(e,1)):e++,s=0,o=0,l="",r="";break}}n[n.length-1][1]===""&&n.pop();let f=!1;for(e=1;e<n.length-1;)n[e-1][0]===0&&n[e+1][0]===0&&(n[e][1].substring(n[e][1].length-n[e-1][1].length)===n[e-1][1]?(n[e][1]=n[e-1][1]+n[e][1].substring(0,n[e][1].length-n[e-1][1].length),n[e+1][1]=n[e-1][1]+n[e+1][1],n.splice(e-1,1),f=!0):n[e][1].substring(0,n[e+1][1].length)==n[e+1][1]&&(n[e-1][1]+=n[e+1][1],n[e][1]=n[e][1].substring(n[e+1][1].length)+n[e+1][1],n.splice(e+1,1),f=!0)),e++;return f?_(n):n}function P(t){return t>=55296&&t<=56319}function U(t){return t>=56320&&t<=57343}function Q(t){return U(t.charCodeAt(0))}function K(t){return P(t.charCodeAt(t.length-1))}function V(t){const n=[];for(let e=0;e<t.length;e++)t[e][1].length>0&&n.push(t[e]);return n}function j(t,n,e,o){return K(t)||Q(o)?null:V([[0,t],[C,n],[1,e],[0,o]])}function Y(t,n,e){const o=typeof e=="number"?{index:e,length:0}:e.oldRange,s=typeof e=="number"?null:e.newRange,l=t.length,r=n.length;if(o.length===0&&(s===null||s.length===0)){const i=o.index,c=t.slice(0,i),f=t.slice(i),a=s?s.index:null;n:{const m=i+r-l;if(a!==null&&a!==m)break n;if(m<0||m>r)break n;const w=n.slice(0,m),d=n.slice(m);if(d!==f)break n;const h=Math.min(i,m),u=c.slice(0,h),y=w.slice(0,h);if(u!==y)break n;const g=c.slice(h),p=w.slice(h);return j(u,g,p,f)}n:{if(a!==null&&a!==i)break n;const m=i,w=n.slice(0,i),d=n.slice(i);if(w!==c)break n;const h=Math.min(l-i,r-i),u=f.slice(f.length-h),y=d.slice(d.length-h);if(u!==y)break n;const g=f.slice(0,f.length-h),p=d.slice(0,d.length-h);return j(c,g,p,u)}}if(o.length>0&&s&&s.length===0){n:{const i=t.slice(0,o.index),c=t.slice(o.index+o.length),f=i.length,a=c.length;if(r<f+a)break n;const m=n.slice(0,f),w=n.slice(r-a);if(i!==m||c!==w)break n;const d=t.slice(f,l-a),h=n.slice(f,r-a);return j(i,d,h,c)}}return null}function T(t,n,e){return v({text1:t,text2:n,cursorPos:e})}T.INSERT=1,T.DELETE=C,T.EQUAL=0;const A=window.document;let q=!0,M=0,N=0,B="",W="",X="",L="";export async function run(){const t=H("https://unpkg.com/jsframe.js@1.6.2/lib/jsframe.min.js");await H("https://unpkg.com/@babel/standalone@7.12.6/babel.min.js"),(async()=>{const s=e();L=s;function l(c){if(!modules)return;if(B=c,!M)i(B);else{const f=c,a=setInterval(()=>{(c!==B||!M)&&clearInterval(a),M||i(B)},100)}}async function r(){if(!modules||!modules.monaco)return;const c=modules.monaco.Uri.parse("file:///main.tsx"),f=await modules.monaco.languages.typescript.getTypeScriptWorker(),a=await(await f(c)).getSemanticDiagnostics("file:///main.tsx"),m=await(await f(c)).getCompilerOptionsDiagnostics("file:///main.tsx"),w=await(await f(c)).getSyntacticDiagnostics("file:///main.tsx");return[...a,...m,...w]}async function i(c){if(M===1)return;try{M=1;const f=await r(),a=A.getElementById("error");if(M=0,c!==B)return;if(f&&f.length){if(B!=c)return;if(W===c)return;A.getElementById("root").classList.add("transparent");const m=T(L,c,0);if(m.length<=3){modules.monaco.editor.setTheme("hc-black");return}a.innerHTML=f[0].messageText.toString(),A.getElementById("root").style.setProperty("dispay","none"),a.style.display="block",W=c,modules.monaco.editor.setTheme("vs-light"),setTimeout(()=>{modules.monaco.editor.setTheme("hc-black")},N++);return}L=c,a.style.display="none",modules.monaco.editor.setTheme("vs-dark"),A.getElementById("root").classList.remove("transparent"),N=0,M=0,n(o(c))}catch(f){if(M=0,c!==B)return;modules.monaco.editor.setTheme("vs-light"),setTimeout(()=>{modules.monaco.editor.setTheme("hc-black")},10),console.error(f)}}})(),n(o(e())),A.getElementById("root").setAttribute("style","display:block");async function n(s){console.log(s);const l=new Function("transpileCode",`return function(){ 
        ${s} 
    }`)();if(!q){const r=async c=>{if(c!==L)return;if(X===c)return;X=c;const f={codeTranspiled:s,code:L},a=JSON.stringify(f),m=new Request("https://code.zed.vision",{body:a,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),w=await fetch(m),{hash:d}=await w.json();try{const h=window.localStorage,u=h.getItem("codeBoXHash");u!==d&&(h.setItem("codeBoXHash",d),h.setItem(d,L),window.history.pushState({},"","/?h="+d))}catch(h){console.log("no localStorage")}},i=B;setTimeout(()=>r(B),500)}q=!1,l()}function e(){const s=new URLSearchParams(window.location.search),l=s.get("h")||localStorage.getItem("codeBoXHash");return l&&window.localStorage.getItem(l)||window.localStorage.getItem("STARTER")||$}function o(s){return window.Babel.transform(s,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(/import/gi,"///")}}
