async function h(c){const{transpileCode:p}=await import("./transpile.js");return p(c,!1)}function U(){return{unmount:()=>{},hydrated:!1,preRendered:!1,lastErrors:0,rootElement:null,div:window.document.createElement("div"),HTML:"",devtoolHash:"",ipfs:0,transpiled:"",code:""}}const A=async c=>{const{Workbox:p}=await import(`https://storage.googleapis.com/workbox-cdn/releases/${c}/workbox-window.prod.mjs`);"serviceWorker"in window.navigator&&new p("dist/sw.js").register()};export async function run(c="window",p){const a=(await import("./versions.js")).default(),{searchParams:V,pathname:M}=new URL(window.location.href),u=M.substr(1),j=[...u].filter(e=>e<"0"||e>"f").length===0;Object.assign(window,await import("./hash.js")),j&&await import("./hash.js").then(({sendSignal:e})=>e(`https://zed.vision/${u}`));const{formatter:f}=await import("./formatter.js"),{importScript:H,importCss:y}=await import("./importScript.js");y(`https://unpkg.com/@zedvision/code@${a.code}/assets/app.css`,"appCss"),y(`https://unpkg.com/@zedvision/code@${a.code}/assets/normalize.min.css`,"normalizeCss");const{WindowManager:L}=await H("https://unpkg.com/simple-window-manager@2.1.2/public/simple-window-manager.min.js");A(a.workbox);const b=new L.WindowManager({backgroundWindow:"green"});b.snap(!1);const x=b.createWindow({titlebarHeight:"42px",width:720,backgroundWindow:"#1e1e1e",height:640,title:"React Live"}),v=()=>typeof window=="undefined"?!1:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent),{document:m,open:C}=p;if(x.content.innerHTML=`<div style="min-height: 700px;  min-width: 600px; height: ${v()?"2000px":"100%"}; width:100%; display: block;" id="editor"></div>`,console.log("Runner"),!v())try{const e=m.querySelector("body > div:nth-child(2) > div:nth-child(3) > div:nth-child(1) > section");e!==null&&(e.style.overflow="")}catch(e){console.error({e})}const t=U();try{const{getCodeToLoad:e}=await import("./data.js"),{code:o,transpiled:n,html:r,versions:i}=await e();t.code=o,t.transpiled=n||await h(o),t.div.innerHTML=r}catch(e){console.error({e,message:"couldn't start"});return}t.transpiled=t.transpiled||await h(t.code);const{renderEmotion:T,jsx:z}=await import(a.emotionRenderer);if(c==="window"){const e=async()=>{const{shareItAsHtml:i}=await import("./share.js"),s=await i({code:t.code,transpiled:t.transpiled,HTML:t.HTML});console.log({link:s}),C(s)},o=window.document.createElement("div");window.document.body.appendChild(o);const{DraggableWindow:n}=await import(a.DraggableWindow);T(z(n,{onShare:e}),o);const r=window.document.getElementById("zbody");r!==null&&r.appendChild(t.div),t.HTML&&(t.div.innerHTML=t.HTML)}const W=await h(t.code);await g(W);const S=(await import(a.editor)).default,B=m.getElementById("editor"),d=await S({language:"typescript",container:B,code:t.code,onChange:e=>R(e)});async function R(e){const o=await f(e);try{const n=await h(o);if(t.transpiled===n&&n!=="")return;let r=!1;n.length&&t.lastErrors===0&&(r=await g(n));const i=await $(o);if(r&&i.push({messageText:"Error while starting the app. Check the console!"}),i.length&&console.log({err:i}),t.lastErrors&&i.length===0&&g(n),t.lastErrors=i.length,i.length===0&&n.length){if(t.code=await f(o),t.transpiled!==n){t.transpiled=n;const{saveCode:s}=await import("./data.js");await s({code:t.code,transpiled:t.transpiled,html:t.HTML,versions:t.devtoolHash})}}else{const{diff:s}=await import(`https://unpkg.com/@zedvision/shadb@${a.shadb}/src/diff.js`),l=await s(t.code,o);if(l.c.length<=3){t.lastErrors=0;return}if(l.c.length==4){t.lastErrors=0,d.monaco.editor.setTheme("hc-black");return}console.error(i[0].messageText.toString());return}d.monaco.editor.setTheme("vs-dark")}catch(n){d.monaco.editor.setTheme("vs-light"),setTimeout(()=>{d.monaco.editor.setTheme("hc-black")},50),console.error(n)}}async function $(e){if(!d||!d.monaco)return[{messageText:"Error with the error checking. Try to reload!"}];const{monaco:o}=d,{sha256:n}=await import(`https://unpkg.com/@zedvision/shadb@${a.shadb}/src/sha256.js`),i=`file:///${await n(e)}.tsx`,s=o.Uri.parse(i),l=o.editor.getModel(s)||await o.editor.createModel(e,"typescript",s),w=await(await o.languages.typescript.getTypeScriptWorker())(l.uri),D=w.getSemanticDiagnostics(i),I=w.getCompilerOptionsDiagnostics(i),O=w.getSyntacticDiagnostics(i),P=await Promise.race([D,I,O]);return l.dispose(),[...P]}async function g(e){t.HTML="";let o=!1;if(typeof e!="string"||e==="")return o=!0,o;const n=c==="window"?e.replace("body{","#zbody{"):e,r=m.createElement("div"),i=(await import(l(n))).default;t.unmount(),t.unmount=T(i(),r);const s=m.getElementById("zbody");return s&&s.children[0].replaceWith(r),t.HTML=t.div.innerHTML,!!t.HTML;function l(k){const w=new Blob([k],{type:"application/javascript"});return URL.createObjectURL(w)}}}
