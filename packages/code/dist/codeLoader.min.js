async function g(a){const{transpileCode:p}=await import("./transpile.js");return p(a,!1)}function I(){return{unmount:()=>{},hydrated:!1,preRendered:!1,lastErrors:0,rootElement:null,div:window.document.createElement("div"),HTML:"",devtoolHash:"",ipfs:0,transpiled:"",code:""}}const $=async a=>{const{Workbox:p}=await import(`https://storage.googleapis.com/workbox-cdn/releases/${a}/workbox-window.prod.mjs`);"serviceWorker"in window.navigator&&new p("dist/sw.js").register()};export async function run(a="window",p){const l=(await import("./versions.js")).default(),{formatter:u}=await import("./formatter.js"),{importScript:k,importCss:f}=await import("./importScript.js");f("./assets/app.css","appCss"),f("./assets/normalize.min.css","normalizeCss");const{WindowManager:E}=await k("https://unpkg.com/simple-window-manager@2.1.2/public/simple-window-manager.min.js");$(l.workbox);const y=new E.WindowManager({backgroundWindow:"green"});y.snap(!1);const M=y.createWindow({width:720,height:640,style:{backgroundWindow:"#1e1e1e"},title:"React Live"}),b=()=>typeof window=="undefined"?!1:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent),{document:m,open:H}=p;if(M.content.innerHTML=`<div style="min-height: 700px;  min-width: 600px; height: ${b()?"2000px":"100%"}; width:100%; display: block;" id="editor"></div>`,console.log("Runner"),!b())try{const e=m.querySelector("body > div:nth-child(2) > div:nth-child(3) > div:nth-child(1) > section");e!==null&&(e.style.overflow="")}catch(e){console.error({e})}const t=I();try{const{getCodeToLoad:e}=await import("./data.js"),{code:i,transpiled:o,html:r,versions:n}=await e();t.code=i,t.transpiled=o||await g(i),t.div.innerHTML=r}catch(e){console.error({e,message:"couldn't start"});return}if(t.transpiled=t.transpiled||await g(t.code),a==="window"){const e=async()=>{const{shareItAsHtml:r}=await import("./share.js"),n=await r({code:t.code,transpiled:t.transpiled,HTML:t.HTML});console.log({link:n}),H(n)},{renderDraggableWindow:i}=await import("./DraggableWindow.js");await i({onShare:e},l.emotionRenderer);const o=window.document.getElementById("zbody");o!==null&&o.appendChild(t.div),t.HTML&&(t.div.innerHTML=t.HTML)}const{renderEmotion:L}=await import(l.emotionRenderer),j=await g(t.code);await h(j);const x=(await import(l.editor)).default,C=m.getElementById("editor"),c=await x({language:"typescript",container:C,code:t.code,onChange:e=>W(e)});async function W(e){const i=await u(e);try{const o=await g(i);if(t.transpiled===o&&o!=="")return;let r=!1;o.length&&t.lastErrors===0&&(r=await h(o));const n=await S(i);if(r&&n.push({messageText:"Error while starting the app. Check the console!"}),n.length&&console.log({err:n}),t.lastErrors&&n.length===0&&h(o),t.lastErrors=n.length,n.length===0&&o.length){if(t.code=await u(i),t.transpiled!==o){t.transpiled=o;const{saveCode:s}=await import("./data.js");await s({code:t.code,transpiled:t.transpiled,html:t.HTML,versions:t.devtoolHash})}}else{const{diff:s}=await import(`https://unpkg.com/@zedvision/diff@${l.diff}/src/diff.js`),d=await s(t.code,i);if(d.c.length<=3){t.lastErrors=0;return}if(d.c.length==4){t.lastErrors=0,c.monaco.editor.setTheme("hc-black");return}console.error(n[0].messageText.toString());return}c.monaco.editor.setTheme("vs-dark")}catch(o){c.monaco.editor.setTheme("vs-light"),setTimeout(()=>{c.monaco.editor.setTheme("hc-black")},50),console.error(o)}}async function S(e){if(!c||!c.monaco)return[{messageText:"Error with the error checking. Try to reload!"}];const{monaco:i}=c,{sha256:o}=await import(`https://unpkg.com/@zedvision/sha256@${l.sha256}/sha256.js`),n=`file:///${await o(e)}.tsx`,s=i.Uri.parse(n),d=i.editor.getModel(s)||await i.editor.createModel(e,"typescript",s),w=await(await i.languages.typescript.getTypeScriptWorker())(d.uri),z=w.getSemanticDiagnostics(n),B=w.getCompilerOptionsDiagnostics(n),R=w.getSyntacticDiagnostics(n),D=await Promise.race([z,B,R]);return d.dispose(),[...D]}async function h(e){t.HTML="";let i=!1;if(typeof e!="string"||e==="")return i=!0,i;const o=a==="window"?e.replace("body{","#zbody{"):e,r=m.createElement("div"),n=(await import(d(o))).default;t.unmount(),t.unmount=L(n(),r);const s=m.getElementById("zbody");return s&&s.children[0].replaceWith(r),t.HTML=t.div.innerHTML,!!t.HTML;function d(v){const w=new Blob([v],{type:"application/javascript"});return URL.createObjectURL(w)}}}
