import{starter as y}from"./starterNoFramerMotion.js";const i={firstLoad:!0,errorCode:"",code:""};function I(c="root"){const s=document.createElement("div"),w=document.getElementById(c);try{ReactDOM.unmountComponentAtNode(w)}catch(j){console.error("Error in un-mount",j)}w?w.replaceWith(s):document.body.appendChild(s),s.id=c}export async function run(c="window"){const{transpileCode:s}=await import("./transpile.js");if(i.code=await M(),c==="editor"){const{renderDraggableEditor:t}=await import("./DraggableEditor.js");await t()}if(c==="window"){const{renderDraggableWindow:t}=await import("./DraggableWindow.js"),{shareItAsHtml:e}=await import("./share.js");await t({onShare:async()=>{const o=await e({code:await s(i.code)});window.open(o)}})}const{getDB:w}=await import("../dist/shaDB.min.js"),{getUserId:j,getProjects:C,saveCode:T}=await import("./data.js"),U=await w(),R=await j(),b=await C(),W=b[0],k=await s(i.code);D(k);const{startMonaco:S}=await import("../dist/editor.min.js"),r=await S({language:"typescript",code:i.code,onChange:v});async function B(t){try{const e=await s(t);e.length&&D(e);const o=await L(t),n=document.getElementById("error");if(o.length===0)i.code=t,await T(t);else{i.error=t;const{diff:a}=await import("../dist/diff.min.js"),m=await a(i.code,t);if(m.c.length<=3){r.monaco.editor.setTheme("hc-black");return}n.innerHTML=o[0].messageText.toString(),n.style.display="block";return}n.style.display="none",r.monaco.editor.setTheme("vs-dark")}catch(e){r.monaco.editor.setTheme("vs-light"),setTimeout(()=>{r.monaco.editor.setTheme("hc-black")},50),console.error(e)}}function v(t){if(!r)return;window.requestAnimationFrame(()=>B(t))}async function L(t){if(!r||!r.monaco)return;const{monaco:e}=r,{sha256:o}=await import("./sha256.js"),n=await o(t),a=`file:///${n}.tsx`,m=e.Uri.parse(a),u=e.editor.getModel(m)||await e.editor.createModel(t,"typescript",m),g=await e.languages.typescript.getTypeScriptWorker(),l=await g(u.uri),d=l.getSemanticDiagnostics(a),p=l.getCompilerOptionsDiagnostics(a),h=l.getSyntacticDiagnostics(a),f=await Promise.race([d,p,h]);return u.dispose(),[...f]}function D(t){if(typeof t!="string"||t==="")return;i.firstLoad||I("root");const e=()=>{const o=c==="window"?t.replace("body{","#root{"):t,n=new Function(`return function(){  
          let DefaultElement;
          ${o}
          return ReactDOM.render(jsx(DefaultElement), document.getElementById("root"));
      }`)();n()};e()}async function M(){const{getUserId:t,getProjects:e,saveCode:o}=await import("./data.js"),{getDB:n}=await import("../dist/shaDB.min.js"),a=await n(),m=await t(),u=await e(),g=u[0],l=new URLSearchParams(window.location.search),d=l.get("h")||await a.get(g);if(d){let p;try{p=await a.get(d)}catch{console.error("error load key: "+d)}if(p)return p;let h;try{const f=await fetch("https://code.zed.vision/?h="+d);h=await f.json()}catch(f){const{sha256:x}=await import("./sha256.js"),E=await x(y);return a.put(E,y),await a.put(g,E),y}return h}return y}function H(t,e){const o=new URLSearchParams(window.location.search);o.set(t,e),window.history.replaceState({},"",decodeURIComponent(`${window.location.pathname}?${o}`))}}
