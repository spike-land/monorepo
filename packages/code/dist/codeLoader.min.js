import $ from"./versions.js";const l=$();async function u(i){const{transpileCode:c}=await import("./transpile.js");return c(i,!1)}const v=`https://unpkg.com/@zedvision/emotion-react-renderer@${l.emotionRenderer}/dist/bundle.js`;function P(){return{unmount:()=>{},hydrated:!1,preRendered:!1,lastErrors:0,rootElement:null,div:window.document.createElement("div"),HTML:"",devtoolHash:"",ipfs:0,transpiled:"",code:""}}async function T(i){const c=(await import(`https://unpkg.com/prettier@${l.prettier}/esm/standalone.mjs`)).default,g=(await import(`https://unpkg.com/prettier@${l.prettier}/esm/parser-babel.mjs`)).default,h=(await import(`https://unpkg.com/prettier@${l.prettier}/esm/parser-html.mjs`)).default;try{return c.format(i,{arrowParens:"always",bracketSpacing:!0,embeddedLanguageFormatting:"auto",htmlWhitespaceSensitivity:"css",insertPragma:!1,jsxBracketSameLine:!0,jsxSingleQuote:!1,printWidth:80,proseWrap:"preserve",quoteProps:"as-needed",requirePragma:!1,semi:!0,singleQuote:!0,tabWidth:2,trailingComma:"all",useTabs:!1,parser:"babel-ts",plugins:[g,h]})}catch(w){return i}}export async function run(i="window",c){const{importScript:g}=await import("./importScript.js"),{WindowManager:h}=await g("https://unpkg.com/simple-window-manager@2.1.2/public/simple-window-manager.min.js"),w=new h.WindowManager({backgroundWindow:"green"});w.snap(!1);const k=w.createWindow({width:720,height:640,style:{backgroundWindow:"#1e1e1e"},title:"React Live Editor"}),b=()=>typeof window=="undefined"?!1:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent),{document:m,open:E}=c;if(k.content.innerHTML=`<div style="min-height: 700px;  min-width: 600px; height: ${b()?"2000px":"100%"}; width:100%; display: block;" id="editor"></div>`,console.log("Runner"),!b())try{const e=m.querySelector("body > div:nth-child(2) > div:nth-child(3) > div:nth-child(1) > section");e!==null&&(e.style.overflow="")}catch(e){}const t=P();try{const{getCodeToLoad:e}=await import("./data.js"),{code:n,transpiled:o,html:a,versions:r}=await e();t.code=n,t.transpiled=o||await u(n),t.div.innerHTML=a}catch(e){console.error({e,message:"couldn't start"});return}if(t.transpiled=t.transpiled||await u(t.code),i==="window"){const e=async()=>{const{shareItAsHtml:a}=await import("./share.js"),r=await a({code:t.code,transpiled:t.transpiled,HTML:t.HTML});console.log({link:r}),E(r)},{renderDraggableWindow:n}=await import("./DraggableWindow.js");await n({onShare:e},v);const o=window.document.getElementById("zbody");o!==null&&o.appendChild(t.div),t.HTML&&(t.div.innerHTML=t.HTML)}const{renderEmotion:M}=await import(v),j=await u(t.code);await f(j);const L=(await import(`https://unpkg.com/@zedvision/smart-monaco-editor@${l.editor}/dist/editor.js`)).default,H=m.getElementById("editor"),d=await L({language:"typescript",container:H,code:t.code,onChange:e=>S(e)});async function S(e){const n=await T(e);try{const o=await u(n);if(t.transpiled===o&&o!=="")return;let a=!1;o.length&&t.lastErrors===0&&(a=await f(o));const r=await W(n);if(a&&r.push({messageText:"Error while starting the app. Check the console!"}),r.length&&console.log({err:r}),t.lastErrors&&r.length===0&&f(o),t.lastErrors=r.length,r.length===0&&o.length){if(t.code=await T(n),t.transpiled!==o){t.transpiled=o;const{saveCode:s}=await import("./data.js");await s({code:t.code,transpiled:t.transpiled,html:t.HTML,versions:t.devtoolHash})}}else{const{diff:s}=await import(`https://unpkg.com/@zedvision/diff@${l.diff}/src/diff.js`),p=await s(t.code,n);if(p.c.length<=3){t.lastErrors=0;return}if(p.c.length==4){t.lastErrors=0,d.monaco.editor.setTheme("hc-black");return}console.error(r[0].messageText.toString());return}d.monaco.editor.setTheme("vs-dark")}catch(o){d.monaco.editor.setTheme("vs-light"),setTimeout(()=>{d.monaco.editor.setTheme("hc-black")},50),console.error(o)}}async function W(e){if(!d||!d.monaco)return[{messageText:"Error with the error checking. Try to reload!"}];const{monaco:n}=d,{sha256:o}=await import(`https://unpkg.com/@zedvision/sha256@${l.sha256}/sha256.js`),r=`file:///${await o(e)}.tsx`,s=n.Uri.parse(r),p=n.editor.getModel(s)||await n.editor.createModel(e,"typescript",s),y=await(await n.languages.typescript.getTypeScriptWorker())(p.uri),x=y.getSemanticDiagnostics(r),C=y.getCompilerOptionsDiagnostics(r),z=y.getSyntacticDiagnostics(r),B=await Promise.race([x,C,z]);return p.dispose(),[...B]}async function f(e){t.HTML="";let n=!1;if(typeof e!="string"||e==="")return n=!0,n;const o=i==="window"?e.replace("body{","#zbody{"):e,a=m.createElement("div"),r=(await import(R(o))).default;t.unmount(),t.unmount=M(r(),a);const s=m.getElementById("zbody");return s&&s.children[0].replaceWith(a),t.HTML=t.div.innerHTML,!!t.HTML}}function R(i){const c=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(c)}
