/* esm.sh - esbuild bundle(@react-three/xr@6.2.8) es2022 production */
import * as __0$ from "react";
import * as __1$ from "react";
var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({__esModule:true},m);switch(n){case"react":return e(__0$);default:throw new Error("module \""+n+"\" not found");}};
var uo=Object.create;var sr=Object.defineProperty;var lo=Object.getOwnPropertyDescriptor;var co=Object.getOwnPropertyNames;var fo=Object.getPrototypeOf,po=Object.prototype.hasOwnProperty;var ar=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var Re=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var mo=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of co(e))!po.call(t,o)&&o!==r&&sr(t,o,{get:()=>e[o],enumerable:!(n=lo(e,o))||n.enumerable});return t};var ho=(t,e,r)=>(r=t!=null?uo(fo(t)):{},mo(e||!t||!t.__esModule?sr(r,"default",{value:t,enumerable:!0}):r,t));var nn=Re(rn=>{"use strict";var K=ar("react");function Ji(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var es=typeof Object.is=="function"?Object.is:Ji,ts=K.useState,rs=K.useEffect,ns=K.useLayoutEffect,os=K.useDebugValue;function is(t,e){var r=e(),n=ts({inst:{value:r,getSnapshot:e}}),o=n[0].inst,i=n[1];return ns(function(){o.value=r,o.getSnapshot=e,Wt(o)&&i({inst:o})},[t,r,e]),rs(function(){return Wt(o)&&i({inst:o}),t(function(){Wt(o)&&i({inst:o})})},[t]),os(r),r}function Wt(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!es(t,r)}catch{return!0}}function ss(t,e){return e()}var as=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ss:is;rn.useSyncExternalStore=K.useSyncExternalStore!==void 0?K.useSyncExternalStore:as});var sn=Re((pm,on)=>{"use strict";on.exports=nn()});var un=Re(an=>{"use strict";var Ne=ar("react"),us=sn();function ls(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var cs=typeof Object.is=="function"?Object.is:ls,fs=us.useSyncExternalStore,ps=Ne.useRef,ds=Ne.useEffect,ms=Ne.useMemo,hs=Ne.useDebugValue;an.useSyncExternalStoreWithSelector=function(t,e,r,n,o){var i=ps(null);if(i.current===null){var s={hasValue:!1,value:null};i.current=s}else s=i.current;i=ms(function(){function u(y){if(!l){if(l=!0,f=y,y=n(y),o!==void 0&&s.hasValue){var b=s.value;if(o(b,y))return c=b}return c=y}if(b=c,cs(f,y))return b;var te=n(y);return o!==void 0&&o(b,te)?b:(f=y,c=te)}var l=!1,f,c,g=r===void 0?null:r;return[function(){return u(e())},g===null?void 0:function(){return u(g())}]},[e,r,n,o]);var a=fs(t,i[0],i[1]);return ds(function(){s.hasValue=!0,s.value=a},[a]),hs(a),a}});var cn=Re((mm,ln)=>{"use strict";ln.exports=un()});import{jsx as Un}from"react/jsx-runtime";import{clamp as wu}from"three/src/math/MathUtils.js";import{GLTFLoader as Zi}from"three/examples/jsm/loaders/GLTFLoader.js";import{Matrix4 as we,Quaternion as ur}from"three";var Eu=new we,Cu=new we;var Xu=new we,Iu=new we,Tu=new ur,Au=new ur;import{Material as yo,Mesh as xo}from"three";import{clone as go}from"three/examples/jsm/utils/SkeletonUtils.js";function lr({scene:t}){let e=go(t),r=e.getObjectByProperty("type","SkinnedMesh");if(r==null)throw new Error("missing SkinnedMesh in loaded XRHand model");return r.frustumCulled=!1,e}function ot(t,e){t.renderOrder=e?.renderOrder??0,t.traverse(r=>{r instanceof xo&&r.material instanceof yo&&(r.material.colorWrite=e?.colorWrite??!0)})}var So=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"];function st(t,e,r){let n=new Float32Array(t.size*16),o=So.map(i=>{let s=e.getObjectByName(i);if(s==null)throw new Error(`missing joint "${i}" in hand model`);return s.matrixAutoUpdate=!1,s});return i=>{let s=typeof r=="function"?r():r;if(i==null||s==null)return;i.fillPoses(t.values(),s,n);let a=o.length;for(let u=0;u<a;u++)o[u].matrix.fromArray(n,u*16)}}function Pe(t){return t!=null&&typeof t=="object"&&"inputSource"in t}function at(t,e){let r=(n,o)=>{o!=null&&n.visibilityState===o.visibilityState||e(n.visibilityState==="visible")};return r(t.getState()),t.subscribe(r)}import{MeshBasicMaterial as Ro,Quaternion as wo,Vector3 as fr}from"three";var ne=class extends Ro{constructor(){super({transparent:!0,toneMapped:!1,depthWrite:!1})}onBeforeCompile(e,r){super.onBeforeCompile(e,r),e.vertexShader=`varying vec2 vLocalPosition;
`+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <color_vertex>",`#include <color_vertex>
        vLocalPosition = position.xy * 2.0;`),e.fragmentShader=`varying vec2 vLocalPosition;
`+e.fragmentShader,e.fragmentShader=e.fragmentShader.replace("#include <color_fragment>",`#include <color_fragment>
          float value = max(0.0, 1.0 - sqrt(dot(vLocalPosition, vLocalPosition)));
          diffuseColor.a = diffuseColor.a * value * value;`)}},Po=new fr(0,0,1),cr=new wo,ut=new fr;function lt(t,e,r,n,o){let i=n.getIntersection();if(i==null||!n.getEnabled()||!pr(t)){e.visible=!1;return}e.visible=!0;let s=typeof o.color=="function"?o.color(n):o.color;Array.isArray(s)?r.color.set(...s):r.color.set(s??"white"),r.opacity=typeof o.opacity=="function"?o.opacity(n):o.opacity??.4,e.position.copy(i.pointOnFace),e.scale.setScalar(o.size??.1),i.normal!=null&&(cr.setFromUnitVectors(Po,i.normal),i.object.getWorldQuaternion(e.quaternion),e.quaternion.multiply(cr),ut.set(0,0,o.cursorOffset??.01),ut.applyQuaternion(e.quaternion),e.position.add(ut)),e.updateMatrix()}function pr({visible:t,parent:e}){return t?e==null?!0:pr(e):!1}import{MeshBasicMaterial as Mo}from"three";var oe=class extends Mo{constructor(){super({transparent:!0,toneMapped:!1})}onBeforeCompile(e,r){super.onBeforeCompile(e,r),e.vertexShader=`varying float vFade;
`+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <color_vertex>",`#include <color_vertex>
            vFade = position.z + 0.5;`),e.fragmentShader=`varying float vFade;
`+e.fragmentShader,e.fragmentShader=e.fragmentShader.replace("#include <color_fragment>",`#include <color_fragment>
              diffuseColor.a *= vFade;`)}};function ct(t,e,r,n){if(!r.getEnabled()){t.visible=!1;return}t.visible=!0;let o=r.getIntersection(),i=typeof n.color=="function"?n.color(r):n.color;Array.isArray(i)?e.color.set(...i):e.color.set(i??"white"),e.opacity=typeof n.opacity=="function"?n.opacity(r):n.opacity??.4;let s=n.maxLength??1;o!=null&&(s=Math.min(s,o.distance)),t.position.z=-s/2;let a=n.size??.005;t.scale.set(a,a,s),t.updateMatrix()}function ft(t,e,r,n,o,i={}){let s=c=>{c.inputSource===r&&t.down(Object.assign(c,{button:i.button??0}))},a=c=>{c.inputSource===r&&t.up(Object.assign(c,{button:i.button??0}))},u=`${n}start`,l=`${n}end`,f=o.length;for(let c=0;c<f;c++){let g=o[c];switch(g.type){case u:s(g);break;case l:a(g);break}}return e.addEventListener(u,s),e.addEventListener(l,a),()=>{e.removeEventListener(u,s),e.removeEventListener(l,a)}}function Me(t){return t.getButtonsDown().size>0?.6:dr(t.getIntersection()?.distance??1/0,.07,0,.2,.4)}function D(t){return t.getButtonsDown().size>0?.6:.4}function Ee(t){return dr(t.getIntersection()?.distance??1/0,.1,.03,.2,.6)}function dr(t,e,r,n,o){return n+Math.max(0,Math.min(1,(t-e)/(r-e)))*(o-n)}import{Object3D as Jf}from"three";function pt(t,e){return(r,n)=>{if(t===e)return r.identity(),!0;let o=typeof e=="function"?e():e;if(o==null)return!1;let i=n?.getPose(t,o);return i==null?!1:(r.fromArray(i.transform.matrix),!0)}}function A(t,e,r,n){n?.copy(t.matrix);let o=mr(t.parent,n);return o??(n!=null&&Eo(t,e,n),r)}function Eo(t,e,r){if(e==null){r.copy(t.matrixWorld);return}r.copy(e.matrixWorld).invert().multiply(t.matrixWorld)}function mr(t,e){if(t!=null)return t.xrSpace!=null?t.xrSpace:(e?.premultiply(t.matrix),mr(t.parent,e))}import{Group as Gf}from"three";var hr=t=>{let e,r=new Set,n=(f,c)=>{let g=typeof f=="function"?f(e):f;if(!Object.is(g,e)){let y=e;e=c??(typeof g!="object"||g===null)?g:Object.assign({},e,g),r.forEach(b=>b(e,y))}},o=()=>e,u={setState:n,getState:o,getInitialState:()=>l,subscribe:f=>(r.add(f),()=>r.delete(f)),destroy:()=>{(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},l=e=t(n,o,u);return u},yr=t=>t?hr(t):hr;function ie(t,e,r){return typeof t=="function"?t:(typeof t=="object"&&(e!=null&&Co(t,e)?t=t[e]:"default"in t&&(t=t.default)),t===!1?!1:t===!0?r:t??r)}function Co(t,e){return e in t}import{Group as Ef}from"three";import{BoxGeometry as Xo,Mesh as Ml,PlaneGeometry as Io}from"three";var Il=new Xo;var Tl=new Io;import{Object3D as Hl}from"three";import{Object3D as kl}from"three";import{Material as To,Mesh as Ao}from"three";async function Xe(t,e=it){let{scene:r}=await e.loadAsync(t.assetPath);return r.clone(!0)}function Ie(t,e){t.renderOrder=e?.renderOrder??0,t.traverse(r=>{r instanceof Ao&&r.material instanceof To&&(r.material.colorWrite=e?.colorWrite??!0)})}import{Vector2 as Lo}from"three";function Te(t,e,r){let n=[];for(let o in e.components){let i=e.components[o],s=r[o];s==null&&(r[o]=s={state:"default"}),n.push(...Object.values(i.visualResponses).map(a=>Oo(t,s,a)))}return()=>{let o=n.length;for(let i=0;i<o;i++)n[i]()}}function Oo(t,e,r){let n=t.getObjectByName(r.valueNodeName);if(e.object=n,n==null)return()=>{};if(r.valueNodeProperty==="visibility")return()=>n.visible=r.states.includes(e.state);let o=t.getObjectByName(r.minNodeName),i=t.getObjectByName(r.maxNodeName);return o==null||i==null?()=>{}:()=>{let s=Ho(e,r);n.quaternion.slerpQuaternions(o.quaternion,i.quaternion,s),n.position.lerpVectors(o.position,i.position,s),n.updateMatrix()}}function Ho(t,{componentProperty:e,states:r}){let n=r.includes(t.state);switch(e){case"xAxis":return n?xr(t).x:.5;case"yAxis":return n?xr(t).y:.5;case"button":return n?t.button??0:0;case"state":return n?1:0}}var se=new Lo;function xr({xAxis:t=0,yAxis:e=0}){if(se.lengthSq()>1){let n=Math.atan2(e,t);se.set(Math.cos(n),Math.sin(n))}else se.set(t,e);return se.multiplyScalar(.5).addScalar(.5),se}import{Object3D as ht}from"three";import{BufferAttribute as Zl,Matrix4 as Fo,Triangle as gr,Vector2 as dt,Vector3 as vr}from"three";function Sr({_listeners:t,__r3f:e}){if(e!=null&&e?.eventCount>0)return!0;if(t==null)return!1;let r=Object.entries(t),n=r.length;for(let o=0;o<n;o++){let i=r[o];if(Do.includes(i[0])&&i[1]!=null&&i[1].length>0)return!0}return!1}function br({_listeners:t,__r3f:e},r){if(t!=null&&r in t)return t[r];if(e==null)return;let n=e.handlers[Rr[r]];if(n!=null)return[n]}var Rr={click:"onClick",contextmenu:"onContextMenu",dblclick:"onDoubleClick",pointercancel:"onPointerCancel",pointerdown:"onPointerDown",pointerenter:"onPointerEnter",pointerleave:"onPointerLeave",pointermove:"onPointerMove",pointerout:"onPointerOut",pointerover:"onPointerOver",pointerup:"onPointerUp",wheel:"onWheel"},Do=Object.keys(Rr),Yl=new gr,Jl=new gr,ec=new dt,tc=new dt,rc=new dt,nc=new vr,oc=new Fo,ic=new vr;var v=class t{type;bubbles;nativeEvent;pointer;intersection;currentObject;object;get pointerId(){return this.pointer.id}get pointerType(){return this.pointer.type}get pointerState(){return this.pointer.state}get timeStamp(){return this.nativeEvent.timeStamp}get button(){return this.nativeEvent.button}get shiftKey(){return this.nativeEvent.shiftKey??!1}get metaKey(){return this.nativeEvent.metaKey??!1}get ctrlKey(){return this.nativeEvent.ctrlKey??!1}get altKey(){return this.nativeEvent.altKey??!1}get distance(){return this.intersection.distance}get distanceToRay(){return this.intersection.distanceToRay}get point(){return this.intersection.point}get index(){return this.intersection.index}get face(){return this.intersection.face}get faceIndex(){return this.intersection.faceIndex}get uv(){return this.intersection.uv}get uv1(){return this.intersection.uv1}get normal(){return this.intersection.normal}get instanceId(){return this.intersection.instanceId}get pointOnLine(){return this.intersection.pointOnLine}get batchId(){return this.intersection.batchId}get pointerPosition(){return this.intersection.pointerPosition}get pointerQuaternion(){return this.intersection.pointerQuaternion}get pointOnFace(){return this.intersection.pointOnFace}get localPoint(){return this.intersection.localPoint}get details(){return this.intersection.details}get target(){return this.object}get currentTarget(){return this.currentObject}stopPropagation;stopImmediatePropagation;constructor(e,r,n,o,i,s=i.object,a=s){this.type=e,this.bubbles=r,this.nativeEvent=n,this.pointer=o,this.intersection=i,this.currentObject=s,this.object=a}retarget(e){let{type:r,bubbles:n,nativeEvent:o,pointer:i,intersection:s,target:a}=this;return new t(r,n,o,i,s,e,a)}},ae=class t extends v{get deltaX(){return this.nativeEvent.deltaX}get deltaY(){return this.nativeEvent.deltaY}get deltaZ(){return this.nativeEvent.deltaZ}constructor(e,r,n,o,i){super("wheel",!0,e,r,n,o,i)}retarget(e){let{type:r,bubbles:n,nativeEvent:o,pointer:i,intersection:s,target:a}=this;return new t(o,i,s,e,a)}};function w(t){wr(t,t.currentObject)}function wr(t,e){if(e==null)return;let r=br(e,t.type),n=!t.bubbles;if(r!=null&&r.length>0){let o=t.retarget(e),i=r.length;o.stopPropagation=()=>n=!0;let s=!1;o.stopImmediatePropagation=()=>{n=!0,s=!0};for(let a=0;a<i&&!s;a++)r[a](o)}n||wr(t,e.parent)}function B(t,e,r){let n=e.normal??e.face?.normal;return n==null?!1:(t.setFromNormalAndCoplanarPoint(n,e.localPoint),t.applyMatrix4(r.matrixWorld),!0)}function _o(t,e,r){if(e==="none"||e==="listener"&&!t)return!1;if(r==="all")return!0;if(typeof r=="function")return({id:i,type:s,state:a})=>r(i,s,a);let n,o;return"deny"in r?(o=!0,n=r.deny):(o=!1,n=r.allow),Array.isArray(n)?i=>Pr(n.includes(i.type),o):i=>Pr(n===i.type,o)}function Pr(t,e){return e?!t:t}function ue(t,e,r=!1,n,o,i){let s=r||Sr(t),a=t.pointerEvents??n??"listener",u=t.pointerEventsType??o??"all",l=t.pointerEventsOrder??i??0,f=_o(s,a,u),c=e.length;if(f===!0)for(let y=0;y<c;y++)Mr(e[y],t,a,u,l);else if(typeof f=="function")for(let y=0;y<c;y++){let b=e[y];f(b)&&Mr(b,t,a,u,l)}let g=t.children.length;for(let y=0;y<g;y++)ue(t.children[y],e,s,a,u,l)}function Mr({intersector:t,options:e},r,n,o,i){e.filter!=null&&!e.filter(r,n,o,i)||t.executeIntersection(r,i)}function k(t,e,r,n,{customSort:o=jo}={}){let i,s=r.length;for(let a=0;a<s;a++){let u=r[a];(t==null||o(t,e,u,n)>0)&&(t=u,i=a)}return i}function jo(t,e=0,r,n=0){return e!=n?n-e:t.distance-r.distance}var mt=Symbol("buttonsDownTime"),zo=Symbol("buttonsClickTime"),Er=new Map;ht.prototype.setPointerCapture=function(t){yt(t)?.setCapture(this)};ht.prototype.releasePointerCapture=function(t){let e=yt(t);e==null||!e.hasCaptured(this)||e.setCapture(void 0)};ht.prototype.hasPointerCapture=function(t){return yt(t)?.hasCaptured(this)??!1};function yt(t){return Er.get(t)}var R=class{id;type;state;intersector;onMoveCommited;parentSetPointerCapture;parentReleasePointerCapture;options;prevIntersection;intersection;prevEnabled=!0;enabled=!0;pointerEntered=[];pointerEnteredHelper=[];pointerCapture;buttonsDownTime=new Map;buttonsDown=new Set;wasMoved=!1;onFirstMove=[];constructor(e,r,n,o,i,s,a,u={}){this.id=e,this.type=r,this.state=n,this.intersector=o,this.onMoveCommited=i,this.parentSetPointerCapture=s,this.parentReleasePointerCapture=a,this.options=u,Er.set(e,this)}getPointerCapture(){return this.pointerCapture}hasCaptured(e){return this.pointerCapture?.object===e}setCapture(e){this.pointerCapture?.object!==e&&(this.pointerCapture!=null&&(this.parentReleasePointerCapture?.(),this.pointerCapture=void 0),e!=null&&this.intersection!=null&&(this.pointerCapture={object:e,intersection:this.intersection},this.parentSetPointerCapture?.()))}getButtonsDown(){return this.buttonsDown}getIntersection(){return this.intersection}getEnabled(){return this.enabled}setEnabled(e,r,n=!0){this.enabled!==e&&(!e&&this.pointerCapture!=null&&(this.parentReleasePointerCapture?.(),this.pointerCapture=void 0),this.enabled=e,n&&this.commit(r))}computeIntersection(e,r){return this.pointerCapture!=null?this.intersector.intersectPointerCapture(this.pointerCapture,r):(this.intersector.startIntersection(r),ue(e,[this]),this.intersector.finalizeIntersection())}setIntersection(e){this.intersection=e}computeMove(e,r){this.intersection=this.computeIntersection(e,r)}commit(e){let r=this.prevEnabled?this.prevIntersection:void 0,n=this.enabled?this.intersection:void 0;r!=null&&r.object!=n?.object&&w(new v("pointerout",!0,e,this,r));let o=this.pointerEntered;this.pointerEntered=[],this.pointerEnteredHelper.length=0,Cr(n?.object,this.pointerEntered,o,this.pointerEnteredHelper);let i=o.length;for(let s=0;s<i;s++){let a=o[s];w(new v("pointerleave",!1,e,this,r,a))}n!=null&&r?.object!=n.object&&w(new v("pointerover",!0,e,this,n));for(let s=this.pointerEnteredHelper.length-1;s>=0;s--){let a=this.pointerEnteredHelper[s];w(new v("pointerenter",!1,e,this,n,a))}if(n!=null&&w(new v("pointermove",!0,e,this,n)),this.prevIntersection=this.intersection,this.prevEnabled=this.enabled,!this.wasMoved){this.wasMoved=!0;let s=this.onFirstMove.length;for(let a=0;a<s;a++)this.onFirstMove[a]();this.onFirstMove.length=0}this.onMoveCommited?.(this)}move(e,r){this.computeMove(e,r),this.commit(r)}down(e){if(this.buttonsDown.add(e.button),!this.enabled)return;if(!this.wasMoved){this.onFirstMove.push(this.down.bind(this,e));return}if(this.intersection==null)return;w(new v("pointerdown",!0,e,this,this.intersection));let{object:r}=this.intersection;r[mt]??=new Map,r[mt].set(e.button,e.timeStamp),this.buttonsDownTime.set(e.button,e.timeStamp)}up(e){if(this.buttonsDown.delete(e.button),!this.enabled)return;if(!this.wasMoved){this.onFirstMove.push(this.up.bind(this,e));return}if(this.intersection==null)return;let{contextMenuButton:r=2,dblClickThresholdMs:n=500,clickThesholdMs:o=300}=this.options;this.pointerCapture=void 0;let i=Vo(this.buttonsDownTime,this.intersection.object[mt],e.button,e.timeStamp,o);if(i&&e.button===r&&w(new v("contextmenu",!0,e,this,this.intersection)),w(new v("pointerup",!0,e,this,this.intersection)),!i||e.button===r)return;w(new v("click",!0,e,this,this.intersection));let{object:s}=this.intersection,a=s[zo]??=new Map,u=a.get(e.button);if(u==null||e.timeStamp-u>n){a.set(e.button,e.timeStamp);return}w(new v("dblclick",!0,e,this,this.intersection)),a.delete(e.button)}cancel(e){if(this.enabled){if(!this.wasMoved){this.onFirstMove.push(this.cancel.bind(this,e));return}this.intersection!=null&&w(new v("pointercancel",!0,e,this,this.intersection))}}wheel(e,r,n){if(!this.enabled)return;let o=this.intersection;if(n||(o=this.computeIntersection(e,r)),!this.wasMoved&&n){this.onFirstMove.push(this.cancel.bind(this,r));return}o!=null&&w(new ae(r,this,o))}exit(e){if(!this.wasMoved){this.onFirstMove.push(this.exit.bind(this,e));return}this.pointerCapture!=null&&(this.parentReleasePointerCapture?.(),this.pointerCapture=void 0),this.intersection=void 0,this.commit(e)}};function Cr(t,e,r,n){if(t==null)return;let o=r.indexOf(t);o!=-1?r.splice(o,1):n.push(t),e.push(t),Cr(t.parent,e,r,n)}function Vo(t,e,r,n,o){if(e==null)return!1;let i=e.get(r);return!(i==null||n-i>o||i!=t.get(r))}import{Line3 as Wo,Matrix4 as Ar,Plane as Go,Quaternion as Xr,Ray as qo,Raycaster as Bo,Vector3 as U}from"three";var L=class{intersection;pointerEventsOrder;startIntersection(e){this.intersection=void 0,this.pointerEventsOrder=void 0,this.prepareIntersection(e)}};var ko=new Ar,le=[],xt=new Wo,Ir=new Go,Uo=new qo,Tr=[new U(0,0,0),new U(0,0,1)],Ae=class extends L{prepareTransformation;options;raycasters=[];fromMatrixWorld=new Ar;intersectionLineIndex=0;intersectionDistanceOnLine=0;constructor(e,r){super(),this.prepareTransformation=e,this.options=r}intersectPointerCapture({intersection:e,object:r},n){let o=e.details;if(o.type!="lines"||!this.prepareTransformation(n,this.fromMatrixWorld))return;let i=this.options.linePoints??Tr;xt.set(i[o.lineIndex],i[o.lineIndex+1]).applyMatrix4(this.fromMatrixWorld);let s=xt.at(o.distanceOnLine/xt.distance(),new U);B(Ir,e,r);let a=Uo.intersectPlane(Ir,new U)??s;return{...e,pointOnFace:a,point:s,pointerPosition:new U().setFromMatrixPosition(this.fromMatrixWorld),pointerQuaternion:new Xr().setFromRotationMatrix(this.fromMatrixWorld)}}prepareIntersection(e){if(!this.prepareTransformation(e,this.fromMatrixWorld))return!1;let r=this.options.linePoints??Tr,n=r.length-1;for(let o=0;o<n;o++){let i=r[o],s=r[o+1],a=this.raycasters[o]??(this.raycasters[o]=new Bo);a.ray.origin.copy(i).applyMatrix4(this.fromMatrixWorld),a.ray.direction.copy(s).applyMatrix4(this.fromMatrixWorld),a.ray.direction.sub(a.ray.origin);let u=a.ray.direction.length();a.ray.direction.divideScalar(u),a.far=u}return this.raycasters.length=n,!0}executeIntersection(e,r){let n=0,o=this.raycasters.length;for(let i=0;i<o;i++){let s=this.raycasters[i];e.raycast(s,le);for(let u of le)u.distance+=n;let a=k(this.intersection,this.pointerEventsOrder,le,r,this.options);a!=null&&(this.intersection=le[a],this.intersectionLineIndex=i,this.intersectionDistanceOnLine=this.intersection.distance-s.far,this.pointerEventsOrder=r),le.length=0,n+=s.far}}finalizeIntersection(){if(this.intersection!=null)return Object.assign(this.intersection,{details:{lineIndex:this.intersectionLineIndex,distanceOnLine:this.intersectionDistanceOnLine,type:"lines"},pointerPosition:new U().setFromMatrixPosition(this.fromMatrixWorld),pointerQuaternion:new Xr().setFromRotationMatrix(this.fromMatrixWorld),pointOnFace:this.intersection.point,localPoint:this.intersection.point.clone().applyMatrix4(ko.copy(this.intersection.object.matrixWorld).invert())})}};import{Matrix4 as Fr,Plane as Qo,Quaternion as No,Raycaster as $o,Vector3 as He,Vector2 as bc}from"three";var Ko=new Fr,Le=[],Lr=new Fr,Or=new He,Zo=new He(0,0,-1),Pc=new He,Hr=new Qo,Oe=class extends L{prepareTransformation;options;raycaster=new $o;raycasterQuaternion=new No;worldScale=0;constructor(e,r){super(),this.prepareTransformation=e,this.options=r}intersectPointerCapture({intersection:e,object:r},n){if(e.details.type!="ray"||!this.prepareIntersection(n))return;B(Hr,e,r);let{ray:o}=this.raycaster,i=o.intersectPlane(Hr,new He)??e.point;return{...e,object:r,pointOnFace:i,point:o.direction.clone().multiplyScalar(e.distance).add(o.origin),pointerPosition:o.origin.clone(),pointerQuaternion:this.raycasterQuaternion.clone()}}prepareIntersection(e){return this.prepareTransformation(e,Lr)?(Lr.decompose(this.raycaster.ray.origin,this.raycasterQuaternion,Or),this.worldScale=Or.x,this.raycaster.ray.direction.copy(this.options?.direction??Zo).applyQuaternion(this.raycasterQuaternion),!0):!1}executeIntersection(e,r){e.raycast(this.raycaster,Le);let n=k(this.intersection,this.pointerEventsOrder,Le,r,this.options);n!=null&&(this.intersection=Le[n],this.pointerEventsOrder=r),Le.length=0}finalizeIntersection(){if(this.intersection!=null&&!(this.options.minDistance!=null&&this.intersection.distance*this.worldScale<this.options.minDistance))return Object.assign(this.intersection,{details:{type:"ray"},pointerPosition:this.raycaster.ray.origin.clone(),pointerQuaternion:this.raycasterQuaternion.clone(),pointOnFace:this.intersection.point,localPoint:this.intersection.point.clone().applyMatrix4(Ko.copy(this.intersection.object.matrixWorld).invert())})}};import{InstancedMesh as Yo,Matrix4 as Gr,Mesh as Jo,Vector3 as _,Sphere as qr,Quaternion as Br,Plane as ei}from"three";var gt=new qr,Fe=[],N=class extends L{prepareTransformation;options;fromPosition=new _;fromQuaternion=new Br;constructor(e,r){super(),this.prepareTransformation=e,this.options=r}intersectPointerCapture({intersection:e,object:r},n){if(e.details.type!="sphere"||this.prepareTransformation(n,this.fromPosition,this.fromQuaternion)==null)return;Dr.copy(e.point).sub(e.pointerPosition),_r.copy(e.pointerQuaternion).invert().multiply(this.fromQuaternion);let o=Dr.clone().applyQuaternion(_r).add(this.fromPosition);B(jr,e,r);let i=jr.projectPoint(this.fromPosition,new _);return{details:{type:"sphere"},distance:e.distance,pointerPosition:this.fromPosition.clone(),pointerQuaternion:this.fromQuaternion.clone(),object:r,point:o,pointOnFace:i,face:e.face,localPoint:e.localPoint}}prepareIntersection(e){let r=this.prepareTransformation(e,this.fromPosition,this.fromQuaternion);return r==null?!1:(gt.center.copy(this.fromPosition),gt.radius=r,!0)}executeIntersection(e,r){ri(gt,e,Fe);let n=k(this.intersection,this.pointerEventsOrder,Fe,r,this.options);n!=null&&(this.intersection=Fe[n],this.pointerEventsOrder=r),Fe.length=0}finalizeIntersection(){if(this.intersection!=null)return Object.assign(this.intersection,{details:{type:"sphere"},pointOnFace:this.intersection.point,pointerPosition:this.fromPosition.clone(),pointerQuaternion:this.fromQuaternion.clone(),localPoint:this.intersection.point.clone().applyMatrix4(je.copy(this.intersection.object.matrixWorld).invert())})}},De=new Gr;function ti(t){return"spherecast"in t}function ri(t,e,r){if(e.updateWorldMatrix(!0,!1),ti(e)){e.spherecast(t,r);return}if(e instanceof Yo){e.geometry.boundingSphere==null&&e.geometry.computeBoundingSphere(),e.geometry.boundingBox==null&&e.geometry.computeBoundingBox();for(let o=0;o<e.count;o++){if(e.getMatrixAt(o,De),De.premultiply(e.matrixWorld),!zr(t,e,De))continue;let i=Wr(t,e,De,o);i!=null&&r.push(i)}}if(!(e instanceof Jo)||!zr(t,e,e.matrixWorld))return;je.copy(e.matrixWorld).invert();let n=Wr(t,e,e.matrixWorld);n!=null&&r.push(n)}var Dr=new _,_r=new Br,jr=new ei,Q=new qr;function zr(t,{geometry:e},r){return e.boundingSphere==null&&e.computeBoundingSphere(),Q.copy(e.boundingSphere).applyMatrix4(r),Q.center.distanceToSquared(t.center)<(t.radius+Q.radius)**2}var _e=new _,vt=new _,Vr=new _,ni=new _(1e-4,1e-4,1e-4),je=new Gr;function Wr(t,e,r,n){je.copy(r).invert(),Q.copy(t).applyMatrix4(je);let{geometry:o}=e;o.boundingBox==null&&o.computeBoundingBox(),o.boundingBox.getSize(vt),o.boundingBox.getCenter(Vr),o.boundingBox.clampPoint(Q.center,_e),_e.applyMatrix4(r);let i=_e.distanceToSquared(t.center);if(i>t.radius*t.radius)return;vt.max(ni);let s=Q.center.clone().sub(Vr);s.divide(vt),oi(s);let a=_e.clone();return{distance:Math.sqrt(i),face:{a:0,b:0,c:0,materialIndex:0,normal:s},normal:s,point:a,instanceId:n,object:e}}function oi(t){let e=Math.abs(t.x),r=Math.abs(t.y),n=Math.abs(t.z);if(e>=r&&e>=n){t.set(t.x<0?-1:1,0,0);return}if(r>=e&&r>=n){t.set(0,t.y<0?-1:1,0);return}t.set(0,0,t.z<0?-1:1)}import{Mesh as nf}from"three";function St(t,e,r={},n="grab"){return new R(I(),n,e,new N((o,i,s)=>{let a=t.current;if(a!=null)return a.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(a.matrixWorld),s.setFromRotationMatrix(a.matrixWorld),r.radius??.07},r),void 0,void 0,void 0,r)}function bt(t,e,r={},n="ray"){return new R(I(),n,e,new Oe((o,i)=>t.current==null?!1:(i.copy(t.current.matrixWorld),!0),r),void 0,void 0,void 0,r)}function Rt(t,e,r={},n="lines"){return new R(I(),n,e,new Ae((o,i)=>{let s=t.current;return s==null?!1:(i.copy(s.matrixWorld),!0)},r),void 0,void 0,void 0,r)}function wt(t,e,r={},n="touch"){return new R(I(),n,e,new N((o,i,s)=>{let a=t.current;if(a!=null)return a.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(a.matrixWorld),s.setFromRotationMatrix(a.matrixWorld),r.hoverRadius??.1},r),ii(r),void 0,void 0,r)}function ii(t){let e=!1;return r=>{if(!r.getEnabled())return;let n=r.getIntersection(),o=si(n,t.downRadius??.03);if(o===e)return;let i={timeStamp:performance.now(),button:t.button??0};o?r.down(i):r.up(i),e=o}}function si(t,e){return t==null?!1:t.distance<=e}var ai=23412;function I(){return ai++}var O=class t{enableMultiplePointers;pointers=[];isDefaults=[];enabled=!0;activePointer;nonCapturedPointers=[];constructor(e){this.enableMultiplePointers=e}register(e,r=!1){return this.pointers.push(e),this.isDefaults.push(r),this.unregister.bind(this,e)}unregister(e){let r=this.pointers.indexOf(e);r!==-1&&(this.isDefaults.splice(r,1),this.pointers.splice(r,1))}startIntersection(e,r){let n=this.pointers.length,o=!1;for(let i=0;i<n;i++){let s=this.pointers[i];if(s instanceof t){s.startIntersection(e,r);continue}let a=s.getPointerCapture();if(a!=null){o=!0,s.setIntersection(s.intersector.intersectPointerCapture(a,r));continue}e.push(s),s.intersector.startIntersection(r)}return o}getIntersection(){return this.activePointer?.getIntersection()}getPointerCapture(){return this.activePointer?.getPointerCapture()}computeActivePointer(){let e;this.activePointer=void 0;let r=this.pointers.length;for(let n=0;n<r;n++){let o=this.pointers[n];o instanceof t&&o.computeActivePointer();let i=o.getIntersection(),s=o.getPointerCapture()!=null?-1/0:i?.distance??1/0,a=this.isDefaults[n];(e==null||a&&s===e||s<e)&&(this.activePointer=o,e=s)}}commit(e,r=!0){if(this.enableMultiplePointers){let o=this.pointers.length;for(let i=0;i<o;i++)this.pointers[i].commit(e);return}r&&this.computeActivePointer();let n=this.pointers.length;for(let o=0;o<n;o++){let i=this.pointers[o];i.setEnabled(i===this.activePointer,e,!1),i.commit(e,!1)}}move(e,r){if(!this.enabled)return;if(this.nonCapturedPointers.length=0,!this.startIntersection(this.nonCapturedPointers,r)||this.enableMultiplePointers){ue(e,this.nonCapturedPointers);let o=this.nonCapturedPointers.length;for(let i=0;i<o;i++){let s=this.nonCapturedPointers[i];s.setIntersection(s.intersector.finalizeIntersection())}}this.commit(r)}setEnabled(e,r){this.enabled=e;let n=this.pointers.length;for(let o=0;o<n;o++){let i=this.pointers[o];i.setEnabled(e&&(this.enableMultiplePointers||i==this.activePointer),r)}}};import{Mesh as sp}from"three";import{BufferAttribute as kr,BufferGeometry as ci}from"three";function ze(t,e){if(e!=null&&e.createdAt!=null&&e.createdAt>=t.lastChangedTime)return e;let r=new ci;return r.setIndex(new kr(t.indices,1)),r.setAttribute("position",new kr(t.vertices,3)),Object.assign(r,{creationTime:t.lastChangedTime})}import{Mesh as pp}from"three";import{Box2 as fi,BufferGeometry as pi,Shape as di,ShapeGeometry as mi,Vector2 as Ur}from"three";function We(t,e){return e!=null&&e.createdAt!=null&&e.createdAt>=t.lastChangedTime?e:Object.assign(hi(t.polygon),{createdAt:t.lastChangedTime})}var fe=new fi,Ve=new Ur;function hi(t){if(t.length===0)return new pi;let e=new di,r=t.map(({x:o,z:i})=>new Ur(o,i));fe.setFromPoints(r),fe.getSize(Ve);for(let o of r)o.sub(fe.min),o.divide(Ve);e.setFromPoints(r);let n=new mi(e);return n.scale(Ve.x,Ve.y,1),n.translate(fe.min.x,fe.min.y,0),n.rotateX(Math.PI/2),n}import{Group as Rp}from"three";import{Mesh as Op,MeshBasicMaterial as Hp,WebGLRenderTarget as Fp}from"three";import{CylinderGeometry as Ep,DepthTexture as xi,HalfFloatType as gi,LinearFilter as Qr,Matrix4 as vi,PlaneGeometry as Cp,Quaternion as Si,SphereGeometry as Xp,SRGBColorSpace as bi,Texture as Ri,Vector3 as Kr,VideoTexture as wi,WebGLRenderTarget as Ct}from"three";function j(t,e=1){if(t!=null)return{x:t.x,y:t.y,z:t.z,w:"w"in t?t.w:e}}var Zr=60/180*Math.PI,Pi=60/180*Math.PI,Mi=-30/180*Math.PI,Ei=30/180*Math.PI;function Xt(t,e,r,n,o,i){return t instanceof HTMLVideoElement?Ci(t,e,n,o,i):Xi(t,e,r,n,o,i)}function Ci(t,e,r,{invertStereo:n,layout:o,shape:i="quad"},s={}){let a=A(r,e.origin,e.originReferenceSpace,$);if(a==null)return;let u=It($,z),l={invertStereo:n,layout:o,space:a,transform:u};Ot(i,l,s.centralAngle,z);let f=`create${Yr(i)}Layer`,c=e.mediaBinding?.[f](t,l);if(c!=null)return pe(c,s),c}function Xi(t,e,r,n,{shape:o="quad",...i},s={}){let a=A(n,e.origin,e.originReferenceSpace,$);if(a==null)return;let u=It($,z),l={...i,isStatic:!(t instanceof Ct),textureType:"texture",viewPixelWidth:i.layout==="stereo-left-right"?t.width/2:t.width,viewPixelHeight:i.layout==="stereo-top-bottom"?t.height/2:t.height,space:a,transform:u};Ot(o,l,s.centralAngle,z);let f=`create${Yr(o)}Layer`,c=r.getBinding()?.[f](l);if(c!=null)return pe(c,s),c}var $=new vi,Nr=new Kr,$r=new Si,z=new Kr;function It(t,e=z){return t.decompose(Nr,$r,e),new XRRigidTransform(j(Nr),j($r))}function Yr(t){return`${t[0].toUpperCase()}${t.slice(1)}`}function pe(t,e={}){if(t.chromaticAberrationCorrection=e.chromaticAberrationCorrection,t.quality=e.quality??"default",t.blendTextureSourceAlpha=e.blendTextureSourceAlpha??!1,t instanceof XRCylinderLayer){t.centralAngle=e?.centralAngle??Zr;return}t instanceof XREquirectLayer&&(t.centralHorizontalAngle=e?.centralHorizontalAngle??Pi,t.lowerVerticalAngle=e?.lowerVerticalAngle??Mi,t.upperVerticalAngle=e?.upperVerticalAngle??Ei)}function Tt(t,e,r,n){let o=!1,i=async()=>{let s=await e.requestFrame();o||Ii(t,r,s,n)};return r.addEventListener("redraw",i),i(),()=>{o=!0,r.removeEventListener("redraw",i)}}function At(t){if(t instanceof Ct)return t.texture;let e=t instanceof HTMLVideoElement?new wi(t):new Ri(t);return e.colorSpace=bi,e.needsUpdate=!0,e}function Ii(t,e,r,n){let o=t.getContext(),i=t.xr.getBinding().getSubImage(e,r);t.state.bindTexture(o.TEXTURE_2D,i.colorTexture),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!0),o.texSubImage2D(o.TEXTURE_2D,0,0,0,n.width,n.height,o.RGBA,o.UNSIGNED_BYTE,n)}function Lt(t,e,r,n){t.originReferenceSpace!=null&&(e.space=A(n,t.origin,t.originReferenceSpace,$),e.transform=It($,z),Ot(Ti(e),e,r,z))}function Ot(t,e,r,n){if(t==="cylinder"){let i=(n.x+n.z)/2,s=i*(r??Zr);e.radius=i,e.aspectRatio=s/n.y}else t==="quad"?(e.width=n.x/2,e.height=n.y/2):e.radius=(n.x+n.y+n.z)/3}function Ti(t){return t instanceof XRCylinderLayer?"cylinder":t instanceof XREquirectLayer?"equirect":"quad"}function Ht(t,e,r){return new Ct(t*r,e*r,{minFilter:Qr,magFilter:Qr,type:gi,depthTexture:new xi(t,e)})}import{Quaternion as Oi,Vector3 as Ft}from"three";var Kp=new Ft,Zp=new Ft,Yp=new Ft,Jp=new Oi;import{Euler as Wi,Mesh as Gi,QuadraticBezierCurve3 as qi,Quaternion as Bi,Vector3 as _t}from"three";import*as d from"three";var Hi=Object.defineProperty,Fi=(t,e,r)=>e in t?Hi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,m=(t,e,r)=>(Fi(t,typeof e!="symbol"?e+"":e,r),r);function Dt(t,e,r,n,o){let i;if(t=t.subarray||t.slice?t:t.buffer,r=r.subarray||r.slice?r:r.buffer,t=e?t.subarray?t.subarray(e,o&&e+o):t.slice(e,o&&e+o):t,r.set)r.set(t,n);else for(i=0;i<t.length;i++)r[i+n]=t[i];return r}function Di(t){return t instanceof Float32Array?t:t instanceof d.BufferGeometry?t.getAttribute("position").array:t.map(e=>{let r=Array.isArray(e);return e instanceof d.Vector3?[e.x,e.y,e.z]:e instanceof d.Vector2?[e.x,e.y,0]:r&&e.length===3?[e[0],e[1],e[2]]:r&&e.length===2?[e[0],e[1],0]:e}).flat()}var Ge=class extends d.BufferGeometry{constructor(){super(),m(this,"type","MeshLine"),m(this,"isMeshLine",!0),m(this,"positions",[]),m(this,"previous",[]),m(this,"next",[]),m(this,"side",[]),m(this,"width",[]),m(this,"indices_array",[]),m(this,"uvs",[]),m(this,"counters",[]),m(this,"widthCallback",null),m(this,"_attributes"),m(this,"_points",[]),m(this,"points"),m(this,"matrixWorld",new d.Matrix4),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(e){this.setPoints(e,this.widthCallback)}}})}setMatrixWorld(e){this.matrixWorld=e}setPoints(e,r){if(e=Di(e),this._points=e,this.widthCallback=r??null,this.positions=[],this.counters=[],e.length&&e[0]instanceof d.Vector3)for(let n=0;n<e.length;n++){let o=e[n],i=n/(e.length-1);this.positions.push(o.x,o.y,o.z),this.positions.push(o.x,o.y,o.z),this.counters.push(i),this.counters.push(i)}else for(let n=0;n<e.length;n+=3){let o=n/(e.length-1);this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.counters.push(o),this.counters.push(o)}this.process()}compareV3(e,r){let n=e*6,o=r*6;return this.positions[n]===this.positions[o]&&this.positions[n+1]===this.positions[o+1]&&this.positions[n+2]===this.positions[o+2]}copyV3(e){let r=e*6;return[this.positions[r],this.positions[r+1],this.positions[r+2]]}process(){let e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];let r,n;this.compareV3(0,e-1)?n=this.copyV3(e-2):n=this.copyV3(0),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(let o=0;o<e;o++){if(this.side.push(1),this.side.push(-1),this.widthCallback?r=this.widthCallback(o/(e-1)):r=1,this.width.push(r),this.width.push(r),this.uvs.push(o/(e-1),0),this.uvs.push(o/(e-1),1),o<e-1){n=this.copyV3(o),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);let i=o*2;this.indices_array.push(i,i+1,i+2),this.indices_array.push(i+2,i+1,i+3)}o>0&&(n=this.copyV3(o),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]))}this.compareV3(e-1,0)?n=this.copyV3(1):n=this.copyV3(e-1),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]),!this._attributes||this._attributes.position.count!==this.counters.length?this._attributes={position:new d.BufferAttribute(new Float32Array(this.positions),3),previous:new d.BufferAttribute(new Float32Array(this.previous),3),next:new d.BufferAttribute(new Float32Array(this.next),3),side:new d.BufferAttribute(new Float32Array(this.side),1),width:new d.BufferAttribute(new Float32Array(this.width),1),uv:new d.BufferAttribute(new Float32Array(this.uvs),2),index:new d.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new d.BufferAttribute(new Float32Array(this.counters),1)}:(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:e,y:r,z:n}){let o=this._attributes.position.array,i=this._attributes.previous.array,s=this._attributes.next.array,a=o.length;Dt(o,0,i,0,a),Dt(o,6,o,0,a-6),o[a-6]=e,o[a-5]=r,o[a-4]=n,o[a-3]=e,o[a-2]=r,o[a-1]=n,Dt(o,6,s,0,a-6),s[a-6]=e,s[a-5]=r,s[a-4]=n,s[a-3]=e,s[a-2]=r,s[a-1]=n,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}},_i=`
  #include <common>
  #include <logdepthbuf_pars_vertex>
  #include <fog_pars_vertex>
  #include <clipping_planes_pars_vertex>

  attribute vec3 previous;
  attribute vec3 next;
  attribute float side;
  attribute float width;
  attribute float counters;
  
  uniform vec2 resolution;
  uniform float lineWidth;
  uniform vec3 color;
  uniform float opacity;
  uniform float sizeAttenuation;
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
  }
  
  void main() {
    float aspect = resolution.x / resolution.y;
    vColor = vec4(color, opacity);
    vUV = uv;
    vCounters = counters;
  
    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4(position, 1.0) * aspect;
    vec4 prevPos = m * vec4(previous, 1.0);
    vec4 nextPos = m * vec4(next, 1.0);
  
    vec2 currentP = fix(finalPosition, aspect);
    vec2 prevP = fix(prevPos, aspect);
    vec2 nextP = fix(nextPos, aspect);
  
    float w = lineWidth * width;
  
    vec2 dir;
    if (nextP == currentP) dir = normalize(currentP - prevP);
    else if (prevP == currentP) dir = normalize(nextP - currentP);
    else {
      vec2 dir1 = normalize(currentP - prevP);
      vec2 dir2 = normalize(nextP - currentP);
      dir = normalize(dir1 + dir2);
  
      vec2 perp = vec2(-dir1.y, dir1.x);
      vec2 miter = vec2(-dir.y, dir.x);
      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);
    }
  
    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;
    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);
    normal.xy *= .5 * w;
    //normal *= projectionMatrix;
    if (sizeAttenuation == 0.) {
      normal.xy *= finalPosition.w;
      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;
    }
  
    finalPosition.xy += normal.xy * side;
    gl_Position = finalPosition;
    #include <logdepthbuf_vertex>
    #include <fog_vertex>
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    #include <clipping_planes_vertex>
    #include <fog_vertex>
  }
`,ji=parseInt(d.REVISION.replace(/\D+/g,"")),zi=ji>=154?"colorspace_fragment":"encodings_fragment",Vi=`
  #include <fog_pars_fragment>
  #include <logdepthbuf_pars_fragment>
  #include <clipping_planes_pars_fragment>
  
  uniform sampler2D map;
  uniform sampler2D alphaMap;
  uniform float useGradient;
  uniform float useMap;
  uniform float useAlphaMap;
  uniform float useDash;
  uniform float dashArray;
  uniform float dashOffset;
  uniform float dashRatio;
  uniform float visibility;
  uniform float alphaTest;
  uniform vec2 repeat;
  uniform vec3 gradient[2];
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  void main() {
    #include <logdepthbuf_fragment>
    vec4 diffuseColor = vColor;
    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);
    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);
    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;
    if (diffuseColor.a < alphaTest) discard;
    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));
    diffuseColor.a *= step(vCounters, visibility);
    #include <clipping_planes_fragment>
    gl_FragColor = diffuseColor;     
    #include <fog_fragment>
    #include <tonemapping_fragment>
    #include <${zi}>
  }
`,qe=class extends d.ShaderMaterial{constructor(e){super({uniforms:{...d.UniformsLib.fog,lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new d.Color(16777215)},gradient:{value:[new d.Color(16711680),new d.Color(65280)]},opacity:{value:1},resolution:{value:new d.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new d.Vector2(1,1)}},vertexShader:_i,fragmentShader:Vi}),m(this,"lineWidth"),m(this,"map"),m(this,"useMap"),m(this,"alphaMap"),m(this,"useAlphaMap"),m(this,"color"),m(this,"gradient"),m(this,"resolution"),m(this,"sizeAttenuation"),m(this,"dashArray"),m(this,"dashOffset"),m(this,"dashRatio"),m(this,"useDash"),m(this,"useGradient"),m(this,"visibility"),m(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(r){this.uniforms.lineWidth.value=r}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(r){this.uniforms.map.value=r}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(r){this.uniforms.useMap.value=r}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(r){this.uniforms.alphaMap.value=r}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(r){this.uniforms.useAlphaMap.value=r}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(r){this.uniforms.color.value=r}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(r){this.uniforms.gradient.value=r}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(r){this.uniforms.opacity.value=r}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(r){this.uniforms.resolution.value.copy(r)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(r){this.uniforms.sizeAttenuation.value=r}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(r){this.uniforms.dashArray.value=r,this.useDash=r!==0?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(r){this.uniforms.dashOffset.value=r}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(r){this.uniforms.dashRatio.value=r}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(r){this.uniforms.useDash.value=r}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(r){this.uniforms.useGradient.value=r}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(r){this.uniforms.visibility.value=r}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(r){this.uniforms.alphaTest.value=r}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(r){this.uniforms.repeat.value.copy(r)}}}),this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.gradient=e.gradient,this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.useGradient=e.useGradient,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}};import{clamp as ki}from"three/src/math/MathUtils.js";var de=new Wi(0,0,0,"YXZ"),Be=new Bi;function Pt(t,e,r){t.matrixWorld.decompose(e.position,Be,e.scale),de.setFromQuaternion(Be),de.z=0,de.x=ki(de.x-10*Math.PI/180,-Math.PI/2,1.1*Math.PI/4),Be.setFromEuler(de),e.quaternion.slerp(Be,r/100)}function Ui(t){return t.userData.teleportTarget===!0}function Mt(t={}){return(e,r,n,o)=>!(!Ui(e)||t.filter!=null&&!t.filter(e,r,n,o))}function Et(){return new qi(new _t(0,0,0),new _t(0,0,-8),new _t(0,-20,-15)).getPoints(20)}var ce=class extends Gi{multiplier;lineLengths;options={};constructor(e){let r=new Ge,n=new Float32Array(e.length*3);for(let s=0;s<e.length;s++)e[s].toArray(n,s*3);r.setPoints(n);let o=(e.length*3-3)/(e.length*3-1),i=new qe({lineWidth:.1,resolution:void 0,visibility:o});super(r,i),this.material.transparent=!0,this.multiplier=o,this.material=i,this.lineLengths=e.slice(0,-1).map((s,a)=>s.distanceTo(e[a+1]))}update(e){if(!e.getEnabled()||e.getButtonsDown().size===0){this.visible=!1;return}this.visible=!0;let n=e.getIntersection();if(n?.details.type!="lines"){this.material.visibility=this.multiplier;return}let{distanceOnLine:o,lineIndex:i}=n.details,s=this.lineLengths[i];this.material.visibility=this.multiplier*(i+o/s)/this.lineLengths.length;let{color:a="white",opacity:u=.4,size:l=.01}=this.options;this.material.lineWidth=l,this.material.opacity=typeof u=="function"?u(e):u;let f=typeof a=="function"?a(e):a;Array.isArray(f)?this.material.color.set(...f):this.material.color.set(f)}};import{Matrix4 as Qi,Quaternion as Ni,Vector3 as $i}from"three";var jt=new Qi,ke=new $i,Jr=new Ni;async function zt(t,e,r=["point","plane","mesh"]){let n=t.getState();if(typeof e=="string"){if(n.session==null)return;e=await n.session.requestReferenceSpace(e)}let o=Array.isArray(r)?r:[r],i,s,a;if(e instanceof XRSpace)i={space:e,entityTypes:o},a=n.origin;else{let l=A(e,n.origin,n.originReferenceSpace,jt);if(l==null)return;ke.setFromMatrixPosition(jt);let f=j(ke);Jr.setFromRotationMatrix(jt),ke.set(0,0,-1).applyQuaternion(Jr);let c=new XRRay(f,j(ke,0));a=e,i={space:l,offsetRay:c,entityTypes:o},s=l}let u=await t.getState().session?.requestHitTestSource?.(i);if(u!=null)return{source:u,getWorldMatrix:Ki.bind(null,t,s,a)}}function Ki(t,e,r,n,o){if(e??=t.getState().originReferenceSpace,e==null)return!1;let i=o.getPose(e);return i==null?!1:(n.fromArray(i.transform.matrix),r!=null&&n.premultiply(r.matrixWorld),!0)}import{Matrix4 as en,Quaternion as tn,Vector3 as Ue}from"three";var pd=new Ue(1,1,1),dd=new Ue(0,0,0),md=new tn,hd=new en,yd=new en,xd=new tn,gd=new Ue,vd=new Ue;var it=new Zi;import{useFrame as ga}from"@react-three/fiber";import{forwardRef as va,useContext as Qn,useEffect as Sa,useImperativeHandle as ba,useMemo as Ra,useRef as wa,useState as Pa}from"react";import{createContext as Qe}from"react";var Vt=Qe(void 0),M=Qe(void 0),H=Qe(void 0),me=Qe(void 0);import{jsx as $t,jsxs as fa}from"react/jsx-runtime";import{useFrame as Kt,useThree as pa,useStore as da}from"@react-three/fiber";import{useContext as ma,useEffect as kn,useMemo as ha}from"react";var dn=ho(cn(),1);import ys from"react";var{useDebugValue:xs}=ys,{useSyncExternalStoreWithSelector:gs}=dn.default,fn=!1,vs=t=>t;function he(t,e=vs,r){(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&r&&!fn&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),fn=!0);let n=gs(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,r);return xs(n),n}var pn=t=>{(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let e=typeof t=="function"?yr(t):t,r=(n,o)=>he(e,n,o);return Object.assign(r,e),r},mn=t=>t?pn(t):pn;import{jsx as p,jsxs as Gn,Fragment as ee}from"react/jsx-runtime";import{context as ra,reconciler as na,useStore as oa}from"@react-three/fiber";import{Suspense as Se,useMemo as ia}from"react";var Ss=0,hn=new Map;function ye(t){let e=hn.get(t);return e==null&&hn.set(t,e=Ss++),e}import{useEffect as bm,useMemo as bs,useRef as Rs,useState as Rm,useSyncExternalStore as ws}from"react";function Gt(){return h(t=>t.visibilityState)}function qt(t,e){let r=Rs(e);r.current=e;let[n,o]=bs(()=>{let i;return[s=>{let a=!1;return navigator.xr==null?(i=!1,()=>{}):(navigator.xr.isSessionSupported(t).then(u=>{i=u,!a&&s()}).catch(u=>{a||r.current?.(u)}),()=>a=!0)},()=>i]},[t]);return ws(n,o)}import{jsx as x,jsxs as V,Fragment as Nt}from"react/jsx-runtime";import{useRef as Y,Suspense as On,useContext as Hn,useMemo as $s}from"react";import{jsx as Xs}from"react/jsx-runtime";import{forwardRef as xn,useImperativeHandle as gn,useMemo as Is,useRef as Ts,useState as As}from"react";var Ps=t=>typeof t=="object"&&typeof t.then=="function",$e=[];function Ms(t,e,r=(n,o)=>n===o){if(t===e)return!0;if(!t||!e)return!1;let n=t.length;if(e.length!==n)return!1;for(let o=0;o<n;o++)if(!r(t[o],e[o]))return!1;return!0}function Es(t,e=null,r=!1,n={}){e===null&&(e=[t]);for(let i of $e)if(Ms(e,i.keys,i.equal)){if(r)return;if(Object.prototype.hasOwnProperty.call(i,"error"))throw i.error;if(Object.prototype.hasOwnProperty.call(i,"response"))return n.lifespan&&n.lifespan>0&&(i.timeout&&clearTimeout(i.timeout),i.timeout=setTimeout(i.remove,n.lifespan)),i.response;if(!r)throw i.promise}let o={keys:e,equal:n.equal,remove:()=>{let i=$e.indexOf(o);i!==-1&&$e.splice(i,1)},promise:(Ps(t)?t:t(...e)).then(i=>{o.response=i,n.lifespan&&n.lifespan>0&&(o.timeout=setTimeout(o.remove,n.lifespan))}).catch(i=>o.error=i)};if($e.push(o),!r)throw o.promise}var yn=(t,e,r)=>Es(t,e,!1,r);import{createPortal as Ls,useFrame as Bt}from"@react-three/fiber";import{useContext as Cs,useEffect as Am}from"react";function C(t){let e=Cs(M);if(e==null||t!=null&&e.type!=t)throw new Error("useXRInputSourceStateContext() can only be used inside a the xr store config");return e}var zm=xn(({id:t,children:e,onPress:r,onRelease:n},o)=>{let i=C("controller"),[s,a]=As(void 0);if(gn(o,()=>s,[s]),Os(i,t,u=>u==="pressed"?r?.():n?.()),Bt(()=>a(i.gamepad[t]?.object)),s!=null)return Ls(e,s)});function Os(t,e,r){let n=Ts();Bt(()=>{let o=t?.gamepad[e]?.state;o!=null&&o!=n.current&&r(o),n.current=o})}var Hs=Symbol("loadXRControllerModel"),vn=xn((t,e)=>{let r=C("controller"),n=yn(Xe,[r.layout,void 0,Hs]);Ie(n,t),r.object=n,gn(e,()=>n,[n]);let o=Is(()=>Te(n,r.layout,r.gamepad),[n,r.layout,r.gamepad]);return Bt(o),Xs("primitive",{object:n})}),Vm=Symbol("loadXRControllerLayout");import{jsx as bn}from"react/jsx-runtime";import{forwardRef as Rn,useImperativeHandle as Fs,useMemo as Sn}from"react";import{useFrame as Ds,useLoader as _s}from"@react-three/fiber";import{GLTFLoader as js}from"three/examples/jsm/loaders/GLTFLoader.js";var wn=Rn((t,e)=>{let r=C("hand"),n=_s(js,r.assetPath),o=Sn(()=>lr(n),[n]);ot(o,t),Fs(e,()=>o,[o]);let i=Ke(),s=Sn(()=>st(r.inputSource.hand,o,i),[r.inputSource,o,i]);return Ds((a,u,l)=>s(l)),bn("primitive",{object:o})}),$m=Rn(({joint:t,children:e},r)=>{let n=C("hand");return bn(P,{ref:r,space:n.inputSource.hand.get(t),children:e})});import{jsx as Z,Fragment as zs,jsxs as Vs}from"react/jsx-runtime";import{forwardRef as Pn,useContext as Ws,useEffect as kt,useImperativeHandle as Mn,useMemo as E,useRef as Ut}from"react";import{createPortal as Gs,useFrame as En,useThree as qs}from"@react-three/fiber";function Qt({children:t}){let e=E(()=>new O(!1),[]);return ge(e),Z(me.Provider,{value:e,children:t})}function Ze(t){for(let e of Object.keys(t))delete t[e]}function Cn(t,e,r,n){let o=E(()=>({}),[]);Ze(o),Object.assign(o,r);let i=E(()=>St(t,e,o,n),[t,e,o,n]);return ge(i,r?.makeDefault),i}function Xn(t,e,r,n){let o=E(()=>({}),[]);Ze(o),Object.assign(o,r);let i=E(()=>bt(t,e,o,n),[t,e,o,n]);return ge(i,r?.makeDefault),i}function In(t,e,r,n){let o=E(()=>({}),[]);Ze(o),Object.assign(o,r);let i=E(()=>Rt(t,e,o,n),[t,e,o,n]);return ge(i,r?.makeDefault),i}function Tn(t,e,r,n){let o=E(()=>({}),[]);Ze(o),Object.assign(o,r);let i=E(()=>wt(t,e,o,n),[t,e,o,n]);return ge(i,r?.makeDefault),i}var An=Pn((t,e)=>{let r=E(()=>new oe,[]),n=Ut(null);return Mn(e,()=>n.current,[]),En(()=>n.current!=null&&ct(n.current,r,t.pointer,t)),Z("mesh",{matrixAutoUpdate:!1,renderOrder:t.renderOrder??2,ref:n,material:r,children:Z("boxGeometry",{})})}),xe=Pn((t,e)=>{let r=E(()=>new ne,[]),n=Ut(null),o=Ut(null);Mn(e,()=>n.current,[]),En(()=>n.current!=null&&o.current!=null&&lt(o.current,n.current,r,t.pointer,t));let i=qs(s=>s.scene);return Vs(zs,{children:[Z("group",{ref:o}),Gs(Z("mesh",{renderOrder:t.renderOrder??1,ref:n,matrixAutoUpdate:!1,material:r,children:Z("planeGeometry",{})}),i)]})});function Ye(t,e,r,n){let o=h(i=>i.session);kt(()=>{if(o!=null)return ft(t,o,e,r,n)},[r,e,t,o,n])}function ge(t,e=!1){let r=Ws(me);if(r==null)throw new Error("xr pointers can only be used inside the XR component");kt(()=>{let n=r.register(t,e);return()=>{n()}},[r,t,e]),kt(()=>{if(t instanceof R)return()=>t.exit({timeStamp:performance.now()})},[t])}import{jsx as Bs}from"react/jsx-runtime";import{useFrame as ks,useStore as ch}from"@react-three/fiber";import{forwardRef as Us,useEffect as ph,useImperativeHandle as Qs,useMemo as Ns,useRef as dh}from"react";var Ln=Us(({pointer:t,linePoints:e,...r},n)=>{let o=Ns(()=>new ce(e),[e]);return Qs(n,()=>o,[o]),o.options=r,ks(()=>o.update(t)),Bs("primitive",{object:o})});import{createPortal as Ks,useFrame as Zs,useThree as Ys}from"@react-three/fiber";function Fn(t,e,r){let n=Hn(M);if(n==null)throw new Error("DefaultXRInputSourceGrabPointer can only be used inside a XRInputSource");let o=Y(null),i=Cn(o,n,r);Ye(i,n.inputSource,t,n.events);let s=r.cursorModel;return x(P,{ref:o,space:e(n.inputSource),children:s!==!1&&x(xe,{pointer:i,opacity:Me,...S(s)})})}var Js=Fn.bind(null,"select",t=>t.hand.get("index-finger-tip")),ea=Fn.bind(null,"squeeze",t=>t.gripSpace);function ve(t){let e=C(),r=Y(null),n=Xn(r,e,t);Ye(n,e.inputSource,"select",e.events);let o=t.rayModel,i=t.cursorModel;return V(P,{ref:r,space:e.inputSource.targetRaySpace,children:[o!==!1&&x(An,{pointer:n,opacity:D,...S(o)}),i!==!1&&x(xe,{pointer:n,opacity:D,...S(i)})]})}function ta(t){let e=C("hand"),r=Y(null),n=Tn(r,e,t),o=t.cursorModel;return x(P,{ref:r,space:e.inputSource.hand.get("index-finger-tip"),children:o!==!1&&x(xe,{pointer:n,opacity:Ee,...S(o)})})}function Dn(t){let e=t.model,r=t.grabPointer,n=t.rayPointer,o=t.teleportPointer??!1;return V(Nt,{children:[e!==!1&&x(On,{children:x(vn,{...S(e)})}),V(Qt,{children:[r!==!1&&x(ea,{...S(r)}),n!==!1&&x(ve,{makeDefault:!0,minDistance:.2,...S(n)}),o!==!1&&x(Wn,{...S(o)})]})]})}function _n(t){let e=t.model,r=t.grabPointer,n=t.rayPointer,o=t.touchPointer,i=t.teleportPointer??!1,s=n===!1?!1:S(n)?.rayModel;return V(Nt,{children:[e!==!1&&x(On,{children:x(wn,{...S(e)})}),V(Qt,{children:[r!==!1&&x(Js,{...S(r)}),o!==!1&&x(ta,{...S(o)}),n!==!1&&x(ve,{makeDefault:!0,minDistance:.2,...S(n),rayModel:s===!1?!1:{maxLength:.2,...S(s)}}),i!==!1&&x(Wn,{...S(i)})]})]})}function jn(t){return x(ve,{...t,rayModel:!1})}function zn(t){return x(ve,{...t,rayModel:!1})}function Vn(t){return x(ve,{...t,cursorModel:!1,rayModel:!1})}function Wn(t){let e=Hn(M);if(e==null)throw new Error("DefaultXRInputSourceRayPointer can only be used inside a XRInputSource");let r=Y(null),n=Y(null),o=$s(()=>Et(),[]),i=In(n,e,{...t,linePoints:o,filter:Mt(t)},"teleport");Ye(i,e.inputSource,"select",e.events);let s=t.rayModel,a=t.cursorModel,u=Ys(f=>f.scene),l=Y(null);return Zs((f,c)=>{l.current!=null&&(l.current.visible=i.getEnabled()&&i.getButtonsDown().size>0);let g=n.current,y=r.current;g==null||y==null||Pt(y,g,c*1e3)}),V(Nt,{children:[x(P,{ref:r,space:e.inputSource.targetRaySpace}),Ks(V("group",{ref:n,children:[s!==!1&&x(Ln,{linePoints:o,pointer:i,opacity:D,...S(s)}),a!==!1&&x(xe,{ref:l,pointer:i,opacity:D,...S(a)})]}),u)]})}function S(t){if(t!==!0)return t}function J(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(let[n,o]of t)if(!Object.is(o,e.get(n)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(let n of t)if(!e.has(n))return!1;return!0}let r=Object.keys(t);if(r.length!==Object.keys(e).length)return!1;for(let n of r)if(!Object.prototype.hasOwnProperty.call(e,n)||!Object.is(t[n],e[n]))return!1;return!0}function qn({children:t}){let e=h(s=>s.originReferenceSpace),r=h(s=>s.origin),n=Gt()==="visible",o=oa(),i=ia(()=>Object.assign({},o,{getState(){return{...o.getState(),scene:r}}}),[r,o]);return r==null||e==null?null:p(ee,{children:na.createPortal(p(ra.Provider,{value:o,children:Gn(H.Provider,{value:e,children:[Gn("group",{matrixAutoUpdate:!1,visible:n,children:[p(sa,{}),p(aa,{}),p(ua,{}),p(la,{}),p(ca,{})]}),t]})}),i,null)})}function sa(){let t=h(r=>r.inputSourceStates.filter(n=>n.type==="controller"),J),e=h(r=>r.controller);return e===!1?null:p(ee,{children:t.map(r=>{let n=ie(e,r.inputSource.handedness,{});return n===!1?null:p(P,{space:r.inputSource.gripSpace,children:p(M.Provider,{value:r,children:p(Se,{children:typeof n=="function"?p(n,{}):p(Dn,{...n})})})},r.id)})})}function aa(){let t=h(r=>r.inputSourceStates.filter(n=>n.type==="hand"),J),e=h(r=>r.hand);return e===!1?null:p(ee,{children:t.map(r=>{let n=ie(e,r.inputSource.handedness,{});return n===!1?null:p(P,{space:r.inputSource.hand.get("wrist"),children:p(M.Provider,{value:r,children:p(Se,{children:typeof n=="function"?p(n,{}):p(_n,{...n})})})},ye(r))})})}function ua(){let t=h(r=>r.inputSourceStates.filter(n=>n.type==="transientPointer"),J),e=h(r=>r.transientPointer);return e===!1?null:p(ee,{children:t.map(r=>{let n=ie(e,r.inputSource.handedness,{});return n===!1?null:p(P,{space:r.inputSource.targetRaySpace,children:p(M.Provider,{value:r,children:p(Se,{children:typeof n=="function"?p(n,{}):p(jn,{...n})})})},ye(r))})})}function la(){let t=h(r=>r.inputSourceStates.filter(n=>n.type==="gaze"),J),e=h(r=>r.gaze);return e===!1?null:p(ee,{children:t.map(r=>p(P,{space:r.inputSource.targetRaySpace,children:p(M.Provider,{value:r,children:p(Se,{children:typeof e=="function"?p(e,{}):p(zn,{...Bn(e)})})})},ye(r)))})}function ca(){let t=h(r=>r.inputSourceStates.filter(n=>n.type==="screenInput"),J),e=h(r=>r.screenInput);return e===!1?null:p(ee,{children:t.map(r=>p(P,{space:r.inputSource.targetRaySpace,children:p(M.Provider,{value:r,children:p(Se,{children:typeof e=="function"?p(e,{}):p(Vn,{...Bn(e)})})})},ye(r)))})}function Bn(t){if(t!==!0)return t}function ya({children:t,store:e}){e.setWebXRManager(pa(n=>n.gl.xr));let r=da();return kn(()=>{let n;return e.subscribe((o,i)=>{if(o.session!==i.session){if(o.session!=null){let{camera:s,gl:a}=r.getState();n=s,r.setState({camera:a.xr.getCamera()});return}n!=null&&r.setState({camera:n})}})},[r,e]),Kt((n,o,i)=>e.onBeforeFrame(n.scene,n.camera,i),-1e3),Kt(()=>e.onBeforeRender()),$t(Vt.Provider,{value:e,children:fa(xa,{children:[$t(qn,{}),t]})})}function xa({children:t}){let e=W(),r=ha(()=>new O(!0),[]);return kn(()=>at(e,n=>r.setEnabled(n,{timeStamp:performance.now()})),[e,r]),Kt(n=>r.move(n.scene,{timeStamp:performance.now()}),-50),$t(me.Provider,{value:r,children:t})}function W(){let t=ma(Vt);if(t==null)throw new Error("XR features can only be used inside the <XR> component");return t}function h(t=r=>r,e){return he(W(),t,e)}var P=va(({space:t,children:e},r)=>{let n=wa(null),o=typeof t=="string"?Ke(t):t;return ba(r,()=>n.current,[]),Ea(n,o,(i,s,a)=>{n.current!=null&&(n.current.visible=a!=null)}),o==null?null:Un("group",{xrSpace:o,visible:!1,matrixAutoUpdate:!1,ref:n,children:Un(H.Provider,{value:o,children:e})})});function Ke(t){if(t==null){let o=Qn(H);if(o==null)throw new Error("XR objects must be placed inside the XROrigin");return o}let[e,r]=Pa(void 0),n=h(o=>o.session);return Sa(()=>{if(n==null)return;let o=!1;return n.requestReferenceSpace(t).then(i=>{o||r(i)}),()=>void(o=!0)},[n,t]),e}function Ma(t){let e=Qn(H),r=h(n=>e??n.originReferenceSpace);return Ra(()=>t==null||r==null?void 0:pt(t,r),[t,r])}function Ea(t,e,r){let n=Ma(e);ga((o,i,s)=>{t.current==null||n==null||(n(t.current.matrix,s),r?.(o,i,s))},-100)}import{jsx as Ca}from"react/jsx-runtime";import{forwardRef as Xa,useEffect as Ia,useMemo as sy,useState as Ta}from"react";import{useFrame as Aa}from"@react-three/fiber";var cy=Xa(({mesh:t,...e},r)=>{let n=La(t);return Ca("mesh",{ref:r,geometry:n,...e})});function La(t,e=!0){let[r,n]=Ta(ze(t,void 0));return Aa(()=>n(o=>ze(t,o))),Ia(()=>{if(e)return()=>r.dispose()},[r]),r}import{jsx as Oa}from"react/jsx-runtime";import{forwardRef as Ha,useEffect as Fa,useMemo as my,useState as Da}from"react";import{useFrame as _a}from"@react-three/fiber";var gy=Ha(({plane:t,...e},r)=>{let n=ja(t);return Oa("mesh",{ref:r,geometry:n,...e})});function ja(t,e=!0){let[r,n]=Da(We(t,void 0));return _a(()=>n(o=>We(t,o))),Fa(()=>{if(e)return()=>r.dispose()},[r]),r}import{jsx as Ry,Fragment as wy}from"react/jsx-runtime";import{useFrame as Ey,useThree as Cy}from"@react-three/fiber";import{useRef as Iy,useState as Ty}from"react";import{jsx as Oy,Fragment as Hy}from"react/jsx-runtime";import{jsx as jy,Fragment as zy}from"react/jsx-runtime";import{jsx as qy,Fragment as By}from"react/jsx-runtime";import{jsx as Nn}from"react/jsx-runtime";import{useThree as za}from"@react-three/fiber";import{forwardRef as Va,useEffect as Wa,useImperativeHandle as Ga,useRef as qa}from"react";var nx=Va(({children:t,...e},r)=>{let n=za(s=>s.gl.xr.getCamera()),o=qa(null);Ga(r,()=>o.current,[]);let i=h(s=>s.originReferenceSpace);return Wa(()=>{let s=o.current;if(s!=null)return s.add(n),()=>void s.remove(n)},[n]),Nn("group",{ref:o,...e,children:i!=null&&Nn(H.Provider,{value:i,children:t})})});import{jsx as ka}from"react/jsx-runtime";import{forwardRef as Ua,useCallback as Qa,useEffect as Na,useImperativeHandle as $a,useRef as $n,useState as ax}from"react";import{useFrame as Ka}from"@react-three/fiber";function Za(t,e,r){let n=$n(void 0);Ya(e,r,Qa(o=>n.current=o,[])),Ka((o,i,s)=>{t==null||s==null||n.current==null||t(s.getHitTestResults(n.current.source),n.current.getWorldMatrix)})}function Ya(t,e,r){let n=W();Na(()=>{let o,i=!1,s=t instanceof XRSpace||typeof t=="string"?t:t?.current;if(s!=null)return zt(n,s,e).then(a=>{i||(o=a,r(a))}),()=>{r(void 0),i=!0,o?.source.cancel()}},[n,t,e,r])}var fx=Ua(({trackableType:t,onResults:e,space:r,...n},o)=>{let i=$n(null);return $a(o,()=>i.current),Za(e,r??i,t),ka("group",{...n,ref:i})});import{useState as yx,useRef as xx,useCallback as gx,useEffect as vx,useMemo as Sx}from"react";import{jsx as Zt}from"react/jsx-runtime";import{forwardRef as eu,useEffect as tu,useMemo as ru}from"react";import{createRoot as nu}from"react-dom/client";import Je from"react";var Kn,Zn,Yn=typeof window<"u"&&((Kn=window.document)!=null&&Kn.createElement||((Zn=window.navigator)==null?void 0:Zn.product)==="ReactNative")?Je.useLayoutEffect:Je.useEffect;function Jn(){let t=mn(e=>({current:new Array,version:0,set:e}));return{In:({children:e})=>{let r=t(o=>o.set),n=t(o=>o.version);return Yn(()=>{r(o=>({version:o.version+1}))},[]),Yn(()=>(r(({current:o})=>({current:[...o,e]})),()=>r(({current:o})=>({current:o.filter(i=>i!==e)}))),[e,n]),null},Out:()=>{let e=t(r=>r.current);return Je.createElement(Je.Fragment,null,e)}}}var Lx=eu((t,e)=>{let r=h(i=>i.domOverlayRoot),{In:n,Out:o}=ru(Jn,[]);return tu(()=>{let i=nu(r);return i.render(Zt(o,{})),()=>i.unmount()},[r,o]),Zt(n,{children:Zt("div",{...t,ref:e})})});import{jsx as tt,Fragment as jx,jsxs as zx}from"react/jsx-runtime";import{context as Gx,reconciler as qx,useFrame as ou,useStore as Bx,useThree as iu}from"@react-three/fiber";import{forwardRef as eo,useEffect as to,useImperativeHandle as su,useMemo as Ux,useRef as et,useState as Qx}from"react";import{OrthographicCamera as Zx,PerspectiveCamera as Yx,Raycaster as Jx,Scene as eg,Vector2 as tg,Vector3 as rg,WebGLRenderTarget as ro}from"three";var og=eo(({src:t,shape:e,colorFormat:r,depthFormat:n,layout:o,mipLevels:i,renderOrder:s=0,blendTextureSourceAlpha:a,centralAngle:u,centralHorizontalAngle:l,chromaticAberrationCorrection:f,lowerVerticalAngle:c,quality:g,upperVerticalAngle:y,invertStereo:b,pixelWidth:te,pixelHeight:tr,dpr:rr,renderTargetRef:nr,layerEntryRef:T,...io},so)=>{let G=et(null),rt=iu(q=>q.gl),F=W(),or={blendTextureSourceAlpha:a,centralAngle:u,centralHorizontalAngle:l,chromaticAberrationCorrection:f,lowerVerticalAngle:c,quality:g,upperVerticalAngle:y},be=et(or);be.current=or;let ir=et(s);return ir.current=s,to(()=>{if(G.current==null)return;let q=t??(nr.current=Ht(te,tr,rr)),re=Xt(q,F.getState(),rt.xr,G.current,{colorFormat:r,depthFormat:n,invertStereo:b,layout:o,mipLevels:i,shape:e},be.current);if(re==null)return;let nt=T.current={layer:re,renderOrder:ir.current};if(F.addLayerEntry(nt),q instanceof HTMLVideoElement||q instanceof ro)return()=>{F.removeLayerEntry(nt),re.destroy()};let ao=Tt(rt,F,re,q);return()=>{F.removeLayerEntry(nt),ao(),re.destroy()}},[r,n,b,T,o,i,tr,te,rr,nr,rt,e,t,F]),T.current!=null&&(T.current.renderOrder=s),T.current!=null&&pe(T.current.layer,be.current),ou(()=>{T.current==null||G.current==null||Lt(F.getState(),T.current.layer,be.current.centralAngle,G.current)}),su(so,()=>G.current,[]),tt("mesh",{...io,renderOrder:-1/0,ref:G,children:tt("meshBasicMaterial",{colorWrite:!1})})}),ig=eo(({src:t,renderTargetRef:e,dpr:r,renderOrder:n,pixelWidth:o,pixelHeight:i,...s},a)=>{let u=et(null);return to(()=>{if(u.current==null)return;let l=t??(e.current=Ht(o,i,r)),f=At(l);return u.current.map=f,u.current.needsUpdate=!0,()=>{if(l instanceof ro){l.dispose();return}f.dispose()}},[t,o,i,r,e]),tt("mesh",{ref:a,...s,children:tt("meshBasicMaterial",{ref:u,toneMapped:!1})})});import{jsx as Yt}from"react/jsx-runtime";import{forwardRef as Jt}from"react";var no=Jt(({store:t,mode:e,onError:r,children:n,...o},i)=>{let s=he(t,u=>u.session),a=qt(e,r);return Yt("button",{ref:i,...o,onClick:()=>s!=null?s.end():t.enterXR(e).catch(r),children:typeof n=="function"?n(a?s!=null?"entered":"exited":"unsupported"):n})}),fg=Jt((t,e)=>Yt(no,{ref:e,mode:"immersive-ar",...t})),au=Jt((t,e)=>Yt(no,{ref:e,mode:"immersive-vr",...t}));import{useEffect as uu,useRef as lu}from"react";var cu={onBlur:"pointerleave",onHover:"pointerenter",onMove:"pointermove",onSelect:{type:"click",filter:t=>t.pointerType==="ray"},onSelectEnd:{type:"pointerup",filter:t=>t.pointerType==="ray"},onSelectStart:{type:"pointerdown",filter:t=>t.pointerType==="ray"},onSqueeze:{type:"click",filter:t=>t.pointerType==="grab"},onSqueezeEnd:{type:"pointerup",filter:t=>t.pointerType==="grab"},onSqueezeStart:{type:"pointerdown",filter:t=>t.pointerType==="grab"}};function X(t,e,r){let n=lu(r);n.current=r,uu(()=>{let{current:o}=t;if(o==null)return;let i=cu[e],s=typeof i=="string"?u=>n.current?.({intersection:u,intersections:[u],target:u.pointerState}):u=>{u instanceof v&&!i.filter(u)||n.current?.({intersection:u,intersections:[u],target:u.pointerState})},a=typeof i=="string"?i:i.type;return o.addEventListener(a,s),()=>o.removeEventListener(a,s)},[t,e])}import{jsx as fu}from"react/jsx-runtime";import{forwardRef as pu,useImperativeHandle as du,useRef as mu}from"react";var er=pu(({onHover:t,onBlur:e,onSelectStart:r,onSelectEnd:n,onSelect:o,onSqueezeStart:i,onSqueezeEnd:s,onSqueeze:a,onMove:u,children:l},f)=>{let c=mu(null);return du(f,()=>c.current),X(c,"onHover",t),X(c,"onBlur",e),X(c,"onSelectStart",r),X(c,"onSelectEnd",n),X(c,"onSelect",o),X(c,"onSqueezeStart",i),X(c,"onSqueezeEnd",s),X(c,"onSqueeze",a),X(c,"onMove",u),fu("group",{ref:c,children:l})});import{jsx as hu}from"react/jsx-runtime";import{forwardRef as yu,useImperativeHandle as xu,useMemo as gu,useRef as oo}from"react";import{Matrix4 as vu}from"three";import{useFrame as Su}from"@react-three/fiber";var Tg=yu(function({onSelectStart:e,onSelectEnd:r,children:n,...o},i){let s=oo(),a=oo(null),u=gu(()=>new vu,[]);return xu(i,()=>a.current),Su(()=>{let l=s.current,f=a.current;!f||!l||(f.applyMatrix4(u),f.applyMatrix4(l.matrixWorld),f.updateMatrixWorld(),u.copy(l.matrixWorld).invert())}),hu(er,{ref:a,onSelectStart:l=>{Pe(l.target)&&(l.target.type==="controller"||l.target.type==="hand")&&l.target.object!=null&&(s.current=l.target.object,u.copy(l.target.object.matrixWorld).invert(),e?.(l))},onSelectEnd:l=>{l.target.controller===s.current&&(s.current=void 0),r?.(l)},...o,children:n})});export{er as Interactive,au as VRButton,ya as XR};
/*! Bundled license information:

use-sync-external-store/cjs/use-sync-external-store-shim.production.min.js:
  (**
   * @license React
   * use-sync-external-store-shim.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.min.js:
  (**
   * @license React
   * use-sync-external-store-shim/with-selector.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
//# sourceMappingURL=xr.bundle.mjs.map