<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="/" />
    <meta charset="utf-8" />
    <meta
      name="theme-color"
      content="#ffffff"
      media="(prefers-color-scheme: light)"
    />
    <meta
      name="theme-color"
      content="#000000"
      media="(prefers-color-scheme: dark)"
    />
    <meta
      name="description"
      content="spike.land, an online content Editor with AI support"
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap"
      as="style"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap"
      rel="stylesheet"
    />

    <!-- Content Security Policy (unchanged) -->
    <meta
      http-equiv="Content-Security-Policy"
      content="
    default-src 'self' ;
    media-src 'self' blob:;
    script-src 'self'  https://cdn.jsdelivr.net https://esm.sh https://static.cloudflareinsights.com data: https://clerk.spike.land blob: 'unsafe-eval' 'unsafe-inline';
    worker-src 'self'  https://storage.googleapis.com https://esm.sh blob:;
    style-src 'self'  https://esm.sh 'unsafe-inline' https://fonts.googleapis.com;
    connect-src 'self'  https://cdn.jsdelivr.net blob: https://esm.sh https://clerk.spike.land wss://*.peerjs.com;
    font-src 'self'  data: blob: https://esm.sh https://fonts.gstatic.com;
    img-src 'self'  https://esm.sh data: blob: https://img.clerk.com https://*.clerk.dev;
    "
    />

    <link
      rel="manifest"
      href="/assets/manifest.webmanifest"
      type="application/manifest+json"
    />

    <link rel="preload" href="/app/tw-global.css" as="style" />
    <link rel="stylesheet" href="/app/tw-global.css" />

    <link rel="preload" href="/assets/app.css" as="style" />
    <link rel="stylesheet" href="/assets/app.css" />

    <!-- Inline style for initial theme -->

    <script type="importmap"></script>

    <script>
      (function() {
        function getInitialTheme() {
          // First check if there's a saved preference
          const savedTheme = localStorage.getItem('darkMode');
          if (savedTheme !== null) {
            return savedTheme === 'true';
          }
          
          // Otherwise use system preference
          return window.matchMedia && 
            window.matchMedia('(prefers-color-scheme: dark)').matches;
        }

        // Apply theme immediately to prevent flash
        const isDark = getInitialTheme();
        document.documentElement.classList.add(isDark ? 'dark' : 'light');
        
        // Store the initial value if not already set
        if (localStorage.getItem('darkMode') === null) {
          localStorage.setItem('darkMode', isDark.toString());
        }

        // Handle system theme changes before React loads
        const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        darkModeMediaQuery.addListener(function(e) {
          if (localStorage.getItem('darkMode') === null) {
            document.documentElement.classList.remove('light', 'dark');
            document.documentElement.classList.add(e.matches ? 'dark' : 'light');
          }
        });
      })();
    </script>

    <link
      rel="shortcut icon"
      type="image/png"
      href="/assets/favicons/chunk-chunk-fe2f7da4f9ccc2.png"
    />
    <title>Instant React Editor</title>

    <!-- Inline LINK for initial theme -->
  </head>
  <body>
    <div id="embed"></div>

    <script type="module" src="/start.mjs"></script>
  </body>
</html>
