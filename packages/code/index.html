<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html,charset=utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <link rel="icon" type="image/png" href="./assets/zed-icon-big.png" />
  <link rel="modulepreload" href="./modules/renderer.mjs">
  <link rel="modulepreload" href="./js/codeLoader.mjs">
  <link rel="stylesheet" href="./assets/app.css" />
  <link rel="stylesheet" href="./assets/roboto.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin="anonymous" />
<title>Instant React Editor</title>
</head>
<body>
  <script type="module">
    try{
      start();
    }catch(error){
      console.error({error});
      fetch("https://zed.vision/error", {method: "POST",  body: JSON.stringify({error})})
    }

  async function start() {
    try{
    const {run} = await import("./js/codeLoader.mjs");
      run("window", window);
    } catch(e) {
      const {run} = await import("https://unpkg.com/@zedvision/code@13.0.9/js/codeLoader.mjs");
      run("window", window);
    }
      setTimeout(()=>workBox(), 3000);

  }

  async function workBox() {
  if ("serviceWorker" in window.navigator && window.location.origin==="https://code.zed.vision") {

    fetch("https://code.zed.vision/check").then((x) => x.json()).then((x) =>
      x.missing
    ).then((x) => {
      if (x.length) {
        import("./js/ipfsClient.mjs").then(({ ipfsCat }) => {
          x.map((cid) => ipfsCat(cid).then(content=>fetch(`https://code.zed.vision/add/${cid}`,{method: "POST", body: content}       )));
        });
      }
    }); 

    const { Workbox } = await import(
      "https://storage.googleapis.com/workbox-cdn/releases/6.1.1/workbox-window.prod.mjs"
    );
    const wb = new Workbox(`./generated-sw.js`);

    wb.addEventListener("activated", (event) => {
      if (!event.isUpdate && !window.monaco) {
        console.log("Service worker activated for the first time!");
      }
    });

    return wb.register();
  }
}

  </script>
  
</body>
</html>