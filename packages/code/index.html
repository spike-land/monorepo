<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="icon" type="image/png" href="./assets/zed-icon-big.png" />
  <link rel="stylesheet" href="assets/app.css" />
  <link rel="stylesheet" href="assets/roboto.css" />
  <link rel="stylesheet" href="assets/normalize.min.css" />
<title>Instant React Editor</title>
</head>
<body>
  <script type="module">

workBox();

async function workBox() {
  if ("serviceWorker" in window.navigator) {
    const { Workbox } = await import(
      "https://storage.googleapis.com/workbox-cdn/releases/6.0.2/workbox-window.prod.mjs"
    );
    const {navigator, location} = window;

    // navigator.serviceWorker &&
    //   navigator.serviceWorker.controller &&
    //   navigator.serviceWorker.controller.unregister();

    const wb = new Workbox("/sw.js");


//    navigator.serviceWorker.controller && startApp();

    wb.addEventListener('activated', async (event) => {

      if (!event.isUpdate || !window.monaco) {
        location.reload()
          // startApp();
   
      }
    });

    wb.register();
  }
  try{
    startApp();
  } catch(e) {
    console.log({e});
  }
}

async function startApp(){
  try{
  const {run} = await import ("./src/codeLoader.js")
  run("window", window);
  } catch(e) {
    console.log("some error", {e});
  }
}

  </script>
</body>
</html>