// ../../packages/code/package.json
var version = "0.0.95";

// ../../packages/code/js/importmap.json
var imports = {
  "@babel/runtime/helpers/asyncIterator": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/asyncIterator.js",
  "@babel/runtime/helpers/esm/asyncIterator": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/asyncIterator.js",
  "@babel/runtime/helpers/jsx": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/jsx.js",
  "@babel/runtime/helpers/esm/jsx": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/jsx.js",
  "@babel/runtime/helpers/objectSpread2": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/objectSpread2.js",
  "@babel/runtime/helpers/esm/objectSpread2": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/objectSpread2.js",
  "@babel/runtime/helpers/typeof": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/typeof.js",
  "@babel/runtime/helpers/esm/typeof": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/typeof.js",
  "@babel/runtime/helpers/wrapRegExp": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/wrapRegExp.js",
  "@babel/runtime/helpers/esm/wrapRegExp": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/wrapRegExp.js",
  "@babel/runtime/helpers/AwaitValue": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/AwaitValue.js",
  "@babel/runtime/helpers/esm/AwaitValue": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/AwaitValue.js",
  "@babel/runtime/helpers/AsyncGenerator": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/AsyncGenerator.js",
  "@babel/runtime/helpers/esm/AsyncGenerator": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/AsyncGenerator.js",
  "@babel/runtime/helpers/wrapAsyncGenerator": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/wrapAsyncGenerator.js",
  "@babel/runtime/helpers/esm/wrapAsyncGenerator": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/wrapAsyncGenerator.js",
  "@babel/runtime/helpers/awaitAsyncGenerator": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/awaitAsyncGenerator.js",
  "@babel/runtime/helpers/esm/awaitAsyncGenerator": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/awaitAsyncGenerator.js",
  "@babel/runtime/helpers/asyncGeneratorDelegate": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/asyncGeneratorDelegate.js",
  "@babel/runtime/helpers/esm/asyncGeneratorDelegate": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/asyncGeneratorDelegate.js",
  "@babel/runtime/helpers/asyncToGenerator": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/asyncToGenerator.js",
  "@babel/runtime/helpers/esm/asyncToGenerator": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/asyncToGenerator.js",
  "@babel/runtime/helpers/classCallCheck": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classCallCheck.js",
  "@babel/runtime/helpers/esm/classCallCheck": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classCallCheck.js",
  "@babel/runtime/helpers/createClass": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/createClass.js",
  "@babel/runtime/helpers/esm/createClass": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/createClass.js",
  "@babel/runtime/helpers/defineEnumerableProperties": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/defineEnumerableProperties.js",
  "@babel/runtime/helpers/esm/defineEnumerableProperties": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/defineEnumerableProperties.js",
  "@babel/runtime/helpers/defaults": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/defaults.js",
  "@babel/runtime/helpers/esm/defaults": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/defaults.js",
  "@babel/runtime/helpers/defineProperty": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/defineProperty.js",
  "@babel/runtime/helpers/esm/defineProperty": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/defineProperty.js",
  "@babel/runtime/helpers/extends": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/extends.js",
  "@babel/runtime/helpers/esm/extends": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/extends.js",
  "@babel/runtime/helpers/objectSpread": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/objectSpread.js",
  "@babel/runtime/helpers/esm/objectSpread": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/objectSpread.js",
  "@babel/runtime/helpers/inherits": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/inherits.js",
  "@babel/runtime/helpers/esm/inherits": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/inherits.js",
  "@babel/runtime/helpers/inheritsLoose": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/inheritsLoose.js",
  "@babel/runtime/helpers/esm/inheritsLoose": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/inheritsLoose.js",
  "@babel/runtime/helpers/getPrototypeOf": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/getPrototypeOf.js",
  "@babel/runtime/helpers/esm/getPrototypeOf": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/getPrototypeOf.js",
  "@babel/runtime/helpers/setPrototypeOf": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/setPrototypeOf.js",
  "@babel/runtime/helpers/esm/setPrototypeOf": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/setPrototypeOf.js",
  "@babel/runtime/helpers/isNativeReflectConstruct": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/isNativeReflectConstruct.js",
  "@babel/runtime/helpers/esm/isNativeReflectConstruct": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/isNativeReflectConstruct.js",
  "@babel/runtime/helpers/construct": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/construct.js",
  "@babel/runtime/helpers/esm/construct": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/construct.js",
  "@babel/runtime/helpers/isNativeFunction": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/isNativeFunction.js",
  "@babel/runtime/helpers/esm/isNativeFunction": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/isNativeFunction.js",
  "@babel/runtime/helpers/wrapNativeSuper": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/wrapNativeSuper.js",
  "@babel/runtime/helpers/esm/wrapNativeSuper": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/wrapNativeSuper.js",
  "@babel/runtime/helpers/instanceof": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/instanceof.js",
  "@babel/runtime/helpers/esm/instanceof": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/instanceof.js",
  "@babel/runtime/helpers/interopRequireDefault": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/interopRequireDefault.js",
  "@babel/runtime/helpers/esm/interopRequireDefault": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/interopRequireDefault.js",
  "@babel/runtime/helpers/interopRequireWildcard": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/interopRequireWildcard.js",
  "@babel/runtime/helpers/esm/interopRequireWildcard": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/interopRequireWildcard.js",
  "@babel/runtime/helpers/newArrowCheck": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/newArrowCheck.js",
  "@babel/runtime/helpers/esm/newArrowCheck": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/newArrowCheck.js",
  "@babel/runtime/helpers/objectDestructuringEmpty": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/objectDestructuringEmpty.js",
  "@babel/runtime/helpers/esm/objectDestructuringEmpty": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/objectDestructuringEmpty.js",
  "@babel/runtime/helpers/objectWithoutPropertiesLoose": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/objectWithoutPropertiesLoose.js",
  "@babel/runtime/helpers/esm/objectWithoutPropertiesLoose": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/objectWithoutPropertiesLoose.js",
  "@babel/runtime/helpers/objectWithoutProperties": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/objectWithoutProperties.js",
  "@babel/runtime/helpers/esm/objectWithoutProperties": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/objectWithoutProperties.js",
  "@babel/runtime/helpers/assertThisInitialized": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/assertThisInitialized.js",
  "@babel/runtime/helpers/esm/assertThisInitialized": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/assertThisInitialized.js",
  "@babel/runtime/helpers/possibleConstructorReturn": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/possibleConstructorReturn.js",
  "@babel/runtime/helpers/esm/possibleConstructorReturn": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/possibleConstructorReturn.js",
  "@babel/runtime/helpers/createSuper": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/createSuper.js",
  "@babel/runtime/helpers/esm/createSuper": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/createSuper.js",
  "@babel/runtime/helpers/superPropBase": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/superPropBase.js",
  "@babel/runtime/helpers/esm/superPropBase": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/superPropBase.js",
  "@babel/runtime/helpers/get": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/get.js",
  "@babel/runtime/helpers/esm/get": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/get.js",
  "@babel/runtime/helpers/set": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/set.js",
  "@babel/runtime/helpers/esm/set": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/set.js",
  "@babel/runtime/helpers/taggedTemplateLiteral": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/taggedTemplateLiteral.js",
  "@babel/runtime/helpers/esm/taggedTemplateLiteral": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/taggedTemplateLiteral.js",
  "@babel/runtime/helpers/taggedTemplateLiteralLoose": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/taggedTemplateLiteralLoose.js",
  "@babel/runtime/helpers/esm/taggedTemplateLiteralLoose": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/taggedTemplateLiteralLoose.js",
  "@babel/runtime/helpers/readOnlyError": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/readOnlyError.js",
  "@babel/runtime/helpers/esm/readOnlyError": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/readOnlyError.js",
  "@babel/runtime/helpers/writeOnlyError": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/writeOnlyError.js",
  "@babel/runtime/helpers/esm/writeOnlyError": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/writeOnlyError.js",
  "@babel/runtime/helpers/classNameTDZError": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classNameTDZError.js",
  "@babel/runtime/helpers/esm/classNameTDZError": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classNameTDZError.js",
  "@babel/runtime/helpers/temporalUndefined": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/temporalUndefined.js",
  "@babel/runtime/helpers/esm/temporalUndefined": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/temporalUndefined.js",
  "@babel/runtime/helpers/tdz": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/tdz.js",
  "@babel/runtime/helpers/esm/tdz": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/tdz.js",
  "@babel/runtime/helpers/temporalRef": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/temporalRef.js",
  "@babel/runtime/helpers/esm/temporalRef": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/temporalRef.js",
  "@babel/runtime/helpers/slicedToArray": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/slicedToArray.js",
  "@babel/runtime/helpers/esm/slicedToArray": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/slicedToArray.js",
  "@babel/runtime/helpers/slicedToArrayLoose": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/slicedToArrayLoose.js",
  "@babel/runtime/helpers/esm/slicedToArrayLoose": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/slicedToArrayLoose.js",
  "@babel/runtime/helpers/toArray": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/toArray.js",
  "@babel/runtime/helpers/esm/toArray": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/toArray.js",
  "@babel/runtime/helpers/toConsumableArray": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/toConsumableArray.js",
  "@babel/runtime/helpers/esm/toConsumableArray": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/toConsumableArray.js",
  "@babel/runtime/helpers/arrayWithoutHoles": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/arrayWithoutHoles.js",
  "@babel/runtime/helpers/esm/arrayWithoutHoles": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/arrayWithoutHoles.js",
  "@babel/runtime/helpers/arrayWithHoles": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/arrayWithHoles.js",
  "@babel/runtime/helpers/esm/arrayWithHoles": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/arrayWithHoles.js",
  "@babel/runtime/helpers/maybeArrayLike": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/maybeArrayLike.js",
  "@babel/runtime/helpers/esm/maybeArrayLike": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/maybeArrayLike.js",
  "@babel/runtime/helpers/iterableToArray": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/iterableToArray.js",
  "@babel/runtime/helpers/esm/iterableToArray": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/iterableToArray.js",
  "@babel/runtime/helpers/iterableToArrayLimit": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/iterableToArrayLimit.js",
  "@babel/runtime/helpers/esm/iterableToArrayLimit": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/iterableToArrayLimit.js",
  "@babel/runtime/helpers/iterableToArrayLimitLoose": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/iterableToArrayLimitLoose.js",
  "@babel/runtime/helpers/esm/iterableToArrayLimitLoose": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/iterableToArrayLimitLoose.js",
  "@babel/runtime/helpers/unsupportedIterableToArray": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/unsupportedIterableToArray.js",
  "@babel/runtime/helpers/esm/unsupportedIterableToArray": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/unsupportedIterableToArray.js",
  "@babel/runtime/helpers/arrayLikeToArray": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/arrayLikeToArray.js",
  "@babel/runtime/helpers/esm/arrayLikeToArray": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/arrayLikeToArray.js",
  "@babel/runtime/helpers/nonIterableSpread": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/nonIterableSpread.js",
  "@babel/runtime/helpers/esm/nonIterableSpread": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/nonIterableSpread.js",
  "@babel/runtime/helpers/nonIterableRest": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/nonIterableRest.js",
  "@babel/runtime/helpers/esm/nonIterableRest": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/nonIterableRest.js",
  "@babel/runtime/helpers/createForOfIteratorHelper": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/createForOfIteratorHelper.js",
  "@babel/runtime/helpers/esm/createForOfIteratorHelper": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/createForOfIteratorHelper.js",
  "@babel/runtime/helpers/createForOfIteratorHelperLoose": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/createForOfIteratorHelperLoose.js",
  "@babel/runtime/helpers/esm/createForOfIteratorHelperLoose": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/createForOfIteratorHelperLoose.js",
  "@babel/runtime/helpers/skipFirstGeneratorNext": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/skipFirstGeneratorNext.js",
  "@babel/runtime/helpers/esm/skipFirstGeneratorNext": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/skipFirstGeneratorNext.js",
  "@babel/runtime/helpers/toPrimitive": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/toPrimitive.js",
  "@babel/runtime/helpers/esm/toPrimitive": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/toPrimitive.js",
  "@babel/runtime/helpers/toPropertyKey": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/toPropertyKey.js",
  "@babel/runtime/helpers/esm/toPropertyKey": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/toPropertyKey.js",
  "@babel/runtime/helpers/initializerWarningHelper": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/initializerWarningHelper.js",
  "@babel/runtime/helpers/esm/initializerWarningHelper": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/initializerWarningHelper.js",
  "@babel/runtime/helpers/initializerDefineProperty": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/initializerDefineProperty.js",
  "@babel/runtime/helpers/esm/initializerDefineProperty": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/initializerDefineProperty.js",
  "@babel/runtime/helpers/applyDecoratedDescriptor": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/applyDecoratedDescriptor.js",
  "@babel/runtime/helpers/esm/applyDecoratedDescriptor": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/applyDecoratedDescriptor.js",
  "@babel/runtime/helpers/classPrivateFieldLooseKey": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateFieldLooseKey.js",
  "@babel/runtime/helpers/esm/classPrivateFieldLooseKey": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateFieldLooseKey.js",
  "@babel/runtime/helpers/classPrivateFieldLooseBase": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateFieldLooseBase.js",
  "@babel/runtime/helpers/esm/classPrivateFieldLooseBase": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateFieldLooseBase.js",
  "@babel/runtime/helpers/classPrivateFieldGet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateFieldGet.js",
  "@babel/runtime/helpers/esm/classPrivateFieldGet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateFieldGet.js",
  "@babel/runtime/helpers/classPrivateFieldSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateFieldSet.js",
  "@babel/runtime/helpers/esm/classPrivateFieldSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateFieldSet.js",
  "@babel/runtime/helpers/classPrivateFieldDestructureSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateFieldDestructureSet.js",
  "@babel/runtime/helpers/esm/classPrivateFieldDestructureSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateFieldDestructureSet.js",
  "@babel/runtime/helpers/classExtractFieldDescriptor": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classExtractFieldDescriptor.js",
  "@babel/runtime/helpers/esm/classExtractFieldDescriptor": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classExtractFieldDescriptor.js",
  "@babel/runtime/helpers/classStaticPrivateFieldSpecGet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classStaticPrivateFieldSpecGet.js",
  "@babel/runtime/helpers/esm/classStaticPrivateFieldSpecGet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classStaticPrivateFieldSpecGet.js",
  "@babel/runtime/helpers/classStaticPrivateFieldSpecSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classStaticPrivateFieldSpecSet.js",
  "@babel/runtime/helpers/esm/classStaticPrivateFieldSpecSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classStaticPrivateFieldSpecSet.js",
  "@babel/runtime/helpers/classStaticPrivateMethodGet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classStaticPrivateMethodGet.js",
  "@babel/runtime/helpers/esm/classStaticPrivateMethodGet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classStaticPrivateMethodGet.js",
  "@babel/runtime/helpers/classStaticPrivateMethodSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classStaticPrivateMethodSet.js",
  "@babel/runtime/helpers/esm/classStaticPrivateMethodSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classStaticPrivateMethodSet.js",
  "@babel/runtime/helpers/classApplyDescriptorGet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classApplyDescriptorGet.js",
  "@babel/runtime/helpers/esm/classApplyDescriptorGet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classApplyDescriptorGet.js",
  "@babel/runtime/helpers/classApplyDescriptorSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classApplyDescriptorSet.js",
  "@babel/runtime/helpers/esm/classApplyDescriptorSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classApplyDescriptorSet.js",
  "@babel/runtime/helpers/classApplyDescriptorDestructureSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classApplyDescriptorDestructureSet.js",
  "@babel/runtime/helpers/esm/classApplyDescriptorDestructureSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classApplyDescriptorDestructureSet.js",
  "@babel/runtime/helpers/classStaticPrivateFieldDestructureSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classStaticPrivateFieldDestructureSet.js",
  "@babel/runtime/helpers/esm/classStaticPrivateFieldDestructureSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classStaticPrivateFieldDestructureSet.js",
  "@babel/runtime/helpers/classCheckPrivateStaticAccess": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classCheckPrivateStaticAccess.js",
  "@babel/runtime/helpers/esm/classCheckPrivateStaticAccess": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classCheckPrivateStaticAccess.js",
  "@babel/runtime/helpers/classCheckPrivateStaticFieldDescriptor": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classCheckPrivateStaticFieldDescriptor.js",
  "@babel/runtime/helpers/esm/classCheckPrivateStaticFieldDescriptor": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classCheckPrivateStaticFieldDescriptor.js",
  "@babel/runtime/helpers/decorate": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/decorate.js",
  "@babel/runtime/helpers/esm/decorate": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/decorate.js",
  "@babel/runtime/helpers/classPrivateMethodGet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateMethodGet.js",
  "@babel/runtime/helpers/esm/classPrivateMethodGet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateMethodGet.js",
  "@babel/runtime/helpers/checkPrivateRedeclaration": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/checkPrivateRedeclaration.js",
  "@babel/runtime/helpers/esm/checkPrivateRedeclaration": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/checkPrivateRedeclaration.js",
  "@babel/runtime/helpers/classPrivateFieldInitSpec": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateFieldInitSpec.js",
  "@babel/runtime/helpers/esm/classPrivateFieldInitSpec": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateFieldInitSpec.js",
  "@babel/runtime/helpers/classPrivateMethodInitSpec": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateMethodInitSpec.js",
  "@babel/runtime/helpers/esm/classPrivateMethodInitSpec": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateMethodInitSpec.js",
  "@babel/runtime/helpers/classPrivateMethodSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateMethodSet.js",
  "@babel/runtime/helpers/esm/classPrivateMethodSet": "https://unpkg.com/@babel/runtime@7.16.3/helpers/esm/classPrivateMethodSet.js",
  "@emotion/cache": "https://unpkg.com/@emotion/cache@11.6.0/dist/emotion-cache.browser.esm.js",
  "@emotion/hash": "https://unpkg.com/@emotion/hash@0.8.0/dist/hash.browser.esm.js",
  "@emotion/is-prop-valid": "https://unpkg.com/@emotion/is-prop-valid@1.1.1/dist/emotion-is-prop-valid.browser.esm.js",
  "@emotion/memoize": "https://unpkg.com/@emotion/memoize@0.7.5/dist/emotion-memoize.browser.esm.js",
  "@emotion/react": "https://unpkg.com/@emotion/react@11.6.0/dist/emotion-react.browser.esm.js",
  "@emotion/serialize": "https://unpkg.com/@emotion/serialize@1.0.2/dist/emotion-serialize.browser.esm.js",
  "@emotion/sheet": "https://unpkg.com/@emotion/sheet@1.1.0/dist/emotion-sheet.browser.esm.js",
  "@emotion/styled": "https://unpkg.com/@emotion/styled@11.6.0/dist/emotion-styled.browser.esm.js",
  "@emotion/utils": "https://unpkg.com/@emotion/utils@1.0.0/dist/emotion-utils.browser.esm.js",
  "@emotion/unitless": "https://unpkg.com/@emotion/unitless@0.7.5/dist/unitless.browser.esm.js",
  "@emotion/weak-memoize": "https://unpkg.com/@emotion/weak-memoize@0.2.5/dist/weak-memoize.browser.esm.js",
  "prop-types": "https://esm.sh/prop-types",
  "framer-motion": "https://unpkg.com/@spike.land/esm@0.0.94/dist/framer-motion.mjs",
  framesync: "https://unpkg.com/framesync@6.0.1/dist/es/index.mjs",
  "hey-listen": "https://unpkg.com/hey-listen@1.0.8/dist/hey-listen.es.js",
  "hoist-non-react-statics": "https://esm.sh/hoist-non-react-statics",
  popmotion: "https://unpkg.com/popmotion@11.0.0/dist/es/index.mjs",
  react: "https://unpkg.com/@spike.land/esm@0.0.94/dist/react.mjs",
  "react-dom": "https://unpkg.com/@spike.land/esm@0.0.94/dist/react-dom.mjs",
  "react-is": "https://unpkg.com/@spike.land/esm@0.0.94/dist/react-is.mjs",
  "react-transition-group": "https://esm.sh/react-transition-group",
  "react/jsx-runtime": "https://esm.sh/react/jsx-runtime",
  "@spike.land/renderer": "https://unpkg.com/@spike.land/renderer@0.0.94/dist/renderer.js",
  "style-value-types": "https://unpkg.com/style-value-types@5.0.0/dist/es/index.mjs",
  stylis: "https://unpkg.com/stylis@4.0.10/dist/stylis.mjs",
  "@spike.land/qrious": "https://unpkg.com/@spike.land/qrious@0.0.94/dist/QRious.mjs",
  tslib: "https://unpkg.com/tslib@2.3.1/tslib.es6.js",
  "ipfs-only-hash": "https://unpkg.com/@spike.land/esm@0.0.94/dist/ipfs-only-hash.mjs",
  "@zedvision/swm": "https://unpkg.com/@zedvision/swm@4.0.0/public/swm-esm.js",
  "uuid/": "https://unpkg.com/uuid@8.3.2/dist/esm-browser/",
  "@spike.land/code": "https://unpkg.com/@spike.land/code@0.0.94/js/reactLoader.mjs",
  comlink: "https://unpkg.com/comlink@4.3.1/dist/esm/comlink.mjs",
  "@spike.land/ipfs": "https://unpkg.com/@spike.land/ipfs@0.0.94/dist/ipfs.client.mjs",
  "workbox-window": "https://unpkg.com/workbox-window@6.4.1/build/workbox-window.prod.es5.mjs"
};
var importmap_default = {
  imports
};

// src/index.html
var src_default = `<!DOCTYPE html>
<html lang="en">
<head profile="http://www.w3.org/2005/10/profile">
  <meta http-equiv="Content-Type" content="text/html,charset=utf-8" />
  <meta name="viewport" content="width=device-width">
  <link rel="preload" href="https://unpkg.com/monaco-editor@0.30.1/min/vs/editor/editor.main.js" as="script" />
  <link rel="icon" type="image/png" href="@VERSION/assets/zed-icon-big.png" />
  <link rel="stylesheet" href="@VERSION/assets/app.css" />
  <title>Instant React Editor</title>
  <style>
    body{
      background-image: url(./assets/synthwave.webp);
    }
    
     @font-face {
      font-family: 'codicon';
      src: url('https://unpkg.com/monaco-editor@0.30.1/min/vs/base/browser/ui/codicons/codicon/codicon.ttf')
        format('truetype');
    }
		
  </style>
  	<style>body{padding:54px 0 40px 0;overflow-y:scroll}body.home{padding-top:0}.navbar-search .search-query,body,button,input,select,textarea{font:400 14px/1.4em 'Segoe UI','Open Sans',Calibri,Candara,Arial,sans-serif}.navbar .nav{float:left;margin-right:0}a{color:#06c;cursor:pointer}h1,h2,h3,h4,h5,h6{letter-spacing:-.01em;margin:0;line-height:normal}h1,h2{font-family:'Segoe UI Light','Segoe UI','Open Sans',Calibri,Candara,Arial,sans-serif;font-weight:300}h1{font-size:72px;letter-spacing:-.02em}.hero-unit h1{font-size:48px}h2{font-size:26px}h3{font-size:26px}h4{font-size:16px}h1 small,h2 small,h3 small,h4 small,h5 small,h6 small{color:#999}.alert h1,.alert h2,.alert h3,.alert h4,.alert h5,.alert h6,.alert-heading{color:inherit}.alert-info{color:#3a87ad;background-color:#d9edf7}.navbar-inverse .navbar-inner{background-color:#68217a;-webkit-filter:none;filter:none}.navbar-inverse.home .navbar-inner{background-color:transparent}.navbar-inverse .btn-navbar{background:0 0;margin-top:14px}.navbar-inverse .btn-navbar.active,.navbar-inverse .btn-navbar.disabled,.navbar-inverse .btn-navbar:active,.navbar-inverse .btn-navbar:focus,.navbar-inverse .btn-navbar:hover,.navbar-inverse .btn-navbar[disabled]{background:#442359}.btn-primary{background-color:#0072c6}.home .hero-unit{margin-top:-54px;position:relative;z-index:100}.hero-unit{font-weight:400}.hero-unit h1{margin:0 0 6px}.nav-tabs>li>a{color:#999}.nav-tabs>li>a:hover{color:#555}.nav-tabs>.active>a,.nav-tabs>.active>a:focus,.nav-tabs>.active>a:hover{color:#0072c6}body>section>.container{padding-top:12px}.masthead{background-color:#0072c6;color:#fff}.masthead .hero-unit{padding:30px 0 0;background:0 0}.navbar.home{position:relative;z-index:500}.navbar .nav>li>a{text-shadow:none;padding-top:18px;font-size:14px;text-transform:uppercase}.navbar-inverse .nav-collapse .nav>li>a{color:#fff;padding-left:0}.navbar-inverse .nav>li>a.nav-item:focus,.navbar-inverse .nav>li>a.nav-item:hover{background-color:rgba(0,0,0,.12)}.navbar-inverse .nav .active>a.nav-item,.navbar-inverse .nav .active>a.nav-item:focus,.navbar-inverse .nav .active>a.nav-item:hover{color:#fff;background-color:rgba(0,0,0,.24);-webkit-box-shadow:none;box-shadow:none}.navbar .logo{padding:16px 12px 0 0;height:35px;display:block;float:left}.navbar .logo a{color:#fff;font-size:24px;letter-spacing:-1px}.navbar-fixed-top{z-index:500}.flgroup:after{content:'';display:block;visibility:hidden;height:0;clear:both}@media (min-width:1200px){h1,h2{letter-spacing:-.04em}.hero-unit h1{font-size:72px}h2{font-size:36px}}#gh-link{display:none;position:fixed;top:0;right:0;border:0;margin:0;z-index:1000}@media (min-width:980px){#gh-link{display:block}}@media (min-width:980px){.navbar .nav{float:right}.navbar-inverse .nav-collapse .nav>li>a{padding-left:15px}}@media (min-width:768px) and (max-width:979px){h1{letter-spacing:-.02em}}@media (max-width:979px){body{padding:inherit}.navbar-fixed-bottom,.navbar-fixed-top,.navbar-static-top{margin-right:inherit;margin-left:inherit;margin-bottom:0}.navbar-fixed-top .navbar-inner{padding:0 20px}.navbar .container{width:724px}}@media (max-width:767px){.navbar .container{width:100%}}@media (max-width:480px){.navbar .logo a{display:none}}</style>
		<style>.try .drops{margin:0;list-style:none;float:right}.try .drops li{float:left;width:auto;height:auto;text-indent:0;font-size:26px;line-height:normal;margin:0 12px;cursor:pointer}.try .drops li a:focus,.try .drops li a:hover{text-decoration:none}.try .drops li h4{color:#999}.try .drops li.active h4,.try .drops li.active:hover h4{color:#0072c6}.try .drops li:hover h4{color:rgba(0,114,198,.5)}.try .editor.row{padding:18px 0}.try .row h4{padding-bottom:6px}.try .tile{position:relative;height:72px;border:1px solid #ddd;text-align:right;overflow:hidden;cursor:pointer;-webkit-box-shadow:0 1px 3px rgba(0,0,0,.055);-moz-box-shadow:0 1px 3px rgba(0,0,0,.055);box-shadow:0 1px 3px rgba(0,0,0,.055);-webkit-box-sizing:border-box;-o-box-sizing:border-box;-moz-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box}.try .tile:hover{-webkit-box-shadow:0 1px 5px rgba(0,0,0,.25);-moz-box-shadow:0 1px 5px rgba(0,0,0,.25);box-shadow:0 1px 5px rgba(0,0,0,.25)}.try .tile h4{margin:0;position:absolute;right:12px;bottom:12px;z-index:1}.try .tile .glyph{position:absolute;left:12px;bottom:-6px;background:url('../img/cloud.png') no-repeat;background-size:80px 43px;height:43px;width:80px;opacity:.5;transition:opacity .5s ease,bottom .5s ease;-webkit-transition:opacity .5s ease,bottom .5s ease}.try .tile:hover .glyph{opacity:1;bottom:-2px}.try .editor.row h4 small{color:#555}.try .editor.row .control-label{display:inline-block;position:relative;top:-4px;margin-right:4px}.try .editor.row .monaco-editor .find-widget input[type=text]{margin-bottom:0;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;-webkit-transition:none;-moz-transition:none;-o-transition:none;transition:none}.try .editor.row .monaco-editor .find-widget .monaco-checkbox .label{min-height:20px;min-width:20px}.try .editor.row .monaco-editor .find-widget .close{float:none;opacity:1}.try .editor .editor-frame{position:relative}.try .editor .editor-frame #diff-editor,.try .editor .editor-frame #editor{height:400px;margin-bottom:10px;border:1px solid #eee}.try .editor .editor-frame .loading{position:absolute;height:100%;width:100%;background-color:rgba(255,255,255,.5);margin:0 auto;display:none;z-index:100}.try .editor .editor-frame .progress{width:50%;margin:15% auto 0}.try .editor .editor-frame .progress .bar{width:100%;background-color:#4bb1cf}.try .editor .editor-frame #diff-editor .alert,.try .editor .editor-frame #editor .alert{margin:18% auto 0;width:30%;text-align:center;color:#b94a48;background-color:#f2dede;border-color:#eed3d7}.try .editor #diff-editor .monaco-editor .row,.try .editor #editor .monaco-editor .row{margin-left:0}.try .editor .vs.monaco-editor .context-view.monaco-menu-container a{color:#646465}.try .editor .vs-dark.monaco-editor .context-view.monaco-menu-container a{color:#bbb}@media (min-width:1200px){.try .editor .row{margin-left:0}}@media (max-width:767px){.try .container{margin:0 24px}.try .tile h4{right:6px}.try .editor>.span9 .row .span4{float:left;width:50%}.try .editor h4{margin-top:0}}@media (max-width:520px){.try .editor>.span3 h4,.try .editor>.span3 p{display:none}}@media (max-width:320px){.try .editor>.span9{display:none}}.monaco-editor .container:before,.monaco-editor .row:before{content:'';display:inherit}.monaco-editor .container:after,.monaco-editor .row:after{clear:inherit}.monaco-editor .container{width:auto;margin:inherit;padding:inherit}.monaco-editor .close{float:none;font-size:inherit;font-weight:inherit;line-height:inherit;color:inherit;text-shadow:inherit;opacity:inherit;filter:inherit}.monaco-editor .row{margin:inherit}.monaco-editor .invisible{visibility:visible}</style>

		<link
			data-name="vs/editor/editor.main"
			rel="stylesheet"
			href="https://unpkg.com/monaco-editor@0.30.1/min/vs/editor/editor.main.css"
		/>
</head>
<body>
  <div id="editor"></div>
  <script async src="https://unpkg.com/es-module-shims@1.3.2/dist/es-module-shims.js"><\/script>
  <script type="importmap">
    $$IMPORTMAP
  <\/script>
  <script type="module">
    import app from "app";
    app()
  <\/script>
  <script type="text/javascript">
    (async()=>{
    let currentWebSocket = null;

    const chCode = (code) => {
        const { monaco } = window;
        if (!monaco || !monaco.Uri) return;
        const modelUri = monaco.Uri.parse(\`file:///main.tsx\`);
        const model = monaco.editor.getModel(modelUri);
        const oldCode = model.getValue();

        if (oldCode !==code ){
          console.log({oldCode});

          model.setValue(code);
        }
          
      }


    let hostname = window.location.host;
if (hostname == "") {
  // Probably testing the HTML locally.
  hostname = "code.spike.land";
}


let roomName = "ROOMNAMEagain";
let username = 'Pisti'+Math.random();
let lastSeenTimestamp = Date.now();
let lastSeenCode = "";

    function join() {
  let ws = new WebSocket("wss://" + hostname + "/api/room/" + roomName + "/websocket");
  let rejoined = false;
  let startTime = Date.now();

  let rejoin = async () => {
    if (!rejoined) {
      rejoined = true;
      currentWebSocket = null;

      // Clear the roster.
    //  while (roster.firstChild) {
     //   roster.removeChild(roster.firstChild);
  //    }

      // Don't try to reconnect too rapidly.
      let timeSinceLastJoin = Date.now() - startTime;
      if (timeSinceLastJoin < 10000) {
        // Less than 10 seconds elapsed since last join. Pause a bit.
        await new Promise(resolve => setTimeout(resolve, 10000 - timeSinceLastJoin));
      }

      // OK, reconnect now!
      join();
    }
  }

  ws.addEventListener("open", event => {
    currentWebSocket = ws;
    window.chCode = chCode;
    window.broad = (code)=>{
      chCode(code);
      if (code !== lastSeenCode) currentWebSocket.send(JSON.stringify({message:  code}));
  }

    // Send user info message.
    ws.send(JSON.stringify({name: username}));
  });

 

  ws.addEventListener("message", event => {
    let data = JSON.parse(event.data);

    if (data.code) {

     chCode(data.code)
    
    } else {
     

      // A regular chat message.
      if (data.timestamp > lastSeenTimestamp) {
        if (data.message && data.message!==lastSeenCode && data.name !== username){

          lastSeenCode = data.message;
          chCode(data.message)
        }
      // addChatMessage(data.name, data.message);
        lastSeenTimestamp = data.timestamp;
      }
    }
  });

  ws.addEventListener("close", event => {
    console.log("WebSocket closed, reconnecting:", event.code, event.reason);
    rejoin();
  });
  ws.addEventListener("error", event => {
    console.log("WebSocket error, reconnecting:", event);
    rejoin();
  });
}



    console.log("hello hello2");
    join();
})()
    /**************/
  <\/script>
</body>
</html>
`;

// ../../packages/cf-npm-site/dist/index.mjs
function src_default2(packageName, version2, serveDir = "") {
  return async function(request, env) {
    try {
      const url = new URL(request.url);
      const { pathname } = url;
      const uri = pathname.startsWith("/@") ? pathname.substring(1) : `@${version2}${serveDir ? `/${serveDir}` : ``}${pathname}`;
      let myCache = await caches.open(`blog-npm:${version2}-${serveDir}`);
      const cachedResp = await myCache.match(request, {});
      if (cachedResp) {
        return cachedResp;
      }
      let targetPath = uri;
      if (uri.endsWith("/")) {
        targetPath = `${uri}index.html`;
      } else if (pathname.indexOf(".") === -1) {
        targetPath = `${uri}/index.html`;
      }
      const resp = fetch(`https://unpkg.com/${packageName}${targetPath}`);
      myCache.put(request, (await resp).clone());
      return resp;
    } catch (Error) {
      return new Response(`Yayy... ${Object.prototype.toString.call(Error)}`);
    }
  };
}

// src/handleErrors.mjs
async function handleErrors(request, func) {
  try {
    return await func();
  } catch (err) {
    if (request.headers.get("Upgrade") == "websocket") {
      let pair = new WebSocketPair();
      pair[1].accept();
      pair[1].send(JSON.stringify({ error: err.stack }));
      pair[1].close(1011, "Uncaught exception during session setup");
      return new Response(null, { status: 101, webSocket: pair[0] });
    } else {
      return new Response(err.stack, { status: 500 });
    }
  }
}

// src/chat.mjs
var chat_default = {
  async fetch(request, env) {
    return await handleErrors(request, async () => {
      let url = new URL(request.url);
      let path = url.pathname.slice(1).split("/");
      if (!path[0]) {
        const html1 = src_default.slice(0, src_default.length - 40) + "*/";
        const html2 = "/*" + src_default.slice(src_default.length - 40);
        const rand = Math.random();
        const injection = `
              console.log(${rand});
          `;
        const regex = /VERSION/ig;
        importmap_default.imports.app = `./@${version}/js/starter.mjs`;
        return new Response(html1.replace("$$IMPORTMAP", JSON.stringify(importmap_default)).replaceAll(regex, version) + injection + html2, {
          headers: {
            "Content-Type": "text/html;charset=UTF-8",
            "Cache-Control": "no-cache"
          }
        });
      }
      switch (path[0]) {
        case "api":
          return handleApiRequest(path.slice(1), request, env);
        default:
          return src_default2("@spike.land/code", version)(request, env);
      }
    });
  }
};
async function handleApiRequest(path, request, env) {
  switch (path[0]) {
    case "room": {
      if (!path[1]) {
        if (request.method == "POST") {
          let id2 = env.CODE.newUniqueId();
          return new Response(id2.toString(), {
            headers: { "Access-Control-Allow-Origin": "*" }
          });
        } else {
          return new Response("Method not allowed", { status: 405 });
        }
      }
      let name = path[1];
      let id;
      if (name.match(/^[0-9a-f]{64}$/)) {
        id = env.CODE.idFromString(name);
      } else if (name.length <= 32) {
        id = env.CODE.idFromName(name);
      } else {
        return new Response("Name too long", { status: 404 });
      }
      let roomObject = env.CODE.get(id);
      let newUrl = new URL(request.url);
      newUrl.pathname = "/" + path.slice(2).join("/");
      return roomObject.fetch(newUrl, request);
    }
    default:
      return new Response("Not found", { status: 404 });
  }
}

// src/rateLimiterClient.mjs
var RateLimiterClient = class {
  constructor(getLimiterStub, reportError) {
    this.getLimiterStub = getLimiterStub;
    this.reportError = reportError;
    this.limiter = getLimiterStub();
    this.inCooldown = false;
  }
  checkLimit() {
    if (this.inCooldown) {
      return false;
    }
    this.inCooldown = true;
    this.callLimiter();
    return true;
  }
  async callLimiter() {
    try {
      let response;
      try {
        response = await this.limiter.fetch("https://dummy-url", {
          method: "POST"
        });
      } catch (err) {
        this.limiter = this.getLimiterStub();
        response = await this.limiter.fetch("https://dummy-url", {
          method: "POST"
        });
      }
      let cooldown = +await response.text();
      await new Promise((resolve) => setTimeout(resolve, cooldown * 1e3));
      this.inCooldown = false;
    } catch (err) {
      this.reportError(err);
    }
  }
};

// src/chatRoom.mjs
var Code = class {
  constructor(controller, env) {
    this.storage = controller.storage;
    this.env = env;
    this.sessions = [];
    this.lastTimestamp = 0;
  }
  async fetch(request) {
    return await handleErrors(request, async () => {
      let url = new URL(request.url);
      switch (url.pathname) {
        case "/websocket": {
          if (request.headers.get("Upgrade") != "websocket") {
            return new Response("expected websocket", { status: 400 });
          }
          let ip = request.headers.get("CF-Connecting-IP");
          let pair = new WebSocketPair();
          await this.handleSession(pair[1], ip);
          return new Response(null, { status: 101, webSocket: pair[0] });
        }
        default:
          return new Response("Not found", { status: 404 });
      }
    });
  }
  async handleSession(webSocket, ip) {
    webSocket.accept();
    let limiterId = this.env.LIMITERS.idFromName(ip);
    let limiter = new RateLimiterClient(() => this.env.LIMITERS.get(limiterId), (err) => webSocket.close(1011, err.stack));
    let session = { webSocket, blockedMessages: [] };
    this.sessions.push(session);
    this.sessions.forEach((otherSession) => {
      if (otherSession.name) {
        session.blockedMessages.push(JSON.stringify({ joined: otherSession.name }));
      }
    });
    let storage = await this.storage.list({ reverse: true, limit: 100 });
    let backlog = [...storage.values()];
    backlog.reverse();
    backlog.forEach((value) => {
      session.blockedMessages.push(value);
    });
    let receivedUserInfo = false;
    webSocket.addEventListener("message", async (msg) => {
      try {
        if (session.quit) {
          webSocket.close(1011, "WebSocket broken.");
          return;
        }
        if (!limiter.checkLimit()) {
          webSocket.send(JSON.stringify({
            error: "Your IP is being rate-limited, please try again later."
          }));
          return;
        }
        let data = JSON.parse(msg.data);
        if (!receivedUserInfo) {
          session.name = "" + (data.name || "anonymous");
          if (session.name.length > 32) {
            webSocket.send(JSON.stringify({ error: "Name too long." }));
            webSocket.close(1009, "Name too long.");
            return;
          }
          session.blockedMessages.forEach((queued) => {
            webSocket.send(queued);
          });
          delete session.blockedMessages;
          this.broadcast({ joined: session.name });
          webSocket.send(JSON.stringify({ ready: true }));
          receivedUserInfo = true;
          return;
        }
        data = { name: session.name, message: "" + data.message };
        if (data.message.length > 4096) {
          webSocket.send(JSON.stringify({ error: "Message too long." }));
          return;
        }
        data.timestamp = Math.max(Date.now(), this.lastTimestamp + 1);
        this.lastTimestamp = data.timestamp;
        let dataStr = JSON.stringify(data);
        this.broadcast(dataStr);
        let key = new Date(data.timestamp).toISOString();
        await this.storage.put(key, dataStr);
      } catch (err) {
        webSocket.send(JSON.stringify({ error: err.stack }));
      }
    });
    let closeOrErrorHandler = (evt) => {
      session.quit = true;
      this.sessions = this.sessions.filter((member) => member !== session);
      if (session.name) {
        this.broadcast({ quit: session.name });
      }
    };
    webSocket.addEventListener("close", closeOrErrorHandler);
    webSocket.addEventListener("error", closeOrErrorHandler);
  }
  broadcast(message) {
    if (typeof message !== "string") {
      message = JSON.stringify(message);
    }
    let quitters = [];
    this.sessions = this.sessions.filter((session) => {
      if (session.name) {
        try {
          session.webSocket.send(message);
          return true;
        } catch (err) {
          session.quit = true;
          quitters.push(session);
          return false;
        }
      } else {
        session.blockedMessages.push(message);
        return true;
      }
    });
    quitters.forEach((quitter) => {
      if (quitter.name) {
        this.broadcast({ quit: quitter.name });
      }
    });
  }
};

// src/rateLimiter.mjs
var CodeRateLimiter = class {
  constructor(controller, env) {
    this.nextAllowedTime = 0;
  }
  async fetch(request) {
    return await handleErrors(request, async () => {
      let now = Date.now() / 1e3;
      this.nextAllowedTime = Math.max(now, this.nextAllowedTime);
      if (request.method == "POST") {
        this.nextAllowedTime += 1;
      }
      let cooldown = Math.max(0, this.nextAllowedTime - now - 20);
      return new Response(cooldown);
    });
  }
};

// src/index.ts
var src_default3 = chat_default;
export {
  Code,
  CodeRateLimiter,
  src_default3 as default
};
