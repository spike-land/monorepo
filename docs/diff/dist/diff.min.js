Object.defineProperty(exports,"__esModule",{value:!0});function E(){}function k(s,e,t,n,u){for(var o=0,l=e.length,i=0,c=0;o<l;o++){var r=e[o];if(r.removed){if(r.value=s.join(n.slice(c,c+r.count)),c+=r.count,o&&e[o-1].added){var v=e[o-1];e[o-1]=e[o],e[o]=v}}else{if(!r.added&&u){var d=t.slice(i,i+r.count);d=d.map(function(h,w){var f=n[c+w];return f.length>h.length?f:h}),r.value=s.join(d)}else r.value=s.join(t.slice(i,i+r.count));i+=r.count,r.added||(c+=r.count)}}var p=e[l-1];return l>1&&typeof p.value=="string"&&(p.added||p.removed)&&s.equals("",p.value)&&(e[l-2].value+=p.value,e.pop()),e}function x(s){return{newPos:s.newPos,components:s.components.slice(0)}}const I=async s=>Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",typeof s=="string"?new TextEncoder().encode(s):s)).slice(0,4)).map(e=>("00"+e.toString(16)).slice(-2)).join(""),q=async(s,e)=>{const t=I(s),n=diff(s,e);return{b:await t,c:n.map(u=>u.added?u.value:u.removed?-u.count:u.count)}};export{q as diff};export const isDiff=s=>{if(s.length<10)return!1;const e=[...s.slice(0,8)].filter(n=>n<"0"||n>"f").length===0,t=s.slice(8);if(e&&t[0]==="["&&t[t.length-1]==="]")try{return JSON.parse(t).length>1}catch{return!1}return!1},assemble=(s,e)=>{const t=JSON.parse(e);let n=s.slice(),u="";return t.forEach(o=>{if(Number(o)===o){const l=Math.abs(o),i=n.slice(0,l);n=n.slice(l),o>0&&(u+=String(i))}else u+=String(o)}),u};exports.default=E,E.prototype={diff:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=n.callback;typeof n=="function"&&(u=n,n={}),this.options=n;var o=this;function l(f){return u?(setTimeout(function(){u(void 0,f)},0),!0):f}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var i=t.length,c=e.length,r=1,d=i+c,v=[{newPos:-1,components:[]}],p=this.extractCommon(v[0],t,e,0);if(v[0].newPos+1>=i&&p+1>=c)return l([{value:this.join(t),count:t.length}]);function h(){for(var f=-1*r;f<=r;f+=2){var a=void 0,m=v[f-1],y=v[f+1],C=(y?y.newPos:0)-f;m&&(v[f-1]=void 0);var L=m&&m.newPos+1<i,j=y&&0<=C&&C<c;if(!L&&!j){v[f]=void 0;continue}if(!L||j&&m.newPos<y.newPos?(a=x(y),o.pushComponent(a.components,void 0,!0)):(a=m,a.newPos++,o.pushComponent(a.components,!0,void 0)),C=o.extractCommon(a,t,e,f),a.newPos+1>=i&&C+1>=c)return l(k(o,a.components,t,e,o.useLongestToken));v[f]=a}r++}if(u)(function f(){setTimeout(function(){if(r>d)return u();h()||f()},0)})();else for(;r<=d;){var w=h();if(w)return w}},pushComponent:function(e,t,n){var u=e[e.length-1];u&&u.added===t&&u.removed===n?e[e.length-1]={count:u.count+1,added:t,removed:n}:e.push({count:1,added:t,removed:n})},extractCommon:function(e,t,n,u){for(var o=t.length,l=n.length,i=e.newPos,c=i-u,r=0;i+1<o&&c+1<l&&this.equals(t[i+1],n[c+1]);)i++,c++,r++;return r&&e.components.push({count:r}),e.newPos=i,c},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};
