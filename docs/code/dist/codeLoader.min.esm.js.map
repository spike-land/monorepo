{"version":3,"file":"codeLoader.min.esm.js","sources":["../../smart-monaco-editor/dist/smart-monaco-editor.modern.js","../src/db.js","../src/transpile.js","../src/ipfsKV.js","../src/DraggableWindow.js","../src/sha256.js","../src/data.js","../src/share.js","../src/codeLoader.js"],"sourcesContent":["function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}const t=(e,t=[])=>{if(\"https://\"===e.slice(0,8))return window.document.head.querySelector(`script[src=\"${e}\"]`)||new Promise(function(o,n){const s=window.document.createElement(\"script\");s.src=e,s.type=\"application/javascript\",s.onload=()=>{0===t.length&&o(window);const e={};t.forEach(t=>Object.assign(e,window[t])),o(e)},s.onerror=n,window.document.head.appendChild(s)})};export default async({onChange:o,code:n,language:s,options:i})=>{const{document:a}=window;let d=a.getElementById(\"container\");d||(d=a.createElement(\"container\"),d.id=\"container\",a.body.appendChild(d));const c=\"typescript\"===s?\"file:///main.tsx\":\"file:///main.html\";if(\"undefined\"!=typeof window&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)){const e=window.document.createElement(\"div\");e.id=\"ace\",window.document.body.appendChild(e),await t(\"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js\"),\"typescript\"===s?await t(\"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js\"):await t(\"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.min.js\"),await t(\"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js\"),window.document.getElementById(\"ace\").style.setProperty(\"display\",\"block\"),d.style.setProperty(\"display\",\"none\");const o=window.ace.edit(\"ace\");o.getSession().setMode(\"ace/mode/typescript\");const i=e=>setTimeout(()=>{const t=ace.edit(\"ace\");\"ace/theme/monokai \"!==t.getTheme()&&(t.setOptions({fontSize:\"14pt\"}),t.setTheme(\"ace/theme/monokai\"),i(2*e))},e);i(100),o.setValue(n),o.blur()}const r=await(async()=>{const{require:e}=await t(\"https://unpkg.com/monaco-editor@0.21.2/min/vs/loader.js\");return e.config({paths:{vs:\"https://unpkg.com/monaco-editor@0.21.2/min/vs\"}}),await new Promise(t=>e([\"vs/editor/editor.main\"],e=>t(e)))})();let p;try{p=r.editor.getModel(c),p.getValue()!==n&&p.setValue(n)}catch(e){p=await r.editor.createModel(n,s,r.Uri.parse(c))}const l={monaco:r,editor:r.editor.create(window.document.getElementById(\"container\"),e({formatOnType:!1,scrollbar:{horizontal:\"hidden\",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,glyphMargin:!1,wordWrap:\"off\",mouseWheelZoom:!1,wordWrapColumn:80,useTabStops:!1,dragAndDrop:!1,disableLayerHinting:!0,formatOnPaste:!1,disableMonospaceOptimizations:!0,showUnused:!0,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:\"full\",accessibilitySupport:\"off\",autoClosingQuotes:\"beforeWhitespace\",padding:{bottom:300},lineNumbers:\"on\",autoClosingBrackets:\"beforeWhitespace\",autoClosingOvertype:\"auto\",suggest:{},codeLens:!0,autoSurround:\"languageDefined\",trimAutoWhitespace:!1,codeActionsOnSaveTimeout:100,model:p,value:n,language:s,theme:\"vs-dark\"},i))};if(l.editor.onDidChangeModelContent(()=>o(l.editor.getValue())),aceEditor&&aceEditor.session.on(\"change\",function(){const e=aceEditor.getValue();l.editor.setValue(e),o(e)}),aceEditor&&a.getElementById(\"container\").replaceWith(a.getElementById(\"ace\")),l.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),\"typescript\"===s){const e=[{name:\"react\",url:\"https://unpkg.com/@types/react@17.0.0/index.d.ts\",depend:[\"global\",\"csstype\",\"react-dom\",\"prop-types\"]},{name:\"global\",url:\"https://unpkg.com/@types/react@17.0.0/global.d.ts\",depend:[]},{name:\"prop-types\",url:\"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts\",depend:[]},{name:\"react-dom\",url:\"https://unpkg.com/@types/react-dom@17.0.0/index.d.ts\",depend:[]},{name:\"csstype\",url:\"https://unpkg.com/csstype@3.0.5/index.d.ts\",depend:[]},{name:\"@emotion/styled/base.d.ts\",url:\"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts\",depend:[\"@emotion/react\",\"@emotion/serialize\",\"react\"]},{name:\"@emotion/styled/index.d.ts\",url:\"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts\",depend:[\"@emotion/react\",\"@emotion/serialize\",\"react\"]},{name:\"@emotion/cache/index.d.ts\",url:\"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts\",depend:[\"@emotion/utils\"]},{name:\"@emotion/react/index.d.ts\",url:\"https://unpkg.com/@emotion/react@11.1.3/types/index.d.ts\",depend:[\"@emotion/cache\"]},{name:\"@emotion/react/jsx-namespace.d.ts\",url:\"https://unpkg.com/@emotion/react@11.1.3/types/jsx-namespace.d.ts\",depend:[\"@emotion/utils\",\"csstype\"]},{name:\"@emotion/react/css-prop.d.ts\",url:\"https://unpkg.com/@emotion/react@11.1.3/types/css-prop.d.ts\",depend:[\"@emotion/utils\",\"csstype\"]},{name:\"@emotion/react/helper.d.ts\",url:\"https://unpkg.com/@emotion/react@11.1.3/types/helper.d.ts\",depend:[\"@emotion/utils\",\"csstype\"]},{name:\"@emotion/react/theming.d.ts\",url:\"https://unpkg.com/@emotion/react@11.1.3/types/theming.d.ts\",depend:[\"@emotion/utils\",\"csstype\"]},{name:\"@emotion/serialize/index.d.ts\",url:\"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts\",depend:[\"@emotion/utils\",\"csstype\"]},{name:\"@emotion/utils/index.d.ts\",url:\"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts\",depend:[]},{name:\"framer-motion\",url:\"https://unpkg.com/framer-motion@3.1.1/dist/framer-motion.d.ts\",depend:[]},{name:\"popmotion\",url:\"https://unpkg.com/popmotion@9.0.2/lib/index.d.ts\"},{name:\"@zedvision/qrious/index.d.ts\",url:\"https://unpkg.com/@zedvision/qrious@8.5.7/dist/qrious.d.ts\"}].map(({name:e,url:t})=>(async()=>l.monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(t)).text(),e.includes(\"@\")?`file:///node_modules/${e}`:`file:///node_modules/@types/${e}/index.d.ts`))());return l.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:l.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:l.monaco.languages.typescript.ModuleResolutionKind.Nodejs,module:l.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:[\"node_modules/@types\"],jsx:\"react-jsx\",esModuleInterop:!0}),await Promise.all(e),l.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),l}};\n//# sourceMappingURL=smart-monaco-editor.modern.js.map\n","import { getDB } from \"https://unpkg.com/@zedvision/shadb@8.7.2/dist/shaDB.js\";\n\nlet db;\n\nexport const shaDB = {\n  get: async (...args) => {\n    db = db || await getDB();\n    return db.get(...args);\n  },\n  put: async (...args) => {\n    db = db || await getDB();\n    return db.put(...args);\n  },\n};\n","import * as Comlink from \"https://unpkg.com/comlink/dist/esm/comlink.mjs\";\nimport { shaDB } from \"./db.js\";\n// import * as Comlink from \"../../../dist/esm/comlink.mjs\";\n\nlet transform;\nexport async function transpileCode(code, hasToReport) {\n  transform = transform || await init();\n\n  return await transform(code, hasToReport);\n}\n\nlet node = null;\n\nexport async function getIpfsiD() {\n  if (node) return node;\n\n  let ipfsId = await shaDB.get(\"ipfs\");\n  if (!ipfsId) {\n    ipfsId = v4();\n\n    await shaDB.put(\"ipfs\", ipfsId);\n  }\n\n  return ipfsId;\n}\n\nlet ipfsNode;\nexport async function ipfsAdd(code, hasToReport) {\n  ipfsNode = ipfsNode || await Ipfs.create({ repo: await getIpfsiD() });\n\n  return await transform(code, hasToReport);\n}\n\nfunction init() {\n  const worker = new Worker(\n    \"./src/transpile.worker.js\",\n  );\n  // WebWorkers use `postMessage` and therefore work with Comlink.\n  transform = Comlink.wrap(worker);\n  return transform;\n}\ninit();\n","import * as Comlink from \"https://unpkg.com/comlink/dist/esm/comlink.mjs\";\n// import * as Comlink from \"../../../dist/esm/comlink.mjs\";\n\nlet ipfsWorker;\n\nexport const ipfsKV = {\n  add: async (data) => (ipfsWorker || await initIpfsKV()).add(data),\n};\n\nfunction initIpfsKV() {\n  const worker = new Worker(\n    \"./src/ipfsKV.worker.js\",\n  );\n\n  ipfsWorker = Comlink.wrap(worker);\n  return ipfsWorker;\n}\ninitIpfsKV();\n","/** @jsx jsx */\n\nimport ReactDOM from \"https://unpkg.com/react-dom@17.0.1/index.js\";\n\nimport React from \"https://unpkg.com/react@17.0.1/cjs/react.production.min.js\";\nimport { css, jsx } from \"https://unpkg.com/@emotion/react\"\n;\nimport { motion } from \"https://unpkg.com/framer-motion\"\n\nexport { jsx };\n\nexport {ReactDOM}\n\nexport const DraggableWindow = ({ onShare }) => {\n  return jsx(\n    React.Fragment,\n    null,\n    jsx(\n      motion.div,\n      {\n        css: css`\n            background: red;\n            border: 4px solid red;\n            border-radius: 8px;\n          `,\n        animate: {\n          scale: 1,\n          top: 1,\n          left: 600,\n        },\n        dragElastic: 0.5,\n        dragMomentum: false,\n        initial: {\n          top: 1,\n          left: 0,\n          scale: 0.7,\n        },\n        transition: {\n          duration: 0.5,\n        },\n        drag: true,\n        dragConstraints: {\n          left: -window.innerWidth + 200,\n          right: 0,\n          bottom: window.innerHeight - 200,\n          top: 0,\n        },\n      },\n      jsx(\n        \"div\",\n        {\n          css: `\n      display: block;\n      with: 100%;\n      text-align: right;\n      background: linear-gradient(0deg, darkred, red);\n    `,\n        },\n        jsx(\"button\", {\n          css: `\n              background: darkred;\n              margin-top: -4px;\n              margin-right: -4px;\n              color: white;\n              cursor: pointer;\n              font-weight: bold;\n              font-family: Roboto;\n              padding: 8px 16px;\n              outline: none;\n              border: none;\n              border-radius: 0px 8px 0px 0px;\n            `,\n          onClick: () => onShare(),\n        }, \"🌎 SHARE\"),\n      ),\n      jsx(\"div\", {\n        css: `\n      min-width: 200px;\n      padding: 30px;\n      max-width: 600px;\n      background: white;\n      max-height: 800px;\n      border-radius: 0px 0px 8px 8px;\n      overflow-y: overlay;\n    `,\n        id: \"zbody\",\n      }),\n    ),\n  );\n};\n","export const sha256 = async (x) =>\n  Array.from(\n    new Uint8Array(\n      await crypto.subtle.digest(\n        \"SHA-256\",\n        typeof x === \"string\" ? new TextEncoder().encode(x) : x,\n      ),\n    ).slice(0, 4),\n  ).map((b) => (\"00\" + b.toString(16)).slice(-2)).join(\"\");\n","import { shaDB } from \"./db.js\";\nimport v4 from \"https://unpkg.com/uuid@8.3.2/dist/esm-browser/v4.js\";\nimport { sha256 } from \"./sha256.js\";\n\nexport async function getZkey(hash) {\n  const uuid = await getUserId();\n  const uKey = await sha256(uuid);\n  const gKey = await sha256(hash + uKey);\n  const vKey = await sha256(hash + uuid);\n  return `${hash}${uKey}${gKey}${vKey}`;\n}\n\nexport async function getUserId() {\n  const uuid = await shaDB.get(\"uuid\");\n  if (!uuid) {\n    const resp = await fetch(\"https://code.zed.vision/register\");\n    const data = await resp.json();\n    await shaDB.put(\"uuid\", data.uuid);\n    return data.uuid;\n  }\n  return uuid;\n}\n\nexport const getProjects = async () => {\n  const uuid = await getUserId();\n  const projects = await shaDB.get(uuid, \"json\");\n\n  if (typeof projects === \"string\" || projects === null || !projects.list) {\n    const projectId = v4();\n\n    await shaDB.put(\n      uuid,\n      JSON.stringify({\n        list: [projectId],\n        [projectId]: {\n          created: Date.now(),\n          lastOpen: Date.now(),\n        },\n      }),\n    );\n\n    return [projectId];\n  }\n\n  // const search = new URLSearchParams(window.location.search);\n\n  // const keyToLoad = search.get(\"h\") || await db.get(projectName);\n  // if(keyToLoad){\n  //   projects.map(p=>shaDB.get())\n  // }\n\n  return projects.list;\n};\n\nexport const saveCode = async (code) => {\n  const hash = await sha256(code);\n\n  const projects = await getProjects();\n  const projectName = projects[0];\n\n  try {\n    const prevHash = await shaDB.get(projectName);\n\n    if (prevHash !== hash) {\n      await shaDB.put(hash, code);\n      await shaDB.put(projectName, hash);\n      // setQueryStringParameter(\"h\", hash);\n      //const response = fetch(request);\n    }\n  } catch (e) {\n    console.error(e);\n  }\n\n  // lets not save now - we will save the diff only\n  // await response;\n};\n","import { importScript } from \"./importScript.js\";\nimport { sha256 } from \"./sha256.js\";\nimport { getZkey } from \"./data.js\";\nimport { ipfsKV } from \"./ipfsKV.js\";\n\nexport const shareItAsHtml = async ({ code, HTML, jsExport }) => {\n  const mod = createJsBlob(code);\n\n  const Element = (await import(mod)).default;\n\n  const css = Array.from(\n    window.document.querySelector(\"head > style[data-emotion=css]\").sheet\n      .cssRules,\n  ).map((x) => x.cssText).filter((cssRule) =>\n    HTML.includes(cssRule.substring(3, 8))\n  ).join(\"\\n  \");\n\n  const { getHtml, getCodeForImport } = await import(\"./templates.js\");\n\n  const linkToCode = await saveToIPFS(code, \"application/html\");\n\n  console.log({\n    HTML,\n    linkToCode,\n    css,\n    code,\n  });\n\n  const link = await saveHtml(\n    getHtml({ HTML, css, js: getCodeForImport(linkToCode) }),\n  );\n\n  return link;\n};\n\nfunction saveHtml(html) {\n  return saveToIPFS(html, \"text/html\");\n}\n\nfunction saveJs(js) {\n  return save(js, \"application/javascript\");\n}\nasync function saveToIPFS(content, type) {\n  const cid = await ipfsKV.add(\n    URL.createObjectURL(new Blob([content], { type })),\n  );\n  return `https://ipfs.io/ipfs/${cid}`;\n}\n\nasync function save(content, type) {\n  const hash = await sha256(content);\n  const request = new Request(\n    \"https://code.zed.vision\",\n    {\n      body: content,\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": type + \";charset=UTF-8\",\n        \"ZKEY\": await getZkey(hash),\n      },\n    },\n  );\n\n  await fetch(request);\n\n  return `https://code.zed.vision/${hash}`;\n}\n\nexport function createJsBlob(code) {\n  const blob = new Blob([code], { type: \"application/javascript\" });\n\n  return URL.createObjectURL(blob);\n}\n","import startMonaco from \"@zedvision/smart-monaco-editor\";\nimport { diff } from \"https://unpkg.com/@zedvision/diff@8.6.10/dist/diff.min.js\";\nimport prettier from \"https://unpkg.com/prettier@2.2.1/esm/standalone.mjs\";\nimport parserBabel from \"https://unpkg.com/prettier@2.2.1/esm/parser-babel.mjs\";\nimport parserHtml from \"https://unpkg.com/prettier@2.2.1/esm/parser-html.mjs\";\n\nimport { DraggableWindow, jsx, ReactDOM } from \"./DraggableWindow.js\";\n\nimport { getProjects, saveCode } from \"./data.js\";\nimport { shaDB } from \"./db.js\";\nimport { starter } from \"./starterNoFramerMotion.js\";\nimport { transpileCode } from \"./transpile.js\";\nimport { createJsBlob, shareItAsHtml } from \"./share.js\";\n\n\nconst session = {\n  hydrated: false,\n  preRendered: false,\n  lastErrors: 0,\n  HTML: \"\",\n  ipfs: 0,\n  transpiled: \"\",\n  code: \"\",\n};\n\nfunction formatter(code) {\n  try {\n    return prettier.format(code, {\n      \"arrowParens\": \"always\",\n      \"bracketSpacing\": true,\n      \"embeddedLanguageFormatting\": \"auto\",\n      \"htmlWhitespaceSensitivity\": \"css\",\n      \"insertPragma\": false,\n      \"jsxBracketSameLine\": true,\n      \"jsxSingleQuote\": false,\n      \"printWidth\": 80,\n      \"proseWrap\": \"preserve\",\n      \"quoteProps\": \"as-needed\",\n      \"requirePragma\": false,\n      \"semi\": true,\n      \"singleQuote\": true,\n      \"tabWidth\": 2,\n      \"trailingComma\": \"all\",\n      \"useTabs\": false,\n      parser: \"babel-ts\",\n      plugins: [parserBabel, parserHtml],\n    });\n  } catch {\n    return code;\n  }\n}\n\nexport async function run(mode = \"window\") {\n  session.code = formatter(await getCodeToLoad());\n  session.transpiled = await transpileCode(session.code);\n\n  if (mode === \"editor\") {\n    const { renderDraggableEditor } = await import(\"./DraggableEditor.js\");\n\n    await renderDraggableEditor();\n  }\n\n  if (mode === \"window\") {\n    const onShare = async () => {\n      const link = await shareItAsHtml(\n        { code: session.transpiled, HTML: session.HTML },\n      );\n      window.open(link);\n    };\n\n    ReactDOM.render(\n      jsx(DraggableWindow, {\n        onShare,\n      }),\n      window.document.getElementById(\"dragabbleWindow\"),\n    );\n  }\n\n  const transpiled = await transpileCode(session.code);\n  restartCode(transpiled);\n\n  const modules = await startMonaco({\n    language: \"typescript\",\n    code: formatter(session.code),\n    onChange: (c) => runner(formatter(c)),\n  });\n\n  async function runner(cd) {\n    try {\n      const transpiled = await transpileCode(cd, session.lastErrors);\n      if (session.transpiled === transpiled) return;\n      let restartError = false;\n      ///yellow\n      if (transpiled.length && session.lastErrors === 0) {\n        restartError = restartCode(transpiled);\n      }\n\n      const err = [\n        ...(restartError\n          ? [\n            { messageText: \"Error while starting the app. Check the console!\" },\n          ]\n          : []),\n        ...(await getErrors(cd)),\n      ];\n      if (session.lastErrors && err.length === 0) restartCode(transpiled);\n      session.lastErrors = err.length;\n      const errorDiv = window.document.getElementById(\"error\");\n      if (err.length === 0 && transpiled.length) {\n        session.code = cd;\n        if (session.transpiled !== transpiled) {\n          session.transpiled = transpiled;\n\n          await saveCode(formatter(cd), session.transpiled);\n        }\n\n        await saveCode(cd);\n      } else {\n        session.error = cd;\n\n        const slices = await diff(session.code, cd);\n\n        if (slices.c.length <= 3) {\n          session.lastErrors = 0;\n\n          return;\n        }\n\n        if (slices.c.length == 4) {\n          session.lastErrors = 0;\n          modules.monaco.editor.setTheme(\"hc-black\");\n\n          return;\n        }\n\n        errorDiv.innerHTML = err[0].messageText.toString();\n\n        errorDiv.style.display = \"block\";\n\n        return;\n      }\n\n      errorDiv.style.display = \"none\";\n\n      modules.monaco.editor.setTheme(\"vs-dark\");\n    } catch (err) {\n      modules.monaco.editor.setTheme(\"vs-light\");\n      setTimeout(() => {\n        modules.monaco.editor.setTheme(\"hc-black\");\n      }, 50);\n      console.error(err);\n    }\n  }\n\n  async function getErrors(code) {\n    if (!modules || !modules.monaco) return;\n    const { monaco } = modules;\n    const { sha256 } = await import(\"./sha256.js\");\n    const shaCode = await sha256(code);\n    const filename = `file:///${shaCode}.tsx`;\n    const uri = monaco.Uri.parse(filename);\n    const model = monaco.editor.getModel(uri) ||\n      await monaco.editor.createModel(code, \"typescript\", uri);\n    const worker = await monaco.languages.typescript.getTypeScriptWorker();\n    const client = await worker(model.uri);\n\n    const diag = client.getSemanticDiagnostics(filename);\n    const comp = client.getCompilerOptionsDiagnostics(filename);\n    const syntax = client.getSyntacticDiagnostics(filename);\n    const fastError = await Promise.race([diag, comp, syntax]);\n\n    model.dispose();\n\n    return [\n      ...fastError,\n    ];\n  }\n\n  async function restartCode(transpiled) {\n    if (typeof transpiled !== \"string\" || transpiled === \"\") {\n      // console.log(transpiled.error);\n      return 1;\n    }\n\n    const codeToHydrate = mode === \"window\"\n      ? transpiled.replace(\"body{\", \"#zbody{\")\n      : transpiled;\n\n    const root = window.document.getElementById(\"zbody\");\n\n    const Element = (await import(createJsBlob(codeToHydrate))).default;\n\n    ReactDOM.render(Element(), root);\n    session.HTML = root.innerHTML;\n\n    return !session.preRendered;\n  }\n\n  async function getCodeToLoad() {\n    const projects = await getProjects();\n    const projectName = projects[0];\n\n    const search = new URLSearchParams(window.location.search);\n    const keyToLoad = search.get(\"h\") || await shaDB.get(projectName);\n\n    if (keyToLoad) {\n      let code;\n      try {\n        code = await shaDB.get(keyToLoad);\n      } catch {\n        console.error(\"error load key: \" + keyToLoad);\n      }\n\n      if (code) return code;\n\n      let text;\n      try {\n        const resp = await fetch(\"https://code.zed.vision/?h=\" + keyToLoad);\n        text = await resp.json();\n      } catch (e) {\n        const { sha256 } = await import(\"./sha256.js\");\n        const shaHash = await sha256(starter);\n\n        shaDB.put(shaHash, starter);\n        await shaDB.put(projectName, shaHash);\n        return starter;\n      }\n\n      return text;\n    }\n\n    return starter;\n  }\n\n  function setQueryStringParameter(name, value) {\n    const params = new URLSearchParams(window.location.search);\n    params.set(name, value);\n    window.history.replaceState(\n      {},\n      \"\",\n      decodeURIComponent(`${window.location.pathname}?${params}`),\n    );\n  }\n}\n"],"names":["importScript","src","res","slice","window","document","head","querySelector","Promise","resolve","reject","s","createElement","type","onload","length","ret","forEach","x","Object","assign","onerror","appendChild","db","transform","ipfsWorker","DraggableWindow","onShare","jsx","React","Fragment","motion","div","css","animate","scale","top","left","dragElastic","dragMomentum","initial","transition","duration","drag","dragConstraints","innerWidth","right","bottom","innerHeight","onClick","id","shaDB","get","getDB","put","sha256","crypto","subtle","digest","TextEncoder","encode","Array","from","Uint8Array","map","b","toString","join","saveCode","code","hash","uuid","fetch","resp","json","data","getUserId","projects","list","projectId","v4","JSON","stringify","created","Date","now","lastOpen","getProjects","projectName","body","recover","result","prevHash","e","then","console","error","transpileCode","hasToReport","init","worker","Worker","Comlink","initIpfsKV","saveToIPFS","content","add","ipfsKV","URL","createObjectURL","Blob","cid","createJsBlob","blob","run","mode","getCodeToLoad","session","formatter","ReactDOM","render","HTML","mod","import","sheet","cssRules","cssText","filter","cssRule","includes","substring","getHtml","getCodeForImport","linkToCode","log","html","js","shareItAsHtml","transpiled","link","open","getElementById","restartCode","codeToHydrate","replace","root","Element","_import","innerHTML","preRendered","startMonaco","language","onChange","c","cd","lastErrors","restartError","messageText","modules","monaco","shaCode","model","languages","typescript","getTypeScriptWorker","uri","client","diag","getSemanticDiagnostics","filename","comp","getCompilerOptionsDiagnostics","syntax","getSyntacticDiagnostics","race","fastError","dispose","Uri","parse","editor","getModel","createModel","getErrors","errorDiv","style","display","setTheme","err","diff","slices","_exit","setTimeout","runner","renderDraggableEditor","hydrated","ipfs","prettier","format","arrowParens","bracketSpacing","embeddedLanguageFormatting","htmlWhitespaceSensitivity","insertPragma","jsxBracketSameLine","jsxSingleQuote","printWidth","proseWrap","quoteProps","requirePragma","semi","singleQuote","tabWidth","trailingComma","useTabs","parser","plugins","parserBabel","parserHtml"],"mappings":"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"}