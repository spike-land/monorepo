const J=async()=>{const n=window.JSFrame,e=new n({fixed:!1});e.create({name:"Win0",title:"Your page :)",left:(window.innerWidth-360)/2,top:20,width:360,height:320,appearanceName:"yosemite",html:`<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" /><div style="color:black; font-size:16px; overflow: hidden" class="window-content">
    <div id="root"></div>
</div>`}).show()},q=async({onChange:n,code:e,language:t})=>{const r=window.document.getElementById("container");if(!r){const d=E.getElementById("container");d.id="container",E.body.appendChild(d)}const i=t==="typescript"?"file:///main.tsx":"file:///main.html";let o;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)){const d=window.document.createElement("div");d.id="ace",window.document.body.appendChild(d),await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"),t==="typescript"?await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js"):await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.min.js"),await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js"),window.document.getElementById("ace").style.setProperty("display","block"),r.style.setProperty("display","none"),o=window.ace.edit("ace"),o.getSession().setMode("ace/mode/typescript");const c=a=>setTimeout(()=>{let u=window.ace.edit("ace"),h=u.getTheme();h!=="ace/theme/monokai "&&(u.setOptions({fontSize:"14pt"}),u.setTheme("ace/theme/monokai"),c(2*a))},a);c(100),o.setValue(e),o.blur()}if(window.monaco===void 0){const d="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs",{require:c}=await A("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js");c.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs"}}),await new Promise(a=>c(["vs/editor/editor.main"],u=>{a(u)}))}const l=window.monaco,s={monaco:l,editor:l.editor.create(window.document.getElementById("container"),{formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;}",mouseWheelZoom:!1,wordWrapColumn:80,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",padding:{bottom:300},lineNumbers:"on",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:l.editor.getModel(i)||l.editor.createModel(e,t,l.Uri.parse(i)),value:e,language:t,theme:"vs-dark"})};if(s.editor.onDidChangeModelContent(()=>n(s.editor.getValue())),o&&o.session.on("change",function(){const d=o.getValue();s.editor.setValue(d),n(d)}),o&&E.getElementById("container").replaceWith(E.getElementById("ace")),s.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),t==="typescript"){const d=[{name:"react",url:"https://unpkg.com/@types/react@16.9.56/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@16.9.56/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@16.9.9/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@3.0.5/index.d.ts",depend:[]},{name:"@emotion/styled/base.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/styled/index.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/cache/index.d.ts",url:"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts",depend:["@emotion/utils"]},{name:"@emotion/react/index.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/index.d.ts",depend:["@emotion/cache"]},{name:"@emotion/react/jsx-namespace.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/jsx-namespace.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/css-prop.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/css-prop.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/helper.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/helper.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/theming.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/theming.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/serialize/index.d.ts",url:"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/utils/index.d.ts",url:"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts",depend:[]}],c=d.map(({name:a,url:u})=>(async()=>s.monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(u)).text(),a.includes("@emotion")?`file:///node_modules/${a}`:`file:///node_modules/@types/${a}/index.d.ts`))());return s.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:s.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:s.monaco.languages.typescript.ModuleResolutionKind.NodeJs,module:s.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:s.monaco.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",jsxFragmentFactory:"React.Fragment",esModuleInterop:!0}),await Promise.all(c),s.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),s}};function A(n){return new Promise(function(e,t){var r;r=window.document.createElement("script"),r.src=n,r.onload=()=>e(window),r.onerror=t,window.document.head.appendChild(r)})}const F=async n=>E.querySelector(`script[src="${n}"]`)||new Promise(function(e,t){const r=window.document.createElement("script");r.src=n,r.onload=e,r.onerror=t,window.document.head.appendChild(r)}),$=`import React from "react";
import ReactDOM from "react-dom"
/** @jsx jsx */
import styled from "@emotion/styled"

const Counter = () => {
  const [clicks, setClicks] = React.useState(0);

  return <Container>
    <Button css={\`background: green\`} onClick={() => setClicks(clicks - 1)}>-</Button>
    {clicks}
    <Button css={\`background: red\`} onClick={() => setClicks(clicks + 1)}>+</Button>
  </Container>
}

const Container = styled.div\`
  margin: 2em;
  display: inline-block;
  min-width: 200px;
  background: white;
  border: 4px dotted red;
  border-radius: 30px;
  padding: 1rem;
\`

const Button = styled.button\`
  text-align: center;
  display: inline-block;
  border-radius: 6px;
  padding: 0.5rem 0;
  margin: 0.5rem 2rem;
  width: 4rem;
  color: white;
  border: none;
  :focus{
    outline: none;
  }
  \`

const elementToRender = document.getElementById("root");
ReactDOM.render(<Counter />, elementToRender);



`,C=-1;function I({text1:n,text2:e,cursorPos:t}){if(n===e)return n?[[0,n]]:[];if(t){const s=ee(n,e,t);if(s)return s}let r=O(n,e);const i=n.substring(0,r);n=n.substring(r),e=e.substring(r),r=R(n,e);const o=n.substring(n.length-r);n=n.substring(0,n.length-r),e=e.substring(0,e.length-r);const l=X(n,e);return i&&l.unshift([0,i]),o&&l.push([0,o]),z(l),l}function X(n,e){let t;if(!n)return[[1,e]];if(!e)return[[C,n]];const r=n.length>e.length?n:e,i=n.length>e.length?e:n,o=r.indexOf(i);if(o!==-1)return t=[[1,r.substring(0,o)],[0,i],[1,r.substring(o+i.length)]],n.length>e.length&&(t[0][0]=t[2][0]=C),t;if(i.length===1)return[[C,n],[1,e]];const l=K(n,e);if(l){const s=l[0]||"",d=l[1]||"",c=l[2]||"",a=l[3]||"",u=l[4]||"",h=I({text1:s,text2:c,cursorPos:0}),g=I({text1:d,text2:a,cursorPos:0});return h.concat([[0,u[1]]],g)}return G(n,e)}function G(n,e){const t=n.length,r=e.length,i=Math.ceil((t+r)/2),o=i,l=2*i,s=new Array(l),d=new Array(l);for(let m=0;m<l;m++)s[m]=-1,d[m]=-1;s[o+1]=0,d[o+1]=0;const c=t-r,a=c%2!==0;let u=0,h=0,g=0,p=0;for(let m=0;m<i;m++){for(let f=-m+u;f<=m-h;f+=2){const y=i+f;let w;f===-m||f!==m&&s[y-1]<s[y+1]?w=s[y+1]:w=s[y-1]+1;let k=w-f;for(;w<t&&k<r&&n.charAt(w)===e.charAt(k);)w++,k++;if(s[y]=w,w>t)h+=2;else if(k>r)u+=2;else if(a){const S=i+c-f;if(S>=0&&S<l&&d[S]!==-1){const M=t-d[S];if(w>=M)return W(n,e,w,k)}}}let b;for(let f=-m+g;f<=m-p;f+=2){const y=i+f;f===-m||f!==m&&d[y-1]<d[y+1]?b=d[y+1]:b=d[y-1]+1;let w=b-f;for(;b<t&&w<r&&n.charAt(t-b-1)===e.charAt(r-w-1);)b++,w++;if(d[y]=b,b>t)p+=2;else if(w>r)g+=2;else if(!a){const k=i+c-f;if(k>=0&&k<l&&s[k]!==-1){const S=s[k],M=i+S-k;if(b=t-b,S>=b)return W(n,e,S,M)}}}}return[[C,n],[1,e]]}function W(n,e,t,r){const i=n.substring(0,t),o=e.substring(0,r),l=n.substring(t),s=e.substring(r),d=I({text1:i,text2:o,cursorPos:0}),c=I({text1:l,text2:s,cursorPos:0});return d.concat(c)}function O(n,e){if(!n||!e||n.charAt(0)!==e.charAt(0))return 0;let t=0,r=Math.min(n.length,e.length),i=r,o=0;for(;t<i;)n.substring(o,i)==e.substring(o,i)?(t=i,o=t):r=i,i=Math.floor((r-t)/2+t);return P(n.charCodeAt(i-1))&&i--,i}function R(n,e){if(!n||!e||n.slice(-1)!==e.slice(-1))return 0;let t=0,r=Math.min(n.length,e.length),i=r,o=0;for(;t<i;)n.substring(n.length-i,n.length-o)==e.substring(e.length-i,e.length-o)?(t=i,o=t):r=i,i=Math.floor((r-t)/2+t);return N(n.charCodeAt(n.length-i))&&i--,i}function K(n,e){const t=n.length>e.length?n:e,r=n.length>e.length?e:n;if(t.length<4||r.length*2<t.length)return null;function i(g,p,m){const b=g.substring(m,m+Math.floor(g.length/4));let f=-1,y="",w,k,S,M;for(;(f=p.indexOf(b,f+1))!==-1;){const L=O(g.substring(m),p.substring(f)),D=R(g.substring(0,m),p.substring(0,f));y.length<D+L&&(y=p.substring(f-D,f)+p.substring(f,f+L),w=g.substring(0,m-D),k=g.substring(m+L),S=p.substring(0,f-D),M=p.substring(f+L))}return y.length*2>=g.length?[w,k,S,M,y]:null}const o=i(t,r,Math.ceil(t.length/4)),l=i(t,r,Math.ceil(t.length/2));let s;if(l===null&&o===null)return null;if(l===null){if(o===null)return null;s=o}else if(o===null){if(l===null)return null;s=l}else s=o[4].length>l[4].length?o:l;let d,c,a,u;n.length>e.length?(d=s[0],c=s[1],a=s[2],u=s[3]):(a=s[0],u=s[1],d=s[2],c=s[3]);const h=s[4];return[d,c,a,u,h]}function z(n){const e=[...n];e.push([0,""]);let t=0,r=0,i=0,o="",l="",s,d;for(;t<e.length;){if(t<e.length-1&&!e[t][1]){e.splice(t,1);continue}switch(e[t][0]){case 1:i++,l+=e[t][1],t++;break;case C:r++,o+=e[t][1],t++;break;case 0:if(d=t-i-r-1,t<e.length-1&&!e[t][1]){e.splice(t,1);break}if(o.length>0||l.length>0){o.length>0&&l.length>0&&(s=O(l,o),s!==0&&(d>=0?e[d][1]+=l.substring(0,s):(e.splice(0,0,[0,l.substring(0,s)]),t++),l=l.substring(s),o=o.substring(s)),s=R(l,o),s!==0&&(e[t][1]=l.substring(l.length-s)+e[t][1],l=l.substring(0,l.length-s),o=o.substring(0,o.length-s)));const a=i+r;o.length===0&&l.length===0?(e.splice(t-a,a),t=t-a):o.length===0?(e.splice(t-a,a,[1,l]),t=t-a+1):l.length===0?(e.splice(t-a,a,[C,o]),t=t-a+1):(e.splice(t-a,a,[C,o],[1,l]),t=t-a+2)}t!==0&&e[t-1][0]===0?(e[t-1][1]+=e[t][1],e.splice(t,1)):t++,i=0,r=0,o="",l="";break}}e[e.length-1][1]===""&&e.pop();let c=!1;for(t=1;t<e.length-1;)e[t-1][0]===0&&e[t+1][0]===0&&(e[t][1].substring(e[t][1].length-e[t-1][1].length)===e[t-1][1]?(e[t][1]=e[t-1][1]+e[t][1].substring(0,e[t][1].length-e[t-1][1].length),e[t+1][1]=e[t-1][1]+e[t+1][1],e.splice(t-1,1),c=!0):e[t][1].substring(0,e[t+1][1].length)==e[t+1][1]&&(e[t-1][1]+=e[t+1][1],e[t][1]=e[t][1].substring(e[t+1][1].length)+e[t+1][1],e.splice(t+1,1),c=!0)),t++;return c?z(e):e}function P(n){return n>=55296&&n<=56319}function N(n){return n>=56320&&n<=57343}function Q(n){return N(n.charCodeAt(0))}function Y(n){return P(n.charCodeAt(n.length-1))}function Z(n){const e=[];for(let t=0;t<n.length;t++)n[t][1].length>0&&e.push(n[t]);return e}function x(n,e,t,r){return Y(n)||Q(r)?null:Z([[0,n],[C,e],[1,t],[0,r]])}function ee(n,e,t){const r=typeof t=="number"?{index:t,length:0}:t.oldRange,i=typeof t=="number"?null:t.newRange,o=n.length,l=e.length;if(r.length===0&&(i===null||i.length===0)){const s=r.index,d=n.slice(0,s),c=n.slice(s),a=i?i.index:null;e:{const u=s+l-o;if(a!==null&&a!==u)break e;if(u<0||u>l)break e;const h=e.slice(0,u),g=e.slice(u);if(g!==c)break e;const p=Math.min(s,u),m=d.slice(0,p),b=h.slice(0,p);if(m!==b)break e;const f=d.slice(p),y=h.slice(p);return x(m,f,y,c)}e:{if(a!==null&&a!==s)break e;const u=s,h=e.slice(0,s),g=e.slice(s);if(h!==d)break e;const p=Math.min(o-s,l-s),m=c.slice(c.length-p),b=g.slice(g.length-p);if(m!==b)break e;const f=c.slice(0,c.length-p),y=g.slice(0,g.length-p);return x(d,f,y,m)}}if(r.length>0&&i&&i.length===0){e:{const s=n.slice(0,r.index),d=n.slice(r.index+r.length),c=s.length,a=d.length;if(l<c+a)break e;const u=e.slice(0,c),h=e.slice(l-a);if(s!==u||d!==h)break e;const g=n.slice(c,o-a),p=e.slice(c,l-a);return x(s,g,p,d)}}return null}function T(n,e,t){return I({text1:n,text2:e,cursorPos:t})}T.INSERT=1,T.DELETE=C,T.EQUAL=0;const E=window.document;let H=!0,B=0,_=0,v="",U="",V="",j="";export async function run(){const n=F("https://unpkg.com/jsframe.js@1.6.2/lib/jsframe.min.js");await F("https://unpkg.com/@babel/standalone@7.12.6/babel.min.js"),await n,J(),(async()=>{const i=t();j=i;const o=await q({language:"typescript",code:i,onChange:l});function l(c){if(!o)return;if(v=c,!B)d(v);else{const a=c,u=setInterval(()=>{(c!==v||!B)&&clearInterval(u),B||d(v)},100)}}async function s(){if(!o||!o.monaco)return;const c=o.monaco.Uri.parse("file:///main.tsx"),a=await o.monaco.languages.typescript.getTypeScriptWorker(),u=await(await a(c)).getSemanticDiagnostics("file:///main.tsx"),h=await(await a(c)).getCompilerOptionsDiagnostics("file:///main.tsx"),g=await(await a(c)).getSyntacticDiagnostics("file:///main.tsx");return[...u,...h,...g]}async function d(c){if(B===1)return;try{B=1;const a=await s(),u=E.getElementById("error");if(B=0,c!==v)return;if(a&&a.length){if(v!=c)return;if(U===c)return;E.getElementById("root").classList.add("transparent");const h=T(j,c,0);if(h.length<=3){o.monaco.editor.setTheme("hc-black");return}u.innerHTML=a[0].messageText.toString(),E.getElementById("root").style.setProperty("dispay","none"),u.style.display="block",U=c,o.monaco.editor.setTheme("vs-light"),setTimeout(()=>{o.monaco.editor.setTheme("hc-black")},_++);return}j=c,u.style.display="none",o.monaco.editor.setTheme("vs-dark"),E.getElementById("root").classList.remove("transparent"),_=0,B=0,e(r(c))}catch(a){if(B=0,c!==v)return;o.monaco.editor.setTheme("vs-light"),setTimeout(()=>{o.monaco.editor.setTheme("hc-black")},10),console.error(a)}}})(),e(r(t())),E.getElementById("root").setAttribute("style","display:block");async function e(i){console.log(i);const o=new Function("transpileCode",`return function(){ 
        ${i} 
    }`)();if(!H){const l=async d=>{if(d!==j)return;if(V===d)return;V=d;const c={codeTranspiled:i,code:j},a=JSON.stringify(c),u=new Request("https://code.zed.vision",{body:a,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),h=await fetch(u),{hash:g}=await h.json();try{const p=window.localStorage,m=p.getItem("codeBoXHash");m!==g&&(p.setItem("codeBoXHash",g),p.setItem(g,j),window.history.pushState({},"","/?h="+g))}catch(p){console.log("no localStorage")}},s=v;setTimeout(()=>l(v),500)}H=!1,o()}function t(){const i=new URLSearchParams(window.location.search),o=i.get("h")||localStorage.getItem("codeBoXHash");return o&&window.localStorage.getItem(o)||window.localStorage.getItem("STARTER")||$}function r(i){return window.Babel.transform(i,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(/import/gi,"///")}}
