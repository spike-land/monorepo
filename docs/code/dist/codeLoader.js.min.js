const O=async n=>B.querySelector(`script[src="${n}"]`)||new Promise(function(t,e){const i=window.document.createElement("script");i.src=n,i.onload=t,i.onerror=e,window.document.head.appendChild(i)}),J=async()=>(await O("https://unpkg.com/jsframe.js@1.6.2/lib/jsframe.min.js"),new Promise(n=>{setTimeout(()=>{const t=window.JSFrame,e=new t({horizontalAlign:"left",verticalAlign:"top"}),i=e.create({name:"Win2",title:"Z",left:(window.innerWidth-window.innerWidth*.7)/2,top:20,width:window.innerWidth*.7,height:320,minWidth:300,minHeight:200,appearanceName:"material",appearanceParam:{border:{shadow:"2px 2px 10px  rgba(0, 0, 0, 0.5)",width:0,radius:6},titleBar:{color:"white",fontSize:"20px",background:"red",leftMargin:40,height:30,fontSize:14,buttonWidth:36,buttonHeight:16,buttonColor:"white",fontWeight:"bolder",buttons:[{fa:"fas fa-times",name:"closeButton",visible:!0},{fa:"fas fa-expand-arrows-alt",name:"maximizeButton",visible:!0},{fa:"fas fa-compress-arrows-alt",name:"minimizedButton",visible:!1}],buttonsOnLeft:[{fa:"fas fa-bars",name:"menu",visible:!0,childMenuHTML:'<div class="list-group">  <div name="menu1" class="list-group-item list-group-item-action py-2">Menu Item 01</div>  <div name="menu2" class="list-group-item list-group-item-action py-2">Menu Item 02</div>  <div name="menu3" class="list-group-item list-group-item-action py-2">Menu Item 03</div></div>',childMenuWidth:300}]}},style:{backgroundColor:"rgba(198,198,198,0.8)",fontSize:"1rem",overflow:"hidden",width:"100%"},html:'<div id="root"></div>'}).show();i.setControl({maximizeButton:"maximizeButton",demaximizeButton:"restoreButton",minimizeButton:"minimizeButton",deminimizeButton:"deminimizeButton",hideButton:"closeButton",animation:!0,animationDuration:150,maximizeWithoutTitleBar:!0,restoreKey:"Escape"}),i.control.on("hid",(s,r)=>{s.closeFrame()}),i.control.on("maximized",(s,r)=>{e.showToast({text:'Press "ESC" to minimize.',align:"center"})}),i.control.on("demaximized",(s,r)=>{}),i.on("menu","click",(s,r,a)=>{const o=r.target.getAttribute("name");o&&o.startsWith("menu")&&alert(o+" clicked")}),n()})})),$=async({onChange:n,code:t,language:e})=>{const i=window.document.getElementById("container");if(!i){const l=B.getElementById("container");l.id="container",B.body.appendChild(l)}const s=e==="typescript"?"file:///main.tsx":"file:///main.html";let r;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)){const l=window.document.createElement("div");l.id="ace",window.document.body.appendChild(l),await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"),e==="typescript"?await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js"):await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.min.js"),await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js"),window.document.getElementById("ace").style.setProperty("display","block"),i.style.setProperty("display","none"),r=window.ace.edit("ace"),r.getSession().setMode("ace/mode/typescript");const d=c=>setTimeout(()=>{let u=window.ace.edit("ace"),h=u.getTheme();h!=="ace/theme/monokai "&&(u.setOptions({fontSize:"14pt"}),u.setTheme("ace/theme/monokai"),d(2*c))},c);d(100),r.setValue(t),r.blur()}if(window.monaco===void 0){const l="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs",{require:d}=await A("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js");d.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs"}}),await new Promise(c=>d(["vs/editor/editor.main"],u=>{c(u)}))}const a=window.monaco,o={monaco:a,editor:a.editor.create(window.document.getElementById("container"),{formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;}",mouseWheelZoom:!1,wordWrapColumn:80,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",padding:{bottom:300},lineNumbers:"on",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:a.editor.getModel(s)||a.editor.createModel(t,e,a.Uri.parse(s)),value:t,language:e,theme:"vs-dark"})};if(o.editor.onDidChangeModelContent(()=>n(o.editor.getValue())),r&&r.session.on("change",function(){const l=r.getValue();o.editor.setValue(l),n(l)}),r&&B.getElementById("container").replaceWith(B.getElementById("ace")),o.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),e==="typescript"){const l=[{name:"react",url:"https://unpkg.com/@types/react@16.9.56/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@16.9.56/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@16.9.9/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@3.0.5/index.d.ts",depend:[]},{name:"@emotion/styled/base.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/styled/index.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/cache/index.d.ts",url:"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts",depend:["@emotion/utils"]},{name:"@emotion/react/index.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/index.d.ts",depend:["@emotion/cache"]},{name:"@emotion/react/jsx-namespace.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/jsx-namespace.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/css-prop.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/css-prop.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/helper.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/helper.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/theming.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/theming.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/serialize/index.d.ts",url:"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/utils/index.d.ts",url:"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts",depend:[]}],d=l.map(({name:c,url:u})=>(async()=>o.monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(u)).text(),c.includes("@emotion")?`file:///node_modules/${c}`:`file:///node_modules/@types/${c}/index.d.ts`))());return o.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:o.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:o.monaco.languages.typescript.ModuleResolutionKind.NodeJs,module:o.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:o.monaco.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",jsxFragmentFactory:"React.Fragment",esModuleInterop:!0}),await Promise.all(d),o.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),o}};function A(n){return new Promise(function(t,e){var i;i=window.document.createElement("script"),i.src=n,i.onload=()=>t(window),i.onerror=e,window.document.head.appendChild(i)})}const q=`import React from "react";
import ReactDOM from "react-dom";
/** @jsx jsx */
import styled from "@emotion/styled";

const Counter = () => {
  const [clicks, setClicks] = React.useState(0);

  return <Container>
    <Button css={\`background: green\`} onClick={() => setClicks(clicks - 1)}>
      -
    </Button>
    {clicks}
    <Button css={\`background: red\`} onClick={() => setClicks(clicks + 1)}>
      +
    </Button>
  </Container>;
};

const Container = styled.div\`
  margin: 2em;
  display: inline-block;
  min-width: 200px;
  background: white;
  border: 4px dotted red;
  border-radius: 30px;
  padding: 1rem;
\`;

const Button = styled.button\`
  text-align: center;
  display: inline-block;
  border-radius: 6px;
  padding: 0.5rem 0;
  margin: 0.5rem 2rem;
  width: 4rem;
  color: white;
  border: none;
  :focus{
    outline: none;
  }
  \`;

const elementToRender = document.getElementById("root");
ReactDOM.render(<Counter />, elementToRender);

`,v=-1;function I({text1:n,text2:t,cursorPos:e}){if(n===t)return n?[[0,n]]:[];if(e){const o=ee(n,t,e);if(o)return o}let i=P(n,t);const s=n.substring(0,i);n=n.substring(i),t=t.substring(i),i=z(n,t);const r=n.substring(n.length-i);n=n.substring(0,n.length-i),t=t.substring(0,t.length-i);const a=X(n,t);return s&&a.unshift([0,s]),r&&a.push([0,r]),F(a),a}function X(n,t){let e;if(!n)return[[1,t]];if(!t)return[[v,n]];const i=n.length>t.length?n:t,s=n.length>t.length?t:n,r=i.indexOf(s);if(r!==-1)return e=[[1,i.substring(0,r)],[0,s],[1,i.substring(r+s.length)]],n.length>t.length&&(e[0][0]=e[2][0]=v),e;if(s.length===1)return[[v,n],[1,t]];const a=Q(n,t);if(a){const o=a[0]||"",l=a[1]||"",d=a[2]||"",c=a[3]||"",u=a[4]||"",h=I({text1:o,text2:d,cursorPos:0}),p=I({text1:l,text2:c,cursorPos:0});return h.concat([[0,u[1]]],p)}return K(n,t)}function K(n,t){const e=n.length,i=t.length,s=Math.ceil((e+i)/2),r=s,a=2*s,o=new Array(a),l=new Array(a);for(let f=0;f<a;f++)o[f]=-1,l[f]=-1;o[r+1]=0,l[r+1]=0;const d=e-i,c=d%2!==0;let u=0,h=0,p=0,g=0;for(let f=0;f<s;f++){for(let m=-f+u;m<=f-h;m+=2){const y=s+m;let w;m===-f||m!==f&&o[y-1]<o[y+1]?w=o[y+1]:w=o[y-1]+1;let k=w-m;for(;w<e&&k<i&&n.charAt(w)===t.charAt(k);)w++,k++;if(o[y]=w,w>e)h+=2;else if(k>i)u+=2;else if(c){const S=s+d-m;if(S>=0&&S<a&&l[S]!==-1){const M=e-l[S];if(w>=M)return W(n,t,w,k)}}}let b;for(let m=-f+p;m<=f-g;m+=2){const y=s+m;m===-f||m!==f&&l[y-1]<l[y+1]?b=l[y+1]:b=l[y-1]+1;let w=b-m;for(;b<e&&w<i&&n.charAt(e-b-1)===t.charAt(i-w-1);)b++,w++;if(l[y]=b,b>e)g+=2;else if(w>i)p+=2;else if(!c){const k=s+d-m;if(k>=0&&k<a&&o[k]!==-1){const S=o[k],M=s+S-k;if(b=e-b,S>=b)return W(n,t,S,M)}}}}return[[v,n],[1,t]]}function W(n,t,e,i){const s=n.substring(0,e),r=t.substring(0,i),a=n.substring(e),o=t.substring(i),l=I({text1:s,text2:r,cursorPos:0}),d=I({text1:a,text2:o,cursorPos:0});return l.concat(d)}function P(n,t){if(!n||!t||n.charAt(0)!==t.charAt(0))return 0;let e=0,i=Math.min(n.length,t.length),s=i,r=0;for(;e<s;)n.substring(r,s)==t.substring(r,s)?(e=s,r=e):i=s,s=Math.floor((i-e)/2+e);return x(n.charCodeAt(s-1))&&s--,s}function z(n,t){if(!n||!t||n.slice(-1)!==t.slice(-1))return 0;let e=0,i=Math.min(n.length,t.length),s=i,r=0;for(;e<s;)n.substring(n.length-s,n.length-r)==t.substring(t.length-s,t.length-r)?(e=s,r=e):i=s,s=Math.floor((i-e)/2+e);return H(n.charCodeAt(n.length-s))&&s--,s}function Q(n,t){const e=n.length>t.length?n:t,i=n.length>t.length?t:n;if(e.length<4||i.length*2<e.length)return null;function s(p,g,f){const b=p.substring(f,f+Math.floor(p.length/4));let m=-1,y="",w,k,S,M;for(;(m=g.indexOf(b,m+1))!==-1;){const L=P(p.substring(f),g.substring(m)),T=z(p.substring(0,f),g.substring(0,m));y.length<T+L&&(y=g.substring(m-T,m)+g.substring(m,m+L),w=p.substring(0,f-T),k=p.substring(f+L),S=g.substring(0,m-T),M=g.substring(m+L))}return y.length*2>=p.length?[w,k,S,M,y]:null}const r=s(e,i,Math.ceil(e.length/4)),a=s(e,i,Math.ceil(e.length/2));let o;if(a===null&&r===null)return null;if(a===null){if(r===null)return null;o=r}else if(r===null){if(a===null)return null;o=a}else o=r[4].length>a[4].length?r:a;let l,d,c,u;n.length>t.length?(l=o[0],d=o[1],c=o[2],u=o[3]):(c=o[0],u=o[1],l=o[2],d=o[3]);const h=o[4];return[l,d,c,u,h]}function F(n){const t=[...n];t.push([0,""]);let e=0,i=0,s=0,r="",a="",o,l;for(;e<t.length;){if(e<t.length-1&&!t[e][1]){t.splice(e,1);continue}switch(t[e][0]){case 1:s++,a+=t[e][1],e++;break;case v:i++,r+=t[e][1],e++;break;case 0:if(l=e-s-i-1,e<t.length-1&&!t[e][1]){t.splice(e,1);break}if(r.length>0||a.length>0){r.length>0&&a.length>0&&(o=P(a,r),o!==0&&(l>=0?t[l][1]+=a.substring(0,o):(t.splice(0,0,[0,a.substring(0,o)]),e++),a=a.substring(o),r=r.substring(o)),o=z(a,r),o!==0&&(t[e][1]=a.substring(a.length-o)+t[e][1],a=a.substring(0,a.length-o),r=r.substring(0,r.length-o)));const c=s+i;r.length===0&&a.length===0?(t.splice(e-c,c),e=e-c):r.length===0?(t.splice(e-c,c,[1,a]),e=e-c+1):a.length===0?(t.splice(e-c,c,[v,r]),e=e-c+1):(t.splice(e-c,c,[v,r],[1,a]),e=e-c+2)}e!==0&&t[e-1][0]===0?(t[e-1][1]+=t[e][1],t.splice(e,1)):e++,s=0,i=0,r="",a="";break}}t[t.length-1][1]===""&&t.pop();let d=!1;for(e=1;e<t.length-1;)t[e-1][0]===0&&t[e+1][0]===0&&(t[e][1].substring(t[e][1].length-t[e-1][1].length)===t[e-1][1]?(t[e][1]=t[e-1][1]+t[e][1].substring(0,t[e][1].length-t[e-1][1].length),t[e+1][1]=t[e-1][1]+t[e+1][1],t.splice(e-1,1),d=!0):t[e][1].substring(0,t[e+1][1].length)==t[e+1][1]&&(t[e-1][1]+=t[e+1][1],t[e][1]=t[e][1].substring(t[e+1][1].length)+t[e+1][1],t.splice(e+1,1),d=!0)),e++;return d?F(t):t}function x(n){return n>=55296&&n<=56319}function H(n){return n>=56320&&n<=57343}function G(n){return H(n.charCodeAt(0))}function Z(n){return x(n.charCodeAt(n.length-1))}function Y(n){const t=[];for(let e=0;e<n.length;e++)n[e][1].length>0&&t.push(n[e]);return t}function R(n,t,e,i){return Z(n)||G(i)?null:Y([[0,n],[v,t],[1,e],[0,i]])}function ee(n,t,e){const i=typeof e=="number"?{index:e,length:0}:e.oldRange,s=typeof e=="number"?null:e.newRange,r=n.length,a=t.length;if(i.length===0&&(s===null||s.length===0)){const o=i.index,l=n.slice(0,o),d=n.slice(o),c=s?s.index:null;e:{const u=o+a-r;if(c!==null&&c!==u)break e;if(u<0||u>a)break e;const h=t.slice(0,u),p=t.slice(u);if(p!==d)break e;const g=Math.min(o,u),f=l.slice(0,g),b=h.slice(0,g);if(f!==b)break e;const m=l.slice(g),y=h.slice(g);return R(f,m,y,d)}e:{if(c!==null&&c!==o)break e;const u=o,h=t.slice(0,o),p=t.slice(o);if(h!==l)break e;const g=Math.min(r-o,a-o),f=d.slice(d.length-g),b=p.slice(p.length-g);if(f!==b)break e;const m=d.slice(0,d.length-g),y=p.slice(0,p.length-g);return R(l,m,y,f)}}if(i.length>0&&s&&s.length===0){e:{const o=n.slice(0,i.index),l=n.slice(i.index+i.length),d=o.length,c=l.length;if(a<d+c)break e;const u=t.slice(0,d),h=t.slice(a-c);if(o!==u||l!==h)break e;const p=n.slice(d,r-c),g=t.slice(d,a-c);return R(o,p,g,l)}}return null}function D(n,t,e){return I({text1:n,text2:t,cursorPos:e})}D.INSERT=1,D.DELETE=v,D.EQUAL=0;const B=window.document;let U=!0,E=0,_=0,C="",N="",V="",j="";export async function run(){await J(),await O("https://unpkg.com/@babel/standalone@7.12.6/babel.min.js"),(async()=>{const i=t();j=i;const s=await $({language:"typescript",code:i,onChange:r});function r(l){if(!s)return;if(C=l,!E)o(C);else{const d=l,c=setInterval(()=>{(l!==C||!E)&&clearInterval(c),E||o(C)},100)}}async function a(){if(!s||!s.monaco)return;const l=s.monaco.Uri.parse("file:///main.tsx"),d=await s.monaco.languages.typescript.getTypeScriptWorker(),c=await(await d(l)).getSemanticDiagnostics("file:///main.tsx"),u=await(await d(l)).getCompilerOptionsDiagnostics("file:///main.tsx"),h=await(await d(l)).getSyntacticDiagnostics("file:///main.tsx");return[...c,...u,...h]}async function o(l){if(E===1)return;try{E=1;const d=await a(),c=B.getElementById("error");if(E=0,l!==C)return;if(d&&d.length){if(C!=l)return;if(N===l)return;B.getElementById("root").classList.add("transparent");const u=D(j,l,0);if(u.length<=3){s.monaco.editor.setTheme("hc-black");return}c.innerHTML=d[0].messageText.toString(),B.getElementById("root").style.setProperty("dispay","none"),c.style.display="block",N=l,s.monaco.editor.setTheme("vs-light"),setTimeout(()=>{s.monaco.editor.setTheme("hc-black")},_++);return}j=l,c.style.display="none",s.monaco.editor.setTheme("vs-dark"),B.getElementById("root").classList.remove("transparent"),_=0,E=0,n(e(l))}catch(d){if(E=0,l!==C)return;s.monaco.editor.setTheme("vs-light"),setTimeout(()=>{s.monaco.editor.setTheme("hc-black")},10),console.error(d)}}})(),n(e(t())),B.getElementById("root").setAttribute("style","display:block");async function n(i){const s=new Function("transpileCode",`return function(){ 
        ${i} 
    }`)();if(!U){const r=async o=>{if(o!==j)return;if(V===o)return;V=o;const l={codeTranspiled:i,code:j},d=JSON.stringify(l),c=new Request("https://code.zed.vision",{body:d,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),u=await fetch(c),{hash:h}=await u.json();try{const p=window.localStorage,g=p.getItem("codeBoXHash");g!==h&&(p.setItem("codeBoXHash",h),p.setItem(h,j),te("h",h))}catch(p){console.log("no localStorage")}},a=C;setTimeout(()=>r(C),500)}U=!1,s()}function t(){const i=new URLSearchParams(window.location.search),s=i.get("h")||localStorage.getItem("codeBoXHash");return s&&window.localStorage.getItem(s)||window.localStorage.getItem("STARTER")||q}function e(i){return window.Babel.transform(i,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(/import/gi,"///")}}function te(n,t){const e=new URLSearchParams(window.location.search);e.set(n,t),window.history.replaceState({},"",decodeURIComponent(`${window.location.pathname}?${e}`))}
