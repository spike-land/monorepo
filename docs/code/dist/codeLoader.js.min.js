const F=async n=>C.querySelector(`script[src="${n}"]`)||new Promise(function(e,t){const s=window.document.createElement("script");s.src=n,s.onload=e,s.onerror=t,window.document.head.appendChild(s)}),J=async()=>(await F("https://unpkg.com/jsframe.js@1.6.2/lib/jsframe.min.js"),new Promise(n=>{setTimeout(()=>{const e=window.JSFrame,t=new e({fixed:!1});t.create({name:"Win0",title:"Your page :)",left:(window.innerWidth-window.innerWidth*.7)/2,top:20,width:window.innerWidth*.7,height:320,appearanceName:"yosemite",html:`<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" /><div style="color:black; font-size:16px; overflow: hidden" class="window-content">
    <div id="root"></div>
</div>`}).show(),n()})})),$=async({onChange:n,code:e,language:t})=>{const s=window.document.getElementById("container");if(!s){const l=C.getElementById("container");l.id="container",C.body.appendChild(l)}const i=t==="typescript"?"file:///main.tsx":"file:///main.html";let c;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)){const l=window.document.createElement("div");l.id="ace",window.document.body.appendChild(l),await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"),t==="typescript"?await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js"):await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.min.js"),await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js"),window.document.getElementById("ace").style.setProperty("display","block"),s.style.setProperty("display","none"),c=window.ace.edit("ace"),c.getSession().setMode("ace/mode/typescript");const d=a=>setTimeout(()=>{let u=window.ace.edit("ace"),h=u.getTheme();h!=="ace/theme/monokai "&&(u.setOptions({fontSize:"14pt"}),u.setTheme("ace/theme/monokai"),d(2*a))},a);d(100),c.setValue(e),c.blur()}if(window.monaco===void 0){const l="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs",{require:d}=await A("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js");d.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs"}}),await new Promise(a=>d(["vs/editor/editor.main"],u=>{a(u)}))}const r=window.monaco,o={monaco:r,editor:r.editor.create(window.document.getElementById("container"),{formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;}",mouseWheelZoom:!1,wordWrapColumn:80,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",padding:{bottom:300},lineNumbers:"on",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:r.editor.getModel(i)||r.editor.createModel(e,t,r.Uri.parse(i)),value:e,language:t,theme:"vs-dark"})};if(o.editor.onDidChangeModelContent(()=>n(o.editor.getValue())),c&&c.session.on("change",function(){const l=c.getValue();o.editor.setValue(l),n(l)}),c&&C.getElementById("container").replaceWith(C.getElementById("ace")),o.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),t==="typescript"){const l=[{name:"react",url:"https://unpkg.com/@types/react@16.9.56/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@16.9.56/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@16.9.9/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@3.0.5/index.d.ts",depend:[]},{name:"@emotion/styled/base.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/styled/index.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/cache/index.d.ts",url:"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts",depend:["@emotion/utils"]},{name:"@emotion/react/index.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/index.d.ts",depend:["@emotion/cache"]},{name:"@emotion/react/jsx-namespace.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/jsx-namespace.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/css-prop.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/css-prop.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/helper.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/helper.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/theming.d.ts",url:"https://unpkg.com/@emotion/react@11.0.0/types/theming.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/serialize/index.d.ts",url:"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/utils/index.d.ts",url:"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts",depend:[]}],d=l.map(({name:a,url:u})=>(async()=>o.monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(u)).text(),a.includes("@emotion")?`file:///node_modules/${a}`:`file:///node_modules/@types/${a}/index.d.ts`))());return o.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:o.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:o.monaco.languages.typescript.ModuleResolutionKind.NodeJs,module:o.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:o.monaco.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",jsxFragmentFactory:"React.Fragment",esModuleInterop:!0}),await Promise.all(d),o.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),o}};function A(n){return new Promise(function(e,t){var s;s=window.document.createElement("script"),s.src=n,s.onload=()=>e(window),s.onerror=t,window.document.head.appendChild(s)})}const q=`import React from "react";
import ReactDOM from "react-dom";
/** @jsx jsx */
import styled from "@emotion/styled";

const Counter = () => {
  const [clicks, setClicks] = React.useState(0);

  return <Container>
    <Button css={\`background: green\`} onClick={() => setClicks(clicks - 1)}>
      -
    </Button>
    {clicks}
    <Button css={\`background: red\`} onClick={() => setClicks(clicks + 1)}>
      +
    </Button>
  </Container>;
};

const Container = styled.div\`
  margin: 2em;
  display: inline-block;
  min-width: 200px;
  background: white;
  border: 4px dotted red;
  border-radius: 30px;
  padding: 1rem;
\`;

const Button = styled.button\`
  text-align: center;
  display: inline-block;
  border-radius: 6px;
  padding: 0.5rem 0;
  margin: 0.5rem 2rem;
  width: 4rem;
  color: white;
  border: none;
  :focus{
    outline: none;
  }
  \`;

const elementToRender = document.getElementById("root");
ReactDOM.render(<Counter />, elementToRender);

`,E=-1;function I({text1:n,text2:e,cursorPos:t}){if(n===e)return n?[[0,n]]:[];if(t){const o=ee(n,e,t);if(o)return o}let s=R(n,e);const i=n.substring(0,s);n=n.substring(s),e=e.substring(s),s=T(n,e);const c=n.substring(n.length-s);n=n.substring(0,n.length-s),e=e.substring(0,e.length-s);const r=X(n,e);return i&&r.unshift([0,i]),c&&r.push([0,c]),z(r),r}function X(n,e){let t;if(!n)return[[1,e]];if(!e)return[[E,n]];const s=n.length>e.length?n:e,i=n.length>e.length?e:n,c=s.indexOf(i);if(c!==-1)return t=[[1,s.substring(0,c)],[0,i],[1,s.substring(c+i.length)]],n.length>e.length&&(t[0][0]=t[2][0]=E),t;if(i.length===1)return[[E,n],[1,e]];const r=G(n,e);if(r){const o=r[0]||"",l=r[1]||"",d=r[2]||"",a=r[3]||"",u=r[4]||"",h=I({text1:o,text2:d,cursorPos:0}),p=I({text1:l,text2:a,cursorPos:0});return h.concat([[0,u[1]]],p)}return Q(n,e)}function Q(n,e){const t=n.length,s=e.length,i=Math.ceil((t+s)/2),c=i,r=2*i,o=new Array(r),l=new Array(r);for(let f=0;f<r;f++)o[f]=-1,l[f]=-1;o[c+1]=0,l[c+1]=0;const d=t-s,a=d%2!==0;let u=0,h=0,p=0,g=0;for(let f=0;f<i;f++){for(let m=-f+u;m<=f-h;m+=2){const y=i+m;let w;m===-f||m!==f&&o[y-1]<o[y+1]?w=o[y+1]:w=o[y-1]+1;let k=w-m;for(;w<t&&k<s&&n.charAt(w)===e.charAt(k);)w++,k++;if(o[y]=w,w>t)h+=2;else if(k>s)u+=2;else if(a){const S=i+d-m;if(S>=0&&S<r&&l[S]!==-1){const M=t-l[S];if(w>=M)return W(n,e,w,k)}}}let b;for(let m=-f+p;m<=f-g;m+=2){const y=i+m;m===-f||m!==f&&l[y-1]<l[y+1]?b=l[y+1]:b=l[y-1]+1;let w=b-m;for(;b<t&&w<s&&n.charAt(t-b-1)===e.charAt(s-w-1);)b++,w++;if(l[y]=b,b>t)g+=2;else if(w>s)p+=2;else if(!a){const k=i+d-m;if(k>=0&&k<r&&o[k]!==-1){const S=o[k],M=i+S-k;if(b=t-b,S>=b)return W(n,e,S,M)}}}}return[[E,n],[1,e]]}function W(n,e,t,s){const i=n.substring(0,t),c=e.substring(0,s),r=n.substring(t),o=e.substring(s),l=I({text1:i,text2:c,cursorPos:0}),d=I({text1:r,text2:o,cursorPos:0});return l.concat(d)}function R(n,e){if(!n||!e||n.charAt(0)!==e.charAt(0))return 0;let t=0,s=Math.min(n.length,e.length),i=s,c=0;for(;t<i;)n.substring(c,i)==e.substring(c,i)?(t=i,c=t):s=i,i=Math.floor((s-t)/2+t);return O(n.charCodeAt(i-1))&&i--,i}function T(n,e){if(!n||!e||n.slice(-1)!==e.slice(-1))return 0;let t=0,s=Math.min(n.length,e.length),i=s,c=0;for(;t<i;)n.substring(n.length-i,n.length-c)==e.substring(e.length-i,e.length-c)?(t=i,c=t):s=i,i=Math.floor((s-t)/2+t);return N(n.charCodeAt(n.length-i))&&i--,i}function G(n,e){const t=n.length>e.length?n:e,s=n.length>e.length?e:n;if(t.length<4||s.length*2<t.length)return null;function i(p,g,f){const b=p.substring(f,f+Math.floor(p.length/4));let m=-1,y="",w,k,S,M;for(;(m=g.indexOf(b,m+1))!==-1;){const L=R(p.substring(f),g.substring(m)),D=T(p.substring(0,f),g.substring(0,m));y.length<D+L&&(y=g.substring(m-D,m)+g.substring(m,m+L),w=p.substring(0,f-D),k=p.substring(f+L),S=g.substring(0,m-D),M=g.substring(m+L))}return y.length*2>=p.length?[w,k,S,M,y]:null}const c=i(t,s,Math.ceil(t.length/4)),r=i(t,s,Math.ceil(t.length/2));let o;if(r===null&&c===null)return null;if(r===null){if(c===null)return null;o=c}else if(c===null){if(r===null)return null;o=r}else o=c[4].length>r[4].length?c:r;let l,d,a,u;n.length>e.length?(l=o[0],d=o[1],a=o[2],u=o[3]):(a=o[0],u=o[1],l=o[2],d=o[3]);const h=o[4];return[l,d,a,u,h]}function z(n){const e=[...n];e.push([0,""]);let t=0,s=0,i=0,c="",r="",o,l;for(;t<e.length;){if(t<e.length-1&&!e[t][1]){e.splice(t,1);continue}switch(e[t][0]){case 1:i++,r+=e[t][1],t++;break;case E:s++,c+=e[t][1],t++;break;case 0:if(l=t-i-s-1,t<e.length-1&&!e[t][1]){e.splice(t,1);break}if(c.length>0||r.length>0){c.length>0&&r.length>0&&(o=R(r,c),o!==0&&(l>=0?e[l][1]+=r.substring(0,o):(e.splice(0,0,[0,r.substring(0,o)]),t++),r=r.substring(o),c=c.substring(o)),o=T(r,c),o!==0&&(e[t][1]=r.substring(r.length-o)+e[t][1],r=r.substring(0,r.length-o),c=c.substring(0,c.length-o)));const a=i+s;c.length===0&&r.length===0?(e.splice(t-a,a),t=t-a):c.length===0?(e.splice(t-a,a,[1,r]),t=t-a+1):r.length===0?(e.splice(t-a,a,[E,c]),t=t-a+1):(e.splice(t-a,a,[E,c],[1,r]),t=t-a+2)}t!==0&&e[t-1][0]===0?(e[t-1][1]+=e[t][1],e.splice(t,1)):t++,i=0,s=0,c="",r="";break}}e[e.length-1][1]===""&&e.pop();let d=!1;for(t=1;t<e.length-1;)e[t-1][0]===0&&e[t+1][0]===0&&(e[t][1].substring(e[t][1].length-e[t-1][1].length)===e[t-1][1]?(e[t][1]=e[t-1][1]+e[t][1].substring(0,e[t][1].length-e[t-1][1].length),e[t+1][1]=e[t-1][1]+e[t+1][1],e.splice(t-1,1),d=!0):e[t][1].substring(0,e[t+1][1].length)==e[t+1][1]&&(e[t-1][1]+=e[t+1][1],e[t][1]=e[t][1].substring(e[t+1][1].length)+e[t+1][1],e.splice(t+1,1),d=!0)),t++;return d?z(e):e}function O(n){return n>=55296&&n<=56319}function N(n){return n>=56320&&n<=57343}function K(n){return N(n.charCodeAt(0))}function Y(n){return O(n.charCodeAt(n.length-1))}function Z(n){const e=[];for(let t=0;t<n.length;t++)n[t][1].length>0&&e.push(n[t]);return e}function x(n,e,t,s){return Y(n)||K(s)?null:Z([[0,n],[E,e],[1,t],[0,s]])}function ee(n,e,t){const s=typeof t=="number"?{index:t,length:0}:t.oldRange,i=typeof t=="number"?null:t.newRange,c=n.length,r=e.length;if(s.length===0&&(i===null||i.length===0)){const o=s.index,l=n.slice(0,o),d=n.slice(o),a=i?i.index:null;e:{const u=o+r-c;if(a!==null&&a!==u)break e;if(u<0||u>r)break e;const h=e.slice(0,u),p=e.slice(u);if(p!==d)break e;const g=Math.min(o,u),f=l.slice(0,g),b=h.slice(0,g);if(f!==b)break e;const m=l.slice(g),y=h.slice(g);return x(f,m,y,d)}e:{if(a!==null&&a!==o)break e;const u=o,h=e.slice(0,o),p=e.slice(o);if(h!==l)break e;const g=Math.min(c-o,r-o),f=d.slice(d.length-g),b=p.slice(p.length-g);if(f!==b)break e;const m=d.slice(0,d.length-g),y=p.slice(0,p.length-g);return x(l,m,y,f)}}if(s.length>0&&i&&i.length===0){e:{const o=n.slice(0,s.index),l=n.slice(s.index+s.length),d=o.length,a=l.length;if(r<d+a)break e;const u=e.slice(0,d),h=e.slice(r-a);if(o!==u||l!==h)break e;const p=n.slice(d,c-a),g=e.slice(d,r-a);return x(o,p,g,l)}}return null}function P(n,e,t){return I({text1:n,text2:e,cursorPos:t})}P.INSERT=1,P.DELETE=E,P.EQUAL=0;const C=window.document;let U=!0,B=0,H=0,v="",_="",V="",j="";export async function run(){await J(),await F("https://unpkg.com/@babel/standalone@7.12.6/babel.min.js"),(async()=>{const s=e();j=s;const i=await $({language:"typescript",code:s,onChange:c});function c(l){if(!i)return;if(v=l,!B)o(v);else{const d=l,a=setInterval(()=>{(l!==v||!B)&&clearInterval(a),B||o(v)},100)}}async function r(){if(!i||!i.monaco)return;const l=i.monaco.Uri.parse("file:///main.tsx"),d=await i.monaco.languages.typescript.getTypeScriptWorker(),a=await(await d(l)).getSemanticDiagnostics("file:///main.tsx"),u=await(await d(l)).getCompilerOptionsDiagnostics("file:///main.tsx"),h=await(await d(l)).getSyntacticDiagnostics("file:///main.tsx");return[...a,...u,...h]}async function o(l){if(B===1)return;try{B=1;const d=await r(),a=C.getElementById("error");if(B=0,l!==v)return;if(d&&d.length){if(v!=l)return;if(_===l)return;C.getElementById("root").classList.add("transparent");const u=P(j,l,0);if(u.length<=3){i.monaco.editor.setTheme("hc-black");return}a.innerHTML=d[0].messageText.toString(),C.getElementById("root").style.setProperty("dispay","none"),a.style.display="block",_=l,i.monaco.editor.setTheme("vs-light"),setTimeout(()=>{i.monaco.editor.setTheme("hc-black")},H++);return}j=l,a.style.display="none",i.monaco.editor.setTheme("vs-dark"),C.getElementById("root").classList.remove("transparent"),H=0,B=0,n(t(l))}catch(d){if(B=0,l!==v)return;i.monaco.editor.setTheme("vs-light"),setTimeout(()=>{i.monaco.editor.setTheme("hc-black")},10),console.error(d)}}})(),n(t(e())),C.getElementById("root").setAttribute("style","display:block");async function n(s){const i=new Function("transpileCode",`return function(){ 
        ${s} 
    }`)();if(!U){const c=async o=>{if(o!==j)return;if(V===o)return;V=o;const l={codeTranspiled:s,code:j},d=JSON.stringify(l),a=new Request("https://code.zed.vision",{body:d,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),u=await fetch(a),{hash:h}=await u.json();try{const p=window.localStorage,g=p.getItem("codeBoXHash");g!==h&&(p.setItem("codeBoXHash",h),p.setItem(h,j),te("h",h))}catch(p){console.log("no localStorage")}},r=v;setTimeout(()=>c(v),500)}U=!1,i()}function e(){const s=new URLSearchParams(window.location.search),i=s.get("h")||localStorage.getItem("codeBoXHash");return i&&window.localStorage.getItem(i)||window.localStorage.getItem("STARTER")||q}function t(s){return window.Babel.transform(s,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code.replace(/import/gi,"///")}}function te(n,e){const t=new URLSearchParams(window.location.search);t.set(n,e),window.history.replaceState({},"",decodeURIComponent(`${window.location.pathname}?${t}`))}
