import t from"https://unpkg.com/@zedvision/smart-monaco-editor@10.11.4/dist/smart-monaco-editor.modern.js";import{diff as e}from"https://unpkg.com/@zedvision/diff@8.6.10/dist/diff.min.js";import n from"https://unpkg.com/prettier@2.2.1/esm/standalone.mjs";import r from"https://unpkg.com/prettier@2.2.1/esm/parser-babel.mjs";import a from"https://unpkg.com/prettier@2.2.1/esm/parser-html.mjs";import{getDB as o}from"https://unpkg.com/@zedvision/shadb@8.7.2/dist/shaDB.js";import i from"https://unpkg.com/uuid@8.3.2/dist/esm-browser/v4.js";import{wrap as s}from"https://unpkg.com/comlink/dist/esm/comlink.mjs";let c,d,l=t=>t;const p=async(...t)=>(d=d||await o(),d.get(...t)),u=async(...t)=>(d=d||await o(),d.put(...t)),m=async t=>Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256","string"==typeof t?(new TextEncoder).encode(t):t)).slice(0,4)).map(t=>("00"+t.toString(16)).slice(-2)).join("");var w={__proto__:null,sha256:m};const g=async()=>{const t=await async function(){const t=await p("uuid");if(!t){const t=await fetch("https://code.zed.vision/register"),e=await t.json();return await u("uuid",e.uuid),e.uuid}return t}(),e=await p(t,"json");if("string"==typeof e||null===e||!e.list){const e=i();return await u(t,JSON.stringify({list:[e],[e]:{created:Date.now(),lastOpen:Date.now()}})),[e]}return e.list},h=async t=>{const e=await m(t),n=(await g())[0];try{await p(n)!==e&&(await u(e,t),await u(n,e))}catch(t){console.error(t)}},f='import { useState } from "react";\nimport { css, Global } from "@zedvision/emotion-react";\n\nconst Slider = () => {\n  const steps = 128;\n  const [sliderValue, setSlider] = useState(steps / 2);\n  return <>\n    <input max={steps}\n      css={`\n        appearance: none;\n        width: 100%;\n        height: 40px; \n        background: rgb(${255 / steps * sliderValue} ${255 / steps * (steps - sliderValue)} 0); \n        outline: none; \n    `} type="range"\n      aria-label="font size changer"\n      value={sliderValue}\n      step="1"\n      onChangeCapture={(e) => setSlider(Number(e.currentTarget.value))}>\n    </input>\n    <p\n      css={css`\n        font-size: ${72 / steps * sliderValue}px\n        `}>\n      Example when the text gets bigger...\n    </p>\n    <p css={css`\n        font-size: ${72 / steps * (steps - sliderValue)}px\n        `}>\n      ...or smaller\n    </p>\n  </>\n}\n\nexport default () => <>\n  <Global styles={css`\n      body{\n          margin: 0;\n          overflow: overlay;\n        }  \n    `} />\n  <Slider />\n</>\n';let y,b;async function x(t,e){return y=y||await k(),await y(t,e)}function k(){const t=new Worker("./src/transpile.worker.js");return y=s(t),y}function v(){const t=new Worker("./src/ipfsKV.worker.js");return b=s(t),b}async function j(t,e){return`https://ipfs.io/ipfs/${await(async t=>(b||await v()).add(t))(URL.createObjectURL(new Blob([t],{type:e})))}`}function S(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}k(),v();const T={hydrated:!1,preRendered:!1,lastErrors:0,HTML:"",ipfs:0,transpiled:"",code:""};function E(t){try{return n.format(t,{arrowParens:"always",bracketSpacing:!0,embeddedLanguageFormatting:"auto",htmlWhitespaceSensitivity:"css",insertPragma:!1,jsxBracketSameLine:!0,jsxSingleQuote:!1,printWidth:80,proseWrap:"preserve",quoteProps:"as-needed",requirePragma:!1,semi:!0,singleQuote:!0,tabWidth:2,trailingComma:"all",useTabs:!1,parser:"babel-ts",plugins:[r,a]})}catch(e){return t}}async function L(n="window",{React:r,ReactDOM:a}){if(console.log("Runnnner"),T.code=E(await async function(){const t=(await g())[0],e=new URLSearchParams(window.location.search).get("h")||await p(t);if(e){let n,r;try{n=await p(e)}catch(t){console.error("error load key: "+e)}if(n)return n;try{const t=await fetch("https://code.zed.vision/?h="+e);r=await t.json()}catch(e){const{sha256:n}=await Promise.resolve().then(function(){return w}),r=await n(f);return u(r,f),await u(t,r),f}return r}return f}()),T.transpiled=await x(T.code),"editor"===n){const{renderDraggableEditor:t}=await import("./DraggableEditor-cc43fb2e.js");await t()}if("window"===n){const t=async()=>{const t=await(async({code:t,HTML:e})=>{const n=S(t),r=(await import(n),Array.from(window.document.querySelector("head > style[data-emotion=css]").sheet.cssRules).map(t=>t.cssText).filter(t=>e.includes(t.substring(3,8))).join("\n  ")),{getHtml:a,getCodeForImport:o}=await import("./templates-8cd1ae36.js"),i=await j(t,"application/html");var s;return console.log({HTML:e,linkToCode:i,css:r,code:t}),await(s=a({HTML:e,css:r,js:o(i)}),j(s,"text/html"))})({code:T.transpiled,HTML:T.HTML});window.open(t)};await(async({onShare:t})=>{const{css:e,jsx:n}=await import("https://cdn.skypack.dev/@emotion/react@11.1.1");ReactDDOM.render(n(function({onShare:t}){return n("div",null,n("div",{css:e(c||(c=l`
            background: red;
            border: 4px solid red;
            border-radius: 8px;
          `)),animate:{scale:1,top:1,left:600},dragElastic:.5,dragMomentum:!1,initial:{top:1,left:0,scale:.7},transition:{duration:.5},drag:!0,dragConstraints:{left:200-window.innerWidth,right:0,bottom:window.innerHeight-200,top:0}},n("div",{css:"\n      display: block;\n      with: 100%;\n      text-align: right;\n      background: linear-gradient(0deg, darkred, red);\n    "},n("button",{css:"\n              background: darkred;\n              margin-top: -4px;\n              margin-right: -4px;\n              color: white;\n              cursor: pointer;\n              font-weight: bold;\n              font-family: Roboto;\n              padding: 8px 16px;\n              outline: none;\n              border: none;\n              border-radius: 0px 8px 0px 0px;\n            ",onClick:()=>t()},"ðŸŒŽ SHARE")),n("div",{css:"\n      min-width: 200px;\n      padding: 30px;\n      max-width: 600px;\n      background: white;\n      max-height: 800px;\n      border-radius: 0px 0px 8px 8px;\n      overflow-y: overlay;\n    ",id:"zbody"})),null)},{onShare:t}),window.document.getElementById("dragabbleWindow"))})({ReactDOM:a,React:r,onShare:t})}s(await x(T.code));const o=await t({language:"typescript",code:E(T.code),onChange:t=>async function(t){try{const t=await x(cd,T.lastErrors);if(T.transpiled===t)return;let n=!1;t.length&&0===T.lastErrors&&(n=s(t));const r=[...n?[{messageText:"Error while starting the app. Check the console!"}]:[],...await i(cd)];T.lastErrors&&0===r.length&&s(t),T.lastErrors=r.length;const a=window.document.getElementById("error");if(0!==r.length||!t.length){T.error=cd;const t=await e(T.code,cd);return t.c.length<=3?void(T.lastErrors=0):4==t.c.length?(T.lastErrors=0,void o.monaco.editor.setTheme("hc-black")):(a.innerHTML=r[0].messageText.toString(),void(a.style.display="block"))}T.code=cd,T.transpiled!==t&&(T.transpiled=t,await h(E(cd))),await h(cd),a.style.display="none",o.monaco.editor.setTheme("vs-dark")}catch(t){o.monaco.editor.setTheme("vs-light"),setTimeout(()=>{o.monaco.editor.setTheme("hc-black")},50),console.error(t)}}(E(t))});async function i(t){if(!o||!o.monaco)return;const{monaco:e}=o,{sha256:n}=await Promise.resolve().then(function(){return w}),r=`file:///${await n(t)}.tsx`,a=e.Uri.parse(r),i=e.editor.getModel(a)||await e.editor.createModel(t,"typescript",a),s=await e.languages.typescript.getTypeScriptWorker(),c=await s(i.uri),d=c.getSemanticDiagnostics(r),l=c.getCompilerOptionsDiagnostics(r),p=c.getSyntacticDiagnostics(r),u=await Promise.race([d,l,p]);return i.dispose(),[...u]}async function s(t){if("string"!=typeof t||""===t)return 1;const e="window"===n?t.replace("body{","#zbody{"):t,r=window.document.getElementById("zbody").children[0]||document.getElementById("zbody").appendChild(document.createElement("div")),o=(await import(S(e))).default;return a.render(o(),r),T.HTML=r.innerHTML,!T.preRendered}}export{L as run};
//# sourceMappingURL=codeLoader.min.modern.js.map
