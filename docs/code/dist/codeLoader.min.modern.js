import{diff as e}from"https://unpkg.com/@zedvision/diff@8.6.10/dist/diff.min.js";import t from"https://unpkg.com/prettier@2.2.1/esm/standalone.mjs";import n from"https://unpkg.com/prettier@2.2.1/esm/parser-babel.mjs";import o from"https://unpkg.com/prettier@2.2.1/esm/parser-html.mjs";import a from"https://unpkg.com/react-dom@17.0.1/index.js";import i from"https://unpkg.com/react@17.0.1/cjs/react.production.min.js";import{jsx as s,css as r}from"https://unpkg.com/@emotion/react";import{motion as c}from"https://unpkg.com/framer-motion";import{getDB as d}from"https://unpkg.com/@zedvision/shadb@8.7.2/dist/shaDB.js";import p from"https://unpkg.com/uuid@8.3.2/dist/esm-browser/v4.js";import{wrap as l}from"https://unpkg.com/comlink/dist/esm/comlink.mjs";function m(){return(m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}const u=(e,t=[])=>{if("https://"===e.slice(0,8))return window.document.head.querySelector(`script[src="${e}"]`)||new Promise(function(n,o){const a=window.document.createElement("script");a.src=e,a.type="application/javascript",a.onload=()=>{0===t.length&&n(window);const e={};t.forEach(t=>Object.assign(e,window[t])),n(e)},a.onerror=o,window.document.head.appendChild(a)})};let g,h=e=>e;const w=({onShare:e})=>s(i.Fragment,null,s(c.div,{css:r(g||(g=h`
            background: red;
            border: 4px solid red;
            border-radius: 8px;
          `)),animate:{scale:1,top:1,left:600},dragElastic:.5,dragMomentum:!1,initial:{top:1,left:0,scale:.7},transition:{duration:.5},drag:!0,dragConstraints:{left:200-window.innerWidth,right:0,bottom:window.innerHeight-200,top:0}},s("div",{css:"\n      display: block;\n      with: 100%;\n      text-align: right;\n      background: linear-gradient(0deg, darkred, red);\n    "},s("button",{css:"\n              background: darkred;\n              margin-top: -4px;\n              margin-right: -4px;\n              color: white;\n              cursor: pointer;\n              font-weight: bold;\n              font-family: Roboto;\n              padding: 8px 16px;\n              outline: none;\n              border: none;\n              border-radius: 0px 8px 0px 0px;\n            ",onClick:()=>e()},"ðŸŒŽ SHARE")),s("div",{css:"\n      min-width: 200px;\n      padding: 30px;\n      max-width: 600px;\n      background: white;\n      max-height: 800px;\n      border-radius: 0px 0px 8px 8px;\n      overflow-y: overlay;\n    ",id:"zbody"})));let y;const f=async(...e)=>(y=y||await d(),y.get(...e)),b=async(...e)=>(y=y||await d(),y.put(...e)),x=async e=>Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256","string"==typeof e?(new TextEncoder).encode(e):e)).slice(0,4)).map(e=>("00"+e.toString(16)).slice(-2)).join("");var k={__proto__:null,sha256:x};const j=async()=>{const e=await async function(){const e=await f("uuid");if(!e){const e=await fetch("https://code.zed.vision/register"),t=await e.json();return await b("uuid",t.uuid),t.uuid}return e}(),t=await f(e,"json");if("string"==typeof t||null===t||!t.list){const t=p();return await b(e,JSON.stringify({list:[t],[t]:{created:Date.now(),lastOpen:Date.now()}})),[t]}return t.list},v=async e=>{const t=await x(e),n=(await j())[0];try{await f(n)!==t&&(await b(t,e),await b(n,t))}catch(e){console.error(e)}},S='import { useState } from "react";\nimport { css, Global } from "@zedvision/emotion-react";\n\nconst Slider = () => {\n  const steps = 128;\n  const [sliderValue, setSlider] = useState(steps / 2);\n  return <>\n    <input max={steps}\n      css={`\n        appearance: none;\n        width: 100%;\n        height: 40px; \n        background: rgb(${255 / steps * sliderValue} ${255 / steps * (steps - sliderValue)} 0); \n        outline: none; \n    `} type="range"\n      aria-label="font size changer"\n      value={sliderValue}\n      step="1"\n      onChangeCapture={(e) => setSlider(Number(e.currentTarget.value))}>\n    </input>\n    <p\n      css={css`\n        font-size: ${72 / steps * sliderValue}px\n        `}>\n      Example when the text gets bigger...\n    </p>\n    <p css={css`\n        font-size: ${72 / steps * (steps - sliderValue)}px\n        `}>\n      ...or smaller\n    </p>\n  </>\n}\n\nexport default () => <>\n  <Global styles={css`\n      body{\n          margin: 0;\n          overflow: overlay;\n        }  \n    `} />\n  <Slider />\n</>\n';let E,T;async function M(e,t){return E=E||await C(),await E(e,t)}function C(){const e=new Worker("./src/transpile.worker.js");return E=l(e),E}function L(){const e=new Worker("./src/ipfsKV.worker.js");return T=l(e),T}async function z(e,t){return`https://ipfs.io/ipfs/${await(async e=>(T||await L()).add(e))(URL.createObjectURL(new Blob([e],{type:t})))}`}function O(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}C(),L();const D={hydrated:!1,preRendered:!1,lastErrors:0,HTML:"",ipfs:0,transpiled:"",code:""};function P(e){try{return t.format(e,{arrowParens:"always",bracketSpacing:!0,embeddedLanguageFormatting:"auto",htmlWhitespaceSensitivity:"css",insertPragma:!1,jsxBracketSameLine:!0,jsxSingleQuote:!1,printWidth:80,proseWrap:"preserve",quoteProps:"as-needed",requirePragma:!1,semi:!0,singleQuote:!0,tabWidth:2,trailingComma:"all",useTabs:!1,parser:"babel-ts",plugins:[n,o]})}catch(t){return e}}async function V(t="window"){if(D.code=P(await async function(){const e=(await j())[0],t=new URLSearchParams(window.location.search).get("h")||await f(e);if(t){let n,o;try{n=await f(t)}catch(e){console.error("error load key: "+t)}if(n)return n;try{const e=await fetch("https://code.zed.vision/?h="+t);o=await e.json()}catch(t){const{sha256:n}=await Promise.resolve().then(function(){return k}),o=await n(S);return b(o,S),await b(e,o),S}return o}return S}()),D.transpiled=await M(D.code),"editor"===t){const{renderDraggableEditor:e}=await import("./DraggableEditor-34d91b86.js");await e()}"window"===t&&a.render(s(w,{onShare:async()=>{const e=await(async({code:e,HTML:t})=>{const n=O(e),o=(await import(n),Array.from(window.document.querySelector("head > style[data-emotion=css]").sheet.cssRules).map(e=>e.cssText).filter(e=>t.includes(e.substring(3,8))).join("\n  ")),{getHtml:a,getCodeForImport:i}=await import("./templates-0c9137b1.js"),s=await z(e,"application/html");var r;return console.log({HTML:t,linkToCode:s,css:o,code:e}),await(r=a({HTML:t,css:o,js:i(s)}),z(r,"text/html"))})({code:D.transpiled,HTML:D.HTML});window.open(e)}}),window.document.getElementById("dragabbleWindow")),i(await M(D.code));const n=await(async({onChange:e,code:t,language:n,options:o})=>{const{document:a}=window;let i=a.getElementById("container");i||(i=a.createElement("container"),i.id="container",a.body.appendChild(i));const s="typescript"===n?"file:///main.tsx":"file:///main.html";if("undefined"!=typeof window&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)){const e=window.document.createElement("div");e.id="ace",window.document.body.appendChild(e),await u("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"),"typescript"===n?await u("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js"):await u("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.min.js"),await u("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js"),window.document.getElementById("ace").style.setProperty("display","block"),i.style.setProperty("display","none");const o=window.ace.edit("ace");o.getSession().setMode("ace/mode/typescript");const a=e=>setTimeout(()=>{const t=ace.edit("ace");"ace/theme/monokai "!==t.getTheme()&&(t.setOptions({fontSize:"14pt"}),t.setTheme("ace/theme/monokai"),a(2*e))},e);a(100),o.setValue(t),o.blur()}const r=await(async()=>{const{require:e}=await u("https://unpkg.com/monaco-editor@0.21.2/min/vs/loader.js");return e.config({paths:{vs:"https://unpkg.com/monaco-editor@0.21.2/min/vs"}}),await new Promise(t=>e(["vs/editor/editor.main"],e=>t(e)))})();let c;try{c=r.editor.getModel(s),c.getValue()!==t&&c.setValue(t)}catch(e){c=await r.editor.createModel(t,n,r.Uri.parse(s))}const d={monaco:r,editor:r.editor.create(window.document.getElementById("container"),m({formatOnType:!1,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,glyphMargin:!1,wordWrap:"off",mouseWheelZoom:!1,wordWrapColumn:80,useTabStops:!1,dragAndDrop:!1,disableLayerHinting:!0,formatOnPaste:!1,disableMonospaceOptimizations:!0,showUnused:!0,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"full",accessibilitySupport:"off",autoClosingQuotes:"beforeWhitespace",padding:{bottom:300},lineNumbers:"on",autoClosingBrackets:"beforeWhitespace",autoClosingOvertype:"auto",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!1,codeActionsOnSaveTimeout:100,model:c,value:t,language:n,theme:"vs-dark"},o))};if(d.editor.onDidChangeModelContent(()=>e(d.editor.getValue())),aceEditor&&aceEditor.session.on("change",function(){const t=aceEditor.getValue();d.editor.setValue(t),e(t)}),aceEditor&&a.getElementById("container").replaceWith(a.getElementById("ace")),d.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),"typescript"===n){const e=[{name:"react",url:"https://unpkg.com/@types/react@17.0.0/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@17.0.0/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@17.0.0/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@3.0.5/index.d.ts",depend:[]},{name:"@emotion/styled/base.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/styled/index.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/cache/index.d.ts",url:"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts",depend:["@emotion/utils"]},{name:"@emotion/react/index.d.ts",url:"https://unpkg.com/@emotion/react@11.1.3/types/index.d.ts",depend:["@emotion/cache"]},{name:"@emotion/react/jsx-namespace.d.ts",url:"https://unpkg.com/@emotion/react@11.1.3/types/jsx-namespace.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/css-prop.d.ts",url:"https://unpkg.com/@emotion/react@11.1.3/types/css-prop.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/helper.d.ts",url:"https://unpkg.com/@emotion/react@11.1.3/types/helper.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/theming.d.ts",url:"https://unpkg.com/@emotion/react@11.1.3/types/theming.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/serialize/index.d.ts",url:"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/utils/index.d.ts",url:"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts",depend:[]},{name:"framer-motion",url:"https://unpkg.com/framer-motion@3.1.1/dist/framer-motion.d.ts",depend:[]},{name:"popmotion",url:"https://unpkg.com/popmotion@9.0.2/lib/index.d.ts"},{name:"@zedvision/qrious/index.d.ts",url:"https://unpkg.com/@zedvision/qrious@8.5.7/dist/qrious.d.ts"}].map(({name:e,url:t})=>(async()=>d.monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(t)).text(),e.includes("@")?`file:///node_modules/${e}`:`file:///node_modules/@types/${e}/index.d.ts`))());return d.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:d.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:d.monaco.languages.typescript.ModuleResolutionKind.Nodejs,module:d.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:"react-jsx",esModuleInterop:!0}),await Promise.all(e),d.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),d}})({language:"typescript",code:P(D.code),onChange:t=>async function(t){try{const a=await M(t,D.lastErrors);if(D.transpiled===a)return;let s=!1;a.length&&0===D.lastErrors&&(s=i(a));const r=[...s?[{messageText:"Error while starting the app. Check the console!"}]:[],...await o(t)];D.lastErrors&&0===r.length&&i(a),D.lastErrors=r.length;const c=window.document.getElementById("error");if(0!==r.length||!a.length){D.error=t;const o=await e(D.code,t);return o.c.length<=3?void(D.lastErrors=0):4==o.c.length?(D.lastErrors=0,void n.monaco.editor.setTheme("hc-black")):(c.innerHTML=r[0].messageText.toString(),void(c.style.display="block"))}D.code=t,D.transpiled!==a&&(D.transpiled=a,await v(P(t))),await v(t),c.style.display="none",n.monaco.editor.setTheme("vs-dark")}catch(e){n.monaco.editor.setTheme("vs-light"),setTimeout(()=>{n.monaco.editor.setTheme("hc-black")},50),console.error(e)}}(P(t))});async function o(e){if(!n||!n.monaco)return;const{monaco:t}=n,{sha256:o}=await Promise.resolve().then(function(){return k}),a=`file:///${await o(e)}.tsx`,i=t.Uri.parse(a),s=t.editor.getModel(i)||await t.editor.createModel(e,"typescript",i),r=await t.languages.typescript.getTypeScriptWorker(),c=await r(s.uri),d=c.getSemanticDiagnostics(a),p=c.getCompilerOptionsDiagnostics(a),l=c.getSyntacticDiagnostics(a),m=await Promise.race([d,p,l]);return s.dispose(),[...m]}async function i(e){if("string"!=typeof e||""===e)return 1;const n="window"===t?e.replace("body{","#zbody{"):e,o=window.document.getElementById("zbody"),i=(await import(O(n))).default;return a.render(i(),o),D.HTML=o.innerHTML,!D.preRendered}}export{V as run};
//# sourceMappingURL=codeLoader.min.modern.js.map
