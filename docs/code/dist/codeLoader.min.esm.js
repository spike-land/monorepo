import e from"https://unpkg.com/@zedvision/smart-monaco-editor@10.11.4/dist/smart-monaco-editor.modern.js";import{diff as r}from"https://unpkg.com/@zedvision/diff@8.6.10/dist/diff.min.js";import t from"https://unpkg.com/prettier@2.2.1/esm/standalone.mjs";import n from"https://unpkg.com/prettier@2.2.1/esm/parser-babel.mjs";import o from"https://unpkg.com/prettier@2.2.1/esm/parser-html.mjs";import{getDB as i}from"https://unpkg.com/@zedvision/shadb@8.7.2/dist/shaDB.js";import s from"https://unpkg.com/uuid@8.3.2/dist/esm-browser/v4.js";import{wrap as c}from"https://unpkg.com/comlink/dist/esm/comlink.mjs";function u(){var e,r,t=(e=["\n            background: red;\n            border: 4px solid red;\n            border-radius: 8px;\n          "],r||(r=e.slice(0)),e.raw=r,e);return u=function(){return t},t}var a,l,m,d=function(){try{var e=arguments,r=function(r){var t;return(t=a=r).get.apply(t,[].slice.call(e))},t=a;return Promise.resolve(t?r(t):Promise.resolve(i()).then(r))}catch(e){return Promise.reject(e)}},h=function(){try{var e=arguments,r=function(r){var t;return(t=a=r).put.apply(t,[].slice.call(e))},t=a;return Promise.resolve(t?r(t):Promise.resolve(i()).then(r))}catch(e){return Promise.reject(e)}},f=function(e){try{return Promise.resolve(crypto.subtle.digest("SHA-256","string"==typeof e?(new TextEncoder).encode(e):e)).then(function(e){return Array.from(new Uint8Array(e).slice(0,4)).map(function(e){return("00"+e.toString(16)).slice(-2)}).join("")})}catch(e){return Promise.reject(e)}},p={__proto__:null,sha256:f},v=function(e){try{return Promise.resolve(f(e)).then(function(r){return Promise.resolve(function(){try{return Promise.resolve(function(){try{return Promise.resolve(d("uuid")).then(function(e){var r,t=function(){if(!e)return Promise.resolve(fetch("https://code.zed.vision/register")).then(function(e){return Promise.resolve(e.json()).then(function(e){return Promise.resolve(h("uuid",e.uuid)).then(function(){return r=1,e.uuid})})})}();return t&&t.then?t.then(function(t){return r?t:e}):r?t:e})}catch(e){return Promise.reject(e)}}()).then(function(e){return Promise.resolve(d(e,"json")).then(function(r){var t;function n(e){return t?e:r.list}var o=function(){if("string"==typeof r||null===r||!r.list){var n,o=s();return Promise.resolve(h(e,JSON.stringify((n={list:[o]},n[o]={created:Date.now(),lastOpen:Date.now()},n)))).then(function(){return t=1,[o]})}}();return o&&o.then?o.then(n):n(o)})})}catch(e){return Promise.reject(e)}}()).then(function(t){var n=t[0],o=function(t,o){try{var i=Promise.resolve(d(n)).then(function(t){var o=function(){if(t!==r)return Promise.resolve(h(r,e)).then(function(){return Promise.resolve(h(n,r)).then(function(){})})}();if(o&&o.then)return o.then(function(){})})}catch(e){return o(e)}return i&&i.then?i.then(void 0,o):i}(0,function(e){console.error(e)});if(o&&o.then)return o.then(function(){})})})}catch(e){return Promise.reject(e)}},g=function(e,r){try{var t=function(t){return l=t,Promise.resolve(l(e,r))};return Promise.resolve(l?t(l):Promise.resolve(P()).then(t))}catch(e){return Promise.reject(e)}};function P(){var e=new Worker("./src/transpile.worker.js");return l=c(e)}function y(){var e=new Worker("./src/ipfsKV.worker.js");return m=c(e)}P(),y();var w=function(e,r){try{return Promise.resolve(function(e){try{var r=function(r){return r.add(e)};return Promise.resolve(m?r(m):Promise.resolve(y()).then(r))}catch(e){return Promise.reject(e)}}(URL.createObjectURL(new Blob([e],{type:r})))).then(function(e){return"https://ipfs.io/ipfs/"+e})}catch(e){return Promise.reject(e)}};function b(e){var r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}var j=function(t,n){void 0===t&&(t="window");var o=n.React,i=n.ReactDOM;try{return console.log("Runnnner"),Promise.resolve(getCodeToLoad()).then(function(n){return k.code=x(n),Promise.resolve(g(k.code)).then(function(n){function s(){function n(){return Promise.resolve(g(k.code)).then(function(n){var o=function(e){try{if("string"!=typeof e||""===e)return Promise.resolve(1);var r="window"===t?e.replace("body{","#zbody{"):e,n=window.document.createElement("div");return Promise.resolve(import(b(r))).then(function(e){return i.render((0,e.default)(),n),document.getElementById("zbody").removeChild(),document.getElementById("zbody").appendChild(n),k.HTML=n.innerHTML,!k.preRendered})}catch(e){return Promise.reject(e)}};return o(n),Promise.resolve(e({language:"typescript",code:x(k.code),onChange:function(e){return function(e){try{return Promise.resolve(function(t,n){try{var i=Promise.resolve(g(e,k.lastErrors)).then(function(t){if(k.transpiled!==t){var n=!1;t.length&&0===k.lastErrors&&(n=o(t));var i=n?[{messageText:"Error while starting the app. Check the console!"}]:[];return Promise.resolve(function(e){try{if(!modules||!modules.monaco)return Promise.resolve();var r=modules.monaco;return Promise.resolve(Promise.resolve().then(function(){return p})).then(function(t){return Promise.resolve((0,t.sha256)(e)).then(function(t){function n(e){return Promise.resolve(r.languages.typescript.getTypeScriptWorker()).then(function(r){return Promise.resolve(r(e.uri)).then(function(r){var t=r.getSemanticDiagnostics(o),n=r.getCompilerOptionsDiagnostics(o),i=r.getSyntacticDiagnostics(o);return Promise.resolve(Promise.race([t,n,i])).then(function(r){return e.dispose(),[].concat(r)})})})}var o="file:///"+t+".tsx",i=r.Uri.parse(o),s=r.editor.getModel(i);return s?n(s):Promise.resolve(r.editor.createModel(e,"typescript",i)).then(n)})})}catch(e){return Promise.reject(e)}}(e)).then(function(n){var s;function c(e){if(s)return e;a.style.display="none",modules.monaco.editor.setTheme("vs-dark")}var u=[].concat(i,n);k.lastErrors&&0===u.length&&o(t),k.lastErrors=u.length;var a=window.document.getElementById("error"),l=function(){if(0===u.length&&t.length){var n=function(){return Promise.resolve(v(e)).then(function(){})};k.code=e;var o=function(){if(k.transpiled!==t)return k.transpiled=t,Promise.resolve(v(x(e))).then(function(){})}();return o&&o.then?o.then(n):n()}return k.error=e,Promise.resolve(r(k.code,e)).then(function(e){return e.c.length<=3?(k.lastErrors=0,void(s=1)):4==e.c.length?(k.lastErrors=0,modules.monaco.editor.setTheme("hc-black"),void(s=1)):(a.innerHTML=u[0].messageText.toString(),a.style.display="block",void(s=1))})}();return l&&l.then?l.then(c):c(l)})}})}catch(e){return n(e)}return i&&i.then?i.then(void 0,n):i}(0,function(e){modules.monaco.editor.setTheme("vs-light"),setTimeout(function(){modules.monaco.editor.setTheme("hc-black")},50),console.error(e)}))}catch(e){return Promise.reject(e)}}(x(e))}})).then(function(){})})}var s=function(){if("window"===t)return Promise.resolve(function(e){var r=e.ReactDOM,t=e.onShare;try{return Promise.resolve(import("https://cdn.skypack.dev/@emotion/react@11.1.4")).then(function(e){var n=e.css,o=e.jsx;r.render(o(function(e){var r=e.onShare;return o("div",null,o("div",{css:n(u()),animate:{scale:1,top:1,left:600},dragElastic:.5,dragMomentum:!1,initial:{top:1,left:0,scale:.7},transition:{duration:.5},drag:!0,dragConstraints:{left:200-window.innerWidth,right:0,bottom:window.innerHeight-200,top:0}},o("div",{css:"\n      display: block;\n      with: 100%;\n      text-align: right;\n      background: linear-gradient(0deg, darkred, red);\n    "},o("button",{css:"\n              background: darkred;\n              margin-top: -4px;\n              margin-right: -4px;\n              color: white;\n              cursor: pointer;\n              font-weight: bold;\n              font-family: Roboto;\n              padding: 8px 16px;\n              outline: none;\n              border: none;\n              border-radius: 0px 8px 0px 0px;\n            ",onClick:function(){return r()}},"ðŸŒŽ SHARE")),o("div",{css:"\n      min-width: 200px;\n      padding: 30px;\n      max-width: 600px;\n      background: white;\n      max-height: 800px;\n      border-radius: 0px 0px 8px 8px;\n      overflow-y: overlay;\n    ",id:"zbody"})),null)},{onShare:t}),window.document.getElementById("dragabbleWindow"))})}catch(e){return Promise.reject(e)}}({ReactDOM:i,React:o,onShare:function(){try{return Promise.resolve(function(e){var r=e.code,t=e.HTML;try{var n=b(r);return Promise.resolve(import(n)).then(function(e){var n=Array.from(window.document.querySelector("head > style[data-emotion=css]").sheet.cssRules).map(function(e){return e.cssText}).filter(function(e){return t.includes(e.substring(3,8))}).join("\n  ");return Promise.resolve(import("./templates-7751cd86.js")).then(function(e){var o=e.getHtml,i=e.getCodeForImport;return Promise.resolve(w(r,"application/html")).then(function(e){return console.log({HTML:t,linkToCode:e,css:n,code:r}),Promise.resolve((s=o({HTML:t,css:n,js:i(e)}),w(s,"text/html")));var s})})})}catch(e){return Promise.reject(e)}}({code:k.transpiled,HTML:k.HTML})).then(function(e){window.open(e)})}catch(e){return Promise.reject(e)}}})).then(function(){})}();return s&&s.then?s.then(n):n()}k.transpiled=n;var c=function(){if("editor"===t)return Promise.resolve(import("./DraggableEditor-fde5fd70.js")).then(function(e){return Promise.resolve((0,e.renderDraggableEditor)()).then(function(){})})}();return c&&c.then?c.then(s):s()})})}catch(e){return Promise.reject(e)}},k={hydrated:!1,preRendered:!1,lastErrors:0,HTML:"",ipfs:0,transpiled:"",code:""};function x(e){try{return t.format(e,{arrowParens:"always",bracketSpacing:!0,embeddedLanguageFormatting:"auto",htmlWhitespaceSensitivity:"css",insertPragma:!1,jsxBracketSameLine:!0,jsxSingleQuote:!1,printWidth:80,proseWrap:"preserve",quoteProps:"as-needed",requirePragma:!1,semi:!0,singleQuote:!0,tabWidth:2,trailingComma:"all",useTabs:!1,parser:"babel-ts",plugins:[n,o]})}catch(r){return e}}export{j as run};
//# sourceMappingURL=codeLoader.min.esm.js.map
