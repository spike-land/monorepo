var e=require("https://unpkg.com/@zedvision/smart-monaco-editor@10.11.4/dist/smart-monaco-editor.modern.js"),r=require("https://unpkg.com/@zedvision/diff@8.6.10/dist/diff.min.js"),t=require("https://unpkg.com/prettier@2.2.1/esm/standalone.mjs"),n=require("https://unpkg.com/prettier@2.2.1/esm/parser-babel.mjs"),o=require("https://unpkg.com/prettier@2.2.1/esm/parser-html.mjs"),i=require("https://unpkg.com/@zedvision/shadb@8.7.2/dist/shaDB.js"),s=require("https://unpkg.com/uuid@8.3.2/dist/esm-browser/v4.js"),u=require("https://unpkg.com/comlink/dist/esm/comlink.mjs");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach(function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}}),r.default=e,r}var l=c(e),d=c(t),m=c(n),f=c(o),h=c(s);function v(){var e,r,t=(e=["\n            background: red;\n            border: 4px solid red;\n            border-radius: 8px;\n          "],r||(r=e.slice(0)),e.raw=r,e);return v=function(){return t},t}var p,g,P,y=function(){try{var e=arguments,r=function(r){var t;return(t=p=r).get.apply(t,[].slice.call(e))},t=p;return Promise.resolve(t?r(t):Promise.resolve(i.getDB()).then(r))}catch(e){return Promise.reject(e)}},b=function(){try{var e=arguments,r=function(r){var t;return(t=p=r).put.apply(t,[].slice.call(e))},t=p;return Promise.resolve(t?r(t):Promise.resolve(i.getDB()).then(r))}catch(e){return Promise.reject(e)}},w=function(e){try{return Promise.resolve(crypto.subtle.digest("SHA-256","string"==typeof e?(new TextEncoder).encode(e):e)).then(function(e){return Array.from(new Uint8Array(e).slice(0,4)).map(function(e){return("00"+e.toString(16)).slice(-2)}).join("")})}catch(e){return Promise.reject(e)}},j={__proto__:null,sha256:w},k=function(e){try{return Promise.resolve(w(e)).then(function(r){return Promise.resolve(function(){try{return Promise.resolve(function(){try{return Promise.resolve(y("uuid")).then(function(e){var r,t=function(){if(!e)return Promise.resolve(fetch("https://code.zed.vision/register")).then(function(e){return Promise.resolve(e.json()).then(function(e){return Promise.resolve(b("uuid",e.uuid)).then(function(){return r=1,e.uuid})})})}();return t&&t.then?t.then(function(t){return r?t:e}):r?t:e})}catch(e){return Promise.reject(e)}}()).then(function(e){return Promise.resolve(y(e,"json")).then(function(r){var t;function n(e){return t?e:r.list}var o=function(){if("string"==typeof r||null===r||!r.list){var n,o=h.default();return Promise.resolve(b(e,JSON.stringify((n={list:[o]},n[o]={created:Date.now(),lastOpen:Date.now()},n)))).then(function(){return t=1,[o]})}}();return o&&o.then?o.then(n):n(o)})})}catch(e){return Promise.reject(e)}}()).then(function(t){var n=t[0],o=function(t,o){try{var i=Promise.resolve(y(n)).then(function(t){var o=function(){if(t!==r)return Promise.resolve(b(r,e)).then(function(){return Promise.resolve(b(n,r)).then(function(){})})}();if(o&&o.then)return o.then(function(){})})}catch(e){return o(e)}return i&&i.then?i.then(void 0,o):i}(0,function(e){console.error(e)});if(o&&o.then)return o.then(function(){})})})}catch(e){return Promise.reject(e)}},x=function(e,r){try{var t=function(t){return g=t,Promise.resolve(g(e,r))};return Promise.resolve(g?t(g):Promise.resolve(T()).then(t))}catch(e){return Promise.reject(e)}};function T(){var e=new Worker("./src/transpile.worker.js");return g=u.wrap(e)}function E(){var e=new Worker("./src/ipfsKV.worker.js");return P=u.wrap(e)}T(),E();var S=function(e,r){try{return Promise.resolve(function(e){try{var r=function(r){return r.add(e)};return Promise.resolve(P?r(P):Promise.resolve(E()).then(r))}catch(e){return Promise.reject(e)}}(URL.createObjectURL(new Blob([e],{type:r})))).then(function(e){return"https://ipfs.io/ipfs/"+e})}catch(e){return Promise.reject(e)}};function q(e){var r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}var L={hydrated:!1,preRendered:!1,lastErrors:0,HTML:"",ipfs:0,transpiled:"",code:""};function M(e){try{return d.default.format(e,{arrowParens:"always",bracketSpacing:!0,embeddedLanguageFormatting:"auto",htmlWhitespaceSensitivity:"css",insertPragma:!1,jsxBracketSameLine:!0,jsxSingleQuote:!1,printWidth:80,proseWrap:"preserve",quoteProps:"as-needed",requirePragma:!1,semi:!0,singleQuote:!0,tabWidth:2,trailingComma:"all",useTabs:!1,parser:"babel-ts",plugins:[m.default,f.default]})}catch(r){return e}}exports.run=function(e,t){void 0===e&&(e="window");var n=t.React,o=t.ReactDOM;try{return console.log("Runnnner"),Promise.resolve(getCodeToLoad()).then(function(t){return L.code=M(t),Promise.resolve(x(L.code)).then(function(t){function i(){function t(){return Promise.resolve(x(L.code)).then(function(t){var n=function(r){try{if("string"!=typeof r||""===r)return Promise.resolve(1);var t="window"===e?r.replace("body{","#zbody{"):r,n=window.document.getElementById("zbody").children[0]||document.getElementById("zbody").appendChild(document.createElement("div"));return Promise.resolve(Promise.resolve().then(function(){return a(require(q(t)))})).then(function(e){return o.render((0,e.default)(),n),L.HTML=n.innerHTML,!L.preRendered})}catch(e){return Promise.reject(e)}};return n(t),Promise.resolve(l.default({language:"typescript",code:M(L.code),onChange:function(e){return function(e){try{return Promise.resolve(function(e,t){try{var o=Promise.resolve(x(cd,L.lastErrors)).then(function(e){if(L.transpiled!==e){var t=!1;e.length&&0===L.lastErrors&&(t=n(e));var o=t?[{messageText:"Error while starting the app. Check the console!"}]:[];return Promise.resolve(function(e){try{if(!modules||!modules.monaco)return Promise.resolve();var r=modules.monaco;return Promise.resolve(Promise.resolve().then(function(){return j})).then(function(t){return Promise.resolve((0,t.sha256)(e)).then(function(t){function n(e){return Promise.resolve(r.languages.typescript.getTypeScriptWorker()).then(function(r){return Promise.resolve(r(e.uri)).then(function(r){var t=r.getSemanticDiagnostics(o),n=r.getCompilerOptionsDiagnostics(o),i=r.getSyntacticDiagnostics(o);return Promise.resolve(Promise.race([t,n,i])).then(function(r){return e.dispose(),[].concat(r)})})})}var o="file:///"+t+".tsx",i=r.Uri.parse(o),s=r.editor.getModel(i);return s?n(s):Promise.resolve(r.editor.createModel(e,"typescript",i)).then(n)})})}catch(e){return Promise.reject(e)}}(cd)).then(function(t){var i;function s(e){if(i)return e;c.style.display="none",modules.monaco.editor.setTheme("vs-dark")}var u=[].concat(o,t);L.lastErrors&&0===u.length&&n(e),L.lastErrors=u.length;var c=window.document.getElementById("error"),a=function(){if(0===u.length&&e.length){var t=function(){return Promise.resolve(k(cd)).then(function(){})};L.code=cd;var n=function(){if(L.transpiled!==e)return L.transpiled=e,Promise.resolve(k(M(cd))).then(function(){})}();return n&&n.then?n.then(t):t()}return L.error=cd,Promise.resolve(r.diff(L.code,cd)).then(function(e){return e.c.length<=3?(L.lastErrors=0,void(i=1)):4==e.c.length?(L.lastErrors=0,modules.monaco.editor.setTheme("hc-black"),void(i=1)):(c.innerHTML=u[0].messageText.toString(),c.style.display="block",void(i=1))})}();return a&&a.then?a.then(s):s(a)})}})}catch(e){return t(e)}return o&&o.then?o.then(void 0,t):o}(0,function(e){modules.monaco.editor.setTheme("vs-light"),setTimeout(function(){modules.monaco.editor.setTheme("hc-black")},50),console.error(e)}))}catch(e){return Promise.reject(e)}}(M(e))}})).then(function(){})})}var i=function(){if("window"===e)return Promise.resolve(function(e){var r=e.onShare;try{return Promise.resolve(Promise.resolve().then(function(){return a(require("https://cdn.skypack.dev/@emotion/react@11.1.1"))})).then(function(e){var t=e.css,n=e.jsx;ReactDDOM.render(n(function(e){var r=e.onShare;return n("div",null,n("div",{css:t(v()),animate:{scale:1,top:1,left:600},dragElastic:.5,dragMomentum:!1,initial:{top:1,left:0,scale:.7},transition:{duration:.5},drag:!0,dragConstraints:{left:200-window.innerWidth,right:0,bottom:window.innerHeight-200,top:0}},n("div",{css:"\n      display: block;\n      with: 100%;\n      text-align: right;\n      background: linear-gradient(0deg, darkred, red);\n    "},n("button",{css:"\n              background: darkred;\n              margin-top: -4px;\n              margin-right: -4px;\n              color: white;\n              cursor: pointer;\n              font-weight: bold;\n              font-family: Roboto;\n              padding: 8px 16px;\n              outline: none;\n              border: none;\n              border-radius: 0px 8px 0px 0px;\n            ",onClick:function(){return r()}},"ðŸŒŽ SHARE")),n("div",{css:"\n      min-width: 200px;\n      padding: 30px;\n      max-width: 600px;\n      background: white;\n      max-height: 800px;\n      border-radius: 0px 0px 8px 8px;\n      overflow-y: overlay;\n    ",id:"zbody"})),null)},{onShare:r}),window.document.getElementById("dragabbleWindow"))})}catch(e){return Promise.reject(e)}}({ReactDOM:o,React:n,onShare:function(){try{return Promise.resolve(function(e){var r=e.code,t=e.HTML;try{var n=q(r);return Promise.resolve(Promise.resolve().then(function(){return a(require(n))})).then(function(e){var n=Array.from(window.document.querySelector("head > style[data-emotion=css]").sheet.cssRules).map(function(e){return e.cssText}).filter(function(e){return t.includes(e.substring(3,8))}).join("\n  ");return Promise.resolve(Promise.resolve().then(function(){return require("./templates-f8237e6b.js")})).then(function(e){var o=e.getHtml,i=e.getCodeForImport;return Promise.resolve(S(r,"application/html")).then(function(e){return console.log({HTML:t,linkToCode:e,css:n,code:r}),Promise.resolve((s=o({HTML:t,css:n,js:i(e)}),S(s,"text/html")));var s})})})}catch(e){return Promise.reject(e)}}({code:L.transpiled,HTML:L.HTML})).then(function(e){window.open(e)})}catch(e){return Promise.reject(e)}}})).then(function(){})}();return i&&i.then?i.then(t):t()}L.transpiled=t;var s=function(){if("editor"===e)return Promise.resolve(Promise.resolve().then(function(){return require("./DraggableEditor-f10ea7b6.js")})).then(function(e){return Promise.resolve((0,e.renderDraggableEditor)()).then(function(){})})}();return s&&s.then?s.then(i):i()})})}catch(e){return Promise.reject(e)}};
//# sourceMappingURL=codeLoader.min.js.map
