const v=(i,a)=>{const n=()=>jsx(React.Fragment,null,jsx(i.div,{css:`
            z-index:900;
            background: white;
            border: 2px solid white;
            border-radius: 0px 0px 12px 12px;
          `,animate:{scale:1,top:1,left:600},dragElastic:.5,dragMomentum:!1,initial:{top:1,left:0,scale:.7},transition:{duration:.5},drag:!0,dragConstraints:{left:-200,right:window.innerWidth-200,bottom:window.innerHeight+200,top:0}},jsx("div",{css:`
      display: block;
      with: 100%;
      height: 30px;
      background: burlywood;
    `}),jsx("div",{onClick:()=>a(),css:`
      display: inline-block;
      min-width: 200px;
      padding: 30px;
      max-width: 600px;
      max-height: 800px;
      overflow-y: scroll;
    `,id:"root"})));ReactDOM.render(jsx(n),u.getElementById("dragabbleWindow"))},T=async({onChange:i,code:a,language:n})=>{const t=window.document.getElementById("container");if(!t){const o=u.getElementById("container");o.id="container",u.body.appendChild(o)}const y=n==="typescript"?"file:///main.tsx":"file:///main.html";let d;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)){const o=window.document.createElement("div");o.id="ace",window.document.body.appendChild(o),await h("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"),n==="typescript"?await h("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js"):await h("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.min.js"),await h("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js"),window.document.getElementById("ace").style.setProperty("display","block"),t.style.setProperty("display","none"),d=window.ace.edit("ace"),d.getSession().setMode("ace/mode/typescript");const s=r=>setTimeout(()=>{let c=window.ace.edit("ace"),x=c.getTheme();x!=="ace/theme/monokai "&&(c.setOptions({fontSize:"14pt"}),c.setTheme("ace/theme/monokai"),s(2*r))},r);s(100),d.setValue(a),d.blur()}if(window.monaco===void 0){const o="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs",{require:s}=await h("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js");s.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs"}}),await new Promise(r=>s(["vs/editor/editor.main"],c=>{r(c)}))}const l=window.monaco,e={monaco:l,editor:l.editor.create(window.document.getElementById("container"),{formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;}",mouseWheelZoom:!1,wordWrapColumn:80,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",padding:{bottom:300},lineNumbers:"on",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:l.editor.getModel(y)||l.editor.createModel(a,n,l.Uri.parse(y)),value:a,language:n,theme:"vs-dark"})};if(e.editor.onDidChangeModelContent(()=>i(e.editor.getValue())),d&&d.session.on("change",function(){const o=d.getValue();e.editor.setValue(o),i(o)}),d&&u.getElementById("container").replaceWith(u.getElementById("ace")),e.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),n==="typescript"){const o=[{name:"react",url:"https://unpkg.com/@types/react@17.0.0/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@17.0.0/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@17.0.0/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@3.0.5/index.d.ts",depend:[]},{name:"@emotion/styled/base.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/styled/index.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/cache/index.d.ts",url:"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts",depend:["@emotion/utils"]},{name:"@emotion/react/index.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/index.d.ts",depend:["@emotion/cache"]},{name:"@emotion/react/jsx-namespace.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/jsx-namespace.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/css-prop.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/css-prop.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/helper.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/helper.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/theming.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/theming.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/serialize/index.d.ts",url:"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/utils/index.d.ts",url:"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts",depend:[]},{name:"framer-motion",url:"https://unpkg.com/framer-motion@2.9.4/dist/framer-motion.d.ts",depend:[]},{name:"popmotion",url:"https://unpkg.com/browse/popmotion@9.0.0/lib/index.d.ts"}],s=o.map(({name:r,url:c})=>(async()=>e.monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(c)).text(),r.includes("@emotion")?`file:///node_modules/${r}`:`file:///node_modules/@types/${r}/index.d.ts`))());return e.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:e.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:e.monaco.languages.typescript.ModuleResolutionKind.Nodejs,module:e.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:e.monaco.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",jsxFragmentFactory:"React.Fragment",esModuleInterop:!0}),await Promise.all(s),e.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),e}};function h(i){return new Promise(function(a,n){var t;t=window.document.createElement("script"),t.src=i,t.onload=()=>a(window),t.onerror=n,window.document.head.appendChild(t)})}const b=async i=>u.querySelector(`script[src="${i}"]`)||new Promise(function(a,n){const t=window.document.createElement("script");t.src=i,t.onload=a,t.onerror=n,window.document.head.appendChild(t)}),D=`import { useState } from "react";
import {css, Global} from "@emotion/react";;

const Counter = () => {
  const [clicks, setClicks] = useState(0);

  return <>
      <h1>Counter example</h1>
      <button css={buttonStyles("green")} onClick={() => setClicks(clicks - 1)}>
        -
     </button>
      {clicks}
      <button css={buttonStyles("red")} onClick={() => setClicks(clicks + 1)}>
        +
    </button>
  </>
}

const buttonStyles = (color: string) => css\`
  border-radius: 6px;
  padding: 0.5rem 0;
  margin: 0.5rem 2rem;
  width: 4rem;
  background: \${color};
  color: white;
  border: none;
  :focus{
    outline: none;
  }
  \`;

export default () => <>
  <Global styles={css\`
      body{
          margin: 0;
        }  
    \`}
  />
  <Counter />
</>
`,u=window.document;let k=!0;const{motion:I}=window.Motion;let m="",p=0,B=0,S="",j="",g="";export async function run(){v(I),await b("https://unpkg.com/@babel/standalone@7.12.7/babel.min.js"),b("https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"),(async()=>{const n=a();g=n;const t=await T({language:"typescript",code:n,onChange:y});function y(e){if(!t)return;if(m=e,!p)l(m);else{const o=e,s=setInterval(()=>{(e!==m||!p)&&clearInterval(s),p||l(m)},100)}}async function d(){if(!t||!t.monaco)return;const e=t.monaco.Uri.parse("file:///main.tsx"),o=await t.monaco.languages.typescript.getTypeScriptWorker(),s=await(await o(e)).getSemanticDiagnostics("file:///main.tsx"),r=await(await o(e)).getCompilerOptionsDiagnostics("file:///main.tsx"),c=await(await o(e)).getSyntacticDiagnostics("file:///main.tsx");return[...s,...r,...c]}async function l(e){const{diff:o}=await import("../dist/diff.min.js");if(p===1)return;try{p=1;const s=await d(),r=u.getElementById("error");if(p=0,e!==m)return;if(s&&s.length){if(m!=e)return;if(S===e)return;const c=o(g,e,0);if(c.length<=3){t.monaco.editor.setTheme("hc-black");return}r.innerHTML=s[0].messageText.toString(),r.style.display="block",S=e;return}g=e,r.style.display="none",t.monaco.editor.setTheme("vs-dark"),B=0,p=0,i(E(e))}catch(s){if(p=0,e!==m)return;t.monaco.editor.setTheme("vs-light"),setTimeout(()=>{t.monaco.editor.setTheme("hc-black")},50),console.error(s)}}})(),i(E(a()));async function i(n){const t=/import/gi,y="///",d=n.replaceAll(/import/gi,"///").replace("export default","DefaultElement = "),l=async()=>{const e=new Function("code",`return function(){  
          let DefaultElement;
        
        ${d}

                return ReactDOM.render(jsx(DefaultElement), document.getElementById("root"));
      }`)();e()};if(!k){const e=async o=>{if(!location.origin.includes("zed.vision"))return;if(o!==g)return;if(j===o)return;j=o;const s={codeTranspiled:n,code:g},r=JSON.stringify(s),c=new Request("https://code.zed.vision",{body:r,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),x=await fetch(c),{hash:w}=await x.json();try{const f=window.localStorage,C=f.getItem("codeBoXHash2");C!==w&&(f.setItem("codeBoXHash2",w),f.setItem(w,g),R("h",w))}catch(f){}};setTimeout(()=>e(m),500)}k=!1,l()}function a(){const n=new URLSearchParams(window.location.search),t=n.get("h")||localStorage.getItem("codeBoXHash2");return t&&window.localStorage.getItem(t)||window.localStorage.getItem("STARTER")||D}}function R(i,a){const n=new URLSearchParams(window.location.search);n.set(i,a),window.history.replaceState({},"",decodeURIComponent(`${window.location.pathname}?${n}`))}function E(i){const{transform:a}=window.Babel;return a(`/** @jsx jsx */

  Object.assign(window, React);
  `+i,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code}
