const B=(i,a)=>{const n=()=>jsx(React.Fragment,null,jsx(i.div,{css:`
            z-index:900;
            background: white;
            border: 2px solid white;
            border-radius: 0px 0px 12px 12px;
          `,animate:{scale:1,top:1,left:600},dragElastic:.5,dragMomentum:!1,initial:{top:1,left:0,scale:.7},transition:{duration:.5},drag:!0,dragConstraints:{left:-200,right:window.innerWidth-200,bottom:window.innerHeight+200,top:0}},jsx("div",{css:`
      display: block;
      with: 100%;
      height: 30px;
      background: burlywood;
    `},jsx("button",{css:`
              backgound: blue;
            `,onClick:()=>a()},"SHARE")),jsx("div",{css:`  
      display: inline-block;
      min-width: 200px;
      padding: 30px;
      max-width: 600px;
      max-height: 800px;
      overflow-y: scroll;
    `,id:"root"})));ReactDOM.render(jsx(n),m.getElementById("dragabbleWindow"))},M=async({onChange:i,code:a,language:n})=>{const e=window.document.getElementById("container");if(!e){const o=m.getElementById("container");o.id="container",m.body.appendChild(o)}const f=n==="typescript"?"file:///main.tsx":"file:///main.html";let r;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)){const o=window.document.createElement("div");o.id="ace",window.document.body.appendChild(o),await x("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"),n==="typescript"?await x("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js"):await x("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.min.js"),await x("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js"),window.document.getElementById("ace").style.setProperty("display","block"),e.style.setProperty("display","none"),r=window.ace.edit("ace"),r.getSession().setMode("ace/mode/typescript");const s=c=>setTimeout(()=>{let d=window.ace.edit("ace"),g=d.getTheme();g!=="ace/theme/monokai "&&(d.setOptions({fontSize:"14pt"}),d.setTheme("ace/theme/monokai"),s(2*c))},c);s(100),r.setValue(a),r.blur()}if(window.monaco===void 0){const o="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs",{require:s}=await x("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs/loader.min.js");s.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs"}}),await new Promise(c=>s(["vs/editor/editor.main"],d=>{c(d)}))}const l=window.monaco,t={monaco:l,editor:l.editor.create(window.document.getElementById("container"),{formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;}",mouseWheelZoom:!1,wordWrapColumn:80,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",padding:{bottom:300},lineNumbers:"on",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:l.editor.getModel(f)||l.editor.createModel(a,n,l.Uri.parse(f)),value:a,language:n,theme:"vs-dark"})};if(t.editor.onDidChangeModelContent(()=>i(t.editor.getValue())),r&&r.session.on("change",function(){const o=r.getValue();t.editor.setValue(o),i(o)}),r&&m.getElementById("container").replaceWith(m.getElementById("ace")),t.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),n==="typescript"){const o=[{name:"react",url:"https://unpkg.com/@types/react@17.0.0/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@17.0.0/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@17.0.0/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@3.0.5/index.d.ts",depend:[]},{name:"@emotion/styled/base.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/styled/index.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/cache/index.d.ts",url:"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts",depend:["@emotion/utils"]},{name:"@emotion/react/index.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/index.d.ts",depend:["@emotion/cache"]},{name:"@emotion/react/jsx-namespace.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/jsx-namespace.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/css-prop.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/css-prop.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/helper.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/helper.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/theming.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/theming.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/serialize/index.d.ts",url:"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/utils/index.d.ts",url:"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts",depend:[]},{name:"framer-motion",url:"https://unpkg.com/framer-motion@2.9.4/dist/framer-motion.d.ts",depend:[]},{name:"popmotion",url:"https://unpkg.com/browse/popmotion@9.0.0/lib/index.d.ts"}],s=o.map(({name:c,url:d})=>(async()=>t.monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(d)).text(),c.includes("@emotion")?`file:///node_modules/${c}`:`file:///node_modules/@types/${c}/index.d.ts`))());return t.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:t.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:t.monaco.languages.typescript.ModuleResolutionKind.Nodejs,module:t.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:t.monaco.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",jsxFragmentFactory:"React.Fragment",esModuleInterop:!0}),await Promise.all(s),t.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),t}};function x(i){return new Promise(function(a,n){var e;e=window.document.createElement("script"),e.src=i,e.onload=()=>a(window),e.onerror=n,window.document.head.appendChild(e)})}const S=async i=>m.querySelector(`script[src="${i}"]`)||new Promise(function(a,n){const e=window.document.createElement("script");e.src=i,e.onload=a,e.onerror=n,window.document.head.appendChild(e)}),I=`import { useState } from "react";
import {css, Global} from "@emotion/react";;

const Counter = () => {
  const [clicks, setClicks] = useState(0);

  return <>
      <h1>Counter example</h1>
      <button css={buttonStyles("green")} onClick={() => setClicks(clicks - 1)}>
        -
     </button>
      {clicks}
      <button css={buttonStyles("red")} onClick={() => setClicks(clicks + 1)}>
        +
    </button>
  </>
}

const buttonStyles = (color: string) => css\`
  border-radius: 6px;
  padding: 0.5rem 0;
  margin: 0.5rem 2rem;
  width: 4rem;
  background: \${color};
  color: white;
  border: none;
  :focus{
    outline: none;
  }
  \`;

export default () => <>
  <Global styles={css\`
      body{
          margin: 0;
        }  
    \`}
  />
  <Counter />
</>
`,m=window.document;let E=!0;const{motion:P}=window.Motion;let p="",u=0,$=0,v="",T="",w="",C;export async function run(){B(P,()=>C()),await S("https://unpkg.com/@babel/standalone@7.12.7/babel.min.js"),S("https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"),(async()=>{const n=a();w=n;const e=await M({language:"typescript",code:n,onChange:f});function f(t){if(!e)return;if(p=t,!u)l(p);else{const o=t,s=setInterval(()=>{(t!==p||!u)&&clearInterval(s),u||l(p)},100)}}async function r(){if(!e||!e.monaco)return;const t=e.monaco.Uri.parse("file:///main.tsx"),o=await e.monaco.languages.typescript.getTypeScriptWorker(),s=await(await o(t)).getSemanticDiagnostics("file:///main.tsx"),c=await(await o(t)).getCompilerOptionsDiagnostics("file:///main.tsx"),d=await(await o(t)).getSyntacticDiagnostics("file:///main.tsx");return[...s,...c,...d]}async function l(t){const{diff:o}=await import("../dist/diff.min.js");if(u===1)return;try{u=1;const s=await r(),c=m.getElementById("error");if(u=0,t!==p)return;if(s&&s.length){if(p!=t)return;if(v===t)return;const d=o(w,t,0);if(d.length<=3){e.monaco.editor.setTheme("hc-black");return}c.innerHTML=s[0].messageText.toString(),c.style.display="block",v=t;return}w=t,c.style.display="none",e.monaco.editor.setTheme("vs-dark"),$=0,u=0,i(D(t))}catch(s){if(u=0,t!==p)return;e.monaco.editor.setTheme("vs-light"),setTimeout(()=>{e.monaco.editor.setTheme("hc-black")},50),console.error(s)}}})(),i(D(a()));async function i(n){const e=/import/gi,f="///",r=n.replaceAll(/import/gi,"///").replace("export default","DefaultElement = ");console.log(r);const l=async()=>{const t=new Function("code",`return function(){  
          let DefaultElement;
        
        ${r}

                return ReactDOM.render(jsx(DefaultElement), document.getElementById("root"));
      }`)();t(),C=async()=>{const o=new Function("code",`return function(){
            let DefaultElement;
  
          ${r}
  
                  return ReactDOMServer.renderToString(jsx(DefaultElement));
        }`)(),s=o(),c=Array.from(m.querySelector("head > style[data-emotion=css]").sheet.cssRules).map(b=>b.cssText).filter(b=>s.includes(b.substring(3,8))).join(`
  `);let d;if(r.includes("body{")){const b=r.indexOf("body{"),j=r.slice(b),O=j.indexOf("}");d=j.slice(0,O+1)}let g="",y="";r.includes("Motion")&&(g='<script crossorigin src="https://unpkg.com/framer-motion@2.9.4/dist/framer-motion.js"></script>',y="const {motion} = Motion");const h=`<!DOCTYPE html>
        <html lang="en">
        <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <style>
        ${d}
        ${c}
        </style>
        </head>
        <body>
        <div id="root">
        ${s}
        </div>
        <script crossorigin src="https://unpkg.com/react@17.0.1/umd/react.production.min.js"></script>
        ${g}
        <script crossorigin src="https://unpkg.com/react-dom@17.0.1/umd/react-dom.production.min.js"></script>
        <script crossorigin src="https://unpkg.com/@emotion/react@11.1.1/dist/emotion-react.umd.min.js"></script>
        <script crossorigin src="https://unpkg.com/@emotion/styled@11.0.0/dist/emotion-styled.umd.min.js"></script>
        <script type="module">
        Object.assign(window, emotionReact);

       const styled = window["emotionStyled"];

        let DefaultElement;

        ${r}

        ReactDOM.hydrate(jsx(DefaultElement), document.body.children[0]);
        </script>
        </body>
        </html>
        `,k=await H(h),R=await W(k);console.log(R)}};if(!E){const t=async o=>{if(!location.origin.includes("zed.vision"))return;if(o!==w)return;if(T===o)return;T=o;const s={codeTranspiled:n,code:w},c=JSON.stringify(s),d=new Request("https://code.zed.vision",{body:c,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),g=await fetch(d),{hash:y}=await g.json();try{const h=window.localStorage,k=h.getItem("codeBoXHash2");k!==y&&(h.setItem("codeBoXHash2",y),h.setItem(y,w),A("h",y))}catch(h){}};setTimeout(()=>t(p),500)}E=!1,l()}function a(){const n=new URLSearchParams(window.location.search),e=n.get("h")||localStorage.getItem("codeBoXHash2");return e&&window.localStorage.getItem(e)||window.localStorage.getItem("STARTER")||I}}function A(i,a){const n=new URLSearchParams(window.location.search);n.set(i,a),window.history.replaceState({},"",decodeURIComponent(`${window.location.pathname}?${n}`))}function H(i){const a=new Blob([i],{type:"text/html"});return a}async function W(i){const a=new Request("https://code.zed.vision",{body:i,method:"POST",headers:{"content-type":"text/html;charset=UTF-8"}}),n=await fetch(a),{hash:e}=await n.json();return`https://code.zed.vision/?r=${e}`}function D(i){const{transform:a}=window.Babel;return a(`/** @jsx jsx */

  Object.assign(window, React);
  `+i,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code}
