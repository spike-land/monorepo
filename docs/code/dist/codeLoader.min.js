async function L(n,e){try{const t=`https://code.zed.vision/keys/?prefix=${e}`,o=await fetch(t,{headers:{"content-type":"application/json;charset=UTF-8",API_KEY:n}}),i=await o.json();return i.keys}catch(t){return console.log(t),[]}}const We=L,me=n=>{const e=()=>jsx(React.Fragment,null,jsx(motion.div,{css:`
            background: red;
            border: 4px solid red;
            border-radius: 8px;
          `,animate:{scale:1,top:1,left:600},dragElastic:.5,dragMomentum:!1,initial:{top:1,left:0,scale:.7},transition:{duration:.5},drag:!0,dragConstraints:{left:-window.innerWidth+200,right:0,bottom:window.innerHeight-200,top:0}},jsx("div",{css:`
      display: block;
      with: 100%;
      text-align: right;
      background: linear-gradient(0deg, darkred, red);
    `},jsx("button",{css:`
              background: darkred;
              margin-top: -4px;
              color: white;
              cursor: pointer;
              font-weight: bold;
              font-family: Roboto;
              padding: 8px 16px;
              outline: none;
              border: none;
              border-radius: 0px 8px 0px 0px;
            `,onClick:()=>n()},"\u{1F30E} SHARE")),jsx("div",{css:`  
      min-width: 200px;
      padding: 30px;
      max-width: 600px;
      background: white;
      max-height: 800px;
      border-radius: 0px 0px 8px 8px;
      overflow-y: overlay;
    `,id:"root"})));V.render(jsx(e),document.getElementById("dragabbleWindow"))};function pe(){const n=new JSFrame,e=n.create({name:"Win",title:"monaco",width:window.innerWidth/2-40,height:600,minWidth:300,minHeight:300,appearanceName:"material",appearanceParam:{titleBar:{color:"white",height:40,background:"red"}},style:{backgroundColor:"rgba(255,255,255,0.8)",overflow:"auto"},style:{backgroundColor:"rgba(0,0,0,0.8)",overflow:"hidden",width:"100%"},html:'<div id="container"></div>'});e.setPosition(window.innerWidth-32,32,"RIGHT_TOP"),e.setControl({maximizeButton:"maximizeButton",demaximizeButton:"restoreButton",minimizeButton:"minimizeButton",deminimizeButton:"deminimizeButton",hideButton:"closeButton",animation:!0,animationDuration:150}),e.control.on("hid",(t,o)=>{t.closeFrame()}),e.control.on("maximized",(t,o)=>{n.showToast({text:"Maximized"})}),e.control.on("demaximized",(t,o)=>{}),e.control.on("minimized",(t,o)=>{}),e.control.on("dminimized",(t,o)=>{}),e.show(),console.log(e)}function A(n){return new Promise(function(e,t){var o;o=window.document.createElement("script"),o.src=n,o.onload=()=>e(window),o.onerror=t,window.document.head.appendChild(o)})}const fe=async n=>document.querySelector(`script[src="${n}"]`)||new Promise(function(e,t){const o=window.document.createElement("script");o.src=n,o.onload=e,o.onerror=t,window.document.head.appendChild(o)}),G=`import { useState } from "react";
import { motion } from "framer-motion";
import { css, Global } from "@emotion/react";;

const Slider = () => {
  const [sliderValue, setSlider] = useState(64);

  return <>
  <Global styles={css\`
      body{
          margin: 0;
          background: rgb(\${sliderValue},\${255-sliderValue},255);
          overflow: overlay;
        }  
    \`}/>
    <input max="128"
      css={\`
        appearance: none;
        width: 100%;
        height: 40px; 
        background: rgb(\${sliderValue*2},\${255-2*sliderValue},0); 
        outline: none; 
    \`} type="range"
      value={sliderValue} step="1"
      onChangeCapture={(e) => setSlider(Number(e.currentTarget.value))}>
    </input>
    <motion.p
      animate={{ fontSize: sliderValue + \`px\` }}>
      Example when the text gets bigger...
    </motion.p>
      <motion.p animate={{fontSize:128-sliderValue+"px"}}>
        ...or smaller
    </motion.p>
  </>
}

export default () => <>
  <Slider />
</>
`;async function he(n){const e=await crypto.subtle.digest("SHA-256",n),t=Array.from(new Uint8Array(e)),o=t.map(i=>("00"+i.toString(16)).slice(-2)).join("");return o}const P=async()=>{const{openDB:n}=await import("https://unpkg.com/idb@5.0.8/build/esm/index.js"),e=n("localZedCodeStore",1,{blocked(){},blocking(){},terminated(){},upgrade(t){t.createObjectStore("codeStore")}});return{async get(t,o="string"){const i=(await e).get("codeStore",t);if(!i)return null;if(o==="json")return JSON.parse(i);if(o==="string"){const c=await i;if(typeof c===o)return c;const r=new TextDecoder,s=r.decode(c);return s}return i},async put(t,o){let i;return typeof o!="string"?i=new TextDecoder().decode(o):i=o,(await e).put("codeStore",i,t)},async delete(t){return(await e).delete("codeStore",t)},async clear(){return(await e).clear("codeStore")},async keys(){return(await e).getAllKeys("codeStore")}}},ge=(n,e)=>e.some(t=>n instanceof t);let X,Q;function we(){return X||(X=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ye(){return Q||(Q=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Y=new WeakMap,R=new WeakMap,Z=new WeakMap,z=new WeakMap,W=new WeakMap;function be(n){if(R.has(n))return;const e=new Promise((t,o)=>{const i=()=>{n.removeEventListener("complete",c),n.removeEventListener("error",r),n.removeEventListener("abort",r)},c=()=>{t(),i()},r=()=>{o(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",c),n.addEventListener("error",r),n.addEventListener("abort",r)});R.set(n,e)}const H=n=>W.get(n),ke=["get","getKey","getAll","getAllKeys","count"],Se=["put","add","delete","clear"],$=new Map;function ee(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if($.get(e))return $.get(e);const t=e.replace(/FromIndex$/,""),o=e!==t,i=Se.includes(t);if(!(t in(o?IDBIndex:IDBObjectStore).prototype)||!(i||ke.includes(t)))return;const c=async function(r,...s){const u=this.transaction(r,i?"readwrite":"readonly");let p=u.store;o&&(p=p.index(s.shift()));const a=await p[t](...s);return i&&await u.done,a};return $.set(e,c),c}const D=-1;function F(n){return n>=55296&&n<=56319}function te(n){return n>=56320&&n<=57343}function Ee(n){return te(n.charCodeAt(0))}function Be(n){return F(n.charCodeAt(n.length-1))}function De(n){const e=[];for(let t=0;t<n.length;t++)n[t][1].length>0&&e.push(n[t]);return e}function U(n,e,t,o){return Be(n)||Ee(o)?null:De([[0,n],[D,e],[1,t],[0,o]])}function je(n,e,t){const o=typeof t=="number"?{index:t,length:0}:t.oldRange,i=typeof t=="number"?null:t.newRange,c=n.length,r=e.length;if(o.length===0&&(i===null||i.length===0)){const s=o.index,u=n.slice(0,s),p=n.slice(s),a=i?i.index:null;e:{const d=s+r-c;if(a!==null&&a!==d)break e;if(d<0||d>r)break e;const y=e.slice(0,d),h=e.slice(d);if(h!==p)break e;const f=Math.min(s,d),l=u.slice(0,f),g=y.slice(0,f);if(l!==g)break e;const m=u.slice(f),w=y.slice(f);return U(l,m,w,p)}e:{if(a!==null&&a!==s)break e;const d=s,y=e.slice(0,s),h=e.slice(s);if(y!==u)break e;const f=Math.min(c-s,r-s),l=p.slice(p.length-f),g=h.slice(h.length-f);if(l!==g)break e;const m=p.slice(0,p.length-f),w=h.slice(0,h.length-f);return U(u,m,w,l)}}if(o.length>0&&i&&i.length===0){e:{const s=n.slice(0,o.index),u=n.slice(o.index+o.length),p=s.length,a=u.length;if(r<p+a)break e;const d=e.slice(0,p),y=e.slice(r-a);if(s!==d||u!==y)break e;const h=n.slice(p,c-a),f=e.slice(p,r-a);return U(s,h,f,u)}}return null}O.INSERT=1,O.DELETE=D,O.EQUAL=0;var V=window.ReactDOM;const N=()=>document.location.href.includes("zed.dev")?"https://code.zed.dev":"https://code.zed.vision";let ne=!0,j="",x=0,xe=0,oe="",ie="",M="",se;async function Me(n,e){try{const t=`https://code.zed.vision/keys/delete/?hash=${e}`,o=await fetch(t,{headers:{"content-type":"application/json;charset=UTF-8",API_KEY:n}});return!0}catch(t){return console.log(t),!1}}async function re(n){try{const e=`https://code.zed.vision/?h=${n}`,t=await fetch(e,{headers:{"content-type":"application/json;charset=UTF-8"}}),o=await t.json();return o.code?o.code:""}catch(e){return console.log(e),""}}async function ve(n){try{const e=`https://code.zed.vision/?h=${n}`,t=await fetch(e,{headers:{"content-type":"application/json;charset=UTF-8"}}),o=await t.json();return o.codeTranspiled?o.codeTranspiled:""}catch(e){return console.log(e),""}}async function ce(){const n=await P(),e=await n.get("uuid");if(!e)if(window.location.href.includes("zed.dev"))n.put("uuid","1234");else{const t=await fetch("https://code.zed.vision/register"),o=await t.json();return n.put("uuid",o.uuid),o.uuid}return e}function ae(n="root"){const e=document.createElement("div"),t=document.getElementById(n);try{V.unmountComponentAtNode(t)}catch(o){console.error("Error in un-mount",o)}t?t.replaceWith(e):document.body.appendChild(e),e.id=n}const Ce=async({onChange:n,code:e,language:t})=>{const o=window.document.getElementById("container");if(!o){const u=document.getElementById("container");u.id="container",document.body.appendChild(u)}const i=t==="typescript"?"file:///main.tsx":"file:///main.html";let c;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)){const u=window.document.createElement("div");u.id="ace",window.document.body.appendChild(u),await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"),t==="typescript"?await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-typescript.min.js"):await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.min.js"),await A("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js"),window.document.getElementById("ace").style.setProperty("display","block"),o.style.setProperty("display","none"),c=window.ace.edit("ace"),c.getSession().setMode("ace/mode/typescript");const p=a=>setTimeout(()=>{let d=window.ace.edit("ace"),y=d.getTheme();y!=="ace/theme/monokai "&&(d.setOptions({fontSize:"14pt"}),d.setTheme("ace/theme/monokai"),p(2*a))},a);p(100),c.setValue(e),c.blur()}if(window.monaco===void 0){const u="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.21.2/min/vs",{require:p}=await A(`${u}/loader.min.js`);p.config({paths:{vs:u}}),await new Promise(a=>p(["vs/editor/editor.main"],d=>{a(d)}))}const r=window.monaco,s={monaco:r,editor:r.editor.create(window.document.getElementById("container"),{formatOnType:!0,scrollbar:{horizontal:"hidden",verticalHasArrows:!0,verticalScrollbarSize:20},minimap:{enabled:!1},folding:!1,multiCursorModifier:"alt",wordWrap:"on",wordWrapBreakAfterCharacters:">([{]))],;} ",mouseWheelZoom:!1,wordWrapColumn:80,automaticLayout:!0,scrollBeyondLastLine:!1,autoIndent:"brackets",autoClosingQuotes:"always",padding:{bottom:300},lineNumbers:"on",autoClosingBrackets:"always",autoClosingOvertype:"always",suggest:{},codeLens:!0,autoSurround:"languageDefined",trimAutoWhitespace:!0,codeActionsOnSaveTimeout:100,model:r.editor.getModel(i)||r.editor.createModel(e,t,r.Uri.parse(i)),value:e,language:t,theme:"vs-dark"})};if(s.editor.onDidChangeModelContent(()=>n(s.editor.getValue())),c&&c.session.on("change",function(){const u=c.getValue();s.editor.setValue(u),n(u)}),c&&document.getElementById("container").replaceWith(document.getElementById("ace")),s.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!0,noSemanticValidation:!0,noSyntaxValidation:!0}),t==="typescript"){const u=[{name:"react",url:"https://unpkg.com/@types/react@17.0.0/index.d.ts",depend:["global","csstype","react-dom","prop-types"]},{name:"global",url:"https://unpkg.com/@types/react@17.0.0/global.d.ts",depend:[]},{name:"prop-types",url:"https://unpkg.com/@types/prop-types@15.7.3/index.d.ts",depend:[]},{name:"react-dom",url:"https://unpkg.com/@types/react-dom@17.0.0/index.d.ts",depend:[]},{name:"csstype",url:"https://unpkg.com/csstype@3.0.5/index.d.ts",depend:[]},{name:"@emotion/styled/base.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/base.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/styled/index.d.ts",url:"https://unpkg.com/@emotion/styled@11.0.0/types/index.d.ts",depend:["@emotion/react","@emotion/serialize","react"]},{name:"@emotion/cache/index.d.ts",url:"https://unpkg.com/@emotion/cache@11.0.0/types/index.d.ts",depend:["@emotion/utils"]},{name:"@emotion/react/index.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/index.d.ts",depend:["@emotion/cache"]},{name:"@emotion/react/jsx-namespace.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/jsx-namespace.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/css-prop.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/css-prop.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/helper.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/helper.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/react/theming.d.ts",url:"https://unpkg.com/@emotion/react@11.1.1/types/theming.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/serialize/index.d.ts",url:"https://unpkg.com/@emotion/serialize@1.0.0/types/index.d.ts",depend:["@emotion/utils","csstype"]},{name:"@emotion/utils/index.d.ts",url:"https://unpkg.com/@emotion/utils@1.0.0/types/index.d.ts",depend:[]},{name:"framer-motion",url:"https://unpkg.com/framer-motion@2.9.5/dist/framer-motion.d.ts",depend:[]},{name:"popmotion",url:"https://unpkg.com/browse/popmotion@9.0.1/lib/index.d.ts"}],p=u.map(({name:a,url:d})=>(async()=>s.monaco.languages.typescript.typescriptDefaults.addExtraLib(await(await fetch(d)).text(),a.includes("@emotion")?`file:///node_modules/${a}`:`file:///node_modules/@types/${a}/index.d.ts`))());return s.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:s.monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,allowUmdGlobalAccess:!0,strict:!0,allowJs:!0,noEmitOnError:!0,allowSyntheticDefaultImports:!0,moduleResolution:s.monaco.languages.typescript.ModuleResolutionKind.Nodejs,module:s.monaco.languages.typescript.ModuleKind.CommonJS,noEmit:!0,typeRoots:["node_modules/@types"],jsx:"react-jsx",esModuleInterop:!0}),await Promise.all(p),s.monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSuggestionDiagnostics:!1,noSemanticValidation:!1,noSyntaxValidation:!1}),s}};async function Ae(n){const e=new TextEncoder().encode(n),t=await he(e);return t.substr(0,8)}function _(n,e){if(!n||!e||n.charAt(0)!==e.charAt(0))return 0;let t=0,o=Math.min(n.length,e.length),i=o,c=0;for(;t<i;)n.substring(c,i)==e.substring(c,i)?(t=i,c=t):o=i,i=Math.floor((o-t)/2+t);return F(n.charCodeAt(i-1))&&i--,i}function K(n,e){if(!n||!e||n.slice(-1)!==e.slice(-1))return 0;let t=0,o=Math.min(n.length,e.length),i=o,c=0;for(;t<i;)n.substring(n.length-i,n.length-c)==e.substring(e.length-i,e.length-c)?(t=i,c=t):o=i,i=Math.floor((o-t)/2+t);return te(n.charCodeAt(n.length-i))&&i--,i}function Ie(n,e){const t=n.length>e.length?n:e,o=n.length>e.length?e:n;if(t.length<4||o.length*2<t.length)return null;function i(h,f,l){const g=h.substring(l,l+Math.floor(h.length/4));let m=-1,w="",b,k,S,E;for(;(m=f.indexOf(g,m+1))!==-1;){const B=_(h.substring(l),f.substring(m)),v=K(h.substring(0,l),f.substring(0,m));w.length<v+B&&(w=f.substring(m-v,m)+f.substring(m,m+B),b=h.substring(0,l-v),k=h.substring(l+B),S=f.substring(0,m-v),E=f.substring(m+B))}return w.length*2>=h.length?[b,k,S,E,w]:null}const c=i(t,o,Math.ceil(t.length/4)),r=i(t,o,Math.ceil(t.length/2));let s;if(r===null&&c===null)return null;if(r===null){if(c===null)return null;s=c}else if(c===null){if(r===null)return null;s=r}else s=c[4].length>r[4].length?c:r;let u,p,a,d;n.length>e.length?(u=s[0],p=s[1],a=s[2],d=s[3]):(a=s[0],d=s[1],u=s[2],p=s[3]);const y=s[4];return[u,p,a,d,y]}function le(n){const e=[...n];e.push([0,""]);let t=0,o=0,i=0,c="",r="",s,u;for(;t<e.length;){if(t<e.length-1&&!e[t][1]){e.splice(t,1);continue}switch(e[t][0]){case 1:i++,r+=e[t][1],t++;break;case D:o++,c+=e[t][1],t++;break;case 0:if(u=t-i-o-1,t<e.length-1&&!e[t][1]){e.splice(t,1);break}if(c.length>0||r.length>0){c.length>0&&r.length>0&&(s=_(r,c),s!==0&&(u>=0?e[u][1]+=r.substring(0,s):(e.splice(0,0,[0,r.substring(0,s)]),t++),r=r.substring(s),c=c.substring(s)),s=K(r,c),s!==0&&(e[t][1]=r.substring(r.length-s)+e[t][1],r=r.substring(0,r.length-s),c=c.substring(0,c.length-s)));const a=i+o;c.length===0&&r.length===0?(e.splice(t-a,a),t=t-a):c.length===0?(e.splice(t-a,a,[1,r]),t=t-a+1):r.length===0?(e.splice(t-a,a,[D,c]),t=t-a+1):(e.splice(t-a,a,[D,c],[1,r]),t=t-a+2)}t!==0&&e[t-1][0]===0?(e[t-1][1]+=e[t][1],e.splice(t,1)):t++,i=0,o=0,c="",r="";break}}e[e.length-1][1]===""&&e.pop();let p=!1;for(t=1;t<e.length-1;)e[t-1][0]===0&&e[t+1][0]===0&&(e[t][1].substring(e[t][1].length-e[t-1][1].length)===e[t-1][1]?(e[t][1]=e[t-1][1]+e[t][1].substring(0,e[t][1].length-e[t-1][1].length),e[t+1][1]=e[t-1][1]+e[t+1][1],e.splice(t-1,1),p=!0):e[t][1].substring(0,e[t+1][1].length)==e[t+1][1]&&(e[t-1][1]+=e[t+1][1],e[t][1]=e[t][1].substring(e[t+1][1].length)+e[t+1][1],e.splice(t+1,1),p=!0)),t++;return p?le(e):e}export const getProjects=async()=>{const n=await ce(),e=await P(),t=await e.get(n,"json");return t||(await e.put(n,JSON.stringify([])),[])};function Te(n){const e=new Promise((t,o)=>{const i=()=>{n.removeEventListener("success",c),n.removeEventListener("error",r)},c=()=>{t(I(n.result)),i()},r=()=>{o(n.error),i()};n.addEventListener("success",c),n.addEventListener("error",r)});return e.then(t=>{t instanceof IDBCursor&&Y.set(t,n)}).catch(()=>{}),W.set(e,n),e}let q={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return R.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Z.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return I(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Oe(n){q=n(q)}function Le(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const o=n.call(H(this),e,...t);return Z.set(o,e.sort?e.sort():[e]),I(o)}:ye().includes(n)?function(...e){return n.apply(H(this),e),I(Y.get(this))}:function(...e){return I(n.apply(H(this),e))}}function Pe(n){return typeof n=="function"?Le(n):(n instanceof IDBTransaction&&be(n),ge(n,we())?new Proxy(n,q):n)}function I(n){if(n instanceof IDBRequest)return Te(n);if(z.has(n))return z.get(n);const e=Pe(n);return e!==n&&(z.set(n,e),W.set(e,n)),e}Oe(n=>({...n,get:(e,t,o)=>ee(e,t)||n.get(e,t,o),has:(e,t)=>!!ee(e,t)||n.has(e,t)}));function T({text1:n,text2:e,cursorPos:t}){if(n===e)return n?[[0,n]]:[];if(t){const s=je(n,e,t);if(s)return s}let o=_(n,e);const i=n.substring(0,o);n=n.substring(o),e=e.substring(o),o=K(n,e);const c=n.substring(n.length-o);n=n.substring(0,n.length-o),e=e.substring(0,e.length-o);const r=Re(n,e);return i&&r.unshift([0,i]),c&&r.push([0,c]),le(r),r}function Re(n,e){let t;if(!n)return[[1,e]];if(!e)return[[D,n]];const o=n.length>e.length?n:e,i=n.length>e.length?e:n,c=o.indexOf(i);if(c!==-1)return t=[[1,o.substring(0,c)],[0,i],[1,o.substring(c+i.length)]],n.length>e.length&&(t[0][0]=t[2][0]=D),t;if(i.length===1)return[[D,n],[1,e]];const r=Ie(n,e);if(r){const s=r[0]||"",u=r[1]||"",p=r[2]||"",a=r[3]||"",d=r[4]||"",y=T({text1:s,text2:p,cursorPos:0}),h=T({text1:u,text2:a,cursorPos:0});return y.concat([[0,d[1]]],h)}return ze(n,e)}function ze(n,e){const t=n.length,o=e.length,i=Math.ceil((t+o)/2),c=i,r=2*i,s=new Array(r),u=new Array(r);for(let l=0;l<r;l++)s[l]=-1,u[l]=-1;s[i+1]=0,u[i+1]=0;const p=t-o,a=p%2!==0;let d=0,y=0,h=0,f=0;for(let l=0;l<i;l++){for(let m=-l+d;m<=l-y;m+=2){const w=i+m;let b;m===-l||m!==l&&s[w-1]<s[w+1]?b=s[w+1]:b=s[w-1]+1;let k=b-m;for(;b<t&&k<o&&n.charAt(b)===e.charAt(k);)b++,k++;if(s[w]=b,b>t)y+=2;else if(k>o)d+=2;else if(a){const S=i+p-m;if(S>=0&&S<r&&u[S]!==-1){const E=t-u[S];if(b>=E)return de(n,e,b,k)}}}let g;for(let m=-l+h;m<=l-f;m+=2){const w=i+m;m===-l||m!==l&&u[w-1]<u[w+1]?g=u[w+1]:g=u[w-1]+1;let b=g-m;for(;g<t&&b<o&&n.charAt(t-g-1)===e.charAt(o-b-1);)g++,b++;if(u[w]=g,g>t)f+=2;else if(b>o)h+=2;else if(!a){const k=i+p-m;if(k>=0&&k<r&&s[k]!==-1){const S=s[k],E=i+S-k;if(g=t-g,S>=g)return de(n,e,S,E)}}}}return[[D,n],[1,e]]}function de(n,e,t,o){const i=n.substring(0,t),c=e.substring(0,o),r=n.substring(t),s=e.substring(o),u=T({text1:i,text2:c,cursorPos:0}),p=T({text1:r,text2:s,cursorPos:0});return u.concat(p)}function O(n,e,t){return T({text1:n,text2:e,cursorPos:t})}export async function run(n="window"){const e=await P(),t=await ce();async function o(a,d,y=!1){const h=await L(a,d);h.map(f=>f.name).map(async f=>{const l=await re(f);if(!l)return"";const g=await ve(f);ae("root");let m;try{if(m=p(l),m!==g){const w=/setInterval/gi,b="///",k=/debugger/gi,S="///";V.unmountComponentAtNode(document.getElementById("root")),i(m.replaceAll(w,b).replaceAll(k,S));const E=document.getElementById("root").innerHTML;ae("root"),i(g.replaceAll(w,b).replaceAll(k,S));const B=document.getElementById("root").innerHTML;B!==E&&(console.log({hash:f,code:l,html1:B,html2:E,transpiled1:g,transpiled2:m}),y&&await Me(a,f))}}catch(w){console.error({hash:f,code:l,transpiled:m})}})}Object.assign(window,{getKeys:L,getCode:re,restartCode:i,regenerate:o}),n==="editor"&&pe(),n=="window"&&me(async()=>{const a=await se();window.open(a)}),await fe("https://unpkg.com/@babel/standalone@7.12.9/babel.min.js"),(async()=>{const a=await c();M=a;const d=await Ce({language:"typescript",code:a,onChange:y});function y(l){if(!d)return;if(j=l,!x)f(j);else{const g=l,m=setInterval(()=>{(l!==j||!x)&&clearInterval(m),x||f(j)},100)}}async function h(){if(!d||!d.monaco)return;const l=d.monaco.Uri.parse("file:///main.tsx"),g=await d.monaco.languages.typescript.getTypeScriptWorker(),m=await(await g(l)).getSemanticDiagnostics("file:///main.tsx"),w=await(await g(l)).getCompilerOptionsDiagnostics("file:///main.tsx"),b=await(await g(l)).getSyntacticDiagnostics("file:///main.tsx");return[...m,...w,...b]}async function f(l){if(x===1)return;try{x=1;const g=await h(),m=document.getElementById("error");if(x=0,l!==j)return;if(g&&g.length){if(j!=l)return;if(oe===l)return;const w=O(M,l,0);if(w.length<=3){d.monaco.editor.setTheme("hc-black");return}m.innerHTML=g[0].messageText.toString(),m.style.display="block",oe=l;return}M=l,m.style.display="none",d.monaco.editor.setTheme("vs-dark"),xe=0,x=0,i(p(l))}catch(g){if(x=0,l!==j)return;d.monaco.editor.setTheme("vs-light"),setTimeout(()=>{d.monaco.editor.setTheme("hc-black")},50),console.error(g)}}})(),i(p(await c()));async function i(a){const d=/import/gi,y="///",h=`
    Object.assign(window, React);
    if (window.Motion) {
        Object.assign(window, window.Motion);
    }
    if (window.emotionStyled){
      window.styled= window.emotionStyled;
    }
    ;
    `+a.replaceAll(d,y).replace("export default","DefaultElement = "),f=async()=>{const l=new Function("code",`return function(){  
          let DefaultElement;
        
        ${h}

                return ReactDOM.render(jsx(DefaultElement), document.getElementById("root"));
      }`)();l(),se=async()=>{const g=new Function("code",`return function(){
            let DefaultElement;
  
          ${h}
  
                  return ReactDOMServer.renderToString(jsx(DefaultElement));
        }`)(),m=g(),w=Array.from(document.querySelector("head > style[data-emotion=css]").sheet.cssRules).map(C=>C.cssText).filter(C=>m.includes(C.substring(3,8))).join(`
  `);let b;if(h.includes("body{")){const C=h.indexOf("body{"),J=h.slice(C),ue=J.indexOf("}");b=J.slice(0,ue+1)}let k="",S="";h.includes("Motion")&&(k='<script crossorigin src="https://unpkg.com/framer-motion@2.9.5/dist/framer-motion.js"></script>',S="const {motion} = Motion");const E=`<!DOCTYPE html>
        <html lang="en">
        <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <head profile="http://www.w3.org/2005/10/profile">
        <link rel="icon" 
              type="image/png"
              href="https://zed.vision/favicon.ico">
        <style>
        ${b}
        ${w}
        </style>
        </head>
        <body>
        <div id="root">
        ${m}
        </div>
        <script crossorigin src="https://unpkg.com/react@17.0.1/umd/react.production.min.js"></script>
        ${k}
        <script crossorigin src="https://unpkg.com/react-dom@17.0.1/umd/react-dom.production.min.js"></script>
        <script crossorigin src="https://unpkg.com/@emotion/react@11.1.1/dist/emotion-react.umd.min.js"></script>
        <script crossorigin src="https://unpkg.com/@emotion/styled@11.0.0/dist/emotion-styled.umd.min.js"></script>
        <script type="module">
        Object.assign(window, emotionReact);

       const styled = window["emotionStyled"];

        let DefaultElement;

        ${h}

        ReactDOM.hydrate(jsx(DefaultElement), document.body.children[0]);
        </script>
        </body>
        </html>
        `,B=await s(E),v=await u(B);return v}};if(!ne){const l=async g=>{if(!location.origin.includes("zed."))return;if(g!==M)return;if(ie===g)return;ie=g;const m={codeTranspiled:p(M),code:M},w=JSON.stringify(m),b=new Request(N(),{body:w,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}),k=fetch(b),S=await Ae(w);try{const E=await e.get("codeBoXHash2");E!==S&&(await e.put("codeBoXHash2",S),await e.put(S,M),r("h",S))}catch(E){}await k};l(j)}ne=!1,f()}async function c(){const a=new URLSearchParams(window.location.search),d=a.get("h")||await e.get("codeBoXHash2");if(d){const y=await e.get(d);if(y)return y;let h;try{const f=await fetch(N()+"/?h="+d);h=await f.json()}catch(f){return console.error(f),G}return h.code}return G}function r(a,d){const y=new URLSearchParams(window.location.search);y.set(a,d),window.history.replaceState({},"",decodeURIComponent(`${window.location.pathname}?${y}`))}function s(a){const d=new Blob([a],{type:"text/html"});return d}async function u(a){const d=N(),y=new Request(d,{body:a,method:"POST",headers:{"content-type":"text/html;charset=UTF-8",SHARE:"true"}}),h=await fetch(y),{hash:f}=await h.json();return`${d}/${f}`}function p(a){const{transform:d}=window.Babel;return d(`/** @jsx jsx */

  Object.assign(window, React);
  `+a,{plugins:[],presets:["react",["typescript",{isTSX:!0,allExtensions:!0}]]}).code}}
