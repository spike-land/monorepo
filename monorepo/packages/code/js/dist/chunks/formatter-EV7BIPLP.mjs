import "./chunk-XHYF4LCB.mjs";

// js/dist/workers/js/workers/prettier.worker.js
var prettier_worker_default = "data:text/javascript;charset=utf-8;base64,KCgpID0+IHsKICB2YXIgX19jcmVhdGUgPSBPYmplY3QuY3JlYXRlOwogIHZhciBfX2RlZlByb3AgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7CiAgdmFyIF9fZ2V0T3duUHJvcERlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwogIHZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwogIHZhciBfX2dldFByb3RvT2YgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Y7CiAgdmFyIF9faGFzT3duUHJvcCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CiAgdmFyIF9fbWFya0FzTW9kdWxlID0gKHRhcmdldCkgPT4gX19kZWZQcm9wKHRhcmdldCwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogIHZhciBfX2NvbW1vbkpTID0gKGNiLCBtb2QpID0+IGZ1bmN0aW9uIF9fcmVxdWlyZSgpIHsKICAgIHJldHVybiBtb2QgfHwgKDAsIGNiW19fZ2V0T3duUHJvcE5hbWVzKGNiKVswXV0pKChtb2QgPSB7IGV4cG9ydHM6IHt9IH0pLmV4cG9ydHMsIG1vZCksIG1vZC5leHBvcnRzOwogIH07CiAgdmFyIF9fcmVFeHBvcnQgPSAodGFyZ2V0LCBtb2R1bGUsIGNvcHlEZWZhdWx0LCBkZXNjKSA9PiB7CiAgICBpZiAobW9kdWxlICYmIHR5cGVvZiBtb2R1bGUgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBtb2R1bGUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgZm9yIChsZXQga2V5IG9mIF9fZ2V0T3duUHJvcE5hbWVzKG1vZHVsZSkpCiAgICAgICAgaWYgKCFfX2hhc093blByb3AuY2FsbCh0YXJnZXQsIGtleSkgJiYgKGNvcHlEZWZhdWx0IHx8IGtleSAhPT0gImRlZmF1bHQiKSkKICAgICAgICAgIF9fZGVmUHJvcCh0YXJnZXQsIGtleSwgeyBnZXQ6ICgpID0+IG1vZHVsZVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKG1vZHVsZSwga2V5KSkgfHwgZGVzYy5lbnVtZXJhYmxlIH0pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwogIHZhciBfX3RvRVNNID0gKG1vZHVsZSwgaXNOb2RlTW9kZSkgPT4gewogICAgcmV0dXJuIF9fcmVFeHBvcnQoX19tYXJrQXNNb2R1bGUoX19kZWZQcm9wKG1vZHVsZSAhPSBudWxsID8gX19jcmVhdGUoX19nZXRQcm90b09mKG1vZHVsZSkpIDoge30sICJkZWZhdWx0IiwgIWlzTm9kZU1vZGUgJiYgbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID8geyBnZXQ6ICgpID0+IG1vZHVsZS5kZWZhdWx0LCBlbnVtZXJhYmxlOiB0cnVlIH0gOiB7IHZhbHVlOiBtb2R1bGUsIGVudW1lcmFibGU6IHRydWUgfSkpLCBtb2R1bGUpOwogIH07CgogIC8vIC4uLy4uL25vZGVfbW9kdWxlcy9wcmV0dGllci9zdGFuZGFsb25lLmpzCiAgdmFyIHJlcXVpcmVfc3RhbmRhbG9uZSA9IF9fY29tbW9uSlMoewogICAgIi4uLy4uL25vZGVfbW9kdWxlcy9wcmV0dGllci9zdGFuZGFsb25lLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgIWZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICB0eXBlb2YgZXhwb3J0cyA9PSAib2JqZWN0IiAmJiB0eXBlb2YgbW9kdWxlICE9ICJ1bmRlZmluZWQiID8gbW9kdWxlLmV4cG9ydHMgPSB0KCkgOiB0eXBlb2YgZGVmaW5lID09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCA/IGRlZmluZSh0KSA6IChlID0gdHlwZW9mIGdsb2JhbFRoaXMgIT0gInVuZGVmaW5lZCIgPyBnbG9iYWxUaGlzIDogZSB8fCBzZWxmKS5wcmV0dGllciA9IHQoKTsKICAgICAgfShleHBvcnRzLCBmdW5jdGlvbigpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIGUgPSB0eXBlb2YgZ2xvYmFsVGhpcyAhPSAidW5kZWZpbmVkIiA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9ICJ1bmRlZmluZWQiID8gd2luZG93IDogdHlwZW9mIGdsb2JhbCAhPSAidW5kZWZpbmVkIiA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9ICJ1bmRlZmluZWQiID8gc2VsZiA6IHt9OwogICAgICAgIGZ1bmN0aW9uIHQoZTIpIHsKICAgICAgICAgIHJldHVybiBlMiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZTIsICJkZWZhdWx0IikgPyBlMi5kZWZhdWx0IDogZTI7CiAgICAgICAgfQogICAgICAgIHZhciBuID0geyB2ZXJzaW9uOiAiMi41LjEiIH0sIHIgPSB7fSwgbyA9IHt9OwogICAgICAgICFmdW5jdGlvbihlMikgewogICAgICAgICAgZnVuY3Rpb24gdDIoKSB7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBuMihlMywgdDMsIG4zLCByMywgbzIpIHsKICAgICAgICAgICAgZm9yICh2YXIgaTIgPSAwLCB1MiA9IHQzLmxlbmd0aCwgczIgPSAwLCBhMiA9IDA7IGkyIDwgdTI7IGkyKyspIHsKICAgICAgICAgICAgICB2YXIgYzIgPSB0M1tpMl07CiAgICAgICAgICAgICAgaWYgKGMyLnJlbW92ZWQpIHsKICAgICAgICAgICAgICAgIGlmIChjMi52YWx1ZSA9IGUzLmpvaW4ocjMuc2xpY2UoYTIsIGEyICsgYzIuY291bnQpKSwgYTIgKz0gYzIuY291bnQsIGkyICYmIHQzW2kyIC0gMV0uYWRkZWQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGwyID0gdDNbaTIgLSAxXTsKICAgICAgICAgICAgICAgICAgdDNbaTIgLSAxXSA9IHQzW2kyXSwgdDNbaTJdID0gbDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICghYzIuYWRkZWQgJiYgbzIpIHsKICAgICAgICAgICAgICAgICAgdmFyIHAyID0gbjMuc2xpY2UoczIsIHMyICsgYzIuY291bnQpOwogICAgICAgICAgICAgICAgICBwMiA9IHAyLm1hcChmdW5jdGlvbihlNCwgdDQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbjQgPSByM1thMiArIHQ0XTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbjQubGVuZ3RoID4gZTQubGVuZ3RoID8gbjQgOiBlNDsKICAgICAgICAgICAgICAgICAgfSksIGMyLnZhbHVlID0gZTMuam9pbihwMik7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgYzIudmFsdWUgPSBlMy5qb2luKG4zLnNsaWNlKHMyLCBzMiArIGMyLmNvdW50KSk7CiAgICAgICAgICAgICAgICBzMiArPSBjMi5jb3VudCwgYzIuYWRkZWQgfHwgKGEyICs9IGMyLmNvdW50KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGYyID0gdDNbdTIgLSAxXTsKICAgICAgICAgICAgcmV0dXJuIHUyID4gMSAmJiB0eXBlb2YgZjIudmFsdWUgPT0gInN0cmluZyIgJiYgKGYyLmFkZGVkIHx8IGYyLnJlbW92ZWQpICYmIGUzLmVxdWFscygiIiwgZjIudmFsdWUpICYmICh0M1t1MiAtIDJdLnZhbHVlICs9IGYyLnZhbHVlLCB0My5wb3AoKSksIHQzOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gcjIoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIHsgbmV3UG9zOiBlMy5uZXdQb3MsIGNvbXBvbmVudHM6IGUzLmNvbXBvbmVudHMuc2xpY2UoMCkgfTsKICAgICAgICAgIH0KICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCBlMi5kZWZhdWx0ID0gdDIsIHQyLnByb3RvdHlwZSA9IHsgZGlmZjogZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIHZhciBvMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzJdIDoge30sIGkyID0gbzIuY2FsbGJhY2s7CiAgICAgICAgICAgIHR5cGVvZiBvMiA9PSAiZnVuY3Rpb24iICYmIChpMiA9IG8yLCBvMiA9IHt9KSwgdGhpcy5vcHRpb25zID0gbzI7CiAgICAgICAgICAgIHZhciB1MiA9IHRoaXM7CiAgICAgICAgICAgIGZ1bmN0aW9uIHMyKGU0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGkyID8gKHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpMih2b2lkIDAsIGU0KTsKICAgICAgICAgICAgICB9LCAwKSwgdHJ1ZSkgOiBlNDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlMyA9IHRoaXMuY2FzdElucHV0KGUzKSwgdDMgPSB0aGlzLmNhc3RJbnB1dCh0MyksIGUzID0gdGhpcy5yZW1vdmVFbXB0eSh0aGlzLnRva2VuaXplKGUzKSk7CiAgICAgICAgICAgIHZhciBhMiA9ICh0MyA9IHRoaXMucmVtb3ZlRW1wdHkodGhpcy50b2tlbml6ZSh0MykpKS5sZW5ndGgsIGMyID0gZTMubGVuZ3RoLCBsMiA9IDEsIHAyID0gYTIgKyBjMiwgZjIgPSBbeyBuZXdQb3M6IC0xLCBjb21wb25lbnRzOiBbXSB9XSwgZDIgPSB0aGlzLmV4dHJhY3RDb21tb24oZjJbMF0sIHQzLCBlMywgMCk7CiAgICAgICAgICAgIGlmIChmMlswXS5uZXdQb3MgKyAxID49IGEyICYmIGQyICsgMSA+PSBjMikKICAgICAgICAgICAgICByZXR1cm4gczIoW3sgdmFsdWU6IHRoaXMuam9pbih0MyksIGNvdW50OiB0My5sZW5ndGggfV0pOwogICAgICAgICAgICBmdW5jdGlvbiBoMigpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBvMyA9IC0xICogbDI7IG8zIDw9IGwyOyBvMyArPSAyKSB7CiAgICAgICAgICAgICAgICB2YXIgaTMgPSB2b2lkIDAsIHAzID0gZjJbbzMgLSAxXSwgZDMgPSBmMltvMyArIDFdLCBoMyA9IChkMyA/IGQzLm5ld1BvcyA6IDApIC0gbzM7CiAgICAgICAgICAgICAgICBwMyAmJiAoZjJbbzMgLSAxXSA9IHZvaWQgMCk7CiAgICAgICAgICAgICAgICB2YXIgZzMgPSBwMyAmJiBwMy5uZXdQb3MgKyAxIDwgYTIsIG0yID0gZDMgJiYgMCA8PSBoMyAmJiBoMyA8IGMyOwogICAgICAgICAgICAgICAgaWYgKGczIHx8IG0yKSB7CiAgICAgICAgICAgICAgICAgIGlmICghZzMgfHwgbTIgJiYgcDMubmV3UG9zIDwgZDMubmV3UG9zID8gKGkzID0gcjIoZDMpLCB1Mi5wdXNoQ29tcG9uZW50KGkzLmNvbXBvbmVudHMsIHZvaWQgMCwgdHJ1ZSkpIDogKChpMyA9IHAzKS5uZXdQb3MrKywgdTIucHVzaENvbXBvbmVudChpMy5jb21wb25lbnRzLCB0cnVlLCB2b2lkIDApKSwgaDMgPSB1Mi5leHRyYWN0Q29tbW9uKGkzLCB0MywgZTMsIG8zKSwgaTMubmV3UG9zICsgMSA+PSBhMiAmJiBoMyArIDEgPj0gYzIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMyKG4yKHUyLCBpMy5jb21wb25lbnRzLCB0MywgZTMsIHUyLnVzZUxvbmdlc3RUb2tlbikpOwogICAgICAgICAgICAgICAgICBmMltvM10gPSBpMzsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICBmMltvM10gPSB2b2lkIDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGwyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGkyKQogICAgICAgICAgICAgICFmdW5jdGlvbiBlNCgpIHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIGlmIChsMiA+IHAyKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpMigpOwogICAgICAgICAgICAgICAgICBoMigpIHx8IGU0KCk7CiAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgICB9KCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICBmb3IgKDsgbDIgPD0gcDI7ICkgewogICAgICAgICAgICAgICAgdmFyIGcyID0gaDIoKTsKICAgICAgICAgICAgICAgIGlmIChnMikKICAgICAgICAgICAgICAgICAgcmV0dXJuIGcyOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHB1c2hDb21wb25lbnQ6IGZ1bmN0aW9uKGUzLCB0MywgbjMpIHsKICAgICAgICAgICAgdmFyIHIzID0gZTNbZTMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIHIzICYmIHIzLmFkZGVkID09PSB0MyAmJiByMy5yZW1vdmVkID09PSBuMyA/IGUzW2UzLmxlbmd0aCAtIDFdID0geyBjb3VudDogcjMuY291bnQgKyAxLCBhZGRlZDogdDMsIHJlbW92ZWQ6IG4zIH0gOiBlMy5wdXNoKHsgY291bnQ6IDEsIGFkZGVkOiB0MywgcmVtb3ZlZDogbjMgfSk7CiAgICAgICAgICB9LCBleHRyYWN0Q29tbW9uOiBmdW5jdGlvbihlMywgdDMsIG4zLCByMykgewogICAgICAgICAgICBmb3IgKHZhciBvMiA9IHQzLmxlbmd0aCwgaTIgPSBuMy5sZW5ndGgsIHUyID0gZTMubmV3UG9zLCBzMiA9IHUyIC0gcjMsIGEyID0gMDsgdTIgKyAxIDwgbzIgJiYgczIgKyAxIDwgaTIgJiYgdGhpcy5lcXVhbHModDNbdTIgKyAxXSwgbjNbczIgKyAxXSk7ICkKICAgICAgICAgICAgICB1MisrLCBzMisrLCBhMisrOwogICAgICAgICAgICByZXR1cm4gYTIgJiYgZTMuY29tcG9uZW50cy5wdXNoKHsgY291bnQ6IGEyIH0pLCBlMy5uZXdQb3MgPSB1MiwgczI7CiAgICAgICAgICB9LCBlcXVhbHM6IGZ1bmN0aW9uKGUzLCB0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmNvbXBhcmF0b3IgPyB0aGlzLm9wdGlvbnMuY29tcGFyYXRvcihlMywgdDMpIDogZTMgPT09IHQzIHx8IHRoaXMub3B0aW9ucy5pZ25vcmVDYXNlICYmIGUzLnRvTG93ZXJDYXNlKCkgPT09IHQzLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICB9LCByZW1vdmVFbXB0eTogZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgZm9yICh2YXIgdDMgPSBbXSwgbjMgPSAwOyBuMyA8IGUzLmxlbmd0aDsgbjMrKykKICAgICAgICAgICAgICBlM1tuM10gJiYgdDMucHVzaChlM1tuM10pOwogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9LCBjYXN0SW5wdXQ6IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMzsKICAgICAgICAgIH0sIHRva2VuaXplOiBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gZTMuc3BsaXQoIiIpOwogICAgICAgICAgfSwgam9pbjogZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzLmpvaW4oIiIpOwogICAgICAgICAgfSB9OwogICAgICAgIH0obyk7CiAgICAgICAgdmFyIGksIHUgPSB7fTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCB1LmRpZmZDaGFycyA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBzLmRpZmYoZTIsIHQyLCBuMik7CiAgICAgICAgfSwgdS5jaGFyYWN0ZXJEaWZmID0gdm9pZCAwOwogICAgICAgIHZhciBzID0gbmV3ICgoaSA9IG8pICYmIGkuX19lc01vZHVsZSA/IGkgOiB7IGRlZmF1bHQ6IGkgfSkuZGVmYXVsdCgpOwogICAgICAgIHUuY2hhcmFjdGVyRGlmZiA9IHM7CiAgICAgICAgdmFyIGEgPSB7fSwgYyA9IHt9OwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIGMuZ2VuZXJhdGVPcHRpb25zID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGUyID09ICJmdW5jdGlvbiIpCiAgICAgICAgICAgIHQyLmNhbGxiYWNrID0gZTI7CiAgICAgICAgICBlbHNlIGlmIChlMikKICAgICAgICAgICAgZm9yICh2YXIgbjIgaW4gZTIpCiAgICAgICAgICAgICAgZTIuaGFzT3duUHJvcGVydHkobjIpICYmICh0MltuMl0gPSBlMltuMl0pOwogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0sIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIGEuZGlmZldvcmRzID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIG4yID0gKDAsIHAuZ2VuZXJhdGVPcHRpb25zKShuMiwgeyBpZ25vcmVXaGl0ZXNwYWNlOiB0cnVlIH0pLCBoLmRpZmYoZTIsIHQyLCBuMik7CiAgICAgICAgfSwgYS5kaWZmV29yZHNXaXRoU3BhY2UgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gaC5kaWZmKGUyLCB0MiwgbjIpOwogICAgICAgIH0sIGEud29yZERpZmYgPSB2b2lkIDA7CiAgICAgICAgdmFyIGwgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyICYmIGUyLl9fZXNNb2R1bGUgPyBlMiA6IHsgZGVmYXVsdDogZTIgfTsKICAgICAgICB9KG8pLCBwID0gYzsKICAgICAgICB2YXIgZiA9IC9eW0EtWmEtelx4QzAtXHUwMkM2XHUwMkM4LVx1MDJEN1x1MDJERS1cdTAyRkZcdTFFMDAtXHUxRUZGXSskLywgZCA9IC9cUy8sIGggPSBuZXcgbC5kZWZhdWx0KCk7CiAgICAgICAgYS53b3JkRGlmZiA9IGgsIGguZXF1YWxzID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmlnbm9yZUNhc2UgJiYgKGUyID0gZTIudG9Mb3dlckNhc2UoKSwgdDIgPSB0Mi50b0xvd2VyQ2FzZSgpKSwgZTIgPT09IHQyIHx8IHRoaXMub3B0aW9ucy5pZ25vcmVXaGl0ZXNwYWNlICYmICFkLnRlc3QoZTIpICYmICFkLnRlc3QodDIpOwogICAgICAgIH0sIGgudG9rZW5pemUgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgZm9yICh2YXIgdDIgPSBlMi5zcGxpdCgvKFteXFNcclxuXSt8WygpW1xde30nIlxyXG5dfFxiKS8pLCBuMiA9IDA7IG4yIDwgdDIubGVuZ3RoIC0gMTsgbjIrKykKICAgICAgICAgICAgIXQyW24yICsgMV0gJiYgdDJbbjIgKyAyXSAmJiBmLnRlc3QodDJbbjJdKSAmJiBmLnRlc3QodDJbbjIgKyAyXSkgJiYgKHQyW24yXSArPSB0MltuMiArIDJdLCB0Mi5zcGxpY2UobjIgKyAxLCAyKSwgbjItLSk7CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfTsKICAgICAgICB2YXIgZyA9IHt9OwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShnLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIGcuZGlmZkxpbmVzID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIEQuZGlmZihlMiwgdDIsIG4yKTsKICAgICAgICB9LCBnLmRpZmZUcmltbWVkTGluZXMgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICB2YXIgcjIgPSAoMCwgeS5nZW5lcmF0ZU9wdGlvbnMpKG4yLCB7IGlnbm9yZVdoaXRlc3BhY2U6IHRydWUgfSk7CiAgICAgICAgICByZXR1cm4gRC5kaWZmKGUyLCB0MiwgcjIpOwogICAgICAgIH0sIGcubGluZURpZmYgPSB2b2lkIDA7CiAgICAgICAgdmFyIG0gPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyICYmIGUyLl9fZXNNb2R1bGUgPyBlMiA6IHsgZGVmYXVsdDogZTIgfTsKICAgICAgICB9KG8pLCB5ID0gYzsKICAgICAgICB2YXIgRCA9IG5ldyBtLmRlZmF1bHQoKTsKICAgICAgICBnLmxpbmVEaWZmID0gRCwgRC50b2tlbml6ZSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSBbXSwgbjIgPSBlMi5zcGxpdCgvKFxufFxyXG4pLyk7CiAgICAgICAgICBuMltuMi5sZW5ndGggLSAxXSB8fCBuMi5wb3AoKTsKICAgICAgICAgIGZvciAodmFyIHIyID0gMDsgcjIgPCBuMi5sZW5ndGg7IHIyKyspIHsKICAgICAgICAgICAgdmFyIG8yID0gbjJbcjJdOwogICAgICAgICAgICByMiAlIDIgJiYgIXRoaXMub3B0aW9ucy5uZXdsaW5lSXNUb2tlbiA/IHQyW3QyLmxlbmd0aCAtIDFdICs9IG8yIDogKHRoaXMub3B0aW9ucy5pZ25vcmVXaGl0ZXNwYWNlICYmIChvMiA9IG8yLnRyaW0oKSksIHQyLnB1c2gobzIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9OwogICAgICAgIHZhciBFID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEUsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KSwgRS5kaWZmU2VudGVuY2VzID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIGIuZGlmZihlMiwgdDIsIG4yKTsKICAgICAgICB9LCBFLnNlbnRlbmNlRGlmZiA9IHZvaWQgMDsKICAgICAgICB2YXIgQyA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgZTIuX19lc01vZHVsZSA/IGUyIDogeyBkZWZhdWx0OiBlMiB9OwogICAgICAgIH0obyk7CiAgICAgICAgdmFyIGIgPSBuZXcgQy5kZWZhdWx0KCk7CiAgICAgICAgRS5zZW50ZW5jZURpZmYgPSBiLCBiLnRva2VuaXplID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5zcGxpdCgvKFxTLis/Wy4hP10pKD89XHMrfCQpLyk7CiAgICAgICAgfTsKICAgICAgICB2YXIgdiA9IHt9OwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh2LCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIHYuZGlmZkNzcyA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBGLmRpZmYoZTIsIHQyLCBuMik7CiAgICAgICAgfSwgdi5jc3NEaWZmID0gdm9pZCAwOwogICAgICAgIHZhciBBID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMiAmJiBlMi5fX2VzTW9kdWxlID8gZTIgOiB7IGRlZmF1bHQ6IGUyIH07CiAgICAgICAgfShvKTsKICAgICAgICB2YXIgRiA9IG5ldyBBLmRlZmF1bHQoKTsKICAgICAgICB2LmNzc0RpZmYgPSBGLCBGLnRva2VuaXplID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5zcGxpdCgvKFt7fTo7LF18XHMrKS8pOwogICAgICAgIH07CiAgICAgICAgdmFyIHggPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyICYmIGUyLk1hdGggPT0gTWF0aCAmJiBlMjsKICAgICAgICB9LCBTID0geCh0eXBlb2YgZ2xvYmFsVGhpcyA9PSAib2JqZWN0IiAmJiBnbG9iYWxUaGlzKSB8fCB4KHR5cGVvZiB3aW5kb3cgPT0gIm9iamVjdCIgJiYgd2luZG93KSB8fCB4KHR5cGVvZiBzZWxmID09ICJvYmplY3QiICYmIHNlbGYpIHx8IHgodHlwZW9mIGUgPT0gIm9iamVjdCIgJiYgZSkgfHwgZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9KCkgfHwgRnVuY3Rpb24oInJldHVybiB0aGlzIikoKSwgdyA9IHt9LCBUID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAhIWUyKCk7CiAgICAgICAgICB9IGNhdGNoIChlMykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9LCBCID0gIVQoZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAxLCB7IGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiA3OwogICAgICAgICAgfSB9KVsxXSAhPSA3OwogICAgICAgIH0pLCBOID0gRnVuY3Rpb24ucHJvdG90eXBlLmNhbGwsIGsgPSBOLmJpbmQgPyBOLmJpbmQoTikgOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBOLmFwcGx5KE4sIGFyZ3VtZW50cyk7CiAgICAgICAgfSwgUCA9IHt9LCBPID0ge30ucHJvcGVydHlJc0VudW1lcmFibGUsIEkgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLCBMID0gSSAmJiAhTy5jYWxsKHsgMTogMiB9LCAxKTsKICAgICAgICBQLmYgPSBMID8gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IEkodGhpcywgZTIpOwogICAgICAgICAgcmV0dXJuICEhdDIgJiYgdDIuZW51bWVyYWJsZTsKICAgICAgICB9IDogTzsKICAgICAgICB2YXIgaiwgXywgTSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHsgZW51bWVyYWJsZTogISgxICYgZTIpLCBjb25maWd1cmFibGU6ICEoMiAmIGUyKSwgd3JpdGFibGU6ICEoNCAmIGUyKSwgdmFsdWU6IHQyIH07CiAgICAgICAgfSwgUiA9IEZ1bmN0aW9uLnByb3RvdHlwZSwgViA9IFIuYmluZCwgJCA9IFIuY2FsbCwgVyA9IFYgJiYgVi5iaW5kKCQpLCBxID0gViA/IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgVygkLCBlMik7CiAgICAgICAgfSA6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAkLmFwcGx5KGUyLCBhcmd1bWVudHMpOwogICAgICAgICAgfTsKICAgICAgICB9LCBVID0gcSwgeiA9IFUoe30udG9TdHJpbmcpLCBHID0gVSgiIi5zbGljZSksIEggPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIEcoeihlMiksIDgsIC0xKTsKICAgICAgICB9LCBKID0gcSwgWCA9IFQsIFkgPSBILCBLID0gUy5PYmplY3QsIFEgPSBKKCIiLnNwbGl0KSwgWiA9IFgoZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gIUsoInoiKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKTsKICAgICAgICB9KSA/IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gWShlMikgPT0gIlN0cmluZyIgPyBRKGUyLCAiIikgOiBLKGUyKTsKICAgICAgICB9IDogSywgZWUgPSBTLlR5cGVFcnJvciwgdGUgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKGUyID09IG51bGwpCiAgICAgICAgICAgIHRocm93IGVlKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAiICsgZTIpOwogICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgIH0sIG5lID0gWiwgcmUgPSB0ZSwgb2UgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIG5lKHJlKGUyKSk7CiAgICAgICAgfSwgaWUgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiBlMiA9PSAiZnVuY3Rpb24iOwogICAgICAgIH0sIHVlID0gaWUsIHNlID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiB0eXBlb2YgZTIgPT0gIm9iamVjdCIgPyBlMiAhPT0gbnVsbCA6IHVlKGUyKTsKICAgICAgICB9LCBhZSA9IFMsIGNlID0gaWUsIGxlID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBjZShlMikgPyBlMiA6IHZvaWQgMDsKICAgICAgICB9LCBwZSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAyID8gbGUoYWVbZTJdKSA6IGFlW2UyXSAmJiBhZVtlMl1bdDJdOwogICAgICAgIH0sIGZlID0gcSh7fS5pc1Byb3RvdHlwZU9mKSwgZGUgPSBwZSgibmF2aWdhdG9yIiwgInVzZXJBZ2VudCIpIHx8ICIiLCBoZSA9IFMsIGdlID0gZGUsIG1lID0gaGUucHJvY2VzcywgeWUgPSBoZS5EZW5vLCBEZSA9IG1lICYmIG1lLnZlcnNpb25zIHx8IHllICYmIHllLnZlcnNpb24sIEVlID0gRGUgJiYgRGUudjg7CiAgICAgICAgRWUgJiYgKF8gPSAoaiA9IEVlLnNwbGl0KCIuIikpWzBdID4gMCAmJiBqWzBdIDwgNCA/IDEgOiArKGpbMF0gKyBqWzFdKSksICFfICYmIGdlICYmICghKGogPSBnZS5tYXRjaCgvRWRnZVwvKFxkKykvKSkgfHwgalsxXSA+PSA3NCkgJiYgKGogPSBnZS5tYXRjaCgvQ2hyb21lXC8oXGQrKS8pKSAmJiAoXyA9ICtqWzFdKTsKICAgICAgICB2YXIgQ2UgPSBfLCBiZSA9IENlLCB2ZSA9IFQsIEFlID0gISFPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzICYmICF2ZShmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBlMiA9IFN5bWJvbCgpOwogICAgICAgICAgcmV0dXJuICFTdHJpbmcoZTIpIHx8ICEoT2JqZWN0KGUyKSBpbnN0YW5jZW9mIFN5bWJvbCkgfHwgIVN5bWJvbC5zaGFtICYmIGJlICYmIGJlIDwgNDE7CiAgICAgICAgfSksIEZlID0gQWUgJiYgIVN5bWJvbC5zaGFtICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT0gInN5bWJvbCIsIHhlID0gcGUsIFNlID0gaWUsIHdlID0gZmUsIFRlID0gRmUsIEJlID0gUy5PYmplY3QsIE5lID0gVGUgPyBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiBlMiA9PSAic3ltYm9sIjsKICAgICAgICB9IDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IHhlKCJTeW1ib2wiKTsKICAgICAgICAgIHJldHVybiBTZSh0MikgJiYgd2UodDIucHJvdG90eXBlLCBCZShlMikpOwogICAgICAgIH0sIGtlID0gUy5TdHJpbmcsIFBlID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBrZShlMik7CiAgICAgICAgICB9IGNhdGNoIChlMykgewogICAgICAgICAgICByZXR1cm4gIk9iamVjdCI7CiAgICAgICAgICB9CiAgICAgICAgfSwgT2UgPSBpZSwgSWUgPSBQZSwgTGUgPSBTLlR5cGVFcnJvciwgamUgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKE9lKGUyKSkKICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgdGhyb3cgTGUoSWUoZTIpICsgIiBpcyBub3QgYSBmdW5jdGlvbiIpOwogICAgICAgIH0sIF9lID0gamUsIE1lID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICB2YXIgbjIgPSBlMlt0Ml07CiAgICAgICAgICByZXR1cm4gbjIgPT0gbnVsbCA/IHZvaWQgMCA6IF9lKG4yKTsKICAgICAgICB9LCBSZSA9IGssIFZlID0gaWUsICRlID0gc2UsIFdlID0gUy5UeXBlRXJyb3IsIHFlID0geyBleHBvcnRzOiB7fSB9LCBVZSA9IFMsIHplID0gT2JqZWN0LmRlZmluZVByb3BlcnR5LCBHZSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgemUoVWUsIGUyLCB7IHZhbHVlOiB0MiwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsKICAgICAgICAgIH0gY2F0Y2ggKG4yKSB7CiAgICAgICAgICAgIFVlW2UyXSA9IHQyOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0sIEhlID0gR2UsIEplID0gIl9fY29yZS1qc19zaGFyZWRfXyIsIFhlID0gU1tKZV0gfHwgSGUoSmUsIHt9KSwgWWUgPSBYZTsKICAgICAgICAocWUuZXhwb3J0cyA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIFllW2UyXSB8fCAoWWVbZTJdID0gdDIgIT09IHZvaWQgMCA/IHQyIDoge30pOwogICAgICAgIH0pKCJ2ZXJzaW9ucyIsIFtdKS5wdXNoKHsgdmVyc2lvbjogIjMuMTkuMSIsIG1vZGU6ICJnbG9iYWwiLCBjb3B5cmlnaHQ6ICJceEE5IDIwMjEgRGVuaXMgUHVzaGthcmV2ICh6bG9pcm9jay5ydSkiIH0pOwogICAgICAgIHZhciBLZSA9IHRlLCBRZSA9IFMuT2JqZWN0LCBaZSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gUWUoS2UoZTIpKTsKICAgICAgICB9LCBldCA9IFplLCB0dCA9IHEoe30uaGFzT3duUHJvcGVydHkpLCBudCA9IE9iamVjdC5oYXNPd24gfHwgZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gdHQoZXQoZTIpLCB0Mik7CiAgICAgICAgfSwgcnQgPSBxLCBvdCA9IDAsIGl0ID0gTWF0aC5yYW5kb20oKSwgdXQgPSBydCgxIC50b1N0cmluZyksIHN0ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiAiU3ltYm9sKCIgKyAoZTIgPT09IHZvaWQgMCA/ICIiIDogZTIpICsgIilfIiArIHV0KCsrb3QgKyBpdCwgMzYpOwogICAgICAgIH0sIGF0ID0gUywgY3QgPSBxZS5leHBvcnRzLCBsdCA9IG50LCBwdCA9IHN0LCBmdCA9IEFlLCBkdCA9IEZlLCBodCA9IGN0KCJ3a3MiKSwgZ3QgPSBhdC5TeW1ib2wsIG10ID0gZ3QgJiYgZ3QuZm9yLCB5dCA9IGR0ID8gZ3QgOiBndCAmJiBndC53aXRob3V0U2V0dGVyIHx8IHB0LCBEdCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBpZiAoIWx0KGh0LCBlMikgfHwgIWZ0ICYmIHR5cGVvZiBodFtlMl0gIT0gInN0cmluZyIpIHsKICAgICAgICAgICAgdmFyIHQyID0gIlN5bWJvbC4iICsgZTI7CiAgICAgICAgICAgIGZ0ICYmIGx0KGd0LCBlMikgPyBodFtlMl0gPSBndFtlMl0gOiBodFtlMl0gPSBkdCAmJiBtdCA/IG10KHQyKSA6IHl0KHQyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBodFtlMl07CiAgICAgICAgfSwgRXQgPSBrLCBDdCA9IHNlLCBidCA9IE5lLCB2dCA9IE1lLCBBdCA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgdmFyIG4yLCByMjsKICAgICAgICAgIGlmICh0MiA9PT0gInN0cmluZyIgJiYgVmUobjIgPSBlMi50b1N0cmluZykgJiYgISRlKHIyID0gUmUobjIsIGUyKSkpCiAgICAgICAgICAgIHJldHVybiByMjsKICAgICAgICAgIGlmIChWZShuMiA9IGUyLnZhbHVlT2YpICYmICEkZShyMiA9IFJlKG4yLCBlMikpKQogICAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgICBpZiAodDIgIT09ICJzdHJpbmciICYmIFZlKG4yID0gZTIudG9TdHJpbmcpICYmICEkZShyMiA9IFJlKG4yLCBlMikpKQogICAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgICB0aHJvdyBXZSgiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIik7CiAgICAgICAgfSwgRnQgPSBEdCwgeHQgPSBTLlR5cGVFcnJvciwgU3QgPSBGdCgidG9QcmltaXRpdmUiKSwgd3QgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGlmICghQ3QoZTIpIHx8IGJ0KGUyKSkKICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgdmFyIG4yLCByMiA9IHZ0KGUyLCBTdCk7CiAgICAgICAgICBpZiAocjIpIHsKICAgICAgICAgICAgaWYgKHQyID09PSB2b2lkIDAgJiYgKHQyID0gImRlZmF1bHQiKSwgbjIgPSBFdChyMiwgZTIsIHQyKSwgIUN0KG4yKSB8fCBidChuMikpCiAgICAgICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgICAgICB0aHJvdyB4dCgiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdDIgPT09IHZvaWQgMCAmJiAodDIgPSAibnVtYmVyIiksIEF0KGUyLCB0Mik7CiAgICAgICAgfSwgVHQgPSBOZSwgQnQgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gd3QoZTIsICJzdHJpbmciKTsKICAgICAgICAgIHJldHVybiBUdCh0MikgPyB0MiA6IHQyICsgIiI7CiAgICAgICAgfSwgTnQgPSBzZSwga3QgPSBTLmRvY3VtZW50LCBQdCA9IE50KGt0KSAmJiBOdChrdC5jcmVhdGVFbGVtZW50KSwgT3QgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFB0ID8ga3QuY3JlYXRlRWxlbWVudChlMikgOiB7fTsKICAgICAgICB9LCBJdCA9IE90LCBMdCA9ICFCICYmICFUKGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShJdCgiZGl2IiksICJhIiwgeyBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gNzsKICAgICAgICAgIH0gfSkuYSAhPSA3OwogICAgICAgIH0pLCBqdCA9IEIsIF90ID0gaywgTXQgPSBQLCBSdCA9IE0sIFZ0ID0gb2UsICR0ID0gQnQsIFd0ID0gbnQsIHF0ID0gTHQsIFV0ID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKICAgICAgICB3LmYgPSBqdCA/IFV0IDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBpZiAoZTIgPSBWdChlMiksIHQyID0gJHQodDIpLCBxdCkKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICByZXR1cm4gVXQoZTIsIHQyKTsKICAgICAgICAgICAgfSBjYXRjaCAoZTMpIHsKICAgICAgICAgICAgfQogICAgICAgICAgaWYgKFd0KGUyLCB0MikpCiAgICAgICAgICAgIHJldHVybiBSdCghX3QoTXQuZiwgZTIsIHQyKSwgZTJbdDJdKTsKICAgICAgICB9OwogICAgICAgIHZhciB6dCA9IHt9LCBHdCA9IFMsIEh0ID0gc2UsIEp0ID0gR3QuU3RyaW5nLCBYdCA9IEd0LlR5cGVFcnJvciwgWXQgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKEh0KGUyKSkKICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgdGhyb3cgWHQoSnQoZTIpICsgIiBpcyBub3QgYW4gb2JqZWN0Iik7CiAgICAgICAgfSwgS3QgPSBCLCBRdCA9IEx0LCBadCA9IFl0LCBlbiA9IEJ0LCB0biA9IFMuVHlwZUVycm9yLCBubiA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKICAgICAgICB6dC5mID0gS3QgPyBubiA6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGlmIChadChlMiksIHQyID0gZW4odDIpLCBadChuMiksIFF0KQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBubihlMiwgdDIsIG4yKTsKICAgICAgICAgICAgfSBjYXRjaCAoZTMpIHsKICAgICAgICAgICAgfQogICAgICAgICAgaWYgKCJnZXQiIGluIG4yIHx8ICJzZXQiIGluIG4yKQogICAgICAgICAgICB0aHJvdyB0bigiQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICAgIHJldHVybiAidmFsdWUiIGluIG4yICYmIChlMlt0Ml0gPSBuMi52YWx1ZSksIGUyOwogICAgICAgIH07CiAgICAgICAgdmFyIHJuID0genQsIG9uID0gTSwgdW4gPSBCID8gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIHJuLmYoZTIsIHQyLCBvbigxLCBuMikpOwogICAgICAgIH0gOiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gZTJbdDJdID0gbjIsIGUyOwogICAgICAgIH0sIHNuID0geyBleHBvcnRzOiB7fSB9LCBhbiA9IGllLCBjbiA9IFhlLCBsbiA9IHEoRnVuY3Rpb24udG9TdHJpbmcpOwogICAgICAgIGFuKGNuLmluc3BlY3RTb3VyY2UpIHx8IChjbi5pbnNwZWN0U291cmNlID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBsbihlMik7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHBuLCBmbiwgZG4sIGhuID0gY24uaW5zcGVjdFNvdXJjZSwgZ24gPSBpZSwgbW4gPSBobiwgeW4gPSBTLldlYWtNYXAsIERuID0gZ24oeW4pICYmIC9uYXRpdmUgY29kZS8udGVzdChtbih5bikpLCBFbiA9IHFlLmV4cG9ydHMsIENuID0gc3QsIGJuID0gRW4oImtleXMiKSwgdm4gPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGJuW2UyXSB8fCAoYm5bZTJdID0gQ24oZTIpKTsKICAgICAgICB9LCBBbiA9IHt9LCBGbiA9IERuLCB4biA9IFMsIFNuID0gcSwgd24gPSBzZSwgVG4gPSB1biwgQm4gPSBudCwgTm4gPSBYZSwga24gPSB2biwgUG4gPSBBbiwgT24gPSAiT2JqZWN0IGFscmVhZHkgaW5pdGlhbGl6ZWQiLCBJbiA9IHhuLlR5cGVFcnJvciwgTG4gPSB4bi5XZWFrTWFwOwogICAgICAgIGlmIChGbiB8fCBObi5zdGF0ZSkgewogICAgICAgICAgdmFyIGpuID0gTm4uc3RhdGUgfHwgKE5uLnN0YXRlID0gbmV3IExuKCkpLCBfbiA9IFNuKGpuLmdldCksIE1uID0gU24oam4uaGFzKSwgUm4gPSBTbihqbi5zZXQpOwogICAgICAgICAgcG4gPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgICAgaWYgKE1uKGpuLCBlMikpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEluKE9uKTsKICAgICAgICAgICAgcmV0dXJuIHQyLmZhY2FkZSA9IGUyLCBSbihqbiwgZTIsIHQyKSwgdDI7CiAgICAgICAgICB9LCBmbiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICAgIHJldHVybiBfbihqbiwgZTIpIHx8IHt9OwogICAgICAgICAgfSwgZG4gPSBmdW5jdGlvbihlMikgewogICAgICAgICAgICByZXR1cm4gTW4oam4sIGUyKTsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBWbiA9IGtuKCJzdGF0ZSIpOwogICAgICAgICAgUG5bVm5dID0gdHJ1ZSwgcG4gPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgICAgaWYgKEJuKGUyLCBWbikpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEluKE9uKTsKICAgICAgICAgICAgcmV0dXJuIHQyLmZhY2FkZSA9IGUyLCBUbihlMiwgVm4sIHQyKSwgdDI7CiAgICAgICAgICB9LCBmbiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICAgIHJldHVybiBCbihlMiwgVm4pID8gZTJbVm5dIDoge307CiAgICAgICAgICB9LCBkbiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICAgIHJldHVybiBCbihlMiwgVm4pOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgdmFyICRuID0geyBzZXQ6IHBuLCBnZXQ6IGZuLCBoYXM6IGRuLCBlbmZvcmNlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGRuKGUyKSA/IGZuKGUyKSA6IHBuKGUyLCB7fSk7CiAgICAgICAgfSwgZ2V0dGVyRm9yOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICAgIHZhciBuMjsKICAgICAgICAgICAgaWYgKCF3bih0MikgfHwgKG4yID0gZm4odDIpKS50eXBlICE9PSBlMikKICAgICAgICAgICAgICB0aHJvdyBJbigiSW5jb21wYXRpYmxlIHJlY2VpdmVyLCAiICsgZTIgKyAiIHJlcXVpcmVkIik7CiAgICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICAgIH07CiAgICAgICAgfSB9LCBXbiA9IEIsIHFuID0gbnQsIFVuID0gRnVuY3Rpb24ucHJvdG90eXBlLCB6biA9IFduICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsIEduID0gcW4oVW4sICJuYW1lIiksIEhuID0gR24gJiYgZnVuY3Rpb24oKSB7CiAgICAgICAgfS5uYW1lID09PSAic29tZXRoaW5nIiwgSm4gPSBHbiAmJiAoIVduIHx8IFduICYmIHpuKFVuLCAibmFtZSIpLmNvbmZpZ3VyYWJsZSksIFhuID0gUywgWW4gPSBpZSwgS24gPSBudCwgUW4gPSB1biwgWm4gPSBHZSwgZXIgPSBobiwgdHIgPSB7IEVYSVNUUzogR24sIFBST1BFUjogSG4sIENPTkZJR1VSQUJMRTogSm4gfS5DT05GSUdVUkFCTEUsIG5yID0gJG4uZ2V0LCByciA9ICRuLmVuZm9yY2UsIG9yID0gU3RyaW5nKFN0cmluZykuc3BsaXQoIlN0cmluZyIpOwogICAgICAgIChzbi5leHBvcnRzID0gZnVuY3Rpb24oZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIHZhciBvMiwgaTIgPSAhIXIyICYmICEhcjIudW5zYWZlLCB1MiA9ICEhcjIgJiYgISFyMi5lbnVtZXJhYmxlLCBzMiA9ICEhcjIgJiYgISFyMi5ub1RhcmdldEdldCwgYTIgPSByMiAmJiByMi5uYW1lICE9PSB2b2lkIDAgPyByMi5uYW1lIDogdDI7CiAgICAgICAgICBZbihuMikgJiYgKFN0cmluZyhhMikuc2xpY2UoMCwgNykgPT09ICJTeW1ib2woIiAmJiAoYTIgPSAiWyIgKyBTdHJpbmcoYTIpLnJlcGxhY2UoL15TeW1ib2xcKChbXildKilcKS8sICIkMSIpICsgIl0iKSwgKCFLbihuMiwgIm5hbWUiKSB8fCB0ciAmJiBuMi5uYW1lICE9PSBhMikgJiYgUW4objIsICJuYW1lIiwgYTIpLCAobzIgPSBycihuMikpLnNvdXJjZSB8fCAobzIuc291cmNlID0gb3Iuam9pbih0eXBlb2YgYTIgPT0gInN0cmluZyIgPyBhMiA6ICIiKSkpLCBlMiAhPT0gWG4gPyAoaTIgPyAhczIgJiYgZTJbdDJdICYmICh1MiA9IHRydWUpIDogZGVsZXRlIGUyW3QyXSwgdTIgPyBlMlt0Ml0gPSBuMiA6IFFuKGUyLCB0MiwgbjIpKSA6IHUyID8gZTJbdDJdID0gbjIgOiBabih0MiwgbjIpOwogICAgICAgIH0pKEZ1bmN0aW9uLnByb3RvdHlwZSwgInRvU3RyaW5nIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gWW4odGhpcykgJiYgbnIodGhpcykuc291cmNlIHx8IGVyKHRoaXMpOwogICAgICAgIH0pOwogICAgICAgIHZhciBpciA9IHt9LCB1ciA9IE1hdGguY2VpbCwgc3IgPSBNYXRoLmZsb29yLCBhciA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSArZTI7CiAgICAgICAgICByZXR1cm4gdDIgIT0gdDIgfHwgdDIgPT09IDAgPyAwIDogKHQyID4gMCA/IHNyIDogdXIpKHQyKTsKICAgICAgICB9LCBjciA9IGFyLCBsciA9IE1hdGgubWF4LCBwciA9IE1hdGgubWluLCBmciA9IGFyLCBkciA9IE1hdGgubWluLCBociA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgPiAwID8gZHIoZnIoZTIpLCA5MDA3MTk5MjU0NzQwOTkxKSA6IDA7CiAgICAgICAgfSwgZ3IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGhyKGUyLmxlbmd0aCk7CiAgICAgICAgfSwgbXIgPSBvZSwgeXIgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHZhciBuMiA9IGNyKGUyKTsKICAgICAgICAgIHJldHVybiBuMiA8IDAgPyBscihuMiArIHQyLCAwKSA6IHByKG4yLCB0Mik7CiAgICAgICAgfSwgRHIgPSBnciwgRXIgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQyLCBuMiwgcjIpIHsKICAgICAgICAgICAgdmFyIG8yLCBpMiA9IG1yKHQyKSwgdTIgPSBEcihpMiksIHMyID0geXIocjIsIHUyKTsKICAgICAgICAgICAgaWYgKGUyICYmIG4yICE9IG4yKSB7CiAgICAgICAgICAgICAgZm9yICg7IHUyID4gczI7ICkKICAgICAgICAgICAgICAgIGlmICgobzIgPSBpMltzMisrXSkgIT0gbzIpCiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBmb3IgKDsgdTIgPiBzMjsgczIrKykKICAgICAgICAgICAgICAgIGlmICgoZTIgfHwgczIgaW4gaTIpICYmIGkyW3MyXSA9PT0gbjIpCiAgICAgICAgICAgICAgICAgIHJldHVybiBlMiB8fCBzMiB8fCAwOwogICAgICAgICAgICByZXR1cm4gIWUyICYmIC0xOwogICAgICAgICAgfTsKICAgICAgICB9LCBDciA9IHsgaW5jbHVkZXM6IEVyKHRydWUpLCBpbmRleE9mOiBFcihmYWxzZSkgfSwgYnIgPSBudCwgdnIgPSBvZSwgQXIgPSBDci5pbmRleE9mLCBGciA9IEFuLCB4ciA9IHEoW10ucHVzaCksIFNyID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICB2YXIgbjIsIHIyID0gdnIoZTIpLCBvMiA9IDAsIGkyID0gW107CiAgICAgICAgICBmb3IgKG4yIGluIHIyKQogICAgICAgICAgICAhYnIoRnIsIG4yKSAmJiBicihyMiwgbjIpICYmIHhyKGkyLCBuMik7CiAgICAgICAgICBmb3IgKDsgdDIubGVuZ3RoID4gbzI7ICkKICAgICAgICAgICAgYnIocjIsIG4yID0gdDJbbzIrK10pICYmICh+QXIoaTIsIG4yKSB8fCB4cihpMiwgbjIpKTsKICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICB9LCB3ciA9IFsiY29uc3RydWN0b3IiLCAiaGFzT3duUHJvcGVydHkiLCAiaXNQcm90b3R5cGVPZiIsICJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsICJ0b0xvY2FsZVN0cmluZyIsICJ0b1N0cmluZyIsICJ2YWx1ZU9mIl0sIFRyID0gU3IsIEJyID0gd3IuY29uY2F0KCJsZW5ndGgiLCAicHJvdG90eXBlIik7CiAgICAgICAgaXIuZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHx8IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gVHIoZTIsIEJyKTsKICAgICAgICB9OwogICAgICAgIHZhciBOciA9IHt9OwogICAgICAgIE5yLmYgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzOwogICAgICAgIHZhciBrciA9IHBlLCBQciA9IGlyLCBPciA9IE5yLCBJciA9IFl0LCBMciA9IHEoW10uY29uY2F0KSwganIgPSBrcigiUmVmbGVjdCIsICJvd25LZXlzIikgfHwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IFByLmYoSXIoZTIpKSwgbjIgPSBPci5mOwogICAgICAgICAgcmV0dXJuIG4yID8gTHIodDIsIG4yKGUyKSkgOiB0MjsKICAgICAgICB9LCBfciA9IG50LCBNciA9IGpyLCBSciA9IHcsIFZyID0genQsICRyID0gVCwgV3IgPSBpZSwgcXIgPSAvI3xcLnByb3RvdHlwZVwuLywgVXIgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHZhciBuMiA9IEdyW3pyKGUyKV07CiAgICAgICAgICByZXR1cm4gbjIgPT0gSnIgfHwgbjIgIT0gSHIgJiYgKFdyKHQyKSA/ICRyKHQyKSA6ICEhdDIpOwogICAgICAgIH0sIHpyID0gVXIubm9ybWFsaXplID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBTdHJpbmcoZTIpLnJlcGxhY2UocXIsICIuIikudG9Mb3dlckNhc2UoKTsKICAgICAgICB9LCBHciA9IFVyLmRhdGEgPSB7fSwgSHIgPSBVci5OQVRJVkUgPSAiTiIsIEpyID0gVXIuUE9MWUZJTEwgPSAiUCIsIFhyID0gVXIsIFlyID0gUywgS3IgPSB3LmYsIFFyID0gdW4sIFpyID0gc24uZXhwb3J0cywgZW8gPSBHZSwgdG8gPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGZvciAodmFyIG4yID0gTXIodDIpLCByMiA9IFZyLmYsIG8yID0gUnIuZiwgaTIgPSAwOyBpMiA8IG4yLmxlbmd0aDsgaTIrKykgewogICAgICAgICAgICB2YXIgdTIgPSBuMltpMl07CiAgICAgICAgICAgIF9yKGUyLCB1MikgfHwgcjIoZTIsIHUyLCBvMih0MiwgdTIpKTsKICAgICAgICAgIH0KICAgICAgICB9LCBubyA9IFhyLCBybyA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgdmFyIG4yLCByMiwgbzIsIGkyLCB1MiwgczIgPSBlMi50YXJnZXQsIGEyID0gZTIuZ2xvYmFsLCBjMiA9IGUyLnN0YXQ7CiAgICAgICAgICBpZiAobjIgPSBhMiA/IFlyIDogYzIgPyBZcltzMl0gfHwgZW8oczIsIHt9KSA6IChZcltzMl0gfHwge30pLnByb3RvdHlwZSkKICAgICAgICAgICAgZm9yIChyMiBpbiB0MikgewogICAgICAgICAgICAgIGlmIChpMiA9IHQyW3IyXSwgbzIgPSBlMi5ub1RhcmdldEdldCA/ICh1MiA9IEtyKG4yLCByMikpICYmIHUyLnZhbHVlIDogbjJbcjJdLCAhbm8oYTIgPyByMiA6IHMyICsgKGMyID8gIi4iIDogIiMiKSArIHIyLCBlMi5mb3JjZWQpICYmIG8yICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaTIgPT0gdHlwZW9mIG8yKQogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIHRvKGkyLCBvMik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIChlMi5zaGFtIHx8IG8yICYmIG8yLnNoYW0pICYmIFFyKGkyLCAic2hhbSIsIHRydWUpLCBacihuMiwgcjIsIGkyLCBlMik7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBvbyA9IHt9OwogICAgICAgIG9vW0R0KCJ0b1N0cmluZ1RhZyIpXSA9ICJ6IjsKICAgICAgICB2YXIgaW8gPSBTLCB1byA9IFN0cmluZyhvbykgPT09ICJbb2JqZWN0IHpdIiwgc28gPSBpZSwgYW8gPSBILCBjbyA9IER0KCJ0b1N0cmluZ1RhZyIpLCBsbyA9IGlvLk9iamVjdCwgcG8gPSBhbyhmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHM7CiAgICAgICAgfSgpKSA9PSAiQXJndW1lbnRzIiwgZm8gPSB1byA/IGFvIDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiwgbjIsIHIyOwogICAgICAgICAgcmV0dXJuIGUyID09PSB2b2lkIDAgPyAiVW5kZWZpbmVkIiA6IGUyID09PSBudWxsID8gIk51bGwiIDogdHlwZW9mIChuMiA9IGZ1bmN0aW9uKGUzLCB0MykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBlM1t0M107CiAgICAgICAgICAgIH0gY2F0Y2ggKGU0KSB7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0odDIgPSBsbyhlMiksIGNvKSkgPT0gInN0cmluZyIgPyBuMiA6IHBvID8gYW8odDIpIDogKHIyID0gYW8odDIpKSA9PSAiT2JqZWN0IiAmJiBzbyh0Mi5jYWxsZWUpID8gIkFyZ3VtZW50cyIgOiByMjsKICAgICAgICB9LCBobyA9IGZvLCBnbyA9IFMuU3RyaW5nLCBtbyA9IHEoW10uc2xpY2UpLCB5byA9IE1hdGguZmxvb3IsIERvID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICB2YXIgbjIgPSBlMi5sZW5ndGgsIHIyID0geW8objIgLyAyKTsKICAgICAgICAgIHJldHVybiBuMiA8IDggPyBFbyhlMiwgdDIpIDogQ28oZTIsIERvKG1vKGUyLCAwLCByMiksIHQyKSwgRG8obW8oZTIsIHIyKSwgdDIpLCB0Mik7CiAgICAgICAgfSwgRW8gPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGZvciAodmFyIG4yLCByMiwgbzIgPSBlMi5sZW5ndGgsIGkyID0gMTsgaTIgPCBvMjsgKSB7CiAgICAgICAgICAgIGZvciAocjIgPSBpMiwgbjIgPSBlMltpMl07IHIyICYmIHQyKGUyW3IyIC0gMV0sIG4yKSA+IDA7ICkKICAgICAgICAgICAgICBlMltyMl0gPSBlMlstLXIyXTsKICAgICAgICAgICAgcjIgIT09IGkyKysgJiYgKGUyW3IyXSA9IG4yKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICB9LCBDbyA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICBmb3IgKHZhciBvMiA9IHQyLmxlbmd0aCwgaTIgPSBuMi5sZW5ndGgsIHUyID0gMCwgczIgPSAwOyB1MiA8IG8yIHx8IHMyIDwgaTI7ICkKICAgICAgICAgICAgZTJbdTIgKyBzMl0gPSB1MiA8IG8yICYmIHMyIDwgaTIgPyByMih0Mlt1Ml0sIG4yW3MyXSkgPD0gMCA/IHQyW3UyKytdIDogbjJbczIrK10gOiB1MiA8IG8yID8gdDJbdTIrK10gOiBuMltzMisrXTsKICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICB9LCBibyA9IERvLCB2byA9IFQsIEFvID0gZGUubWF0Y2goL2ZpcmVmb3hcLyhcZCspL2kpLCBGbyA9ICEhQW8gJiYgK0FvWzFdLCB4byA9IC9NU0lFfFRyaWRlbnQvLnRlc3QoZGUpLCBTbyA9IGRlLm1hdGNoKC9BcHBsZVdlYktpdFwvKFxkKylcLi8pLCB3byA9ICEhU28gJiYgK1NvWzFdLCBUbyA9IHJvLCBCbyA9IHEsIE5vID0gamUsIGtvID0gWmUsIFBvID0gZ3IsIE9vID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGlmIChobyhlMikgPT09ICJTeW1ib2wiKQogICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBjb252ZXJ0IGEgU3ltYm9sIHZhbHVlIHRvIGEgc3RyaW5nIik7CiAgICAgICAgICByZXR1cm4gZ28oZTIpOwogICAgICAgIH0sIElvID0gVCwgTG8gPSBibywgam8gPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHZhciBuMiA9IFtdW2UyXTsKICAgICAgICAgIHJldHVybiAhIW4yICYmIHZvKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBuMi5jYWxsKG51bGwsIHQyIHx8IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRocm93IDE7CiAgICAgICAgICAgIH0sIDEpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwgX28gPSBGbywgTW8gPSB4bywgUm8gPSBDZSwgVm8gPSB3bywgJG8gPSBbXSwgV28gPSBCbygkby5zb3J0KSwgcW8gPSBCbygkby5wdXNoKSwgVW8gPSBJbyhmdW5jdGlvbigpIHsKICAgICAgICAgICRvLnNvcnQodm9pZCAwKTsKICAgICAgICB9KSwgem8gPSBJbyhmdW5jdGlvbigpIHsKICAgICAgICAgICRvLnNvcnQobnVsbCk7CiAgICAgICAgfSksIEdvID0gam8oInNvcnQiKSwgSG8gPSAhSW8oZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoUm8pCiAgICAgICAgICAgIHJldHVybiBSbyA8IDcwOwogICAgICAgICAgaWYgKCEoX28gJiYgX28gPiAzKSkgewogICAgICAgICAgICBpZiAoTW8pCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChWbykKICAgICAgICAgICAgICByZXR1cm4gVm8gPCA2MDM7CiAgICAgICAgICAgIHZhciBlMiwgdDIsIG4yLCByMiwgbzIgPSAiIjsKICAgICAgICAgICAgZm9yIChlMiA9IDY1OyBlMiA8IDc2OyBlMisrKSB7CiAgICAgICAgICAgICAgc3dpdGNoICh0MiA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZTIpLCBlMikgewogICAgICAgICAgICAgICAgY2FzZSA2NjoKICAgICAgICAgICAgICAgIGNhc2UgNjk6CiAgICAgICAgICAgICAgICBjYXNlIDcwOgogICAgICAgICAgICAgICAgY2FzZSA3MjoKICAgICAgICAgICAgICAgICAgbjIgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNjg6CiAgICAgICAgICAgICAgICBjYXNlIDcxOgogICAgICAgICAgICAgICAgICBuMiA9IDQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgbjIgPSAyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmb3IgKHIyID0gMDsgcjIgPCA0NzsgcjIrKykKICAgICAgICAgICAgICAgICRvLnB1c2goeyBrOiB0MiArIHIyLCB2OiBuMiB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKCRvLnNvcnQoZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQzLnYgLSBlMy52OwogICAgICAgICAgICB9KSwgcjIgPSAwOyByMiA8ICRvLmxlbmd0aDsgcjIrKykKICAgICAgICAgICAgICB0MiA9ICRvW3IyXS5rLmNoYXJBdCgwKSwgbzIuY2hhckF0KG8yLmxlbmd0aCAtIDEpICE9PSB0MiAmJiAobzIgKz0gdDIpOwogICAgICAgICAgICByZXR1cm4gbzIgIT09ICJER0JFRkhBQ0lKSyI7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgVG8oeyB0YXJnZXQ6ICJBcnJheSIsIHByb3RvOiB0cnVlLCBmb3JjZWQ6IFVvIHx8ICF6byB8fCAhR28gfHwgIUhvIH0sIHsgc29ydDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGUyICE9PSB2b2lkIDAgJiYgTm8oZTIpOwogICAgICAgICAgdmFyIHQyID0ga28odGhpcyk7CiAgICAgICAgICBpZiAoSG8pCiAgICAgICAgICAgIHJldHVybiBlMiA9PT0gdm9pZCAwID8gV28odDIpIDogV28odDIsIGUyKTsKICAgICAgICAgIHZhciBuMiwgcjIsIG8yID0gW10sIGkyID0gUG8odDIpOwogICAgICAgICAgZm9yIChyMiA9IDA7IHIyIDwgaTI7IHIyKyspCiAgICAgICAgICAgIHIyIGluIHQyICYmIHFvKG8yLCB0MltyMl0pOwogICAgICAgICAgZm9yIChMbyhvMiwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgICAgIHJldHVybiBuMyA9PT0gdm9pZCAwID8gLTEgOiB0MyA9PT0gdm9pZCAwID8gMSA6IGUzICE9PSB2b2lkIDAgPyArZTModDMsIG4zKSB8fCAwIDogT28odDMpID4gT28objMpID8gMSA6IC0xOwogICAgICAgICAgICB9OwogICAgICAgICAgfShlMikpLCBuMiA9IG8yLmxlbmd0aCwgcjIgPSAwOyByMiA8IG4yOyApCiAgICAgICAgICAgIHQyW3IyXSA9IG8yW3IyKytdOwogICAgICAgICAgZm9yICg7IHIyIDwgaTI7ICkKICAgICAgICAgICAgZGVsZXRlIHQyW3IyKytdOwogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0gfSk7CiAgICAgICAgdmFyIEpvID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEpvLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIEpvLmRpZmZKc29uID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIFpvLmRpZmYoZTIsIHQyLCBuMik7CiAgICAgICAgfSwgSm8uY2Fub25pY2FsaXplID0gZWksIEpvLmpzb25EaWZmID0gdm9pZCAwOwogICAgICAgIHZhciBYbyA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgZTIuX19lc01vZHVsZSA/IGUyIDogeyBkZWZhdWx0OiBlMiB9OwogICAgICAgIH0obyksIFlvID0gZzsKICAgICAgICBmdW5jdGlvbiBLbyhlMikgewogICAgICAgICAgcmV0dXJuIEtvID0gdHlwZW9mIFN5bWJvbCA9PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT0gInN5bWJvbCIgPyBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gdHlwZW9mIGUzOwogICAgICAgICAgfSA6IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMyAmJiB0eXBlb2YgU3ltYm9sID09ICJmdW5jdGlvbiIgJiYgZTMuY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBlMyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIGUzOwogICAgICAgICAgfSwgS28oZTIpOwogICAgICAgIH0KICAgICAgICB2YXIgUW8gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLCBabyA9IG5ldyBYby5kZWZhdWx0KCk7CiAgICAgICAgZnVuY3Rpb24gZWkoZTIsIHQyLCBuMiwgcjIsIG8yKSB7CiAgICAgICAgICB2YXIgaTIsIHUyOwogICAgICAgICAgZm9yICh0MiA9IHQyIHx8IFtdLCBuMiA9IG4yIHx8IFtdLCByMiAmJiAoZTIgPSByMihvMiwgZTIpKSwgaTIgPSAwOyBpMiA8IHQyLmxlbmd0aDsgaTIgKz0gMSkKICAgICAgICAgICAgaWYgKHQyW2kyXSA9PT0gZTIpCiAgICAgICAgICAgICAgcmV0dXJuIG4yW2kyXTsKICAgICAgICAgIGlmIChRby5jYWxsKGUyKSA9PT0gIltvYmplY3QgQXJyYXldIikgewogICAgICAgICAgICBmb3IgKHQyLnB1c2goZTIpLCB1MiA9IG5ldyBBcnJheShlMi5sZW5ndGgpLCBuMi5wdXNoKHUyKSwgaTIgPSAwOyBpMiA8IGUyLmxlbmd0aDsgaTIgKz0gMSkKICAgICAgICAgICAgICB1MltpMl0gPSBlaShlMltpMl0sIHQyLCBuMiwgcjIsIG8yKTsKICAgICAgICAgICAgcmV0dXJuIHQyLnBvcCgpLCBuMi5wb3AoKSwgdTI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZTIgJiYgZTIudG9KU09OICYmIChlMiA9IGUyLnRvSlNPTigpKSwgS28oZTIpID09PSAib2JqZWN0IiAmJiBlMiAhPT0gbnVsbCkgewogICAgICAgICAgICB0Mi5wdXNoKGUyKSwgdTIgPSB7fSwgbjIucHVzaCh1Mik7CiAgICAgICAgICAgIHZhciBzMiwgYTIgPSBbXTsKICAgICAgICAgICAgZm9yIChzMiBpbiBlMikKICAgICAgICAgICAgICBlMi5oYXNPd25Qcm9wZXJ0eShzMikgJiYgYTIucHVzaChzMik7CiAgICAgICAgICAgIGZvciAoYTIuc29ydCgpLCBpMiA9IDA7IGkyIDwgYTIubGVuZ3RoOyBpMiArPSAxKQogICAgICAgICAgICAgIHUyW3MyID0gYTJbaTJdXSA9IGVpKGUyW3MyXSwgdDIsIG4yLCByMiwgczIpOwogICAgICAgICAgICB0Mi5wb3AoKSwgbjIucG9wKCk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgdTIgPSBlMjsKICAgICAgICAgIHJldHVybiB1MjsKICAgICAgICB9CiAgICAgICAgSm8uanNvbkRpZmYgPSBabywgWm8udXNlTG9uZ2VzdFRva2VuID0gdHJ1ZSwgWm8udG9rZW5pemUgPSBZby5saW5lRGlmZi50b2tlbml6ZSwgWm8uY2FzdElucHV0ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IHRoaXMub3B0aW9ucywgbjIgPSB0Mi51bmRlZmluZWRSZXBsYWNlbWVudCwgcjIgPSB0Mi5zdHJpbmdpZnlSZXBsYWNlciwgbzIgPSByMiA9PT0gdm9pZCAwID8gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0MyA9PT0gdm9pZCAwID8gbjIgOiB0MzsKICAgICAgICAgIH0gOiByMjsKICAgICAgICAgIHJldHVybiB0eXBlb2YgZTIgPT0gInN0cmluZyIgPyBlMiA6IEpTT04uc3RyaW5naWZ5KGVpKGUyLCBudWxsLCBudWxsLCBvMiksIG8yLCAiICAiKTsKICAgICAgICB9LCBaby5lcXVhbHMgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBYby5kZWZhdWx0LnByb3RvdHlwZS5lcXVhbHMuY2FsbChabywgZTIucmVwbGFjZSgvLChbXHJcbl0pL2csICIkMSIpLCB0Mi5yZXBsYWNlKC8sKFtcclxuXSkvZywgIiQxIikpOwogICAgICAgIH07CiAgICAgICAgdmFyIHRpID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRpLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIHRpLmRpZmZBcnJheXMgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gcmkuZGlmZihlMiwgdDIsIG4yKTsKICAgICAgICB9LCB0aS5hcnJheURpZmYgPSB2b2lkIDA7CiAgICAgICAgdmFyIG5pID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMiAmJiBlMi5fX2VzTW9kdWxlID8gZTIgOiB7IGRlZmF1bHQ6IGUyIH07CiAgICAgICAgfShvKTsKICAgICAgICB2YXIgcmkgPSBuZXcgbmkuZGVmYXVsdCgpOwogICAgICAgIHRpLmFycmF5RGlmZiA9IHJpLCByaS50b2tlbml6ZSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIuc2xpY2UoKTsKICAgICAgICB9LCByaS5qb2luID0gcmkucmVtb3ZlRW1wdHkgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgIH07CiAgICAgICAgdmFyIG9pID0ge30sIGlpID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGlpLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIGlpLnBhcnNlUGF0Y2ggPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMV0gOiB7fSwgbjIgPSBlMi5zcGxpdCgvXHJcbnxbXG5cdlxmXHJceDg1XS8pLCByMiA9IGUyLm1hdGNoKC9cclxufFtcblx2XGZcclx4ODVdL2cpIHx8IFtdLCBvMiA9IFtdLCBpMiA9IDA7CiAgICAgICAgICBmdW5jdGlvbiB1MigpIHsKICAgICAgICAgICAgdmFyIGUzID0ge307CiAgICAgICAgICAgIGZvciAobzIucHVzaChlMyk7IGkyIDwgbjIubGVuZ3RoOyApIHsKICAgICAgICAgICAgICB2YXIgcjMgPSBuMltpMl07CiAgICAgICAgICAgICAgaWYgKC9eKFwtXC1cLXxcK1wrXCt8QEApXHMvLnRlc3QocjMpKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgdmFyIHUzID0gL14oPzpJbmRleDp8ZGlmZig/OiAtciBcdyspKylccysoLis/KVxzKiQvLmV4ZWMocjMpOwogICAgICAgICAgICAgIHUzICYmIChlMy5pbmRleCA9IHUzWzFdKSwgaTIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKHMyKGUzKSwgczIoZTMpLCBlMy5odW5rcyA9IFtdOyBpMiA8IG4yLmxlbmd0aDsgKSB7CiAgICAgICAgICAgICAgdmFyIGMyID0gbjJbaTJdOwogICAgICAgICAgICAgIGlmICgvXihJbmRleDp8ZGlmZnxcLVwtXC18XCtcK1wrKVxzLy50ZXN0KGMyKSkKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGlmICgvXkBALy50ZXN0KGMyKSkKICAgICAgICAgICAgICAgIGUzLmh1bmtzLnB1c2goYTIoKSk7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoYzIgJiYgdDIuc3RyaWN0KQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbGluZSAiICsgKGkyICsgMSkgKyAiICIgKyBKU09OLnN0cmluZ2lmeShjMikpOwogICAgICAgICAgICAgICAgaTIrKzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHMyKGUzKSB7CiAgICAgICAgICAgIHZhciB0MyA9IC9eKC0tLXxcK1wrXCspXHMrKC4qKSQvLmV4ZWMobjJbaTJdKTsKICAgICAgICAgICAgaWYgKHQzKSB7CiAgICAgICAgICAgICAgdmFyIHIzID0gdDNbMV0gPT09ICItLS0iID8gIm9sZCIgOiAibmV3IiwgbzMgPSB0M1syXS5zcGxpdCgiCSIsIDIpLCB1MyA9IG8zWzBdLnJlcGxhY2UoL1xcXFwvZywgIlxcIik7CiAgICAgICAgICAgICAgL14iLioiJC8udGVzdCh1MykgJiYgKHUzID0gdTMuc3Vic3RyKDEsIHUzLmxlbmd0aCAtIDIpKSwgZTNbcjMgKyAiRmlsZU5hbWUiXSA9IHUzLCBlM1tyMyArICJIZWFkZXIiXSA9IChvM1sxXSB8fCAiIikudHJpbSgpLCBpMisrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBhMigpIHsKICAgICAgICAgICAgdmFyIGUzID0gaTIsIG8zID0gbjJbaTIrK10uc3BsaXQoL0BAIC0oXGQrKSg/OiwoXGQrKSk/IFwrKFxkKykoPzosKFxkKykpPyBAQC8pLCB1MyA9IHsgb2xkU3RhcnQ6ICtvM1sxXSwgb2xkTGluZXM6IG8zWzJdID09PSB2b2lkIDAgPyAxIDogK28zWzJdLCBuZXdTdGFydDogK28zWzNdLCBuZXdMaW5lczogbzNbNF0gPT09IHZvaWQgMCA/IDEgOiArbzNbNF0sIGxpbmVzOiBbXSwgbGluZWRlbGltaXRlcnM6IFtdIH07CiAgICAgICAgICAgIHUzLm9sZExpbmVzID09PSAwICYmICh1My5vbGRTdGFydCArPSAxKSwgdTMubmV3TGluZXMgPT09IDAgJiYgKHUzLm5ld1N0YXJ0ICs9IDEpOwogICAgICAgICAgICBmb3IgKHZhciBzMyA9IDAsIGEzID0gMDsgaTIgPCBuMi5sZW5ndGggJiYgIShuMltpMl0uaW5kZXhPZigiLS0tICIpID09PSAwICYmIGkyICsgMiA8IG4yLmxlbmd0aCAmJiBuMltpMiArIDFdLmluZGV4T2YoIisrKyAiKSA9PT0gMCAmJiBuMltpMiArIDJdLmluZGV4T2YoIkBAIikgPT09IDApOyBpMisrKSB7CiAgICAgICAgICAgICAgdmFyIGMyID0gbjJbaTJdLmxlbmd0aCA9PSAwICYmIGkyICE9IG4yLmxlbmd0aCAtIDEgPyAiICIgOiBuMltpMl1bMF07CiAgICAgICAgICAgICAgaWYgKGMyICE9PSAiKyIgJiYgYzIgIT09ICItIiAmJiBjMiAhPT0gIiAiICYmIGMyICE9PSAiXFwiKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgdTMubGluZXMucHVzaChuMltpMl0pLCB1My5saW5lZGVsaW1pdGVycy5wdXNoKHIyW2kyXSB8fCAiXG4iKSwgYzIgPT09ICIrIiA/IHMzKysgOiBjMiA9PT0gIi0iID8gYTMrKyA6IGMyID09PSAiICIgJiYgKHMzKyssIGEzKyspOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzMyB8fCB1My5uZXdMaW5lcyAhPT0gMSB8fCAodTMubmV3TGluZXMgPSAwKSwgYTMgfHwgdTMub2xkTGluZXMgIT09IDEgfHwgKHUzLm9sZExpbmVzID0gMCksIHQyLnN0cmljdCkgewogICAgICAgICAgICAgIGlmIChzMyAhPT0gdTMubmV3TGluZXMpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFkZGVkIGxpbmUgY291bnQgZGlkIG5vdCBtYXRjaCBmb3IgaHVuayBhdCBsaW5lICIgKyAoZTMgKyAxKSk7CiAgICAgICAgICAgICAgaWYgKGEzICE9PSB1My5vbGRMaW5lcykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUmVtb3ZlZCBsaW5lIGNvdW50IGRpZCBub3QgbWF0Y2ggZm9yIGh1bmsgYXQgbGluZSAiICsgKGUzICsgMSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB1MzsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoOyBpMiA8IG4yLmxlbmd0aDsgKQogICAgICAgICAgICB1MigpOwogICAgICAgICAgcmV0dXJuIG8yOwogICAgICAgIH07CiAgICAgICAgdmFyIHVpID0ge307CiAgICAgICAgIWZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KSwgZTIuZGVmYXVsdCA9IGZ1bmN0aW9uKGUzLCB0MiwgbjIpIHsKICAgICAgICAgICAgdmFyIHIyID0gdHJ1ZSwgbzIgPSBmYWxzZSwgaTIgPSBmYWxzZSwgdTIgPSAxOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gczIoKSB7CiAgICAgICAgICAgICAgaWYgKHIyICYmICFpMikgewogICAgICAgICAgICAgICAgaWYgKG8yID8gdTIrKyA6IHIyID0gZmFsc2UsIGUzICsgdTIgPD0gbjIpCiAgICAgICAgICAgICAgICAgIHJldHVybiB1MjsKICAgICAgICAgICAgICAgIGkyID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCFvMikKICAgICAgICAgICAgICAgIHJldHVybiBpMiB8fCAocjIgPSB0cnVlKSwgdDIgPD0gZTMgLSB1MiA/IC11MisrIDogKG8yID0gdHJ1ZSwgczIoKSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9OwogICAgICAgIH0odWkpLCBPYmplY3QuZGVmaW5lUHJvcGVydHkob2ksICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KSwgb2kuYXBwbHlQYXRjaCA9IGNpLCBvaS5hcHBseVBhdGNoZXMgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHR5cGVvZiBlMiA9PSAic3RyaW5nIiAmJiAoZTIgPSAoMCwgc2kucGFyc2VQYXRjaCkoZTIpKTsKICAgICAgICAgIHZhciBuMiA9IDA7CiAgICAgICAgICAhZnVuY3Rpb24gcjIoKSB7CiAgICAgICAgICAgIHZhciBvMiA9IGUyW24yKytdOwogICAgICAgICAgICBpZiAoIW8yKQogICAgICAgICAgICAgIHJldHVybiB0Mi5jb21wbGV0ZSgpOwogICAgICAgICAgICB0Mi5sb2FkRmlsZShvMiwgZnVuY3Rpb24oZTMsIG4zKSB7CiAgICAgICAgICAgICAgaWYgKGUzKQogICAgICAgICAgICAgICAgcmV0dXJuIHQyLmNvbXBsZXRlKGUzKTsKICAgICAgICAgICAgICB2YXIgaTIgPSBjaShuMywgbzIsIHQyKTsKICAgICAgICAgICAgICB0Mi5wYXRjaGVkKG8yLCBpMiwgZnVuY3Rpb24oZTQpIHsKICAgICAgICAgICAgICAgIGlmIChlNCkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHQyLmNvbXBsZXRlKGU0KTsKICAgICAgICAgICAgICAgIHIyKCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSgpOwogICAgICAgIH07CiAgICAgICAgdmFyIHNpID0gaWksIGFpID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMiAmJiBlMi5fX2VzTW9kdWxlID8gZTIgOiB7IGRlZmF1bHQ6IGUyIH07CiAgICAgICAgfSh1aSk7CiAgICAgICAgZnVuY3Rpb24gY2koZTIsIHQyKSB7CiAgICAgICAgICB2YXIgbjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICAgICAgaWYgKHR5cGVvZiB0MiA9PSAic3RyaW5nIiAmJiAodDIgPSAoMCwgc2kucGFyc2VQYXRjaCkodDIpKSwgQXJyYXkuaXNBcnJheSh0MikpIHsKICAgICAgICAgICAgaWYgKHQyLmxlbmd0aCA+IDEpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJhcHBseVBhdGNoIG9ubHkgd29ya3Mgd2l0aCBhIHNpbmdsZSBpbnB1dC4iKTsKICAgICAgICAgICAgdDIgPSB0MlswXTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciByMiwgbzIsIGkyID0gZTIuc3BsaXQoL1xyXG58W1xuXHZcZlxyXHg4NV0vKSwgdTIgPSBlMi5tYXRjaCgvXHJcbnxbXG5cdlxmXHJceDg1XS9nKSB8fCBbXSwgczIgPSB0Mi5odW5rcywgYTIgPSBuMi5jb21wYXJlTGluZSB8fCBmdW5jdGlvbihlMywgdDMsIG4zLCByMykgewogICAgICAgICAgICByZXR1cm4gdDMgPT09IHIzOwogICAgICAgICAgfSwgYzIgPSAwLCBsMiA9IG4yLmZ1enpGYWN0b3IgfHwgMCwgcDIgPSAwLCBmMiA9IDA7CiAgICAgICAgICBmdW5jdGlvbiBkMihlMywgdDMpIHsKICAgICAgICAgICAgZm9yICh2YXIgbjMgPSAwOyBuMyA8IGUzLmxpbmVzLmxlbmd0aDsgbjMrKykgewogICAgICAgICAgICAgIHZhciByMyA9IGUzLmxpbmVzW24zXSwgbzMgPSByMy5sZW5ndGggPiAwID8gcjNbMF0gOiAiICIsIHUzID0gcjMubGVuZ3RoID4gMCA/IHIzLnN1YnN0cigxKSA6IHIzOwogICAgICAgICAgICAgIGlmIChvMyA9PT0gIiAiIHx8IG8zID09PSAiLSIpIHsKICAgICAgICAgICAgICAgIGlmICghYTIodDMgKyAxLCBpMlt0M10sIG8zLCB1MykgJiYgKytjMiA+IGwyKQogICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB0MysrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAodmFyIGgyID0gMDsgaDIgPCBzMi5sZW5ndGg7IGgyKyspIHsKICAgICAgICAgICAgZm9yICh2YXIgZzIgPSBzMltoMl0sIG0yID0gaTIubGVuZ3RoIC0gZzIub2xkTGluZXMsIHkyID0gMCwgRDIgPSBmMiArIGcyLm9sZFN0YXJ0IC0gMSwgRTIgPSAoMCwgYWkuZGVmYXVsdCkoRDIsIHAyLCBtMik7IHkyICE9PSB2b2lkIDA7IHkyID0gRTIoKSkKICAgICAgICAgICAgICBpZiAoZDIoZzIsIEQyICsgeTIpKSB7CiAgICAgICAgICAgICAgICBnMi5vZmZzZXQgPSBmMiArPSB5MjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHkyID09PSB2b2lkIDApCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBwMiA9IGcyLm9mZnNldCArIGcyLm9sZFN0YXJ0ICsgZzIub2xkTGluZXM7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKHZhciBDMiA9IDAsIGIyID0gMDsgYjIgPCBzMi5sZW5ndGg7IGIyKyspIHsKICAgICAgICAgICAgdmFyIHYyID0gczJbYjJdLCBBMiA9IHYyLm9sZFN0YXJ0ICsgdjIub2Zmc2V0ICsgQzIgLSAxOwogICAgICAgICAgICBDMiArPSB2Mi5uZXdMaW5lcyAtIHYyLm9sZExpbmVzOwogICAgICAgICAgICBmb3IgKHZhciBGMiA9IDA7IEYyIDwgdjIubGluZXMubGVuZ3RoOyBGMisrKSB7CiAgICAgICAgICAgICAgdmFyIHgyID0gdjIubGluZXNbRjJdLCBTMiA9IHgyLmxlbmd0aCA+IDAgPyB4MlswXSA6ICIgIiwgdzIgPSB4Mi5sZW5ndGggPiAwID8geDIuc3Vic3RyKDEpIDogeDIsIFQyID0gdjIubGluZWRlbGltaXRlcnNbRjJdOwogICAgICAgICAgICAgIGlmIChTMiA9PT0gIiAiKQogICAgICAgICAgICAgICAgQTIrKzsKICAgICAgICAgICAgICBlbHNlIGlmIChTMiA9PT0gIi0iKQogICAgICAgICAgICAgICAgaTIuc3BsaWNlKEEyLCAxKSwgdTIuc3BsaWNlKEEyLCAxKTsKICAgICAgICAgICAgICBlbHNlIGlmIChTMiA9PT0gIisiKQogICAgICAgICAgICAgICAgaTIuc3BsaWNlKEEyLCAwLCB3MiksIHUyLnNwbGljZShBMiwgMCwgVDIpLCBBMisrOwogICAgICAgICAgICAgIGVsc2UgaWYgKFMyID09PSAiXFwiKSB7CiAgICAgICAgICAgICAgICB2YXIgQjIgPSB2Mi5saW5lc1tGMiAtIDFdID8gdjIubGluZXNbRjIgLSAxXVswXSA6IG51bGw7CiAgICAgICAgICAgICAgICBCMiA9PT0gIisiID8gcjIgPSB0cnVlIDogQjIgPT09ICItIiAmJiAobzIgPSB0cnVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChyMikKICAgICAgICAgICAgZm9yICg7ICFpMltpMi5sZW5ndGggLSAxXTsgKQogICAgICAgICAgICAgIGkyLnBvcCgpLCB1Mi5wb3AoKTsKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgbzIgJiYgKGkyLnB1c2goIiIpLCB1Mi5wdXNoKCJcbiIpKTsKICAgICAgICAgIGZvciAodmFyIE4yID0gMDsgTjIgPCBpMi5sZW5ndGggLSAxOyBOMisrKQogICAgICAgICAgICBpMltOMl0gPSBpMltOMl0gKyB1MltOMl07CiAgICAgICAgICByZXR1cm4gaTIuam9pbigiIik7CiAgICAgICAgfQogICAgICAgIHZhciBsaSA9IHt9LCBwaSA9IHt9OwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwaSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCBwaS5zdHJ1Y3R1cmVkUGF0Y2ggPSBnaSwgcGkuZm9ybWF0UGF0Y2ggPSBtaSwgcGkuY3JlYXRlVHdvRmlsZXNQYXRjaCA9IHlpLCBwaS5jcmVhdGVQYXRjaCA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIsIHIyLCBvMiwgaTIpIHsKICAgICAgICAgIHJldHVybiB5aShlMiwgZTIsIHQyLCBuMiwgcjIsIG8yLCBpMik7CiAgICAgICAgfTsKICAgICAgICB2YXIgZmkgPSBnOwogICAgICAgIGZ1bmN0aW9uIGRpKGUyKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZTMpKQogICAgICAgICAgICAgIHJldHVybiBoaShlMyk7CiAgICAgICAgICB9KGUyKSB8fCBmdW5jdGlvbihlMykgewogICAgICAgICAgICBpZiAodHlwZW9mIFN5bWJvbCAhPSAidW5kZWZpbmVkIiAmJiBTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGUzKSkKICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShlMyk7CiAgICAgICAgICB9KGUyKSB8fCBmdW5jdGlvbihlMywgdDIpIHsKICAgICAgICAgICAgaWYgKCFlMykKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmICh0eXBlb2YgZTMgPT0gInN0cmluZyIpCiAgICAgICAgICAgICAgcmV0dXJuIGhpKGUzLCB0Mik7CiAgICAgICAgICAgIHZhciBuMiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlMykuc2xpY2UoOCwgLTEpOwogICAgICAgICAgICBuMiA9PT0gIk9iamVjdCIgJiYgZTMuY29uc3RydWN0b3IgJiYgKG4yID0gZTMuY29uc3RydWN0b3IubmFtZSk7CiAgICAgICAgICAgIGlmIChuMiA9PT0gIk1hcCIgfHwgbjIgPT09ICJTZXQiKQogICAgICAgICAgICAgIHJldHVybiBBcnJheS5mcm9tKGUzKTsKICAgICAgICAgICAgaWYgKG4yID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuMikpCiAgICAgICAgICAgICAgcmV0dXJuIGhpKGUzLCB0Mik7CiAgICAgICAgICB9KGUyKSB8fCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7CiAgICAgICAgICB9KCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGhpKGUyLCB0MikgewogICAgICAgICAgKHQyID09IG51bGwgfHwgdDIgPiBlMi5sZW5ndGgpICYmICh0MiA9IGUyLmxlbmd0aCk7CiAgICAgICAgICBmb3IgKHZhciBuMiA9IDAsIHIyID0gbmV3IEFycmF5KHQyKTsgbjIgPCB0MjsgbjIrKykKICAgICAgICAgICAgcjJbbjJdID0gZTJbbjJdOwogICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnaShlMiwgdDIsIG4yLCByMiwgbzIsIGkyLCB1MikgewogICAgICAgICAgdTIgfHwgKHUyID0ge30pLCB1Mi5jb250ZXh0ID09PSB2b2lkIDAgJiYgKHUyLmNvbnRleHQgPSA0KTsKICAgICAgICAgIHZhciBzMiA9ICgwLCBmaS5kaWZmTGluZXMpKG4yLCByMiwgdTIpOwogICAgICAgICAgZnVuY3Rpb24gYTIoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzLm1hcChmdW5jdGlvbihlNCkgewogICAgICAgICAgICAgIHJldHVybiAiICIgKyBlNDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBzMi5wdXNoKHsgdmFsdWU6ICIiLCBsaW5lczogW10gfSk7CiAgICAgICAgICBmb3IgKHZhciBjMiA9IFtdLCBsMiA9IDAsIHAyID0gMCwgZjIgPSBbXSwgZDIgPSAxLCBoMiA9IDEsIGcyID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgdmFyIHQzID0gczJbZTNdLCBvMyA9IHQzLmxpbmVzIHx8IHQzLnZhbHVlLnJlcGxhY2UoL1xuJC8sICIiKS5zcGxpdCgiXG4iKTsKICAgICAgICAgICAgaWYgKHQzLmxpbmVzID0gbzMsIHQzLmFkZGVkIHx8IHQzLnJlbW92ZWQpIHsKICAgICAgICAgICAgICB2YXIgaTM7CiAgICAgICAgICAgICAgaWYgKCFsMikgewogICAgICAgICAgICAgICAgdmFyIGczID0gczJbZTMgLSAxXTsKICAgICAgICAgICAgICAgIGwyID0gZDIsIHAyID0gaDIsIGczICYmIChmMiA9IHUyLmNvbnRleHQgPiAwID8gYTIoZzMubGluZXMuc2xpY2UoLXUyLmNvbnRleHQpKSA6IFtdLCBsMiAtPSBmMi5sZW5ndGgsIHAyIC09IGYyLmxlbmd0aCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIChpMyA9IGYyKS5wdXNoLmFwcGx5KGkzLCBkaShvMy5tYXAoZnVuY3Rpb24oZTQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAodDMuYWRkZWQgPyAiKyIgOiAiLSIpICsgZTQ7CiAgICAgICAgICAgICAgfSkpKSwgdDMuYWRkZWQgPyBoMiArPSBvMy5sZW5ndGggOiBkMiArPSBvMy5sZW5ndGg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKGwyKQogICAgICAgICAgICAgICAgaWYgKG8zLmxlbmd0aCA8PSAyICogdTIuY29udGV4dCAmJiBlMyA8IHMyLmxlbmd0aCAtIDIpIHsKICAgICAgICAgICAgICAgICAgdmFyIG0zOwogICAgICAgICAgICAgICAgICAobTMgPSBmMikucHVzaC5hcHBseShtMywgZGkoYTIobzMpKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB2YXIgeTIsIEQyID0gTWF0aC5taW4obzMubGVuZ3RoLCB1Mi5jb250ZXh0KTsKICAgICAgICAgICAgICAgICAgKHkyID0gZjIpLnB1c2guYXBwbHkoeTIsIGRpKGEyKG8zLnNsaWNlKDAsIEQyKSkpKTsKICAgICAgICAgICAgICAgICAgdmFyIEUyID0geyBvbGRTdGFydDogbDIsIG9sZExpbmVzOiBkMiAtIGwyICsgRDIsIG5ld1N0YXJ0OiBwMiwgbmV3TGluZXM6IGgyIC0gcDIgKyBEMiwgbGluZXM6IGYyIH07CiAgICAgICAgICAgICAgICAgIGlmIChlMyA+PSBzMi5sZW5ndGggLSAyICYmIG8zLmxlbmd0aCA8PSB1Mi5jb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIEMyID0gL1xuJC8udGVzdChuMiksIGIyID0gL1xuJC8udGVzdChyMiksIHYyID0gbzMubGVuZ3RoID09IDAgJiYgZjIubGVuZ3RoID4gRTIub2xkTGluZXM7CiAgICAgICAgICAgICAgICAgICAgIUMyICYmIHYyICYmIG4yLmxlbmd0aCA+IDAgJiYgZjIuc3BsaWNlKEUyLm9sZExpbmVzLCAwLCAiXFwgTm8gbmV3bGluZSBhdCBlbmQgb2YgZmlsZSIpLCAoQzIgfHwgdjIpICYmIGIyIHx8IGYyLnB1c2goIlxcIE5vIG5ld2xpbmUgYXQgZW5kIG9mIGZpbGUiKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBjMi5wdXNoKEUyKSwgbDIgPSAwLCBwMiA9IDAsIGYyID0gW107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZDIgKz0gbzMubGVuZ3RoLCBoMiArPSBvMy5sZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIG0yID0gMDsgbTIgPCBzMi5sZW5ndGg7IG0yKyspCiAgICAgICAgICAgIGcyKG0yKTsKICAgICAgICAgIHJldHVybiB7IG9sZEZpbGVOYW1lOiBlMiwgbmV3RmlsZU5hbWU6IHQyLCBvbGRIZWFkZXI6IG8yLCBuZXdIZWFkZXI6IGkyLCBodW5rczogYzIgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbWkoZTIpIHsKICAgICAgICAgIHZhciB0MiA9IFtdOwogICAgICAgICAgZTIub2xkRmlsZU5hbWUgPT0gZTIubmV3RmlsZU5hbWUgJiYgdDIucHVzaCgiSW5kZXg6ICIgKyBlMi5vbGRGaWxlTmFtZSksIHQyLnB1c2goIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0iKSwgdDIucHVzaCgiLS0tICIgKyBlMi5vbGRGaWxlTmFtZSArIChlMi5vbGRIZWFkZXIgPT09IHZvaWQgMCA/ICIiIDogIgkiICsgZTIub2xkSGVhZGVyKSksIHQyLnB1c2goIisrKyAiICsgZTIubmV3RmlsZU5hbWUgKyAoZTIubmV3SGVhZGVyID09PSB2b2lkIDAgPyAiIiA6ICIJIiArIGUyLm5ld0hlYWRlcikpOwogICAgICAgICAgZm9yICh2YXIgbjIgPSAwOyBuMiA8IGUyLmh1bmtzLmxlbmd0aDsgbjIrKykgewogICAgICAgICAgICB2YXIgcjIgPSBlMi5odW5rc1tuMl07CiAgICAgICAgICAgIHIyLm9sZExpbmVzID09PSAwICYmIChyMi5vbGRTdGFydCAtPSAxKSwgcjIubmV3TGluZXMgPT09IDAgJiYgKHIyLm5ld1N0YXJ0IC09IDEpLCB0Mi5wdXNoKCJAQCAtIiArIHIyLm9sZFN0YXJ0ICsgIiwiICsgcjIub2xkTGluZXMgKyAiICsiICsgcjIubmV3U3RhcnQgKyAiLCIgKyByMi5uZXdMaW5lcyArICIgQEAiKSwgdDIucHVzaC5hcHBseSh0MiwgcjIubGluZXMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQyLmpvaW4oIlxuIikgKyAiXG4iOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB5aShlMiwgdDIsIG4yLCByMiwgbzIsIGkyLCB1MikgewogICAgICAgICAgcmV0dXJuIG1pKGdpKGUyLCB0MiwgbjIsIHIyLCBvMiwgaTIsIHUyKSk7CiAgICAgICAgfQogICAgICAgIHZhciBEaSA9IHt9OwogICAgICAgIGZ1bmN0aW9uIEVpKGUyLCB0MikgewogICAgICAgICAgaWYgKHQyLmxlbmd0aCA+IGUyLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgZm9yICh2YXIgbjIgPSAwOyBuMiA8IHQyLmxlbmd0aDsgbjIrKykKICAgICAgICAgICAgaWYgKHQyW24yXSAhPT0gZTJbbjJdKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoRGksICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KSwgRGkuYXJyYXlFcXVhbCA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgaWYgKGUyLmxlbmd0aCAhPT0gdDIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICByZXR1cm4gRWkoZTIsIHQyKTsKICAgICAgICB9LCBEaS5hcnJheVN0YXJ0c1dpdGggPSBFaSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGxpLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIGxpLmNhbGNMaW5lQ291bnQgPSB4aSwgbGkubWVyZ2UgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBlMiA9IFNpKGUyLCBuMiksIHQyID0gU2kodDIsIG4yKTsKICAgICAgICAgIHZhciByMiA9IHt9OwogICAgICAgICAgKGUyLmluZGV4IHx8IHQyLmluZGV4KSAmJiAocjIuaW5kZXggPSBlMi5pbmRleCB8fCB0Mi5pbmRleCk7CiAgICAgICAgICAoZTIubmV3RmlsZU5hbWUgfHwgdDIubmV3RmlsZU5hbWUpICYmICh3aShlMikgPyB3aSh0MikgPyAocjIub2xkRmlsZU5hbWUgPSBUaShyMiwgZTIub2xkRmlsZU5hbWUsIHQyLm9sZEZpbGVOYW1lKSwgcjIubmV3RmlsZU5hbWUgPSBUaShyMiwgZTIubmV3RmlsZU5hbWUsIHQyLm5ld0ZpbGVOYW1lKSwgcjIub2xkSGVhZGVyID0gVGkocjIsIGUyLm9sZEhlYWRlciwgdDIub2xkSGVhZGVyKSwgcjIubmV3SGVhZGVyID0gVGkocjIsIGUyLm5ld0hlYWRlciwgdDIubmV3SGVhZGVyKSkgOiAocjIub2xkRmlsZU5hbWUgPSBlMi5vbGRGaWxlTmFtZSwgcjIubmV3RmlsZU5hbWUgPSBlMi5uZXdGaWxlTmFtZSwgcjIub2xkSGVhZGVyID0gZTIub2xkSGVhZGVyLCByMi5uZXdIZWFkZXIgPSBlMi5uZXdIZWFkZXIpIDogKHIyLm9sZEZpbGVOYW1lID0gdDIub2xkRmlsZU5hbWUgfHwgZTIub2xkRmlsZU5hbWUsIHIyLm5ld0ZpbGVOYW1lID0gdDIubmV3RmlsZU5hbWUgfHwgZTIubmV3RmlsZU5hbWUsIHIyLm9sZEhlYWRlciA9IHQyLm9sZEhlYWRlciB8fCBlMi5vbGRIZWFkZXIsIHIyLm5ld0hlYWRlciA9IHQyLm5ld0hlYWRlciB8fCBlMi5uZXdIZWFkZXIpKTsKICAgICAgICAgIHIyLmh1bmtzID0gW107CiAgICAgICAgICB2YXIgbzIgPSAwLCBpMiA9IDAsIHUyID0gMCwgczIgPSAwOwogICAgICAgICAgZm9yICg7IG8yIDwgZTIuaHVua3MubGVuZ3RoIHx8IGkyIDwgdDIuaHVua3MubGVuZ3RoOyApIHsKICAgICAgICAgICAgdmFyIGEyID0gZTIuaHVua3NbbzJdIHx8IHsgb2xkU3RhcnQ6IDEgLyAwIH0sIGMyID0gdDIuaHVua3NbaTJdIHx8IHsgb2xkU3RhcnQ6IDEgLyAwIH07CiAgICAgICAgICAgIGlmIChCaShhMiwgYzIpKQogICAgICAgICAgICAgIHIyLmh1bmtzLnB1c2goTmkoYTIsIHUyKSksIG8yKyssIHMyICs9IGEyLm5ld0xpbmVzIC0gYTIub2xkTGluZXM7CiAgICAgICAgICAgIGVsc2UgaWYgKEJpKGMyLCBhMikpCiAgICAgICAgICAgICAgcjIuaHVua3MucHVzaChOaShjMiwgczIpKSwgaTIrKywgdTIgKz0gYzIubmV3TGluZXMgLSBjMi5vbGRMaW5lczsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgdmFyIGwyID0geyBvbGRTdGFydDogTWF0aC5taW4oYTIub2xkU3RhcnQsIGMyLm9sZFN0YXJ0KSwgb2xkTGluZXM6IDAsIG5ld1N0YXJ0OiBNYXRoLm1pbihhMi5uZXdTdGFydCArIHUyLCBjMi5vbGRTdGFydCArIHMyKSwgbmV3TGluZXM6IDAsIGxpbmVzOiBbXSB9OwogICAgICAgICAgICAgIGtpKGwyLCBhMi5vbGRTdGFydCwgYTIubGluZXMsIGMyLm9sZFN0YXJ0LCBjMi5saW5lcyksIGkyKyssIG8yKyssIHIyLmh1bmtzLnB1c2gobDIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgfTsKICAgICAgICB2YXIgQ2kgPSBwaSwgYmkgPSBpaSwgdmkgPSBEaTsKICAgICAgICBmdW5jdGlvbiBBaShlMikgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGUzKSkKICAgICAgICAgICAgICByZXR1cm4gRmkoZTMpOwogICAgICAgICAgfShlMikgfHwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBTeW1ib2wgIT0gInVuZGVmaW5lZCIgJiYgU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChlMykpCiAgICAgICAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oZTMpOwogICAgICAgICAgfShlMikgfHwgZnVuY3Rpb24oZTMsIHQyKSB7CiAgICAgICAgICAgIGlmICghZTMpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAodHlwZW9mIGUzID09ICJzdHJpbmciKQogICAgICAgICAgICAgIHJldHVybiBGaShlMywgdDIpOwogICAgICAgICAgICB2YXIgbjIgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZTMpLnNsaWNlKDgsIC0xKTsKICAgICAgICAgICAgbjIgPT09ICJPYmplY3QiICYmIGUzLmNvbnN0cnVjdG9yICYmIChuMiA9IGUzLmNvbnN0cnVjdG9yLm5hbWUpOwogICAgICAgICAgICBpZiAobjIgPT09ICJNYXAiIHx8IG4yID09PSAiU2V0IikKICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShlMyk7CiAgICAgICAgICAgIGlmIChuMiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobjIpKQogICAgICAgICAgICAgIHJldHVybiBGaShlMywgdDIpOwogICAgICAgICAgfShlMikgfHwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOwogICAgICAgICAgfSgpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBGaShlMiwgdDIpIHsKICAgICAgICAgICh0MiA9PSBudWxsIHx8IHQyID4gZTIubGVuZ3RoKSAmJiAodDIgPSBlMi5sZW5ndGgpOwogICAgICAgICAgZm9yICh2YXIgbjIgPSAwLCByMiA9IG5ldyBBcnJheSh0Mik7IG4yIDwgdDI7IG4yKyspCiAgICAgICAgICAgIHIyW24yXSA9IGUyW24yXTsKICAgICAgICAgIHJldHVybiByMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24geGkoZTIpIHsKICAgICAgICAgIHZhciB0MiA9IFZpKGUyLmxpbmVzKSwgbjIgPSB0Mi5vbGRMaW5lcywgcjIgPSB0Mi5uZXdMaW5lczsKICAgICAgICAgIG4yICE9PSB2b2lkIDAgPyBlMi5vbGRMaW5lcyA9IG4yIDogZGVsZXRlIGUyLm9sZExpbmVzLCByMiAhPT0gdm9pZCAwID8gZTIubmV3TGluZXMgPSByMiA6IGRlbGV0ZSBlMi5uZXdMaW5lczsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gU2koZTIsIHQyKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGUyID09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGlmICgvXkBAL20udGVzdChlMikgfHwgL15JbmRleDovbS50ZXN0KGUyKSkKICAgICAgICAgICAgICByZXR1cm4gKDAsIGJpLnBhcnNlUGF0Y2gpKGUyKVswXTsKICAgICAgICAgICAgaWYgKCF0MikKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk11c3QgcHJvdmlkZSBhIGJhc2UgcmVmZXJlbmNlIG9yIHBhc3MgaW4gYSBwYXRjaCIpOwogICAgICAgICAgICByZXR1cm4gKDAsIENpLnN0cnVjdHVyZWRQYXRjaCkodm9pZCAwLCB2b2lkIDAsIHQyLCBlMik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHdpKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIubmV3RmlsZU5hbWUgJiYgZTIubmV3RmlsZU5hbWUgIT09IGUyLm9sZEZpbGVOYW1lOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBUaShlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gdDIgPT09IG4yID8gdDIgOiAoZTIuY29uZmxpY3QgPSB0cnVlLCB7IG1pbmU6IHQyLCB0aGVpcnM6IG4yIH0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBCaShlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBlMi5vbGRTdGFydCA8IHQyLm9sZFN0YXJ0ICYmIGUyLm9sZFN0YXJ0ICsgZTIub2xkTGluZXMgPCB0Mi5vbGRTdGFydDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gTmkoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4geyBvbGRTdGFydDogZTIub2xkU3RhcnQsIG9sZExpbmVzOiBlMi5vbGRMaW5lcywgbmV3U3RhcnQ6IGUyLm5ld1N0YXJ0ICsgdDIsIG5ld0xpbmVzOiBlMi5uZXdMaW5lcywgbGluZXM6IGUyLmxpbmVzIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGtpKGUyLCB0MiwgbjIsIHIyLCBvMikgewogICAgICAgICAgdmFyIGkyID0geyBvZmZzZXQ6IHQyLCBsaW5lczogbjIsIGluZGV4OiAwIH0sIHUyID0geyBvZmZzZXQ6IHIyLCBsaW5lczogbzIsIGluZGV4OiAwIH07CiAgICAgICAgICBmb3IgKExpKGUyLCBpMiwgdTIpLCBMaShlMiwgdTIsIGkyKTsgaTIuaW5kZXggPCBpMi5saW5lcy5sZW5ndGggJiYgdTIuaW5kZXggPCB1Mi5saW5lcy5sZW5ndGg7ICkgewogICAgICAgICAgICB2YXIgczIgPSBpMi5saW5lc1tpMi5pbmRleF0sIGEyID0gdTIubGluZXNbdTIuaW5kZXhdOwogICAgICAgICAgICBpZiAoczJbMF0gIT09ICItIiAmJiBzMlswXSAhPT0gIisiIHx8IGEyWzBdICE9PSAiLSIgJiYgYTJbMF0gIT09ICIrIikKICAgICAgICAgICAgICBpZiAoczJbMF0gPT09ICIrIiAmJiBhMlswXSA9PT0gIiAiKSB7CiAgICAgICAgICAgICAgICB2YXIgYzI7CiAgICAgICAgICAgICAgICAoYzIgPSBlMi5saW5lcykucHVzaC5hcHBseShjMiwgQWkoX2koaTIpKSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChhMlswXSA9PT0gIisiICYmIHMyWzBdID09PSAiICIpIHsKICAgICAgICAgICAgICAgIHZhciBsMjsKICAgICAgICAgICAgICAgIChsMiA9IGUyLmxpbmVzKS5wdXNoLmFwcGx5KGwyLCBBaShfaSh1MikpKTsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIHMyWzBdID09PSAiLSIgJiYgYTJbMF0gPT09ICIgIiA/IE9pKGUyLCBpMiwgdTIpIDogYTJbMF0gPT09ICItIiAmJiBzMlswXSA9PT0gIiAiID8gT2koZTIsIHUyLCBpMiwgdHJ1ZSkgOiBzMiA9PT0gYTIgPyAoZTIubGluZXMucHVzaChzMiksIGkyLmluZGV4KyssIHUyLmluZGV4KyspIDogSWkoZTIsIF9pKGkyKSwgX2kodTIpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgIFBpKGUyLCBpMiwgdTIpOwogICAgICAgICAgfQogICAgICAgICAgamkoZTIsIGkyKSwgamkoZTIsIHUyKSwgeGkoZTIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBQaShlMiwgdDIsIG4yKSB7CiAgICAgICAgICB2YXIgcjIgPSBfaSh0MiksIG8yID0gX2kobjIpOwogICAgICAgICAgaWYgKE1pKHIyKSAmJiBNaShvMikpIHsKICAgICAgICAgICAgdmFyIGkyLCB1MjsKICAgICAgICAgICAgaWYgKCgwLCB2aS5hcnJheVN0YXJ0c1dpdGgpKHIyLCBvMikgJiYgUmkobjIsIHIyLCByMi5sZW5ndGggLSBvMi5sZW5ndGgpKQogICAgICAgICAgICAgIHJldHVybiB2b2lkIChpMiA9IGUyLmxpbmVzKS5wdXNoLmFwcGx5KGkyLCBBaShyMikpOwogICAgICAgICAgICBpZiAoKDAsIHZpLmFycmF5U3RhcnRzV2l0aCkobzIsIHIyKSAmJiBSaSh0MiwgbzIsIG8yLmxlbmd0aCAtIHIyLmxlbmd0aCkpCiAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgKHUyID0gZTIubGluZXMpLnB1c2guYXBwbHkodTIsIEFpKG8yKSk7CiAgICAgICAgICB9IGVsc2UgaWYgKCgwLCB2aS5hcnJheUVxdWFsKShyMiwgbzIpKSB7CiAgICAgICAgICAgIHZhciBzMjsKICAgICAgICAgICAgcmV0dXJuIHZvaWQgKHMyID0gZTIubGluZXMpLnB1c2guYXBwbHkoczIsIEFpKHIyKSk7CiAgICAgICAgICB9CiAgICAgICAgICBJaShlMiwgcjIsIG8yKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gT2koZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIHZhciBvMiwgaTIgPSBfaSh0MiksIHUyID0gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIHZhciBuMyA9IFtdLCByMyA9IFtdLCBvMyA9IDAsIGkzID0gZmFsc2UsIHUzID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAoOyBvMyA8IHQzLmxlbmd0aCAmJiBlMy5pbmRleCA8IGUzLmxpbmVzLmxlbmd0aDsgKSB7CiAgICAgICAgICAgICAgdmFyIHMyID0gZTMubGluZXNbZTMuaW5kZXhdLCBhMiA9IHQzW28zXTsKICAgICAgICAgICAgICBpZiAoYTJbMF0gPT09ICIrIikKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGlmIChpMyA9IGkzIHx8IHMyWzBdICE9PSAiICIsIHIzLnB1c2goYTIpLCBvMysrLCBzMlswXSA9PT0gIisiKQogICAgICAgICAgICAgICAgZm9yICh1MyA9IHRydWU7IHMyWzBdID09PSAiKyI7ICkKICAgICAgICAgICAgICAgICAgbjMucHVzaChzMiksIHMyID0gZTMubGluZXNbKytlMy5pbmRleF07CiAgICAgICAgICAgICAgYTIuc3Vic3RyKDEpID09PSBzMi5zdWJzdHIoMSkgPyAobjMucHVzaChzMiksIGUzLmluZGV4KyspIDogdTMgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgICh0M1tvM10gfHwgIiIpWzBdID09PSAiKyIgJiYgaTMgJiYgKHUzID0gdHJ1ZSk7CiAgICAgICAgICAgIGlmICh1MykKICAgICAgICAgICAgICByZXR1cm4gbjM7CiAgICAgICAgICAgIGZvciAoOyBvMyA8IHQzLmxlbmd0aDsgKQogICAgICAgICAgICAgIHIzLnB1c2godDNbbzMrK10pOwogICAgICAgICAgICByZXR1cm4geyBtZXJnZWQ6IHIzLCBjaGFuZ2VzOiBuMyB9OwogICAgICAgICAgfShuMiwgaTIpOwogICAgICAgICAgdTIubWVyZ2VkID8gKG8yID0gZTIubGluZXMpLnB1c2guYXBwbHkobzIsIEFpKHUyLm1lcmdlZCkpIDogSWkoZTIsIHIyID8gdTIgOiBpMiwgcjIgPyBpMiA6IHUyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gSWkoZTIsIHQyLCBuMikgewogICAgICAgICAgZTIuY29uZmxpY3QgPSB0cnVlLCBlMi5saW5lcy5wdXNoKHsgY29uZmxpY3Q6IHRydWUsIG1pbmU6IHQyLCB0aGVpcnM6IG4yIH0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBMaShlMiwgdDIsIG4yKSB7CiAgICAgICAgICBmb3IgKDsgdDIub2Zmc2V0IDwgbjIub2Zmc2V0ICYmIHQyLmluZGV4IDwgdDIubGluZXMubGVuZ3RoOyApIHsKICAgICAgICAgICAgdmFyIHIyID0gdDIubGluZXNbdDIuaW5kZXgrK107CiAgICAgICAgICAgIGUyLmxpbmVzLnB1c2gocjIpLCB0Mi5vZmZzZXQrKzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gamkoZTIsIHQyKSB7CiAgICAgICAgICBmb3IgKDsgdDIuaW5kZXggPCB0Mi5saW5lcy5sZW5ndGg7ICkgewogICAgICAgICAgICB2YXIgbjIgPSB0Mi5saW5lc1t0Mi5pbmRleCsrXTsKICAgICAgICAgICAgZTIubGluZXMucHVzaChuMik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIF9pKGUyKSB7CiAgICAgICAgICBmb3IgKHZhciB0MiA9IFtdLCBuMiA9IGUyLmxpbmVzW2UyLmluZGV4XVswXTsgZTIuaW5kZXggPCBlMi5saW5lcy5sZW5ndGg7ICkgewogICAgICAgICAgICB2YXIgcjIgPSBlMi5saW5lc1tlMi5pbmRleF07CiAgICAgICAgICAgIGlmIChuMiA9PT0gIi0iICYmIHIyWzBdID09PSAiKyIgJiYgKG4yID0gIisiKSwgbjIgIT09IHIyWzBdKQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB0Mi5wdXNoKHIyKSwgZTIuaW5kZXgrKzsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gTWkoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5yZWR1Y2UoZnVuY3Rpb24oZTMsIHQyKSB7CiAgICAgICAgICAgIHJldHVybiBlMyAmJiB0MlswXSA9PT0gIi0iOwogICAgICAgICAgfSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFJpKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGZvciAodmFyIHIyID0gMDsgcjIgPCBuMjsgcjIrKykgewogICAgICAgICAgICB2YXIgbzIgPSB0Mlt0Mi5sZW5ndGggLSBuMiArIHIyXS5zdWJzdHIoMSk7CiAgICAgICAgICAgIGlmIChlMi5saW5lc1tlMi5pbmRleCArIHIyXSAhPT0gIiAiICsgbzIpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUyLmluZGV4ICs9IG4yLCB0cnVlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBWaShlMikgewogICAgICAgICAgdmFyIHQyID0gMCwgbjIgPSAwOwogICAgICAgICAgcmV0dXJuIGUyLmZvckVhY2goZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBlMyAhPSAic3RyaW5nIikgewogICAgICAgICAgICAgIHZhciByMiA9IFZpKGUzLm1pbmUpLCBvMiA9IFZpKGUzLnRoZWlycyk7CiAgICAgICAgICAgICAgdDIgIT09IHZvaWQgMCAmJiAocjIub2xkTGluZXMgPT09IG8yLm9sZExpbmVzID8gdDIgKz0gcjIub2xkTGluZXMgOiB0MiA9IHZvaWQgMCksIG4yICE9PSB2b2lkIDAgJiYgKHIyLm5ld0xpbmVzID09PSBvMi5uZXdMaW5lcyA/IG4yICs9IHIyLm5ld0xpbmVzIDogbjIgPSB2b2lkIDApOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBuMiA9PT0gdm9pZCAwIHx8IGUzWzBdICE9PSAiKyIgJiYgZTNbMF0gIT09ICIgIiB8fCBuMisrLCB0MiA9PT0gdm9pZCAwIHx8IGUzWzBdICE9PSAiLSIgJiYgZTNbMF0gIT09ICIgIiB8fCB0MisrOwogICAgICAgICAgfSksIHsgb2xkTGluZXM6IHQyLCBuZXdMaW5lczogbjIgfTsKICAgICAgICB9CiAgICAgICAgdmFyICRpID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KCRpLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksICRpLmNvbnZlcnRDaGFuZ2VzVG9ETVAgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgZm9yICh2YXIgdDIsIG4yLCByMiA9IFtdLCBvMiA9IDA7IG8yIDwgZTIubGVuZ3RoOyBvMisrKQogICAgICAgICAgICB0MiA9IGUyW28yXSwgbjIgPSB0Mi5hZGRlZCA/IDEgOiB0Mi5yZW1vdmVkID8gLTEgOiAwLCByMi5wdXNoKFtuMiwgdDIudmFsdWVdKTsKICAgICAgICAgIHJldHVybiByMjsKICAgICAgICB9OwogICAgICAgIHZhciBXaSA9IHt9OwogICAgICAgIGZ1bmN0aW9uIHFpKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSBlMjsKICAgICAgICAgIHJldHVybiB0MiA9ICh0MiA9ICh0MiA9ICh0MiA9IHQyLnJlcGxhY2UoLyYvZywgIiZhbXA7IikpLnJlcGxhY2UoLzwvZywgIiZsdDsiKSkucmVwbGFjZSgvPi9nLCAiJmd0OyIpKS5yZXBsYWNlKC8iL2csICImcXVvdDsiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVWkoZTIpIHsKICAgICAgICAgIHJldHVybiB7IHR5cGU6ICJjb25jYXQiLCBwYXJ0czogZTIgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gemkoZTIpIHsKICAgICAgICAgIHJldHVybiB7IHR5cGU6ICJpbmRlbnQiLCBjb250ZW50czogZTIgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gR2koZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4geyB0eXBlOiAiYWxpZ24iLCBjb250ZW50czogdDIsIG46IGUyIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEhpKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICAgICAgcmV0dXJuIHsgdHlwZTogImdyb3VwIiwgaWQ6IHQyLmlkLCBjb250ZW50czogZTIsIGJyZWFrOiBCb29sZWFuKHQyLnNob3VsZEJyZWFrKSwgZXhwYW5kZWRTdGF0ZXM6IHQyLmV4cGFuZGVkU3RhdGVzIH07CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXaSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCBXaS5jb252ZXJ0Q2hhbmdlc1RvWE1MID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGZvciAodmFyIHQyID0gW10sIG4yID0gMDsgbjIgPCBlMi5sZW5ndGg7IG4yKyspIHsKICAgICAgICAgICAgdmFyIHIyID0gZTJbbjJdOwogICAgICAgICAgICByMi5hZGRlZCA/IHQyLnB1c2goIjxpbnM+IikgOiByMi5yZW1vdmVkICYmIHQyLnB1c2goIjxkZWw+IiksIHQyLnB1c2gocWkocjIudmFsdWUpKSwgcjIuYWRkZWQgPyB0Mi5wdXNoKCI8L2lucz4iKSA6IHIyLnJlbW92ZWQgJiYgdDIucHVzaCgiPC9kZWw+Iik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdDIuam9pbigiIik7CiAgICAgICAgfSwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJEaWZmIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdDIuZGVmYXVsdDsKICAgICAgICAgIH0gfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgImRpZmZDaGFycyIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIG4yLmRpZmZDaGFyczsKICAgICAgICAgIH0gfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgImRpZmZXb3JkcyIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHIyLmRpZmZXb3JkczsKICAgICAgICAgIH0gfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgImRpZmZXb3Jkc1dpdGhTcGFjZSIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHIyLmRpZmZXb3Jkc1dpdGhTcGFjZTsKICAgICAgICAgIH0gfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgImRpZmZMaW5lcyIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGkyLmRpZmZMaW5lczsKICAgICAgICAgIH0gfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgImRpZmZUcmltbWVkTGluZXMiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBpMi5kaWZmVHJpbW1lZExpbmVzOwogICAgICAgICAgfSB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCAiZGlmZlNlbnRlbmNlcyIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHMyLmRpZmZTZW50ZW5jZXM7CiAgICAgICAgICB9IH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJkaWZmQ3NzIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gYzIuZGlmZkNzczsKICAgICAgICAgIH0gfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgImRpZmZKc29uIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gbDIuZGlmZkpzb247CiAgICAgICAgICB9IH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJjYW5vbmljYWxpemUiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBsMi5jYW5vbmljYWxpemU7CiAgICAgICAgICB9IH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJkaWZmQXJyYXlzIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gcDIuZGlmZkFycmF5czsKICAgICAgICAgIH0gfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgImFwcGx5UGF0Y2giLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBmMi5hcHBseVBhdGNoOwogICAgICAgICAgfSB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCAiYXBwbHlQYXRjaGVzIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gZjIuYXBwbHlQYXRjaGVzOwogICAgICAgICAgfSB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCAicGFyc2VQYXRjaCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGQyLnBhcnNlUGF0Y2g7CiAgICAgICAgICB9IH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJtZXJnZSIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGgyLm1lcmdlOwogICAgICAgICAgfSB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCAic3RydWN0dXJlZFBhdGNoIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gbTIuc3RydWN0dXJlZFBhdGNoOwogICAgICAgICAgfSB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCAiY3JlYXRlVHdvRmlsZXNQYXRjaCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIG0yLmNyZWF0ZVR3b0ZpbGVzUGF0Y2g7CiAgICAgICAgICB9IH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJjcmVhdGVQYXRjaCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIG0yLmNyZWF0ZVBhdGNoOwogICAgICAgICAgfSB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCAiY29udmVydENoYW5nZXNUb0RNUCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHkyLmNvbnZlcnRDaGFuZ2VzVG9ETVA7CiAgICAgICAgICB9IH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJjb252ZXJ0Q2hhbmdlc1RvWE1MIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gRDIuY29udmVydENoYW5nZXNUb1hNTDsKICAgICAgICAgIH0gfSk7CiAgICAgICAgICB2YXIgdDIgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gZTMgJiYgZTMuX19lc01vZHVsZSA/IGUzIDogeyBkZWZhdWx0OiBlMyB9OwogICAgICAgICAgfShvKSwgbjIgPSB1LCByMiA9IGEsIGkyID0gZywgczIgPSBFLCBjMiA9IHYsIGwyID0gSm8sIHAyID0gdGksIGYyID0gb2ksIGQyID0gaWksIGgyID0gbGksIG0yID0gcGksIHkyID0gJGksIEQyID0gV2k7CiAgICAgICAgfShyKTsKICAgICAgICBjb25zdCBKaSA9IHsgdHlwZTogImJyZWFrLXBhcmVudCIgfSwgWGkgPSB7IHR5cGU6ICJsaW5lIiwgaGFyZDogdHJ1ZSB9LCBZaSA9IHsgdHlwZTogImxpbmUiLCBoYXJkOiB0cnVlLCBsaXRlcmFsOiB0cnVlIH0sIEtpID0gVWkoW1hpLCBKaV0pLCBRaSA9IFVpKFtZaSwgSmldKTsKICAgICAgICB2YXIgWmkgPSB7IGNvbmNhdDogVWksIGpvaW46IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSBbXTsKICAgICAgICAgIGZvciAobGV0IHIyID0gMDsgcjIgPCB0Mi5sZW5ndGg7IHIyKyspCiAgICAgICAgICAgIHIyICE9PSAwICYmIG4yLnB1c2goZTIpLCBuMi5wdXNoKHQyW3IyXSk7CiAgICAgICAgICByZXR1cm4gVWkobjIpOwogICAgICAgIH0sIGxpbmU6IHsgdHlwZTogImxpbmUiIH0sIHNvZnRsaW5lOiB7IHR5cGU6ICJsaW5lIiwgc29mdDogdHJ1ZSB9LCBoYXJkbGluZTogS2ksIGxpdGVyYWxsaW5lOiBRaSwgZ3JvdXA6IEhpLCBjb25kaXRpb25hbEdyb3VwOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBIaShlMlswXSwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0MiksIHt9LCB7IGV4cGFuZGVkU3RhdGVzOiBlMiB9KSk7CiAgICAgICAgfSwgZmlsbDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiB7IHR5cGU6ICJmaWxsIiwgcGFydHM6IGUyIH07CiAgICAgICAgfSwgbGluZVN1ZmZpeDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiB7IHR5cGU6ICJsaW5lLXN1ZmZpeCIsIGNvbnRlbnRzOiBlMiB9OwogICAgICAgIH0sIGxpbmVTdWZmaXhCb3VuZGFyeTogeyB0eXBlOiAibGluZS1zdWZmaXgtYm91bmRhcnkiIH0sIGN1cnNvcjogeyB0eXBlOiAiY3Vyc29yIiwgcGxhY2Vob2xkZXI6IFN5bWJvbCgiY3Vyc29yIikgfSwgYnJlYWtQYXJlbnQ6IEppLCBpZkJyZWFrOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGxldCBuMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzJdIDoge307CiAgICAgICAgICByZXR1cm4geyB0eXBlOiAiaWYtYnJlYWsiLCBicmVha0NvbnRlbnRzOiBlMiwgZmxhdENvbnRlbnRzOiB0MiwgZ3JvdXBJZDogbjIuZ3JvdXBJZCB9OwogICAgICAgIH0sIHRyaW06IHsgdHlwZTogInRyaW0iIH0sIGluZGVudDogemksIGluZGVudElmQnJlYWs6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHsgdHlwZTogImluZGVudC1pZi1icmVhayIsIGNvbnRlbnRzOiBlMiwgZ3JvdXBJZDogdDIuZ3JvdXBJZCwgbmVnYXRlOiB0Mi5uZWdhdGUgfTsKICAgICAgICB9LCBhbGlnbjogR2ksIGFkZEFsaWdubWVudFRvRG9jOiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBsZXQgcjIgPSBlMjsKICAgICAgICAgIGlmICh0MiA+IDApIHsKICAgICAgICAgICAgZm9yIChsZXQgZTMgPSAwOyBlMyA8IE1hdGguZmxvb3IodDIgLyBuMik7ICsrZTMpCiAgICAgICAgICAgICAgcjIgPSB6aShyMik7CiAgICAgICAgICAgIHIyID0gR2kodDIgJSBuMiwgcjIpLCByMiA9IEdpKE51bWJlci5ORUdBVElWRV9JTkZJTklUWSwgcjIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgIH0sIG1hcmtBc1Jvb3Q6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gR2koeyB0eXBlOiAicm9vdCIgfSwgZTIpOwogICAgICAgIH0sIGRlZGVudFRvUm9vdDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBHaShOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksIGUyKTsKICAgICAgICB9LCBkZWRlbnQ6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gR2koLTEsIGUyKTsKICAgICAgICB9LCBoYXJkbGluZVdpdGhvdXRCcmVha1BhcmVudDogWGksIGxpdGVyYWxsaW5lV2l0aG91dEJyZWFrUGFyZW50OiBZaSwgbGFiZWw6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHsgdHlwZTogImxhYmVsIiwgbGFiZWw6IGUyLCBjb250ZW50czogdDIgfTsKICAgICAgICB9IH0sIGV1ID0geyBleHBvcnRzOiB7fSB9OwogICAgICAgIGNvbnN0IHR1ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBsZXQgeyBvbmx5Rmlyc3Q6IGUyID0gZmFsc2UgfSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgICAgICBjb25zdCB0MiA9IFsiW1xcdTAwMUJcXHUwMDlCXVtbXFxdKCkjOz9dKig/Oig/Oig/Oig/OjtbLWEtekEtWlxcZFxcLyMmLjo9PyVAfl9dKykqfFthLXpBLVpcXGRdKyg/OjtbLWEtekEtWlxcZFxcLyMmLjo9PyVAfl9dKikqKT9cXHUwMDA3KSIsICIoPzooPzpcXGR7MSw0fSg/OjtcXGR7MCw0fSkqKT9bXFxkQS1QUi1UWmNmLW50cXJ5PT48fl0pKSJdLmpvaW4oInwiKTsKICAgICAgICAgIHJldHVybiBuZXcgUmVnRXhwKHQyLCBlMiA/IHZvaWQgMCA6ICJnIik7CiAgICAgICAgfTsKICAgICAgICB2YXIgbnUgPSB7IGV4cG9ydHM6IHt9IH07CiAgICAgICAgY29uc3QgcnUgPSAoZTIpID0+ICFOdW1iZXIuaXNOYU4oZTIpICYmIChlMiA+PSA0MzUyICYmIChlMiA8PSA0NDQ3IHx8IGUyID09PSA5MDAxIHx8IGUyID09PSA5MDAyIHx8IDExOTA0IDw9IGUyICYmIGUyIDw9IDEyODcxICYmIGUyICE9PSAxMjM1MSB8fCAxMjg4MCA8PSBlMiAmJiBlMiA8PSAxOTkwMyB8fCAxOTk2OCA8PSBlMiAmJiBlMiA8PSA0MjE4MiB8fCA0MzM2MCA8PSBlMiAmJiBlMiA8PSA0MzM4OCB8fCA0NDAzMiA8PSBlMiAmJiBlMiA8PSA1NTIwMyB8fCA2Mzc0NCA8PSBlMiAmJiBlMiA8PSA2NDI1NSB8fCA2NTA0MCA8PSBlMiAmJiBlMiA8PSA2NTA0OSB8fCA2NTA3MiA8PSBlMiAmJiBlMiA8PSA2NTEzMSB8fCA2NTI4MSA8PSBlMiAmJiBlMiA8PSA2NTM3NiB8fCA2NTUwNCA8PSBlMiAmJiBlMiA8PSA2NTUxMCB8fCAxMTA1OTIgPD0gZTIgJiYgZTIgPD0gMTEwNTkzIHx8IDEyNzQ4OCA8PSBlMiAmJiBlMiA8PSAxMjc1NjkgfHwgMTMxMDcyIDw9IGUyICYmIGUyIDw9IDI2MjE0MSkpOwogICAgICAgIG51LmV4cG9ydHMgPSBydSwgbnUuZXhwb3J0cy5kZWZhdWx0ID0gcnU7CiAgICAgICAgY29uc3Qgb3UgPSAoZTIpID0+IHR5cGVvZiBlMiA9PSAic3RyaW5nIiA/IGUyLnJlcGxhY2UodHUoKSwgIiIpIDogZTIsIGl1ID0gbnUuZXhwb3J0cywgdXUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAvXHVEODNDXHVERkY0XHVEQjQwXHVEQzY3XHVEQjQwXHVEQzYyKD86XHVEQjQwXHVEQzY1XHVEQjQwXHVEQzZFXHVEQjQwXHVEQzY3fFx1REI0MFx1REM3M1x1REI0MFx1REM2M1x1REI0MFx1REM3NHxcdURCNDBcdURDNzdcdURCNDBcdURDNkNcdURCNDBcdURDNzMpXHVEQjQwXHVEQzdGfFx1RDgzRFx1REM2OCg/Olx1RDgzQ1x1REZGQ1x1MjAwRCg/Olx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRFx1REM2OFx1RDgzQ1x1REZGQnxcdUQ4M0NbXHVERjNFXHVERjczXHVERjkzXHVERkE0XHVERkE4XHVERkVCXHVERkVEXXxcdUQ4M0RbXHVEQ0JCXHVEQ0JDXHVERDI3XHVERDJDXHVERTgwXHVERTkyXXxcdUQ4M0VbXHVEREFGLVx1RERCM1x1RERCQ1x1RERCRF0pfFx1RDgzQ1x1REZGRlx1MjAwRCg/Olx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRFx1REM2OCg/Olx1RDgzQ1tcdURGRkItXHVERkZFXSl8XHVEODNDW1x1REYzRVx1REY3M1x1REY5M1x1REZBNFx1REZBOFx1REZFQlx1REZFRF18XHVEODNEW1x1RENCQlx1RENCQ1x1REQyN1x1REQyQ1x1REU4MFx1REU5Ml18XHVEODNFW1x1RERBRi1cdUREQjNcdUREQkNcdUREQkRdKXxcdUQ4M0NcdURGRkVcdTIwMEQoPzpcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0RcdURDNjgoPzpcdUQ4M0NbXHVERkZCLVx1REZGRF0pfFx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSl8XHVEODNDXHVERkZEXHUyMDBEKD86XHVEODNFXHVERDFEXHUyMDBEXHVEODNEXHVEQzY4KD86XHVEODNDW1x1REZGQlx1REZGQ10pfFx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSl8XHUyMDBEKD86XHUyNzY0XHVGRTBGXHUyMDBEKD86XHVEODNEXHVEQzhCXHUyMDBEKT9cdUQ4M0RcdURDNjh8KD86XHVEODNEW1x1REM2OFx1REM2OV0pXHUyMDBEKD86XHVEODNEXHVEQzY2XHUyMDBEXHVEODNEXHVEQzY2fFx1RDgzRFx1REM2N1x1MjAwRCg/Olx1RDgzRFtcdURDNjZcdURDNjddKSl8XHVEODNEXHVEQzY2XHUyMDBEXHVEODNEXHVEQzY2fFx1RDgzRFx1REM2N1x1MjAwRCg/Olx1RDgzRFtcdURDNjZcdURDNjddKXwoPzpcdUQ4M0RbXHVEQzY4XHVEQzY5XSlcdTIwMEQoPzpcdUQ4M0RbXHVEQzY2XHVEQzY3XSl8W1x1MjY5NVx1MjY5Nlx1MjcwOF1cdUZFMEZ8XHVEODNEW1x1REM2Nlx1REM2N118XHVEODNDW1x1REYzRVx1REY3M1x1REY5M1x1REZBNFx1REZBOFx1REZFQlx1REZFRF18XHVEODNEW1x1RENCQlx1RENCQ1x1REQyN1x1REQyQ1x1REU4MFx1REU5Ml18XHVEODNFW1x1RERBRi1cdUREQjNcdUREQkNcdUREQkRdKXwoPzpcdUQ4M0NcdURGRkJcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkZcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkVcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkRcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkNcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XSlcdUZFMEZ8XHVEODNDXHVERkZCXHUyMDBEKD86XHVEODNDW1x1REYzRVx1REY3M1x1REY5M1x1REZBNFx1REZBOFx1REZFQlx1REZFRF18XHVEODNEW1x1RENCQlx1RENCQ1x1REQyN1x1REQyQ1x1REU4MFx1REU5Ml18XHVEODNFW1x1RERBRi1cdUREQjNcdUREQkNcdUREQkRdKXxcdUQ4M0NbXHVERkZCLVx1REZGRl0pfCg/Olx1RDgzRVx1REREMVx1RDgzQ1x1REZGQlx1MjAwRFx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRVx1REREMXxcdUQ4M0RcdURDNjlcdUQ4M0NcdURGRkNcdTIwMERcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0RcdURDNjkpXHVEODNDXHVERkZCfFx1RDgzRVx1REREMSg/Olx1RDgzQ1x1REZGRlx1MjAwRFx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRVx1REREMSg/Olx1RDgzQ1tcdURGRkItXHVERkZGXSl8XHUyMDBEXHVEODNFXHVERDFEXHUyMDBEXHVEODNFXHVEREQxKXwoPzpcdUQ4M0VcdURERDFcdUQ4M0NcdURGRkVcdTIwMERcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0VcdURERDF8XHVEODNEXHVEQzY5XHVEODNDXHVERkZGXHUyMDBEXHVEODNFXHVERDFEXHUyMDBEKD86XHVEODNEW1x1REM2OFx1REM2OV0pKSg/Olx1RDgzQ1tcdURGRkItXHVERkZFXSl8KD86XHVEODNFXHVEREQxXHVEODNDXHVERkZDXHUyMDBEXHVEODNFXHVERDFEXHUyMDBEXHVEODNFXHVEREQxfFx1RDgzRFx1REM2OVx1RDgzQ1x1REZGRFx1MjAwRFx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRFx1REM2OSkoPzpcdUQ4M0NbXHVERkZCXHVERkZDXSl8XHVEODNEXHVEQzY5KD86XHVEODNDXHVERkZFXHUyMDBEKD86XHVEODNFXHVERDFEXHUyMDBEXHVEODNEXHVEQzY4KD86XHVEODNDW1x1REZGQi1cdURGRkRcdURGRkZdKXxcdUQ4M0NbXHVERjNFXHVERjczXHVERjkzXHVERkE0XHVERkE4XHVERkVCXHVERkVEXXxcdUQ4M0RbXHVEQ0JCXHVEQ0JDXHVERDI3XHVERDJDXHVERTgwXHVERTkyXXxcdUQ4M0VbXHVEREFGLVx1RERCM1x1RERCQ1x1RERCRF0pfFx1RDgzQ1x1REZGQ1x1MjAwRCg/Olx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRFx1REM2OCg/Olx1RDgzQ1tcdURGRkJcdURGRkQtXHVERkZGXSl8XHVEODNDW1x1REYzRVx1REY3M1x1REY5M1x1REZBNFx1REZBOFx1REZFQlx1REZFRF18XHVEODNEW1x1RENCQlx1RENCQ1x1REQyN1x1REQyQ1x1REU4MFx1REU5Ml18XHVEODNFW1x1RERBRi1cdUREQjNcdUREQkNcdUREQkRdKXxcdUQ4M0NcdURGRkJcdTIwMEQoPzpcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0RcdURDNjgoPzpcdUQ4M0NbXHVERkZDLVx1REZGRl0pfFx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSl8XHVEODNDXHVERkZEXHUyMDBEKD86XHVEODNFXHVERDFEXHUyMDBEXHVEODNEXHVEQzY4KD86XHVEODNDW1x1REZGQlx1REZGQ1x1REZGRVx1REZGRl0pfFx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSl8XHUyMDBEKD86XHUyNzY0XHVGRTBGXHUyMDBEKD86XHVEODNEXHVEQzhCXHUyMDBEKD86XHVEODNEW1x1REM2OFx1REM2OV0pfFx1RDgzRFtcdURDNjhcdURDNjldKXxcdUQ4M0NbXHVERjNFXHVERjczXHVERjkzXHVERkE0XHVERkE4XHVERkVCXHVERkVEXXxcdUQ4M0RbXHVEQ0JCXHVEQ0JDXHVERDI3XHVERDJDXHVERTgwXHVERTkyXXxcdUQ4M0VbXHVEREFGLVx1RERCM1x1RERCQ1x1RERCRF0pfFx1RDgzQ1x1REZGRlx1MjAwRCg/Olx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSkpfFx1RDgzRFx1REM2OVx1MjAwRFx1RDgzRFx1REM2OVx1MjAwRCg/Olx1RDgzRFx1REM2Nlx1MjAwRFx1RDgzRFx1REM2NnxcdUQ4M0RcdURDNjdcdTIwMEQoPzpcdUQ4M0RbXHVEQzY2XHVEQzY3XSkpfCg/Olx1RDgzRVx1REREMVx1RDgzQ1x1REZGRFx1MjAwRFx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRVx1REREMXxcdUQ4M0RcdURDNjlcdUQ4M0NcdURGRkVcdTIwMERcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0RcdURDNjkpKD86XHVEODNDW1x1REZGQi1cdURGRkRdKXxcdUQ4M0RcdURDNjlcdTIwMERcdUQ4M0RcdURDNjZcdTIwMERcdUQ4M0RcdURDNjZ8XHVEODNEXHVEQzY5XHUyMDBEXHVEODNEXHVEQzY5XHUyMDBEKD86XHVEODNEW1x1REM2Nlx1REM2N10pfCg/Olx1RDgzRFx1REM0MVx1RkUwRlx1MjAwRFx1RDgzRFx1RERFOHxcdUQ4M0RcdURDNjkoPzpcdUQ4M0NcdURGRkZcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkVcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkNcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkJcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkRcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XSl8KD86KD86XHUyNkY5fFx1RDgzQ1tcdURGQ0JcdURGQ0NdfFx1RDgzRFx1REQ3NSlcdUZFMEZ8XHVEODNEXHVEQzZGfFx1RDgzRVtcdUREM0NcdUREREVcdUREREZdKVx1MjAwRFtcdTI2NDBcdTI2NDJdfCg/Olx1MjZGOXxcdUQ4M0NbXHVERkNCXHVERkNDXXxcdUQ4M0RcdURENzUpKD86XHVEODNDW1x1REZGQi1cdURGRkZdKVx1MjAwRFtcdTI2NDBcdTI2NDJdfCg/Olx1RDgzQ1tcdURGQzNcdURGQzRcdURGQ0FdfFx1RDgzRFtcdURDNkVcdURDNzFcdURDNzNcdURDNzdcdURDODFcdURDODJcdURDODZcdURDODdcdURFNDUtXHVERTQ3XHVERTRCXHVERTREXHVERTRFXHVERUEzXHVERUI0LVx1REVCNl18XHVEODNFW1x1REQyNlx1REQzNy1cdUREMzlcdUREM0RcdUREM0VcdUREQjhcdUREQjlcdUREQ0QtXHVERENGXHVEREQ2LVx1RERERF0pKD86KD86XHVEODNDW1x1REZGQi1cdURGRkZdKVx1MjAwRFtcdTI2NDBcdTI2NDJdfFx1MjAwRFtcdTI2NDBcdTI2NDJdKXxcdUQ4M0NcdURGRjRcdTIwMERcdTI2MjApXHVGRTBGfFx1RDgzRFx1REM2OVx1MjAwRFx1RDgzRFx1REM2N1x1MjAwRCg/Olx1RDgzRFtcdURDNjZcdURDNjddKXxcdUQ4M0NcdURGRjNcdUZFMEZcdTIwMERcdUQ4M0NcdURGMDh8XHVEODNEXHVEQzE1XHUyMDBEXHVEODNFXHVEREJBfFx1RDgzRFx1REM2OVx1MjAwRFx1RDgzRFx1REM2NnxcdUQ4M0RcdURDNjlcdTIwMERcdUQ4M0RcdURDNjd8XHVEODNDXHVEREZEXHVEODNDXHVEREYwfFx1RDgzQ1x1RERGNFx1RDgzQ1x1RERGMnxcdUQ4M0NcdURERjZcdUQ4M0NcdURERTZ8WyNcKjAtOV1cdUZFMEZcdTIwRTN8XHVEODNDXHVEREU3KD86XHVEODNDW1x1RERFNlx1RERFN1x1RERFOS1cdURERUZcdURERjEtXHVEREY0XHVEREY2LVx1RERGOVx1RERGQlx1RERGQ1x1RERGRVx1RERGRl0pfFx1RDgzQ1x1RERGOSg/Olx1RDgzQ1tcdURERTZcdURERThcdURERTlcdURERUItXHVEREVEXHVEREVGLVx1RERGNFx1RERGN1x1RERGOVx1RERGQlx1RERGQ1x1RERGRl0pfFx1RDgzQ1x1RERFQSg/Olx1RDgzQ1tcdURERTZcdURERThcdURERUFcdURERUNcdURERURcdURERjctXHVEREZBXSl8XHVEODNFXHVEREQxKD86XHVEODNDW1x1REZGQi1cdURGRkZdKXxcdUQ4M0NcdURERjcoPzpcdUQ4M0NbXHVEREVBXHVEREY0XHVEREY4XHVEREZBXHVEREZDXSl8XHVEODNEXHVEQzY5KD86XHVEODNDW1x1REZGQi1cdURGRkZdKXxcdUQ4M0NcdURERjIoPzpcdUQ4M0NbXHVEREU2XHVEREU4LVx1RERFRFx1RERGMC1cdURERkZdKXxcdUQ4M0NcdURERTYoPzpcdUQ4M0NbXHVEREU4LVx1RERFQ1x1RERFRVx1RERGMVx1RERGMlx1RERGNFx1RERGNi1cdURERkFcdURERkNcdURERkRcdURERkZdKXxcdUQ4M0NcdURERjAoPzpcdUQ4M0NbXHVEREVBXHVEREVDLVx1RERFRVx1RERGMlx1RERGM1x1RERGNVx1RERGN1x1RERGQ1x1RERGRVx1RERGRl0pfFx1RDgzQ1x1RERFRCg/Olx1RDgzQ1tcdURERjBcdURERjJcdURERjNcdURERjdcdURERjlcdURERkFdKXxcdUQ4M0NcdURERTkoPzpcdUQ4M0NbXHVEREVBXHVEREVDXHVEREVGXHVEREYwXHVEREYyXHVEREY0XHVEREZGXSl8XHVEODNDXHVEREZFKD86XHVEODNDW1x1RERFQVx1RERGOV0pfFx1RDgzQ1x1RERFQyg/Olx1RDgzQ1tcdURERTZcdURERTdcdURERTktXHVEREVFXHVEREYxLVx1RERGM1x1RERGNS1cdURERkFcdURERkNcdURERkVdKXxcdUQ4M0NcdURERjgoPzpcdUQ4M0NbXHVEREU2LVx1RERFQVx1RERFQy1cdURERjRcdURERjctXHVEREY5XHVEREZCXHVEREZELVx1RERGRl0pfFx1RDgzQ1x1RERFQig/Olx1RDgzQ1tcdURERUUtXHVEREYwXHVEREYyXHVEREY0XHVEREY3XSl8XHVEODNDXHVEREY1KD86XHVEODNDW1x1RERFNlx1RERFQS1cdURERURcdURERjAtXHVEREYzXHVEREY3LVx1RERGOVx1RERGQ1x1RERGRV0pfFx1RDgzQ1x1RERGQig/Olx1RDgzQ1tcdURERTZcdURERThcdURERUFcdURERUNcdURERUVcdURERjNcdURERkFdKXxcdUQ4M0NcdURERjMoPzpcdUQ4M0NbXHVEREU2XHVEREU4XHVEREVBLVx1RERFQ1x1RERFRVx1RERGMVx1RERGNFx1RERGNVx1RERGN1x1RERGQVx1RERGRl0pfFx1RDgzQ1x1RERFOCg/Olx1RDgzQ1tcdURERTZcdURERThcdURERTlcdURERUItXHVEREVFXHVEREYwLVx1RERGNVx1RERGN1x1RERGQS1cdURERkZdKXxcdUQ4M0NcdURERjEoPzpcdUQ4M0NbXHVEREU2LVx1RERFOFx1RERFRVx1RERGMFx1RERGNy1cdURERkJcdURERkVdKXxcdUQ4M0NcdURERkYoPzpcdUQ4M0NbXHVEREU2XHVEREYyXHVEREZDXSl8XHVEODNDXHVEREZDKD86XHVEODNDW1x1RERFQlx1RERGOF0pfFx1RDgzQ1x1RERGQSg/Olx1RDgzQ1tcdURERTZcdURERUNcdURERjJcdURERjNcdURERjhcdURERkVcdURERkZdKXxcdUQ4M0NcdURERUUoPzpcdUQ4M0NbXHVEREU4LVx1RERFQVx1RERGMS1cdURERjRcdURERjYtXHVEREY5XSl8XHVEODNDXHVEREVGKD86XHVEODNDW1x1RERFQVx1RERGMlx1RERGNFx1RERGNV0pfCg/Olx1RDgzQ1tcdURGQzNcdURGQzRcdURGQ0FdfFx1RDgzRFtcdURDNkVcdURDNzFcdURDNzNcdURDNzdcdURDODFcdURDODJcdURDODZcdURDODdcdURFNDUtXHVERTQ3XHVERTRCXHVERTREXHVERTRFXHVERUEzXHVERUI0LVx1REVCNl18XHVEODNFW1x1REQyNlx1REQzNy1cdUREMzlcdUREM0RcdUREM0VcdUREQjhcdUREQjlcdUREQ0QtXHVERENGXHVEREQ2LVx1RERERF0pKD86XHVEODNDW1x1REZGQi1cdURGRkZdKXwoPzpcdTI2Rjl8XHVEODNDW1x1REZDQlx1REZDQ118XHVEODNEXHVERDc1KSg/Olx1RDgzQ1tcdURGRkItXHVERkZGXSl8KD86W1x1MjYxRFx1MjcwQS1cdTI3MERdfFx1RDgzQ1tcdURGODVcdURGQzJcdURGQzddfFx1RDgzRFtcdURDNDJcdURDNDNcdURDNDYtXHVEQzUwXHVEQzY2XHVEQzY3XHVEQzZCLVx1REM2RFx1REM3MFx1REM3Mlx1REM3NC1cdURDNzZcdURDNzhcdURDN0NcdURDODNcdURDODVcdURDQUFcdURENzRcdUREN0FcdUREOTBcdUREOTVcdUREOTZcdURFNENcdURFNEZcdURFQzBcdURFQ0NdfFx1RDgzRVtcdUREMEZcdUREMTgtXHVERDFDXHVERDFFXHVERDFGXHVERDMwLVx1REQzNlx1RERCNVx1RERCNlx1RERCQlx1REREMi1cdURERDVdKSg/Olx1RDgzQ1tcdURGRkItXHVERkZGXSl8KD86W1x1MjMxQVx1MjMxQlx1MjNFOS1cdTIzRUNcdTIzRjBcdTIzRjNcdTI1RkRcdTI1RkVcdTI2MTRcdTI2MTVcdTI2NDgtXHUyNjUzXHUyNjdGXHUyNjkzXHUyNkExXHUyNkFBXHUyNkFCXHUyNkJEXHUyNkJFXHUyNkM0XHUyNkM1XHUyNkNFXHUyNkQ0XHUyNkVBXHUyNkYyXHUyNkYzXHUyNkY1XHUyNkZBXHUyNkZEXHUyNzA1XHUyNzBBXHUyNzBCXHUyNzI4XHUyNzRDXHUyNzRFXHUyNzUzLVx1Mjc1NVx1Mjc1N1x1Mjc5NS1cdTI3OTdcdTI3QjBcdTI3QkZcdTJCMUJcdTJCMUNcdTJCNTBcdTJCNTVdfFx1RDgzQ1tcdURDMDRcdURDQ0ZcdUREOEVcdUREOTEtXHVERDlBXHVEREU2LVx1RERGRlx1REUwMVx1REUxQVx1REUyRlx1REUzMi1cdURFMzZcdURFMzgtXHVERTNBXHVERTUwXHVERTUxXHVERjAwLVx1REYyMFx1REYyRC1cdURGMzVcdURGMzctXHVERjdDXHVERjdFLVx1REY5M1x1REZBMC1cdURGQ0FcdURGQ0YtXHVERkQzXHVERkUwLVx1REZGMFx1REZGNFx1REZGOC1cdURGRkZdfFx1RDgzRFtcdURDMDAtXHVEQzNFXHVEQzQwXHVEQzQyLVx1RENGQ1x1RENGRi1cdUREM0RcdURENEItXHVERDRFXHVERDUwLVx1REQ2N1x1REQ3QVx1REQ5NVx1REQ5Nlx1RERBNFx1RERGQi1cdURFNEZcdURFODAtXHVERUM1XHVERUNDXHVERUQwLVx1REVEMlx1REVENVx1REVFQlx1REVFQ1x1REVGNC1cdURFRkFcdURGRTAtXHVERkVCXXxcdUQ4M0VbXHVERDBELVx1REQzQVx1REQzQy1cdURENDVcdURENDctXHVERDcxXHVERDczLVx1REQ3Nlx1REQ3QS1cdUREQTJcdUREQTUtXHVEREFBXHVEREFFLVx1RERDQVx1RERDRC1cdURERkZcdURFNzAtXHVERTczXHVERTc4LVx1REU3QVx1REU4MC1cdURFODJcdURFOTAtXHVERTk1XSl8KD86WyNcKjAtOVx4QTlceEFFXHUyMDNDXHUyMDQ5XHUyMTIyXHUyMTM5XHUyMTk0LVx1MjE5OVx1MjFBOVx1MjFBQVx1MjMxQVx1MjMxQlx1MjMyOFx1MjNDRlx1MjNFOS1cdTIzRjNcdTIzRjgtXHUyM0ZBXHUyNEMyXHUyNUFBXHUyNUFCXHUyNUI2XHUyNUMwXHUyNUZCLVx1MjVGRVx1MjYwMC1cdTI2MDRcdTI2MEVcdTI2MTFcdTI2MTRcdTI2MTVcdTI2MThcdTI2MURcdTI2MjBcdTI2MjJcdTI2MjNcdTI2MjZcdTI2MkFcdTI2MkVcdTI2MkZcdTI2MzgtXHUyNjNBXHUyNjQwXHUyNjQyXHUyNjQ4LVx1MjY1M1x1MjY1Rlx1MjY2MFx1MjY2M1x1MjY2NVx1MjY2Nlx1MjY2OFx1MjY3Qlx1MjY3RVx1MjY3Rlx1MjY5Mi1cdTI2OTdcdTI2OTlcdTI2OUJcdTI2OUNcdTI2QTBcdTI2QTFcdTI2QUFcdTI2QUJcdTI2QjBcdTI2QjFcdTI2QkRcdTI2QkVcdTI2QzRcdTI2QzVcdTI2QzhcdTI2Q0VcdTI2Q0ZcdTI2RDFcdTI2RDNcdTI2RDRcdTI2RTlcdTI2RUFcdTI2RjAtXHUyNkY1XHUyNkY3LVx1MjZGQVx1MjZGRFx1MjcwMlx1MjcwNVx1MjcwOC1cdTI3MERcdTI3MEZcdTI3MTJcdTI3MTRcdTI3MTZcdTI3MURcdTI3MjFcdTI3MjhcdTI3MzNcdTI3MzRcdTI3NDRcdTI3NDdcdTI3NENcdTI3NEVcdTI3NTMtXHUyNzU1XHUyNzU3XHUyNzYzXHUyNzY0XHUyNzk1LVx1Mjc5N1x1MjdBMVx1MjdCMFx1MjdCRlx1MjkzNFx1MjkzNVx1MkIwNS1cdTJCMDdcdTJCMUJcdTJCMUNcdTJCNTBcdTJCNTVcdTMwMzBcdTMwM0RcdTMyOTdcdTMyOTldfFx1RDgzQ1tcdURDMDRcdURDQ0ZcdURENzBcdURENzFcdUREN0VcdUREN0ZcdUREOEVcdUREOTEtXHVERDlBXHVEREU2LVx1RERGRlx1REUwMVx1REUwMlx1REUxQVx1REUyRlx1REUzMi1cdURFM0FcdURFNTBcdURFNTFcdURGMDAtXHVERjIxXHVERjI0LVx1REY5M1x1REY5Nlx1REY5N1x1REY5OS1cdURGOUJcdURGOUUtXHVERkYwXHVERkYzLVx1REZGNVx1REZGNy1cdURGRkZdfFx1RDgzRFtcdURDMDAtXHVEQ0ZEXHVEQ0ZGLVx1REQzRFx1REQ0OS1cdURENEVcdURENTAtXHVERDY3XHVERDZGXHVERDcwXHVERDczLVx1REQ3QVx1REQ4N1x1REQ4QS1cdUREOERcdUREOTBcdUREOTVcdUREOTZcdUREQTRcdUREQTVcdUREQThcdUREQjFcdUREQjJcdUREQkNcdUREQzItXHVEREM0XHVEREQxLVx1REREM1x1REREQy1cdUREREVcdURERTFcdURERTNcdURERThcdURERUZcdURERjNcdURERkEtXHVERTRGXHVERTgwLVx1REVDNVx1REVDQi1cdURFRDJcdURFRDVcdURFRTAtXHVERUU1XHVERUU5XHVERUVCXHVERUVDXHVERUYwXHVERUYzLVx1REVGQVx1REZFMC1cdURGRUJdfFx1RDgzRVtcdUREMEQtXHVERDNBXHVERDNDLVx1REQ0NVx1REQ0Ny1cdURENzFcdURENzMtXHVERDc2XHVERDdBLVx1RERBMlx1RERBNS1cdUREQUFcdUREQUUtXHVERENBXHVERENELVx1RERGRlx1REU3MC1cdURFNzNcdURFNzgtXHVERTdBXHVERTgwLVx1REU4Mlx1REU5MC1cdURFOTVdKVx1RkUwRnwoPzpbXHUyNjFEXHUyNkY5XHUyNzBBLVx1MjcwRF18XHVEODNDW1x1REY4NVx1REZDMi1cdURGQzRcdURGQzdcdURGQ0EtXHVERkNDXXxcdUQ4M0RbXHVEQzQyXHVEQzQzXHVEQzQ2LVx1REM1MFx1REM2Ni1cdURDNzhcdURDN0NcdURDODEtXHVEQzgzXHVEQzg1LVx1REM4N1x1REM4Rlx1REM5MVx1RENBQVx1REQ3NFx1REQ3NVx1REQ3QVx1REQ5MFx1REQ5NVx1REQ5Nlx1REU0NS1cdURFNDdcdURFNEItXHVERTRGXHVERUEzXHVERUI0LVx1REVCNlx1REVDMFx1REVDQ118XHVEODNFW1x1REQwRlx1REQxOC1cdUREMUZcdUREMjZcdUREMzAtXHVERDM5XHVERDNDLVx1REQzRVx1RERCNVx1RERCNlx1RERCOFx1RERCOVx1RERCQlx1RERDRC1cdUREQ0ZcdURERDEtXHVEREREXSkvZzsKICAgICAgICB9LCBzdSA9IChlMikgPT4gewogICAgICAgICAgaWYgKHR5cGVvZiBlMiAhPSAic3RyaW5nIiB8fCBlMi5sZW5ndGggPT09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgaWYgKChlMiA9IG91KGUyKSkubGVuZ3RoID09PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIGUyID0gZTIucmVwbGFjZSh1dSgpLCAiICAiKTsKICAgICAgICAgIGxldCB0MiA9IDA7CiAgICAgICAgICBmb3IgKGxldCBuMiA9IDA7IG4yIDwgZTIubGVuZ3RoOyBuMisrKSB7CiAgICAgICAgICAgIGNvbnN0IHIyID0gZTIuY29kZVBvaW50QXQobjIpOwogICAgICAgICAgICByMiA8PSAzMSB8fCByMiA+PSAxMjcgJiYgcjIgPD0gMTU5IHx8IChyMiA+PSA3NjggJiYgcjIgPD0gODc5IHx8IChyMiA+IDY1NTM1ICYmIG4yKyssIHQyICs9IGl1KHIyKSA/IDIgOiAxKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfTsKICAgICAgICBldS5leHBvcnRzID0gc3UsIGV1LmV4cG9ydHMuZGVmYXVsdCA9IHN1OwogICAgICAgIHZhciBhdSA9IChlMikgPT4gZTJbZTIubGVuZ3RoIC0gMV07CiAgICAgICAgZnVuY3Rpb24gY3UoZTIsIHQyKSB7CiAgICAgICAgICBpZiAoZTIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHt9OwogICAgICAgICAgdmFyIG4yLCByMiwgbzIgPSBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgaWYgKGUzID09IG51bGwpCiAgICAgICAgICAgICAgcmV0dXJuIHt9OwogICAgICAgICAgICB2YXIgbjMsIHIzLCBvMyA9IHt9LCBpMyA9IE9iamVjdC5rZXlzKGUzKTsKICAgICAgICAgICAgZm9yIChyMyA9IDA7IHIzIDwgaTMubGVuZ3RoOyByMysrKQogICAgICAgICAgICAgIG4zID0gaTNbcjNdLCB0My5pbmRleE9mKG4zKSA+PSAwIHx8IChvM1tuM10gPSBlM1tuM10pOwogICAgICAgICAgICByZXR1cm4gbzM7CiAgICAgICAgICB9KGUyLCB0Mik7CiAgICAgICAgICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgICAgICAgICB2YXIgaTIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUyKTsKICAgICAgICAgICAgZm9yIChyMiA9IDA7IHIyIDwgaTIubGVuZ3RoOyByMisrKQogICAgICAgICAgICAgIG4yID0gaTJbcjJdLCB0Mi5pbmRleE9mKG4yKSA+PSAwIHx8IE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlMiwgbjIpICYmIChvMltuMl0gPSBlMltuMl0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG8yOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBsdShlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB0MiB8fCAodDIgPSBlMi5zbGljZSgwKSksIE9iamVjdC5mcmVlemUoT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZTIsIHsgcmF3OiB7IHZhbHVlOiBPYmplY3QuZnJlZXplKHQyKSB9IH0pKTsKICAgICAgICB9CiAgICAgICAgdmFyIHB1ID0gSCwgZnUgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gcHUoZTIpID09ICJBcnJheSI7CiAgICAgICAgfSwgZHUgPSBqZSwgaHUgPSBxKHEuYmluZCksIGd1ID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gZHUoZTIpLCB0MiA9PT0gdm9pZCAwID8gZTIgOiBodSA/IGh1KGUyLCB0MikgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGUyLmFwcGx5KHQyLCBhcmd1bWVudHMpOwogICAgICAgICAgfTsKICAgICAgICB9LCBtdSA9IGZ1LCB5dSA9IGdyLCBEdSA9IGd1LCBFdSA9IFMuVHlwZUVycm9yLCBDdSA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIsIHIyLCBvMiwgaTIsIHUyLCBzMikgewogICAgICAgICAgZm9yICh2YXIgYTIsIGMyLCBsMiA9IG8yLCBwMiA9IDAsIGYyID0gISF1MiAmJiBEdSh1MiwgczIpOyBwMiA8IHIyOyApIHsKICAgICAgICAgICAgaWYgKHAyIGluIG4yKSB7CiAgICAgICAgICAgICAgaWYgKGEyID0gZjIgPyBmMihuMltwMl0sIHAyLCB0MikgOiBuMltwMl0sIGkyID4gMCAmJiBtdShhMikpCiAgICAgICAgICAgICAgICBjMiA9IHl1KGEyKSwgbDIgPSBDdShlMiwgdDIsIGEyLCBjMiwgbDIsIGkyIC0gMSkgLSAxOwogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGwyID49IDkwMDcxOTkyNTQ3NDA5OTEpCiAgICAgICAgICAgICAgICAgIHRocm93IEV1KCJFeGNlZWQgdGhlIGFjY2VwdGFibGUgYXJyYXkgbGVuZ3RoIik7CiAgICAgICAgICAgICAgICBlMltsMl0gPSBhMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbDIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBwMisrOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGwyOwogICAgICAgIH0sIGJ1ID0gQ3UsIHZ1ID0gcSwgQXUgPSBULCBGdSA9IGllLCB4dSA9IGZvLCBTdSA9IGhuLCB3dSA9IGZ1bmN0aW9uKCkgewogICAgICAgIH0sIFR1ID0gW10sIEJ1ID0gcGUoIlJlZmxlY3QiLCAiY29uc3RydWN0IiksIE51ID0gL15ccyooPzpjbGFzc3xmdW5jdGlvbilcYi8sIGt1ID0gdnUoTnUuZXhlYyksIFB1ID0gIU51LmV4ZWMod3UpLCBPdSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBpZiAoIUZ1KGUyKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIEJ1KHd1LCBUdSwgZTIpLCB0cnVlOwogICAgICAgICAgfSBjYXRjaCAoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0sIEl1ID0gIUJ1IHx8IEF1KGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGUyOwogICAgICAgICAgcmV0dXJuIE91KE91LmNhbGwpIHx8ICFPdShPYmplY3QpIHx8ICFPdShmdW5jdGlvbigpIHsKICAgICAgICAgICAgZTIgPSB0cnVlOwogICAgICAgICAgfSkgfHwgZTI7CiAgICAgICAgfSkgPyBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKCFGdShlMikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIHN3aXRjaCAoeHUoZTIpKSB7CiAgICAgICAgICAgIGNhc2UgIkFzeW5jRnVuY3Rpb24iOgogICAgICAgICAgICBjYXNlICJHZW5lcmF0b3JGdW5jdGlvbiI6CiAgICAgICAgICAgIGNhc2UgIkFzeW5jR2VuZXJhdG9yRnVuY3Rpb24iOgogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBQdSB8fCAhIWt1KE51LCBTdShlMikpOwogICAgICAgIH0gOiBPdSwgTHUgPSBTLCBqdSA9IGZ1LCBfdSA9IEl1LCBNdSA9IHNlLCBSdSA9IER0KCJzcGVjaWVzIiksIFZ1ID0gTHUuQXJyYXksICR1ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MjsKICAgICAgICAgIHJldHVybiBqdShlMikgJiYgKHQyID0gZTIuY29uc3RydWN0b3IsIChfdSh0MikgJiYgKHQyID09PSBWdSB8fCBqdSh0Mi5wcm90b3R5cGUpKSB8fCBNdSh0MikgJiYgKHQyID0gdDJbUnVdKSA9PT0gbnVsbCkgJiYgKHQyID0gdm9pZCAwKSksIHQyID09PSB2b2lkIDAgPyBWdSA6IHQyOwogICAgICAgIH0sIFd1ID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gbmV3ICgkdShlMikpKHQyID09PSAwID8gMCA6IHQyKTsKICAgICAgICB9LCBxdSA9IGJ1LCBVdSA9IGplLCB6dSA9IFplLCBHdSA9IGdyLCBIdSA9IFd1OwogICAgICAgIHJvKHsgdGFyZ2V0OiAiQXJyYXkiLCBwcm90bzogdHJ1ZSB9LCB7IGZsYXRNYXA6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIsIG4yID0genUodGhpcyksIHIyID0gR3UobjIpOwogICAgICAgICAgcmV0dXJuIFV1KGUyKSwgKHQyID0gSHUobjIsIDApKS5sZW5ndGggPSBxdSh0MiwgbjIsIG4yLCByMiwgMCwgMSwgZTIsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdm9pZCAwKSwgdDI7CiAgICAgICAgfSB9KTsKICAgICAgICB2YXIgSnUgPSB7fSwgWHUgPSBKdSwgWXUgPSBEdCgiaXRlcmF0b3IiKSwgS3UgPSBBcnJheS5wcm90b3R5cGUsIFF1ID0gZm8sIFp1ID0gTWUsIGVzID0gSnUsIHRzID0gRHQoIml0ZXJhdG9yIiksIG5zID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGlmIChlMiAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gWnUoZTIsIHRzKSB8fCBadShlMiwgIkBAaXRlcmF0b3IiKSB8fCBlc1tRdShlMildOwogICAgICAgIH0sIHJzID0gaywgb3MgPSBqZSwgaXMgPSBZdCwgdXMgPSBQZSwgc3MgPSBucywgYXMgPSBTLlR5cGVFcnJvciwgY3MgPSBrLCBscyA9IFl0LCBwcyA9IE1lLCBmcyA9IGd1LCBkcyA9IGssIGhzID0gWXQsIGdzID0gUGUsIG1zID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMiAhPT0gdm9pZCAwICYmIChYdS5BcnJheSA9PT0gZTIgfHwgS3VbWXVdID09PSBlMik7CiAgICAgICAgfSwgeXMgPSBnciwgRHMgPSBmZSwgRXMgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHZhciBuMiA9IGFyZ3VtZW50cy5sZW5ndGggPCAyID8gc3MoZTIpIDogdDI7CiAgICAgICAgICBpZiAob3MobjIpKQogICAgICAgICAgICByZXR1cm4gaXMocnMobjIsIGUyKSk7CiAgICAgICAgICB0aHJvdyBhcyh1cyhlMikgKyAiIGlzIG5vdCBpdGVyYWJsZSIpOwogICAgICAgIH0sIENzID0gbnMsIGJzID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgdmFyIHIyLCBvMjsKICAgICAgICAgIGxzKGUyKTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghKHIyID0gcHMoZTIsICJyZXR1cm4iKSkpIHsKICAgICAgICAgICAgICBpZiAodDIgPT09ICJ0aHJvdyIpCiAgICAgICAgICAgICAgICB0aHJvdyBuMjsKICAgICAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcjIgPSBjcyhyMiwgZTIpOwogICAgICAgICAgfSBjYXRjaCAoZTMpIHsKICAgICAgICAgICAgbzIgPSB0cnVlLCByMiA9IGUzOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHQyID09PSAidGhyb3ciKQogICAgICAgICAgICB0aHJvdyBuMjsKICAgICAgICAgIGlmIChvMikKICAgICAgICAgICAgdGhyb3cgcjI7CiAgICAgICAgICByZXR1cm4gbHMocjIpLCBuMjsKICAgICAgICB9LCB2cyA9IFMuVHlwZUVycm9yLCBBcyA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgdGhpcy5zdG9wcGVkID0gZTIsIHRoaXMucmVzdWx0ID0gdDI7CiAgICAgICAgfSwgRnMgPSBBcy5wcm90b3R5cGUsIHhzID0gQnQsIFNzID0genQsIHdzID0gTSwgVHMgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICB2YXIgcjIsIG8yLCBpMiwgdTIsIHMyLCBhMiwgYzIsIGwyID0gbjIgJiYgbjIudGhhdCwgcDIgPSAhKCFuMiB8fCAhbjIuQVNfRU5UUklFUyksIGYyID0gISghbjIgfHwgIW4yLklTX0lURVJBVE9SKSwgZDIgPSAhKCFuMiB8fCAhbjIuSU5URVJSVVBURUQpLCBoMiA9IGZzKHQyLCBsMiksIGcyID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIHIyICYmIGJzKHIyLCAibm9ybWFsIiwgZTMpLCBuZXcgQXModHJ1ZSwgZTMpOwogICAgICAgICAgfSwgbTIgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gcDIgPyAoaHMoZTMpLCBkMiA/IGgyKGUzWzBdLCBlM1sxXSwgZzIpIDogaDIoZTNbMF0sIGUzWzFdKSkgOiBkMiA/IGgyKGUzLCBnMikgOiBoMihlMyk7CiAgICAgICAgICB9OwogICAgICAgICAgaWYgKGYyKQogICAgICAgICAgICByMiA9IGUyOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmICghKG8yID0gQ3MoZTIpKSkKICAgICAgICAgICAgICB0aHJvdyB2cyhncyhlMikgKyAiIGlzIG5vdCBpdGVyYWJsZSIpOwogICAgICAgICAgICBpZiAobXMobzIpKSB7CiAgICAgICAgICAgICAgZm9yIChpMiA9IDAsIHUyID0geXMoZTIpOyB1MiA+IGkyOyBpMisrKQogICAgICAgICAgICAgICAgaWYgKChzMiA9IG0yKGUyW2kyXSkpICYmIERzKEZzLCBzMikpCiAgICAgICAgICAgICAgICAgIHJldHVybiBzMjsKICAgICAgICAgICAgICByZXR1cm4gbmV3IEFzKGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByMiA9IEVzKGUyLCBvMik7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGEyID0gcjIubmV4dDsgIShjMiA9IGRzKGEyLCByMikpLmRvbmU7ICkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHMyID0gbTIoYzIudmFsdWUpOwogICAgICAgICAgICB9IGNhdGNoIChlMykgewogICAgICAgICAgICAgIGJzKHIyLCAidGhyb3ciLCBlMyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiBzMiA9PSAib2JqZWN0IiAmJiBzMiAmJiBEcyhGcywgczIpKQogICAgICAgICAgICAgIHJldHVybiBzMjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuZXcgQXMoZmFsc2UpOwogICAgICAgIH0sIEJzID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgdmFyIHIyID0geHModDIpOwogICAgICAgICAgcjIgaW4gZTIgPyBTcy5mKGUyLCByMiwgd3MoMCwgbjIpKSA6IGUyW3IyXSA9IG4yOwogICAgICAgIH07CiAgICAgICAgcm8oeyB0YXJnZXQ6ICJPYmplY3QiLCBzdGF0OiB0cnVlIH0sIHsgZnJvbUVudHJpZXM6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSB7fTsKICAgICAgICAgIHJldHVybiBUcyhlMiwgZnVuY3Rpb24oZTMsIG4yKSB7CiAgICAgICAgICAgIEJzKHQyLCBlMywgbjIpOwogICAgICAgICAgfSwgeyBBU19FTlRSSUVTOiB0cnVlIH0pLCB0MjsKICAgICAgICB9IH0pOwogICAgICAgIHZhciBOcyA9IE5zICE9PSB2b2lkIDAgPyBOcyA6IHR5cGVvZiBzZWxmICE9ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB7fTsKICAgICAgICBmdW5jdGlvbiBrcygpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigic2V0VGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBQcygpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiY2xlYXJUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkIik7CiAgICAgICAgfQogICAgICAgIHZhciBPcyA9IGtzLCBJcyA9IFBzOwogICAgICAgIGZ1bmN0aW9uIExzKGUyKSB7CiAgICAgICAgICBpZiAoT3MgPT09IHNldFRpbWVvdXQpCiAgICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGUyLCAwKTsKICAgICAgICAgIGlmICgoT3MgPT09IGtzIHx8ICFPcykgJiYgc2V0VGltZW91dCkKICAgICAgICAgICAgcmV0dXJuIE9zID0gc2V0VGltZW91dCwgc2V0VGltZW91dChlMiwgMCk7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gT3MoZTIsIDApOwogICAgICAgICAgfSBjYXRjaCAodDIpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICByZXR1cm4gT3MuY2FsbChudWxsLCBlMiwgMCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKHQzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIE9zLmNhbGwodGhpcywgZTIsIDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHR5cGVvZiBOcy5zZXRUaW1lb3V0ID09ICJmdW5jdGlvbiIgJiYgKE9zID0gc2V0VGltZW91dCksIHR5cGVvZiBOcy5jbGVhclRpbWVvdXQgPT0gImZ1bmN0aW9uIiAmJiAoSXMgPSBjbGVhclRpbWVvdXQpOwogICAgICAgIHZhciBqcywgX3MgPSBbXSwgTXMgPSBmYWxzZSwgUnMgPSAtMTsKICAgICAgICBmdW5jdGlvbiBWcygpIHsKICAgICAgICAgIE1zICYmIGpzICYmIChNcyA9IGZhbHNlLCBqcy5sZW5ndGggPyBfcyA9IGpzLmNvbmNhdChfcykgOiBScyA9IC0xLCBfcy5sZW5ndGggJiYgJHMoKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uICRzKCkgewogICAgICAgICAgaWYgKCFNcykgewogICAgICAgICAgICB2YXIgZTIgPSBMcyhWcyk7CiAgICAgICAgICAgIE1zID0gdHJ1ZTsKICAgICAgICAgICAgZm9yICh2YXIgdDIgPSBfcy5sZW5ndGg7IHQyOyApIHsKICAgICAgICAgICAgICBmb3IgKGpzID0gX3MsIF9zID0gW107ICsrUnMgPCB0MjsgKQogICAgICAgICAgICAgICAganMgJiYganNbUnNdLnJ1bigpOwogICAgICAgICAgICAgIFJzID0gLTEsIHQyID0gX3MubGVuZ3RoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGpzID0gbnVsbCwgTXMgPSBmYWxzZSwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgICBpZiAoSXMgPT09IGNsZWFyVGltZW91dCkKICAgICAgICAgICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQoZTMpOwogICAgICAgICAgICAgIGlmICgoSXMgPT09IFBzIHx8ICFJcykgJiYgY2xlYXJUaW1lb3V0KQogICAgICAgICAgICAgICAgcmV0dXJuIElzID0gY2xlYXJUaW1lb3V0LCBjbGVhclRpbWVvdXQoZTMpOwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBJcyhlMyk7CiAgICAgICAgICAgICAgfSBjYXRjaCAodDMpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBJcy5jYWxsKG51bGwsIGUzKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHQ0KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBJcy5jYWxsKHRoaXMsIGUzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0oZTIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBXcyhlMiwgdDIpIHsKICAgICAgICAgIHRoaXMuZnVuID0gZTIsIHRoaXMuYXJyYXkgPSB0MjsKICAgICAgICB9CiAgICAgICAgV3MucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhpcy5mdW4uYXBwbHkobnVsbCwgdGhpcy5hcnJheSk7CiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBxcygpIHsKICAgICAgICB9CiAgICAgICAgdmFyIFVzID0gcXMsIHpzID0gcXMsIEdzID0gcXMsIEhzID0gcXMsIEpzID0gcXMsIFhzID0gcXMsIFlzID0gcXM7CiAgICAgICAgdmFyIEtzID0gTnMucGVyZm9ybWFuY2UgfHwge30sIFFzID0gS3Mubm93IHx8IEtzLm1vek5vdyB8fCBLcy5tc05vdyB8fCBLcy5vTm93IHx8IEtzLndlYmtpdE5vdyB8fCBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICB9OwogICAgICAgIHZhciBacyA9IG5ldyBEYXRlKCk7CiAgICAgICAgdmFyIGVhID0geyBuZXh0VGljazogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7CiAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIGZvciAodmFyIG4yID0gMTsgbjIgPCBhcmd1bWVudHMubGVuZ3RoOyBuMisrKQogICAgICAgICAgICAgIHQyW24yIC0gMV0gPSBhcmd1bWVudHNbbjJdOwogICAgICAgICAgX3MucHVzaChuZXcgV3MoZTIsIHQyKSksIF9zLmxlbmd0aCAhPT0gMSB8fCBNcyB8fCBMcygkcyk7CiAgICAgICAgfSwgdGl0bGU6ICJicm93c2VyIiwgYnJvd3NlcjogdHJ1ZSwgZW52OiB7fSwgYXJndjogW10sIHZlcnNpb246ICIiLCB2ZXJzaW9uczoge30sIG9uOiBVcywgYWRkTGlzdGVuZXI6IHpzLCBvbmNlOiBHcywgb2ZmOiBIcywgcmVtb3ZlTGlzdGVuZXI6IEpzLCByZW1vdmVBbGxMaXN0ZW5lcnM6IFhzLCBlbWl0OiBZcywgYmluZGluZzogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICB9LCBjd2Q6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuICIvIjsKICAgICAgICB9LCBjaGRpcjogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkIik7CiAgICAgICAgfSwgdW1hc2s6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSwgaHJ0aW1lOiBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gMWUtMyAqIFFzLmNhbGwoS3MpLCBuMiA9IE1hdGguZmxvb3IodDIpLCByMiA9IE1hdGguZmxvb3IodDIgJSAxICogMWU5KTsKICAgICAgICAgIHJldHVybiBlMiAmJiAobjIgLT0gZTJbMF0sIChyMiAtPSBlMlsxXSkgPCAwICYmIChuMi0tLCByMiArPSAxZTkpKSwgW24yLCByMl07CiAgICAgICAgfSwgcGxhdGZvcm06ICJicm93c2VyIiwgcmVsZWFzZToge30sIGNvbmZpZzoge30sIHVwdGltZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gKG5ldyBEYXRlKCkgLSBacykgLyAxZTM7CiAgICAgICAgfSB9LCB0YSA9IGVhOwogICAgICAgIGNvbnN0IG5hID0gdHlwZW9mIHRhID09ICJvYmplY3QiICYmIHRhLmVudiAmJiB0YS5lbnYuTk9ERV9ERUJVRyAmJiAvXGJzZW12ZXJcYi9pLnRlc3QodGEuZW52Lk5PREVfREVCVUcpID8gZnVuY3Rpb24oKSB7CiAgICAgICAgICBmb3IgKHZhciBlMiA9IGFyZ3VtZW50cy5sZW5ndGgsIHQyID0gbmV3IEFycmF5KGUyKSwgbjIgPSAwOyBuMiA8IGUyOyBuMisrKQogICAgICAgICAgICB0MltuMl0gPSBhcmd1bWVudHNbbjJdOwogICAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoIlNFTVZFUiIsIC4uLnQyKTsKICAgICAgICB9IDogKCkgPT4gewogICAgICAgIH07CiAgICAgICAgdmFyIHJhID0gbmE7CiAgICAgICAgdmFyIG9hID0geyBTRU1WRVJfU1BFQ19WRVJTSU9OOiAiMi4wLjAiLCBNQVhfTEVOR1RIOiAyNTYsIE1BWF9TQUZFX0lOVEVHRVI6IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSIHx8IDkwMDcxOTkyNTQ3NDA5OTEsIE1BWF9TQUZFX0NPTVBPTkVOVF9MRU5HVEg6IDE2IH0sIGlhID0geyBleHBvcnRzOiB7fSB9OwogICAgICAgICFmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IHsgTUFYX1NBRkVfQ09NUE9ORU5UX0xFTkdUSDogbjIgfSA9IG9hLCByMiA9IHJhLCBvMiA9ICh0MiA9IGUyLmV4cG9ydHMgPSB7fSkucmUgPSBbXSwgaTIgPSB0Mi5zcmMgPSBbXSwgdTIgPSB0Mi50ID0ge307CiAgICAgICAgICBsZXQgczIgPSAwOwogICAgICAgICAgY29uc3QgYTIgPSAoZTMsIHQzLCBuMykgPT4gewogICAgICAgICAgICBjb25zdCBhMyA9IHMyKys7CiAgICAgICAgICAgIHIyKGEzLCB0MyksIHUyW2UzXSA9IGEzLCBpMlthM10gPSB0MywgbzJbYTNdID0gbmV3IFJlZ0V4cCh0MywgbjMgPyAiZyIgOiB2b2lkIDApOwogICAgICAgICAgfTsKICAgICAgICAgIGEyKCJOVU1FUklDSURFTlRJRklFUiIsICIwfFsxLTldXFxkKiIpLCBhMigiTlVNRVJJQ0lERU5USUZJRVJMT09TRSIsICJbMC05XSsiKSwgYTIoIk5PTk5VTUVSSUNJREVOVElGSUVSIiwgIlxcZCpbYS16QS1aLV1bYS16QS1aMC05LV0qIiksIGEyKCJNQUlOVkVSU0lPTiIsICIoIi5jb25jYXQoaTJbdTIuTlVNRVJJQ0lERU5USUZJRVJdLCAiKVxcLiIpICsgIigiLmNvbmNhdChpMlt1Mi5OVU1FUklDSURFTlRJRklFUl0sICIpXFwuIikgKyAiKCIuY29uY2F0KGkyW3UyLk5VTUVSSUNJREVOVElGSUVSXSwgIikiKSksIGEyKCJNQUlOVkVSU0lPTkxPT1NFIiwgIigiLmNvbmNhdChpMlt1Mi5OVU1FUklDSURFTlRJRklFUkxPT1NFXSwgIilcXC4iKSArICIoIi5jb25jYXQoaTJbdTIuTlVNRVJJQ0lERU5USUZJRVJMT09TRV0sICIpXFwuIikgKyAiKCIuY29uY2F0KGkyW3UyLk5VTUVSSUNJREVOVElGSUVSTE9PU0VdLCAiKSIpKSwgYTIoIlBSRVJFTEVBU0VJREVOVElGSUVSIiwgIig/OiIuY29uY2F0KGkyW3UyLk5VTUVSSUNJREVOVElGSUVSXSwgInwiKS5jb25jYXQoaTJbdTIuTk9OTlVNRVJJQ0lERU5USUZJRVJdLCAiKSIpKSwgYTIoIlBSRVJFTEVBU0VJREVOVElGSUVSTE9PU0UiLCAiKD86Ii5jb25jYXQoaTJbdTIuTlVNRVJJQ0lERU5USUZJRVJMT09TRV0sICJ8IikuY29uY2F0KGkyW3UyLk5PTk5VTUVSSUNJREVOVElGSUVSXSwgIikiKSksIGEyKCJQUkVSRUxFQVNFIiwgIig/Oi0oIi5jb25jYXQoaTJbdTIuUFJFUkVMRUFTRUlERU5USUZJRVJdLCAiKD86XFwuIikuY29uY2F0KGkyW3UyLlBSRVJFTEVBU0VJREVOVElGSUVSXSwgIikqKSkiKSksIGEyKCJQUkVSRUxFQVNFTE9PU0UiLCAiKD86LT8oIi5jb25jYXQoaTJbdTIuUFJFUkVMRUFTRUlERU5USUZJRVJMT09TRV0sICIoPzpcXC4iKS5jb25jYXQoaTJbdTIuUFJFUkVMRUFTRUlERU5USUZJRVJMT09TRV0sICIpKikpIikpLCBhMigiQlVJTERJREVOVElGSUVSIiwgIlswLTlBLVphLXotXSsiKSwgYTIoIkJVSUxEIiwgIig/OlxcKygiLmNvbmNhdChpMlt1Mi5CVUlMRElERU5USUZJRVJdLCAiKD86XFwuIikuY29uY2F0KGkyW3UyLkJVSUxESURFTlRJRklFUl0sICIpKikpIikpLCBhMigiRlVMTFBMQUlOIiwgInY/Ii5jb25jYXQoaTJbdTIuTUFJTlZFUlNJT05dKS5jb25jYXQoaTJbdTIuUFJFUkVMRUFTRV0sICI/IikuY29uY2F0KGkyW3UyLkJVSUxEXSwgIj8iKSksIGEyKCJGVUxMIiwgIl4iLmNvbmNhdChpMlt1Mi5GVUxMUExBSU5dLCAiJCIpKSwgYTIoIkxPT1NFUExBSU4iLCAiW3Y9XFxzXSoiLmNvbmNhdChpMlt1Mi5NQUlOVkVSU0lPTkxPT1NFXSkuY29uY2F0KGkyW3UyLlBSRVJFTEVBU0VMT09TRV0sICI/IikuY29uY2F0KGkyW3UyLkJVSUxEXSwgIj8iKSksIGEyKCJMT09TRSIsICJeIi5jb25jYXQoaTJbdTIuTE9PU0VQTEFJTl0sICIkIikpLCBhMigiR1RMVCIsICIoKD86PHw+KT89PykiKSwgYTIoIlhSQU5HRUlERU5USUZJRVJMT09TRSIsICIiLmNvbmNhdChpMlt1Mi5OVU1FUklDSURFTlRJRklFUkxPT1NFXSwgInx4fFh8XFwqIikpLCBhMigiWFJBTkdFSURFTlRJRklFUiIsICIiLmNvbmNhdChpMlt1Mi5OVU1FUklDSURFTlRJRklFUl0sICJ8eHxYfFxcKiIpKSwgYTIoIlhSQU5HRVBMQUlOIiwgIlt2PVxcc10qKCIuY29uY2F0KGkyW3UyLlhSQU5HRUlERU5USUZJRVJdLCAiKSIpICsgIig/OlxcLigiLmNvbmNhdChpMlt1Mi5YUkFOR0VJREVOVElGSUVSXSwgIikiKSArICIoPzpcXC4oIi5jb25jYXQoaTJbdTIuWFJBTkdFSURFTlRJRklFUl0sICIpIikgKyAiKD86Ii5jb25jYXQoaTJbdTIuUFJFUkVMRUFTRV0sICIpPyIpLmNvbmNhdChpMlt1Mi5CVUlMRF0sICI/IikgKyAiKT8pPyIpLCBhMigiWFJBTkdFUExBSU5MT09TRSIsICJbdj1cXHNdKigiLmNvbmNhdChpMlt1Mi5YUkFOR0VJREVOVElGSUVSTE9PU0VdLCAiKSIpICsgIig/OlxcLigiLmNvbmNhdChpMlt1Mi5YUkFOR0VJREVOVElGSUVSTE9PU0VdLCAiKSIpICsgIig/OlxcLigiLmNvbmNhdChpMlt1Mi5YUkFOR0VJREVOVElGSUVSTE9PU0VdLCAiKSIpICsgIig/OiIuY29uY2F0KGkyW3UyLlBSRVJFTEVBU0VMT09TRV0sICIpPyIpLmNvbmNhdChpMlt1Mi5CVUlMRF0sICI/IikgKyAiKT8pPyIpLCBhMigiWFJBTkdFIiwgIl4iLmNvbmNhdChpMlt1Mi5HVExUXSwgIlxccyoiKS5jb25jYXQoaTJbdTIuWFJBTkdFUExBSU5dLCAiJCIpKSwgYTIoIlhSQU5HRUxPT1NFIiwgIl4iLmNvbmNhdChpMlt1Mi5HVExUXSwgIlxccyoiKS5jb25jYXQoaTJbdTIuWFJBTkdFUExBSU5MT09TRV0sICIkIikpLCBhMigiQ09FUkNFIiwgIiIuY29uY2F0KCIoXnxbXlxcZF0pKFxcZHsxLCIpLmNvbmNhdChuMiwgIn0pIikgKyAiKD86XFwuKFxcZHsxLCIuY29uY2F0KG4yLCAifSkpPyIpICsgIig/OlxcLihcXGR7MSwiLmNvbmNhdChuMiwgIn0pKT8iKSArICIoPzokfFteXFxkXSkiKSwgYTIoIkNPRVJDRVJUTCIsIGkyW3UyLkNPRVJDRV0sIHRydWUpLCBhMigiTE9ORVRJTERFIiwgIig/On4+PykiKSwgYTIoIlRJTERFVFJJTSIsICIoXFxzKikiLmNvbmNhdChpMlt1Mi5MT05FVElMREVdLCAiXFxzKyIpLCB0cnVlKSwgdDIudGlsZGVUcmltUmVwbGFjZSA9ICIkMX4iLCBhMigiVElMREUiLCAiXiIuY29uY2F0KGkyW3UyLkxPTkVUSUxERV0pLmNvbmNhdChpMlt1Mi5YUkFOR0VQTEFJTl0sICIkIikpLCBhMigiVElMREVMT09TRSIsICJeIi5jb25jYXQoaTJbdTIuTE9ORVRJTERFXSkuY29uY2F0KGkyW3UyLlhSQU5HRVBMQUlOTE9PU0VdLCAiJCIpKSwgYTIoIkxPTkVDQVJFVCIsICIoPzpcXF4pIiksIGEyKCJDQVJFVFRSSU0iLCAiKFxccyopIi5jb25jYXQoaTJbdTIuTE9ORUNBUkVUXSwgIlxccysiKSwgdHJ1ZSksIHQyLmNhcmV0VHJpbVJlcGxhY2UgPSAiJDFeIiwgYTIoIkNBUkVUIiwgIl4iLmNvbmNhdChpMlt1Mi5MT05FQ0FSRVRdKS5jb25jYXQoaTJbdTIuWFJBTkdFUExBSU5dLCAiJCIpKSwgYTIoIkNBUkVUTE9PU0UiLCAiXiIuY29uY2F0KGkyW3UyLkxPTkVDQVJFVF0pLmNvbmNhdChpMlt1Mi5YUkFOR0VQTEFJTkxPT1NFXSwgIiQiKSksIGEyKCJDT01QQVJBVE9STE9PU0UiLCAiXiIuY29uY2F0KGkyW3UyLkdUTFRdLCAiXFxzKigiKS5jb25jYXQoaTJbdTIuTE9PU0VQTEFJTl0sICIpJHxeJCIpKSwgYTIoIkNPTVBBUkFUT1IiLCAiXiIuY29uY2F0KGkyW3UyLkdUTFRdLCAiXFxzKigiKS5jb25jYXQoaTJbdTIuRlVMTFBMQUlOXSwgIikkfF4kIikpLCBhMigiQ09NUEFSQVRPUlRSSU0iLCAiKFxccyopIi5jb25jYXQoaTJbdTIuR1RMVF0sICJcXHMqKCIpLmNvbmNhdChpMlt1Mi5MT09TRVBMQUlOXSwgInwiKS5jb25jYXQoaTJbdTIuWFJBTkdFUExBSU5dLCAiKSIpLCB0cnVlKSwgdDIuY29tcGFyYXRvclRyaW1SZXBsYWNlID0gIiQxJDIkMyIsIGEyKCJIWVBIRU5SQU5HRSIsICJeXFxzKigiLmNvbmNhdChpMlt1Mi5YUkFOR0VQTEFJTl0sICIpIikgKyAiXFxzKy1cXHMrIiArICIoIi5jb25jYXQoaTJbdTIuWFJBTkdFUExBSU5dLCAiKSIpICsgIlxccyokIiksIGEyKCJIWVBIRU5SQU5HRUxPT1NFIiwgIl5cXHMqKCIuY29uY2F0KGkyW3UyLlhSQU5HRVBMQUlOTE9PU0VdLCAiKSIpICsgIlxccystXFxzKyIgKyAiKCIuY29uY2F0KGkyW3UyLlhSQU5HRVBMQUlOTE9PU0VdLCAiKSIpICsgIlxccyokIiksIGEyKCJTVEFSIiwgIig8fD4pPz0/XFxzKlxcKiIpLCBhMigiR1RFMCIsICJeXFxzKj49XFxzKjAuMC4wXFxzKiQiKSwgYTIoIkdURTBQUkUiLCAiXlxccyo+PVxccyowLjAuMC0wXFxzKiQiKTsKICAgICAgICB9KGlhLCBpYS5leHBvcnRzKTsKICAgICAgICBjb25zdCB1YSA9IFsiaW5jbHVkZVByZXJlbGVhc2UiLCAibG9vc2UiLCAicnRsIl07CiAgICAgICAgdmFyIHNhID0gKGUyKSA9PiBlMiA/IHR5cGVvZiBlMiAhPSAib2JqZWN0IiA/IHsgbG9vc2U6IHRydWUgfSA6IHVhLmZpbHRlcigodDIpID0+IGUyW3QyXSkucmVkdWNlKChlMywgdDIpID0+IChlM1t0Ml0gPSB0cnVlLCBlMyksIHt9KSA6IHt9OwogICAgICAgIGNvbnN0IGFhID0gL15bMC05XSskLywgY2EgPSAoZTIsIHQyKSA9PiB7CiAgICAgICAgICBjb25zdCBuMiA9IGFhLnRlc3QoZTIpLCByMiA9IGFhLnRlc3QodDIpOwogICAgICAgICAgcmV0dXJuIG4yICYmIHIyICYmIChlMiA9ICtlMiwgdDIgPSArdDIpLCBlMiA9PT0gdDIgPyAwIDogbjIgJiYgIXIyID8gLTEgOiByMiAmJiAhbjIgPyAxIDogZTIgPCB0MiA/IC0xIDogMTsKICAgICAgICB9OwogICAgICAgIHZhciBsYSA9IHsgY29tcGFyZUlkZW50aWZpZXJzOiBjYSwgcmNvbXBhcmVJZGVudGlmaWVyczogKGUyLCB0MikgPT4gY2EodDIsIGUyKSB9OwogICAgICAgIGNvbnN0IHBhID0gcmEsIHsgTUFYX0xFTkdUSDogZmEsIE1BWF9TQUZFX0lOVEVHRVI6IGRhIH0gPSBvYSwgeyByZTogaGEsIHQ6IGdhIH0gPSBpYS5leHBvcnRzLCBtYSA9IHNhLCB7IGNvbXBhcmVJZGVudGlmaWVyczogeWEgfSA9IGxhOwogICAgICAgIGNsYXNzIERhIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKGUyLCB0MikgewogICAgICAgICAgICBpZiAodDIgPSBtYSh0MiksIGUyIGluc3RhbmNlb2YgRGEpIHsKICAgICAgICAgICAgICBpZiAoZTIubG9vc2UgPT09ICEhdDIubG9vc2UgJiYgZTIuaW5jbHVkZVByZXJlbGVhc2UgPT09ICEhdDIuaW5jbHVkZVByZXJlbGVhc2UpCiAgICAgICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICAgICAgZTIgPSBlMi52ZXJzaW9uOwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBlMiAhPSAic3RyaW5nIikKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIFZlcnNpb246ICIuY29uY2F0KGUyKSk7CiAgICAgICAgICAgIGlmIChlMi5sZW5ndGggPiBmYSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJ2ZXJzaW9uIGlzIGxvbmdlciB0aGFuICIuY29uY2F0KGZhLCAiIGNoYXJhY3RlcnMiKSk7CiAgICAgICAgICAgIHBhKCJTZW1WZXIiLCBlMiwgdDIpLCB0aGlzLm9wdGlvbnMgPSB0MiwgdGhpcy5sb29zZSA9ICEhdDIubG9vc2UsIHRoaXMuaW5jbHVkZVByZXJlbGVhc2UgPSAhIXQyLmluY2x1ZGVQcmVyZWxlYXNlOwogICAgICAgICAgICBjb25zdCBuMiA9IGUyLnRyaW0oKS5tYXRjaCh0Mi5sb29zZSA/IGhhW2dhLkxPT1NFXSA6IGhhW2dhLkZVTExdKTsKICAgICAgICAgICAgaWYgKCFuMikKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIFZlcnNpb246ICIuY29uY2F0KGUyKSk7CiAgICAgICAgICAgIGlmICh0aGlzLnJhdyA9IGUyLCB0aGlzLm1ham9yID0gK24yWzFdLCB0aGlzLm1pbm9yID0gK24yWzJdLCB0aGlzLnBhdGNoID0gK24yWzNdLCB0aGlzLm1ham9yID4gZGEgfHwgdGhpcy5tYWpvciA8IDApCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBtYWpvciB2ZXJzaW9uIik7CiAgICAgICAgICAgIGlmICh0aGlzLm1pbm9yID4gZGEgfHwgdGhpcy5taW5vciA8IDApCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBtaW5vciB2ZXJzaW9uIik7CiAgICAgICAgICAgIGlmICh0aGlzLnBhdGNoID4gZGEgfHwgdGhpcy5wYXRjaCA8IDApCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBwYXRjaCB2ZXJzaW9uIik7CiAgICAgICAgICAgIG4yWzRdID8gdGhpcy5wcmVyZWxlYXNlID0gbjJbNF0uc3BsaXQoIi4iKS5tYXAoKGUzKSA9PiB7CiAgICAgICAgICAgICAgaWYgKC9eWzAtOV0rJC8udGVzdChlMykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gK2UzOwogICAgICAgICAgICAgICAgaWYgKHQzID49IDAgJiYgdDMgPCBkYSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gZTM7CiAgICAgICAgICAgIH0pIDogdGhpcy5wcmVyZWxlYXNlID0gW10sIHRoaXMuYnVpbGQgPSBuMls1XSA/IG4yWzVdLnNwbGl0KCIuIikgOiBbXSwgdGhpcy5mb3JtYXQoKTsKICAgICAgICAgIH0KICAgICAgICAgIGZvcm1hdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudmVyc2lvbiA9ICIiLmNvbmNhdCh0aGlzLm1ham9yLCAiLiIpLmNvbmNhdCh0aGlzLm1pbm9yLCAiLiIpLmNvbmNhdCh0aGlzLnBhdGNoKSwgdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCAmJiAodGhpcy52ZXJzaW9uICs9ICItIi5jb25jYXQodGhpcy5wcmVyZWxlYXNlLmpvaW4oIi4iKSkpLCB0aGlzLnZlcnNpb247CiAgICAgICAgICB9CiAgICAgICAgICB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudmVyc2lvbjsKICAgICAgICAgIH0KICAgICAgICAgIGNvbXBhcmUoZTIpIHsKICAgICAgICAgICAgaWYgKHBhKCJTZW1WZXIuY29tcGFyZSIsIHRoaXMudmVyc2lvbiwgdGhpcy5vcHRpb25zLCBlMiksICEoZTIgaW5zdGFuY2VvZiBEYSkpIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGUyID09ICJzdHJpbmciICYmIGUyID09PSB0aGlzLnZlcnNpb24pCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICBlMiA9IG5ldyBEYShlMiwgdGhpcy5vcHRpb25zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZTIudmVyc2lvbiA9PT0gdGhpcy52ZXJzaW9uID8gMCA6IHRoaXMuY29tcGFyZU1haW4oZTIpIHx8IHRoaXMuY29tcGFyZVByZShlMik7CiAgICAgICAgICB9CiAgICAgICAgICBjb21wYXJlTWFpbihlMikgewogICAgICAgICAgICByZXR1cm4gZTIgaW5zdGFuY2VvZiBEYSB8fCAoZTIgPSBuZXcgRGEoZTIsIHRoaXMub3B0aW9ucykpLCB5YSh0aGlzLm1ham9yLCBlMi5tYWpvcikgfHwgeWEodGhpcy5taW5vciwgZTIubWlub3IpIHx8IHlhKHRoaXMucGF0Y2gsIGUyLnBhdGNoKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbXBhcmVQcmUoZTIpIHsKICAgICAgICAgICAgaWYgKGUyIGluc3RhbmNlb2YgRGEgfHwgKGUyID0gbmV3IERhKGUyLCB0aGlzLm9wdGlvbnMpKSwgdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCAmJiAhZTIucHJlcmVsZWFzZS5sZW5ndGgpCiAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBpZiAoIXRoaXMucHJlcmVsZWFzZS5sZW5ndGggJiYgZTIucHJlcmVsZWFzZS5sZW5ndGgpCiAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgIGlmICghdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCAmJiAhZTIucHJlcmVsZWFzZS5sZW5ndGgpCiAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIGxldCB0MiA9IDA7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBjb25zdCBuMiA9IHRoaXMucHJlcmVsZWFzZVt0Ml0sIHIyID0gZTIucHJlcmVsZWFzZVt0Ml07CiAgICAgICAgICAgICAgaWYgKHBhKCJwcmVyZWxlYXNlIGNvbXBhcmUiLCB0MiwgbjIsIHIyKSwgbjIgPT09IHZvaWQgMCAmJiByMiA9PT0gdm9pZCAwKQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgaWYgKHIyID09PSB2b2lkIDApCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICBpZiAobjIgPT09IHZvaWQgMCkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgICBpZiAobjIgIT09IHIyKQogICAgICAgICAgICAgICAgcmV0dXJuIHlhKG4yLCByMik7CiAgICAgICAgICAgIH0gd2hpbGUgKCsrdDIpOwogICAgICAgICAgfQogICAgICAgICAgY29tcGFyZUJ1aWxkKGUyKSB7CiAgICAgICAgICAgIGUyIGluc3RhbmNlb2YgRGEgfHwgKGUyID0gbmV3IERhKGUyLCB0aGlzLm9wdGlvbnMpKTsKICAgICAgICAgICAgbGV0IHQyID0gMDsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGNvbnN0IG4yID0gdGhpcy5idWlsZFt0Ml0sIHIyID0gZTIuYnVpbGRbdDJdOwogICAgICAgICAgICAgIGlmIChwYSgicHJlcmVsZWFzZSBjb21wYXJlIiwgdDIsIG4yLCByMiksIG4yID09PSB2b2lkIDAgJiYgcjIgPT09IHZvaWQgMCkKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgIGlmIChyMiA9PT0gdm9pZCAwKQogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgICAgaWYgKG4yID09PSB2b2lkIDApCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgICAgaWYgKG4yICE9PSByMikKICAgICAgICAgICAgICAgIHJldHVybiB5YShuMiwgcjIpOwogICAgICAgICAgICB9IHdoaWxlICgrK3QyKTsKICAgICAgICAgIH0KICAgICAgICAgIGluYyhlMiwgdDIpIHsKICAgICAgICAgICAgc3dpdGNoIChlMikgewogICAgICAgICAgICAgIGNhc2UgInByZW1ham9yIjoKICAgICAgICAgICAgICAgIHRoaXMucHJlcmVsZWFzZS5sZW5ndGggPSAwLCB0aGlzLnBhdGNoID0gMCwgdGhpcy5taW5vciA9IDAsIHRoaXMubWFqb3IrKywgdGhpcy5pbmMoInByZSIsIHQyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInByZW1pbm9yIjoKICAgICAgICAgICAgICAgIHRoaXMucHJlcmVsZWFzZS5sZW5ndGggPSAwLCB0aGlzLnBhdGNoID0gMCwgdGhpcy5taW5vcisrLCB0aGlzLmluYygicHJlIiwgdDIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAicHJlcGF0Y2giOgogICAgICAgICAgICAgICAgdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCA9IDAsIHRoaXMuaW5jKCJwYXRjaCIsIHQyKSwgdGhpcy5pbmMoInByZSIsIHQyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInByZXJlbGVhc2UiOgogICAgICAgICAgICAgICAgdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCA9PT0gMCAmJiB0aGlzLmluYygicGF0Y2giLCB0MiksIHRoaXMuaW5jKCJwcmUiLCB0Mik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJtYWpvciI6CiAgICAgICAgICAgICAgICB0aGlzLm1pbm9yID09PSAwICYmIHRoaXMucGF0Y2ggPT09IDAgJiYgdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCAhPT0gMCB8fCB0aGlzLm1ham9yKyssIHRoaXMubWlub3IgPSAwLCB0aGlzLnBhdGNoID0gMCwgdGhpcy5wcmVyZWxlYXNlID0gW107CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJtaW5vciI6CiAgICAgICAgICAgICAgICB0aGlzLnBhdGNoID09PSAwICYmIHRoaXMucHJlcmVsZWFzZS5sZW5ndGggIT09IDAgfHwgdGhpcy5taW5vcisrLCB0aGlzLnBhdGNoID0gMCwgdGhpcy5wcmVyZWxlYXNlID0gW107CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJwYXRjaCI6CiAgICAgICAgICAgICAgICB0aGlzLnByZXJlbGVhc2UubGVuZ3RoID09PSAwICYmIHRoaXMucGF0Y2grKywgdGhpcy5wcmVyZWxlYXNlID0gW107CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJwcmUiOgogICAgICAgICAgICAgICAgaWYgKHRoaXMucHJlcmVsZWFzZS5sZW5ndGggPT09IDApCiAgICAgICAgICAgICAgICAgIHRoaXMucHJlcmVsZWFzZSA9IFswXTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICBsZXQgZTMgPSB0aGlzLnByZXJlbGVhc2UubGVuZ3RoOwogICAgICAgICAgICAgICAgICBmb3IgKDsgLS1lMyA+PSAwOyApCiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHRoaXMucHJlcmVsZWFzZVtlM10gPT0gIm51bWJlciIgJiYgKHRoaXMucHJlcmVsZWFzZVtlM10rKywgZTMgPSAtMik7CiAgICAgICAgICAgICAgICAgIGUzID09PSAtMSAmJiB0aGlzLnByZXJlbGVhc2UucHVzaCgwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHQyICYmICh0aGlzLnByZXJlbGVhc2VbMF0gPT09IHQyID8gaXNOYU4odGhpcy5wcmVyZWxlYXNlWzFdKSAmJiAodGhpcy5wcmVyZWxlYXNlID0gW3QyLCAwXSkgOiB0aGlzLnByZXJlbGVhc2UgPSBbdDIsIDBdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgaW5jcmVtZW50IGFyZ3VtZW50OiAiLmNvbmNhdChlMikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1hdCgpLCB0aGlzLnJhdyA9IHRoaXMudmVyc2lvbiwgdGhpczsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc3QgRWEgPSBEYTsKICAgICAgICB2YXIgQ2EgPSAoZTIsIHQyLCBuMikgPT4gbmV3IEVhKGUyLCBuMikuY29tcGFyZShuZXcgRWEodDIsIG4yKSk7CiAgICAgICAgY29uc3QgYmEgPSBDYTsKICAgICAgICB2YXIgdmEgPSAoZTIsIHQyLCBuMikgPT4gYmEoZTIsIHQyLCBuMikgPCAwOwogICAgICAgIGNvbnN0IEFhID0gQ2E7CiAgICAgICAgdmFyIEZhLCB4YSwgU2EsIHdhLCBUYSwgQmEsIE5hID0gKGUyLCB0MiwgbjIpID0+IEFhKGUyLCB0MiwgbjIpID49IDAsIGthID0geyBleHBvcnRzOiB7fSB9OwogICAgICAgICFmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGZ1bmN0aW9uIG4yKCkgewogICAgICAgICAgICBmb3IgKHZhciBlMyA9IFtdLCB0MyA9IDA7IHQzIDwgYXJndW1lbnRzLmxlbmd0aDsgdDMrKykKICAgICAgICAgICAgICBlM1t0M10gPSBhcmd1bWVudHNbdDNdOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gcjIoKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgV2Vha01hcCAhPSAidW5kZWZpbmVkIiA/IC8qIEBfX1BVUkVfXyAqLyBuZXcgV2Vha01hcCgpIDogeyBhZGQ6IG4yLCBkZWxldGU6IG4yLCBnZXQ6IG4yLCBzZXQ6IG4yLCBoYXM6IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9IH07CiAgICAgICAgICB9CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodDIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KSwgdDIub3V0ZGVudCA9IHZvaWQgMDsKICAgICAgICAgIHZhciBvMiA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksIGkyID0gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIHJldHVybiBvMi5jYWxsKGUzLCB0Myk7CiAgICAgICAgICB9OwogICAgICAgICAgZnVuY3Rpb24gdTIoZTMsIHQzKSB7CiAgICAgICAgICAgIGZvciAodmFyIG4zIGluIHQzKQogICAgICAgICAgICAgIGkyKHQzLCBuMykgJiYgKGUzW24zXSA9IHQzW24zXSk7CiAgICAgICAgICAgIHJldHVybiBlMzsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBzMiA9IC9eWyBcdF0qKD86XHJcbnxccnxcbikvLCBhMiA9IC8oPzpcclxufFxyfFxuKVsgXHRdKiQvLCBjMiA9IC9eKD86W1xyXG5dfCQpLywgbDIgPSAvKD86XHJcbnxccnxcbikoWyBcdF0qKSg/OlteIFx0XHJcbl18JCkvLCBwMiA9IC9eWyBcdF0qW1xyXG5dWyBcdFxyXG5dKiQvOwogICAgICAgICAgZnVuY3Rpb24gZjIoZTMsIHQzLCBuMykgewogICAgICAgICAgICB2YXIgcjMgPSAwLCBvMyA9IGUzWzBdLm1hdGNoKGwyKTsKICAgICAgICAgICAgbzMgJiYgKHIzID0gbzNbMV0ubGVuZ3RoKTsKICAgICAgICAgICAgdmFyIGkzID0gbmV3IFJlZ0V4cCgiKFxcclxcbnxcXHJ8XFxuKS57MCwiICsgcjMgKyAifSIsICJnIik7CiAgICAgICAgICAgIHQzICYmIChlMyA9IGUzLnNsaWNlKDEpKTsKICAgICAgICAgICAgdmFyIHUzID0gbjMubmV3bGluZSwgYzMgPSBuMy50cmltTGVhZGluZ05ld2xpbmUsIHAzID0gbjMudHJpbVRyYWlsaW5nTmV3bGluZSwgZjMgPSB0eXBlb2YgdTMgPT0gInN0cmluZyIsIGQzID0gZTMubGVuZ3RoOwogICAgICAgICAgICByZXR1cm4gZTMubWFwKGZ1bmN0aW9uKGU0LCB0NCkgewogICAgICAgICAgICAgIHJldHVybiBlNCA9IGU0LnJlcGxhY2UoaTMsICIkMSIpLCB0NCA9PT0gMCAmJiBjMyAmJiAoZTQgPSBlNC5yZXBsYWNlKHMyLCAiIikpLCB0NCA9PT0gZDMgLSAxICYmIHAzICYmIChlNCA9IGU0LnJlcGxhY2UoYTIsICIiKSksIGYzICYmIChlNCA9IGU0LnJlcGxhY2UoL1xyXG58XG58XHIvZywgZnVuY3Rpb24oZTUpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1MzsKICAgICAgICAgICAgICB9KSksIGU0OwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGQyKGUzLCB0MykgewogICAgICAgICAgICBmb3IgKHZhciBuMyA9ICIiLCByMyA9IDAsIG8zID0gZTMubGVuZ3RoOyByMyA8IG8zOyByMysrKQogICAgICAgICAgICAgIG4zICs9IGUzW3IzXSwgcjMgPCBvMyAtIDEgJiYgKG4zICs9IHQzW3IzXSk7CiAgICAgICAgICAgIHJldHVybiBuMzsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGgyKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBpMihlMywgInJhdyIpICYmIGkyKGUzLCAibGVuZ3RoIik7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZzIgPSBmdW5jdGlvbiBlMyh0MykgewogICAgICAgICAgICB2YXIgbjMgPSByMigpLCBvMyA9IHIyKCksIGkzID0gdTIoZnVuY3Rpb24gcjMoaTQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBzMyA9IFtdLCBhMyA9IDE7IGEzIDwgYXJndW1lbnRzLmxlbmd0aDsgYTMrKykKICAgICAgICAgICAgICAgIHMzW2EzIC0gMV0gPSBhcmd1bWVudHNbYTNdOwogICAgICAgICAgICAgIGlmIChoMihpNCkpIHsKICAgICAgICAgICAgICAgIHZhciBsMyA9IGk0LCBtMiA9IChzM1swXSA9PT0gcjMgfHwgczNbMF0gPT09IGcyKSAmJiBwMi50ZXN0KGwzWzBdKSAmJiBjMi50ZXN0KGwzWzFdKSwgeTIgPSBtMiA/IG8zIDogbjMsIEQyID0geTIuZ2V0KGwzKTsKICAgICAgICAgICAgICAgIGlmIChEMiB8fCAoRDIgPSBmMihsMywgbTIsIHQzKSwgeTIuc2V0KGwzLCBEMikpLCBzMy5sZW5ndGggPT09IDApCiAgICAgICAgICAgICAgICAgIHJldHVybiBEMlswXTsKICAgICAgICAgICAgICAgIHZhciBFMiA9IGQyKEQyLCBtMiA/IHMzLnNsaWNlKDEpIDogczMpOwogICAgICAgICAgICAgICAgcmV0dXJuIEUyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gZTModTIodTIoe30sIHQzKSwgaTQgfHwge30pKTsKICAgICAgICAgICAgfSwgeyBzdHJpbmc6IGZ1bmN0aW9uKGU0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGYyKFtlNF0sIGZhbHNlLCB0MylbMF07CiAgICAgICAgICAgIH0gfSk7CiAgICAgICAgICAgIHJldHVybiBpMzsKICAgICAgICAgIH0oeyB0cmltTGVhZGluZ05ld2xpbmU6IHRydWUsIHRyaW1UcmFpbGluZ05ld2xpbmU6IHRydWUgfSk7CiAgICAgICAgICB0Mi5vdXRkZW50ID0gZzIsIHQyLmRlZmF1bHQgPSBnMjsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGUyLmV4cG9ydHMgPSBnMiwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGcyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIGcyLmRlZmF1bHQgPSBnMiwgZzIub3V0ZGVudCA9IGcyOwogICAgICAgICAgfSBjYXRjaCAoZTMpIHsKICAgICAgICAgIH0KICAgICAgICB9KGthLCBrYS5leHBvcnRzKTsKICAgICAgICBjb25zdCB7IG91dGRlbnQ6IFBhIH0gPSBrYS5leHBvcnRzLCBPYSA9ICJDb25maWciLCBJYSA9ICJFZGl0b3IiLCBMYSA9ICJPdGhlciIsIGphID0gIkdsb2JhbCIsIF9hID0gIlNwZWNpYWwiLCBNYSA9IHsgY3Vyc29yT2Zmc2V0OiB7IHNpbmNlOiAiMS40LjAiLCBjYXRlZ29yeTogX2EsIHR5cGU6ICJpbnQiLCBkZWZhdWx0OiAtMSwgcmFuZ2U6IHsgc3RhcnQ6IC0xLCBlbmQ6IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSwgc3RlcDogMSB9LCBkZXNjcmlwdGlvbjogUGEoRmEgfHwgKEZhID0gbHUoWyJcbiAgICAgIFByaW50ICh0byBzdGRlcnIpIHdoZXJlIGEgY3Vyc29yIGF0IHRoZSBnaXZlbiBwb3NpdGlvbiB3b3VsZCBtb3ZlIHRvIGFmdGVyIGZvcm1hdHRpbmcuXG4gICAgICBUaGlzIG9wdGlvbiBjYW5ub3QgYmUgdXNlZCB3aXRoIC0tcmFuZ2Utc3RhcnQgYW5kIC0tcmFuZ2UtZW5kLlxuICAgICJdKSkpLCBjbGlDYXRlZ29yeTogSWEgfSwgZW5kT2ZMaW5lOiB7IHNpbmNlOiAiMS4xNS4wIiwgY2F0ZWdvcnk6IGphLCB0eXBlOiAiY2hvaWNlIiwgZGVmYXVsdDogW3sgc2luY2U6ICIxLjE1LjAiLCB2YWx1ZTogImF1dG8iIH0sIHsgc2luY2U6ICIyLjAuMCIsIHZhbHVlOiAibGYiIH1dLCBkZXNjcmlwdGlvbjogIldoaWNoIGVuZCBvZiBsaW5lIGNoYXJhY3RlcnMgdG8gYXBwbHkuIiwgY2hvaWNlczogW3sgdmFsdWU6ICJsZiIsIGRlc2NyaXB0aW9uOiAiTGluZSBGZWVkIG9ubHkgKFxcbiksIGNvbW1vbiBvbiBMaW51eCBhbmQgbWFjT1MgYXMgd2VsbCBhcyBpbnNpZGUgZ2l0IHJlcG9zIiB9LCB7IHZhbHVlOiAiY3JsZiIsIGRlc2NyaXB0aW9uOiAiQ2FycmlhZ2UgUmV0dXJuICsgTGluZSBGZWVkIGNoYXJhY3RlcnMgKFxcclxcbiksIGNvbW1vbiBvbiBXaW5kb3dzIiB9LCB7IHZhbHVlOiAiY3IiLCBkZXNjcmlwdGlvbjogIkNhcnJpYWdlIFJldHVybiBjaGFyYWN0ZXIgb25seSAoXFxyKSwgdXNlZCB2ZXJ5IHJhcmVseSIgfSwgeyB2YWx1ZTogImF1dG8iLCBkZXNjcmlwdGlvbjogUGEoeGEgfHwgKHhhID0gbHUoWyJcbiAgICAgICAgICBNYWludGFpbiBleGlzdGluZ1xuICAgICAgICAgIChtaXhlZCB2YWx1ZXMgd2l0aGluIG9uZSBmaWxlIGFyZSBub3JtYWxpc2VkIGJ5IGxvb2tpbmcgYXQgd2hhdCdzIHVzZWQgYWZ0ZXIgdGhlIGZpcnN0IGxpbmUpXG4gICAgICAgICJdKSkpIH1dIH0sIGZpbGVwYXRoOiB7IHNpbmNlOiAiMS40LjAiLCBjYXRlZ29yeTogX2EsIHR5cGU6ICJwYXRoIiwgZGVzY3JpcHRpb246ICJTcGVjaWZ5IHRoZSBpbnB1dCBmaWxlcGF0aC4gVGhpcyB3aWxsIGJlIHVzZWQgdG8gZG8gcGFyc2VyIGluZmVyZW5jZS4iLCBjbGlOYW1lOiAic3RkaW4tZmlsZXBhdGgiLCBjbGlDYXRlZ29yeTogTGEsIGNsaURlc2NyaXB0aW9uOiAiUGF0aCB0byB0aGUgZmlsZSB0byBwcmV0ZW5kIHRoYXQgc3RkaW4gY29tZXMgZnJvbS4iIH0sIGluc2VydFByYWdtYTogeyBzaW5jZTogIjEuOC4wIiwgY2F0ZWdvcnk6IF9hLCB0eXBlOiAiYm9vbGVhbiIsIGRlZmF1bHQ6IGZhbHNlLCBkZXNjcmlwdGlvbjogIkluc2VydCBAZm9ybWF0IHByYWdtYSBpbnRvIGZpbGUncyBmaXJzdCBkb2NibG9jayBjb21tZW50LiIsIGNsaUNhdGVnb3J5OiBMYSB9LCBwYXJzZXI6IHsgc2luY2U6ICIwLjAuMTAiLCBjYXRlZ29yeTogamEsIHR5cGU6ICJjaG9pY2UiLCBkZWZhdWx0OiBbeyBzaW5jZTogIjAuMC4xMCIsIHZhbHVlOiAiYmFieWxvbiIgfSwgeyBzaW5jZTogIjEuMTMuMCIsIHZhbHVlOiB2b2lkIDAgfV0sIGRlc2NyaXB0aW9uOiAiV2hpY2ggcGFyc2VyIHRvIHVzZS4iLCBleGNlcHRpb246IChlMikgPT4gdHlwZW9mIGUyID09ICJzdHJpbmciIHx8IHR5cGVvZiBlMiA9PSAiZnVuY3Rpb24iLCBjaG9pY2VzOiBbeyB2YWx1ZTogImZsb3ciLCBkZXNjcmlwdGlvbjogIkZsb3ciIH0sIHsgdmFsdWU6ICJiYWJlbCIsIHNpbmNlOiAiMS4xNi4wIiwgZGVzY3JpcHRpb246ICJKYXZhU2NyaXB0IiB9LCB7IHZhbHVlOiAiYmFiZWwtZmxvdyIsIHNpbmNlOiAiMS4xNi4wIiwgZGVzY3JpcHRpb246ICJGbG93IiB9LCB7IHZhbHVlOiAiYmFiZWwtdHMiLCBzaW5jZTogIjIuMC4wIiwgZGVzY3JpcHRpb246ICJUeXBlU2NyaXB0IiB9LCB7IHZhbHVlOiAidHlwZXNjcmlwdCIsIHNpbmNlOiAiMS40LjAiLCBkZXNjcmlwdGlvbjogIlR5cGVTY3JpcHQiIH0sIHsgdmFsdWU6ICJlc3ByZWUiLCBzaW5jZTogIjIuMi4wIiwgZGVzY3JpcHRpb246ICJKYXZhU2NyaXB0IiB9LCB7IHZhbHVlOiAibWVyaXlhaCIsIHNpbmNlOiAiMi4yLjAiLCBkZXNjcmlwdGlvbjogIkphdmFTY3JpcHQiIH0sIHsgdmFsdWU6ICJjc3MiLCBzaW5jZTogIjEuNy4xIiwgZGVzY3JpcHRpb246ICJDU1MiIH0sIHsgdmFsdWU6ICJsZXNzIiwgc2luY2U6ICIxLjcuMSIsIGRlc2NyaXB0aW9uOiAiTGVzcyIgfSwgeyB2YWx1ZTogInNjc3MiLCBzaW5jZTogIjEuNy4xIiwgZGVzY3JpcHRpb246ICJTQ1NTIiB9LCB7IHZhbHVlOiAianNvbiIsIHNpbmNlOiAiMS41LjAiLCBkZXNjcmlwdGlvbjogIkpTT04iIH0sIHsgdmFsdWU6ICJqc29uNSIsIHNpbmNlOiAiMS4xMy4wIiwgZGVzY3JpcHRpb246ICJKU09ONSIgfSwgeyB2YWx1ZTogImpzb24tc3RyaW5naWZ5Iiwgc2luY2U6ICIxLjEzLjAiLCBkZXNjcmlwdGlvbjogIkpTT04uc3RyaW5naWZ5IiB9LCB7IHZhbHVlOiAiZ3JhcGhxbCIsIHNpbmNlOiAiMS41LjAiLCBkZXNjcmlwdGlvbjogIkdyYXBoUUwiIH0sIHsgdmFsdWU6ICJtYXJrZG93biIsIHNpbmNlOiAiMS44LjAiLCBkZXNjcmlwdGlvbjogIk1hcmtkb3duIiB9LCB7IHZhbHVlOiAibWR4Iiwgc2luY2U6ICIxLjE1LjAiLCBkZXNjcmlwdGlvbjogIk1EWCIgfSwgeyB2YWx1ZTogInZ1ZSIsIHNpbmNlOiAiMS4xMC4wIiwgZGVzY3JpcHRpb246ICJWdWUiIH0sIHsgdmFsdWU6ICJ5YW1sIiwgc2luY2U6ICIxLjE0LjAiLCBkZXNjcmlwdGlvbjogIllBTUwiIH0sIHsgdmFsdWU6ICJnbGltbWVyIiwgc2luY2U6ICIyLjMuMCIsIGRlc2NyaXB0aW9uOiAiRW1iZXIgLyBIYW5kbGViYXJzIiB9LCB7IHZhbHVlOiAiaHRtbCIsIHNpbmNlOiAiMS4xNS4wIiwgZGVzY3JpcHRpb246ICJIVE1MIiB9LCB7IHZhbHVlOiAiYW5ndWxhciIsIHNpbmNlOiAiMS4xNS4wIiwgZGVzY3JpcHRpb246ICJBbmd1bGFyIiB9LCB7IHZhbHVlOiAibHdjIiwgc2luY2U6ICIxLjE3LjAiLCBkZXNjcmlwdGlvbjogIkxpZ2h0bmluZyBXZWIgQ29tcG9uZW50cyIgfV0gfSwgcGx1Z2luczogeyBzaW5jZTogIjEuMTAuMCIsIHR5cGU6ICJwYXRoIiwgYXJyYXk6IHRydWUsIGRlZmF1bHQ6IFt7IHZhbHVlOiBbXSB9XSwgY2F0ZWdvcnk6IGphLCBkZXNjcmlwdGlvbjogIkFkZCBhIHBsdWdpbi4gTXVsdGlwbGUgcGx1Z2lucyBjYW4gYmUgcGFzc2VkIGFzIHNlcGFyYXRlIGAtLXBsdWdpbmBzLiIsIGV4Y2VwdGlvbjogKGUyKSA9PiB0eXBlb2YgZTIgPT0gInN0cmluZyIgfHwgdHlwZW9mIGUyID09ICJvYmplY3QiLCBjbGlOYW1lOiAicGx1Z2luIiwgY2xpQ2F0ZWdvcnk6IE9hIH0sIHBsdWdpblNlYXJjaERpcnM6IHsgc2luY2U6ICIxLjEzLjAiLCB0eXBlOiAicGF0aCIsIGFycmF5OiB0cnVlLCBkZWZhdWx0OiBbeyB2YWx1ZTogW10gfV0sIGNhdGVnb3J5OiBqYSwgZGVzY3JpcHRpb246IFBhKFNhIHx8IChTYSA9IGx1KFsiXG4gICAgICBDdXN0b20gZGlyZWN0b3J5IHRoYXQgY29udGFpbnMgcHJldHRpZXIgcGx1Z2lucyBpbiBub2RlX21vZHVsZXMgc3ViZGlyZWN0b3J5LlxuICAgICAgT3ZlcnJpZGVzIGRlZmF1bHQgYmVoYXZpb3Igd2hlbiBwbHVnaW5zIGFyZSBzZWFyY2hlZCByZWxhdGl2ZWx5IHRvIHRoZSBsb2NhdGlvbiBvZiBQcmV0dGllci5cbiAgICAgIE11bHRpcGxlIHZhbHVlcyBhcmUgYWNjZXB0ZWQuXG4gICAgIl0pKSksIGV4Y2VwdGlvbjogKGUyKSA9PiB0eXBlb2YgZTIgPT0gInN0cmluZyIgfHwgdHlwZW9mIGUyID09ICJvYmplY3QiLCBjbGlOYW1lOiAicGx1Z2luLXNlYXJjaC1kaXIiLCBjbGlDYXRlZ29yeTogT2EgfSwgcHJpbnRXaWR0aDogeyBzaW5jZTogIjAuMC4wIiwgY2F0ZWdvcnk6IGphLCB0eXBlOiAiaW50IiwgZGVmYXVsdDogODAsIGRlc2NyaXB0aW9uOiAiVGhlIGxpbmUgbGVuZ3RoIHdoZXJlIFByZXR0aWVyIHdpbGwgdHJ5IHdyYXAuIiwgcmFuZ2U6IHsgc3RhcnQ6IDAsIGVuZDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBzdGVwOiAxIH0gfSwgcmFuZ2VFbmQ6IHsgc2luY2U6ICIxLjQuMCIsIGNhdGVnb3J5OiBfYSwgdHlwZTogImludCIsIGRlZmF1bHQ6IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSwgcmFuZ2U6IHsgc3RhcnQ6IDAsIGVuZDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBzdGVwOiAxIH0sIGRlc2NyaXB0aW9uOiBQYSh3YSB8fCAod2EgPSBsdShbIlxuICAgICAgRm9ybWF0IGNvZGUgZW5kaW5nIGF0IGEgZ2l2ZW4gY2hhcmFjdGVyIG9mZnNldCAoZXhjbHVzaXZlKS5cbiAgICAgIFRoZSByYW5nZSB3aWxsIGV4dGVuZCBmb3J3YXJkcyB0byB0aGUgZW5kIG9mIHRoZSBzZWxlY3RlZCBzdGF0ZW1lbnQuXG4gICAgICBUaGlzIG9wdGlvbiBjYW5ub3QgYmUgdXNlZCB3aXRoIC0tY3Vyc29yLW9mZnNldC5cbiAgICAiXSkpKSwgY2xpQ2F0ZWdvcnk6IElhIH0sIHJhbmdlU3RhcnQ6IHsgc2luY2U6ICIxLjQuMCIsIGNhdGVnb3J5OiBfYSwgdHlwZTogImludCIsIGRlZmF1bHQ6IDAsIHJhbmdlOiB7IHN0YXJ0OiAwLCBlbmQ6IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSwgc3RlcDogMSB9LCBkZXNjcmlwdGlvbjogUGEoVGEgfHwgKFRhID0gbHUoWyJcbiAgICAgIEZvcm1hdCBjb2RlIHN0YXJ0aW5nIGF0IGEgZ2l2ZW4gY2hhcmFjdGVyIG9mZnNldC5cbiAgICAgIFRoZSByYW5nZSB3aWxsIGV4dGVuZCBiYWNrd2FyZHMgdG8gdGhlIHN0YXJ0IG9mIHRoZSBmaXJzdCBsaW5lIGNvbnRhaW5pbmcgdGhlIHNlbGVjdGVkIHN0YXRlbWVudC5cbiAgICAgIFRoaXMgb3B0aW9uIGNhbm5vdCBiZSB1c2VkIHdpdGggLS1jdXJzb3Itb2Zmc2V0LlxuICAgICJdKSkpLCBjbGlDYXRlZ29yeTogSWEgfSwgcmVxdWlyZVByYWdtYTogeyBzaW5jZTogIjEuNy4wIiwgY2F0ZWdvcnk6IF9hLCB0eXBlOiAiYm9vbGVhbiIsIGRlZmF1bHQ6IGZhbHNlLCBkZXNjcmlwdGlvbjogUGEoQmEgfHwgKEJhID0gbHUoWyJcbiAgICAgIFJlcXVpcmUgZWl0aGVyICdAcHJldHRpZXInIG9yICdAZm9ybWF0JyB0byBiZSBwcmVzZW50IGluIHRoZSBmaWxlJ3MgZmlyc3QgZG9jYmxvY2sgY29tbWVudFxuICAgICAgaW4gb3JkZXIgZm9yIGl0IHRvIGJlIGZvcm1hdHRlZC5cbiAgICAiXSkpKSwgY2xpQ2F0ZWdvcnk6IExhIH0sIHRhYldpZHRoOiB7IHR5cGU6ICJpbnQiLCBjYXRlZ29yeTogamEsIGRlZmF1bHQ6IDIsIGRlc2NyaXB0aW9uOiAiTnVtYmVyIG9mIHNwYWNlcyBwZXIgaW5kZW50YXRpb24gbGV2ZWwuIiwgcmFuZ2U6IHsgc3RhcnQ6IDAsIGVuZDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBzdGVwOiAxIH0gfSwgdXNlVGFiczogeyBzaW5jZTogIjEuMC4wIiwgY2F0ZWdvcnk6IGphLCB0eXBlOiAiYm9vbGVhbiIsIGRlZmF1bHQ6IGZhbHNlLCBkZXNjcmlwdGlvbjogIkluZGVudCB3aXRoIHRhYnMgaW5zdGVhZCBvZiBzcGFjZXMuIiB9LCBlbWJlZGRlZExhbmd1YWdlRm9ybWF0dGluZzogeyBzaW5jZTogIjIuMS4wIiwgY2F0ZWdvcnk6IGphLCB0eXBlOiAiY2hvaWNlIiwgZGVmYXVsdDogW3sgc2luY2U6ICIyLjEuMCIsIHZhbHVlOiAiYXV0byIgfV0sIGRlc2NyaXB0aW9uOiAiQ29udHJvbCBob3cgUHJldHRpZXIgZm9ybWF0cyBxdW90ZWQgY29kZSBlbWJlZGRlZCBpbiB0aGUgZmlsZS4iLCBjaG9pY2VzOiBbeyB2YWx1ZTogImF1dG8iLCBkZXNjcmlwdGlvbjogIkZvcm1hdCBlbWJlZGRlZCBjb2RlIGlmIFByZXR0aWVyIGNhbiBhdXRvbWF0aWNhbGx5IGlkZW50aWZ5IGl0LiIgfSwgeyB2YWx1ZTogIm9mZiIsIGRlc2NyaXB0aW9uOiAiTmV2ZXIgYXV0b21hdGljYWxseSBmb3JtYXQgZW1iZWRkZWQgY29kZS4iIH1dIH0gfTsKICAgICAgICBjb25zdCBSYSA9IFsiY2xpTmFtZSIsICJjbGlDYXRlZ29yeSIsICJjbGlEZXNjcmlwdGlvbiJdLCBWYSA9IHsgY29tcGFyZTogQ2EsIGx0OiB2YSwgZ3RlOiBOYSB9LCAkYSA9IChlMiwgdDIpID0+IE9iamVjdC5lbnRyaWVzKGUyKS5tYXAoKGUzKSA9PiB7CiAgICAgICAgICBsZXQgW24yLCByMl0gPSBlMzsKICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHsgW3QyXTogbjIgfSwgcjIpOwogICAgICAgIH0pLCBXYSA9IG4udmVyc2lvbiwgcWEgPSB7IENBVEVHT1JZX0NPTkZJRzogT2EsIENBVEVHT1JZX0VESVRPUjogSWEsIENBVEVHT1JZX0ZPUk1BVDogIkZvcm1hdCIsIENBVEVHT1JZX09USEVSOiBMYSwgQ0FURUdPUllfT1VUUFVUOiAiT3V0cHV0IiwgQ0FURUdPUllfR0xPQkFMOiBqYSwgQ0FURUdPUllfU1BFQ0lBTDogX2EsIG9wdGlvbnM6IE1hIH0ub3B0aW9uczsKICAgICAgICBmdW5jdGlvbiBVYShlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IG5ldyBTZXQoZTIuY2hvaWNlcy5tYXAoKGUzKSA9PiBlMy52YWx1ZSkpOwogICAgICAgICAgZm9yIChjb25zdCBvMiBvZiB0MikKICAgICAgICAgICAgaWYgKG8yLnBhcnNlcnMpIHsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQzIG9mIG8yLnBhcnNlcnMpCiAgICAgICAgICAgICAgICBpZiAoIXIyLmhhcyh0MykpIHsKICAgICAgICAgICAgICAgICAgcjIuYWRkKHQzKTsKICAgICAgICAgICAgICAgICAgY29uc3QgaTIgPSBuMi5maW5kKChlMykgPT4gZTMucGFyc2VycyAmJiBlMy5wYXJzZXJzW3QzXSk7CiAgICAgICAgICAgICAgICAgIGxldCB1MiA9IG8yLm5hbWU7CiAgICAgICAgICAgICAgICAgIGkyICYmIGkyLm5hbWUgJiYgKHUyICs9ICIgKHBsdWdpbjogIi5jb25jYXQoaTIubmFtZSwgIikiKSksIGUyLmNob2ljZXMucHVzaCh7IHZhbHVlOiB0MywgZGVzY3JpcHRpb246IHUyIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciB6YSA9IHsgZ2V0U3VwcG9ydEluZm86IGZ1bmN0aW9uKCkgewogICAgICAgICAgbGV0IHsgcGx1Z2luczogZTIgPSBbXSwgc2hvd1VucmVsZWFzZWQ6IHQyID0gZmFsc2UsIHNob3dEZXByZWNhdGVkOiBuMiA9IGZhbHNlLCBzaG93SW50ZXJuYWw6IHIyID0gZmFsc2UgfSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgICAgICBjb25zdCBvMiA9IFdhLnNwbGl0KCItIiwgMSlbMF0sIGkyID0gZTIuZmxhdE1hcCgoZTMpID0+IGUzLmxhbmd1YWdlcyB8fCBbXSkuZmlsdGVyKHMyKSwgdTIgPSAkYShPYmplY3QuYXNzaWduKHt9LCAuLi5lMi5tYXAoKGUzKSA9PiB7CiAgICAgICAgICAgIGxldCB7IG9wdGlvbnM6IHQzIH0gPSBlMzsKICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfSksIHFhKSwgIm5hbWUiKS5maWx0ZXIoKGUzKSA9PiBzMihlMykgJiYgYTIoZTMpKS5zb3J0KChlMywgdDMpID0+IGUzLm5hbWUgPT09IHQzLm5hbWUgPyAwIDogZTMubmFtZSA8IHQzLm5hbWUgPyAtMSA6IDEpLm1hcChjMikubWFwKCh0MykgPT4gewogICAgICAgICAgICB0MyA9IE9iamVjdC5hc3NpZ24oe30sIHQzKSwgQXJyYXkuaXNBcnJheSh0My5kZWZhdWx0KSAmJiAodDMuZGVmYXVsdCA9IHQzLmRlZmF1bHQubGVuZ3RoID09PSAxID8gdDMuZGVmYXVsdFswXS52YWx1ZSA6IHQzLmRlZmF1bHQuZmlsdGVyKHMyKS5zb3J0KChlMywgdDQpID0+IFZhLmNvbXBhcmUodDQuc2luY2UsIGUzLnNpbmNlKSlbMF0udmFsdWUpLCBBcnJheS5pc0FycmF5KHQzLmNob2ljZXMpICYmICh0My5jaG9pY2VzID0gdDMuY2hvaWNlcy5maWx0ZXIoKGUzKSA9PiBzMihlMykgJiYgYTIoZTMpKSwgdDMubmFtZSA9PT0gInBhcnNlciIgJiYgVWEodDMsIGkyLCBlMikpOwogICAgICAgICAgICBjb25zdCBuMyA9IE9iamVjdC5mcm9tRW50cmllcyhlMi5maWx0ZXIoKGUzKSA9PiBlMy5kZWZhdWx0T3B0aW9ucyAmJiBlMy5kZWZhdWx0T3B0aW9uc1t0My5uYW1lXSAhPT0gdm9pZCAwKS5tYXAoKGUzKSA9PiBbZTMubmFtZSwgZTMuZGVmYXVsdE9wdGlvbnNbdDMubmFtZV1dKSk7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHQzKSwge30sIHsgcGx1Z2luRGVmYXVsdHM6IG4zIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4geyBsYW5ndWFnZXM6IGkyLCBvcHRpb25zOiB1MiB9OwogICAgICAgICAgZnVuY3Rpb24gczIoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIHQyIHx8ICEoInNpbmNlIiBpbiBlMykgfHwgZTMuc2luY2UgJiYgVmEuZ3RlKG8yLCBlMy5zaW5jZSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBhMihlMykgewogICAgICAgICAgICByZXR1cm4gbjIgfHwgISgiZGVwcmVjYXRlZCIgaW4gZTMpIHx8IGUzLmRlcHJlY2F0ZWQgJiYgVmEubHQobzIsIGUzLmRlcHJlY2F0ZWQpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gYzIoZTMpIHsKICAgICAgICAgICAgaWYgKHIyKQogICAgICAgICAgICAgIHJldHVybiBlMzsKICAgICAgICAgICAgcmV0dXJuIGN1KGUzLCBSYSk7CiAgICAgICAgICB9CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IEdhID0gZXUuZXhwb3J0cywgSGEgPSAoZTIpID0+IHsKICAgICAgICAgIGlmICh0eXBlb2YgZTIgIT0gInN0cmluZyIpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkV4cGVjdGVkIGEgc3RyaW5nIik7CiAgICAgICAgICByZXR1cm4gZTIucmVwbGFjZSgvW3xcXHt9KClbXF1eJCsqPy5dL2csICJcXCQmIikucmVwbGFjZSgvLS9nLCAiXFx4MmQiKTsKICAgICAgICB9LCBKYSA9IGF1LCB7IGdldFN1cHBvcnRJbmZvOiBYYSB9ID0gemEsIFlhID0gL1teXHgyMC1ceDdGXS87CiAgICAgICAgZnVuY3Rpb24gS2EoZTIpIHsKICAgICAgICAgIHJldHVybiAodDIsIG4yLCByMikgPT4gewogICAgICAgICAgICBjb25zdCBvMiA9IHIyICYmIHIyLmJhY2t3YXJkczsKICAgICAgICAgICAgaWYgKG4yID09PSBmYWxzZSkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHsgbGVuZ3RoOiBpMiB9ID0gdDI7CiAgICAgICAgICAgIGxldCB1MiA9IG4yOwogICAgICAgICAgICBmb3IgKDsgdTIgPj0gMCAmJiB1MiA8IGkyOyApIHsKICAgICAgICAgICAgICBjb25zdCBuMyA9IHQyLmNoYXJBdCh1Mik7CiAgICAgICAgICAgICAgaWYgKGUyIGluc3RhbmNlb2YgUmVnRXhwKSB7CiAgICAgICAgICAgICAgICBpZiAoIWUyLnRlc3QobjMpKQogICAgICAgICAgICAgICAgICByZXR1cm4gdTI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICghZTIuaW5jbHVkZXMobjMpKQogICAgICAgICAgICAgICAgcmV0dXJuIHUyOwogICAgICAgICAgICAgIG8yID8gdTItLSA6IHUyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICh1MiA9PT0gLTEgfHwgdTIgPT09IGkyKSAmJiB1MjsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGNvbnN0IFFhID0gS2EoL1xzLyksIFphID0gS2EoIiAJIiksIGVjID0gS2EoIiw7IAkiKSwgdGMgPSBLYSgvW15cblxyXS8pOwogICAgICAgIGZ1bmN0aW9uIG5jKGUyLCB0MikgewogICAgICAgICAgaWYgKHQyID09PSBmYWxzZSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgaWYgKGUyLmNoYXJBdCh0MikgPT09ICIvIiAmJiBlMi5jaGFyQXQodDIgKyAxKSA9PT0gIioiKSB7CiAgICAgICAgICAgIGZvciAobGV0IG4yID0gdDIgKyAyOyBuMiA8IGUyLmxlbmd0aDsgKytuMikKICAgICAgICAgICAgICBpZiAoZTIuY2hhckF0KG4yKSA9PT0gIioiICYmIGUyLmNoYXJBdChuMiArIDEpID09PSAiLyIpCiAgICAgICAgICAgICAgICByZXR1cm4gbjIgKyAyOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiByYyhlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB0MiAhPT0gZmFsc2UgJiYgKGUyLmNoYXJBdCh0MikgPT09ICIvIiAmJiBlMi5jaGFyQXQodDIgKyAxKSA9PT0gIi8iID8gdGMoZTIsIHQyKSA6IHQyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb2MoZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBuMiAmJiBuMi5iYWNrd2FyZHM7CiAgICAgICAgICBpZiAodDIgPT09IGZhbHNlKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBjb25zdCBvMiA9IGUyLmNoYXJBdCh0Mik7CiAgICAgICAgICBpZiAocjIpIHsKICAgICAgICAgICAgaWYgKGUyLmNoYXJBdCh0MiAtIDEpID09PSAiXHIiICYmIG8yID09PSAiXG4iKQogICAgICAgICAgICAgIHJldHVybiB0MiAtIDI7CiAgICAgICAgICAgIGlmIChvMiA9PT0gIlxuIiB8fCBvMiA9PT0gIlxyIiB8fCBvMiA9PT0gIlx1MjAyOCIgfHwgbzIgPT09ICJcdTIwMjkiKQogICAgICAgICAgICAgIHJldHVybiB0MiAtIDE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAobzIgPT09ICJcciIgJiYgZTIuY2hhckF0KHQyICsgMSkgPT09ICJcbiIpCiAgICAgICAgICAgICAgcmV0dXJuIHQyICsgMjsKICAgICAgICAgICAgaWYgKG8yID09PSAiXG4iIHx8IG8yID09PSAiXHIiIHx8IG8yID09PSAiXHUyMDI4IiB8fCBvMiA9PT0gIlx1MjAyOSIpCiAgICAgICAgICAgICAgcmV0dXJuIHQyICsgMTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaWMoZTIsIHQyKSB7CiAgICAgICAgICBsZXQgbjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICAgICAgY29uc3QgcjIgPSBaYShlMiwgbjIuYmFja3dhcmRzID8gdDIgLSAxIDogdDIsIG4yKSwgbzIgPSBvYyhlMiwgcjIsIG4yKTsKICAgICAgICAgIHJldHVybiByMiAhPT0gbzI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHVjKGUyLCB0MikgewogICAgICAgICAgbGV0IG4yID0gbnVsbCwgcjIgPSB0MjsKICAgICAgICAgIGZvciAoOyByMiAhPT0gbjI7ICkKICAgICAgICAgICAgbjIgPSByMiwgcjIgPSBlYyhlMiwgcjIpLCByMiA9IG5jKGUyLCByMiksIHIyID0gWmEoZTIsIHIyKTsKICAgICAgICAgIHJldHVybiByMiA9IHJjKGUyLCByMiksIHIyID0gb2MoZTIsIHIyKSwgcjIgIT09IGZhbHNlICYmIGljKGUyLCByMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHNjKGUyLCB0MikgewogICAgICAgICAgbGV0IG4yID0gbnVsbCwgcjIgPSB0MjsKICAgICAgICAgIGZvciAoOyByMiAhPT0gbjI7ICkKICAgICAgICAgICAgbjIgPSByMiwgcjIgPSBaYShlMiwgcjIpLCByMiA9IG5jKGUyLCByMiksIHIyID0gcmMoZTIsIHIyKSwgcjIgPSBvYyhlMiwgcjIpOwogICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhYyhlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gc2MoZTIsIG4yKHQyKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNjKGUyLCB0MikgewogICAgICAgICAgbGV0IG4yID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMl0gOiAwLCByMiA9IDA7CiAgICAgICAgICBmb3IgKGxldCBvMiA9IG4yOyBvMiA8IGUyLmxlbmd0aDsgKytvMikKICAgICAgICAgICAgZTJbbzJdID09PSAiCSIgPyByMiA9IHIyICsgdDIgLSByMiAlIHQyIDogcjIrKzsKICAgICAgICAgIHJldHVybiByMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbGMoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IHsgcXVvdGU6ICciJywgcmVnZXg6IC8iL2csIGVzY2FwZWQ6ICImcXVvdDsiIH0sIHIyID0geyBxdW90ZTogIiciLCByZWdleDogLycvZywgZXNjYXBlZDogIiZhcG9zOyIgfSwgbzIgPSB0MiA9PT0gIiciID8gcjIgOiBuMiwgaTIgPSBvMiA9PT0gcjIgPyBuMiA6IHIyOwogICAgICAgICAgbGV0IHUyID0gbzI7CiAgICAgICAgICBpZiAoZTIuaW5jbHVkZXMobzIucXVvdGUpIHx8IGUyLmluY2x1ZGVzKGkyLnF1b3RlKSkgewogICAgICAgICAgICB1MiA9IChlMi5tYXRjaChvMi5yZWdleCkgfHwgW10pLmxlbmd0aCA+IChlMi5tYXRjaChpMi5yZWdleCkgfHwgW10pLmxlbmd0aCA/IGkyIDogbzI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHBjKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gdDIgPT09ICciJyA/ICInIiA6ICciJywgbzIgPSBlMi5yZXBsYWNlKC9cXCguKXwoWyInXSkvZ3MsIChlMywgbzMsIGkyKSA9PiBvMyA9PT0gcjIgPyBvMyA6IGkyID09PSB0MiA/ICJcXCIgKyBpMiA6IGkyIHx8IChuMiAmJiAvXlteXG5cciInMC03XFxiZm5ydC12eFx1MjAyOFx1MjAyOV0kLy50ZXN0KG8zKSA/IG8zIDogIlxcIiArIG8zKSk7CiAgICAgICAgICByZXR1cm4gdDIgKyBvMiArIHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBmYyhlMiwgdDIpIHsKICAgICAgICAgIChlMi5jb21tZW50cyB8fCAoZTIuY29tbWVudHMgPSBbXSkpLnB1c2godDIpLCB0Mi5wcmludGVkID0gZmFsc2UsIHQyLm5vZGVEZXNjcmlwdGlvbiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gZTMudHlwZSB8fCBlMy5raW5kIHx8ICIodW5rbm93biB0eXBlKSI7CiAgICAgICAgICAgIGxldCBuMiA9IFN0cmluZyhlMy5uYW1lIHx8IGUzLmlkICYmICh0eXBlb2YgZTMuaWQgPT0gIm9iamVjdCIgPyBlMy5pZC5uYW1lIDogZTMuaWQpIHx8IGUzLmtleSAmJiAodHlwZW9mIGUzLmtleSA9PSAib2JqZWN0IiA/IGUzLmtleS5uYW1lIDogZTMua2V5KSB8fCBlMy52YWx1ZSAmJiAodHlwZW9mIGUzLnZhbHVlID09ICJvYmplY3QiID8gIiIgOiBTdHJpbmcoZTMudmFsdWUpKSB8fCBlMy5vcGVyYXRvciB8fCAiIik7CiAgICAgICAgICAgIG4yLmxlbmd0aCA+IDIwICYmIChuMiA9IG4yLnNsaWNlKDAsIDE5KSArICJcdTIwMjYiKTsKICAgICAgICAgICAgcmV0dXJuIHQzICsgKG4yID8gIiAiICsgbjIgOiAiIik7CiAgICAgICAgICB9KGUyKTsKICAgICAgICB9CiAgICAgICAgdmFyIGRjID0geyBpbmZlclBhcnNlckJ5TGFuZ3VhZ2U6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgeyBsYW5ndWFnZXM6IG4yIH0gPSBYYSh7IHBsdWdpbnM6IHQyLnBsdWdpbnMgfSksIHIyID0gbjIuZmluZCgodDMpID0+IHsKICAgICAgICAgICAgbGV0IHsgbmFtZTogbjMgfSA9IHQzOwogICAgICAgICAgICByZXR1cm4gbjMudG9Mb3dlckNhc2UoKSA9PT0gZTI7CiAgICAgICAgICB9KSB8fCBuMi5maW5kKCh0MykgPT4gewogICAgICAgICAgICBsZXQgeyBhbGlhc2VzOiBuMyB9ID0gdDM7CiAgICAgICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KG4zKSAmJiBuMy5pbmNsdWRlcyhlMik7CiAgICAgICAgICB9KSB8fCBuMi5maW5kKCh0MykgPT4gewogICAgICAgICAgICBsZXQgeyBleHRlbnNpb25zOiBuMyB9ID0gdDM7CiAgICAgICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KG4zKSAmJiBuMy5pbmNsdWRlcygiLiIuY29uY2F0KGUyKSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiByMiAmJiByMi5wYXJzZXJzWzBdOwogICAgICAgIH0sIGdldFN0cmluZ1dpZHRoOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyID8gWWEudGVzdChlMikgPyBHYShlMikgOiBlMi5sZW5ndGggOiAwOwogICAgICAgIH0sIGdldE1heENvbnRpbnVvdXNDb3VudDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IGUyLm1hdGNoKG5ldyBSZWdFeHAoIigiLmNvbmNhdChIYSh0MiksICIpKyIpLCAiZyIpKTsKICAgICAgICAgIHJldHVybiBuMiA9PT0gbnVsbCA/IDAgOiBuMi5yZWR1Y2UoKGUzLCBuMykgPT4gTWF0aC5tYXgoZTMsIG4zLmxlbmd0aCAvIHQyLmxlbmd0aCksIDApOwogICAgICAgIH0sIGdldE1pbk5vdFByZXNlbnRDb250aW51b3VzQ291bnQ6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSBlMi5tYXRjaChuZXcgUmVnRXhwKCIoIi5jb25jYXQoSGEodDIpLCAiKSsiKSwgImciKSk7CiAgICAgICAgICBpZiAobjIgPT09IG51bGwpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgY29uc3QgcjIgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwogICAgICAgICAgbGV0IG8yID0gMDsKICAgICAgICAgIGZvciAoY29uc3QgZTMgb2YgbjIpIHsKICAgICAgICAgICAgY29uc3QgbjMgPSBlMy5sZW5ndGggLyB0Mi5sZW5ndGg7CiAgICAgICAgICAgIHIyLnNldChuMywgdHJ1ZSksIG4zID4gbzIgJiYgKG8yID0gbjMpOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChsZXQgZTMgPSAxOyBlMyA8IG8yOyBlMysrKQogICAgICAgICAgICBpZiAoIXIyLmdldChlMykpCiAgICAgICAgICAgICAgcmV0dXJuIGUzOwogICAgICAgICAgcmV0dXJuIG8yICsgMTsKICAgICAgICB9LCBnZXRQZW51bHRpbWF0ZTogKGUyKSA9PiBlMltlMi5sZW5ndGggLSAyXSwgZ2V0TGFzdDogSmEsIGdldE5leHROb25TcGFjZU5vbkNvbW1lbnRDaGFyYWN0ZXJJbmRleFdpdGhTdGFydEluZGV4OiBzYywgZ2V0TmV4dE5vblNwYWNlTm9uQ29tbWVudENoYXJhY3RlckluZGV4OiBhYywgZ2V0TmV4dE5vblNwYWNlTm9uQ29tbWVudENoYXJhY3RlcjogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIGUyLmNoYXJBdChhYyhlMiwgdDIsIG4yKSk7CiAgICAgICAgfSwgc2tpcDogS2EsIHNraXBXaGl0ZXNwYWNlOiBRYSwgc2tpcFNwYWNlczogWmEsIHNraXBUb0xpbmVFbmQ6IGVjLCBza2lwRXZlcnl0aGluZ0J1dE5ld0xpbmU6IHRjLCBza2lwSW5saW5lQ29tbWVudDogbmMsIHNraXBUcmFpbGluZ0NvbW1lbnQ6IHJjLCBza2lwTmV3bGluZTogb2MsIGlzTmV4dExpbmVFbXB0eUFmdGVySW5kZXg6IHVjLCBpc05leHRMaW5lRW1wdHk6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiB1YyhlMiwgbjIodDIpKTsKICAgICAgICB9LCBpc1ByZXZpb3VzTGluZUVtcHR5OiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBsZXQgcjIgPSBuMih0MikgLSAxOwogICAgICAgICAgcmV0dXJuIHIyID0gWmEoZTIsIHIyLCB7IGJhY2t3YXJkczogdHJ1ZSB9KSwgcjIgPSBvYyhlMiwgcjIsIHsgYmFja3dhcmRzOiB0cnVlIH0pLCByMiA9IFphKGUyLCByMiwgeyBiYWNrd2FyZHM6IHRydWUgfSksIHIyICE9PSBvYyhlMiwgcjIsIHsgYmFja3dhcmRzOiB0cnVlIH0pOwogICAgICAgIH0sIGhhc05ld2xpbmU6IGljLCBoYXNOZXdsaW5lSW5SYW5nZTogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgZm9yIChsZXQgcjIgPSB0MjsgcjIgPCBuMjsgKytyMikKICAgICAgICAgICAgaWYgKGUyLmNoYXJBdChyMikgPT09ICJcbiIpCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSwgaGFzU3BhY2VzOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGxldCBuMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzJdIDoge307CiAgICAgICAgICBjb25zdCByMiA9IFphKGUyLCBuMi5iYWNrd2FyZHMgPyB0MiAtIDEgOiB0MiwgbjIpOwogICAgICAgICAgcmV0dXJuIHIyICE9PSB0MjsKICAgICAgICB9LCBnZXRBbGlnbm1lbnRTaXplOiBjYywgZ2V0SW5kZW50U2l6ZTogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IGUyLmxhc3RJbmRleE9mKCJcbiIpOwogICAgICAgICAgcmV0dXJuIG4yID09PSAtMSA/IDAgOiBjYyhlMi5zbGljZShuMiArIDEpLm1hdGNoKC9eW1x0IF0qLylbMF0sIHQyKTsKICAgICAgICB9LCBnZXRQcmVmZXJyZWRRdW90ZTogbGMsIHByaW50U3RyaW5nOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gZTIuc2xpY2UoMSwgLTEpOwogICAgICAgICAgcmV0dXJuIHBjKG4yLCB0Mi5wYXJzZXIgPT09ICJqc29uIiB8fCB0Mi5wYXJzZXIgPT09ICJqc29uNSIgJiYgdDIucXVvdGVQcm9wcyA9PT0gInByZXNlcnZlIiAmJiAhdDIuc2luZ2xlUXVvdGUgPyAnIicgOiB0Mi5fX2lzSW5IdG1sQXR0cmlidXRlID8gIiciIDogbGMobjIsIHQyLnNpbmdsZVF1b3RlID8gIiciIDogJyInKS5xdW90ZSwgISh0Mi5wYXJzZXIgPT09ICJjc3MiIHx8IHQyLnBhcnNlciA9PT0gImxlc3MiIHx8IHQyLnBhcnNlciA9PT0gInNjc3MiIHx8IHQyLl9fZW1iZWRkZWRJbkh0bWwpKTsKICAgICAgICB9LCBwcmludE51bWJlcjogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL14oWystXT9bXGQuXStlKSg/OlwrfCgtKSk/MCooXGQpLywgIiQxJDIkMyIpLnJlcGxhY2UoL14oWystXT9bXGQuXSspZVsrLV0/MCskLywgIiQxIikucmVwbGFjZSgvXihbKy1dKT9cLi8sICIkMTAuIikucmVwbGFjZSgvKFwuXGQrPykwKyg/PWV8JCkvLCAiJDEiKS5yZXBsYWNlKC9cLig/PWV8JCkvLCAiIik7CiAgICAgICAgfSwgbWFrZVN0cmluZzogcGMsIGFkZExlYWRpbmdDb21tZW50OiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHQyLmxlYWRpbmcgPSB0cnVlLCB0Mi50cmFpbGluZyA9IGZhbHNlLCBmYyhlMiwgdDIpOwogICAgICAgIH0sIGFkZERhbmdsaW5nQ29tbWVudDogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgdDIubGVhZGluZyA9IGZhbHNlLCB0Mi50cmFpbGluZyA9IGZhbHNlLCBuMiAmJiAodDIubWFya2VyID0gbjIpLCBmYyhlMiwgdDIpOwogICAgICAgIH0sIGFkZFRyYWlsaW5nQ29tbWVudDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICB0Mi5sZWFkaW5nID0gZmFsc2UsIHQyLnRyYWlsaW5nID0gdHJ1ZSwgZmMoZTIsIHQyKTsKICAgICAgICB9LCBpc0Zyb250TWF0dGVyTm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMiAmJiBlMi50eXBlID09PSAiZnJvbnQtbWF0dGVyIjsKICAgICAgICB9LCBnZXRTaGViYW5nOiBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKCFlMi5zdGFydHNXaXRoKCIjISIpKQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICBjb25zdCB0MiA9IGUyLmluZGV4T2YoIlxuIik7CiAgICAgICAgICByZXR1cm4gdDIgPT09IC0xID8gZTIgOiBlMi5zbGljZSgwLCB0Mik7CiAgICAgICAgfSwgaXNOb25FbXB0eUFycmF5OiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoZTIpICYmIGUyLmxlbmd0aCA+IDA7CiAgICAgICAgfSwgY3JlYXRlR3JvdXBJZE1hcHBlcjogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24objIpIHsKICAgICAgICAgICAgcmV0dXJuIHQyLmhhcyhuMikgfHwgdDIuc2V0KG4yLCBTeW1ib2woZTIpKSwgdDIuZ2V0KG4yKTsKICAgICAgICAgIH07CiAgICAgICAgfSB9OwogICAgICAgIHZhciBoYyA9IHsgZ3Vlc3NFbmRPZkxpbmU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyLmluZGV4T2YoIlxyIik7CiAgICAgICAgICByZXR1cm4gdDIgPj0gMCA/IGUyLmNoYXJBdCh0MiArIDEpID09PSAiXG4iID8gImNybGYiIDogImNyIiA6ICJsZiI7CiAgICAgICAgfSwgY29udmVydEVuZE9mTGluZVRvQ2hhcnM6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBzd2l0Y2ggKGUyKSB7CiAgICAgICAgICAgIGNhc2UgImNyIjoKICAgICAgICAgICAgICByZXR1cm4gIlxyIjsKICAgICAgICAgICAgY2FzZSAiY3JsZiI6CiAgICAgICAgICAgICAgcmV0dXJuICJcclxuIjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXR1cm4gIlxuIjsKICAgICAgICAgIH0KICAgICAgICB9LCBjb3VudEVuZE9mTGluZUNoYXJzOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGxldCBuMjsKICAgICAgICAgIGlmICh0MiA9PT0gIlxuIikKICAgICAgICAgICAgbjIgPSAvXG4vZzsKICAgICAgICAgIGVsc2UgaWYgKHQyID09PSAiXHIiKQogICAgICAgICAgICBuMiA9IC9cci9nOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmICh0MiAhPT0gIlxyXG4iKQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCAiZW9sIiAnLmNvbmNhdChKU09OLnN0cmluZ2lmeSh0MiksICIuIikpOwogICAgICAgICAgICBuMiA9IC9cclxuL2c7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCByMiA9IGUyLm1hdGNoKG4yKTsKICAgICAgICAgIHJldHVybiByMiA/IHIyLmxlbmd0aCA6IDA7CiAgICAgICAgfSwgbm9ybWFsaXplRW5kT2ZMaW5lOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnJlcGxhY2UoL1xyXG4/L2csICJcbiIpOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCBnYyA9IGF1LCB7IGxpdGVyYWxsaW5lOiBtYywgam9pbjogeWMgfSA9IFppLCBEYyA9IChlMikgPT4gQXJyYXkuaXNBcnJheShlMikgfHwgZTIgJiYgZTIudHlwZSA9PT0gImNvbmNhdCIsIEVjID0gKGUyKSA9PiB7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShlMikpCiAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICAgIGlmIChlMi50eXBlICE9PSAiY29uY2F0IiAmJiBlMi50eXBlICE9PSAiZmlsbCIpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRXhwZWN0IGRvYyB0eXBlIHRvIGJlIGBjb25jYXRgIG9yIGBmaWxsYC4iKTsKICAgICAgICAgIHJldHVybiBlMi5wYXJ0czsKICAgICAgICB9LCBDYyA9IHt9OwogICAgICAgIGZ1bmN0aW9uIGJjKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICBjb25zdCBvMiA9IFtlMl07CiAgICAgICAgICBmb3IgKDsgbzIubGVuZ3RoID4gMDsgKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gbzIucG9wKCk7CiAgICAgICAgICAgIGlmIChlMyAhPT0gQ2MpIHsKICAgICAgICAgICAgICBpZiAobjIgJiYgbzIucHVzaChlMywgQ2MpLCAhdDIgfHwgdDIoZTMpICE9PSBmYWxzZSkKICAgICAgICAgICAgICAgIGlmIChEYyhlMykgfHwgZTMudHlwZSA9PT0gImZpbGwiKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gRWMoZTMpOwogICAgICAgICAgICAgICAgICBmb3IgKGxldCBlNCA9IHQzLmxlbmd0aCAtIDE7IGU0ID49IDA7IC0tZTQpCiAgICAgICAgICAgICAgICAgICAgbzIucHVzaCh0M1tlNF0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlMy50eXBlID09PSAiaWYtYnJlYWsiKQogICAgICAgICAgICAgICAgICBlMy5mbGF0Q29udGVudHMgJiYgbzIucHVzaChlMy5mbGF0Q29udGVudHMpLCBlMy5icmVha0NvbnRlbnRzICYmIG8yLnB1c2goZTMuYnJlYWtDb250ZW50cyk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChlMy50eXBlID09PSAiZ3JvdXAiICYmIGUzLmV4cGFuZGVkU3RhdGVzKQogICAgICAgICAgICAgICAgICBpZiAocjIpCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgdDMgPSBlMy5leHBhbmRlZFN0YXRlcy5sZW5ndGggLSAxOyB0MyA+PSAwOyAtLXQzKQogICAgICAgICAgICAgICAgICAgICAgbzIucHVzaChlMy5leHBhbmRlZFN0YXRlc1t0M10pOwogICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbzIucHVzaChlMy5jb250ZW50cyk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgIGUzLmNvbnRlbnRzICYmIG8yLnB1c2goZTMuY29udGVudHMpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBuMihvMi5wb3AoKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHZjKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwogICAgICAgICAgcmV0dXJuIHIyKGUyKTsKICAgICAgICAgIGZ1bmN0aW9uIHIyKGUzKSB7CiAgICAgICAgICAgIGlmIChuMi5oYXMoZTMpKQogICAgICAgICAgICAgIHJldHVybiBuMi5nZXQoZTMpOwogICAgICAgICAgICBjb25zdCBvMiA9IGZ1bmN0aW9uKGU0KSB7CiAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZTQpKQogICAgICAgICAgICAgICAgcmV0dXJuIHQyKGU0Lm1hcChyMikpOwogICAgICAgICAgICAgIGlmIChlNC50eXBlID09PSAiY29uY2F0IiB8fCBlNC50eXBlID09PSAiZmlsbCIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG4zID0gZTQucGFydHMubWFwKHIyKTsKICAgICAgICAgICAgICAgIHJldHVybiB0MihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGU0KSwge30sIHsgcGFydHM6IG4zIH0pKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGU0LnR5cGUgPT09ICJpZi1icmVhayIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG4zID0gZTQuYnJlYWtDb250ZW50cyAmJiByMihlNC5icmVha0NvbnRlbnRzKSwgbzMgPSBlNC5mbGF0Q29udGVudHMgJiYgcjIoZTQuZmxhdENvbnRlbnRzKTsKICAgICAgICAgICAgICAgIHJldHVybiB0MihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGU0KSwge30sIHsgYnJlYWtDb250ZW50czogbjMsIGZsYXRDb250ZW50czogbzMgfSkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoZTQudHlwZSA9PT0gImdyb3VwIiAmJiBlNC5leHBhbmRlZFN0YXRlcykgewogICAgICAgICAgICAgICAgY29uc3QgbjMgPSBlNC5leHBhbmRlZFN0YXRlcy5tYXAocjIpLCBvMyA9IG4zWzBdOwogICAgICAgICAgICAgICAgcmV0dXJuIHQyKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZTQpLCB7fSwgeyBjb250ZW50czogbzMsIGV4cGFuZGVkU3RhdGVzOiBuMyB9KSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChlNC5jb250ZW50cykgewogICAgICAgICAgICAgICAgY29uc3QgbjMgPSByMihlNC5jb250ZW50cyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdDIoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlNCksIHt9LCB7IGNvbnRlbnRzOiBuMyB9KSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB0MihlNCk7CiAgICAgICAgICAgIH0oZTMpOwogICAgICAgICAgICByZXR1cm4gbjIuc2V0KGUzLCBvMiksIG8yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBBYyhlMiwgdDIsIG4yKSB7CiAgICAgICAgICBsZXQgcjIgPSBuMiwgbzIgPSBmYWxzZTsKICAgICAgICAgIHJldHVybiBiYyhlMiwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgY29uc3QgbjMgPSB0MihlMyk7CiAgICAgICAgICAgIGlmIChuMyAhPT0gdm9pZCAwICYmIChvMiA9IHRydWUsIHIyID0gbjMpLCBvMikKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9KSwgcjI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEZjKGUyKSB7CiAgICAgICAgICByZXR1cm4gIShlMi50eXBlICE9PSAiZ3JvdXAiIHx8ICFlMi5icmVhaykgfHwgKCEoZTIudHlwZSAhPT0gImxpbmUiIHx8ICFlMi5oYXJkKSB8fCAoZTIudHlwZSA9PT0gImJyZWFrLXBhcmVudCIgfHwgdm9pZCAwKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHhjKGUyKSB7CiAgICAgICAgICBpZiAoZTIubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCB0MiA9IGdjKGUyKTsKICAgICAgICAgICAgdDIuZXhwYW5kZWRTdGF0ZXMgfHwgdDIuYnJlYWsgfHwgKHQyLmJyZWFrID0gInByb3BhZ2F0ZWQiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBTYyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgIT09ICJsaW5lIiB8fCBlMi5oYXJkID8gZTIudHlwZSA9PT0gImlmLWJyZWFrIiA/IGUyLmZsYXRDb250ZW50cyB8fCAiIiA6IGUyIDogZTIuc29mdCA/ICIiIDogIiAiOwogICAgICAgIH0KICAgICAgICBjb25zdCB3YyA9IChlMiwgdDIpID0+IGUyICYmIGUyLnR5cGUgPT09ICJsaW5lIiAmJiBlMi5oYXJkICYmIHQyICYmIHQyLnR5cGUgPT09ICJicmVhay1wYXJlbnQiOwogICAgICAgIGZ1bmN0aW9uIFRjKGUyKSB7CiAgICAgICAgICBpZiAoIWUyKQogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICBpZiAoRGMoZTIpIHx8IGUyLnR5cGUgPT09ICJmaWxsIikgewogICAgICAgICAgICBjb25zdCB0MiA9IEVjKGUyKTsKICAgICAgICAgICAgZm9yICg7IHQyLmxlbmd0aCA+IDEgJiYgd2MoLi4udDIuc2xpY2UoLTIpKTsgKQogICAgICAgICAgICAgIHQyLmxlbmd0aCAtPSAyOwogICAgICAgICAgICBpZiAodDIubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gVGMoZ2ModDIpKTsKICAgICAgICAgICAgICB0Mlt0Mi5sZW5ndGggLSAxXSA9IGUzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KGUyKSA/IHQyIDogT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlMiksIHt9LCB7IHBhcnRzOiB0MiB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHN3aXRjaCAoZTIudHlwZSkgewogICAgICAgICAgICBjYXNlICJhbGlnbiI6CiAgICAgICAgICAgIGNhc2UgImluZGVudCI6CiAgICAgICAgICAgIGNhc2UgImluZGVudC1pZi1icmVhayI6CiAgICAgICAgICAgIGNhc2UgImdyb3VwIjoKICAgICAgICAgICAgY2FzZSAibGluZS1zdWZmaXgiOgogICAgICAgICAgICBjYXNlICJsYWJlbCI6IHsKICAgICAgICAgICAgICBjb25zdCB0MiA9IFRjKGUyLmNvbnRlbnRzKTsKICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlMiksIHt9LCB7IGNvbnRlbnRzOiB0MiB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJpZi1icmVhayI6IHsKICAgICAgICAgICAgICBjb25zdCB0MiA9IFRjKGUyLmJyZWFrQ29udGVudHMpLCBuMiA9IFRjKGUyLmZsYXRDb250ZW50cyk7CiAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZTIpLCB7fSwgeyBicmVha0NvbnRlbnRzOiB0MiwgZmxhdENvbnRlbnRzOiBuMiB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBCYyhlMikgewogICAgICAgICAgcmV0dXJuIHZjKGUyLCAoZTMpID0+IGZ1bmN0aW9uKGU0KSB7CiAgICAgICAgICAgIHN3aXRjaCAoZTQudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgImZpbGwiOgogICAgICAgICAgICAgICAgaWYgKGU0LnBhcnRzLmV2ZXJ5KChlNSkgPT4gZTUgPT09ICIiKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiZ3JvdXAiOgogICAgICAgICAgICAgICAgaWYgKCEoZTQuY29udGVudHMgfHwgZTQuaWQgfHwgZTQuYnJlYWsgfHwgZTQuZXhwYW5kZWRTdGF0ZXMpKQogICAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgICAgICBpZiAoZTQuY29udGVudHMudHlwZSA9PT0gImdyb3VwIiAmJiBlNC5jb250ZW50cy5pZCA9PT0gZTQuaWQgJiYgZTQuY29udGVudHMuYnJlYWsgPT09IGU0LmJyZWFrICYmIGU0LmNvbnRlbnRzLmV4cGFuZGVkU3RhdGVzID09PSBlNC5leHBhbmRlZFN0YXRlcykKICAgICAgICAgICAgICAgICAgcmV0dXJuIGU0LmNvbnRlbnRzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiYWxpZ24iOgogICAgICAgICAgICAgIGNhc2UgImluZGVudCI6CiAgICAgICAgICAgICAgY2FzZSAiaW5kZW50LWlmLWJyZWFrIjoKICAgICAgICAgICAgICBjYXNlICJsaW5lLXN1ZmZpeCI6CiAgICAgICAgICAgICAgICBpZiAoIWU0LmNvbnRlbnRzKQogICAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJpZi1icmVhayI6CiAgICAgICAgICAgICAgICBpZiAoIWU0LmZsYXRDb250ZW50cyAmJiAhZTQuYnJlYWtDb250ZW50cykKICAgICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghRGMoZTQpKQogICAgICAgICAgICAgIHJldHVybiBlNDsKICAgICAgICAgICAgY29uc3QgdDIgPSBbXTsKICAgICAgICAgICAgZm9yIChjb25zdCBuMiBvZiBFYyhlNCkpIHsKICAgICAgICAgICAgICBpZiAoIW4yKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgY29uc3QgW2U1LCAuLi5yMl0gPSBEYyhuMikgPyBFYyhuMikgOiBbbjJdOwogICAgICAgICAgICAgIHR5cGVvZiBlNSA9PSAic3RyaW5nIiAmJiB0eXBlb2YgZ2ModDIpID09ICJzdHJpbmciID8gdDJbdDIubGVuZ3RoIC0gMV0gKz0gZTUgOiB0Mi5wdXNoKGU1KSwgdDIucHVzaCguLi5yMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHQyLmxlbmd0aCA9PT0gMCA/ICIiIDogdDIubGVuZ3RoID09PSAxID8gdDJbMF0gOiBBcnJheS5pc0FycmF5KGU0KSA/IHQyIDogT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlNCksIHt9LCB7IHBhcnRzOiB0MiB9KTsKICAgICAgICAgIH0oZTMpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gTmMoZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gW10sIG4yID0gZTIuZmlsdGVyKEJvb2xlYW4pOwogICAgICAgICAgZm9yICg7IG4yLmxlbmd0aCA+IDA7ICkgewogICAgICAgICAgICBjb25zdCBlMyA9IG4yLnNoaWZ0KCk7CiAgICAgICAgICAgIGUzICYmIChEYyhlMykgPyBuMi51bnNoaWZ0KC4uLkVjKGUzKSkgOiB0Mi5sZW5ndGggPiAwICYmIHR5cGVvZiBnYyh0MikgPT0gInN0cmluZyIgJiYgdHlwZW9mIGUzID09ICJzdHJpbmciID8gdDJbdDIubGVuZ3RoIC0gMV0gKz0gZTMgOiB0Mi5wdXNoKGUzKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGtjKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IG1jOwogICAgICAgICAgcmV0dXJuIHljKHQyLCBlMi5zcGxpdCgiXG4iKSkucGFydHM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFBjKGUyKSB7CiAgICAgICAgICBpZiAoZTIudHlwZSA9PT0gImxpbmUiKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgdmFyIE9jID0geyBpc0NvbmNhdDogRGMsIGdldERvY1BhcnRzOiBFYywgd2lsbEJyZWFrOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIEFjKGUyLCBGYywgZmFsc2UpOwogICAgICAgIH0sIHRyYXZlcnNlRG9jOiBiYywgZmluZEluRG9jOiBBYywgbWFwRG9jOiB2YywgcHJvcGFnYXRlQnJlYWtzOiBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCBuMiA9IFtdOwogICAgICAgICAgYmMoZTIsIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGlmIChlMy50eXBlID09PSAiYnJlYWstcGFyZW50IiAmJiB4YyhuMiksIGUzLnR5cGUgPT09ICJncm91cCIpIHsKICAgICAgICAgICAgICBpZiAobjIucHVzaChlMyksIHQyLmhhcyhlMykpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgdDIuYWRkKGUzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgaWYgKGUzLnR5cGUgPT09ICJncm91cCIpIHsKICAgICAgICAgICAgICBuMi5wb3AoKS5icmVhayAmJiB4YyhuMik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHRydWUpOwogICAgICAgIH0sIHJlbW92ZUxpbmVzOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIHZjKGUyLCBTYyk7CiAgICAgICAgfSwgc3RyaXBUcmFpbGluZ0hhcmRsaW5lOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFRjKEJjKGUyKSk7CiAgICAgICAgfSwgbm9ybWFsaXplUGFydHM6IE5jLCBub3JtYWxpemVEb2M6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gdmMoZTIsIChlMykgPT4gQXJyYXkuaXNBcnJheShlMykgPyBOYyhlMykgOiBlMy5wYXJ0cyA/IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZTMpLCB7fSwgeyBwYXJ0czogTmMoZTMucGFydHMpIH0pIDogZTMpOwogICAgICAgIH0sIGNsZWFuRG9jOiBCYywgcmVwbGFjZVRleHRFbmRPZkxpbmU6IGtjLCByZXBsYWNlRW5kT2ZMaW5lOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIHZjKGUyLCAoZTMpID0+IHR5cGVvZiBlMyA9PSAic3RyaW5nIiAmJiBlMy5pbmNsdWRlcygiXG4iKSA/IGtjKGUzKSA6IGUzKTsKICAgICAgICB9LCBjYW5CcmVhazogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBBYyhlMiwgUGMsIGZhbHNlKTsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgeyBnZXRTdHJpbmdXaWR0aDogSWMsIGdldExhc3Q6IExjIH0gPSBkYywgeyBjb252ZXJ0RW5kT2ZMaW5lVG9DaGFyczogamMgfSA9IGhjLCB7IGZpbGw6IF9jLCBjdXJzb3I6IE1jLCBpbmRlbnQ6IFJjIH0gPSBaaSwgeyBpc0NvbmNhdDogVmMsIGdldERvY1BhcnRzOiAkYyB9ID0gT2M7CiAgICAgICAgbGV0IFdjOwogICAgICAgIGZ1bmN0aW9uIHFjKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHpjKGUyLCB7IHR5cGU6ICJpbmRlbnQiIH0sIHQyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVWMoZTIsIHQyLCBuMikgewogICAgICAgICAgaWYgKHQyID09PSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkpCiAgICAgICAgICAgIHJldHVybiBlMi5yb290IHx8IHsgdmFsdWU6ICIiLCBsZW5ndGg6IDAsIHF1ZXVlOiBbXSB9OwogICAgICAgICAgaWYgKHQyIDwgMCkKICAgICAgICAgICAgcmV0dXJuIHpjKGUyLCB7IHR5cGU6ICJkZWRlbnQiIH0sIG4yKTsKICAgICAgICAgIGlmICghdDIpCiAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICAgIGlmICh0Mi50eXBlID09PSAicm9vdCIpCiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGUyKSwge30sIHsgcm9vdDogZTIgfSk7CiAgICAgICAgICByZXR1cm4gemMoZTIsIHsgdHlwZTogdHlwZW9mIHQyID09ICJzdHJpbmciID8gInN0cmluZ0FsaWduIiA6ICJudW1iZXJBbGlnbiIsIG46IHQyIH0sIG4yKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gemMoZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSB0Mi50eXBlID09PSAiZGVkZW50IiA/IGUyLnF1ZXVlLnNsaWNlKDAsIC0xKSA6IFsuLi5lMi5xdWV1ZSwgdDJdOwogICAgICAgICAgbGV0IG8yID0gIiIsIGkyID0gMCwgdTIgPSAwLCBzMiA9IDA7CiAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIHIyKQogICAgICAgICAgICBzd2l0Y2ggKGUzLnR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICJpbmRlbnQiOgogICAgICAgICAgICAgICAgbDIoKSwgbjIudXNlVGFicyA/IGEyKDEpIDogYzIobjIudGFiV2lkdGgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAic3RyaW5nQWxpZ24iOgogICAgICAgICAgICAgICAgbDIoKSwgbzIgKz0gZTMubiwgaTIgKz0gZTMubi5sZW5ndGg7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJudW1iZXJBbGlnbiI6CiAgICAgICAgICAgICAgICB1MiArPSAxLCBzMiArPSBlMy5uOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCB0eXBlICciLmNvbmNhdChlMy50eXBlLCAiJyIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHAyKCksIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZTIpLCB7fSwgeyB2YWx1ZTogbzIsIGxlbmd0aDogaTIsIHF1ZXVlOiByMiB9KTsKICAgICAgICAgIGZ1bmN0aW9uIGEyKGUzKSB7CiAgICAgICAgICAgIG8yICs9ICIJIi5yZXBlYXQoZTMpLCBpMiArPSBuMi50YWJXaWR0aCAqIGUzOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gYzIoZTMpIHsKICAgICAgICAgICAgbzIgKz0gIiAiLnJlcGVhdChlMyksIGkyICs9IGUzOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gbDIoKSB7CiAgICAgICAgICAgIG4yLnVzZVRhYnMgPyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB1MiA+IDAgJiYgYTIodTIpOwogICAgICAgICAgICAgIGYyKCk7CiAgICAgICAgICAgIH0oKSA6IHAyKCk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBwMigpIHsKICAgICAgICAgICAgczIgPiAwICYmIGMyKHMyKSwgZjIoKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGYyKCkgewogICAgICAgICAgICB1MiA9IDAsIHMyID0gMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gR2MoZTIpIHsKICAgICAgICAgIGlmIChlMi5sZW5ndGggPT09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgbGV0IHQyID0gMDsKICAgICAgICAgIGZvciAoOyBlMi5sZW5ndGggPiAwICYmIHR5cGVvZiBMYyhlMikgPT0gInN0cmluZyIgJiYgL15bXHQgXSokLy50ZXN0KExjKGUyKSk7ICkKICAgICAgICAgICAgdDIgKz0gZTIucG9wKCkubGVuZ3RoOwogICAgICAgICAgaWYgKGUyLmxlbmd0aCA+IDAgJiYgdHlwZW9mIExjKGUyKSA9PSAic3RyaW5nIikgewogICAgICAgICAgICBjb25zdCBuMiA9IExjKGUyKS5yZXBsYWNlKC9bXHQgXSokLywgIiIpOwogICAgICAgICAgICB0MiArPSBMYyhlMikubGVuZ3RoIC0gbjIubGVuZ3RoLCBlMltlMi5sZW5ndGggLSAxXSA9IG4yOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBIYyhlMiwgdDIsIG4yLCByMiwgbzIsIGkyKSB7CiAgICAgICAgICBsZXQgdTIgPSB0Mi5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzMiA9IFtlMl0sIGEyID0gW107CiAgICAgICAgICBmb3IgKDsgbjIgPj0gMDsgKSB7CiAgICAgICAgICAgIGlmIChzMi5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICBpZiAodTIgPT09IDApCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICBzMi5wdXNoKHQyW3UyIC0gMV0pLCB1Mi0tOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IFtlMywgYzIsIGwyXSA9IHMyLnBvcCgpOwogICAgICAgICAgICBpZiAodHlwZW9mIGwyID09ICJzdHJpbmciKQogICAgICAgICAgICAgIGEyLnB1c2gobDIpLCBuMiAtPSBJYyhsMik7CiAgICAgICAgICAgIGVsc2UgaWYgKFZjKGwyKSkgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gJGMobDIpOwogICAgICAgICAgICAgIGZvciAobGV0IG4zID0gdDMubGVuZ3RoIC0gMTsgbjMgPj0gMDsgbjMtLSkKICAgICAgICAgICAgICAgIHMyLnB1c2goW2UzLCBjMiwgdDNbbjNdXSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIHN3aXRjaCAobDIudHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAiaW5kZW50IjoKICAgICAgICAgICAgICAgICAgczIucHVzaChbcWMoZTMsIHIyKSwgYzIsIGwyLmNvbnRlbnRzXSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiYWxpZ24iOgogICAgICAgICAgICAgICAgICBzMi5wdXNoKFtVYyhlMywgbDIubiwgcjIpLCBjMiwgbDIuY29udGVudHNdKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJ0cmltIjoKICAgICAgICAgICAgICAgICAgbjIgKz0gR2MoYTIpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImdyb3VwIjogewogICAgICAgICAgICAgICAgICBpZiAoaTIgJiYgbDIuYnJlYWspCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICBjb25zdCB0MyA9IGwyLmJyZWFrID8gMSA6IGMyOwogICAgICAgICAgICAgICAgICBzMi5wdXNoKFtlMywgdDMsIGwyLmV4cGFuZGVkU3RhdGVzICYmIHQzID09PSAxID8gTGMobDIuZXhwYW5kZWRTdGF0ZXMpIDogbDIuY29udGVudHNdKSwgbDIuaWQgJiYgKFdjW2wyLmlkXSA9IHQzKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXNlICJmaWxsIjoKICAgICAgICAgICAgICAgICAgZm9yIChsZXQgdDMgPSBsMi5wYXJ0cy5sZW5ndGggLSAxOyB0MyA+PSAwOyB0My0tKQogICAgICAgICAgICAgICAgICAgIHMyLnB1c2goW2UzLCBjMiwgbDIucGFydHNbdDNdXSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiaWYtYnJlYWsiOgogICAgICAgICAgICAgICAgY2FzZSAiaW5kZW50LWlmLWJyZWFrIjogewogICAgICAgICAgICAgICAgICBjb25zdCB0MyA9IGwyLmdyb3VwSWQgPyBXY1tsMi5ncm91cElkXSA6IGMyOwogICAgICAgICAgICAgICAgICBpZiAodDMgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0NCA9IGwyLnR5cGUgPT09ICJpZi1icmVhayIgPyBsMi5icmVha0NvbnRlbnRzIDogbDIubmVnYXRlID8gbDIuY29udGVudHMgOiBSYyhsMi5jb250ZW50cyk7CiAgICAgICAgICAgICAgICAgICAgdDQgJiYgczIucHVzaChbZTMsIGMyLCB0NF0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmICh0MyA9PT0gMikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHQ0ID0gbDIudHlwZSA9PT0gImlmLWJyZWFrIiA/IGwyLmZsYXRDb250ZW50cyA6IGwyLm5lZ2F0ZSA/IFJjKGwyLmNvbnRlbnRzKSA6IGwyLmNvbnRlbnRzOwogICAgICAgICAgICAgICAgICAgIHQ0ICYmIHMyLnB1c2goW2UzLCBjMiwgdDRdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgImxpbmUiOgogICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMyKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgaWYgKCFsMi5oYXJkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGwyLnNvZnQgfHwgKGEyLnB1c2goIiAiKSwgbjIgLT0gMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJsaW5lLXN1ZmZpeCI6CiAgICAgICAgICAgICAgICAgIG8yID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJsaW5lLXN1ZmZpeC1ib3VuZGFyeSI6CiAgICAgICAgICAgICAgICAgIGlmIChvMikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAibGFiZWwiOgogICAgICAgICAgICAgICAgICBzMi5wdXNoKFtlMywgYzIsIGwyLmNvbnRlbnRzXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgSmMgPSB7IHByaW50RG9jVG9TdHJpbmc6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgV2MgPSB7fTsKICAgICAgICAgIGNvbnN0IG4yID0gdDIucHJpbnRXaWR0aCwgcjIgPSBqYyh0Mi5lbmRPZkxpbmUpOwogICAgICAgICAgbGV0IG8yID0gMDsKICAgICAgICAgIGNvbnN0IGkyID0gW1t7IHZhbHVlOiAiIiwgbGVuZ3RoOiAwLCBxdWV1ZTogW10gfSwgMSwgZTJdXSwgdTIgPSBbXTsKICAgICAgICAgIGxldCBzMiA9IGZhbHNlLCBhMiA9IFtdOwogICAgICAgICAgZm9yICg7IGkyLmxlbmd0aCA+IDA7ICkgewogICAgICAgICAgICBjb25zdCBbZTMsIGMzLCBsMl0gPSBpMi5wb3AoKTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBsMiA9PSAic3RyaW5nIikgewogICAgICAgICAgICAgIGNvbnN0IGU0ID0gcjIgIT09ICJcbiIgPyBsMi5yZXBsYWNlKC9cbi9nLCByMikgOiBsMjsKICAgICAgICAgICAgICB1Mi5wdXNoKGU0KSwgbzIgKz0gSWMoZTQpOwogICAgICAgICAgICB9IGVsc2UgaWYgKFZjKGwyKSkgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gJGMobDIpOwogICAgICAgICAgICAgIGZvciAobGV0IG4zID0gdDMubGVuZ3RoIC0gMTsgbjMgPj0gMDsgbjMtLSkKICAgICAgICAgICAgICAgIGkyLnB1c2goW2UzLCBjMywgdDNbbjNdXSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIHN3aXRjaCAobDIudHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAiY3Vyc29yIjoKICAgICAgICAgICAgICAgICAgdTIucHVzaChNYy5wbGFjZWhvbGRlcik7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiaW5kZW50IjoKICAgICAgICAgICAgICAgICAgaTIucHVzaChbcWMoZTMsIHQyKSwgYzMsIGwyLmNvbnRlbnRzXSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiYWxpZ24iOgogICAgICAgICAgICAgICAgICBpMi5wdXNoKFtVYyhlMywgbDIubiwgdDIpLCBjMywgbDIuY29udGVudHNdKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJ0cmltIjoKICAgICAgICAgICAgICAgICAgbzIgLT0gR2ModTIpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImdyb3VwIjoKICAgICAgICAgICAgICAgICAgc3dpdGNoIChjMykgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgIGlmICghczIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaTIucHVzaChbZTMsIGwyLmJyZWFrID8gMSA6IDIsIGwyLmNvbnRlbnRzXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgMTogewogICAgICAgICAgICAgICAgICAgICAgczIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHIzID0gW2UzLCAyLCBsMi5jb250ZW50c10sIHUzID0gbjIgLSBvMiwgYzQgPSBhMi5sZW5ndGggPiAwOwogICAgICAgICAgICAgICAgICAgICAgaWYgKCFsMi5icmVhayAmJiBIYyhyMywgaTIsIHUzLCB0MiwgYzQpKQogICAgICAgICAgICAgICAgICAgICAgICBpMi5wdXNoKHIzKTsKICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGwyLmV4cGFuZGVkU3RhdGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG4zID0gTGMobDIuZXhwYW5kZWRTdGF0ZXMpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobDIuYnJlYWspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpMi5wdXNoKFtlMywgMSwgbjNdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCByNCA9IDE7IHI0IDwgbDIuZXhwYW5kZWRTdGF0ZXMubGVuZ3RoICsgMTsgcjQrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyNCA+PSBsMi5leHBhbmRlZFN0YXRlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkyLnB1c2goW2UzLCAxLCBuM10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG40ID0gW2UzLCAyLCBsMi5leHBhbmRlZFN0YXRlc1tyNF1dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEhjKG40LCBpMiwgdTMsIHQyLCBjNCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaTIucHVzaChuNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGkyLnB1c2goW2UzLCAxLCBsMi5jb250ZW50c10pOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGwyLmlkICYmIChXY1tsMi5pZF0gPSBMYyhpMilbMV0pOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImZpbGwiOiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHIzID0gbjIgLSBvMiwgeyBwYXJ0czogdTMgfSA9IGwyOwogICAgICAgICAgICAgICAgICBpZiAodTMubGVuZ3RoID09PSAwKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjb25zdCBbczMsIHAyXSA9IHUzLCBmMiA9IFtlMywgMiwgczNdLCBkMiA9IFtlMywgMSwgczNdLCBoMiA9IEhjKGYyLCBbXSwgcjMsIHQyLCBhMi5sZW5ndGggPiAwLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgaWYgKHUzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIGgyID8gaTIucHVzaChmMikgOiBpMi5wdXNoKGQyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBjb25zdCBnMiA9IFtlMywgMiwgcDJdLCBtMiA9IFtlMywgMSwgcDJdOwogICAgICAgICAgICAgICAgICBpZiAodTMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgaDIgPyBpMi5wdXNoKGcyLCBmMikgOiBpMi5wdXNoKG0yLCBkMik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdTMuc3BsaWNlKDAsIDIpOwogICAgICAgICAgICAgICAgICBjb25zdCB5MiA9IFtlMywgYzMsIF9jKHUzKV07CiAgICAgICAgICAgICAgICAgIEhjKFtlMywgMiwgW3MzLCBwMiwgdTNbMF1dXSwgW10sIHIzLCB0MiwgYTIubGVuZ3RoID4gMCwgdHJ1ZSkgPyBpMi5wdXNoKHkyLCBnMiwgZjIpIDogaDIgPyBpMi5wdXNoKHkyLCBtMiwgZjIpIDogaTIucHVzaCh5MiwgbTIsIGQyKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXNlICJpZi1icmVhayI6CiAgICAgICAgICAgICAgICBjYXNlICJpbmRlbnQtaWYtYnJlYWsiOiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gbDIuZ3JvdXBJZCA/IFdjW2wyLmdyb3VwSWRdIDogYzM7CiAgICAgICAgICAgICAgICAgIGlmICh0MyA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHQ0ID0gbDIudHlwZSA9PT0gImlmLWJyZWFrIiA/IGwyLmJyZWFrQ29udGVudHMgOiBsMi5uZWdhdGUgPyBsMi5jb250ZW50cyA6IFJjKGwyLmNvbnRlbnRzKTsKICAgICAgICAgICAgICAgICAgICB0NCAmJiBpMi5wdXNoKFtlMywgYzMsIHQ0XSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKHQzID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdDQgPSBsMi50eXBlID09PSAiaWYtYnJlYWsiID8gbDIuZmxhdENvbnRlbnRzIDogbDIubmVnYXRlID8gUmMobDIuY29udGVudHMpIDogbDIuY29udGVudHM7CiAgICAgICAgICAgICAgICAgICAgdDQgJiYgaTIucHVzaChbZTMsIGMzLCB0NF0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAibGluZS1zdWZmaXgiOgogICAgICAgICAgICAgICAgICBhMi5wdXNoKFtlMywgYzMsIGwyLmNvbnRlbnRzXSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAibGluZS1zdWZmaXgtYm91bmRhcnkiOgogICAgICAgICAgICAgICAgICBhMi5sZW5ndGggPiAwICYmIGkyLnB1c2goW2UzLCBjMywgeyB0eXBlOiAibGluZSIsIGhhcmQ6IHRydWUgfV0pOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImxpbmUiOgogICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMzKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgaWYgKCFsMi5oYXJkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGwyLnNvZnQgfHwgKHUyLnB1c2goIiAiKSwgbzIgKz0gMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgczIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgIGlmIChhMi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGkyLnB1c2goW2UzLCBjMywgbDJdLCAuLi5hMi5yZXZlcnNlKCkpLCBhMiA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGwyLmxpdGVyYWwgPyBlMy5yb290ID8gKHUyLnB1c2gocjIsIGUzLnJvb3QudmFsdWUpLCBvMiA9IGUzLnJvb3QubGVuZ3RoKSA6ICh1Mi5wdXNoKHIyKSwgbzIgPSAwKSA6IChvMiAtPSBHYyh1MiksIHUyLnB1c2gocjIgKyBlMy52YWx1ZSksIG8yID0gZTMubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImxhYmVsIjoKICAgICAgICAgICAgICAgICAgaTIucHVzaChbZTMsIGMzLCBsMi5jb250ZW50c10pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgaTIubGVuZ3RoID09PSAwICYmIGEyLmxlbmd0aCA+IDAgJiYgKGkyLnB1c2goLi4uYTIucmV2ZXJzZSgpKSwgYTIgPSBbXSk7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBjMiA9IHUyLmluZGV4T2YoTWMucGxhY2Vob2xkZXIpOwogICAgICAgICAgaWYgKGMyICE9PSAtMSkgewogICAgICAgICAgICBjb25zdCBlMyA9IHUyLmluZGV4T2YoTWMucGxhY2Vob2xkZXIsIGMyICsgMSksIHQzID0gdTIuc2xpY2UoMCwgYzIpLmpvaW4oIiIpLCBuMyA9IHUyLnNsaWNlKGMyICsgMSwgZTMpLmpvaW4oIiIpOwogICAgICAgICAgICByZXR1cm4geyBmb3JtYXR0ZWQ6IHQzICsgbjMgKyB1Mi5zbGljZShlMyArIDEpLmpvaW4oIiIpLCBjdXJzb3JOb2RlU3RhcnQ6IHQzLmxlbmd0aCwgY3Vyc29yTm9kZVRleHQ6IG4zIH07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4geyBmb3JtYXR0ZWQ6IHUyLmpvaW4oIiIpIH07CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IHsgaXNDb25jYXQ6IFhjLCBnZXREb2NQYXJ0czogWWMgfSA9IE9jOwogICAgICAgIGZ1bmN0aW9uIEtjKGUyKSB7CiAgICAgICAgICBpZiAoIWUyKQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICBpZiAoWGMoZTIpKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gW107CiAgICAgICAgICAgIGZvciAoY29uc3QgbjIgb2YgWWMoZTIpKQogICAgICAgICAgICAgIGlmIChYYyhuMikpCiAgICAgICAgICAgICAgICB0Mi5wdXNoKC4uLktjKG4yKS5wYXJ0cyk7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBlMyA9IEtjKG4yKTsKICAgICAgICAgICAgICAgIGUzICE9PSAiIiAmJiB0Mi5wdXNoKGUzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7IHR5cGU6ICJjb25jYXQiLCBwYXJ0czogdDIgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAiaWYtYnJlYWsiID8gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlMiksIHt9LCB7IGJyZWFrQ29udGVudHM6IEtjKGUyLmJyZWFrQ29udGVudHMpLCBmbGF0Q29udGVudHM6IEtjKGUyLmZsYXRDb250ZW50cykgfSkgOiBlMi50eXBlID09PSAiZ3JvdXAiID8gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlMiksIHt9LCB7IGNvbnRlbnRzOiBLYyhlMi5jb250ZW50cyksIGV4cGFuZGVkU3RhdGVzOiBlMi5leHBhbmRlZFN0YXRlcyAmJiBlMi5leHBhbmRlZFN0YXRlcy5tYXAoS2MpIH0pIDogZTIudHlwZSA9PT0gImZpbGwiID8geyB0eXBlOiAiZmlsbCIsIHBhcnRzOiBlMi5wYXJ0cy5tYXAoS2MpIH0gOiBlMi5jb250ZW50cyA/IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZTIpLCB7fSwgeyBjb250ZW50czogS2MoZTIuY29udGVudHMpIH0pIDogZTI7CiAgICAgICAgfQogICAgICAgIHZhciBRYyA9IHsgcHJpbnREb2NUb0RlYnVnOiBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKSwgbjIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGUzKHQzLCBuMywgbzIpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB0MyA9PSAic3RyaW5nIikKICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodDMpOwogICAgICAgICAgICBpZiAoWGModDMpKSB7CiAgICAgICAgICAgICAgY29uc3QgbjQgPSBZYyh0MykubWFwKGUzKS5maWx0ZXIoQm9vbGVhbik7CiAgICAgICAgICAgICAgcmV0dXJuIG40Lmxlbmd0aCA9PT0gMSA/IG40WzBdIDogIlsiLmNvbmNhdChuNC5qb2luKCIsICIpLCAiXSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0My50eXBlID09PSAibGluZSIpIHsKICAgICAgICAgICAgICBjb25zdCBlNCA9IEFycmF5LmlzQXJyYXkobzIpICYmIG8yW24zICsgMV0gJiYgbzJbbjMgKyAxXS50eXBlID09PSAiYnJlYWstcGFyZW50IjsKICAgICAgICAgICAgICByZXR1cm4gdDMubGl0ZXJhbCA/IGU0ID8gImxpdGVyYWxsaW5lIiA6ICJsaXRlcmFsbGluZVdpdGhvdXRCcmVha1BhcmVudCIgOiB0My5oYXJkID8gZTQgPyAiaGFyZGxpbmUiIDogImhhcmRsaW5lV2l0aG91dEJyZWFrUGFyZW50IiA6IHQzLnNvZnQgPyAic29mdGxpbmUiIDogImxpbmUiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0My50eXBlID09PSAiYnJlYWstcGFyZW50IikgewogICAgICAgICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KG8yKSAmJiBvMltuMyAtIDFdICYmIG8yW24zIC0gMV0udHlwZSA9PT0gImxpbmUiICYmIG8yW24zIC0gMV0uaGFyZCA/IHZvaWQgMCA6ICJicmVha1BhcmVudCI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJ0cmltIikKICAgICAgICAgICAgICByZXR1cm4gInRyaW0iOwogICAgICAgICAgICBpZiAodDMudHlwZSA9PT0gImluZGVudCIpCiAgICAgICAgICAgICAgcmV0dXJuICJpbmRlbnQoIiArIGUzKHQzLmNvbnRlbnRzKSArICIpIjsKICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJhbGlnbiIpCiAgICAgICAgICAgICAgcmV0dXJuIHQzLm4gPT09IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSA/ICJkZWRlbnRUb1Jvb3QoIiArIGUzKHQzLmNvbnRlbnRzKSArICIpIiA6IHQzLm4gPCAwID8gImRlZGVudCgiICsgZTModDMuY29udGVudHMpICsgIikiIDogdDMubi50eXBlID09PSAicm9vdCIgPyAibWFya0FzUm9vdCgiICsgZTModDMuY29udGVudHMpICsgIikiIDogImFsaWduKCIgKyBKU09OLnN0cmluZ2lmeSh0My5uKSArICIsICIgKyBlMyh0My5jb250ZW50cykgKyAiKSI7CiAgICAgICAgICAgIGlmICh0My50eXBlID09PSAiaWYtYnJlYWsiKQogICAgICAgICAgICAgIHJldHVybiAiaWZCcmVhaygiICsgZTModDMuYnJlYWtDb250ZW50cykgKyAodDMuZmxhdENvbnRlbnRzID8gIiwgIiArIGUzKHQzLmZsYXRDb250ZW50cykgOiAiIikgKyAodDMuZ3JvdXBJZCA/ICh0My5mbGF0Q29udGVudHMgPyAiIiA6ICcsICIiJykgKyAiLCB7IGdyb3VwSWQ6ICIuY29uY2F0KHIyKHQzLmdyb3VwSWQpLCAiIH0iKSA6ICIiKSArICIpIjsKICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJpbmRlbnQtaWYtYnJlYWsiKSB7CiAgICAgICAgICAgICAgY29uc3QgbjQgPSBbXTsKICAgICAgICAgICAgICB0My5uZWdhdGUgJiYgbjQucHVzaCgibmVnYXRlOiB0cnVlIiksIHQzLmdyb3VwSWQgJiYgbjQucHVzaCgiZ3JvdXBJZDogIi5jb25jYXQocjIodDMuZ3JvdXBJZCkpKTsKICAgICAgICAgICAgICBjb25zdCBvMyA9IG40Lmxlbmd0aCA+IDAgPyAiLCB7ICIuY29uY2F0KG40LmpvaW4oIiwgIiksICIgfSIpIDogIiI7CiAgICAgICAgICAgICAgcmV0dXJuICJpbmRlbnRJZkJyZWFrKCIuY29uY2F0KGUzKHQzLmNvbnRlbnRzKSkuY29uY2F0KG8zLCAiKSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0My50eXBlID09PSAiZ3JvdXAiKSB7CiAgICAgICAgICAgICAgY29uc3QgbjQgPSBbXTsKICAgICAgICAgICAgICB0My5icmVhayAmJiB0My5icmVhayAhPT0gInByb3BhZ2F0ZWQiICYmIG40LnB1c2goInNob3VsZEJyZWFrOiB0cnVlIiksIHQzLmlkICYmIG40LnB1c2goImlkOiAiLmNvbmNhdChyMih0My5pZCkpKTsKICAgICAgICAgICAgICBjb25zdCBvMyA9IG40Lmxlbmd0aCA+IDAgPyAiLCB7ICIuY29uY2F0KG40LmpvaW4oIiwgIiksICIgfSIpIDogIiI7CiAgICAgICAgICAgICAgcmV0dXJuIHQzLmV4cGFuZGVkU3RhdGVzID8gImNvbmRpdGlvbmFsR3JvdXAoWyIuY29uY2F0KHQzLmV4cGFuZGVkU3RhdGVzLm1hcCgodDQpID0+IGUzKHQ0KSkuam9pbigiLCIpLCAiXSIpLmNvbmNhdChvMywgIikiKSA6ICJncm91cCgiLmNvbmNhdChlMyh0My5jb250ZW50cykpLmNvbmNhdChvMywgIikiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodDMudHlwZSA9PT0gImZpbGwiKQogICAgICAgICAgICAgIHJldHVybiAiZmlsbChbIi5jb25jYXQodDMucGFydHMubWFwKCh0NCkgPT4gZTModDQpKS5qb2luKCIsICIpLCAiXSkiKTsKICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJsaW5lLXN1ZmZpeCIpCiAgICAgICAgICAgICAgcmV0dXJuICJsaW5lU3VmZml4KCIgKyBlMyh0My5jb250ZW50cykgKyAiKSI7CiAgICAgICAgICAgIGlmICh0My50eXBlID09PSAibGluZS1zdWZmaXgtYm91bmRhcnkiKQogICAgICAgICAgICAgIHJldHVybiAibGluZVN1ZmZpeEJvdW5kYXJ5IjsKICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJsYWJlbCIpCiAgICAgICAgICAgICAgcmV0dXJuICJsYWJlbCgiLmNvbmNhdChKU09OLnN0cmluZ2lmeSh0My5sYWJlbCksICIsICIpLmNvbmNhdChlMyh0My5jb250ZW50cyksICIpIik7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBkb2MgdHlwZSAiICsgdDMudHlwZSk7CiAgICAgICAgICB9KEtjKGUyKSk7CiAgICAgICAgICBmdW5jdGlvbiByMihlMykgewogICAgICAgICAgICBpZiAodHlwZW9mIGUzICE9ICJzeW1ib2wiKQogICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShTdHJpbmcoZTMpKTsKICAgICAgICAgICAgaWYgKGUzIGluIHQyKQogICAgICAgICAgICAgIHJldHVybiB0MltlM107CiAgICAgICAgICAgIGNvbnN0IHIzID0gU3RyaW5nKGUzKS5zbGljZSg3LCAtMSkgfHwgInN5bWJvbCI7CiAgICAgICAgICAgIGZvciAobGV0IG8yID0gMDsgOyBvMisrKSB7CiAgICAgICAgICAgICAgY29uc3QgaTIgPSByMyArIChvMiA+IDAgPyAiICMiLmNvbmNhdChvMikgOiAiIik7CiAgICAgICAgICAgICAgaWYgKCFuMi5oYXMoaTIpKQogICAgICAgICAgICAgICAgcmV0dXJuIG4yLmFkZChpMiksIHQyW2UzXSA9ICJTeW1ib2wuZm9yKCIuY29uY2F0KEpTT04uc3RyaW5naWZ5KGkyKSwgIikiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gfSwgWmMgPSB7IGJ1aWxkZXJzOiBaaSwgcHJpbnRlcjogSmMsIHV0aWxzOiBPYywgZGVidWc6IFFjIH0sIGVsID0gdChPYmplY3QuZnJlZXplKHsgX19wcm90b19fOiBudWxsLCBkZWZhdWx0OiB7fSB9KSk7CiAgICAgICAgZnVuY3Rpb24gdGwoZTIsIHQyKSB7CiAgICAgICAgICBmb3IgKHZhciBuMiA9IDAsIHIyID0gZTIubGVuZ3RoIC0gMTsgcjIgPj0gMDsgcjItLSkgewogICAgICAgICAgICB2YXIgbzIgPSBlMltyMl07CiAgICAgICAgICAgIG8yID09PSAiLiIgPyBlMi5zcGxpY2UocjIsIDEpIDogbzIgPT09ICIuLiIgPyAoZTIuc3BsaWNlKHIyLCAxKSwgbjIrKykgOiBuMiAmJiAoZTIuc3BsaWNlKHIyLCAxKSwgbjItLSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodDIpCiAgICAgICAgICAgIGZvciAoOyBuMi0tOyBuMikKICAgICAgICAgICAgICBlMi51bnNoaWZ0KCIuLiIpOwogICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgIH0KICAgICAgICB2YXIgbmwgPSAvXihcLz98KShbXHNcU10qPykoKD86XC57MSwyfXxbXlwvXSs/fCkoXC5bXi5cL10qfCkpKD86W1wvXSopJC8sIHJsID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBubC5leGVjKGUyKS5zbGljZSgxKTsKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIG9sKCkgewogICAgICAgICAgZm9yICh2YXIgZTIgPSAiIiwgdDIgPSBmYWxzZSwgbjIgPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsgbjIgPj0gLTEgJiYgIXQyOyBuMi0tKSB7CiAgICAgICAgICAgIHZhciByMiA9IG4yID49IDAgPyBhcmd1bWVudHNbbjJdIDogIi8iOwogICAgICAgICAgICBpZiAodHlwZW9mIHIyICE9ICJzdHJpbmciKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkFyZ3VtZW50cyB0byBwYXRoLnJlc29sdmUgbXVzdCBiZSBzdHJpbmdzIik7CiAgICAgICAgICAgIHIyICYmIChlMiA9IHIyICsgIi8iICsgZTIsIHQyID0gcjIuY2hhckF0KDApID09PSAiLyIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUyID0gdGwoZGwoZTIuc3BsaXQoIi8iKSwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuICEhZTM7CiAgICAgICAgICB9KSwgIXQyKS5qb2luKCIvIiksICh0MiA/ICIvIiA6ICIiKSArIGUyIHx8ICIuIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaWwoZTIpIHsKICAgICAgICAgIHZhciB0MiA9IHVsKGUyKSwgbjIgPSBobChlMiwgLTEpID09PSAiLyI7CiAgICAgICAgICByZXR1cm4gZTIgPSB0bChkbChlMi5zcGxpdCgiLyIpLCBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gISFlMzsKICAgICAgICAgIH0pLCAhdDIpLmpvaW4oIi8iKSwgZTIgfHwgdDIgfHwgKGUyID0gIi4iKSwgZTIgJiYgbjIgJiYgKGUyICs9ICIvIiksICh0MiA/ICIvIiA6ICIiKSArIGUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB1bChlMikgewogICAgICAgICAgcmV0dXJuIGUyLmNoYXJBdCgwKSA9PT0gIi8iOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzbCgpIHsKICAgICAgICAgIHZhciBlMiA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7CiAgICAgICAgICByZXR1cm4gaWwoZGwoZTIsIGZ1bmN0aW9uKGUzLCB0MikgewogICAgICAgICAgICBpZiAodHlwZW9mIGUzICE9ICJzdHJpbmciKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkFyZ3VtZW50cyB0byBwYXRoLmpvaW4gbXVzdCBiZSBzdHJpbmdzIik7CiAgICAgICAgICAgIHJldHVybiBlMzsKICAgICAgICAgIH0pLmpvaW4oIi8iKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFsKGUyLCB0MikgewogICAgICAgICAgZnVuY3Rpb24gbjIoZTMpIHsKICAgICAgICAgICAgZm9yICh2YXIgdDMgPSAwOyB0MyA8IGUzLmxlbmd0aCAmJiBlM1t0M10gPT09ICIiOyB0MysrKQogICAgICAgICAgICAgIDsKICAgICAgICAgICAgZm9yICh2YXIgbjMgPSBlMy5sZW5ndGggLSAxOyBuMyA+PSAwICYmIGUzW24zXSA9PT0gIiI7IG4zLS0pCiAgICAgICAgICAgICAgOwogICAgICAgICAgICByZXR1cm4gdDMgPiBuMyA/IFtdIDogZTMuc2xpY2UodDMsIG4zIC0gdDMgKyAxKTsKICAgICAgICAgIH0KICAgICAgICAgIGUyID0gb2woZTIpLnN1YnN0cigxKSwgdDIgPSBvbCh0Mikuc3Vic3RyKDEpOwogICAgICAgICAgZm9yICh2YXIgcjIgPSBuMihlMi5zcGxpdCgiLyIpKSwgbzIgPSBuMih0Mi5zcGxpdCgiLyIpKSwgaTIgPSBNYXRoLm1pbihyMi5sZW5ndGgsIG8yLmxlbmd0aCksIHUyID0gaTIsIHMyID0gMDsgczIgPCBpMjsgczIrKykKICAgICAgICAgICAgaWYgKHIyW3MyXSAhPT0gbzJbczJdKSB7CiAgICAgICAgICAgICAgdTIgPSBzMjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgdmFyIGEyID0gW107CiAgICAgICAgICBmb3IgKHMyID0gdTI7IHMyIDwgcjIubGVuZ3RoOyBzMisrKQogICAgICAgICAgICBhMi5wdXNoKCIuLiIpOwogICAgICAgICAgcmV0dXJuIChhMiA9IGEyLmNvbmNhdChvMi5zbGljZSh1MikpKS5qb2luKCIvIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNsKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSBybChlMiksIG4yID0gdDJbMF0sIHIyID0gdDJbMV07CiAgICAgICAgICByZXR1cm4gbjIgfHwgcjIgPyAocjIgJiYgKHIyID0gcjIuc3Vic3RyKDAsIHIyLmxlbmd0aCAtIDEpKSwgbjIgKyByMikgOiAiLiI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGxsKGUyLCB0MikgewogICAgICAgICAgdmFyIG4yID0gcmwoZTIpWzJdOwogICAgICAgICAgcmV0dXJuIHQyICYmIG4yLnN1YnN0cigtMSAqIHQyLmxlbmd0aCkgPT09IHQyICYmIChuMiA9IG4yLnN1YnN0cigwLCBuMi5sZW5ndGggLSB0Mi5sZW5ndGgpKSwgbjI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHBsKGUyKSB7CiAgICAgICAgICByZXR1cm4gcmwoZTIpWzNdOwogICAgICAgIH0KICAgICAgICB2YXIgZmwgPSB7IGV4dG5hbWU6IHBsLCBiYXNlbmFtZTogbGwsIGRpcm5hbWU6IGNsLCBzZXA6ICIvIiwgZGVsaW1pdGVyOiAiOiIsIHJlbGF0aXZlOiBhbCwgam9pbjogc2wsIGlzQWJzb2x1dGU6IHVsLCBub3JtYWxpemU6IGlsLCByZXNvbHZlOiBvbCB9OwogICAgICAgIGZ1bmN0aW9uIGRsKGUyLCB0MikgewogICAgICAgICAgaWYgKGUyLmZpbHRlcikKICAgICAgICAgICAgcmV0dXJuIGUyLmZpbHRlcih0Mik7CiAgICAgICAgICBmb3IgKHZhciBuMiA9IFtdLCByMiA9IDA7IHIyIDwgZTIubGVuZ3RoOyByMisrKQogICAgICAgICAgICB0MihlMltyMl0sIHIyLCBlMikgJiYgbjIucHVzaChlMltyMl0pOwogICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgIH0KICAgICAgICB2YXIgaGwgPSAiYWIiLnN1YnN0cigtMSkgPT09ICJiIiA/IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBlMi5zdWJzdHIodDIsIG4yKTsKICAgICAgICB9IDogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIHQyIDwgMCAmJiAodDIgPSBlMi5sZW5ndGggKyB0MiksIGUyLnN1YnN0cih0MiwgbjIpOwogICAgICAgIH0sIGdsID0gdChPYmplY3QuZnJlZXplKHsgX19wcm90b19fOiBudWxsLCByZXNvbHZlOiBvbCwgbm9ybWFsaXplOiBpbCwgaXNBYnNvbHV0ZTogdWwsIGpvaW46IHNsLCByZWxhdGl2ZTogYWwsIHNlcDogIi8iLCBkZWxpbWl0ZXI6ICI6IiwgZGlybmFtZTogY2wsIGJhc2VuYW1lOiBsbCwgZXh0bmFtZTogcGwsIGRlZmF1bHQ6IGZsIH0pKSwgbWwgPSBbXSwgeWwgPSBbXSwgRGwgPSB0eXBlb2YgVWludDhBcnJheSAhPSAidW5kZWZpbmVkIiA/IFVpbnQ4QXJyYXkgOiBBcnJheSwgRWwgPSBmYWxzZTsKICAgICAgICBmdW5jdGlvbiBDbCgpIHsKICAgICAgICAgIEVsID0gdHJ1ZTsKICAgICAgICAgIGZvciAodmFyIGUyID0gIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8iLCB0MiA9IDAsIG4yID0gZTIubGVuZ3RoOyB0MiA8IG4yOyArK3QyKQogICAgICAgICAgICBtbFt0Ml0gPSBlMlt0Ml0sIHlsW2UyLmNoYXJDb2RlQXQodDIpXSA9IHQyOwogICAgICAgICAgeWxbIi0iLmNoYXJDb2RlQXQoMCldID0gNjIsIHlsWyJfIi5jaGFyQ29kZUF0KDApXSA9IDYzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBibChlMiwgdDIsIG4yKSB7CiAgICAgICAgICBmb3IgKHZhciByMiwgbzIsIGkyID0gW10sIHUyID0gdDI7IHUyIDwgbjI7IHUyICs9IDMpCiAgICAgICAgICAgIHIyID0gKGUyW3UyXSA8PCAxNikgKyAoZTJbdTIgKyAxXSA8PCA4KSArIGUyW3UyICsgMl0sIGkyLnB1c2gobWxbKG8yID0gcjIpID4+IDE4ICYgNjNdICsgbWxbbzIgPj4gMTIgJiA2M10gKyBtbFtvMiA+PiA2ICYgNjNdICsgbWxbNjMgJiBvMl0pOwogICAgICAgICAgcmV0dXJuIGkyLmpvaW4oIiIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB2bChlMikgewogICAgICAgICAgdmFyIHQyOwogICAgICAgICAgRWwgfHwgQ2woKTsKICAgICAgICAgIGZvciAodmFyIG4yID0gZTIubGVuZ3RoLCByMiA9IG4yICUgMywgbzIgPSAiIiwgaTIgPSBbXSwgdTIgPSAxNjM4MywgczIgPSAwLCBhMiA9IG4yIC0gcjI7IHMyIDwgYTI7IHMyICs9IHUyKQogICAgICAgICAgICBpMi5wdXNoKGJsKGUyLCBzMiwgczIgKyB1MiA+IGEyID8gYTIgOiBzMiArIHUyKSk7CiAgICAgICAgICByZXR1cm4gcjIgPT09IDEgPyAodDIgPSBlMltuMiAtIDFdLCBvMiArPSBtbFt0MiA+PiAyXSwgbzIgKz0gbWxbdDIgPDwgNCAmIDYzXSwgbzIgKz0gIj09IikgOiByMiA9PT0gMiAmJiAodDIgPSAoZTJbbjIgLSAyXSA8PCA4KSArIGUyW24yIC0gMV0sIG8yICs9IG1sW3QyID4+IDEwXSwgbzIgKz0gbWxbdDIgPj4gNCAmIDYzXSwgbzIgKz0gbWxbdDIgPDwgMiAmIDYzXSwgbzIgKz0gIj0iKSwgaTIucHVzaChvMiksIGkyLmpvaW4oIiIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBBbChlMiwgdDIsIG4yLCByMiwgbzIpIHsKICAgICAgICAgIHZhciBpMiwgdTIsIHMyID0gOCAqIG8yIC0gcjIgLSAxLCBhMiA9ICgxIDw8IHMyKSAtIDEsIGMyID0gYTIgPj4gMSwgbDIgPSAtNywgcDIgPSBuMiA/IG8yIC0gMSA6IDAsIGYyID0gbjIgPyAtMSA6IDEsIGQyID0gZTJbdDIgKyBwMl07CiAgICAgICAgICBmb3IgKHAyICs9IGYyLCBpMiA9IGQyICYgKDEgPDwgLWwyKSAtIDEsIGQyID4+PSAtbDIsIGwyICs9IHMyOyBsMiA+IDA7IGkyID0gMjU2ICogaTIgKyBlMlt0MiArIHAyXSwgcDIgKz0gZjIsIGwyIC09IDgpCiAgICAgICAgICAgIDsKICAgICAgICAgIGZvciAodTIgPSBpMiAmICgxIDw8IC1sMikgLSAxLCBpMiA+Pj0gLWwyLCBsMiArPSByMjsgbDIgPiAwOyB1MiA9IDI1NiAqIHUyICsgZTJbdDIgKyBwMl0sIHAyICs9IGYyLCBsMiAtPSA4KQogICAgICAgICAgICA7CiAgICAgICAgICBpZiAoaTIgPT09IDApCiAgICAgICAgICAgIGkyID0gMSAtIGMyOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChpMiA9PT0gYTIpCiAgICAgICAgICAgICAgcmV0dXJuIHUyID8gTmFOIDogMSAvIDAgKiAoZDIgPyAtMSA6IDEpOwogICAgICAgICAgICB1MiArPSBNYXRoLnBvdygyLCByMiksIGkyIC09IGMyOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIChkMiA/IC0xIDogMSkgKiB1MiAqIE1hdGgucG93KDIsIGkyIC0gcjIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBGbChlMiwgdDIsIG4yLCByMiwgbzIsIGkyKSB7CiAgICAgICAgICB2YXIgdTIsIHMyLCBhMiwgYzIgPSA4ICogaTIgLSBvMiAtIDEsIGwyID0gKDEgPDwgYzIpIC0gMSwgcDIgPSBsMiA+PiAxLCBmMiA9IG8yID09PSAyMyA/IE1hdGgucG93KDIsIC0yNCkgLSBNYXRoLnBvdygyLCAtNzcpIDogMCwgZDIgPSByMiA/IDAgOiBpMiAtIDEsIGgyID0gcjIgPyAxIDogLTEsIGcyID0gdDIgPCAwIHx8IHQyID09PSAwICYmIDEgLyB0MiA8IDAgPyAxIDogMDsKICAgICAgICAgIGZvciAodDIgPSBNYXRoLmFicyh0MiksIGlzTmFOKHQyKSB8fCB0MiA9PT0gMSAvIDAgPyAoczIgPSBpc05hTih0MikgPyAxIDogMCwgdTIgPSBsMikgOiAodTIgPSBNYXRoLmZsb29yKE1hdGgubG9nKHQyKSAvIE1hdGguTE4yKSwgdDIgKiAoYTIgPSBNYXRoLnBvdygyLCAtdTIpKSA8IDEgJiYgKHUyLS0sIGEyICo9IDIpLCAodDIgKz0gdTIgKyBwMiA+PSAxID8gZjIgLyBhMiA6IGYyICogTWF0aC5wb3coMiwgMSAtIHAyKSkgKiBhMiA+PSAyICYmICh1MisrLCBhMiAvPSAyKSwgdTIgKyBwMiA+PSBsMiA/IChzMiA9IDAsIHUyID0gbDIpIDogdTIgKyBwMiA+PSAxID8gKHMyID0gKHQyICogYTIgLSAxKSAqIE1hdGgucG93KDIsIG8yKSwgdTIgKz0gcDIpIDogKHMyID0gdDIgKiBNYXRoLnBvdygyLCBwMiAtIDEpICogTWF0aC5wb3coMiwgbzIpLCB1MiA9IDApKTsgbzIgPj0gODsgZTJbbjIgKyBkMl0gPSAyNTUgJiBzMiwgZDIgKz0gaDIsIHMyIC89IDI1NiwgbzIgLT0gOCkKICAgICAgICAgICAgOwogICAgICAgICAgZm9yICh1MiA9IHUyIDw8IG8yIHwgczIsIGMyICs9IG8yOyBjMiA+IDA7IGUyW24yICsgZDJdID0gMjU1ICYgdTIsIGQyICs9IGgyLCB1MiAvPSAyNTYsIGMyIC09IDgpCiAgICAgICAgICAgIDsKICAgICAgICAgIGUyW24yICsgZDIgLSBoMl0gfD0gMTI4ICogZzI7CiAgICAgICAgfQogICAgICAgIHZhciB4bCA9IHt9LnRvU3RyaW5nLCBTbCA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiB4bC5jYWxsKGUyKSA9PSAiW29iamVjdCBBcnJheV0iOwogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gd2woKSB7CiAgICAgICAgICByZXR1cm4gQmwuVFlQRURfQVJSQVlfU1VQUE9SVCA/IDIxNDc0ODM2NDcgOiAxMDczNzQxODIzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBUbChlMiwgdDIpIHsKICAgICAgICAgIGlmICh3bCgpIDwgdDIpCiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJJbnZhbGlkIHR5cGVkIGFycmF5IGxlbmd0aCIpOwogICAgICAgICAgcmV0dXJuIEJsLlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAoZTIgPSBuZXcgVWludDhBcnJheSh0MikpLl9fcHJvdG9fXyA9IEJsLnByb3RvdHlwZSA6IChlMiA9PT0gbnVsbCAmJiAoZTIgPSBuZXcgQmwodDIpKSwgZTIubGVuZ3RoID0gdDIpLCBlMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQmwoZTIsIHQyLCBuMikgewogICAgICAgICAgaWYgKCEoQmwuVFlQRURfQVJSQVlfU1VQUE9SVCB8fCB0aGlzIGluc3RhbmNlb2YgQmwpKQogICAgICAgICAgICByZXR1cm4gbmV3IEJsKGUyLCB0MiwgbjIpOwogICAgICAgICAgaWYgKHR5cGVvZiBlMiA9PSAibnVtYmVyIikgewogICAgICAgICAgICBpZiAodHlwZW9mIHQyID09ICJzdHJpbmciKQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSWYgZW5jb2RpbmcgaXMgc3BlY2lmaWVkIHRoZW4gdGhlIGZpcnN0IGFyZ3VtZW50IG11c3QgYmUgYSBzdHJpbmciKTsKICAgICAgICAgICAgcmV0dXJuIFBsKHRoaXMsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBObCh0aGlzLCBlMiwgdDIsIG4yKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gTmwoZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIGlmICh0eXBlb2YgdDIgPT0gIm51bWJlciIpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJ2YWx1ZSIgYXJndW1lbnQgbXVzdCBub3QgYmUgYSBudW1iZXInKTsKICAgICAgICAgIHJldHVybiB0eXBlb2YgQXJyYXlCdWZmZXIgIT0gInVuZGVmaW5lZCIgJiYgdDIgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciA/IGZ1bmN0aW9uKGUzLCB0MywgbjMsIHIzKSB7CiAgICAgICAgICAgIGlmICh0My5ieXRlTGVuZ3RoLCBuMyA8IDAgfHwgdDMuYnl0ZUxlbmd0aCA8IG4zKQogICAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCInb2Zmc2V0JyBpcyBvdXQgb2YgYm91bmRzIik7CiAgICAgICAgICAgIGlmICh0My5ieXRlTGVuZ3RoIDwgbjMgKyAocjMgfHwgMCkpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIidsZW5ndGgnIGlzIG91dCBvZiBib3VuZHMiKTsKICAgICAgICAgICAgdDMgPSBuMyA9PT0gdm9pZCAwICYmIHIzID09PSB2b2lkIDAgPyBuZXcgVWludDhBcnJheSh0MykgOiByMyA9PT0gdm9pZCAwID8gbmV3IFVpbnQ4QXJyYXkodDMsIG4zKSA6IG5ldyBVaW50OEFycmF5KHQzLCBuMywgcjMpOwogICAgICAgICAgICBCbC5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKGUzID0gdDMpLl9fcHJvdG9fXyA9IEJsLnByb3RvdHlwZSA6IGUzID0gT2woZTMsIHQzKTsKICAgICAgICAgICAgcmV0dXJuIGUzOwogICAgICAgICAgfShlMiwgdDIsIG4yLCByMikgOiB0eXBlb2YgdDIgPT0gInN0cmluZyIgPyBmdW5jdGlvbihlMywgdDMsIG4zKSB7CiAgICAgICAgICAgIHR5cGVvZiBuMyA9PSAic3RyaW5nIiAmJiBuMyAhPT0gIiIgfHwgKG4zID0gInV0ZjgiKTsKICAgICAgICAgICAgaWYgKCFCbC5pc0VuY29kaW5nKG4zKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCciZW5jb2RpbmciIG11c3QgYmUgYSB2YWxpZCBzdHJpbmcgZW5jb2RpbmcnKTsKICAgICAgICAgICAgdmFyIHIzID0gMCB8IGpsKHQzLCBuMyksIG8yID0gKGUzID0gVGwoZTMsIHIzKSkud3JpdGUodDMsIG4zKTsKICAgICAgICAgICAgbzIgIT09IHIzICYmIChlMyA9IGUzLnNsaWNlKDAsIG8yKSk7CiAgICAgICAgICAgIHJldHVybiBlMzsKICAgICAgICAgIH0oZTIsIHQyLCBuMikgOiBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgaWYgKExsKHQzKSkgewogICAgICAgICAgICAgIHZhciBuMyA9IDAgfCBJbCh0My5sZW5ndGgpOwogICAgICAgICAgICAgIHJldHVybiAoZTMgPSBUbChlMywgbjMpKS5sZW5ndGggPT09IDAgfHwgdDMuY29weShlMywgMCwgMCwgbjMpLCBlMzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodDMpIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIEFycmF5QnVmZmVyICE9ICJ1bmRlZmluZWQiICYmIHQzLmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyIHx8ICJsZW5ndGgiIGluIHQzKQogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiB0My5sZW5ndGggIT0gIm51bWJlciIgfHwgKHIzID0gdDMubGVuZ3RoKSAhPSByMyA/IFRsKGUzLCAwKSA6IE9sKGUzLCB0Myk7CiAgICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJCdWZmZXIiICYmIFNsKHQzLmRhdGEpKQogICAgICAgICAgICAgICAgcmV0dXJuIE9sKGUzLCB0My5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcjM7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkZpcnN0IGFyZ3VtZW50IG11c3QgYmUgYSBzdHJpbmcsIEJ1ZmZlciwgQXJyYXlCdWZmZXIsIEFycmF5LCBvciBhcnJheS1saWtlIG9iamVjdC4iKTsKICAgICAgICAgIH0oZTIsIHQyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24ga2woZTIpIHsKICAgICAgICAgIGlmICh0eXBlb2YgZTIgIT0gIm51bWJlciIpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJzaXplIiBhcmd1bWVudCBtdXN0IGJlIGEgbnVtYmVyJyk7CiAgICAgICAgICBpZiAoZTIgPCAwKQogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignInNpemUiIGFyZ3VtZW50IG11c3Qgbm90IGJlIG5lZ2F0aXZlJyk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFBsKGUyLCB0MikgewogICAgICAgICAgaWYgKGtsKHQyKSwgZTIgPSBUbChlMiwgdDIgPCAwID8gMCA6IDAgfCBJbCh0MikpLCAhQmwuVFlQRURfQVJSQVlfU1VQUE9SVCkKICAgICAgICAgICAgZm9yICh2YXIgbjIgPSAwOyBuMiA8IHQyOyArK24yKQogICAgICAgICAgICAgIGUyW24yXSA9IDA7CiAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE9sKGUyLCB0MikgewogICAgICAgICAgdmFyIG4yID0gdDIubGVuZ3RoIDwgMCA/IDAgOiAwIHwgSWwodDIubGVuZ3RoKTsKICAgICAgICAgIGUyID0gVGwoZTIsIG4yKTsKICAgICAgICAgIGZvciAodmFyIHIyID0gMDsgcjIgPCBuMjsgcjIgKz0gMSkKICAgICAgICAgICAgZTJbcjJdID0gMjU1ICYgdDJbcjJdOwogICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBJbChlMikgewogICAgICAgICAgaWYgKGUyID49IHdsKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJBdHRlbXB0IHRvIGFsbG9jYXRlIEJ1ZmZlciBsYXJnZXIgdGhhbiBtYXhpbXVtIHNpemU6IDB4IiArIHdsKCkudG9TdHJpbmcoMTYpICsgIiBieXRlcyIpOwogICAgICAgICAgcmV0dXJuIDAgfCBlMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gTGwoZTIpIHsKICAgICAgICAgIHJldHVybiAhKGUyID09IG51bGwgfHwgIWUyLl9pc0J1ZmZlcik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGpsKGUyLCB0MikgewogICAgICAgICAgaWYgKExsKGUyKSkKICAgICAgICAgICAgcmV0dXJuIGUyLmxlbmd0aDsKICAgICAgICAgIGlmICh0eXBlb2YgQXJyYXlCdWZmZXIgIT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIEFycmF5QnVmZmVyLmlzVmlldyA9PSAiZnVuY3Rpb24iICYmIChBcnJheUJ1ZmZlci5pc1ZpZXcoZTIpIHx8IGUyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpKQogICAgICAgICAgICByZXR1cm4gZTIuYnl0ZUxlbmd0aDsKICAgICAgICAgIHR5cGVvZiBlMiAhPSAic3RyaW5nIiAmJiAoZTIgPSAiIiArIGUyKTsKICAgICAgICAgIHZhciBuMiA9IGUyLmxlbmd0aDsKICAgICAgICAgIGlmIChuMiA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICBmb3IgKHZhciByMiA9IGZhbHNlOyA7ICkKICAgICAgICAgICAgc3dpdGNoICh0MikgewogICAgICAgICAgICAgIGNhc2UgImFzY2lpIjoKICAgICAgICAgICAgICBjYXNlICJsYXRpbjEiOgogICAgICAgICAgICAgIGNhc2UgImJpbmFyeSI6CiAgICAgICAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgICAgICAgY2FzZSAidXRmOCI6CiAgICAgICAgICAgICAgY2FzZSAidXRmLTgiOgogICAgICAgICAgICAgIGNhc2Ugdm9pZCAwOgogICAgICAgICAgICAgICAgcmV0dXJuIGNwKGUyKS5sZW5ndGg7CiAgICAgICAgICAgICAgY2FzZSAidWNzMiI6CiAgICAgICAgICAgICAgY2FzZSAidWNzLTIiOgogICAgICAgICAgICAgIGNhc2UgInV0ZjE2bGUiOgogICAgICAgICAgICAgIGNhc2UgInV0Zi0xNmxlIjoKICAgICAgICAgICAgICAgIHJldHVybiAyICogbjI7CiAgICAgICAgICAgICAgY2FzZSAiaGV4IjoKICAgICAgICAgICAgICAgIHJldHVybiBuMiA+Pj4gMTsKICAgICAgICAgICAgICBjYXNlICJiYXNlNjQiOgogICAgICAgICAgICAgICAgcmV0dXJuIGxwKGUyKS5sZW5ndGg7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmIChyMikKICAgICAgICAgICAgICAgICAgcmV0dXJuIGNwKGUyKS5sZW5ndGg7CiAgICAgICAgICAgICAgICB0MiA9ICgiIiArIHQyKS50b0xvd2VyQ2FzZSgpLCByMiA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gX2woZTIsIHQyLCBuMikgewogICAgICAgICAgdmFyIHIyID0gZmFsc2U7CiAgICAgICAgICBpZiAoKHQyID09PSB2b2lkIDAgfHwgdDIgPCAwKSAmJiAodDIgPSAwKSwgdDIgPiB0aGlzLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgaWYgKChuMiA9PT0gdm9pZCAwIHx8IG4yID4gdGhpcy5sZW5ndGgpICYmIChuMiA9IHRoaXMubGVuZ3RoKSwgbjIgPD0gMCkKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgaWYgKChuMiA+Pj49IDApIDw9ICh0MiA+Pj49IDApKQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICBmb3IgKGUyIHx8IChlMiA9ICJ1dGY4Iik7IDsgKQogICAgICAgICAgICBzd2l0Y2ggKGUyKSB7CiAgICAgICAgICAgICAgY2FzZSAiaGV4IjoKICAgICAgICAgICAgICAgIHJldHVybiBRbCh0aGlzLCB0MiwgbjIpOwogICAgICAgICAgICAgIGNhc2UgInV0ZjgiOgogICAgICAgICAgICAgIGNhc2UgInV0Zi04IjoKICAgICAgICAgICAgICAgIHJldHVybiBKbCh0aGlzLCB0MiwgbjIpOwogICAgICAgICAgICAgIGNhc2UgImFzY2lpIjoKICAgICAgICAgICAgICAgIHJldHVybiBZbCh0aGlzLCB0MiwgbjIpOwogICAgICAgICAgICAgIGNhc2UgImxhdGluMSI6CiAgICAgICAgICAgICAgY2FzZSAiYmluYXJ5IjoKICAgICAgICAgICAgICAgIHJldHVybiBLbCh0aGlzLCB0MiwgbjIpOwogICAgICAgICAgICAgIGNhc2UgImJhc2U2NCI6CiAgICAgICAgICAgICAgICByZXR1cm4gSGwodGhpcywgdDIsIG4yKTsKICAgICAgICAgICAgICBjYXNlICJ1Y3MyIjoKICAgICAgICAgICAgICBjYXNlICJ1Y3MtMiI6CiAgICAgICAgICAgICAgY2FzZSAidXRmMTZsZSI6CiAgICAgICAgICAgICAgY2FzZSAidXRmLTE2bGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIFpsKHRoaXMsIHQyLCBuMik7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmIChyMikKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBlbmNvZGluZzogIiArIGUyKTsKICAgICAgICAgICAgICAgIGUyID0gKGUyICsgIiIpLnRvTG93ZXJDYXNlKCksIHIyID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBNbChlMiwgdDIsIG4yKSB7CiAgICAgICAgICB2YXIgcjIgPSBlMlt0Ml07CiAgICAgICAgICBlMlt0Ml0gPSBlMltuMl0sIGUyW24yXSA9IHIyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBSbChlMiwgdDIsIG4yLCByMiwgbzIpIHsKICAgICAgICAgIGlmIChlMi5sZW5ndGggPT09IDApCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIGlmICh0eXBlb2YgbjIgPT0gInN0cmluZyIgPyAocjIgPSBuMiwgbjIgPSAwKSA6IG4yID4gMjE0NzQ4MzY0NyA/IG4yID0gMjE0NzQ4MzY0NyA6IG4yIDwgLTIxNDc0ODM2NDggJiYgKG4yID0gLTIxNDc0ODM2NDgpLCBuMiA9ICtuMiwgaXNOYU4objIpICYmIChuMiA9IG8yID8gMCA6IGUyLmxlbmd0aCAtIDEpLCBuMiA8IDAgJiYgKG4yID0gZTIubGVuZ3RoICsgbjIpLCBuMiA+PSBlMi5sZW5ndGgpIHsKICAgICAgICAgICAgaWYgKG8yKQogICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgbjIgPSBlMi5sZW5ndGggLSAxOwogICAgICAgICAgfSBlbHNlIGlmIChuMiA8IDApIHsKICAgICAgICAgICAgaWYgKCFvMikKICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIG4yID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2YgdDIgPT0gInN0cmluZyIgJiYgKHQyID0gQmwuZnJvbSh0MiwgcjIpKSwgTGwodDIpKQogICAgICAgICAgICByZXR1cm4gdDIubGVuZ3RoID09PSAwID8gLTEgOiBWbChlMiwgdDIsIG4yLCByMiwgbzIpOwogICAgICAgICAgaWYgKHR5cGVvZiB0MiA9PSAibnVtYmVyIikKICAgICAgICAgICAgcmV0dXJuIHQyICY9IDI1NSwgQmwuVFlQRURfQVJSQVlfU1VQUE9SVCAmJiB0eXBlb2YgVWludDhBcnJheS5wcm90b3R5cGUuaW5kZXhPZiA9PSAiZnVuY3Rpb24iID8gbzIgPyBVaW50OEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoZTIsIHQyLCBuMikgOiBVaW50OEFycmF5LnByb3RvdHlwZS5sYXN0SW5kZXhPZi5jYWxsKGUyLCB0MiwgbjIpIDogVmwoZTIsIFt0Ml0sIG4yLCByMiwgbzIpOwogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigidmFsIG11c3QgYmUgc3RyaW5nLCBudW1iZXIgb3IgQnVmZmVyIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFZsKGUyLCB0MiwgbjIsIHIyLCBvMikgewogICAgICAgICAgdmFyIGkyLCB1MiA9IDEsIHMyID0gZTIubGVuZ3RoLCBhMiA9IHQyLmxlbmd0aDsKICAgICAgICAgIGlmIChyMiAhPT0gdm9pZCAwICYmICgocjIgPSBTdHJpbmcocjIpLnRvTG93ZXJDYXNlKCkpID09PSAidWNzMiIgfHwgcjIgPT09ICJ1Y3MtMiIgfHwgcjIgPT09ICJ1dGYxNmxlIiB8fCByMiA9PT0gInV0Zi0xNmxlIikpIHsKICAgICAgICAgICAgaWYgKGUyLmxlbmd0aCA8IDIgfHwgdDIubGVuZ3RoIDwgMikKICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIHUyID0gMiwgczIgLz0gMiwgYTIgLz0gMiwgbjIgLz0gMjsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGMyKGUzLCB0MykgewogICAgICAgICAgICByZXR1cm4gdTIgPT09IDEgPyBlM1t0M10gOiBlMy5yZWFkVUludDE2QkUodDMgKiB1Mik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobzIpIHsKICAgICAgICAgICAgdmFyIGwyID0gLTE7CiAgICAgICAgICAgIGZvciAoaTIgPSBuMjsgaTIgPCBzMjsgaTIrKykKICAgICAgICAgICAgICBpZiAoYzIoZTIsIGkyKSA9PT0gYzIodDIsIGwyID09PSAtMSA/IDAgOiBpMiAtIGwyKSkgewogICAgICAgICAgICAgICAgaWYgKGwyID09PSAtMSAmJiAobDIgPSBpMiksIGkyIC0gbDIgKyAxID09PSBhMikKICAgICAgICAgICAgICAgICAgcmV0dXJuIGwyICogdTI7CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBsMiAhPT0gLTEgJiYgKGkyIC09IGkyIC0gbDIpLCBsMiA9IC0xOwogICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGZvciAobjIgKyBhMiA+IHMyICYmIChuMiA9IHMyIC0gYTIpLCBpMiA9IG4yOyBpMiA+PSAwOyBpMi0tKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgcDIgPSB0cnVlLCBmMiA9IDA7IGYyIDwgYTI7IGYyKyspCiAgICAgICAgICAgICAgICBpZiAoYzIoZTIsIGkyICsgZjIpICE9PSBjMih0MiwgZjIpKSB7CiAgICAgICAgICAgICAgICAgIHAyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChwMikKICAgICAgICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiAkbChlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgbjIgPSBOdW1iZXIobjIpIHx8IDA7CiAgICAgICAgICB2YXIgbzIgPSBlMi5sZW5ndGggLSBuMjsKICAgICAgICAgIHIyID8gKHIyID0gTnVtYmVyKHIyKSkgPiBvMiAmJiAocjIgPSBvMikgOiByMiA9IG8yOwogICAgICAgICAgdmFyIGkyID0gdDIubGVuZ3RoOwogICAgICAgICAgaWYgKGkyICUgMiAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGhleCBzdHJpbmciKTsKICAgICAgICAgIHIyID4gaTIgLyAyICYmIChyMiA9IGkyIC8gMik7CiAgICAgICAgICBmb3IgKHZhciB1MiA9IDA7IHUyIDwgcjI7ICsrdTIpIHsKICAgICAgICAgICAgdmFyIHMyID0gcGFyc2VJbnQodDIuc3Vic3RyKDIgKiB1MiwgMiksIDE2KTsKICAgICAgICAgICAgaWYgKGlzTmFOKHMyKSkKICAgICAgICAgICAgICByZXR1cm4gdTI7CiAgICAgICAgICAgIGUyW24yICsgdTJdID0gczI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFdsKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICByZXR1cm4gcHAoY3AodDIsIGUyLmxlbmd0aCAtIG4yKSwgZTIsIG4yLCByMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHFsKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICByZXR1cm4gcHAoZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgZm9yICh2YXIgdDMgPSBbXSwgbjMgPSAwOyBuMyA8IGUzLmxlbmd0aDsgKytuMykKICAgICAgICAgICAgICB0My5wdXNoKDI1NSAmIGUzLmNoYXJDb2RlQXQobjMpKTsKICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfSh0MiksIGUyLCBuMiwgcjIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBVbChlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgcmV0dXJuIHFsKGUyLCB0MiwgbjIsIHIyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gemwoZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIHJldHVybiBwcChscCh0MiksIGUyLCBuMiwgcjIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBHbChlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgcmV0dXJuIHBwKGZ1bmN0aW9uKGUzLCB0MykgewogICAgICAgICAgICBmb3IgKHZhciBuMywgcjMsIG8yLCBpMiA9IFtdLCB1MiA9IDA7IHUyIDwgZTMubGVuZ3RoICYmICEoKHQzIC09IDIpIDwgMCk7ICsrdTIpCiAgICAgICAgICAgICAgcjMgPSAobjMgPSBlMy5jaGFyQ29kZUF0KHUyKSkgPj4gOCwgbzIgPSBuMyAlIDI1NiwgaTIucHVzaChvMiksIGkyLnB1c2gocjMpOwogICAgICAgICAgICByZXR1cm4gaTI7CiAgICAgICAgICB9KHQyLCBlMi5sZW5ndGggLSBuMiksIGUyLCBuMiwgcjIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBIbChlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gdDIgPT09IDAgJiYgbjIgPT09IGUyLmxlbmd0aCA/IHZsKGUyKSA6IHZsKGUyLnNsaWNlKHQyLCBuMikpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBKbChlMiwgdDIsIG4yKSB7CiAgICAgICAgICBuMiA9IE1hdGgubWluKGUyLmxlbmd0aCwgbjIpOwogICAgICAgICAgZm9yICh2YXIgcjIgPSBbXSwgbzIgPSB0MjsgbzIgPCBuMjsgKSB7CiAgICAgICAgICAgIHZhciBpMiwgdTIsIHMyLCBhMiwgYzIgPSBlMltvMl0sIGwyID0gbnVsbCwgcDIgPSBjMiA+IDIzOSA/IDQgOiBjMiA+IDIyMyA/IDMgOiBjMiA+IDE5MSA/IDIgOiAxOwogICAgICAgICAgICBpZiAobzIgKyBwMiA8PSBuMikKICAgICAgICAgICAgICBzd2l0Y2ggKHAyKSB7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgIGMyIDwgMTI4ICYmIChsMiA9IGMyKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICgxOTIgJiAoaTIgPSBlMltvMiArIDFdKSkgPT0gMTI4ICYmIChhMiA9ICgzMSAmIGMyKSA8PCA2IHwgNjMgJiBpMikgPiAxMjcgJiYgKGwyID0gYTIpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgaTIgPSBlMltvMiArIDFdLCB1MiA9IGUyW28yICsgMl0sICgxOTIgJiBpMikgPT0gMTI4ICYmICgxOTIgJiB1MikgPT0gMTI4ICYmIChhMiA9ICgxNSAmIGMyKSA8PCAxMiB8ICg2MyAmIGkyKSA8PCA2IHwgNjMgJiB1MikgPiAyMDQ3ICYmIChhMiA8IDU1Mjk2IHx8IGEyID4gNTczNDMpICYmIChsMiA9IGEyKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgIGkyID0gZTJbbzIgKyAxXSwgdTIgPSBlMltvMiArIDJdLCBzMiA9IGUyW28yICsgM10sICgxOTIgJiBpMikgPT0gMTI4ICYmICgxOTIgJiB1MikgPT0gMTI4ICYmICgxOTIgJiBzMikgPT0gMTI4ICYmIChhMiA9ICgxNSAmIGMyKSA8PCAxOCB8ICg2MyAmIGkyKSA8PCAxMiB8ICg2MyAmIHUyKSA8PCA2IHwgNjMgJiBzMikgPiA2NTUzNSAmJiBhMiA8IDExMTQxMTIgJiYgKGwyID0gYTIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgbDIgPT09IG51bGwgPyAobDIgPSA2NTUzMywgcDIgPSAxKSA6IGwyID4gNjU1MzUgJiYgKGwyIC09IDY1NTM2LCByMi5wdXNoKGwyID4+PiAxMCAmIDEwMjMgfCA1NTI5NiksIGwyID0gNTYzMjAgfCAxMDIzICYgbDIpLCByMi5wdXNoKGwyKSwgbzIgKz0gcDI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgdmFyIHQzID0gZTMubGVuZ3RoOwogICAgICAgICAgICBpZiAodDMgPD0gWGwpCiAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLCBlMyk7CiAgICAgICAgICAgIHZhciBuMyA9ICIiLCByMyA9IDA7CiAgICAgICAgICAgIGZvciAoOyByMyA8IHQzOyApCiAgICAgICAgICAgICAgbjMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsIGUzLnNsaWNlKHIzLCByMyArPSBYbCkpOwogICAgICAgICAgICByZXR1cm4gbjM7CiAgICAgICAgICB9KHIyKTsKICAgICAgICB9CiAgICAgICAgQmwuVFlQRURfQVJSQVlfU1VQUE9SVCA9IE5zLlRZUEVEX0FSUkFZX1NVUFBPUlQgPT09IHZvaWQgMCB8fCBOcy5UWVBFRF9BUlJBWV9TVVBQT1JULCBCbC5wb29sU2l6ZSA9IDgxOTIsIEJsLl9hdWdtZW50ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5fX3Byb3RvX18gPSBCbC5wcm90b3R5cGUsIGUyOwogICAgICAgIH0sIEJsLmZyb20gPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gTmwobnVsbCwgZTIsIHQyLCBuMik7CiAgICAgICAgfSwgQmwuVFlQRURfQVJSQVlfU1VQUE9SVCAmJiAoQmwucHJvdG90eXBlLl9fcHJvdG9fXyA9IFVpbnQ4QXJyYXkucHJvdG90eXBlLCBCbC5fX3Byb3RvX18gPSBVaW50OEFycmF5KSwgQmwuYWxsb2MgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTMsIHQzLCBuMywgcjIpIHsKICAgICAgICAgICAgcmV0dXJuIGtsKHQzKSwgdDMgPD0gMCA/IFRsKGUzLCB0MykgOiBuMyAhPT0gdm9pZCAwID8gdHlwZW9mIHIyID09ICJzdHJpbmciID8gVGwoZTMsIHQzKS5maWxsKG4zLCByMikgOiBUbChlMywgdDMpLmZpbGwobjMpIDogVGwoZTMsIHQzKTsKICAgICAgICAgIH0obnVsbCwgZTIsIHQyLCBuMik7CiAgICAgICAgfSwgQmwuYWxsb2NVbnNhZmUgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFBsKG51bGwsIGUyKTsKICAgICAgICB9LCBCbC5hbGxvY1Vuc2FmZVNsb3cgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFBsKG51bGwsIGUyKTsKICAgICAgICB9LCBCbC5pc0J1ZmZlciA9IGZwLCBCbC5jb21wYXJlID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBpZiAoIUxsKGUyKSB8fCAhTGwodDIpKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJBcmd1bWVudHMgbXVzdCBiZSBCdWZmZXJzIik7CiAgICAgICAgICBpZiAoZTIgPT09IHQyKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIGZvciAodmFyIG4yID0gZTIubGVuZ3RoLCByMiA9IHQyLmxlbmd0aCwgbzIgPSAwLCBpMiA9IE1hdGgubWluKG4yLCByMik7IG8yIDwgaTI7ICsrbzIpCiAgICAgICAgICAgIGlmIChlMltvMl0gIT09IHQyW28yXSkgewogICAgICAgICAgICAgIG4yID0gZTJbbzJdLCByMiA9IHQyW28yXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG4yIDwgcjIgPyAtMSA6IHIyIDwgbjIgPyAxIDogMDsKICAgICAgICB9LCBCbC5pc0VuY29kaW5nID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHN3aXRjaCAoU3RyaW5nKGUyKS50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgICAgIGNhc2UgImhleCI6CiAgICAgICAgICAgIGNhc2UgInV0ZjgiOgogICAgICAgICAgICBjYXNlICJ1dGYtOCI6CiAgICAgICAgICAgIGNhc2UgImFzY2lpIjoKICAgICAgICAgICAgY2FzZSAibGF0aW4xIjoKICAgICAgICAgICAgY2FzZSAiYmluYXJ5IjoKICAgICAgICAgICAgY2FzZSAiYmFzZTY0IjoKICAgICAgICAgICAgY2FzZSAidWNzMiI6CiAgICAgICAgICAgIGNhc2UgInVjcy0yIjoKICAgICAgICAgICAgY2FzZSAidXRmMTZsZSI6CiAgICAgICAgICAgIGNhc2UgInV0Zi0xNmxlIjoKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSwgQmwuY29uY2F0ID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBpZiAoIVNsKGUyKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignImxpc3QiIGFyZ3VtZW50IG11c3QgYmUgYW4gQXJyYXkgb2YgQnVmZmVycycpOwogICAgICAgICAgaWYgKGUyLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIEJsLmFsbG9jKDApOwogICAgICAgICAgdmFyIG4yOwogICAgICAgICAgaWYgKHQyID09PSB2b2lkIDApCiAgICAgICAgICAgIGZvciAodDIgPSAwLCBuMiA9IDA7IG4yIDwgZTIubGVuZ3RoOyArK24yKQogICAgICAgICAgICAgIHQyICs9IGUyW24yXS5sZW5ndGg7CiAgICAgICAgICB2YXIgcjIgPSBCbC5hbGxvY1Vuc2FmZSh0MiksIG8yID0gMDsKICAgICAgICAgIGZvciAobjIgPSAwOyBuMiA8IGUyLmxlbmd0aDsgKytuMikgewogICAgICAgICAgICB2YXIgaTIgPSBlMltuMl07CiAgICAgICAgICAgIGlmICghTGwoaTIpKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJsaXN0IiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKTsKICAgICAgICAgICAgaTIuY29weShyMiwgbzIpLCBvMiArPSBpMi5sZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgfSwgQmwuYnl0ZUxlbmd0aCA9IGpsLCBCbC5wcm90b3R5cGUuX2lzQnVmZmVyID0gdHJ1ZSwgQmwucHJvdG90eXBlLnN3YXAxNiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGUyID0gdGhpcy5sZW5ndGg7CiAgICAgICAgICBpZiAoZTIgJSAyICE9IDApCiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJCdWZmZXIgc2l6ZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgMTYtYml0cyIpOwogICAgICAgICAgZm9yICh2YXIgdDIgPSAwOyB0MiA8IGUyOyB0MiArPSAyKQogICAgICAgICAgICBNbCh0aGlzLCB0MiwgdDIgKyAxKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5zd2FwMzIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBlMiA9IHRoaXMubGVuZ3RoOwogICAgICAgICAgaWYgKGUyICUgNCAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDMyLWJpdHMiKTsKICAgICAgICAgIGZvciAodmFyIHQyID0gMDsgdDIgPCBlMjsgdDIgKz0gNCkKICAgICAgICAgICAgTWwodGhpcywgdDIsIHQyICsgMyksIE1sKHRoaXMsIHQyICsgMSwgdDIgKyAyKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5zd2FwNjQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBlMiA9IHRoaXMubGVuZ3RoOwogICAgICAgICAgaWYgKGUyICUgOCAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDY0LWJpdHMiKTsKICAgICAgICAgIGZvciAodmFyIHQyID0gMDsgdDIgPCBlMjsgdDIgKz0gOCkKICAgICAgICAgICAgTWwodGhpcywgdDIsIHQyICsgNyksIE1sKHRoaXMsIHQyICsgMSwgdDIgKyA2KSwgTWwodGhpcywgdDIgKyAyLCB0MiArIDUpLCBNbCh0aGlzLCB0MiArIDMsIHQyICsgNCk7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LCBCbC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBlMiA9IDAgfCB0aGlzLmxlbmd0aDsKICAgICAgICAgIHJldHVybiBlMiA9PT0gMCA/ICIiIDogYXJndW1lbnRzLmxlbmd0aCA9PT0gMCA/IEpsKHRoaXMsIDAsIGUyKSA6IF9sLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBpZiAoIUxsKGUyKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciIpOwogICAgICAgICAgcmV0dXJuIHRoaXMgPT09IGUyIHx8IEJsLmNvbXBhcmUodGhpcywgZTIpID09PSAwOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5pbnNwZWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZTIgPSAiIjsKICAgICAgICAgIHJldHVybiB0aGlzLmxlbmd0aCA+IDAgJiYgKGUyID0gdGhpcy50b1N0cmluZygiaGV4IiwgMCwgNTApLm1hdGNoKC8uezJ9L2cpLmpvaW4oIiAiKSwgdGhpcy5sZW5ndGggPiA1MCAmJiAoZTIgKz0gIiAuLi4gIikpLCAiPEJ1ZmZlciAiICsgZTIgKyAiPiI7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLmNvbXBhcmUgPSBmdW5jdGlvbihlMiwgdDIsIG4yLCByMiwgbzIpIHsKICAgICAgICAgIGlmICghTGwoZTIpKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJBcmd1bWVudCBtdXN0IGJlIGEgQnVmZmVyIik7CiAgICAgICAgICBpZiAodDIgPT09IHZvaWQgMCAmJiAodDIgPSAwKSwgbjIgPT09IHZvaWQgMCAmJiAobjIgPSBlMiA/IGUyLmxlbmd0aCA6IDApLCByMiA9PT0gdm9pZCAwICYmIChyMiA9IDApLCBvMiA9PT0gdm9pZCAwICYmIChvMiA9IHRoaXMubGVuZ3RoKSwgdDIgPCAwIHx8IG4yID4gZTIubGVuZ3RoIHx8IHIyIDwgMCB8fCBvMiA+IHRoaXMubGVuZ3RoKQogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigib3V0IG9mIHJhbmdlIGluZGV4Iik7CiAgICAgICAgICBpZiAocjIgPj0gbzIgJiYgdDIgPj0gbjIpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgaWYgKHIyID49IG8yKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICBpZiAodDIgPj0gbjIpCiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgaWYgKHRoaXMgPT09IGUyKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIGZvciAodmFyIGkyID0gKG8yID4+Pj0gMCkgLSAocjIgPj4+PSAwKSwgdTIgPSAobjIgPj4+PSAwKSAtICh0MiA+Pj49IDApLCBzMiA9IE1hdGgubWluKGkyLCB1MiksIGEyID0gdGhpcy5zbGljZShyMiwgbzIpLCBjMiA9IGUyLnNsaWNlKHQyLCBuMiksIGwyID0gMDsgbDIgPCBzMjsgKytsMikKICAgICAgICAgICAgaWYgKGEyW2wyXSAhPT0gYzJbbDJdKSB7CiAgICAgICAgICAgICAgaTIgPSBhMltsMl0sIHUyID0gYzJbbDJdOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaTIgPCB1MiA/IC0xIDogdTIgPCBpMiA/IDEgOiAwOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5pbmNsdWRlcyA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4T2YoZTIsIHQyLCBuMikgIT09IC0xOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIFJsKHRoaXMsIGUyLCB0MiwgbjIsIHRydWUpOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5sYXN0SW5kZXhPZiA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBSbCh0aGlzLCBlMiwgdDIsIG4yLCBmYWxzZSk7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24oZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIGlmICh0MiA9PT0gdm9pZCAwKQogICAgICAgICAgICByMiA9ICJ1dGY4IiwgbjIgPSB0aGlzLmxlbmd0aCwgdDIgPSAwOwogICAgICAgICAgZWxzZSBpZiAobjIgPT09IHZvaWQgMCAmJiB0eXBlb2YgdDIgPT0gInN0cmluZyIpCiAgICAgICAgICAgIHIyID0gdDIsIG4yID0gdGhpcy5sZW5ndGgsIHQyID0gMDsKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiAoIWlzRmluaXRlKHQyKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkJ1ZmZlci53cml0ZShzdHJpbmcsIGVuY29kaW5nLCBvZmZzZXRbLCBsZW5ndGhdKSBpcyBubyBsb25nZXIgc3VwcG9ydGVkIik7CiAgICAgICAgICAgIHQyIHw9IDAsIGlzRmluaXRlKG4yKSA/IChuMiB8PSAwLCByMiA9PT0gdm9pZCAwICYmIChyMiA9ICJ1dGY4IikpIDogKHIyID0gbjIsIG4yID0gdm9pZCAwKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBvMiA9IHRoaXMubGVuZ3RoIC0gdDI7CiAgICAgICAgICBpZiAoKG4yID09PSB2b2lkIDAgfHwgbjIgPiBvMikgJiYgKG4yID0gbzIpLCBlMi5sZW5ndGggPiAwICYmIChuMiA8IDAgfHwgdDIgPCAwKSB8fCB0MiA+IHRoaXMubGVuZ3RoKQogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQXR0ZW1wdCB0byB3cml0ZSBvdXRzaWRlIGJ1ZmZlciBib3VuZHMiKTsKICAgICAgICAgIHIyIHx8IChyMiA9ICJ1dGY4Iik7CiAgICAgICAgICBmb3IgKHZhciBpMiA9IGZhbHNlOyA7ICkKICAgICAgICAgICAgc3dpdGNoIChyMikgewogICAgICAgICAgICAgIGNhc2UgImhleCI6CiAgICAgICAgICAgICAgICByZXR1cm4gJGwodGhpcywgZTIsIHQyLCBuMik7CiAgICAgICAgICAgICAgY2FzZSAidXRmOCI6CiAgICAgICAgICAgICAgY2FzZSAidXRmLTgiOgogICAgICAgICAgICAgICAgcmV0dXJuIFdsKHRoaXMsIGUyLCB0MiwgbjIpOwogICAgICAgICAgICAgIGNhc2UgImFzY2lpIjoKICAgICAgICAgICAgICAgIHJldHVybiBxbCh0aGlzLCBlMiwgdDIsIG4yKTsKICAgICAgICAgICAgICBjYXNlICJsYXRpbjEiOgogICAgICAgICAgICAgIGNhc2UgImJpbmFyeSI6CiAgICAgICAgICAgICAgICByZXR1cm4gVWwodGhpcywgZTIsIHQyLCBuMik7CiAgICAgICAgICAgICAgY2FzZSAiYmFzZTY0IjoKICAgICAgICAgICAgICAgIHJldHVybiB6bCh0aGlzLCBlMiwgdDIsIG4yKTsKICAgICAgICAgICAgICBjYXNlICJ1Y3MyIjoKICAgICAgICAgICAgICBjYXNlICJ1Y3MtMiI6CiAgICAgICAgICAgICAgY2FzZSAidXRmMTZsZSI6CiAgICAgICAgICAgICAgY2FzZSAidXRmLTE2bGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIEdsKHRoaXMsIGUyLCB0MiwgbjIpOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBpZiAoaTIpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZW5jb2Rpbmc6ICIgKyByMik7CiAgICAgICAgICAgICAgICByMiA9ICgiIiArIHIyKS50b0xvd2VyQ2FzZSgpLCBpMiA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBCbC5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4geyB0eXBlOiAiQnVmZmVyIiwgZGF0YTogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5fYXJyIHx8IHRoaXMsIDApIH07CiAgICAgICAgfTsKICAgICAgICB2YXIgWGwgPSA0MDk2OwogICAgICAgIGZ1bmN0aW9uIFlsKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHZhciByMiA9ICIiOwogICAgICAgICAgbjIgPSBNYXRoLm1pbihlMi5sZW5ndGgsIG4yKTsKICAgICAgICAgIGZvciAodmFyIG8yID0gdDI7IG8yIDwgbjI7ICsrbzIpCiAgICAgICAgICAgIHIyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoMTI3ICYgZTJbbzJdKTsKICAgICAgICAgIHJldHVybiByMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gS2woZTIsIHQyLCBuMikgewogICAgICAgICAgdmFyIHIyID0gIiI7CiAgICAgICAgICBuMiA9IE1hdGgubWluKGUyLmxlbmd0aCwgbjIpOwogICAgICAgICAgZm9yICh2YXIgbzIgPSB0MjsgbzIgPCBuMjsgKytvMikKICAgICAgICAgICAgcjIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShlMltvMl0pOwogICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBRbChlMiwgdDIsIG4yKSB7CiAgICAgICAgICB2YXIgcjIgPSBlMi5sZW5ndGg7CiAgICAgICAgICAoIXQyIHx8IHQyIDwgMCkgJiYgKHQyID0gMCksICghbjIgfHwgbjIgPCAwIHx8IG4yID4gcjIpICYmIChuMiA9IHIyKTsKICAgICAgICAgIGZvciAodmFyIG8yID0gIiIsIGkyID0gdDI7IGkyIDwgbjI7ICsraTIpCiAgICAgICAgICAgIG8yICs9IGFwKGUyW2kyXSk7CiAgICAgICAgICByZXR1cm4gbzI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFpsKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGZvciAodmFyIHIyID0gZTIuc2xpY2UodDIsIG4yKSwgbzIgPSAiIiwgaTIgPSAwOyBpMiA8IHIyLmxlbmd0aDsgaTIgKz0gMikKICAgICAgICAgICAgbzIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShyMltpMl0gKyAyNTYgKiByMltpMiArIDFdKTsKICAgICAgICAgIHJldHVybiBvMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZXAoZTIsIHQyLCBuMikgewogICAgICAgICAgaWYgKGUyICUgMSAhPSAwIHx8IGUyIDwgMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm9mZnNldCBpcyBub3QgdWludCIpOwogICAgICAgICAgaWYgKGUyICsgdDIgPiBuMikKICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIlRyeWluZyB0byBhY2Nlc3MgYmV5b25kIGJ1ZmZlciBsZW5ndGgiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdHAoZTIsIHQyLCBuMiwgcjIsIG8yLCBpMikgewogICAgICAgICAgaWYgKCFMbChlMikpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJidWZmZXIiIGFyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXIgaW5zdGFuY2UnKTsKICAgICAgICAgIGlmICh0MiA+IG8yIHx8IHQyIDwgaTIpCiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCcidmFsdWUiIGFyZ3VtZW50IGlzIG91dCBvZiBib3VuZHMnKTsKICAgICAgICAgIGlmIChuMiArIHIyID4gZTIubGVuZ3RoKQogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSW5kZXggb3V0IG9mIHJhbmdlIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG5wKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICB0MiA8IDAgJiYgKHQyID0gNjU1MzUgKyB0MiArIDEpOwogICAgICAgICAgZm9yICh2YXIgbzIgPSAwLCBpMiA9IE1hdGgubWluKGUyLmxlbmd0aCAtIG4yLCAyKTsgbzIgPCBpMjsgKytvMikKICAgICAgICAgICAgZTJbbjIgKyBvMl0gPSAodDIgJiAyNTUgPDwgOCAqIChyMiA/IG8yIDogMSAtIG8yKSkgPj4+IDggKiAocjIgPyBvMiA6IDEgLSBvMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJwKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICB0MiA8IDAgJiYgKHQyID0gNDI5NDk2NzI5NSArIHQyICsgMSk7CiAgICAgICAgICBmb3IgKHZhciBvMiA9IDAsIGkyID0gTWF0aC5taW4oZTIubGVuZ3RoIC0gbjIsIDQpOyBvMiA8IGkyOyArK28yKQogICAgICAgICAgICBlMltuMiArIG8yXSA9IHQyID4+PiA4ICogKHIyID8gbzIgOiAzIC0gbzIpICYgMjU1OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvcChlMiwgdDIsIG4yLCByMiwgbzIsIGkyKSB7CiAgICAgICAgICBpZiAobjIgKyByMiA+IGUyLmxlbmd0aCkKICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkluZGV4IG91dCBvZiByYW5nZSIpOwogICAgICAgICAgaWYgKG4yIDwgMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkluZGV4IG91dCBvZiByYW5nZSIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpcChlMiwgdDIsIG4yLCByMiwgbzIpIHsKICAgICAgICAgIHJldHVybiBvMiB8fCBvcChlMiwgMCwgbjIsIDQpLCBGbChlMiwgdDIsIG4yLCByMiwgMjMsIDQpLCBuMiArIDQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHVwKGUyLCB0MiwgbjIsIHIyLCBvMikgewogICAgICAgICAgcmV0dXJuIG8yIHx8IG9wKGUyLCAwLCBuMiwgOCksIEZsKGUyLCB0MiwgbjIsIHIyLCA1MiwgOCksIG4yICsgODsKICAgICAgICB9CiAgICAgICAgQmwucHJvdG90eXBlLnNsaWNlID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICB2YXIgbjIsIHIyID0gdGhpcy5sZW5ndGg7CiAgICAgICAgICBpZiAoKGUyID0gfn5lMikgPCAwID8gKGUyICs9IHIyKSA8IDAgJiYgKGUyID0gMCkgOiBlMiA+IHIyICYmIChlMiA9IHIyKSwgKHQyID0gdDIgPT09IHZvaWQgMCA/IHIyIDogfn50MikgPCAwID8gKHQyICs9IHIyKSA8IDAgJiYgKHQyID0gMCkgOiB0MiA+IHIyICYmICh0MiA9IHIyKSwgdDIgPCBlMiAmJiAodDIgPSBlMiksIEJsLlRZUEVEX0FSUkFZX1NVUFBPUlQpCiAgICAgICAgICAgIChuMiA9IHRoaXMuc3ViYXJyYXkoZTIsIHQyKSkuX19wcm90b19fID0gQmwucHJvdG90eXBlOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBvMiA9IHQyIC0gZTI7CiAgICAgICAgICAgIG4yID0gbmV3IEJsKG8yLCB2b2lkIDApOwogICAgICAgICAgICBmb3IgKHZhciBpMiA9IDA7IGkyIDwgbzI7ICsraTIpCiAgICAgICAgICAgICAgbjJbaTJdID0gdGhpc1tpMiArIGUyXTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICB9LCBCbC5wcm90b3R5cGUucmVhZFVJbnRMRSA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGUyIHw9IDAsIHQyIHw9IDAsIG4yIHx8IGVwKGUyLCB0MiwgdGhpcy5sZW5ndGgpOwogICAgICAgICAgZm9yICh2YXIgcjIgPSB0aGlzW2UyXSwgbzIgPSAxLCBpMiA9IDA7ICsraTIgPCB0MiAmJiAobzIgKj0gMjU2KTsgKQogICAgICAgICAgICByMiArPSB0aGlzW2UyICsgaTJdICogbzI7CiAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLnJlYWRVSW50QkUgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBlMiB8PSAwLCB0MiB8PSAwLCBuMiB8fCBlcChlMiwgdDIsIHRoaXMubGVuZ3RoKTsKICAgICAgICAgIGZvciAodmFyIHIyID0gdGhpc1tlMiArIC0tdDJdLCBvMiA9IDE7IHQyID4gMCAmJiAobzIgKj0gMjU2KTsgKQogICAgICAgICAgICByMiArPSB0aGlzW2UyICsgLS10Ml0gKiBvMjsKICAgICAgICAgIHJldHVybiByMjsKICAgICAgICB9LCBCbC5wcm90b3R5cGUucmVhZFVJbnQ4ID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIgfHwgZXAoZTIsIDEsIHRoaXMubGVuZ3RoKSwgdGhpc1tlMl07CiAgICAgICAgfSwgQmwucHJvdG90eXBlLnJlYWRVSW50MTZMRSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHQyIHx8IGVwKGUyLCAyLCB0aGlzLmxlbmd0aCksIHRoaXNbZTJdIHwgdGhpc1tlMiArIDFdIDw8IDg7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLnJlYWRVSW50MTZCRSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHQyIHx8IGVwKGUyLCAyLCB0aGlzLmxlbmd0aCksIHRoaXNbZTJdIDw8IDggfCB0aGlzW2UyICsgMV07CiAgICAgICAgfSwgQmwucHJvdG90eXBlLnJlYWRVSW50MzJMRSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHQyIHx8IGVwKGUyLCA0LCB0aGlzLmxlbmd0aCksICh0aGlzW2UyXSB8IHRoaXNbZTIgKyAxXSA8PCA4IHwgdGhpc1tlMiArIDJdIDw8IDE2KSArIDE2Nzc3MjE2ICogdGhpc1tlMiArIDNdOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5yZWFkVUludDMyQkUgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB0MiB8fCBlcChlMiwgNCwgdGhpcy5sZW5ndGgpLCAxNjc3NzIxNiAqIHRoaXNbZTJdICsgKHRoaXNbZTIgKyAxXSA8PCAxNiB8IHRoaXNbZTIgKyAyXSA8PCA4IHwgdGhpc1tlMiArIDNdKTsKICAgICAgICB9LCBCbC5wcm90b3R5cGUucmVhZEludExFID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgZTIgfD0gMCwgdDIgfD0gMCwgbjIgfHwgZXAoZTIsIHQyLCB0aGlzLmxlbmd0aCk7CiAgICAgICAgICBmb3IgKHZhciByMiA9IHRoaXNbZTJdLCBvMiA9IDEsIGkyID0gMDsgKytpMiA8IHQyICYmIChvMiAqPSAyNTYpOyApCiAgICAgICAgICAgIHIyICs9IHRoaXNbZTIgKyBpMl0gKiBvMjsKICAgICAgICAgIHJldHVybiByMiA+PSAobzIgKj0gMTI4KSAmJiAocjIgLT0gTWF0aC5wb3coMiwgOCAqIHQyKSksIHIyOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5yZWFkSW50QkUgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBlMiB8PSAwLCB0MiB8PSAwLCBuMiB8fCBlcChlMiwgdDIsIHRoaXMubGVuZ3RoKTsKICAgICAgICAgIGZvciAodmFyIHIyID0gdDIsIG8yID0gMSwgaTIgPSB0aGlzW2UyICsgLS1yMl07IHIyID4gMCAmJiAobzIgKj0gMjU2KTsgKQogICAgICAgICAgICBpMiArPSB0aGlzW2UyICsgLS1yMl0gKiBvMjsKICAgICAgICAgIHJldHVybiBpMiA+PSAobzIgKj0gMTI4KSAmJiAoaTIgLT0gTWF0aC5wb3coMiwgOCAqIHQyKSksIGkyOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5yZWFkSW50OCA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHQyIHx8IGVwKGUyLCAxLCB0aGlzLmxlbmd0aCksIDEyOCAmIHRoaXNbZTJdID8gLTEgKiAoMjU1IC0gdGhpc1tlMl0gKyAxKSA6IHRoaXNbZTJdOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5yZWFkSW50MTZMRSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgdDIgfHwgZXAoZTIsIDIsIHRoaXMubGVuZ3RoKTsKICAgICAgICAgIHZhciBuMiA9IHRoaXNbZTJdIHwgdGhpc1tlMiArIDFdIDw8IDg7CiAgICAgICAgICByZXR1cm4gMzI3NjggJiBuMiA/IDQyOTQ5MDE3NjAgfCBuMiA6IG4yOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5yZWFkSW50MTZCRSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgdDIgfHwgZXAoZTIsIDIsIHRoaXMubGVuZ3RoKTsKICAgICAgICAgIHZhciBuMiA9IHRoaXNbZTIgKyAxXSB8IHRoaXNbZTJdIDw8IDg7CiAgICAgICAgICByZXR1cm4gMzI3NjggJiBuMiA/IDQyOTQ5MDE3NjAgfCBuMiA6IG4yOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5yZWFkSW50MzJMRSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHQyIHx8IGVwKGUyLCA0LCB0aGlzLmxlbmd0aCksIHRoaXNbZTJdIHwgdGhpc1tlMiArIDFdIDw8IDggfCB0aGlzW2UyICsgMl0gPDwgMTYgfCB0aGlzW2UyICsgM10gPDwgMjQ7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLnJlYWRJbnQzMkJFID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIgfHwgZXAoZTIsIDQsIHRoaXMubGVuZ3RoKSwgdGhpc1tlMl0gPDwgMjQgfCB0aGlzW2UyICsgMV0gPDwgMTYgfCB0aGlzW2UyICsgMl0gPDwgOCB8IHRoaXNbZTIgKyAzXTsKICAgICAgICB9LCBCbC5wcm90b3R5cGUucmVhZEZsb2F0TEUgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB0MiB8fCBlcChlMiwgNCwgdGhpcy5sZW5ndGgpLCBBbCh0aGlzLCBlMiwgdHJ1ZSwgMjMsIDQpOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5yZWFkRmxvYXRCRSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHQyIHx8IGVwKGUyLCA0LCB0aGlzLmxlbmd0aCksIEFsKHRoaXMsIGUyLCBmYWxzZSwgMjMsIDQpOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5yZWFkRG91YmxlTEUgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB0MiB8fCBlcChlMiwgOCwgdGhpcy5sZW5ndGgpLCBBbCh0aGlzLCBlMiwgdHJ1ZSwgNTIsIDgpOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5yZWFkRG91YmxlQkUgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB0MiB8fCBlcChlMiwgOCwgdGhpcy5sZW5ndGgpLCBBbCh0aGlzLCBlMiwgZmFsc2UsIDUyLCA4KTsKICAgICAgICB9LCBCbC5wcm90b3R5cGUud3JpdGVVSW50TEUgPSBmdW5jdGlvbihlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgKGUyID0gK2UyLCB0MiB8PSAwLCBuMiB8PSAwLCByMikgfHwgdHAodGhpcywgZTIsIHQyLCBuMiwgTWF0aC5wb3coMiwgOCAqIG4yKSAtIDEsIDApOwogICAgICAgICAgdmFyIG8yID0gMSwgaTIgPSAwOwogICAgICAgICAgZm9yICh0aGlzW3QyXSA9IDI1NSAmIGUyOyArK2kyIDwgbjIgJiYgKG8yICo9IDI1Nik7ICkKICAgICAgICAgICAgdGhpc1t0MiArIGkyXSA9IGUyIC8gbzIgJiAyNTU7CiAgICAgICAgICByZXR1cm4gdDIgKyBuMjsKICAgICAgICB9LCBCbC5wcm90b3R5cGUud3JpdGVVSW50QkUgPSBmdW5jdGlvbihlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgKGUyID0gK2UyLCB0MiB8PSAwLCBuMiB8PSAwLCByMikgfHwgdHAodGhpcywgZTIsIHQyLCBuMiwgTWF0aC5wb3coMiwgOCAqIG4yKSAtIDEsIDApOwogICAgICAgICAgdmFyIG8yID0gbjIgLSAxLCBpMiA9IDE7CiAgICAgICAgICBmb3IgKHRoaXNbdDIgKyBvMl0gPSAyNTUgJiBlMjsgLS1vMiA+PSAwICYmIChpMiAqPSAyNTYpOyApCiAgICAgICAgICAgIHRoaXNbdDIgKyBvMl0gPSBlMiAvIGkyICYgMjU1OwogICAgICAgICAgcmV0dXJuIHQyICsgbjI7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLndyaXRlVUludDggPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gZTIgPSArZTIsIHQyIHw9IDAsIG4yIHx8IHRwKHRoaXMsIGUyLCB0MiwgMSwgMjU1LCAwKSwgQmwuVFlQRURfQVJSQVlfU1VQUE9SVCB8fCAoZTIgPSBNYXRoLmZsb29yKGUyKSksIHRoaXNbdDJdID0gMjU1ICYgZTIsIHQyICsgMTsKICAgICAgICB9LCBCbC5wcm90b3R5cGUud3JpdGVVSW50MTZMRSA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBlMiA9ICtlMiwgdDIgfD0gMCwgbjIgfHwgdHAodGhpcywgZTIsIHQyLCAyLCA2NTUzNSwgMCksIEJsLlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAodGhpc1t0Ml0gPSAyNTUgJiBlMiwgdGhpc1t0MiArIDFdID0gZTIgPj4+IDgpIDogbnAodGhpcywgZTIsIHQyLCB0cnVlKSwgdDIgKyAyOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS53cml0ZVVJbnQxNkJFID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIGUyID0gK2UyLCB0MiB8PSAwLCBuMiB8fCB0cCh0aGlzLCBlMiwgdDIsIDIsIDY1NTM1LCAwKSwgQmwuVFlQRURfQVJSQVlfU1VQUE9SVCA/ICh0aGlzW3QyXSA9IGUyID4+PiA4LCB0aGlzW3QyICsgMV0gPSAyNTUgJiBlMikgOiBucCh0aGlzLCBlMiwgdDIsIGZhbHNlKSwgdDIgKyAyOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS53cml0ZVVJbnQzMkxFID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIGUyID0gK2UyLCB0MiB8PSAwLCBuMiB8fCB0cCh0aGlzLCBlMiwgdDIsIDQsIDQyOTQ5NjcyOTUsIDApLCBCbC5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKHRoaXNbdDIgKyAzXSA9IGUyID4+PiAyNCwgdGhpc1t0MiArIDJdID0gZTIgPj4+IDE2LCB0aGlzW3QyICsgMV0gPSBlMiA+Pj4gOCwgdGhpc1t0Ml0gPSAyNTUgJiBlMikgOiBycCh0aGlzLCBlMiwgdDIsIHRydWUpLCB0MiArIDQ7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLndyaXRlVUludDMyQkUgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gZTIgPSArZTIsIHQyIHw9IDAsIG4yIHx8IHRwKHRoaXMsIGUyLCB0MiwgNCwgNDI5NDk2NzI5NSwgMCksIEJsLlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAodGhpc1t0Ml0gPSBlMiA+Pj4gMjQsIHRoaXNbdDIgKyAxXSA9IGUyID4+PiAxNiwgdGhpc1t0MiArIDJdID0gZTIgPj4+IDgsIHRoaXNbdDIgKyAzXSA9IDI1NSAmIGUyKSA6IHJwKHRoaXMsIGUyLCB0MiwgZmFsc2UpLCB0MiArIDQ7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLndyaXRlSW50TEUgPSBmdW5jdGlvbihlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgaWYgKGUyID0gK2UyLCB0MiB8PSAwLCAhcjIpIHsKICAgICAgICAgICAgdmFyIG8yID0gTWF0aC5wb3coMiwgOCAqIG4yIC0gMSk7CiAgICAgICAgICAgIHRwKHRoaXMsIGUyLCB0MiwgbjIsIG8yIC0gMSwgLW8yKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBpMiA9IDAsIHUyID0gMSwgczIgPSAwOwogICAgICAgICAgZm9yICh0aGlzW3QyXSA9IDI1NSAmIGUyOyArK2kyIDwgbjIgJiYgKHUyICo9IDI1Nik7ICkKICAgICAgICAgICAgZTIgPCAwICYmIHMyID09PSAwICYmIHRoaXNbdDIgKyBpMiAtIDFdICE9PSAwICYmIChzMiA9IDEpLCB0aGlzW3QyICsgaTJdID0gKGUyIC8gdTIgPj4gMCkgLSBzMiAmIDI1NTsKICAgICAgICAgIHJldHVybiB0MiArIG4yOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS53cml0ZUludEJFID0gZnVuY3Rpb24oZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIGlmIChlMiA9ICtlMiwgdDIgfD0gMCwgIXIyKSB7CiAgICAgICAgICAgIHZhciBvMiA9IE1hdGgucG93KDIsIDggKiBuMiAtIDEpOwogICAgICAgICAgICB0cCh0aGlzLCBlMiwgdDIsIG4yLCBvMiAtIDEsIC1vMik7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaTIgPSBuMiAtIDEsIHUyID0gMSwgczIgPSAwOwogICAgICAgICAgZm9yICh0aGlzW3QyICsgaTJdID0gMjU1ICYgZTI7IC0taTIgPj0gMCAmJiAodTIgKj0gMjU2KTsgKQogICAgICAgICAgICBlMiA8IDAgJiYgczIgPT09IDAgJiYgdGhpc1t0MiArIGkyICsgMV0gIT09IDAgJiYgKHMyID0gMSksIHRoaXNbdDIgKyBpMl0gPSAoZTIgLyB1MiA+PiAwKSAtIHMyICYgMjU1OwogICAgICAgICAgcmV0dXJuIHQyICsgbjI7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLndyaXRlSW50OCA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBlMiA9ICtlMiwgdDIgfD0gMCwgbjIgfHwgdHAodGhpcywgZTIsIHQyLCAxLCAxMjcsIC0xMjgpLCBCbC5UWVBFRF9BUlJBWV9TVVBQT1JUIHx8IChlMiA9IE1hdGguZmxvb3IoZTIpKSwgZTIgPCAwICYmIChlMiA9IDI1NSArIGUyICsgMSksIHRoaXNbdDJdID0gMjU1ICYgZTIsIHQyICsgMTsKICAgICAgICB9LCBCbC5wcm90b3R5cGUud3JpdGVJbnQxNkxFID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIGUyID0gK2UyLCB0MiB8PSAwLCBuMiB8fCB0cCh0aGlzLCBlMiwgdDIsIDIsIDMyNzY3LCAtMzI3NjgpLCBCbC5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKHRoaXNbdDJdID0gMjU1ICYgZTIsIHRoaXNbdDIgKyAxXSA9IGUyID4+PiA4KSA6IG5wKHRoaXMsIGUyLCB0MiwgdHJ1ZSksIHQyICsgMjsKICAgICAgICB9LCBCbC5wcm90b3R5cGUud3JpdGVJbnQxNkJFID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIGUyID0gK2UyLCB0MiB8PSAwLCBuMiB8fCB0cCh0aGlzLCBlMiwgdDIsIDIsIDMyNzY3LCAtMzI3NjgpLCBCbC5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKHRoaXNbdDJdID0gZTIgPj4+IDgsIHRoaXNbdDIgKyAxXSA9IDI1NSAmIGUyKSA6IG5wKHRoaXMsIGUyLCB0MiwgZmFsc2UpLCB0MiArIDI7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLndyaXRlSW50MzJMRSA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBlMiA9ICtlMiwgdDIgfD0gMCwgbjIgfHwgdHAodGhpcywgZTIsIHQyLCA0LCAyMTQ3NDgzNjQ3LCAtMjE0NzQ4MzY0OCksIEJsLlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAodGhpc1t0Ml0gPSAyNTUgJiBlMiwgdGhpc1t0MiArIDFdID0gZTIgPj4+IDgsIHRoaXNbdDIgKyAyXSA9IGUyID4+PiAxNiwgdGhpc1t0MiArIDNdID0gZTIgPj4+IDI0KSA6IHJwKHRoaXMsIGUyLCB0MiwgdHJ1ZSksIHQyICsgNDsKICAgICAgICB9LCBCbC5wcm90b3R5cGUud3JpdGVJbnQzMkJFID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIGUyID0gK2UyLCB0MiB8PSAwLCBuMiB8fCB0cCh0aGlzLCBlMiwgdDIsIDQsIDIxNDc0ODM2NDcsIC0yMTQ3NDgzNjQ4KSwgZTIgPCAwICYmIChlMiA9IDQyOTQ5NjcyOTUgKyBlMiArIDEpLCBCbC5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKHRoaXNbdDJdID0gZTIgPj4+IDI0LCB0aGlzW3QyICsgMV0gPSBlMiA+Pj4gMTYsIHRoaXNbdDIgKyAyXSA9IGUyID4+PiA4LCB0aGlzW3QyICsgM10gPSAyNTUgJiBlMikgOiBycCh0aGlzLCBlMiwgdDIsIGZhbHNlKSwgdDIgKyA0OwogICAgICAgIH0sIEJsLnByb3RvdHlwZS53cml0ZUZsb2F0TEUgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gaXAodGhpcywgZTIsIHQyLCB0cnVlLCBuMik7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLndyaXRlRmxvYXRCRSA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBpcCh0aGlzLCBlMiwgdDIsIGZhbHNlLCBuMik7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLndyaXRlRG91YmxlTEUgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gdXAodGhpcywgZTIsIHQyLCB0cnVlLCBuMik7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLndyaXRlRG91YmxlQkUgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gdXAodGhpcywgZTIsIHQyLCBmYWxzZSwgbjIpOwogICAgICAgIH0sIEJsLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24oZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIGlmIChuMiB8fCAobjIgPSAwKSwgcjIgfHwgcjIgPT09IDAgfHwgKHIyID0gdGhpcy5sZW5ndGgpLCB0MiA+PSBlMi5sZW5ndGggJiYgKHQyID0gZTIubGVuZ3RoKSwgdDIgfHwgKHQyID0gMCksIHIyID4gMCAmJiByMiA8IG4yICYmIChyMiA9IG4yKSwgcjIgPT09IG4yKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIGlmIChlMi5sZW5ndGggPT09IDAgfHwgdGhpcy5sZW5ndGggPT09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgaWYgKHQyIDwgMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoInRhcmdldFN0YXJ0IG91dCBvZiBib3VuZHMiKTsKICAgICAgICAgIGlmIChuMiA8IDAgfHwgbjIgPj0gdGhpcy5sZW5ndGgpCiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJzb3VyY2VTdGFydCBvdXQgb2YgYm91bmRzIik7CiAgICAgICAgICBpZiAocjIgPCAwKQogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigic291cmNlRW5kIG91dCBvZiBib3VuZHMiKTsKICAgICAgICAgIHIyID4gdGhpcy5sZW5ndGggJiYgKHIyID0gdGhpcy5sZW5ndGgpLCBlMi5sZW5ndGggLSB0MiA8IHIyIC0gbjIgJiYgKHIyID0gZTIubGVuZ3RoIC0gdDIgKyBuMik7CiAgICAgICAgICB2YXIgbzIsIGkyID0gcjIgLSBuMjsKICAgICAgICAgIGlmICh0aGlzID09PSBlMiAmJiBuMiA8IHQyICYmIHQyIDwgcjIpCiAgICAgICAgICAgIGZvciAobzIgPSBpMiAtIDE7IG8yID49IDA7IC0tbzIpCiAgICAgICAgICAgICAgZTJbbzIgKyB0Ml0gPSB0aGlzW28yICsgbjJdOwogICAgICAgICAgZWxzZSBpZiAoaTIgPCAxZTMgfHwgIUJsLlRZUEVEX0FSUkFZX1NVUFBPUlQpCiAgICAgICAgICAgIGZvciAobzIgPSAwOyBvMiA8IGkyOyArK28yKQogICAgICAgICAgICAgIGUyW28yICsgdDJdID0gdGhpc1tvMiArIG4yXTsKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgVWludDhBcnJheS5wcm90b3R5cGUuc2V0LmNhbGwoZTIsIHRoaXMuc3ViYXJyYXkobjIsIG4yICsgaTIpLCB0Mik7CiAgICAgICAgICByZXR1cm4gaTI7CiAgICAgICAgfSwgQmwucHJvdG90eXBlLmZpbGwgPSBmdW5jdGlvbihlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgaWYgKHR5cGVvZiBlMiA9PSAic3RyaW5nIikgewogICAgICAgICAgICBpZiAodHlwZW9mIHQyID09ICJzdHJpbmciID8gKHIyID0gdDIsIHQyID0gMCwgbjIgPSB0aGlzLmxlbmd0aCkgOiB0eXBlb2YgbjIgPT0gInN0cmluZyIgJiYgKHIyID0gbjIsIG4yID0gdGhpcy5sZW5ndGgpLCBlMi5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICB2YXIgbzIgPSBlMi5jaGFyQ29kZUF0KDApOwogICAgICAgICAgICAgIG8yIDwgMjU2ICYmIChlMiA9IG8yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocjIgIT09IHZvaWQgMCAmJiB0eXBlb2YgcjIgIT0gInN0cmluZyIpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiZW5jb2RpbmcgbXVzdCBiZSBhIHN0cmluZyIpOwogICAgICAgICAgICBpZiAodHlwZW9mIHIyID09ICJzdHJpbmciICYmICFCbC5pc0VuY29kaW5nKHIyKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGVuY29kaW5nOiAiICsgcjIpOwogICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHR5cGVvZiBlMiA9PSAibnVtYmVyIiAmJiAoZTIgJj0gMjU1KTsKICAgICAgICAgIGlmICh0MiA8IDAgfHwgdGhpcy5sZW5ndGggPCB0MiB8fCB0aGlzLmxlbmd0aCA8IG4yKQogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiT3V0IG9mIHJhbmdlIGluZGV4Iik7CiAgICAgICAgICBpZiAobjIgPD0gdDIpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgdmFyIGkyOwogICAgICAgICAgaWYgKHQyID4+Pj0gMCwgbjIgPSBuMiA9PT0gdm9pZCAwID8gdGhpcy5sZW5ndGggOiBuMiA+Pj4gMCwgZTIgfHwgKGUyID0gMCksIHR5cGVvZiBlMiA9PSAibnVtYmVyIikKICAgICAgICAgICAgZm9yIChpMiA9IHQyOyBpMiA8IG4yOyArK2kyKQogICAgICAgICAgICAgIHRoaXNbaTJdID0gZTI7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdmFyIHUyID0gTGwoZTIpID8gZTIgOiBjcChuZXcgQmwoZTIsIHIyKS50b1N0cmluZygpKSwgczIgPSB1Mi5sZW5ndGg7CiAgICAgICAgICAgIGZvciAoaTIgPSAwOyBpMiA8IG4yIC0gdDI7ICsraTIpCiAgICAgICAgICAgICAgdGhpc1tpMiArIHQyXSA9IHUyW2kyICUgczJdOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfTsKICAgICAgICB2YXIgc3AgPSAvW14rXC8wLTlBLVphLXotX10vZzsKICAgICAgICBmdW5jdGlvbiBhcChlMikgewogICAgICAgICAgcmV0dXJuIGUyIDwgMTYgPyAiMCIgKyBlMi50b1N0cmluZygxNikgOiBlMi50b1N0cmluZygxNik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNwKGUyLCB0MikgewogICAgICAgICAgdmFyIG4yOwogICAgICAgICAgdDIgPSB0MiB8fCAxIC8gMDsKICAgICAgICAgIGZvciAodmFyIHIyID0gZTIubGVuZ3RoLCBvMiA9IG51bGwsIGkyID0gW10sIHUyID0gMDsgdTIgPCByMjsgKyt1MikgewogICAgICAgICAgICBpZiAoKG4yID0gZTIuY2hhckNvZGVBdCh1MikpID4gNTUyOTUgJiYgbjIgPCA1NzM0NCkgewogICAgICAgICAgICAgIGlmICghbzIpIHsKICAgICAgICAgICAgICAgIGlmIChuMiA+IDU2MzE5KSB7CiAgICAgICAgICAgICAgICAgICh0MiAtPSAzKSA+IC0xICYmIGkyLnB1c2goMjM5LCAxOTEsIDE4OSk7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHUyICsgMSA9PT0gcjIpIHsKICAgICAgICAgICAgICAgICAgKHQyIC09IDMpID4gLTEgJiYgaTIucHVzaCgyMzksIDE5MSwgMTg5KTsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBvMiA9IG4yOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChuMiA8IDU2MzIwKSB7CiAgICAgICAgICAgICAgICAodDIgLT0gMykgPiAtMSAmJiBpMi5wdXNoKDIzOSwgMTkxLCAxODkpLCBvMiA9IG4yOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG4yID0gNjU1MzYgKyAobzIgLSA1NTI5NiA8PCAxMCB8IG4yIC0gNTYzMjApOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBvMiAmJiAodDIgLT0gMykgPiAtMSAmJiBpMi5wdXNoKDIzOSwgMTkxLCAxODkpOwogICAgICAgICAgICBpZiAobzIgPSBudWxsLCBuMiA8IDEyOCkgewogICAgICAgICAgICAgIGlmICgodDIgLT0gMSkgPCAwKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgaTIucHVzaChuMik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobjIgPCAyMDQ4KSB7CiAgICAgICAgICAgICAgaWYgKCh0MiAtPSAyKSA8IDApCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBpMi5wdXNoKG4yID4+IDYgfCAxOTIsIDYzICYgbjIgfCAxMjgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKG4yIDwgNjU1MzYpIHsKICAgICAgICAgICAgICBpZiAoKHQyIC09IDMpIDwgMCkKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGkyLnB1c2gobjIgPj4gMTIgfCAyMjQsIG4yID4+IDYgJiA2MyB8IDEyOCwgNjMgJiBuMiB8IDEyOCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKCEobjIgPCAxMTE0MTEyKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBjb2RlIHBvaW50Iik7CiAgICAgICAgICAgICAgaWYgKCh0MiAtPSA0KSA8IDApCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBpMi5wdXNoKG4yID4+IDE4IHwgMjQwLCBuMiA+PiAxMiAmIDYzIHwgMTI4LCBuMiA+PiA2ICYgNjMgfCAxMjgsIDYzICYgbjIgfCAxMjgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGxwKGUyKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgdmFyIHQyLCBuMiwgcjIsIG8yLCBpMiwgdTI7CiAgICAgICAgICAgIEVsIHx8IENsKCk7CiAgICAgICAgICAgIHZhciBzMiA9IGUzLmxlbmd0aDsKICAgICAgICAgICAgaWYgKHMyICUgNCA+IDApCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHN0cmluZy4gTGVuZ3RoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA0Iik7CiAgICAgICAgICAgIGkyID0gZTNbczIgLSAyXSA9PT0gIj0iID8gMiA6IGUzW3MyIC0gMV0gPT09ICI9IiA/IDEgOiAwLCB1MiA9IG5ldyBEbCgzICogczIgLyA0IC0gaTIpLCByMiA9IGkyID4gMCA/IHMyIC0gNCA6IHMyOwogICAgICAgICAgICB2YXIgYTIgPSAwOwogICAgICAgICAgICBmb3IgKHQyID0gMCwgbjIgPSAwOyB0MiA8IHIyOyB0MiArPSA0LCBuMiArPSAzKQogICAgICAgICAgICAgIG8yID0geWxbZTMuY2hhckNvZGVBdCh0MildIDw8IDE4IHwgeWxbZTMuY2hhckNvZGVBdCh0MiArIDEpXSA8PCAxMiB8IHlsW2UzLmNoYXJDb2RlQXQodDIgKyAyKV0gPDwgNiB8IHlsW2UzLmNoYXJDb2RlQXQodDIgKyAzKV0sIHUyW2EyKytdID0gbzIgPj4gMTYgJiAyNTUsIHUyW2EyKytdID0gbzIgPj4gOCAmIDI1NSwgdTJbYTIrK10gPSAyNTUgJiBvMjsKICAgICAgICAgICAgcmV0dXJuIGkyID09PSAyID8gKG8yID0geWxbZTMuY2hhckNvZGVBdCh0MildIDw8IDIgfCB5bFtlMy5jaGFyQ29kZUF0KHQyICsgMSldID4+IDQsIHUyW2EyKytdID0gMjU1ICYgbzIpIDogaTIgPT09IDEgJiYgKG8yID0geWxbZTMuY2hhckNvZGVBdCh0MildIDw8IDEwIHwgeWxbZTMuY2hhckNvZGVBdCh0MiArIDEpXSA8PCA0IHwgeWxbZTMuY2hhckNvZGVBdCh0MiArIDIpXSA+PiAyLCB1MlthMisrXSA9IG8yID4+IDggJiAyNTUsIHUyW2EyKytdID0gMjU1ICYgbzIpLCB1MjsKICAgICAgICAgIH0oZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgaWYgKChlMyA9IGZ1bmN0aW9uKGU0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGU0LnRyaW0gPyBlNC50cmltKCkgOiBlNC5yZXBsYWNlKC9eXHMrfFxzKyQvZywgIiIpOwogICAgICAgICAgICB9KGUzKS5yZXBsYWNlKHNwLCAiIikpLmxlbmd0aCA8IDIpCiAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICBmb3IgKDsgZTMubGVuZ3RoICUgNCAhPSAwOyApCiAgICAgICAgICAgICAgZTMgKz0gIj0iOwogICAgICAgICAgICByZXR1cm4gZTM7CiAgICAgICAgICB9KGUyKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHBwKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICBmb3IgKHZhciBvMiA9IDA7IG8yIDwgcjIgJiYgIShvMiArIG4yID49IHQyLmxlbmd0aCB8fCBvMiA+PSBlMi5sZW5ndGgpOyArK28yKQogICAgICAgICAgICB0MltvMiArIG4yXSA9IGUyW28yXTsKICAgICAgICAgIHJldHVybiBvMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZnAoZTIpIHsKICAgICAgICAgIHJldHVybiBlMiAhPSBudWxsICYmICghIWUyLl9pc0J1ZmZlciB8fCBkcChlMikgfHwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBlMy5yZWFkRmxvYXRMRSA9PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBlMy5zbGljZSA9PSAiZnVuY3Rpb24iICYmIGRwKGUzLnNsaWNlKDAsIDApKTsKICAgICAgICAgIH0oZTIpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZHAoZTIpIHsKICAgICAgICAgIHJldHVybiAhIWUyLmNvbnN0cnVjdG9yICYmIHR5cGVvZiBlMi5jb25zdHJ1Y3Rvci5pc0J1ZmZlciA9PSAiZnVuY3Rpb24iICYmIGUyLmNvbnN0cnVjdG9yLmlzQnVmZmVyKGUyKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgaHAgPSBlbDsKICAgICAgICB2YXIgZ3AgPSBjbGFzcyB7CiAgICAgICAgICBjb25zdHJ1Y3RvcihlMiwgdDIpIHsKICAgICAgICAgICAgKHQyID0gdDIgfHwge30pLnJlYWRDaHVuayB8fCAodDIucmVhZENodW5rID0gMTAyNCksIHQyLm5ld0xpbmVDaGFyYWN0ZXIgPyB0Mi5uZXdMaW5lQ2hhcmFjdGVyID0gdDIubmV3TGluZUNoYXJhY3Rlci5jaGFyQ29kZUF0KDApIDogdDIubmV3TGluZUNoYXJhY3RlciA9IDEwLCB0aGlzLmZkID0gdHlwZW9mIGUyID09ICJudW1iZXIiID8gZTIgOiBocC5vcGVuU3luYyhlMiwgInIiKSwgdGhpcy5vcHRpb25zID0gdDIsIHRoaXMubmV3TGluZUNoYXJhY3RlciA9IHQyLm5ld0xpbmVDaGFyYWN0ZXIsIHRoaXMucmVzZXQoKTsKICAgICAgICAgIH0KICAgICAgICAgIF9zZWFyY2hJbkJ1ZmZlcihlMiwgdDIpIHsKICAgICAgICAgICAgbGV0IG4yID0gLTE7CiAgICAgICAgICAgIGZvciAobGV0IHIyID0gMDsgcjIgPD0gZTIubGVuZ3RoOyByMisrKSB7CiAgICAgICAgICAgICAgaWYgKGUyW3IyXSA9PT0gdDIpIHsKICAgICAgICAgICAgICAgIG4yID0gcjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgICAgfQogICAgICAgICAgcmVzZXQoKSB7CiAgICAgICAgICAgIHRoaXMuZW9mUmVhY2hlZCA9IGZhbHNlLCB0aGlzLmxpbmVzQ2FjaGUgPSBbXSwgdGhpcy5mZFBvc2l0aW9uID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGNsb3NlKCkgewogICAgICAgICAgICBocC5jbG9zZVN5bmModGhpcy5mZCksIHRoaXMuZmQgPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgX2V4dHJhY3RMaW5lcyhlMikgewogICAgICAgICAgICBsZXQgdDI7CiAgICAgICAgICAgIGNvbnN0IG4yID0gW107CiAgICAgICAgICAgIGxldCByMiA9IDAsIG8yID0gMDsKICAgICAgICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgICAgICAgbGV0IGkzID0gZTJbcjIrK107CiAgICAgICAgICAgICAgaWYgKGkzID09PSB0aGlzLm5ld0xpbmVDaGFyYWN0ZXIpCiAgICAgICAgICAgICAgICB0MiA9IGUyLnNsaWNlKG8yLCByMiksIG4yLnB1c2godDIpLCBvMiA9IHIyOwogICAgICAgICAgICAgIGVsc2UgaWYgKGkzID09PSB2b2lkIDApCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgaTIgPSBlMi5zbGljZShvMiwgcjIpOwogICAgICAgICAgICByZXR1cm4gaTIubGVuZ3RoICYmIG4yLnB1c2goaTIpLCBuMjsKICAgICAgICAgIH0KICAgICAgICAgIF9yZWFkQ2h1bmsoZTIpIHsKICAgICAgICAgICAgbGV0IHQyLCBuMiA9IDA7CiAgICAgICAgICAgIGNvbnN0IHIyID0gW107CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IG5ldyBCbCh0aGlzLm9wdGlvbnMucmVhZENodW5rKTsKICAgICAgICAgICAgICB0MiA9IGhwLnJlYWRTeW5jKHRoaXMuZmQsIGUzLCAwLCB0aGlzLm9wdGlvbnMucmVhZENodW5rLCB0aGlzLmZkUG9zaXRpb24pLCBuMiArPSB0MiwgdGhpcy5mZFBvc2l0aW9uID0gdGhpcy5mZFBvc2l0aW9uICsgdDIsIHIyLnB1c2goZTMpOwogICAgICAgICAgICB9IHdoaWxlICh0MiAmJiB0aGlzLl9zZWFyY2hJbkJ1ZmZlcihyMltyMi5sZW5ndGggLSAxXSwgdGhpcy5vcHRpb25zLm5ld0xpbmVDaGFyYWN0ZXIpID09PSAtMSk7CiAgICAgICAgICAgIGxldCBvMiA9IEJsLmNvbmNhdChyMik7CiAgICAgICAgICAgIHJldHVybiB0MiA8IHRoaXMub3B0aW9ucy5yZWFkQ2h1bmsgJiYgKHRoaXMuZW9mUmVhY2hlZCA9IHRydWUsIG8yID0gbzIuc2xpY2UoMCwgbjIpKSwgbjIgJiYgKHRoaXMubGluZXNDYWNoZSA9IHRoaXMuX2V4dHJhY3RMaW5lcyhvMiksIGUyICYmICh0aGlzLmxpbmVzQ2FjaGVbMF0gPSBCbC5jb25jYXQoW2UyLCB0aGlzLmxpbmVzQ2FjaGVbMF1dKSkpLCBuMjsKICAgICAgICAgIH0KICAgICAgICAgIG5leHQoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5mZCkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGxldCBlMiwgdDIgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuZW9mUmVhY2hlZCAmJiB0aGlzLmxpbmVzQ2FjaGUubGVuZ3RoID09PSAwKQogICAgICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICAgICAgaWYgKHRoaXMubGluZXNDYWNoZS5sZW5ndGggfHwgKGUyID0gdGhpcy5fcmVhZENodW5rKCkpLCB0aGlzLmxpbmVzQ2FjaGUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdDIgPSB0aGlzLmxpbmVzQ2FjaGUuc2hpZnQoKTsKICAgICAgICAgICAgICB0Mlt0Mi5sZW5ndGggLSAxXSAhPT0gdGhpcy5uZXdMaW5lQ2hhcmFjdGVyICYmIChlMiA9IHRoaXMuX3JlYWRDaHVuayh0MiksIGUyICYmICh0MiA9IHRoaXMubGluZXNDYWNoZS5zaGlmdCgpKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW9mUmVhY2hlZCAmJiB0aGlzLmxpbmVzQ2FjaGUubGVuZ3RoID09PSAwICYmIHRoaXMuY2xvc2UoKSwgdDIgJiYgdDJbdDIubGVuZ3RoIC0gMV0gPT09IHRoaXMubmV3TGluZUNoYXJhY3RlciAmJiAodDIgPSB0Mi5zbGljZSgwLCB0Mi5sZW5ndGggLSAxKSksIHQyOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY2xhc3MgbXAgZXh0ZW5kcyBFcnJvciB7CiAgICAgICAgfQogICAgICAgIGNsYXNzIHlwIGV4dGVuZHMgRXJyb3IgewogICAgICAgIH0KICAgICAgICBjbGFzcyBEcCBleHRlbmRzIEVycm9yIHsKICAgICAgICB9CiAgICAgICAgY2xhc3MgRXAgZXh0ZW5kcyBFcnJvciB7CiAgICAgICAgfQogICAgICAgIHZhciBDcCA9IHsgQ29uZmlnRXJyb3I6IG1wLCBEZWJ1Z0Vycm9yOiB5cCwgVW5kZWZpbmVkUGFyc2VyRXJyb3I6IERwLCBBcmdFeHBhbnNpb25CYWlsb3V0OiBFcCB9LCBicCA9IHt9LCB2cCA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHZwID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIGUzLl9fcHJvdG9fXyA9IHQzOwogICAgICAgICAgfSB8fCBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgZm9yICh2YXIgbjIgaW4gdDMpCiAgICAgICAgICAgICAgdDMuaGFzT3duUHJvcGVydHkobjIpICYmIChlM1tuMl0gPSB0M1tuMl0pOwogICAgICAgICAgfSwgdnAoZTIsIHQyKTsKICAgICAgICB9OwogICAgICAgIHZhciBBcCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIEFwID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbihlMikgewogICAgICAgICAgICBmb3IgKHZhciB0MiwgbjIgPSAxLCByMiA9IGFyZ3VtZW50cy5sZW5ndGg7IG4yIDwgcjI7IG4yKyspCiAgICAgICAgICAgICAgZm9yICh2YXIgbzIgaW4gdDIgPSBhcmd1bWVudHNbbjJdKQogICAgICAgICAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQyLCBvMikgJiYgKGUyW28yXSA9IHQyW28yXSk7CiAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICAgIH0sIEFwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBGcChlMikgewogICAgICAgICAgdmFyIHQyID0gdHlwZW9mIFN5bWJvbCA9PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbjIgPSB0MiAmJiBlMlt0Ml0sIHIyID0gMDsKICAgICAgICAgIGlmIChuMikKICAgICAgICAgICAgcmV0dXJuIG4yLmNhbGwoZTIpOwogICAgICAgICAgaWYgKGUyICYmIHR5cGVvZiBlMi5sZW5ndGggPT0gIm51bWJlciIpCiAgICAgICAgICAgIHJldHVybiB7IG5leHQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBlMiAmJiByMiA+PSBlMi5sZW5ndGggJiYgKGUyID0gdm9pZCAwKSwgeyB2YWx1ZTogZTIgJiYgZTJbcjIrK10sIGRvbmU6ICFlMiB9OwogICAgICAgICAgICB9IH07CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHQyID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHhwKGUyLCB0MikgewogICAgICAgICAgdmFyIG4yID0gdHlwZW9mIFN5bWJvbCA9PSAiZnVuY3Rpb24iICYmIGUyW1N5bWJvbC5pdGVyYXRvcl07CiAgICAgICAgICBpZiAoIW4yKQogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICB2YXIgcjIsIG8yLCBpMiA9IG4yLmNhbGwoZTIpLCB1MiA9IFtdOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yICg7ICh0MiA9PT0gdm9pZCAwIHx8IHQyLS0gPiAwKSAmJiAhKHIyID0gaTIubmV4dCgpKS5kb25lOyApCiAgICAgICAgICAgICAgdTIucHVzaChyMi52YWx1ZSk7CiAgICAgICAgICB9IGNhdGNoIChlMykgewogICAgICAgICAgICBvMiA9IHsgZXJyb3I6IGUzIH07CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHIyICYmICFyMi5kb25lICYmIChuMiA9IGkyLnJldHVybikgJiYgbjIuY2FsbChpMik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgaWYgKG8yKQogICAgICAgICAgICAgICAgdGhyb3cgbzIuZXJyb3I7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB1MjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gU3AoZTIpIHsKICAgICAgICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgU3AgPyAodGhpcy52ID0gZTIsIHRoaXMpIDogbmV3IFNwKGUyKTsKICAgICAgICB9CiAgICAgICAgdmFyIHdwID0gT2JqZWN0LmZyZWV6ZSh7IF9fcHJvdG9fXzogbnVsbCwgX19leHRlbmRzOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGZ1bmN0aW9uIG4yKCkgewogICAgICAgICAgICB0aGlzLmNvbnN0cnVjdG9yID0gZTI7CiAgICAgICAgICB9CiAgICAgICAgICB2cChlMiwgdDIpLCBlMi5wcm90b3R5cGUgPSB0MiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUodDIpIDogKG4yLnByb3RvdHlwZSA9IHQyLnByb3RvdHlwZSwgbmV3IG4yKCkpOwogICAgICAgIH0sIGdldCBfX2Fzc2lnbigpIHsKICAgICAgICAgIHJldHVybiBBcDsKICAgICAgICB9LCBfX3Jlc3Q6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgdmFyIG4yID0ge307CiAgICAgICAgICBmb3IgKHZhciByMiBpbiBlMikKICAgICAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUyLCByMikgJiYgdDIuaW5kZXhPZihyMikgPCAwICYmIChuMltyMl0gPSBlMltyMl0pOwogICAgICAgICAgaWYgKGUyICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICB2YXIgbzIgPSAwOwogICAgICAgICAgICBmb3IgKHIyID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlMik7IG8yIDwgcjIubGVuZ3RoOyBvMisrKQogICAgICAgICAgICAgIHQyLmluZGV4T2YocjJbbzJdKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKGUyLCByMltvMl0pICYmIChuMltyMltvMl1dID0gZTJbcjJbbzJdXSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgfSwgX19kZWNvcmF0ZTogZnVuY3Rpb24oZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIHZhciBvMiwgaTIgPSBhcmd1bWVudHMubGVuZ3RoLCB1MiA9IGkyIDwgMyA/IHQyIDogcjIgPT09IG51bGwgPyByMiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodDIsIG4yKSA6IHIyOwogICAgICAgICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09ICJvYmplY3QiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09ICJmdW5jdGlvbiIpCiAgICAgICAgICAgIHUyID0gUmVmbGVjdC5kZWNvcmF0ZShlMiwgdDIsIG4yLCByMik7CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIGZvciAodmFyIHMyID0gZTIubGVuZ3RoIC0gMTsgczIgPj0gMDsgczItLSkKICAgICAgICAgICAgICAobzIgPSBlMltzMl0pICYmICh1MiA9IChpMiA8IDMgPyBvMih1MikgOiBpMiA+IDMgPyBvMih0MiwgbjIsIHUyKSA6IG8yKHQyLCBuMikpIHx8IHUyKTsKICAgICAgICAgIHJldHVybiBpMiA+IDMgJiYgdTIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQyLCBuMiwgdTIpLCB1MjsKICAgICAgICB9LCBfX3BhcmFtOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihuMiwgcjIpIHsKICAgICAgICAgICAgdDIobjIsIHIyLCBlMik7CiAgICAgICAgICB9OwogICAgICAgIH0sIF9fbWV0YWRhdGE6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09ICJvYmplY3QiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09ICJmdW5jdGlvbiIpCiAgICAgICAgICAgIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKGUyLCB0Mik7CiAgICAgICAgfSwgX19hd2FpdGVyOiBmdW5jdGlvbihlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgcmV0dXJuIG5ldyAobjIgfHwgKG4yID0gUHJvbWlzZSkpKGZ1bmN0aW9uKG8yLCBpMikgewogICAgICAgICAgICBmdW5jdGlvbiB1MihlMykgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhMihyMi5uZXh0KGUzKSk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZTQpIHsKICAgICAgICAgICAgICAgIGkyKGU0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gczIoZTMpIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYTIocjIudGhyb3coZTMpKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlNCkgewogICAgICAgICAgICAgICAgaTIoZTQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBhMihlMykgewogICAgICAgICAgICAgIHZhciB0MzsKICAgICAgICAgICAgICBlMy5kb25lID8gbzIoZTMudmFsdWUpIDogKHQzID0gZTMudmFsdWUsIHQzIGluc3RhbmNlb2YgbjIgPyB0MyA6IG5ldyBuMihmdW5jdGlvbihlNCkgewogICAgICAgICAgICAgICAgZTQodDMpOwogICAgICAgICAgICAgIH0pKS50aGVuKHUyLCBzMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYTIoKHIyID0gcjIuYXBwbHkoZTIsIHQyIHx8IFtdKSkubmV4dCgpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sIF9fZ2VuZXJhdG9yOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHZhciBuMiwgcjIsIG8yLCBpMiwgdTIgPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKDEgJiBvMlswXSkKICAgICAgICAgICAgICB0aHJvdyBvMlsxXTsKICAgICAgICAgICAgcmV0dXJuIG8yWzFdOwogICAgICAgICAgfSwgdHJ5czogW10sIG9wczogW10gfTsKICAgICAgICAgIHJldHVybiBpMiA9IHsgbmV4dDogczIoMCksIHRocm93OiBzMigxKSwgcmV0dXJuOiBzMigyKSB9LCB0eXBlb2YgU3ltYm9sID09ICJmdW5jdGlvbiIgJiYgKGkyW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICB9KSwgaTI7CiAgICAgICAgICBmdW5jdGlvbiBzMihpMykgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oczMpIHsKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oaTQpIHsKICAgICAgICAgICAgICAgIGlmIChuMikKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLiIpOwogICAgICAgICAgICAgICAgZm9yICg7IHUyOyApCiAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG4yID0gMSwgcjIgJiYgKG8yID0gMiAmIGk0WzBdID8gcjIucmV0dXJuIDogaTRbMF0gPyByMi50aHJvdyB8fCAoKG8yID0gcjIucmV0dXJuKSAmJiBvMi5jYWxsKHIyKSwgMCkgOiByMi5uZXh0KSAmJiAhKG8yID0gbzIuY2FsbChyMiwgaTRbMV0pKS5kb25lKQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG8yOwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocjIgPSAwLCBvMiAmJiAoaTQgPSBbMiAmIGk0WzBdLCBvMi52YWx1ZV0pLCBpNFswXSkgewogICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICBvMiA9IGk0OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHUyLmxhYmVsKyssIHsgdmFsdWU6IGk0WzFdLCBkb25lOiBmYWxzZSB9OwogICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgICB1Mi5sYWJlbCsrLCByMiA9IGk0WzFdLCBpNCA9IFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgICAgIGk0ID0gdTIub3BzLnBvcCgpLCB1Mi50cnlzLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKG8yID0gdTIudHJ5cywgKG8yID0gbzIubGVuZ3RoID4gMCAmJiBvMltvMi5sZW5ndGggLSAxXSkgfHwgaTRbMF0gIT09IDYgJiYgaTRbMF0gIT09IDIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdTIgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpNFswXSA9PT0gMyAmJiAoIW8yIHx8IGk0WzFdID4gbzJbMF0gJiYgaTRbMV0gPCBvMlszXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB1Mi5sYWJlbCA9IGk0WzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpNFswXSA9PT0gNiAmJiB1Mi5sYWJlbCA8IG8yWzFdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdTIubGFiZWwgPSBvMlsxXSwgbzIgPSBpNDsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobzIgJiYgdTIubGFiZWwgPCBvMlsyXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHUyLmxhYmVsID0gbzJbMl0sIHUyLm9wcy5wdXNoKGk0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBvMlsyXSAmJiB1Mi5vcHMucG9wKCksIHUyLnRyeXMucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpNCA9IHQyLmNhbGwoZTIsIHUyKTsKICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZTMpIHsKICAgICAgICAgICAgICAgICAgICBpNCA9IFs2LCBlM10sIHIyID0gMDsKICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBuMiA9IG8yID0gMDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKDUgJiBpNFswXSkKICAgICAgICAgICAgICAgICAgdGhyb3cgaTRbMV07CiAgICAgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogaTRbMF0gPyBpNFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9OwogICAgICAgICAgICAgIH0oW2kzLCBzM10pOwogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgIH0sIF9fY3JlYXRlQmluZGluZzogZnVuY3Rpb24oZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIHIyID09PSB2b2lkIDAgJiYgKHIyID0gbjIpLCBlMltyMl0gPSB0MltuMl07CiAgICAgICAgfSwgX19leHBvcnRTdGFyOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGZvciAodmFyIG4yIGluIGUyKQogICAgICAgICAgICBuMiA9PT0gImRlZmF1bHQiIHx8IHQyLmhhc093blByb3BlcnR5KG4yKSB8fCAodDJbbjJdID0gZTJbbjJdKTsKICAgICAgICB9LCBfX3ZhbHVlczogRnAsIF9fcmVhZDogeHAsIF9fc3ByZWFkOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGZvciAodmFyIGUyID0gW10sIHQyID0gMDsgdDIgPCBhcmd1bWVudHMubGVuZ3RoOyB0MisrKQogICAgICAgICAgICBlMiA9IGUyLmNvbmNhdCh4cChhcmd1bWVudHNbdDJdKSk7CiAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgfSwgX19zcHJlYWRBcnJheXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgZm9yICh2YXIgZTIgPSAwLCB0MiA9IDAsIG4yID0gYXJndW1lbnRzLmxlbmd0aDsgdDIgPCBuMjsgdDIrKykKICAgICAgICAgICAgZTIgKz0gYXJndW1lbnRzW3QyXS5sZW5ndGg7CiAgICAgICAgICB2YXIgcjIgPSBBcnJheShlMiksIG8yID0gMDsKICAgICAgICAgIGZvciAodDIgPSAwOyB0MiA8IG4yOyB0MisrKQogICAgICAgICAgICBmb3IgKHZhciBpMiA9IGFyZ3VtZW50c1t0Ml0sIHUyID0gMCwgczIgPSBpMi5sZW5ndGg7IHUyIDwgczI7IHUyKyssIG8yKyspCiAgICAgICAgICAgICAgcjJbbzJdID0gaTJbdTJdOwogICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgIH0sIF9fYXdhaXQ6IFNwLCBfX2FzeW5jR2VuZXJhdG9yOiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKICAgICAgICAgIHZhciByMiwgbzIgPSBuMi5hcHBseShlMiwgdDIgfHwgW10pLCBpMiA9IFtdOwogICAgICAgICAgcmV0dXJuIHIyID0ge30sIHUyKCJuZXh0IiksIHUyKCJ0aHJvdyIpLCB1MigicmV0dXJuIiksIHIyW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0sIHIyOwogICAgICAgICAgZnVuY3Rpb24gdTIoZTMpIHsKICAgICAgICAgICAgbzJbZTNdICYmIChyMltlM10gPSBmdW5jdGlvbih0MykgewogICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihuMywgcjMpIHsKICAgICAgICAgICAgICAgIGkyLnB1c2goW2UzLCB0MywgbjMsIHIzXSkgPiAxIHx8IHMyKGUzLCB0Myk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gczIoZTMsIHQzKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgKG4zID0gbzJbZTNdKHQzKSkudmFsdWUgaW5zdGFuY2VvZiBTcCA/IFByb21pc2UucmVzb2x2ZShuMy52YWx1ZS52KS50aGVuKGEyLCBjMikgOiBsMihpMlswXVsyXSwgbjMpOwogICAgICAgICAgICB9IGNhdGNoIChlNCkgewogICAgICAgICAgICAgIGwyKGkyWzBdWzNdLCBlNCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG4zOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gYTIoZTMpIHsKICAgICAgICAgICAgczIoIm5leHQiLCBlMyk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjMihlMykgewogICAgICAgICAgICBzMigidGhyb3ciLCBlMyk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBsMihlMywgdDMpIHsKICAgICAgICAgICAgZTModDMpLCBpMi5zaGlmdCgpLCBpMi5sZW5ndGggJiYgczIoaTJbMF1bMF0sIGkyWzBdWzFdKTsKICAgICAgICAgIH0KICAgICAgICB9LCBfX2FzeW5jRGVsZWdhdG9yOiBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyLCBuMjsKICAgICAgICAgIHJldHVybiB0MiA9IHt9LCByMigibmV4dCIpLCByMigidGhyb3ciLCBmdW5jdGlvbihlMykgewogICAgICAgICAgICB0aHJvdyBlMzsKICAgICAgICAgIH0pLCByMigicmV0dXJuIiksIHQyW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICB9LCB0MjsKICAgICAgICAgIGZ1bmN0aW9uIHIyKHIzLCBvMikgewogICAgICAgICAgICB0MltyM10gPSBlMltyM10gPyBmdW5jdGlvbih0MykgewogICAgICAgICAgICAgIHJldHVybiAobjIgPSAhbjIpID8geyB2YWx1ZTogU3AoZTJbcjNdKHQzKSksIGRvbmU6IHIzID09PSAicmV0dXJuIiB9IDogbzIgPyBvMih0MykgOiB0MzsKICAgICAgICAgICAgfSA6IG8yOwogICAgICAgICAgfQogICAgICAgIH0sIF9fYXN5bmNWYWx1ZXM6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKICAgICAgICAgIHZhciB0MiwgbjIgPSBlMltTeW1ib2wuYXN5bmNJdGVyYXRvcl07CiAgICAgICAgICByZXR1cm4gbjIgPyBuMi5jYWxsKGUyKSA6IChlMiA9IEZwKGUyKSwgdDIgPSB7fSwgcjIoIm5leHQiKSwgcjIoInRocm93IiksIHIyKCJyZXR1cm4iKSwgdDJbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfSwgdDIpOwogICAgICAgICAgZnVuY3Rpb24gcjIobjMpIHsKICAgICAgICAgICAgdDJbbjNdID0gZTJbbjNdICYmIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHIzLCBvMikgewogICAgICAgICAgICAgICAgKGZ1bmN0aW9uKGUzLCB0NCwgbjQsIHI0KSB7CiAgICAgICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZShyNCkudGhlbihmdW5jdGlvbih0NSkgewogICAgICAgICAgICAgICAgICAgIGUzKHsgdmFsdWU6IHQ1LCBkb25lOiBuNCB9KTsKICAgICAgICAgICAgICAgICAgfSwgdDQpOwogICAgICAgICAgICAgICAgfSkocjMsIG8yLCAodDMgPSBlMltuM10odDMpKS5kb25lLCB0My52YWx1ZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfSwgX19tYWtlVGVtcGxhdGVPYmplY3Q6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgInJhdyIsIHsgdmFsdWU6IHQyIH0pIDogZTIucmF3ID0gdDIsIGUyOwogICAgICAgIH0sIF9faW1wb3J0U3RhcjogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGlmIChlMiAmJiBlMi5fX2VzTW9kdWxlKQogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICB2YXIgdDIgPSB7fTsKICAgICAgICAgIGlmIChlMiAhPSBudWxsKQogICAgICAgICAgICBmb3IgKHZhciBuMiBpbiBlMikKICAgICAgICAgICAgICBPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlMiwgbjIpICYmICh0MltuMl0gPSBlMltuMl0pOwogICAgICAgICAgcmV0dXJuIHQyLmRlZmF1bHQgPSBlMiwgdDI7CiAgICAgICAgfSwgX19pbXBvcnREZWZhdWx0OiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyICYmIGUyLl9fZXNNb2R1bGUgPyBlMiA6IHsgZGVmYXVsdDogZTIgfTsKICAgICAgICB9LCBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0OiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGlmICghdDIuaGFzKGUyKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiYXR0ZW1wdGVkIHRvIGdldCBwcml2YXRlIGZpZWxkIG9uIG5vbi1pbnN0YW5jZSIpOwogICAgICAgICAgcmV0dXJuIHQyLmdldChlMik7CiAgICAgICAgfSwgX19jbGFzc1ByaXZhdGVGaWVsZFNldDogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgaWYgKCF0Mi5oYXMoZTIpKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJhdHRlbXB0ZWQgdG8gc2V0IHByaXZhdGUgZmllbGQgb24gbm9uLWluc3RhbmNlIik7CiAgICAgICAgICByZXR1cm4gdDIuc2V0KGUyLCBuMiksIG4yOwogICAgICAgIH0gfSksIFRwID0ge30sIEJwID0ge307CiAgICAgICAgIWZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KSwgZTIuYXBpRGVzY3JpcHRvciA9IHsga2V5OiAoZTMpID0+IC9eWyRfYS16QS1aXVskX2EtekEtWjAtOV0qJC8udGVzdChlMykgPyBlMyA6IEpTT04uc3RyaW5naWZ5KGUzKSwgdmFsdWUodDIpIHsKICAgICAgICAgICAgaWYgKHQyID09PSBudWxsIHx8IHR5cGVvZiB0MiAhPSAib2JqZWN0IikKICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodDIpOwogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0MikpCiAgICAgICAgICAgICAgcmV0dXJuICJbIi5jb25jYXQodDIubWFwKCh0MykgPT4gZTIuYXBpRGVzY3JpcHRvci52YWx1ZSh0MykpLmpvaW4oIiwgIiksICJdIik7CiAgICAgICAgICAgIGNvbnN0IG4yID0gT2JqZWN0LmtleXModDIpOwogICAgICAgICAgICByZXR1cm4gbjIubGVuZ3RoID09PSAwID8gInt9IiA6ICJ7ICIuY29uY2F0KG4yLm1hcCgobjMpID0+ICIiLmNvbmNhdChlMi5hcGlEZXNjcmlwdG9yLmtleShuMyksICI6ICIpLmNvbmNhdChlMi5hcGlEZXNjcmlwdG9yLnZhbHVlKHQyW24zXSkpKS5qb2luKCIsICIpLCAiIH0iKTsKICAgICAgICAgIH0sIHBhaXI6ICh0MikgPT4gewogICAgICAgICAgICBsZXQgeyBrZXk6IG4yLCB2YWx1ZTogcjIgfSA9IHQyOwogICAgICAgICAgICByZXR1cm4gZTIuYXBpRGVzY3JpcHRvci52YWx1ZSh7IFtuMl06IHIyIH0pOwogICAgICAgICAgfSB9OwogICAgICAgIH0oQnApLCBmdW5jdGlvbihlMikgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgICB3cC5fX2V4cG9ydFN0YXIoQnAsIGUyKTsKICAgICAgICB9KFRwKTsKICAgICAgICB2YXIgTnAgPSB7fSwga3AgPSB7fSwgUHAgPSB7fSwgT3AgPSB7IGV4cG9ydHM6IHt9IH0sIElwID0gL1t8XFx7fSgpW1xdXiQrKj8uXS9nLCBMcCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGUyICE9ICJzdHJpbmciKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJFeHBlY3RlZCBhIHN0cmluZyIpOwogICAgICAgICAgcmV0dXJuIGUyLnJlcGxhY2UoSXAsICJcXCQmIik7CiAgICAgICAgfSwganAgPSB7IGV4cG9ydHM6IHt9IH0sIF9wID0geyBleHBvcnRzOiB7fSB9LCBNcCA9IHsgYWxpY2VibHVlOiBbMjQwLCAyNDgsIDI1NV0sIGFudGlxdWV3aGl0ZTogWzI1MCwgMjM1LCAyMTVdLCBhcXVhOiBbMCwgMjU1LCAyNTVdLCBhcXVhbWFyaW5lOiBbMTI3LCAyNTUsIDIxMl0sIGF6dXJlOiBbMjQwLCAyNTUsIDI1NV0sIGJlaWdlOiBbMjQ1LCAyNDUsIDIyMF0sIGJpc3F1ZTogWzI1NSwgMjI4LCAxOTZdLCBibGFjazogWzAsIDAsIDBdLCBibGFuY2hlZGFsbW9uZDogWzI1NSwgMjM1LCAyMDVdLCBibHVlOiBbMCwgMCwgMjU1XSwgYmx1ZXZpb2xldDogWzEzOCwgNDMsIDIyNl0sIGJyb3duOiBbMTY1LCA0MiwgNDJdLCBidXJseXdvb2Q6IFsyMjIsIDE4NCwgMTM1XSwgY2FkZXRibHVlOiBbOTUsIDE1OCwgMTYwXSwgY2hhcnRyZXVzZTogWzEyNywgMjU1LCAwXSwgY2hvY29sYXRlOiBbMjEwLCAxMDUsIDMwXSwgY29yYWw6IFsyNTUsIDEyNywgODBdLCBjb3JuZmxvd2VyYmx1ZTogWzEwMCwgMTQ5LCAyMzddLCBjb3Juc2lsazogWzI1NSwgMjQ4LCAyMjBdLCBjcmltc29uOiBbMjIwLCAyMCwgNjBdLCBjeWFuOiBbMCwgMjU1LCAyNTVdLCBkYXJrYmx1ZTogWzAsIDAsIDEzOV0sIGRhcmtjeWFuOiBbMCwgMTM5LCAxMzldLCBkYXJrZ29sZGVucm9kOiBbMTg0LCAxMzQsIDExXSwgZGFya2dyYXk6IFsxNjksIDE2OSwgMTY5XSwgZGFya2dyZWVuOiBbMCwgMTAwLCAwXSwgZGFya2dyZXk6IFsxNjksIDE2OSwgMTY5XSwgZGFya2toYWtpOiBbMTg5LCAxODMsIDEwN10sIGRhcmttYWdlbnRhOiBbMTM5LCAwLCAxMzldLCBkYXJrb2xpdmVncmVlbjogWzg1LCAxMDcsIDQ3XSwgZGFya29yYW5nZTogWzI1NSwgMTQwLCAwXSwgZGFya29yY2hpZDogWzE1MywgNTAsIDIwNF0sIGRhcmtyZWQ6IFsxMzksIDAsIDBdLCBkYXJrc2FsbW9uOiBbMjMzLCAxNTAsIDEyMl0sIGRhcmtzZWFncmVlbjogWzE0MywgMTg4LCAxNDNdLCBkYXJrc2xhdGVibHVlOiBbNzIsIDYxLCAxMzldLCBkYXJrc2xhdGVncmF5OiBbNDcsIDc5LCA3OV0sIGRhcmtzbGF0ZWdyZXk6IFs0NywgNzksIDc5XSwgZGFya3R1cnF1b2lzZTogWzAsIDIwNiwgMjA5XSwgZGFya3Zpb2xldDogWzE0OCwgMCwgMjExXSwgZGVlcHBpbms6IFsyNTUsIDIwLCAxNDddLCBkZWVwc2t5Ymx1ZTogWzAsIDE5MSwgMjU1XSwgZGltZ3JheTogWzEwNSwgMTA1LCAxMDVdLCBkaW1ncmV5OiBbMTA1LCAxMDUsIDEwNV0sIGRvZGdlcmJsdWU6IFszMCwgMTQ0LCAyNTVdLCBmaXJlYnJpY2s6IFsxNzgsIDM0LCAzNF0sIGZsb3JhbHdoaXRlOiBbMjU1LCAyNTAsIDI0MF0sIGZvcmVzdGdyZWVuOiBbMzQsIDEzOSwgMzRdLCBmdWNoc2lhOiBbMjU1LCAwLCAyNTVdLCBnYWluc2Jvcm86IFsyMjAsIDIyMCwgMjIwXSwgZ2hvc3R3aGl0ZTogWzI0OCwgMjQ4LCAyNTVdLCBnb2xkOiBbMjU1LCAyMTUsIDBdLCBnb2xkZW5yb2Q6IFsyMTgsIDE2NSwgMzJdLCBncmF5OiBbMTI4LCAxMjgsIDEyOF0sIGdyZWVuOiBbMCwgMTI4LCAwXSwgZ3JlZW55ZWxsb3c6IFsxNzMsIDI1NSwgNDddLCBncmV5OiBbMTI4LCAxMjgsIDEyOF0sIGhvbmV5ZGV3OiBbMjQwLCAyNTUsIDI0MF0sIGhvdHBpbms6IFsyNTUsIDEwNSwgMTgwXSwgaW5kaWFucmVkOiBbMjA1LCA5MiwgOTJdLCBpbmRpZ286IFs3NSwgMCwgMTMwXSwgaXZvcnk6IFsyNTUsIDI1NSwgMjQwXSwga2hha2k6IFsyNDAsIDIzMCwgMTQwXSwgbGF2ZW5kZXI6IFsyMzAsIDIzMCwgMjUwXSwgbGF2ZW5kZXJibHVzaDogWzI1NSwgMjQwLCAyNDVdLCBsYXduZ3JlZW46IFsxMjQsIDI1MiwgMF0sIGxlbW9uY2hpZmZvbjogWzI1NSwgMjUwLCAyMDVdLCBsaWdodGJsdWU6IFsxNzMsIDIxNiwgMjMwXSwgbGlnaHRjb3JhbDogWzI0MCwgMTI4LCAxMjhdLCBsaWdodGN5YW46IFsyMjQsIDI1NSwgMjU1XSwgbGlnaHRnb2xkZW5yb2R5ZWxsb3c6IFsyNTAsIDI1MCwgMjEwXSwgbGlnaHRncmF5OiBbMjExLCAyMTEsIDIxMV0sIGxpZ2h0Z3JlZW46IFsxNDQsIDIzOCwgMTQ0XSwgbGlnaHRncmV5OiBbMjExLCAyMTEsIDIxMV0sIGxpZ2h0cGluazogWzI1NSwgMTgyLCAxOTNdLCBsaWdodHNhbG1vbjogWzI1NSwgMTYwLCAxMjJdLCBsaWdodHNlYWdyZWVuOiBbMzIsIDE3OCwgMTcwXSwgbGlnaHRza3libHVlOiBbMTM1LCAyMDYsIDI1MF0sIGxpZ2h0c2xhdGVncmF5OiBbMTE5LCAxMzYsIDE1M10sIGxpZ2h0c2xhdGVncmV5OiBbMTE5LCAxMzYsIDE1M10sIGxpZ2h0c3RlZWxibHVlOiBbMTc2LCAxOTYsIDIyMl0sIGxpZ2h0eWVsbG93OiBbMjU1LCAyNTUsIDIyNF0sIGxpbWU6IFswLCAyNTUsIDBdLCBsaW1lZ3JlZW46IFs1MCwgMjA1LCA1MF0sIGxpbmVuOiBbMjUwLCAyNDAsIDIzMF0sIG1hZ2VudGE6IFsyNTUsIDAsIDI1NV0sIG1hcm9vbjogWzEyOCwgMCwgMF0sIG1lZGl1bWFxdWFtYXJpbmU6IFsxMDIsIDIwNSwgMTcwXSwgbWVkaXVtYmx1ZTogWzAsIDAsIDIwNV0sIG1lZGl1bW9yY2hpZDogWzE4NiwgODUsIDIxMV0sIG1lZGl1bXB1cnBsZTogWzE0NywgMTEyLCAyMTldLCBtZWRpdW1zZWFncmVlbjogWzYwLCAxNzksIDExM10sIG1lZGl1bXNsYXRlYmx1ZTogWzEyMywgMTA0LCAyMzhdLCBtZWRpdW1zcHJpbmdncmVlbjogWzAsIDI1MCwgMTU0XSwgbWVkaXVtdHVycXVvaXNlOiBbNzIsIDIwOSwgMjA0XSwgbWVkaXVtdmlvbGV0cmVkOiBbMTk5LCAyMSwgMTMzXSwgbWlkbmlnaHRibHVlOiBbMjUsIDI1LCAxMTJdLCBtaW50Y3JlYW06IFsyNDUsIDI1NSwgMjUwXSwgbWlzdHlyb3NlOiBbMjU1LCAyMjgsIDIyNV0sIG1vY2Nhc2luOiBbMjU1LCAyMjgsIDE4MV0sIG5hdmFqb3doaXRlOiBbMjU1LCAyMjIsIDE3M10sIG5hdnk6IFswLCAwLCAxMjhdLCBvbGRsYWNlOiBbMjUzLCAyNDUsIDIzMF0sIG9saXZlOiBbMTI4LCAxMjgsIDBdLCBvbGl2ZWRyYWI6IFsxMDcsIDE0MiwgMzVdLCBvcmFuZ2U6IFsyNTUsIDE2NSwgMF0sIG9yYW5nZXJlZDogWzI1NSwgNjksIDBdLCBvcmNoaWQ6IFsyMTgsIDExMiwgMjE0XSwgcGFsZWdvbGRlbnJvZDogWzIzOCwgMjMyLCAxNzBdLCBwYWxlZ3JlZW46IFsxNTIsIDI1MSwgMTUyXSwgcGFsZXR1cnF1b2lzZTogWzE3NSwgMjM4LCAyMzhdLCBwYWxldmlvbGV0cmVkOiBbMjE5LCAxMTIsIDE0N10sIHBhcGF5YXdoaXA6IFsyNTUsIDIzOSwgMjEzXSwgcGVhY2hwdWZmOiBbMjU1LCAyMTgsIDE4NV0sIHBlcnU6IFsyMDUsIDEzMywgNjNdLCBwaW5rOiBbMjU1LCAxOTIsIDIwM10sIHBsdW06IFsyMjEsIDE2MCwgMjIxXSwgcG93ZGVyYmx1ZTogWzE3NiwgMjI0LCAyMzBdLCBwdXJwbGU6IFsxMjgsIDAsIDEyOF0sIHJlYmVjY2FwdXJwbGU6IFsxMDIsIDUxLCAxNTNdLCByZWQ6IFsyNTUsIDAsIDBdLCByb3N5YnJvd246IFsxODgsIDE0MywgMTQzXSwgcm95YWxibHVlOiBbNjUsIDEwNSwgMjI1XSwgc2FkZGxlYnJvd246IFsxMzksIDY5LCAxOV0sIHNhbG1vbjogWzI1MCwgMTI4LCAxMTRdLCBzYW5keWJyb3duOiBbMjQ0LCAxNjQsIDk2XSwgc2VhZ3JlZW46IFs0NiwgMTM5LCA4N10sIHNlYXNoZWxsOiBbMjU1LCAyNDUsIDIzOF0sIHNpZW5uYTogWzE2MCwgODIsIDQ1XSwgc2lsdmVyOiBbMTkyLCAxOTIsIDE5Ml0sIHNreWJsdWU6IFsxMzUsIDIwNiwgMjM1XSwgc2xhdGVibHVlOiBbMTA2LCA5MCwgMjA1XSwgc2xhdGVncmF5OiBbMTEyLCAxMjgsIDE0NF0sIHNsYXRlZ3JleTogWzExMiwgMTI4LCAxNDRdLCBzbm93OiBbMjU1LCAyNTAsIDI1MF0sIHNwcmluZ2dyZWVuOiBbMCwgMjU1LCAxMjddLCBzdGVlbGJsdWU6IFs3MCwgMTMwLCAxODBdLCB0YW46IFsyMTAsIDE4MCwgMTQwXSwgdGVhbDogWzAsIDEyOCwgMTI4XSwgdGhpc3RsZTogWzIxNiwgMTkxLCAyMTZdLCB0b21hdG86IFsyNTUsIDk5LCA3MV0sIHR1cnF1b2lzZTogWzY0LCAyMjQsIDIwOF0sIHZpb2xldDogWzIzOCwgMTMwLCAyMzhdLCB3aGVhdDogWzI0NSwgMjIyLCAxNzldLCB3aGl0ZTogWzI1NSwgMjU1LCAyNTVdLCB3aGl0ZXNtb2tlOiBbMjQ1LCAyNDUsIDI0NV0sIHllbGxvdzogWzI1NSwgMjU1LCAwXSwgeWVsbG93Z3JlZW46IFsxNTQsIDIwNSwgNTBdIH0sIFJwID0ge307CiAgICAgICAgZm9yICh2YXIgVnAgaW4gTXApCiAgICAgICAgICBNcC5oYXNPd25Qcm9wZXJ0eShWcCkgJiYgKFJwW01wW1ZwXV0gPSBWcCk7CiAgICAgICAgdmFyICRwID0gX3AuZXhwb3J0cyA9IHsgcmdiOiB7IGNoYW5uZWxzOiAzLCBsYWJlbHM6ICJyZ2IiIH0sIGhzbDogeyBjaGFubmVsczogMywgbGFiZWxzOiAiaHNsIiB9LCBoc3Y6IHsgY2hhbm5lbHM6IDMsIGxhYmVsczogImhzdiIgfSwgaHdiOiB7IGNoYW5uZWxzOiAzLCBsYWJlbHM6ICJod2IiIH0sIGNteWs6IHsgY2hhbm5lbHM6IDQsIGxhYmVsczogImNteWsiIH0sIHh5ejogeyBjaGFubmVsczogMywgbGFiZWxzOiAieHl6IiB9LCBsYWI6IHsgY2hhbm5lbHM6IDMsIGxhYmVsczogImxhYiIgfSwgbGNoOiB7IGNoYW5uZWxzOiAzLCBsYWJlbHM6ICJsY2giIH0sIGhleDogeyBjaGFubmVsczogMSwgbGFiZWxzOiBbImhleCJdIH0sIGtleXdvcmQ6IHsgY2hhbm5lbHM6IDEsIGxhYmVsczogWyJrZXl3b3JkIl0gfSwgYW5zaTE2OiB7IGNoYW5uZWxzOiAxLCBsYWJlbHM6IFsiYW5zaTE2Il0gfSwgYW5zaTI1NjogeyBjaGFubmVsczogMSwgbGFiZWxzOiBbImFuc2kyNTYiXSB9LCBoY2c6IHsgY2hhbm5lbHM6IDMsIGxhYmVsczogWyJoIiwgImMiLCAiZyJdIH0sIGFwcGxlOiB7IGNoYW5uZWxzOiAzLCBsYWJlbHM6IFsicjE2IiwgImcxNiIsICJiMTYiXSB9LCBncmF5OiB7IGNoYW5uZWxzOiAxLCBsYWJlbHM6IFsiZ3JheSJdIH0gfTsKICAgICAgICBmb3IgKHZhciBXcCBpbiAkcCkKICAgICAgICAgIGlmICgkcC5oYXNPd25Qcm9wZXJ0eShXcCkpIHsKICAgICAgICAgICAgaWYgKCEoImNoYW5uZWxzIiBpbiAkcFtXcF0pKQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigibWlzc2luZyBjaGFubmVscyBwcm9wZXJ0eTogIiArIFdwKTsKICAgICAgICAgICAgaWYgKCEoImxhYmVscyIgaW4gJHBbV3BdKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm1pc3NpbmcgY2hhbm5lbCBsYWJlbHMgcHJvcGVydHk6ICIgKyBXcCk7CiAgICAgICAgICAgIGlmICgkcFtXcF0ubGFiZWxzLmxlbmd0aCAhPT0gJHBbV3BdLmNoYW5uZWxzKQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiY2hhbm5lbCBhbmQgbGFiZWwgY291bnRzIG1pc21hdGNoOiAiICsgV3ApOwogICAgICAgICAgICB2YXIgcXAgPSAkcFtXcF0uY2hhbm5lbHMsIFVwID0gJHBbV3BdLmxhYmVsczsKICAgICAgICAgICAgZGVsZXRlICRwW1dwXS5jaGFubmVscywgZGVsZXRlICRwW1dwXS5sYWJlbHMsIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSgkcFtXcF0sICJjaGFubmVscyIsIHsgdmFsdWU6IHFwIH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoJHBbV3BdLCAibGFiZWxzIiwgeyB2YWx1ZTogVXAgfSk7CiAgICAgICAgICB9CiAgICAgICAgJHAucmdiLmhzbCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIsIG4yLCByMiA9IGUyWzBdIC8gMjU1LCBvMiA9IGUyWzFdIC8gMjU1LCBpMiA9IGUyWzJdIC8gMjU1LCB1MiA9IE1hdGgubWluKHIyLCBvMiwgaTIpLCBzMiA9IE1hdGgubWF4KHIyLCBvMiwgaTIpLCBhMiA9IHMyIC0gdTI7CiAgICAgICAgICByZXR1cm4gczIgPT09IHUyID8gdDIgPSAwIDogcjIgPT09IHMyID8gdDIgPSAobzIgLSBpMikgLyBhMiA6IG8yID09PSBzMiA/IHQyID0gMiArIChpMiAtIHIyKSAvIGEyIDogaTIgPT09IHMyICYmICh0MiA9IDQgKyAocjIgLSBvMikgLyBhMiksICh0MiA9IE1hdGgubWluKDYwICogdDIsIDM2MCkpIDwgMCAmJiAodDIgKz0gMzYwKSwgbjIgPSAodTIgKyBzMikgLyAyLCBbdDIsIDEwMCAqIChzMiA9PT0gdTIgPyAwIDogbjIgPD0gMC41ID8gYTIgLyAoczIgKyB1MikgOiBhMiAvICgyIC0gczIgLSB1MikpLCAxMDAgKiBuMl07CiAgICAgICAgfSwgJHAucmdiLmhzdiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIsIG4yLCByMiwgbzIsIGkyLCB1MiA9IGUyWzBdIC8gMjU1LCBzMiA9IGUyWzFdIC8gMjU1LCBhMiA9IGUyWzJdIC8gMjU1LCBjMiA9IE1hdGgubWF4KHUyLCBzMiwgYTIpLCBsMiA9IGMyIC0gTWF0aC5taW4odTIsIHMyLCBhMiksIHAyID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIChjMiAtIGUzKSAvIDYgLyBsMiArIDAuNTsKICAgICAgICAgIH07CiAgICAgICAgICByZXR1cm4gbDIgPT09IDAgPyBvMiA9IGkyID0gMCA6IChpMiA9IGwyIC8gYzIsIHQyID0gcDIodTIpLCBuMiA9IHAyKHMyKSwgcjIgPSBwMihhMiksIHUyID09PSBjMiA/IG8yID0gcjIgLSBuMiA6IHMyID09PSBjMiA/IG8yID0gMSAvIDMgKyB0MiAtIHIyIDogYTIgPT09IGMyICYmIChvMiA9IDIgLyAzICsgbjIgLSB0MiksIG8yIDwgMCA/IG8yICs9IDEgOiBvMiA+IDEgJiYgKG8yIC09IDEpKSwgWzM2MCAqIG8yLCAxMDAgKiBpMiwgMTAwICogYzJdOwogICAgICAgIH0sICRwLnJnYi5od2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gZTJbMF0sIG4yID0gZTJbMV0sIHIyID0gZTJbMl07CiAgICAgICAgICByZXR1cm4gWyRwLnJnYi5oc2woZTIpWzBdLCAxMDAgKiAoMSAvIDI1NSAqIE1hdGgubWluKHQyLCBNYXRoLm1pbihuMiwgcjIpKSksIDEwMCAqIChyMiA9IDEgLSAxIC8gMjU1ICogTWF0aC5tYXgodDIsIE1hdGgubWF4KG4yLCByMikpKV07CiAgICAgICAgfSwgJHAucmdiLmNteWsgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyLCBuMiA9IGUyWzBdIC8gMjU1LCByMiA9IGUyWzFdIC8gMjU1LCBvMiA9IGUyWzJdIC8gMjU1OwogICAgICAgICAgcmV0dXJuIFsxMDAgKiAoKDEgLSBuMiAtICh0MiA9IE1hdGgubWluKDEgLSBuMiwgMSAtIHIyLCAxIC0gbzIpKSkgLyAoMSAtIHQyKSB8fCAwKSwgMTAwICogKCgxIC0gcjIgLSB0MikgLyAoMSAtIHQyKSB8fCAwKSwgMTAwICogKCgxIC0gbzIgLSB0MikgLyAoMSAtIHQyKSB8fCAwKSwgMTAwICogdDJdOwogICAgICAgIH0sICRwLnJnYi5rZXl3b3JkID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IFJwW2UyXTsKICAgICAgICAgIGlmICh0MikKICAgICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgICAgdmFyIG4yLCByMiwgbzIsIGkyID0gMSAvIDA7CiAgICAgICAgICBmb3IgKHZhciB1MiBpbiBNcCkKICAgICAgICAgICAgaWYgKE1wLmhhc093blByb3BlcnR5KHUyKSkgewogICAgICAgICAgICAgIHZhciBzMiA9IE1wW3UyXSwgYTIgPSAocjIgPSBlMiwgbzIgPSBzMiwgTWF0aC5wb3cocjJbMF0gLSBvMlswXSwgMikgKyBNYXRoLnBvdyhyMlsxXSAtIG8yWzFdLCAyKSArIE1hdGgucG93KHIyWzJdIC0gbzJbMl0sIDIpKTsKICAgICAgICAgICAgICBhMiA8IGkyICYmIChpMiA9IGEyLCBuMiA9IHUyKTsKICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgIH0sICRwLmtleXdvcmQucmdiID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBNcFtlMl07CiAgICAgICAgfSwgJHAucmdiLnh5eiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSBlMlswXSAvIDI1NSwgbjIgPSBlMlsxXSAvIDI1NSwgcjIgPSBlMlsyXSAvIDI1NTsKICAgICAgICAgIHJldHVybiBbMTAwICogKDAuNDEyNCAqICh0MiA9IHQyID4gMC4wNDA0NSA/IE1hdGgucG93KCh0MiArIDAuMDU1KSAvIDEuMDU1LCAyLjQpIDogdDIgLyAxMi45MikgKyAwLjM1NzYgKiAobjIgPSBuMiA+IDAuMDQwNDUgPyBNYXRoLnBvdygobjIgKyAwLjA1NSkgLyAxLjA1NSwgMi40KSA6IG4yIC8gMTIuOTIpICsgMC4xODA1ICogKHIyID0gcjIgPiAwLjA0MDQ1ID8gTWF0aC5wb3coKHIyICsgMC4wNTUpIC8gMS4wNTUsIDIuNCkgOiByMiAvIDEyLjkyKSksIDEwMCAqICgwLjIxMjYgKiB0MiArIDAuNzE1MiAqIG4yICsgMC4wNzIyICogcjIpLCAxMDAgKiAoMC4wMTkzICogdDIgKyAwLjExOTIgKiBuMiArIDAuOTUwNSAqIHIyKV07CiAgICAgICAgfSwgJHAucmdiLmxhYiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSAkcC5yZ2IueHl6KGUyKSwgbjIgPSB0MlswXSwgcjIgPSB0MlsxXSwgbzIgPSB0MlsyXTsKICAgICAgICAgIHJldHVybiByMiAvPSAxMDAsIG8yIC89IDEwOC44ODMsIG4yID0gKG4yIC89IDk1LjA0NykgPiA4ODU2ZS02ID8gTWF0aC5wb3cobjIsIDEgLyAzKSA6IDcuNzg3ICogbjIgKyAxNiAvIDExNiwgWzExNiAqIChyMiA9IHIyID4gODg1NmUtNiA/IE1hdGgucG93KHIyLCAxIC8gMykgOiA3Ljc4NyAqIHIyICsgMTYgLyAxMTYpIC0gMTYsIDUwMCAqIChuMiAtIHIyKSwgMjAwICogKHIyIC0gKG8yID0gbzIgPiA4ODU2ZS02ID8gTWF0aC5wb3cobzIsIDEgLyAzKSA6IDcuNzg3ICogbzIgKyAxNiAvIDExNikpXTsKICAgICAgICB9LCAkcC5oc2wucmdiID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiwgbjIsIHIyLCBvMiwgaTIsIHUyID0gZTJbMF0gLyAzNjAsIHMyID0gZTJbMV0gLyAxMDAsIGEyID0gZTJbMl0gLyAxMDA7CiAgICAgICAgICBpZiAoczIgPT09IDApCiAgICAgICAgICAgIHJldHVybiBbaTIgPSAyNTUgKiBhMiwgaTIsIGkyXTsKICAgICAgICAgIHQyID0gMiAqIGEyIC0gKG4yID0gYTIgPCAwLjUgPyBhMiAqICgxICsgczIpIDogYTIgKyBzMiAtIGEyICogczIpLCBvMiA9IFswLCAwLCAwXTsKICAgICAgICAgIGZvciAodmFyIGMyID0gMDsgYzIgPCAzOyBjMisrKQogICAgICAgICAgICAocjIgPSB1MiArIDEgLyAzICogLShjMiAtIDEpKSA8IDAgJiYgcjIrKywgcjIgPiAxICYmIHIyLS0sIGkyID0gNiAqIHIyIDwgMSA/IHQyICsgNiAqIChuMiAtIHQyKSAqIHIyIDogMiAqIHIyIDwgMSA/IG4yIDogMyAqIHIyIDwgMiA/IHQyICsgKG4yIC0gdDIpICogKDIgLyAzIC0gcjIpICogNiA6IHQyLCBvMltjMl0gPSAyNTUgKiBpMjsKICAgICAgICAgIHJldHVybiBvMjsKICAgICAgICB9LCAkcC5oc2wuaHN2ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IGUyWzBdLCBuMiA9IGUyWzFdIC8gMTAwLCByMiA9IGUyWzJdIC8gMTAwLCBvMiA9IG4yLCBpMiA9IE1hdGgubWF4KHIyLCAwLjAxKTsKICAgICAgICAgIHJldHVybiBuMiAqPSAocjIgKj0gMikgPD0gMSA/IHIyIDogMiAtIHIyLCBvMiAqPSBpMiA8PSAxID8gaTIgOiAyIC0gaTIsIFt0MiwgMTAwICogKHIyID09PSAwID8gMiAqIG8yIC8gKGkyICsgbzIpIDogMiAqIG4yIC8gKHIyICsgbjIpKSwgMTAwICogKChyMiArIG4yKSAvIDIpXTsKICAgICAgICB9LCAkcC5oc3YucmdiID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IGUyWzBdIC8gNjAsIG4yID0gZTJbMV0gLyAxMDAsIHIyID0gZTJbMl0gLyAxMDAsIG8yID0gTWF0aC5mbG9vcih0MikgJSA2LCBpMiA9IHQyIC0gTWF0aC5mbG9vcih0MiksIHUyID0gMjU1ICogcjIgKiAoMSAtIG4yKSwgczIgPSAyNTUgKiByMiAqICgxIC0gbjIgKiBpMiksIGEyID0gMjU1ICogcjIgKiAoMSAtIG4yICogKDEgLSBpMikpOwogICAgICAgICAgc3dpdGNoIChyMiAqPSAyNTUsIG8yKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICByZXR1cm4gW3IyLCBhMiwgdTJdOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgcmV0dXJuIFtzMiwgcjIsIHUyXTsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHJldHVybiBbdTIsIHIyLCBhMl07CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICByZXR1cm4gW3UyLCBzMiwgcjJdOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgcmV0dXJuIFthMiwgdTIsIHIyXTsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIHJldHVybiBbcjIsIHUyLCBzMl07CiAgICAgICAgICB9CiAgICAgICAgfSwgJHAuaHN2LmhzbCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIsIG4yLCByMiwgbzIgPSBlMlswXSwgaTIgPSBlMlsxXSAvIDEwMCwgdTIgPSBlMlsyXSAvIDEwMCwgczIgPSBNYXRoLm1heCh1MiwgMC4wMSk7CiAgICAgICAgICByZXR1cm4gcjIgPSAoMiAtIGkyKSAqIHUyLCBuMiA9IGkyICogczIsIFtvMiwgMTAwICogKG4yID0gKG4yIC89ICh0MiA9ICgyIC0gaTIpICogczIpIDw9IDEgPyB0MiA6IDIgLSB0MikgfHwgMCksIDEwMCAqIChyMiAvPSAyKV07CiAgICAgICAgfSwgJHAuaHdiLnJnYiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIsIG4yLCByMiwgbzIsIGkyLCB1MiwgczIsIGEyID0gZTJbMF0gLyAzNjAsIGMyID0gZTJbMV0gLyAxMDAsIGwyID0gZTJbMl0gLyAxMDAsIHAyID0gYzIgKyBsMjsKICAgICAgICAgIHN3aXRjaCAocDIgPiAxICYmIChjMiAvPSBwMiwgbDIgLz0gcDIpLCByMiA9IDYgKiBhMiAtICh0MiA9IE1hdGguZmxvb3IoNiAqIGEyKSksICgxICYgdDIpICE9IDAgJiYgKHIyID0gMSAtIHIyKSwgbzIgPSBjMiArIHIyICogKChuMiA9IDEgLSBsMikgLSBjMiksIHQyKSB7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGkyID0gbjIsIHUyID0gbzIsIHMyID0gYzI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBpMiA9IG8yLCB1MiA9IG4yLCBzMiA9IGMyOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgaTIgPSBjMiwgdTIgPSBuMiwgczIgPSBvMjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIGkyID0gYzIsIHUyID0gbzIsIHMyID0gbjI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBpMiA9IG8yLCB1MiA9IGMyLCBzMiA9IG4yOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgaTIgPSBuMiwgdTIgPSBjMiwgczIgPSBvMjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbMjU1ICogaTIsIDI1NSAqIHUyLCAyNTUgKiBzMl07CiAgICAgICAgfSwgJHAuY215ay5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gZTJbMF0gLyAxMDAsIG4yID0gZTJbMV0gLyAxMDAsIHIyID0gZTJbMl0gLyAxMDAsIG8yID0gZTJbM10gLyAxMDA7CiAgICAgICAgICByZXR1cm4gWzI1NSAqICgxIC0gTWF0aC5taW4oMSwgdDIgKiAoMSAtIG8yKSArIG8yKSksIDI1NSAqICgxIC0gTWF0aC5taW4oMSwgbjIgKiAoMSAtIG8yKSArIG8yKSksIDI1NSAqICgxIC0gTWF0aC5taW4oMSwgcjIgKiAoMSAtIG8yKSArIG8yKSldOwogICAgICAgIH0sICRwLnh5ei5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyLCBuMiwgcjIsIG8yID0gZTJbMF0gLyAxMDAsIGkyID0gZTJbMV0gLyAxMDAsIHUyID0gZTJbMl0gLyAxMDA7CiAgICAgICAgICByZXR1cm4gbjIgPSAtMC45Njg5ICogbzIgKyAxLjg3NTggKiBpMiArIDAuMDQxNSAqIHUyLCByMiA9IDAuMDU1NyAqIG8yICsgLTAuMjA0ICogaTIgKyAxLjA1NyAqIHUyLCB0MiA9ICh0MiA9IDMuMjQwNiAqIG8yICsgLTEuNTM3MiAqIGkyICsgLTAuNDk4NiAqIHUyKSA+IDMxMzA4ZS03ID8gMS4wNTUgKiBNYXRoLnBvdyh0MiwgMSAvIDIuNCkgLSAwLjA1NSA6IDEyLjkyICogdDIsIG4yID0gbjIgPiAzMTMwOGUtNyA/IDEuMDU1ICogTWF0aC5wb3cobjIsIDEgLyAyLjQpIC0gMC4wNTUgOiAxMi45MiAqIG4yLCByMiA9IHIyID4gMzEzMDhlLTcgPyAxLjA1NSAqIE1hdGgucG93KHIyLCAxIC8gMi40KSAtIDAuMDU1IDogMTIuOTIgKiByMiwgWzI1NSAqICh0MiA9IE1hdGgubWluKE1hdGgubWF4KDAsIHQyKSwgMSkpLCAyNTUgKiAobjIgPSBNYXRoLm1pbihNYXRoLm1heCgwLCBuMiksIDEpKSwgMjU1ICogKHIyID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgcjIpLCAxKSldOwogICAgICAgIH0sICRwLnh5ei5sYWIgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gZTJbMF0sIG4yID0gZTJbMV0sIHIyID0gZTJbMl07CiAgICAgICAgICByZXR1cm4gbjIgLz0gMTAwLCByMiAvPSAxMDguODgzLCB0MiA9ICh0MiAvPSA5NS4wNDcpID4gODg1NmUtNiA/IE1hdGgucG93KHQyLCAxIC8gMykgOiA3Ljc4NyAqIHQyICsgMTYgLyAxMTYsIFsxMTYgKiAobjIgPSBuMiA+IDg4NTZlLTYgPyBNYXRoLnBvdyhuMiwgMSAvIDMpIDogNy43ODcgKiBuMiArIDE2IC8gMTE2KSAtIDE2LCA1MDAgKiAodDIgLSBuMiksIDIwMCAqIChuMiAtIChyMiA9IHIyID4gODg1NmUtNiA/IE1hdGgucG93KHIyLCAxIC8gMykgOiA3Ljc4NyAqIHIyICsgMTYgLyAxMTYpKV07CiAgICAgICAgfSwgJHAubGFiLnh5eiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIsIG4yLCByMiwgbzIgPSBlMlswXTsKICAgICAgICAgIHQyID0gZTJbMV0gLyA1MDAgKyAobjIgPSAobzIgKyAxNikgLyAxMTYpLCByMiA9IG4yIC0gZTJbMl0gLyAyMDA7CiAgICAgICAgICB2YXIgaTIgPSBNYXRoLnBvdyhuMiwgMyksIHUyID0gTWF0aC5wb3codDIsIDMpLCBzMiA9IE1hdGgucG93KHIyLCAzKTsKICAgICAgICAgIHJldHVybiBuMiA9IGkyID4gODg1NmUtNiA/IGkyIDogKG4yIC0gMTYgLyAxMTYpIC8gNy43ODcsIHQyID0gdTIgPiA4ODU2ZS02ID8gdTIgOiAodDIgLSAxNiAvIDExNikgLyA3Ljc4NywgcjIgPSBzMiA+IDg4NTZlLTYgPyBzMiA6IChyMiAtIDE2IC8gMTE2KSAvIDcuNzg3LCBbdDIgKj0gOTUuMDQ3LCBuMiAqPSAxMDAsIHIyICo9IDEwOC44ODNdOwogICAgICAgIH0sICRwLmxhYi5sY2ggPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyLCBuMiA9IGUyWzBdLCByMiA9IGUyWzFdLCBvMiA9IGUyWzJdOwogICAgICAgICAgcmV0dXJuICh0MiA9IDM2MCAqIE1hdGguYXRhbjIobzIsIHIyKSAvIDIgLyBNYXRoLlBJKSA8IDAgJiYgKHQyICs9IDM2MCksIFtuMiwgTWF0aC5zcXJ0KHIyICogcjIgKyBvMiAqIG8yKSwgdDJdOwogICAgICAgIH0sICRwLmxjaC5sYWIgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyLCBuMiA9IGUyWzBdLCByMiA9IGUyWzFdOwogICAgICAgICAgcmV0dXJuIHQyID0gZTJbMl0gLyAzNjAgKiAyICogTWF0aC5QSSwgW24yLCByMiAqIE1hdGguY29zKHQyKSwgcjIgKiBNYXRoLnNpbih0MildOwogICAgICAgIH0sICRwLnJnYi5hbnNpMTYgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gZTJbMF0sIG4yID0gZTJbMV0sIHIyID0gZTJbMl0sIG8yID0gMSBpbiBhcmd1bWVudHMgPyBhcmd1bWVudHNbMV0gOiAkcC5yZ2IuaHN2KGUyKVsyXTsKICAgICAgICAgIGlmICgobzIgPSBNYXRoLnJvdW5kKG8yIC8gNTApKSA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIDMwOwogICAgICAgICAgdmFyIGkyID0gMzAgKyAoTWF0aC5yb3VuZChyMiAvIDI1NSkgPDwgMiB8IE1hdGgucm91bmQobjIgLyAyNTUpIDw8IDEgfCBNYXRoLnJvdW5kKHQyIC8gMjU1KSk7CiAgICAgICAgICByZXR1cm4gbzIgPT09IDIgJiYgKGkyICs9IDYwKSwgaTI7CiAgICAgICAgfSwgJHAuaHN2LmFuc2kxNiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gJHAucmdiLmFuc2kxNigkcC5oc3YucmdiKGUyKSwgZTJbMl0pOwogICAgICAgIH0sICRwLnJnYi5hbnNpMjU2ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IGUyWzBdLCBuMiA9IGUyWzFdLCByMiA9IGUyWzJdOwogICAgICAgICAgcmV0dXJuIHQyID09PSBuMiAmJiBuMiA9PT0gcjIgPyB0MiA8IDggPyAxNiA6IHQyID4gMjQ4ID8gMjMxIDogTWF0aC5yb3VuZCgodDIgLSA4KSAvIDI0NyAqIDI0KSArIDIzMiA6IDE2ICsgMzYgKiBNYXRoLnJvdW5kKHQyIC8gMjU1ICogNSkgKyA2ICogTWF0aC5yb3VuZChuMiAvIDI1NSAqIDUpICsgTWF0aC5yb3VuZChyMiAvIDI1NSAqIDUpOwogICAgICAgIH0sICRwLmFuc2kxNi5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gZTIgJSAxMDsKICAgICAgICAgIGlmICh0MiA9PT0gMCB8fCB0MiA9PT0gNykKICAgICAgICAgICAgcmV0dXJuIGUyID4gNTAgJiYgKHQyICs9IDMuNSksIFt0MiA9IHQyIC8gMTAuNSAqIDI1NSwgdDIsIHQyXTsKICAgICAgICAgIHZhciBuMiA9IDAuNSAqICgxICsgfn4oZTIgPiA1MCkpOwogICAgICAgICAgcmV0dXJuIFsoMSAmIHQyKSAqIG4yICogMjU1LCAodDIgPj4gMSAmIDEpICogbjIgKiAyNTUsICh0MiA+PiAyICYgMSkgKiBuMiAqIDI1NV07CiAgICAgICAgfSwgJHAuYW5zaTI1Ni5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKGUyID49IDIzMikgewogICAgICAgICAgICB2YXIgdDIgPSAxMCAqIChlMiAtIDIzMikgKyA4OwogICAgICAgICAgICByZXR1cm4gW3QyLCB0MiwgdDJdOwogICAgICAgICAgfQogICAgICAgICAgdmFyIG4yOwogICAgICAgICAgcmV0dXJuIGUyIC09IDE2LCBbTWF0aC5mbG9vcihlMiAvIDM2KSAvIDUgKiAyNTUsIE1hdGguZmxvb3IoKG4yID0gZTIgJSAzNikgLyA2KSAvIDUgKiAyNTUsIG4yICUgNiAvIDUgKiAyNTVdOwogICAgICAgIH0sICRwLnJnYi5oZXggPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gKCgoMjU1ICYgTWF0aC5yb3VuZChlMlswXSkpIDw8IDE2KSArICgoMjU1ICYgTWF0aC5yb3VuZChlMlsxXSkpIDw8IDgpICsgKDI1NSAmIE1hdGgucm91bmQoZTJbMl0pKSkudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICByZXR1cm4gIjAwMDAwMCIuc3Vic3RyaW5nKHQyLmxlbmd0aCkgKyB0MjsKICAgICAgICB9LCAkcC5oZXgucmdiID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IGUyLnRvU3RyaW5nKDE2KS5tYXRjaCgvW2EtZjAtOV17Nn18W2EtZjAtOV17M30vaSk7CiAgICAgICAgICBpZiAoIXQyKQogICAgICAgICAgICByZXR1cm4gWzAsIDAsIDBdOwogICAgICAgICAgdmFyIG4yID0gdDJbMF07CiAgICAgICAgICB0MlswXS5sZW5ndGggPT09IDMgJiYgKG4yID0gbjIuc3BsaXQoIiIpLm1hcChmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gZTMgKyBlMzsKICAgICAgICAgIH0pLmpvaW4oIiIpKTsKICAgICAgICAgIHZhciByMiA9IHBhcnNlSW50KG4yLCAxNik7CiAgICAgICAgICByZXR1cm4gW3IyID4+IDE2ICYgMjU1LCByMiA+PiA4ICYgMjU1LCAyNTUgJiByMl07CiAgICAgICAgfSwgJHAucmdiLmhjZyA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIsIG4yID0gZTJbMF0gLyAyNTUsIHIyID0gZTJbMV0gLyAyNTUsIG8yID0gZTJbMl0gLyAyNTUsIGkyID0gTWF0aC5tYXgoTWF0aC5tYXgobjIsIHIyKSwgbzIpLCB1MiA9IE1hdGgubWluKE1hdGgubWluKG4yLCByMiksIG8yKSwgczIgPSBpMiAtIHUyOwogICAgICAgICAgcmV0dXJuIHQyID0gczIgPD0gMCA/IDAgOiBpMiA9PT0gbjIgPyAocjIgLSBvMikgLyBzMiAlIDYgOiBpMiA9PT0gcjIgPyAyICsgKG8yIC0gbjIpIC8gczIgOiA0ICsgKG4yIC0gcjIpIC8gczIgKyA0LCB0MiAvPSA2LCBbMzYwICogKHQyICU9IDEpLCAxMDAgKiBzMiwgMTAwICogKHMyIDwgMSA/IHUyIC8gKDEgLSBzMikgOiAwKV07CiAgICAgICAgfSwgJHAuaHNsLmhjZyA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSBlMlsxXSAvIDEwMCwgbjIgPSBlMlsyXSAvIDEwMCwgcjIgPSAxLCBvMiA9IDA7CiAgICAgICAgICByZXR1cm4gKHIyID0gbjIgPCAwLjUgPyAyICogdDIgKiBuMiA6IDIgKiB0MiAqICgxIC0gbjIpKSA8IDEgJiYgKG8yID0gKG4yIC0gMC41ICogcjIpIC8gKDEgLSByMikpLCBbZTJbMF0sIDEwMCAqIHIyLCAxMDAgKiBvMl07CiAgICAgICAgfSwgJHAuaHN2LmhjZyA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSBlMlsxXSAvIDEwMCwgbjIgPSBlMlsyXSAvIDEwMCwgcjIgPSB0MiAqIG4yLCBvMiA9IDA7CiAgICAgICAgICByZXR1cm4gcjIgPCAxICYmIChvMiA9IChuMiAtIHIyKSAvICgxIC0gcjIpKSwgW2UyWzBdLCAxMDAgKiByMiwgMTAwICogbzJdOwogICAgICAgIH0sICRwLmhjZy5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gZTJbMF0gLyAzNjAsIG4yID0gZTJbMV0gLyAxMDAsIHIyID0gZTJbMl0gLyAxMDA7CiAgICAgICAgICBpZiAobjIgPT09IDApCiAgICAgICAgICAgIHJldHVybiBbMjU1ICogcjIsIDI1NSAqIHIyLCAyNTUgKiByMl07CiAgICAgICAgICB2YXIgbzIsIGkyID0gWzAsIDAsIDBdLCB1MiA9IHQyICUgMSAqIDYsIHMyID0gdTIgJSAxLCBhMiA9IDEgLSBzMjsKICAgICAgICAgIHN3aXRjaCAoTWF0aC5mbG9vcih1MikpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGkyWzBdID0gMSwgaTJbMV0gPSBzMiwgaTJbMl0gPSAwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgaTJbMF0gPSBhMiwgaTJbMV0gPSAxLCBpMlsyXSA9IDA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBpMlswXSA9IDAsIGkyWzFdID0gMSwgaTJbMl0gPSBzMjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIGkyWzBdID0gMCwgaTJbMV0gPSBhMiwgaTJbMl0gPSAxOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgaTJbMF0gPSBzMiwgaTJbMV0gPSAwLCBpMlsyXSA9IDE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgaTJbMF0gPSAxLCBpMlsxXSA9IDAsIGkyWzJdID0gYTI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbzIgPSAoMSAtIG4yKSAqIHIyLCBbMjU1ICogKG4yICogaTJbMF0gKyBvMiksIDI1NSAqIChuMiAqIGkyWzFdICsgbzIpLCAyNTUgKiAobjIgKiBpMlsyXSArIG8yKV07CiAgICAgICAgfSwgJHAuaGNnLmhzdiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSBlMlsxXSAvIDEwMCwgbjIgPSB0MiArIGUyWzJdIC8gMTAwICogKDEgLSB0MiksIHIyID0gMDsKICAgICAgICAgIHJldHVybiBuMiA+IDAgJiYgKHIyID0gdDIgLyBuMiksIFtlMlswXSwgMTAwICogcjIsIDEwMCAqIG4yXTsKICAgICAgICB9LCAkcC5oY2cuaHNsID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IGUyWzFdIC8gMTAwLCBuMiA9IGUyWzJdIC8gMTAwICogKDEgLSB0MikgKyAwLjUgKiB0MiwgcjIgPSAwOwogICAgICAgICAgcmV0dXJuIG4yID4gMCAmJiBuMiA8IDAuNSA/IHIyID0gdDIgLyAoMiAqIG4yKSA6IG4yID49IDAuNSAmJiBuMiA8IDEgJiYgKHIyID0gdDIgLyAoMiAqICgxIC0gbjIpKSksIFtlMlswXSwgMTAwICogcjIsIDEwMCAqIG4yXTsKICAgICAgICB9LCAkcC5oY2cuaHdiID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IGUyWzFdIC8gMTAwLCBuMiA9IHQyICsgZTJbMl0gLyAxMDAgKiAoMSAtIHQyKTsKICAgICAgICAgIHJldHVybiBbZTJbMF0sIDEwMCAqIChuMiAtIHQyKSwgMTAwICogKDEgLSBuMildOwogICAgICAgIH0sICRwLmh3Yi5oY2cgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gZTJbMV0gLyAxMDAsIG4yID0gMSAtIGUyWzJdIC8gMTAwLCByMiA9IG4yIC0gdDIsIG8yID0gMDsKICAgICAgICAgIHJldHVybiByMiA8IDEgJiYgKG8yID0gKG4yIC0gcjIpIC8gKDEgLSByMikpLCBbZTJbMF0sIDEwMCAqIHIyLCAxMDAgKiBvMl07CiAgICAgICAgfSwgJHAuYXBwbGUucmdiID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBbZTJbMF0gLyA2NTUzNSAqIDI1NSwgZTJbMV0gLyA2NTUzNSAqIDI1NSwgZTJbMl0gLyA2NTUzNSAqIDI1NV07CiAgICAgICAgfSwgJHAucmdiLmFwcGxlID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBbZTJbMF0gLyAyNTUgKiA2NTUzNSwgZTJbMV0gLyAyNTUgKiA2NTUzNSwgZTJbMl0gLyAyNTUgKiA2NTUzNV07CiAgICAgICAgfSwgJHAuZ3JheS5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFtlMlswXSAvIDEwMCAqIDI1NSwgZTJbMF0gLyAxMDAgKiAyNTUsIGUyWzBdIC8gMTAwICogMjU1XTsKICAgICAgICB9LCAkcC5ncmF5LmhzbCA9ICRwLmdyYXkuaHN2ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBbMCwgMCwgZTJbMF1dOwogICAgICAgIH0sICRwLmdyYXkuaHdiID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBbMCwgMTAwLCBlMlswXV07CiAgICAgICAgfSwgJHAuZ3JheS5jbXlrID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBbMCwgMCwgMCwgZTJbMF1dOwogICAgICAgIH0sICRwLmdyYXkubGFiID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBbZTJbMF0sIDAsIDBdOwogICAgICAgIH0sICRwLmdyYXkuaGV4ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IDI1NSAmIE1hdGgucm91bmQoZTJbMF0gLyAxMDAgKiAyNTUpLCBuMiA9ICgodDIgPDwgMTYpICsgKHQyIDw8IDgpICsgdDIpLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgcmV0dXJuICIwMDAwMDAiLnN1YnN0cmluZyhuMi5sZW5ndGgpICsgbjI7CiAgICAgICAgfSwgJHAucmdiLmdyYXkgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFsoZTJbMF0gKyBlMlsxXSArIGUyWzJdKSAvIDMgLyAyNTUgKiAxMDBdOwogICAgICAgIH07CiAgICAgICAgdmFyIHpwID0gX3AuZXhwb3J0czsKICAgICAgICBmdW5jdGlvbiBHcChlMikgewogICAgICAgICAgdmFyIHQyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZvciAodmFyIGUzID0ge30sIHQzID0gT2JqZWN0LmtleXMoenApLCBuMyA9IHQzLmxlbmd0aCwgcjMgPSAwOyByMyA8IG4zOyByMysrKQogICAgICAgICAgICAgIGUzW3QzW3IzXV0gPSB7IGRpc3RhbmNlOiAtMSwgcGFyZW50OiBudWxsIH07CiAgICAgICAgICAgIHJldHVybiBlMzsKICAgICAgICAgIH0oKSwgbjIgPSBbZTJdOwogICAgICAgICAgZm9yICh0MltlMl0uZGlzdGFuY2UgPSAwOyBuMi5sZW5ndGg7ICkKICAgICAgICAgICAgZm9yICh2YXIgcjIgPSBuMi5wb3AoKSwgbzIgPSBPYmplY3Qua2V5cyh6cFtyMl0pLCBpMiA9IG8yLmxlbmd0aCwgdTIgPSAwOyB1MiA8IGkyOyB1MisrKSB7CiAgICAgICAgICAgICAgdmFyIHMyID0gbzJbdTJdLCBhMiA9IHQyW3MyXTsKICAgICAgICAgICAgICBhMi5kaXN0YW5jZSA9PT0gLTEgJiYgKGEyLmRpc3RhbmNlID0gdDJbcjJdLmRpc3RhbmNlICsgMSwgYTIucGFyZW50ID0gcjIsIG4yLnVuc2hpZnQoczIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBIcChlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihuMikgewogICAgICAgICAgICByZXR1cm4gdDIoZTIobjIpKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEpwKGUyLCB0MikgewogICAgICAgICAgZm9yICh2YXIgbjIgPSBbdDJbZTJdLnBhcmVudCwgZTJdLCByMiA9IHpwW3QyW2UyXS5wYXJlbnRdW2UyXSwgbzIgPSB0MltlMl0ucGFyZW50OyB0MltvMl0ucGFyZW50OyApCiAgICAgICAgICAgIG4yLnVuc2hpZnQodDJbbzJdLnBhcmVudCksIHIyID0gSHAoenBbdDJbbzJdLnBhcmVudF1bbzJdLCByMiksIG8yID0gdDJbbzJdLnBhcmVudDsKICAgICAgICAgIHJldHVybiByMi5jb252ZXJzaW9uID0gbjIsIHIyOwogICAgICAgIH0KICAgICAgICB2YXIgWHAgPSBfcC5leHBvcnRzLCBZcCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBmb3IgKHZhciB0MiA9IEdwKGUyKSwgbjIgPSB7fSwgcjIgPSBPYmplY3Qua2V5cyh0MiksIG8yID0gcjIubGVuZ3RoLCBpMiA9IDA7IGkyIDwgbzI7IGkyKyspIHsKICAgICAgICAgICAgdmFyIHUyID0gcjJbaTJdOwogICAgICAgICAgICB0Mlt1Ml0ucGFyZW50ICE9PSBudWxsICYmIChuMlt1Ml0gPSBKcCh1MiwgdDIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICB9LCBLcCA9IHt9OwogICAgICAgIE9iamVjdC5rZXlzKFhwKS5mb3JFYWNoKGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBLcFtlMl0gPSB7fSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KEtwW2UyXSwgImNoYW5uZWxzIiwgeyB2YWx1ZTogWHBbZTJdLmNoYW5uZWxzIH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoS3BbZTJdLCAibGFiZWxzIiwgeyB2YWx1ZTogWHBbZTJdLmxhYmVscyB9KTsKICAgICAgICAgIHZhciB0MiA9IFlwKGUyKTsKICAgICAgICAgIE9iamVjdC5rZXlzKHQyKS5mb3JFYWNoKGZ1bmN0aW9uKG4yKSB7CiAgICAgICAgICAgIHZhciByMiA9IHQyW24yXTsKICAgICAgICAgICAgS3BbZTJdW24yXSA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgICAgdmFyIHQzID0gZnVuY3Rpb24odDQpIHsKICAgICAgICAgICAgICAgIGlmICh0NCA9PSBudWxsKQogICAgICAgICAgICAgICAgICByZXR1cm4gdDQ7CiAgICAgICAgICAgICAgICBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiAodDQgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKTsKICAgICAgICAgICAgICAgIHZhciBuMyA9IGUzKHQ0KTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbjMgPT0gIm9iamVjdCIpCiAgICAgICAgICAgICAgICAgIGZvciAodmFyIHIzID0gbjMubGVuZ3RoLCBvMiA9IDA7IG8yIDwgcjM7IG8yKyspCiAgICAgICAgICAgICAgICAgICAgbjNbbzJdID0gTWF0aC5yb3VuZChuM1tvMl0pOwogICAgICAgICAgICAgICAgcmV0dXJuIG4zOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgcmV0dXJuICJjb252ZXJzaW9uIiBpbiBlMyAmJiAodDMuY29udmVyc2lvbiA9IGUzLmNvbnZlcnNpb24pLCB0MzsKICAgICAgICAgICAgfShyMiksIEtwW2UyXVtuMl0ucmF3ID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgICB2YXIgdDMgPSBmdW5jdGlvbih0NCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHQ0ID09IG51bGwgPyB0NCA6IChhcmd1bWVudHMubGVuZ3RoID4gMSAmJiAodDQgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKSwgZTModDQpKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHJldHVybiAiY29udmVyc2lvbiIgaW4gZTMgJiYgKHQzLmNvbnZlcnNpb24gPSBlMy5jb252ZXJzaW9uKSwgdDM7CiAgICAgICAgICAgIH0ocjIpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIFFwLCBacCA9IEtwOwogICAgICAgIGZ1bmN0aW9uIGVmKCkgewogICAgICAgICAgaWYgKFFwID09PSB2b2lkIDApIHsKICAgICAgICAgICAgdmFyIGUyID0gbmV3IEFycmF5QnVmZmVyKDIpLCB0MiA9IG5ldyBVaW50OEFycmF5KGUyKSwgbjIgPSBuZXcgVWludDE2QXJyYXkoZTIpOwogICAgICAgICAgICBpZiAodDJbMF0gPSAxLCB0MlsxXSA9IDIsIG4yWzBdID09PSAyNTgpCiAgICAgICAgICAgICAgUXAgPSAiQkUiOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBpZiAobjJbMF0gIT09IDUxMykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5hYmxlIHRvIGZpZ3VyZSBvdXQgZW5kaWFuZXNzIik7CiAgICAgICAgICAgICAgUXAgPSAiTEUiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gUXA7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRmKCkgewogICAgICAgICAgcmV0dXJuIE5zLmxvY2F0aW9uICE9PSB2b2lkIDAgPyBOcy5sb2NhdGlvbi5ob3N0bmFtZSA6ICIiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBuZigpIHsKICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcmYoKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb2YoKSB7CiAgICAgICAgICByZXR1cm4gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdWYoKSB7CiAgICAgICAgICByZXR1cm4gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc2YoKSB7CiAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFmKCkgewogICAgICAgICAgcmV0dXJuICJCcm93c2VyIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY2YoKSB7CiAgICAgICAgICByZXR1cm4gTnMubmF2aWdhdG9yICE9PSB2b2lkIDAgPyBOcy5uYXZpZ2F0b3IuYXBwVmVyc2lvbiA6ICIiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBsZigpIHsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcGYoKSB7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGZmKCkgewogICAgICAgICAgcmV0dXJuICJqYXZhc2NyaXB0IjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZGYoKSB7CiAgICAgICAgICByZXR1cm4gImJyb3dzZXIiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBoZigpIHsKICAgICAgICAgIHJldHVybiAiL3RtcCI7CiAgICAgICAgfQogICAgICAgICFmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBacCwgbjIgPSAoZTMsIG4zKSA9PiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgY29uc3QgcjMgPSBlMy5hcHBseSh0MiwgYXJndW1lbnRzKTsKICAgICAgICAgICAgcmV0dXJuICJceDFCWyIuY29uY2F0KHIzICsgbjMsICJtIik7CiAgICAgICAgICB9LCByMiA9IChlMywgbjMpID0+IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjb25zdCByMyA9IGUzLmFwcGx5KHQyLCBhcmd1bWVudHMpOwogICAgICAgICAgICByZXR1cm4gIlx4MUJbIi5jb25jYXQoMzggKyBuMywgIjs1OyIpLmNvbmNhdChyMywgIm0iKTsKICAgICAgICAgIH0sIG8yID0gKGUzLCBuMykgPT4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGNvbnN0IHIzID0gZTMuYXBwbHkodDIsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIHJldHVybiAiXHgxQlsiLmNvbmNhdCgzOCArIG4zLCAiOzI7IikuY29uY2F0KHIzWzBdLCAiOyIpLmNvbmNhdChyM1sxXSwgIjsiKS5jb25jYXQocjNbMl0sICJtIik7CiAgICAgICAgICB9OwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCAiZXhwb3J0cyIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLCBpMiA9IHsgbW9kaWZpZXI6IHsgcmVzZXQ6IFswLCAwXSwgYm9sZDogWzEsIDIyXSwgZGltOiBbMiwgMjJdLCBpdGFsaWM6IFszLCAyM10sIHVuZGVybGluZTogWzQsIDI0XSwgaW52ZXJzZTogWzcsIDI3XSwgaGlkZGVuOiBbOCwgMjhdLCBzdHJpa2V0aHJvdWdoOiBbOSwgMjldIH0sIGNvbG9yOiB7IGJsYWNrOiBbMzAsIDM5XSwgcmVkOiBbMzEsIDM5XSwgZ3JlZW46IFszMiwgMzldLCB5ZWxsb3c6IFszMywgMzldLCBibHVlOiBbMzQsIDM5XSwgbWFnZW50YTogWzM1LCAzOV0sIGN5YW46IFszNiwgMzldLCB3aGl0ZTogWzM3LCAzOV0sIGdyYXk6IFs5MCwgMzldLCByZWRCcmlnaHQ6IFs5MSwgMzldLCBncmVlbkJyaWdodDogWzkyLCAzOV0sIHllbGxvd0JyaWdodDogWzkzLCAzOV0sIGJsdWVCcmlnaHQ6IFs5NCwgMzldLCBtYWdlbnRhQnJpZ2h0OiBbOTUsIDM5XSwgY3lhbkJyaWdodDogWzk2LCAzOV0sIHdoaXRlQnJpZ2h0OiBbOTcsIDM5XSB9LCBiZ0NvbG9yOiB7IGJnQmxhY2s6IFs0MCwgNDldLCBiZ1JlZDogWzQxLCA0OV0sIGJnR3JlZW46IFs0MiwgNDldLCBiZ1llbGxvdzogWzQzLCA0OV0sIGJnQmx1ZTogWzQ0LCA0OV0sIGJnTWFnZW50YTogWzQ1LCA0OV0sIGJnQ3lhbjogWzQ2LCA0OV0sIGJnV2hpdGU6IFs0NywgNDldLCBiZ0JsYWNrQnJpZ2h0OiBbMTAwLCA0OV0sIGJnUmVkQnJpZ2h0OiBbMTAxLCA0OV0sIGJnR3JlZW5CcmlnaHQ6IFsxMDIsIDQ5XSwgYmdZZWxsb3dCcmlnaHQ6IFsxMDMsIDQ5XSwgYmdCbHVlQnJpZ2h0OiBbMTA0LCA0OV0sIGJnTWFnZW50YUJyaWdodDogWzEwNSwgNDldLCBiZ0N5YW5CcmlnaHQ6IFsxMDYsIDQ5XSwgYmdXaGl0ZUJyaWdodDogWzEwNywgNDldIH0gfTsKICAgICAgICAgICAgaTIuY29sb3IuZ3JleSA9IGkyLmNvbG9yLmdyYXk7CiAgICAgICAgICAgIGZvciAoY29uc3QgdDMgb2YgT2JqZWN0LmtleXMoaTIpKSB7CiAgICAgICAgICAgICAgY29uc3QgbjMgPSBpMlt0M107CiAgICAgICAgICAgICAgZm9yIChjb25zdCB0NCBvZiBPYmplY3Qua2V5cyhuMykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHIzID0gbjNbdDRdOwogICAgICAgICAgICAgICAgaTJbdDRdID0geyBvcGVuOiAiXHgxQlsiLmNvbmNhdChyM1swXSwgIm0iKSwgY2xvc2U6ICJceDFCWyIuY29uY2F0KHIzWzFdLCAibSIpIH0sIG4zW3Q0XSA9IGkyW3Q0XSwgZTMuc2V0KHIzWzBdLCByM1sxXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpMiwgdDMsIHsgdmFsdWU6IG4zLCBlbnVtZXJhYmxlOiBmYWxzZSB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGkyLCAiY29kZXMiLCB7IHZhbHVlOiBlMywgZW51bWVyYWJsZTogZmFsc2UgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgdTIgPSAoZTQpID0+IGU0LCBzMiA9IChlNCwgdDMsIG4zKSA9PiBbZTQsIHQzLCBuM107CiAgICAgICAgICAgIGkyLmNvbG9yLmNsb3NlID0gIlx4MUJbMzltIiwgaTIuYmdDb2xvci5jbG9zZSA9ICJceDFCWzQ5bSIsIGkyLmNvbG9yLmFuc2kgPSB7IGFuc2k6IG4yKHUyLCAwKSB9LCBpMi5jb2xvci5hbnNpMjU2ID0geyBhbnNpMjU2OiByMih1MiwgMCkgfSwgaTIuY29sb3IuYW5zaTE2bSA9IHsgcmdiOiBvMihzMiwgMCkgfSwgaTIuYmdDb2xvci5hbnNpID0geyBhbnNpOiBuMih1MiwgMTApIH0sIGkyLmJnQ29sb3IuYW5zaTI1NiA9IHsgYW5zaTI1NjogcjIodTIsIDEwKSB9LCBpMi5iZ0NvbG9yLmFuc2kxNm0gPSB7IHJnYjogbzIoczIsIDEwKSB9OwogICAgICAgICAgICBmb3IgKGxldCBlNCBvZiBPYmplY3Qua2V5cyh0MikpIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHQyW2U0XSAhPSAib2JqZWN0IikKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIGNvbnN0IHUzID0gdDJbZTRdOwogICAgICAgICAgICAgIGU0ID09PSAiYW5zaTE2IiAmJiAoZTQgPSAiYW5zaSIpLCAiYW5zaTE2IiBpbiB1MyAmJiAoaTIuY29sb3IuYW5zaVtlNF0gPSBuMih1My5hbnNpMTYsIDApLCBpMi5iZ0NvbG9yLmFuc2lbZTRdID0gbjIodTMuYW5zaTE2LCAxMCkpLCAiYW5zaTI1NiIgaW4gdTMgJiYgKGkyLmNvbG9yLmFuc2kyNTZbZTRdID0gcjIodTMuYW5zaTI1NiwgMCksIGkyLmJnQ29sb3IuYW5zaTI1NltlNF0gPSByMih1My5hbnNpMjU2LCAxMCkpLCAicmdiIiBpbiB1MyAmJiAoaTIuY29sb3IuYW5zaTE2bVtlNF0gPSBvMih1My5yZ2IsIDApLCBpMi5iZ0NvbG9yLmFuc2kxNm1bZTRdID0gbzIodTMucmdiLCAxMCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICAgIH0gfSk7CiAgICAgICAgfShqcCk7CiAgICAgICAgdmFyIGdmID0gaGYsIG1mID0geyBFT0w6ICJcbiIsIGFyY2g6IGZmLCBwbGF0Zm9ybTogZGYsIHRtcGRpcjogZ2YsIHRtcERpcjogaGYsIG5ldHdvcmtJbnRlcmZhY2VzOiBsZiwgZ2V0TmV0d29ya0ludGVyZmFjZXM6IHBmLCByZWxlYXNlOiBjZiwgdHlwZTogYWYsIGNwdXM6IHNmLCB0b3RhbG1lbTogdWYsIGZyZWVtZW06IG9mLCB1cHRpbWU6IHJmLCBsb2FkYXZnOiBuZiwgaG9zdG5hbWU6IHRmLCBlbmRpYW5uZXNzOiBlZiB9LCB5ZiA9IHQoT2JqZWN0LmZyZWV6ZSh7IF9fcHJvdG9fXzogbnVsbCwgZW5kaWFubmVzczogZWYsIGhvc3RuYW1lOiB0ZiwgbG9hZGF2ZzogbmYsIHVwdGltZTogcmYsIGZyZWVtZW06IG9mLCB0b3RhbG1lbTogdWYsIGNwdXM6IHNmLCB0eXBlOiBhZiwgcmVsZWFzZTogY2YsIG5ldHdvcmtJbnRlcmZhY2VzOiBsZiwgZ2V0TmV0d29ya0ludGVyZmFjZXM6IHBmLCBhcmNoOiBmZiwgcGxhdGZvcm06IGRmLCB0bXBEaXI6IGhmLCB0bXBkaXI6IGdmLCBFT0w6ICJcbiIsIGRlZmF1bHQ6IG1mIH0pKTsKICAgICAgICBjb25zdCBEZiA9IHlmLCBFZiA9IChlMiwgdDIpID0+IHsKICAgICAgICAgIHQyID0gdDIgfHwgdGEuYXJndjsKICAgICAgICAgIGNvbnN0IG4yID0gZTIuc3RhcnRzV2l0aCgiLSIpID8gIiIgOiBlMi5sZW5ndGggPT09IDEgPyAiLSIgOiAiLS0iLCByMiA9IHQyLmluZGV4T2YobjIgKyBlMiksIG8yID0gdDIuaW5kZXhPZigiLS0iKTsKICAgICAgICAgIHJldHVybiByMiAhPT0gLTEgJiYgKG8yID09PSAtMSB8fCByMiA8IG8yKTsKICAgICAgICB9LCBDZiA9IHRhLmVudjsKICAgICAgICBsZXQgYmY7CiAgICAgICAgZnVuY3Rpb24gdmYoZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgaWYgKGJmID09PSBmYWxzZSkKICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgaWYgKEVmKCJjb2xvcj0xNm0iKSB8fCBFZigiY29sb3I9ZnVsbCIpIHx8IEVmKCJjb2xvcj10cnVlY29sb3IiKSkKICAgICAgICAgICAgICByZXR1cm4gMzsKICAgICAgICAgICAgaWYgKEVmKCJjb2xvcj0yNTYiKSkKICAgICAgICAgICAgICByZXR1cm4gMjsKICAgICAgICAgICAgaWYgKGUzICYmICFlMy5pc1RUWSAmJiBiZiAhPT0gdHJ1ZSkKICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgY29uc3QgdDMgPSBiZiA/IDEgOiAwOwogICAgICAgICAgICBpZiAodGEucGxhdGZvcm0gPT09ICJ3aW4zMiIpIHsKICAgICAgICAgICAgICBjb25zdCBlNCA9IERmLnJlbGVhc2UoKS5zcGxpdCgiLiIpOwogICAgICAgICAgICAgIHJldHVybiBOdW1iZXIodGEudmVyc2lvbnMubm9kZS5zcGxpdCgiLiIpWzBdKSA+PSA4ICYmIE51bWJlcihlNFswXSkgPj0gMTAgJiYgTnVtYmVyKGU0WzJdKSA+PSAxMDU4NiA/IE51bWJlcihlNFsyXSkgPj0gMTQ5MzEgPyAzIDogMiA6IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCJDSSIgaW4gQ2YpCiAgICAgICAgICAgICAgcmV0dXJuIFsiVFJBVklTIiwgIkNJUkNMRUNJIiwgIkFQUFZFWU9SIiwgIkdJVExBQl9DSSJdLnNvbWUoKGU0KSA9PiBlNCBpbiBDZikgfHwgQ2YuQ0lfTkFNRSA9PT0gImNvZGVzaGlwIiA/IDEgOiB0MzsKICAgICAgICAgICAgaWYgKCJURUFNQ0lUWV9WRVJTSU9OIiBpbiBDZikKICAgICAgICAgICAgICByZXR1cm4gL14oOVwuKDAqWzEtOV1cZCopXC58XGR7Mix9XC4pLy50ZXN0KENmLlRFQU1DSVRZX1ZFUlNJT04pID8gMSA6IDA7CiAgICAgICAgICAgIGlmIChDZi5DT0xPUlRFUk0gPT09ICJ0cnVlY29sb3IiKQogICAgICAgICAgICAgIHJldHVybiAzOwogICAgICAgICAgICBpZiAoIlRFUk1fUFJPR1JBTSIgaW4gQ2YpIHsKICAgICAgICAgICAgICBjb25zdCBlNCA9IHBhcnNlSW50KChDZi5URVJNX1BST0dSQU1fVkVSU0lPTiB8fCAiIikuc3BsaXQoIi4iKVswXSwgMTApOwogICAgICAgICAgICAgIHN3aXRjaCAoQ2YuVEVSTV9QUk9HUkFNKSB7CiAgICAgICAgICAgICAgICBjYXNlICJpVGVybS5hcHAiOgogICAgICAgICAgICAgICAgICByZXR1cm4gZTQgPj0gMyA/IDMgOiAyOwogICAgICAgICAgICAgICAgY2FzZSAiQXBwbGVfVGVybWluYWwiOgogICAgICAgICAgICAgICAgICByZXR1cm4gMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC8tMjU2KGNvbG9yKT8kL2kudGVzdChDZi5URVJNKSA/IDIgOiAvXnNjcmVlbnxeeHRlcm18XnZ0MTAwfF52dDIyMHxecnh2dHxjb2xvcnxhbnNpfGN5Z3dpbnxsaW51eC9pLnRlc3QoQ2YuVEVSTSkgfHwgIkNPTE9SVEVSTSIgaW4gQ2YgPyAxIDogKENmLlRFUk0sIHQzKTsKICAgICAgICAgIH0oZTIpOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMyAhPT0gMCAmJiB7IGxldmVsOiBlMywgaGFzQmFzaWM6IHRydWUsIGhhczI1NjogZTMgPj0gMiwgaGFzMTZtOiBlMyA+PSAzIH07CiAgICAgICAgICB9KHQyKTsKICAgICAgICB9CiAgICAgICAgRWYoIm5vLWNvbG9yIikgfHwgRWYoIm5vLWNvbG9ycyIpIHx8IEVmKCJjb2xvcj1mYWxzZSIpID8gYmYgPSBmYWxzZSA6IChFZigiY29sb3IiKSB8fCBFZigiY29sb3JzIikgfHwgRWYoImNvbG9yPXRydWUiKSB8fCBFZigiY29sb3I9YWx3YXlzIikpICYmIChiZiA9IHRydWUpLCAiRk9SQ0VfQ09MT1IiIGluIENmICYmIChiZiA9IENmLkZPUkNFX0NPTE9SLmxlbmd0aCA9PT0gMCB8fCBwYXJzZUludChDZi5GT1JDRV9DT0xPUiwgMTApICE9PSAwKTsKICAgICAgICB2YXIgQWYgPSB7IHN1cHBvcnRzQ29sb3I6IHZmLCBzdGRvdXQ6IHZmKHRhLnN0ZG91dCksIHN0ZGVycjogdmYodGEuc3RkZXJyKSB9OwogICAgICAgIGNvbnN0IEZmID0gLyg/OlxcKHVbYS1mXGRdezR9fHhbYS1mXGRdezJ9fC4pKXwoPzpceyh+KT8oXHcrKD86XChbXildKlwpKT8oPzpcLlx3Kyg/OlwoW14pXSpcKSk/KSopKD86WyBcdF18KD89XHI/XG4pKSl8KFx9KXwoKD86LnxbXHJcblxmXSkrPykvZ2ksIHhmID0gLyg/Ol58XC4pKFx3KykoPzpcKChbXildKilcKSk/L2csIFNmID0gL14oWyciXSkoKD86XFwufCg/IVwxKVteXFxdKSopXDEkLywgd2YgPSAvXFwodVthLWZcZF17NH18eFthLWZcZF17Mn18Lil8KFteXFxdKS9naSwgVGYgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcChbWyJuIiwgIlxuIl0sIFsiciIsICJcciJdLCBbInQiLCAiCSJdLCBbImIiLCAiXGIiXSwgWyJmIiwgIlxmIl0sIFsidiIsICJcdiJdLCBbIjAiLCAiXDAiXSwgWyJcXCIsICJcXCJdLCBbImUiLCAiXHgxQiJdLCBbImEiLCAiXHgwNyJdXSk7CiAgICAgICAgZnVuY3Rpb24gQmYoZTIpIHsKICAgICAgICAgIHJldHVybiBlMlswXSA9PT0gInUiICYmIGUyLmxlbmd0aCA9PT0gNSB8fCBlMlswXSA9PT0gIngiICYmIGUyLmxlbmd0aCA9PT0gMyA/IFN0cmluZy5mcm9tQ2hhckNvZGUocGFyc2VJbnQoZTIuc2xpY2UoMSksIDE2KSkgOiBUZi5nZXQoZTIpIHx8IGUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBOZihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gW10sIHIyID0gdDIudHJpbSgpLnNwbGl0KC9ccyosXHMqL2cpOwogICAgICAgICAgbGV0IG8yOwogICAgICAgICAgZm9yIChjb25zdCB0MyBvZiByMikKICAgICAgICAgICAgaWYgKGlzTmFOKHQzKSkgewogICAgICAgICAgICAgIGlmICghKG8yID0gdDMubWF0Y2goU2YpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBDaGFsayB0ZW1wbGF0ZSBzdHlsZSBhcmd1bWVudDogIi5jb25jYXQodDMsICIgKGluIHN0eWxlICciKS5jb25jYXQoZTIsICInKSIpKTsKICAgICAgICAgICAgICBuMi5wdXNoKG8yWzJdLnJlcGxhY2Uod2YsIChlMywgdDQsIG4zKSA9PiB0NCA/IEJmKHQ0KSA6IG4zKSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIG4yLnB1c2goTnVtYmVyKHQzKSk7CiAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGtmKGUyKSB7CiAgICAgICAgICB4Zi5sYXN0SW5kZXggPSAwOwogICAgICAgICAgY29uc3QgdDIgPSBbXTsKICAgICAgICAgIGxldCBuMjsKICAgICAgICAgIGZvciAoOyAobjIgPSB4Zi5leGVjKGUyKSkgIT09IG51bGw7ICkgewogICAgICAgICAgICBjb25zdCBlMyA9IG4yWzFdOwogICAgICAgICAgICBpZiAobjJbMl0pIHsKICAgICAgICAgICAgICBjb25zdCByMiA9IE5mKGUzLCBuMlsyXSk7CiAgICAgICAgICAgICAgdDIucHVzaChbZTNdLmNvbmNhdChyMikpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICB0Mi5wdXNoKFtlM10pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBQZihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0ge307CiAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIHQyKQogICAgICAgICAgICBmb3IgKGNvbnN0IHQzIG9mIGUzLnN0eWxlcykKICAgICAgICAgICAgICBuMlt0M1swXV0gPSBlMy5pbnZlcnNlID8gbnVsbCA6IHQzLnNsaWNlKDEpOwogICAgICAgICAgbGV0IHIyID0gZTI7CiAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIE9iamVjdC5rZXlzKG4yKSkKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobjJbZTNdKSkgewogICAgICAgICAgICAgIGlmICghKGUzIGluIHIyKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBDaGFsayBzdHlsZTogIi5jb25jYXQoZTMpKTsKICAgICAgICAgICAgICByMiA9IG4yW2UzXS5sZW5ndGggPiAwID8gcjJbZTNdLmFwcGx5KHIyLCBuMltlM10pIDogcjJbZTNdOwogICAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgfQogICAgICAgIHZhciBPZiA9IChlMiwgdDIpID0+IHsKICAgICAgICAgIGNvbnN0IG4yID0gW10sIHIyID0gW107CiAgICAgICAgICBsZXQgbzIgPSBbXTsKICAgICAgICAgIGlmICh0Mi5yZXBsYWNlKEZmLCAodDMsIGkyLCB1MiwgczIsIGEyLCBjMikgPT4gewogICAgICAgICAgICBpZiAoaTIpCiAgICAgICAgICAgICAgbzIucHVzaChCZihpMikpOwogICAgICAgICAgICBlbHNlIGlmIChzMikgewogICAgICAgICAgICAgIGNvbnN0IHQ0ID0gbzIuam9pbigiIik7CiAgICAgICAgICAgICAgbzIgPSBbXSwgcjIucHVzaChuMi5sZW5ndGggPT09IDAgPyB0NCA6IFBmKGUyLCBuMikodDQpKSwgbjIucHVzaCh7IGludmVyc2U6IHUyLCBzdHlsZXM6IGtmKHMyKSB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhMikgewogICAgICAgICAgICAgIGlmIChuMi5sZW5ndGggPT09IDApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkZvdW5kIGV4dHJhbmVvdXMgfSBpbiBDaGFsayB0ZW1wbGF0ZSBsaXRlcmFsIik7CiAgICAgICAgICAgICAgcjIucHVzaChQZihlMiwgbjIpKG8yLmpvaW4oIiIpKSksIG8yID0gW10sIG4yLnBvcCgpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBvMi5wdXNoKGMyKTsKICAgICAgICAgIH0pLCByMi5wdXNoKG8yLmpvaW4oIiIpKSwgbjIubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCBlMyA9ICJDaGFsayB0ZW1wbGF0ZSBsaXRlcmFsIGlzIG1pc3NpbmcgIi5jb25jYXQobjIubGVuZ3RoLCAiIGNsb3NpbmcgYnJhY2tldCIpLmNvbmNhdChuMi5sZW5ndGggPT09IDEgPyAiIiA6ICJzIiwgIiAoYH1gKSIpOwogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZTMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHIyLmpvaW4oIiIpOwogICAgICAgIH07CiAgICAgICAgIWZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IExwLCBuMiA9IGpwLmV4cG9ydHMsIHIyID0gQWYuc3Rkb3V0LCBvMiA9IE9mLCBpMiA9IHRhLnBsYXRmb3JtID09PSAid2luMzIiICYmICEodGEuZW52LlRFUk0gfHwgIiIpLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aCgieHRlcm0iKSwgdTIgPSBbImFuc2kiLCAiYW5zaSIsICJhbnNpMjU2IiwgImFuc2kxNm0iXSwgczIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldChbImdyYXkiXSksIGEyID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICBmdW5jdGlvbiBjMihlMywgdDMpIHsKICAgICAgICAgICAgdDMgPSB0MyB8fCB7fTsKICAgICAgICAgICAgY29uc3QgbjMgPSByMiA/IHIyLmxldmVsIDogMDsKICAgICAgICAgICAgZTMubGV2ZWwgPSB0My5sZXZlbCA9PT0gdm9pZCAwID8gbjMgOiB0My5sZXZlbCwgZTMuZW5hYmxlZCA9ICJlbmFibGVkIiBpbiB0MyA/IHQzLmVuYWJsZWQgOiBlMy5sZXZlbCA+IDA7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBsMihlMykgewogICAgICAgICAgICBpZiAoIXRoaXMgfHwgISh0aGlzIGluc3RhbmNlb2YgbDIpIHx8IHRoaXMudGVtcGxhdGUpIHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IHt9OwogICAgICAgICAgICAgIHJldHVybiBjMih0MywgZTMpLCB0My50ZW1wbGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgY29uc3QgZTQgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICByZXR1cm4gaDIuYXBwbHkobnVsbCwgW3QzLnRlbXBsYXRlXS5jb25jYXQoZTQpKTsKICAgICAgICAgICAgICB9LCBPYmplY3Quc2V0UHJvdG90eXBlT2YodDMsIGwyLnByb3RvdHlwZSksIE9iamVjdC5zZXRQcm90b3R5cGVPZih0My50ZW1wbGF0ZSwgdDMpLCB0My50ZW1wbGF0ZS5jb25zdHJ1Y3RvciA9IGwyLCB0My50ZW1wbGF0ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjMih0aGlzLCBlMyk7CiAgICAgICAgICB9CiAgICAgICAgICBpMiAmJiAobjIuYmx1ZS5vcGVuID0gIlx4MUJbOTRtIik7CiAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIE9iamVjdC5rZXlzKG4yKSkKICAgICAgICAgICAgbjJbZTNdLmNsb3NlUmUgPSBuZXcgUmVnRXhwKHQyKG4yW2UzXS5jbG9zZSksICJnIiksIGEyW2UzXSA9IHsgZ2V0KCkgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gbjJbZTNdOwogICAgICAgICAgICAgIHJldHVybiBmMi5jYWxsKHRoaXMsIHRoaXMuX3N0eWxlcyA/IHRoaXMuX3N0eWxlcy5jb25jYXQodDMpIDogW3QzXSwgdGhpcy5fZW1wdHksIGUzKTsKICAgICAgICAgICAgfSB9OwogICAgICAgICAgYTIudmlzaWJsZSA9IHsgZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gZjIuY2FsbCh0aGlzLCB0aGlzLl9zdHlsZXMgfHwgW10sIHRydWUsICJ2aXNpYmxlIik7CiAgICAgICAgICB9IH0sIG4yLmNvbG9yLmNsb3NlUmUgPSBuZXcgUmVnRXhwKHQyKG4yLmNvbG9yLmNsb3NlKSwgImciKTsKICAgICAgICAgIGZvciAoY29uc3QgZTMgb2YgT2JqZWN0LmtleXMobjIuY29sb3IuYW5zaSkpCiAgICAgICAgICAgIHMyLmhhcyhlMykgfHwgKGEyW2UzXSA9IHsgZ2V0KCkgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5sZXZlbDsKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjb25zdCByMyA9IG4yLmNvbG9yW3UyW3QzXV1bZTNdLmFwcGx5KG51bGwsIGFyZ3VtZW50cyksIG8zID0geyBvcGVuOiByMywgY2xvc2U6IG4yLmNvbG9yLmNsb3NlLCBjbG9zZVJlOiBuMi5jb2xvci5jbG9zZVJlIH07CiAgICAgICAgICAgICAgICByZXR1cm4gZjIuY2FsbCh0aGlzLCB0aGlzLl9zdHlsZXMgPyB0aGlzLl9zdHlsZXMuY29uY2F0KG8zKSA6IFtvM10sIHRoaXMuX2VtcHR5LCBlMyk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSB9KTsKICAgICAgICAgIG4yLmJnQ29sb3IuY2xvc2VSZSA9IG5ldyBSZWdFeHAodDIobjIuYmdDb2xvci5jbG9zZSksICJnIik7CiAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIE9iamVjdC5rZXlzKG4yLmJnQ29sb3IuYW5zaSkpIHsKICAgICAgICAgICAgaWYgKHMyLmhhcyhlMykpCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGEyWyJiZyIgKyBlM1swXS50b1VwcGVyQ2FzZSgpICsgZTMuc2xpY2UoMSldID0geyBnZXQoKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLmxldmVsOwogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHIzID0gbjIuYmdDb2xvclt1Mlt0M11dW2UzXS5hcHBseShudWxsLCBhcmd1bWVudHMpLCBvMyA9IHsgb3BlbjogcjMsIGNsb3NlOiBuMi5iZ0NvbG9yLmNsb3NlLCBjbG9zZVJlOiBuMi5iZ0NvbG9yLmNsb3NlUmUgfTsKICAgICAgICAgICAgICAgIHJldHVybiBmMi5jYWxsKHRoaXMsIHRoaXMuX3N0eWxlcyA/IHRoaXMuX3N0eWxlcy5jb25jYXQobzMpIDogW28zXSwgdGhpcy5fZW1wdHksIGUzKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IH07CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBwMiA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCgpID0+IHsKICAgICAgICAgIH0sIGEyKTsKICAgICAgICAgIGZ1bmN0aW9uIGYyKGUzLCB0MywgbjMpIHsKICAgICAgICAgICAgY29uc3QgcjMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gZDIuYXBwbHkocjMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHIzLl9zdHlsZXMgPSBlMywgcjMuX2VtcHR5ID0gdDM7CiAgICAgICAgICAgIGNvbnN0IG8zID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyMywgImxldmVsIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6ICgpID0+IG8zLmxldmVsLCBzZXQoZTQpIHsKICAgICAgICAgICAgICBvMy5sZXZlbCA9IGU0OwogICAgICAgICAgICB9IH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkocjMsICJlbmFibGVkIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6ICgpID0+IG8zLmVuYWJsZWQsIHNldChlNCkgewogICAgICAgICAgICAgIG8zLmVuYWJsZWQgPSBlNDsKICAgICAgICAgICAgfSB9KSwgcjMuaGFzR3JleSA9IHRoaXMuaGFzR3JleSB8fCBuMyA9PT0gImdyYXkiIHx8IG4zID09PSAiZ3JleSIsIHIzLl9fcHJvdG9fXyA9IHAyLCByMzsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGQyKCkgewogICAgICAgICAgICBjb25zdCBlMyA9IGFyZ3VtZW50cywgdDMgPSBlMy5sZW5ndGg7CiAgICAgICAgICAgIGxldCByMyA9IFN0cmluZyhhcmd1bWVudHNbMF0pOwogICAgICAgICAgICBpZiAodDMgPT09IDApCiAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICBpZiAodDMgPiAxKQogICAgICAgICAgICAgIGZvciAobGV0IG4zID0gMTsgbjMgPCB0MzsgbjMrKykKICAgICAgICAgICAgICAgIHIzICs9ICIgIiArIGUzW24zXTsKICAgICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWQgfHwgdGhpcy5sZXZlbCA8PSAwIHx8ICFyMykKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW1wdHkgPyAiIiA6IHIzOwogICAgICAgICAgICBjb25zdCBvMyA9IG4yLmRpbS5vcGVuOwogICAgICAgICAgICBpMiAmJiB0aGlzLmhhc0dyZXkgJiYgKG4yLmRpbS5vcGVuID0gIiIpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGU0IG9mIHRoaXMuX3N0eWxlcy5zbGljZSgpLnJldmVyc2UoKSkKICAgICAgICAgICAgICByMyA9IGU0Lm9wZW4gKyByMy5yZXBsYWNlKGU0LmNsb3NlUmUsIGU0Lm9wZW4pICsgZTQuY2xvc2UsIHIzID0gcjMucmVwbGFjZSgvXHI/XG4vZywgIiIuY29uY2F0KGU0LmNsb3NlLCAiJCYiKS5jb25jYXQoZTQub3BlbikpOwogICAgICAgICAgICByZXR1cm4gbjIuZGltLm9wZW4gPSBvMywgcjM7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBoMihlMywgdDMpIHsKICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHQzKSkKICAgICAgICAgICAgICByZXR1cm4gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLmpvaW4oIiAiKTsKICAgICAgICAgICAgY29uc3QgbjMgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMiksIHIzID0gW3QzLnJhd1swXV07CiAgICAgICAgICAgIGZvciAobGV0IGU0ID0gMTsgZTQgPCB0My5sZW5ndGg7IGU0KyspCiAgICAgICAgICAgICAgcjMucHVzaChTdHJpbmcobjNbZTQgLSAxXSkucmVwbGFjZSgvW3t9XFxdL2csICJcXCQmIikpLCByMy5wdXNoKFN0cmluZyh0My5yYXdbZTRdKSk7CiAgICAgICAgICAgIHJldHVybiBvMihlMywgcjMuam9pbigiIikpOwogICAgICAgICAgfQogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMobDIucHJvdG90eXBlLCBhMiksIGUyLmV4cG9ydHMgPSBsMigpLCBlMi5leHBvcnRzLnN1cHBvcnRzQ29sb3IgPSByMiwgZTIuZXhwb3J0cy5kZWZhdWx0ID0gZTIuZXhwb3J0czsKICAgICAgICB9KE9wKSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KFBwLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgY29uc3QgSWYgPSBPcC5leHBvcnRzOwogICAgICAgIFBwLmNvbW1vbkRlcHJlY2F0ZWRIYW5kbGVyID0gKGUyLCB0MiwgbjIpID0+IHsKICAgICAgICAgIGxldCB7IGRlc2NyaXB0b3I6IHIyIH0gPSBuMjsKICAgICAgICAgIGNvbnN0IG8yID0gWyIiLmNvbmNhdChJZi5kZWZhdWx0LnllbGxvdyh0eXBlb2YgZTIgPT0gInN0cmluZyIgPyByMi5rZXkoZTIpIDogcjIucGFpcihlMikpLCAiIGlzIGRlcHJlY2F0ZWQiKV07CiAgICAgICAgICByZXR1cm4gdDIgJiYgbzIucHVzaCgid2Ugbm93IHRyZWF0IGl0IGFzICIuY29uY2F0KElmLmRlZmF1bHQuYmx1ZSh0eXBlb2YgdDIgPT0gInN0cmluZyIgPyByMi5rZXkodDIpIDogcjIucGFpcih0MikpKSksIG8yLmpvaW4oIjsgIikgKyAiLiI7CiAgICAgICAgfSwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgICAgd3AuX19leHBvcnRTdGFyKFBwLCBlMik7CiAgICAgICAgfShrcCk7CiAgICAgICAgdmFyIExmID0ge30sIGpmID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGpmLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgY29uc3QgX2YgPSBPcC5leHBvcnRzOwogICAgICAgIGpmLmNvbW1vbkludmFsaWRIYW5kbGVyID0gKGUyLCB0MiwgbjIpID0+IFsiSW52YWxpZCAiLmNvbmNhdChfZi5kZWZhdWx0LnJlZChuMi5kZXNjcmlwdG9yLmtleShlMikpLCAiIHZhbHVlLiIpLCAiRXhwZWN0ZWQgIi5jb25jYXQoX2YuZGVmYXVsdC5ibHVlKG4yLnNjaGVtYXNbZTJdLmV4cGVjdGVkKG4yKSksICIsIiksICJidXQgcmVjZWl2ZWQgIi5jb25jYXQoX2YuZGVmYXVsdC5yZWQobjIuZGVzY3JpcHRvci52YWx1ZSh0MikpLCAiLiIpXS5qb2luKCIgIiksIGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgICAgIHdwLl9fZXhwb3J0U3RhcihqZiwgZTIpOwogICAgICAgIH0oTGYpOwogICAgICAgIHZhciBNZiA9IHt9LCBSZiA9IHt9LCBWZiA9IFtdLCAkZiA9IFtdOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgIGNvbnN0IFdmID0gT3AuZXhwb3J0cywgcWYgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGlmIChlMiA9PT0gdDIpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgdmFyIG4yID0gZTI7CiAgICAgICAgICBlMi5sZW5ndGggPiB0Mi5sZW5ndGggJiYgKGUyID0gdDIsIHQyID0gbjIpOwogICAgICAgICAgdmFyIHIyID0gZTIubGVuZ3RoLCBvMiA9IHQyLmxlbmd0aDsKICAgICAgICAgIGlmIChyMiA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIG8yOwogICAgICAgICAgaWYgKG8yID09PSAwKQogICAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgICBmb3IgKDsgcjIgPiAwICYmIGUyLmNoYXJDb2RlQXQofi1yMikgPT09IHQyLmNoYXJDb2RlQXQofi1vMik7ICkKICAgICAgICAgICAgcjItLSwgbzItLTsKICAgICAgICAgIGlmIChyMiA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIG8yOwogICAgICAgICAgZm9yICh2YXIgaTIsIHUyLCBzMiwgYTIsIGMyID0gMDsgYzIgPCByMiAmJiBlMi5jaGFyQ29kZUF0KGMyKSA9PT0gdDIuY2hhckNvZGVBdChjMik7ICkKICAgICAgICAgICAgYzIrKzsKICAgICAgICAgIGlmIChvMiAtPSBjMiwgKHIyIC09IGMyKSA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIG8yOwogICAgICAgICAgZm9yICh2YXIgbDIgPSAwLCBwMiA9IDA7IGwyIDwgcjI7ICkKICAgICAgICAgICAgJGZbYzIgKyBsMl0gPSBlMi5jaGFyQ29kZUF0KGMyICsgbDIpLCBWZltsMl0gPSArK2wyOwogICAgICAgICAgZm9yICg7IHAyIDwgbzI7ICkKICAgICAgICAgICAgZm9yIChpMiA9IHQyLmNoYXJDb2RlQXQoYzIgKyBwMiksIHMyID0gcDIrKywgdTIgPSBwMiwgbDIgPSAwOyBsMiA8IHIyOyBsMisrKQogICAgICAgICAgICAgIGEyID0gaTIgPT09ICRmW2MyICsgbDJdID8gczIgOiBzMiArIDEsIHMyID0gVmZbbDJdLCB1MiA9IFZmW2wyXSA9IHMyID4gdTIgPyBhMiA+IHUyID8gdTIgKyAxIDogYTIgOiBhMiA+IHMyID8gczIgKyAxIDogYTI7CiAgICAgICAgICByZXR1cm4gdTI7CiAgICAgICAgfTsKICAgICAgICBSZi5sZXZlblVua25vd25IYW5kbGVyID0gKGUyLCB0MiwgbjIpID0+IHsKICAgICAgICAgIGxldCB7IGRlc2NyaXB0b3I6IHIyLCBsb2dnZXI6IG8yLCBzY2hlbWFzOiBpMiB9ID0gbjI7CiAgICAgICAgICBjb25zdCB1MiA9IFsiSWdub3JlZCB1bmtub3duIG9wdGlvbiAiLmNvbmNhdChXZi5kZWZhdWx0LnllbGxvdyhyMi5wYWlyKHsga2V5OiBlMiwgdmFsdWU6IHQyIH0pKSwgIi4iKV0sIHMyID0gT2JqZWN0LmtleXMoaTIpLnNvcnQoKS5maW5kKCh0MykgPT4gcWYoZTIsIHQzKSA8IDMpOwogICAgICAgICAgczIgJiYgdTIucHVzaCgiRGlkIHlvdSBtZWFuICIuY29uY2F0KFdmLmRlZmF1bHQuYmx1ZShyMi5rZXkoczIpKSwgIj8iKSksIG8yLndhcm4odTIuam9pbigiICIpKTsKICAgICAgICB9LCBmdW5jdGlvbihlMikgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgICB3cC5fX2V4cG9ydFN0YXIoUmYsIGUyKTsKICAgICAgICB9KE1mKSwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgICAgY29uc3QgdDIgPSB3cDsKICAgICAgICAgIHQyLl9fZXhwb3J0U3RhcihrcCwgZTIpLCB0Mi5fX2V4cG9ydFN0YXIoTGYsIGUyKSwgdDIuX19leHBvcnRTdGFyKE1mLCBlMik7CiAgICAgICAgfShOcCk7CiAgICAgICAgdmFyIFVmID0ge30sIHpmID0ge30sIEdmID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEdmLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgY29uc3QgSGYgPSBbImRlZmF1bHQiLCAiZXhwZWN0ZWQiLCAidmFsaWRhdGUiLCAiZGVwcmVjYXRlZCIsICJmb3J3YXJkIiwgInJlZGlyZWN0IiwgIm92ZXJsYXAiLCAicHJlcHJvY2VzcyIsICJwb3N0cHJvY2VzcyJdOwogICAgICAgIGZ1bmN0aW9uIEpmKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSBuZXcgZTIodDIpLCByMiA9IE9iamVjdC5jcmVhdGUobjIpOwogICAgICAgICAgZm9yIChjb25zdCBlMyBvZiBIZikKICAgICAgICAgICAgZTMgaW4gdDIgJiYgKHIyW2UzXSA9IFlmKHQyW2UzXSwgbjIsIFhmLnByb3RvdHlwZVtlM10ubGVuZ3RoKSk7CiAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgfQogICAgICAgIEdmLmNyZWF0ZVNjaGVtYSA9IEpmOwogICAgICAgIGNsYXNzIFhmIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKGUyKSB7CiAgICAgICAgICAgIHRoaXMubmFtZSA9IGUyLm5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0aWMgY3JlYXRlKGUyKSB7CiAgICAgICAgICAgIHJldHVybiBKZih0aGlzLCBlMik7CiAgICAgICAgICB9CiAgICAgICAgICBkZWZhdWx0KGUyKSB7CiAgICAgICAgICB9CiAgICAgICAgICBleHBlY3RlZChlMikgewogICAgICAgICAgICByZXR1cm4gIm5vdGhpbmciOwogICAgICAgICAgfQogICAgICAgICAgdmFsaWRhdGUoZTIsIHQyKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGRlcHJlY2F0ZWQoZTIsIHQyKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGZvcndhcmQoZTIsIHQyKSB7CiAgICAgICAgICB9CiAgICAgICAgICByZWRpcmVjdChlMiwgdDIpIHsKICAgICAgICAgIH0KICAgICAgICAgIG92ZXJsYXAoZTIsIHQyLCBuMikgewogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICB9CiAgICAgICAgICBwcmVwcm9jZXNzKGUyLCB0MikgewogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICB9CiAgICAgICAgICBwb3N0cHJvY2VzcyhlMiwgdDIpIHsKICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBZZihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGUyID09ICJmdW5jdGlvbiIgPyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZm9yICh2YXIgcjIgPSBhcmd1bWVudHMubGVuZ3RoLCBvMiA9IG5ldyBBcnJheShyMiksIGkyID0gMDsgaTIgPCByMjsgaTIrKykKICAgICAgICAgICAgICBvMltpMl0gPSBhcmd1bWVudHNbaTJdOwogICAgICAgICAgICByZXR1cm4gZTIoLi4ubzIuc2xpY2UoMCwgbjIgLSAxKSwgdDIsIC4uLm8yLnNsaWNlKG4yIC0gMSkpOwogICAgICAgICAgfSA6ICgpID0+IGUyOwogICAgICAgIH0KICAgICAgICBHZi5TY2hlbWEgPSBYZiwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHpmLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgY29uc3QgS2YgPSBHZjsKICAgICAgICBjbGFzcyBRZiBleHRlbmRzIEtmLlNjaGVtYSB7CiAgICAgICAgICBjb25zdHJ1Y3RvcihlMikgewogICAgICAgICAgICBzdXBlcihlMiksIHRoaXMuX3NvdXJjZU5hbWUgPSBlMi5zb3VyY2VOYW1lOwogICAgICAgICAgfQogICAgICAgICAgZXhwZWN0ZWQoZTIpIHsKICAgICAgICAgICAgcmV0dXJuIGUyLnNjaGVtYXNbdGhpcy5fc291cmNlTmFtZV0uZXhwZWN0ZWQoZTIpOwogICAgICAgICAgfQogICAgICAgICAgdmFsaWRhdGUoZTIsIHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0Mi5zY2hlbWFzW3RoaXMuX3NvdXJjZU5hbWVdLnZhbGlkYXRlKGUyLCB0Mik7CiAgICAgICAgICB9CiAgICAgICAgICByZWRpcmVjdChlMiwgdDIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NvdXJjZU5hbWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHpmLkFsaWFzU2NoZW1hID0gUWY7CiAgICAgICAgdmFyIFpmID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFpmLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgY29uc3QgZWQgPSBHZjsKICAgICAgICBjbGFzcyB0ZCBleHRlbmRzIGVkLlNjaGVtYSB7CiAgICAgICAgICBleHBlY3RlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICJhbnl0aGluZyI7CiAgICAgICAgICB9CiAgICAgICAgICB2YWxpZGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFpmLkFueVNjaGVtYSA9IHRkOwogICAgICAgIHZhciBuZCA9IHt9OwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZCwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgIGNvbnN0IHJkID0gd3AsIG9kID0gR2Y7CiAgICAgICAgY2xhc3MgaWQgZXh0ZW5kcyBvZC5TY2hlbWEgewogICAgICAgICAgY29uc3RydWN0b3IoZTIpIHsKICAgICAgICAgICAgdmFyIHsgdmFsdWVTY2hlbWE6IHQyLCBuYW1lOiBuMiA9IHQyLm5hbWUgfSA9IGUyLCByMiA9IHJkLl9fcmVzdChlMiwgWyJ2YWx1ZVNjaGVtYSIsICJuYW1lIl0pOwogICAgICAgICAgICBzdXBlcihPYmplY3QuYXNzaWduKHt9LCByMiwgeyBuYW1lOiBuMiB9KSksIHRoaXMuX3ZhbHVlU2NoZW1hID0gdDI7CiAgICAgICAgICB9CiAgICAgICAgICBleHBlY3RlZChlMikgewogICAgICAgICAgICByZXR1cm4gImFuIGFycmF5IG9mICIuY29uY2F0KHRoaXMuX3ZhbHVlU2NoZW1hLmV4cGVjdGVkKGUyKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YWxpZGF0ZShlMiwgdDIpIHsKICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGUyKSkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IG4yID0gW107CiAgICAgICAgICAgIGZvciAoY29uc3QgcjIgb2YgZTIpIHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IHQyLm5vcm1hbGl6ZVZhbGlkYXRlUmVzdWx0KHRoaXMuX3ZhbHVlU2NoZW1hLnZhbGlkYXRlKHIyLCB0MiksIHIyKTsKICAgICAgICAgICAgICBlMyAhPT0gdHJ1ZSAmJiBuMi5wdXNoKGUzLnZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbjIubGVuZ3RoID09PSAwIHx8IHsgdmFsdWU6IG4yIH07CiAgICAgICAgICB9CiAgICAgICAgICBkZXByZWNhdGVkKGUyLCB0MikgewogICAgICAgICAgICBjb25zdCBuMiA9IFtdOwogICAgICAgICAgICBmb3IgKGNvbnN0IHIyIG9mIGUyKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0Mi5ub3JtYWxpemVEZXByZWNhdGVkUmVzdWx0KHRoaXMuX3ZhbHVlU2NoZW1hLmRlcHJlY2F0ZWQocjIsIHQyKSwgcjIpOwogICAgICAgICAgICAgIGUzICE9PSBmYWxzZSAmJiBuMi5wdXNoKC4uLmUzLm1hcCgoZTQpID0+IHsKICAgICAgICAgICAgICAgIGxldCB7IHZhbHVlOiB0MyB9ID0gZTQ7CiAgICAgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogW3QzXSB9OwogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgICB9CiAgICAgICAgICBmb3J3YXJkKGUyLCB0MikgewogICAgICAgICAgICBjb25zdCBuMiA9IFtdOwogICAgICAgICAgICBmb3IgKGNvbnN0IHIyIG9mIGUyKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0Mi5ub3JtYWxpemVGb3J3YXJkUmVzdWx0KHRoaXMuX3ZhbHVlU2NoZW1hLmZvcndhcmQocjIsIHQyKSwgcjIpOwogICAgICAgICAgICAgIG4yLnB1c2goLi4uZTMubWFwKHVkKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgICAgfQogICAgICAgICAgcmVkaXJlY3QoZTIsIHQyKSB7CiAgICAgICAgICAgIGNvbnN0IG4yID0gW10sIHIyID0gW107CiAgICAgICAgICAgIGZvciAoY29uc3QgbzIgb2YgZTIpIHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IHQyLm5vcm1hbGl6ZVJlZGlyZWN0UmVzdWx0KHRoaXMuX3ZhbHVlU2NoZW1hLnJlZGlyZWN0KG8yLCB0MiksIG8yKTsKICAgICAgICAgICAgICAicmVtYWluIiBpbiBlMyAmJiBuMi5wdXNoKGUzLnJlbWFpbiksIHIyLnB1c2goLi4uZTMucmVkaXJlY3QubWFwKHVkKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG4yLmxlbmd0aCA9PT0gMCA/IHsgcmVkaXJlY3Q6IHIyIH0gOiB7IHJlZGlyZWN0OiByMiwgcmVtYWluOiBuMiB9OwogICAgICAgICAgfQogICAgICAgICAgb3ZlcmxhcChlMiwgdDIpIHsKICAgICAgICAgICAgcmV0dXJuIGUyLmNvbmNhdCh0Mik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHVkKGUyKSB7CiAgICAgICAgICBsZXQgeyBmcm9tOiB0MiwgdG86IG4yIH0gPSBlMjsKICAgICAgICAgIHJldHVybiB7IGZyb206IFt0Ml0sIHRvOiBuMiB9OwogICAgICAgIH0KICAgICAgICBuZC5BcnJheVNjaGVtYSA9IGlkOwogICAgICAgIHZhciBzZCA9IHt9OwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZCwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgIGNvbnN0IGFkID0gR2Y7CiAgICAgICAgY2xhc3MgY2QgZXh0ZW5kcyBhZC5TY2hlbWEgewogICAgICAgICAgZXhwZWN0ZWQoKSB7CiAgICAgICAgICAgIHJldHVybiAidHJ1ZSBvciBmYWxzZSI7CiAgICAgICAgICB9CiAgICAgICAgICB2YWxpZGF0ZShlMikgewogICAgICAgICAgICByZXR1cm4gdHlwZW9mIGUyID09ICJib29sZWFuIjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc2QuQm9vbGVhblNjaGVtYSA9IGNkOwogICAgICAgIHZhciBsZCA9IHt9LCBwZCA9IHt9OwogICAgICAgIGZ1bmN0aW9uIGZkKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiBlMiA9PSAic3RyaW5nIiB8fCAia2V5IiBpbiBlMiA/IHsgZnJvbTogdDIsIHRvOiBlMiB9IDogImZyb20iIGluIGUyID8geyBmcm9tOiBlMi5mcm9tLCB0bzogZTIudG8gfSA6IHsgZnJvbTogdDIsIHRvOiBlMi50byB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBkZChlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBlMiA9PT0gdm9pZCAwID8gW10gOiBBcnJheS5pc0FycmF5KGUyKSA/IGUyLm1hcCgoZTMpID0+IGZkKGUzLCB0MikpIDogW2ZkKGUyLCB0MildOwogICAgICAgIH0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocGQsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KSwgcGQucmVjb3JkRnJvbUFycmF5ID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgZm9yIChjb25zdCByMiBvZiBlMikgewogICAgICAgICAgICBjb25zdCBlMyA9IHIyW3QyXTsKICAgICAgICAgICAgaWYgKG4yW2UzXSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkR1cGxpY2F0ZSAiLmNvbmNhdCh0MiwgIiAiKS5jb25jYXQoSlNPTi5zdHJpbmdpZnkoZTMpKSk7CiAgICAgICAgICAgIG4yW2UzXSA9IHIyOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgIH0sIHBkLm1hcEZyb21BcnJheSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwogICAgICAgICAgZm9yIChjb25zdCByMiBvZiBlMikgewogICAgICAgICAgICBjb25zdCBlMyA9IHIyW3QyXTsKICAgICAgICAgICAgaWYgKG4yLmhhcyhlMykpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJEdXBsaWNhdGUgIi5jb25jYXQodDIsICIgIikuY29uY2F0KEpTT04uc3RyaW5naWZ5KGUzKSkpOwogICAgICAgICAgICBuMi5zZXQoZTMsIHIyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICB9LCBwZC5jcmVhdGVBdXRvQ2hlY2tsaXN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBjb25zdCBlMiA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgcmV0dXJuICh0MikgPT4gewogICAgICAgICAgICBjb25zdCBuMiA9IEpTT04uc3RyaW5naWZ5KHQyKTsKICAgICAgICAgICAgcmV0dXJuICEhZTJbbjJdIHx8IChlMltuMl0gPSB0cnVlLCBmYWxzZSk7CiAgICAgICAgICB9OwogICAgICAgIH0sIHBkLnBhcnRpdGlvbiA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSBbXSwgcjIgPSBbXTsKICAgICAgICAgIGZvciAoY29uc3QgbzIgb2YgZTIpCiAgICAgICAgICAgIHQyKG8yKSA/IG4yLnB1c2gobzIpIDogcjIucHVzaChvMik7CiAgICAgICAgICByZXR1cm4gW24yLCByMl07CiAgICAgICAgfSwgcGQuaXNJbnQgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyID09PSBNYXRoLmZsb29yKGUyKTsKICAgICAgICB9LCBwZC5jb21wYXJlUHJpbWl0aXZlID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBpZiAoZTIgPT09IHQyKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIGNvbnN0IG4yID0gdHlwZW9mIGUyLCByMiA9IHR5cGVvZiB0MiwgbzIgPSBbInVuZGVmaW5lZCIsICJvYmplY3QiLCAiYm9vbGVhbiIsICJudW1iZXIiLCAic3RyaW5nIl07CiAgICAgICAgICByZXR1cm4gbjIgIT09IHIyID8gbzIuaW5kZXhPZihuMikgLSBvMi5pbmRleE9mKHIyKSA6IG4yICE9PSAic3RyaW5nIiA/IE51bWJlcihlMikgLSBOdW1iZXIodDIpIDogZTIubG9jYWxlQ29tcGFyZSh0Mik7CiAgICAgICAgfSwgcGQubm9ybWFsaXplRGVmYXVsdFJlc3VsdCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgPT09IHZvaWQgMCA/IHt9IDogZTI7CiAgICAgICAgfSwgcGQubm9ybWFsaXplVmFsaWRhdGVSZXN1bHQgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBlMiA9PT0gdHJ1ZSB8fCAoZTIgPT09IGZhbHNlID8geyB2YWx1ZTogdDIgfSA6IGUyKTsKICAgICAgICB9LCBwZC5ub3JtYWxpemVEZXByZWNhdGVkUmVzdWx0ID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBsZXQgbjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCAmJiBhcmd1bWVudHNbMl07CiAgICAgICAgICByZXR1cm4gZTIgIT09IGZhbHNlICYmIChlMiA9PT0gdHJ1ZSA/ICEhbjIgfHwgW3sgdmFsdWU6IHQyIH1dIDogInZhbHVlIiBpbiBlMiA/IFtlMl0gOiBlMi5sZW5ndGggIT09IDAgJiYgZTIpOwogICAgICAgIH0sIHBkLm5vcm1hbGl6ZVRyYW5zZmVyUmVzdWx0ID0gZmQsIHBkLm5vcm1hbGl6ZUZvcndhcmRSZXN1bHQgPSBkZCwgcGQubm9ybWFsaXplUmVkaXJlY3RSZXN1bHQgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gZGQodHlwZW9mIGUyID09ICJvYmplY3QiICYmICJyZWRpcmVjdCIgaW4gZTIgPyBlMi5yZWRpcmVjdCA6IGUyLCB0Mik7CiAgICAgICAgICByZXR1cm4gbjIubGVuZ3RoID09PSAwID8geyByZW1haW46IHQyLCByZWRpcmVjdDogbjIgfSA6IHR5cGVvZiBlMiA9PSAib2JqZWN0IiAmJiAicmVtYWluIiBpbiBlMiA/IHsgcmVtYWluOiBlMi5yZW1haW4sIHJlZGlyZWN0OiBuMiB9IDogeyByZWRpcmVjdDogbjIgfTsKICAgICAgICB9LCBPYmplY3QuZGVmaW5lUHJvcGVydHkobGQsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgICBjb25zdCBoZCA9IEdmLCBnZCA9IHBkOwogICAgICAgIGNsYXNzIG1kIGV4dGVuZHMgaGQuU2NoZW1hIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKGUyKSB7CiAgICAgICAgICAgIHN1cGVyKGUyKSwgdGhpcy5fY2hvaWNlcyA9IGdkLm1hcEZyb21BcnJheShlMi5jaG9pY2VzLm1hcCgoZTMpID0+IGUzICYmIHR5cGVvZiBlMyA9PSAib2JqZWN0IiA/IGUzIDogeyB2YWx1ZTogZTMgfSksICJ2YWx1ZSIpOwogICAgICAgICAgfQogICAgICAgICAgZXhwZWN0ZWQoZTIpIHsKICAgICAgICAgICAgbGV0IHsgZGVzY3JpcHRvcjogdDIgfSA9IGUyOwogICAgICAgICAgICBjb25zdCBuMiA9IEFycmF5LmZyb20odGhpcy5fY2hvaWNlcy5rZXlzKCkpLm1hcCgoZTMpID0+IHRoaXMuX2Nob2ljZXMuZ2V0KGUzKSkuZmlsdGVyKChlMykgPT4gIWUzLmRlcHJlY2F0ZWQpLm1hcCgoZTMpID0+IGUzLnZhbHVlKS5zb3J0KGdkLmNvbXBhcmVQcmltaXRpdmUpLm1hcCh0Mi52YWx1ZSksIHIyID0gbjIuc2xpY2UoMCwgLTIpLCBvMiA9IG4yLnNsaWNlKC0yKTsKICAgICAgICAgICAgcmV0dXJuIHIyLmNvbmNhdChvMi5qb2luKCIgb3IgIikpLmpvaW4oIiwgIik7CiAgICAgICAgICB9CiAgICAgICAgICB2YWxpZGF0ZShlMikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hvaWNlcy5oYXMoZTIpOwogICAgICAgICAgfQogICAgICAgICAgZGVwcmVjYXRlZChlMikgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuX2Nob2ljZXMuZ2V0KGUyKTsKICAgICAgICAgICAgcmV0dXJuICEoIXQyIHx8ICF0Mi5kZXByZWNhdGVkKSAmJiB7IHZhbHVlOiBlMiB9OwogICAgICAgICAgfQogICAgICAgICAgZm9yd2FyZChlMikgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuX2Nob2ljZXMuZ2V0KGUyKTsKICAgICAgICAgICAgcmV0dXJuIHQyID8gdDIuZm9yd2FyZCA6IHZvaWQgMDsKICAgICAgICAgIH0KICAgICAgICAgIHJlZGlyZWN0KGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5fY2hvaWNlcy5nZXQoZTIpOwogICAgICAgICAgICByZXR1cm4gdDIgPyB0Mi5yZWRpcmVjdCA6IHZvaWQgMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGQuQ2hvaWNlU2NoZW1hID0gbWQ7CiAgICAgICAgdmFyIHlkID0ge30sIERkID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KERkLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgY29uc3QgRWQgPSBHZjsKICAgICAgICBjbGFzcyBDZCBleHRlbmRzIEVkLlNjaGVtYSB7CiAgICAgICAgICBleHBlY3RlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICJhIG51bWJlciI7CiAgICAgICAgICB9CiAgICAgICAgICB2YWxpZGF0ZShlMiwgdDIpIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBlMiA9PSAibnVtYmVyIjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgRGQuTnVtYmVyU2NoZW1hID0gQ2QsIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh5ZCwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgIGNvbnN0IGJkID0gcGQsIHZkID0gRGQ7CiAgICAgICAgY2xhc3MgQWQgZXh0ZW5kcyB2ZC5OdW1iZXJTY2hlbWEgewogICAgICAgICAgZXhwZWN0ZWQoKSB7CiAgICAgICAgICAgIHJldHVybiAiYW4gaW50ZWdlciI7CiAgICAgICAgICB9CiAgICAgICAgICB2YWxpZGF0ZShlMiwgdDIpIHsKICAgICAgICAgICAgcmV0dXJuIHQyLm5vcm1hbGl6ZVZhbGlkYXRlUmVzdWx0KHN1cGVyLnZhbGlkYXRlKGUyLCB0MiksIGUyKSA9PT0gdHJ1ZSAmJiBiZC5pc0ludChlMik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHlkLkludGVnZXJTY2hlbWEgPSBBZDsKICAgICAgICB2YXIgRmQgPSB7fTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoRmQsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgICBjb25zdCB4ZCA9IEdmOwogICAgICAgIGNsYXNzIFNkIGV4dGVuZHMgeGQuU2NoZW1hIHsKICAgICAgICAgIGV4cGVjdGVkKCkgewogICAgICAgICAgICByZXR1cm4gImEgc3RyaW5nIjsKICAgICAgICAgIH0KICAgICAgICAgIHZhbGlkYXRlKGUyKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgZTIgPT0gInN0cmluZyI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEZkLlN0cmluZ1NjaGVtYSA9IFNkLCBmdW5jdGlvbihlMikgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgICBjb25zdCB0MiA9IHdwOwogICAgICAgICAgdDIuX19leHBvcnRTdGFyKHpmLCBlMiksIHQyLl9fZXhwb3J0U3RhcihaZiwgZTIpLCB0Mi5fX2V4cG9ydFN0YXIobmQsIGUyKSwgdDIuX19leHBvcnRTdGFyKHNkLCBlMiksIHQyLl9fZXhwb3J0U3RhcihsZCwgZTIpLCB0Mi5fX2V4cG9ydFN0YXIoeWQsIGUyKSwgdDIuX19leHBvcnRTdGFyKERkLCBlMiksIHQyLl9fZXhwb3J0U3RhcihGZCwgZTIpOwogICAgICAgIH0oVWYpOwogICAgICAgIHZhciB3ZCA9IHt9LCBUZCA9IHt9OwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZCwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgIGNvbnN0IEJkID0gQnAsIE5kID0gUHAsIGtkID0gTGYsIFBkID0gUmY7CiAgICAgICAgVGQuZGVmYXVsdERlc2NyaXB0b3IgPSBCZC5hcGlEZXNjcmlwdG9yLCBUZC5kZWZhdWx0VW5rbm93bkhhbmRsZXIgPSBQZC5sZXZlblVua25vd25IYW5kbGVyLCBUZC5kZWZhdWx0SW52YWxpZEhhbmRsZXIgPSBrZC5jb21tb25JbnZhbGlkSGFuZGxlciwgVGQuZGVmYXVsdERlcHJlY2F0ZWRIYW5kbGVyID0gTmQuY29tbW9uRGVwcmVjYXRlZEhhbmRsZXIsIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3ZCwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgIGNvbnN0IE9kID0gVGQsIElkID0gcGQ7CiAgICAgICAgd2Qubm9ybWFsaXplID0gKGUyLCB0MiwgbjIpID0+IG5ldyBMZCh0MiwgbjIpLm5vcm1hbGl6ZShlMik7CiAgICAgICAgY2xhc3MgTGQgewogICAgICAgICAgY29uc3RydWN0b3IoZTIsIHQyKSB7CiAgICAgICAgICAgIGNvbnN0IHsgbG9nZ2VyOiBuMiA9IGNvbnNvbGUsIGRlc2NyaXB0b3I6IHIyID0gT2QuZGVmYXVsdERlc2NyaXB0b3IsIHVua25vd246IG8yID0gT2QuZGVmYXVsdFVua25vd25IYW5kbGVyLCBpbnZhbGlkOiBpMiA9IE9kLmRlZmF1bHRJbnZhbGlkSGFuZGxlciwgZGVwcmVjYXRlZDogdTIgPSBPZC5kZWZhdWx0RGVwcmVjYXRlZEhhbmRsZXIgfSA9IHQyIHx8IHt9OwogICAgICAgICAgICB0aGlzLl91dGlscyA9IHsgZGVzY3JpcHRvcjogcjIsIGxvZ2dlcjogbjIgfHwgeyB3YXJuOiAoKSA9PiB7CiAgICAgICAgICAgIH0gfSwgc2NoZW1hczogSWQucmVjb3JkRnJvbUFycmF5KGUyLCAibmFtZSIpLCBub3JtYWxpemVEZWZhdWx0UmVzdWx0OiBJZC5ub3JtYWxpemVEZWZhdWx0UmVzdWx0LCBub3JtYWxpemVEZXByZWNhdGVkUmVzdWx0OiBJZC5ub3JtYWxpemVEZXByZWNhdGVkUmVzdWx0LCBub3JtYWxpemVGb3J3YXJkUmVzdWx0OiBJZC5ub3JtYWxpemVGb3J3YXJkUmVzdWx0LCBub3JtYWxpemVSZWRpcmVjdFJlc3VsdDogSWQubm9ybWFsaXplUmVkaXJlY3RSZXN1bHQsIG5vcm1hbGl6ZVZhbGlkYXRlUmVzdWx0OiBJZC5ub3JtYWxpemVWYWxpZGF0ZVJlc3VsdCB9LCB0aGlzLl91bmtub3duSGFuZGxlciA9IG8yLCB0aGlzLl9pbnZhbGlkSGFuZGxlciA9IGkyLCB0aGlzLl9kZXByZWNhdGVkSGFuZGxlciA9IHUyLCB0aGlzLmNsZWFuSGlzdG9yeSgpOwogICAgICAgICAgfQogICAgICAgICAgY2xlYW5IaXN0b3J5KCkgewogICAgICAgICAgICB0aGlzLl9oYXNEZXByZWNhdGlvbldhcm5lZCA9IElkLmNyZWF0ZUF1dG9DaGVja2xpc3QoKTsKICAgICAgICAgIH0KICAgICAgICAgIG5vcm1hbGl6ZShlMikgewogICAgICAgICAgICBjb25zdCB0MiA9IHt9LCBuMiA9IFtlMl0sIHIyID0gKCkgPT4gewogICAgICAgICAgICAgIGZvciAoOyBuMi5sZW5ndGggIT09IDA7ICkgewogICAgICAgICAgICAgICAgY29uc3QgZTMgPSBuMi5zaGlmdCgpLCByMyA9IHRoaXMuX2FwcGx5Tm9ybWFsaXphdGlvbihlMywgdDIpOwogICAgICAgICAgICAgICAgbjIucHVzaCguLi5yMyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICByMigpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIE9iamVjdC5rZXlzKHRoaXMuX3V0aWxzLnNjaGVtYXMpKSB7CiAgICAgICAgICAgICAgY29uc3QgcjMgPSB0aGlzLl91dGlscy5zY2hlbWFzW2UzXTsKICAgICAgICAgICAgICBpZiAoIShlMyBpbiB0MikpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gSWQubm9ybWFsaXplRGVmYXVsdFJlc3VsdChyMy5kZWZhdWx0KHRoaXMuX3V0aWxzKSk7CiAgICAgICAgICAgICAgICAidmFsdWUiIGluIHQzICYmIG4yLnB1c2goeyBbZTNdOiB0My52YWx1ZSB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcjIoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBlMyBvZiBPYmplY3Qua2V5cyh0aGlzLl91dGlscy5zY2hlbWFzKSkgewogICAgICAgICAgICAgIGNvbnN0IG4zID0gdGhpcy5fdXRpbHMuc2NoZW1hc1tlM107CiAgICAgICAgICAgICAgZTMgaW4gdDIgJiYgKHQyW2UzXSA9IG4zLnBvc3Rwcm9jZXNzKHQyW2UzXSwgdGhpcy5fdXRpbHMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgICB9CiAgICAgICAgICBfYXBwbHlOb3JtYWxpemF0aW9uKGUyLCB0MikgewogICAgICAgICAgICBjb25zdCBuMiA9IFtdLCBbcjIsIG8yXSA9IElkLnBhcnRpdGlvbihPYmplY3Qua2V5cyhlMiksIChlMykgPT4gZTMgaW4gdGhpcy5fdXRpbHMuc2NoZW1hcyk7CiAgICAgICAgICAgIGZvciAoY29uc3QgbzMgb2YgcjIpIHsKICAgICAgICAgICAgICBjb25zdCByMyA9IHRoaXMuX3V0aWxzLnNjaGVtYXNbbzNdLCBpMiA9IHIzLnByZXByb2Nlc3MoZTJbbzNdLCB0aGlzLl91dGlscyksIHUyID0gSWQubm9ybWFsaXplVmFsaWRhdGVSZXN1bHQocjMudmFsaWRhdGUoaTIsIHRoaXMuX3V0aWxzKSwgaTIpOwogICAgICAgICAgICAgIGlmICh1MiAhPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgY29uc3QgeyB2YWx1ZTogZTMgfSA9IHUyLCB0MyA9IHRoaXMuX2ludmFsaWRIYW5kbGVyKG8zLCBlMywgdGhpcy5fdXRpbHMpOwogICAgICAgICAgICAgICAgdGhyb3cgdHlwZW9mIHQzID09ICJzdHJpbmciID8gbmV3IEVycm9yKHQzKSA6IHQzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBzMiA9IChlMykgPT4gewogICAgICAgICAgICAgICAgbGV0IHsgZnJvbTogdDMsIHRvOiByNCB9ID0gZTM7CiAgICAgICAgICAgICAgICBuMi5wdXNoKHR5cGVvZiByNCA9PSAic3RyaW5nIiA/IHsgW3I0XTogdDMgfSA6IHsgW3I0LmtleV06IHI0LnZhbHVlIH0pOwogICAgICAgICAgICAgIH0sIGEyID0gKGUzKSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgeyB2YWx1ZTogdDMsIHJlZGlyZWN0VG86IG4zIH0gPSBlMzsKICAgICAgICAgICAgICAgIGNvbnN0IHUzID0gSWQubm9ybWFsaXplRGVwcmVjYXRlZFJlc3VsdChyMy5kZXByZWNhdGVkKHQzLCB0aGlzLl91dGlscyksIGkyLCB0cnVlKTsKICAgICAgICAgICAgICAgIGlmICh1MyAhPT0gZmFsc2UpCiAgICAgICAgICAgICAgICAgIGlmICh1MyA9PT0gdHJ1ZSkKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYXNEZXByZWNhdGlvbldhcm5lZChvMykgfHwgdGhpcy5fdXRpbHMubG9nZ2VyLndhcm4odGhpcy5fZGVwcmVjYXRlZEhhbmRsZXIobzMsIG4zLCB0aGlzLl91dGlscykpOwogICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCB7IHZhbHVlOiBlNCB9IG9mIHUzKSB7CiAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0NCA9IHsga2V5OiBvMywgdmFsdWU6IGU0IH07CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2hhc0RlcHJlY2F0aW9uV2FybmVkKHQ0KSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByNCA9IHR5cGVvZiBuMyA9PSAic3RyaW5nIiA/IHsga2V5OiBuMywgdmFsdWU6IGU0IH0gOiBuMzsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXRpbHMubG9nZ2VyLndhcm4odGhpcy5fZGVwcmVjYXRlZEhhbmRsZXIodDQsIHI0LCB0aGlzLl91dGlscykpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIElkLm5vcm1hbGl6ZUZvcndhcmRSZXN1bHQocjMuZm9yd2FyZChpMiwgdGhpcy5fdXRpbHMpLCBpMikuZm9yRWFjaChzMik7CiAgICAgICAgICAgICAgY29uc3QgYzIgPSBJZC5ub3JtYWxpemVSZWRpcmVjdFJlc3VsdChyMy5yZWRpcmVjdChpMiwgdGhpcy5fdXRpbHMpLCBpMik7CiAgICAgICAgICAgICAgaWYgKGMyLnJlZGlyZWN0LmZvckVhY2goczIpLCAicmVtYWluIiBpbiBjMikgewogICAgICAgICAgICAgICAgY29uc3QgZTMgPSBjMi5yZW1haW47CiAgICAgICAgICAgICAgICB0MltvM10gPSBvMyBpbiB0MiA/IHIzLm92ZXJsYXAodDJbbzNdLCBlMywgdGhpcy5fdXRpbHMpIDogZTMsIGEyKHsgdmFsdWU6IGUzIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmb3IgKGNvbnN0IHsgZnJvbTogZTMsIHRvOiB0MyB9IG9mIGMyLnJlZGlyZWN0KQogICAgICAgICAgICAgICAgYTIoeyB2YWx1ZTogZTMsIHJlZGlyZWN0VG86IHQzIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoY29uc3QgcjMgb2YgbzIpIHsKICAgICAgICAgICAgICBjb25zdCBvMyA9IGUyW3IzXSwgaTIgPSB0aGlzLl91bmtub3duSGFuZGxlcihyMywgbzMsIHRoaXMuX3V0aWxzKTsKICAgICAgICAgICAgICBpZiAoaTIpCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIE9iamVjdC5rZXlzKGkyKSkgewogICAgICAgICAgICAgICAgICBjb25zdCByNCA9IHsgW2UzXTogaTJbZTNdIH07CiAgICAgICAgICAgICAgICAgIGUzIGluIHRoaXMuX3V0aWxzLnNjaGVtYXMgPyBuMi5wdXNoKHI0KSA6IE9iamVjdC5hc3NpZ24odDIsIHI0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHdkLk5vcm1hbGl6ZXIgPSBMZCwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgICAgY29uc3QgdDIgPSB3cDsKICAgICAgICAgIHQyLl9fZXhwb3J0U3RhcihUcCwgZTIpLCB0Mi5fX2V4cG9ydFN0YXIoTnAsIGUyKSwgdDIuX19leHBvcnRTdGFyKFVmLCBlMiksIHQyLl9fZXhwb3J0U3Rhcih3ZCwgZTIpLCB0Mi5fX2V4cG9ydFN0YXIoR2YsIGUyKTsKICAgICAgICB9KGJwKTsKICAgICAgICB2YXIgamQgPSB7IGV4cG9ydHM6IHt9IH07CiAgICAgICAgY29uc3QgX2QgPSBbXSwgTWQgPSBbXSwgUmQgPSAoZTIsIHQyKSA9PiB7CiAgICAgICAgICBpZiAoZTIgPT09IHQyKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIGNvbnN0IG4yID0gZTI7CiAgICAgICAgICBlMi5sZW5ndGggPiB0Mi5sZW5ndGggJiYgKGUyID0gdDIsIHQyID0gbjIpOwogICAgICAgICAgbGV0IHIyID0gZTIubGVuZ3RoLCBvMiA9IHQyLmxlbmd0aDsKICAgICAgICAgIGZvciAoOyByMiA+IDAgJiYgZTIuY2hhckNvZGVBdCh+LXIyKSA9PT0gdDIuY2hhckNvZGVBdCh+LW8yKTsgKQogICAgICAgICAgICByMi0tLCBvMi0tOwogICAgICAgICAgbGV0IGkyLCB1MiwgczIsIGEyLCBjMiA9IDA7CiAgICAgICAgICBmb3IgKDsgYzIgPCByMiAmJiBlMi5jaGFyQ29kZUF0KGMyKSA9PT0gdDIuY2hhckNvZGVBdChjMik7ICkKICAgICAgICAgICAgYzIrKzsKICAgICAgICAgIGlmIChyMiAtPSBjMiwgbzIgLT0gYzIsIHIyID09PSAwKQogICAgICAgICAgICByZXR1cm4gbzI7CiAgICAgICAgICBsZXQgbDIgPSAwLCBwMiA9IDA7CiAgICAgICAgICBmb3IgKDsgbDIgPCByMjsgKQogICAgICAgICAgICBNZFtsMl0gPSBlMi5jaGFyQ29kZUF0KGMyICsgbDIpLCBfZFtsMl0gPSArK2wyOwogICAgICAgICAgZm9yICg7IHAyIDwgbzI7ICkKICAgICAgICAgICAgZm9yIChpMiA9IHQyLmNoYXJDb2RlQXQoYzIgKyBwMiksIHMyID0gcDIrKywgdTIgPSBwMiwgbDIgPSAwOyBsMiA8IHIyOyBsMisrKQogICAgICAgICAgICAgIGEyID0gaTIgPT09IE1kW2wyXSA/IHMyIDogczIgKyAxLCBzMiA9IF9kW2wyXSwgdTIgPSBfZFtsMl0gPSBzMiA+IHUyID8gYTIgPiB1MiA/IHUyICsgMSA6IGEyIDogYTIgPiBzMiA/IHMyICsgMSA6IGEyOwogICAgICAgICAgcmV0dXJuIHUyOwogICAgICAgIH07CiAgICAgICAgamQuZXhwb3J0cyA9IFJkLCBqZC5leHBvcnRzLmRlZmF1bHQgPSBSZDsKICAgICAgICB2YXIgVmQgPSB7IGV4cG9ydHM6IHt9IH07CiAgICAgICAgY29uc3QgJGQgPSB7IGFsaWNlYmx1ZTogWzI0MCwgMjQ4LCAyNTVdLCBhbnRpcXVld2hpdGU6IFsyNTAsIDIzNSwgMjE1XSwgYXF1YTogWzAsIDI1NSwgMjU1XSwgYXF1YW1hcmluZTogWzEyNywgMjU1LCAyMTJdLCBhenVyZTogWzI0MCwgMjU1LCAyNTVdLCBiZWlnZTogWzI0NSwgMjQ1LCAyMjBdLCBiaXNxdWU6IFsyNTUsIDIyOCwgMTk2XSwgYmxhY2s6IFswLCAwLCAwXSwgYmxhbmNoZWRhbG1vbmQ6IFsyNTUsIDIzNSwgMjA1XSwgYmx1ZTogWzAsIDAsIDI1NV0sIGJsdWV2aW9sZXQ6IFsxMzgsIDQzLCAyMjZdLCBicm93bjogWzE2NSwgNDIsIDQyXSwgYnVybHl3b29kOiBbMjIyLCAxODQsIDEzNV0sIGNhZGV0Ymx1ZTogWzk1LCAxNTgsIDE2MF0sIGNoYXJ0cmV1c2U6IFsxMjcsIDI1NSwgMF0sIGNob2NvbGF0ZTogWzIxMCwgMTA1LCAzMF0sIGNvcmFsOiBbMjU1LCAxMjcsIDgwXSwgY29ybmZsb3dlcmJsdWU6IFsxMDAsIDE0OSwgMjM3XSwgY29ybnNpbGs6IFsyNTUsIDI0OCwgMjIwXSwgY3JpbXNvbjogWzIyMCwgMjAsIDYwXSwgY3lhbjogWzAsIDI1NSwgMjU1XSwgZGFya2JsdWU6IFswLCAwLCAxMzldLCBkYXJrY3lhbjogWzAsIDEzOSwgMTM5XSwgZGFya2dvbGRlbnJvZDogWzE4NCwgMTM0LCAxMV0sIGRhcmtncmF5OiBbMTY5LCAxNjksIDE2OV0sIGRhcmtncmVlbjogWzAsIDEwMCwgMF0sIGRhcmtncmV5OiBbMTY5LCAxNjksIDE2OV0sIGRhcmtraGFraTogWzE4OSwgMTgzLCAxMDddLCBkYXJrbWFnZW50YTogWzEzOSwgMCwgMTM5XSwgZGFya29saXZlZ3JlZW46IFs4NSwgMTA3LCA0N10sIGRhcmtvcmFuZ2U6IFsyNTUsIDE0MCwgMF0sIGRhcmtvcmNoaWQ6IFsxNTMsIDUwLCAyMDRdLCBkYXJrcmVkOiBbMTM5LCAwLCAwXSwgZGFya3NhbG1vbjogWzIzMywgMTUwLCAxMjJdLCBkYXJrc2VhZ3JlZW46IFsxNDMsIDE4OCwgMTQzXSwgZGFya3NsYXRlYmx1ZTogWzcyLCA2MSwgMTM5XSwgZGFya3NsYXRlZ3JheTogWzQ3LCA3OSwgNzldLCBkYXJrc2xhdGVncmV5OiBbNDcsIDc5LCA3OV0sIGRhcmt0dXJxdW9pc2U6IFswLCAyMDYsIDIwOV0sIGRhcmt2aW9sZXQ6IFsxNDgsIDAsIDIxMV0sIGRlZXBwaW5rOiBbMjU1LCAyMCwgMTQ3XSwgZGVlcHNreWJsdWU6IFswLCAxOTEsIDI1NV0sIGRpbWdyYXk6IFsxMDUsIDEwNSwgMTA1XSwgZGltZ3JleTogWzEwNSwgMTA1LCAxMDVdLCBkb2RnZXJibHVlOiBbMzAsIDE0NCwgMjU1XSwgZmlyZWJyaWNrOiBbMTc4LCAzNCwgMzRdLCBmbG9yYWx3aGl0ZTogWzI1NSwgMjUwLCAyNDBdLCBmb3Jlc3RncmVlbjogWzM0LCAxMzksIDM0XSwgZnVjaHNpYTogWzI1NSwgMCwgMjU1XSwgZ2FpbnNib3JvOiBbMjIwLCAyMjAsIDIyMF0sIGdob3N0d2hpdGU6IFsyNDgsIDI0OCwgMjU1XSwgZ29sZDogWzI1NSwgMjE1LCAwXSwgZ29sZGVucm9kOiBbMjE4LCAxNjUsIDMyXSwgZ3JheTogWzEyOCwgMTI4LCAxMjhdLCBncmVlbjogWzAsIDEyOCwgMF0sIGdyZWVueWVsbG93OiBbMTczLCAyNTUsIDQ3XSwgZ3JleTogWzEyOCwgMTI4LCAxMjhdLCBob25leWRldzogWzI0MCwgMjU1LCAyNDBdLCBob3RwaW5rOiBbMjU1LCAxMDUsIDE4MF0sIGluZGlhbnJlZDogWzIwNSwgOTIsIDkyXSwgaW5kaWdvOiBbNzUsIDAsIDEzMF0sIGl2b3J5OiBbMjU1LCAyNTUsIDI0MF0sIGtoYWtpOiBbMjQwLCAyMzAsIDE0MF0sIGxhdmVuZGVyOiBbMjMwLCAyMzAsIDI1MF0sIGxhdmVuZGVyYmx1c2g6IFsyNTUsIDI0MCwgMjQ1XSwgbGF3bmdyZWVuOiBbMTI0LCAyNTIsIDBdLCBsZW1vbmNoaWZmb246IFsyNTUsIDI1MCwgMjA1XSwgbGlnaHRibHVlOiBbMTczLCAyMTYsIDIzMF0sIGxpZ2h0Y29yYWw6IFsyNDAsIDEyOCwgMTI4XSwgbGlnaHRjeWFuOiBbMjI0LCAyNTUsIDI1NV0sIGxpZ2h0Z29sZGVucm9keWVsbG93OiBbMjUwLCAyNTAsIDIxMF0sIGxpZ2h0Z3JheTogWzIxMSwgMjExLCAyMTFdLCBsaWdodGdyZWVuOiBbMTQ0LCAyMzgsIDE0NF0sIGxpZ2h0Z3JleTogWzIxMSwgMjExLCAyMTFdLCBsaWdodHBpbms6IFsyNTUsIDE4MiwgMTkzXSwgbGlnaHRzYWxtb246IFsyNTUsIDE2MCwgMTIyXSwgbGlnaHRzZWFncmVlbjogWzMyLCAxNzgsIDE3MF0sIGxpZ2h0c2t5Ymx1ZTogWzEzNSwgMjA2LCAyNTBdLCBsaWdodHNsYXRlZ3JheTogWzExOSwgMTM2LCAxNTNdLCBsaWdodHNsYXRlZ3JleTogWzExOSwgMTM2LCAxNTNdLCBsaWdodHN0ZWVsYmx1ZTogWzE3NiwgMTk2LCAyMjJdLCBsaWdodHllbGxvdzogWzI1NSwgMjU1LCAyMjRdLCBsaW1lOiBbMCwgMjU1LCAwXSwgbGltZWdyZWVuOiBbNTAsIDIwNSwgNTBdLCBsaW5lbjogWzI1MCwgMjQwLCAyMzBdLCBtYWdlbnRhOiBbMjU1LCAwLCAyNTVdLCBtYXJvb246IFsxMjgsIDAsIDBdLCBtZWRpdW1hcXVhbWFyaW5lOiBbMTAyLCAyMDUsIDE3MF0sIG1lZGl1bWJsdWU6IFswLCAwLCAyMDVdLCBtZWRpdW1vcmNoaWQ6IFsxODYsIDg1LCAyMTFdLCBtZWRpdW1wdXJwbGU6IFsxNDcsIDExMiwgMjE5XSwgbWVkaXVtc2VhZ3JlZW46IFs2MCwgMTc5LCAxMTNdLCBtZWRpdW1zbGF0ZWJsdWU6IFsxMjMsIDEwNCwgMjM4XSwgbWVkaXVtc3ByaW5nZ3JlZW46IFswLCAyNTAsIDE1NF0sIG1lZGl1bXR1cnF1b2lzZTogWzcyLCAyMDksIDIwNF0sIG1lZGl1bXZpb2xldHJlZDogWzE5OSwgMjEsIDEzM10sIG1pZG5pZ2h0Ymx1ZTogWzI1LCAyNSwgMTEyXSwgbWludGNyZWFtOiBbMjQ1LCAyNTUsIDI1MF0sIG1pc3R5cm9zZTogWzI1NSwgMjI4LCAyMjVdLCBtb2NjYXNpbjogWzI1NSwgMjI4LCAxODFdLCBuYXZham93aGl0ZTogWzI1NSwgMjIyLCAxNzNdLCBuYXZ5OiBbMCwgMCwgMTI4XSwgb2xkbGFjZTogWzI1MywgMjQ1LCAyMzBdLCBvbGl2ZTogWzEyOCwgMTI4LCAwXSwgb2xpdmVkcmFiOiBbMTA3LCAxNDIsIDM1XSwgb3JhbmdlOiBbMjU1LCAxNjUsIDBdLCBvcmFuZ2VyZWQ6IFsyNTUsIDY5LCAwXSwgb3JjaGlkOiBbMjE4LCAxMTIsIDIxNF0sIHBhbGVnb2xkZW5yb2Q6IFsyMzgsIDIzMiwgMTcwXSwgcGFsZWdyZWVuOiBbMTUyLCAyNTEsIDE1Ml0sIHBhbGV0dXJxdW9pc2U6IFsxNzUsIDIzOCwgMjM4XSwgcGFsZXZpb2xldHJlZDogWzIxOSwgMTEyLCAxNDddLCBwYXBheWF3aGlwOiBbMjU1LCAyMzksIDIxM10sIHBlYWNocHVmZjogWzI1NSwgMjE4LCAxODVdLCBwZXJ1OiBbMjA1LCAxMzMsIDYzXSwgcGluazogWzI1NSwgMTkyLCAyMDNdLCBwbHVtOiBbMjIxLCAxNjAsIDIyMV0sIHBvd2RlcmJsdWU6IFsxNzYsIDIyNCwgMjMwXSwgcHVycGxlOiBbMTI4LCAwLCAxMjhdLCByZWJlY2NhcHVycGxlOiBbMTAyLCA1MSwgMTUzXSwgcmVkOiBbMjU1LCAwLCAwXSwgcm9zeWJyb3duOiBbMTg4LCAxNDMsIDE0M10sIHJveWFsYmx1ZTogWzY1LCAxMDUsIDIyNV0sIHNhZGRsZWJyb3duOiBbMTM5LCA2OSwgMTldLCBzYWxtb246IFsyNTAsIDEyOCwgMTE0XSwgc2FuZHlicm93bjogWzI0NCwgMTY0LCA5Nl0sIHNlYWdyZWVuOiBbNDYsIDEzOSwgODddLCBzZWFzaGVsbDogWzI1NSwgMjQ1LCAyMzhdLCBzaWVubmE6IFsxNjAsIDgyLCA0NV0sIHNpbHZlcjogWzE5MiwgMTkyLCAxOTJdLCBza3libHVlOiBbMTM1LCAyMDYsIDIzNV0sIHNsYXRlYmx1ZTogWzEwNiwgOTAsIDIwNV0sIHNsYXRlZ3JheTogWzExMiwgMTI4LCAxNDRdLCBzbGF0ZWdyZXk6IFsxMTIsIDEyOCwgMTQ0XSwgc25vdzogWzI1NSwgMjUwLCAyNTBdLCBzcHJpbmdncmVlbjogWzAsIDI1NSwgMTI3XSwgc3RlZWxibHVlOiBbNzAsIDEzMCwgMTgwXSwgdGFuOiBbMjEwLCAxODAsIDE0MF0sIHRlYWw6IFswLCAxMjgsIDEyOF0sIHRoaXN0bGU6IFsyMTYsIDE5MSwgMjE2XSwgdG9tYXRvOiBbMjU1LCA5OSwgNzFdLCB0dXJxdW9pc2U6IFs2NCwgMjI0LCAyMDhdLCB2aW9sZXQ6IFsyMzgsIDEzMCwgMjM4XSwgd2hlYXQ6IFsyNDUsIDIyMiwgMTc5XSwgd2hpdGU6IFsyNTUsIDI1NSwgMjU1XSwgd2hpdGVzbW9rZTogWzI0NSwgMjQ1LCAyNDVdLCB5ZWxsb3c6IFsyNTUsIDI1NSwgMF0sIHllbGxvd2dyZWVuOiBbMTU0LCAyMDUsIDUwXSB9LCBXZCA9IHt9OwogICAgICAgIGZvciAoY29uc3QgZTIgb2YgT2JqZWN0LmtleXMoJGQpKQogICAgICAgICAgV2RbJGRbZTJdXSA9IGUyOwogICAgICAgIGNvbnN0IHFkID0geyByZ2I6IHsgY2hhbm5lbHM6IDMsIGxhYmVsczogInJnYiIgfSwgaHNsOiB7IGNoYW5uZWxzOiAzLCBsYWJlbHM6ICJoc2wiIH0sIGhzdjogeyBjaGFubmVsczogMywgbGFiZWxzOiAiaHN2IiB9LCBod2I6IHsgY2hhbm5lbHM6IDMsIGxhYmVsczogImh3YiIgfSwgY215azogeyBjaGFubmVsczogNCwgbGFiZWxzOiAiY215ayIgfSwgeHl6OiB7IGNoYW5uZWxzOiAzLCBsYWJlbHM6ICJ4eXoiIH0sIGxhYjogeyBjaGFubmVsczogMywgbGFiZWxzOiAibGFiIiB9LCBsY2g6IHsgY2hhbm5lbHM6IDMsIGxhYmVsczogImxjaCIgfSwgaGV4OiB7IGNoYW5uZWxzOiAxLCBsYWJlbHM6IFsiaGV4Il0gfSwga2V5d29yZDogeyBjaGFubmVsczogMSwgbGFiZWxzOiBbImtleXdvcmQiXSB9LCBhbnNpMTY6IHsgY2hhbm5lbHM6IDEsIGxhYmVsczogWyJhbnNpMTYiXSB9LCBhbnNpMjU2OiB7IGNoYW5uZWxzOiAxLCBsYWJlbHM6IFsiYW5zaTI1NiJdIH0sIGhjZzogeyBjaGFubmVsczogMywgbGFiZWxzOiBbImgiLCAiYyIsICJnIl0gfSwgYXBwbGU6IHsgY2hhbm5lbHM6IDMsIGxhYmVsczogWyJyMTYiLCAiZzE2IiwgImIxNiJdIH0sIGdyYXk6IHsgY2hhbm5lbHM6IDEsIGxhYmVsczogWyJncmF5Il0gfSB9OwogICAgICAgIHZhciBVZCA9IHFkOwogICAgICAgIGZvciAoY29uc3QgZTIgb2YgT2JqZWN0LmtleXMocWQpKSB7CiAgICAgICAgICBpZiAoISgiY2hhbm5lbHMiIGluIHFkW2UyXSkpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigibWlzc2luZyBjaGFubmVscyBwcm9wZXJ0eTogIiArIGUyKTsKICAgICAgICAgIGlmICghKCJsYWJlbHMiIGluIHFkW2UyXSkpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigibWlzc2luZyBjaGFubmVsIGxhYmVscyBwcm9wZXJ0eTogIiArIGUyKTsKICAgICAgICAgIGlmIChxZFtlMl0ubGFiZWxzLmxlbmd0aCAhPT0gcWRbZTJdLmNoYW5uZWxzKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImNoYW5uZWwgYW5kIGxhYmVsIGNvdW50cyBtaXNtYXRjaDogIiArIGUyKTsKICAgICAgICAgIGNvbnN0IHsgY2hhbm5lbHM6IHQyLCBsYWJlbHM6IG4yIH0gPSBxZFtlMl07CiAgICAgICAgICBkZWxldGUgcWRbZTJdLmNoYW5uZWxzLCBkZWxldGUgcWRbZTJdLmxhYmVscywgT2JqZWN0LmRlZmluZVByb3BlcnR5KHFkW2UyXSwgImNoYW5uZWxzIiwgeyB2YWx1ZTogdDIgfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShxZFtlMl0sICJsYWJlbHMiLCB7IHZhbHVlOiBuMiB9KTsKICAgICAgICB9CiAgICAgICAgcWQucmdiLmhzbCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyWzBdIC8gMjU1LCBuMiA9IGUyWzFdIC8gMjU1LCByMiA9IGUyWzJdIC8gMjU1LCBvMiA9IE1hdGgubWluKHQyLCBuMiwgcjIpLCBpMiA9IE1hdGgubWF4KHQyLCBuMiwgcjIpLCB1MiA9IGkyIC0gbzI7CiAgICAgICAgICBsZXQgczIsIGEyOwogICAgICAgICAgaTIgPT09IG8yID8gczIgPSAwIDogdDIgPT09IGkyID8gczIgPSAobjIgLSByMikgLyB1MiA6IG4yID09PSBpMiA/IHMyID0gMiArIChyMiAtIHQyKSAvIHUyIDogcjIgPT09IGkyICYmIChzMiA9IDQgKyAodDIgLSBuMikgLyB1MiksIHMyID0gTWF0aC5taW4oNjAgKiBzMiwgMzYwKSwgczIgPCAwICYmIChzMiArPSAzNjApOwogICAgICAgICAgY29uc3QgYzIgPSAobzIgKyBpMikgLyAyOwogICAgICAgICAgcmV0dXJuIGEyID0gaTIgPT09IG8yID8gMCA6IGMyIDw9IDAuNSA/IHUyIC8gKGkyICsgbzIpIDogdTIgLyAoMiAtIGkyIC0gbzIpLCBbczIsIDEwMCAqIGEyLCAxMDAgKiBjMl07CiAgICAgICAgfSwgcWQucmdiLmhzdiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBsZXQgdDIsIG4yLCByMiwgbzIsIGkyOwogICAgICAgICAgY29uc3QgdTIgPSBlMlswXSAvIDI1NSwgczIgPSBlMlsxXSAvIDI1NSwgYTIgPSBlMlsyXSAvIDI1NSwgYzIgPSBNYXRoLm1heCh1MiwgczIsIGEyKSwgbDIgPSBjMiAtIE1hdGgubWluKHUyLCBzMiwgYTIpLCBwMiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiAoYzIgLSBlMykgLyA2IC8gbDIgKyAwLjU7CiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIGwyID09PSAwID8gKG8yID0gMCwgaTIgPSAwKSA6IChpMiA9IGwyIC8gYzIsIHQyID0gcDIodTIpLCBuMiA9IHAyKHMyKSwgcjIgPSBwMihhMiksIHUyID09PSBjMiA/IG8yID0gcjIgLSBuMiA6IHMyID09PSBjMiA/IG8yID0gMSAvIDMgKyB0MiAtIHIyIDogYTIgPT09IGMyICYmIChvMiA9IDIgLyAzICsgbjIgLSB0MiksIG8yIDwgMCA/IG8yICs9IDEgOiBvMiA+IDEgJiYgKG8yIC09IDEpKSwgWzM2MCAqIG8yLCAxMDAgKiBpMiwgMTAwICogYzJdOwogICAgICAgIH0sIHFkLnJnYi5od2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMlswXSwgbjIgPSBlMlsxXTsKICAgICAgICAgIGxldCByMiA9IGUyWzJdOwogICAgICAgICAgY29uc3QgbzIgPSBxZC5yZ2IuaHNsKGUyKVswXSwgaTIgPSAxIC8gMjU1ICogTWF0aC5taW4odDIsIE1hdGgubWluKG4yLCByMikpOwogICAgICAgICAgcmV0dXJuIHIyID0gMSAtIDEgLyAyNTUgKiBNYXRoLm1heCh0MiwgTWF0aC5tYXgobjIsIHIyKSksIFtvMiwgMTAwICogaTIsIDEwMCAqIHIyXTsKICAgICAgICB9LCBxZC5yZ2IuY215ayA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyWzBdIC8gMjU1LCBuMiA9IGUyWzFdIC8gMjU1LCByMiA9IGUyWzJdIC8gMjU1LCBvMiA9IE1hdGgubWluKDEgLSB0MiwgMSAtIG4yLCAxIC0gcjIpOwogICAgICAgICAgcmV0dXJuIFsxMDAgKiAoKDEgLSB0MiAtIG8yKSAvICgxIC0gbzIpIHx8IDApLCAxMDAgKiAoKDEgLSBuMiAtIG8yKSAvICgxIC0gbzIpIHx8IDApLCAxMDAgKiAoKDEgLSByMiAtIG8yKSAvICgxIC0gbzIpIHx8IDApLCAxMDAgKiBvMl07CiAgICAgICAgfSwgcWQucmdiLmtleXdvcmQgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBXZFtlMl07CiAgICAgICAgICBpZiAodDIpCiAgICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICAgIGxldCBuMiwgcjIgPSAxIC8gMDsKICAgICAgICAgIGZvciAoY29uc3QgdDMgb2YgT2JqZWN0LmtleXMoJGQpKSB7CiAgICAgICAgICAgIGNvbnN0IHUyID0gKGkyID0gJGRbdDNdLCAoKG8yID0gZTIpWzBdIC0gaTJbMF0pICoqIDIgKyAobzJbMV0gLSBpMlsxXSkgKiogMiArIChvMlsyXSAtIGkyWzJdKSAqKiAyKTsKICAgICAgICAgICAgdTIgPCByMiAmJiAocjIgPSB1MiwgbjIgPSB0Myk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgbzIsIGkyOwogICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgIH0sIHFkLmtleXdvcmQucmdiID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiAkZFtlMl07CiAgICAgICAgfSwgcWQucmdiLnh5eiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSBlMlswXSAvIDI1NSwgbjIgPSBlMlsxXSAvIDI1NSwgcjIgPSBlMlsyXSAvIDI1NTsKICAgICAgICAgIHQyID0gdDIgPiAwLjA0MDQ1ID8gKCh0MiArIDAuMDU1KSAvIDEuMDU1KSAqKiAyLjQgOiB0MiAvIDEyLjkyLCBuMiA9IG4yID4gMC4wNDA0NSA/ICgobjIgKyAwLjA1NSkgLyAxLjA1NSkgKiogMi40IDogbjIgLyAxMi45MiwgcjIgPSByMiA+IDAuMDQwNDUgPyAoKHIyICsgMC4wNTUpIC8gMS4wNTUpICoqIDIuNCA6IHIyIC8gMTIuOTI7CiAgICAgICAgICByZXR1cm4gWzEwMCAqICgwLjQxMjQgKiB0MiArIDAuMzU3NiAqIG4yICsgMC4xODA1ICogcjIpLCAxMDAgKiAoMC4yMTI2ICogdDIgKyAwLjcxNTIgKiBuMiArIDAuMDcyMiAqIHIyKSwgMTAwICogKDAuMDE5MyAqIHQyICsgMC4xMTkyICogbjIgKyAwLjk1MDUgKiByMildOwogICAgICAgIH0sIHFkLnJnYi5sYWIgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBxZC5yZ2IueHl6KGUyKTsKICAgICAgICAgIGxldCBuMiA9IHQyWzBdLCByMiA9IHQyWzFdLCBvMiA9IHQyWzJdOwogICAgICAgICAgbjIgLz0gOTUuMDQ3LCByMiAvPSAxMDAsIG8yIC89IDEwOC44ODMsIG4yID0gbjIgPiA4ODU2ZS02ID8gbjIgKiogKDEgLyAzKSA6IDcuNzg3ICogbjIgKyAxNiAvIDExNiwgcjIgPSByMiA+IDg4NTZlLTYgPyByMiAqKiAoMSAvIDMpIDogNy43ODcgKiByMiArIDE2IC8gMTE2LCBvMiA9IG8yID4gODg1NmUtNiA/IG8yICoqICgxIC8gMykgOiA3Ljc4NyAqIG8yICsgMTYgLyAxMTY7CiAgICAgICAgICByZXR1cm4gWzExNiAqIHIyIC0gMTYsIDUwMCAqIChuMiAtIHIyKSwgMjAwICogKHIyIC0gbzIpXTsKICAgICAgICB9LCBxZC5oc2wucmdiID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTJbMF0gLyAzNjAsIG4yID0gZTJbMV0gLyAxMDAsIHIyID0gZTJbMl0gLyAxMDA7CiAgICAgICAgICBsZXQgbzIsIGkyLCB1MjsKICAgICAgICAgIGlmIChuMiA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIHUyID0gMjU1ICogcjIsIFt1MiwgdTIsIHUyXTsKICAgICAgICAgIG8yID0gcjIgPCAwLjUgPyByMiAqICgxICsgbjIpIDogcjIgKyBuMiAtIHIyICogbjI7CiAgICAgICAgICBjb25zdCBzMiA9IDIgKiByMiAtIG8yLCBhMiA9IFswLCAwLCAwXTsKICAgICAgICAgIGZvciAobGV0IGUzID0gMDsgZTMgPCAzOyBlMysrKQogICAgICAgICAgICBpMiA9IHQyICsgMSAvIDMgKiAtKGUzIC0gMSksIGkyIDwgMCAmJiBpMisrLCBpMiA+IDEgJiYgaTItLSwgdTIgPSA2ICogaTIgPCAxID8gczIgKyA2ICogKG8yIC0gczIpICogaTIgOiAyICogaTIgPCAxID8gbzIgOiAzICogaTIgPCAyID8gczIgKyAobzIgLSBzMikgKiAoMiAvIDMgLSBpMikgKiA2IDogczIsIGEyW2UzXSA9IDI1NSAqIHUyOwogICAgICAgICAgcmV0dXJuIGEyOwogICAgICAgIH0sIHFkLmhzbC5oc3YgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMlswXTsKICAgICAgICAgIGxldCBuMiA9IGUyWzFdIC8gMTAwLCByMiA9IGUyWzJdIC8gMTAwLCBvMiA9IG4yOwogICAgICAgICAgY29uc3QgaTIgPSBNYXRoLm1heChyMiwgMC4wMSk7CiAgICAgICAgICByMiAqPSAyLCBuMiAqPSByMiA8PSAxID8gcjIgOiAyIC0gcjIsIG8yICo9IGkyIDw9IDEgPyBpMiA6IDIgLSBpMjsKICAgICAgICAgIHJldHVybiBbdDIsIDEwMCAqIChyMiA9PT0gMCA/IDIgKiBvMiAvIChpMiArIG8yKSA6IDIgKiBuMiAvIChyMiArIG4yKSksIDEwMCAqICgocjIgKyBuMikgLyAyKV07CiAgICAgICAgfSwgcWQuaHN2LnJnYiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyWzBdIC8gNjAsIG4yID0gZTJbMV0gLyAxMDA7CiAgICAgICAgICBsZXQgcjIgPSBlMlsyXSAvIDEwMDsKICAgICAgICAgIGNvbnN0IG8yID0gTWF0aC5mbG9vcih0MikgJSA2LCBpMiA9IHQyIC0gTWF0aC5mbG9vcih0MiksIHUyID0gMjU1ICogcjIgKiAoMSAtIG4yKSwgczIgPSAyNTUgKiByMiAqICgxIC0gbjIgKiBpMiksIGEyID0gMjU1ICogcjIgKiAoMSAtIG4yICogKDEgLSBpMikpOwogICAgICAgICAgc3dpdGNoIChyMiAqPSAyNTUsIG8yKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICByZXR1cm4gW3IyLCBhMiwgdTJdOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgcmV0dXJuIFtzMiwgcjIsIHUyXTsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHJldHVybiBbdTIsIHIyLCBhMl07CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICByZXR1cm4gW3UyLCBzMiwgcjJdOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgcmV0dXJuIFthMiwgdTIsIHIyXTsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIHJldHVybiBbcjIsIHUyLCBzMl07CiAgICAgICAgICB9CiAgICAgICAgfSwgcWQuaHN2LmhzbCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyWzBdLCBuMiA9IGUyWzFdIC8gMTAwLCByMiA9IGUyWzJdIC8gMTAwLCBvMiA9IE1hdGgubWF4KHIyLCAwLjAxKTsKICAgICAgICAgIGxldCBpMiwgdTI7CiAgICAgICAgICB1MiA9ICgyIC0gbjIpICogcjI7CiAgICAgICAgICBjb25zdCBzMiA9ICgyIC0gbjIpICogbzI7CiAgICAgICAgICByZXR1cm4gaTIgPSBuMiAqIG8yLCBpMiAvPSBzMiA8PSAxID8gczIgOiAyIC0gczIsIGkyID0gaTIgfHwgMCwgdTIgLz0gMiwgW3QyLCAxMDAgKiBpMiwgMTAwICogdTJdOwogICAgICAgIH0sIHFkLmh3Yi5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMlswXSAvIDM2MDsKICAgICAgICAgIGxldCBuMiA9IGUyWzFdIC8gMTAwLCByMiA9IGUyWzJdIC8gMTAwOwogICAgICAgICAgY29uc3QgbzIgPSBuMiArIHIyOwogICAgICAgICAgbGV0IGkyOwogICAgICAgICAgbzIgPiAxICYmIChuMiAvPSBvMiwgcjIgLz0gbzIpOwogICAgICAgICAgY29uc3QgdTIgPSBNYXRoLmZsb29yKDYgKiB0MiksIHMyID0gMSAtIHIyOwogICAgICAgICAgaTIgPSA2ICogdDIgLSB1MiwgKDEgJiB1MikgIT0gMCAmJiAoaTIgPSAxIC0gaTIpOwogICAgICAgICAgY29uc3QgYTIgPSBuMiArIGkyICogKHMyIC0gbjIpOwogICAgICAgICAgbGV0IGMyLCBsMiwgcDI7CiAgICAgICAgICBzd2l0Y2ggKHUyKSB7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGMyID0gczIsIGwyID0gYTIsIHAyID0gbjI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBjMiA9IGEyLCBsMiA9IHMyLCBwMiA9IG4yOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgYzIgPSBuMiwgbDIgPSBzMiwgcDIgPSBhMjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIGMyID0gbjIsIGwyID0gYTIsIHAyID0gczI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjMiA9IGEyLCBsMiA9IG4yLCBwMiA9IHMyOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgYzIgPSBzMiwgbDIgPSBuMiwgcDIgPSBhMjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbMjU1ICogYzIsIDI1NSAqIGwyLCAyNTUgKiBwMl07CiAgICAgICAgfSwgcWQuY215ay5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMlswXSAvIDEwMCwgbjIgPSBlMlsxXSAvIDEwMCwgcjIgPSBlMlsyXSAvIDEwMCwgbzIgPSBlMlszXSAvIDEwMDsKICAgICAgICAgIHJldHVybiBbMjU1ICogKDEgLSBNYXRoLm1pbigxLCB0MiAqICgxIC0gbzIpICsgbzIpKSwgMjU1ICogKDEgLSBNYXRoLm1pbigxLCBuMiAqICgxIC0gbzIpICsgbzIpKSwgMjU1ICogKDEgLSBNYXRoLm1pbigxLCByMiAqICgxIC0gbzIpICsgbzIpKV07CiAgICAgICAgfSwgcWQueHl6LnJnYiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyWzBdIC8gMTAwLCBuMiA9IGUyWzFdIC8gMTAwLCByMiA9IGUyWzJdIC8gMTAwOwogICAgICAgICAgbGV0IG8yLCBpMiwgdTI7CiAgICAgICAgICByZXR1cm4gbzIgPSAzLjI0MDYgKiB0MiArIC0xLjUzNzIgKiBuMiArIC0wLjQ5ODYgKiByMiwgaTIgPSAtMC45Njg5ICogdDIgKyAxLjg3NTggKiBuMiArIDAuMDQxNSAqIHIyLCB1MiA9IDAuMDU1NyAqIHQyICsgLTAuMjA0ICogbjIgKyAxLjA1NyAqIHIyLCBvMiA9IG8yID4gMzEzMDhlLTcgPyAxLjA1NSAqIG8yICoqICgxIC8gMi40KSAtIDAuMDU1IDogMTIuOTIgKiBvMiwgaTIgPSBpMiA+IDMxMzA4ZS03ID8gMS4wNTUgKiBpMiAqKiAoMSAvIDIuNCkgLSAwLjA1NSA6IDEyLjkyICogaTIsIHUyID0gdTIgPiAzMTMwOGUtNyA/IDEuMDU1ICogdTIgKiogKDEgLyAyLjQpIC0gMC4wNTUgOiAxMi45MiAqIHUyLCBvMiA9IE1hdGgubWluKE1hdGgubWF4KDAsIG8yKSwgMSksIGkyID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgaTIpLCAxKSwgdTIgPSBNYXRoLm1pbihNYXRoLm1heCgwLCB1MiksIDEpLCBbMjU1ICogbzIsIDI1NSAqIGkyLCAyNTUgKiB1Ml07CiAgICAgICAgfSwgcWQueHl6LmxhYiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSBlMlswXSwgbjIgPSBlMlsxXSwgcjIgPSBlMlsyXTsKICAgICAgICAgIHQyIC89IDk1LjA0NywgbjIgLz0gMTAwLCByMiAvPSAxMDguODgzLCB0MiA9IHQyID4gODg1NmUtNiA/IHQyICoqICgxIC8gMykgOiA3Ljc4NyAqIHQyICsgMTYgLyAxMTYsIG4yID0gbjIgPiA4ODU2ZS02ID8gbjIgKiogKDEgLyAzKSA6IDcuNzg3ICogbjIgKyAxNiAvIDExNiwgcjIgPSByMiA+IDg4NTZlLTYgPyByMiAqKiAoMSAvIDMpIDogNy43ODcgKiByMiArIDE2IC8gMTE2OwogICAgICAgICAgcmV0dXJuIFsxMTYgKiBuMiAtIDE2LCA1MDAgKiAodDIgLSBuMiksIDIwMCAqIChuMiAtIHIyKV07CiAgICAgICAgfSwgcWQubGFiLnh5eiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBsZXQgdDIsIG4yLCByMjsKICAgICAgICAgIG4yID0gKGUyWzBdICsgMTYpIC8gMTE2LCB0MiA9IGUyWzFdIC8gNTAwICsgbjIsIHIyID0gbjIgLSBlMlsyXSAvIDIwMDsKICAgICAgICAgIGNvbnN0IG8yID0gbjIgKiogMywgaTIgPSB0MiAqKiAzLCB1MiA9IHIyICoqIDM7CiAgICAgICAgICByZXR1cm4gbjIgPSBvMiA+IDg4NTZlLTYgPyBvMiA6IChuMiAtIDE2IC8gMTE2KSAvIDcuNzg3LCB0MiA9IGkyID4gODg1NmUtNiA/IGkyIDogKHQyIC0gMTYgLyAxMTYpIC8gNy43ODcsIHIyID0gdTIgPiA4ODU2ZS02ID8gdTIgOiAocjIgLSAxNiAvIDExNikgLyA3Ljc4NywgdDIgKj0gOTUuMDQ3LCBuMiAqPSAxMDAsIHIyICo9IDEwOC44ODMsIFt0MiwgbjIsIHIyXTsKICAgICAgICB9LCBxZC5sYWIubGNoID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTJbMF0sIG4yID0gZTJbMV0sIHIyID0gZTJbMl07CiAgICAgICAgICBsZXQgbzI7CiAgICAgICAgICBvMiA9IDM2MCAqIE1hdGguYXRhbjIocjIsIG4yKSAvIDIgLyBNYXRoLlBJLCBvMiA8IDAgJiYgKG8yICs9IDM2MCk7CiAgICAgICAgICByZXR1cm4gW3QyLCBNYXRoLnNxcnQobjIgKiBuMiArIHIyICogcjIpLCBvMl07CiAgICAgICAgfSwgcWQubGNoLmxhYiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyWzBdLCBuMiA9IGUyWzFdLCByMiA9IGUyWzJdIC8gMzYwICogMiAqIE1hdGguUEk7CiAgICAgICAgICByZXR1cm4gW3QyLCBuMiAqIE1hdGguY29zKHIyKSwgbjIgKiBNYXRoLnNpbihyMildOwogICAgICAgIH0sIHFkLnJnYi5hbnNpMTYgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgbGV0IHQyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMV0gOiBudWxsOwogICAgICAgICAgY29uc3QgW24yLCByMiwgbzJdID0gZTI7CiAgICAgICAgICBsZXQgaTIgPSB0MiA9PT0gbnVsbCA/IHFkLnJnYi5oc3YoZTIpWzJdIDogdDI7CiAgICAgICAgICBpZiAoaTIgPSBNYXRoLnJvdW5kKGkyIC8gNTApLCBpMiA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIDMwOwogICAgICAgICAgbGV0IHUyID0gMzAgKyAoTWF0aC5yb3VuZChvMiAvIDI1NSkgPDwgMiB8IE1hdGgucm91bmQocjIgLyAyNTUpIDw8IDEgfCBNYXRoLnJvdW5kKG4yIC8gMjU1KSk7CiAgICAgICAgICByZXR1cm4gaTIgPT09IDIgJiYgKHUyICs9IDYwKSwgdTI7CiAgICAgICAgfSwgcWQuaHN2LmFuc2kxNiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gcWQucmdiLmFuc2kxNihxZC5oc3YucmdiKGUyKSwgZTJbMl0pOwogICAgICAgIH0sIHFkLnJnYi5hbnNpMjU2ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTJbMF0sIG4yID0gZTJbMV0sIHIyID0gZTJbMl07CiAgICAgICAgICBpZiAodDIgPT09IG4yICYmIG4yID09PSByMikKICAgICAgICAgICAgcmV0dXJuIHQyIDwgOCA/IDE2IDogdDIgPiAyNDggPyAyMzEgOiBNYXRoLnJvdW5kKCh0MiAtIDgpIC8gMjQ3ICogMjQpICsgMjMyOwogICAgICAgICAgcmV0dXJuIDE2ICsgMzYgKiBNYXRoLnJvdW5kKHQyIC8gMjU1ICogNSkgKyA2ICogTWF0aC5yb3VuZChuMiAvIDI1NSAqIDUpICsgTWF0aC5yb3VuZChyMiAvIDI1NSAqIDUpOwogICAgICAgIH0sIHFkLmFuc2kxNi5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgbGV0IHQyID0gZTIgJSAxMDsKICAgICAgICAgIGlmICh0MiA9PT0gMCB8fCB0MiA9PT0gNykKICAgICAgICAgICAgcmV0dXJuIGUyID4gNTAgJiYgKHQyICs9IDMuNSksIHQyID0gdDIgLyAxMC41ICogMjU1LCBbdDIsIHQyLCB0Ml07CiAgICAgICAgICBjb25zdCBuMiA9IDAuNSAqICgxICsgfn4oZTIgPiA1MCkpOwogICAgICAgICAgcmV0dXJuIFsoMSAmIHQyKSAqIG4yICogMjU1LCAodDIgPj4gMSAmIDEpICogbjIgKiAyNTUsICh0MiA+PiAyICYgMSkgKiBuMiAqIDI1NV07CiAgICAgICAgfSwgcWQuYW5zaTI1Ni5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKGUyID49IDIzMikgewogICAgICAgICAgICBjb25zdCB0MyA9IDEwICogKGUyIC0gMjMyKSArIDg7CiAgICAgICAgICAgIHJldHVybiBbdDMsIHQzLCB0M107CiAgICAgICAgICB9CiAgICAgICAgICBsZXQgdDI7CiAgICAgICAgICBlMiAtPSAxNjsKICAgICAgICAgIHJldHVybiBbTWF0aC5mbG9vcihlMiAvIDM2KSAvIDUgKiAyNTUsIE1hdGguZmxvb3IoKHQyID0gZTIgJSAzNikgLyA2KSAvIDUgKiAyNTUsIHQyICUgNiAvIDUgKiAyNTVdOwogICAgICAgIH0sIHFkLnJnYi5oZXggPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSAoKCgyNTUgJiBNYXRoLnJvdW5kKGUyWzBdKSkgPDwgMTYpICsgKCgyNTUgJiBNYXRoLnJvdW5kKGUyWzFdKSkgPDwgOCkgKyAoMjU1ICYgTWF0aC5yb3VuZChlMlsyXSkpKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTsKICAgICAgICAgIHJldHVybiAiMDAwMDAwIi5zdWJzdHJpbmcodDIubGVuZ3RoKSArIHQyOwogICAgICAgIH0sIHFkLmhleC5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMi50b1N0cmluZygxNikubWF0Y2goL1thLWYwLTldezZ9fFthLWYwLTldezN9L2kpOwogICAgICAgICAgaWYgKCF0MikKICAgICAgICAgICAgcmV0dXJuIFswLCAwLCAwXTsKICAgICAgICAgIGxldCBuMiA9IHQyWzBdOwogICAgICAgICAgdDJbMF0ubGVuZ3RoID09PSAzICYmIChuMiA9IG4yLnNwbGl0KCIiKS5tYXAoKGUzKSA9PiBlMyArIGUzKS5qb2luKCIiKSk7CiAgICAgICAgICBjb25zdCByMiA9IHBhcnNlSW50KG4yLCAxNik7CiAgICAgICAgICByZXR1cm4gW3IyID4+IDE2ICYgMjU1LCByMiA+PiA4ICYgMjU1LCAyNTUgJiByMl07CiAgICAgICAgfSwgcWQucmdiLmhjZyA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyWzBdIC8gMjU1LCBuMiA9IGUyWzFdIC8gMjU1LCByMiA9IGUyWzJdIC8gMjU1LCBvMiA9IE1hdGgubWF4KE1hdGgubWF4KHQyLCBuMiksIHIyKSwgaTIgPSBNYXRoLm1pbihNYXRoLm1pbih0MiwgbjIpLCByMiksIHUyID0gbzIgLSBpMjsKICAgICAgICAgIGxldCBzMiwgYTI7CiAgICAgICAgICByZXR1cm4gczIgPSB1MiA8IDEgPyBpMiAvICgxIC0gdTIpIDogMCwgYTIgPSB1MiA8PSAwID8gMCA6IG8yID09PSB0MiA/IChuMiAtIHIyKSAvIHUyICUgNiA6IG8yID09PSBuMiA/IDIgKyAocjIgLSB0MikgLyB1MiA6IDQgKyAodDIgLSBuMikgLyB1MiwgYTIgLz0gNiwgYTIgJT0gMSwgWzM2MCAqIGEyLCAxMDAgKiB1MiwgMTAwICogczJdOwogICAgICAgIH0sIHFkLmhzbC5oY2cgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMlsxXSAvIDEwMCwgbjIgPSBlMlsyXSAvIDEwMCwgcjIgPSBuMiA8IDAuNSA/IDIgKiB0MiAqIG4yIDogMiAqIHQyICogKDEgLSBuMik7CiAgICAgICAgICBsZXQgbzIgPSAwOwogICAgICAgICAgcmV0dXJuIHIyIDwgMSAmJiAobzIgPSAobjIgLSAwLjUgKiByMikgLyAoMSAtIHIyKSksIFtlMlswXSwgMTAwICogcjIsIDEwMCAqIG8yXTsKICAgICAgICB9LCBxZC5oc3YuaGNnID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTJbMV0gLyAxMDAsIG4yID0gZTJbMl0gLyAxMDAsIHIyID0gdDIgKiBuMjsKICAgICAgICAgIGxldCBvMiA9IDA7CiAgICAgICAgICByZXR1cm4gcjIgPCAxICYmIChvMiA9IChuMiAtIHIyKSAvICgxIC0gcjIpKSwgW2UyWzBdLCAxMDAgKiByMiwgMTAwICogbzJdOwogICAgICAgIH0sIHFkLmhjZy5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMlswXSAvIDM2MCwgbjIgPSBlMlsxXSAvIDEwMCwgcjIgPSBlMlsyXSAvIDEwMDsKICAgICAgICAgIGlmIChuMiA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIFsyNTUgKiByMiwgMjU1ICogcjIsIDI1NSAqIHIyXTsKICAgICAgICAgIGNvbnN0IG8yID0gWzAsIDAsIDBdLCBpMiA9IHQyICUgMSAqIDYsIHUyID0gaTIgJSAxLCBzMiA9IDEgLSB1MjsKICAgICAgICAgIGxldCBhMiA9IDA7CiAgICAgICAgICBzd2l0Y2ggKE1hdGguZmxvb3IoaTIpKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBvMlswXSA9IDEsIG8yWzFdID0gdTIsIG8yWzJdID0gMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIG8yWzBdID0gczIsIG8yWzFdID0gMSwgbzJbMl0gPSAwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgbzJbMF0gPSAwLCBvMlsxXSA9IDEsIG8yWzJdID0gdTI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBvMlswXSA9IDAsIG8yWzFdID0gczIsIG8yWzJdID0gMTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIG8yWzBdID0gdTIsIG8yWzFdID0gMCwgbzJbMl0gPSAxOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIG8yWzBdID0gMSwgbzJbMV0gPSAwLCBvMlsyXSA9IHMyOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGEyID0gKDEgLSBuMikgKiByMiwgWzI1NSAqIChuMiAqIG8yWzBdICsgYTIpLCAyNTUgKiAobjIgKiBvMlsxXSArIGEyKSwgMjU1ICogKG4yICogbzJbMl0gKyBhMildOwogICAgICAgIH0sIHFkLmhjZy5oc3YgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMlsxXSAvIDEwMCwgbjIgPSB0MiArIGUyWzJdIC8gMTAwICogKDEgLSB0Mik7CiAgICAgICAgICBsZXQgcjIgPSAwOwogICAgICAgICAgcmV0dXJuIG4yID4gMCAmJiAocjIgPSB0MiAvIG4yKSwgW2UyWzBdLCAxMDAgKiByMiwgMTAwICogbjJdOwogICAgICAgIH0sIHFkLmhjZy5oc2wgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMlsxXSAvIDEwMCwgbjIgPSBlMlsyXSAvIDEwMCAqICgxIC0gdDIpICsgMC41ICogdDI7CiAgICAgICAgICBsZXQgcjIgPSAwOwogICAgICAgICAgcmV0dXJuIG4yID4gMCAmJiBuMiA8IDAuNSA/IHIyID0gdDIgLyAoMiAqIG4yKSA6IG4yID49IDAuNSAmJiBuMiA8IDEgJiYgKHIyID0gdDIgLyAoMiAqICgxIC0gbjIpKSksIFtlMlswXSwgMTAwICogcjIsIDEwMCAqIG4yXTsKICAgICAgICB9LCBxZC5oY2cuaHdiID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTJbMV0gLyAxMDAsIG4yID0gdDIgKyBlMlsyXSAvIDEwMCAqICgxIC0gdDIpOwogICAgICAgICAgcmV0dXJuIFtlMlswXSwgMTAwICogKG4yIC0gdDIpLCAxMDAgKiAoMSAtIG4yKV07CiAgICAgICAgfSwgcWQuaHdiLmhjZyA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyWzFdIC8gMTAwLCBuMiA9IDEgLSBlMlsyXSAvIDEwMCwgcjIgPSBuMiAtIHQyOwogICAgICAgICAgbGV0IG8yID0gMDsKICAgICAgICAgIHJldHVybiByMiA8IDEgJiYgKG8yID0gKG4yIC0gcjIpIC8gKDEgLSByMikpLCBbZTJbMF0sIDEwMCAqIHIyLCAxMDAgKiBvMl07CiAgICAgICAgfSwgcWQuYXBwbGUucmdiID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBbZTJbMF0gLyA2NTUzNSAqIDI1NSwgZTJbMV0gLyA2NTUzNSAqIDI1NSwgZTJbMl0gLyA2NTUzNSAqIDI1NV07CiAgICAgICAgfSwgcWQucmdiLmFwcGxlID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBbZTJbMF0gLyAyNTUgKiA2NTUzNSwgZTJbMV0gLyAyNTUgKiA2NTUzNSwgZTJbMl0gLyAyNTUgKiA2NTUzNV07CiAgICAgICAgfSwgcWQuZ3JheS5yZ2IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFtlMlswXSAvIDEwMCAqIDI1NSwgZTJbMF0gLyAxMDAgKiAyNTUsIGUyWzBdIC8gMTAwICogMjU1XTsKICAgICAgICB9LCBxZC5ncmF5LmhzbCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gWzAsIDAsIGUyWzBdXTsKICAgICAgICB9LCBxZC5ncmF5LmhzdiA9IHFkLmdyYXkuaHNsLCBxZC5ncmF5Lmh3YiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gWzAsIDEwMCwgZTJbMF1dOwogICAgICAgIH0sIHFkLmdyYXkuY215ayA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gWzAsIDAsIDAsIGUyWzBdXTsKICAgICAgICB9LCBxZC5ncmF5LmxhYiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gW2UyWzBdLCAwLCAwXTsKICAgICAgICB9LCBxZC5ncmF5LmhleCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IDI1NSAmIE1hdGgucm91bmQoZTJbMF0gLyAxMDAgKiAyNTUpLCBuMiA9ICgodDIgPDwgMTYpICsgKHQyIDw8IDgpICsgdDIpLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgcmV0dXJuICIwMDAwMDAiLnN1YnN0cmluZyhuMi5sZW5ndGgpICsgbjI7CiAgICAgICAgfSwgcWQucmdiLmdyYXkgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFsoZTJbMF0gKyBlMlsxXSArIGUyWzJdKSAvIDMgLyAyNTUgKiAxMDBdOwogICAgICAgIH07CiAgICAgICAgY29uc3QgemQgPSBVZDsKICAgICAgICBmdW5jdGlvbiBHZChlMikgewogICAgICAgICAgY29uc3QgdDIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSB7fSwgdDMgPSBPYmplY3Qua2V5cyh6ZCk7CiAgICAgICAgICAgIGZvciAobGV0IG4zID0gdDMubGVuZ3RoLCByMiA9IDA7IHIyIDwgbjM7IHIyKyspCiAgICAgICAgICAgICAgZTNbdDNbcjJdXSA9IHsgZGlzdGFuY2U6IC0xLCBwYXJlbnQ6IG51bGwgfTsKICAgICAgICAgICAgcmV0dXJuIGUzOwogICAgICAgICAgfSgpLCBuMiA9IFtlMl07CiAgICAgICAgICBmb3IgKHQyW2UyXS5kaXN0YW5jZSA9IDA7IG4yLmxlbmd0aDsgKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gbjIucG9wKCksIHIyID0gT2JqZWN0LmtleXMoemRbZTNdKTsKICAgICAgICAgICAgZm9yIChsZXQgbzIgPSByMi5sZW5ndGgsIGkyID0gMDsgaTIgPCBvMjsgaTIrKykgewogICAgICAgICAgICAgIGNvbnN0IG8zID0gcjJbaTJdLCB1MiA9IHQyW28zXTsKICAgICAgICAgICAgICB1Mi5kaXN0YW5jZSA9PT0gLTEgJiYgKHUyLmRpc3RhbmNlID0gdDJbZTNdLmRpc3RhbmNlICsgMSwgdTIucGFyZW50ID0gZTMsIG4yLnVuc2hpZnQobzMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBIZChlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihuMikgewogICAgICAgICAgICByZXR1cm4gdDIoZTIobjIpKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEpkKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSBbdDJbZTJdLnBhcmVudCwgZTJdOwogICAgICAgICAgbGV0IHIyID0gemRbdDJbZTJdLnBhcmVudF1bZTJdLCBvMiA9IHQyW2UyXS5wYXJlbnQ7CiAgICAgICAgICBmb3IgKDsgdDJbbzJdLnBhcmVudDsgKQogICAgICAgICAgICBuMi51bnNoaWZ0KHQyW28yXS5wYXJlbnQpLCByMiA9IEhkKHpkW3QyW28yXS5wYXJlbnRdW28yXSwgcjIpLCBvMiA9IHQyW28yXS5wYXJlbnQ7CiAgICAgICAgICByZXR1cm4gcjIuY29udmVyc2lvbiA9IG4yLCByMjsKICAgICAgICB9CiAgICAgICAgY29uc3QgWGQgPSBVZCwgWWQgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBHZChlMiksIG4yID0ge30sIHIyID0gT2JqZWN0LmtleXModDIpOwogICAgICAgICAgZm9yIChsZXQgZTMgPSByMi5sZW5ndGgsIG8yID0gMDsgbzIgPCBlMzsgbzIrKykgewogICAgICAgICAgICBjb25zdCBlNCA9IHIyW28yXTsKICAgICAgICAgICAgdDJbZTRdLnBhcmVudCAhPT0gbnVsbCAmJiAobjJbZTRdID0gSmQoZTQsIHQyKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgfSwgS2QgPSB7fTsKICAgICAgICBPYmplY3Qua2V5cyhYZCkuZm9yRWFjaCgoZTIpID0+IHsKICAgICAgICAgIEtkW2UyXSA9IHt9LCBPYmplY3QuZGVmaW5lUHJvcGVydHkoS2RbZTJdLCAiY2hhbm5lbHMiLCB7IHZhbHVlOiBYZFtlMl0uY2hhbm5lbHMgfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShLZFtlMl0sICJsYWJlbHMiLCB7IHZhbHVlOiBYZFtlMl0ubGFiZWxzIH0pOwogICAgICAgICAgY29uc3QgdDIgPSBZZChlMik7CiAgICAgICAgICBPYmplY3Qua2V5cyh0MikuZm9yRWFjaCgobjIpID0+IHsKICAgICAgICAgICAgY29uc3QgcjIgPSB0MltuMl07CiAgICAgICAgICAgIEtkW2UyXVtuMl0gPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciB0NCA9IGFyZ3VtZW50cy5sZW5ndGgsIG4zID0gbmV3IEFycmF5KHQ0KSwgcjMgPSAwOyByMyA8IHQ0OyByMysrKQogICAgICAgICAgICAgICAgICBuM1tyM10gPSBhcmd1bWVudHNbcjNdOwogICAgICAgICAgICAgICAgY29uc3QgbzIgPSBuM1swXTsKICAgICAgICAgICAgICAgIGlmIChvMiA9PSBudWxsKQogICAgICAgICAgICAgICAgICByZXR1cm4gbzI7CiAgICAgICAgICAgICAgICBvMi5sZW5ndGggPiAxICYmIChuMyA9IG8yKTsKICAgICAgICAgICAgICAgIGNvbnN0IGkyID0gZTMobjMpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpMiA9PSAib2JqZWN0IikKICAgICAgICAgICAgICAgICAgZm9yIChsZXQgZTQgPSBpMi5sZW5ndGgsIHQ1ID0gMDsgdDUgPCBlNDsgdDUrKykKICAgICAgICAgICAgICAgICAgICBpMlt0NV0gPSBNYXRoLnJvdW5kKGkyW3Q1XSk7CiAgICAgICAgICAgICAgICByZXR1cm4gaTI7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICByZXR1cm4gImNvbnZlcnNpb24iIGluIGUzICYmICh0My5jb252ZXJzaW9uID0gZTMuY29udmVyc2lvbiksIHQzOwogICAgICAgICAgICB9KHIyKSwgS2RbZTJdW24yXS5yYXcgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciB0NCA9IGFyZ3VtZW50cy5sZW5ndGgsIG4zID0gbmV3IEFycmF5KHQ0KSwgcjMgPSAwOyByMyA8IHQ0OyByMysrKQogICAgICAgICAgICAgICAgICBuM1tyM10gPSBhcmd1bWVudHNbcjNdOwogICAgICAgICAgICAgICAgY29uc3QgbzIgPSBuM1swXTsKICAgICAgICAgICAgICAgIHJldHVybiBvMiA9PSBudWxsID8gbzIgOiAobzIubGVuZ3RoID4gMSAmJiAobjMgPSBvMiksIGUzKG4zKSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICByZXR1cm4gImNvbnZlcnNpb24iIGluIGUzICYmICh0My5jb252ZXJzaW9uID0gZTMuY29udmVyc2lvbiksIHQzOwogICAgICAgICAgICB9KHIyKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIHZhciBRZCA9IEtkOwogICAgICAgIGZ1bmN0aW9uIFpkKCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBlaCgpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidHR5LlJlYWRTdHJlYW0gaXMgbm90IGltcGxlbWVudGVkIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRoKCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ0dHkuUmVhZFN0cmVhbSBpcyBub3QgaW1wbGVtZW50ZWQiKTsKICAgICAgICB9CiAgICAgICAgIWZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IChlMywgdDMpID0+IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjb25zdCBuMyA9IGUzKC4uLmFyZ3VtZW50cyk7CiAgICAgICAgICAgIHJldHVybiAiXHgxQlsiLmNvbmNhdChuMyArIHQzLCAibSIpOwogICAgICAgICAgfSwgbjIgPSAoZTMsIHQzKSA9PiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgY29uc3QgbjMgPSBlMyguLi5hcmd1bWVudHMpOwogICAgICAgICAgICByZXR1cm4gIlx4MUJbIi5jb25jYXQoMzggKyB0MywgIjs1OyIpLmNvbmNhdChuMywgIm0iKTsKICAgICAgICAgIH0sIHIyID0gKGUzLCB0MykgPT4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGNvbnN0IG4zID0gZTMoLi4uYXJndW1lbnRzKTsKICAgICAgICAgICAgcmV0dXJuICJceDFCWyIuY29uY2F0KDM4ICsgdDMsICI7MjsiKS5jb25jYXQobjNbMF0sICI7IikuY29uY2F0KG4zWzFdLCAiOyIpLmNvbmNhdChuM1syXSwgIm0iKTsKICAgICAgICAgIH0sIG8yID0gKGUzKSA9PiBlMywgaTIgPSAoZTMsIHQzLCBuMykgPT4gW2UzLCB0MywgbjNdLCB1MiA9IChlMywgdDMsIG4zKSA9PiB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMywgdDMsIHsgZ2V0OiAoKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgcjMgPSBuMygpOwogICAgICAgICAgICAgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTMsIHQzLCB7IHZhbHVlOiByMywgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0pLCByMzsKICAgICAgICAgICAgfSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0pOwogICAgICAgICAgfTsKICAgICAgICAgIGxldCBzMjsKICAgICAgICAgIGNvbnN0IGEyID0gKGUzLCB0MywgbjMsIHIzKSA9PiB7CiAgICAgICAgICAgIHMyID09PSB2b2lkIDAgJiYgKHMyID0gUWQpOwogICAgICAgICAgICBjb25zdCBvMyA9IHIzID8gMTAgOiAwLCBpMyA9IHt9OwogICAgICAgICAgICBmb3IgKGNvbnN0IFtyNCwgdTNdIG9mIE9iamVjdC5lbnRyaWVzKHMyKSkgewogICAgICAgICAgICAgIGNvbnN0IHMzID0gcjQgPT09ICJhbnNpMTYiID8gImFuc2kiIDogcjQ7CiAgICAgICAgICAgICAgcjQgPT09IHQzID8gaTNbczNdID0gZTMobjMsIG8zKSA6IHR5cGVvZiB1MyA9PSAib2JqZWN0IiAmJiAoaTNbczNdID0gZTModTNbdDNdLCBvMykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBpMzsKICAgICAgICAgIH07CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJleHBvcnRzIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjb25zdCBlMyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCksIHMzID0geyBtb2RpZmllcjogeyByZXNldDogWzAsIDBdLCBib2xkOiBbMSwgMjJdLCBkaW06IFsyLCAyMl0sIGl0YWxpYzogWzMsIDIzXSwgdW5kZXJsaW5lOiBbNCwgMjRdLCBpbnZlcnNlOiBbNywgMjddLCBoaWRkZW46IFs4LCAyOF0sIHN0cmlrZXRocm91Z2g6IFs5LCAyOV0gfSwgY29sb3I6IHsgYmxhY2s6IFszMCwgMzldLCByZWQ6IFszMSwgMzldLCBncmVlbjogWzMyLCAzOV0sIHllbGxvdzogWzMzLCAzOV0sIGJsdWU6IFszNCwgMzldLCBtYWdlbnRhOiBbMzUsIDM5XSwgY3lhbjogWzM2LCAzOV0sIHdoaXRlOiBbMzcsIDM5XSwgYmxhY2tCcmlnaHQ6IFs5MCwgMzldLCByZWRCcmlnaHQ6IFs5MSwgMzldLCBncmVlbkJyaWdodDogWzkyLCAzOV0sIHllbGxvd0JyaWdodDogWzkzLCAzOV0sIGJsdWVCcmlnaHQ6IFs5NCwgMzldLCBtYWdlbnRhQnJpZ2h0OiBbOTUsIDM5XSwgY3lhbkJyaWdodDogWzk2LCAzOV0sIHdoaXRlQnJpZ2h0OiBbOTcsIDM5XSB9LCBiZ0NvbG9yOiB7IGJnQmxhY2s6IFs0MCwgNDldLCBiZ1JlZDogWzQxLCA0OV0sIGJnR3JlZW46IFs0MiwgNDldLCBiZ1llbGxvdzogWzQzLCA0OV0sIGJnQmx1ZTogWzQ0LCA0OV0sIGJnTWFnZW50YTogWzQ1LCA0OV0sIGJnQ3lhbjogWzQ2LCA0OV0sIGJnV2hpdGU6IFs0NywgNDldLCBiZ0JsYWNrQnJpZ2h0OiBbMTAwLCA0OV0sIGJnUmVkQnJpZ2h0OiBbMTAxLCA0OV0sIGJnR3JlZW5CcmlnaHQ6IFsxMDIsIDQ5XSwgYmdZZWxsb3dCcmlnaHQ6IFsxMDMsIDQ5XSwgYmdCbHVlQnJpZ2h0OiBbMTA0LCA0OV0sIGJnTWFnZW50YUJyaWdodDogWzEwNSwgNDldLCBiZ0N5YW5CcmlnaHQ6IFsxMDYsIDQ5XSwgYmdXaGl0ZUJyaWdodDogWzEwNywgNDldIH0gfTsKICAgICAgICAgICAgczMuY29sb3IuZ3JheSA9IHMzLmNvbG9yLmJsYWNrQnJpZ2h0LCBzMy5iZ0NvbG9yLmJnR3JheSA9IHMzLmJnQ29sb3IuYmdCbGFja0JyaWdodCwgczMuY29sb3IuZ3JleSA9IHMzLmNvbG9yLmJsYWNrQnJpZ2h0LCBzMy5iZ0NvbG9yLmJnR3JleSA9IHMzLmJnQ29sb3IuYmdCbGFja0JyaWdodDsKICAgICAgICAgICAgZm9yIChjb25zdCBbdDMsIG4zXSBvZiBPYmplY3QuZW50cmllcyhzMykpIHsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IFt0NCwgcjNdIG9mIE9iamVjdC5lbnRyaWVzKG4zKSkKICAgICAgICAgICAgICAgIHMzW3Q0XSA9IHsgb3BlbjogIlx4MUJbIi5jb25jYXQocjNbMF0sICJtIiksIGNsb3NlOiAiXHgxQlsiLmNvbmNhdChyM1sxXSwgIm0iKSB9LCBuM1t0NF0gPSBzM1t0NF0sIGUzLnNldChyM1swXSwgcjNbMV0pOwogICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzMywgdDMsIHsgdmFsdWU6IG4zLCBlbnVtZXJhYmxlOiBmYWxzZSB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHMzLCAiY29kZXMiLCB7IHZhbHVlOiBlMywgZW51bWVyYWJsZTogZmFsc2UgfSksIHMzLmNvbG9yLmNsb3NlID0gIlx4MUJbMzltIiwgczMuYmdDb2xvci5jbG9zZSA9ICJceDFCWzQ5bSIsIHUyKHMzLmNvbG9yLCAiYW5zaSIsICgpID0+IGEyKHQyLCAiYW5zaTE2IiwgbzIsIGZhbHNlKSksIHUyKHMzLmNvbG9yLCAiYW5zaTI1NiIsICgpID0+IGEyKG4yLCAiYW5zaTI1NiIsIG8yLCBmYWxzZSkpLCB1MihzMy5jb2xvciwgImFuc2kxNm0iLCAoKSA9PiBhMihyMiwgInJnYiIsIGkyLCBmYWxzZSkpLCB1MihzMy5iZ0NvbG9yLCAiYW5zaSIsICgpID0+IGEyKHQyLCAiYW5zaTE2IiwgbzIsIHRydWUpKSwgdTIoczMuYmdDb2xvciwgImFuc2kyNTYiLCAoKSA9PiBhMihuMiwgImFuc2kyNTYiLCBvMiwgdHJ1ZSkpLCB1MihzMy5iZ0NvbG9yLCAiYW5zaTE2bSIsICgpID0+IGEyKHIyLCAicmdiIiwgaTIsIHRydWUpKSwgczM7CiAgICAgICAgICB9IH0pOwogICAgICAgIH0oVmQpOwogICAgICAgIHZhciBuaCA9IHsgaXNhdHR5OiBaZCwgUmVhZFN0cmVhbTogZWgsIFdyaXRlU3RyZWFtOiB0aCB9OwogICAgICAgIGNvbnN0IHJoID0geWYsIG9oID0gdChPYmplY3QuZnJlZXplKHsgX19wcm90b19fOiBudWxsLCBpc2F0dHk6IFpkLCBSZWFkU3RyZWFtOiBlaCwgV3JpdGVTdHJlYW06IHRoLCBkZWZhdWx0OiBuaCB9KSksIGloID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGxldCB0MiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDogdGEuYXJndjsKICAgICAgICAgIGNvbnN0IG4yID0gZTIuc3RhcnRzV2l0aCgiLSIpID8gIiIgOiBlMi5sZW5ndGggPT09IDEgPyAiLSIgOiAiLS0iLCByMiA9IHQyLmluZGV4T2YobjIgKyBlMiksIG8yID0gdDIuaW5kZXhPZigiLS0iKTsKICAgICAgICAgIHJldHVybiByMiAhPT0gLTEgJiYgKG8yID09PSAtMSB8fCByMiA8IG8yKTsKICAgICAgICB9LCB7IGVudjogdWggfSA9IHRhOwogICAgICAgIGxldCBzaDsKICAgICAgICBmdW5jdGlvbiBhaChlMikgewogICAgICAgICAgcmV0dXJuIGUyICE9PSAwICYmIHsgbGV2ZWw6IGUyLCBoYXNCYXNpYzogdHJ1ZSwgaGFzMjU2OiBlMiA+PSAyLCBoYXMxNm06IGUyID49IDMgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY2goZTIsIHQyKSB7CiAgICAgICAgICBpZiAoc2ggPT09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgaWYgKGloKCJjb2xvcj0xNm0iKSB8fCBpaCgiY29sb3I9ZnVsbCIpIHx8IGloKCJjb2xvcj10cnVlY29sb3IiKSkKICAgICAgICAgICAgcmV0dXJuIDM7CiAgICAgICAgICBpZiAoaWgoImNvbG9yPTI1NiIpKQogICAgICAgICAgICByZXR1cm4gMjsKICAgICAgICAgIGlmIChlMiAmJiAhdDIgJiYgc2ggPT09IHZvaWQgMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICBjb25zdCBuMiA9IHNoIHx8IDA7CiAgICAgICAgICBpZiAodWguVEVSTSA9PT0gImR1bWIiKQogICAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgICBpZiAodGEucGxhdGZvcm0gPT09ICJ3aW4zMiIpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSByaC5yZWxlYXNlKCkuc3BsaXQoIi4iKTsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcihlM1swXSkgPj0gMTAgJiYgTnVtYmVyKGUzWzJdKSA+PSAxMDU4NiA/IE51bWJlcihlM1syXSkgPj0gMTQ5MzEgPyAzIDogMiA6IDE7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIkNJIiBpbiB1aCkKICAgICAgICAgICAgcmV0dXJuIFsiVFJBVklTIiwgIkNJUkNMRUNJIiwgIkFQUFZFWU9SIiwgIkdJVExBQl9DSSIsICJHSVRIVUJfQUNUSU9OUyIsICJCVUlMREtJVEUiXS5zb21lKChlMykgPT4gZTMgaW4gdWgpIHx8IHVoLkNJX05BTUUgPT09ICJjb2Rlc2hpcCIgPyAxIDogbjI7CiAgICAgICAgICBpZiAoIlRFQU1DSVRZX1ZFUlNJT04iIGluIHVoKQogICAgICAgICAgICByZXR1cm4gL14oOVwuKDAqWzEtOV1cZCopXC58XGR7Mix9XC4pLy50ZXN0KHVoLlRFQU1DSVRZX1ZFUlNJT04pID8gMSA6IDA7CiAgICAgICAgICBpZiAodWguQ09MT1JURVJNID09PSAidHJ1ZWNvbG9yIikKICAgICAgICAgICAgcmV0dXJuIDM7CiAgICAgICAgICBpZiAoIlRFUk1fUFJPR1JBTSIgaW4gdWgpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSBwYXJzZUludCgodWguVEVSTV9QUk9HUkFNX1ZFUlNJT04gfHwgIiIpLnNwbGl0KCIuIilbMF0sIDEwKTsKICAgICAgICAgICAgc3dpdGNoICh1aC5URVJNX1BST0dSQU0pIHsKICAgICAgICAgICAgICBjYXNlICJpVGVybS5hcHAiOgogICAgICAgICAgICAgICAgcmV0dXJuIGUzID49IDMgPyAzIDogMjsKICAgICAgICAgICAgICBjYXNlICJBcHBsZV9UZXJtaW5hbCI6CiAgICAgICAgICAgICAgICByZXR1cm4gMjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIC8tMjU2KGNvbG9yKT8kL2kudGVzdCh1aC5URVJNKSA/IDIgOiAvXnNjcmVlbnxeeHRlcm18XnZ0MTAwfF52dDIyMHxecnh2dHxjb2xvcnxhbnNpfGN5Z3dpbnxsaW51eC9pLnRlc3QodWguVEVSTSkgfHwgIkNPTE9SVEVSTSIgaW4gdWggPyAxIDogbjI7CiAgICAgICAgfQogICAgICAgIGloKCJuby1jb2xvciIpIHx8IGloKCJuby1jb2xvcnMiKSB8fCBpaCgiY29sb3I9ZmFsc2UiKSB8fCBpaCgiY29sb3I9bmV2ZXIiKSA/IHNoID0gMCA6IChpaCgiY29sb3IiKSB8fCBpaCgiY29sb3JzIikgfHwgaWgoImNvbG9yPXRydWUiKSB8fCBpaCgiY29sb3I9YWx3YXlzIikpICYmIChzaCA9IDEpLCAiRk9SQ0VfQ09MT1IiIGluIHVoICYmIChzaCA9IHVoLkZPUkNFX0NPTE9SID09PSAidHJ1ZSIgPyAxIDogdWguRk9SQ0VfQ09MT1IgPT09ICJmYWxzZSIgPyAwIDogdWguRk9SQ0VfQ09MT1IubGVuZ3RoID09PSAwID8gMSA6IE1hdGgubWluKHBhcnNlSW50KHVoLkZPUkNFX0NPTE9SLCAxMCksIDMpKTsKICAgICAgICB2YXIgbGggPSB7IHN1cHBvcnRzQ29sb3I6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gYWgoY2goZTIsIGUyICYmIGUyLmlzVFRZKSk7CiAgICAgICAgfSwgc3Rkb3V0OiBhaChjaCh0cnVlLCBvaC5pc2F0dHkoMSkpKSwgc3RkZXJyOiBhaChjaCh0cnVlLCBvaC5pc2F0dHkoMikpKSB9OwogICAgICAgIHZhciBwaCA9IHsgc3RyaW5nUmVwbGFjZUFsbDogKGUyLCB0MiwgbjIpID0+IHsKICAgICAgICAgIGxldCByMiA9IGUyLmluZGV4T2YodDIpOwogICAgICAgICAgaWYgKHIyID09PSAtMSkKICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgY29uc3QgbzIgPSB0Mi5sZW5ndGg7CiAgICAgICAgICBsZXQgaTIgPSAwLCB1MiA9ICIiOwogICAgICAgICAgZG8gewogICAgICAgICAgICB1MiArPSBlMi5zdWJzdHIoaTIsIHIyIC0gaTIpICsgdDIgKyBuMiwgaTIgPSByMiArIG8yLCByMiA9IGUyLmluZGV4T2YodDIsIGkyKTsKICAgICAgICAgIH0gd2hpbGUgKHIyICE9PSAtMSk7CiAgICAgICAgICByZXR1cm4gdTIgKz0gZTIuc3Vic3RyKGkyKSwgdTI7CiAgICAgICAgfSwgc3RyaW5nRW5jYXNlQ1JMRldpdGhGaXJzdEluZGV4OiAoZTIsIHQyLCBuMiwgcjIpID0+IHsKICAgICAgICAgIGxldCBvMiA9IDAsIGkyID0gIiI7CiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIGNvbnN0IHUyID0gZTJbcjIgLSAxXSA9PT0gIlxyIjsKICAgICAgICAgICAgaTIgKz0gZTIuc3Vic3RyKG8yLCAodTIgPyByMiAtIDEgOiByMikgLSBvMikgKyB0MiArICh1MiA/ICJcclxuIiA6ICJcbiIpICsgbjIsIG8yID0gcjIgKyAxLCByMiA9IGUyLmluZGV4T2YoIlxuIiwgbzIpOwogICAgICAgICAgfSB3aGlsZSAocjIgIT09IC0xKTsKICAgICAgICAgIHJldHVybiBpMiArPSBlMi5zdWJzdHIobzIpLCBpMjsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgZmggPSAvKD86XFwodSg/OlthLWZcZF17NH18XHtbYS1mXGRdezEsNn1cfSl8eFthLWZcZF17Mn18LikpfCg/Olx7KH4pPyhcdysoPzpcKFteKV0qXCkpPyg/OlwuXHcrKD86XChbXildKlwpKT8pKikoPzpbIFx0XXwoPz1ccj9cbikpKXwoXH0pfCgoPzoufFtcclxuXGZdKSs/KS9naSwgZGggPSAvKD86XnxcLikoXHcrKSg/OlwoKFteKV0qKVwpKT8vZywgaGggPSAvXihbJyJdKSgoPzpcXC58KD8hXDEpW15cXF0pKilcMSQvLCBnaCA9IC9cXCh1KD86W2EtZlxkXXs0fXx7W2EtZlxkXXsxLDZ9fSl8eFthLWZcZF17Mn18Lil8KFteXFxdKS9naSwgbWggPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcChbWyJuIiwgIlxuIl0sIFsiciIsICJcciJdLCBbInQiLCAiCSJdLCBbImIiLCAiXGIiXSwgWyJmIiwgIlxmIl0sIFsidiIsICJcdiJdLCBbIjAiLCAiXDAiXSwgWyJcXCIsICJcXCJdLCBbImUiLCAiXHgxQiJdLCBbImEiLCAiXHgwNyJdXSk7CiAgICAgICAgZnVuY3Rpb24geWgoZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTJbMF0gPT09ICJ1IiwgbjIgPSBlMlsxXSA9PT0gInsiOwogICAgICAgICAgcmV0dXJuIHQyICYmICFuMiAmJiBlMi5sZW5ndGggPT09IDUgfHwgZTJbMF0gPT09ICJ4IiAmJiBlMi5sZW5ndGggPT09IDMgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhcnNlSW50KGUyLnNsaWNlKDEpLCAxNikpIDogdDIgJiYgbjIgPyBTdHJpbmcuZnJvbUNvZGVQb2ludChwYXJzZUludChlMi5zbGljZSgyLCAtMSksIDE2KSkgOiBtaC5nZXQoZTIpIHx8IGUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBEaChlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gW10sIHIyID0gdDIudHJpbSgpLnNwbGl0KC9ccyosXHMqL2cpOwogICAgICAgICAgbGV0IG8yOwogICAgICAgICAgZm9yIChjb25zdCB0MyBvZiByMikgewogICAgICAgICAgICBjb25zdCByMyA9IE51bWJlcih0Myk7CiAgICAgICAgICAgIGlmIChOdW1iZXIuaXNOYU4ocjMpKSB7CiAgICAgICAgICAgICAgaWYgKCEobzIgPSB0My5tYXRjaChoaCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIENoYWxrIHRlbXBsYXRlIHN0eWxlIGFyZ3VtZW50OiAiLmNvbmNhdCh0MywgIiAoaW4gc3R5bGUgJyIpLmNvbmNhdChlMiwgIicpIikpOwogICAgICAgICAgICAgIG4yLnB1c2gobzJbMl0ucmVwbGFjZShnaCwgKGUzLCB0NCwgbjMpID0+IHQ0ID8geWgodDQpIDogbjMpKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgbjIucHVzaChyMyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEVoKGUyKSB7CiAgICAgICAgICBkaC5sYXN0SW5kZXggPSAwOwogICAgICAgICAgY29uc3QgdDIgPSBbXTsKICAgICAgICAgIGxldCBuMjsKICAgICAgICAgIGZvciAoOyAobjIgPSBkaC5leGVjKGUyKSkgIT09IG51bGw7ICkgewogICAgICAgICAgICBjb25zdCBlMyA9IG4yWzFdOwogICAgICAgICAgICBpZiAobjJbMl0pIHsKICAgICAgICAgICAgICBjb25zdCByMiA9IERoKGUzLCBuMlsyXSk7CiAgICAgICAgICAgICAgdDIucHVzaChbZTNdLmNvbmNhdChyMikpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICB0Mi5wdXNoKFtlM10pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBDaChlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0ge307CiAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIHQyKQogICAgICAgICAgICBmb3IgKGNvbnN0IHQzIG9mIGUzLnN0eWxlcykKICAgICAgICAgICAgICBuMlt0M1swXV0gPSBlMy5pbnZlcnNlID8gbnVsbCA6IHQzLnNsaWNlKDEpOwogICAgICAgICAgbGV0IHIyID0gZTI7CiAgICAgICAgICBmb3IgKGNvbnN0IFtlMywgdDNdIG9mIE9iamVjdC5lbnRyaWVzKG4yKSkKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodDMpKSB7CiAgICAgICAgICAgICAgaWYgKCEoZTMgaW4gcjIpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIENoYWxrIHN0eWxlOiAiLmNvbmNhdChlMykpOwogICAgICAgICAgICAgIHIyID0gdDMubGVuZ3RoID4gMCA/IHIyW2UzXSguLi50MykgOiByMltlM107CiAgICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByMjsKICAgICAgICB9CiAgICAgICAgdmFyIGJoID0gKGUyLCB0MikgPT4gewogICAgICAgICAgY29uc3QgbjIgPSBbXSwgcjIgPSBbXTsKICAgICAgICAgIGxldCBvMiA9IFtdOwogICAgICAgICAgaWYgKHQyLnJlcGxhY2UoZmgsICh0MywgaTIsIHUyLCBzMiwgYTIsIGMyKSA9PiB7CiAgICAgICAgICAgIGlmIChpMikKICAgICAgICAgICAgICBvMi5wdXNoKHloKGkyKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHMyKSB7CiAgICAgICAgICAgICAgY29uc3QgdDQgPSBvMi5qb2luKCIiKTsKICAgICAgICAgICAgICBvMiA9IFtdLCByMi5wdXNoKG4yLmxlbmd0aCA9PT0gMCA/IHQ0IDogQ2goZTIsIG4yKSh0NCkpLCBuMi5wdXNoKHsgaW52ZXJzZTogdTIsIHN0eWxlczogRWgoczIpIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKGEyKSB7CiAgICAgICAgICAgICAgaWYgKG4yLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRm91bmQgZXh0cmFuZW91cyB9IGluIENoYWxrIHRlbXBsYXRlIGxpdGVyYWwiKTsKICAgICAgICAgICAgICByMi5wdXNoKENoKGUyLCBuMikobzIuam9pbigiIikpKSwgbzIgPSBbXSwgbjIucG9wKCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIG8yLnB1c2goYzIpOwogICAgICAgICAgfSksIHIyLnB1c2gobzIuam9pbigiIikpLCBuMi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gIkNoYWxrIHRlbXBsYXRlIGxpdGVyYWwgaXMgbWlzc2luZyAiLmNvbmNhdChuMi5sZW5ndGgsICIgY2xvc2luZyBicmFja2V0IikuY29uY2F0KG4yLmxlbmd0aCA9PT0gMSA/ICIiIDogInMiLCAiIChgfWApIik7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlMyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcjIuam9pbigiIik7CiAgICAgICAgfTsKICAgICAgICBjb25zdCB2aCA9IFZkLmV4cG9ydHMsIHsgc3Rkb3V0OiBBaCwgc3RkZXJyOiBGaCB9ID0gbGgsIHsgc3RyaW5nUmVwbGFjZUFsbDogeGgsIHN0cmluZ0VuY2FzZUNSTEZXaXRoRmlyc3RJbmRleDogU2ggfSA9IHBoLCB7IGlzQXJyYXk6IHdoIH0gPSBBcnJheSwgVGggPSBbImFuc2kiLCAiYW5zaSIsICJhbnNpMjU2IiwgImFuc2kxNm0iXSwgQmggPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICBjbGFzcyBOaCB7CiAgICAgICAgICBjb25zdHJ1Y3RvcihlMikgewogICAgICAgICAgICByZXR1cm4ga2goZTIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBraCA9IChlMikgPT4gewogICAgICAgICAgY29uc3QgdDIgPSB7fTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMykgewogICAgICAgICAgICBsZXQgdDMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICAgICAgICBpZiAodDMubGV2ZWwgJiYgIShOdW1iZXIuaXNJbnRlZ2VyKHQzLmxldmVsKSAmJiB0My5sZXZlbCA+PSAwICYmIHQzLmxldmVsIDw9IDMpKQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVGhlIGBsZXZlbGAgb3B0aW9uIHNob3VsZCBiZSBhbiBpbnRlZ2VyIGZyb20gMCB0byAzIik7CiAgICAgICAgICAgIGNvbnN0IG4yID0gQWggPyBBaC5sZXZlbCA6IDA7CiAgICAgICAgICAgIGUzLmxldmVsID0gdDMubGV2ZWwgPT09IHZvaWQgMCA/IG4yIDogdDMubGV2ZWw7CiAgICAgICAgICB9KHQyLCBlMiksIHQyLnRlbXBsYXRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZvciAodmFyIGUzID0gYXJndW1lbnRzLmxlbmd0aCwgbjIgPSBuZXcgQXJyYXkoZTMpLCByMiA9IDA7IHIyIDwgZTM7IHIyKyspCiAgICAgICAgICAgICAgbjJbcjJdID0gYXJndW1lbnRzW3IyXTsKICAgICAgICAgICAgcmV0dXJuIFJoKHQyLnRlbXBsYXRlLCAuLi5uMik7CiAgICAgICAgICB9LCBPYmplY3Quc2V0UHJvdG90eXBlT2YodDIsIFBoLnByb3RvdHlwZSksIE9iamVjdC5zZXRQcm90b3R5cGVPZih0Mi50ZW1wbGF0ZSwgdDIpLCB0Mi50ZW1wbGF0ZS5jb25zdHJ1Y3RvciA9ICgpID0+IHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJgY2hhbGsuY29uc3RydWN0b3IoKWAgaXMgZGVwcmVjYXRlZC4gVXNlIGBuZXcgY2hhbGsuSW5zdGFuY2UoKWAgaW5zdGVhZC4iKTsKICAgICAgICAgIH0sIHQyLnRlbXBsYXRlLkluc3RhbmNlID0gTmgsIHQyLnRlbXBsYXRlOwogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gUGgoZTIpIHsKICAgICAgICAgIHJldHVybiBraChlMik7CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3QgW2UyLCB0Ml0gb2YgT2JqZWN0LmVudHJpZXModmgpKQogICAgICAgICAgQmhbZTJdID0geyBnZXQoKSB7CiAgICAgICAgICAgIGNvbnN0IG4yID0gamgodGhpcywgTGgodDIub3BlbiwgdDIuY2xvc2UsIHRoaXMuX3N0eWxlciksIHRoaXMuX2lzRW1wdHkpOwogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIGUyLCB7IHZhbHVlOiBuMiB9KSwgbjI7CiAgICAgICAgICB9IH07CiAgICAgICAgQmgudmlzaWJsZSA9IHsgZ2V0KCkgewogICAgICAgICAgY29uc3QgZTIgPSBqaCh0aGlzLCB0aGlzLl9zdHlsZXIsIHRydWUpOwogICAgICAgICAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAidmlzaWJsZSIsIHsgdmFsdWU6IGUyIH0pLCBlMjsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgT2ggPSBbInJnYiIsICJoZXgiLCAia2V5d29yZCIsICJoc2wiLCAiaHN2IiwgImh3YiIsICJhbnNpIiwgImFuc2kyNTYiXTsKICAgICAgICBmb3IgKGNvbnN0IGUyIG9mIE9oKQogICAgICAgICAgQmhbZTJdID0geyBnZXQoKSB7CiAgICAgICAgICAgIGNvbnN0IHsgbGV2ZWw6IHQyIH0gPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgY29uc3QgbjIgPSBMaCh2aC5jb2xvcltUaFt0Ml1dW2UyXSguLi5hcmd1bWVudHMpLCB2aC5jb2xvci5jbG9zZSwgdGhpcy5fc3R5bGVyKTsKICAgICAgICAgICAgICByZXR1cm4gamgodGhpcywgbjIsIHRoaXMuX2lzRW1wdHkpOwogICAgICAgICAgICB9OwogICAgICAgICAgfSB9OwogICAgICAgIGZvciAoY29uc3QgZTIgb2YgT2gpIHsKICAgICAgICAgIEJoWyJiZyIgKyBlMlswXS50b1VwcGVyQ2FzZSgpICsgZTIuc2xpY2UoMSldID0geyBnZXQoKSB7CiAgICAgICAgICAgIGNvbnN0IHsgbGV2ZWw6IHQyIH0gPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgY29uc3QgbjIgPSBMaCh2aC5iZ0NvbG9yW1RoW3QyXV1bZTJdKC4uLmFyZ3VtZW50cyksIHZoLmJnQ29sb3IuY2xvc2UsIHRoaXMuX3N0eWxlcik7CiAgICAgICAgICAgICAgcmV0dXJuIGpoKHRoaXMsIG4yLCB0aGlzLl9pc0VtcHR5KTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gfTsKICAgICAgICB9CiAgICAgICAgY29uc3QgSWggPSBPYmplY3QuZGVmaW5lUHJvcGVydGllcygoKSA9PiB7CiAgICAgICAgfSwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBCaCksIHt9LCB7IGxldmVsOiB7IGVudW1lcmFibGU6IHRydWUsIGdldCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9nZW5lcmF0b3IubGV2ZWw7CiAgICAgICAgfSwgc2V0KGUyKSB7CiAgICAgICAgICB0aGlzLl9nZW5lcmF0b3IubGV2ZWwgPSBlMjsKICAgICAgICB9IH0gfSkpLCBMaCA9IChlMiwgdDIsIG4yKSA9PiB7CiAgICAgICAgICBsZXQgcjIsIG8yOwogICAgICAgICAgcmV0dXJuIG4yID09PSB2b2lkIDAgPyAocjIgPSBlMiwgbzIgPSB0MikgOiAocjIgPSBuMi5vcGVuQWxsICsgZTIsIG8yID0gdDIgKyBuMi5jbG9zZUFsbCksIHsgb3BlbjogZTIsIGNsb3NlOiB0Miwgb3BlbkFsbDogcjIsIGNsb3NlQWxsOiBvMiwgcGFyZW50OiBuMiB9OwogICAgICAgIH0sIGpoID0gKGUyLCB0MiwgbjIpID0+IHsKICAgICAgICAgIGNvbnN0IHIyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZvciAodmFyIGUzID0gYXJndW1lbnRzLmxlbmd0aCwgdDMgPSBuZXcgQXJyYXkoZTMpLCBuMyA9IDA7IG4zIDwgZTM7IG4zKyspCiAgICAgICAgICAgICAgdDNbbjNdID0gYXJndW1lbnRzW24zXTsKICAgICAgICAgICAgcmV0dXJuIHdoKHQzWzBdKSAmJiB3aCh0M1swXS5yYXcpID8gX2gocjIsIFJoKHIyLCAuLi50MykpIDogX2gocjIsIHQzLmxlbmd0aCA9PT0gMSA/ICIiICsgdDNbMF0gOiB0My5qb2luKCIgIikpOwogICAgICAgICAgfTsKICAgICAgICAgIHJldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2YocjIsIEloKSwgcjIuX2dlbmVyYXRvciA9IGUyLCByMi5fc3R5bGVyID0gdDIsIHIyLl9pc0VtcHR5ID0gbjIsIHIyOwogICAgICAgIH0sIF9oID0gKGUyLCB0MikgPT4gewogICAgICAgICAgaWYgKGUyLmxldmVsIDw9IDAgfHwgIXQyKQogICAgICAgICAgICByZXR1cm4gZTIuX2lzRW1wdHkgPyAiIiA6IHQyOwogICAgICAgICAgbGV0IG4yID0gZTIuX3N0eWxlcjsKICAgICAgICAgIGlmIChuMiA9PT0gdm9pZCAwKQogICAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgICBjb25zdCB7IG9wZW5BbGw6IHIyLCBjbG9zZUFsbDogbzIgfSA9IG4yOwogICAgICAgICAgaWYgKHQyLmluZGV4T2YoIlx4MUIiKSAhPT0gLTEpCiAgICAgICAgICAgIGZvciAoOyBuMiAhPT0gdm9pZCAwOyApCiAgICAgICAgICAgICAgdDIgPSB4aCh0MiwgbjIuY2xvc2UsIG4yLm9wZW4pLCBuMiA9IG4yLnBhcmVudDsKICAgICAgICAgIGNvbnN0IGkyID0gdDIuaW5kZXhPZigiXG4iKTsKICAgICAgICAgIHJldHVybiBpMiAhPT0gLTEgJiYgKHQyID0gU2godDIsIG8yLCByMiwgaTIpKSwgcjIgKyB0MiArIG8yOwogICAgICAgIH07CiAgICAgICAgbGV0IE1oOwogICAgICAgIGNvbnN0IFJoID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGZvciAodmFyIHQyID0gYXJndW1lbnRzLmxlbmd0aCwgbjIgPSBuZXcgQXJyYXkodDIgPiAxID8gdDIgLSAxIDogMCksIHIyID0gMTsgcjIgPCB0MjsgcjIrKykKICAgICAgICAgICAgbjJbcjIgLSAxXSA9IGFyZ3VtZW50c1tyMl07CiAgICAgICAgICBjb25zdCBbbzJdID0gbjI7CiAgICAgICAgICBpZiAoIXdoKG8yKSB8fCAhd2gobzIucmF3KSkKICAgICAgICAgICAgcmV0dXJuIG4yLmpvaW4oIiAiKTsKICAgICAgICAgIGNvbnN0IGkyID0gbjIuc2xpY2UoMSksIHUyID0gW28yLnJhd1swXV07CiAgICAgICAgICBmb3IgKGxldCBlMyA9IDE7IGUzIDwgbzIubGVuZ3RoOyBlMysrKQogICAgICAgICAgICB1Mi5wdXNoKFN0cmluZyhpMltlMyAtIDFdKS5yZXBsYWNlKC9be31cXF0vZywgIlxcJCYiKSwgU3RyaW5nKG8yLnJhd1tlM10pKTsKICAgICAgICAgIHJldHVybiBNaCA9PT0gdm9pZCAwICYmIChNaCA9IGJoKSwgTWgoZTIsIHUyLmpvaW4oIiIpKTsKICAgICAgICB9OwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKFBoLnByb3RvdHlwZSwgQmgpOwogICAgICAgIGNvbnN0IFZoID0gUGgoKTsKICAgICAgICBWaC5zdXBwb3J0c0NvbG9yID0gQWgsIFZoLnN0ZGVyciA9IFBoKHsgbGV2ZWw6IEZoID8gRmgubGV2ZWwgOiAwIH0pLCBWaC5zdGRlcnIuc3VwcG9ydHNDb2xvciA9IEZoOwogICAgICAgIHZhciAkaCA9IFZoOwogICAgICAgIGNvbnN0IFdoID0gWyJfIl0sIHFoID0gYnAsIFVoID0gamQuZXhwb3J0cywgemggPSAkaCwgR2ggPSBhdSwgSGggPSB7IGtleTogKGUyKSA9PiBlMi5sZW5ndGggPT09IDEgPyAiLSIuY29uY2F0KGUyKSA6ICItLSIuY29uY2F0KGUyKSwgdmFsdWU6IChlMikgPT4gcWguYXBpRGVzY3JpcHRvci52YWx1ZShlMiksIHBhaXI6IChlMikgPT4gewogICAgICAgICAgbGV0IHsga2V5OiB0MiwgdmFsdWU6IG4yIH0gPSBlMjsKICAgICAgICAgIHJldHVybiBuMiA9PT0gZmFsc2UgPyAiLS1uby0iLmNvbmNhdCh0MikgOiBuMiA9PT0gdHJ1ZSA/IEhoLmtleSh0MikgOiBuMiA9PT0gIiIgPyAiIi5jb25jYXQoSGgua2V5KHQyKSwgIiB3aXRob3V0IGFuIGFyZ3VtZW50IikgOiAiIi5jb25jYXQoSGgua2V5KHQyKSwgIj0iKS5jb25jYXQobjIpOwogICAgICAgIH0gfTsKICAgICAgICBjbGFzcyBKaCBleHRlbmRzIHFoLkNob2ljZVNjaGVtYSB7CiAgICAgICAgICBjb25zdHJ1Y3RvcihlMikgewogICAgICAgICAgICBsZXQgeyBuYW1lOiB0MiwgZmxhZ3M6IG4yIH0gPSBlMjsKICAgICAgICAgICAgc3VwZXIoeyBuYW1lOiB0MiwgY2hvaWNlczogbjIgfSksIHRoaXMuX2ZsYWdzID0gWy4uLm4yXS5zb3J0KCk7CiAgICAgICAgICB9CiAgICAgICAgICBwcmVwcm9jZXNzKGUyLCB0MikgewogICAgICAgICAgICBpZiAodHlwZW9mIGUyID09ICJzdHJpbmciICYmIGUyLmxlbmd0aCA+IDAgJiYgIXRoaXMuX2ZsYWdzLmluY2x1ZGVzKGUyKSkgewogICAgICAgICAgICAgIGNvbnN0IG4yID0gdGhpcy5fZmxhZ3MuZmluZCgodDMpID0+IFVoKHQzLCBlMikgPCAzKTsKICAgICAgICAgICAgICBpZiAobjIpCiAgICAgICAgICAgICAgICByZXR1cm4gdDIubG9nZ2VyLndhcm4oWyJVbmtub3duIGZsYWcgIi5jb25jYXQoemgueWVsbG93KHQyLmRlc2NyaXB0b3IudmFsdWUoZTIpKSwgIiwiKSwgImRpZCB5b3UgbWVhbiAiLmNvbmNhdCh6aC5ibHVlKHQyLmRlc2NyaXB0b3IudmFsdWUobjIpKSwgIj8iKV0uam9pbigiICIpKSwgbjI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgfQogICAgICAgICAgZXhwZWN0ZWQoKSB7CiAgICAgICAgICAgIHJldHVybiAiYSBmbGFnIjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGV0IFhoOwogICAgICAgIGZ1bmN0aW9uIFloKGUyLCB0MikgewogICAgICAgICAgbGV0IHsgbG9nZ2VyOiBuMiwgaXNDTEk6IHIyID0gZmFsc2UsIHBhc3NUaHJvdWdoOiBvMiA9IGZhbHNlIH0gPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICAgICAgY29uc3QgaTIgPSBvMiA/IEFycmF5LmlzQXJyYXkobzIpID8gKGUzLCB0MykgPT4gbzIuaW5jbHVkZXMoZTMpID8geyBbZTNdOiB0MyB9IDogdm9pZCAwIDogKGUzLCB0MykgPT4gKHsgW2UzXTogdDMgfSkgOiAoZTMsIHQzLCBuMykgPT4gewogICAgICAgICAgICBjb25zdCByMyA9IGN1KG4zLnNjaGVtYXMsIFdoKTsKICAgICAgICAgICAgcmV0dXJuIHFoLmxldmVuVW5rbm93bkhhbmRsZXIoZTMsIHQzLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG4zKSwge30sIHsgc2NoZW1hczogcjMgfSkpOwogICAgICAgICAgfSwgdTIgPSByMiA/IEhoIDogcWguYXBpRGVzY3JpcHRvciwgczIgPSBLaCh0MiwgeyBpc0NMSTogcjIgfSksIGEyID0gbmV3IHFoLk5vcm1hbGl6ZXIoczIsIHsgbG9nZ2VyOiBuMiwgdW5rbm93bjogaTIsIGRlc2NyaXB0b3I6IHUyIH0pLCBjMiA9IG4yICE9PSBmYWxzZTsKICAgICAgICAgIGMyICYmIFhoICYmIChhMi5faGFzRGVwcmVjYXRpb25XYXJuZWQgPSBYaCk7CiAgICAgICAgICBjb25zdCBsMiA9IGEyLm5vcm1hbGl6ZShlMik7CiAgICAgICAgICByZXR1cm4gYzIgJiYgKFhoID0gYTIuX2hhc0RlcHJlY2F0aW9uV2FybmVkKSwgbDI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEtoKGUyLCB0MikgewogICAgICAgICAgbGV0IHsgaXNDTEk6IG4yIH0gPSB0MjsKICAgICAgICAgIGNvbnN0IHIyID0gW107CiAgICAgICAgICBuMiAmJiByMi5wdXNoKHFoLkFueVNjaGVtYS5jcmVhdGUoeyBuYW1lOiAiXyIgfSkpOwogICAgICAgICAgZm9yIChjb25zdCB0MyBvZiBlMikKICAgICAgICAgICAgcjIucHVzaChRaCh0MywgeyBpc0NMSTogbjIsIG9wdGlvbkluZm9zOiBlMiB9KSksIHQzLmFsaWFzICYmIG4yICYmIHIyLnB1c2gocWguQWxpYXNTY2hlbWEuY3JlYXRlKHsgbmFtZTogdDMuYWxpYXMsIHNvdXJjZU5hbWU6IHQzLm5hbWUgfSkpOwogICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBRaChlMiwgdDIpIHsKICAgICAgICAgIGxldCBuMiwgeyBpc0NMSTogcjIsIG9wdGlvbkluZm9zOiBvMiB9ID0gdDI7CiAgICAgICAgICBjb25zdCBpMiA9IHsgbmFtZTogZTIubmFtZSB9LCB1MiA9IHt9OwogICAgICAgICAgc3dpdGNoIChlMi50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgImludCI6CiAgICAgICAgICAgICAgbjIgPSBxaC5JbnRlZ2VyU2NoZW1hLCByMiAmJiAoaTIucHJlcHJvY2VzcyA9IChlMykgPT4gTnVtYmVyKGUzKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInN0cmluZyI6CiAgICAgICAgICAgIGNhc2UgInBhdGgiOgogICAgICAgICAgICAgIG4yID0gcWguU3RyaW5nU2NoZW1hOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJjaG9pY2UiOgogICAgICAgICAgICAgIG4yID0gcWguQ2hvaWNlU2NoZW1hLCBpMi5jaG9pY2VzID0gZTIuY2hvaWNlcy5tYXAoKHQzKSA9PiB0eXBlb2YgdDMgPT0gIm9iamVjdCIgJiYgdDMucmVkaXJlY3QgPyBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHQzKSwge30sIHsgcmVkaXJlY3Q6IHsgdG86IHsga2V5OiBlMi5uYW1lLCB2YWx1ZTogdDMucmVkaXJlY3QgfSB9IH0pIDogdDMpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJib29sZWFuIjoKICAgICAgICAgICAgICBuMiA9IHFoLkJvb2xlYW5TY2hlbWE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImZsYWciOgogICAgICAgICAgICAgIG4yID0gSmgsIGkyLmZsYWdzID0gbzIuZmxhdE1hcCgoZTMpID0+IFtlMy5hbGlhcywgZTMuZGVzY3JpcHRpb24gJiYgZTMubmFtZSwgZTMub3Bwb3NpdGVEZXNjcmlwdGlvbiAmJiAibm8tIi5jb25jYXQoZTMubmFtZSldLmZpbHRlcihCb29sZWFuKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkIHR5cGUgIi5jb25jYXQoZTIudHlwZSkpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGUyLmV4Y2VwdGlvbiA/IGkyLnZhbGlkYXRlID0gKHQzLCBuMywgcjMpID0+IGUyLmV4Y2VwdGlvbih0MykgfHwgbjMudmFsaWRhdGUodDMsIHIzKSA6IGkyLnZhbGlkYXRlID0gKGUzLCB0MywgbjMpID0+IGUzID09PSB2b2lkIDAgfHwgdDMudmFsaWRhdGUoZTMsIG4zKSwgZTIucmVkaXJlY3QgJiYgKHUyLnJlZGlyZWN0ID0gKHQzKSA9PiB0MyA/IHsgdG86IHsga2V5OiBlMi5yZWRpcmVjdC5vcHRpb24sIHZhbHVlOiBlMi5yZWRpcmVjdC52YWx1ZSB9IH0gOiB2b2lkIDApLCBlMi5kZXByZWNhdGVkICYmICh1Mi5kZXByZWNhdGVkID0gdHJ1ZSksIHIyICYmICFlMi5hcnJheSkgewogICAgICAgICAgICBjb25zdCBlMyA9IGkyLnByZXByb2Nlc3MgfHwgKChlNCkgPT4gZTQpOwogICAgICAgICAgICBpMi5wcmVwcm9jZXNzID0gKHQzLCBuMywgcjMpID0+IG4zLnByZXByb2Nlc3MoZTMoQXJyYXkuaXNBcnJheSh0MykgPyBHaCh0MykgOiB0MyksIHIzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlMi5hcnJheSA/IHFoLkFycmF5U2NoZW1hLmNyZWF0ZShPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcjIgPyB7IHByZXByb2Nlc3M6IChlMykgPT4gQXJyYXkuaXNBcnJheShlMykgPyBlMyA6IFtlM10gfSA6IHt9KSwgdTIpLCB7fSwgeyB2YWx1ZVNjaGVtYTogbjIuY3JlYXRlKGkyKSB9KSkgOiBuMi5jcmVhdGUoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBpMiksIHUyKSk7CiAgICAgICAgfQogICAgICAgIHZhciBaaCA9IHsgbm9ybWFsaXplQXBpT3B0aW9uczogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIFloKGUyLCB0MiwgbjIpOwogICAgICAgIH0sIG5vcm1hbGl6ZUNsaU9wdGlvbnM6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBZaChlMiwgdDIsIE9iamVjdC5hc3NpZ24oeyBpc0NMSTogdHJ1ZSB9LCBuMikpOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IGlzTm9uRW1wdHlBcnJheTogZWcgfSA9IGRjOwogICAgICAgIGZ1bmN0aW9uIHRnKGUyLCB0MikgewogICAgICAgICAgY29uc3QgeyBpZ25vcmVEZWNvcmF0b3JzOiBuMiB9ID0gdDIgfHwge307CiAgICAgICAgICBpZiAoIW4yKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gZTIuZGVjbGFyYXRpb24gJiYgZTIuZGVjbGFyYXRpb24uZGVjb3JhdG9ycyB8fCBlMi5kZWNvcmF0b3JzOwogICAgICAgICAgICBpZiAoZWcodDMpKQogICAgICAgICAgICAgIHJldHVybiB0Zyh0M1swXSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZTIucmFuZ2UgPyBlMi5yYW5nZVswXSA6IGUyLnN0YXJ0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBuZyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLnJhbmdlID8gZTIucmFuZ2VbMV0gOiBlMi5lbmQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJnKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHRnKGUyKSA9PT0gdGcodDIpOwogICAgICAgIH0KICAgICAgICB2YXIgb2cgPSB7IGxvY1N0YXJ0OiB0ZywgbG9jRW5kOiBuZywgaGFzU2FtZUxvY1N0YXJ0OiByZywgaGFzU2FtZUxvYzogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gcmcoZTIsIHQyKSAmJiBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgcmV0dXJuIG5nKGUzKSA9PT0gbmcodDMpOwogICAgICAgICAgfShlMiwgdDIpOwogICAgICAgIH0gfSwgaWcgPSB7fSwgdWcgPSB7fSwgc2cgPSB7fTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2csICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KSwgc2cuZGVmYXVsdCA9IC8oKFsnIl0pKD86KD8hXDJ8XFwpLnxcXCg/OlxyXG58W1xzXFNdKSkqKFwyKT98YCg/OlteYFxcJF18XFxbXHNcU118XCQoPyFceyl8XCRceyg/Oltee31dfFx7W159XSpcfT8pKlx9PykqKGApPyl8KFwvXC8uKil8KFwvXCooPzpbXipdfFwqKD8hXC8pKSooXCpcLyk/KXwoXC8oPyFcKikoPzpcWyg/Oig/IVtcXVxcXSkufFxcLikqXF18KD8hW1wvXF1cXF0pLnxcXC4pK1wvKD86KD8hXHMqKD86XGJ8W1x1MDA4MC1cdUZGRkYkXFwnIn4oe118WytcLSFdKD8hPSl8XC4/XGQpKXxbZ21peXVzXXsxLDZ9XGIoPyFbXHUwMDgwLVx1RkZGRiRcXF18XHMqKD86WytcLSolJnxePD4hPT8oe118XC8oPyFbXC8qXSkpKSkpfCgwW3hYXVtcZGEtZkEtRl0rfDBbb09dWzAtN10rfDBbYkJdWzAxXSt8KD86XGQqXC5cZCt8XGQrXC4/KSg/OltlRV1bKy1dP1xkKyk/KXwoKD8hXGQpKD86KD8hXHMpWyRcd1x1MDA4MC1cdUZGRkZdfFxcdVtcZGEtZkEtRl17NH18XFx1XHtbXGRhLWZBLUZdK1x9KSspfCgtLXxcK1wrfCYmfFx8XHx8PT58XC57M318KD86WytcLVwvJSZ8Xl18XCp7MSwyfXw8ezEsMn18PnsxLDN9fCE9P3w9ezEsMn0pPT98Wz9+Liw6O1tcXSgpe31dKXwoXHMrKXwoXiR8W1xzXFNdKS9nLCBzZy5tYXRjaFRvVG9rZW4gPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0geyB0eXBlOiAiaW52YWxpZCIsIHZhbHVlOiBlMlswXSwgY2xvc2VkOiB2b2lkIDAgfTsKICAgICAgICAgIHJldHVybiBlMlsxXSA/ICh0Mi50eXBlID0gInN0cmluZyIsIHQyLmNsb3NlZCA9ICEoIWUyWzNdICYmICFlMls0XSkpIDogZTJbNV0gPyB0Mi50eXBlID0gImNvbW1lbnQiIDogZTJbNl0gPyAodDIudHlwZSA9ICJjb21tZW50IiwgdDIuY2xvc2VkID0gISFlMls3XSkgOiBlMls4XSA/IHQyLnR5cGUgPSAicmVnZXgiIDogZTJbOV0gPyB0Mi50eXBlID0gIm51bWJlciIgOiBlMlsxMF0gPyB0Mi50eXBlID0gIm5hbWUiIDogZTJbMTFdID8gdDIudHlwZSA9ICJwdW5jdHVhdG9yIiA6IGUyWzEyXSAmJiAodDIudHlwZSA9ICJ3aGl0ZXNwYWNlIiksIHQyOwogICAgICAgIH07CiAgICAgICAgdmFyIGFnID0ge30sIGNnID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNnLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIGNnLmlzSWRlbnRpZmllclN0YXJ0ID0geWcsIGNnLmlzSWRlbnRpZmllckNoYXIgPSBEZywgY2cuaXNJZGVudGlmaWVyTmFtZSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSB0cnVlOwogICAgICAgICAgZm9yIChsZXQgbjIgPSAwOyBuMiA8IGUyLmxlbmd0aDsgbjIrKykgewogICAgICAgICAgICBsZXQgcjIgPSBlMi5jaGFyQ29kZUF0KG4yKTsKICAgICAgICAgICAgaWYgKCg2NDUxMiAmIHIyKSA9PSA1NTI5NiAmJiBuMiArIDEgPCBlMi5sZW5ndGgpIHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IGUyLmNoYXJDb2RlQXQoKytuMik7CiAgICAgICAgICAgICAgKDY0NTEyICYgdDMpID09IDU2MzIwICYmIChyMiA9IDY1NTM2ICsgKCgxMDIzICYgcjIpIDw8IDEwKSArICgxMDIzICYgdDMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodDIpIHsKICAgICAgICAgICAgICBpZiAodDIgPSBmYWxzZSwgIXlnKHIyKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIGlmICghRGcocjIpKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAhdDI7CiAgICAgICAgfTsKICAgICAgICBsZXQgbGcgPSAiXHhBQVx4QjVceEJBXHhDMC1ceEQ2XHhEOC1ceEY2XHhGOC1cdTAyQzFcdTAyQzYtXHUwMkQxXHUwMkUwLVx1MDJFNFx1MDJFQ1x1MDJFRVx1MDM3MC1cdTAzNzRcdTAzNzZcdTAzNzdcdTAzN0EtXHUwMzdEXHUwMzdGXHUwMzg2XHUwMzg4LVx1MDM4QVx1MDM4Q1x1MDM4RS1cdTAzQTFcdTAzQTMtXHUwM0Y1XHUwM0Y3LVx1MDQ4MVx1MDQ4QS1cdTA1MkZcdTA1MzEtXHUwNTU2XHUwNTU5XHUwNTYwLVx1MDU4OFx1MDVEMC1cdTA1RUFcdTA1RUYtXHUwNUYyXHUwNjIwLVx1MDY0QVx1MDY2RVx1MDY2Rlx1MDY3MS1cdTA2RDNcdTA2RDVcdTA2RTVcdTA2RTZcdTA2RUVcdTA2RUZcdTA2RkEtXHUwNkZDXHUwNkZGXHUwNzEwXHUwNzEyLVx1MDcyRlx1MDc0RC1cdTA3QTVcdTA3QjFcdTA3Q0EtXHUwN0VBXHUwN0Y0XHUwN0Y1XHUwN0ZBXHUwODAwLVx1MDgxNVx1MDgxQVx1MDgyNFx1MDgyOFx1MDg0MC1cdTA4NThcdTA4NjAtXHUwODZBXHUwODcwLVx1MDg4N1x1MDg4OS1cdTA4OEVcdTA4QTAtXHUwOEM5XHUwOTA0LVx1MDkzOVx1MDkzRFx1MDk1MFx1MDk1OC1cdTA5NjFcdTA5NzEtXHUwOTgwXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCRFx1MDlDRVx1MDlEQ1x1MDlERFx1MDlERi1cdTA5RTFcdTA5RjBcdTA5RjFcdTA5RkNcdTBBMDUtXHUwQTBBXHUwQTBGXHUwQTEwXHUwQTEzLVx1MEEyOFx1MEEyQS1cdTBBMzBcdTBBMzJcdTBBMzNcdTBBMzVcdTBBMzZcdTBBMzhcdTBBMzlcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTcyLVx1MEE3NFx1MEE4NS1cdTBBOERcdTBBOEYtXHUwQTkxXHUwQTkzLVx1MEFBOFx1MEFBQS1cdTBBQjBcdTBBQjJcdTBBQjNcdTBBQjUtXHUwQUI5XHUwQUJEXHUwQUQwXHUwQUUwXHUwQUUxXHUwQUY5XHUwQjA1LVx1MEIwQ1x1MEIwRlx1MEIxMFx1MEIxMy1cdTBCMjhcdTBCMkEtXHUwQjMwXHUwQjMyXHUwQjMzXHUwQjM1LVx1MEIzOVx1MEIzRFx1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjFcdTBCNzFcdTBCODNcdTBCODUtXHUwQjhBXHUwQjhFLVx1MEI5MFx1MEI5Mi1cdTBCOTVcdTBCOTlcdTBCOUFcdTBCOUNcdTBCOUVcdTBCOUZcdTBCQTNcdTBCQTRcdTBCQTgtXHUwQkFBXHUwQkFFLVx1MEJCOVx1MEJEMFx1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0RcdTBDNTgtXHUwQzVBXHUwQzVEXHUwQzYwXHUwQzYxXHUwQzgwXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkRcdTBDRERcdTBDREVcdTBDRTBcdTBDRTFcdTBDRjFcdTBDRjJcdTBEMDQtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0RcdTBENEVcdTBENTQtXHUwRDU2XHUwRDVGLVx1MEQ2MVx1MEQ3QS1cdTBEN0ZcdTBEODUtXHUwRDk2XHUwRDlBLVx1MERCMVx1MERCMy1cdTBEQkJcdTBEQkRcdTBEQzAtXHUwREM2XHUwRTAxLVx1MEUzMFx1MEUzMlx1MEUzM1x1MEU0MC1cdTBFNDZcdTBFODFcdTBFODJcdTBFODRcdTBFODYtXHUwRThBXHUwRThDLVx1MEVBM1x1MEVBNVx1MEVBNy1cdTBFQjBcdTBFQjJcdTBFQjNcdTBFQkRcdTBFQzAtXHUwRUM0XHUwRUM2XHUwRURDLVx1MEVERlx1MEYwMFx1MEY0MC1cdTBGNDdcdTBGNDktXHUwRjZDXHUwRjg4LVx1MEY4Q1x1MTAwMC1cdTEwMkFcdTEwM0ZcdTEwNTAtXHUxMDU1XHUxMDVBLVx1MTA1RFx1MTA2MVx1MTA2NVx1MTA2Nlx1MTA2RS1cdTEwNzBcdTEwNzUtXHUxMDgxXHUxMDhFXHUxMEEwLVx1MTBDNVx1MTBDN1x1MTBDRFx1MTBEMC1cdTEwRkFcdTEwRkMtXHUxMjQ4XHUxMjRBLVx1MTI0RFx1MTI1MC1cdTEyNTZcdTEyNThcdTEyNUEtXHUxMjVEXHUxMjYwLVx1MTI4OFx1MTI4QS1cdTEyOERcdTEyOTAtXHUxMkIwXHUxMkIyLVx1MTJCNVx1MTJCOC1cdTEyQkVcdTEyQzBcdTEyQzItXHUxMkM1XHUxMkM4LVx1MTJENlx1MTJEOC1cdTEzMTBcdTEzMTItXHUxMzE1XHUxMzE4LVx1MTM1QVx1MTM4MC1cdTEzOEZcdTEzQTAtXHUxM0Y1XHUxM0Y4LVx1MTNGRFx1MTQwMS1cdTE2NkNcdTE2NkYtXHUxNjdGXHUxNjgxLVx1MTY5QVx1MTZBMC1cdTE2RUFcdTE2RUUtXHUxNkY4XHUxNzAwLVx1MTcxMVx1MTcxRi1cdTE3MzFcdTE3NDAtXHUxNzUxXHUxNzYwLVx1MTc2Q1x1MTc2RS1cdTE3NzBcdTE3ODAtXHUxN0IzXHUxN0Q3XHUxN0RDXHUxODIwLVx1MTg3OFx1MTg4MC1cdTE4QThcdTE4QUFcdTE4QjAtXHUxOEY1XHUxOTAwLVx1MTkxRVx1MTk1MC1cdTE5NkRcdTE5NzAtXHUxOTc0XHUxOTgwLVx1MTlBQlx1MTlCMC1cdTE5QzlcdTFBMDAtXHUxQTE2XHUxQTIwLVx1MUE1NFx1MUFBN1x1MUIwNS1cdTFCMzNcdTFCNDUtXHUxQjRDXHUxQjgzLVx1MUJBMFx1MUJBRVx1MUJBRlx1MUJCQS1cdTFCRTVcdTFDMDAtXHUxQzIzXHUxQzRELVx1MUM0Rlx1MUM1QS1cdTFDN0RcdTFDODAtXHUxQzg4XHUxQzkwLVx1MUNCQVx1MUNCRC1cdTFDQkZcdTFDRTktXHUxQ0VDXHUxQ0VFLVx1MUNGM1x1MUNGNVx1MUNGNlx1MUNGQVx1MUQwMC1cdTFEQkZcdTFFMDAtXHUxRjE1XHUxRjE4LVx1MUYxRFx1MUYyMC1cdTFGNDVcdTFGNDgtXHUxRjREXHUxRjUwLVx1MUY1N1x1MUY1OVx1MUY1Qlx1MUY1RFx1MUY1Ri1cdTFGN0RcdTFGODAtXHUxRkI0XHUxRkI2LVx1MUZCQ1x1MUZCRVx1MUZDMi1cdTFGQzRcdTFGQzYtXHUxRkNDXHUxRkQwLVx1MUZEM1x1MUZENi1cdTFGREJcdTFGRTAtXHUxRkVDXHUxRkYyLVx1MUZGNFx1MUZGNi1cdTFGRkNcdTIwNzFcdTIwN0ZcdTIwOTAtXHUyMDlDXHUyMTAyXHUyMTA3XHUyMTBBLVx1MjExM1x1MjExNVx1MjExOC1cdTIxMURcdTIxMjRcdTIxMjZcdTIxMjhcdTIxMkEtXHUyMTM5XHUyMTNDLVx1MjEzRlx1MjE0NS1cdTIxNDlcdTIxNEVcdTIxNjAtXHUyMTg4XHUyQzAwLVx1MkNFNFx1MkNFQi1cdTJDRUVcdTJDRjJcdTJDRjNcdTJEMDAtXHUyRDI1XHUyRDI3XHUyRDJEXHUyRDMwLVx1MkQ2N1x1MkQ2Rlx1MkQ4MC1cdTJEOTZcdTJEQTAtXHUyREE2XHUyREE4LVx1MkRBRVx1MkRCMC1cdTJEQjZcdTJEQjgtXHUyREJFXHUyREMwLVx1MkRDNlx1MkRDOC1cdTJEQ0VcdTJERDAtXHUyREQ2XHUyREQ4LVx1MkRERVx1MzAwNS1cdTMwMDdcdTMwMjEtXHUzMDI5XHUzMDMxLVx1MzAzNVx1MzAzOC1cdTMwM0NcdTMwNDEtXHUzMDk2XHUzMDlCLVx1MzA5Rlx1MzBBMS1cdTMwRkFcdTMwRkMtXHUzMEZGXHUzMTA1LVx1MzEyRlx1MzEzMS1cdTMxOEVcdTMxQTAtXHUzMUJGXHUzMUYwLVx1MzFGRlx1MzQwMC1cdTREQkZcdTRFMDAtXHVBNDhDXHVBNEQwLVx1QTRGRFx1QTUwMC1cdUE2MENcdUE2MTAtXHVBNjFGXHVBNjJBXHVBNjJCXHVBNjQwLVx1QTY2RVx1QTY3Ri1cdUE2OURcdUE2QTAtXHVBNkVGXHVBNzE3LVx1QTcxRlx1QTcyMi1cdUE3ODhcdUE3OEItXHVBN0NBXHVBN0QwXHVBN0QxXHVBN0QzXHVBN0Q1LVx1QTdEOVx1QTdGMi1cdUE4MDFcdUE4MDMtXHVBODA1XHVBODA3LVx1QTgwQVx1QTgwQy1cdUE4MjJcdUE4NDAtXHVBODczXHVBODgyLVx1QThCM1x1QThGMi1cdUE4RjdcdUE4RkJcdUE4RkRcdUE4RkVcdUE5MEEtXHVBOTI1XHVBOTMwLVx1QTk0Nlx1QTk2MC1cdUE5N0NcdUE5ODQtXHVBOUIyXHVBOUNGXHVBOUUwLVx1QTlFNFx1QTlFNi1cdUE5RUZcdUE5RkEtXHVBOUZFXHVBQTAwLVx1QUEyOFx1QUE0MC1cdUFBNDJcdUFBNDQtXHVBQTRCXHVBQTYwLVx1QUE3Nlx1QUE3QVx1QUE3RS1cdUFBQUZcdUFBQjFcdUFBQjVcdUFBQjZcdUFBQjktXHVBQUJEXHVBQUMwXHVBQUMyXHVBQURCLVx1QUFERFx1QUFFMC1cdUFBRUFcdUFBRjItXHVBQUY0XHVBQjAxLVx1QUIwNlx1QUIwOS1cdUFCMEVcdUFCMTEtXHVBQjE2XHVBQjIwLVx1QUIyNlx1QUIyOC1cdUFCMkVcdUFCMzAtXHVBQjVBXHVBQjVDLVx1QUI2OVx1QUI3MC1cdUFCRTJcdUFDMDAtXHVEN0EzXHVEN0IwLVx1RDdDNlx1RDdDQi1cdUQ3RkJcdUY5MDAtXHVGQTZEXHVGQTcwLVx1RkFEOVx1RkIwMC1cdUZCMDZcdUZCMTMtXHVGQjE3XHVGQjFEXHVGQjFGLVx1RkIyOFx1RkIyQS1cdUZCMzZcdUZCMzgtXHVGQjNDXHVGQjNFXHVGQjQwXHVGQjQxXHVGQjQzXHVGQjQ0XHVGQjQ2LVx1RkJCMVx1RkJEMy1cdUZEM0RcdUZENTAtXHVGRDhGXHVGRDkyLVx1RkRDN1x1RkRGMC1cdUZERkJcdUZFNzAtXHVGRTc0XHVGRTc2LVx1RkVGQ1x1RkYyMS1cdUZGM0FcdUZGNDEtXHVGRjVBXHVGRjY2LVx1RkZCRVx1RkZDMi1cdUZGQzdcdUZGQ0EtXHVGRkNGXHVGRkQyLVx1RkZEN1x1RkZEQS1cdUZGREMiLCBwZyA9ICJcdTIwMENcdTIwMERceEI3XHUwMzAwLVx1MDM2Rlx1MDM4N1x1MDQ4My1cdTA0ODdcdTA1OTEtXHUwNUJEXHUwNUJGXHUwNUMxXHUwNUMyXHUwNUM0XHUwNUM1XHUwNUM3XHUwNjEwLVx1MDYxQVx1MDY0Qi1cdTA2NjlcdTA2NzBcdTA2RDYtXHUwNkRDXHUwNkRGLVx1MDZFNFx1MDZFN1x1MDZFOFx1MDZFQS1cdTA2RURcdTA2RjAtXHUwNkY5XHUwNzExXHUwNzMwLVx1MDc0QVx1MDdBNi1cdTA3QjBcdTA3QzAtXHUwN0M5XHUwN0VCLVx1MDdGM1x1MDdGRFx1MDgxNi1cdTA4MTlcdTA4MUItXHUwODIzXHUwODI1LVx1MDgyN1x1MDgyOS1cdTA4MkRcdTA4NTktXHUwODVCXHUwODk4LVx1MDg5Rlx1MDhDQS1cdTA4RTFcdTA4RTMtXHUwOTAzXHUwOTNBLVx1MDkzQ1x1MDkzRS1cdTA5NEZcdTA5NTEtXHUwOTU3XHUwOTYyXHUwOTYzXHUwOTY2LVx1MDk2Rlx1MDk4MS1cdTA5ODNcdTA5QkNcdTA5QkUtXHUwOUM0XHUwOUM3XHUwOUM4XHUwOUNCLVx1MDlDRFx1MDlEN1x1MDlFMlx1MDlFM1x1MDlFNi1cdTA5RUZcdTA5RkVcdTBBMDEtXHUwQTAzXHUwQTNDXHUwQTNFLVx1MEE0Mlx1MEE0N1x1MEE0OFx1MEE0Qi1cdTBBNERcdTBBNTFcdTBBNjYtXHUwQTcxXHUwQTc1XHUwQTgxLVx1MEE4M1x1MEFCQ1x1MEFCRS1cdTBBQzVcdTBBQzctXHUwQUM5XHUwQUNCLVx1MEFDRFx1MEFFMlx1MEFFM1x1MEFFNi1cdTBBRUZcdTBBRkEtXHUwQUZGXHUwQjAxLVx1MEIwM1x1MEIzQ1x1MEIzRS1cdTBCNDRcdTBCNDdcdTBCNDhcdTBCNEItXHUwQjREXHUwQjU1LVx1MEI1N1x1MEI2Mlx1MEI2M1x1MEI2Ni1cdTBCNkZcdTBCODJcdTBCQkUtXHUwQkMyXHUwQkM2LVx1MEJDOFx1MEJDQS1cdTBCQ0RcdTBCRDdcdTBCRTYtXHUwQkVGXHUwQzAwLVx1MEMwNFx1MEMzQ1x1MEMzRS1cdTBDNDRcdTBDNDYtXHUwQzQ4XHUwQzRBLVx1MEM0RFx1MEM1NVx1MEM1Nlx1MEM2Mlx1MEM2M1x1MEM2Ni1cdTBDNkZcdTBDODEtXHUwQzgzXHUwQ0JDXHUwQ0JFLVx1MENDNFx1MENDNi1cdTBDQzhcdTBDQ0EtXHUwQ0NEXHUwQ0Q1XHUwQ0Q2XHUwQ0UyXHUwQ0UzXHUwQ0U2LVx1MENFRlx1MEQwMC1cdTBEMDNcdTBEM0JcdTBEM0NcdTBEM0UtXHUwRDQ0XHUwRDQ2LVx1MEQ0OFx1MEQ0QS1cdTBENERcdTBENTdcdTBENjJcdTBENjNcdTBENjYtXHUwRDZGXHUwRDgxLVx1MEQ4M1x1MERDQVx1MERDRi1cdTBERDRcdTBERDZcdTBERDgtXHUwRERGXHUwREU2LVx1MERFRlx1MERGMlx1MERGM1x1MEUzMVx1MEUzNC1cdTBFM0FcdTBFNDctXHUwRTRFXHUwRTUwLVx1MEU1OVx1MEVCMVx1MEVCNC1cdTBFQkNcdTBFQzgtXHUwRUNEXHUwRUQwLVx1MEVEOVx1MEYxOFx1MEYxOVx1MEYyMC1cdTBGMjlcdTBGMzVcdTBGMzdcdTBGMzlcdTBGM0VcdTBGM0ZcdTBGNzEtXHUwRjg0XHUwRjg2XHUwRjg3XHUwRjhELVx1MEY5N1x1MEY5OS1cdTBGQkNcdTBGQzZcdTEwMkItXHUxMDNFXHUxMDQwLVx1MTA0OVx1MTA1Ni1cdTEwNTlcdTEwNUUtXHUxMDYwXHUxMDYyLVx1MTA2NFx1MTA2Ny1cdTEwNkRcdTEwNzEtXHUxMDc0XHUxMDgyLVx1MTA4RFx1MTA4Ri1cdTEwOURcdTEzNUQtXHUxMzVGXHUxMzY5LVx1MTM3MVx1MTcxMi1cdTE3MTVcdTE3MzItXHUxNzM0XHUxNzUyXHUxNzUzXHUxNzcyXHUxNzczXHUxN0I0LVx1MTdEM1x1MTdERFx1MTdFMC1cdTE3RTlcdTE4MEItXHUxODBEXHUxODBGLVx1MTgxOVx1MThBOVx1MTkyMC1cdTE5MkJcdTE5MzAtXHUxOTNCXHUxOTQ2LVx1MTk0Rlx1MTlEMC1cdTE5REFcdTFBMTctXHUxQTFCXHUxQTU1LVx1MUE1RVx1MUE2MC1cdTFBN0NcdTFBN0YtXHUxQTg5XHUxQTkwLVx1MUE5OVx1MUFCMC1cdTFBQkRcdTFBQkYtXHUxQUNFXHUxQjAwLVx1MUIwNFx1MUIzNC1cdTFCNDRcdTFCNTAtXHUxQjU5XHUxQjZCLVx1MUI3M1x1MUI4MC1cdTFCODJcdTFCQTEtXHUxQkFEXHUxQkIwLVx1MUJCOVx1MUJFNi1cdTFCRjNcdTFDMjQtXHUxQzM3XHUxQzQwLVx1MUM0OVx1MUM1MC1cdTFDNTlcdTFDRDAtXHUxQ0QyXHUxQ0Q0LVx1MUNFOFx1MUNFRFx1MUNGNFx1MUNGNy1cdTFDRjlcdTFEQzAtXHUxREZGXHUyMDNGXHUyMDQwXHUyMDU0XHUyMEQwLVx1MjBEQ1x1MjBFMVx1MjBFNS1cdTIwRjBcdTJDRUYtXHUyQ0YxXHUyRDdGXHUyREUwLVx1MkRGRlx1MzAyQS1cdTMwMkZcdTMwOTlcdTMwOUFcdUE2MjAtXHVBNjI5XHVBNjZGXHVBNjc0LVx1QTY3RFx1QTY5RVx1QTY5Rlx1QTZGMFx1QTZGMVx1QTgwMlx1QTgwNlx1QTgwQlx1QTgyMy1cdUE4MjdcdUE4MkNcdUE4ODBcdUE4ODFcdUE4QjQtXHVBOEM1XHVBOEQwLVx1QThEOVx1QThFMC1cdUE4RjFcdUE4RkYtXHVBOTA5XHVBOTI2LVx1QTkyRFx1QTk0Ny1cdUE5NTNcdUE5ODAtXHVBOTgzXHVBOUIzLVx1QTlDMFx1QTlEMC1cdUE5RDlcdUE5RTVcdUE5RjAtXHVBOUY5XHVBQTI5LVx1QUEzNlx1QUE0M1x1QUE0Q1x1QUE0RFx1QUE1MC1cdUFBNTlcdUFBN0ItXHVBQTdEXHVBQUIwXHVBQUIyLVx1QUFCNFx1QUFCN1x1QUFCOFx1QUFCRVx1QUFCRlx1QUFDMVx1QUFFQi1cdUFBRUZcdUFBRjVcdUFBRjZcdUFCRTMtXHVBQkVBXHVBQkVDXHVBQkVEXHVBQkYwLVx1QUJGOVx1RkIxRVx1RkUwMC1cdUZFMEZcdUZFMjAtXHVGRTJGXHVGRTMzXHVGRTM0XHVGRTRELVx1RkU0Rlx1RkYxMC1cdUZGMTlcdUZGM0YiOwogICAgICAgIGNvbnN0IGZnID0gbmV3IFJlZ0V4cCgiWyIgKyBsZyArICJdIiksIGRnID0gbmV3IFJlZ0V4cCgiWyIgKyBsZyArIHBnICsgIl0iKTsKICAgICAgICBsZyA9IHBnID0gbnVsbDsKICAgICAgICBjb25zdCBoZyA9IFswLCAxMSwgMiwgMjUsIDIsIDE4LCAyLCAxLCAyLCAxNCwgMywgMTMsIDM1LCAxMjIsIDcwLCA1MiwgMjY4LCAyOCwgNCwgNDgsIDQ4LCAzMSwgMTQsIDI5LCA2LCAzNywgMTEsIDI5LCAzLCAzNSwgNSwgNywgMiwgNCwgNDMsIDE1NywgMTksIDM1LCA1LCAzNSwgNSwgMzksIDksIDUxLCAxMywgMTAsIDIsIDE0LCAyLCA2LCAyLCAxLCAyLCAxMCwgMiwgMTQsIDIsIDYsIDIsIDEsIDY4LCAzMTAsIDEwLCAyMSwgMTEsIDcsIDI1LCA1LCAyLCA0MSwgMiwgOCwgNzAsIDUsIDMsIDAsIDIsIDQzLCAyLCAxLCA0LCAwLCAzLCAyMiwgMTEsIDIyLCAxMCwgMzAsIDY2LCAxOCwgMiwgMSwgMTEsIDIxLCAxMSwgMjUsIDcxLCA1NSwgNywgMSwgNjUsIDAsIDE2LCAzLCAyLCAyLCAyLCAyOCwgNDMsIDI4LCA0LCAyOCwgMzYsIDcsIDIsIDI3LCAyOCwgNTMsIDExLCAyMSwgMTEsIDE4LCAxNCwgMTcsIDExMSwgNzIsIDU2LCA1MCwgMTQsIDUwLCAxNCwgMzUsIDM0OSwgNDEsIDcsIDEsIDc5LCAyOCwgMTEsIDAsIDksIDIxLCA0MywgMTcsIDQ3LCAyMCwgMjgsIDIyLCAxMywgNTIsIDU4LCAxLCAzLCAwLCAxNCwgNDQsIDMzLCAyNCwgMjcsIDM1LCAzMCwgMCwgMywgMCwgOSwgMzQsIDQsIDAsIDEzLCA0NywgMTUsIDMsIDIyLCAwLCAyLCAwLCAzNiwgMTcsIDIsIDI0LCA4NSwgNiwgMiwgMCwgMiwgMywgMiwgMTQsIDIsIDksIDgsIDQ2LCAzOSwgNywgMywgMSwgMywgMjEsIDIsIDYsIDIsIDEsIDIsIDQsIDQsIDAsIDE5LCAwLCAxMywgNCwgMTU5LCA1MiwgMTksIDMsIDIxLCAyLCAzMSwgNDcsIDIxLCAxLCAyLCAwLCAxODUsIDQ2LCA0MiwgMywgMzcsIDQ3LCAyMSwgMCwgNjAsIDQyLCAxNCwgMCwgNzIsIDI2LCAzOCwgNiwgMTg2LCA0MywgMTE3LCA2MywgMzIsIDcsIDMsIDAsIDMsIDcsIDIsIDEsIDIsIDIzLCAxNiwgMCwgMiwgMCwgOTUsIDcsIDMsIDM4LCAxNywgMCwgMiwgMCwgMjksIDAsIDExLCAzOSwgOCwgMCwgMjIsIDAsIDEyLCA0NSwgMjAsIDAsIDE5LCA3MiwgMjY0LCA4LCAyLCAzNiwgMTgsIDAsIDUwLCAyOSwgMTEzLCA2LCAyLCAxLCAyLCAzNywgMjIsIDAsIDI2LCA1LCAyLCAxLCAyLCAzMSwgMTUsIDAsIDMyOCwgMTgsIDE5MCwgMCwgODAsIDkyMSwgMTAzLCAxMTAsIDE4LCAxOTUsIDI2MzcsIDk2LCAxNiwgMTA3MCwgNDA1MCwgNTgyLCA4NjM0LCA1NjgsIDgsIDMwLCAxOCwgNzgsIDE4LCAyOSwgMTksIDQ3LCAxNywgMywgMzIsIDIwLCA2LCAxOCwgNjg5LCA2MywgMTI5LCA3NCwgNiwgMCwgNjcsIDEyLCA2NSwgMSwgMiwgMCwgMjksIDYxMzUsIDksIDEyMzcsIDQzLCA4LCA4OTM2LCAzLCAyLCA2LCAyLCAxLCAyLCAyOTAsIDQ2LCAyLCAxOCwgMywgOSwgMzk1LCAyMzA5LCAxMDYsIDYsIDEyLCA0LCA4LCA4LCA5LCA1OTkxLCA4NCwgMiwgNzAsIDIsIDEsIDMsIDAsIDMsIDEsIDMsIDMsIDIsIDExLCAyLCAwLCAyLCA2LCAyLCA2NCwgMiwgMywgMywgNywgMiwgNiwgMiwgMjcsIDIsIDMsIDIsIDQsIDIsIDAsIDQsIDYsIDIsIDMzOSwgMywgMjQsIDIsIDI0LCAyLCAzMCwgMiwgMjQsIDIsIDMwLCAyLCAyNCwgMiwgMzAsIDIsIDI0LCAyLCAzMCwgMiwgMjQsIDIsIDcsIDE4NDUsIDMwLCA0ODIsIDQ0LCAxMSwgNiwgMTcsIDAsIDMyMiwgMjksIDE5LCA0MywgMTI2OSwgNiwgMiwgMywgMiwgMSwgMiwgMTQsIDIsIDE5NiwgNjAsIDY3LCA4LCAwLCAxMjA1LCAzLCAyLCAyNiwgMiwgMSwgMiwgMCwgMywgMCwgMiwgOSwgMiwgMywgMiwgMCwgMiwgMCwgNywgMCwgNSwgMCwgMiwgMCwgMiwgMCwgMiwgMiwgMiwgMSwgMiwgMCwgMywgMCwgMiwgMCwgMiwgMCwgMiwgMCwgMiwgMCwgMiwgMSwgMiwgMCwgMywgMywgMiwgNiwgMiwgMywgMiwgMywgMiwgMCwgMiwgOSwgMiwgMTYsIDYsIDIsIDIsIDQsIDIsIDE2LCA0NDIxLCA0MjcxOSwgMzMsIDQxNTIsIDgsIDIyMSwgMywgNTc2MSwgMTUsIDc0NzIsIDMxMDQsIDU0MSwgMTUwNywgNDkzOF0sIGdnID0gWzUwOSwgMCwgMjI3LCAwLCAxNTAsIDQsIDI5NCwgOSwgMTM2OCwgMiwgMiwgMSwgNiwgMywgNDEsIDIsIDUsIDAsIDE2NiwgMSwgNTc0LCAzLCA5LCA5LCAzNzAsIDEsIDE1NCwgMTAsIDUwLCAzLCAxMjMsIDIsIDU0LCAxNCwgMzIsIDEwLCAzLCAxLCAxMSwgMywgNDYsIDEwLCA4LCAwLCA0NiwgOSwgNywgMiwgMzcsIDEzLCAyLCA5LCA2LCAxLCA0NSwgMCwgMTMsIDIsIDQ5LCAxMywgOSwgMywgMiwgMTEsIDgzLCAxMSwgNywgMCwgMTYxLCAxMSwgNiwgOSwgNywgMywgNTYsIDEsIDIsIDYsIDMsIDEsIDMsIDIsIDEwLCAwLCAxMSwgMSwgMywgNiwgNCwgNCwgMTkzLCAxNywgMTAsIDksIDUsIDAsIDgyLCAxOSwgMTMsIDksIDIxNCwgNiwgMywgOCwgMjgsIDEsIDgzLCAxNiwgMTYsIDksIDgyLCAxMiwgOSwgOSwgODQsIDE0LCA1LCA5LCAyNDMsIDE0LCAxNjYsIDksIDcxLCA1LCAyLCAxLCAzLCAzLCAyLCAwLCAyLCAxLCAxMywgOSwgMTIwLCA2LCAzLCA2LCA0LCAwLCAyOSwgOSwgNDEsIDYsIDIsIDMsIDksIDAsIDEwLCAxMCwgNDcsIDE1LCA0MDYsIDcsIDIsIDcsIDE3LCA5LCA1NywgMjEsIDIsIDEzLCAxMjMsIDUsIDQsIDAsIDIsIDEsIDIsIDYsIDIsIDAsIDksIDksIDQ5LCA0LCAyLCAxLCAyLCA0LCA5LCA5LCAzMzAsIDMsIDE5MzA2LCA5LCA4NywgOSwgMzksIDQsIDYwLCA2LCAyNiwgOSwgMTAxNCwgMCwgMiwgNTQsIDgsIDMsIDgyLCAwLCAxMiwgMSwgMTk2MjgsIDEsIDQ3MDYsIDQ1LCAzLCAyMiwgNTQzLCA0LCA0LCA1LCA5LCA3LCAzLCA2LCAzMSwgMywgMTQ5LCAyLCAxNDE4LCA0OSwgNTEzLCA1NCwgNSwgNDksIDksIDAsIDE1LCAwLCAyMywgNCwgMiwgMTQsIDEzNjEsIDYsIDIsIDE2LCAzLCA2LCAyLCAxLCAyLCA0LCAyNjIsIDYsIDEwLCA5LCAzNTcsIDAsIDYyLCAxMywgMTQ5NSwgNiwgMTEwLCA2LCA2LCA5LCA0NzU5LCA5LCA3ODc3MTksIDIzOV07CiAgICAgICAgZnVuY3Rpb24gbWcoZTIsIHQyKSB7CiAgICAgICAgICBsZXQgbjIgPSA2NTUzNjsKICAgICAgICAgIGZvciAobGV0IHIyID0gMCwgbzIgPSB0Mi5sZW5ndGg7IHIyIDwgbzI7IHIyICs9IDIpIHsKICAgICAgICAgICAgaWYgKG4yICs9IHQyW3IyXSwgbjIgPiBlMikKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChuMiArPSB0MltyMiArIDFdLCBuMiA+PSBlMikKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24geWcoZTIpIHsKICAgICAgICAgIHJldHVybiBlMiA8IDY1ID8gZTIgPT09IDM2IDogZTIgPD0gOTAgfHwgKGUyIDwgOTcgPyBlMiA9PT0gOTUgOiBlMiA8PSAxMjIgfHwgKGUyIDw9IDY1NTM1ID8gZTIgPj0gMTcwICYmIGZnLnRlc3QoU3RyaW5nLmZyb21DaGFyQ29kZShlMikpIDogbWcoZTIsIGhnKSkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBEZyhlMikgewogICAgICAgICAgcmV0dXJuIGUyIDwgNDggPyBlMiA9PT0gMzYgOiBlMiA8IDU4IHx8ICEoZTIgPCA2NSkgJiYgKGUyIDw9IDkwIHx8IChlMiA8IDk3ID8gZTIgPT09IDk1IDogZTIgPD0gMTIyIHx8IChlMiA8PSA2NTUzNSA/IGUyID49IDE3MCAmJiBkZy50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoZTIpKSA6IG1nKGUyLCBoZykgfHwgbWcoZTIsIGdnKSkpKTsKICAgICAgICB9CiAgICAgICAgdmFyIEVnID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEVnLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIEVnLmlzUmVzZXJ2ZWRXb3JkID0geGcsIEVnLmlzU3RyaWN0UmVzZXJ2ZWRXb3JkID0gU2csIEVnLmlzU3RyaWN0QmluZE9ubHlSZXNlcnZlZFdvcmQgPSB3ZywgRWcuaXNTdHJpY3RCaW5kUmVzZXJ2ZWRXb3JkID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gU2coZTIsIHQyKSB8fCB3ZyhlMik7CiAgICAgICAgfSwgRWcuaXNLZXl3b3JkID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiB2Zy5oYXMoZTIpOwogICAgICAgIH07CiAgICAgICAgY29uc3QgQ2cgPSBbImltcGxlbWVudHMiLCAiaW50ZXJmYWNlIiwgImxldCIsICJwYWNrYWdlIiwgInByaXZhdGUiLCAicHJvdGVjdGVkIiwgInB1YmxpYyIsICJzdGF0aWMiLCAieWllbGQiXSwgYmcgPSBbImV2YWwiLCAiYXJndW1lbnRzIl0sIHZnID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJicmVhayIsICJjYXNlIiwgImNhdGNoIiwgImNvbnRpbnVlIiwgImRlYnVnZ2VyIiwgImRlZmF1bHQiLCAiZG8iLCAiZWxzZSIsICJmaW5hbGx5IiwgImZvciIsICJmdW5jdGlvbiIsICJpZiIsICJyZXR1cm4iLCAic3dpdGNoIiwgInRocm93IiwgInRyeSIsICJ2YXIiLCAiY29uc3QiLCAid2hpbGUiLCAid2l0aCIsICJuZXciLCAidGhpcyIsICJzdXBlciIsICJjbGFzcyIsICJleHRlbmRzIiwgImV4cG9ydCIsICJpbXBvcnQiLCAibnVsbCIsICJ0cnVlIiwgImZhbHNlIiwgImluIiwgImluc3RhbmNlb2YiLCAidHlwZW9mIiwgInZvaWQiLCAiZGVsZXRlIl0pLCBBZyA9IG5ldyBTZXQoQ2cpLCBGZyA9IG5ldyBTZXQoYmcpOwogICAgICAgIGZ1bmN0aW9uIHhnKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHQyICYmIGUyID09PSAiYXdhaXQiIHx8IGUyID09PSAiZW51bSI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFNnKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHhnKGUyLCB0MikgfHwgQWcuaGFzKGUyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gd2coZTIpIHsKICAgICAgICAgIHJldHVybiBGZy5oYXMoZTIpOwogICAgICAgIH0KICAgICAgICAhZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJpc0lkZW50aWZpZXJOYW1lIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdDIuaXNJZGVudGlmaWVyTmFtZTsKICAgICAgICAgIH0gfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgImlzSWRlbnRpZmllckNoYXIiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0Mi5pc0lkZW50aWZpZXJDaGFyOwogICAgICAgICAgfSB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCAiaXNJZGVudGlmaWVyU3RhcnQiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0Mi5pc0lkZW50aWZpZXJTdGFydDsKICAgICAgICAgIH0gfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgImlzUmVzZXJ2ZWRXb3JkIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gbjIuaXNSZXNlcnZlZFdvcmQ7CiAgICAgICAgICB9IH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJpc1N0cmljdEJpbmRPbmx5UmVzZXJ2ZWRXb3JkIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gbjIuaXNTdHJpY3RCaW5kT25seVJlc2VydmVkV29yZDsKICAgICAgICAgIH0gfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgImlzU3RyaWN0QmluZFJlc2VydmVkV29yZCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIG4yLmlzU3RyaWN0QmluZFJlc2VydmVkV29yZDsKICAgICAgICAgIH0gfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgImlzU3RyaWN0UmVzZXJ2ZWRXb3JkIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gbjIuaXNTdHJpY3RSZXNlcnZlZFdvcmQ7CiAgICAgICAgICB9IH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJpc0tleXdvcmQiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBuMi5pc0tleXdvcmQ7CiAgICAgICAgICB9IH0pOwogICAgICAgICAgdmFyIHQyID0gY2csIG4yID0gRWc7CiAgICAgICAgfShhZyk7CiAgICAgICAgdmFyIFRnID0geyBleHBvcnRzOiB7fSB9LCBCZyA9IC9bfFxce30oKVtcXV4kKyo/Ll0vZywgTmcgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKHR5cGVvZiBlMiAhPSAic3RyaW5nIikKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiRXhwZWN0ZWQgYSBzdHJpbmciKTsKICAgICAgICAgIHJldHVybiBlMi5yZXBsYWNlKEJnLCAiXFwkJiIpOwogICAgICAgIH07CiAgICAgICAgY29uc3Qga2cgPSB5ZiwgUGcgPSAoZTIsIHQyKSA9PiB7CiAgICAgICAgICB0MiA9IHQyIHx8IHRhLmFyZ3Y7CiAgICAgICAgICBjb25zdCBuMiA9IGUyLnN0YXJ0c1dpdGgoIi0iKSA/ICIiIDogZTIubGVuZ3RoID09PSAxID8gIi0iIDogIi0tIiwgcjIgPSB0Mi5pbmRleE9mKG4yICsgZTIpLCBvMiA9IHQyLmluZGV4T2YoIi0tIik7CiAgICAgICAgICByZXR1cm4gcjIgIT09IC0xICYmIChvMiA9PT0gLTEgfHwgcjIgPCBvMik7CiAgICAgICAgfSwgT2cgPSB0YS5lbnY7CiAgICAgICAgbGV0IElnOwogICAgICAgIGZ1bmN0aW9uIExnKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGlmIChJZyA9PT0gZmFsc2UpCiAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIGlmIChQZygiY29sb3I9MTZtIikgfHwgUGcoImNvbG9yPWZ1bGwiKSB8fCBQZygiY29sb3I9dHJ1ZWNvbG9yIikpCiAgICAgICAgICAgICAgcmV0dXJuIDM7CiAgICAgICAgICAgIGlmIChQZygiY29sb3I9MjU2IikpCiAgICAgICAgICAgICAgcmV0dXJuIDI7CiAgICAgICAgICAgIGlmIChlMyAmJiAhZTMuaXNUVFkgJiYgSWcgIT09IHRydWUpCiAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIGNvbnN0IHQzID0gSWcgPyAxIDogMDsKICAgICAgICAgICAgaWYgKHRhLnBsYXRmb3JtID09PSAid2luMzIiKSB7CiAgICAgICAgICAgICAgY29uc3QgZTQgPSBrZy5yZWxlYXNlKCkuc3BsaXQoIi4iKTsKICAgICAgICAgICAgICByZXR1cm4gTnVtYmVyKHRhLnZlcnNpb25zLm5vZGUuc3BsaXQoIi4iKVswXSkgPj0gOCAmJiBOdW1iZXIoZTRbMF0pID49IDEwICYmIE51bWJlcihlNFsyXSkgPj0gMTA1ODYgPyBOdW1iZXIoZTRbMl0pID49IDE0OTMxID8gMyA6IDIgOiAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgiQ0kiIGluIE9nKQogICAgICAgICAgICAgIHJldHVybiBbIlRSQVZJUyIsICJDSVJDTEVDSSIsICJBUFBWRVlPUiIsICJHSVRMQUJfQ0kiXS5zb21lKChlNCkgPT4gZTQgaW4gT2cpIHx8IE9nLkNJX05BTUUgPT09ICJjb2Rlc2hpcCIgPyAxIDogdDM7CiAgICAgICAgICAgIGlmICgiVEVBTUNJVFlfVkVSU0lPTiIgaW4gT2cpCiAgICAgICAgICAgICAgcmV0dXJuIC9eKDlcLigwKlsxLTldXGQqKVwufFxkezIsfVwuKS8udGVzdChPZy5URUFNQ0lUWV9WRVJTSU9OKSA/IDEgOiAwOwogICAgICAgICAgICBpZiAoT2cuQ09MT1JURVJNID09PSAidHJ1ZWNvbG9yIikKICAgICAgICAgICAgICByZXR1cm4gMzsKICAgICAgICAgICAgaWYgKCJURVJNX1BST0dSQU0iIGluIE9nKSB7CiAgICAgICAgICAgICAgY29uc3QgZTQgPSBwYXJzZUludCgoT2cuVEVSTV9QUk9HUkFNX1ZFUlNJT04gfHwgIiIpLnNwbGl0KCIuIilbMF0sIDEwKTsKICAgICAgICAgICAgICBzd2l0Y2ggKE9nLlRFUk1fUFJPR1JBTSkgewogICAgICAgICAgICAgICAgY2FzZSAiaVRlcm0uYXBwIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGU0ID49IDMgPyAzIDogMjsKICAgICAgICAgICAgICAgIGNhc2UgIkFwcGxlX1Rlcm1pbmFsIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAvLTI1Nihjb2xvcik/JC9pLnRlc3QoT2cuVEVSTSkgPyAyIDogL15zY3JlZW58Xnh0ZXJtfF52dDEwMHxednQyMjB8XnJ4dnR8Y29sb3J8YW5zaXxjeWd3aW58bGludXgvaS50ZXN0KE9nLlRFUk0pIHx8ICJDT0xPUlRFUk0iIGluIE9nID8gMSA6IChPZy5URVJNLCB0Myk7CiAgICAgICAgICB9KGUyKTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gZTMgIT09IDAgJiYgeyBsZXZlbDogZTMsIGhhc0Jhc2ljOiB0cnVlLCBoYXMyNTY6IGUzID49IDIsIGhhczE2bTogZTMgPj0gMyB9OwogICAgICAgICAgfSh0Mik7CiAgICAgICAgfQogICAgICAgIFBnKCJuby1jb2xvciIpIHx8IFBnKCJuby1jb2xvcnMiKSB8fCBQZygiY29sb3I9ZmFsc2UiKSA/IElnID0gZmFsc2UgOiAoUGcoImNvbG9yIikgfHwgUGcoImNvbG9ycyIpIHx8IFBnKCJjb2xvcj10cnVlIikgfHwgUGcoImNvbG9yPWFsd2F5cyIpKSAmJiAoSWcgPSB0cnVlKSwgIkZPUkNFX0NPTE9SIiBpbiBPZyAmJiAoSWcgPSBPZy5GT1JDRV9DT0xPUi5sZW5ndGggPT09IDAgfHwgcGFyc2VJbnQoT2cuRk9SQ0VfQ09MT1IsIDEwKSAhPT0gMCk7CiAgICAgICAgdmFyIGpnID0geyBzdXBwb3J0c0NvbG9yOiBMZywgc3Rkb3V0OiBMZyh0YS5zdGRvdXQpLCBzdGRlcnI6IExnKHRhLnN0ZGVycikgfTsKICAgICAgICBjb25zdCBfZyA9IC8oPzpcXCh1W2EtZlxkXXs0fXx4W2EtZlxkXXsyfXwuKSl8KD86XHsofik/KFx3Kyg/OlwoW14pXSpcKSk/KD86XC5cdysoPzpcKFteKV0qXCkpPykqKSg/OlsgXHRdfCg/PVxyP1xuKSkpfChcfSl8KCg/Oi58W1xyXG5cZl0pKz8pL2dpLCBNZyA9IC8oPzpefFwuKShcdyspKD86XCgoW14pXSopXCkpPy9nLCBSZyA9IC9eKFsnIl0pKCg/OlxcLnwoPyFcMSlbXlxcXSkqKVwxJC8sIFZnID0gL1xcKHVbYS1mXGRdezR9fHhbYS1mXGRdezJ9fC4pfChbXlxcXSkvZ2ksICRnID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoW1sibiIsICJcbiJdLCBbInIiLCAiXHIiXSwgWyJ0IiwgIgkiXSwgWyJiIiwgIlxiIl0sIFsiZiIsICJcZiJdLCBbInYiLCAiXHYiXSwgWyIwIiwgIlwwIl0sIFsiXFwiLCAiXFwiXSwgWyJlIiwgIlx4MUIiXSwgWyJhIiwgIlx4MDciXV0pOwogICAgICAgIGZ1bmN0aW9uIFdnKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTJbMF0gPT09ICJ1IiAmJiBlMi5sZW5ndGggPT09IDUgfHwgZTJbMF0gPT09ICJ4IiAmJiBlMi5sZW5ndGggPT09IDMgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhcnNlSW50KGUyLnNsaWNlKDEpLCAxNikpIDogJGcuZ2V0KGUyKSB8fCBlMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcWcoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IFtdLCByMiA9IHQyLnRyaW0oKS5zcGxpdCgvXHMqLFxzKi9nKTsKICAgICAgICAgIGxldCBvMjsKICAgICAgICAgIGZvciAoY29uc3QgdDMgb2YgcjIpCiAgICAgICAgICAgIGlmIChpc05hTih0MykpIHsKICAgICAgICAgICAgICBpZiAoIShvMiA9IHQzLm1hdGNoKFJnKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgQ2hhbGsgdGVtcGxhdGUgc3R5bGUgYXJndW1lbnQ6ICIuY29uY2F0KHQzLCAiIChpbiBzdHlsZSAnIikuY29uY2F0KGUyLCAiJykiKSk7CiAgICAgICAgICAgICAgbjIucHVzaChvMlsyXS5yZXBsYWNlKFZnLCAoZTMsIHQ0LCBuMykgPT4gdDQgPyBXZyh0NCkgOiBuMykpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBuMi5wdXNoKE51bWJlcih0MykpOwogICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBVZyhlMikgewogICAgICAgICAgTWcubGFzdEluZGV4ID0gMDsKICAgICAgICAgIGNvbnN0IHQyID0gW107CiAgICAgICAgICBsZXQgbjI7CiAgICAgICAgICBmb3IgKDsgKG4yID0gTWcuZXhlYyhlMikpICE9PSBudWxsOyApIHsKICAgICAgICAgICAgY29uc3QgZTMgPSBuMlsxXTsKICAgICAgICAgICAgaWYgKG4yWzJdKSB7CiAgICAgICAgICAgICAgY29uc3QgcjIgPSBxZyhlMywgbjJbMl0pOwogICAgICAgICAgICAgIHQyLnB1c2goW2UzXS5jb25jYXQocjIpKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgdDIucHVzaChbZTNdKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gemcoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IHt9OwogICAgICAgICAgZm9yIChjb25zdCBlMyBvZiB0MikKICAgICAgICAgICAgZm9yIChjb25zdCB0MyBvZiBlMy5zdHlsZXMpCiAgICAgICAgICAgICAgbjJbdDNbMF1dID0gZTMuaW52ZXJzZSA/IG51bGwgOiB0My5zbGljZSgxKTsKICAgICAgICAgIGxldCByMiA9IGUyOwogICAgICAgICAgZm9yIChjb25zdCBlMyBvZiBPYmplY3Qua2V5cyhuMikpCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG4yW2UzXSkpIHsKICAgICAgICAgICAgICBpZiAoIShlMyBpbiByMikpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gQ2hhbGsgc3R5bGU6ICIuY29uY2F0KGUzKSk7CiAgICAgICAgICAgICAgcjIgPSBuMltlM10ubGVuZ3RoID4gMCA/IHIyW2UzXS5hcHBseShyMiwgbjJbZTNdKSA6IHIyW2UzXTsKICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgIH0KICAgICAgICB2YXIgR2cgPSAoZTIsIHQyKSA9PiB7CiAgICAgICAgICBjb25zdCBuMiA9IFtdLCByMiA9IFtdOwogICAgICAgICAgbGV0IG8yID0gW107CiAgICAgICAgICBpZiAodDIucmVwbGFjZShfZywgKHQzLCBpMiwgdTIsIHMyLCBhMiwgYzIpID0+IHsKICAgICAgICAgICAgaWYgKGkyKQogICAgICAgICAgICAgIG8yLnB1c2goV2coaTIpKTsKICAgICAgICAgICAgZWxzZSBpZiAoczIpIHsKICAgICAgICAgICAgICBjb25zdCB0NCA9IG8yLmpvaW4oIiIpOwogICAgICAgICAgICAgIG8yID0gW10sIHIyLnB1c2gobjIubGVuZ3RoID09PSAwID8gdDQgOiB6ZyhlMiwgbjIpKHQ0KSksIG4yLnB1c2goeyBpbnZlcnNlOiB1Miwgc3R5bGVzOiBVZyhzMikgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYTIpIHsKICAgICAgICAgICAgICBpZiAobjIubGVuZ3RoID09PSAwKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJGb3VuZCBleHRyYW5lb3VzIH0gaW4gQ2hhbGsgdGVtcGxhdGUgbGl0ZXJhbCIpOwogICAgICAgICAgICAgIHIyLnB1c2goemcoZTIsIG4yKShvMi5qb2luKCIiKSkpLCBvMiA9IFtdLCBuMi5wb3AoKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgbzIucHVzaChjMik7CiAgICAgICAgICB9KSwgcjIucHVzaChvMi5qb2luKCIiKSksIG4yLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgZTMgPSAiQ2hhbGsgdGVtcGxhdGUgbGl0ZXJhbCBpcyBtaXNzaW5nICIuY29uY2F0KG4yLmxlbmd0aCwgIiBjbG9zaW5nIGJyYWNrZXQiKS5jb25jYXQobjIubGVuZ3RoID09PSAxID8gIiIgOiAicyIsICIgKGB9YCkiKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByMi5qb2luKCIiKTsKICAgICAgICB9OwogICAgICAgICFmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBOZywgbjIgPSBqcC5leHBvcnRzLCByMiA9IGpnLnN0ZG91dCwgbzIgPSBHZywgaTIgPSB0YS5wbGF0Zm9ybSA9PT0gIndpbjMyIiAmJiAhKHRhLmVudi5URVJNIHx8ICIiKS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoInh0ZXJtIiksIHUyID0gWyJhbnNpIiwgImFuc2kiLCAiYW5zaTI1NiIsICJhbnNpMTZtIl0sIHMyID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJncmF5Il0pLCBhMiA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgZnVuY3Rpb24gYzIoZTMsIHQzKSB7CiAgICAgICAgICAgIHQzID0gdDMgfHwge307CiAgICAgICAgICAgIGNvbnN0IG4zID0gcjIgPyByMi5sZXZlbCA6IDA7CiAgICAgICAgICAgIGUzLmxldmVsID0gdDMubGV2ZWwgPT09IHZvaWQgMCA/IG4zIDogdDMubGV2ZWwsIGUzLmVuYWJsZWQgPSAiZW5hYmxlZCIgaW4gdDMgPyB0My5lbmFibGVkIDogZTMubGV2ZWwgPiAwOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gbDIoZTMpIHsKICAgICAgICAgICAgaWYgKCF0aGlzIHx8ICEodGhpcyBpbnN0YW5jZW9mIGwyKSB8fCB0aGlzLnRlbXBsYXRlKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSB7fTsKICAgICAgICAgICAgICByZXR1cm4gYzIodDMsIGUzKSwgdDMudGVtcGxhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGU0ID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgcmV0dXJuIGgyLmFwcGx5KG51bGwsIFt0My50ZW1wbGF0ZV0uY29uY2F0KGU0KSk7CiAgICAgICAgICAgICAgfSwgT2JqZWN0LnNldFByb3RvdHlwZU9mKHQzLCBsMi5wcm90b3R5cGUpLCBPYmplY3Quc2V0UHJvdG90eXBlT2YodDMudGVtcGxhdGUsIHQzKSwgdDMudGVtcGxhdGUuY29uc3RydWN0b3IgPSBsMiwgdDMudGVtcGxhdGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYzIodGhpcywgZTMpOwogICAgICAgICAgfQogICAgICAgICAgaTIgJiYgKG4yLmJsdWUub3BlbiA9ICJceDFCWzk0bSIpOwogICAgICAgICAgZm9yIChjb25zdCBlMyBvZiBPYmplY3Qua2V5cyhuMikpCiAgICAgICAgICAgIG4yW2UzXS5jbG9zZVJlID0gbmV3IFJlZ0V4cCh0MihuMltlM10uY2xvc2UpLCAiZyIpLCBhMltlM10gPSB7IGdldCgpIHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IG4yW2UzXTsKICAgICAgICAgICAgICByZXR1cm4gZjIuY2FsbCh0aGlzLCB0aGlzLl9zdHlsZXMgPyB0aGlzLl9zdHlsZXMuY29uY2F0KHQzKSA6IFt0M10sIHRoaXMuX2VtcHR5LCBlMyk7CiAgICAgICAgICAgIH0gfTsKICAgICAgICAgIGEyLnZpc2libGUgPSB7IGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIGYyLmNhbGwodGhpcywgdGhpcy5fc3R5bGVzIHx8IFtdLCB0cnVlLCAidmlzaWJsZSIpOwogICAgICAgICAgfSB9LCBuMi5jb2xvci5jbG9zZVJlID0gbmV3IFJlZ0V4cCh0MihuMi5jb2xvci5jbG9zZSksICJnIik7CiAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIE9iamVjdC5rZXlzKG4yLmNvbG9yLmFuc2kpKQogICAgICAgICAgICBzMi5oYXMoZTMpIHx8IChhMltlM10gPSB7IGdldCgpIHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMubGV2ZWw7CiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgY29uc3QgcjMgPSBuMi5jb2xvclt1Mlt0M11dW2UzXS5hcHBseShudWxsLCBhcmd1bWVudHMpLCBvMyA9IHsgb3BlbjogcjMsIGNsb3NlOiBuMi5jb2xvci5jbG9zZSwgY2xvc2VSZTogbjIuY29sb3IuY2xvc2VSZSB9OwogICAgICAgICAgICAgICAgcmV0dXJuIGYyLmNhbGwodGhpcywgdGhpcy5fc3R5bGVzID8gdGhpcy5fc3R5bGVzLmNvbmNhdChvMykgOiBbbzNdLCB0aGlzLl9lbXB0eSwgZTMpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gfSk7CiAgICAgICAgICBuMi5iZ0NvbG9yLmNsb3NlUmUgPSBuZXcgUmVnRXhwKHQyKG4yLmJnQ29sb3IuY2xvc2UpLCAiZyIpOwogICAgICAgICAgZm9yIChjb25zdCBlMyBvZiBPYmplY3Qua2V5cyhuMi5iZ0NvbG9yLmFuc2kpKSB7CiAgICAgICAgICAgIGlmIChzMi5oYXMoZTMpKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBhMlsiYmciICsgZTNbMF0udG9VcHBlckNhc2UoKSArIGUzLnNsaWNlKDEpXSA9IHsgZ2V0KCkgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5sZXZlbDsKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjb25zdCByMyA9IG4yLmJnQ29sb3JbdTJbdDNdXVtlM10uYXBwbHkobnVsbCwgYXJndW1lbnRzKSwgbzMgPSB7IG9wZW46IHIzLCBjbG9zZTogbjIuYmdDb2xvci5jbG9zZSwgY2xvc2VSZTogbjIuYmdDb2xvci5jbG9zZVJlIH07CiAgICAgICAgICAgICAgICByZXR1cm4gZjIuY2FsbCh0aGlzLCB0aGlzLl9zdHlsZXMgPyB0aGlzLl9zdHlsZXMuY29uY2F0KG8zKSA6IFtvM10sIHRoaXMuX2VtcHR5LCBlMyk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSB9OwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgcDIgPSBPYmplY3QuZGVmaW5lUHJvcGVydGllcygoKSA9PiB7CiAgICAgICAgICB9LCBhMik7CiAgICAgICAgICBmdW5jdGlvbiBmMihlMywgdDMsIG4zKSB7CiAgICAgICAgICAgIGNvbnN0IHIzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGQyLmFwcGx5KHIzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9OwogICAgICAgICAgICByMy5fc3R5bGVzID0gZTMsIHIzLl9lbXB0eSA9IHQzOwogICAgICAgICAgICBjb25zdCBvMyA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkocjMsICJsZXZlbCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiAoKSA9PiBvMy5sZXZlbCwgc2V0KGU0KSB7CiAgICAgICAgICAgICAgbzMubGV2ZWwgPSBlNDsKICAgICAgICAgICAgfSB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHIzLCAiZW5hYmxlZCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiAoKSA9PiBvMy5lbmFibGVkLCBzZXQoZTQpIHsKICAgICAgICAgICAgICBvMy5lbmFibGVkID0gZTQ7CiAgICAgICAgICAgIH0gfSksIHIzLmhhc0dyZXkgPSB0aGlzLmhhc0dyZXkgfHwgbjMgPT09ICJncmF5IiB8fCBuMyA9PT0gImdyZXkiLCByMy5fX3Byb3RvX18gPSBwMiwgcjM7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBkMigpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSBhcmd1bWVudHMsIHQzID0gZTMubGVuZ3RoOwogICAgICAgICAgICBsZXQgcjMgPSBTdHJpbmcoYXJndW1lbnRzWzBdKTsKICAgICAgICAgICAgaWYgKHQzID09PSAwKQogICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgaWYgKHQzID4gMSkKICAgICAgICAgICAgICBmb3IgKGxldCBuMyA9IDE7IG4zIDwgdDM7IG4zKyspCiAgICAgICAgICAgICAgICByMyArPSAiICIgKyBlM1tuM107CiAgICAgICAgICAgIGlmICghdGhpcy5lbmFibGVkIHx8IHRoaXMubGV2ZWwgPD0gMCB8fCAhcjMpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VtcHR5ID8gIiIgOiByMzsKICAgICAgICAgICAgY29uc3QgbzMgPSBuMi5kaW0ub3BlbjsKICAgICAgICAgICAgaTIgJiYgdGhpcy5oYXNHcmV5ICYmIChuMi5kaW0ub3BlbiA9ICIiKTsKICAgICAgICAgICAgZm9yIChjb25zdCBlNCBvZiB0aGlzLl9zdHlsZXMuc2xpY2UoKS5yZXZlcnNlKCkpCiAgICAgICAgICAgICAgcjMgPSBlNC5vcGVuICsgcjMucmVwbGFjZShlNC5jbG9zZVJlLCBlNC5vcGVuKSArIGU0LmNsb3NlLCByMyA9IHIzLnJlcGxhY2UoL1xyP1xuL2csICIiLmNvbmNhdChlNC5jbG9zZSwgIiQmIikuY29uY2F0KGU0Lm9wZW4pKTsKICAgICAgICAgICAgcmV0dXJuIG4yLmRpbS5vcGVuID0gbzMsIHIzOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gaDIoZTMsIHQzKSB7CiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0MykpCiAgICAgICAgICAgICAgcmV0dXJuIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKS5qb2luKCIgIik7CiAgICAgICAgICAgIGNvbnN0IG4zID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpLCByMyA9IFt0My5yYXdbMF1dOwogICAgICAgICAgICBmb3IgKGxldCBlNCA9IDE7IGU0IDwgdDMubGVuZ3RoOyBlNCsrKQogICAgICAgICAgICAgIHIzLnB1c2goU3RyaW5nKG4zW2U0IC0gMV0pLnJlcGxhY2UoL1t7fVxcXS9nLCAiXFwkJiIpKSwgcjMucHVzaChTdHJpbmcodDMucmF3W2U0XSkpOwogICAgICAgICAgICByZXR1cm4gbzIoZTMsIHIzLmpvaW4oIiIpKTsKICAgICAgICAgIH0KICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGwyLnByb3RvdHlwZSwgYTIpLCBlMi5leHBvcnRzID0gbDIoKSwgZTIuZXhwb3J0cy5zdXBwb3J0c0NvbG9yID0gcjIsIGUyLmV4cG9ydHMuZGVmYXVsdCA9IGUyLmV4cG9ydHM7CiAgICAgICAgfShUZyksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh1ZywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCB1Zy5kZWZhdWx0ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGxldCB0MiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgICAgICBpZiAobm0odDIpKSB7CiAgICAgICAgICAgIGNvbnN0IG4yID0gcm0odDIpOwogICAgICAgICAgICByZXR1cm4gdG0oS2cobjIpLCBlMik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgfSwgdWcuZ2V0Q2hhbGsgPSBybSwgdWcuc2hvdWxkSGlnaGxpZ2h0ID0gbm07CiAgICAgICAgdmFyIEhnID0gc2csIEpnID0gYWcsIFhnID0gVGcuZXhwb3J0czsKICAgICAgICBjb25zdCBZZyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KFsiYXMiLCAiYXN5bmMiLCAiZnJvbSIsICJnZXQiLCAib2YiLCAic2V0Il0pOwogICAgICAgIGZ1bmN0aW9uIEtnKGUyKSB7CiAgICAgICAgICByZXR1cm4geyBrZXl3b3JkOiBlMi5jeWFuLCBjYXBpdGFsaXplZDogZTIueWVsbG93LCBqc3hJZGVudGlmaWVyOiBlMi55ZWxsb3csIHB1bmN0dWF0b3I6IGUyLnllbGxvdywgbnVtYmVyOiBlMi5tYWdlbnRhLCBzdHJpbmc6IGUyLmdyZWVuLCByZWdleDogZTIubWFnZW50YSwgY29tbWVudDogZTIuZ3JleSwgaW52YWxpZDogZTIud2hpdGUuYmdSZWQuYm9sZCB9OwogICAgICAgIH0KICAgICAgICBjb25zdCBRZyA9IC9cclxufFtcblxyXHUyMDI4XHUyMDI5XS8sIFpnID0gL15bKClbXF17fV0kLzsKICAgICAgICBsZXQgZW07CiAgICAgICAgewogICAgICAgICAgY29uc3QgZTIgPSAvXlthLXpdW1x3LV0qJC9pLCB0MiA9IGZ1bmN0aW9uKHQzLCBuMiwgcjIpIHsKICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJuYW1lIikgewogICAgICAgICAgICAgIGlmICgoMCwgSmcuaXNLZXl3b3JkKSh0My52YWx1ZSkgfHwgKDAsIEpnLmlzU3RyaWN0UmVzZXJ2ZWRXb3JkKSh0My52YWx1ZSwgdHJ1ZSkgfHwgWWcuaGFzKHQzLnZhbHVlKSkKICAgICAgICAgICAgICAgIHJldHVybiAia2V5d29yZCI7CiAgICAgICAgICAgICAgaWYgKGUyLnRlc3QodDMudmFsdWUpICYmIChyMltuMiAtIDFdID09PSAiPCIgfHwgcjIuc3Vic3RyKG4yIC0gMiwgMikgPT0gIjwvIikpCiAgICAgICAgICAgICAgICByZXR1cm4gImpzeElkZW50aWZpZXIiOwogICAgICAgICAgICAgIGlmICh0My52YWx1ZVswXSAhPT0gdDMudmFsdWVbMF0udG9Mb3dlckNhc2UoKSkKICAgICAgICAgICAgICAgIHJldHVybiAiY2FwaXRhbGl6ZWQiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0My50eXBlID09PSAicHVuY3R1YXRvciIgJiYgWmcudGVzdCh0My52YWx1ZSkgPyAiYnJhY2tldCIgOiB0My50eXBlICE9PSAiaW52YWxpZCIgfHwgdDMudmFsdWUgIT09ICJAIiAmJiB0My52YWx1ZSAhPT0gIiMiID8gdDMudHlwZSA6ICJwdW5jdHVhdG9yIjsKICAgICAgICAgIH07CiAgICAgICAgICBlbSA9IGZ1bmN0aW9uKiAoZTMpIHsKICAgICAgICAgICAgbGV0IG4yOwogICAgICAgICAgICBmb3IgKDsgbjIgPSBIZy5kZWZhdWx0LmV4ZWMoZTMpOyApIHsKICAgICAgICAgICAgICBjb25zdCByMiA9IEhnLm1hdGNoVG9Ub2tlbihuMik7CiAgICAgICAgICAgICAgeWllbGQgeyB0eXBlOiB0MihyMiwgbjIuaW5kZXgsIGUzKSwgdmFsdWU6IHIyLnZhbHVlIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRtKGUyLCB0MikgewogICAgICAgICAgbGV0IG4yID0gIiI7CiAgICAgICAgICBmb3IgKGNvbnN0IHsgdHlwZTogcjIsIHZhbHVlOiBvMiB9IG9mIGVtKHQyKSkgewogICAgICAgICAgICBjb25zdCB0MyA9IGUyW3IyXTsKICAgICAgICAgICAgbjIgKz0gdDMgPyBvMi5zcGxpdChRZykubWFwKChlMykgPT4gdDMoZTMpKS5qb2luKCJcbiIpIDogbzI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG5tKGUyKSB7CiAgICAgICAgICByZXR1cm4gISFYZy5zdXBwb3J0c0NvbG9yIHx8IGUyLmZvcmNlQ29sb3I7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJtKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIuZm9yY2VDb2xvciA/IG5ldyBYZy5jb25zdHJ1Y3Rvcih7IGVuYWJsZWQ6IHRydWUsIGxldmVsOiAxIH0pIDogWGc7CiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpZywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCBpZy5jb2RlRnJhbWVDb2x1bW5zID0gY20sIGlnLmRlZmF1bHQgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBsZXQgcjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1szXSA6IHt9OwogICAgICAgICAgaWYgKCFpbSkgewogICAgICAgICAgICBpbSA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IGUzID0gIlBhc3NpbmcgbGluZU51bWJlciBhbmQgY29sTnVtYmVyIGlzIGRlcHJlY2F0ZWQgdG8gQGJhYmVsL2NvZGUtZnJhbWUuIFBsZWFzZSB1c2UgYGNvZGVGcmFtZUNvbHVtbnNgLiI7CiAgICAgICAgICAgIGlmICh0YS5lbWl0V2FybmluZykKICAgICAgICAgICAgICB0YS5lbWl0V2FybmluZyhlMywgIkRlcHJlY2F0aW9uV2FybmluZyIpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBuZXcgRXJyb3IoZTMpLm5hbWUgPSAiRGVwcmVjYXRpb25XYXJuaW5nIiwgY29uc29sZS53YXJuKG5ldyBFcnJvcihlMykpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBvMiA9IHsgc3RhcnQ6IHsgY29sdW1uOiBuMiA9IE1hdGgubWF4KG4yLCAwKSwgbGluZTogdDIgfSB9OwogICAgICAgICAgcmV0dXJuIGNtKGUyLCBvMiwgcjIpOwogICAgICAgIH07CiAgICAgICAgdmFyIG9tID0gdWc7CiAgICAgICAgbGV0IGltID0gZmFsc2U7CiAgICAgICAgZnVuY3Rpb24gdW0oZTIpIHsKICAgICAgICAgIHJldHVybiB7IGd1dHRlcjogZTIuZ3JleSwgbWFya2VyOiBlMi5yZWQuYm9sZCwgbWVzc2FnZTogZTIucmVkLmJvbGQgfTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgc20gPSAvXHJcbnxbXG5cclx1MjAyOFx1MjAyOV0vOwogICAgICAgIGZ1bmN0aW9uIGFtKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gT2JqZWN0LmFzc2lnbih7IGNvbHVtbjogMCwgbGluZTogLTEgfSwgZTIuc3RhcnQpLCBvMiA9IE9iamVjdC5hc3NpZ24oe30sIHIyLCBlMi5lbmQpLCB7IGxpbmVzQWJvdmU6IGkyID0gMiwgbGluZXNCZWxvdzogdTIgPSAzIH0gPSBuMiB8fCB7fSwgczIgPSByMi5saW5lLCBhMiA9IHIyLmNvbHVtbiwgYzIgPSBvMi5saW5lLCBsMiA9IG8yLmNvbHVtbjsKICAgICAgICAgIGxldCBwMiA9IE1hdGgubWF4KHMyIC0gKGkyICsgMSksIDApLCBmMiA9IE1hdGgubWluKHQyLmxlbmd0aCwgYzIgKyB1Mik7CiAgICAgICAgICBzMiA9PT0gLTEgJiYgKHAyID0gMCksIGMyID09PSAtMSAmJiAoZjIgPSB0Mi5sZW5ndGgpOwogICAgICAgICAgY29uc3QgZDIgPSBjMiAtIHMyLCBoMiA9IHt9OwogICAgICAgICAgaWYgKGQyKQogICAgICAgICAgICBmb3IgKGxldCBlMyA9IDA7IGUzIDw9IGQyOyBlMysrKSB7CiAgICAgICAgICAgICAgY29uc3QgbjMgPSBlMyArIHMyOwogICAgICAgICAgICAgIGlmIChhMikKICAgICAgICAgICAgICAgIGlmIChlMyA9PT0gMCkgewogICAgICAgICAgICAgICAgICBjb25zdCBlNCA9IHQyW24zIC0gMV0ubGVuZ3RoOwogICAgICAgICAgICAgICAgICBoMltuM10gPSBbYTIsIGU0IC0gYTIgKyAxXTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZTMgPT09IGQyKQogICAgICAgICAgICAgICAgICBoMltuM10gPSBbMCwgbDJdOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHIzID0gdDJbbjMgLSBlM10ubGVuZ3RoOwogICAgICAgICAgICAgICAgICBoMltuM10gPSBbMCwgcjNdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGgyW24zXSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIGVsc2UKICAgICAgICAgICAgaDJbczJdID0gYTIgPT09IGwyID8gIWEyIHx8IFthMiwgMF0gOiBbYTIsIGwyIC0gYTJdOwogICAgICAgICAgcmV0dXJuIHsgc3RhcnQ6IHAyLCBlbmQ6IGYyLCBtYXJrZXJMaW5lczogaDIgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY20oZTIsIHQyKSB7CiAgICAgICAgICBsZXQgbjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICAgICAgY29uc3QgcjIgPSAobjIuaGlnaGxpZ2h0Q29kZSB8fCBuMi5mb3JjZUNvbG9yKSAmJiAoMCwgb20uc2hvdWxkSGlnaGxpZ2h0KShuMiksIG8yID0gKDAsIG9tLmdldENoYWxrKShuMiksIGkyID0gdW0obzIpLCB1MiA9IChlMywgdDMpID0+IHIyID8gZTModDMpIDogdDMsIHMyID0gZTIuc3BsaXQoc20pLCB7IHN0YXJ0OiBhMiwgZW5kOiBjMiwgbWFya2VyTGluZXM6IGwyIH0gPSBhbSh0MiwgczIsIG4yKSwgcDIgPSB0Mi5zdGFydCAmJiB0eXBlb2YgdDIuc3RhcnQuY29sdW1uID09ICJudW1iZXIiLCBmMiA9IFN0cmluZyhjMikubGVuZ3RoLCBkMiA9IHIyID8gKDAsIG9tLmRlZmF1bHQpKGUyLCBuMikgOiBlMjsKICAgICAgICAgIGxldCBoMiA9IGQyLnNwbGl0KHNtLCBjMikuc2xpY2UoYTIsIGMyKS5tYXAoKGUzLCB0MykgPT4gewogICAgICAgICAgICBjb25zdCByMyA9IGEyICsgMSArIHQzLCBvMyA9ICIgIi5jb25jYXQocjMpLnNsaWNlKC1mMiksIHMzID0gIiAiLmNvbmNhdChvMywgIiB8IiksIGMzID0gbDJbcjNdLCBwMyA9ICFsMltyMyArIDFdOwogICAgICAgICAgICBpZiAoYzMpIHsKICAgICAgICAgICAgICBsZXQgdDQgPSAiIjsKICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjMykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHI0ID0gZTMuc2xpY2UoMCwgTWF0aC5tYXgoYzNbMF0gLSAxLCAwKSkucmVwbGFjZSgvW15cdF0vZywgIiAiKSwgbzQgPSBjM1sxXSB8fCAxOwogICAgICAgICAgICAgICAgdDQgPSBbIlxuICIsIHUyKGkyLmd1dHRlciwgczMucmVwbGFjZSgvXGQvZywgIiAiKSksICIgIiwgcjQsIHUyKGkyLm1hcmtlciwgIl4iKS5yZXBlYXQobzQpXS5qb2luKCIiKSwgcDMgJiYgbjIubWVzc2FnZSAmJiAodDQgKz0gIiAiICsgdTIoaTIubWVzc2FnZSwgbjIubWVzc2FnZSkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gW3UyKGkyLm1hcmtlciwgIj4iKSwgdTIoaTIuZ3V0dGVyLCBzMyksIGUzLmxlbmd0aCA+IDAgPyAiICIuY29uY2F0KGUzKSA6ICIiLCB0NF0uam9pbigiIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICIgIi5jb25jYXQodTIoaTIuZ3V0dGVyLCBzMykpLmNvbmNhdChlMy5sZW5ndGggPiAwID8gIiAiLmNvbmNhdChlMykgOiAiIik7CiAgICAgICAgICB9KS5qb2luKCJcbiIpOwogICAgICAgICAgcmV0dXJuIG4yLm1lc3NhZ2UgJiYgIXAyICYmIChoMiA9ICIiLmNvbmNhdCgiICIucmVwZWF0KGYyICsgMSkpLmNvbmNhdChuMi5tZXNzYWdlLCAiXG4iKS5jb25jYXQoaDIpKSwgcjIgPyBvMi5yZXNldChoMikgOiBoMjsKICAgICAgICB9CiAgICAgICAgY29uc3QgeyBDb25maWdFcnJvcjogbG0gfSA9IENwLCBwbSA9IG9nLCB7IGxvY1N0YXJ0OiBmbSwgbG9jRW5kOiBkbSB9ID0gcG0sIGhtID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMsIGdtID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKICAgICAgICBmdW5jdGlvbiBtbShlMikgewogICAgICAgICAgY29uc3QgdDIgPSB7fTsKICAgICAgICAgIGZvciAoY29uc3QgbjIgb2YgZTIucGx1Z2lucykKICAgICAgICAgICAgaWYgKG4yLnBhcnNlcnMpCiAgICAgICAgICAgICAgZm9yIChjb25zdCBlMyBvZiBobShuMi5wYXJzZXJzKSkKICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0MiwgZTMsIGdtKG4yLnBhcnNlcnMsIGUzKSk7CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHltKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IG1tKGUyKTsKICAgICAgICAgIGlmICh0eXBlb2YgZTIucGFyc2VyID09ICJmdW5jdGlvbiIpCiAgICAgICAgICAgIHJldHVybiB7IHBhcnNlOiBlMi5wYXJzZXIsIGFzdEZvcm1hdDogImVzdHJlZSIsIGxvY1N0YXJ0OiBmbSwgbG9jRW5kOiBkbSB9OwogICAgICAgICAgaWYgKHR5cGVvZiBlMi5wYXJzZXIgPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0MiwgZTIucGFyc2VyKSkKICAgICAgICAgICAgICByZXR1cm4gdDJbZTIucGFyc2VyXTsKICAgICAgICAgICAgdGhyb3cgbmV3IGxtKGBDb3VsZG4ndCByZXNvbHZlIHBhcnNlciAiYC5jb25jYXQoZTIucGFyc2VyLCAnIi4gUGFyc2VycyBtdXN0IGJlIGV4cGxpY2l0bHkgYWRkZWQgdG8gdGhlIHN0YW5kYWxvbmUgYnVuZGxlLicpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIERtID0geyBwYXJzZTogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IG1tKHQyKSwgcjIgPSBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh7fSwgT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5rZXlzKG4yKS5tYXAoKGUzKSA9PiBbZTMsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiAoKSA9PiBuMltlM10ucGFyc2UgfV0pKSksIG8yID0geW0odDIsIG4yKTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBvMi5wcmVwcm9jZXNzICYmIChlMiA9IG8yLnByZXByb2Nlc3MoZTIsIHQyKSksIHsgdGV4dDogZTIsIGFzdDogbzIucGFyc2UoZTIsIHIyLCB0MikgfTsKICAgICAgICAgIH0gY2F0Y2ggKHQzKSB7CiAgICAgICAgICAgIGNvbnN0IHsgbG9jOiBuMyB9ID0gdDM7CiAgICAgICAgICAgIGlmIChuMykgewogICAgICAgICAgICAgIGNvbnN0IHsgY29kZUZyYW1lQ29sdW1uczogcjMgfSA9IGlnOwogICAgICAgICAgICAgIHRocm93IHQzLmNvZGVGcmFtZSA9IHIzKGUyLCBuMywgeyBoaWdobGlnaHRDb2RlOiB0cnVlIH0pLCB0My5tZXNzYWdlICs9ICJcbiIgKyB0My5jb2RlRnJhbWUsIHQzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IHQzLnN0YWNrOwogICAgICAgICAgfQogICAgICAgIH0sIHJlc29sdmVQYXJzZXI6IHltIH07CiAgICAgICAgY29uc3QgRW0gPSBlbCwgQ20gPSBnbCwgYm0gPSBncCwgeyBVbmRlZmluZWRQYXJzZXJFcnJvcjogdm0gfSA9IENwLCB7IGdldFN1cHBvcnRJbmZvOiBBbSB9ID0gemEsIEZtID0gWmgsIHsgcmVzb2x2ZVBhcnNlcjogeG0gfSA9IERtLCBTbSA9IHsgYXN0Rm9ybWF0OiAiZXN0cmVlIiwgcHJpbnRlcjoge30sIG9yaWdpbmFsVGV4dDogdm9pZCAwLCBsb2NTdGFydDogbnVsbCwgbG9jRW5kOiBudWxsIH07CiAgICAgICAgZnVuY3Rpb24gd20oZTIpIHsKICAgICAgICAgIGNvbnN0IHsgYXN0Rm9ybWF0OiB0MiB9ID0gZTI7CiAgICAgICAgICBpZiAoIXQyKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImdldFBsdWdpbigpIHJlcXVpcmVzIGFzdEZvcm1hdCB0byBiZSBzZXQiKTsKICAgICAgICAgIGNvbnN0IG4yID0gZTIucGx1Z2lucy5maW5kKChlMykgPT4gZTMucHJpbnRlcnMgJiYgZTMucHJpbnRlcnNbdDJdKTsKICAgICAgICAgIGlmICghbjIpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGRuJ3QgZmluZCBwbHVnaW4gZm9yIEFTVCBmb3JtYXQgImAuY29uY2F0KHQyLCAnIicpKTsKICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVG0oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IENtLmJhc2VuYW1lKGUyKS50b0xvd2VyQ2FzZSgpLCByMiA9IEFtKHsgcGx1Z2luczogdDIgfSkubGFuZ3VhZ2VzLmZpbHRlcigoZTMpID0+IGUzLnNpbmNlICE9PSBudWxsKTsKICAgICAgICAgIGxldCBvMiA9IHIyLmZpbmQoKGUzKSA9PiBlMy5leHRlbnNpb25zICYmIGUzLmV4dGVuc2lvbnMuc29tZSgoZTQpID0+IG4yLmVuZHNXaXRoKGU0KSkgfHwgZTMuZmlsZW5hbWVzICYmIGUzLmZpbGVuYW1lcy5zb21lKChlNCkgPT4gZTQudG9Mb3dlckNhc2UoKSA9PT0gbjIpKTsKICAgICAgICAgIGlmICghbzIgJiYgIW4yLmluY2x1ZGVzKCIuIikpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICAgIGlmICh0eXBlb2YgZTMgIT0gInN0cmluZyIpCiAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgICAgbGV0IHQ0OwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB0NCA9IEVtLm9wZW5TeW5jKGUzLCAiciIpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGU0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBlNCA9IG5ldyBibSh0NCkubmV4dCgpLnRvU3RyaW5nKCJ1dGY4IiksIG4zID0gZTQubWF0Y2goL14jIVwvKD86dXNyXC8pP2JpblwvZW52XHMrKFxTKykvKTsKICAgICAgICAgICAgICAgIGlmIChuMykKICAgICAgICAgICAgICAgICAgcmV0dXJuIG4zWzFdOwogICAgICAgICAgICAgICAgY29uc3QgcjMgPSBlNC5tYXRjaCgvXiMhXC8oPzp1c3JcLyg/OmxvY2FsXC8pPyk/YmluXC8oXFMrKS8pOwogICAgICAgICAgICAgICAgcmV0dXJuIHIzID8gcjNbMV0gOiAiIjsKICAgICAgICAgICAgICB9IGNhdGNoIChlNCkgewogICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICBFbS5jbG9zZVN5bmModDQpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZTQpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0oZTIpOwogICAgICAgICAgICBvMiA9IHIyLmZpbmQoKGUzKSA9PiBlMy5pbnRlcnByZXRlcnMgJiYgZTMuaW50ZXJwcmV0ZXJzLmluY2x1ZGVzKHQzKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbzIgJiYgbzIucGFyc2Vyc1swXTsKICAgICAgICB9CiAgICAgICAgdmFyIEJtID0geyBub3JtYWxpemU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICAgICAgY29uc3QgbjIgPSBPYmplY3QuYXNzaWduKHt9LCBlMiksIHIyID0gQW0oeyBwbHVnaW5zOiBlMi5wbHVnaW5zLCBzaG93VW5yZWxlYXNlZDogdHJ1ZSwgc2hvd0RlcHJlY2F0ZWQ6IHRydWUgfSkub3B0aW9ucywgbzIgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIFNtKSwgT2JqZWN0LmZyb21FbnRyaWVzKHIyLmZpbHRlcigoZTMpID0+IGUzLmRlZmF1bHQgIT09IHZvaWQgMCkubWFwKChlMykgPT4gW2UzLm5hbWUsIGUzLmRlZmF1bHRdKSkpOwogICAgICAgICAgaWYgKCFuMi5wYXJzZXIpCiAgICAgICAgICAgIGlmIChuMi5maWxlcGF0aCkgewogICAgICAgICAgICAgIGlmIChuMi5wYXJzZXIgPSBUbShuMi5maWxlcGF0aCwgbjIucGx1Z2lucyksICFuMi5wYXJzZXIpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgdm0oIk5vIHBhcnNlciBjb3VsZCBiZSBpbmZlcnJlZCBmb3IgZmlsZTogIi5jb25jYXQobjIuZmlsZXBhdGgpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAodDIubG9nZ2VyIHx8IGNvbnNvbGUpLndhcm4oIk5vIHBhcnNlciBhbmQgbm8gZmlsZXBhdGggZ2l2ZW4sIHVzaW5nICdiYWJlbCcgdGhlIHBhcnNlciBub3cgYnV0IHRoaXMgd2lsbCB0aHJvdyBhbiBlcnJvciBpbiB0aGUgZnV0dXJlLiBQbGVhc2Ugc3BlY2lmeSBhIHBhcnNlciBvciBhIGZpbGVwYXRoIHNvIG9uZSBjYW4gYmUgaW5mZXJyZWQuIiksIG4yLnBhcnNlciA9ICJiYWJlbCI7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGkyID0geG0oRm0ubm9ybWFsaXplQXBpT3B0aW9ucyhuMiwgW3IyLmZpbmQoKGUzKSA9PiBlMy5uYW1lID09PSAicGFyc2VyIildLCB7IHBhc3NUaHJvdWdoOiB0cnVlLCBsb2dnZXI6IGZhbHNlIH0pKTsKICAgICAgICAgIG4yLmFzdEZvcm1hdCA9IGkyLmFzdEZvcm1hdCwgbjIubG9jRW5kID0gaTIubG9jRW5kLCBuMi5sb2NTdGFydCA9IGkyLmxvY1N0YXJ0OwogICAgICAgICAgY29uc3QgdTIgPSB3bShuMik7CiAgICAgICAgICBuMi5wcmludGVyID0gdTIucHJpbnRlcnNbbjIuYXN0Rm9ybWF0XTsKICAgICAgICAgIGNvbnN0IHMyID0gT2JqZWN0LmZyb21FbnRyaWVzKHIyLmZpbHRlcigoZTMpID0+IGUzLnBsdWdpbkRlZmF1bHRzICYmIGUzLnBsdWdpbkRlZmF1bHRzW3UyLm5hbWVdICE9PSB2b2lkIDApLm1hcCgoZTMpID0+IFtlMy5uYW1lLCBlMy5wbHVnaW5EZWZhdWx0c1t1Mi5uYW1lXV0pKSwgYTIgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG8yKSwgczIpOwogICAgICAgICAgZm9yIChjb25zdCBbZTMsIHQzXSBvZiBPYmplY3QuZW50cmllcyhhMikpCiAgICAgICAgICAgIG4yW2UzXSAhPT0gbnVsbCAmJiBuMltlM10gIT09IHZvaWQgMCB8fCAobjJbZTNdID0gdDMpOwogICAgICAgICAgcmV0dXJuIG4yLnBhcnNlciA9PT0gImpzb24iICYmIChuMi50cmFpbGluZ0NvbW1hID0gIm5vbmUiKSwgRm0ubm9ybWFsaXplQXBpT3B0aW9ucyhuMiwgcjIsIE9iamVjdC5hc3NpZ24oeyBwYXNzVGhyb3VnaDogT2JqZWN0LmtleXMoU20pIH0sIHQyKSk7CiAgICAgICAgfSwgaGlkZGVuRGVmYXVsdHM6IFNtLCBpbmZlclBhcnNlcjogVG0gfTsKICAgICAgICB2YXIgTm0gPSBmdW5jdGlvbiBlMih0MiwgbjIsIHIyKSB7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0MikpCiAgICAgICAgICAgIHJldHVybiB0Mi5tYXAoKHQzKSA9PiBlMih0MywgbjIsIHIyKSkuZmlsdGVyKEJvb2xlYW4pOwogICAgICAgICAgaWYgKCF0MiB8fCB0eXBlb2YgdDIgIT0gIm9iamVjdCIpCiAgICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICAgIGNvbnN0IG8yID0gbjIucHJpbnRlci5tYXNzYWdlQXN0Tm9kZTsKICAgICAgICAgIGxldCBpMjsKICAgICAgICAgIGkyID0gbzIgJiYgbzIuaWdub3JlZFByb3BlcnRpZXMgPyBvMi5pZ25vcmVkUHJvcGVydGllcyA6IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7CiAgICAgICAgICBjb25zdCB1MiA9IHt9OwogICAgICAgICAgZm9yIChjb25zdCBbcjMsIG8zXSBvZiBPYmplY3QuZW50cmllcyh0MikpCiAgICAgICAgICAgIGkyLmhhcyhyMykgfHwgdHlwZW9mIG8zID09ICJmdW5jdGlvbiIgfHwgKHUyW3IzXSA9IGUyKG8zLCBuMiwgdDIpKTsKICAgICAgICAgIGlmIChvMikgewogICAgICAgICAgICBjb25zdCBlMyA9IG8yKHQyLCB1MiwgcjIpOwogICAgICAgICAgICBpZiAoZTMgPT09IG51bGwpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoZTMpCiAgICAgICAgICAgICAgcmV0dXJuIGUzOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHUyOwogICAgICAgIH0sIGttID0gdHlwZW9mIE9iamVjdC5jcmVhdGUgPT0gImZ1bmN0aW9uIiA/IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgZTIuc3VwZXJfID0gdDIsIGUyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUodDIucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBlMiwgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsKICAgICAgICB9IDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBlMi5zdXBlcl8gPSB0MjsKICAgICAgICAgIHZhciBuMiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgfTsKICAgICAgICAgIG4yLnByb3RvdHlwZSA9IHQyLnByb3RvdHlwZSwgZTIucHJvdG90eXBlID0gbmV3IG4yKCksIGUyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGUyOwogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gUG0oZTIsIHQyKSB7CiAgICAgICAgICB2YXIgbjIgPSB7IHNlZW46IFtdLCBzdHlsaXplOiBJbSB9OwogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPj0gMyAmJiAobjIuZGVwdGggPSBhcmd1bWVudHNbMl0pLCBhcmd1bWVudHMubGVuZ3RoID49IDQgJiYgKG4yLmNvbG9ycyA9IGFyZ3VtZW50c1szXSksIE1tKHQyKSA/IG4yLnNob3dIaWRkZW4gPSB0MiA6IHQyICYmIFhtKG4yLCB0MiksICRtKG4yLnNob3dIaWRkZW4pICYmIChuMi5zaG93SGlkZGVuID0gZmFsc2UpLCAkbShuMi5kZXB0aCkgJiYgKG4yLmRlcHRoID0gMiksICRtKG4yLmNvbG9ycykgJiYgKG4yLmNvbG9ycyA9IGZhbHNlKSwgJG0objIuY3VzdG9tSW5zcGVjdCkgJiYgKG4yLmN1c3RvbUluc3BlY3QgPSB0cnVlKSwgbjIuY29sb3JzICYmIChuMi5zdHlsaXplID0gT20pLCBMbShuMiwgZTIsIG4yLmRlcHRoKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gT20oZTIsIHQyKSB7CiAgICAgICAgICB2YXIgbjIgPSBQbS5zdHlsZXNbdDJdOwogICAgICAgICAgcmV0dXJuIG4yID8gIlx4MUJbIiArIFBtLmNvbG9yc1tuMl1bMF0gKyAibSIgKyBlMiArICJceDFCWyIgKyBQbS5jb2xvcnNbbjJdWzFdICsgIm0iIDogZTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEltKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBMbShlMiwgdDIsIG4yKSB7CiAgICAgICAgICBpZiAoZTIuY3VzdG9tSW5zcGVjdCAmJiB0MiAmJiBHbSh0Mi5pbnNwZWN0KSAmJiB0Mi5pbnNwZWN0ICE9PSBQbSAmJiAoIXQyLmNvbnN0cnVjdG9yIHx8IHQyLmNvbnN0cnVjdG9yLnByb3RvdHlwZSAhPT0gdDIpKSB7CiAgICAgICAgICAgIHZhciByMiA9IHQyLmluc3BlY3QobjIsIGUyKTsKICAgICAgICAgICAgcmV0dXJuIFZtKHIyKSB8fCAocjIgPSBMbShlMiwgcjIsIG4yKSksIHIyOwogICAgICAgICAgfQogICAgICAgICAgdmFyIG8yID0gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIGlmICgkbSh0MykpCiAgICAgICAgICAgICAgcmV0dXJuIGUzLnN0eWxpemUoInVuZGVmaW5lZCIsICJ1bmRlZmluZWQiKTsKICAgICAgICAgICAgaWYgKFZtKHQzKSkgewogICAgICAgICAgICAgIHZhciBuMyA9ICInIiArIEpTT04uc3RyaW5naWZ5KHQzKS5yZXBsYWNlKC9eInwiJC9nLCAiIikucmVwbGFjZSgvJy9nLCAiXFwnIikucmVwbGFjZSgvXFwiL2csICciJykgKyAiJyI7CiAgICAgICAgICAgICAgcmV0dXJuIGUzLnN0eWxpemUobjMsICJzdHJpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocjMgPSB0MywgdHlwZW9mIHIzID09ICJudW1iZXIiKQogICAgICAgICAgICAgIHJldHVybiBlMy5zdHlsaXplKCIiICsgdDMsICJudW1iZXIiKTsKICAgICAgICAgICAgdmFyIHIzOwogICAgICAgICAgICBpZiAoTW0odDMpKQogICAgICAgICAgICAgIHJldHVybiBlMy5zdHlsaXplKCIiICsgdDMsICJib29sZWFuIik7CiAgICAgICAgICAgIGlmIChSbSh0MykpCiAgICAgICAgICAgICAgcmV0dXJuIGUzLnN0eWxpemUoIm51bGwiLCAibnVsbCIpOwogICAgICAgICAgfShlMiwgdDIpOwogICAgICAgICAgaWYgKG8yKQogICAgICAgICAgICByZXR1cm4gbzI7CiAgICAgICAgICB2YXIgaTIgPSBPYmplY3Qua2V5cyh0MiksIHUyID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgdmFyIHQzID0ge307CiAgICAgICAgICAgIHJldHVybiBlMy5mb3JFYWNoKGZ1bmN0aW9uKGU0LCBuMykgewogICAgICAgICAgICAgIHQzW2U0XSA9IHRydWU7CiAgICAgICAgICAgIH0pLCB0MzsKICAgICAgICAgIH0oaTIpOwogICAgICAgICAgaWYgKGUyLnNob3dIaWRkZW4gJiYgKGkyID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModDIpKSwgem0odDIpICYmIChpMi5pbmRleE9mKCJtZXNzYWdlIikgPj0gMCB8fCBpMi5pbmRleE9mKCJkZXNjcmlwdGlvbiIpID49IDApKQogICAgICAgICAgICByZXR1cm4gam0odDIpOwogICAgICAgICAgaWYgKGkyLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBpZiAoR20odDIpKSB7CiAgICAgICAgICAgICAgdmFyIHMyID0gdDIubmFtZSA/ICI6ICIgKyB0Mi5uYW1lIDogIiI7CiAgICAgICAgICAgICAgcmV0dXJuIGUyLnN0eWxpemUoIltGdW5jdGlvbiIgKyBzMiArICJdIiwgInNwZWNpYWwiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoV20odDIpKQogICAgICAgICAgICAgIHJldHVybiBlMi5zdHlsaXplKFJlZ0V4cC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0MiksICJyZWdleHAiKTsKICAgICAgICAgICAgaWYgKFVtKHQyKSkKICAgICAgICAgICAgICByZXR1cm4gZTIuc3R5bGl6ZShEYXRlLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQyKSwgImRhdGUiKTsKICAgICAgICAgICAgaWYgKHptKHQyKSkKICAgICAgICAgICAgICByZXR1cm4gam0odDIpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGEyLCBjMiwgbDIgPSAiIiwgcDIgPSBmYWxzZSwgZjIgPSBbInsiLCAifSJdOwogICAgICAgICAgKGEyID0gdDIsIEFycmF5LmlzQXJyYXkoYTIpICYmIChwMiA9IHRydWUsIGYyID0gWyJbIiwgIl0iXSksIEdtKHQyKSkgJiYgKGwyID0gIiBbRnVuY3Rpb24iICsgKHQyLm5hbWUgPyAiOiAiICsgdDIubmFtZSA6ICIiKSArICJdIik7CiAgICAgICAgICByZXR1cm4gV20odDIpICYmIChsMiA9ICIgIiArIFJlZ0V4cC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0MikpLCBVbSh0MikgJiYgKGwyID0gIiAiICsgRGF0ZS5wcm90b3R5cGUudG9VVENTdHJpbmcuY2FsbCh0MikpLCB6bSh0MikgJiYgKGwyID0gIiAiICsgam0odDIpKSwgaTIubGVuZ3RoICE9PSAwIHx8IHAyICYmIHQyLmxlbmd0aCAhPSAwID8gbjIgPCAwID8gV20odDIpID8gZTIuc3R5bGl6ZShSZWdFeHAucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodDIpLCAicmVnZXhwIikgOiBlMi5zdHlsaXplKCJbT2JqZWN0XSIsICJzcGVjaWFsIikgOiAoZTIuc2Vlbi5wdXNoKHQyKSwgYzIgPSBwMiA/IGZ1bmN0aW9uKGUzLCB0MywgbjMsIHIzLCBvMykgewogICAgICAgICAgICBmb3IgKHZhciBpMyA9IFtdLCB1MyA9IDAsIHMzID0gdDMubGVuZ3RoOyB1MyA8IHMzOyArK3UzKQogICAgICAgICAgICAgIFltKHQzLCBTdHJpbmcodTMpKSA/IGkzLnB1c2goX20oZTMsIHQzLCBuMywgcjMsIFN0cmluZyh1MyksIHRydWUpKSA6IGkzLnB1c2goIiIpOwogICAgICAgICAgICByZXR1cm4gbzMuZm9yRWFjaChmdW5jdGlvbihvNCkgewogICAgICAgICAgICAgIG80Lm1hdGNoKC9eXGQrJC8pIHx8IGkzLnB1c2goX20oZTMsIHQzLCBuMywgcjMsIG80LCB0cnVlKSk7CiAgICAgICAgICAgIH0pLCBpMzsKICAgICAgICAgIH0oZTIsIHQyLCBuMiwgdTIsIGkyKSA6IGkyLm1hcChmdW5jdGlvbihyMykgewogICAgICAgICAgICByZXR1cm4gX20oZTIsIHQyLCBuMiwgdTIsIHIzLCBwMik7CiAgICAgICAgICB9KSwgZTIuc2Vlbi5wb3AoKSwgZnVuY3Rpb24oZTMsIHQzLCBuMykgewogICAgICAgICAgICBpZiAoZTMucmVkdWNlKGZ1bmN0aW9uKGU0LCB0NCkgewogICAgICAgICAgICAgIHJldHVybiB0NC5pbmRleE9mKCJcbiIpLCBlNCArIHQ0LnJlcGxhY2UoL1x1MDAxYlxbXGRcZD9tL2csICIiKS5sZW5ndGggKyAxOwogICAgICAgICAgICB9LCAwKSA+IDYwKQogICAgICAgICAgICAgIHJldHVybiBuM1swXSArICh0MyA9PT0gIiIgPyAiIiA6IHQzICsgIlxuICIpICsgIiAiICsgZTMuam9pbigiLFxuICAiKSArICIgIiArIG4zWzFdOwogICAgICAgICAgICByZXR1cm4gbjNbMF0gKyB0MyArICIgIiArIGUzLmpvaW4oIiwgIikgKyAiICIgKyBuM1sxXTsKICAgICAgICAgIH0oYzIsIGwyLCBmMikpIDogZjJbMF0gKyBsMiArIGYyWzFdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBqbShlMikgewogICAgICAgICAgcmV0dXJuICJbIiArIEVycm9yLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGUyKSArICJdIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gX20oZTIsIHQyLCBuMiwgcjIsIG8yLCBpMikgewogICAgICAgICAgdmFyIHUyLCBzMiwgYTI7CiAgICAgICAgICBpZiAoKGEyID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0MiwgbzIpIHx8IHsgdmFsdWU6IHQyW28yXSB9KS5nZXQgPyBzMiA9IGEyLnNldCA/IGUyLnN0eWxpemUoIltHZXR0ZXIvU2V0dGVyXSIsICJzcGVjaWFsIikgOiBlMi5zdHlsaXplKCJbR2V0dGVyXSIsICJzcGVjaWFsIikgOiBhMi5zZXQgJiYgKHMyID0gZTIuc3R5bGl6ZSgiW1NldHRlcl0iLCAic3BlY2lhbCIpKSwgWW0ocjIsIG8yKSB8fCAodTIgPSAiWyIgKyBvMiArICJdIiksIHMyIHx8IChlMi5zZWVuLmluZGV4T2YoYTIudmFsdWUpIDwgMCA/IChzMiA9IFJtKG4yKSA/IExtKGUyLCBhMi52YWx1ZSwgbnVsbCkgOiBMbShlMiwgYTIudmFsdWUsIG4yIC0gMSkpLmluZGV4T2YoIlxuIikgPiAtMSAmJiAoczIgPSBpMiA/IHMyLnNwbGl0KCJcbiIpLm1hcChmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gIiAgIiArIGUzOwogICAgICAgICAgfSkuam9pbigiXG4iKS5zdWJzdHIoMikgOiAiXG4iICsgczIuc3BsaXQoIlxuIikubWFwKGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiAiICAgIiArIGUzOwogICAgICAgICAgfSkuam9pbigiXG4iKSkgOiBzMiA9IGUyLnN0eWxpemUoIltDaXJjdWxhcl0iLCAic3BlY2lhbCIpKSwgJG0odTIpKSB7CiAgICAgICAgICAgIGlmIChpMiAmJiBvMi5tYXRjaCgvXlxkKyQvKSkKICAgICAgICAgICAgICByZXR1cm4gczI7CiAgICAgICAgICAgICh1MiA9IEpTT04uc3RyaW5naWZ5KCIiICsgbzIpKS5tYXRjaCgvXiIoW2EtekEtWl9dW2EtekEtWl8wLTldKikiJC8pID8gKHUyID0gdTIuc3Vic3RyKDEsIHUyLmxlbmd0aCAtIDIpLCB1MiA9IGUyLnN0eWxpemUodTIsICJuYW1lIikpIDogKHUyID0gdTIucmVwbGFjZSgvJy9nLCAiXFwnIikucmVwbGFjZSgvXFwiL2csICciJykucmVwbGFjZSgvKF4ifCIkKS9nLCAiJyIpLCB1MiA9IGUyLnN0eWxpemUodTIsICJzdHJpbmciKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdTIgKyAiOiAiICsgczI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE1tKGUyKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGUyID09ICJib29sZWFuIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gUm0oZTIpIHsKICAgICAgICAgIHJldHVybiBlMiA9PT0gbnVsbDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVm0oZTIpIHsKICAgICAgICAgIHJldHVybiB0eXBlb2YgZTIgPT0gInN0cmluZyI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uICRtKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgPT09IHZvaWQgMDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gV20oZTIpIHsKICAgICAgICAgIHJldHVybiBxbShlMikgJiYgSm0oZTIpID09PSAiW29iamVjdCBSZWdFeHBdIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcW0oZTIpIHsKICAgICAgICAgIHJldHVybiB0eXBlb2YgZTIgPT0gIm9iamVjdCIgJiYgZTIgIT09IG51bGw7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFVtKGUyKSB7CiAgICAgICAgICByZXR1cm4gcW0oZTIpICYmIEptKGUyKSA9PT0gIltvYmplY3QgRGF0ZV0iOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB6bShlMikgewogICAgICAgICAgcmV0dXJuIHFtKGUyKSAmJiAoSm0oZTIpID09PSAiW29iamVjdCBFcnJvcl0iIHx8IGUyIGluc3RhbmNlb2YgRXJyb3IpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBHbShlMikgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiBlMiA9PSAiZnVuY3Rpb24iOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBIbShlMikgewogICAgICAgICAgcmV0dXJuIGUyID09PSBudWxsIHx8IHR5cGVvZiBlMiA9PSAiYm9vbGVhbiIgfHwgdHlwZW9mIGUyID09ICJudW1iZXIiIHx8IHR5cGVvZiBlMiA9PSAic3RyaW5nIiB8fCB0eXBlb2YgZTIgPT0gInN5bWJvbCIgfHwgZTIgPT09IHZvaWQgMDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gSm0oZTIpIHsKICAgICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZTIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBYbShlMiwgdDIpIHsKICAgICAgICAgIGlmICghdDIgfHwgIXFtKHQyKSkKICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgZm9yICh2YXIgbjIgPSBPYmplY3Qua2V5cyh0MiksIHIyID0gbjIubGVuZ3RoOyByMi0tOyApCiAgICAgICAgICAgIGUyW24yW3IyXV0gPSB0MltuMltyMl1dOwogICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBZbShlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZTIsIHQyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gS20oZTIsIHQyKSB7CiAgICAgICAgICBpZiAoZTIgPT09IHQyKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIGZvciAodmFyIG4yID0gZTIubGVuZ3RoLCByMiA9IHQyLmxlbmd0aCwgbzIgPSAwLCBpMiA9IE1hdGgubWluKG4yLCByMik7IG8yIDwgaTI7ICsrbzIpCiAgICAgICAgICAgIGlmIChlMltvMl0gIT09IHQyW28yXSkgewogICAgICAgICAgICAgIG4yID0gZTJbbzJdLCByMiA9IHQyW28yXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG4yIDwgcjIgPyAtMSA6IHIyIDwgbjIgPyAxIDogMDsKICAgICAgICB9CiAgICAgICAgUG0uY29sb3JzID0geyBib2xkOiBbMSwgMjJdLCBpdGFsaWM6IFszLCAyM10sIHVuZGVybGluZTogWzQsIDI0XSwgaW52ZXJzZTogWzcsIDI3XSwgd2hpdGU6IFszNywgMzldLCBncmV5OiBbOTAsIDM5XSwgYmxhY2s6IFszMCwgMzldLCBibHVlOiBbMzQsIDM5XSwgY3lhbjogWzM2LCAzOV0sIGdyZWVuOiBbMzIsIDM5XSwgbWFnZW50YTogWzM1LCAzOV0sIHJlZDogWzMxLCAzOV0sIHllbGxvdzogWzMzLCAzOV0gfSwgUG0uc3R5bGVzID0geyBzcGVjaWFsOiAiY3lhbiIsIG51bWJlcjogInllbGxvdyIsIGJvb2xlYW46ICJ5ZWxsb3ciLCB1bmRlZmluZWQ6ICJncmV5IiwgbnVsbDogImJvbGQiLCBzdHJpbmc6ICJncmVlbiIsIGRhdGU6ICJtYWdlbnRhIiwgcmVnZXhwOiAicmVkIiB9OwogICAgICAgIHZhciBRbSwgWm0gPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LCBleSA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSBbXTsKICAgICAgICAgIGZvciAodmFyIG4yIGluIGUyKQogICAgICAgICAgICBabS5jYWxsKGUyLCBuMikgJiYgdDIucHVzaChuMik7CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfSwgdHkgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7CiAgICAgICAgZnVuY3Rpb24gbnkoKSB7CiAgICAgICAgICByZXR1cm4gUW0gIT09IHZvaWQgMCA/IFFtIDogUW0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIH0ubmFtZSA9PT0gImZvbyI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJ5KGUyKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGUyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb3koZTIpIHsKICAgICAgICAgIHJldHVybiAhZnAoZTIpICYmICh0eXBlb2YgTnMuQXJyYXlCdWZmZXIgPT0gImZ1bmN0aW9uIiAmJiAodHlwZW9mIEFycmF5QnVmZmVyLmlzVmlldyA9PSAiZnVuY3Rpb24iID8gQXJyYXlCdWZmZXIuaXNWaWV3KGUyKSA6ICEhZTIgJiYgKGUyIGluc3RhbmNlb2YgRGF0YVZpZXcgfHwgISEoZTIuYnVmZmVyICYmIGUyLmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSkpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaXkoZTIsIHQyKSB7CiAgICAgICAgICBlMiB8fCBweShlMiwgdHJ1ZSwgdDIsICI9PSIsIGZ5KTsKICAgICAgICB9CiAgICAgICAgdmFyIHV5ID0gL1xzKmZ1bmN0aW9uXHMrKFteXChcc10qKVxzKi87CiAgICAgICAgZnVuY3Rpb24gc3koZTIpIHsKICAgICAgICAgIGlmIChHbShlMikpIHsKICAgICAgICAgICAgaWYgKG55KCkpCiAgICAgICAgICAgICAgcmV0dXJuIGUyLm5hbWU7CiAgICAgICAgICAgIHZhciB0MiA9IGUyLnRvU3RyaW5nKCkubWF0Y2godXkpOwogICAgICAgICAgICByZXR1cm4gdDIgJiYgdDJbMV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGF5KGUyKSB7CiAgICAgICAgICB0aGlzLm5hbWUgPSAiQXNzZXJ0aW9uRXJyb3IiLCB0aGlzLmFjdHVhbCA9IGUyLmFjdHVhbCwgdGhpcy5leHBlY3RlZCA9IGUyLmV4cGVjdGVkLCB0aGlzLm9wZXJhdG9yID0gZTIub3BlcmF0b3IsIGUyLm1lc3NhZ2UgPyAodGhpcy5tZXNzYWdlID0gZTIubWVzc2FnZSwgdGhpcy5nZW5lcmF0ZWRNZXNzYWdlID0gZmFsc2UpIDogKHRoaXMubWVzc2FnZSA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBjeShseShlMy5hY3R1YWwpLCAxMjgpICsgIiAiICsgZTMub3BlcmF0b3IgKyAiICIgKyBjeShseShlMy5leHBlY3RlZCksIDEyOCk7CiAgICAgICAgICB9KHRoaXMpLCB0aGlzLmdlbmVyYXRlZE1lc3NhZ2UgPSB0cnVlKTsKICAgICAgICAgIHZhciB0MiA9IGUyLnN0YWNrU3RhcnRGdW5jdGlvbiB8fCBweTsKICAgICAgICAgIGlmIChFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSkKICAgICAgICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgdDIpOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBuMiA9IG5ldyBFcnJvcigpOwogICAgICAgICAgICBpZiAobjIuc3RhY2spIHsKICAgICAgICAgICAgICB2YXIgcjIgPSBuMi5zdGFjaywgbzIgPSBzeSh0MiksIGkyID0gcjIuaW5kZXhPZigiXG4iICsgbzIpOwogICAgICAgICAgICAgIGlmIChpMiA+PSAwKSB7CiAgICAgICAgICAgICAgICB2YXIgdTIgPSByMi5pbmRleE9mKCJcbiIsIGkyICsgMSk7CiAgICAgICAgICAgICAgICByMiA9IHIyLnN1YnN0cmluZyh1MiArIDEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLnN0YWNrID0gcjI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3koZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGUyID09ICJzdHJpbmciID8gZTIubGVuZ3RoIDwgdDIgPyBlMiA6IGUyLnNsaWNlKDAsIHQyKSA6IGUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBseShlMikgewogICAgICAgICAgaWYgKG55KCkgfHwgIUdtKGUyKSkKICAgICAgICAgICAgcmV0dXJuIFBtKGUyKTsKICAgICAgICAgIHZhciB0MiA9IHN5KGUyKTsKICAgICAgICAgIHJldHVybiAiW0Z1bmN0aW9uIiArICh0MiA/ICI6ICIgKyB0MiA6ICIiKSArICJdIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcHkoZTIsIHQyLCBuMiwgcjIsIG8yKSB7CiAgICAgICAgICB0aHJvdyBuZXcgYXkoeyBtZXNzYWdlOiBuMiwgYWN0dWFsOiBlMiwgZXhwZWN0ZWQ6IHQyLCBvcGVyYXRvcjogcjIsIHN0YWNrU3RhcnRGdW5jdGlvbjogbzIgfSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGZ5KGUyLCB0MikgewogICAgICAgICAgZTIgfHwgcHkoZTIsIHRydWUsIHQyLCAiPT0iLCBmeSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGR5KGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGUyICE9IHQyICYmIHB5KGUyLCB0MiwgbjIsICI9PSIsIGR5KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaHkoZTIsIHQyLCBuMikgewogICAgICAgICAgZTIgPT0gdDIgJiYgcHkoZTIsIHQyLCBuMiwgIiE9IiwgaHkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBneShlMiwgdDIsIG4yKSB7CiAgICAgICAgICB5eShlMiwgdDIsIGZhbHNlKSB8fCBweShlMiwgdDIsIG4yLCAiZGVlcEVxdWFsIiwgZ3kpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBteShlMiwgdDIsIG4yKSB7CiAgICAgICAgICB5eShlMiwgdDIsIHRydWUpIHx8IHB5KGUyLCB0MiwgbjIsICJkZWVwU3RyaWN0RXF1YWwiLCBteSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHl5KGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICBpZiAoZTIgPT09IHQyKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIGlmIChmcChlMikgJiYgZnAodDIpKQogICAgICAgICAgICByZXR1cm4gS20oZTIsIHQyKSA9PT0gMDsKICAgICAgICAgIGlmIChVbShlMikgJiYgVW0odDIpKQogICAgICAgICAgICByZXR1cm4gZTIuZ2V0VGltZSgpID09PSB0Mi5nZXRUaW1lKCk7CiAgICAgICAgICBpZiAoV20oZTIpICYmIFdtKHQyKSkKICAgICAgICAgICAgcmV0dXJuIGUyLnNvdXJjZSA9PT0gdDIuc291cmNlICYmIGUyLmdsb2JhbCA9PT0gdDIuZ2xvYmFsICYmIGUyLm11bHRpbGluZSA9PT0gdDIubXVsdGlsaW5lICYmIGUyLmxhc3RJbmRleCA9PT0gdDIubGFzdEluZGV4ICYmIGUyLmlnbm9yZUNhc2UgPT09IHQyLmlnbm9yZUNhc2U7CiAgICAgICAgICBpZiAoZTIgIT09IG51bGwgJiYgdHlwZW9mIGUyID09ICJvYmplY3QiIHx8IHQyICE9PSBudWxsICYmIHR5cGVvZiB0MiA9PSAib2JqZWN0IikgewogICAgICAgICAgICBpZiAob3koZTIpICYmIG95KHQyKSAmJiByeShlMikgPT09IHJ5KHQyKSAmJiAhKGUyIGluc3RhbmNlb2YgRmxvYXQzMkFycmF5IHx8IGUyIGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5KSkKICAgICAgICAgICAgICByZXR1cm4gS20obmV3IFVpbnQ4QXJyYXkoZTIuYnVmZmVyKSwgbmV3IFVpbnQ4QXJyYXkodDIuYnVmZmVyKSkgPT09IDA7CiAgICAgICAgICAgIGlmIChmcChlMikgIT09IGZwKHQyKSkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHZhciBvMiA9IChyMiA9IHIyIHx8IHsgYWN0dWFsOiBbXSwgZXhwZWN0ZWQ6IFtdIH0pLmFjdHVhbC5pbmRleE9mKGUyKTsKICAgICAgICAgICAgcmV0dXJuIG8yICE9PSAtMSAmJiBvMiA9PT0gcjIuZXhwZWN0ZWQuaW5kZXhPZih0MikgfHwgKHIyLmFjdHVhbC5wdXNoKGUyKSwgcjIuZXhwZWN0ZWQucHVzaCh0MiksIGZ1bmN0aW9uKGUzLCB0MywgbjMsIHIzKSB7CiAgICAgICAgICAgICAgaWYgKGUzID09IG51bGwgfHwgdDMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICBpZiAoSG0oZTMpIHx8IEhtKHQzKSkKICAgICAgICAgICAgICAgIHJldHVybiBlMyA9PT0gdDM7CiAgICAgICAgICAgICAgaWYgKG4zICYmIE9iamVjdC5nZXRQcm90b3R5cGVPZihlMykgIT09IE9iamVjdC5nZXRQcm90b3R5cGVPZih0MykpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgdmFyIG8zID0gRHkoZTMpLCBpMiA9IER5KHQzKTsKICAgICAgICAgICAgICBpZiAobzMgJiYgIWkyIHx8ICFvMyAmJiBpMikKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICBpZiAobzMpCiAgICAgICAgICAgICAgICByZXR1cm4geXkoZTMgPSB0eS5jYWxsKGUzKSwgdDMgPSB0eS5jYWxsKHQzKSwgbjMpOwogICAgICAgICAgICAgIHZhciB1MiwgczIsIGEyID0gZXkoZTMpLCBjMiA9IGV5KHQzKTsKICAgICAgICAgICAgICBpZiAoYTIubGVuZ3RoICE9PSBjMi5sZW5ndGgpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgZm9yIChhMi5zb3J0KCksIGMyLnNvcnQoKSwgczIgPSBhMi5sZW5ndGggLSAxOyBzMiA+PSAwOyBzMi0tKQogICAgICAgICAgICAgICAgaWYgKGEyW3MyXSAhPT0gYzJbczJdKQogICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgZm9yIChzMiA9IGEyLmxlbmd0aCAtIDE7IHMyID49IDA7IHMyLS0pCiAgICAgICAgICAgICAgICBpZiAoIXl5KGUzW3UyID0gYTJbczJdXSwgdDNbdTJdLCBuMywgcjMpKQogICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0oZTIsIHQyLCBuMiwgcjIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuMiA/IGUyID09PSB0MiA6IGUyID09IHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBEeShlMikgewogICAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlMikgPT0gIltvYmplY3QgQXJndW1lbnRzXSI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEV5KGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHl5KGUyLCB0MiwgZmFsc2UpICYmIHB5KGUyLCB0MiwgbjIsICJub3REZWVwRXF1YWwiLCBFeSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEN5KGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHl5KGUyLCB0MiwgdHJ1ZSkgJiYgcHkoZTIsIHQyLCBuMiwgIm5vdERlZXBTdHJpY3RFcXVhbCIsIEN5KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYnkoZTIsIHQyLCBuMikgewogICAgICAgICAgZTIgIT09IHQyICYmIHB5KGUyLCB0MiwgbjIsICI9PT0iLCBieSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHZ5KGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGUyID09PSB0MiAmJiBweShlMiwgdDIsIG4yLCAiIT09IiwgdnkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBBeShlMiwgdDIpIHsKICAgICAgICAgIGlmICghZTIgfHwgIXQyKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQyKSA9PSAiW29iamVjdCBSZWdFeHBdIikKICAgICAgICAgICAgcmV0dXJuIHQyLnRlc3QoZTIpOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGUyIGluc3RhbmNlb2YgdDIpCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9IGNhdGNoIChlMykgewogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuICFFcnJvci5pc1Byb3RvdHlwZU9mKHQyKSAmJiB0Mi5jYWxsKHt9LCBlMikgPT09IHRydWU7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEZ5KGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICB2YXIgbzI7CiAgICAgICAgICBpZiAodHlwZW9mIHQyICE9ICJmdW5jdGlvbiIpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJibG9jayIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7CiAgICAgICAgICB0eXBlb2YgbjIgPT0gInN0cmluZyIgJiYgKHIyID0gbjIsIG4yID0gbnVsbCksIG8yID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgdmFyIHQzOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGUzKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGU0KSB7CiAgICAgICAgICAgICAgdDMgPSBlNDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9KHQyKSwgcjIgPSAobjIgJiYgbjIubmFtZSA/ICIgKCIgKyBuMi5uYW1lICsgIikuIiA6ICIuIikgKyAocjIgPyAiICIgKyByMiA6ICIuIiksIGUyICYmICFvMiAmJiBweShvMiwgbjIsICJNaXNzaW5nIGV4cGVjdGVkIGV4Y2VwdGlvbiIgKyByMik7CiAgICAgICAgICB2YXIgaTIgPSB0eXBlb2YgcjIgPT0gInN0cmluZyIsIHUyID0gIWUyICYmIG8yICYmICFuMjsKICAgICAgICAgIGlmICgoIWUyICYmIHptKG8yKSAmJiBpMiAmJiBBeShvMiwgbjIpIHx8IHUyKSAmJiBweShvMiwgbjIsICJHb3QgdW53YW50ZWQgZXhjZXB0aW9uIiArIHIyKSwgZTIgJiYgbzIgJiYgbjIgJiYgIUF5KG8yLCBuMikgfHwgIWUyICYmIG8yKQogICAgICAgICAgICB0aHJvdyBvMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24geHkoZTIsIHQyLCBuMikgewogICAgICAgICAgRnkodHJ1ZSwgZTIsIHQyLCBuMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFN5KGUyLCB0MiwgbjIpIHsKICAgICAgICAgIEZ5KGZhbHNlLCBlMiwgdDIsIG4yKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gd3koZTIpIHsKICAgICAgICAgIGlmIChlMikKICAgICAgICAgICAgdGhyb3cgZTI7CiAgICAgICAgfQogICAgICAgIGl5LkFzc2VydGlvbkVycm9yID0gYXksIGttKGF5LCBFcnJvciksIGl5LmZhaWwgPSBweSwgaXkub2sgPSBmeSwgaXkuZXF1YWwgPSBkeSwgaXkubm90RXF1YWwgPSBoeSwgaXkuZGVlcEVxdWFsID0gZ3ksIGl5LmRlZXBTdHJpY3RFcXVhbCA9IG15LCBpeS5ub3REZWVwRXF1YWwgPSBFeSwgaXkubm90RGVlcFN0cmljdEVxdWFsID0gQ3ksIGl5LnN0cmljdEVxdWFsID0gYnksIGl5Lm5vdFN0cmljdEVxdWFsID0gdnksIGl5LnRocm93cyA9IHh5LCBpeS5kb2VzTm90VGhyb3cgPSBTeSwgaXkuaWZFcnJvciA9IHd5OwogICAgICAgIHZhciBUeSA9IHQoT2JqZWN0LmZyZWV6ZSh7IF9fcHJvdG9fXzogbnVsbCwgZGVmYXVsdDogaXksIEFzc2VydGlvbkVycm9yOiBheSwgZmFpbDogcHksIG9rOiBmeSwgYXNzZXJ0OiBmeSwgZXF1YWw6IGR5LCBub3RFcXVhbDogaHksIGRlZXBFcXVhbDogZ3ksIGRlZXBTdHJpY3RFcXVhbDogbXksIG5vdERlZXBFcXVhbDogRXksIG5vdERlZXBTdHJpY3RFcXVhbDogQ3ksIHN0cmljdEVxdWFsOiBieSwgbm90U3RyaWN0RXF1YWw6IHZ5LCB0aHJvd3M6IHh5LCBkb2VzTm90VGhyb3c6IFN5LCBpZkVycm9yOiB3eSB9KSk7CiAgICAgICAgY29uc3QgQnkgPSBUeSwgeyBidWlsZGVyczogeyBsaW5lOiBOeSwgaGFyZGxpbmU6IGt5LCBicmVha1BhcmVudDogUHksIGluZGVudDogT3ksIGxpbmVTdWZmaXg6IEl5LCBqb2luOiBMeSwgY3Vyc29yOiBqeSB9IH0gPSBaYywgeyBoYXNOZXdsaW5lOiBfeSwgc2tpcE5ld2xpbmU6IE15LCBza2lwU3BhY2VzOiBSeSwgaXNQcmV2aW91c0xpbmVFbXB0eTogVnksIGFkZExlYWRpbmdDb21tZW50OiAkeSwgYWRkRGFuZ2xpbmdDb21tZW50OiBXeSwgYWRkVHJhaWxpbmdDb21tZW50OiBxeSB9ID0gZGMsIFV5ID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7CiAgICAgICAgZnVuY3Rpb24genkoZTIsIHQyLCBuMikgewogICAgICAgICAgaWYgKCFlMikKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY29uc3QgeyBwcmludGVyOiByMiwgbG9jU3RhcnQ6IG8yLCBsb2NFbmQ6IGkyIH0gPSB0MjsKICAgICAgICAgIGlmIChuMikgewogICAgICAgICAgICBpZiAocjIuY2FuQXR0YWNoQ29tbWVudCAmJiByMi5jYW5BdHRhY2hDb21tZW50KGUyKSkgewogICAgICAgICAgICAgIGxldCB0MzsKICAgICAgICAgICAgICBmb3IgKHQzID0gbjIubGVuZ3RoIC0gMTsgdDMgPj0gMCAmJiAhKG8yKG4yW3QzXSkgPD0gbzIoZTIpICYmIGkyKG4yW3QzXSkgPD0gaTIoZTIpKTsgLS10MykKICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICByZXR1cm4gdm9pZCBuMi5zcGxpY2UodDMgKyAxLCAwLCBlMik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoVXkuaGFzKGUyKSkKICAgICAgICAgICAgcmV0dXJuIFV5LmdldChlMik7CiAgICAgICAgICBjb25zdCB1MiA9IHIyLmdldENvbW1lbnRDaGlsZE5vZGVzICYmIHIyLmdldENvbW1lbnRDaGlsZE5vZGVzKGUyLCB0MikgfHwgdHlwZW9mIGUyID09ICJvYmplY3QiICYmIE9iamVjdC5lbnRyaWVzKGUyKS5maWx0ZXIoKGUzKSA9PiB7CiAgICAgICAgICAgIGxldCBbdDNdID0gZTM7CiAgICAgICAgICAgIHJldHVybiB0MyAhPT0gImVuY2xvc2luZ05vZGUiICYmIHQzICE9PSAicHJlY2VkaW5nTm9kZSIgJiYgdDMgIT09ICJmb2xsb3dpbmdOb2RlIiAmJiB0MyAhPT0gInRva2VucyIgJiYgdDMgIT09ICJjb21tZW50cyI7CiAgICAgICAgICB9KS5tYXAoKGUzKSA9PiB7CiAgICAgICAgICAgIGxldCBbLCB0M10gPSBlMzsKICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAodTIpIHsKICAgICAgICAgICAgbjIgfHwgKG4yID0gW10sIFV5LnNldChlMiwgbjIpKTsKICAgICAgICAgICAgZm9yIChjb25zdCBlMyBvZiB1MikKICAgICAgICAgICAgICB6eShlMywgdDIsIG4yKTsKICAgICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBHeShlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgY29uc3QgeyBsb2NTdGFydDogbzIsIGxvY0VuZDogaTIgfSA9IG4yLCB1MiA9IG8yKHQyKSwgczIgPSBpMih0MiksIGEyID0genkoZTIsIG4yKTsKICAgICAgICAgIGxldCBjMiwgbDIsIHAyID0gMCwgZjIgPSBhMi5sZW5ndGg7CiAgICAgICAgICBmb3IgKDsgcDIgPCBmMjsgKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gcDIgKyBmMiA+PiAxLCByMyA9IGEyW2UzXSwgZDIgPSBvMihyMyksIGgyID0gaTIocjMpOwogICAgICAgICAgICBpZiAoZDIgPD0gdTIgJiYgczIgPD0gaDIpCiAgICAgICAgICAgICAgcmV0dXJuIEd5KHIzLCB0MiwgbjIsIHIzKTsKICAgICAgICAgICAgaWYgKGgyIDw9IHUyKQogICAgICAgICAgICAgIGMyID0gcjMsIHAyID0gZTMgKyAxOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBpZiAoIShzMiA8PSBkMikpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNvbW1lbnQgbG9jYXRpb24gb3ZlcmxhcHMgd2l0aCBub2RlIGxvY2F0aW9uIik7CiAgICAgICAgICAgICAgbDIgPSByMywgZjIgPSBlMzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHIyICYmIHIyLnR5cGUgPT09ICJUZW1wbGF0ZUxpdGVyYWwiKSB7CiAgICAgICAgICAgIGNvbnN0IHsgcXVhc2lzOiBlMyB9ID0gcjIsIG8zID0gWnkoZTMsIHQyLCBuMik7CiAgICAgICAgICAgIGMyICYmIFp5KGUzLCBjMiwgbjIpICE9PSBvMyAmJiAoYzIgPSBudWxsKSwgbDIgJiYgWnkoZTMsIGwyLCBuMikgIT09IG8zICYmIChsMiA9IG51bGwpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHsgZW5jbG9zaW5nTm9kZTogcjIsIHByZWNlZGluZ05vZGU6IGMyLCBmb2xsb3dpbmdOb2RlOiBsMiB9OwogICAgICAgIH0KICAgICAgICBjb25zdCBIeSA9ICgpID0+IGZhbHNlOwogICAgICAgIGNvbnN0IEp5ID0gKGUyKSA9PiAhL1tcU1xuXHUyMDI4XHUyMDI5XS8udGVzdChlMik7CiAgICAgICAgZnVuY3Rpb24gWHkoZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIGNvbnN0IHsgY29tbWVudDogbzIsIHByZWNlZGluZ05vZGU6IGkyIH0gPSBuMltyMl0sIHsgbG9jU3RhcnQ6IHUyLCBsb2NFbmQ6IHMyIH0gPSB0MjsKICAgICAgICAgIGxldCBhMiA9IHUyKG8yKTsKICAgICAgICAgIGlmIChpMikKICAgICAgICAgICAgZm9yIChsZXQgdDMgPSByMiAtIDE7IHQzID49IDA7IHQzLS0pIHsKICAgICAgICAgICAgICBjb25zdCB7IGNvbW1lbnQ6IHIzLCBwcmVjZWRpbmdOb2RlOiBvMyB9ID0gbjJbdDNdOwogICAgICAgICAgICAgIGlmIChvMyAhPT0gaTIgfHwgIUp5KGUyLnNsaWNlKHMyKHIzKSwgYTIpKSkKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGEyID0gdTIocjMpOwogICAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gX3koZTIsIGEyLCB7IGJhY2t3YXJkczogdHJ1ZSB9KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gWXkoZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIGNvbnN0IHsgY29tbWVudDogbzIsIGZvbGxvd2luZ05vZGU6IGkyIH0gPSBuMltyMl0sIHsgbG9jU3RhcnQ6IHUyLCBsb2NFbmQ6IHMyIH0gPSB0MjsKICAgICAgICAgIGxldCBhMiA9IHMyKG8yKTsKICAgICAgICAgIGlmIChpMikKICAgICAgICAgICAgZm9yIChsZXQgdDMgPSByMiArIDE7IHQzIDwgbjIubGVuZ3RoOyB0MysrKSB7CiAgICAgICAgICAgICAgY29uc3QgeyBjb21tZW50OiByMywgZm9sbG93aW5nTm9kZTogbzMgfSA9IG4yW3QzXTsKICAgICAgICAgICAgICBpZiAobzMgIT09IGkyIHx8ICFKeShlMi5zbGljZShhMiwgdTIocjMpKSkpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBhMiA9IHMyKHIzKTsKICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIF95KGUyLCBhMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEt5KGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIubGVuZ3RoOwogICAgICAgICAgaWYgKHIyID09PSAwKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBjb25zdCB7IHByZWNlZGluZ05vZGU6IG8yLCBmb2xsb3dpbmdOb2RlOiBpMiwgZW5jbG9zaW5nTm9kZTogdTIgfSA9IGUyWzBdLCBzMiA9IG4yLnByaW50ZXIuZ2V0R2FwUmVnZXggJiYgbjIucHJpbnRlci5nZXRHYXBSZWdleCh1MikgfHwgL15bXHMoXSokLzsKICAgICAgICAgIGxldCBhMiwgYzIgPSBuMi5sb2NTdGFydChpMik7CiAgICAgICAgICBmb3IgKGEyID0gcjI7IGEyID4gMDsgLS1hMikgewogICAgICAgICAgICBjb25zdCB7IGNvbW1lbnQ6IHIzLCBwcmVjZWRpbmdOb2RlOiB1MywgZm9sbG93aW5nTm9kZTogbDIgfSA9IGUyW2EyIC0gMV07CiAgICAgICAgICAgIEJ5LnN0cmljdEVxdWFsKHUzLCBvMiksIEJ5LnN0cmljdEVxdWFsKGwyLCBpMik7CiAgICAgICAgICAgIGNvbnN0IHAyID0gdDIuc2xpY2UobjIubG9jRW5kKHIzKSwgYzIpOwogICAgICAgICAgICBpZiAoIXMyLnRlc3QocDIpKQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjMiA9IG4yLmxvY1N0YXJ0KHIzKTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoY29uc3QgW3QzLCB7IGNvbW1lbnQ6IG4zIH1dIG9mIGUyLmVudHJpZXMoKSkKICAgICAgICAgICAgdDMgPCBhMiA/IHF5KG8yLCBuMykgOiAkeShpMiwgbjMpOwogICAgICAgICAgZm9yIChjb25zdCBlMyBvZiBbbzIsIGkyXSkKICAgICAgICAgICAgZTMuY29tbWVudHMgJiYgZTMuY29tbWVudHMubGVuZ3RoID4gMSAmJiBlMy5jb21tZW50cy5zb3J0KChlNCwgdDMpID0+IG4yLmxvY1N0YXJ0KGU0KSAtIG4yLmxvY1N0YXJ0KHQzKSk7CiAgICAgICAgICBlMi5sZW5ndGggPSAwOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBReShlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBlMi5nZXRWYWx1ZSgpLnByaW50ZWQgPSB0cnVlLCB0Mi5wcmludGVyLnByaW50Q29tbWVudChlMiwgdDIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBaeShlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IG4yLmxvY1N0YXJ0KHQyKSAtIDE7CiAgICAgICAgICBmb3IgKGxldCB0MyA9IDE7IHQzIDwgZTIubGVuZ3RoOyArK3QzKQogICAgICAgICAgICBpZiAocjIgPCBuMi5sb2NTdGFydChlMlt0M10pKQogICAgICAgICAgICAgIHJldHVybiB0MyAtIDE7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZUQoZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgaWYgKCFyMikKICAgICAgICAgICAgcmV0dXJuIHt9OwogICAgICAgICAgbGV0IG8yID0gcjIuY29tbWVudHMgfHwgW107CiAgICAgICAgICBuMiAmJiAobzIgPSBvMi5maWx0ZXIoKGUzKSA9PiAhbjIuaGFzKGUzKSkpOwogICAgICAgICAgY29uc3QgaTIgPSByMiA9PT0gdDIuY3Vyc29yTm9kZTsKICAgICAgICAgIGlmIChvMi5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgY29uc3QgZTMgPSBpMiA/IGp5IDogIiI7CiAgICAgICAgICAgIHJldHVybiB7IGxlYWRpbmc6IGUzLCB0cmFpbGluZzogZTMgfTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHUyID0gW10sIHMyID0gW107CiAgICAgICAgICByZXR1cm4gZTIuZWFjaCgoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHIzID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgaWYgKG4yICYmIG4yLmhhcyhyMykpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB7IGxlYWRpbmc6IG8zLCB0cmFpbGluZzogaTMgfSA9IHIzOwogICAgICAgICAgICBvMyA/IHUyLnB1c2goZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgICAgY29uc3QgbjMgPSBlMy5nZXRWYWx1ZSgpLCByNCA9IFtReShlMywgdDMpXSwgeyBwcmludGVyOiBvNCwgb3JpZ2luYWxUZXh0OiBpNCwgbG9jU3RhcnQ6IHUzLCBsb2NFbmQ6IHMzIH0gPSB0MzsKICAgICAgICAgICAgICBpZiAobzQuaXNCbG9ja0NvbW1lbnQgJiYgbzQuaXNCbG9ja0NvbW1lbnQobjMpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlNCA9IF95KGk0LCBzMyhuMykpID8gX3koaTQsIHUzKG4zKSwgeyBiYWNrd2FyZHM6IHRydWUgfSkgPyBreSA6IE55IDogIiAiOwogICAgICAgICAgICAgICAgcjQucHVzaChlNCk7CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICByNC5wdXNoKGt5KTsKICAgICAgICAgICAgICBjb25zdCBhMiA9IE15KGk0LCBSeShpNCwgczMobjMpKSk7CiAgICAgICAgICAgICAgcmV0dXJuIGEyICE9PSBmYWxzZSAmJiBfeShpNCwgYTIpICYmIHI0LnB1c2goa3kpLCByNDsKICAgICAgICAgICAgfShlMiwgdDIpKSA6IGkzICYmIHMyLnB1c2goZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgICAgY29uc3QgbjMgPSBlMy5nZXRWYWx1ZSgpLCByNCA9IFF5KGUzLCB0MyksIHsgcHJpbnRlcjogbzQsIG9yaWdpbmFsVGV4dDogaTQsIGxvY1N0YXJ0OiB1MyB9ID0gdDMsIHMzID0gbzQuaXNCbG9ja0NvbW1lbnQgJiYgbzQuaXNCbG9ja0NvbW1lbnQobjMpOwogICAgICAgICAgICAgIGlmIChfeShpNCwgdTMobjMpLCB7IGJhY2t3YXJkczogdHJ1ZSB9KSkgewogICAgICAgICAgICAgICAgY29uc3QgZTQgPSBWeShpNCwgbjMsIHUzKTsKICAgICAgICAgICAgICAgIHJldHVybiBJeShba3ksIGU0ID8ga3kgOiAiIiwgcjRdKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbGV0IGEyID0gWyIgIiwgcjRdOwogICAgICAgICAgICAgIHJldHVybiBzMyB8fCAoYTIgPSBbSXkoYTIpLCBQeV0pLCBhMjsKICAgICAgICAgICAgfShlMiwgdDIpKTsKICAgICAgICAgIH0sICJjb21tZW50cyIpLCBpMiAmJiAodTIudW5zaGlmdChqeSksIHMyLnB1c2goankpKSwgeyBsZWFkaW5nOiB1MiwgdHJhaWxpbmc6IHMyIH07CiAgICAgICAgfQogICAgICAgIHZhciB0RCA9IHsgYXR0YWNoOiBmdW5jdGlvbihlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGUyKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY29uc3QgbzIgPSBbXSwgeyBsb2NTdGFydDogaTIsIGxvY0VuZDogdTIsIHByaW50ZXI6IHsgaGFuZGxlQ29tbWVudHM6IHMyID0ge30gfSB9ID0gcjIsIHsgYXZvaWRBc3RNdXRhdGlvbjogYTIsIG93bkxpbmU6IGMyID0gSHksIGVuZE9mTGluZTogbDIgPSBIeSwgcmVtYWluaW5nOiBwMiA9IEh5IH0gPSBzMiwgZjIgPSBlMi5tYXAoKG8zLCBpMykgPT4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBHeSh0MiwgbzMsIHIyKSksIHt9LCB7IGNvbW1lbnQ6IG8zLCB0ZXh0OiBuMiwgb3B0aW9uczogcjIsIGFzdDogdDIsIGlzTGFzdENvbW1lbnQ6IGUyLmxlbmd0aCAtIDEgPT09IGkzIH0pKTsKICAgICAgICAgIGZvciAoY29uc3QgW2UzLCB0M10gb2YgZjIuZW50cmllcygpKSB7CiAgICAgICAgICAgIGNvbnN0IHsgY29tbWVudDogbjMsIHByZWNlZGluZ05vZGU6IHIzLCBlbmNsb3NpbmdOb2RlOiBzMywgZm9sbG93aW5nTm9kZTogZDIsIHRleHQ6IGgyLCBvcHRpb25zOiBnMiwgYXN0OiBtMiwgaXNMYXN0Q29tbWVudDogeTIgfSA9IHQzOwogICAgICAgICAgICBpZiAoZzIucGFyc2VyID09PSAianNvbiIgfHwgZzIucGFyc2VyID09PSAianNvbjUiIHx8IGcyLnBhcnNlciA9PT0gIl9fanNfZXhwcmVzc2lvbiIgfHwgZzIucGFyc2VyID09PSAiX192dWVfZXhwcmVzc2lvbiIpIHsKICAgICAgICAgICAgICBpZiAoaTIobjMpIC0gaTIobTIpIDw9IDApIHsKICAgICAgICAgICAgICAgICR5KG0yLCBuMyk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHUyKG4zKSAtIHUyKG0yKSA+PSAwKSB7CiAgICAgICAgICAgICAgICBxeShtMiwgbjMpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBEMjsKICAgICAgICAgICAgaWYgKGEyID8gRDIgPSBbdDNdIDogKG4zLmVuY2xvc2luZ05vZGUgPSBzMywgbjMucHJlY2VkaW5nTm9kZSA9IHIzLCBuMy5mb2xsb3dpbmdOb2RlID0gZDIsIEQyID0gW24zLCBoMiwgZzIsIG0yLCB5Ml0pLCBYeShoMiwgZzIsIGYyLCBlMykpCiAgICAgICAgICAgICAgbjMucGxhY2VtZW50ID0gIm93bkxpbmUiLCBjMiguLi5EMikgfHwgKGQyID8gJHkoZDIsIG4zKSA6IHIzID8gcXkocjMsIG4zKSA6IFd5KHMzIHx8IG0yLCBuMykpOwogICAgICAgICAgICBlbHNlIGlmIChZeShoMiwgZzIsIGYyLCBlMykpCiAgICAgICAgICAgICAgbjMucGxhY2VtZW50ID0gImVuZE9mTGluZSIsIGwyKC4uLkQyKSB8fCAocjMgPyBxeShyMywgbjMpIDogZDIgPyAkeShkMiwgbjMpIDogV3koczMgfHwgbTIsIG4zKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKG4zLnBsYWNlbWVudCA9ICJyZW1haW5pbmciLCBwMiguLi5EMikpCiAgICAgICAgICAgICAgOwogICAgICAgICAgICBlbHNlIGlmIChyMyAmJiBkMikgewogICAgICAgICAgICAgIGNvbnN0IGU0ID0gbzIubGVuZ3RoOwogICAgICAgICAgICAgIGlmIChlNCA+IDApIHsKICAgICAgICAgICAgICAgIG8yW2U0IC0gMV0uZm9sbG93aW5nTm9kZSAhPT0gZDIgJiYgS3kobzIsIGgyLCBnMik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG8yLnB1c2godDMpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICByMyA/IHF5KHIzLCBuMykgOiBkMiA/ICR5KGQyLCBuMykgOiBXeShzMyB8fCBtMiwgbjMpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKEt5KG8yLCBuMiwgcjIpLCAhYTIpCiAgICAgICAgICAgIGZvciAoY29uc3QgdDMgb2YgZTIpCiAgICAgICAgICAgICAgZGVsZXRlIHQzLnByZWNlZGluZ05vZGUsIGRlbGV0ZSB0My5lbmNsb3NpbmdOb2RlLCBkZWxldGUgdDMuZm9sbG93aW5nTm9kZTsKICAgICAgICB9LCBwcmludENvbW1lbnRzOiBmdW5jdGlvbihlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgY29uc3QgeyBsZWFkaW5nOiBvMiwgdHJhaWxpbmc6IGkyIH0gPSBlRChlMiwgbjIsIHIyKTsKICAgICAgICAgIHJldHVybiBvMiB8fCBpMiA/IFtvMiwgdDIsIGkyXSA6IHQyOwogICAgICAgIH0sIHByaW50Q29tbWVudHNTZXBhcmF0ZWx5OiBlRCwgcHJpbnREYW5nbGluZ0NvbW1lbnRzOiBmdW5jdGlvbihlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgY29uc3QgbzIgPSBbXSwgaTIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgcmV0dXJuIGkyICYmIGkyLmNvbW1lbnRzID8gKGUyLmVhY2goKCkgPT4gewogICAgICAgICAgICBjb25zdCBuMyA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICAgIG4zLmxlYWRpbmcgfHwgbjMudHJhaWxpbmcgfHwgcjIgJiYgIXIyKG4zKSB8fCBvMi5wdXNoKFF5KGUyLCB0MikpOwogICAgICAgICAgfSwgImNvbW1lbnRzIiksIG8yLmxlbmd0aCA9PT0gMCA/ICIiIDogbjIgPyBMeShreSwgbzIpIDogT3koW2t5LCBMeShreSwgbzIpXSkpIDogIiI7CiAgICAgICAgfSwgZ2V0U29ydGVkQ2hpbGROb2RlczogenksIGVuc3VyZUFsbENvbW1lbnRzUHJpbnRlZDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGlmIChlMikKICAgICAgICAgICAgZm9yIChjb25zdCB0MiBvZiBlMikgewogICAgICAgICAgICAgIGlmICghdDIucHJpbnRlZCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ29tbWVudCAiJyArIHQyLnZhbHVlLnRyaW0oKSArICciIHdhcyBub3QgcHJpbnRlZC4gUGxlYXNlIHJlcG9ydCB0aGlzIGVycm9yIScpOwogICAgICAgICAgICAgIGRlbGV0ZSB0Mi5wcmludGVkOwogICAgICAgICAgICB9CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IG5EID0gYXU7CiAgICAgICAgZnVuY3Rpb24gckQoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IG9EKGUyLnN0YWNrLCB0Mik7CiAgICAgICAgICByZXR1cm4gbjIgPT09IC0xID8gbnVsbCA6IGUyLnN0YWNrW24yXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb0QoZTIsIHQyKSB7CiAgICAgICAgICBmb3IgKGxldCBuMiA9IGUyLmxlbmd0aCAtIDE7IG4yID49IDA7IG4yIC09IDIpIHsKICAgICAgICAgICAgY29uc3QgcjIgPSBlMltuMl07CiAgICAgICAgICAgIGlmIChyMiAmJiAhQXJyYXkuaXNBcnJheShyMikgJiYgLS10MiA8IDApCiAgICAgICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICB2YXIgaUQgPSBjbGFzcyB7CiAgICAgICAgICBjb25zdHJ1Y3RvcihlMikgewogICAgICAgICAgICB0aGlzLnN0YWNrID0gW2UyXTsKICAgICAgICAgIH0KICAgICAgICAgIGdldE5hbWUoKSB7CiAgICAgICAgICAgIGNvbnN0IHsgc3RhY2s6IGUyIH0gPSB0aGlzLCB7IGxlbmd0aDogdDIgfSA9IGUyOwogICAgICAgICAgICByZXR1cm4gdDIgPiAxID8gZTJbdDIgLSAyXSA6IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBnZXRWYWx1ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG5EKHRoaXMuc3RhY2spOwogICAgICAgICAgfQogICAgICAgICAgZ2V0Tm9kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHJEKHRoaXMsIGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzBdIDogMCk7CiAgICAgICAgICB9CiAgICAgICAgICBnZXRQYXJlbnROb2RlKCkgewogICAgICAgICAgICByZXR1cm4gckQodGhpcywgKGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzBdIDogMCkgKyAxKTsKICAgICAgICAgIH0KICAgICAgICAgIGNhbGwoZTIpIHsKICAgICAgICAgICAgY29uc3QgeyBzdGFjazogdDIgfSA9IHRoaXMsIHsgbGVuZ3RoOiBuMiB9ID0gdDI7CiAgICAgICAgICAgIGxldCByMiA9IG5EKHQyKTsKICAgICAgICAgICAgZm9yICh2YXIgbzIgPSBhcmd1bWVudHMubGVuZ3RoLCBpMiA9IG5ldyBBcnJheShvMiA+IDEgPyBvMiAtIDEgOiAwKSwgdTIgPSAxOyB1MiA8IG8yOyB1MisrKQogICAgICAgICAgICAgIGkyW3UyIC0gMV0gPSBhcmd1bWVudHNbdTJdOwogICAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIGkyKQogICAgICAgICAgICAgIHIyID0gcjJbZTNdLCB0Mi5wdXNoKGUzLCByMik7CiAgICAgICAgICAgIGNvbnN0IHMyID0gZTIodGhpcyk7CiAgICAgICAgICAgIHJldHVybiB0Mi5sZW5ndGggPSBuMiwgczI7CiAgICAgICAgICB9CiAgICAgICAgICBjYWxsUGFyZW50KGUyKSB7CiAgICAgICAgICAgIGxldCB0MiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDogMDsKICAgICAgICAgICAgY29uc3QgbjIgPSBvRCh0aGlzLnN0YWNrLCB0MiArIDEpLCByMiA9IHRoaXMuc3RhY2suc3BsaWNlKG4yICsgMSksIG8yID0gZTIodGhpcyk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YWNrLnB1c2goLi4ucjIpLCBvMjsKICAgICAgICAgIH0KICAgICAgICAgIGVhY2goZTIpIHsKICAgICAgICAgICAgY29uc3QgeyBzdGFjazogdDIgfSA9IHRoaXMsIHsgbGVuZ3RoOiBuMiB9ID0gdDI7CiAgICAgICAgICAgIGxldCByMiA9IG5EKHQyKTsKICAgICAgICAgICAgZm9yICh2YXIgbzIgPSBhcmd1bWVudHMubGVuZ3RoLCBpMiA9IG5ldyBBcnJheShvMiA+IDEgPyBvMiAtIDEgOiAwKSwgdTIgPSAxOyB1MiA8IG8yOyB1MisrKQogICAgICAgICAgICAgIGkyW3UyIC0gMV0gPSBhcmd1bWVudHNbdTJdOwogICAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIGkyKQogICAgICAgICAgICAgIHIyID0gcjJbZTNdLCB0Mi5wdXNoKGUzLCByMik7CiAgICAgICAgICAgIGZvciAobGV0IG4zID0gMDsgbjMgPCByMi5sZW5ndGg7ICsrbjMpCiAgICAgICAgICAgICAgdDIucHVzaChuMywgcjJbbjNdKSwgZTIodGhpcywgbjMsIHIyKSwgdDIubGVuZ3RoIC09IDI7CiAgICAgICAgICAgIHQyLmxlbmd0aCA9IG4yOwogICAgICAgICAgfQogICAgICAgICAgbWFwKGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gW107CiAgICAgICAgICAgIGZvciAodmFyIG4yID0gYXJndW1lbnRzLmxlbmd0aCwgcjIgPSBuZXcgQXJyYXkobjIgPiAxID8gbjIgLSAxIDogMCksIG8yID0gMTsgbzIgPCBuMjsgbzIrKykKICAgICAgICAgICAgICByMltvMiAtIDFdID0gYXJndW1lbnRzW28yXTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaCgobjMsIHIzLCBvMykgPT4gewogICAgICAgICAgICAgIHQyW3IzXSA9IGUyKG4zLCByMywgbzMpOwogICAgICAgICAgICB9LCAuLi5yMiksIHQyOwogICAgICAgICAgfQogICAgICAgICAgdHJ5KGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHsgc3RhY2s6IHQyIH0gPSB0aGlzLCBuMiA9IFsuLi50Ml07CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUyKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdDIubGVuZ3RoID0gMCwgdDIucHVzaCguLi5uMik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG1hdGNoKCkgewogICAgICAgICAgICBsZXQgZTIgPSB0aGlzLnN0YWNrLmxlbmd0aCAtIDEsIHQyID0gbnVsbCwgbjIgPSB0aGlzLnN0YWNrW2UyLS1dOwogICAgICAgICAgICBmb3IgKHZhciByMiA9IGFyZ3VtZW50cy5sZW5ndGgsIG8yID0gbmV3IEFycmF5KHIyKSwgaTIgPSAwOyBpMiA8IHIyOyBpMisrKQogICAgICAgICAgICAgIG8yW2kyXSA9IGFyZ3VtZW50c1tpMl07CiAgICAgICAgICAgIGZvciAoY29uc3QgcjMgb2YgbzIpIHsKICAgICAgICAgICAgICBpZiAobjIgPT09IHZvaWQgMCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICBsZXQgbzMgPSBudWxsOwogICAgICAgICAgICAgIGlmICh0eXBlb2YgdDIgPT0gIm51bWJlciIgJiYgKG8zID0gdDIsIHQyID0gdGhpcy5zdGFja1tlMi0tXSwgbjIgPSB0aGlzLnN0YWNrW2UyLS1dKSwgcjMgJiYgIXIzKG4yLCB0MiwgbzMpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIHQyID0gdGhpcy5zdGFja1tlMi0tXSwgbjIgPSB0aGlzLnN0YWNrW2UyLS1dOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgZmluZEFuY2VzdG9yKGUyKSB7CiAgICAgICAgICAgIGxldCB0MiA9IHRoaXMuc3RhY2subGVuZ3RoIC0gMSwgbjIgPSBudWxsLCByMiA9IHRoaXMuc3RhY2tbdDItLV07CiAgICAgICAgICAgIGZvciAoOyByMjsgKSB7CiAgICAgICAgICAgICAgbGV0IG8yID0gbnVsbDsKICAgICAgICAgICAgICBpZiAodHlwZW9mIG4yID09ICJudW1iZXIiICYmIChvMiA9IG4yLCBuMiA9IHRoaXMuc3RhY2tbdDItLV0sIHIyID0gdGhpcy5zdGFja1t0Mi0tXSksIG4yICE9PSBudWxsICYmIGUyKHIyLCBuMiwgbzIpKQogICAgICAgICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgICAgICAgIG4yID0gdGhpcy5zdGFja1t0Mi0tXSwgcjIgPSB0aGlzLnN0YWNrW3QyLS1dOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBjb25zdCB7IHV0aWxzOiB7IHN0cmlwVHJhaWxpbmdIYXJkbGluZTogdUQgfSB9ID0gWmMsIHsgbm9ybWFsaXplOiBzRCB9ID0gQm0sIGFEID0gdEQ7CiAgICAgICAgdmFyIGNEID0geyBwcmludFN1YnRyZWU6IGZ1bmN0aW9uKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICBpZiAobjIucHJpbnRlci5lbWJlZCAmJiBuMi5lbWJlZGRlZExhbmd1YWdlRm9ybWF0dGluZyA9PT0gImF1dG8iKQogICAgICAgICAgICByZXR1cm4gbjIucHJpbnRlci5lbWJlZChlMiwgdDIsIChlMywgdDMsIG8yKSA9PiBmdW5jdGlvbihlNCwgdDQsIG4zLCByMykgewogICAgICAgICAgICAgIGxldCB7IHN0cmlwVHJhaWxpbmdIYXJkbGluZTogbzMgPSBmYWxzZSB9ID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgJiYgYXJndW1lbnRzWzRdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbNF0gOiB7fTsKICAgICAgICAgICAgICBjb25zdCBpMiA9IHNEKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBuMyksIHQ0KSwge30sIHsgcGFyZW50UGFyc2VyOiBuMy5wYXJzZXIsIG9yaWdpbmFsVGV4dDogZTQgfSksIHsgcGFzc1Rocm91Z2g6IHRydWUgfSksIHUyID0gRG0ucGFyc2UoZTQsIGkyKSwgeyBhc3Q6IHMyIH0gPSB1MjsKICAgICAgICAgICAgICBlNCA9IHUyLnRleHQ7CiAgICAgICAgICAgICAgY29uc3QgYTIgPSBzMi5jb21tZW50czsKICAgICAgICAgICAgICBkZWxldGUgczIuY29tbWVudHMsIGFELmF0dGFjaChhMiwgczIsIGU0LCBpMiksIGkyW1N5bWJvbC5mb3IoImNvbW1lbnRzIildID0gYTIgfHwgW10sIGkyW1N5bWJvbC5mb3IoInRva2VucyIpXSA9IHMyLnRva2VucyB8fCBbXTsKICAgICAgICAgICAgICBjb25zdCBjMiA9IHIzKHMyLCBpMik7CiAgICAgICAgICAgICAgaWYgKGFELmVuc3VyZUFsbENvbW1lbnRzUHJpbnRlZChhMiksIG8zKQogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBjMiA9PSAic3RyaW5nIiA/IGMyLnJlcGxhY2UoLyg/OlxyP1xuKSokLywgIiIpIDogdUQoYzIpOwogICAgICAgICAgICAgIHJldHVybiBjMjsKICAgICAgICAgICAgfShlMywgdDMsIG4yLCByMiwgbzIpLCBuMik7CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IGxEID0gaUQsIHsgYnVpbGRlcnM6IHsgaGFyZGxpbmU6IHBELCBhZGRBbGlnbm1lbnRUb0RvYzogZkQgfSwgdXRpbHM6IHsgcHJvcGFnYXRlQnJlYWtzOiBkRCB9IH0gPSBaYywgeyBwcmludENvbW1lbnRzOiBoRCB9ID0gdEQsIGdEID0gY0Q7CiAgICAgICAgZnVuY3Rpb24gbUQoZTIsIHQyKSB7CiAgICAgICAgICBsZXQgbjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1syXSA6IDA7CiAgICAgICAgICBjb25zdCB7IHByaW50ZXI6IHIyIH0gPSB0MjsKICAgICAgICAgIHIyLnByZXByb2Nlc3MgJiYgKGUyID0gcjIucHJlcHJvY2VzcyhlMiwgdDIpKTsKICAgICAgICAgIGNvbnN0IG8yID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSwgaTIgPSBuZXcgbEQoZTIpOwogICAgICAgICAgbGV0IHUyID0gczIoKTsKICAgICAgICAgIHJldHVybiBuMiA+IDAgJiYgKHUyID0gZkQoW3BELCB1Ml0sIG4yLCB0Mi50YWJXaWR0aCkpLCBkRCh1MiksIHUyOwogICAgICAgICAgZnVuY3Rpb24gczIoZTMsIHQzKSB7CiAgICAgICAgICAgIHJldHVybiBlMyA9PT0gdm9pZCAwIHx8IGUzID09PSBpMiA/IGEyKHQzKSA6IEFycmF5LmlzQXJyYXkoZTMpID8gaTIuY2FsbCgoKSA9PiBhMih0MyksIC4uLmUzKSA6IGkyLmNhbGwoKCkgPT4gYTIodDMpLCBlMyk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBhMihlMykgewogICAgICAgICAgICBjb25zdCBuMyA9IGkyLmdldFZhbHVlKCksIHIzID0gbjMgJiYgdHlwZW9mIG4zID09ICJvYmplY3QiICYmIGUzID09PSB2b2lkIDA7CiAgICAgICAgICAgIGlmIChyMyAmJiBvMi5oYXMobjMpKQogICAgICAgICAgICAgIHJldHVybiBvMi5nZXQobjMpOwogICAgICAgICAgICBjb25zdCB1MyA9IHlEKGkyLCB0MiwgczIsIGUzKTsKICAgICAgICAgICAgcmV0dXJuIHIzICYmIG8yLnNldChuMywgdTMpLCB1MzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24geUQodDIsIG4yLCByMiwgbzIpIHsKICAgICAgICAgIGNvbnN0IGkyID0gdDIuZ2V0VmFsdWUoKSwgeyBwcmludGVyOiB1MiB9ID0gbjI7CiAgICAgICAgICBsZXQgczIsIGEyOwogICAgICAgICAgaWYgKHUyLmhhc1ByZXR0aWVySWdub3JlICYmIHUyLmhhc1ByZXR0aWVySWdub3JlKHQyKSkKICAgICAgICAgICAgKHsgZG9jOiBzMiwgcHJpbnRlZENvbW1lbnRzOiBhMiB9ID0gZnVuY3Rpb24oZTIsIHQzKSB7CiAgICAgICAgICAgICAgY29uc3QgeyBvcmlnaW5hbFRleHQ6IG4zLCBbU3ltYm9sLmZvcigiY29tbWVudHMiKV06IHIzLCBsb2NTdGFydDogbzMsIGxvY0VuZDogaTMgfSA9IHQzLCB1MyA9IG8zKGUyKSwgczMgPSBpMyhlMiksIGEzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIHIzKQogICAgICAgICAgICAgICAgbzMoZTMpID49IHUzICYmIGkzKGUzKSA8PSBzMyAmJiAoZTMucHJpbnRlZCA9IHRydWUsIGEzLmFkZChlMykpOwogICAgICAgICAgICAgIHJldHVybiB7IGRvYzogbjMuc2xpY2UodTMsIHMzKSwgcHJpbnRlZENvbW1lbnRzOiBhMyB9OwogICAgICAgICAgICB9KGkyLCBuMikpOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChpMikKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgczIgPSBnRC5wcmludFN1YnRyZWUodDIsIHIyLCBuMiwgbUQpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKHQzKSB7CiAgICAgICAgICAgICAgICBpZiAoZS5QUkVUVElFUl9ERUJVRykKICAgICAgICAgICAgICAgICAgdGhyb3cgdDM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICBzMiB8fCAoczIgPSB1Mi5wcmludCh0MiwgbjIsIHIyLCBvMikpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHUyLndpbGxQcmludE93bkNvbW1lbnRzICYmIHUyLndpbGxQcmludE93bkNvbW1lbnRzKHQyLCBuMikgfHwgKHMyID0gaEQodDIsIHMyLCBuMiwgYTIpKSwgczI7CiAgICAgICAgfQogICAgICAgIHZhciBERCA9IG1EOwogICAgICAgIGNvbnN0IEVEID0gVHksIENEID0gdEQ7CiAgICAgICAgZnVuY3Rpb24gYkQoZTIpIHsKICAgICAgICAgIGxldCB0MiA9IGUyLmxlbmd0aCAtIDE7CiAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgY29uc3QgbjIgPSBlMlt0Ml07CiAgICAgICAgICAgIGlmICghbjIgfHwgbjIudHlwZSAhPT0gIlByb2dyYW0iICYmIG4yLnR5cGUgIT09ICJGaWxlIikKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgdDItLTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlMi5zbGljZSgwLCB0MiArIDEpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB2RChlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgbGV0IG8yID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgJiYgYXJndW1lbnRzWzRdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbNF0gOiBbXSwgaTIgPSBhcmd1bWVudHMubGVuZ3RoID4gNSA/IGFyZ3VtZW50c1s1XSA6IHZvaWQgMDsKICAgICAgICAgIGNvbnN0IHsgbG9jU3RhcnQ6IHUyLCBsb2NFbmQ6IHMyIH0gPSBuMiwgYTIgPSB1MihlMiksIGMyID0gczIoZTIpOwogICAgICAgICAgaWYgKCEodDIgPiBjMiB8fCB0MiA8IGEyIHx8IGkyID09PSAicmFuZ2VFbmQiICYmIHQyID09PSBhMiB8fCBpMiA9PT0gInJhbmdlU3RhcnQiICYmIHQyID09PSBjMikpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB1MyBvZiBDRC5nZXRTb3J0ZWRDaGlsZE5vZGVzKGUyLCBuMikpIHsKICAgICAgICAgICAgICBjb25zdCBzMyA9IHZEKHUzLCB0MiwgbjIsIHIyLCBbZTIsIC4uLm8yXSwgaTIpOwogICAgICAgICAgICAgIGlmIChzMykKICAgICAgICAgICAgICAgIHJldHVybiBzMzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIXIyIHx8IHIyKGUyLCBvMlswXSkgPyB7IG5vZGU6IGUyLCBwYXJlbnROb2RlczogbzIgfSA6IHZvaWQgMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc3QgQUQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldChbIk9iamVjdEV4cHJlc3Npb24iLCAiQXJyYXlFeHByZXNzaW9uIiwgIlN0cmluZ0xpdGVyYWwiLCAiTnVtZXJpY0xpdGVyYWwiLCAiQm9vbGVhbkxpdGVyYWwiLCAiTnVsbExpdGVyYWwiLCAiVW5hcnlFeHByZXNzaW9uIiwgIlRlbXBsYXRlTGl0ZXJhbCJdKSwgRkQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldChbIk9wZXJhdGlvbkRlZmluaXRpb24iLCAiRnJhZ21lbnREZWZpbml0aW9uIiwgIlZhcmlhYmxlRGVmaW5pdGlvbiIsICJUeXBlRXh0ZW5zaW9uRGVmaW5pdGlvbiIsICJPYmplY3RUeXBlRGVmaW5pdGlvbiIsICJGaWVsZERlZmluaXRpb24iLCAiRGlyZWN0aXZlRGVmaW5pdGlvbiIsICJFbnVtVHlwZURlZmluaXRpb24iLCAiRW51bVZhbHVlRGVmaW5pdGlvbiIsICJJbnB1dFZhbHVlRGVmaW5pdGlvbiIsICJJbnB1dE9iamVjdFR5cGVEZWZpbml0aW9uIiwgIlNjaGVtYURlZmluaXRpb24iLCAiT3BlcmF0aW9uVHlwZURlZmluaXRpb24iLCAiSW50ZXJmYWNlVHlwZURlZmluaXRpb24iLCAiVW5pb25UeXBlRGVmaW5pdGlvbiIsICJTY2FsYXJUeXBlRGVmaW5pdGlvbiJdKTsKICAgICAgICBmdW5jdGlvbiB4RChlMiwgdDIsIG4yKSB7CiAgICAgICAgICBpZiAoIXQyKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBzd2l0Y2ggKGUyLnBhcnNlcikgewogICAgICAgICAgICBjYXNlICJmbG93IjoKICAgICAgICAgICAgY2FzZSAiYmFiZWwiOgogICAgICAgICAgICBjYXNlICJiYWJlbC1mbG93IjoKICAgICAgICAgICAgY2FzZSAiYmFiZWwtdHMiOgogICAgICAgICAgICBjYXNlICJ0eXBlc2NyaXB0IjoKICAgICAgICAgICAgY2FzZSAiZXNwcmVlIjoKICAgICAgICAgICAgY2FzZSAibWVyaXlhaCI6CiAgICAgICAgICAgIGNhc2UgIl9fYmFiZWxfZXN0cmVlIjoKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdDMgIT09ICJEZWNsYXJlRXhwb3J0RGVjbGFyYXRpb24iICYmIGUzICE9PSAiVHlwZVBhcmFtZXRlckRlY2xhcmF0aW9uIiAmJiAoZTMgPT09ICJEaXJlY3RpdmUiIHx8IGUzID09PSAiVHlwZUFsaWFzIiB8fCBlMyA9PT0gIlRTRXhwb3J0QXNzaWdubWVudCIgfHwgZTMuc3RhcnRzV2l0aCgiRGVjbGFyZSIpIHx8IGUzLnN0YXJ0c1dpdGgoIlRTRGVjbGFyZSIpIHx8IGUzLmVuZHNXaXRoKCJTdGF0ZW1lbnQiKSB8fCBlMy5lbmRzV2l0aCgiRGVjbGFyYXRpb24iKSk7CiAgICAgICAgICAgICAgfSh0Mi50eXBlLCBuMiAmJiBuMi50eXBlKTsKICAgICAgICAgICAgY2FzZSAianNvbiI6CiAgICAgICAgICAgIGNhc2UgImpzb241IjoKICAgICAgICAgICAgY2FzZSAianNvbi1zdHJpbmdpZnkiOgogICAgICAgICAgICAgIHJldHVybiBBRC5oYXModDIudHlwZSk7CiAgICAgICAgICAgIGNhc2UgImdyYXBocWwiOgogICAgICAgICAgICAgIHJldHVybiBGRC5oYXModDIua2luZCk7CiAgICAgICAgICAgIGNhc2UgInZ1ZSI6CiAgICAgICAgICAgICAgcmV0dXJuIHQyLnRhZyAhPT0gInJvb3QiOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgU0QgPSB7IGNhbGN1bGF0ZVJhbmdlOiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBsZXQgeyByYW5nZVN0YXJ0OiByMiwgcmFuZ2VFbmQ6IG8yLCBsb2NTdGFydDogaTIsIGxvY0VuZDogdTIgfSA9IHQyOwogICAgICAgICAgRUQub2sobzIgPiByMik7CiAgICAgICAgICBjb25zdCBzMiA9IGUyLnNsaWNlKHIyLCBvMikuc2VhcmNoKC9cUy8pLCBhMiA9IHMyID09PSAtMTsKICAgICAgICAgIGlmICghYTIpCiAgICAgICAgICAgIGZvciAocjIgKz0gczI7IG8yID4gcjIgJiYgIS9cUy8udGVzdChlMltvMiAtIDFdKTsgLS1vMikKICAgICAgICAgICAgICA7CiAgICAgICAgICBjb25zdCBjMiA9IHZEKG4yLCByMiwgdDIsIChlMywgbjMpID0+IHhEKHQyLCBlMywgbjMpLCBbXSwgInJhbmdlU3RhcnQiKSwgbDIgPSBhMiA/IGMyIDogdkQobjIsIG8yLCB0MiwgKGUzKSA9PiB4RCh0MiwgZTMpLCBbXSwgInJhbmdlRW5kIik7CiAgICAgICAgICBpZiAoIWMyIHx8ICFsMikKICAgICAgICAgICAgcmV0dXJuIHsgcmFuZ2VTdGFydDogMCwgcmFuZ2VFbmQ6IDAgfTsKICAgICAgICAgIGxldCBwMiwgZjI7CiAgICAgICAgICBpZiAoKChlMykgPT4gewogICAgICAgICAgICBsZXQgeyBwYXJzZXI6IHQzIH0gPSBlMzsKICAgICAgICAgICAgcmV0dXJuIHQzID09PSAianNvbiIgfHwgdDMgPT09ICJqc29uNSIgfHwgdDMgPT09ICJqc29uLXN0cmluZ2lmeSI7CiAgICAgICAgICB9KSh0MikpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSBmdW5jdGlvbihlNCwgdDMpIHsKICAgICAgICAgICAgICBjb25zdCBuMyA9IFtlNC5ub2RlLCAuLi5lNC5wYXJlbnROb2Rlc10sIHIzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoW3QzLm5vZGUsIC4uLnQzLnBhcmVudE5vZGVzXSk7CiAgICAgICAgICAgICAgcmV0dXJuIG4zLmZpbmQoKGU1KSA9PiBBRC5oYXMoZTUudHlwZSkgJiYgcjMuaGFzKGU1KSk7CiAgICAgICAgICAgIH0oYzIsIGwyKTsKICAgICAgICAgICAgcDIgPSBlMywgZjIgPSBlMzsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAoeyBzdGFydE5vZGU6IHAyLCBlbmROb2RlOiBmMiB9ID0gZnVuY3Rpb24oZTMsIHQzLCBuMykgewogICAgICAgICAgICAgIGxldCB7IGxvY1N0YXJ0OiByMywgbG9jRW5kOiBvMyB9ID0gbjMsIGkzID0gZTMubm9kZSwgdTMgPSB0My5ub2RlOwogICAgICAgICAgICAgIGlmIChpMyA9PT0gdTMpCiAgICAgICAgICAgICAgICByZXR1cm4geyBzdGFydE5vZGU6IGkzLCBlbmROb2RlOiB1MyB9OwogICAgICAgICAgICAgIGNvbnN0IHMzID0gcjMoZTMubm9kZSk7CiAgICAgICAgICAgICAgZm9yIChjb25zdCBlNCBvZiBiRCh0My5wYXJlbnROb2RlcykpIHsKICAgICAgICAgICAgICAgIGlmICghKHIzKGU0KSA+PSBzMykpCiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgdTMgPSBlNDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgYTMgPSBvMyh0My5ub2RlKTsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQ0IG9mIGJEKGUzLnBhcmVudE5vZGVzKSkgewogICAgICAgICAgICAgICAgaWYgKCEobzModDQpIDw9IGEzKSkKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBpMyA9IHQ0OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4geyBzdGFydE5vZGU6IGkzLCBlbmROb2RlOiB1MyB9OwogICAgICAgICAgICB9KGMyLCBsMiwgdDIpKTsKICAgICAgICAgIHJldHVybiB7IHJhbmdlU3RhcnQ6IE1hdGgubWluKGkyKHAyKSwgaTIoZjIpKSwgcmFuZ2VFbmQ6IE1hdGgubWF4KHUyKHAyKSwgdTIoZjIpKSB9OwogICAgICAgIH0sIGZpbmROb2RlQXRPZmZzZXQ6IHZEIH07CiAgICAgICAgY29uc3Qgd0QgPSByLCB7IHByaW50ZXI6IHsgcHJpbnREb2NUb1N0cmluZzogVEQgfSwgZGVidWc6IHsgcHJpbnREb2NUb0RlYnVnOiBCRCB9IH0gPSBaYywgeyBnZXRBbGlnbm1lbnRTaXplOiBORCB9ID0gZGMsIHsgZ3Vlc3NFbmRPZkxpbmU6IGtELCBjb252ZXJ0RW5kT2ZMaW5lVG9DaGFyczogUEQsIGNvdW50RW5kT2ZMaW5lQ2hhcnM6IE9ELCBub3JtYWxpemVFbmRPZkxpbmU6IElEIH0gPSBoYywgTEQgPSBCbS5ub3JtYWxpemUsIGpEID0gTm0sIF9EID0gdEQsIE1EID0gRG0sIFJEID0gREQsIFZEID0gU0QsICREID0gU3ltYm9sKCJjdXJzb3IiKTsKICAgICAgICBmdW5jdGlvbiBXRChlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IHQyLmNvbW1lbnRzOwogICAgICAgICAgcmV0dXJuIHIyICYmIChkZWxldGUgdDIuY29tbWVudHMsIF9ELmF0dGFjaChyMiwgdDIsIGUyLCBuMikpLCBuMltTeW1ib2wuZm9yKCJjb21tZW50cyIpXSA9IHIyIHx8IFtdLCBuMltTeW1ib2wuZm9yKCJ0b2tlbnMiKV0gPSB0Mi50b2tlbnMgfHwgW10sIG4yLm9yaWdpbmFsVGV4dCA9IGUyLCByMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcUQoZTIsIHQyKSB7CiAgICAgICAgICBsZXQgbjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1syXSA6IDA7CiAgICAgICAgICBpZiAoIWUyIHx8IGUyLnRyaW0oKS5sZW5ndGggPT09IDApCiAgICAgICAgICAgIHJldHVybiB7IGZvcm1hdHRlZDogIiIsIGN1cnNvck9mZnNldDogLTEsIGNvbW1lbnRzOiBbXSB9OwogICAgICAgICAgY29uc3QgeyBhc3Q6IHIyLCB0ZXh0OiBvMiB9ID0gTUQucGFyc2UoZTIsIHQyKTsKICAgICAgICAgIGlmICh0Mi5jdXJzb3JPZmZzZXQgPj0gMCkgewogICAgICAgICAgICBjb25zdCBlMyA9IFZELmZpbmROb2RlQXRPZmZzZXQocjIsIHQyLmN1cnNvck9mZnNldCwgdDIpOwogICAgICAgICAgICBlMyAmJiBlMy5ub2RlICYmICh0Mi5jdXJzb3JOb2RlID0gZTMubm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBpMiA9IFdEKG8yLCByMiwgdDIpLCB1MiA9IFJEKHIyLCB0MiwgbjIpLCBzMiA9IFREKHUyLCB0Mik7CiAgICAgICAgICBpZiAoX0QuZW5zdXJlQWxsQ29tbWVudHNQcmludGVkKGkyKSwgbjIgPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gczIuZm9ybWF0dGVkLnRyaW0oKTsKICAgICAgICAgICAgczIuY3Vyc29yTm9kZVN0YXJ0ICE9PSB2b2lkIDAgJiYgKHMyLmN1cnNvck5vZGVTdGFydCAtPSBzMi5mb3JtYXR0ZWQuaW5kZXhPZihlMykpLCBzMi5mb3JtYXR0ZWQgPSBlMyArIFBEKHQyLmVuZE9mTGluZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodDIuY3Vyc29yT2Zmc2V0ID49IDApIHsKICAgICAgICAgICAgbGV0IGUzLCBuMywgcjMsIHUzLCBhMjsKICAgICAgICAgICAgaWYgKHQyLmN1cnNvck5vZGUgJiYgczIuY3Vyc29yTm9kZVRleHQgPyAoZTMgPSB0Mi5sb2NTdGFydCh0Mi5jdXJzb3JOb2RlKSwgbjMgPSBvMi5zbGljZShlMywgdDIubG9jRW5kKHQyLmN1cnNvck5vZGUpKSwgcjMgPSB0Mi5jdXJzb3JPZmZzZXQgLSBlMywgdTMgPSBzMi5jdXJzb3JOb2RlU3RhcnQsIGEyID0gczIuY3Vyc29yTm9kZVRleHQpIDogKGUzID0gMCwgbjMgPSBvMiwgcjMgPSB0Mi5jdXJzb3JPZmZzZXQsIHUzID0gMCwgYTIgPSBzMi5mb3JtYXR0ZWQpLCBuMyA9PT0gYTIpCiAgICAgICAgICAgICAgcmV0dXJuIHsgZm9ybWF0dGVkOiBzMi5mb3JtYXR0ZWQsIGN1cnNvck9mZnNldDogdTMgKyByMywgY29tbWVudHM6IGkyIH07CiAgICAgICAgICAgIGNvbnN0IGMyID0gWy4uLm4zXTsKICAgICAgICAgICAgYzIuc3BsaWNlKHIzLCAwLCAkRCk7CiAgICAgICAgICAgIGNvbnN0IGwyID0gWy4uLmEyXSwgcDIgPSB3RC5kaWZmQXJyYXlzKGMyLCBsMik7CiAgICAgICAgICAgIGxldCBmMiA9IHUzOwogICAgICAgICAgICBmb3IgKGNvbnN0IGU0IG9mIHAyKQogICAgICAgICAgICAgIGlmIChlNC5yZW1vdmVkKSB7CiAgICAgICAgICAgICAgICBpZiAoZTQudmFsdWUuaW5jbHVkZXMoJEQpKQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGYyICs9IGU0LmNvdW50OwogICAgICAgICAgICByZXR1cm4geyBmb3JtYXR0ZWQ6IHMyLmZvcm1hdHRlZCwgY3Vyc29yT2Zmc2V0OiBmMiwgY29tbWVudHM6IGkyIH07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4geyBmb3JtYXR0ZWQ6IHMyLmZvcm1hdHRlZCwgY3Vyc29yT2Zmc2V0OiAtMSwgY29tbWVudHM6IGkyIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFVEKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiB0eXBlb2YgdDIgIT0gIm51bWJlciIgfHwgTnVtYmVyLmlzTmFOKHQyKSB8fCB0MiA8IDAgfHwgdDIgPiBlMi5sZW5ndGggPyBuMiA6IHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB6RChlMiwgdDIpIHsKICAgICAgICAgIGxldCB7IGN1cnNvck9mZnNldDogbjIsIHJhbmdlU3RhcnQ6IHIyLCByYW5nZUVuZDogbzIgfSA9IHQyOwogICAgICAgICAgcmV0dXJuIG4yID0gVUQoZTIsIG4yLCAtMSksIHIyID0gVUQoZTIsIHIyLCAwKSwgbzIgPSBVRChlMiwgbzIsIGUyLmxlbmd0aCksIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdDIpLCB7fSwgeyBjdXJzb3JPZmZzZXQ6IG4yLCByYW5nZVN0YXJ0OiByMiwgcmFuZ2VFbmQ6IG8yIH0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBHRChlMiwgdDIpIHsKICAgICAgICAgIGxldCB7IGN1cnNvck9mZnNldDogbjIsIHJhbmdlU3RhcnQ6IHIyLCByYW5nZUVuZDogbzIsIGVuZE9mTGluZTogaTIgfSA9IHpEKGUyLCB0Mik7CiAgICAgICAgICBjb25zdCB1MiA9IGUyLmNoYXJBdCgwKSA9PT0gIlx1RkVGRiI7CiAgICAgICAgICBpZiAodTIgJiYgKGUyID0gZTIuc2xpY2UoMSksIG4yLS0sIHIyLS0sIG8yLS0pLCBpMiA9PT0gImF1dG8iICYmIChpMiA9IGtEKGUyKSksIGUyLmluY2x1ZGVzKCJcciIpKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gKHQ0KSA9PiBPRChlMi5zbGljZSgwLCBNYXRoLm1heCh0NCwgMCkpLCAiXHJcbiIpOwogICAgICAgICAgICBuMiAtPSB0MyhuMiksIHIyIC09IHQzKHIyKSwgbzIgLT0gdDMobzIpLCBlMiA9IElEKGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB7IGhhc0JPTTogdTIsIHRleHQ6IGUyLCBvcHRpb25zOiB6RChlMiwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0MiksIHt9LCB7IGN1cnNvck9mZnNldDogbjIsIHJhbmdlU3RhcnQ6IHIyLCByYW5nZUVuZDogbzIsIGVuZE9mTGluZTogaTIgfSkpIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEhEKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSBNRC5yZXNvbHZlUGFyc2VyKHQyKTsKICAgICAgICAgIHJldHVybiAhbjIuaGFzUHJhZ21hIHx8IG4yLmhhc1ByYWdtYShlMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEpEKGUyLCB0MikgewogICAgICAgICAgbGV0IG4yLCB7IGhhc0JPTTogcjIsIHRleHQ6IG8yLCBvcHRpb25zOiBpMiB9ID0gR0QoZTIsIExEKHQyKSk7CiAgICAgICAgICByZXR1cm4gaTIucmFuZ2VTdGFydCA+PSBpMi5yYW5nZUVuZCAmJiBvMiAhPT0gIiIgfHwgaTIucmVxdWlyZVByYWdtYSAmJiAhSEQobzIsIGkyKSA/IHsgZm9ybWF0dGVkOiBlMiwgY3Vyc29yT2Zmc2V0OiB0Mi5jdXJzb3JPZmZzZXQsIGNvbW1lbnRzOiBbXSB9IDogKGkyLnJhbmdlU3RhcnQgPiAwIHx8IGkyLnJhbmdlRW5kIDwgbzIubGVuZ3RoID8gbjIgPSBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgY29uc3QgeyBhc3Q6IG4zLCB0ZXh0OiByMyB9ID0gTUQucGFyc2UoZTMsIHQzKSwgeyByYW5nZVN0YXJ0OiBvMywgcmFuZ2VFbmQ6IGkzIH0gPSBWRC5jYWxjdWxhdGVSYW5nZShyMywgdDMsIG4zKSwgdTIgPSByMy5zbGljZShvMywgaTMpLCBzMiA9IE1hdGgubWluKG8zLCByMy5sYXN0SW5kZXhPZigiXG4iLCBvMykgKyAxKSwgYTIgPSByMy5zbGljZShzMiwgbzMpLm1hdGNoKC9eXHMqLylbMF0sIGMyID0gTkQoYTIsIHQzLnRhYldpZHRoKSwgbDIgPSBxRCh1MiwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0MyksIHt9LCB7IHJhbmdlU3RhcnQ6IDAsIHJhbmdlRW5kOiBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIGN1cnNvck9mZnNldDogdDMuY3Vyc29yT2Zmc2V0ID4gbzMgJiYgdDMuY3Vyc29yT2Zmc2V0IDw9IGkzID8gdDMuY3Vyc29yT2Zmc2V0IC0gbzMgOiAtMSwgZW5kT2ZMaW5lOiAibGYiIH0pLCBjMiksIHAyID0gbDIuZm9ybWF0dGVkLnRyaW1FbmQoKTsKICAgICAgICAgICAgbGV0IHsgY3Vyc29yT2Zmc2V0OiBmMiB9ID0gdDM7CiAgICAgICAgICAgIGYyID4gaTMgPyBmMiArPSBwMi5sZW5ndGggLSB1Mi5sZW5ndGggOiBsMi5jdXJzb3JPZmZzZXQgPj0gMCAmJiAoZjIgPSBsMi5jdXJzb3JPZmZzZXQgKyBvMyk7CiAgICAgICAgICAgIGxldCBkMiA9IHIzLnNsaWNlKDAsIG8zKSArIHAyICsgcjMuc2xpY2UoaTMpOwogICAgICAgICAgICBpZiAodDMuZW5kT2ZMaW5lICE9PSAibGYiKSB7CiAgICAgICAgICAgICAgY29uc3QgZTQgPSBQRCh0My5lbmRPZkxpbmUpOwogICAgICAgICAgICAgIGYyID49IDAgJiYgZTQgPT09ICJcclxuIiAmJiAoZjIgKz0gT0QoZDIuc2xpY2UoMCwgZjIpLCAiXG4iKSksIGQyID0gZDIucmVwbGFjZSgvXG4vZywgZTQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7IGZvcm1hdHRlZDogZDIsIGN1cnNvck9mZnNldDogZjIsIGNvbW1lbnRzOiBsMi5jb21tZW50cyB9OwogICAgICAgICAgfShvMiwgaTIpIDogKCFpMi5yZXF1aXJlUHJhZ21hICYmIGkyLmluc2VydFByYWdtYSAmJiBpMi5wcmludGVyLmluc2VydFByYWdtYSAmJiAhSEQobzIsIGkyKSAmJiAobzIgPSBpMi5wcmludGVyLmluc2VydFByYWdtYShvMikpLCBuMiA9IHFEKG8yLCBpMikpLCByMiAmJiAobjIuZm9ybWF0dGVkID0gIlx1RkVGRiIgKyBuMi5mb3JtYXR0ZWQsIG4yLmN1cnNvck9mZnNldCA+PSAwICYmIG4yLmN1cnNvck9mZnNldCsrKSwgbjIpOwogICAgICAgIH0KICAgICAgICB2YXIgWEQgPSB7IGZvcm1hdFdpdGhDdXJzb3I6IEpELCBwYXJzZShlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCB7IHRleHQ6IHIyLCBvcHRpb25zOiBvMiB9ID0gR0QoZTIsIExEKHQyKSksIGkyID0gTUQucGFyc2UocjIsIG8yKTsKICAgICAgICAgIHJldHVybiBuMiAmJiAoaTIuYXN0ID0gakQoaTIuYXN0LCBvMikpLCBpMjsKICAgICAgICB9LCBmb3JtYXRBU1QoZTIsIHQyKSB7CiAgICAgICAgICB0MiA9IExEKHQyKTsKICAgICAgICAgIGNvbnN0IG4yID0gUkQoZTIsIHQyKTsKICAgICAgICAgIHJldHVybiBURChuMiwgdDIpOwogICAgICAgIH0sIGZvcm1hdERvYzogKGUyLCB0MikgPT4gSkQoQkQoZTIpLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHQyKSwge30sIHsgcGFyc2VyOiAiX19qc19leHByZXNzaW9uIiB9KSkuZm9ybWF0dGVkLCBwcmludFRvRG9jKGUyLCB0MikgewogICAgICAgICAgdDIgPSBMRCh0Mik7CiAgICAgICAgICBjb25zdCB7IGFzdDogbjIsIHRleHQ6IHIyIH0gPSBNRC5wYXJzZShlMiwgdDIpOwogICAgICAgICAgcmV0dXJuIFdEKHIyLCBuMiwgdDIpLCBSRChuMiwgdDIpOwogICAgICAgIH0sIHByaW50RG9jVG9TdHJpbmc6IChlMiwgdDIpID0+IFREKGUyLCBMRCh0MikpIH07CiAgICAgICAgY29uc3QgeyBnZXRNYXhDb250aW51b3VzQ291bnQ6IFlELCBnZXRTdHJpbmdXaWR0aDogS0QsIGdldEFsaWdubWVudFNpemU6IFFELCBnZXRJbmRlbnRTaXplOiBaRCwgc2tpcDogZUUsIHNraXBXaGl0ZXNwYWNlOiB0RSwgc2tpcFNwYWNlczogbkUsIHNraXBOZXdsaW5lOiByRSwgc2tpcFRvTGluZUVuZDogb0UsIHNraXBFdmVyeXRoaW5nQnV0TmV3TGluZTogaUUsIHNraXBJbmxpbmVDb21tZW50OiB1RSwgc2tpcFRyYWlsaW5nQ29tbWVudDogc0UsIGhhc05ld2xpbmU6IGFFLCBoYXNOZXdsaW5lSW5SYW5nZTogY0UsIGhhc1NwYWNlczogbEUsIGlzTmV4dExpbmVFbXB0eTogcEUsIGlzTmV4dExpbmVFbXB0eUFmdGVySW5kZXg6IGZFLCBpc1ByZXZpb3VzTGluZUVtcHR5OiBkRSwgZ2V0TmV4dE5vblNwYWNlTm9uQ29tbWVudENoYXJhY3RlckluZGV4OiBoRSwgbWFrZVN0cmluZzogZ0UsIGFkZExlYWRpbmdDb21tZW50OiBtRSwgYWRkRGFuZ2xpbmdDb21tZW50OiB5RSwgYWRkVHJhaWxpbmdDb21tZW50OiBERSB9ID0gZGM7CiAgICAgICAgdmFyIEVFID0geyBnZXRNYXhDb250aW51b3VzQ291bnQ6IFlELCBnZXRTdHJpbmdXaWR0aDogS0QsIGdldEFsaWdubWVudFNpemU6IFFELCBnZXRJbmRlbnRTaXplOiBaRCwgc2tpcDogZUUsIHNraXBXaGl0ZXNwYWNlOiB0RSwgc2tpcFNwYWNlczogbkUsIHNraXBOZXdsaW5lOiByRSwgc2tpcFRvTGluZUVuZDogb0UsIHNraXBFdmVyeXRoaW5nQnV0TmV3TGluZTogaUUsIHNraXBJbmxpbmVDb21tZW50OiB1RSwgc2tpcFRyYWlsaW5nQ29tbWVudDogc0UsIGhhc05ld2xpbmU6IGFFLCBoYXNOZXdsaW5lSW5SYW5nZTogY0UsIGhhc1NwYWNlczogbEUsIGlzTmV4dExpbmVFbXB0eTogcEUsIGlzTmV4dExpbmVFbXB0eUFmdGVySW5kZXg6IGZFLCBpc1ByZXZpb3VzTGluZUVtcHR5OiBkRSwgZ2V0TmV4dE5vblNwYWNlTm9uQ29tbWVudENoYXJhY3RlckluZGV4OiBoRSwgbWFrZVN0cmluZzogZ0UsIGFkZExlYWRpbmdDb21tZW50OiBtRSwgYWRkRGFuZ2xpbmdDb21tZW50OiB5RSwgYWRkVHJhaWxpbmdDb21tZW50OiBERSB9OwogICAgICAgIGNvbnN0IENFID0gWyJsYW5ndWFnZUlkIl07CiAgICAgICAgdmFyIGJFID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCB7IGxhbmd1YWdlSWQ6IG4yIH0gPSBlMiwgcjIgPSBjdShlMiwgQ0UpOwogICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7IGxpbmd1aXN0TGFuZ3VhZ2VJZDogbjIgfSwgcjIpLCB0MihlMikpOwogICAgICAgIH0sIHZFID0ge30sIEFFID0geyBleHBvcnRzOiB7fSB9OwogICAgICAgICFmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIGUyKGUzKSB7CiAgICAgICAgICAgIGlmIChlMyA9PSBudWxsKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3dpdGNoIChlMy50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiQmxvY2tTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIkJyZWFrU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJDb250aW51ZVN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiRGVidWdnZXJTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIkRvV2hpbGVTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIkVtcHR5U3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJFeHByZXNzaW9uU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJGb3JJblN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiRm9yU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJJZlN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiTGFiZWxlZFN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiUmV0dXJuU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJTd2l0Y2hTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIlRocm93U3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJUcnlTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIlZhcmlhYmxlRGVjbGFyYXRpb24iOgogICAgICAgICAgICAgIGNhc2UgIldoaWxlU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJXaXRoU3RhdGVtZW50IjoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHQyKGUzKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZTMudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgIklmU3RhdGVtZW50IjoKICAgICAgICAgICAgICAgIHJldHVybiBlMy5hbHRlcm5hdGUgIT0gbnVsbCA/IGUzLmFsdGVybmF0ZSA6IGUzLmNvbnNlcXVlbnQ7CiAgICAgICAgICAgICAgY2FzZSAiTGFiZWxlZFN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiRm9yU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJGb3JJblN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiV2hpbGVTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIldpdGhTdGF0ZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIGUzLmJvZHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBBRS5leHBvcnRzID0geyBpc0V4cHJlc3Npb246IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGlmIChlMyA9PSBudWxsKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3dpdGNoIChlMy50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiQXJyYXlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJBc3NpZ25tZW50RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiQmluYXJ5RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiQ2FsbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgIGNhc2UgIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiRnVuY3Rpb25FeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJJZGVudGlmaWVyIjoKICAgICAgICAgICAgICBjYXNlICJMaXRlcmFsIjoKICAgICAgICAgICAgICBjYXNlICJMb2dpY2FsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiTmV3RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiU2VxdWVuY2VFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJUaGlzRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiVW5hcnlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJVcGRhdGVFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0sIGlzU3RhdGVtZW50OiBlMiwgaXNJdGVyYXRpb25TdGF0ZW1lbnQ6IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGlmIChlMyA9PSBudWxsKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3dpdGNoIChlMy50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiRG9XaGlsZVN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiRm9ySW5TdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIkZvclN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiV2hpbGVTdGF0ZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfSwgaXNTb3VyY2VFbGVtZW50OiBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gZTIodDMpIHx8IHQzICE9IG51bGwgJiYgdDMudHlwZSA9PT0gIkZ1bmN0aW9uRGVjbGFyYXRpb24iOwogICAgICAgICAgfSwgaXNQcm9ibGVtYXRpY0lmU3RhdGVtZW50OiBmdW5jdGlvbihlMykgewogICAgICAgICAgICB2YXIgbjI7CiAgICAgICAgICAgIGlmIChlMy50eXBlICE9PSAiSWZTdGF0ZW1lbnQiKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKGUzLmFsdGVybmF0ZSA9PSBudWxsKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgbjIgPSBlMy5jb25zZXF1ZW50OwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgaWYgKG4yLnR5cGUgPT09ICJJZlN0YXRlbWVudCIgJiYgbjIuYWx0ZXJuYXRlID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICBuMiA9IHQyKG4yKTsKICAgICAgICAgICAgfSB3aGlsZSAobjIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9LCB0cmFpbGluZ1N0YXRlbWVudDogdDIgfTsKICAgICAgICB9KCk7CiAgICAgICAgdmFyIEZFID0geyBleHBvcnRzOiB7fSB9OwogICAgICAgICFmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBlMiwgdDIsIG4yLCByMiwgbzIsIGkyOwogICAgICAgICAgZnVuY3Rpb24gdTIoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzIDw9IDY1NTM1ID8gU3RyaW5nLmZyb21DaGFyQ29kZShlMykgOiBTdHJpbmcuZnJvbUNoYXJDb2RlKE1hdGguZmxvb3IoKGUzIC0gNjU1MzYpIC8gMTAyNCkgKyA1NTI5NikgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKChlMyAtIDY1NTM2KSAlIDEwMjQgKyA1NjMyMCk7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKHQyID0geyBOb25Bc2NpaUlkZW50aWZpZXJTdGFydDogL1tceEFBXHhCNVx4QkFceEMwLVx4RDZceEQ4LVx4RjZceEY4LVx1MDJDMVx1MDJDNi1cdTAyRDFcdTAyRTAtXHUwMkU0XHUwMkVDXHUwMkVFXHUwMzcwLVx1MDM3NFx1MDM3Nlx1MDM3N1x1MDM3QS1cdTAzN0RcdTAzN0ZcdTAzODZcdTAzODgtXHUwMzhBXHUwMzhDXHUwMzhFLVx1MDNBMVx1MDNBMy1cdTAzRjVcdTAzRjctXHUwNDgxXHUwNDhBLVx1MDUyRlx1MDUzMS1cdTA1NTZcdTA1NTlcdTA1NjEtXHUwNTg3XHUwNUQwLVx1MDVFQVx1MDVGMC1cdTA1RjJcdTA2MjAtXHUwNjRBXHUwNjZFXHUwNjZGXHUwNjcxLVx1MDZEM1x1MDZENVx1MDZFNVx1MDZFNlx1MDZFRVx1MDZFRlx1MDZGQS1cdTA2RkNcdTA2RkZcdTA3MTBcdTA3MTItXHUwNzJGXHUwNzRELVx1MDdBNVx1MDdCMVx1MDdDQS1cdTA3RUFcdTA3RjRcdTA3RjVcdTA3RkFcdTA4MDAtXHUwODE1XHUwODFBXHUwODI0XHUwODI4XHUwODQwLVx1MDg1OFx1MDhBMC1cdTA4QjRcdTA4QjYtXHUwOEJEXHUwOTA0LVx1MDkzOVx1MDkzRFx1MDk1MFx1MDk1OC1cdTA5NjFcdTA5NzEtXHUwOTgwXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCRFx1MDlDRVx1MDlEQ1x1MDlERFx1MDlERi1cdTA5RTFcdTA5RjBcdTA5RjFcdTBBMDUtXHUwQTBBXHUwQTBGXHUwQTEwXHUwQTEzLVx1MEEyOFx1MEEyQS1cdTBBMzBcdTBBMzJcdTBBMzNcdTBBMzVcdTBBMzZcdTBBMzhcdTBBMzlcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTcyLVx1MEE3NFx1MEE4NS1cdTBBOERcdTBBOEYtXHUwQTkxXHUwQTkzLVx1MEFBOFx1MEFBQS1cdTBBQjBcdTBBQjJcdTBBQjNcdTBBQjUtXHUwQUI5XHUwQUJEXHUwQUQwXHUwQUUwXHUwQUUxXHUwQUY5XHUwQjA1LVx1MEIwQ1x1MEIwRlx1MEIxMFx1MEIxMy1cdTBCMjhcdTBCMkEtXHUwQjMwXHUwQjMyXHUwQjMzXHUwQjM1LVx1MEIzOVx1MEIzRFx1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjFcdTBCNzFcdTBCODNcdTBCODUtXHUwQjhBXHUwQjhFLVx1MEI5MFx1MEI5Mi1cdTBCOTVcdTBCOTlcdTBCOUFcdTBCOUNcdTBCOUVcdTBCOUZcdTBCQTNcdTBCQTRcdTBCQTgtXHUwQkFBXHUwQkFFLVx1MEJCOVx1MEJEMFx1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0RcdTBDNTgtXHUwQzVBXHUwQzYwXHUwQzYxXHUwQzgwXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkRcdTBDREVcdTBDRTBcdTBDRTFcdTBDRjFcdTBDRjJcdTBEMDUtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0RcdTBENEVcdTBENTQtXHUwRDU2XHUwRDVGLVx1MEQ2MVx1MEQ3QS1cdTBEN0ZcdTBEODUtXHUwRDk2XHUwRDlBLVx1MERCMVx1MERCMy1cdTBEQkJcdTBEQkRcdTBEQzAtXHUwREM2XHUwRTAxLVx1MEUzMFx1MEUzMlx1MEUzM1x1MEU0MC1cdTBFNDZcdTBFODFcdTBFODJcdTBFODRcdTBFODdcdTBFODhcdTBFOEFcdTBFOERcdTBFOTQtXHUwRTk3XHUwRTk5LVx1MEU5Rlx1MEVBMS1cdTBFQTNcdTBFQTVcdTBFQTdcdTBFQUFcdTBFQUJcdTBFQUQtXHUwRUIwXHUwRUIyXHUwRUIzXHUwRUJEXHUwRUMwLVx1MEVDNFx1MEVDNlx1MEVEQy1cdTBFREZcdTBGMDBcdTBGNDAtXHUwRjQ3XHUwRjQ5LVx1MEY2Q1x1MEY4OC1cdTBGOENcdTEwMDAtXHUxMDJBXHUxMDNGXHUxMDUwLVx1MTA1NVx1MTA1QS1cdTEwNURcdTEwNjFcdTEwNjVcdTEwNjZcdTEwNkUtXHUxMDcwXHUxMDc1LVx1MTA4MVx1MTA4RVx1MTBBMC1cdTEwQzVcdTEwQzdcdTEwQ0RcdTEwRDAtXHUxMEZBXHUxMEZDLVx1MTI0OFx1MTI0QS1cdTEyNERcdTEyNTAtXHUxMjU2XHUxMjU4XHUxMjVBLVx1MTI1RFx1MTI2MC1cdTEyODhcdTEyOEEtXHUxMjhEXHUxMjkwLVx1MTJCMFx1MTJCMi1cdTEyQjVcdTEyQjgtXHUxMkJFXHUxMkMwXHUxMkMyLVx1MTJDNVx1MTJDOC1cdTEyRDZcdTEyRDgtXHUxMzEwXHUxMzEyLVx1MTMxNVx1MTMxOC1cdTEzNUFcdTEzODAtXHUxMzhGXHUxM0EwLVx1MTNGNVx1MTNGOC1cdTEzRkRcdTE0MDEtXHUxNjZDXHUxNjZGLVx1MTY3Rlx1MTY4MS1cdTE2OUFcdTE2QTAtXHUxNkVBXHUxNkVFLVx1MTZGOFx1MTcwMC1cdTE3MENcdTE3MEUtXHUxNzExXHUxNzIwLVx1MTczMVx1MTc0MC1cdTE3NTFcdTE3NjAtXHUxNzZDXHUxNzZFLVx1MTc3MFx1MTc4MC1cdTE3QjNcdTE3RDdcdTE3RENcdTE4MjAtXHUxODc3XHUxODgwLVx1MTg4NFx1MTg4Ny1cdTE4QThcdTE4QUFcdTE4QjAtXHUxOEY1XHUxOTAwLVx1MTkxRVx1MTk1MC1cdTE5NkRcdTE5NzAtXHUxOTc0XHUxOTgwLVx1MTlBQlx1MTlCMC1cdTE5QzlcdTFBMDAtXHUxQTE2XHUxQTIwLVx1MUE1NFx1MUFBN1x1MUIwNS1cdTFCMzNcdTFCNDUtXHUxQjRCXHUxQjgzLVx1MUJBMFx1MUJBRVx1MUJBRlx1MUJCQS1cdTFCRTVcdTFDMDAtXHUxQzIzXHUxQzRELVx1MUM0Rlx1MUM1QS1cdTFDN0RcdTFDODAtXHUxQzg4XHUxQ0U5LVx1MUNFQ1x1MUNFRS1cdTFDRjFcdTFDRjVcdTFDRjZcdTFEMDAtXHUxREJGXHUxRTAwLVx1MUYxNVx1MUYxOC1cdTFGMURcdTFGMjAtXHUxRjQ1XHUxRjQ4LVx1MUY0RFx1MUY1MC1cdTFGNTdcdTFGNTlcdTFGNUJcdTFGNURcdTFGNUYtXHUxRjdEXHUxRjgwLVx1MUZCNFx1MUZCNi1cdTFGQkNcdTFGQkVcdTFGQzItXHUxRkM0XHUxRkM2LVx1MUZDQ1x1MUZEMC1cdTFGRDNcdTFGRDYtXHUxRkRCXHUxRkUwLVx1MUZFQ1x1MUZGMi1cdTFGRjRcdTFGRjYtXHUxRkZDXHUyMDcxXHUyMDdGXHUyMDkwLVx1MjA5Q1x1MjEwMlx1MjEwN1x1MjEwQS1cdTIxMTNcdTIxMTVcdTIxMTktXHUyMTFEXHUyMTI0XHUyMTI2XHUyMTI4XHUyMTJBLVx1MjEyRFx1MjEyRi1cdTIxMzlcdTIxM0MtXHUyMTNGXHUyMTQ1LVx1MjE0OVx1MjE0RVx1MjE2MC1cdTIxODhcdTJDMDAtXHUyQzJFXHUyQzMwLVx1MkM1RVx1MkM2MC1cdTJDRTRcdTJDRUItXHUyQ0VFXHUyQ0YyXHUyQ0YzXHUyRDAwLVx1MkQyNVx1MkQyN1x1MkQyRFx1MkQzMC1cdTJENjdcdTJENkZcdTJEODAtXHUyRDk2XHUyREEwLVx1MkRBNlx1MkRBOC1cdTJEQUVcdTJEQjAtXHUyREI2XHUyREI4LVx1MkRCRVx1MkRDMC1cdTJEQzZcdTJEQzgtXHUyRENFXHUyREQwLVx1MkRENlx1MkREOC1cdTJEREVcdTJFMkZcdTMwMDUtXHUzMDA3XHUzMDIxLVx1MzAyOVx1MzAzMS1cdTMwMzVcdTMwMzgtXHUzMDNDXHUzMDQxLVx1MzA5Nlx1MzA5RC1cdTMwOUZcdTMwQTEtXHUzMEZBXHUzMEZDLVx1MzBGRlx1MzEwNS1cdTMxMkRcdTMxMzEtXHUzMThFXHUzMUEwLVx1MzFCQVx1MzFGMC1cdTMxRkZcdTM0MDAtXHU0REI1XHU0RTAwLVx1OUZENVx1QTAwMC1cdUE0OENcdUE0RDAtXHVBNEZEXHVBNTAwLVx1QTYwQ1x1QTYxMC1cdUE2MUZcdUE2MkFcdUE2MkJcdUE2NDAtXHVBNjZFXHVBNjdGLVx1QTY5RFx1QTZBMC1cdUE2RUZcdUE3MTctXHVBNzFGXHVBNzIyLVx1QTc4OFx1QTc4Qi1cdUE3QUVcdUE3QjAtXHVBN0I3XHVBN0Y3LVx1QTgwMVx1QTgwMy1cdUE4MDVcdUE4MDctXHVBODBBXHVBODBDLVx1QTgyMlx1QTg0MC1cdUE4NzNcdUE4ODItXHVBOEIzXHVBOEYyLVx1QThGN1x1QThGQlx1QThGRFx1QTkwQS1cdUE5MjVcdUE5MzAtXHVBOTQ2XHVBOTYwLVx1QTk3Q1x1QTk4NC1cdUE5QjJcdUE5Q0ZcdUE5RTAtXHVBOUU0XHVBOUU2LVx1QTlFRlx1QTlGQS1cdUE5RkVcdUFBMDAtXHVBQTI4XHVBQTQwLVx1QUE0Mlx1QUE0NC1cdUFBNEJcdUFBNjAtXHVBQTc2XHVBQTdBXHVBQTdFLVx1QUFBRlx1QUFCMVx1QUFCNVx1QUFCNlx1QUFCOS1cdUFBQkRcdUFBQzBcdUFBQzJcdUFBREItXHVBQUREXHVBQUUwLVx1QUFFQVx1QUFGMi1cdUFBRjRcdUFCMDEtXHVBQjA2XHVBQjA5LVx1QUIwRVx1QUIxMS1cdUFCMTZcdUFCMjAtXHVBQjI2XHVBQjI4LVx1QUIyRVx1QUIzMC1cdUFCNUFcdUFCNUMtXHVBQjY1XHVBQjcwLVx1QUJFMlx1QUMwMC1cdUQ3QTNcdUQ3QjAtXHVEN0M2XHVEN0NCLVx1RDdGQlx1RjkwMC1cdUZBNkRcdUZBNzAtXHVGQUQ5XHVGQjAwLVx1RkIwNlx1RkIxMy1cdUZCMTdcdUZCMURcdUZCMUYtXHVGQjI4XHVGQjJBLVx1RkIzNlx1RkIzOC1cdUZCM0NcdUZCM0VcdUZCNDBcdUZCNDFcdUZCNDNcdUZCNDRcdUZCNDYtXHVGQkIxXHVGQkQzLVx1RkQzRFx1RkQ1MC1cdUZEOEZcdUZEOTItXHVGREM3XHVGREYwLVx1RkRGQlx1RkU3MC1cdUZFNzRcdUZFNzYtXHVGRUZDXHVGRjIxLVx1RkYzQVx1RkY0MS1cdUZGNUFcdUZGNjYtXHVGRkJFXHVGRkMyLVx1RkZDN1x1RkZDQS1cdUZGQ0ZcdUZGRDItXHVGRkQ3XHVGRkRBLVx1RkZEQ10vLCBOb25Bc2NpaUlkZW50aWZpZXJQYXJ0OiAvW1x4QUFceEI1XHhCQVx4QzAtXHhENlx4RDgtXHhGNlx4RjgtXHUwMkMxXHUwMkM2LVx1MDJEMVx1MDJFMC1cdTAyRTRcdTAyRUNcdTAyRUVcdTAzMDAtXHUwMzc0XHUwMzc2XHUwMzc3XHUwMzdBLVx1MDM3RFx1MDM3Rlx1MDM4Nlx1MDM4OC1cdTAzOEFcdTAzOENcdTAzOEUtXHUwM0ExXHUwM0EzLVx1MDNGNVx1MDNGNy1cdTA0ODFcdTA0ODMtXHUwNDg3XHUwNDhBLVx1MDUyRlx1MDUzMS1cdTA1NTZcdTA1NTlcdTA1NjEtXHUwNTg3XHUwNTkxLVx1MDVCRFx1MDVCRlx1MDVDMVx1MDVDMlx1MDVDNFx1MDVDNVx1MDVDN1x1MDVEMC1cdTA1RUFcdTA1RjAtXHUwNUYyXHUwNjEwLVx1MDYxQVx1MDYyMC1cdTA2NjlcdTA2NkUtXHUwNkQzXHUwNkQ1LVx1MDZEQ1x1MDZERi1cdTA2RThcdTA2RUEtXHUwNkZDXHUwNkZGXHUwNzEwLVx1MDc0QVx1MDc0RC1cdTA3QjFcdTA3QzAtXHUwN0Y1XHUwN0ZBXHUwODAwLVx1MDgyRFx1MDg0MC1cdTA4NUJcdTA4QTAtXHUwOEI0XHUwOEI2LVx1MDhCRFx1MDhENC1cdTA4RTFcdTA4RTMtXHUwOTYzXHUwOTY2LVx1MDk2Rlx1MDk3MS1cdTA5ODNcdTA5ODUtXHUwOThDXHUwOThGXHUwOTkwXHUwOTkzLVx1MDlBOFx1MDlBQS1cdTA5QjBcdTA5QjJcdTA5QjYtXHUwOUI5XHUwOUJDLVx1MDlDNFx1MDlDN1x1MDlDOFx1MDlDQi1cdTA5Q0VcdTA5RDdcdTA5RENcdTA5RERcdTA5REYtXHUwOUUzXHUwOUU2LVx1MDlGMVx1MEEwMS1cdTBBMDNcdTBBMDUtXHUwQTBBXHUwQTBGXHUwQTEwXHUwQTEzLVx1MEEyOFx1MEEyQS1cdTBBMzBcdTBBMzJcdTBBMzNcdTBBMzVcdTBBMzZcdTBBMzhcdTBBMzlcdTBBM0NcdTBBM0UtXHUwQTQyXHUwQTQ3XHUwQTQ4XHUwQTRCLVx1MEE0RFx1MEE1MVx1MEE1OS1cdTBBNUNcdTBBNUVcdTBBNjYtXHUwQTc1XHUwQTgxLVx1MEE4M1x1MEE4NS1cdTBBOERcdTBBOEYtXHUwQTkxXHUwQTkzLVx1MEFBOFx1MEFBQS1cdTBBQjBcdTBBQjJcdTBBQjNcdTBBQjUtXHUwQUI5XHUwQUJDLVx1MEFDNVx1MEFDNy1cdTBBQzlcdTBBQ0ItXHUwQUNEXHUwQUQwXHUwQUUwLVx1MEFFM1x1MEFFNi1cdTBBRUZcdTBBRjlcdTBCMDEtXHUwQjAzXHUwQjA1LVx1MEIwQ1x1MEIwRlx1MEIxMFx1MEIxMy1cdTBCMjhcdTBCMkEtXHUwQjMwXHUwQjMyXHUwQjMzXHUwQjM1LVx1MEIzOVx1MEIzQy1cdTBCNDRcdTBCNDdcdTBCNDhcdTBCNEItXHUwQjREXHUwQjU2XHUwQjU3XHUwQjVDXHUwQjVEXHUwQjVGLVx1MEI2M1x1MEI2Ni1cdTBCNkZcdTBCNzFcdTBCODJcdTBCODNcdTBCODUtXHUwQjhBXHUwQjhFLVx1MEI5MFx1MEI5Mi1cdTBCOTVcdTBCOTlcdTBCOUFcdTBCOUNcdTBCOUVcdTBCOUZcdTBCQTNcdTBCQTRcdTBCQTgtXHUwQkFBXHUwQkFFLVx1MEJCOVx1MEJCRS1cdTBCQzJcdTBCQzYtXHUwQkM4XHUwQkNBLVx1MEJDRFx1MEJEMFx1MEJEN1x1MEJFNi1cdTBCRUZcdTBDMDAtXHUwQzAzXHUwQzA1LVx1MEMwQ1x1MEMwRS1cdTBDMTBcdTBDMTItXHUwQzI4XHUwQzJBLVx1MEMzOVx1MEMzRC1cdTBDNDRcdTBDNDYtXHUwQzQ4XHUwQzRBLVx1MEM0RFx1MEM1NVx1MEM1Nlx1MEM1OC1cdTBDNUFcdTBDNjAtXHUwQzYzXHUwQzY2LVx1MEM2Rlx1MEM4MC1cdTBDODNcdTBDODUtXHUwQzhDXHUwQzhFLVx1MEM5MFx1MEM5Mi1cdTBDQThcdTBDQUEtXHUwQ0IzXHUwQ0I1LVx1MENCOVx1MENCQy1cdTBDQzRcdTBDQzYtXHUwQ0M4XHUwQ0NBLVx1MENDRFx1MENENVx1MENENlx1MENERVx1MENFMC1cdTBDRTNcdTBDRTYtXHUwQ0VGXHUwQ0YxXHUwQ0YyXHUwRDAxLVx1MEQwM1x1MEQwNS1cdTBEMENcdTBEMEUtXHUwRDEwXHUwRDEyLVx1MEQzQVx1MEQzRC1cdTBENDRcdTBENDYtXHUwRDQ4XHUwRDRBLVx1MEQ0RVx1MEQ1NC1cdTBENTdcdTBENUYtXHUwRDYzXHUwRDY2LVx1MEQ2Rlx1MEQ3QS1cdTBEN0ZcdTBEODJcdTBEODNcdTBEODUtXHUwRDk2XHUwRDlBLVx1MERCMVx1MERCMy1cdTBEQkJcdTBEQkRcdTBEQzAtXHUwREM2XHUwRENBXHUwRENGLVx1MERENFx1MERENlx1MEREOC1cdTBEREZcdTBERTYtXHUwREVGXHUwREYyXHUwREYzXHUwRTAxLVx1MEUzQVx1MEU0MC1cdTBFNEVcdTBFNTAtXHUwRTU5XHUwRTgxXHUwRTgyXHUwRTg0XHUwRTg3XHUwRTg4XHUwRThBXHUwRThEXHUwRTk0LVx1MEU5N1x1MEU5OS1cdTBFOUZcdTBFQTEtXHUwRUEzXHUwRUE1XHUwRUE3XHUwRUFBXHUwRUFCXHUwRUFELVx1MEVCOVx1MEVCQi1cdTBFQkRcdTBFQzAtXHUwRUM0XHUwRUM2XHUwRUM4LVx1MEVDRFx1MEVEMC1cdTBFRDlcdTBFREMtXHUwRURGXHUwRjAwXHUwRjE4XHUwRjE5XHUwRjIwLVx1MEYyOVx1MEYzNVx1MEYzN1x1MEYzOVx1MEYzRS1cdTBGNDdcdTBGNDktXHUwRjZDXHUwRjcxLVx1MEY4NFx1MEY4Ni1cdTBGOTdcdTBGOTktXHUwRkJDXHUwRkM2XHUxMDAwLVx1MTA0OVx1MTA1MC1cdTEwOURcdTEwQTAtXHUxMEM1XHUxMEM3XHUxMENEXHUxMEQwLVx1MTBGQVx1MTBGQy1cdTEyNDhcdTEyNEEtXHUxMjREXHUxMjUwLVx1MTI1Nlx1MTI1OFx1MTI1QS1cdTEyNURcdTEyNjAtXHUxMjg4XHUxMjhBLVx1MTI4RFx1MTI5MC1cdTEyQjBcdTEyQjItXHUxMkI1XHUxMkI4LVx1MTJCRVx1MTJDMFx1MTJDMi1cdTEyQzVcdTEyQzgtXHUxMkQ2XHUxMkQ4LVx1MTMxMFx1MTMxMi1cdTEzMTVcdTEzMTgtXHUxMzVBXHUxMzVELVx1MTM1Rlx1MTM4MC1cdTEzOEZcdTEzQTAtXHUxM0Y1XHUxM0Y4LVx1MTNGRFx1MTQwMS1cdTE2NkNcdTE2NkYtXHUxNjdGXHUxNjgxLVx1MTY5QVx1MTZBMC1cdTE2RUFcdTE2RUUtXHUxNkY4XHUxNzAwLVx1MTcwQ1x1MTcwRS1cdTE3MTRcdTE3MjAtXHUxNzM0XHUxNzQwLVx1MTc1M1x1MTc2MC1cdTE3NkNcdTE3NkUtXHUxNzcwXHUxNzcyXHUxNzczXHUxNzgwLVx1MTdEM1x1MTdEN1x1MTdEQ1x1MTdERFx1MTdFMC1cdTE3RTlcdTE4MEItXHUxODBEXHUxODEwLVx1MTgxOVx1MTgyMC1cdTE4NzdcdTE4ODAtXHUxOEFBXHUxOEIwLVx1MThGNVx1MTkwMC1cdTE5MUVcdTE5MjAtXHUxOTJCXHUxOTMwLVx1MTkzQlx1MTk0Ni1cdTE5NkRcdTE5NzAtXHUxOTc0XHUxOTgwLVx1MTlBQlx1MTlCMC1cdTE5QzlcdTE5RDAtXHUxOUQ5XHUxQTAwLVx1MUExQlx1MUEyMC1cdTFBNUVcdTFBNjAtXHUxQTdDXHUxQTdGLVx1MUE4OVx1MUE5MC1cdTFBOTlcdTFBQTdcdTFBQjAtXHUxQUJEXHUxQjAwLVx1MUI0Qlx1MUI1MC1cdTFCNTlcdTFCNkItXHUxQjczXHUxQjgwLVx1MUJGM1x1MUMwMC1cdTFDMzdcdTFDNDAtXHUxQzQ5XHUxQzRELVx1MUM3RFx1MUM4MC1cdTFDODhcdTFDRDAtXHUxQ0QyXHUxQ0Q0LVx1MUNGNlx1MUNGOFx1MUNGOVx1MUQwMC1cdTFERjVcdTFERkItXHUxRjE1XHUxRjE4LVx1MUYxRFx1MUYyMC1cdTFGNDVcdTFGNDgtXHUxRjREXHUxRjUwLVx1MUY1N1x1MUY1OVx1MUY1Qlx1MUY1RFx1MUY1Ri1cdTFGN0RcdTFGODAtXHUxRkI0XHUxRkI2LVx1MUZCQ1x1MUZCRVx1MUZDMi1cdTFGQzRcdTFGQzYtXHUxRkNDXHUxRkQwLVx1MUZEM1x1MUZENi1cdTFGREJcdTFGRTAtXHUxRkVDXHUxRkYyLVx1MUZGNFx1MUZGNi1cdTFGRkNcdTIwMENcdTIwMERcdTIwM0ZcdTIwNDBcdTIwNTRcdTIwNzFcdTIwN0ZcdTIwOTAtXHUyMDlDXHUyMEQwLVx1MjBEQ1x1MjBFMVx1MjBFNS1cdTIwRjBcdTIxMDJcdTIxMDdcdTIxMEEtXHUyMTEzXHUyMTE1XHUyMTE5LVx1MjExRFx1MjEyNFx1MjEyNlx1MjEyOFx1MjEyQS1cdTIxMkRcdTIxMkYtXHUyMTM5XHUyMTNDLVx1MjEzRlx1MjE0NS1cdTIxNDlcdTIxNEVcdTIxNjAtXHUyMTg4XHUyQzAwLVx1MkMyRVx1MkMzMC1cdTJDNUVcdTJDNjAtXHUyQ0U0XHUyQ0VCLVx1MkNGM1x1MkQwMC1cdTJEMjVcdTJEMjdcdTJEMkRcdTJEMzAtXHUyRDY3XHUyRDZGXHUyRDdGLVx1MkQ5Nlx1MkRBMC1cdTJEQTZcdTJEQTgtXHUyREFFXHUyREIwLVx1MkRCNlx1MkRCOC1cdTJEQkVcdTJEQzAtXHUyREM2XHUyREM4LVx1MkRDRVx1MkREMC1cdTJERDZcdTJERDgtXHUyRERFXHUyREUwLVx1MkRGRlx1MkUyRlx1MzAwNS1cdTMwMDdcdTMwMjEtXHUzMDJGXHUzMDMxLVx1MzAzNVx1MzAzOC1cdTMwM0NcdTMwNDEtXHUzMDk2XHUzMDk5XHUzMDlBXHUzMDlELVx1MzA5Rlx1MzBBMS1cdTMwRkFcdTMwRkMtXHUzMEZGXHUzMTA1LVx1MzEyRFx1MzEzMS1cdTMxOEVcdTMxQTAtXHUzMUJBXHUzMUYwLVx1MzFGRlx1MzQwMC1cdTREQjVcdTRFMDAtXHU5RkQ1XHVBMDAwLVx1QTQ4Q1x1QTREMC1cdUE0RkRcdUE1MDAtXHVBNjBDXHVBNjEwLVx1QTYyQlx1QTY0MC1cdUE2NkZcdUE2NzQtXHVBNjdEXHVBNjdGLVx1QTZGMVx1QTcxNy1cdUE3MUZcdUE3MjItXHVBNzg4XHVBNzhCLVx1QTdBRVx1QTdCMC1cdUE3QjdcdUE3RjctXHVBODI3XHVBODQwLVx1QTg3M1x1QTg4MC1cdUE4QzVcdUE4RDAtXHVBOEQ5XHVBOEUwLVx1QThGN1x1QThGQlx1QThGRFx1QTkwMC1cdUE5MkRcdUE5MzAtXHVBOTUzXHVBOTYwLVx1QTk3Q1x1QTk4MC1cdUE5QzBcdUE5Q0YtXHVBOUQ5XHVBOUUwLVx1QTlGRVx1QUEwMC1cdUFBMzZcdUFBNDAtXHVBQTREXHVBQTUwLVx1QUE1OVx1QUE2MC1cdUFBNzZcdUFBN0EtXHVBQUMyXHVBQURCLVx1QUFERFx1QUFFMC1cdUFBRUZcdUFBRjItXHVBQUY2XHVBQjAxLVx1QUIwNlx1QUIwOS1cdUFCMEVcdUFCMTEtXHVBQjE2XHVBQjIwLVx1QUIyNlx1QUIyOC1cdUFCMkVcdUFCMzAtXHVBQjVBXHVBQjVDLVx1QUI2NVx1QUI3MC1cdUFCRUFcdUFCRUNcdUFCRURcdUFCRjAtXHVBQkY5XHVBQzAwLVx1RDdBM1x1RDdCMC1cdUQ3QzZcdUQ3Q0ItXHVEN0ZCXHVGOTAwLVx1RkE2RFx1RkE3MC1cdUZBRDlcdUZCMDAtXHVGQjA2XHVGQjEzLVx1RkIxN1x1RkIxRC1cdUZCMjhcdUZCMkEtXHVGQjM2XHVGQjM4LVx1RkIzQ1x1RkIzRVx1RkI0MFx1RkI0MVx1RkI0M1x1RkI0NFx1RkI0Ni1cdUZCQjFcdUZCRDMtXHVGRDNEXHVGRDUwLVx1RkQ4Rlx1RkQ5Mi1cdUZEQzdcdUZERjAtXHVGREZCXHVGRTAwLVx1RkUwRlx1RkUyMC1cdUZFMkZcdUZFMzNcdUZFMzRcdUZFNEQtXHVGRTRGXHVGRTcwLVx1RkU3NFx1RkU3Ni1cdUZFRkNcdUZGMTAtXHVGRjE5XHVGRjIxLVx1RkYzQVx1RkYzRlx1RkY0MS1cdUZGNUFcdUZGNjYtXHVGRkJFXHVGRkMyLVx1RkZDN1x1RkZDQS1cdUZGQ0ZcdUZGRDItXHVGRkQ3XHVGRkRBLVx1RkZEQ10vIH0sIGUyID0geyBOb25Bc2NpaUlkZW50aWZpZXJTdGFydDogL1tceEFBXHhCNVx4QkFceEMwLVx4RDZceEQ4LVx4RjZceEY4LVx1MDJDMVx1MDJDNi1cdTAyRDFcdTAyRTAtXHUwMkU0XHUwMkVDXHUwMkVFXHUwMzcwLVx1MDM3NFx1MDM3Nlx1MDM3N1x1MDM3QS1cdTAzN0RcdTAzN0ZcdTAzODZcdTAzODgtXHUwMzhBXHUwMzhDXHUwMzhFLVx1MDNBMVx1MDNBMy1cdTAzRjVcdTAzRjctXHUwNDgxXHUwNDhBLVx1MDUyRlx1MDUzMS1cdTA1NTZcdTA1NTlcdTA1NjEtXHUwNTg3XHUwNUQwLVx1MDVFQVx1MDVGMC1cdTA1RjJcdTA2MjAtXHUwNjRBXHUwNjZFXHUwNjZGXHUwNjcxLVx1MDZEM1x1MDZENVx1MDZFNVx1MDZFNlx1MDZFRVx1MDZFRlx1MDZGQS1cdTA2RkNcdTA2RkZcdTA3MTBcdTA3MTItXHUwNzJGXHUwNzRELVx1MDdBNVx1MDdCMVx1MDdDQS1cdTA3RUFcdTA3RjRcdTA3RjVcdTA3RkFcdTA4MDAtXHUwODE1XHUwODFBXHUwODI0XHUwODI4XHUwODQwLVx1MDg1OFx1MDhBMC1cdTA4QjRcdTA4QjYtXHUwOEJEXHUwOTA0LVx1MDkzOVx1MDkzRFx1MDk1MFx1MDk1OC1cdTA5NjFcdTA5NzEtXHUwOTgwXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCRFx1MDlDRVx1MDlEQ1x1MDlERFx1MDlERi1cdTA5RTFcdTA5RjBcdTA5RjFcdTBBMDUtXHUwQTBBXHUwQTBGXHUwQTEwXHUwQTEzLVx1MEEyOFx1MEEyQS1cdTBBMzBcdTBBMzJcdTBBMzNcdTBBMzVcdTBBMzZcdTBBMzhcdTBBMzlcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTcyLVx1MEE3NFx1MEE4NS1cdTBBOERcdTBBOEYtXHUwQTkxXHUwQTkzLVx1MEFBOFx1MEFBQS1cdTBBQjBcdTBBQjJcdTBBQjNcdTBBQjUtXHUwQUI5XHUwQUJEXHUwQUQwXHUwQUUwXHUwQUUxXHUwQUY5XHUwQjA1LVx1MEIwQ1x1MEIwRlx1MEIxMFx1MEIxMy1cdTBCMjhcdTBCMkEtXHUwQjMwXHUwQjMyXHUwQjMzXHUwQjM1LVx1MEIzOVx1MEIzRFx1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjFcdTBCNzFcdTBCODNcdTBCODUtXHUwQjhBXHUwQjhFLVx1MEI5MFx1MEI5Mi1cdTBCOTVcdTBCOTlcdTBCOUFcdTBCOUNcdTBCOUVcdTBCOUZcdTBCQTNcdTBCQTRcdTBCQTgtXHUwQkFBXHUwQkFFLVx1MEJCOVx1MEJEMFx1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0RcdTBDNTgtXHUwQzVBXHUwQzYwXHUwQzYxXHUwQzgwXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkRcdTBDREVcdTBDRTBcdTBDRTFcdTBDRjFcdTBDRjJcdTBEMDUtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0RcdTBENEVcdTBENTQtXHUwRDU2XHUwRDVGLVx1MEQ2MVx1MEQ3QS1cdTBEN0ZcdTBEODUtXHUwRDk2XHUwRDlBLVx1MERCMVx1MERCMy1cdTBEQkJcdTBEQkRcdTBEQzAtXHUwREM2XHUwRTAxLVx1MEUzMFx1MEUzMlx1MEUzM1x1MEU0MC1cdTBFNDZcdTBFODFcdTBFODJcdTBFODRcdTBFODdcdTBFODhcdTBFOEFcdTBFOERcdTBFOTQtXHUwRTk3XHUwRTk5LVx1MEU5Rlx1MEVBMS1cdTBFQTNcdTBFQTVcdTBFQTdcdTBFQUFcdTBFQUJcdTBFQUQtXHUwRUIwXHUwRUIyXHUwRUIzXHUwRUJEXHUwRUMwLVx1MEVDNFx1MEVDNlx1MEVEQy1cdTBFREZcdTBGMDBcdTBGNDAtXHUwRjQ3XHUwRjQ5LVx1MEY2Q1x1MEY4OC1cdTBGOENcdTEwMDAtXHUxMDJBXHUxMDNGXHUxMDUwLVx1MTA1NVx1MTA1QS1cdTEwNURcdTEwNjFcdTEwNjVcdTEwNjZcdTEwNkUtXHUxMDcwXHUxMDc1LVx1MTA4MVx1MTA4RVx1MTBBMC1cdTEwQzVcdTEwQzdcdTEwQ0RcdTEwRDAtXHUxMEZBXHUxMEZDLVx1MTI0OFx1MTI0QS1cdTEyNERcdTEyNTAtXHUxMjU2XHUxMjU4XHUxMjVBLVx1MTI1RFx1MTI2MC1cdTEyODhcdTEyOEEtXHUxMjhEXHUxMjkwLVx1MTJCMFx1MTJCMi1cdTEyQjVcdTEyQjgtXHUxMkJFXHUxMkMwXHUxMkMyLVx1MTJDNVx1MTJDOC1cdTEyRDZcdTEyRDgtXHUxMzEwXHUxMzEyLVx1MTMxNVx1MTMxOC1cdTEzNUFcdTEzODAtXHUxMzhGXHUxM0EwLVx1MTNGNVx1MTNGOC1cdTEzRkRcdTE0MDEtXHUxNjZDXHUxNjZGLVx1MTY3Rlx1MTY4MS1cdTE2OUFcdTE2QTAtXHUxNkVBXHUxNkVFLVx1MTZGOFx1MTcwMC1cdTE3MENcdTE3MEUtXHUxNzExXHUxNzIwLVx1MTczMVx1MTc0MC1cdTE3NTFcdTE3NjAtXHUxNzZDXHUxNzZFLVx1MTc3MFx1MTc4MC1cdTE3QjNcdTE3RDdcdTE3RENcdTE4MjAtXHUxODc3XHUxODgwLVx1MThBOFx1MThBQVx1MThCMC1cdTE4RjVcdTE5MDAtXHUxOTFFXHUxOTUwLVx1MTk2RFx1MTk3MC1cdTE5NzRcdTE5ODAtXHUxOUFCXHUxOUIwLVx1MTlDOVx1MUEwMC1cdTFBMTZcdTFBMjAtXHUxQTU0XHUxQUE3XHUxQjA1LVx1MUIzM1x1MUI0NS1cdTFCNEJcdTFCODMtXHUxQkEwXHUxQkFFXHUxQkFGXHUxQkJBLVx1MUJFNVx1MUMwMC1cdTFDMjNcdTFDNEQtXHUxQzRGXHUxQzVBLVx1MUM3RFx1MUM4MC1cdTFDODhcdTFDRTktXHUxQ0VDXHUxQ0VFLVx1MUNGMVx1MUNGNVx1MUNGNlx1MUQwMC1cdTFEQkZcdTFFMDAtXHUxRjE1XHUxRjE4LVx1MUYxRFx1MUYyMC1cdTFGNDVcdTFGNDgtXHUxRjREXHUxRjUwLVx1MUY1N1x1MUY1OVx1MUY1Qlx1MUY1RFx1MUY1Ri1cdTFGN0RcdTFGODAtXHUxRkI0XHUxRkI2LVx1MUZCQ1x1MUZCRVx1MUZDMi1cdTFGQzRcdTFGQzYtXHUxRkNDXHUxRkQwLVx1MUZEM1x1MUZENi1cdTFGREJcdTFGRTAtXHUxRkVDXHUxRkYyLVx1MUZGNFx1MUZGNi1cdTFGRkNcdTIwNzFcdTIwN0ZcdTIwOTAtXHUyMDlDXHUyMTAyXHUyMTA3XHUyMTBBLVx1MjExM1x1MjExNVx1MjExOC1cdTIxMURcdTIxMjRcdTIxMjZcdTIxMjhcdTIxMkEtXHUyMTM5XHUyMTNDLVx1MjEzRlx1MjE0NS1cdTIxNDlcdTIxNEVcdTIxNjAtXHUyMTg4XHUyQzAwLVx1MkMyRVx1MkMzMC1cdTJDNUVcdTJDNjAtXHUyQ0U0XHUyQ0VCLVx1MkNFRVx1MkNGMlx1MkNGM1x1MkQwMC1cdTJEMjVcdTJEMjdcdTJEMkRcdTJEMzAtXHUyRDY3XHUyRDZGXHUyRDgwLVx1MkQ5Nlx1MkRBMC1cdTJEQTZcdTJEQTgtXHUyREFFXHUyREIwLVx1MkRCNlx1MkRCOC1cdTJEQkVcdTJEQzAtXHUyREM2XHUyREM4LVx1MkRDRVx1MkREMC1cdTJERDZcdTJERDgtXHUyRERFXHUzMDA1LVx1MzAwN1x1MzAyMS1cdTMwMjlcdTMwMzEtXHUzMDM1XHUzMDM4LVx1MzAzQ1x1MzA0MS1cdTMwOTZcdTMwOUItXHUzMDlGXHUzMEExLVx1MzBGQVx1MzBGQy1cdTMwRkZcdTMxMDUtXHUzMTJEXHUzMTMxLVx1MzE4RVx1MzFBMC1cdTMxQkFcdTMxRjAtXHUzMUZGXHUzNDAwLVx1NERCNVx1NEUwMC1cdTlGRDVcdUEwMDAtXHVBNDhDXHVBNEQwLVx1QTRGRFx1QTUwMC1cdUE2MENcdUE2MTAtXHVBNjFGXHVBNjJBXHVBNjJCXHVBNjQwLVx1QTY2RVx1QTY3Ri1cdUE2OURcdUE2QTAtXHVBNkVGXHVBNzE3LVx1QTcxRlx1QTcyMi1cdUE3ODhcdUE3OEItXHVBN0FFXHVBN0IwLVx1QTdCN1x1QTdGNy1cdUE4MDFcdUE4MDMtXHVBODA1XHVBODA3LVx1QTgwQVx1QTgwQy1cdUE4MjJcdUE4NDAtXHVBODczXHVBODgyLVx1QThCM1x1QThGMi1cdUE4RjdcdUE4RkJcdUE4RkRcdUE5MEEtXHVBOTI1XHVBOTMwLVx1QTk0Nlx1QTk2MC1cdUE5N0NcdUE5ODQtXHVBOUIyXHVBOUNGXHVBOUUwLVx1QTlFNFx1QTlFNi1cdUE5RUZcdUE5RkEtXHVBOUZFXHVBQTAwLVx1QUEyOFx1QUE0MC1cdUFBNDJcdUFBNDQtXHVBQTRCXHVBQTYwLVx1QUE3Nlx1QUE3QVx1QUE3RS1cdUFBQUZcdUFBQjFcdUFBQjVcdUFBQjZcdUFBQjktXHVBQUJEXHVBQUMwXHVBQUMyXHVBQURCLVx1QUFERFx1QUFFMC1cdUFBRUFcdUFBRjItXHVBQUY0XHVBQjAxLVx1QUIwNlx1QUIwOS1cdUFCMEVcdUFCMTEtXHVBQjE2XHVBQjIwLVx1QUIyNlx1QUIyOC1cdUFCMkVcdUFCMzAtXHVBQjVBXHVBQjVDLVx1QUI2NVx1QUI3MC1cdUFCRTJcdUFDMDAtXHVEN0EzXHVEN0IwLVx1RDdDNlx1RDdDQi1cdUQ3RkJcdUY5MDAtXHVGQTZEXHVGQTcwLVx1RkFEOVx1RkIwMC1cdUZCMDZcdUZCMTMtXHVGQjE3XHVGQjFEXHVGQjFGLVx1RkIyOFx1RkIyQS1cdUZCMzZcdUZCMzgtXHVGQjNDXHVGQjNFXHVGQjQwXHVGQjQxXHVGQjQzXHVGQjQ0XHVGQjQ2LVx1RkJCMVx1RkJEMy1cdUZEM0RcdUZENTAtXHVGRDhGXHVGRDkyLVx1RkRDN1x1RkRGMC1cdUZERkJcdUZFNzAtXHVGRTc0XHVGRTc2LVx1RkVGQ1x1RkYyMS1cdUZGM0FcdUZGNDEtXHVGRjVBXHVGRjY2LVx1RkZCRVx1RkZDMi1cdUZGQzdcdUZGQ0EtXHVGRkNGXHVGRkQyLVx1RkZEN1x1RkZEQS1cdUZGRENdfFx1RDgwMFtcdURDMDAtXHVEQzBCXHVEQzBELVx1REMyNlx1REMyOC1cdURDM0FcdURDM0NcdURDM0RcdURDM0YtXHVEQzREXHVEQzUwLVx1REM1RFx1REM4MC1cdURDRkFcdURENDAtXHVERDc0XHVERTgwLVx1REU5Q1x1REVBMC1cdURFRDBcdURGMDAtXHVERjFGXHVERjMwLVx1REY0QVx1REY1MC1cdURGNzVcdURGODAtXHVERjlEXHVERkEwLVx1REZDM1x1REZDOC1cdURGQ0ZcdURGRDEtXHVERkQ1XXxcdUQ4MDFbXHVEQzAwLVx1REM5RFx1RENCMC1cdURDRDNcdURDRDgtXHVEQ0ZCXHVERDAwLVx1REQyN1x1REQzMC1cdURENjNcdURFMDAtXHVERjM2XHVERjQwLVx1REY1NVx1REY2MC1cdURGNjddfFx1RDgwMltcdURDMDAtXHVEQzA1XHVEQzA4XHVEQzBBLVx1REMzNVx1REMzN1x1REMzOFx1REMzQ1x1REMzRi1cdURDNTVcdURDNjAtXHVEQzc2XHVEQzgwLVx1REM5RVx1RENFMC1cdURDRjJcdURDRjRcdURDRjVcdUREMDAtXHVERDE1XHVERDIwLVx1REQzOVx1REQ4MC1cdUREQjdcdUREQkVcdUREQkZcdURFMDBcdURFMTAtXHVERTEzXHVERTE1LVx1REUxN1x1REUxOS1cdURFMzNcdURFNjAtXHVERTdDXHVERTgwLVx1REU5Q1x1REVDMC1cdURFQzdcdURFQzktXHVERUU0XHVERjAwLVx1REYzNVx1REY0MC1cdURGNTVcdURGNjAtXHVERjcyXHVERjgwLVx1REY5MV18XHVEODAzW1x1REMwMC1cdURDNDhcdURDODAtXHVEQ0IyXHVEQ0MwLVx1RENGMl18XHVEODA0W1x1REMwMy1cdURDMzdcdURDODMtXHVEQ0FGXHVEQ0QwLVx1RENFOFx1REQwMy1cdUREMjZcdURENTAtXHVERDcyXHVERDc2XHVERDgzLVx1RERCMlx1RERDMS1cdUREQzRcdUREREFcdURERENcdURFMDAtXHVERTExXHVERTEzLVx1REUyQlx1REU4MC1cdURFODZcdURFODhcdURFOEEtXHVERThEXHVERThGLVx1REU5RFx1REU5Ri1cdURFQThcdURFQjAtXHVERURFXHVERjA1LVx1REYwQ1x1REYwRlx1REYxMFx1REYxMy1cdURGMjhcdURGMkEtXHVERjMwXHVERjMyXHVERjMzXHVERjM1LVx1REYzOVx1REYzRFx1REY1MFx1REY1RC1cdURGNjFdfFx1RDgwNVtcdURDMDAtXHVEQzM0XHVEQzQ3LVx1REM0QVx1REM4MC1cdURDQUZcdURDQzRcdURDQzVcdURDQzdcdUREODAtXHVEREFFXHVEREQ4LVx1REREQlx1REUwMC1cdURFMkZcdURFNDRcdURFODAtXHVERUFBXHVERjAwLVx1REYxOV18XHVEODA2W1x1RENBMC1cdURDREZcdURDRkZcdURFQzAtXHVERUY4XXxcdUQ4MDdbXHVEQzAwLVx1REMwOFx1REMwQS1cdURDMkVcdURDNDBcdURDNzItXHVEQzhGXXxcdUQ4MDhbXHVEQzAwLVx1REY5OV18XHVEODA5W1x1REMwMC1cdURDNkVcdURDODAtXHVERDQzXXxbXHVEODBDXHVEODFDLVx1RDgyMFx1RDg0MC1cdUQ4NjhcdUQ4NkEtXHVEODZDXHVEODZGLVx1RDg3Ml1bXHVEQzAwLVx1REZGRl18XHVEODBEW1x1REMwMC1cdURDMkVdfFx1RDgxMVtcdURDMDAtXHVERTQ2XXxcdUQ4MUFbXHVEQzAwLVx1REUzOFx1REU0MC1cdURFNUVcdURFRDAtXHVERUVEXHVERjAwLVx1REYyRlx1REY0MC1cdURGNDNcdURGNjMtXHVERjc3XHVERjdELVx1REY4Rl18XHVEODFCW1x1REYwMC1cdURGNDRcdURGNTBcdURGOTMtXHVERjlGXHVERkUwXXxcdUQ4MjFbXHVEQzAwLVx1REZFQ118XHVEODIyW1x1REMwMC1cdURFRjJdfFx1RDgyQ1tcdURDMDBcdURDMDFdfFx1RDgyRltcdURDMDAtXHVEQzZBXHVEQzcwLVx1REM3Q1x1REM4MC1cdURDODhcdURDOTAtXHVEQzk5XXxcdUQ4MzVbXHVEQzAwLVx1REM1NFx1REM1Ni1cdURDOUNcdURDOUVcdURDOUZcdURDQTJcdURDQTVcdURDQTZcdURDQTktXHVEQ0FDXHVEQ0FFLVx1RENCOVx1RENCQlx1RENCRC1cdURDQzNcdURDQzUtXHVERDA1XHVERDA3LVx1REQwQVx1REQwRC1cdUREMTRcdUREMTYtXHVERDFDXHVERDFFLVx1REQzOVx1REQzQi1cdUREM0VcdURENDAtXHVERDQ0XHVERDQ2XHVERDRBLVx1REQ1MFx1REQ1Mi1cdURFQTVcdURFQTgtXHVERUMwXHVERUMyLVx1REVEQVx1REVEQy1cdURFRkFcdURFRkMtXHVERjE0XHVERjE2LVx1REYzNFx1REYzNi1cdURGNEVcdURGNTAtXHVERjZFXHVERjcwLVx1REY4OFx1REY4QS1cdURGQThcdURGQUEtXHVERkMyXHVERkM0LVx1REZDQl18XHVEODNBW1x1REMwMC1cdURDQzRcdUREMDAtXHVERDQzXXxcdUQ4M0JbXHVERTAwLVx1REUwM1x1REUwNS1cdURFMUZcdURFMjFcdURFMjJcdURFMjRcdURFMjdcdURFMjktXHVERTMyXHVERTM0LVx1REUzN1x1REUzOVx1REUzQlx1REU0Mlx1REU0N1x1REU0OVx1REU0Qlx1REU0RC1cdURFNEZcdURFNTFcdURFNTJcdURFNTRcdURFNTdcdURFNTlcdURFNUJcdURFNURcdURFNUZcdURFNjFcdURFNjJcdURFNjRcdURFNjctXHVERTZBXHVERTZDLVx1REU3Mlx1REU3NC1cdURFNzdcdURFNzktXHVERTdDXHVERTdFXHVERTgwLVx1REU4OVx1REU4Qi1cdURFOUJcdURFQTEtXHVERUEzXHVERUE1LVx1REVBOVx1REVBQi1cdURFQkJdfFx1RDg2OVtcdURDMDAtXHVERUQ2XHVERjAwLVx1REZGRl18XHVEODZEW1x1REMwMC1cdURGMzRcdURGNDAtXHVERkZGXXxcdUQ4NkVbXHVEQzAwLVx1REMxRFx1REMyMC1cdURGRkZdfFx1RDg3M1tcdURDMDAtXHVERUExXXxcdUQ4N0VbXHVEQzAwLVx1REUxRF0vLCBOb25Bc2NpaUlkZW50aWZpZXJQYXJ0OiAvW1x4QUFceEI1XHhCN1x4QkFceEMwLVx4RDZceEQ4LVx4RjZceEY4LVx1MDJDMVx1MDJDNi1cdTAyRDFcdTAyRTAtXHUwMkU0XHUwMkVDXHUwMkVFXHUwMzAwLVx1MDM3NFx1MDM3Nlx1MDM3N1x1MDM3QS1cdTAzN0RcdTAzN0ZcdTAzODYtXHUwMzhBXHUwMzhDXHUwMzhFLVx1MDNBMVx1MDNBMy1cdTAzRjVcdTAzRjctXHUwNDgxXHUwNDgzLVx1MDQ4N1x1MDQ4QS1cdTA1MkZcdTA1MzEtXHUwNTU2XHUwNTU5XHUwNTYxLVx1MDU4N1x1MDU5MS1cdTA1QkRcdTA1QkZcdTA1QzFcdTA1QzJcdTA1QzRcdTA1QzVcdTA1QzdcdTA1RDAtXHUwNUVBXHUwNUYwLVx1MDVGMlx1MDYxMC1cdTA2MUFcdTA2MjAtXHUwNjY5XHUwNjZFLVx1MDZEM1x1MDZENS1cdTA2RENcdTA2REYtXHUwNkU4XHUwNkVBLVx1MDZGQ1x1MDZGRlx1MDcxMC1cdTA3NEFcdTA3NEQtXHUwN0IxXHUwN0MwLVx1MDdGNVx1MDdGQVx1MDgwMC1cdTA4MkRcdTA4NDAtXHUwODVCXHUwOEEwLVx1MDhCNFx1MDhCNi1cdTA4QkRcdTA4RDQtXHUwOEUxXHUwOEUzLVx1MDk2M1x1MDk2Ni1cdTA5NkZcdTA5NzEtXHUwOTgzXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCQy1cdTA5QzRcdTA5QzdcdTA5QzhcdTA5Q0ItXHUwOUNFXHUwOUQ3XHUwOURDXHUwOUREXHUwOURGLVx1MDlFM1x1MDlFNi1cdTA5RjFcdTBBMDEtXHUwQTAzXHUwQTA1LVx1MEEwQVx1MEEwRlx1MEExMFx1MEExMy1cdTBBMjhcdTBBMkEtXHUwQTMwXHUwQTMyXHUwQTMzXHUwQTM1XHUwQTM2XHUwQTM4XHUwQTM5XHUwQTNDXHUwQTNFLVx1MEE0Mlx1MEE0N1x1MEE0OFx1MEE0Qi1cdTBBNERcdTBBNTFcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTY2LVx1MEE3NVx1MEE4MS1cdTBBODNcdTBBODUtXHUwQThEXHUwQThGLVx1MEE5MVx1MEE5My1cdTBBQThcdTBBQUEtXHUwQUIwXHUwQUIyXHUwQUIzXHUwQUI1LVx1MEFCOVx1MEFCQy1cdTBBQzVcdTBBQzctXHUwQUM5XHUwQUNCLVx1MEFDRFx1MEFEMFx1MEFFMC1cdTBBRTNcdTBBRTYtXHUwQUVGXHUwQUY5XHUwQjAxLVx1MEIwM1x1MEIwNS1cdTBCMENcdTBCMEZcdTBCMTBcdTBCMTMtXHUwQjI4XHUwQjJBLVx1MEIzMFx1MEIzMlx1MEIzM1x1MEIzNS1cdTBCMzlcdTBCM0MtXHUwQjQ0XHUwQjQ3XHUwQjQ4XHUwQjRCLVx1MEI0RFx1MEI1Nlx1MEI1N1x1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjNcdTBCNjYtXHUwQjZGXHUwQjcxXHUwQjgyXHUwQjgzXHUwQjg1LVx1MEI4QVx1MEI4RS1cdTBCOTBcdTBCOTItXHUwQjk1XHUwQjk5XHUwQjlBXHUwQjlDXHUwQjlFXHUwQjlGXHUwQkEzXHUwQkE0XHUwQkE4LVx1MEJBQVx1MEJBRS1cdTBCQjlcdTBCQkUtXHUwQkMyXHUwQkM2LVx1MEJDOFx1MEJDQS1cdTBCQ0RcdTBCRDBcdTBCRDdcdTBCRTYtXHUwQkVGXHUwQzAwLVx1MEMwM1x1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0QtXHUwQzQ0XHUwQzQ2LVx1MEM0OFx1MEM0QS1cdTBDNERcdTBDNTVcdTBDNTZcdTBDNTgtXHUwQzVBXHUwQzYwLVx1MEM2M1x1MEM2Ni1cdTBDNkZcdTBDODAtXHUwQzgzXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkMtXHUwQ0M0XHUwQ0M2LVx1MENDOFx1MENDQS1cdTBDQ0RcdTBDRDVcdTBDRDZcdTBDREVcdTBDRTAtXHUwQ0UzXHUwQ0U2LVx1MENFRlx1MENGMVx1MENGMlx1MEQwMS1cdTBEMDNcdTBEMDUtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0QtXHUwRDQ0XHUwRDQ2LVx1MEQ0OFx1MEQ0QS1cdTBENEVcdTBENTQtXHUwRDU3XHUwRDVGLVx1MEQ2M1x1MEQ2Ni1cdTBENkZcdTBEN0EtXHUwRDdGXHUwRDgyXHUwRDgzXHUwRDg1LVx1MEQ5Nlx1MEQ5QS1cdTBEQjFcdTBEQjMtXHUwREJCXHUwREJEXHUwREMwLVx1MERDNlx1MERDQVx1MERDRi1cdTBERDRcdTBERDZcdTBERDgtXHUwRERGXHUwREU2LVx1MERFRlx1MERGMlx1MERGM1x1MEUwMS1cdTBFM0FcdTBFNDAtXHUwRTRFXHUwRTUwLVx1MEU1OVx1MEU4MVx1MEU4Mlx1MEU4NFx1MEU4N1x1MEU4OFx1MEU4QVx1MEU4RFx1MEU5NC1cdTBFOTdcdTBFOTktXHUwRTlGXHUwRUExLVx1MEVBM1x1MEVBNVx1MEVBN1x1MEVBQVx1MEVBQlx1MEVBRC1cdTBFQjlcdTBFQkItXHUwRUJEXHUwRUMwLVx1MEVDNFx1MEVDNlx1MEVDOC1cdTBFQ0RcdTBFRDAtXHUwRUQ5XHUwRURDLVx1MEVERlx1MEYwMFx1MEYxOFx1MEYxOVx1MEYyMC1cdTBGMjlcdTBGMzVcdTBGMzdcdTBGMzlcdTBGM0UtXHUwRjQ3XHUwRjQ5LVx1MEY2Q1x1MEY3MS1cdTBGODRcdTBGODYtXHUwRjk3XHUwRjk5LVx1MEZCQ1x1MEZDNlx1MTAwMC1cdTEwNDlcdTEwNTAtXHUxMDlEXHUxMEEwLVx1MTBDNVx1MTBDN1x1MTBDRFx1MTBEMC1cdTEwRkFcdTEwRkMtXHUxMjQ4XHUxMjRBLVx1MTI0RFx1MTI1MC1cdTEyNTZcdTEyNThcdTEyNUEtXHUxMjVEXHUxMjYwLVx1MTI4OFx1MTI4QS1cdTEyOERcdTEyOTAtXHUxMkIwXHUxMkIyLVx1MTJCNVx1MTJCOC1cdTEyQkVcdTEyQzBcdTEyQzItXHUxMkM1XHUxMkM4LVx1MTJENlx1MTJEOC1cdTEzMTBcdTEzMTItXHUxMzE1XHUxMzE4LVx1MTM1QVx1MTM1RC1cdTEzNUZcdTEzNjktXHUxMzcxXHUxMzgwLVx1MTM4Rlx1MTNBMC1cdTEzRjVcdTEzRjgtXHUxM0ZEXHUxNDAxLVx1MTY2Q1x1MTY2Ri1cdTE2N0ZcdTE2ODEtXHUxNjlBXHUxNkEwLVx1MTZFQVx1MTZFRS1cdTE2RjhcdTE3MDAtXHUxNzBDXHUxNzBFLVx1MTcxNFx1MTcyMC1cdTE3MzRcdTE3NDAtXHUxNzUzXHUxNzYwLVx1MTc2Q1x1MTc2RS1cdTE3NzBcdTE3NzJcdTE3NzNcdTE3ODAtXHUxN0QzXHUxN0Q3XHUxN0RDXHUxN0REXHUxN0UwLVx1MTdFOVx1MTgwQi1cdTE4MERcdTE4MTAtXHUxODE5XHUxODIwLVx1MTg3N1x1MTg4MC1cdTE4QUFcdTE4QjAtXHUxOEY1XHUxOTAwLVx1MTkxRVx1MTkyMC1cdTE5MkJcdTE5MzAtXHUxOTNCXHUxOTQ2LVx1MTk2RFx1MTk3MC1cdTE5NzRcdTE5ODAtXHUxOUFCXHUxOUIwLVx1MTlDOVx1MTlEMC1cdTE5REFcdTFBMDAtXHUxQTFCXHUxQTIwLVx1MUE1RVx1MUE2MC1cdTFBN0NcdTFBN0YtXHUxQTg5XHUxQTkwLVx1MUE5OVx1MUFBN1x1MUFCMC1cdTFBQkRcdTFCMDAtXHUxQjRCXHUxQjUwLVx1MUI1OVx1MUI2Qi1cdTFCNzNcdTFCODAtXHUxQkYzXHUxQzAwLVx1MUMzN1x1MUM0MC1cdTFDNDlcdTFDNEQtXHUxQzdEXHUxQzgwLVx1MUM4OFx1MUNEMC1cdTFDRDJcdTFDRDQtXHUxQ0Y2XHUxQ0Y4XHUxQ0Y5XHUxRDAwLVx1MURGNVx1MURGQi1cdTFGMTVcdTFGMTgtXHUxRjFEXHUxRjIwLVx1MUY0NVx1MUY0OC1cdTFGNERcdTFGNTAtXHUxRjU3XHUxRjU5XHUxRjVCXHUxRjVEXHUxRjVGLVx1MUY3RFx1MUY4MC1cdTFGQjRcdTFGQjYtXHUxRkJDXHUxRkJFXHUxRkMyLVx1MUZDNFx1MUZDNi1cdTFGQ0NcdTFGRDAtXHUxRkQzXHUxRkQ2LVx1MUZEQlx1MUZFMC1cdTFGRUNcdTFGRjItXHUxRkY0XHUxRkY2LVx1MUZGQ1x1MjAwQ1x1MjAwRFx1MjAzRlx1MjA0MFx1MjA1NFx1MjA3MVx1MjA3Rlx1MjA5MC1cdTIwOUNcdTIwRDAtXHUyMERDXHUyMEUxXHUyMEU1LVx1MjBGMFx1MjEwMlx1MjEwN1x1MjEwQS1cdTIxMTNcdTIxMTVcdTIxMTgtXHUyMTFEXHUyMTI0XHUyMTI2XHUyMTI4XHUyMTJBLVx1MjEzOVx1MjEzQy1cdTIxM0ZcdTIxNDUtXHUyMTQ5XHUyMTRFXHUyMTYwLVx1MjE4OFx1MkMwMC1cdTJDMkVcdTJDMzAtXHUyQzVFXHUyQzYwLVx1MkNFNFx1MkNFQi1cdTJDRjNcdTJEMDAtXHUyRDI1XHUyRDI3XHUyRDJEXHUyRDMwLVx1MkQ2N1x1MkQ2Rlx1MkQ3Ri1cdTJEOTZcdTJEQTAtXHUyREE2XHUyREE4LVx1MkRBRVx1MkRCMC1cdTJEQjZcdTJEQjgtXHUyREJFXHUyREMwLVx1MkRDNlx1MkRDOC1cdTJEQ0VcdTJERDAtXHUyREQ2XHUyREQ4LVx1MkRERVx1MkRFMC1cdTJERkZcdTMwMDUtXHUzMDA3XHUzMDIxLVx1MzAyRlx1MzAzMS1cdTMwMzVcdTMwMzgtXHUzMDNDXHUzMDQxLVx1MzA5Nlx1MzA5OS1cdTMwOUZcdTMwQTEtXHUzMEZBXHUzMEZDLVx1MzBGRlx1MzEwNS1cdTMxMkRcdTMxMzEtXHUzMThFXHUzMUEwLVx1MzFCQVx1MzFGMC1cdTMxRkZcdTM0MDAtXHU0REI1XHU0RTAwLVx1OUZENVx1QTAwMC1cdUE0OENcdUE0RDAtXHVBNEZEXHVBNTAwLVx1QTYwQ1x1QTYxMC1cdUE2MkJcdUE2NDAtXHVBNjZGXHVBNjc0LVx1QTY3RFx1QTY3Ri1cdUE2RjFcdUE3MTctXHVBNzFGXHVBNzIyLVx1QTc4OFx1QTc4Qi1cdUE3QUVcdUE3QjAtXHVBN0I3XHVBN0Y3LVx1QTgyN1x1QTg0MC1cdUE4NzNcdUE4ODAtXHVBOEM1XHVBOEQwLVx1QThEOVx1QThFMC1cdUE4RjdcdUE4RkJcdUE4RkRcdUE5MDAtXHVBOTJEXHVBOTMwLVx1QTk1M1x1QTk2MC1cdUE5N0NcdUE5ODAtXHVBOUMwXHVBOUNGLVx1QTlEOVx1QTlFMC1cdUE5RkVcdUFBMDAtXHVBQTM2XHVBQTQwLVx1QUE0RFx1QUE1MC1cdUFBNTlcdUFBNjAtXHVBQTc2XHVBQTdBLVx1QUFDMlx1QUFEQi1cdUFBRERcdUFBRTAtXHVBQUVGXHVBQUYyLVx1QUFGNlx1QUIwMS1cdUFCMDZcdUFCMDktXHVBQjBFXHVBQjExLVx1QUIxNlx1QUIyMC1cdUFCMjZcdUFCMjgtXHVBQjJFXHVBQjMwLVx1QUI1QVx1QUI1Qy1cdUFCNjVcdUFCNzAtXHVBQkVBXHVBQkVDXHVBQkVEXHVBQkYwLVx1QUJGOVx1QUMwMC1cdUQ3QTNcdUQ3QjAtXHVEN0M2XHVEN0NCLVx1RDdGQlx1RjkwMC1cdUZBNkRcdUZBNzAtXHVGQUQ5XHVGQjAwLVx1RkIwNlx1RkIxMy1cdUZCMTdcdUZCMUQtXHVGQjI4XHVGQjJBLVx1RkIzNlx1RkIzOC1cdUZCM0NcdUZCM0VcdUZCNDBcdUZCNDFcdUZCNDNcdUZCNDRcdUZCNDYtXHVGQkIxXHVGQkQzLVx1RkQzRFx1RkQ1MC1cdUZEOEZcdUZEOTItXHVGREM3XHVGREYwLVx1RkRGQlx1RkUwMC1cdUZFMEZcdUZFMjAtXHVGRTJGXHVGRTMzXHVGRTM0XHVGRTRELVx1RkU0Rlx1RkU3MC1cdUZFNzRcdUZFNzYtXHVGRUZDXHVGRjEwLVx1RkYxOVx1RkYyMS1cdUZGM0FcdUZGM0ZcdUZGNDEtXHVGRjVBXHVGRjY2LVx1RkZCRVx1RkZDMi1cdUZGQzdcdUZGQ0EtXHVGRkNGXHVGRkQyLVx1RkZEN1x1RkZEQS1cdUZGRENdfFx1RDgwMFtcdURDMDAtXHVEQzBCXHVEQzBELVx1REMyNlx1REMyOC1cdURDM0FcdURDM0NcdURDM0RcdURDM0YtXHVEQzREXHVEQzUwLVx1REM1RFx1REM4MC1cdURDRkFcdURENDAtXHVERDc0XHVEREZEXHVERTgwLVx1REU5Q1x1REVBMC1cdURFRDBcdURFRTBcdURGMDAtXHVERjFGXHVERjMwLVx1REY0QVx1REY1MC1cdURGN0FcdURGODAtXHVERjlEXHVERkEwLVx1REZDM1x1REZDOC1cdURGQ0ZcdURGRDEtXHVERkQ1XXxcdUQ4MDFbXHVEQzAwLVx1REM5RFx1RENBMC1cdURDQTlcdURDQjAtXHVEQ0QzXHVEQ0Q4LVx1RENGQlx1REQwMC1cdUREMjdcdUREMzAtXHVERDYzXHVERTAwLVx1REYzNlx1REY0MC1cdURGNTVcdURGNjAtXHVERjY3XXxcdUQ4MDJbXHVEQzAwLVx1REMwNVx1REMwOFx1REMwQS1cdURDMzVcdURDMzdcdURDMzhcdURDM0NcdURDM0YtXHVEQzU1XHVEQzYwLVx1REM3Nlx1REM4MC1cdURDOUVcdURDRTAtXHVEQ0YyXHVEQ0Y0XHVEQ0Y1XHVERDAwLVx1REQxNVx1REQyMC1cdUREMzlcdUREODAtXHVEREI3XHVEREJFXHVEREJGXHVERTAwLVx1REUwM1x1REUwNVx1REUwNlx1REUwQy1cdURFMTNcdURFMTUtXHVERTE3XHVERTE5LVx1REUzM1x1REUzOC1cdURFM0FcdURFM0ZcdURFNjAtXHVERTdDXHVERTgwLVx1REU5Q1x1REVDMC1cdURFQzdcdURFQzktXHVERUU2XHVERjAwLVx1REYzNVx1REY0MC1cdURGNTVcdURGNjAtXHVERjcyXHVERjgwLVx1REY5MV18XHVEODAzW1x1REMwMC1cdURDNDhcdURDODAtXHVEQ0IyXHVEQ0MwLVx1RENGMl18XHVEODA0W1x1REMwMC1cdURDNDZcdURDNjYtXHVEQzZGXHVEQzdGLVx1RENCQVx1RENEMC1cdURDRThcdURDRjAtXHVEQ0Y5XHVERDAwLVx1REQzNFx1REQzNi1cdUREM0ZcdURENTAtXHVERDczXHVERDc2XHVERDgwLVx1RERDNFx1RERDQS1cdUREQ0NcdURERDAtXHVERERBXHVERERDXHVERTAwLVx1REUxMVx1REUxMy1cdURFMzdcdURFM0VcdURFODAtXHVERTg2XHVERTg4XHVERThBLVx1REU4RFx1REU4Ri1cdURFOURcdURFOUYtXHVERUE4XHVERUIwLVx1REVFQVx1REVGMC1cdURFRjlcdURGMDAtXHVERjAzXHVERjA1LVx1REYwQ1x1REYwRlx1REYxMFx1REYxMy1cdURGMjhcdURGMkEtXHVERjMwXHVERjMyXHVERjMzXHVERjM1LVx1REYzOVx1REYzQy1cdURGNDRcdURGNDdcdURGNDhcdURGNEItXHVERjREXHVERjUwXHVERjU3XHVERjVELVx1REY2M1x1REY2Ni1cdURGNkNcdURGNzAtXHVERjc0XXxcdUQ4MDVbXHVEQzAwLVx1REM0QVx1REM1MC1cdURDNTlcdURDODAtXHVEQ0M1XHVEQ0M3XHVEQ0QwLVx1RENEOVx1REQ4MC1cdUREQjVcdUREQjgtXHVEREMwXHVEREQ4LVx1RERERFx1REUwMC1cdURFNDBcdURFNDRcdURFNTAtXHVERTU5XHVERTgwLVx1REVCN1x1REVDMC1cdURFQzlcdURGMDAtXHVERjE5XHVERjFELVx1REYyQlx1REYzMC1cdURGMzldfFx1RDgwNltcdURDQTAtXHVEQ0U5XHVEQ0ZGXHVERUMwLVx1REVGOF18XHVEODA3W1x1REMwMC1cdURDMDhcdURDMEEtXHVEQzM2XHVEQzM4LVx1REM0MFx1REM1MC1cdURDNTlcdURDNzItXHVEQzhGXHVEQzkyLVx1RENBN1x1RENBOS1cdURDQjZdfFx1RDgwOFtcdURDMDAtXHVERjk5XXxcdUQ4MDlbXHVEQzAwLVx1REM2RVx1REM4MC1cdURENDNdfFtcdUQ4MENcdUQ4MUMtXHVEODIwXHVEODQwLVx1RDg2OFx1RDg2QS1cdUQ4NkNcdUQ4NkYtXHVEODcyXVtcdURDMDAtXHVERkZGXXxcdUQ4MERbXHVEQzAwLVx1REMyRV18XHVEODExW1x1REMwMC1cdURFNDZdfFx1RDgxQVtcdURDMDAtXHVERTM4XHVERTQwLVx1REU1RVx1REU2MC1cdURFNjlcdURFRDAtXHVERUVEXHVERUYwLVx1REVGNFx1REYwMC1cdURGMzZcdURGNDAtXHVERjQzXHVERjUwLVx1REY1OVx1REY2My1cdURGNzdcdURGN0QtXHVERjhGXXxcdUQ4MUJbXHVERjAwLVx1REY0NFx1REY1MC1cdURGN0VcdURGOEYtXHVERjlGXHVERkUwXXxcdUQ4MjFbXHVEQzAwLVx1REZFQ118XHVEODIyW1x1REMwMC1cdURFRjJdfFx1RDgyQ1tcdURDMDBcdURDMDFdfFx1RDgyRltcdURDMDAtXHVEQzZBXHVEQzcwLVx1REM3Q1x1REM4MC1cdURDODhcdURDOTAtXHVEQzk5XHVEQzlEXHVEQzlFXXxcdUQ4MzRbXHVERDY1LVx1REQ2OVx1REQ2RC1cdURENzJcdUREN0ItXHVERDgyXHVERDg1LVx1REQ4Qlx1RERBQS1cdUREQURcdURFNDItXHVERTQ0XXxcdUQ4MzVbXHVEQzAwLVx1REM1NFx1REM1Ni1cdURDOUNcdURDOUVcdURDOUZcdURDQTJcdURDQTVcdURDQTZcdURDQTktXHVEQ0FDXHVEQ0FFLVx1RENCOVx1RENCQlx1RENCRC1cdURDQzNcdURDQzUtXHVERDA1XHVERDA3LVx1REQwQVx1REQwRC1cdUREMTRcdUREMTYtXHVERDFDXHVERDFFLVx1REQzOVx1REQzQi1cdUREM0VcdURENDAtXHVERDQ0XHVERDQ2XHVERDRBLVx1REQ1MFx1REQ1Mi1cdURFQTVcdURFQTgtXHVERUMwXHVERUMyLVx1REVEQVx1REVEQy1cdURFRkFcdURFRkMtXHVERjE0XHVERjE2LVx1REYzNFx1REYzNi1cdURGNEVcdURGNTAtXHVERjZFXHVERjcwLVx1REY4OFx1REY4QS1cdURGQThcdURGQUEtXHVERkMyXHVERkM0LVx1REZDQlx1REZDRS1cdURGRkZdfFx1RDgzNltcdURFMDAtXHVERTM2XHVERTNCLVx1REU2Q1x1REU3NVx1REU4NFx1REU5Qi1cdURFOUZcdURFQTEtXHVERUFGXXxcdUQ4MzhbXHVEQzAwLVx1REMwNlx1REMwOC1cdURDMThcdURDMUItXHVEQzIxXHVEQzIzXHVEQzI0XHVEQzI2LVx1REMyQV18XHVEODNBW1x1REMwMC1cdURDQzRcdURDRDAtXHVEQ0Q2XHVERDAwLVx1REQ0QVx1REQ1MC1cdURENTldfFx1RDgzQltcdURFMDAtXHVERTAzXHVERTA1LVx1REUxRlx1REUyMVx1REUyMlx1REUyNFx1REUyN1x1REUyOS1cdURFMzJcdURFMzQtXHVERTM3XHVERTM5XHVERTNCXHVERTQyXHVERTQ3XHVERTQ5XHVERTRCXHVERTRELVx1REU0Rlx1REU1MVx1REU1Mlx1REU1NFx1REU1N1x1REU1OVx1REU1Qlx1REU1RFx1REU1Rlx1REU2MVx1REU2Mlx1REU2NFx1REU2Ny1cdURFNkFcdURFNkMtXHVERTcyXHVERTc0LVx1REU3N1x1REU3OS1cdURFN0NcdURFN0VcdURFODAtXHVERTg5XHVERThCLVx1REU5Qlx1REVBMS1cdURFQTNcdURFQTUtXHVERUE5XHVERUFCLVx1REVCQl18XHVEODY5W1x1REMwMC1cdURFRDZcdURGMDAtXHVERkZGXXxcdUQ4NkRbXHVEQzAwLVx1REYzNFx1REY0MC1cdURGRkZdfFx1RDg2RVtcdURDMDAtXHVEQzFEXHVEQzIwLVx1REZGRl18XHVEODczW1x1REMwMC1cdURFQTFdfFx1RDg3RVtcdURDMDAtXHVERTFEXXxcdURCNDBbXHVERDAwLVx1RERFRl0vIH0sIG4yID0gWzU3NjAsIDgxOTIsIDgxOTMsIDgxOTQsIDgxOTUsIDgxOTYsIDgxOTcsIDgxOTgsIDgxOTksIDgyMDAsIDgyMDEsIDgyMDIsIDgyMzksIDgyODcsIDEyMjg4LCA2NTI3OV0sIHIyID0gbmV3IEFycmF5KDEyOCksIGkyID0gMDsgaTIgPCAxMjg7ICsraTIpCiAgICAgICAgICAgIHIyW2kyXSA9IGkyID49IDk3ICYmIGkyIDw9IDEyMiB8fCBpMiA+PSA2NSAmJiBpMiA8PSA5MCB8fCBpMiA9PT0gMzYgfHwgaTIgPT09IDk1OwogICAgICAgICAgZm9yIChvMiA9IG5ldyBBcnJheSgxMjgpLCBpMiA9IDA7IGkyIDwgMTI4OyArK2kyKQogICAgICAgICAgICBvMltpMl0gPSBpMiA+PSA5NyAmJiBpMiA8PSAxMjIgfHwgaTIgPj0gNjUgJiYgaTIgPD0gOTAgfHwgaTIgPj0gNDggJiYgaTIgPD0gNTcgfHwgaTIgPT09IDM2IHx8IGkyID09PSA5NTsKICAgICAgICAgIEZFLmV4cG9ydHMgPSB7IGlzRGVjaW1hbERpZ2l0OiBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gNDggPD0gZTMgJiYgZTMgPD0gNTc7CiAgICAgICAgICB9LCBpc0hleERpZ2l0OiBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gNDggPD0gZTMgJiYgZTMgPD0gNTcgfHwgOTcgPD0gZTMgJiYgZTMgPD0gMTAyIHx8IDY1IDw9IGUzICYmIGUzIDw9IDcwOwogICAgICAgICAgfSwgaXNPY3RhbERpZ2l0OiBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gZTMgPj0gNDggJiYgZTMgPD0gNTU7CiAgICAgICAgICB9LCBpc1doaXRlU3BhY2U6IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMyA9PT0gMzIgfHwgZTMgPT09IDkgfHwgZTMgPT09IDExIHx8IGUzID09PSAxMiB8fCBlMyA9PT0gMTYwIHx8IGUzID49IDU3NjAgJiYgbjIuaW5kZXhPZihlMykgPj0gMDsKICAgICAgICAgIH0sIGlzTGluZVRlcm1pbmF0b3I6IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMyA9PT0gMTAgfHwgZTMgPT09IDEzIHx8IGUzID09PSA4MjMyIHx8IGUzID09PSA4MjMzOwogICAgICAgICAgfSwgaXNJZGVudGlmaWVyU3RhcnRFUzU6IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMyA8IDEyOCA/IHIyW2UzXSA6IHQyLk5vbkFzY2lpSWRlbnRpZmllclN0YXJ0LnRlc3QodTIoZTMpKTsKICAgICAgICAgIH0sIGlzSWRlbnRpZmllclBhcnRFUzU6IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMyA8IDEyOCA/IG8yW2UzXSA6IHQyLk5vbkFzY2lpSWRlbnRpZmllclBhcnQudGVzdCh1MihlMykpOwogICAgICAgICAgfSwgaXNJZGVudGlmaWVyU3RhcnRFUzY6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0MyA8IDEyOCA/IHIyW3QzXSA6IGUyLk5vbkFzY2lpSWRlbnRpZmllclN0YXJ0LnRlc3QodTIodDMpKTsKICAgICAgICAgIH0sIGlzSWRlbnRpZmllclBhcnRFUzY6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0MyA8IDEyOCA/IG8yW3QzXSA6IGUyLk5vbkFzY2lpSWRlbnRpZmllclBhcnQudGVzdCh1Mih0MykpOwogICAgICAgICAgfSB9OwogICAgICAgIH0oKTsKICAgICAgICB2YXIgeEUgPSB7IGV4cG9ydHM6IHt9IH07CiAgICAgICAgIWZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGUyID0gRkUuZXhwb3J0czsKICAgICAgICAgIGZ1bmN0aW9uIHQyKGUzLCB0MykgewogICAgICAgICAgICByZXR1cm4gISghdDMgJiYgZTMgPT09ICJ5aWVsZCIpICYmIG4yKGUzLCB0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBuMihlMywgdDMpIHsKICAgICAgICAgICAgaWYgKHQzICYmIGZ1bmN0aW9uKGU0KSB7CiAgICAgICAgICAgICAgc3dpdGNoIChlNCkgewogICAgICAgICAgICAgICAgY2FzZSAiaW1wbGVtZW50cyI6CiAgICAgICAgICAgICAgICBjYXNlICJpbnRlcmZhY2UiOgogICAgICAgICAgICAgICAgY2FzZSAicGFja2FnZSI6CiAgICAgICAgICAgICAgICBjYXNlICJwcml2YXRlIjoKICAgICAgICAgICAgICAgIGNhc2UgInByb3RlY3RlZCI6CiAgICAgICAgICAgICAgICBjYXNlICJwdWJsaWMiOgogICAgICAgICAgICAgICAgY2FzZSAic3RhdGljIjoKICAgICAgICAgICAgICAgIGNhc2UgImxldCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfShlMykpCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIHN3aXRjaCAoZTMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmV0dXJuIGUzID09PSAiaWYiIHx8IGUzID09PSAiaW4iIHx8IGUzID09PSAiZG8iOwogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJldHVybiBlMyA9PT0gInZhciIgfHwgZTMgPT09ICJmb3IiIHx8IGUzID09PSAibmV3IiB8fCBlMyA9PT0gInRyeSI7CiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgcmV0dXJuIGUzID09PSAidGhpcyIgfHwgZTMgPT09ICJlbHNlIiB8fCBlMyA9PT0gImNhc2UiIHx8IGUzID09PSAidm9pZCIgfHwgZTMgPT09ICJ3aXRoIiB8fCBlMyA9PT0gImVudW0iOwogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiBlMyA9PT0gIndoaWxlIiB8fCBlMyA9PT0gImJyZWFrIiB8fCBlMyA9PT0gImNhdGNoIiB8fCBlMyA9PT0gInRocm93IiB8fCBlMyA9PT0gImNvbnN0IiB8fCBlMyA9PT0gInlpZWxkIiB8fCBlMyA9PT0gImNsYXNzIiB8fCBlMyA9PT0gInN1cGVyIjsKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICByZXR1cm4gZTMgPT09ICJyZXR1cm4iIHx8IGUzID09PSAidHlwZW9mIiB8fCBlMyA9PT0gImRlbGV0ZSIgfHwgZTMgPT09ICJzd2l0Y2giIHx8IGUzID09PSAiZXhwb3J0IiB8fCBlMyA9PT0gImltcG9ydCI7CiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgcmV0dXJuIGUzID09PSAiZGVmYXVsdCIgfHwgZTMgPT09ICJmaW5hbGx5IiB8fCBlMyA9PT0gImV4dGVuZHMiOwogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIHJldHVybiBlMyA9PT0gImZ1bmN0aW9uIiB8fCBlMyA9PT0gImNvbnRpbnVlIiB8fCBlMyA9PT0gImRlYnVnZ2VyIjsKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgcmV0dXJuIGUzID09PSAiaW5zdGFuY2VvZiI7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gcjIoZTMsIG4zKSB7CiAgICAgICAgICAgIHJldHVybiBlMyA9PT0gIm51bGwiIHx8IGUzID09PSAidHJ1ZSIgfHwgZTMgPT09ICJmYWxzZSIgfHwgdDIoZTMsIG4zKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIG8yKGUzLCB0MykgewogICAgICAgICAgICByZXR1cm4gZTMgPT09ICJudWxsIiB8fCBlMyA9PT0gInRydWUiIHx8IGUzID09PSAiZmFsc2UiIHx8IG4yKGUzLCB0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBpMih0MykgewogICAgICAgICAgICB2YXIgbjMsIHIzLCBvMzsKICAgICAgICAgICAgaWYgKHQzLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChvMyA9IHQzLmNoYXJDb2RlQXQoMCksICFlMi5pc0lkZW50aWZpZXJTdGFydEVTNShvMykpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBmb3IgKG4zID0gMSwgcjMgPSB0My5sZW5ndGg7IG4zIDwgcjM7ICsrbjMpCiAgICAgICAgICAgICAgaWYgKG8zID0gdDMuY2hhckNvZGVBdChuMyksICFlMi5pc0lkZW50aWZpZXJQYXJ0RVM1KG8zKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiB1Mih0MykgewogICAgICAgICAgICB2YXIgbjMsIHIzLCBvMywgaTMsIHUzOwogICAgICAgICAgICBpZiAodDMubGVuZ3RoID09PSAwKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgZm9yICh1MyA9IGUyLmlzSWRlbnRpZmllclN0YXJ0RVM2LCBuMyA9IDAsIHIzID0gdDMubGVuZ3RoOyBuMyA8IHIzOyArK24zKSB7CiAgICAgICAgICAgICAgaWYgKDU1Mjk2IDw9IChvMyA9IHQzLmNoYXJDb2RlQXQobjMpKSAmJiBvMyA8PSA1NjMxOSkgewogICAgICAgICAgICAgICAgaWYgKCsrbjMgPj0gcjMpCiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICghKDU2MzIwIDw9IChpMyA9IHQzLmNoYXJDb2RlQXQobjMpKSAmJiBpMyA8PSA1NzM0MykpCiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIG8zID0gMTAyNCAqIChvMyAtIDU1Mjk2KSArIChpMyAtIDU2MzIwKSArIDY1NTM2OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoIXUzKG8zKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB1MyA9IGUyLmlzSWRlbnRpZmllclBhcnRFUzY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICB4RS5leHBvcnRzID0geyBpc0tleXdvcmRFUzU6IHQyLCBpc0tleXdvcmRFUzY6IG4yLCBpc1Jlc2VydmVkV29yZEVTNTogcjIsIGlzUmVzZXJ2ZWRXb3JkRVM2OiBvMiwgaXNSZXN0cmljdGVkV29yZDogZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzID09PSAiZXZhbCIgfHwgZTMgPT09ICJhcmd1bWVudHMiOwogICAgICAgICAgfSwgaXNJZGVudGlmaWVyTmFtZUVTNTogaTIsIGlzSWRlbnRpZmllck5hbWVFUzY6IHUyLCBpc0lkZW50aWZpZXJFUzU6IGZ1bmN0aW9uKGUzLCB0MykgewogICAgICAgICAgICByZXR1cm4gaTIoZTMpICYmICFyMihlMywgdDMpOwogICAgICAgICAgfSwgaXNJZGVudGlmaWVyRVM2OiBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgcmV0dXJuIHUyKGUzKSAmJiAhbzIoZTMsIHQzKTsKICAgICAgICAgIH0gfTsKICAgICAgICB9KCksIHZFLmFzdCA9IEFFLmV4cG9ydHMsIHZFLmNvZGUgPSBGRS5leHBvcnRzLCB2RS5rZXl3b3JkID0geEUuZXhwb3J0czsKICAgICAgICBjb25zdCBTRSA9IHZFLmtleXdvcmQuaXNJZGVudGlmaWVyTmFtZUVTNSwgeyBnZXRMYXN0OiB3RSwgaGFzTmV3bGluZTogVEUsIHNraXBXaGl0ZXNwYWNlOiBCRSwgaXNOb25FbXB0eUFycmF5OiBORSwgaXNOZXh0TGluZUVtcHR5QWZ0ZXJJbmRleDoga0UsIGdldFN0cmluZ1dpZHRoOiBQRSB9ID0gZGMsIHsgbG9jU3RhcnQ6IE9FLCBsb2NFbmQ6IElFLCBoYXNTYW1lTG9jU3RhcnQ6IExFIH0gPSBvZywgakUgPSAiKD86KD89LilcXHMpIiwgX0UgPSBuZXcgUmVnRXhwKCJeIi5jb25jYXQoakUsICIqOiIpKSwgTUUgPSBuZXcgUmVnRXhwKCJeIi5jb25jYXQoakUsICIqOjoiKSk7CiAgICAgICAgZnVuY3Rpb24gUkUoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAiQmxvY2siIHx8IGUyLnR5cGUgPT09ICJDb21tZW50QmxvY2siIHx8IGUyLnR5cGUgPT09ICJNdWx0aUxpbmUiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBWRShlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJMaW5lIiB8fCBlMi50eXBlID09PSAiQ29tbWVudExpbmUiIHx8IGUyLnR5cGUgPT09ICJTaW5nbGVMaW5lIiB8fCBlMi50eXBlID09PSAiSGFzaGJhbmdDb21tZW50IiB8fCBlMi50eXBlID09PSAiSFRNTE9wZW4iIHx8IGUyLnR5cGUgPT09ICJIVE1MQ2xvc2UiOwogICAgICAgIH0KICAgICAgICBjb25zdCAkRSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KFsiRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uIiwgIkV4cG9ydERlZmF1bHRTcGVjaWZpZXIiLCAiRGVjbGFyZUV4cG9ydERlY2xhcmF0aW9uIiwgIkV4cG9ydE5hbWVkRGVjbGFyYXRpb24iLCAiRXhwb3J0QWxsRGVjbGFyYXRpb24iXSk7CiAgICAgICAgZnVuY3Rpb24gV0UoZTIpIHsKICAgICAgICAgIHJldHVybiBlMiAmJiAkRS5oYXMoZTIudHlwZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHFFKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gIk51bWVyaWNMaXRlcmFsIiB8fCBlMi50eXBlID09PSAiTGl0ZXJhbCIgJiYgdHlwZW9mIGUyLnZhbHVlID09ICJudW1iZXIiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBVRShlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJTdHJpbmdMaXRlcmFsIiB8fCBlMi50eXBlID09PSAiTGl0ZXJhbCIgJiYgdHlwZW9mIGUyLnZhbHVlID09ICJzdHJpbmciOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB6RShlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJGdW5jdGlvbkV4cHJlc3Npb24iIHx8IGUyLnR5cGUgPT09ICJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEdFKGUyKSB7CiAgICAgICAgICByZXR1cm4gWkUoZTIpICYmIGUyLmNhbGxlZS50eXBlID09PSAiSWRlbnRpZmllciIgJiYgKGUyLmNhbGxlZS5uYW1lID09PSAiYXN5bmMiIHx8IGUyLmNhbGxlZS5uYW1lID09PSAiaW5qZWN0IiB8fCBlMi5jYWxsZWUubmFtZSA9PT0gImZha2VBc3luYyIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBIRShlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJKU1hFbGVtZW50IiB8fCBlMi50eXBlID09PSAiSlNYRnJhZ21lbnQiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBKRShlMikgewogICAgICAgICAgcmV0dXJuIGUyLmtpbmQgPT09ICJnZXQiIHx8IGUyLmtpbmQgPT09ICJzZXQiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBYRShlMikgewogICAgICAgICAgcmV0dXJuIEpFKGUyKSB8fCBMRShlMiwgZTIudmFsdWUpOwogICAgICAgIH0KICAgICAgICBjb25zdCBZRSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KFsiQmluYXJ5RXhwcmVzc2lvbiIsICJMb2dpY2FsRXhwcmVzc2lvbiIsICJOR1BpcGVFeHByZXNzaW9uIl0pOwogICAgICAgIGNvbnN0IEtFID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJBbnlUeXBlQW5ub3RhdGlvbiIsICJUU0FueUtleXdvcmQiLCAiTnVsbExpdGVyYWxUeXBlQW5ub3RhdGlvbiIsICJUU051bGxLZXl3b3JkIiwgIlRoaXNUeXBlQW5ub3RhdGlvbiIsICJUU1RoaXNUeXBlIiwgIk51bWJlclR5cGVBbm5vdGF0aW9uIiwgIlRTTnVtYmVyS2V5d29yZCIsICJWb2lkVHlwZUFubm90YXRpb24iLCAiVFNWb2lkS2V5d29yZCIsICJCb29sZWFuVHlwZUFubm90YXRpb24iLCAiVFNCb29sZWFuS2V5d29yZCIsICJCaWdJbnRUeXBlQW5ub3RhdGlvbiIsICJUU0JpZ0ludEtleXdvcmQiLCAiU3ltYm9sVHlwZUFubm90YXRpb24iLCAiVFNTeW1ib2xLZXl3b3JkIiwgIlN0cmluZ1R5cGVBbm5vdGF0aW9uIiwgIlRTU3RyaW5nS2V5d29yZCIsICJCb29sZWFuTGl0ZXJhbFR5cGVBbm5vdGF0aW9uIiwgIlN0cmluZ0xpdGVyYWxUeXBlQW5ub3RhdGlvbiIsICJCaWdJbnRMaXRlcmFsVHlwZUFubm90YXRpb24iLCAiTnVtYmVyTGl0ZXJhbFR5cGVBbm5vdGF0aW9uIiwgIlRTTGl0ZXJhbFR5cGUiLCAiVFNUZW1wbGF0ZUxpdGVyYWxUeXBlIiwgIkVtcHR5VHlwZUFubm90YXRpb24iLCAiTWl4ZWRUeXBlQW5ub3RhdGlvbiIsICJUU05ldmVyS2V5d29yZCIsICJUU09iamVjdEtleXdvcmQiLCAiVFNVbmRlZmluZWRLZXl3b3JkIiwgIlRTVW5rbm93bktleXdvcmQiXSk7CiAgICAgICAgY29uc3QgUUUgPSAvXig/OnNraXB8W2Z4XT8oPzppdHxkZXNjcmliZXx0ZXN0KSkkLzsKICAgICAgICBmdW5jdGlvbiBaRShlMikgewogICAgICAgICAgcmV0dXJuIGUyICYmIChlMi50eXBlID09PSAiQ2FsbEV4cHJlc3Npb24iIHx8IGUyLnR5cGUgPT09ICJPcHRpb25hbENhbGxFeHByZXNzaW9uIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGVDKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgKGUyLnR5cGUgPT09ICJNZW1iZXJFeHByZXNzaW9uIiB8fCBlMi50eXBlID09PSAiT3B0aW9uYWxNZW1iZXJFeHByZXNzaW9uIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRDKGUyKSB7CiAgICAgICAgICByZXR1cm4gL14oPzpcZCt8XGQrXC5cZCspJC8udGVzdChlMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG5DKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIucXVhc2lzLnNvbWUoKGUzKSA9PiBlMy52YWx1ZS5yYXcuaW5jbHVkZXMoIlxuIikpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiByQyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLmV4dHJhID8gZTIuZXh0cmEucmF3IDogZTIucmF3OwogICAgICAgIH0KICAgICAgICBjb25zdCBvQyA9IHsgIj09IjogdHJ1ZSwgIiE9IjogdHJ1ZSwgIj09PSI6IHRydWUsICIhPT0iOiB0cnVlIH0sIGlDID0geyAiKiI6IHRydWUsICIvIjogdHJ1ZSwgIiUiOiB0cnVlIH0sIHVDID0geyAiPj4iOiB0cnVlLCAiPj4+IjogdHJ1ZSwgIjw8IjogdHJ1ZSB9OwogICAgICAgIGNvbnN0IHNDID0ge307CiAgICAgICAgZm9yIChjb25zdCBbZTIsIHQyXSBvZiBbWyJ8PiJdLCBbIj8/Il0sIFsifHwiXSwgWyImJiJdLCBbInwiXSwgWyJeIl0sIFsiJiJdLCBbIj09IiwgIj09PSIsICIhPSIsICIhPT0iXSwgWyI8IiwgIj4iLCAiPD0iLCAiPj0iLCAiaW4iLCAiaW5zdGFuY2VvZiJdLCBbIj4+IiwgIjw8IiwgIj4+PiJdLCBbIisiLCAiLSJdLCBbIioiLCAiLyIsICIlIl0sIFsiKioiXV0uZW50cmllcygpKQogICAgICAgICAgZm9yIChjb25zdCBuMiBvZiB0MikKICAgICAgICAgICAgc0NbbjJdID0gZTI7CiAgICAgICAgZnVuY3Rpb24gYUMoZTIpIHsKICAgICAgICAgIHJldHVybiBzQ1tlMl07CiAgICAgICAgfQogICAgICAgIGNvbnN0IGNDID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7CiAgICAgICAgZnVuY3Rpb24gbEMoZTIpIHsKICAgICAgICAgIGlmIChjQy5oYXMoZTIpKQogICAgICAgICAgICByZXR1cm4gY0MuZ2V0KGUyKTsKICAgICAgICAgIGNvbnN0IHQyID0gW107CiAgICAgICAgICByZXR1cm4gZTIudGhpcyAmJiB0Mi5wdXNoKGUyLnRoaXMpLCBBcnJheS5pc0FycmF5KGUyLnBhcmFtZXRlcnMpID8gdDIucHVzaCguLi5lMi5wYXJhbWV0ZXJzKSA6IEFycmF5LmlzQXJyYXkoZTIucGFyYW1zKSAmJiB0Mi5wdXNoKC4uLmUyLnBhcmFtcyksIGUyLnJlc3QgJiYgdDIucHVzaChlMi5yZXN0KSwgY0Muc2V0KGUyLCB0MiksIHQyOwogICAgICAgIH0KICAgICAgICBjb25zdCBwQyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgV2Vha01hcCgpOwogICAgICAgIGZ1bmN0aW9uIGZDKGUyKSB7CiAgICAgICAgICBpZiAocEMuaGFzKGUyKSkKICAgICAgICAgICAgcmV0dXJuIHBDLmdldChlMik7CiAgICAgICAgICBsZXQgdDIgPSBlMi5hcmd1bWVudHM7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gIkltcG9ydEV4cHJlc3Npb24iICYmICh0MiA9IFtlMi5zb3VyY2VdLCBlMi5hdHRyaWJ1dGVzICYmIHQyLnB1c2goZTIuYXR0cmlidXRlcykpLCBwQy5zZXQoZTIsIHQyKSwgdDI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGRDKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudmFsdWUudHJpbSgpID09PSAicHJldHRpZXItaWdub3JlIiAmJiAhZTIudW5pZ25vcmU7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGhDKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgKGUyLnByZXR0aWVySWdub3JlIHx8IHlDKGUyLCBnQy5QcmV0dGllcklnbm9yZSkpOwogICAgICAgIH0KICAgICAgICBjb25zdCBnQyA9IHsgTGVhZGluZzogMiwgVHJhaWxpbmc6IDQsIERhbmdsaW5nOiA4LCBCbG9jazogMTYsIExpbmU6IDMyLCBQcmV0dGllcklnbm9yZTogNjQsIEZpcnN0OiAxMjgsIExhc3Q6IDI1NiB9LCBtQyA9IChlMiwgdDIpID0+IHsKICAgICAgICAgIGlmICh0eXBlb2YgZTIgPT0gImZ1bmN0aW9uIiAmJiAodDIgPSBlMiwgZTIgPSAwKSwgZTIgfHwgdDIpCiAgICAgICAgICAgIHJldHVybiAobjIsIHIyLCBvMikgPT4gIShlMiAmIGdDLkxlYWRpbmcgJiYgIW4yLmxlYWRpbmcgfHwgZTIgJiBnQy5UcmFpbGluZyAmJiAhbjIudHJhaWxpbmcgfHwgZTIgJiBnQy5EYW5nbGluZyAmJiAobjIubGVhZGluZyB8fCBuMi50cmFpbGluZykgfHwgZTIgJiBnQy5CbG9jayAmJiAhUkUobjIpIHx8IGUyICYgZ0MuTGluZSAmJiAhVkUobjIpIHx8IGUyICYgZ0MuRmlyc3QgJiYgcjIgIT09IDAgfHwgZTIgJiBnQy5MYXN0ICYmIHIyICE9PSBvMi5sZW5ndGggLSAxIHx8IGUyICYgZ0MuUHJldHRpZXJJZ25vcmUgJiYgIWRDKG4yKSB8fCB0MiAmJiAhdDIobjIpKTsKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIHlDKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGlmICghZTIgfHwgIU5FKGUyLmNvbW1lbnRzKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgY29uc3QgcjIgPSBtQyh0MiwgbjIpOwogICAgICAgICAgcmV0dXJuICFyMiB8fCBlMi5jb21tZW50cy5zb21lKHIyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gREMoZTIsIHQyLCBuMikgewogICAgICAgICAgaWYgKCFlMiB8fCAhQXJyYXkuaXNBcnJheShlMi5jb21tZW50cykpCiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgIGNvbnN0IHIyID0gbUModDIsIG4yKTsKICAgICAgICAgIHJldHVybiByMiA/IGUyLmNvbW1lbnRzLmZpbHRlcihyMikgOiBlMi5jb21tZW50czsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gRUMoZTIpIHsKICAgICAgICAgIHJldHVybiBaRShlMikgfHwgZTIudHlwZSA9PT0gIk5ld0V4cHJlc3Npb24iIHx8IGUyLnR5cGUgPT09ICJJbXBvcnRFeHByZXNzaW9uIjsKICAgICAgICB9CiAgICAgICAgdmFyIENDID0geyBnZXRGdW5jdGlvblBhcmFtZXRlcnM6IGxDLCBpdGVyYXRlRnVuY3Rpb25QYXJhbWV0ZXJzUGF0aDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBsZXQgcjIgPSAwOwogICAgICAgICAgY29uc3QgbzIgPSAoZTMpID0+IHQyKGUzLCByMisrKTsKICAgICAgICAgIG4yLnRoaXMgJiYgZTIuY2FsbChvMiwgInRoaXMiKSwgQXJyYXkuaXNBcnJheShuMi5wYXJhbWV0ZXJzKSA/IGUyLmVhY2gobzIsICJwYXJhbWV0ZXJzIikgOiBBcnJheS5pc0FycmF5KG4yLnBhcmFtcykgJiYgZTIuZWFjaChvMiwgInBhcmFtcyIpLCBuMi5yZXN0ICYmIGUyLmNhbGwobzIsICJyZXN0Iik7CiAgICAgICAgfSwgZ2V0Q2FsbEFyZ3VtZW50czogZkMsIGl0ZXJhdGVDYWxsQXJndW1lbnRzUGF0aDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBuMi50eXBlID09PSAiSW1wb3J0RXhwcmVzc2lvbiIgPyAoZTIuY2FsbCgoZTMpID0+IHQyKGUzLCAwKSwgInNvdXJjZSIpLCBuMi5hdHRyaWJ1dGVzICYmIGUyLmNhbGwoKGUzKSA9PiB0MihlMywgMSksICJhdHRyaWJ1dGVzIikpIDogZTIuZWFjaCh0MiwgImFyZ3VtZW50cyIpOwogICAgICAgIH0sIGhhc1Jlc3RQYXJhbWV0ZXI6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBpZiAoZTIucmVzdCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICBjb25zdCB0MiA9IGxDKGUyKTsKICAgICAgICAgIHJldHVybiB0Mi5sZW5ndGggPiAwICYmIHdFKHQyKS50eXBlID09PSAiUmVzdEVsZW1lbnQiOwogICAgICAgIH0sIGdldExlZnRTaWRlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLmV4cHJlc3Npb25zID8gZTIuZXhwcmVzc2lvbnNbMF0gOiBlMi5sZWZ0IHx8IGUyLnRlc3QgfHwgZTIuY2FsbGVlIHx8IGUyLm9iamVjdCB8fCBlMi50YWcgfHwgZTIuYXJndW1lbnQgfHwgZTIuZXhwcmVzc2lvbjsKICAgICAgICB9LCBnZXRMZWZ0U2lkZVBhdGhOYW1lOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGlmICh0Mi5leHByZXNzaW9ucykKICAgICAgICAgICAgcmV0dXJuIFsiZXhwcmVzc2lvbnMiLCAwXTsKICAgICAgICAgIGlmICh0Mi5sZWZ0KQogICAgICAgICAgICByZXR1cm4gWyJsZWZ0Il07CiAgICAgICAgICBpZiAodDIudGVzdCkKICAgICAgICAgICAgcmV0dXJuIFsidGVzdCJdOwogICAgICAgICAgaWYgKHQyLm9iamVjdCkKICAgICAgICAgICAgcmV0dXJuIFsib2JqZWN0Il07CiAgICAgICAgICBpZiAodDIuY2FsbGVlKQogICAgICAgICAgICByZXR1cm4gWyJjYWxsZWUiXTsKICAgICAgICAgIGlmICh0Mi50YWcpCiAgICAgICAgICAgIHJldHVybiBbInRhZyJdOwogICAgICAgICAgaWYgKHQyLmFyZ3VtZW50KQogICAgICAgICAgICByZXR1cm4gWyJhcmd1bWVudCJdOwogICAgICAgICAgaWYgKHQyLmV4cHJlc3Npb24pCiAgICAgICAgICAgIHJldHVybiBbImV4cHJlc3Npb24iXTsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBub2RlIGhhcyBubyBsZWZ0IHNpZGUuIik7CiAgICAgICAgfSwgZ2V0UGFyZW50RXhwb3J0RGVjbGFyYXRpb246IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyLmdldFBhcmVudE5vZGUoKTsKICAgICAgICAgIHJldHVybiBlMi5nZXROYW1lKCkgPT09ICJkZWNsYXJhdGlvbiIgJiYgV0UodDIpID8gdDIgOiBudWxsOwogICAgICAgIH0sIGdldFR5cGVTY3JpcHRNYXBwZWRUeXBlTW9kaWZpZXI6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGUyID09PSAiKyIgPyAiKyIgKyB0MiA6IGUyID09PSAiLSIgPyAiLSIgKyB0MiA6IHQyOwogICAgICAgIH0sIGhhc0Zsb3dBbm5vdGF0aW9uQ29tbWVudDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBORShlMikgJiYgUkUoZTJbMF0pICYmIE1FLnRlc3QoZTJbMF0udmFsdWUpOwogICAgICAgIH0sIGhhc0Zsb3dTaG9ydGhhbmRBbm5vdGF0aW9uQ29tbWVudDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5leHRyYSAmJiBlMi5leHRyYS5wYXJlbnRoZXNpemVkICYmIE5FKGUyLnRyYWlsaW5nQ29tbWVudHMpICYmIFJFKGUyLnRyYWlsaW5nQ29tbWVudHNbMF0pICYmIF9FLnRlc3QoZTIudHJhaWxpbmdDb21tZW50c1swXS52YWx1ZSk7CiAgICAgICAgfSwgaGFzTGVhZGluZ093bkxpbmVDb21tZW50OiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBIRSh0MikgPyBoQyh0MikgOiB5Qyh0MiwgZ0MuTGVhZGluZywgKHQzKSA9PiBURShlMiwgSUUodDMpKSk7CiAgICAgICAgfSwgaGFzTmFrZWRMZWZ0U2lkZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAiQXNzaWdubWVudEV4cHJlc3Npb24iIHx8IGUyLnR5cGUgPT09ICJCaW5hcnlFeHByZXNzaW9uIiB8fCBlMi50eXBlID09PSAiTG9naWNhbEV4cHJlc3Npb24iIHx8IGUyLnR5cGUgPT09ICJOR1BpcGVFeHByZXNzaW9uIiB8fCBlMi50eXBlID09PSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIiB8fCBaRShlMikgfHwgZUMoZTIpIHx8IGUyLnR5cGUgPT09ICJTZXF1ZW5jZUV4cHJlc3Npb24iIHx8IGUyLnR5cGUgPT09ICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iIHx8IGUyLnR5cGUgPT09ICJCaW5kRXhwcmVzc2lvbiIgfHwgZTIudHlwZSA9PT0gIlVwZGF0ZUV4cHJlc3Npb24iICYmICFlMi5wcmVmaXggfHwgZTIudHlwZSA9PT0gIlRTQXNFeHByZXNzaW9uIiB8fCBlMi50eXBlID09PSAiVFNOb25OdWxsRXhwcmVzc2lvbiI7CiAgICAgICAgfSwgaGFzTm9kZTogZnVuY3Rpb24gZTIodDIsIG4yKSB7CiAgICAgICAgICBpZiAoIXQyIHx8IHR5cGVvZiB0MiAhPSAib2JqZWN0IikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodDIpKQogICAgICAgICAgICByZXR1cm4gdDIuc29tZSgodDMpID0+IGUyKHQzLCBuMikpOwogICAgICAgICAgY29uc3QgcjIgPSBuMih0Mik7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIHIyID09ICJib29sZWFuIiA/IHIyIDogT2JqZWN0LnZhbHVlcyh0Mikuc29tZSgodDMpID0+IGUyKHQzLCBuMikpOwogICAgICAgIH0sIGhhc0lnbm9yZUNvbW1lbnQ6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gaEMoZTIuZ2V0VmFsdWUoKSk7CiAgICAgICAgfSwgaGFzTm9kZUlnbm9yZUNvbW1lbnQ6IGhDLCBpZGVudGl0eTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICB9LCBpc0JpbmFyeWlzaDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBZRS5oYXMoZTIudHlwZSk7CiAgICAgICAgfSwgaXNCbG9ja0NvbW1lbnQ6IFJFLCBpc0NhbGxMaWtlRXhwcmVzc2lvbjogRUMsIGlzRW5hYmxlZEhhY2tQaXBlbGluZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBCb29sZWFuKGUyLl9faXNVc2luZ0hhY2tQaXBlbGluZSk7CiAgICAgICAgfSwgaXNMaW5lQ29tbWVudDogVkUsIGlzUHJldHRpZXJJZ25vcmVDb21tZW50OiBkQywgaXNDYWxsRXhwcmVzc2lvbjogWkUsIGlzTWVtYmVyRXhwcmVzc2lvbjogZUMsIGlzRXhwb3J0RGVjbGFyYXRpb246IFdFLCBpc0Zsb3dBbm5vdGF0aW9uQ29tbWVudDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IE9FKHQyKSwgcjIgPSBCRShlMiwgSUUodDIpKTsKICAgICAgICAgIHJldHVybiByMiAhPT0gZmFsc2UgJiYgZTIuc2xpY2UobjIsIG4yICsgMikgPT09ICIvKiIgJiYgZTIuc2xpY2UocjIsIHIyICsgMikgPT09ICIqLyI7CiAgICAgICAgfSwgaXNGdW5jdGlvbkNvbXBvc2l0aW9uQXJnczogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGlmIChlMi5sZW5ndGggPD0gMSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgbGV0IHQyID0gMDsKICAgICAgICAgIGZvciAoY29uc3QgbjIgb2YgZTIpCiAgICAgICAgICAgIGlmICh6RShuMikpIHsKICAgICAgICAgICAgICBpZiAodDIgKz0gMSwgdDIgPiAxKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoWkUobjIpKSB7CiAgICAgICAgICAgICAgZm9yIChjb25zdCBlMyBvZiBuMi5hcmd1bWVudHMpCiAgICAgICAgICAgICAgICBpZiAoekUoZTMpKQogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0sIGlzRnVuY3Rpb25Ob3RhdGlvbjogWEUsIGlzRnVuY3Rpb25PckFycm93RXhwcmVzc2lvbjogekUsIGlzR2V0dGVyT3JTZXR0ZXI6IEpFLCBpc0plc3RFYWNoVGVtcGxhdGVMaXRlcmFsOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gL15bZnhdPyg/OmRlc2NyaWJlfGl0fHRlc3QpJC87CiAgICAgICAgICByZXR1cm4gdDIudHlwZSA9PT0gIlRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbiIgJiYgdDIucXVhc2kgPT09IGUyICYmIHQyLnRhZy50eXBlID09PSAiTWVtYmVyRXhwcmVzc2lvbiIgJiYgdDIudGFnLnByb3BlcnR5LnR5cGUgPT09ICJJZGVudGlmaWVyIiAmJiB0Mi50YWcucHJvcGVydHkubmFtZSA9PT0gImVhY2giICYmICh0Mi50YWcub2JqZWN0LnR5cGUgPT09ICJJZGVudGlmaWVyIiAmJiBuMi50ZXN0KHQyLnRhZy5vYmplY3QubmFtZSkgfHwgdDIudGFnLm9iamVjdC50eXBlID09PSAiTWVtYmVyRXhwcmVzc2lvbiIgJiYgdDIudGFnLm9iamVjdC5wcm9wZXJ0eS50eXBlID09PSAiSWRlbnRpZmllciIgJiYgKHQyLnRhZy5vYmplY3QucHJvcGVydHkubmFtZSA9PT0gIm9ubHkiIHx8IHQyLnRhZy5vYmplY3QucHJvcGVydHkubmFtZSA9PT0gInNraXAiKSAmJiB0Mi50YWcub2JqZWN0Lm9iamVjdC50eXBlID09PSAiSWRlbnRpZmllciIgJiYgbjIudGVzdCh0Mi50YWcub2JqZWN0Lm9iamVjdC5uYW1lKSk7CiAgICAgICAgfSwgaXNKc3hOb2RlOiBIRSwgaXNMaXRlcmFsOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJCb29sZWFuTGl0ZXJhbCIgfHwgZTIudHlwZSA9PT0gIkRpcmVjdGl2ZUxpdGVyYWwiIHx8IGUyLnR5cGUgPT09ICJMaXRlcmFsIiB8fCBlMi50eXBlID09PSAiTnVsbExpdGVyYWwiIHx8IGUyLnR5cGUgPT09ICJOdW1lcmljTGl0ZXJhbCIgfHwgZTIudHlwZSA9PT0gIkJpZ0ludExpdGVyYWwiIHx8IGUyLnR5cGUgPT09ICJEZWNpbWFsTGl0ZXJhbCIgfHwgZTIudHlwZSA9PT0gIlJlZ0V4cExpdGVyYWwiIHx8IGUyLnR5cGUgPT09ICJTdHJpbmdMaXRlcmFsIiB8fCBlMi50eXBlID09PSAiVGVtcGxhdGVMaXRlcmFsIiB8fCBlMi50eXBlID09PSAiVFNUeXBlTGl0ZXJhbCIgfHwgZTIudHlwZSA9PT0gIkpTWFRleHQiOwogICAgICAgIH0sIGlzTG9uZ0N1cnJpZWRDYWxsRXhwcmVzc2lvbjogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTIuZ2V0VmFsdWUoKSwgbjIgPSBlMi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICByZXR1cm4gWkUodDIpICYmIFpFKG4yKSAmJiBuMi5jYWxsZWUgPT09IHQyICYmIHQyLmFyZ3VtZW50cy5sZW5ndGggPiBuMi5hcmd1bWVudHMubGVuZ3RoICYmIG4yLmFyZ3VtZW50cy5sZW5ndGggPiAwOwogICAgICAgIH0sIGlzU2ltcGxlQ2FsbEFyZ3VtZW50OiBmdW5jdGlvbiBlMih0MiwgbjIpIHsKICAgICAgICAgIGlmIChuMiA+PSAyKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBjb25zdCByMiA9ICh0MykgPT4gZTIodDMsIG4yICsgMSksIG8yID0gdDIudHlwZSA9PT0gIkxpdGVyYWwiICYmICJyZWdleCIgaW4gdDIgJiYgdDIucmVnZXgucGF0dGVybiB8fCB0Mi50eXBlID09PSAiUmVnRXhwTGl0ZXJhbCIgJiYgdDIucGF0dGVybjsKICAgICAgICAgIHJldHVybiAhKG8yICYmIFBFKG8yKSA+IDUpICYmICh0Mi50eXBlID09PSAiTGl0ZXJhbCIgfHwgdDIudHlwZSA9PT0gIkJpZ0ludExpdGVyYWwiIHx8IHQyLnR5cGUgPT09ICJEZWNpbWFsTGl0ZXJhbCIgfHwgdDIudHlwZSA9PT0gIkJvb2xlYW5MaXRlcmFsIiB8fCB0Mi50eXBlID09PSAiTnVsbExpdGVyYWwiIHx8IHQyLnR5cGUgPT09ICJOdW1lcmljTGl0ZXJhbCIgfHwgdDIudHlwZSA9PT0gIlJlZ0V4cExpdGVyYWwiIHx8IHQyLnR5cGUgPT09ICJTdHJpbmdMaXRlcmFsIiB8fCB0Mi50eXBlID09PSAiSWRlbnRpZmllciIgfHwgdDIudHlwZSA9PT0gIlRoaXNFeHByZXNzaW9uIiB8fCB0Mi50eXBlID09PSAiU3VwZXIiIHx8IHQyLnR5cGUgPT09ICJQcml2YXRlTmFtZSIgfHwgdDIudHlwZSA9PT0gIlByaXZhdGVJZGVudGlmaWVyIiB8fCB0Mi50eXBlID09PSAiQXJndW1lbnRQbGFjZWhvbGRlciIgfHwgdDIudHlwZSA9PT0gIkltcG9ydCIgfHwgKHQyLnR5cGUgPT09ICJUZW1wbGF0ZUxpdGVyYWwiID8gdDIucXVhc2lzLmV2ZXJ5KChlMykgPT4gIWUzLnZhbHVlLnJhdy5pbmNsdWRlcygiXG4iKSkgJiYgdDIuZXhwcmVzc2lvbnMuZXZlcnkocjIpIDogdDIudHlwZSA9PT0gIk9iamVjdEV4cHJlc3Npb24iID8gdDIucHJvcGVydGllcy5ldmVyeSgoZTMpID0+ICFlMy5jb21wdXRlZCAmJiAoZTMuc2hvcnRoYW5kIHx8IGUzLnZhbHVlICYmIHIyKGUzLnZhbHVlKSkpIDogdDIudHlwZSA9PT0gIkFycmF5RXhwcmVzc2lvbiIgPyB0Mi5lbGVtZW50cy5ldmVyeSgoZTMpID0+IGUzID09PSBudWxsIHx8IHIyKGUzKSkgOiBFQyh0MikgPyAodDIudHlwZSA9PT0gIkltcG9ydEV4cHJlc3Npb24iIHx8IGUyKHQyLmNhbGxlZSwgbjIpKSAmJiBmQyh0MikuZXZlcnkocjIpIDogZUModDIpID8gZTIodDIub2JqZWN0LCBuMikgJiYgZTIodDIucHJvcGVydHksIG4yKSA6IHQyLnR5cGUgIT09ICJVbmFyeUV4cHJlc3Npb24iIHx8IHQyLm9wZXJhdG9yICE9PSAiISIgJiYgdDIub3BlcmF0b3IgIT09ICItIiA/IHQyLnR5cGUgPT09ICJUU05vbk51bGxFeHByZXNzaW9uIiAmJiBlMih0Mi5leHByZXNzaW9uLCBuMikgOiBlMih0Mi5hcmd1bWVudCwgbjIpKSk7CiAgICAgICAgfSwgaXNNZW1iZXJpc2g6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZUMoZTIpIHx8IGUyLnR5cGUgPT09ICJCaW5kRXhwcmVzc2lvbiIgJiYgQm9vbGVhbihlMi5vYmplY3QpOwogICAgICAgIH0sIGlzTnVtZXJpY0xpdGVyYWw6IHFFLCBpc1NpZ25lZE51bWVyaWNMaXRlcmFsOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJVbmFyeUV4cHJlc3Npb24iICYmIChlMi5vcGVyYXRvciA9PT0gIisiIHx8IGUyLm9wZXJhdG9yID09PSAiLSIpICYmIHFFKGUyLmFyZ3VtZW50KTsKICAgICAgICB9LCBpc09iamVjdFByb3BlcnR5OiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyICYmIChlMi50eXBlID09PSAiT2JqZWN0UHJvcGVydHkiIHx8IGUyLnR5cGUgPT09ICJQcm9wZXJ0eSIgJiYgIWUyLm1ldGhvZCAmJiBlMi5raW5kID09PSAiaW5pdCIpOwogICAgICAgIH0sIGlzT2JqZWN0VHlwZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAiT2JqZWN0VHlwZUFubm90YXRpb24iIHx8IGUyLnR5cGUgPT09ICJUU1R5cGVMaXRlcmFsIiB8fCBlMi50eXBlID09PSAiVFNNYXBwZWRUeXBlIjsKICAgICAgICB9LCBpc09iamVjdFR5cGVQcm9wZXJ0eUFGdW5jdGlvbjogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiAhKGUyLnR5cGUgIT09ICJPYmplY3RUeXBlUHJvcGVydHkiICYmIGUyLnR5cGUgIT09ICJPYmplY3RUeXBlSW50ZXJuYWxTbG90IiB8fCBlMi52YWx1ZS50eXBlICE9PSAiRnVuY3Rpb25UeXBlQW5ub3RhdGlvbiIgfHwgZTIuc3RhdGljIHx8IFhFKGUyKSk7CiAgICAgICAgfSwgaXNTaW1wbGVUeXBlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuICEhZTIgJiYgKCEoZTIudHlwZSAhPT0gIkdlbmVyaWNUeXBlQW5ub3RhdGlvbiIgJiYgZTIudHlwZSAhPT0gIlRTVHlwZVJlZmVyZW5jZSIgfHwgZTIudHlwZVBhcmFtZXRlcnMpIHx8ICEhS0UuaGFzKGUyLnR5cGUpKTsKICAgICAgICB9LCBpc1NpbXBsZU51bWJlcjogdEMsIGlzU2ltcGxlVGVtcGxhdGVMaXRlcmFsOiBmdW5jdGlvbihlMikgewogICAgICAgICAgbGV0IHQyID0gImV4cHJlc3Npb25zIjsKICAgICAgICAgIGUyLnR5cGUgPT09ICJUU1RlbXBsYXRlTGl0ZXJhbFR5cGUiICYmICh0MiA9ICJ0eXBlcyIpOwogICAgICAgICAgY29uc3QgbjIgPSBlMlt0Ml07CiAgICAgICAgICByZXR1cm4gbjIubGVuZ3RoICE9PSAwICYmIG4yLmV2ZXJ5KChlMykgPT4gewogICAgICAgICAgICBpZiAoeUMoZTMpKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKGUzLnR5cGUgPT09ICJJZGVudGlmaWVyIiB8fCBlMy50eXBlID09PSAiVGhpc0V4cHJlc3Npb24iKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoZUMoZTMpKSB7CiAgICAgICAgICAgICAgbGV0IHQzID0gZTM7CiAgICAgICAgICAgICAgZm9yICg7IGVDKHQzKTsgKSB7CiAgICAgICAgICAgICAgICBpZiAodDMucHJvcGVydHkudHlwZSAhPT0gIklkZW50aWZpZXIiICYmIHQzLnByb3BlcnR5LnR5cGUgIT09ICJMaXRlcmFsIiAmJiB0My5wcm9wZXJ0eS50eXBlICE9PSAiU3RyaW5nTGl0ZXJhbCIgJiYgdDMucHJvcGVydHkudHlwZSAhPT0gIk51bWVyaWNMaXRlcmFsIikKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKHQzID0gdDMub2JqZWN0LCB5Qyh0MykpCiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHQzLnR5cGUgPT09ICJJZGVudGlmaWVyIiB8fCB0My50eXBlID09PSAiVGhpc0V4cHJlc3Npb24iOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgIH0sIGlzU3RyaW5nTGl0ZXJhbDogVUUsIGlzU3RyaW5nUHJvcFNhZmVUb1VucXVvdGU6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHQyLnBhcnNlciAhPT0gImpzb24iICYmIFVFKGUyLmtleSkgJiYgckMoZTIua2V5KS5zbGljZSgxLCAtMSkgPT09IGUyLmtleS52YWx1ZSAmJiAoU0UoZTIua2V5LnZhbHVlKSAmJiAhKHQyLnBhcnNlciA9PT0gImJhYmVsLXRzIiAmJiBlMi50eXBlID09PSAiQ2xhc3NQcm9wZXJ0eSIgfHwgdDIucGFyc2VyID09PSAidHlwZXNjcmlwdCIgJiYgZTIudHlwZSA9PT0gIlByb3BlcnR5RGVmaW5pdGlvbiIpIHx8IHRDKGUyLmtleS52YWx1ZSkgJiYgU3RyaW5nKE51bWJlcihlMi5rZXkudmFsdWUpKSA9PT0gZTIua2V5LnZhbHVlICYmICh0Mi5wYXJzZXIgPT09ICJiYWJlbCIgfHwgdDIucGFyc2VyID09PSAiZXNwcmVlIiB8fCB0Mi5wYXJzZXIgPT09ICJtZXJpeWFoIiB8fCB0Mi5wYXJzZXIgPT09ICJfX2JhYmVsX2VzdHJlZSIpKTsKICAgICAgICB9LCBpc1RlbXBsYXRlT25JdHNPd25MaW5lOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiAoZTIudHlwZSA9PT0gIlRlbXBsYXRlTGl0ZXJhbCIgJiYgbkMoZTIpIHx8IGUyLnR5cGUgPT09ICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iICYmIG5DKGUyLnF1YXNpKSkgJiYgIVRFKHQyLCBPRShlMiksIHsgYmFja3dhcmRzOiB0cnVlIH0pOwogICAgICAgIH0sIGlzVGVzdENhbGw6IGZ1bmN0aW9uIGUyKHQyLCBuMikgewogICAgICAgICAgaWYgKHQyLnR5cGUgIT09ICJDYWxsRXhwcmVzc2lvbiIpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIGlmICh0Mi5hcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIGlmIChHRSh0MikgJiYgbjIgJiYgZTIobjIpKQogICAgICAgICAgICAgIHJldHVybiB6RSh0Mi5hcmd1bWVudHNbMF0pOwogICAgICAgICAgICBpZiAoZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgICByZXR1cm4gZTMuY2FsbGVlLnR5cGUgPT09ICJJZGVudGlmaWVyIiAmJiAvXig/OmJlZm9yZXxhZnRlcikoPzpFYWNofEFsbCkkLy50ZXN0KGUzLmNhbGxlZS5uYW1lKSAmJiBlMy5hcmd1bWVudHMubGVuZ3RoID09PSAxOwogICAgICAgICAgICB9KHQyKSkKICAgICAgICAgICAgICByZXR1cm4gR0UodDIuYXJndW1lbnRzWzBdKTsKICAgICAgICAgIH0gZWxzZSBpZiAoKHQyLmFyZ3VtZW50cy5sZW5ndGggPT09IDIgfHwgdDIuYXJndW1lbnRzLmxlbmd0aCA9PT0gMykgJiYgKHQyLmNhbGxlZS50eXBlID09PSAiSWRlbnRpZmllciIgJiYgUUUudGVzdCh0Mi5jYWxsZWUubmFtZSkgfHwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGVDKGUzLmNhbGxlZSkgJiYgZTMuY2FsbGVlLm9iamVjdC50eXBlID09PSAiSWRlbnRpZmllciIgJiYgZTMuY2FsbGVlLnByb3BlcnR5LnR5cGUgPT09ICJJZGVudGlmaWVyIiAmJiBRRS50ZXN0KGUzLmNhbGxlZS5vYmplY3QubmFtZSkgJiYgKGUzLmNhbGxlZS5wcm9wZXJ0eS5uYW1lID09PSAib25seSIgfHwgZTMuY2FsbGVlLnByb3BlcnR5Lm5hbWUgPT09ICJza2lwIik7CiAgICAgICAgICB9KHQyKSkgJiYgKGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMy50eXBlID09PSAiVGVtcGxhdGVMaXRlcmFsIjsKICAgICAgICAgIH0odDIuYXJndW1lbnRzWzBdKSB8fCBVRSh0Mi5hcmd1bWVudHNbMF0pKSkKICAgICAgICAgICAgcmV0dXJuICEodDIuYXJndW1lbnRzWzJdICYmICFxRSh0Mi5hcmd1bWVudHNbMl0pKSAmJiAoKHQyLmFyZ3VtZW50cy5sZW5ndGggPT09IDIgPyB6RSh0Mi5hcmd1bWVudHNbMV0pIDogZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgICByZXR1cm4gZTMudHlwZSA9PT0gIkZ1bmN0aW9uRXhwcmVzc2lvbiIgfHwgZTMudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiAmJiBlMy5ib2R5LnR5cGUgPT09ICJCbG9ja1N0YXRlbWVudCI7CiAgICAgICAgICAgIH0odDIuYXJndW1lbnRzWzFdKSAmJiBsQyh0Mi5hcmd1bWVudHNbMV0pLmxlbmd0aCA8PSAxKSB8fCBHRSh0Mi5hcmd1bWVudHNbMV0pKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LCBpc1RoZU9ubHlKc3hFbGVtZW50SW5NYXJrZG93bjogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBpZiAoZTIucGFyZW50UGFyc2VyICE9PSAibWFya2Rvd24iICYmIGUyLnBhcmVudFBhcnNlciAhPT0gIm1keCIpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIGNvbnN0IG4yID0gdDIuZ2V0Tm9kZSgpOwogICAgICAgICAgaWYgKCFuMi5leHByZXNzaW9uIHx8ICFIRShuMi5leHByZXNzaW9uKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgY29uc3QgcjIgPSB0Mi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICByZXR1cm4gcjIudHlwZSA9PT0gIlByb2dyYW0iICYmIHIyLmJvZHkubGVuZ3RoID09PSAxOwogICAgICAgIH0sIGlzVFNYRmlsZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5maWxlcGF0aCAmJiAvXC50c3gkL2kudGVzdChlMi5maWxlcGF0aCk7CiAgICAgICAgfSwgaXNUeXBlQW5ub3RhdGlvbkFGdW5jdGlvbjogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiAhKGUyLnR5cGUgIT09ICJUeXBlQW5ub3RhdGlvbiIgJiYgZTIudHlwZSAhPT0gIlRTVHlwZUFubm90YXRpb24iIHx8IGUyLnR5cGVBbm5vdGF0aW9uLnR5cGUgIT09ICJGdW5jdGlvblR5cGVBbm5vdGF0aW9uIiB8fCBlMi5zdGF0aWMgfHwgTEUoZTIsIGUyLnR5cGVBbm5vdGF0aW9uKSk7CiAgICAgICAgfSwgaXNOZXh0TGluZUVtcHR5OiAoZTIsIHQyKSA9PiB7CiAgICAgICAgICBsZXQgeyBvcmlnaW5hbFRleHQ6IG4yIH0gPSB0MjsKICAgICAgICAgIHJldHVybiBrRShuMiwgSUUoZTIpKTsKICAgICAgICB9LCBuZWVkc0hhcmRsaW5lQWZ0ZXJEYW5nbGluZ0NvbW1lbnQ6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBpZiAoIXlDKGUyKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgY29uc3QgdDIgPSB3RShEQyhlMiwgZ0MuRGFuZ2xpbmcpKTsKICAgICAgICAgIHJldHVybiB0MiAmJiAhUkUodDIpOwogICAgICAgIH0sIHJhd1RleHQ6IHJDLCBzaG91bGRQcmludENvbW1hOiBmdW5jdGlvbihlMikgewogICAgICAgICAgbGV0IHQyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMV0gOiAiZXM1IjsKICAgICAgICAgIHJldHVybiBlMi50cmFpbGluZ0NvbW1hID09PSAiZXM1IiAmJiB0MiA9PT0gImVzNSIgfHwgZTIudHJhaWxpbmdDb21tYSA9PT0gImFsbCIgJiYgKHQyID09PSAiYWxsIiB8fCB0MiA9PT0gImVzNSIpOwogICAgICAgIH0sIGlzQml0d2lzZU9wZXJhdG9yOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIEJvb2xlYW4odUNbZTJdKSB8fCBlMiA9PT0gInwiIHx8IGUyID09PSAiXiIgfHwgZTIgPT09ICImIjsKICAgICAgICB9LCBzaG91bGRGbGF0dGVuOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBhQyh0MikgPT09IGFDKGUyKSAmJiAoZTIgIT09ICIqKiIgJiYgKCghb0NbZTJdIHx8ICFvQ1t0Ml0pICYmICghKHQyID09PSAiJSIgJiYgaUNbZTJdIHx8IGUyID09PSAiJSIgJiYgaUNbdDJdKSAmJiAoKHQyID09PSBlMiB8fCAhaUNbdDJdIHx8ICFpQ1tlMl0pICYmICghdUNbZTJdIHx8ICF1Q1t0Ml0pKSkpKTsKICAgICAgICB9LCBzdGFydHNXaXRoTm9Mb29rYWhlYWRUb2tlbjogZnVuY3Rpb24gZTIodDIsIG4yKSB7CiAgICAgICAgICBzd2l0Y2ggKCh0MiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGZvciAoOyBlMy5sZWZ0OyApCiAgICAgICAgICAgICAgZTMgPSBlMy5sZWZ0OwogICAgICAgICAgICByZXR1cm4gZTM7CiAgICAgICAgICB9KHQyKSkudHlwZSkgewogICAgICAgICAgICBjYXNlICJGdW5jdGlvbkV4cHJlc3Npb24iOgogICAgICAgICAgICBjYXNlICJDbGFzc0V4cHJlc3Npb24iOgogICAgICAgICAgICBjYXNlICJEb0V4cHJlc3Npb24iOgogICAgICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICAgICAgY2FzZSAiT2JqZWN0RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGNhc2UgIk1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICBjYXNlICJPcHRpb25hbE1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICAgIHJldHVybiBlMih0Mi5vYmplY3QsIG4yKTsKICAgICAgICAgICAgY2FzZSAiVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uIjoKICAgICAgICAgICAgICByZXR1cm4gdDIudGFnLnR5cGUgIT09ICJGdW5jdGlvbkV4cHJlc3Npb24iICYmIGUyKHQyLnRhZywgbjIpOwogICAgICAgICAgICBjYXNlICJDYWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgIGNhc2UgIk9wdGlvbmFsQ2FsbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgIHJldHVybiB0Mi5jYWxsZWUudHlwZSAhPT0gIkZ1bmN0aW9uRXhwcmVzc2lvbiIgJiYgZTIodDIuY2FsbGVlLCBuMik7CiAgICAgICAgICAgIGNhc2UgIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIGUyKHQyLnRlc3QsIG4yKTsKICAgICAgICAgICAgY2FzZSAiVXBkYXRlRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuICF0Mi5wcmVmaXggJiYgZTIodDIuYXJndW1lbnQsIG4yKTsKICAgICAgICAgICAgY2FzZSAiQmluZEV4cHJlc3Npb24iOgogICAgICAgICAgICAgIHJldHVybiB0Mi5vYmplY3QgJiYgZTIodDIub2JqZWN0LCBuMik7CiAgICAgICAgICAgIGNhc2UgIlNlcXVlbmNlRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIGUyKHQyLmV4cHJlc3Npb25zWzBdLCBuMik7CiAgICAgICAgICAgIGNhc2UgIlRTQXNFeHByZXNzaW9uIjoKICAgICAgICAgICAgY2FzZSAiVFNOb25OdWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIGUyKHQyLmV4cHJlc3Npb24sIG4yKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSwgZ2V0UHJlY2VkZW5jZTogYUMsIGhhc0NvbW1lbnQ6IHlDLCBnZXRDb21tZW50czogREMsIENvbW1lbnRDaGVja0ZsYWdzOiBnQyB9OwogICAgICAgIGNvbnN0IGJDID0gYXUsIHsgZ2V0U3RyaW5nV2lkdGg6IHZDLCBnZXRJbmRlbnRTaXplOiBBQyB9ID0gZGMsIHsgYnVpbGRlcnM6IHsgam9pbjogRkMsIGhhcmRsaW5lOiB4Qywgc29mdGxpbmU6IFNDLCBncm91cDogd0MsIGluZGVudDogVEMsIGFsaWduOiBCQywgbGluZVN1ZmZpeEJvdW5kYXJ5OiBOQywgYWRkQWxpZ25tZW50VG9Eb2M6IGtDIH0sIHByaW50ZXI6IHsgcHJpbnREb2NUb1N0cmluZzogUEMgfSwgdXRpbHM6IHsgbWFwRG9jOiBPQyB9IH0gPSBaYywgeyBpc0JpbmFyeWlzaDogSUMsIGlzSmVzdEVhY2hUZW1wbGF0ZUxpdGVyYWw6IExDLCBpc1NpbXBsZVRlbXBsYXRlTGl0ZXJhbDogakMsIGhhc0NvbW1lbnQ6IF9DLCBpc01lbWJlckV4cHJlc3Npb246IE1DIH0gPSBDQzsKICAgICAgICBmdW5jdGlvbiBSQyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLnJlcGxhY2UoLyhbXFxgXXxcJHspL2csICJcXCQxIik7CiAgICAgICAgfQogICAgICAgIHZhciBWQyA9IHsgcHJpbnRUZW1wbGF0ZUxpdGVyYWw6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIGlmIChyMi50eXBlID09PSAiVGVtcGxhdGVMaXRlcmFsIiAmJiBMQyhyMiwgZTIuZ2V0UGFyZW50Tm9kZSgpKSkgewogICAgICAgICAgICBjb25zdCByMyA9IGZ1bmN0aW9uKGUzLCB0MywgbjMpIHsKICAgICAgICAgICAgICBjb25zdCByNCA9IGUzLmdldE5vZGUoKSwgbzMgPSByNC5xdWFzaXNbMF0udmFsdWUucmF3LnRyaW0oKS5zcGxpdCgvXHMqXHxccyovKTsKICAgICAgICAgICAgICBpZiAobzMubGVuZ3RoID4gMSB8fCBvMy5zb21lKChlNCkgPT4gZTQubGVuZ3RoID4gMCkpIHsKICAgICAgICAgICAgICAgIHQzLl9faW5KZXN0RWFjaCA9IHRydWU7CiAgICAgICAgICAgICAgICBjb25zdCBpMyA9IGUzLm1hcChuMywgImV4cHJlc3Npb25zIik7CiAgICAgICAgICAgICAgICB0My5fX2luSmVzdEVhY2ggPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnN0IHUzID0gW10sIHMzID0gaTMubWFwKChlNCkgPT4gIiR7IiArIFBDKGU0LCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHQzKSwge30sIHsgcHJpbnRXaWR0aDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBlbmRPZkxpbmU6ICJsZiIgfSkpLmZvcm1hdHRlZCArICJ9IiksIGEyID0gW3sgaGFzTGluZUJyZWFrOiBmYWxzZSwgY2VsbHM6IFtdIH1dOwogICAgICAgICAgICAgICAgZm9yIChsZXQgZTQgPSAxOyBlNCA8IHI0LnF1YXNpcy5sZW5ndGg7IGU0KyspIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdDQgPSBiQyhhMiksIG40ID0gczNbZTQgLSAxXTsKICAgICAgICAgICAgICAgICAgdDQuY2VsbHMucHVzaChuNCksIG40LmluY2x1ZGVzKCJcbiIpICYmICh0NC5oYXNMaW5lQnJlYWsgPSB0cnVlKSwgcjQucXVhc2lzW2U0XS52YWx1ZS5yYXcuaW5jbHVkZXMoIlxuIikgJiYgYTIucHVzaCh7IGhhc0xpbmVCcmVhazogZmFsc2UsIGNlbGxzOiBbXSB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGMyID0gTWF0aC5tYXgobzMubGVuZ3RoLCAuLi5hMi5tYXAoKGU0KSA9PiBlNC5jZWxscy5sZW5ndGgpKSwgbDIgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiBjMiB9KS5maWxsKDApLCBwMiA9IFt7IGNlbGxzOiBvMyB9LCAuLi5hMi5maWx0ZXIoKGU0KSA9PiBlNC5jZWxscy5sZW5ndGggPiAwKV07CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHsgY2VsbHM6IGU0IH0gb2YgcDIuZmlsdGVyKChlNSkgPT4gIWU1Lmhhc0xpbmVCcmVhaykpCiAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW3Q0LCBuNF0gb2YgZTQuZW50cmllcygpKQogICAgICAgICAgICAgICAgICAgIGwyW3Q0XSA9IE1hdGgubWF4KGwyW3Q0XSwgdkMobjQpKTsKICAgICAgICAgICAgICAgIHJldHVybiB1My5wdXNoKE5DLCAiYCIsIFRDKFt4QywgRkMoeEMsIHAyLm1hcCgoZTQpID0+IEZDKCIgfCAiLCBlNC5jZWxscy5tYXAoKHQ0LCBuNCkgPT4gZTQuaGFzTGluZUJyZWFrID8gdDQgOiB0NCArICIgIi5yZXBlYXQobDJbbjRdIC0gdkModDQpKSkpKSldKSwgeEMsICJgIiksIHUzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfShlMiwgbjIsIHQyKTsKICAgICAgICAgICAgaWYgKHIzKQogICAgICAgICAgICAgIHJldHVybiByMzsKICAgICAgICAgIH0KICAgICAgICAgIGxldCBvMiA9ICJleHByZXNzaW9ucyI7CiAgICAgICAgICByMi50eXBlID09PSAiVFNUZW1wbGF0ZUxpdGVyYWxUeXBlIiAmJiAobzIgPSAidHlwZXMiKTsKICAgICAgICAgIGNvbnN0IGkyID0gW107CiAgICAgICAgICBsZXQgdTIgPSBlMi5tYXAodDIsIG8yKTsKICAgICAgICAgIGNvbnN0IHMyID0gakMocjIpOwogICAgICAgICAgcmV0dXJuIHMyICYmICh1MiA9IHUyLm1hcCgoZTMpID0+IFBDKGUzLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG4yKSwge30sIHsgcHJpbnRXaWR0aDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIH0pKS5mb3JtYXR0ZWQpKSwgaTIucHVzaChOQywgImAiKSwgZTIuZWFjaCgoZTMpID0+IHsKICAgICAgICAgICAgY29uc3QgYTIgPSBlMy5nZXROYW1lKCk7CiAgICAgICAgICAgIGlmIChpMi5wdXNoKHQyKCkpLCBhMiA8IHUyLmxlbmd0aCkgewogICAgICAgICAgICAgIGNvbnN0IHsgdGFiV2lkdGg6IHQzIH0gPSBuMiwgYzIgPSBlMy5nZXRWYWx1ZSgpLCBsMiA9IEFDKGMyLnZhbHVlLnJhdywgdDMpOwogICAgICAgICAgICAgIGxldCBwMiA9IHUyW2EyXTsKICAgICAgICAgICAgICBpZiAoIXMyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlNCA9IHIyW28yXVthMl07CiAgICAgICAgICAgICAgICAoX0MoZTQpIHx8IE1DKGU0KSB8fCBlNC50eXBlID09PSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIiB8fCBlNC50eXBlID09PSAiU2VxdWVuY2VFeHByZXNzaW9uIiB8fCBlNC50eXBlID09PSAiVFNBc0V4cHJlc3Npb24iIHx8IElDKGU0KSkgJiYgKHAyID0gW1RDKFtTQywgcDJdKSwgU0NdKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZjIgPSBsMiA9PT0gMCAmJiBjMi52YWx1ZS5yYXcuZW5kc1dpdGgoIlxuIikgPyBCQyhOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksIHAyKSA6IGtDKHAyLCBsMiwgdDMpOwogICAgICAgICAgICAgIGkyLnB1c2god0MoWyIkeyIsIGYyLCBOQywgIn0iXSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCAicXVhc2lzIiksIGkyLnB1c2goImAiKSwgaTI7CiAgICAgICAgfSwgcHJpbnRUZW1wbGF0ZUV4cHJlc3Npb25zOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBlMi5tYXAoKGUzKSA9PiBmdW5jdGlvbihlNCwgdDMpIHsKICAgICAgICAgICAgY29uc3QgbjIgPSBlNC5nZXRWYWx1ZSgpOwogICAgICAgICAgICBsZXQgcjIgPSB0MygpOwogICAgICAgICAgICByZXR1cm4gX0MobjIpICYmIChyMiA9IHdDKFtUQyhbU0MsIHIyXSksIFNDXSkpLCBbIiR7IiwgcjIsIE5DLCAifSJdOwogICAgICAgICAgfShlMywgdDIpLCAiZXhwcmVzc2lvbnMiKTsKICAgICAgICB9LCBlc2NhcGVUZW1wbGF0ZUNoYXJhY3RlcnM6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIE9DKGUyLCAoZTMpID0+IHR5cGVvZiBlMyA9PSAic3RyaW5nIiA/IHQyID8gZTMucmVwbGFjZSgvKFxcKilgL2csICIkMSQxXFxgIikgOiBSQyhlMykgOiBlMyk7CiAgICAgICAgfSwgdW5jb29rVGVtcGxhdGVFbGVtZW50VmFsdWU6IFJDIH07CiAgICAgICAgY29uc3QgeyBidWlsZGVyczogeyBpbmRlbnQ6ICRDLCBzb2Z0bGluZTogV0MsIGxpdGVyYWxsaW5lOiBxQywgZGVkZW50VG9Sb290OiBVQyB9IH0gPSBaYywgeyBlc2NhcGVUZW1wbGF0ZUNoYXJhY3RlcnM6IHpDIH0gPSBWQzsKICAgICAgICB2YXIgR0MgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBsZXQgcjIgPSBlMi5nZXRWYWx1ZSgpLnF1YXNpc1swXS52YWx1ZS5yYXcucmVwbGFjZSgvKCg/OlxcXFwpKilcXGAvZywgKGUzLCB0MykgPT4gIlxcIi5yZXBlYXQodDMubGVuZ3RoIC8gMikgKyAiYCIpOwogICAgICAgICAgY29uc3QgbzIgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICBjb25zdCB0MyA9IGUzLm1hdGNoKC9eKFteXFNcbl0qKVxTL20pOwogICAgICAgICAgICByZXR1cm4gdDMgPT09IG51bGwgPyAiIiA6IHQzWzFdOwogICAgICAgICAgfShyMiksIGkyID0gbzIgIT09ICIiOwogICAgICAgICAgaTIgJiYgKHIyID0gcjIucmVwbGFjZShuZXcgUmVnRXhwKCJeIi5jb25jYXQobzIpLCAiZ20iKSwgIiIpKTsKICAgICAgICAgIGNvbnN0IHUyID0gekMobjIocjIsIHsgcGFyc2VyOiAibWFya2Rvd24iLCBfX2luSnNUZW1wbGF0ZTogdHJ1ZSB9LCB7IHN0cmlwVHJhaWxpbmdIYXJkbGluZTogdHJ1ZSB9KSwgdHJ1ZSk7CiAgICAgICAgICByZXR1cm4gWyJgIiwgaTIgPyAkQyhbV0MsIHUyXSkgOiBbcUMsIFVDKHUyKV0sIFdDLCAiYCJdOwogICAgICAgIH07CiAgICAgICAgY29uc3QgeyBpc05vbkVtcHR5QXJyYXk6IEhDIH0gPSBkYywgeyBidWlsZGVyczogeyBpbmRlbnQ6IEpDLCBoYXJkbGluZTogWEMsIHNvZnRsaW5lOiBZQyB9LCB1dGlsczogeyBtYXBEb2M6IEtDLCByZXBsYWNlRW5kT2ZMaW5lOiBRQywgY2xlYW5Eb2M6IFpDIH0gfSA9IFpjLCB7IHByaW50VGVtcGxhdGVFeHByZXNzaW9uczogZWIgfSA9IFZDOwogICAgICAgIHZhciB0YiA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKSwgbzIgPSByMi5xdWFzaXMubWFwKChlMykgPT4gZTMudmFsdWUucmF3KTsKICAgICAgICAgIGxldCBpMiA9IDA7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTMsIHQzLCBuMykgewogICAgICAgICAgICBpZiAodDMucXVhc2lzLmxlbmd0aCA9PT0gMSAmJiAhdDMucXVhc2lzWzBdLnZhbHVlLnJhdy50cmltKCkpCiAgICAgICAgICAgICAgcmV0dXJuICJgYCI7CiAgICAgICAgICAgIGNvbnN0IHIzID0gZnVuY3Rpb24oZTQsIHQ0KSB7CiAgICAgICAgICAgICAgaWYgKCFIQyh0NCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZTQ7CiAgICAgICAgICAgICAgbGV0IG40ID0gMDsKICAgICAgICAgICAgICBjb25zdCByNCA9IEtDKFpDKGU0KSwgKGU1KSA9PiB0eXBlb2YgZTUgPT0gInN0cmluZyIgJiYgZTUuaW5jbHVkZXMoIkBwcmV0dGllci1wbGFjZWhvbGRlciIpID8gZTUuc3BsaXQoL0BwcmV0dGllci1wbGFjZWhvbGRlci0oXGQrKS1pZC8pLm1hcCgoZTYsIHI1KSA9PiByNSAlIDIgPT0gMCA/IFFDKGU2KSA6IChuNCsrLCB0NFtlNl0pKSA6IGU1KTsKICAgICAgICAgICAgICByZXR1cm4gdDQubGVuZ3RoID09PSBuNCA/IHI0IDogbnVsbDsKICAgICAgICAgICAgfShlMywgbjMpOwogICAgICAgICAgICBpZiAoIXIzKQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ291bGRuJ3QgaW5zZXJ0IGFsbCB0aGUgZXhwcmVzc2lvbnMiKTsKICAgICAgICAgICAgcmV0dXJuIFsiYCIsIEpDKFtYQywgcjNdKSwgWUMsICJgIl07CiAgICAgICAgICB9KG4yKG8yLnJlZHVjZSgoZTMsIHQzLCBuMykgPT4gbjMgPT09IDAgPyB0MyA6IGUzICsgIkBwcmV0dGllci1wbGFjZWhvbGRlci0iICsgaTIrKyArICItaWQiICsgdDMsICIiKSwgeyBwYXJzZXI6ICJzY3NzIiB9LCB7IHN0cmlwVHJhaWxpbmdIYXJkbGluZTogdHJ1ZSB9KSwgcjIsIGViKGUyLCB0MikpOwogICAgICAgIH07CiAgICAgICAgY29uc3QgeyBidWlsZGVyczogeyBpbmRlbnQ6IG5iLCBqb2luOiByYiwgaGFyZGxpbmU6IG9iIH0gfSA9IFpjLCB7IGVzY2FwZVRlbXBsYXRlQ2hhcmFjdGVyczogaWIsIHByaW50VGVtcGxhdGVFeHByZXNzaW9uczogdWIgfSA9IFZDOwogICAgICAgIGZ1bmN0aW9uIHNiKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IFtdOwogICAgICAgICAgbGV0IG4yID0gZmFsc2U7CiAgICAgICAgICBjb25zdCByMiA9IGUyLm1hcCgoZTMpID0+IGUzLnRyaW0oKSk7CiAgICAgICAgICBmb3IgKGNvbnN0IFtlMywgbzJdIG9mIHIyLmVudHJpZXMoKSkKICAgICAgICAgICAgbzIgIT09ICIiICYmIChyMltlMyAtIDFdID09PSAiIiAmJiBuMiA/IHQyLnB1c2goW29iLCBvMl0pIDogdDIucHVzaChvMiksIG4yID0gdHJ1ZSk7CiAgICAgICAgICByZXR1cm4gdDIubGVuZ3RoID09PSAwID8gbnVsbCA6IHJiKG9iLCB0Mik7CiAgICAgICAgfQogICAgICAgIHZhciBhYiA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKSwgbzIgPSByMi5xdWFzaXMubGVuZ3RoOwogICAgICAgICAgaWYgKG8yID09PSAxICYmIHIyLnF1YXNpc1swXS52YWx1ZS5yYXcudHJpbSgpID09PSAiIikKICAgICAgICAgICAgcmV0dXJuICJgYCI7CiAgICAgICAgICBjb25zdCBpMiA9IHViKGUyLCB0MiksIHUyID0gW107CiAgICAgICAgICBmb3IgKGxldCBlMyA9IDA7IGUzIDwgbzI7IGUzKyspIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBlMyA9PT0gMCwgczIgPSBlMyA9PT0gbzIgLSAxLCBhMiA9IHIyLnF1YXNpc1tlM10udmFsdWUuY29va2VkLCBjMiA9IGEyLnNwbGl0KCJcbiIpLCBsMiA9IGMyLmxlbmd0aCwgcDIgPSBpMltlM10sIGYyID0gbDIgPiAyICYmIGMyWzBdLnRyaW0oKSA9PT0gIiIgJiYgYzJbMV0udHJpbSgpID09PSAiIiwgZDIgPSBsMiA+IDIgJiYgYzJbbDIgLSAxXS50cmltKCkgPT09ICIiICYmIGMyW2wyIC0gMl0udHJpbSgpID09PSAiIiwgaDIgPSBjMi5ldmVyeSgoZTQpID0+IC9eXHMqKD86I1teXG5ccl0qKT8kLy50ZXN0KGU0KSk7CiAgICAgICAgICAgIGlmICghczIgJiYgLyNbXlxuXHJdKiQvLnRlc3QoYzJbbDIgLSAxXSkpCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGxldCBnMiA9IG51bGw7CiAgICAgICAgICAgIGcyID0gaDIgPyBzYihjMikgOiBuMihhMiwgeyBwYXJzZXI6ICJncmFwaHFsIiB9LCB7IHN0cmlwVHJhaWxpbmdIYXJkbGluZTogdHJ1ZSB9KSwgZzIgPyAoZzIgPSBpYihnMiwgZmFsc2UpLCAhdDMgJiYgZjIgJiYgdTIucHVzaCgiIiksIHUyLnB1c2goZzIpLCAhczIgJiYgZDIgJiYgdTIucHVzaCgiIikpIDogdDMgfHwgczIgfHwgIWYyIHx8IHUyLnB1c2goIiIpLCBwMiAmJiB1Mi5wdXNoKHAyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbImAiLCBuYihbb2IsIHJiKG9iLCB1MildKSwgb2IsICJgIl07CiAgICAgICAgfTsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IGluZGVudDogY2IsIGxpbmU6IGxiLCBoYXJkbGluZTogcGIsIGdyb3VwOiBmYiB9LCB1dGlsczogeyBtYXBEb2M6IGRiIH0gfSA9IFpjLCB7IHByaW50VGVtcGxhdGVFeHByZXNzaW9uczogaGIsIHVuY29va1RlbXBsYXRlRWxlbWVudFZhbHVlOiBnYiB9ID0gVkM7CiAgICAgICAgbGV0IG1iID0gMDsKICAgICAgICB2YXIgeWIgPSBmdW5jdGlvbihlMiwgdDIsIG4yLCByMiwgbzIpIHsKICAgICAgICAgIGxldCB7IHBhcnNlcjogaTIgfSA9IG8yOwogICAgICAgICAgY29uc3QgdTIgPSBlMi5nZXRWYWx1ZSgpLCBzMiA9IG1iOwogICAgICAgICAgbWIgPSBtYiArIDEgPj4+IDA7CiAgICAgICAgICBjb25zdCBhMiA9IChlMykgPT4gIlBSRVRUSUVSX0hUTUxfUExBQ0VIT0xERVJfIi5jb25jYXQoZTMsICJfIikuY29uY2F0KHMyLCAiX0lOX0pTIiksIGMyID0gdTIucXVhc2lzLm1hcCgoZTMsIHQzLCBuMykgPT4gdDMgPT09IG4zLmxlbmd0aCAtIDEgPyBlMy52YWx1ZS5jb29rZWQgOiBlMy52YWx1ZS5jb29rZWQgKyBhMih0MykpLmpvaW4oIiIpLCBsMiA9IGhiKGUyLCB0Mik7CiAgICAgICAgICBpZiAobDIubGVuZ3RoID09PSAwICYmIGMyLnRyaW0oKS5sZW5ndGggPT09IDApCiAgICAgICAgICAgIHJldHVybiAiYGAiOwogICAgICAgICAgY29uc3QgcDIgPSBuZXcgUmVnRXhwKGEyKCIoXFxkKykiKSwgImciKTsKICAgICAgICAgIGxldCBmMiA9IDA7CiAgICAgICAgICBjb25zdCBkMiA9IG4yKGMyLCB7IHBhcnNlcjogaTIsIF9fb25IdG1sUm9vdChlMykgewogICAgICAgICAgICBmMiA9IGUzLmNoaWxkcmVuLmxlbmd0aDsKICAgICAgICAgIH0gfSwgeyBzdHJpcFRyYWlsaW5nSGFyZGxpbmU6IHRydWUgfSksIGgyID0gZGIoZDIsIChlMykgPT4gewogICAgICAgICAgICBpZiAodHlwZW9mIGUzICE9ICJzdHJpbmciKQogICAgICAgICAgICAgIHJldHVybiBlMzsKICAgICAgICAgICAgY29uc3QgdDMgPSBbXSwgbjMgPSBlMy5zcGxpdChwMik7CiAgICAgICAgICAgIGZvciAobGV0IGU0ID0gMDsgZTQgPCBuMy5sZW5ndGg7IGU0KyspIHsKICAgICAgICAgICAgICBsZXQgbzMgPSBuM1tlNF07CiAgICAgICAgICAgICAgaWYgKGU0ICUgMiA9PSAwKSB7CiAgICAgICAgICAgICAgICBvMyAmJiAobzMgPSBnYihvMyksIHIyLl9fZW1iZWRkZWRJbkh0bWwgJiYgKG8zID0gbzMucmVwbGFjZSgvPFwvKHNjcmlwdClcYi9naSwgIjxcXC8kMSIpKSwgdDMucHVzaChvMykpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGkzID0gTnVtYmVyKG8zKTsKICAgICAgICAgICAgICB0My5wdXNoKGwyW2kzXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfSksIGcyID0gL15ccy8udGVzdChjMikgPyAiICIgOiAiIiwgbTIgPSAvXHMkLy50ZXN0KGMyKSA/ICIgIiA6ICIiLCB5MiA9IHIyLmh0bWxXaGl0ZXNwYWNlU2Vuc2l0aXZpdHkgPT09ICJpZ25vcmUiID8gcGIgOiBnMiAmJiBtMiA/IGxiIDogbnVsbDsKICAgICAgICAgIHJldHVybiBmYih5MiA/IFsiYCIsIGNiKFt5MiwgZmIoaDIpXSksIHkyLCAiYCJdIDogWyJgIiwgZzIsIGYyID4gMSA/IGNiKGZiKGgyKSkgOiBmYihoMiksIG0yLCAiYCJdKTsKICAgICAgICB9OwogICAgICAgIGNvbnN0IHsgaGFzQ29tbWVudDogRGIsIENvbW1lbnRDaGVja0ZsYWdzOiBFYiwgaXNPYmplY3RQcm9wZXJ0eTogQ2IgfSA9IENDLCBiYiA9IEdDLCB2YiA9IHRiLCBBYiA9IGFiLCBGYiA9IHliOwogICAgICAgIGZ1bmN0aW9uIHhiKGUyKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSBlMy5nZXRWYWx1ZSgpLCBuMiA9IGUzLmdldFBhcmVudE5vZGUoKSwgcjIgPSBlMy5nZXRQYXJlbnROb2RlKDEpOwogICAgICAgICAgICByZXR1cm4gcjIgJiYgdDIucXVhc2lzICYmIG4yLnR5cGUgPT09ICJKU1hFeHByZXNzaW9uQ29udGFpbmVyIiAmJiByMi50eXBlID09PSAiSlNYRWxlbWVudCIgJiYgcjIub3BlbmluZ0VsZW1lbnQubmFtZS5uYW1lID09PSAic3R5bGUiICYmIHIyLm9wZW5pbmdFbGVtZW50LmF0dHJpYnV0ZXMuc29tZSgoZTQpID0+IGU0Lm5hbWUubmFtZSA9PT0gImpzeCIpIHx8IG4yICYmIG4yLnR5cGUgPT09ICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iICYmIG4yLnRhZy50eXBlID09PSAiSWRlbnRpZmllciIgJiYgbjIudGFnLm5hbWUgPT09ICJjc3MiIHx8IG4yICYmIG4yLnR5cGUgPT09ICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iICYmIG4yLnRhZy50eXBlID09PSAiTWVtYmVyRXhwcmVzc2lvbiIgJiYgbjIudGFnLm9iamVjdC5uYW1lID09PSAiY3NzIiAmJiAobjIudGFnLnByb3BlcnR5Lm5hbWUgPT09ICJnbG9iYWwiIHx8IG4yLnRhZy5wcm9wZXJ0eS5uYW1lID09PSAicmVzb2x2ZSIpOwogICAgICAgICAgfShlMikgfHwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSBlMy5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICAgIGlmICghdDIgfHwgdDIudHlwZSAhPT0gIlRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbiIpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjb25zdCBuMiA9IHQyLnRhZy50eXBlID09PSAiUGFyZW50aGVzaXplZEV4cHJlc3Npb24iID8gdDIudGFnLmV4cHJlc3Npb24gOiB0Mi50YWc7CiAgICAgICAgICAgIHN3aXRjaCAobjIudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgIk1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIHdiKG4yLm9iamVjdCkgfHwgVGIobjIpOwogICAgICAgICAgICAgIGNhc2UgIkNhbGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiB3YihuMi5jYWxsZWUpIHx8IG4yLmNhbGxlZS50eXBlID09PSAiTWVtYmVyRXhwcmVzc2lvbiIgJiYgKG4yLmNhbGxlZS5vYmplY3QudHlwZSA9PT0gIk1lbWJlckV4cHJlc3Npb24iICYmICh3YihuMi5jYWxsZWUub2JqZWN0Lm9iamVjdCkgfHwgVGIobjIuY2FsbGVlLm9iamVjdCkpIHx8IG4yLmNhbGxlZS5vYmplY3QudHlwZSA9PT0gIkNhbGxFeHByZXNzaW9uIiAmJiB3YihuMi5jYWxsZWUub2JqZWN0LmNhbGxlZSkpOwogICAgICAgICAgICAgIGNhc2UgIklkZW50aWZpZXIiOgogICAgICAgICAgICAgICAgcmV0dXJuIG4yLm5hbWUgPT09ICJjc3MiOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0oZTIpIHx8IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gZTMuZ2V0UGFyZW50Tm9kZSgpLCBuMiA9IGUzLmdldFBhcmVudE5vZGUoMSk7CiAgICAgICAgICAgIHJldHVybiBuMiAmJiB0Mi50eXBlID09PSAiSlNYRXhwcmVzc2lvbkNvbnRhaW5lciIgJiYgbjIudHlwZSA9PT0gIkpTWEF0dHJpYnV0ZSIgJiYgbjIubmFtZS50eXBlID09PSAiSlNYSWRlbnRpZmllciIgJiYgbjIubmFtZS5uYW1lID09PSAiY3NzIjsKICAgICAgICAgIH0oZTIpIHx8IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMy5tYXRjaCgoZTQpID0+IGU0LnR5cGUgPT09ICJUZW1wbGF0ZUxpdGVyYWwiLCAoZTQsIHQyKSA9PiBlNC50eXBlID09PSAiQXJyYXlFeHByZXNzaW9uIiAmJiB0MiA9PT0gImVsZW1lbnRzIiwgKGU0LCB0MikgPT4gQ2IoZTQpICYmIGU0LmtleS50eXBlID09PSAiSWRlbnRpZmllciIgJiYgZTQua2V5Lm5hbWUgPT09ICJzdHlsZXMiICYmIHQyID09PSAidmFsdWUiLCAuLi5TYik7CiAgICAgICAgICB9KGUyKSA/ICJjc3MiIDogZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSBlMy5nZXRWYWx1ZSgpLCBuMiA9IGUzLmdldFBhcmVudE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIEJiKHQyLCAiR3JhcGhRTCIpIHx8IG4yICYmIChuMi50eXBlID09PSAiVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uIiAmJiAobjIudGFnLnR5cGUgPT09ICJNZW1iZXJFeHByZXNzaW9uIiAmJiBuMi50YWcub2JqZWN0Lm5hbWUgPT09ICJncmFwaHFsIiAmJiBuMi50YWcucHJvcGVydHkubmFtZSA9PT0gImV4cGVyaW1lbnRhbCIgfHwgbjIudGFnLnR5cGUgPT09ICJJZGVudGlmaWVyIiAmJiAobjIudGFnLm5hbWUgPT09ICJncWwiIHx8IG4yLnRhZy5uYW1lID09PSAiZ3JhcGhxbCIpKSB8fCBuMi50eXBlID09PSAiQ2FsbEV4cHJlc3Npb24iICYmIG4yLmNhbGxlZS50eXBlID09PSAiSWRlbnRpZmllciIgJiYgbjIuY2FsbGVlLm5hbWUgPT09ICJncmFwaHFsIik7CiAgICAgICAgICB9KGUyKSA/ICJncmFwaHFsIiA6IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBCYihlMy5nZXRWYWx1ZSgpLCAiSFRNTCIpIHx8IGUzLm1hdGNoKChlNCkgPT4gZTQudHlwZSA9PT0gIlRlbXBsYXRlTGl0ZXJhbCIsIChlNCwgdDIpID0+IGU0LnR5cGUgPT09ICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iICYmIGU0LnRhZy50eXBlID09PSAiSWRlbnRpZmllciIgJiYgZTQudGFnLm5hbWUgPT09ICJodG1sIiAmJiB0MiA9PT0gInF1YXNpIik7CiAgICAgICAgICB9KGUyKSA/ICJodG1sIiA6IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMy5tYXRjaCgoZTQpID0+IGU0LnR5cGUgPT09ICJUZW1wbGF0ZUxpdGVyYWwiLCAoZTQsIHQyKSA9PiBDYihlNCkgJiYgZTQua2V5LnR5cGUgPT09ICJJZGVudGlmaWVyIiAmJiBlNC5rZXkubmFtZSA9PT0gInRlbXBsYXRlIiAmJiB0MiA9PT0gInZhbHVlIiwgLi4uU2IpOwogICAgICAgICAgfShlMikgPyAiYW5ndWxhciIgOiBmdW5jdGlvbihlMykgewogICAgICAgICAgICBjb25zdCB0MiA9IGUzLmdldFZhbHVlKCksIG4yID0gZTMuZ2V0UGFyZW50Tm9kZSgpOwogICAgICAgICAgICByZXR1cm4gbjIgJiYgbjIudHlwZSA9PT0gIlRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbiIgJiYgdDIucXVhc2lzLmxlbmd0aCA9PT0gMSAmJiBuMi50YWcudHlwZSA9PT0gIklkZW50aWZpZXIiICYmIChuMi50YWcubmFtZSA9PT0gIm1kIiB8fCBuMi50YWcubmFtZSA9PT0gIm1hcmtkb3duIik7CiAgICAgICAgICB9KGUyKSA/ICJtYXJrZG93biIgOiB2b2lkIDA7CiAgICAgICAgfQogICAgICAgIGNvbnN0IFNiID0gWyhlMiwgdDIpID0+IGUyLnR5cGUgPT09ICJPYmplY3RFeHByZXNzaW9uIiAmJiB0MiA9PT0gInByb3BlcnRpZXMiLCAoZTIsIHQyKSA9PiBlMi50eXBlID09PSAiQ2FsbEV4cHJlc3Npb24iICYmIGUyLmNhbGxlZS50eXBlID09PSAiSWRlbnRpZmllciIgJiYgZTIuY2FsbGVlLm5hbWUgPT09ICJDb21wb25lbnQiICYmIHQyID09PSAiYXJndW1lbnRzIiwgKGUyLCB0MikgPT4gZTIudHlwZSA9PT0gIkRlY29yYXRvciIgJiYgdDIgPT09ICJleHByZXNzaW9uIl07CiAgICAgICAgZnVuY3Rpb24gd2IoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAiSWRlbnRpZmllciIgJiYgZTIubmFtZSA9PT0gInN0eWxlZCI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFRiKGUyKSB7CiAgICAgICAgICByZXR1cm4gL15bQS1aXS8udGVzdChlMi5vYmplY3QubmFtZSkgJiYgZTIucHJvcGVydHkubmFtZSA9PT0gImV4dGVuZCI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEJiKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIERiKGUyLCBFYi5CbG9jayB8IEViLkxlYWRpbmcsIChlMykgPT4gewogICAgICAgICAgICBsZXQgeyB2YWx1ZTogbjIgfSA9IGUzOwogICAgICAgICAgICByZXR1cm4gbjIgPT09ICIgIi5jb25jYXQodDIsICIgIik7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgdmFyIE5iID0gZnVuY3Rpb24oZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIGNvbnN0IG8yID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIGlmIChvMi50eXBlICE9PSAiVGVtcGxhdGVMaXRlcmFsIiB8fCBmdW5jdGlvbihlMykgewogICAgICAgICAgICBsZXQgeyBxdWFzaXM6IHQzIH0gPSBlMzsKICAgICAgICAgICAgcmV0dXJuIHQzLnNvbWUoKGU0KSA9PiB7CiAgICAgICAgICAgICAgbGV0IHsgdmFsdWU6IHsgY29va2VkOiB0NCB9IH0gPSBlNDsKICAgICAgICAgICAgICByZXR1cm4gdDQgPT09IG51bGw7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfShvMikpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIGNvbnN0IGkyID0geGIoZTIpOwogICAgICAgICAgcmV0dXJuIGkyID8gaTIgPT09ICJtYXJrZG93biIgPyBiYihlMiwgdDIsIG4yKSA6IGkyID09PSAiY3NzIiA/IHZiKGUyLCB0MiwgbjIpIDogaTIgPT09ICJncmFwaHFsIiA/IEFiKGUyLCB0MiwgbjIpIDogaTIgPT09ICJodG1sIiB8fCBpMiA9PT0gImFuZ3VsYXIiID8gRmIoZTIsIHQyLCBuMiwgcjIsIHsgcGFyc2VyOiBpMiB9KSA6IHZvaWQgMCA6IHZvaWQgMDsKICAgICAgICB9OwogICAgICAgIGNvbnN0IHsgaXNCbG9ja0NvbW1lbnQ6IGtiIH0gPSBDQywgUGIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldChbInJhbmdlIiwgInJhdyIsICJjb21tZW50cyIsICJsZWFkaW5nQ29tbWVudHMiLCAidHJhaWxpbmdDb21tZW50cyIsICJpbm5lckNvbW1lbnRzIiwgImV4dHJhIiwgInN0YXJ0IiwgImVuZCIsICJsb2MiLCAiZmxhZ3MiLCAiZXJyb3JzIiwgInRva2VucyJdKSwgT2IgPSAoZTIpID0+IHsKICAgICAgICAgIGZvciAoY29uc3QgdDIgb2YgZTIucXVhc2lzKQogICAgICAgICAgICBkZWxldGUgdDIudmFsdWU7CiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBJYihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBpZiAoZTIudHlwZSA9PT0gIlByb2dyYW0iICYmIGRlbGV0ZSB0Mi5zb3VyY2VUeXBlLCBlMi50eXBlICE9PSAiQmlnSW50TGl0ZXJhbCIgJiYgZTIudHlwZSAhPT0gIkJpZ0ludExpdGVyYWxUeXBlQW5ub3RhdGlvbiIgfHwgdDIudmFsdWUgJiYgKHQyLnZhbHVlID0gdDIudmFsdWUudG9Mb3dlckNhc2UoKSksIGUyLnR5cGUgIT09ICJCaWdJbnRMaXRlcmFsIiAmJiBlMi50eXBlICE9PSAiTGl0ZXJhbCIgfHwgdDIuYmlnaW50ICYmICh0Mi5iaWdpbnQgPSB0Mi5iaWdpbnQudG9Mb3dlckNhc2UoKSksIGUyLnR5cGUgPT09ICJEZWNpbWFsTGl0ZXJhbCIgJiYgKHQyLnZhbHVlID0gTnVtYmVyKHQyLnZhbHVlKSksIGUyLnR5cGUgPT09ICJMaXRlcmFsIiAmJiB0Mi5kZWNpbWFsICYmICh0Mi5kZWNpbWFsID0gTnVtYmVyKHQyLmRlY2ltYWwpKSwgZTIudHlwZSA9PT0gIkVtcHR5U3RhdGVtZW50IikKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICBpZiAoZTIudHlwZSA9PT0gIkpTWFRleHQiKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIGlmIChlMi50eXBlID09PSAiSlNYRXhwcmVzc2lvbkNvbnRhaW5lciIgJiYgKGUyLmV4cHJlc3Npb24udHlwZSA9PT0gIkxpdGVyYWwiIHx8IGUyLmV4cHJlc3Npb24udHlwZSA9PT0gIlN0cmluZ0xpdGVyYWwiKSAmJiBlMi5leHByZXNzaW9uLnZhbHVlID09PSAiICIpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgaWYgKGUyLnR5cGUgIT09ICJQcm9wZXJ0eSIgJiYgZTIudHlwZSAhPT0gIk9iamVjdFByb3BlcnR5IiAmJiBlMi50eXBlICE9PSAiTWV0aG9kRGVmaW5pdGlvbiIgJiYgZTIudHlwZSAhPT0gIkNsYXNzUHJvcGVydHkiICYmIGUyLnR5cGUgIT09ICJDbGFzc01ldGhvZCIgJiYgZTIudHlwZSAhPT0gIlByb3BlcnR5RGVmaW5pdGlvbiIgJiYgZTIudHlwZSAhPT0gIlRTRGVjbGFyZU1ldGhvZCIgJiYgZTIudHlwZSAhPT0gIlRTUHJvcGVydHlTaWduYXR1cmUiICYmIGUyLnR5cGUgIT09ICJPYmplY3RUeXBlUHJvcGVydHkiIHx8IHR5cGVvZiBlMi5rZXkgIT0gIm9iamVjdCIgfHwgIWUyLmtleSB8fCBlMi5rZXkudHlwZSAhPT0gIkxpdGVyYWwiICYmIGUyLmtleS50eXBlICE9PSAiTnVtZXJpY0xpdGVyYWwiICYmIGUyLmtleS50eXBlICE9PSAiU3RyaW5nTGl0ZXJhbCIgJiYgZTIua2V5LnR5cGUgIT09ICJJZGVudGlmaWVyIiB8fCBkZWxldGUgdDIua2V5LCBlMi50eXBlID09PSAiSlNYRWxlbWVudCIgJiYgZTIub3BlbmluZ0VsZW1lbnQubmFtZS5uYW1lID09PSAic3R5bGUiICYmIGUyLm9wZW5pbmdFbGVtZW50LmF0dHJpYnV0ZXMuc29tZSgoZTMpID0+IGUzLm5hbWUubmFtZSA9PT0gImpzeCIpKQogICAgICAgICAgICBmb3IgKGNvbnN0IHsgdHlwZTogZTMsIGV4cHJlc3Npb246IG4zIH0gb2YgdDIuY2hpbGRyZW4pCiAgICAgICAgICAgICAgZTMgPT09ICJKU1hFeHByZXNzaW9uQ29udGFpbmVyIiAmJiBuMy50eXBlID09PSAiVGVtcGxhdGVMaXRlcmFsIiAmJiBPYihuMyk7CiAgICAgICAgICBlMi50eXBlID09PSAiSlNYQXR0cmlidXRlIiAmJiBlMi5uYW1lLm5hbWUgPT09ICJjc3MiICYmIGUyLnZhbHVlLnR5cGUgPT09ICJKU1hFeHByZXNzaW9uQ29udGFpbmVyIiAmJiBlMi52YWx1ZS5leHByZXNzaW9uLnR5cGUgPT09ICJUZW1wbGF0ZUxpdGVyYWwiICYmIE9iKHQyLnZhbHVlLmV4cHJlc3Npb24pLCBlMi50eXBlID09PSAiSlNYQXR0cmlidXRlIiAmJiBlMi52YWx1ZSAmJiBlMi52YWx1ZS50eXBlID09PSAiTGl0ZXJhbCIgJiYgL1siJ118JnF1b3Q7fCZhcG9zOy8udGVzdChlMi52YWx1ZS52YWx1ZSkgJiYgKHQyLnZhbHVlLnZhbHVlID0gdDIudmFsdWUudmFsdWUucmVwbGFjZSgvWyInXXwmcXVvdDt8JmFwb3M7L2csICciJykpOwogICAgICAgICAgY29uc3QgcjIgPSBlMi5leHByZXNzaW9uIHx8IGUyLmNhbGxlZTsKICAgICAgICAgIGlmIChlMi50eXBlID09PSAiRGVjb3JhdG9yIiAmJiByMi50eXBlID09PSAiQ2FsbEV4cHJlc3Npb24iICYmIHIyLmNhbGxlZS5uYW1lID09PSAiQ29tcG9uZW50IiAmJiByMi5hcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIGNvbnN0IG4zID0gZTIuZXhwcmVzc2lvbi5hcmd1bWVudHNbMF0ucHJvcGVydGllczsKICAgICAgICAgICAgZm9yIChjb25zdCBbZTMsIHIzXSBvZiB0Mi5leHByZXNzaW9uLmFyZ3VtZW50c1swXS5wcm9wZXJ0aWVzLmVudHJpZXMoKSkKICAgICAgICAgICAgICBzd2l0Y2ggKG4zW2UzXS5rZXkubmFtZSkgewogICAgICAgICAgICAgICAgY2FzZSAic3R5bGVzIjoKICAgICAgICAgICAgICAgICAgcjMudmFsdWUudHlwZSA9PT0gIkFycmF5RXhwcmVzc2lvbiIgJiYgT2IocjMudmFsdWUuZWxlbWVudHNbMF0pOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInRlbXBsYXRlIjoKICAgICAgICAgICAgICAgICAgcjMudmFsdWUudHlwZSA9PT0gIlRlbXBsYXRlTGl0ZXJhbCIgJiYgT2IocjMudmFsdWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChlMi50eXBlICE9PSAiVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uIiB8fCBlMi50YWcudHlwZSAhPT0gIk1lbWJlckV4cHJlc3Npb24iICYmIChlMi50YWcudHlwZSAhPT0gIklkZW50aWZpZXIiIHx8IGUyLnRhZy5uYW1lICE9PSAiZ3FsIiAmJiBlMi50YWcubmFtZSAhPT0gImdyYXBocWwiICYmIGUyLnRhZy5uYW1lICE9PSAiY3NzIiAmJiBlMi50YWcubmFtZSAhPT0gIm1kIiAmJiBlMi50YWcubmFtZSAhPT0gIm1hcmtkb3duIiAmJiBlMi50YWcubmFtZSAhPT0gImh0bWwiKSAmJiBlMi50YWcudHlwZSAhPT0gIkNhbGxFeHByZXNzaW9uIiB8fCBPYih0Mi5xdWFzaSksIGUyLnR5cGUgPT09ICJUZW1wbGF0ZUxpdGVyYWwiKSB7CiAgICAgICAgICAgIGNvbnN0IHIzID0gZTIubGVhZGluZ0NvbW1lbnRzICYmIGUyLmxlYWRpbmdDb21tZW50cy5zb21lKChlMykgPT4ga2IoZTMpICYmIFsiR3JhcGhRTCIsICJIVE1MIl0uc29tZSgodDMpID0+IGUzLnZhbHVlID09PSAiICIuY29uY2F0KHQzLCAiICIpKSk7CiAgICAgICAgICAgIChyMyB8fCBuMi50eXBlID09PSAiQ2FsbEV4cHJlc3Npb24iICYmIG4yLmNhbGxlZS5uYW1lID09PSAiZ3JhcGhxbCIgfHwgIWUyLmxlYWRpbmdDb21tZW50cykgJiYgT2IodDIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJJbnRlcnByZXRlckRpcmVjdGl2ZSIgJiYgKHQyLnZhbHVlID0gdDIudmFsdWUudHJpbUVuZCgpKSwgZTIudHlwZSAhPT0gIlRTSW50ZXJzZWN0aW9uVHlwZSIgJiYgZTIudHlwZSAhPT0gIlRTVW5pb25UeXBlIiB8fCBlMi50eXBlcy5sZW5ndGggIT09IDEgPyB2b2lkIDAgOiB0Mi50eXBlc1swXTsKICAgICAgICB9CiAgICAgICAgSWIuaWdub3JlZFByb3BlcnRpZXMgPSBQYjsKICAgICAgICB2YXIgTGIgPSBJYiwgamIgPSB7fSwgX2IgPSB7IGV4cG9ydHM6IHt9IH07CiAgICAgICAgY29uc3QgTWIgPSAoZTIpID0+IHsKICAgICAgICAgIGlmICh0eXBlb2YgZTIgIT0gInN0cmluZyIpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkV4cGVjdGVkIGEgc3RyaW5nIik7CiAgICAgICAgICBjb25zdCB0MiA9IGUyLm1hdGNoKC8oPzpccj9cbikvZykgfHwgW107CiAgICAgICAgICBpZiAodDIubGVuZ3RoID09PSAwKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBjb25zdCBuMiA9IHQyLmZpbHRlcigoZTMpID0+IGUzID09PSAiXHJcbiIpLmxlbmd0aDsKICAgICAgICAgIHJldHVybiBuMiA+IHQyLmxlbmd0aCAtIG4yID8gIlxyXG4iIDogIlxuIjsKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIFJiKCkgewogICAgICAgICAgY29uc3QgZTIgPSB5ZjsKICAgICAgICAgIHJldHVybiBSYiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICB9LCBlMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVmIoKSB7CiAgICAgICAgICBjb25zdCBlMiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMyAmJiBlMy5fX2VzTW9kdWxlID8gZTMgOiB7IGRlZmF1bHQ6IGUzIH07CiAgICAgICAgICB9KF9iLmV4cG9ydHMpOwogICAgICAgICAgcmV0dXJuIFZiID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICAgIH0sIGUyOwogICAgICAgIH0KICAgICAgICBfYi5leHBvcnRzID0gTWIsIF9iLmV4cG9ydHMuZ3JhY2VmdWwgPSAoZTIpID0+IHR5cGVvZiBlMiA9PSAic3RyaW5nIiAmJiBNYihlMikgfHwgIlxuIiwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGpiLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIGpiLmV4dHJhY3QgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMi5tYXRjaChxYik7CiAgICAgICAgICByZXR1cm4gdDIgPyB0MlswXS50cmltTGVmdCgpIDogIiI7CiAgICAgICAgfSwgamIuc3RyaXAgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMi5tYXRjaChxYik7CiAgICAgICAgICByZXR1cm4gdDIgJiYgdDJbMF0gPyBlMi5zdWJzdHJpbmcodDJbMF0ubGVuZ3RoKSA6IGUyOwogICAgICAgIH0sIGpiLnBhcnNlID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBZYihlMikucHJhZ21hczsKICAgICAgICB9LCBqYi5wYXJzZVdpdGhDb21tZW50cyA9IFliLCBqYi5wcmludCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50czogdDIgPSAiIiwgcHJhZ21hczogbjIgPSB7fSB9ID0gZTI7CiAgICAgICAgICBjb25zdCByMiA9ICgwLCBWYigpLmRlZmF1bHQpKHQyKSB8fCBSYigpLkVPTCwgbzIgPSAiICoiLCBpMiA9IE9iamVjdC5rZXlzKG4yKSwgdTIgPSBpMi5tYXAoKGUzKSA9PiBLYihlMywgbjJbZTNdKSkucmVkdWNlKChlMywgdDMpID0+IGUzLmNvbmNhdCh0MyksIFtdKS5tYXAoKGUzKSA9PiAiICogIiArIGUzICsgcjIpLmpvaW4oIiIpOwogICAgICAgICAgaWYgKCF0MikgewogICAgICAgICAgICBpZiAoaTIubGVuZ3RoID09PSAwKQogICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgaWYgKGkyLmxlbmd0aCA9PT0gMSAmJiAhQXJyYXkuaXNBcnJheShuMltpMlswXV0pKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSBuMltpMlswXV07CiAgICAgICAgICAgICAgcmV0dXJuICIiLmNvbmNhdCgiLyoqIiwgIiAiKS5jb25jYXQoS2IoaTJbMF0sIGUzKVswXSkuY29uY2F0KCIgKi8iKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY29uc3QgczIgPSB0Mi5zcGxpdChyMikubWFwKChlMykgPT4gIiIuY29uY2F0KG8yLCAiICIpLmNvbmNhdChlMykpLmpvaW4ocjIpICsgcjI7CiAgICAgICAgICByZXR1cm4gIi8qKiIgKyByMiArICh0MiA/IHMyIDogIiIpICsgKHQyICYmIGkyLmxlbmd0aCA/IG8yICsgcjIgOiAiIikgKyB1MiArICIgKi8iOwogICAgICAgIH07CiAgICAgICAgY29uc3QgJGIgPSAvXCpcLyQvLCBXYiA9IC9eXC9cKlwqLywgcWIgPSAvXlxzKihcL1wqXCo/KC58XHI/XG4pKj9cKlwvKS8sIFViID0gLyhefFxzKylcL1wvKFteXHJcbl0qKS9nLCB6YiA9IC9eKFxyP1xuKSsvLCBHYiA9IC8oPzpefFxyP1xuKSAqKEBbXlxyXG5dKj8pICpccj9cbiAqKD8hW15AXHJcbl0qXC9cL1teXSopKFteQFxyXG5cc11bXkBcclxuXSs/KSAqXHI/XG4vZywgSGIgPSAvKD86Xnxccj9cbikgKkAoXFMrKSAqKFteXHJcbl0qKS9nLCBKYiA9IC8oXHI/XG58XikgKlwqID8vZywgWGIgPSBbXTsKICAgICAgICBmdW5jdGlvbiBZYihlMikgewogICAgICAgICAgY29uc3QgdDIgPSAoMCwgVmIoKS5kZWZhdWx0KShlMikgfHwgUmIoKS5FT0w7CiAgICAgICAgICBlMiA9IGUyLnJlcGxhY2UoV2IsICIiKS5yZXBsYWNlKCRiLCAiIikucmVwbGFjZShKYiwgIiQxIik7CiAgICAgICAgICBsZXQgbjIgPSAiIjsKICAgICAgICAgIGZvciAoOyBuMiAhPT0gZTI7ICkKICAgICAgICAgICAgbjIgPSBlMiwgZTIgPSBlMi5yZXBsYWNlKEdiLCAiIi5jb25jYXQodDIsICIkMSAkMiIpLmNvbmNhdCh0MikpOwogICAgICAgICAgZTIgPSBlMi5yZXBsYWNlKHpiLCAiIikudHJpbVJpZ2h0KCk7CiAgICAgICAgICBjb25zdCByMiA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpLCBvMiA9IGUyLnJlcGxhY2UoSGIsICIiKS5yZXBsYWNlKHpiLCAiIikudHJpbVJpZ2h0KCk7CiAgICAgICAgICBsZXQgaTI7CiAgICAgICAgICBmb3IgKDsgaTIgPSBIYi5leGVjKGUyKTsgKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gaTJbMl0ucmVwbGFjZShVYiwgIiIpOwogICAgICAgICAgICB0eXBlb2YgcjJbaTJbMV1dID09ICJzdHJpbmciIHx8IEFycmF5LmlzQXJyYXkocjJbaTJbMV1dKSA/IHIyW2kyWzFdXSA9IFhiLmNvbmNhdChyMltpMlsxXV0sIGUzKSA6IHIyW2kyWzFdXSA9IGUzOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHsgY29tbWVudHM6IG8yLCBwcmFnbWFzOiByMiB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBLYihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBYYi5jb25jYXQodDIpLm1hcCgodDMpID0+ICJAIi5jb25jYXQoZTIsICIgIikuY29uY2F0KHQzKS50cmltKCkpOwogICAgICAgIH0KICAgICAgICBjb25zdCB7IHBhcnNlV2l0aENvbW1lbnRzOiBRYiwgc3RyaXA6IFpiLCBleHRyYWN0OiBldiwgcHJpbnQ6IHR2IH0gPSBqYiwgeyBnZXRTaGViYW5nOiBudiB9ID0gZGMsIHsgbm9ybWFsaXplRW5kT2ZMaW5lOiBydiB9ID0gaGM7CiAgICAgICAgZnVuY3Rpb24gb3YoZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gbnYoZTIpOwogICAgICAgICAgdDIgJiYgKGUyID0gZTIuc2xpY2UodDIubGVuZ3RoICsgMSkpOwogICAgICAgICAgY29uc3QgbjIgPSBldihlMiksIHsgcHJhZ21hczogcjIsIGNvbW1lbnRzOiBvMiB9ID0gUWIobjIpOwogICAgICAgICAgcmV0dXJuIHsgc2hlYmFuZzogdDIsIHRleHQ6IGUyLCBwcmFnbWFzOiByMiwgY29tbWVudHM6IG8yIH07CiAgICAgICAgfQogICAgICAgIHZhciBpdiA9IHsgaGFzUHJhZ21hOiBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBPYmplY3Qua2V5cyhvdihlMikucHJhZ21hcyk7CiAgICAgICAgICByZXR1cm4gdDIuaW5jbHVkZXMoInByZXR0aWVyIikgfHwgdDIuaW5jbHVkZXMoImZvcm1hdCIpOwogICAgICAgIH0sIGluc2VydFByYWdtYTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHsgc2hlYmFuZzogdDIsIHRleHQ6IG4yLCBwcmFnbWFzOiByMiwgY29tbWVudHM6IG8yIH0gPSBvdihlMiksIGkyID0gWmIobjIpLCB1MiA9IHR2KHsgcHJhZ21hczogT2JqZWN0LmFzc2lnbih7IGZvcm1hdDogIiIgfSwgcjIpLCBjb21tZW50czogbzIudHJpbVN0YXJ0KCkgfSk7CiAgICAgICAgICByZXR1cm4gKHQyID8gIiIuY29uY2F0KHQyLCAiXG4iKSA6ICIiKSArIHJ2KHUyKSArIChpMi5zdGFydHNXaXRoKCJcbiIpID8gIlxuIiA6ICJcblxuIikgKyBpMjsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgeyBnZXRMYXN0OiB1diwgaGFzTmV3bGluZTogc3YsIGdldE5leHROb25TcGFjZU5vbkNvbW1lbnRDaGFyYWN0ZXJJbmRleFdpdGhTdGFydEluZGV4OiBhdiwgZ2V0TmV4dE5vblNwYWNlTm9uQ29tbWVudENoYXJhY3RlcjogY3YsIGhhc05ld2xpbmVJblJhbmdlOiBsdiwgYWRkTGVhZGluZ0NvbW1lbnQ6IHB2LCBhZGRUcmFpbGluZ0NvbW1lbnQ6IGZ2LCBhZGREYW5nbGluZ0NvbW1lbnQ6IGR2LCBnZXROZXh0Tm9uU3BhY2VOb25Db21tZW50Q2hhcmFjdGVySW5kZXg6IGh2LCBpc05vbkVtcHR5QXJyYXk6IGd2IH0gPSBkYywgeyBpc0Jsb2NrQ29tbWVudDogbXYsIGdldEZ1bmN0aW9uUGFyYW1ldGVyczogeXYsIGlzUHJldHRpZXJJZ25vcmVDb21tZW50OiBEdiwgaXNKc3hOb2RlOiBFdiwgaGFzRmxvd1Nob3J0aGFuZEFubm90YXRpb25Db21tZW50OiBDdiwgaGFzRmxvd0Fubm90YXRpb25Db21tZW50OiBidiwgaGFzSWdub3JlQ29tbWVudDogdnYsIGlzQ2FsbExpa2VFeHByZXNzaW9uOiBBdiwgZ2V0Q2FsbEFyZ3VtZW50czogRnYsIGlzQ2FsbEV4cHJlc3Npb246IHh2LCBpc01lbWJlckV4cHJlc3Npb246IFN2LCBpc09iamVjdFByb3BlcnR5OiB3diwgZ2V0Q29tbWVudHM6IFR2LCBDb21tZW50Q2hlY2tGbGFnczogQnYgfSA9IENDLCB7IGxvY1N0YXJ0OiBOdiwgbG9jRW5kOiBrdiB9ID0gb2c7CiAgICAgICAgZnVuY3Rpb24gUHYoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IChlMi5ib2R5IHx8IGUyLnByb3BlcnRpZXMpLmZpbmQoKGUzKSA9PiB7CiAgICAgICAgICAgIGxldCB7IHR5cGU6IHQzIH0gPSBlMzsKICAgICAgICAgICAgcmV0dXJuIHQzICE9PSAiRW1wdHlTdGF0ZW1lbnQiOwogICAgICAgICAgfSk7CiAgICAgICAgICBuMiA/IHB2KG4yLCB0MikgOiBkdihlMiwgdDIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBPdihlMiwgdDIpIHsKICAgICAgICAgIGUyLnR5cGUgPT09ICJCbG9ja1N0YXRlbWVudCIgPyBQdihlMiwgdDIpIDogcHYoZTIsIHQyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gSXYoZTIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IHQyLCBmb2xsb3dpbmdOb2RlOiBuMiB9ID0gZTI7CiAgICAgICAgICByZXR1cm4gISghbjIgfHwgIWNBKHQyKSkgJiYgKHB2KG4yLCB0MiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBMdihlMikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogdDIsIHByZWNlZGluZ05vZGU6IG4yLCBlbmNsb3NpbmdOb2RlOiByMiwgZm9sbG93aW5nTm9kZTogbzIsIHRleHQ6IGkyIH0gPSBlMjsKICAgICAgICAgIGlmICghcjIgfHwgcjIudHlwZSAhPT0gIklmU3RhdGVtZW50IiB8fCAhbzIpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIHJldHVybiBjdihpMiwgdDIsIGt2KSA9PT0gIikiID8gKGZ2KG4yLCB0MiksIHRydWUpIDogbjIgPT09IHIyLmNvbnNlcXVlbnQgJiYgbzIgPT09IHIyLmFsdGVybmF0ZSA/IChuMi50eXBlID09PSAiQmxvY2tTdGF0ZW1lbnQiID8gZnYobjIsIHQyKSA6IGR2KHIyLCB0MiksIHRydWUpIDogbzIudHlwZSA9PT0gIkJsb2NrU3RhdGVtZW50IiA/IChQdihvMiwgdDIpLCB0cnVlKSA6IG8yLnR5cGUgPT09ICJJZlN0YXRlbWVudCIgPyAoT3YobzIuY29uc2VxdWVudCwgdDIpLCB0cnVlKSA6IHIyLmNvbnNlcXVlbnQgPT09IG8yICYmIChwdihvMiwgdDIpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24ganYoZTIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IHQyLCBwcmVjZWRpbmdOb2RlOiBuMiwgZW5jbG9zaW5nTm9kZTogcjIsIGZvbGxvd2luZ05vZGU6IG8yLCB0ZXh0OiBpMiB9ID0gZTI7CiAgICAgICAgICBpZiAoIXIyIHx8IHIyLnR5cGUgIT09ICJXaGlsZVN0YXRlbWVudCIgfHwgIW8yKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICByZXR1cm4gY3YoaTIsIHQyLCBrdikgPT09ICIpIiA/IChmdihuMiwgdDIpLCB0cnVlKSA6IG8yLnR5cGUgPT09ICJCbG9ja1N0YXRlbWVudCIgPyAoUHYobzIsIHQyKSwgdHJ1ZSkgOiByMi5ib2R5ID09PSBvMiAmJiAocHYobzIsIHQyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIF92KGUyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiB0MiwgcHJlY2VkaW5nTm9kZTogbjIsIGVuY2xvc2luZ05vZGU6IHIyLCBmb2xsb3dpbmdOb2RlOiBvMiB9ID0gZTI7CiAgICAgICAgICByZXR1cm4gISghcjIgfHwgcjIudHlwZSAhPT0gIlRyeVN0YXRlbWVudCIgJiYgcjIudHlwZSAhPT0gIkNhdGNoQ2xhdXNlIiB8fCAhbzIpICYmIChyMi50eXBlID09PSAiQ2F0Y2hDbGF1c2UiICYmIG4yID8gKGZ2KG4yLCB0MiksIHRydWUpIDogbzIudHlwZSA9PT0gIkJsb2NrU3RhdGVtZW50IiA/IChQdihvMiwgdDIpLCB0cnVlKSA6IG8yLnR5cGUgPT09ICJUcnlTdGF0ZW1lbnQiID8gKE92KG8yLmZpbmFsaXplciwgdDIpLCB0cnVlKSA6IG8yLnR5cGUgPT09ICJDYXRjaENsYXVzZSIgJiYgKE92KG8yLmJvZHksIHQyKSwgdHJ1ZSkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBNdihlMikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogdDIsIGVuY2xvc2luZ05vZGU6IG4yLCBmb2xsb3dpbmdOb2RlOiByMiB9ID0gZTI7CiAgICAgICAgICByZXR1cm4gISghU3YobjIpIHx8ICFyMiB8fCByMi50eXBlICE9PSAiSWRlbnRpZmllciIpICYmIChwdihuMiwgdDIpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gUnYoZTIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IHQyLCBwcmVjZWRpbmdOb2RlOiBuMiwgZW5jbG9zaW5nTm9kZTogcjIsIGZvbGxvd2luZ05vZGU6IG8yLCB0ZXh0OiBpMiB9ID0gZTI7CiAgICAgICAgICBjb25zdCB1MiA9IG4yICYmICFsdihpMiwga3YobjIpLCBOdih0MikpOwogICAgICAgICAgcmV0dXJuICEobjIgJiYgdTIgfHwgIXIyIHx8IHIyLnR5cGUgIT09ICJDb25kaXRpb25hbEV4cHJlc3Npb24iICYmIHIyLnR5cGUgIT09ICJUU0NvbmRpdGlvbmFsVHlwZSIgfHwgIW8yKSAmJiAocHYobzIsIHQyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFZ2KGUyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiB0MiwgcHJlY2VkaW5nTm9kZTogbjIsIGVuY2xvc2luZ05vZGU6IHIyIH0gPSBlMjsKICAgICAgICAgIHJldHVybiAhKCF3dihyMikgfHwgIXIyLnNob3J0aGFuZCB8fCByMi5rZXkgIT09IG4yIHx8IHIyLnZhbHVlLnR5cGUgIT09ICJBc3NpZ25tZW50UGF0dGVybiIpICYmIChmdihyMi52YWx1ZS5sZWZ0LCB0MiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiAkdihlMikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogdDIsIHByZWNlZGluZ05vZGU6IG4yLCBlbmNsb3NpbmdOb2RlOiByMiwgZm9sbG93aW5nTm9kZTogbzIgfSA9IGUyOwogICAgICAgICAgaWYgKHIyICYmIChyMi50eXBlID09PSAiQ2xhc3NEZWNsYXJhdGlvbiIgfHwgcjIudHlwZSA9PT0gIkNsYXNzRXhwcmVzc2lvbiIgfHwgcjIudHlwZSA9PT0gIkRlY2xhcmVDbGFzcyIgfHwgcjIudHlwZSA9PT0gIkRlY2xhcmVJbnRlcmZhY2UiIHx8IHIyLnR5cGUgPT09ICJJbnRlcmZhY2VEZWNsYXJhdGlvbiIgfHwgcjIudHlwZSA9PT0gIlRTSW50ZXJmYWNlRGVjbGFyYXRpb24iKSkgewogICAgICAgICAgICBpZiAoZ3YocjIuZGVjb3JhdG9ycykgJiYgKCFvMiB8fCBvMi50eXBlICE9PSAiRGVjb3JhdG9yIikpCiAgICAgICAgICAgICAgcmV0dXJuIGZ2KHV2KHIyLmRlY29yYXRvcnMpLCB0MiksIHRydWU7CiAgICAgICAgICAgIGlmIChyMi5ib2R5ICYmIG8yID09PSByMi5ib2R5KQogICAgICAgICAgICAgIHJldHVybiBQdihyMi5ib2R5LCB0MiksIHRydWU7CiAgICAgICAgICAgIGlmIChvMikgewogICAgICAgICAgICAgIGZvciAoY29uc3QgZTMgb2YgWyJpbXBsZW1lbnRzIiwgImV4dGVuZHMiLCAibWl4aW5zIl0pCiAgICAgICAgICAgICAgICBpZiAocjJbZTNdICYmIG8yID09PSByMltlM11bMF0pCiAgICAgICAgICAgICAgICAgIHJldHVybiAhbjIgfHwgbjIgIT09IHIyLmlkICYmIG4yICE9PSByMi50eXBlUGFyYW1ldGVycyAmJiBuMiAhPT0gcjIuc3VwZXJDbGFzcyA/IGR2KHIyLCB0MiwgZTMpIDogZnYobjIsIHQyKSwgdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBXdihlMikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogdDIsIHByZWNlZGluZ05vZGU6IG4yLCBlbmNsb3NpbmdOb2RlOiByMiwgdGV4dDogbzIgfSA9IGUyOwogICAgICAgICAgcmV0dXJuIChyMiAmJiBuMiAmJiAocjIudHlwZSA9PT0gIlByb3BlcnR5IiB8fCByMi50eXBlID09PSAiVFNEZWNsYXJlTWV0aG9kIiB8fCByMi50eXBlID09PSAiVFNBYnN0cmFjdE1ldGhvZERlZmluaXRpb24iKSAmJiBuMi50eXBlID09PSAiSWRlbnRpZmllciIgJiYgcjIua2V5ID09PSBuMiAmJiBjdihvMiwgbjIsIGt2KSAhPT0gIjoiIHx8ICEoIW4yIHx8ICFyMiB8fCBuMi50eXBlICE9PSAiRGVjb3JhdG9yIiB8fCByMi50eXBlICE9PSAiQ2xhc3NNZXRob2QiICYmIHIyLnR5cGUgIT09ICJDbGFzc1Byb3BlcnR5IiAmJiByMi50eXBlICE9PSAiUHJvcGVydHlEZWZpbml0aW9uIiAmJiByMi50eXBlICE9PSAiVFNBYnN0cmFjdFByb3BlcnR5RGVmaW5pdGlvbiIgJiYgcjIudHlwZSAhPT0gIlRTQWJzdHJhY3RNZXRob2REZWZpbml0aW9uIiAmJiByMi50eXBlICE9PSAiVFNEZWNsYXJlTWV0aG9kIiAmJiByMi50eXBlICE9PSAiTWV0aG9kRGVmaW5pdGlvbiIpKSAmJiAoZnYobjIsIHQyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHF2KGUyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiB0MiwgcHJlY2VkaW5nTm9kZTogbjIsIGVuY2xvc2luZ05vZGU6IHIyLCB0ZXh0OiBvMiB9ID0gZTI7CiAgICAgICAgICByZXR1cm4gY3YobzIsIHQyLCBrdikgPT09ICIoIiAmJiAoISghbjIgfHwgIXIyIHx8IHIyLnR5cGUgIT09ICJGdW5jdGlvbkRlY2xhcmF0aW9uIiAmJiByMi50eXBlICE9PSAiRnVuY3Rpb25FeHByZXNzaW9uIiAmJiByMi50eXBlICE9PSAiQ2xhc3NNZXRob2QiICYmIHIyLnR5cGUgIT09ICJNZXRob2REZWZpbml0aW9uIiAmJiByMi50eXBlICE9PSAiT2JqZWN0TWV0aG9kIikgJiYgKGZ2KG4yLCB0MiksIHRydWUpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVXYoZTIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IHQyLCBlbmNsb3NpbmdOb2RlOiBuMiwgdGV4dDogcjIgfSA9IGUyOwogICAgICAgICAgaWYgKCFuMiB8fCBuMi50eXBlICE9PSAiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBjb25zdCBvMiA9IGh2KHIyLCB0Miwga3YpOwogICAgICAgICAgcmV0dXJuIG8yICE9PSBmYWxzZSAmJiByMi5zbGljZShvMiwgbzIgKyAyKSA9PT0gIj0+IiAmJiAoZHYobjIsIHQyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHp2KGUyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiB0MiwgZW5jbG9zaW5nTm9kZTogbjIsIHRleHQ6IHIyIH0gPSBlMjsKICAgICAgICAgIHJldHVybiBjdihyMiwgdDIsIGt2KSA9PT0gIikiICYmIChuMiAmJiAoYUEobjIpICYmIHl2KG4yKS5sZW5ndGggPT09IDAgfHwgQXYobjIpICYmIEZ2KG4yKS5sZW5ndGggPT09IDApID8gKGR2KG4yLCB0MiksIHRydWUpIDogISghbjIgfHwgbjIudHlwZSAhPT0gIk1ldGhvZERlZmluaXRpb24iICYmIG4yLnR5cGUgIT09ICJUU0Fic3RyYWN0TWV0aG9kRGVmaW5pdGlvbiIgfHwgeXYobjIudmFsdWUpLmxlbmd0aCAhPT0gMCkgJiYgKGR2KG4yLnZhbHVlLCB0MiksIHRydWUpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gR3YoZTIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IHQyLCBwcmVjZWRpbmdOb2RlOiBuMiwgZW5jbG9zaW5nTm9kZTogcjIsIGZvbGxvd2luZ05vZGU6IG8yLCB0ZXh0OiBpMiB9ID0gZTI7CiAgICAgICAgICBpZiAobjIgJiYgbjIudHlwZSA9PT0gIkZ1bmN0aW9uVHlwZVBhcmFtIiAmJiByMiAmJiByMi50eXBlID09PSAiRnVuY3Rpb25UeXBlQW5ub3RhdGlvbiIgJiYgbzIgJiYgbzIudHlwZSAhPT0gIkZ1bmN0aW9uVHlwZVBhcmFtIikKICAgICAgICAgICAgcmV0dXJuIGZ2KG4yLCB0MiksIHRydWU7CiAgICAgICAgICBpZiAobjIgJiYgKG4yLnR5cGUgPT09ICJJZGVudGlmaWVyIiB8fCBuMi50eXBlID09PSAiQXNzaWdubWVudFBhdHRlcm4iKSAmJiByMiAmJiBhQShyMikgJiYgY3YoaTIsIHQyLCBrdikgPT09ICIpIikKICAgICAgICAgICAgcmV0dXJuIGZ2KG4yLCB0MiksIHRydWU7CiAgICAgICAgICBpZiAocjIgJiYgcjIudHlwZSA9PT0gIkZ1bmN0aW9uRGVjbGFyYXRpb24iICYmIG8yICYmIG8yLnR5cGUgPT09ICJCbG9ja1N0YXRlbWVudCIpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSAoKCkgPT4gewogICAgICAgICAgICAgIGNvbnN0IGU0ID0geXYocjIpOwogICAgICAgICAgICAgIGlmIChlNC5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGF2KGkyLCBrdih1dihlNCkpKTsKICAgICAgICAgICAgICBjb25zdCB0MyA9IGF2KGkyLCBrdihyMi5pZCkpOwogICAgICAgICAgICAgIHJldHVybiB0MyAhPT0gZmFsc2UgJiYgYXYoaTIsIHQzICsgMSk7CiAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICAgIGlmIChOdih0MikgPiBlMykKICAgICAgICAgICAgICByZXR1cm4gUHYobzIsIHQyKSwgdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gSHYoZTIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IHQyLCBlbmNsb3NpbmdOb2RlOiBuMiB9ID0gZTI7CiAgICAgICAgICByZXR1cm4gISghbjIgfHwgbjIudHlwZSAhPT0gIkltcG9ydFNwZWNpZmllciIpICYmIChwdihuMiwgdDIpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gSnYoZTIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IHQyLCBlbmNsb3NpbmdOb2RlOiBuMiB9ID0gZTI7CiAgICAgICAgICByZXR1cm4gISghbjIgfHwgbjIudHlwZSAhPT0gIkxhYmVsZWRTdGF0ZW1lbnQiKSAmJiAocHYobjIsIHQyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFh2KGUyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiB0MiwgZW5jbG9zaW5nTm9kZTogbjIgfSA9IGUyOwogICAgICAgICAgcmV0dXJuICEoIW4yIHx8IG4yLnR5cGUgIT09ICJDb250aW51ZVN0YXRlbWVudCIgJiYgbjIudHlwZSAhPT0gIkJyZWFrU3RhdGVtZW50IiB8fCBuMi5sYWJlbCkgJiYgKGZ2KG4yLCB0MiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBZdihlMikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogdDIsIHByZWNlZGluZ05vZGU6IG4yLCBlbmNsb3NpbmdOb2RlOiByMiB9ID0gZTI7CiAgICAgICAgICByZXR1cm4gISEoeHYocjIpICYmIG4yICYmIHIyLmNhbGxlZSA9PT0gbjIgJiYgcjIuYXJndW1lbnRzLmxlbmd0aCA+IDApICYmIChwdihyMi5hcmd1bWVudHNbMF0sIHQyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEt2KGUyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiB0MiwgcHJlY2VkaW5nTm9kZTogbjIsIGVuY2xvc2luZ05vZGU6IHIyLCBmb2xsb3dpbmdOb2RlOiBvMiB9ID0gZTI7CiAgICAgICAgICByZXR1cm4gIXIyIHx8IHIyLnR5cGUgIT09ICJVbmlvblR5cGVBbm5vdGF0aW9uIiAmJiByMi50eXBlICE9PSAiVFNVbmlvblR5cGUiID8gKG8yICYmIChvMi50eXBlID09PSAiVW5pb25UeXBlQW5ub3RhdGlvbiIgfHwgbzIudHlwZSA9PT0gIlRTVW5pb25UeXBlIikgJiYgRHYodDIpICYmIChvMi50eXBlc1swXS5wcmV0dGllcklnbm9yZSA9IHRydWUsIHQyLnVuaWdub3JlID0gdHJ1ZSksIGZhbHNlKSA6IChEdih0MikgJiYgKG8yLnByZXR0aWVySWdub3JlID0gdHJ1ZSwgdDIudW5pZ25vcmUgPSB0cnVlKSwgISFuMiAmJiAoZnYobjIsIHQyKSwgdHJ1ZSkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBRdihlMikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogdDIsIGVuY2xvc2luZ05vZGU6IG4yIH0gPSBlMjsKICAgICAgICAgIHJldHVybiAhIXd2KG4yKSAmJiAocHYobjIsIHQyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFp2KGUyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiB0MiwgZW5jbG9zaW5nTm9kZTogbjIsIGZvbGxvd2luZ05vZGU6IHIyLCBhc3Q6IG8yLCBpc0xhc3RDb21tZW50OiBpMiB9ID0gZTI7CiAgICAgICAgICByZXR1cm4gbzIgJiYgbzIuYm9keSAmJiBvMi5ib2R5Lmxlbmd0aCA9PT0gMCA/IChpMiA/IGR2KG8yLCB0MikgOiBwdihvMiwgdDIpLCB0cnVlKSA6IG4yICYmIG4yLnR5cGUgPT09ICJQcm9ncmFtIiAmJiBuMi5ib2R5Lmxlbmd0aCA9PT0gMCAmJiAhZ3YobjIuZGlyZWN0aXZlcykgPyAoaTIgPyBkdihuMiwgdDIpIDogcHYobjIsIHQyKSwgdHJ1ZSkgOiAhKCFyMiB8fCByMi50eXBlICE9PSAiUHJvZ3JhbSIgfHwgcjIuYm9keS5sZW5ndGggIT09IDAgfHwgIW4yIHx8IG4yLnR5cGUgIT09ICJNb2R1bGVFeHByZXNzaW9uIikgJiYgKGR2KHIyLCB0MiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBlQShlMikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogdDIsIGVuY2xvc2luZ05vZGU6IG4yIH0gPSBlMjsKICAgICAgICAgIHJldHVybiAhKCFuMiB8fCBuMi50eXBlICE9PSAiRm9ySW5TdGF0ZW1lbnQiICYmIG4yLnR5cGUgIT09ICJGb3JPZlN0YXRlbWVudCIpICYmIChwdihuMiwgdDIpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdEEoZTIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IHQyLCBwcmVjZWRpbmdOb2RlOiBuMiwgZW5jbG9zaW5nTm9kZTogcjIsIHRleHQ6IG8yIH0gPSBlMjsKICAgICAgICAgIHJldHVybiAhIShuMiAmJiBuMi50eXBlID09PSAiSW1wb3J0U3BlY2lmaWVyIiAmJiByMiAmJiByMi50eXBlID09PSAiSW1wb3J0RGVjbGFyYXRpb24iICYmIHN2KG8yLCBrdih0MikpKSAmJiAoZnYobjIsIHQyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG5BKGUyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiB0MiwgZW5jbG9zaW5nTm9kZTogbjIgfSA9IGUyOwogICAgICAgICAgcmV0dXJuICEoIW4yIHx8IG4yLnR5cGUgIT09ICJBc3NpZ25tZW50UGF0dGVybiIpICYmIChwdihuMiwgdDIpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gckEoZTIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IHQyLCBlbmNsb3NpbmdOb2RlOiBuMiB9ID0gZTI7CiAgICAgICAgICByZXR1cm4gISghbjIgfHwgbjIudHlwZSAhPT0gIlR5cGVBbGlhcyIpICYmIChwdihuMiwgdDIpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb0EoZTIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IHQyLCBlbmNsb3NpbmdOb2RlOiBuMiwgZm9sbG93aW5nTm9kZTogcjIgfSA9IGUyOwogICAgICAgICAgcmV0dXJuICEoIW4yIHx8IG4yLnR5cGUgIT09ICJWYXJpYWJsZURlY2xhcmF0b3IiICYmIG4yLnR5cGUgIT09ICJBc3NpZ25tZW50RXhwcmVzc2lvbiIgfHwgIXIyIHx8IHIyLnR5cGUgIT09ICJPYmplY3RFeHByZXNzaW9uIiAmJiByMi50eXBlICE9PSAiQXJyYXlFeHByZXNzaW9uIiAmJiByMi50eXBlICE9PSAiVGVtcGxhdGVMaXRlcmFsIiAmJiByMi50eXBlICE9PSAiVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uIiAmJiAhbXYodDIpKSAmJiAocHYocjIsIHQyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlBKGUyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiB0MiwgZW5jbG9zaW5nTm9kZTogbjIsIGZvbGxvd2luZ05vZGU6IHIyLCB0ZXh0OiBvMiB9ID0gZTI7CiAgICAgICAgICByZXR1cm4gIShyMiB8fCAhbjIgfHwgbjIudHlwZSAhPT0gIlRTTWV0aG9kU2lnbmF0dXJlIiAmJiBuMi50eXBlICE9PSAiVFNEZWNsYXJlRnVuY3Rpb24iICYmIG4yLnR5cGUgIT09ICJUU0Fic3RyYWN0TWV0aG9kRGVmaW5pdGlvbiIgfHwgY3YobzIsIHQyLCBrdikgIT09ICI7IikgJiYgKGZ2KG4yLCB0MiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB1QShlMikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogdDIsIGVuY2xvc2luZ05vZGU6IG4yLCBmb2xsb3dpbmdOb2RlOiByMiB9ID0gZTI7CiAgICAgICAgICBpZiAoRHYodDIpICYmIG4yICYmIG4yLnR5cGUgPT09ICJUU01hcHBlZFR5cGUiICYmIHIyICYmIHIyLnR5cGUgPT09ICJUU1R5cGVQYXJhbWV0ZXIiICYmIHIyLmNvbnN0cmFpbnQpCiAgICAgICAgICAgIHJldHVybiBuMi5wcmV0dGllcklnbm9yZSA9IHRydWUsIHQyLnVuaWdub3JlID0gdHJ1ZSwgdHJ1ZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc0EoZTIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IHQyLCBwcmVjZWRpbmdOb2RlOiBuMiwgZW5jbG9zaW5nTm9kZTogcjIsIGZvbGxvd2luZ05vZGU6IG8yIH0gPSBlMjsKICAgICAgICAgIHJldHVybiAhKCFyMiB8fCByMi50eXBlICE9PSAiVFNNYXBwZWRUeXBlIikgJiYgKG8yICYmIG8yLnR5cGUgPT09ICJUU1R5cGVQYXJhbWV0ZXIiICYmIG8yLm5hbWUgPyAocHYobzIubmFtZSwgdDIpLCB0cnVlKSA6ICEoIW4yIHx8IG4yLnR5cGUgIT09ICJUU1R5cGVQYXJhbWV0ZXIiIHx8ICFuMi5jb25zdHJhaW50KSAmJiAoZnYobjIuY29uc3RyYWludCwgdDIpLCB0cnVlKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFBKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiB8fCBlMi50eXBlID09PSAiRnVuY3Rpb25FeHByZXNzaW9uIiB8fCBlMi50eXBlID09PSAiRnVuY3Rpb25EZWNsYXJhdGlvbiIgfHwgZTIudHlwZSA9PT0gIk9iamVjdE1ldGhvZCIgfHwgZTIudHlwZSA9PT0gIkNsYXNzTWV0aG9kIiB8fCBlMi50eXBlID09PSAiVFNEZWNsYXJlRnVuY3Rpb24iIHx8IGUyLnR5cGUgPT09ICJUU0NhbGxTaWduYXR1cmVEZWNsYXJhdGlvbiIgfHwgZTIudHlwZSA9PT0gIlRTQ29uc3RydWN0U2lnbmF0dXJlRGVjbGFyYXRpb24iIHx8IGUyLnR5cGUgPT09ICJUU01ldGhvZFNpZ25hdHVyZSIgfHwgZTIudHlwZSA9PT0gIlRTQ29uc3RydWN0b3JUeXBlIiB8fCBlMi50eXBlID09PSAiVFNGdW5jdGlvblR5cGUiIHx8IGUyLnR5cGUgPT09ICJUU0RlY2xhcmVNZXRob2QiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjQShlMikgewogICAgICAgICAgcmV0dXJuIG12KGUyKSAmJiBlMi52YWx1ZVswXSA9PT0gIioiICYmIC9AdHlwZVxiLy50ZXN0KGUyLnZhbHVlKTsKICAgICAgICB9CiAgICAgICAgdmFyIGxBID0geyBoYW5kbGVPd25MaW5lQ29tbWVudDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBbdUEsIEd2LCBNdiwgTHYsIGp2LCBfdiwgJHYsIEh2LCBlQSwgS3YsIFp2LCB0QSwgbkEsIFd2LCBKdl0uc29tZSgodDIpID0+IHQyKGUyKSk7CiAgICAgICAgfSwgaGFuZGxlRW5kT2ZMaW5lQ29tbWVudDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBbSXYsIEd2LCBSdiwgSHYsIEx2LCBqdiwgX3YsICR2LCBKdiwgWXYsIFF2LCBadiwgckEsIG9BXS5zb21lKCh0MikgPT4gdDIoZTIpKTsKICAgICAgICB9LCBoYW5kbGVSZW1haW5pbmdDb21tZW50OiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFt1QSwgTHYsIGp2LCBWdiwgenYsIFd2LCBadiwgVXYsIHF2LCBzQSwgWHYsIGlBXS5zb21lKCh0MikgPT4gdDIoZTIpKTsKICAgICAgICB9LCBpc1R5cGVDYXN0Q29tbWVudDogY0EsIGdldENvbW1lbnRDaGlsZE5vZGVzOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGlmICgodDIucGFyc2VyID09PSAidHlwZXNjcmlwdCIgfHwgdDIucGFyc2VyID09PSAiZmxvdyIgfHwgdDIucGFyc2VyID09PSAiZXNwcmVlIiB8fCB0Mi5wYXJzZXIgPT09ICJtZXJpeWFoIiB8fCB0Mi5wYXJzZXIgPT09ICJfX2JhYmVsX2VzdHJlZSIpICYmIGUyLnR5cGUgPT09ICJNZXRob2REZWZpbml0aW9uIiAmJiBlMi52YWx1ZSAmJiBlMi52YWx1ZS50eXBlID09PSAiRnVuY3Rpb25FeHByZXNzaW9uIiAmJiB5dihlMi52YWx1ZSkubGVuZ3RoID09PSAwICYmICFlMi52YWx1ZS5yZXR1cm5UeXBlICYmICFndihlMi52YWx1ZS50eXBlUGFyYW1ldGVycykgJiYgZTIudmFsdWUuYm9keSkKICAgICAgICAgICAgcmV0dXJuIFsuLi5lMi5kZWNvcmF0b3JzIHx8IFtdLCBlMi5rZXksIGUyLnZhbHVlLmJvZHldOwogICAgICAgIH0sIHdpbGxQcmludE93bkNvbW1lbnRzOiBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMi5nZXRWYWx1ZSgpLCBuMiA9IGUyLmdldFBhcmVudE5vZGUoKTsKICAgICAgICAgIHJldHVybiAodDIgJiYgKEV2KHQyKSB8fCBDdih0MikgfHwgeHYobjIpICYmICgoZTMpID0+IGJ2KFR2KGUzLCBCdi5MZWFkaW5nKSkgfHwgYnYoVHYoZTMsIEJ2LlRyYWlsaW5nKSkpKHQyKSkgfHwgbjIgJiYgKG4yLnR5cGUgPT09ICJKU1hTcHJlYWRBdHRyaWJ1dGUiIHx8IG4yLnR5cGUgPT09ICJKU1hTcHJlYWRDaGlsZCIgfHwgbjIudHlwZSA9PT0gIlVuaW9uVHlwZUFubm90YXRpb24iIHx8IG4yLnR5cGUgPT09ICJUU1VuaW9uVHlwZSIgfHwgKG4yLnR5cGUgPT09ICJDbGFzc0RlY2xhcmF0aW9uIiB8fCBuMi50eXBlID09PSAiQ2xhc3NFeHByZXNzaW9uIikgJiYgbjIuc3VwZXJDbGFzcyA9PT0gdDIpKSAmJiAoIXZ2KGUyKSB8fCBuMi50eXBlID09PSAiVW5pb25UeXBlQW5ub3RhdGlvbiIgfHwgbjIudHlwZSA9PT0gIlRTVW5pb25UeXBlIik7CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IHBBID0gYXUsIHsgZ2V0RnVuY3Rpb25QYXJhbWV0ZXJzOiBmQSwgZ2V0TGVmdFNpZGVQYXRoTmFtZTogZEEsIGhhc0Zsb3dTaG9ydGhhbmRBbm5vdGF0aW9uQ29tbWVudDogaEEsIGhhc05ha2VkTGVmdFNpZGU6IGdBLCBoYXNOb2RlOiBtQSwgaXNCaXR3aXNlT3BlcmF0b3I6IHlBLCBzdGFydHNXaXRoTm9Mb29rYWhlYWRUb2tlbjogREEsIHNob3VsZEZsYXR0ZW46IEVBLCBnZXRQcmVjZWRlbmNlOiBDQSwgaXNDYWxsRXhwcmVzc2lvbjogYkEsIGlzTWVtYmVyRXhwcmVzc2lvbjogdkEsIGlzT2JqZWN0UHJvcGVydHk6IEFBIH0gPSBDQzsKICAgICAgICBmdW5jdGlvbiBGQShlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gZTIuZ2V0UGFyZW50Tm9kZSgpOwogICAgICAgICAgaWYgKCFuMikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXROYW1lKCksIG8yID0gZTIuZ2V0Tm9kZSgpOwogICAgICAgICAgaWYgKHQyLl9faXNJbkh0bWxJbnRlcnBvbGF0aW9uICYmICF0Mi5icmFja2V0U3BhY2luZyAmJiBmdW5jdGlvbihlMykgewogICAgICAgICAgICBpZiAoZTMudHlwZSA9PT0gIk9iamVjdEV4cHJlc3Npb24iKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9KG8yKSAmJiB4QShlMikpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgaWYgKGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMy50eXBlID09PSAiQmxvY2tTdGF0ZW1lbnQiIHx8IGUzLnR5cGUgPT09ICJCcmVha1N0YXRlbWVudCIgfHwgZTMudHlwZSA9PT0gIkNsYXNzQm9keSIgfHwgZTMudHlwZSA9PT0gIkNsYXNzRGVjbGFyYXRpb24iIHx8IGUzLnR5cGUgPT09ICJDbGFzc01ldGhvZCIgfHwgZTMudHlwZSA9PT0gIkNsYXNzUHJvcGVydHkiIHx8IGUzLnR5cGUgPT09ICJQcm9wZXJ0eURlZmluaXRpb24iIHx8IGUzLnR5cGUgPT09ICJDbGFzc1ByaXZhdGVQcm9wZXJ0eSIgfHwgZTMudHlwZSA9PT0gIkNvbnRpbnVlU3RhdGVtZW50IiB8fCBlMy50eXBlID09PSAiRGVidWdnZXJTdGF0ZW1lbnQiIHx8IGUzLnR5cGUgPT09ICJEZWNsYXJlQ2xhc3MiIHx8IGUzLnR5cGUgPT09ICJEZWNsYXJlRXhwb3J0QWxsRGVjbGFyYXRpb24iIHx8IGUzLnR5cGUgPT09ICJEZWNsYXJlRXhwb3J0RGVjbGFyYXRpb24iIHx8IGUzLnR5cGUgPT09ICJEZWNsYXJlRnVuY3Rpb24iIHx8IGUzLnR5cGUgPT09ICJEZWNsYXJlSW50ZXJmYWNlIiB8fCBlMy50eXBlID09PSAiRGVjbGFyZU1vZHVsZSIgfHwgZTMudHlwZSA9PT0gIkRlY2xhcmVNb2R1bGVFeHBvcnRzIiB8fCBlMy50eXBlID09PSAiRGVjbGFyZVZhcmlhYmxlIiB8fCBlMy50eXBlID09PSAiRG9XaGlsZVN0YXRlbWVudCIgfHwgZTMudHlwZSA9PT0gIkVudW1EZWNsYXJhdGlvbiIgfHwgZTMudHlwZSA9PT0gIkV4cG9ydEFsbERlY2xhcmF0aW9uIiB8fCBlMy50eXBlID09PSAiRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uIiB8fCBlMy50eXBlID09PSAiRXhwb3J0TmFtZWREZWNsYXJhdGlvbiIgfHwgZTMudHlwZSA9PT0gIkV4cHJlc3Npb25TdGF0ZW1lbnQiIHx8IGUzLnR5cGUgPT09ICJGb3JJblN0YXRlbWVudCIgfHwgZTMudHlwZSA9PT0gIkZvck9mU3RhdGVtZW50IiB8fCBlMy50eXBlID09PSAiRm9yU3RhdGVtZW50IiB8fCBlMy50eXBlID09PSAiRnVuY3Rpb25EZWNsYXJhdGlvbiIgfHwgZTMudHlwZSA9PT0gIklmU3RhdGVtZW50IiB8fCBlMy50eXBlID09PSAiSW1wb3J0RGVjbGFyYXRpb24iIHx8IGUzLnR5cGUgPT09ICJJbnRlcmZhY2VEZWNsYXJhdGlvbiIgfHwgZTMudHlwZSA9PT0gIkxhYmVsZWRTdGF0ZW1lbnQiIHx8IGUzLnR5cGUgPT09ICJNZXRob2REZWZpbml0aW9uIiB8fCBlMy50eXBlID09PSAiUmV0dXJuU3RhdGVtZW50IiB8fCBlMy50eXBlID09PSAiU3dpdGNoU3RhdGVtZW50IiB8fCBlMy50eXBlID09PSAiVGhyb3dTdGF0ZW1lbnQiIHx8IGUzLnR5cGUgPT09ICJUcnlTdGF0ZW1lbnQiIHx8IGUzLnR5cGUgPT09ICJUU0RlY2xhcmVGdW5jdGlvbiIgfHwgZTMudHlwZSA9PT0gIlRTRW51bURlY2xhcmF0aW9uIiB8fCBlMy50eXBlID09PSAiVFNJbXBvcnRFcXVhbHNEZWNsYXJhdGlvbiIgfHwgZTMudHlwZSA9PT0gIlRTSW50ZXJmYWNlRGVjbGFyYXRpb24iIHx8IGUzLnR5cGUgPT09ICJUU01vZHVsZURlY2xhcmF0aW9uIiB8fCBlMy50eXBlID09PSAiVFNOYW1lc3BhY2VFeHBvcnREZWNsYXJhdGlvbiIgfHwgZTMudHlwZSA9PT0gIlR5cGVBbGlhcyIgfHwgZTMudHlwZSA9PT0gIlZhcmlhYmxlRGVjbGFyYXRpb24iIHx8IGUzLnR5cGUgPT09ICJXaGlsZVN0YXRlbWVudCIgfHwgZTMudHlwZSA9PT0gIldpdGhTdGF0ZW1lbnQiOwogICAgICAgICAgfShvMikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIGlmICh0Mi5wYXJzZXIgIT09ICJmbG93IiAmJiBoQShlMi5nZXRWYWx1ZSgpKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICBpZiAobzIudHlwZSA9PT0gIklkZW50aWZpZXIiKQogICAgICAgICAgICByZXR1cm4gISEobzIuZXh0cmEgJiYgbzIuZXh0cmEucGFyZW50aGVzaXplZCAmJiAvXlBSRVRUSUVSX0hUTUxfUExBQ0VIT0xERVJfXGQrX1xkK19JTl9KUyQvLnRlc3QobzIubmFtZSkpIHx8IHIyID09PSAibGVmdCIgJiYgbzIubmFtZSA9PT0gImFzeW5jIiAmJiBuMi50eXBlID09PSAiRm9yT2ZTdGF0ZW1lbnQiICYmICFuMi5hd2FpdDsKICAgICAgICAgIHN3aXRjaCAobjIudHlwZSkgewogICAgICAgICAgICBjYXNlICJQYXJlbnRoZXNpemVkRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjYXNlICJDbGFzc0RlY2xhcmF0aW9uIjoKICAgICAgICAgICAgY2FzZSAiQ2xhc3NFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBpZiAocjIgPT09ICJzdXBlckNsYXNzIiAmJiAobzIudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiB8fCBvMi50eXBlID09PSAiQXNzaWdubWVudEV4cHJlc3Npb24iIHx8IG8yLnR5cGUgPT09ICJBd2FpdEV4cHJlc3Npb24iIHx8IG8yLnR5cGUgPT09ICJCaW5hcnlFeHByZXNzaW9uIiB8fCBvMi50eXBlID09PSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIiB8fCBvMi50eXBlID09PSAiTG9naWNhbEV4cHJlc3Npb24iIHx8IG8yLnR5cGUgPT09ICJOZXdFeHByZXNzaW9uIiB8fCBvMi50eXBlID09PSAiT2JqZWN0RXhwcmVzc2lvbiIgfHwgbzIudHlwZSA9PT0gIlBhcmVudGhlc2l6ZWRFeHByZXNzaW9uIiB8fCBvMi50eXBlID09PSAiU2VxdWVuY2VFeHByZXNzaW9uIiB8fCBvMi50eXBlID09PSAiVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uIiB8fCBvMi50eXBlID09PSAiVW5hcnlFeHByZXNzaW9uIiB8fCBvMi50eXBlID09PSAiVXBkYXRlRXhwcmVzc2lvbiIgfHwgbzIudHlwZSA9PT0gIllpZWxkRXhwcmVzc2lvbiIgfHwgbzIudHlwZSA9PT0gIlRTTm9uTnVsbEV4cHJlc3Npb24iKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJFeHBvcnREZWZhdWx0RGVjbGFyYXRpb24iOgogICAgICAgICAgICAgIHJldHVybiBTQShlMiwgdDIpIHx8IG8yLnR5cGUgPT09ICJTZXF1ZW5jZUV4cHJlc3Npb24iOwogICAgICAgICAgICBjYXNlICJEZWNvcmF0b3IiOgogICAgICAgICAgICAgIGlmIChyMiA9PT0gImV4cHJlc3Npb24iKSB7CiAgICAgICAgICAgICAgICBsZXQgZTMgPSBmYWxzZSwgbjMgPSBmYWxzZSwgcjMgPSBvMjsKICAgICAgICAgICAgICAgIGZvciAoOyByMzsgKQogICAgICAgICAgICAgICAgICBzd2l0Y2ggKHIzLnR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJNZW1iZXJFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgICAgIG4zID0gdHJ1ZSwgcjMgPSByMy5vYmplY3Q7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJDYWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgICAgICBpZiAobjMgfHwgZTMpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0Mi5wYXJzZXIgIT09ICJ0eXBlc2NyaXB0IjsKICAgICAgICAgICAgICAgICAgICAgIGUzID0gdHJ1ZSwgcjMgPSByMy5jYWxsZWU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJJZGVudGlmaWVyIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBjYXNlICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQyLnBhcnNlciAhPT0gInR5cGVzY3JpcHQiOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJFeHByZXNzaW9uU3RhdGVtZW50IjoKICAgICAgICAgICAgICBpZiAoREEobzIsIHRydWUpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIjoKICAgICAgICAgICAgICBpZiAocjIgPT09ICJib2R5IiAmJiBvMi50eXBlICE9PSAiU2VxdWVuY2VFeHByZXNzaW9uIiAmJiBEQShvMiwgZmFsc2UpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBzd2l0Y2ggKG8yLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiVXBkYXRlRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgaWYgKG4yLnR5cGUgPT09ICJVbmFyeUV4cHJlc3Npb24iKQogICAgICAgICAgICAgICAgcmV0dXJuIG8yLnByZWZpeCAmJiAobzIub3BlcmF0b3IgPT09ICIrKyIgJiYgbjIub3BlcmF0b3IgPT09ICIrIiB8fCBvMi5vcGVyYXRvciA9PT0gIi0tIiAmJiBuMi5vcGVyYXRvciA9PT0gIi0iKTsKICAgICAgICAgICAgY2FzZSAiVW5hcnlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBzd2l0Y2ggKG4yLnR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgIlVuYXJ5RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBvMi5vcGVyYXRvciA9PT0gbjIub3BlcmF0b3IgJiYgKG8yLm9wZXJhdG9yID09PSAiKyIgfHwgbzIub3BlcmF0b3IgPT09ICItIik7CiAgICAgICAgICAgICAgICBjYXNlICJCaW5kRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiVFNOb25OdWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgY2FzZSAiTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJPcHRpb25hbE1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICByZXR1cm4gcjIgPT09ICJvYmplY3QiOwogICAgICAgICAgICAgICAgY2FzZSAiTmV3RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJDYWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJPcHRpb25hbENhbGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHIyID09PSAiY2FsbGVlIjsKICAgICAgICAgICAgICAgIGNhc2UgIkJpbmFyeUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICByZXR1cm4gcjIgPT09ICJsZWZ0IiAmJiBuMi5vcGVyYXRvciA9PT0gIioqIjsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgIkJpbmFyeUV4cHJlc3Npb24iOgogICAgICAgICAgICAgIGlmIChuMi50eXBlID09PSAiVXBkYXRlRXhwcmVzc2lvbiIpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICBpZiAobzIub3BlcmF0b3IgPT09ICJpbiIgJiYgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgICAgIGxldCB0MyA9IDAsIG4zID0gZTMuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGZvciAoOyBuMzsgKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHIzID0gZTMuZ2V0UGFyZW50Tm9kZSh0MysrKTsKICAgICAgICAgICAgICAgICAgaWYgKHIzICYmIHIzLnR5cGUgPT09ICJGb3JTdGF0ZW1lbnQiICYmIHIzLmluaXQgPT09IG4zKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICBuMyA9IHIzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0oZTIpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgaWYgKG8yLm9wZXJhdG9yID09PSAifD4iICYmIG8yLmV4dHJhICYmIG8yLmV4dHJhLnBhcmVudGhlc2l6ZWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gZTIuZ2V0UGFyZW50Tm9kZSgxKTsKICAgICAgICAgICAgICAgIGlmICh0My50eXBlID09PSAiQmluYXJ5RXhwcmVzc2lvbiIgJiYgdDMub3BlcmF0b3IgPT09ICJ8PiIpCiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiVFNUeXBlQXNzZXJ0aW9uIjoKICAgICAgICAgICAgY2FzZSAiVFNBc0V4cHJlc3Npb24iOgogICAgICAgICAgICBjYXNlICJMb2dpY2FsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgc3dpdGNoIChuMi50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJUU0FzRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBvMi50eXBlICE9PSAiVFNBc0V4cHJlc3Npb24iOwogICAgICAgICAgICAgICAgY2FzZSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIG8yLnR5cGUgPT09ICJUU0FzRXhwcmVzc2lvbiI7CiAgICAgICAgICAgICAgICBjYXNlICJDYWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJOZXdFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIk9wdGlvbmFsQ2FsbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICByZXR1cm4gcjIgPT09ICJjYWxsZWUiOwogICAgICAgICAgICAgICAgY2FzZSAiQ2xhc3NFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIkNsYXNzRGVjbGFyYXRpb24iOgogICAgICAgICAgICAgICAgICByZXR1cm4gcjIgPT09ICJzdXBlckNsYXNzIjsKICAgICAgICAgICAgICAgIGNhc2UgIlRTVHlwZUFzc2VydGlvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiVW5hcnlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIkpTWFNwcmVhZEF0dHJpYnV0ZSI6CiAgICAgICAgICAgICAgICBjYXNlICJTcHJlYWRFbGVtZW50IjoKICAgICAgICAgICAgICAgIGNhc2UgIlNwcmVhZFByb3BlcnR5IjoKICAgICAgICAgICAgICAgIGNhc2UgIkJpbmRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIkF3YWl0RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJUU05vbk51bGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIlVwZGF0ZUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIGNhc2UgIk1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiT3B0aW9uYWxNZW1iZXJFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHIyID09PSAib2JqZWN0IjsKICAgICAgICAgICAgICAgIGNhc2UgIkFzc2lnbm1lbnRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIkFzc2lnbm1lbnRQYXR0ZXJuIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHIyID09PSAibGVmdCIgJiYgKG8yLnR5cGUgPT09ICJUU1R5cGVBc3NlcnRpb24iIHx8IG8yLnR5cGUgPT09ICJUU0FzRXhwcmVzc2lvbiIpOwogICAgICAgICAgICAgICAgY2FzZSAiTG9naWNhbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICBpZiAobzIudHlwZSA9PT0gIkxvZ2ljYWxFeHByZXNzaW9uIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbjIub3BlcmF0b3IgIT09IG8yLm9wZXJhdG9yOwogICAgICAgICAgICAgICAgY2FzZSAiQmluYXJ5RXhwcmVzc2lvbiI6IHsKICAgICAgICAgICAgICAgICAgY29uc3QgeyBvcGVyYXRvcjogZTMsIHR5cGU6IHQzIH0gPSBvMjsKICAgICAgICAgICAgICAgICAgaWYgKCFlMyAmJiB0MyAhPT0gIlRTVHlwZUFzc2VydGlvbiIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGkyID0gQ0EoZTMpLCB1MiA9IG4yLm9wZXJhdG9yLCBzMiA9IENBKHUyKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHMyID4gaTIgfHwgKHIyID09PSAicmlnaHQiICYmIHMyID09PSBpMiB8fCAoczIgPT09IGkyICYmICFFQSh1MiwgZTMpIHx8IChzMiA8IGkyICYmIGUzID09PSAiJSIgPyB1MiA9PT0gIisiIHx8IHUyID09PSAiLSIgOiAhIXlBKHUyKSkpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgIlNlcXVlbmNlRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgc3dpdGNoIChuMi50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJSZXR1cm5TdGF0ZW1lbnQiOgogICAgICAgICAgICAgICAgY2FzZSAiRm9yU3RhdGVtZW50IjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgY2FzZSAiRXhwcmVzc2lvblN0YXRlbWVudCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiByMiAhPT0gImV4cHJlc3Npb24iOwogICAgICAgICAgICAgICAgY2FzZSAiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICByZXR1cm4gcjIgIT09ICJib2R5IjsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiWWllbGRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBpZiAobjIudHlwZSA9PT0gIlVuYXJ5RXhwcmVzc2lvbiIgfHwgbjIudHlwZSA9PT0gIkF3YWl0RXhwcmVzc2lvbiIgfHwgbjIudHlwZSA9PT0gIlRTQXNFeHByZXNzaW9uIiB8fCBuMi50eXBlID09PSAiVFNOb25OdWxsRXhwcmVzc2lvbiIpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgY2FzZSAiQXdhaXRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBzd2l0Y2ggKG4yLnR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgIlRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJVbmFyeUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiTG9naWNhbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiU3ByZWFkRWxlbWVudCI6CiAgICAgICAgICAgICAgICBjYXNlICJTcHJlYWRQcm9wZXJ0eSI6CiAgICAgICAgICAgICAgICBjYXNlICJUU0FzRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJUU05vbk51bGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIkJpbmRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICBjYXNlICJNZW1iZXJFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIk9wdGlvbmFsTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIHJldHVybiByMiA9PT0gIm9iamVjdCI7CiAgICAgICAgICAgICAgICBjYXNlICJOZXdFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIkNhbGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIk9wdGlvbmFsQ2FsbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICByZXR1cm4gcjIgPT09ICJjYWxsZWUiOwogICAgICAgICAgICAgICAgY2FzZSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHIyID09PSAidGVzdCI7CiAgICAgICAgICAgICAgICBjYXNlICJCaW5hcnlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuICEoIW8yLmFyZ3VtZW50ICYmIG4yLm9wZXJhdG9yID09PSAifD4iKTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgIlRTQ29uZGl0aW9uYWxUeXBlIjoKICAgICAgICAgICAgICBpZiAocjIgPT09ICJleHRlbmRzVHlwZSIgJiYgbjIudHlwZSA9PT0gIlRTQ29uZGl0aW9uYWxUeXBlIikKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBjYXNlICJUU0Z1bmN0aW9uVHlwZSI6CiAgICAgICAgICAgIGNhc2UgIlRTQ29uc3RydWN0b3JUeXBlIjoKICAgICAgICAgICAgICBpZiAocjIgPT09ICJjaGVja1R5cGUiICYmIG4yLnR5cGUgPT09ICJUU0NvbmRpdGlvbmFsVHlwZSIpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgY2FzZSAiVFNVbmlvblR5cGUiOgogICAgICAgICAgICBjYXNlICJUU0ludGVyc2VjdGlvblR5cGUiOgogICAgICAgICAgICAgIGlmICgobjIudHlwZSA9PT0gIlRTVW5pb25UeXBlIiB8fCBuMi50eXBlID09PSAiVFNJbnRlcnNlY3Rpb25UeXBlIikgJiYgbjIudHlwZXMubGVuZ3RoID4gMSAmJiAoIW8yLnR5cGVzIHx8IG8yLnR5cGVzLmxlbmd0aCA+IDEpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGNhc2UgIlRTSW5mZXJUeXBlIjoKICAgICAgICAgICAgICBpZiAobzIudHlwZSA9PT0gIlRTSW5mZXJUeXBlIiAmJiBuMi50eXBlID09PSAiVFNSZXN0VHlwZSIpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNhc2UgIlRTVHlwZU9wZXJhdG9yIjoKICAgICAgICAgICAgICByZXR1cm4gbjIudHlwZSA9PT0gIlRTQXJyYXlUeXBlIiB8fCBuMi50eXBlID09PSAiVFNPcHRpb25hbFR5cGUiIHx8IG4yLnR5cGUgPT09ICJUU1Jlc3RUeXBlIiB8fCByMiA9PT0gIm9iamVjdFR5cGUiICYmIG4yLnR5cGUgPT09ICJUU0luZGV4ZWRBY2Nlc3NUeXBlIiB8fCBuMi50eXBlID09PSAiVFNUeXBlT3BlcmF0b3IiIHx8IG4yLnR5cGUgPT09ICJUU1R5cGVBbm5vdGF0aW9uIiAmJiBlMi5nZXRQYXJlbnROb2RlKDEpLnR5cGUuc3RhcnRzV2l0aCgiVFNKU0RvYyIpOwogICAgICAgICAgICBjYXNlICJBcnJheVR5cGVBbm5vdGF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gbjIudHlwZSA9PT0gIk51bGxhYmxlVHlwZUFubm90YXRpb24iOwogICAgICAgICAgICBjYXNlICJJbnRlcnNlY3Rpb25UeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgIGNhc2UgIlVuaW9uVHlwZUFubm90YXRpb24iOgogICAgICAgICAgICAgIHJldHVybiBuMi50eXBlID09PSAiQXJyYXlUeXBlQW5ub3RhdGlvbiIgfHwgbjIudHlwZSA9PT0gIk51bGxhYmxlVHlwZUFubm90YXRpb24iIHx8IG4yLnR5cGUgPT09ICJJbnRlcnNlY3Rpb25UeXBlQW5ub3RhdGlvbiIgfHwgbjIudHlwZSA9PT0gIlVuaW9uVHlwZUFubm90YXRpb24iIHx8IHIyID09PSAib2JqZWN0VHlwZSIgJiYgKG4yLnR5cGUgPT09ICJJbmRleGVkQWNjZXNzVHlwZSIgfHwgbjIudHlwZSA9PT0gIk9wdGlvbmFsSW5kZXhlZEFjY2Vzc1R5cGUiKTsKICAgICAgICAgICAgY2FzZSAiTnVsbGFibGVUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIG4yLnR5cGUgPT09ICJBcnJheVR5cGVBbm5vdGF0aW9uIiB8fCByMiA9PT0gIm9iamVjdFR5cGUiICYmIChuMi50eXBlID09PSAiSW5kZXhlZEFjY2Vzc1R5cGUiIHx8IG4yLnR5cGUgPT09ICJPcHRpb25hbEluZGV4ZWRBY2Nlc3NUeXBlIik7CiAgICAgICAgICAgIGNhc2UgIkZ1bmN0aW9uVHlwZUFubm90YXRpb24iOiB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSBuMi50eXBlID09PSAiTnVsbGFibGVUeXBlQW5ub3RhdGlvbiIgPyBlMi5nZXRQYXJlbnROb2RlKDEpIDogbjI7CiAgICAgICAgICAgICAgcmV0dXJuIHQzLnR5cGUgPT09ICJVbmlvblR5cGVBbm5vdGF0aW9uIiB8fCB0My50eXBlID09PSAiSW50ZXJzZWN0aW9uVHlwZUFubm90YXRpb24iIHx8IHQzLnR5cGUgPT09ICJBcnJheVR5cGVBbm5vdGF0aW9uIiB8fCByMiA9PT0gIm9iamVjdFR5cGUiICYmICh0My50eXBlID09PSAiSW5kZXhlZEFjY2Vzc1R5cGUiIHx8IHQzLnR5cGUgPT09ICJPcHRpb25hbEluZGV4ZWRBY2Nlc3NUeXBlIikgfHwgdDMudHlwZSA9PT0gIk51bGxhYmxlVHlwZUFubm90YXRpb24iIHx8IG4yLnR5cGUgPT09ICJGdW5jdGlvblR5cGVQYXJhbSIgJiYgbjIubmFtZSA9PT0gbnVsbCAmJiBmQShvMikuc29tZSgoZTMpID0+IGUzLnR5cGVBbm5vdGF0aW9uICYmIGUzLnR5cGVBbm5vdGF0aW9uLnR5cGUgPT09ICJOdWxsYWJsZVR5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiT3B0aW9uYWxJbmRleGVkQWNjZXNzVHlwZSI6CiAgICAgICAgICAgICAgcmV0dXJuIHIyID09PSAib2JqZWN0VHlwZSIgJiYgbjIudHlwZSA9PT0gIkluZGV4ZWRBY2Nlc3NUeXBlIjsKICAgICAgICAgICAgY2FzZSAiVHlwZW9mVHlwZUFubm90YXRpb24iOgogICAgICAgICAgICAgIHJldHVybiByMiA9PT0gIm9iamVjdFR5cGUiICYmIChuMi50eXBlID09PSAiSW5kZXhlZEFjY2Vzc1R5cGUiIHx8IG4yLnR5cGUgPT09ICJPcHRpb25hbEluZGV4ZWRBY2Nlc3NUeXBlIik7CiAgICAgICAgICAgIGNhc2UgIlN0cmluZ0xpdGVyYWwiOgogICAgICAgICAgICBjYXNlICJOdW1lcmljTGl0ZXJhbCI6CiAgICAgICAgICAgIGNhc2UgIkxpdGVyYWwiOgogICAgICAgICAgICAgIGlmICh0eXBlb2YgbzIudmFsdWUgPT0gInN0cmluZyIgJiYgbjIudHlwZSA9PT0gIkV4cHJlc3Npb25TdGF0ZW1lbnQiICYmICFuMi5kaXJlY3RpdmUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gZTIuZ2V0UGFyZW50Tm9kZSgxKTsKICAgICAgICAgICAgICAgIHJldHVybiB0My50eXBlID09PSAiUHJvZ3JhbSIgfHwgdDMudHlwZSA9PT0gIkJsb2NrU3RhdGVtZW50IjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHIyID09PSAib2JqZWN0IiAmJiBuMi50eXBlID09PSAiTWVtYmVyRXhwcmVzc2lvbiIgJiYgdHlwZW9mIG8yLnZhbHVlID09ICJudW1iZXIiOwogICAgICAgICAgICBjYXNlICJBc3NpZ25tZW50RXhwcmVzc2lvbiI6IHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IGUyLmdldFBhcmVudE5vZGUoMSk7CiAgICAgICAgICAgICAgcmV0dXJuIHIyID09PSAiYm9keSIgJiYgbjIudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiB8fCAocjIgIT09ICJrZXkiIHx8IG4yLnR5cGUgIT09ICJDbGFzc1Byb3BlcnR5IiAmJiBuMi50eXBlICE9PSAiUHJvcGVydHlEZWZpbml0aW9uIiB8fCAhbjIuY29tcHV0ZWQpICYmICgocjIgIT09ICJpbml0IiAmJiByMiAhPT0gInVwZGF0ZSIgfHwgbjIudHlwZSAhPT0gIkZvclN0YXRlbWVudCIpICYmIChuMi50eXBlID09PSAiRXhwcmVzc2lvblN0YXRlbWVudCIgPyBvMi5sZWZ0LnR5cGUgPT09ICJPYmplY3RQYXR0ZXJuIiA6IChyMiAhPT0gImtleSIgfHwgbjIudHlwZSAhPT0gIlRTUHJvcGVydHlTaWduYXR1cmUiKSAmJiAobjIudHlwZSAhPT0gIkFzc2lnbm1lbnRFeHByZXNzaW9uIiAmJiAoKG4yLnR5cGUgIT09ICJTZXF1ZW5jZUV4cHJlc3Npb24iIHx8ICF0MyB8fCB0My50eXBlICE9PSAiRm9yU3RhdGVtZW50IiB8fCB0My5pbml0ICE9PSBuMiAmJiB0My51cGRhdGUgIT09IG4yKSAmJiAoKHIyICE9PSAidmFsdWUiIHx8IG4yLnR5cGUgIT09ICJQcm9wZXJ0eSIgfHwgIXQzIHx8IHQzLnR5cGUgIT09ICJPYmplY3RQYXR0ZXJuIiB8fCAhdDMucHJvcGVydGllcy5pbmNsdWRlcyhuMikpICYmIG4yLnR5cGUgIT09ICJOR0NoYWluZWRFeHByZXNzaW9uIikpKSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgc3dpdGNoIChuMi50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiVW5hcnlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIlNwcmVhZEVsZW1lbnQiOgogICAgICAgICAgICAgICAgY2FzZSAiU3ByZWFkUHJvcGVydHkiOgogICAgICAgICAgICAgICAgY2FzZSAiQmluYXJ5RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJMb2dpY2FsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJOR1BpcGVFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIkV4cG9ydERlZmF1bHREZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJBd2FpdEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiSlNYU3ByZWFkQXR0cmlidXRlIjoKICAgICAgICAgICAgICAgIGNhc2UgIlRTVHlwZUFzc2VydGlvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJUeXBlQ2FzdEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiVFNBc0V4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiVFNOb25OdWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgY2FzZSAiTmV3RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJDYWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJPcHRpb25hbENhbGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHIyID09PSAiY2FsbGVlIjsKICAgICAgICAgICAgICAgIGNhc2UgIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIHJldHVybiByMiA9PT0gInRlc3QiOwogICAgICAgICAgICAgICAgY2FzZSAiTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJPcHRpb25hbE1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICByZXR1cm4gcjIgPT09ICJvYmplY3QiOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiRnVuY3Rpb25FeHByZXNzaW9uIjoKICAgICAgICAgICAgICBzd2l0Y2ggKG4yLnR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgIk5ld0V4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiQ2FsbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiT3B0aW9uYWxDYWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIHJldHVybiByMiA9PT0gImNhbGxlZSI7CiAgICAgICAgICAgICAgICBjYXNlICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIjoKICAgICAgICAgICAgICBzd2l0Y2ggKG4yLnR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgIkJpbmFyeUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICByZXR1cm4gbjIub3BlcmF0b3IgIT09ICJ8PiIgfHwgbzIuZXh0cmEgJiYgbzIuZXh0cmEucGFyZW50aGVzaXplZDsKICAgICAgICAgICAgICAgIGNhc2UgIk5ld0V4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiQ2FsbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiT3B0aW9uYWxDYWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIHJldHVybiByMiA9PT0gImNhbGxlZSI7CiAgICAgICAgICAgICAgICBjYXNlICJNZW1iZXJFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIk9wdGlvbmFsTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIHJldHVybiByMiA9PT0gIm9iamVjdCI7CiAgICAgICAgICAgICAgICBjYXNlICJUU0FzRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJUU05vbk51bGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIkJpbmRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIlRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJVbmFyeUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiTG9naWNhbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgY2FzZSAiQXdhaXRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIlRTVHlwZUFzc2VydGlvbiI6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgY2FzZSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHIyID09PSAidGVzdCI7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJDbGFzc0V4cHJlc3Npb24iOgogICAgICAgICAgICAgIHJldHVybiBuMi50eXBlID09PSAiTmV3RXhwcmVzc2lvbiIgJiYgcjIgPT09ICJjYWxsZWUiOwogICAgICAgICAgICBjYXNlICJPcHRpb25hbE1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICBjYXNlICJPcHRpb25hbENhbGxFeHByZXNzaW9uIjogewogICAgICAgICAgICAgIGNvbnN0IHQzID0gZTIuZ2V0UGFyZW50Tm9kZSgxKTsKICAgICAgICAgICAgICBpZiAocjIgPT09ICJvYmplY3QiICYmIG4yLnR5cGUgPT09ICJNZW1iZXJFeHByZXNzaW9uIiB8fCByMiA9PT0gImNhbGxlZSIgJiYgKG4yLnR5cGUgPT09ICJDYWxsRXhwcmVzc2lvbiIgfHwgbjIudHlwZSA9PT0gIk5ld0V4cHJlc3Npb24iKSB8fCBuMi50eXBlID09PSAiVFNOb25OdWxsRXhwcmVzc2lvbiIgJiYgdDMudHlwZSA9PT0gIk1lbWJlckV4cHJlc3Npb24iICYmIHQzLm9iamVjdCA9PT0gbjIpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJDYWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgIGNhc2UgIk1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICBjYXNlICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iOgogICAgICAgICAgICBjYXNlICJUU05vbk51bGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBpZiAocjIgPT09ICJjYWxsZWUiICYmIChuMi50eXBlID09PSAiQmluZEV4cHJlc3Npb24iIHx8IG4yLnR5cGUgPT09ICJOZXdFeHByZXNzaW9uIikpIHsKICAgICAgICAgICAgICAgIGxldCBlMyA9IG8yOwogICAgICAgICAgICAgICAgZm9yICg7IGUzOyApCiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZTMudHlwZSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgIkNhbGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgICBjYXNlICJPcHRpb25hbENhbGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIk1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICAgIGNhc2UgIk9wdGlvbmFsTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiQmluZEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICAgICAgZTMgPSBlMy5vYmplY3Q7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICAgICAgZTMgPSBlMy50YWc7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJUU05vbk51bGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgICAgIGUzID0gZTMuZXhwcmVzc2lvbjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjYXNlICJCaW5kRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHIyID09PSAiY2FsbGVlIiAmJiAobjIudHlwZSA9PT0gIkJpbmRFeHByZXNzaW9uIiB8fCBuMi50eXBlID09PSAiTmV3RXhwcmVzc2lvbiIpIHx8IHIyID09PSAib2JqZWN0IiAmJiB2QShuMik7CiAgICAgICAgICAgIGNhc2UgIk5HUGlwZUV4cHJlc3Npb24iOgogICAgICAgICAgICAgIHJldHVybiAhKG4yLnR5cGUgPT09ICJOR1Jvb3QiIHx8IG4yLnR5cGUgPT09ICJOR01pY3Jvc3ludGF4RXhwcmVzc2lvbiIgfHwgbjIudHlwZSA9PT0gIk9iamVjdFByb3BlcnR5IiAmJiAoIW8yLmV4dHJhIHx8ICFvMi5leHRyYS5wYXJlbnRoZXNpemVkKSB8fCBuMi50eXBlID09PSAiQXJyYXlFeHByZXNzaW9uIiB8fCBiQShuMikgJiYgbjIuYXJndW1lbnRzW3IyXSA9PT0gbzIgfHwgcjIgPT09ICJyaWdodCIgJiYgbjIudHlwZSA9PT0gIk5HUGlwZUV4cHJlc3Npb24iIHx8IHIyID09PSAicHJvcGVydHkiICYmIG4yLnR5cGUgPT09ICJNZW1iZXJFeHByZXNzaW9uIiB8fCBuMi50eXBlID09PSAiQXNzaWdubWVudEV4cHJlc3Npb24iKTsKICAgICAgICAgICAgY2FzZSAiSlNYRnJhZ21lbnQiOgogICAgICAgICAgICBjYXNlICJKU1hFbGVtZW50IjoKICAgICAgICAgICAgICByZXR1cm4gcjIgPT09ICJjYWxsZWUiIHx8IHIyID09PSAibGVmdCIgJiYgbjIudHlwZSA9PT0gIkJpbmFyeUV4cHJlc3Npb24iICYmIG4yLm9wZXJhdG9yID09PSAiPCIgfHwgbjIudHlwZSAhPT0gIkFycmF5RXhwcmVzc2lvbiIgJiYgbjIudHlwZSAhPT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiAmJiBuMi50eXBlICE9PSAiQXNzaWdubWVudEV4cHJlc3Npb24iICYmIG4yLnR5cGUgIT09ICJBc3NpZ25tZW50UGF0dGVybiIgJiYgbjIudHlwZSAhPT0gIkJpbmFyeUV4cHJlc3Npb24iICYmIG4yLnR5cGUgIT09ICJOZXdFeHByZXNzaW9uIiAmJiBuMi50eXBlICE9PSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIiAmJiBuMi50eXBlICE9PSAiRXhwcmVzc2lvblN0YXRlbWVudCIgJiYgbjIudHlwZSAhPT0gIkpzRXhwcmVzc2lvblJvb3QiICYmIG4yLnR5cGUgIT09ICJKU1hBdHRyaWJ1dGUiICYmIG4yLnR5cGUgIT09ICJKU1hFbGVtZW50IiAmJiBuMi50eXBlICE9PSAiSlNYRXhwcmVzc2lvbkNvbnRhaW5lciIgJiYgbjIudHlwZSAhPT0gIkpTWEZyYWdtZW50IiAmJiBuMi50eXBlICE9PSAiTG9naWNhbEV4cHJlc3Npb24iICYmICFiQShuMikgJiYgIUFBKG4yKSAmJiBuMi50eXBlICE9PSAiUmV0dXJuU3RhdGVtZW50IiAmJiBuMi50eXBlICE9PSAiVGhyb3dTdGF0ZW1lbnQiICYmIG4yLnR5cGUgIT09ICJUeXBlQ2FzdEV4cHJlc3Npb24iICYmIG4yLnR5cGUgIT09ICJWYXJpYWJsZURlY2xhcmF0b3IiICYmIG4yLnR5cGUgIT09ICJZaWVsZEV4cHJlc3Npb24iOwogICAgICAgICAgICBjYXNlICJUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHIyID09PSAicmV0dXJuVHlwZSIgJiYgbjIudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiAmJiBmdW5jdGlvbihlMykgewogICAgICAgICAgICAgICAgcmV0dXJuIG1BKGUzLCAoZTQpID0+IGU0LnR5cGUgPT09ICJPYmplY3RUeXBlQW5ub3RhdGlvbiIgJiYgbUEoZTQsIChlNSkgPT4gZTUudHlwZSA9PT0gIkZ1bmN0aW9uVHlwZUFubm90YXRpb24iIHx8IHZvaWQgMCkgfHwgdm9pZCAwKTsKICAgICAgICAgICAgICB9KG8yKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24geEEoZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTIuZ2V0VmFsdWUoKSwgbjIgPSBlMi5nZXRQYXJlbnROb2RlKCksIHIyID0gZTIuZ2V0TmFtZSgpOwogICAgICAgICAgc3dpdGNoIChuMi50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgIk5HUGlwZUV4cHJlc3Npb24iOgogICAgICAgICAgICAgIGlmICh0eXBlb2YgcjIgPT0gIm51bWJlciIgJiYgbjIuYXJndW1lbnRzW3IyXSA9PT0gdDIgJiYgbjIuYXJndW1lbnRzLmxlbmd0aCAtIDEgPT09IHIyKQogICAgICAgICAgICAgICAgcmV0dXJuIGUyLmNhbGxQYXJlbnQoeEEpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJPYmplY3RQcm9wZXJ0eSI6CiAgICAgICAgICAgICAgaWYgKHIyID09PSAidmFsdWUiKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IGUyLmdldFBhcmVudE5vZGUoMSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcEEodDMucHJvcGVydGllcykgPT09IG4yOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiQmluYXJ5RXhwcmVzc2lvbiI6CiAgICAgICAgICAgIGNhc2UgIkxvZ2ljYWxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBpZiAocjIgPT09ICJyaWdodCIpCiAgICAgICAgICAgICAgICByZXR1cm4gZTIuY2FsbFBhcmVudCh4QSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgaWYgKHIyID09PSAiYWx0ZXJuYXRlIikKICAgICAgICAgICAgICAgIHJldHVybiBlMi5jYWxsUGFyZW50KHhBKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiVW5hcnlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBpZiAobjIucHJlZml4KQogICAgICAgICAgICAgICAgcmV0dXJuIGUyLmNhbGxQYXJlbnQoeEEpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBTQShlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gZTIuZ2V0VmFsdWUoKSwgcjIgPSBlMi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICByZXR1cm4gbjIudHlwZSA9PT0gIkZ1bmN0aW9uRXhwcmVzc2lvbiIgfHwgbjIudHlwZSA9PT0gIkNsYXNzRXhwcmVzc2lvbiIgPyByMi50eXBlID09PSAiRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uIiB8fCAhRkEoZTIsIHQyKSA6ICEoIWdBKG4yKSB8fCByMi50eXBlICE9PSAiRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uIiAmJiBGQShlMiwgdDIpKSAmJiBlMi5jYWxsKChlMykgPT4gU0EoZTMsIHQyKSwgLi4uZEEoZTIsIG4yKSk7CiAgICAgICAgfQogICAgICAgIHZhciB3QSA9IEZBOwogICAgICAgIHZhciBUQSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgc3dpdGNoICh0Mi5wYXJzZXIpIHsKICAgICAgICAgICAgY2FzZSAianNvbiI6CiAgICAgICAgICAgIGNhc2UgImpzb241IjoKICAgICAgICAgICAgY2FzZSAianNvbi1zdHJpbmdpZnkiOgogICAgICAgICAgICBjYXNlICJfX2pzX2V4cHJlc3Npb24iOgogICAgICAgICAgICBjYXNlICJfX3Z1ZV9leHByZXNzaW9uIjoKICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlMiksIHt9LCB7IHR5cGU6IHQyLnBhcnNlci5zdGFydHNXaXRoKCJfXyIpID8gIkpzRXhwcmVzc2lvblJvb3QiIDogIkpzb25Sb290Iiwgbm9kZTogZTIsIGNvbW1lbnRzOiBbXSwgcm9vdE1hcmtlcjogdDIucm9vdE1hcmtlciB9KTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IGpvaW46IEJBLCBsaW5lOiBOQSwgZ3JvdXA6IGtBLCBzb2Z0bGluZTogUEEsIGluZGVudDogT0EgfSB9ID0gWmM7CiAgICAgICAgdmFyIElBID0geyBpc1Z1ZUV2ZW50QmluZGluZ0V4cHJlc3Npb246IGZ1bmN0aW9uIGUyKHQyKSB7CiAgICAgICAgICBzd2l0Y2ggKHQyLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgc3dpdGNoICh0Mi5wcm9wZXJ0eS50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJJZGVudGlmaWVyIjoKICAgICAgICAgICAgICAgIGNhc2UgIk51bWVyaWNMaXRlcmFsIjoKICAgICAgICAgICAgICAgIGNhc2UgIlN0cmluZ0xpdGVyYWwiOgogICAgICAgICAgICAgICAgICByZXR1cm4gZTIodDIub2JqZWN0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjYXNlICJJZGVudGlmaWVyIjoKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSwgcHJpbnRIdG1sQmluZGluZzogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgaWYgKHQyLl9fb25IdG1sQmluZGluZ1Jvb3QgJiYgZTIuZ2V0TmFtZSgpID09PSBudWxsICYmIHQyLl9fb25IdG1sQmluZGluZ1Jvb3QocjIsIHQyKSwgcjIudHlwZSA9PT0gIkZpbGUiKQogICAgICAgICAgICByZXR1cm4gdDIuX19pc1Z1ZUZvckJpbmRpbmdMZWZ0ID8gZTIuY2FsbCgoZTMpID0+IHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IEJBKFsiLCIsIE5BXSwgZTMubWFwKG4yLCAicGFyYW1zIikpLCB7IHBhcmFtczogcjMgfSA9IGUzLmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgcmV0dXJuIHIzLmxlbmd0aCA9PT0gMSA/IHQzIDogWyIoIiwgT0EoW1BBLCBrQSh0MyldKSwgUEEsICIpIl07CiAgICAgICAgICAgIH0sICJwcm9ncmFtIiwgImJvZHkiLCAwKSA6IHQyLl9faXNWdWVCaW5kaW5ncyA/IGUyLmNhbGwoKGUzKSA9PiBCQShbIiwiLCBOQV0sIGUzLm1hcChuMiwgInBhcmFtcyIpKSwgInByb2dyYW0iLCAiYm9keSIsIDApIDogdm9pZCAwOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IHByaW50Q29tbWVudHM6IExBIH0gPSB0RCwgeyBnZXRMYXN0OiBqQSB9ID0gZGMsIHsgYnVpbGRlcnM6IHsgam9pbjogX0EsIGxpbmU6IE1BLCBzb2Z0bGluZTogUkEsIGdyb3VwOiBWQSwgaW5kZW50OiAkQSwgYWxpZ246IFdBLCBpZkJyZWFrOiBxQSwgaW5kZW50SWZCcmVhazogVUEgfSwgdXRpbHM6IHsgY2xlYW5Eb2M6IHpBLCBnZXREb2NQYXJ0czogR0EsIGlzQ29uY2F0OiBIQSB9IH0gPSBaYywgeyBoYXNMZWFkaW5nT3duTGluZUNvbW1lbnQ6IEpBLCBpc0JpbmFyeWlzaDogWEEsIGlzSnN4Tm9kZTogWUEsIHNob3VsZEZsYXR0ZW46IEtBLCBoYXNDb21tZW50OiBRQSwgQ29tbWVudENoZWNrRmxhZ3M6IFpBLCBpc0NhbGxFeHByZXNzaW9uOiBlRiwgaXNNZW1iZXJFeHByZXNzaW9uOiB0RiwgaXNPYmplY3RQcm9wZXJ0eTogbkYsIGlzRW5hYmxlZEhhY2tQaXBlbGluZTogckYgfSA9IENDOwogICAgICAgIGxldCBvRiA9IDA7CiAgICAgICAgZnVuY3Rpb24gaUYoZTIsIHQyLCBuMiwgcjIsIG8yKSB7CiAgICAgICAgICBjb25zdCBpMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBpZiAoIVhBKGkyKSkKICAgICAgICAgICAgcmV0dXJuIFtWQSh0MigpKV07CiAgICAgICAgICBsZXQgdTIgPSBbXTsKICAgICAgICAgIEtBKGkyLm9wZXJhdG9yLCBpMi5sZWZ0Lm9wZXJhdG9yKSA/IHUyID0gZTIuY2FsbCgoZTMpID0+IGlGKGUzLCB0MiwgbjIsIHRydWUsIG8yKSwgImxlZnQiKSA6IHUyLnB1c2goVkEodDIoImxlZnQiKSkpOwogICAgICAgICAgY29uc3QgczIgPSB1RihpMiksIGEyID0gKGkyLm9wZXJhdG9yID09PSAifD4iIHx8IGkyLnR5cGUgPT09ICJOR1BpcGVFeHByZXNzaW9uIiB8fCBpMi5vcGVyYXRvciA9PT0gInwiICYmIG4yLnBhcnNlciA9PT0gIl9fdnVlX2V4cHJlc3Npb24iKSAmJiAhSkEobjIub3JpZ2luYWxUZXh0LCBpMi5yaWdodCksIGMyID0gaTIudHlwZSA9PT0gIk5HUGlwZUV4cHJlc3Npb24iID8gInwiIDogaTIub3BlcmF0b3IsIGwyID0gaTIudHlwZSA9PT0gIk5HUGlwZUV4cHJlc3Npb24iICYmIGkyLmFyZ3VtZW50cy5sZW5ndGggPiAwID8gVkEoJEEoW1JBLCAiOiAiLCBfQShbUkEsICI6IiwgcUEoIiAiKV0sIGUyLm1hcCh0MiwgImFyZ3VtZW50cyIpLm1hcCgoZTMpID0+IFdBKDIsIFZBKGUzKSkpKV0pKSA6ICIiOwogICAgICAgICAgbGV0IHAyOwogICAgICAgICAgaWYgKHMyKQogICAgICAgICAgICBwMiA9IFtjMiwgIiAiLCB0MigicmlnaHQiKSwgbDJdOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHIzID0gckYobjIpICYmIGMyID09PSAifD4iID8gZTIuY2FsbCgoZTMpID0+IGlGKGUzLCB0MiwgbjIsIHRydWUsIG8yKSwgInJpZ2h0IikgOiB0MigicmlnaHQiKTsKICAgICAgICAgICAgcDIgPSBbYTIgPyBNQSA6ICIiLCBjMiwgYTIgPyAiICIgOiBNQSwgcjMsIGwyXTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGYyID0gZTIuZ2V0UGFyZW50Tm9kZSgpLCBkMiA9IFFBKGkyLmxlZnQsIFpBLlRyYWlsaW5nIHwgWkEuTGluZSksIGgyID0gZDIgfHwgIShvMiAmJiBpMi50eXBlID09PSAiTG9naWNhbEV4cHJlc3Npb24iKSAmJiBmMi50eXBlICE9PSBpMi50eXBlICYmIGkyLmxlZnQudHlwZSAhPT0gaTIudHlwZSAmJiBpMi5yaWdodC50eXBlICE9PSBpMi50eXBlOwogICAgICAgICAgaWYgKHUyLnB1c2goYTIgPyAiIiA6ICIgIiwgaDIgPyBWQShwMiwgeyBzaG91bGRCcmVhazogZDIgfSkgOiBwMiksIHIyICYmIFFBKGkyKSkgewogICAgICAgICAgICBjb25zdCB0MyA9IHpBKExBKGUyLCB1MiwgbjIpKTsKICAgICAgICAgICAgcmV0dXJuIEhBKHQzKSB8fCB0My50eXBlID09PSAiZmlsbCIgPyBHQSh0MykgOiBbdDNdOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB1RihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJMb2dpY2FsRXhwcmVzc2lvbiIgJiYgKGUyLnJpZ2h0LnR5cGUgPT09ICJPYmplY3RFeHByZXNzaW9uIiAmJiBlMi5yaWdodC5wcm9wZXJ0aWVzLmxlbmd0aCA+IDAgfHwgKGUyLnJpZ2h0LnR5cGUgPT09ICJBcnJheUV4cHJlc3Npb24iICYmIGUyLnJpZ2h0LmVsZW1lbnRzLmxlbmd0aCA+IDAgfHwgISFZQShlMi5yaWdodCkpKTsKICAgICAgICB9CiAgICAgICAgdmFyIHNGID0geyBwcmludEJpbmFyeWlzaEV4cHJlc3Npb246IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKSwgbzIgPSBlMi5nZXRQYXJlbnROb2RlKCksIGkyID0gZTIuZ2V0UGFyZW50Tm9kZSgxKSwgdTIgPSByMiAhPT0gbzIuYm9keSAmJiAobzIudHlwZSA9PT0gIklmU3RhdGVtZW50IiB8fCBvMi50eXBlID09PSAiV2hpbGVTdGF0ZW1lbnQiIHx8IG8yLnR5cGUgPT09ICJTd2l0Y2hTdGF0ZW1lbnQiIHx8IG8yLnR5cGUgPT09ICJEb1doaWxlU3RhdGVtZW50IiksIHMyID0gckYodDIpICYmIHIyLm9wZXJhdG9yID09PSAifD4iLCBhMiA9IGlGKGUyLCBuMiwgdDIsIGZhbHNlLCB1Mik7CiAgICAgICAgICBpZiAodTIpCiAgICAgICAgICAgIHJldHVybiBhMjsKICAgICAgICAgIGlmIChzMikKICAgICAgICAgICAgcmV0dXJuIFZBKGEyKTsKICAgICAgICAgIGlmIChlRihvMikgJiYgbzIuY2FsbGVlID09PSByMiB8fCBvMi50eXBlID09PSAiVW5hcnlFeHByZXNzaW9uIiB8fCB0RihvMikgJiYgIW8yLmNvbXB1dGVkKQogICAgICAgICAgICByZXR1cm4gVkEoWyRBKFtSQSwgLi4uYTJdKSwgUkFdKTsKICAgICAgICAgIGNvbnN0IGMyID0gbzIudHlwZSA9PT0gIlJldHVyblN0YXRlbWVudCIgfHwgbzIudHlwZSA9PT0gIlRocm93U3RhdGVtZW50IiB8fCBvMi50eXBlID09PSAiSlNYRXhwcmVzc2lvbkNvbnRhaW5lciIgJiYgaTIudHlwZSA9PT0gIkpTWEF0dHJpYnV0ZSIgfHwgcjIub3BlcmF0b3IgIT09ICJ8IiAmJiBvMi50eXBlID09PSAiSnNFeHByZXNzaW9uUm9vdCIgfHwgcjIudHlwZSAhPT0gIk5HUGlwZUV4cHJlc3Npb24iICYmIChvMi50eXBlID09PSAiTkdSb290IiAmJiB0Mi5wYXJzZXIgPT09ICJfX25nX2JpbmRpbmciIHx8IG8yLnR5cGUgPT09ICJOR01pY3Jvc3ludGF4RXhwcmVzc2lvbiIgJiYgaTIudHlwZSA9PT0gIk5HTWljcm9zeW50YXgiICYmIGkyLmJvZHkubGVuZ3RoID09PSAxKSB8fCByMiA9PT0gbzIuYm9keSAmJiBvMi50eXBlID09PSAiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iIHx8IHIyICE9PSBvMi5ib2R5ICYmIG8yLnR5cGUgPT09ICJGb3JTdGF0ZW1lbnQiIHx8IG8yLnR5cGUgPT09ICJDb25kaXRpb25hbEV4cHJlc3Npb24iICYmIGkyLnR5cGUgIT09ICJSZXR1cm5TdGF0ZW1lbnQiICYmIGkyLnR5cGUgIT09ICJUaHJvd1N0YXRlbWVudCIgJiYgIWVGKGkyKSB8fCBvMi50eXBlID09PSAiVGVtcGxhdGVMaXRlcmFsIiwgbDIgPSBvMi50eXBlID09PSAiQXNzaWdubWVudEV4cHJlc3Npb24iIHx8IG8yLnR5cGUgPT09ICJWYXJpYWJsZURlY2xhcmF0b3IiIHx8IG8yLnR5cGUgPT09ICJDbGFzc1Byb3BlcnR5IiB8fCBvMi50eXBlID09PSAiUHJvcGVydHlEZWZpbml0aW9uIiB8fCBvMi50eXBlID09PSAiVFNBYnN0cmFjdFByb3BlcnR5RGVmaW5pdGlvbiIgfHwgbzIudHlwZSA9PT0gIkNsYXNzUHJpdmF0ZVByb3BlcnR5IiB8fCBuRihvMiksIHAyID0gWEEocjIubGVmdCkgJiYgS0EocjIub3BlcmF0b3IsIHIyLmxlZnQub3BlcmF0b3IpOwogICAgICAgICAgaWYgKGMyIHx8IHVGKHIyKSAmJiAhcDIgfHwgIXVGKHIyKSAmJiBsMikKICAgICAgICAgICAgcmV0dXJuIFZBKGEyKTsKICAgICAgICAgIGlmIChhMi5sZW5ndGggPT09IDApCiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgIGNvbnN0IGYyID0gWUEocjIucmlnaHQpLCBkMiA9IGEyLmZpbmRJbmRleCgoZTMpID0+IHR5cGVvZiBlMyAhPSAic3RyaW5nIiAmJiAhQXJyYXkuaXNBcnJheShlMykgJiYgZTMudHlwZSA9PT0gImdyb3VwIiksIGgyID0gYTIuc2xpY2UoMCwgZDIgPT09IC0xID8gMSA6IGQyICsgMSksIGcyID0gYTIuc2xpY2UoaDIubGVuZ3RoLCBmMiA/IC0xIDogdm9pZCAwKSwgbTIgPSBTeW1ib2woImxvZ2ljYWxDaGFpbi0iICsgKytvRiksIHkyID0gVkEoWy4uLmgyLCAkQShnMildLCB7IGlkOiBtMiB9KTsKICAgICAgICAgIGlmICghZjIpCiAgICAgICAgICAgIHJldHVybiB5MjsKICAgICAgICAgIGNvbnN0IEQyID0gakEoYTIpOwogICAgICAgICAgcmV0dXJuIFZBKFt5MiwgVUEoRDIsIHsgZ3JvdXBJZDogbTIgfSldKTsKICAgICAgICB9LCBzaG91bGRJbmxpbmVMb2dpY2FsRXhwcmVzc2lvbjogdUYgfTsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IGpvaW46IGFGLCBsaW5lOiBjRiwgZ3JvdXA6IGxGIH0gfSA9IFpjLCB7IGhhc05vZGU6IHBGLCBoYXNDb21tZW50OiBmRiwgZ2V0Q29tbWVudHM6IGRGIH0gPSBDQywgeyBwcmludEJpbmFyeWlzaEV4cHJlc3Npb246IGhGIH0gPSBzRjsKICAgICAgICBmdW5jdGlvbiBnRihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gIk5HTWljcm9zeW50YXhLZXllZEV4cHJlc3Npb24iICYmIGUyLmtleS5uYW1lID09PSAib2YiICYmIHQyID09PSAxICYmIG4yLmJvZHlbMF0udHlwZSA9PT0gIk5HTWljcm9zeW50YXhMZXQiICYmIG4yLmJvZHlbMF0udmFsdWUgPT09IG51bGw7CiAgICAgICAgfQogICAgICAgIHZhciBtRiA9IHsgcHJpbnRBbmd1bGFyOiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBpZiAocjIudHlwZS5zdGFydHNXaXRoKCJORyIpKQogICAgICAgICAgICBzd2l0Y2ggKHIyLnR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICJOR1Jvb3QiOgogICAgICAgICAgICAgICAgcmV0dXJuIFtuMigibm9kZSIpLCBmRihyMi5ub2RlKSA/ICIgLy8iICsgZEYocjIubm9kZSlbMF0udmFsdWUudHJpbUVuZCgpIDogIiJdOwogICAgICAgICAgICAgIGNhc2UgIk5HUGlwZUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIGhGKGUyLCB0MiwgbjIpOwogICAgICAgICAgICAgIGNhc2UgIk5HQ2hhaW5lZEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIGxGKGFGKFsiOyIsIGNGXSwgZTIubWFwKChlMykgPT4gZnVuY3Rpb24oZTQpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHBGKGU0LmdldFZhbHVlKCksIChlNSkgPT4gewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZTUudHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgY2FzZSB2b2lkIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIkNhbGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIk9wdGlvbmFsQ2FsbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiQXNzaWdubWVudEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfShlMykgPyBuMigpIDogWyIoIiwgbjIoKSwgIikiXSwgImV4cHJlc3Npb25zIikpKTsKICAgICAgICAgICAgICBjYXNlICJOR0VtcHR5RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgICAgY2FzZSAiTkdRdW90ZWRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiBbcjIucHJlZml4LCAiOiAiLCByMi52YWx1ZS50cmltKCldOwogICAgICAgICAgICAgIGNhc2UgIk5HTWljcm9zeW50YXgiOgogICAgICAgICAgICAgICAgcmV0dXJuIGUyLm1hcCgoZTMsIHQzKSA9PiBbdDMgPT09IDAgPyAiIiA6IGdGKGUzLmdldFZhbHVlKCksIHQzLCByMikgPyAiICIgOiBbIjsiLCBjRl0sIG4yKCldLCAiYm9keSIpOwogICAgICAgICAgICAgIGNhc2UgIk5HTWljcm9zeW50YXhLZXkiOgogICAgICAgICAgICAgICAgcmV0dXJuIC9eWyRfYS16XVtcdyRdKig/Oi1bJF9hLXpdW1x3JF0pKiQvaS50ZXN0KHIyLm5hbWUpID8gcjIubmFtZSA6IEpTT04uc3RyaW5naWZ5KHIyLm5hbWUpOwogICAgICAgICAgICAgIGNhc2UgIk5HTWljcm9zeW50YXhFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiBbbjIoImV4cHJlc3Npb24iKSwgcjIuYWxpYXMgPT09IG51bGwgPyAiIiA6IFsiIGFzICIsIG4yKCJhbGlhcyIpXV07CiAgICAgICAgICAgICAgY2FzZSAiTkdNaWNyb3N5bnRheEtleWVkRXhwcmVzc2lvbiI6IHsKICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gZTIuZ2V0TmFtZSgpLCBvMiA9IGUyLmdldFBhcmVudE5vZGUoKSwgaTIgPSBnRihyMiwgdDMsIG8yKSB8fCAodDMgPT09IDEgJiYgKHIyLmtleS5uYW1lID09PSAidGhlbiIgfHwgcjIua2V5Lm5hbWUgPT09ICJlbHNlIikgfHwgdDMgPT09IDIgJiYgcjIua2V5Lm5hbWUgPT09ICJlbHNlIiAmJiBvMi5ib2R5W3QzIC0gMV0udHlwZSA9PT0gIk5HTWljcm9zeW50YXhLZXllZEV4cHJlc3Npb24iICYmIG8yLmJvZHlbdDMgLSAxXS5rZXkubmFtZSA9PT0gInRoZW4iKSAmJiBvMi5ib2R5WzBdLnR5cGUgPT09ICJOR01pY3Jvc3ludGF4RXhwcmVzc2lvbiI7CiAgICAgICAgICAgICAgICByZXR1cm4gW24yKCJrZXkiKSwgaTIgPyAiICIgOiAiOiAiLCBuMigiZXhwcmVzc2lvbiIpXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY2FzZSAiTkdNaWNyb3N5bnRheExldCI6CiAgICAgICAgICAgICAgICByZXR1cm4gWyJsZXQgIiwgbjIoImtleSIpLCByMi52YWx1ZSA9PT0gbnVsbCA/ICIiIDogWyIgPSAiLCBuMigidmFsdWUiKV1dOwogICAgICAgICAgICAgIGNhc2UgIk5HTWljcm9zeW50YXhBcyI6CiAgICAgICAgICAgICAgICByZXR1cm4gW24yKCJrZXkiKSwgIiBhcyAiLCBuMigiYWxpYXMiKV07CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBBbmd1bGFyIG5vZGUgdHlwZTogIi5jb25jYXQoSlNPTi5zdHJpbmdpZnkocjIudHlwZSksICIuIikpOwogICAgICAgICAgICB9CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IHsgcHJpbnRDb21tZW50czogeUYsIHByaW50RGFuZ2xpbmdDb21tZW50czogREYgfSA9IHRELCB7IGJ1aWxkZXJzOiB7IGxpbmU6IEVGLCBoYXJkbGluZTogQ0YsIHNvZnRsaW5lOiBiRiwgZ3JvdXA6IHZGLCBpbmRlbnQ6IEFGLCBjb25kaXRpb25hbEdyb3VwOiBGRiwgZmlsbDogeEYsIGlmQnJlYWs6IFNGLCBsaW5lU3VmZml4Qm91bmRhcnk6IHdGLCBqb2luOiBURiB9LCB1dGlsczogeyB3aWxsQnJlYWs6IEJGIH0gfSA9IFpjLCB7IGdldExhc3Q6IE5GLCBnZXRQcmVmZXJyZWRRdW90ZToga0YgfSA9IGRjLCB7IGlzSnN4Tm9kZTogUEYsIHJhd1RleHQ6IE9GLCBpc0xpdGVyYWw6IElGLCBpc0NhbGxFeHByZXNzaW9uOiBMRiwgaXNTdHJpbmdMaXRlcmFsOiBqRiwgaXNCaW5hcnlpc2g6IF9GLCBoYXNDb21tZW50OiBNRiwgQ29tbWVudENoZWNrRmxhZ3M6IFJGLCBoYXNOb2RlSWdub3JlQ29tbWVudDogVkYgfSA9IENDLCAkRiA9IHdBLCB7IHdpbGxQcmludE93bkNvbW1lbnRzOiBXRiB9ID0gbEEsIHFGID0gKGUyKSA9PiBlMiA9PT0gIiIgfHwgZTIgPT09IEVGIHx8IGUyID09PSBDRiB8fCBlMiA9PT0gYkY7CiAgICAgICAgZnVuY3Rpb24gVUYoZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgaWYgKHIyLnR5cGUgPT09ICJKU1hFbGVtZW50IiAmJiBmdW5jdGlvbihlMykgewogICAgICAgICAgICBpZiAoZTMuY2hpbGRyZW4ubGVuZ3RoID09PSAwKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoZTMuY2hpbGRyZW4ubGVuZ3RoID4gMSkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHQzID0gZTMuY2hpbGRyZW5bMF07CiAgICAgICAgICAgIHJldHVybiBJRih0MykgJiYgIVFGKHQzKTsKICAgICAgICAgIH0ocjIpKQogICAgICAgICAgICByZXR1cm4gW24yKCJvcGVuaW5nRWxlbWVudCIpLCBuMigiY2xvc2luZ0VsZW1lbnQiKV07CiAgICAgICAgICBjb25zdCBvMiA9IHIyLnR5cGUgPT09ICJKU1hFbGVtZW50IiA/IG4yKCJvcGVuaW5nRWxlbWVudCIpIDogbjIoIm9wZW5pbmdGcmFnbWVudCIpLCBpMiA9IHIyLnR5cGUgPT09ICJKU1hFbGVtZW50IiA/IG4yKCJjbG9zaW5nRWxlbWVudCIpIDogbjIoImNsb3NpbmdGcmFnbWVudCIpOwogICAgICAgICAgaWYgKHIyLmNoaWxkcmVuLmxlbmd0aCA9PT0gMSAmJiByMi5jaGlsZHJlblswXS50eXBlID09PSAiSlNYRXhwcmVzc2lvbkNvbnRhaW5lciIgJiYgKHIyLmNoaWxkcmVuWzBdLmV4cHJlc3Npb24udHlwZSA9PT0gIlRlbXBsYXRlTGl0ZXJhbCIgfHwgcjIuY2hpbGRyZW5bMF0uZXhwcmVzc2lvbi50eXBlID09PSAiVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uIikpCiAgICAgICAgICAgIHJldHVybiBbbzIsIC4uLmUyLm1hcChuMiwgImNoaWxkcmVuIiksIGkyXTsKICAgICAgICAgIHIyLmNoaWxkcmVuID0gcjIuY2hpbGRyZW4ubWFwKChlMykgPT4gZnVuY3Rpb24oZTQpIHsKICAgICAgICAgICAgcmV0dXJuIGU0LnR5cGUgPT09ICJKU1hFeHByZXNzaW9uQ29udGFpbmVyIiAmJiBJRihlNC5leHByZXNzaW9uKSAmJiBlNC5leHByZXNzaW9uLnZhbHVlID09PSAiICIgJiYgIU1GKGU0LmV4cHJlc3Npb24pOwogICAgICAgICAgfShlMykgPyB7IHR5cGU6ICJKU1hUZXh0IiwgdmFsdWU6ICIgIiwgcmF3OiAiICIgfSA6IGUzKTsKICAgICAgICAgIGNvbnN0IHUyID0gcjIuY2hpbGRyZW4uc29tZShQRiksIHMyID0gcjIuY2hpbGRyZW4uZmlsdGVyKChlMykgPT4gZTMudHlwZSA9PT0gIkpTWEV4cHJlc3Npb25Db250YWluZXIiKS5sZW5ndGggPiAxLCBhMiA9IHIyLnR5cGUgPT09ICJKU1hFbGVtZW50IiAmJiByMi5vcGVuaW5nRWxlbWVudC5hdHRyaWJ1dGVzLmxlbmd0aCA+IDE7CiAgICAgICAgICBsZXQgYzIgPSBCRihvMikgfHwgdTIgfHwgYTIgfHwgczI7CiAgICAgICAgICBjb25zdCBsMiA9IGUyLmdldFBhcmVudE5vZGUoKS5yb290TWFya2VyID09PSAibWR4IiwgcDIgPSB0Mi5zaW5nbGVRdW90ZSA/ICJ7JyAnfSIgOiAneyIgIn0nLCBmMiA9IGwyID8gIiAiIDogU0YoW3AyLCBiRl0sICIgIiksIGQyID0gZnVuY3Rpb24oZTMsIHQzLCBuMywgcjMsIG8zKSB7CiAgICAgICAgICAgIGNvbnN0IGkzID0gW107CiAgICAgICAgICAgIHJldHVybiBlMy5lYWNoKChlNCwgdDQsIHUzKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgczMgPSBlNC5nZXRWYWx1ZSgpOwogICAgICAgICAgICAgIGlmIChJRihzMykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGU1ID0gT0YoczMpOwogICAgICAgICAgICAgICAgaWYgKFFGKHMzKSkgewogICAgICAgICAgICAgICAgICBjb25zdCBuNCA9IGU1LnNwbGl0KFhGKTsKICAgICAgICAgICAgICAgICAgaWYgKG40WzBdID09PSAiIikgewogICAgICAgICAgICAgICAgICAgIGlmIChpMy5wdXNoKCIiKSwgbjQuc2hpZnQoKSwgL1xuLy50ZXN0KG40WzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgY29uc3QgZTYgPSB1M1t0NCArIDFdOwogICAgICAgICAgICAgICAgICAgICAgaTMucHVzaChHRihvMywgbjRbMV0sIHMzLCBlNikpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgaTMucHVzaChyMyk7CiAgICAgICAgICAgICAgICAgICAgbjQuc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBsZXQgYTM7CiAgICAgICAgICAgICAgICAgIGlmIChORihuNCkgPT09ICIiICYmIChuNC5wb3AoKSwgYTMgPSBuNC5wb3AoKSksIG40Lmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW2U2LCB0NV0gb2YgbjQuZW50cmllcygpKQogICAgICAgICAgICAgICAgICAgIGU2ICUgMiA9PSAxID8gaTMucHVzaChFRikgOiBpMy5wdXNoKHQ1KTsKICAgICAgICAgICAgICAgICAgaWYgKGEzICE9PSB2b2lkIDApCiAgICAgICAgICAgICAgICAgICAgaWYgKC9cbi8udGVzdChhMykpIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGU2ID0gdTNbdDQgKyAxXTsKICAgICAgICAgICAgICAgICAgICAgIGkzLnB1c2goR0YobzMsIE5GKGkzKSwgczMsIGU2KSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICBpMy5wdXNoKHIzKTsKICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZTYgPSB1M1t0NCArIDFdOwogICAgICAgICAgICAgICAgICAgIGkzLnB1c2goekYobzMsIE5GKGkzKSwgczMsIGU2KSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAvXG4vLnRlc3QoZTUpID8gZTUubWF0Y2goL1xuL2cpLmxlbmd0aCA+IDEgJiYgaTMucHVzaCgiIiwgQ0YpIDogaTMucHVzaCgiIiwgcjMpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBlNSA9IG4zKCk7CiAgICAgICAgICAgICAgICBpMy5wdXNoKGU1KTsKICAgICAgICAgICAgICAgIGNvbnN0IHI0ID0gdTNbdDQgKyAxXTsKICAgICAgICAgICAgICAgIGlmIChyNCAmJiBRRihyNCkpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZTYgPSBLRihPRihyNCkpLnNwbGl0KFhGKVswXTsKICAgICAgICAgICAgICAgICAgaTMucHVzaCh6RihvMywgZTYsIHMzLCByNCkpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgIGkzLnB1c2goQ0YpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgImNoaWxkcmVuIiksIGkzOwogICAgICAgICAgfShlMiwgMCwgbjIsIGYyLCByMi5vcGVuaW5nRWxlbWVudCAmJiByMi5vcGVuaW5nRWxlbWVudC5uYW1lICYmIHIyLm9wZW5pbmdFbGVtZW50Lm5hbWUubmFtZSA9PT0gImZidCIpLCBoMiA9IHIyLmNoaWxkcmVuLnNvbWUoKGUzKSA9PiBRRihlMykpOwogICAgICAgICAgZm9yIChsZXQgZTMgPSBkMi5sZW5ndGggLSAyOyBlMyA+PSAwOyBlMy0tKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gZDJbZTNdID09PSAiIiAmJiBkMltlMyArIDFdID09PSAiIiwgbjMgPSBkMltlM10gPT09IENGICYmIGQyW2UzICsgMV0gPT09ICIiICYmIGQyW2UzICsgMl0gPT09IENGLCByMyA9IChkMltlM10gPT09IGJGIHx8IGQyW2UzXSA9PT0gQ0YpICYmIGQyW2UzICsgMV0gPT09ICIiICYmIGQyW2UzICsgMl0gPT09IGYyLCBvMyA9IGQyW2UzXSA9PT0gZjIgJiYgZDJbZTMgKyAxXSA9PT0gIiIgJiYgKGQyW2UzICsgMl0gPT09IGJGIHx8IGQyW2UzICsgMl0gPT09IENGKSwgaTMgPSBkMltlM10gPT09IGYyICYmIGQyW2UzICsgMV0gPT09ICIiICYmIGQyW2UzICsgMl0gPT09IGYyLCB1MyA9IGQyW2UzXSA9PT0gYkYgJiYgZDJbZTMgKyAxXSA9PT0gIiIgJiYgZDJbZTMgKyAyXSA9PT0gQ0YgfHwgZDJbZTNdID09PSBDRiAmJiBkMltlMyArIDFdID09PSAiIiAmJiBkMltlMyArIDJdID09PSBiRjsKICAgICAgICAgICAgbjMgJiYgaDIgfHwgdDMgfHwgcjMgfHwgaTMgfHwgdTMgPyBkMi5zcGxpY2UoZTMsIDIpIDogbzMgJiYgZDIuc3BsaWNlKGUzICsgMSwgMik7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKDsgZDIubGVuZ3RoID4gMCAmJiBxRihORihkMikpOyApCiAgICAgICAgICAgIGQyLnBvcCgpOwogICAgICAgICAgZm9yICg7IGQyLmxlbmd0aCA+IDEgJiYgcUYoZDJbMF0pICYmIHFGKGQyWzFdKTsgKQogICAgICAgICAgICBkMi5zaGlmdCgpLCBkMi5zaGlmdCgpOwogICAgICAgICAgY29uc3QgZzIgPSBbXTsKICAgICAgICAgIGZvciAoY29uc3QgW2UzLCB0M10gb2YgZDIuZW50cmllcygpKSB7CiAgICAgICAgICAgIGlmICh0MyA9PT0gZjIpIHsKICAgICAgICAgICAgICBpZiAoZTMgPT09IDEgJiYgZDJbZTMgLSAxXSA9PT0gIiIpIHsKICAgICAgICAgICAgICAgIGlmIChkMi5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgZzIucHVzaChwMik7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZzIucHVzaChbcDIsIENGXSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGUzID09PSBkMi5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICBnMi5wdXNoKHAyKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoZDJbZTMgLSAxXSA9PT0gIiIgJiYgZDJbZTMgLSAyXSA9PT0gQ0YpIHsKICAgICAgICAgICAgICAgIGcyLnB1c2gocDIpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGcyLnB1c2godDMpLCBCRih0MykgJiYgKGMyID0gdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBtMiA9IGgyID8geEYoZzIpIDogdkYoZzIsIHsgc2hvdWxkQnJlYWs6IHRydWUgfSk7CiAgICAgICAgICBpZiAobDIpCiAgICAgICAgICAgIHJldHVybiBtMjsKICAgICAgICAgIGNvbnN0IHkyID0gdkYoW28yLCBBRihbQ0YsIG0yXSksIENGLCBpMl0pOwogICAgICAgICAgcmV0dXJuIGMyID8geTIgOiBGRihbdkYoW28yLCAuLi5kMiwgaTJdKSwgeTJdKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gekYoZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIHJldHVybiBlMiA/ICIiIDogbjIudHlwZSA9PT0gIkpTWEVsZW1lbnQiICYmICFuMi5jbG9zaW5nRWxlbWVudCB8fCByMiAmJiByMi50eXBlID09PSAiSlNYRWxlbWVudCIgJiYgIXIyLmNsb3NpbmdFbGVtZW50ID8gdDIubGVuZ3RoID09PSAxID8gYkYgOiBDRiA6IGJGOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBHRihlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgcmV0dXJuIGUyID8gQ0YgOiB0Mi5sZW5ndGggPT09IDEgPyBuMi50eXBlID09PSAiSlNYRWxlbWVudCIgJiYgIW4yLmNsb3NpbmdFbGVtZW50IHx8IHIyICYmIHIyLnR5cGUgPT09ICJKU1hFbGVtZW50IiAmJiAhcjIuY2xvc2luZ0VsZW1lbnQgPyBDRiA6IGJGIDogQ0Y7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEhGKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMywgdDMsIG4zKSB7CiAgICAgICAgICAgIGNvbnN0IHIyID0gZTMuZ2V0UGFyZW50Tm9kZSgpOwogICAgICAgICAgICBpZiAoIXIyKQogICAgICAgICAgICAgIHJldHVybiB0MzsKICAgICAgICAgICAgaWYgKHsgQXJyYXlFeHByZXNzaW9uOiB0cnVlLCBKU1hBdHRyaWJ1dGU6IHRydWUsIEpTWEVsZW1lbnQ6IHRydWUsIEpTWEV4cHJlc3Npb25Db250YWluZXI6IHRydWUsIEpTWEZyYWdtZW50OiB0cnVlLCBFeHByZXNzaW9uU3RhdGVtZW50OiB0cnVlLCBDYWxsRXhwcmVzc2lvbjogdHJ1ZSwgT3B0aW9uYWxDYWxsRXhwcmVzc2lvbjogdHJ1ZSwgQ29uZGl0aW9uYWxFeHByZXNzaW9uOiB0cnVlLCBKc0V4cHJlc3Npb25Sb290OiB0cnVlIH1bcjIudHlwZV0pCiAgICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgICBjb25zdCBvMiA9IGUzLm1hdGNoKHZvaWQgMCwgKGU0KSA9PiBlNC50eXBlID09PSAiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iLCBMRiwgKGU0KSA9PiBlNC50eXBlID09PSAiSlNYRXhwcmVzc2lvbkNvbnRhaW5lciIpLCBpMiA9ICRGKGUzLCBuMyk7CiAgICAgICAgICAgIHJldHVybiB2RihbaTIgPyAiIiA6IFNGKCIoIiksIEFGKFtiRiwgdDNdKSwgYkYsIGkyID8gIiIgOiBTRigiKSIpXSwgeyBzaG91bGRCcmVhazogbzIgfSk7CiAgICAgICAgICB9KGUyLCB5RihlMiwgVUYoZTIsIHQyLCBuMiksIHQyKSwgdDIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBKRihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICByZXR1cm4gWyJ7IiwgZTIuY2FsbCgoZTMpID0+IHsKICAgICAgICAgICAgY29uc3QgcjMgPSBbIi4uLiIsIG4yKCldLCBvMiA9IGUzLmdldFZhbHVlKCk7CiAgICAgICAgICAgIHJldHVybiBNRihvMikgJiYgV0YoZTMpID8gW0FGKFtiRiwgeUYoZTMsIHIzLCB0MildKSwgYkZdIDogcjM7CiAgICAgICAgICB9LCByMi50eXBlID09PSAiSlNYU3ByZWFkQXR0cmlidXRlIiA/ICJhcmd1bWVudCIgOiAiZXhwcmVzc2lvbiIpLCAifSJdOwogICAgICAgIH0KICAgICAgICBjb25zdCBYRiA9IG5ldyBSZWdFeHAoIihbIFxuXHIJXSspIiksIFlGID0gbmV3IFJlZ0V4cCgiW14gXG5ccgldIiksIEtGID0gKGUyKSA9PiBlMi5yZXBsYWNlKG5ldyBSZWdFeHAoIig/Ol4iICsgWEYuc291cmNlICsgInwiICsgWEYuc291cmNlICsgIiQpIiksICIiKTsKICAgICAgICBmdW5jdGlvbiBRRihlMikgewogICAgICAgICAgcmV0dXJuIElGKGUyKSAmJiAoWUYudGVzdChPRihlMikpIHx8ICEvXG4vLnRlc3QoT0YoZTIpKSk7CiAgICAgICAgfQogICAgICAgIHZhciBaRiA9IHsgaGFzSnN4SWdub3JlQ29tbWVudDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTIuZ2V0VmFsdWUoKSwgbjIgPSBlMi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICBpZiAoIShuMiAmJiB0MiAmJiBQRih0MikgJiYgUEYobjIpKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgbGV0IHIyID0gbnVsbDsKICAgICAgICAgIGZvciAobGV0IGUzID0gbjIuY2hpbGRyZW4uaW5kZXhPZih0Mik7IGUzID4gMDsgZTMtLSkgewogICAgICAgICAgICBjb25zdCB0MyA9IG4yLmNoaWxkcmVuW2UzIC0gMV07CiAgICAgICAgICAgIGlmICh0My50eXBlICE9PSAiSlNYVGV4dCIgfHwgUUYodDMpKSB7CiAgICAgICAgICAgICAgcjIgPSB0MzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHIyICYmIHIyLnR5cGUgPT09ICJKU1hFeHByZXNzaW9uQ29udGFpbmVyIiAmJiByMi5leHByZXNzaW9uLnR5cGUgPT09ICJKU1hFbXB0eUV4cHJlc3Npb24iICYmIFZGKHIyLmV4cHJlc3Npb24pOwogICAgICAgIH0sIHByaW50SnN4OiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBpZiAocjIudHlwZS5zdGFydHNXaXRoKCJKU1giKSkKICAgICAgICAgICAgc3dpdGNoIChyMi50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiSlNYQXR0cmlidXRlIjoKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMywgdDMsIG4zKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHIzID0gZTMuZ2V0VmFsdWUoKSwgbzIgPSBbXTsKICAgICAgICAgICAgICAgICAgaWYgKG8yLnB1c2gobjMoIm5hbWUiKSksIHIzLnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGU0OwogICAgICAgICAgICAgICAgICAgIGlmIChqRihyMy52YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgIGxldCBuNCA9IE9GKHIzLnZhbHVlKS5zbGljZSgxLCAtMSkucmVwbGFjZSgvJmFwb3M7L2csICInIikucmVwbGFjZSgvJnF1b3Q7L2csICciJyk7CiAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGVzY2FwZWQ6IG8zLCBxdW90ZTogaTIsIHJlZ2V4OiB1MiB9ID0ga0YobjQsIHQzLmpzeFNpbmdsZVF1b3RlID8gIiciIDogJyInKTsKICAgICAgICAgICAgICAgICAgICAgIG40ID0gbjQucmVwbGFjZSh1MiwgbzMpLCBlNCA9IFtpMiwgbjQsIGkyXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgIGU0ID0gbjMoInZhbHVlIik7CiAgICAgICAgICAgICAgICAgICAgbzIucHVzaCgiPSIsIGU0KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZXR1cm4gbzI7CiAgICAgICAgICAgICAgICB9KGUyLCB0MiwgbjIpOwogICAgICAgICAgICAgIGNhc2UgIkpTWElkZW50aWZpZXIiOgogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhyMi5uYW1lKTsKICAgICAgICAgICAgICBjYXNlICJKU1hOYW1lc3BhY2VkTmFtZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gVEYoIjoiLCBbbjIoIm5hbWVzcGFjZSIpLCBuMigibmFtZSIpXSk7CiAgICAgICAgICAgICAgY2FzZSAiSlNYTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gVEYoIi4iLCBbbjIoIm9iamVjdCIpLCBuMigicHJvcGVydHkiKV0pOwogICAgICAgICAgICAgIGNhc2UgIkpTWFNwcmVhZEF0dHJpYnV0ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gSkYoZTIsIHQyLCBuMik7CiAgICAgICAgICAgICAgY2FzZSAiSlNYU3ByZWFkQ2hpbGQiOgogICAgICAgICAgICAgICAgcmV0dXJuIEpGKGUyLCB0MiwgbjIpOwogICAgICAgICAgICAgIGNhc2UgIkpTWEV4cHJlc3Npb25Db250YWluZXIiOgogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUzLCB0MywgbjMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgcjMgPSBlMy5nZXRWYWx1ZSgpLCBvMiA9IGUzLmdldFBhcmVudE5vZGUoMCksIGkyID0gcjMuZXhwcmVzc2lvbi50eXBlID09PSAiSlNYRW1wdHlFeHByZXNzaW9uIiB8fCAhTUYocjMuZXhwcmVzc2lvbikgJiYgKHIzLmV4cHJlc3Npb24udHlwZSA9PT0gIkFycmF5RXhwcmVzc2lvbiIgfHwgcjMuZXhwcmVzc2lvbi50eXBlID09PSAiT2JqZWN0RXhwcmVzc2lvbiIgfHwgcjMuZXhwcmVzc2lvbi50eXBlID09PSAiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iIHx8IExGKHIzLmV4cHJlc3Npb24pIHx8IHIzLmV4cHJlc3Npb24udHlwZSA9PT0gIkZ1bmN0aW9uRXhwcmVzc2lvbiIgfHwgcjMuZXhwcmVzc2lvbi50eXBlID09PSAiVGVtcGxhdGVMaXRlcmFsIiB8fCByMy5leHByZXNzaW9uLnR5cGUgPT09ICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iIHx8IHIzLmV4cHJlc3Npb24udHlwZSA9PT0gIkRvRXhwcmVzc2lvbiIgfHwgUEYobzIpICYmIChyMy5leHByZXNzaW9uLnR5cGUgPT09ICJDb25kaXRpb25hbEV4cHJlc3Npb24iIHx8IF9GKHIzLmV4cHJlc3Npb24pKSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiB2RihpMiA/IFsieyIsIG4zKCJleHByZXNzaW9uIiksIHdGLCAifSJdIDogWyJ7IiwgQUYoW2JGLCBuMygiZXhwcmVzc2lvbiIpXSksIGJGLCB3RiwgIn0iXSk7CiAgICAgICAgICAgICAgICB9KGUyLCAwLCBuMik7CiAgICAgICAgICAgICAgY2FzZSAiSlNYRnJhZ21lbnQiOgogICAgICAgICAgICAgIGNhc2UgIkpTWEVsZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIEhGKGUyLCB0MiwgbjIpOwogICAgICAgICAgICAgIGNhc2UgIkpTWE9wZW5pbmdFbGVtZW50IjoKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMywgdDMsIG4zKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHIzID0gZTMuZ2V0VmFsdWUoKSwgbzIgPSByMy5uYW1lICYmIE1GKHIzLm5hbWUpIHx8IHIzLnR5cGVQYXJhbWV0ZXJzICYmIE1GKHIzLnR5cGVQYXJhbWV0ZXJzKTsKICAgICAgICAgICAgICAgICAgaWYgKHIzLnNlbGZDbG9zaW5nICYmIHIzLmF0dHJpYnV0ZXMubGVuZ3RoID09PSAwICYmICFvMikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gWyI8IiwgbjMoIm5hbWUiKSwgbjMoInR5cGVQYXJhbWV0ZXJzIiksICIgLz4iXTsKICAgICAgICAgICAgICAgICAgaWYgKHIzLmF0dHJpYnV0ZXMgJiYgcjMuYXR0cmlidXRlcy5sZW5ndGggPT09IDEgJiYgcjMuYXR0cmlidXRlc1swXS52YWx1ZSAmJiBqRihyMy5hdHRyaWJ1dGVzWzBdLnZhbHVlKSAmJiAhcjMuYXR0cmlidXRlc1swXS52YWx1ZS52YWx1ZS5pbmNsdWRlcygiXG4iKSAmJiAhbzIgJiYgIU1GKHIzLmF0dHJpYnV0ZXNbMF0pKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB2RihbIjwiLCBuMygibmFtZSIpLCBuMygidHlwZVBhcmFtZXRlcnMiKSwgIiAiLCAuLi5lMy5tYXAobjMsICJhdHRyaWJ1dGVzIiksIHIzLnNlbGZDbG9zaW5nID8gIiAvPiIgOiAiPiJdKTsKICAgICAgICAgICAgICAgICAgY29uc3QgaTIgPSByMy5hdHRyaWJ1dGVzLmxlbmd0aCA+IDAgJiYgTUYoTkYocjMuYXR0cmlidXRlcyksIFJGLlRyYWlsaW5nKSwgdTIgPSByMy5hdHRyaWJ1dGVzLmxlbmd0aCA9PT0gMCAmJiAhbzIgfHwgKHQzLmJyYWNrZXRTYW1lTGluZSB8fCB0My5qc3hCcmFja2V0U2FtZUxpbmUpICYmICghbzIgfHwgcjMuYXR0cmlidXRlcy5sZW5ndGggPiAwKSAmJiAhaTIsIHMyID0gcjMuYXR0cmlidXRlcyAmJiByMy5hdHRyaWJ1dGVzLnNvbWUoKGU0KSA9PiBlNC52YWx1ZSAmJiBqRihlNC52YWx1ZSkgJiYgZTQudmFsdWUudmFsdWUuaW5jbHVkZXMoIlxuIikpOwogICAgICAgICAgICAgICAgICByZXR1cm4gdkYoWyI8IiwgbjMoIm5hbWUiKSwgbjMoInR5cGVQYXJhbWV0ZXJzIiksIEFGKGUzLm1hcCgoKSA9PiBbRUYsIG4zKCldLCAiYXR0cmlidXRlcyIpKSwgcjMuc2VsZkNsb3NpbmcgPyBFRiA6IHUyID8gIj4iIDogYkYsIHIzLnNlbGZDbG9zaW5nID8gIi8+IiA6IHUyID8gIiIgOiAiPiJdLCB7IHNob3VsZEJyZWFrOiBzMiB9KTsKICAgICAgICAgICAgICAgIH0oZTIsIHQyLCBuMik7CiAgICAgICAgICAgICAgY2FzZSAiSlNYQ2xvc2luZ0VsZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUzLCB0MywgbjMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgcjMgPSBlMy5nZXRWYWx1ZSgpLCBvMiA9IFtdOwogICAgICAgICAgICAgICAgICBvMi5wdXNoKCI8LyIpOwogICAgICAgICAgICAgICAgICBjb25zdCBpMiA9IG4zKCJuYW1lIik7CiAgICAgICAgICAgICAgICAgIHJldHVybiBNRihyMy5uYW1lLCBSRi5MZWFkaW5nIHwgUkYuTGluZSkgPyBvMi5wdXNoKEFGKFtDRiwgaTJdKSwgQ0YpIDogTUYocjMubmFtZSwgUkYuTGVhZGluZyB8IFJGLkJsb2NrKSA/IG8yLnB1c2goIiAiLCBpMikgOiBvMi5wdXNoKGkyKSwgbzIucHVzaCgiPiIpLCBvMjsKICAgICAgICAgICAgICAgIH0oZTIsIDAsIG4yKTsKICAgICAgICAgICAgICBjYXNlICJKU1hPcGVuaW5nRnJhZ21lbnQiOgogICAgICAgICAgICAgIGNhc2UgIkpTWENsb3NpbmdGcmFnbWVudCI6CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG4zID0gZTMuZ2V0VmFsdWUoKSwgcjMgPSBNRihuMyksIG8yID0gTUYobjMsIFJGLkxpbmUpLCBpMiA9IG4zLnR5cGUgPT09ICJKU1hPcGVuaW5nRnJhZ21lbnQiOwogICAgICAgICAgICAgICAgICByZXR1cm4gW2kyID8gIjwiIDogIjwvIiwgQUYoW28yID8gQ0YgOiByMyAmJiAhaTIgPyAiICIgOiAiIiwgREYoZTMsIHQzLCB0cnVlKV0pLCBvMiA/IENGIDogIiIsICI+Il07CiAgICAgICAgICAgICAgICB9KGUyLCB0Mik7CiAgICAgICAgICAgICAgY2FzZSAiSlNYRW1wdHlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgbjMgPSBlMy5nZXRWYWx1ZSgpLCByMyA9IE1GKG4zLCBSRi5MaW5lKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFtERihlMywgdDMsICFyMyksIHIzID8gQ0YgOiAiIl07CiAgICAgICAgICAgICAgICB9KGUyLCB0Mik7CiAgICAgICAgICAgICAgY2FzZSAiSlNYVGV4dCI6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkpTWFRlc3Qgc2hvdWxkIGJlIGhhbmRsZWQgYnkgSlNYRWxlbWVudCIpOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gSlNYIG5vZGUgdHlwZTogIi5jb25jYXQoSlNPTi5zdHJpbmdpZnkocjIudHlwZSksICIuIikpOwogICAgICAgICAgICB9CiAgICAgICAgfSB9LCBleCA9IGJ1LCB0eCA9IFplLCBueCA9IGdyLCByeCA9IGFyLCBveCA9IFd1OwogICAgICAgIHJvKHsgdGFyZ2V0OiAiQXJyYXkiLCBwcm90bzogdHJ1ZSB9LCB7IGZsYXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGUyID0gYXJndW1lbnRzLmxlbmd0aCA/IGFyZ3VtZW50c1swXSA6IHZvaWQgMCwgdDIgPSB0eCh0aGlzKSwgbjIgPSBueCh0MiksIHIyID0gb3godDIsIDApOwogICAgICAgICAgcmV0dXJuIHIyLmxlbmd0aCA9IGV4KHIyLCB0MiwgdDIsIG4yLCAwLCBlMiA9PT0gdm9pZCAwID8gMSA6IHJ4KGUyKSksIHIyOwogICAgICAgIH0gfSk7CiAgICAgICAgdmFyIGl4LCB1eCA9IFNyLCBzeCA9IHdyLCBheCA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gdXgoZTIsIHN4KTsKICAgICAgICB9LCBjeCA9IHp0LCBseCA9IFl0LCBweCA9IG9lLCBmeCA9IGF4LCBkeCA9IEIgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyA6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgbHgoZTIpOwogICAgICAgICAgZm9yICh2YXIgbjIsIHIyID0gcHgodDIpLCBvMiA9IGZ4KHQyKSwgaTIgPSBvMi5sZW5ndGgsIHUyID0gMDsgaTIgPiB1MjsgKQogICAgICAgICAgICBjeC5mKGUyLCBuMiA9IG8yW3UyKytdLCByMltuMl0pOwogICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgIH0sIGh4ID0gcGUoImRvY3VtZW50IiwgImRvY3VtZW50RWxlbWVudCIpLCBneCA9IFl0LCBteCA9IGR4LCB5eCA9IHdyLCBEeCA9IEFuLCBFeCA9IGh4LCBDeCA9IE90LCBieCA9IHZuKCJJRV9QUk9UTyIpLCB2eCA9IGZ1bmN0aW9uKCkgewogICAgICAgIH0sIEF4ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiAiPHNjcmlwdD4iICsgZTIgKyAiPFwvc2NyaXB0PiI7CiAgICAgICAgfSwgRnggPSBmdW5jdGlvbihlMikgewogICAgICAgICAgZTIud3JpdGUoQXgoIiIpKSwgZTIuY2xvc2UoKTsKICAgICAgICAgIHZhciB0MiA9IGUyLnBhcmVudFdpbmRvdy5PYmplY3Q7CiAgICAgICAgICByZXR1cm4gZTIgPSBudWxsLCB0MjsKICAgICAgICB9LCB4eCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaXggPSBuZXcgQWN0aXZlWE9iamVjdCgiaHRtbGZpbGUiKTsKICAgICAgICAgIH0gY2F0Y2ggKGUzKSB7CiAgICAgICAgICB9CiAgICAgICAgICB4eCA9IHR5cGVvZiBkb2N1bWVudCAhPSAidW5kZWZpbmVkIiA/IGRvY3VtZW50LmRvbWFpbiAmJiBpeCA/IEZ4KGl4KSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgZTMsIHQyID0gQ3goImlmcmFtZSIpOwogICAgICAgICAgICByZXR1cm4gdDIuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgRXguYXBwZW5kQ2hpbGQodDIpLCB0Mi5zcmMgPSBTdHJpbmcoImphdmFzY3JpcHQ6IiksIChlMyA9IHQyLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQpLm9wZW4oKSwgZTMud3JpdGUoQXgoImRvY3VtZW50LkY9T2JqZWN0IikpLCBlMy5jbG9zZSgpLCBlMy5GOwogICAgICAgICAgfSgpIDogRngoaXgpOwogICAgICAgICAgZm9yICh2YXIgZTIgPSB5eC5sZW5ndGg7IGUyLS07ICkKICAgICAgICAgICAgZGVsZXRlIHh4LnByb3RvdHlwZVt5eFtlMl1dOwogICAgICAgICAgcmV0dXJuIHh4KCk7CiAgICAgICAgfTsKICAgICAgICBEeFtieF0gPSB0cnVlOwogICAgICAgIHZhciBTeCA9IE9iamVjdC5jcmVhdGUgfHwgZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICB2YXIgbjI7CiAgICAgICAgICByZXR1cm4gZTIgIT09IG51bGwgPyAodngucHJvdG90eXBlID0gZ3goZTIpLCBuMiA9IG5ldyB2eCgpLCB2eC5wcm90b3R5cGUgPSBudWxsLCBuMltieF0gPSBlMikgOiBuMiA9IHh4KCksIHQyID09PSB2b2lkIDAgPyBuMiA6IG14KG4yLCB0Mik7CiAgICAgICAgfSwgd3ggPSB6dCwgVHggPSBEdCgidW5zY29wYWJsZXMiKSwgQnggPSBBcnJheS5wcm90b3R5cGU7CiAgICAgICAgQnhbVHhdID09IG51bGwgJiYgd3guZihCeCwgVHgsIHsgY29uZmlndXJhYmxlOiB0cnVlLCB2YWx1ZTogU3gobnVsbCkgfSk7CiAgICAgICAgdmFyIE54ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIEJ4W1R4XVtlMl0gPSB0cnVlOwogICAgICAgIH07CiAgICAgICAgTngoImZsYXQiKTsKICAgICAgICBjb25zdCB7IGlzTm9uRW1wdHlBcnJheToga3ggfSA9IGRjLCB7IGJ1aWxkZXJzOiB7IGluZGVudDogUHgsIGpvaW46IE94LCBsaW5lOiBJeCB9IH0gPSBaYywgeyBpc0Zsb3dBbm5vdGF0aW9uQ29tbWVudDogTHggfSA9IENDOwogICAgICAgIGZ1bmN0aW9uIGp4KGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIGlmICghcjIudHlwZUFubm90YXRpb24pCiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgIGNvbnN0IG8yID0gZTIuZ2V0UGFyZW50Tm9kZSgpLCBpMiA9IHIyLmRlZmluaXRlIHx8IG8yICYmIG8yLnR5cGUgPT09ICJWYXJpYWJsZURlY2xhcmF0b3IiICYmIG8yLmRlZmluaXRlLCB1MiA9IG8yLnR5cGUgPT09ICJEZWNsYXJlRnVuY3Rpb24iICYmIG8yLmlkID09PSByMjsKICAgICAgICAgIHJldHVybiBMeCh0Mi5vcmlnaW5hbFRleHQsIHIyLnR5cGVBbm5vdGF0aW9uKSA/IFsiIC8qOiAiLCBuMigidHlwZUFubm90YXRpb24iKSwgIiAqLyJdIDogW3UyID8gIiIgOiBpMiA/ICIhOiAiIDogIjogIiwgbjIoInR5cGVBbm5vdGF0aW9uIildOwogICAgICAgIH0KICAgICAgICB2YXIgX3ggPSB7IHByaW50T3B0aW9uYWxUb2tlbjogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIHJldHVybiAhdDIub3B0aW9uYWwgfHwgdDIudHlwZSA9PT0gIklkZW50aWZpZXIiICYmIHQyID09PSBlMi5nZXRQYXJlbnROb2RlKCkua2V5ID8gIiIgOiB0Mi50eXBlID09PSAiT3B0aW9uYWxDYWxsRXhwcmVzc2lvbiIgfHwgdDIudHlwZSA9PT0gIk9wdGlvbmFsTWVtYmVyRXhwcmVzc2lvbiIgJiYgdDIuY29tcHV0ZWQgPyAiPy4iIDogIj8iOwogICAgICAgIH0sIHByaW50RnVuY3Rpb25UeXBlUGFyYW1ldGVyczogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgcmV0dXJuIHIyLnR5cGVBcmd1bWVudHMgPyBuMigidHlwZUFyZ3VtZW50cyIpIDogcjIudHlwZVBhcmFtZXRlcnMgPyBuMigidHlwZVBhcmFtZXRlcnMiKSA6ICIiOwogICAgICAgIH0sIHByaW50QmluZEV4cHJlc3Npb25DYWxsZWU6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBbIjo6IiwgbjIoImNhbGxlZSIpXTsKICAgICAgICB9LCBwcmludFR5cGVTY3JpcHRNb2RpZmllcnM6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIHJldHVybiBreChyMi5tb2RpZmllcnMpID8gW094KCIgIiwgZTIubWFwKG4yLCAibW9kaWZpZXJzIikpLCAiICJdIDogIiI7CiAgICAgICAgfSwgcHJpbnRUeXBlQW5ub3RhdGlvbjogangsIHByaW50UmVzdFNwcmVhZDogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIFsiLi4uIiwgbjIoImFyZ3VtZW50IiksIGp4KGUyLCB0MiwgbjIpXTsKICAgICAgICB9LCBhZGp1c3RDbGF1c2U6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAiRW1wdHlTdGF0ZW1lbnQiID8gIjsiIDogZTIudHlwZSA9PT0gIkJsb2NrU3RhdGVtZW50IiB8fCBuMiA/IFsiICIsIHQyXSA6IFB4KFtJeCwgdDJdKTsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgeyBwcmludERhbmdsaW5nQ29tbWVudHM6IE14IH0gPSB0RCwgeyBidWlsZGVyczogeyBsaW5lOiBSeCwgc29mdGxpbmU6IFZ4LCBoYXJkbGluZTogJHgsIGdyb3VwOiBXeCwgaW5kZW50OiBxeCwgaWZCcmVhazogVXgsIGZpbGw6IHp4IH0gfSA9IFpjLCB7IGdldExhc3Q6IEd4LCBoYXNOZXdsaW5lOiBIeCB9ID0gZGMsIHsgc2hvdWxkUHJpbnRDb21tYTogSngsIGhhc0NvbW1lbnQ6IFh4LCBDb21tZW50Q2hlY2tGbGFnczogWXgsIGlzTmV4dExpbmVFbXB0eTogS3gsIGlzTnVtZXJpY0xpdGVyYWw6IFF4LCBpc1NpZ25lZE51bWVyaWNMaXRlcmFsOiBaeCB9ID0gQ0MsIHsgbG9jU3RhcnQ6IGVTIH0gPSBvZywgeyBwcmludE9wdGlvbmFsVG9rZW46IHRTLCBwcmludFR5cGVBbm5vdGF0aW9uOiBuUyB9ID0gX3g7CiAgICAgICAgZnVuY3Rpb24gclMoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gZTIuZWxlbWVudHMubGVuZ3RoID4gMSAmJiBlMi5lbGVtZW50cy5ldmVyeSgoZTMpID0+IGUzICYmIChReChlMykgfHwgWngoZTMpICYmICFYeChlMy5hcmd1bWVudCkpICYmICFYeChlMywgWXguVHJhaWxpbmcgfCBZeC5MaW5lLCAoZTQpID0+ICFIeCh0Mi5vcmlnaW5hbFRleHQsIGVTKGU0KSwgeyBiYWNrd2FyZHM6IHRydWUgfSkpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb1MoZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIGNvbnN0IG8yID0gW107CiAgICAgICAgICBsZXQgaTIgPSBbXTsKICAgICAgICAgIHJldHVybiBlMi5lYWNoKChlMykgPT4gewogICAgICAgICAgICBvMi5wdXNoKGkyLCBXeChyMigpKSksIGkyID0gWyIsIiwgUnhdLCBlMy5nZXRWYWx1ZSgpICYmIEt4KGUzLmdldFZhbHVlKCksIHQyKSAmJiBpMi5wdXNoKFZ4KTsKICAgICAgICAgIH0sIG4yKSwgbzI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlTKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICBjb25zdCBvMiA9IFtdOwogICAgICAgICAgcmV0dXJuIGUyLmVhY2goKGUzLCBpMiwgdTIpID0+IHsKICAgICAgICAgICAgY29uc3QgczIgPSBpMiA9PT0gdTIubGVuZ3RoIC0gMTsKICAgICAgICAgICAgbzIucHVzaChbbjIoKSwgczIgPyByMiA6ICIsIl0pLCBzMiB8fCBvMi5wdXNoKEt4KGUzLmdldFZhbHVlKCksIHQyKSA/IFskeCwgJHhdIDogWHgodTJbaTIgKyAxXSwgWXguTGVhZGluZyB8IFl4LkxpbmUpID8gJHggOiBSeCk7CiAgICAgICAgICB9LCAiZWxlbWVudHMiKSwgengobzIpOwogICAgICAgIH0KICAgICAgICB2YXIgdVMgPSB7IHByaW50QXJyYXk6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKSwgbzIgPSBbXSwgaTIgPSByMi50eXBlID09PSAiVHVwbGVFeHByZXNzaW9uIiA/ICIjWyIgOiAiWyI7CiAgICAgICAgICBpZiAocjIuZWxlbWVudHMubGVuZ3RoID09PSAwKQogICAgICAgICAgICBYeChyMiwgWXguRGFuZ2xpbmcpID8gbzIucHVzaChXeChbaTIsIE14KGUyLCB0MiksIFZ4LCAiXSJdKSkgOiBvMi5wdXNoKGkyLCAiXSIpOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHUyID0gR3gocjIuZWxlbWVudHMpLCBzMiA9ICEodTIgJiYgdTIudHlwZSA9PT0gIlJlc3RFbGVtZW50IiksIGEyID0gdTIgPT09IG51bGwsIGMyID0gU3ltYm9sKCJhcnJheSIpLCBsMiA9ICF0Mi5fX2luSmVzdEVhY2ggJiYgcjIuZWxlbWVudHMubGVuZ3RoID4gMSAmJiByMi5lbGVtZW50cy5ldmVyeSgoZTMsIHQzLCBuMykgPT4gewogICAgICAgICAgICAgIGNvbnN0IHIzID0gZTMgJiYgZTMudHlwZTsKICAgICAgICAgICAgICBpZiAocjMgIT09ICJBcnJheUV4cHJlc3Npb24iICYmIHIzICE9PSAiT2JqZWN0RXhwcmVzc2lvbiIpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgY29uc3QgbzMgPSBuM1t0MyArIDFdOwogICAgICAgICAgICAgIGlmIChvMyAmJiByMyAhPT0gbzMudHlwZSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICBjb25zdCBpMyA9IHIzID09PSAiQXJyYXlFeHByZXNzaW9uIiA/ICJlbGVtZW50cyIgOiAicHJvcGVydGllcyI7CiAgICAgICAgICAgICAgcmV0dXJuIGUzW2kzXSAmJiBlM1tpM10ubGVuZ3RoID4gMTsKICAgICAgICAgICAgfSksIHAyID0gclMocjIsIHQyKSwgZjIgPSBzMiA/IGEyID8gIiwiIDogSngodDIpID8gcDIgPyBVeCgiLCIsICIiLCB7IGdyb3VwSWQ6IGMyIH0pIDogVXgoIiwiKSA6ICIiIDogIiI7CiAgICAgICAgICAgIG8yLnB1c2goV3goW2kyLCBxeChbVngsIHAyID8gaVMoZTIsIHQyLCBuMiwgZjIpIDogW29TKGUyLCB0MiwgImVsZW1lbnRzIiwgbjIpLCBmMl0sIE14KGUyLCB0MiwgdHJ1ZSldKSwgVngsICJdIl0sIHsgc2hvdWxkQnJlYWs6IGwyLCBpZDogYzIgfSkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG8yLnB1c2godFMoZTIpLCBuUyhlMiwgdDIsIG4yKSksIG8yOwogICAgICAgIH0sIHByaW50QXJyYXlJdGVtczogb1MsIGlzQ29uY2lzZWx5UHJpbnRlZEFycmF5OiByUyB9OwogICAgICAgIGNvbnN0IHsgcHJpbnREYW5nbGluZ0NvbW1lbnRzOiBzUyB9ID0gdEQsIHsgZ2V0TGFzdDogYVMsIGdldFBlbnVsdGltYXRlOiBjUyB9ID0gZGMsIHsgZ2V0RnVuY3Rpb25QYXJhbWV0ZXJzOiBsUywgaGFzQ29tbWVudDogcFMsIENvbW1lbnRDaGVja0ZsYWdzOiBmUywgaXNGdW5jdGlvbkNvbXBvc2l0aW9uQXJnczogZFMsIGlzSnN4Tm9kZTogaFMsIGlzTG9uZ0N1cnJpZWRDYWxsRXhwcmVzc2lvbjogZ1MsIHNob3VsZFByaW50Q29tbWE6IG1TLCBnZXRDYWxsQXJndW1lbnRzOiB5UywgaXRlcmF0ZUNhbGxBcmd1bWVudHNQYXRoOiBEUywgaXNOZXh0TGluZUVtcHR5OiBFUywgaXNDYWxsRXhwcmVzc2lvbjogQ1MsIGlzU3RyaW5nTGl0ZXJhbDogYlMsIGlzT2JqZWN0UHJvcGVydHk6IHZTIH0gPSBDQywgeyBidWlsZGVyczogeyBsaW5lOiBBUywgaGFyZGxpbmU6IEZTLCBzb2Z0bGluZTogeFMsIGdyb3VwOiBTUywgaW5kZW50OiB3UywgY29uZGl0aW9uYWxHcm91cDogVFMsIGlmQnJlYWs6IEJTLCBicmVha1BhcmVudDogTlMgfSwgdXRpbHM6IHsgd2lsbEJyZWFrOiBrUyB9IH0gPSBaYywgeyBBcmdFeHBhbnNpb25CYWlsb3V0OiBQUyB9ID0gQ3AsIHsgaXNDb25jaXNlbHlQcmludGVkQXJyYXk6IE9TIH0gPSB1UzsKICAgICAgICBmdW5jdGlvbiBJUyhlMikgewogICAgICAgICAgbGV0IHQyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgJiYgYXJndW1lbnRzWzFdOwogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJPYmplY3RFeHByZXNzaW9uIiAmJiAoZTIucHJvcGVydGllcy5sZW5ndGggPiAwIHx8IHBTKGUyKSkgfHwgZTIudHlwZSA9PT0gIkFycmF5RXhwcmVzc2lvbiIgJiYgKGUyLmVsZW1lbnRzLmxlbmd0aCA+IDAgfHwgcFMoZTIpKSB8fCBlMi50eXBlID09PSAiVFNUeXBlQXNzZXJ0aW9uIiAmJiBJUyhlMi5leHByZXNzaW9uKSB8fCBlMi50eXBlID09PSAiVFNBc0V4cHJlc3Npb24iICYmIElTKGUyLmV4cHJlc3Npb24pIHx8IGUyLnR5cGUgPT09ICJGdW5jdGlvbkV4cHJlc3Npb24iIHx8IGUyLnR5cGUgPT09ICJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiIgJiYgKCFlMi5yZXR1cm5UeXBlIHx8ICFlMi5yZXR1cm5UeXBlLnR5cGVBbm5vdGF0aW9uIHx8IGUyLnJldHVyblR5cGUudHlwZUFubm90YXRpb24udHlwZSAhPT0gIlRTVHlwZVJlZmVyZW5jZSIgfHwgTFMoZTIuYm9keSkpICYmIChlMi5ib2R5LnR5cGUgPT09ICJCbG9ja1N0YXRlbWVudCIgfHwgZTIuYm9keS50eXBlID09PSAiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iICYmIElTKGUyLmJvZHksIHRydWUpIHx8IGUyLmJvZHkudHlwZSA9PT0gIk9iamVjdEV4cHJlc3Npb24iIHx8IGUyLmJvZHkudHlwZSA9PT0gIkFycmF5RXhwcmVzc2lvbiIgfHwgIXQyICYmIChDUyhlMi5ib2R5KSB8fCBlMi5ib2R5LnR5cGUgPT09ICJDb25kaXRpb25hbEV4cHJlc3Npb24iKSB8fCBoUyhlMi5ib2R5KSkgfHwgZTIudHlwZSA9PT0gIkRvRXhwcmVzc2lvbiIgfHwgZTIudHlwZSA9PT0gIk1vZHVsZUV4cHJlc3Npb24iOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBMUyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJCbG9ja1N0YXRlbWVudCIgJiYgKGUyLmJvZHkuc29tZSgoZTMpID0+IGUzLnR5cGUgIT09ICJFbXB0eVN0YXRlbWVudCIpIHx8IHBTKGUyLCBmUy5EYW5nbGluZykpOwogICAgICAgIH0KICAgICAgICB2YXIgalMgPSBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCksIG8yID0gcjIudHlwZSA9PT0gIkltcG9ydEV4cHJlc3Npb24iLCBpMiA9IHlTKHIyKTsKICAgICAgICAgIGlmIChpMi5sZW5ndGggPT09IDApCiAgICAgICAgICAgIHJldHVybiBbIigiLCBzUyhlMiwgdDIsIHRydWUpLCAiKSJdOwogICAgICAgICAgaWYgKGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMy5sZW5ndGggPT09IDIgJiYgZTNbMF0udHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiAmJiBsUyhlM1swXSkubGVuZ3RoID09PSAwICYmIGUzWzBdLmJvZHkudHlwZSA9PT0gIkJsb2NrU3RhdGVtZW50IiAmJiBlM1sxXS50eXBlID09PSAiQXJyYXlFeHByZXNzaW9uIiAmJiAhZTMuc29tZSgoZTQpID0+IHBTKGU0KSk7CiAgICAgICAgICB9KGkyKSkKICAgICAgICAgICAgcmV0dXJuIFsiKCIsIG4yKFsiYXJndW1lbnRzIiwgMF0pLCAiLCAiLCBuMihbImFyZ3VtZW50cyIsIDFdKSwgIikiXTsKICAgICAgICAgIGxldCB1MiA9IGZhbHNlLCBzMiA9IGZhbHNlOwogICAgICAgICAgY29uc3QgYTIgPSBpMi5sZW5ndGggLSAxLCBjMiA9IFtdOwogICAgICAgICAgRFMoZTIsIChlMywgcjMpID0+IHsKICAgICAgICAgICAgY29uc3QgbzMgPSBlMy5nZXROb2RlKCksIGkzID0gW24yKCldOwogICAgICAgICAgICByMyA9PT0gYTIgfHwgKEVTKG8zLCB0MikgPyAocjMgPT09IDAgJiYgKHMyID0gdHJ1ZSksIHUyID0gdHJ1ZSwgaTMucHVzaCgiLCIsIEZTLCBGUykpIDogaTMucHVzaCgiLCIsIEFTKSksIGMyLnB1c2goaTMpOwogICAgICAgICAgfSk7CiAgICAgICAgICBjb25zdCBsMiA9IG8yIHx8IHIyLmNhbGxlZSAmJiByMi5jYWxsZWUudHlwZSA9PT0gIkltcG9ydCIgfHwgIW1TKHQyLCAiYWxsIikgPyAiIiA6ICIsIjsKICAgICAgICAgIGZ1bmN0aW9uIHAyKCkgewogICAgICAgICAgICByZXR1cm4gU1MoWyIoIiwgd1MoW0FTLCAuLi5jMl0pLCBsMiwgQVMsICIpIl0sIHsgc2hvdWxkQnJlYWs6IHRydWUgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodTIgfHwgZTIuZ2V0UGFyZW50Tm9kZSgpLnR5cGUgIT09ICJEZWNvcmF0b3IiICYmIGRTKGkyKSkKICAgICAgICAgICAgcmV0dXJuIHAyKCk7CiAgICAgICAgICBjb25zdCBmMiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGlmIChlMy5sZW5ndGggIT09IDIpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjb25zdCBbdDMsIG4zXSA9IGUzOwogICAgICAgICAgICBpZiAodDMudHlwZSA9PT0gIk1vZHVsZUV4cHJlc3Npb24iICYmIGZ1bmN0aW9uKGU0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGU0LnR5cGUgPT09ICJPYmplY3RFeHByZXNzaW9uIiAmJiBlNC5wcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMSAmJiB2UyhlNC5wcm9wZXJ0aWVzWzBdKSAmJiBlNC5wcm9wZXJ0aWVzWzBdLmtleS50eXBlID09PSAiSWRlbnRpZmllciIgJiYgZTQucHJvcGVydGllc1swXS5rZXkubmFtZSA9PT0gInR5cGUiICYmIGJTKGU0LnByb3BlcnRpZXNbMF0udmFsdWUpICYmIGU0LnByb3BlcnRpZXNbMF0udmFsdWUudmFsdWUgPT09ICJtb2R1bGUiOwogICAgICAgICAgICB9KG4zKSkKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuICFwUyh0MykgJiYgKHQzLnR5cGUgPT09ICJGdW5jdGlvbkV4cHJlc3Npb24iIHx8IHQzLnR5cGUgPT09ICJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiIgJiYgdDMuYm9keS50eXBlID09PSAiQmxvY2tTdGF0ZW1lbnQiKSAmJiBuMy50eXBlICE9PSAiRnVuY3Rpb25FeHByZXNzaW9uIiAmJiBuMy50eXBlICE9PSAiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iICYmIG4zLnR5cGUgIT09ICJDb25kaXRpb25hbEV4cHJlc3Npb24iICYmICFJUyhuMyk7CiAgICAgICAgICB9KGkyKSwgZDIgPSBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgY29uc3QgbjMgPSBhUyhlMyksIHIzID0gY1MoZTMpOwogICAgICAgICAgICByZXR1cm4gIXBTKG4zLCBmUy5MZWFkaW5nKSAmJiAhcFMobjMsIGZTLlRyYWlsaW5nKSAmJiBJUyhuMykgJiYgKCFyMyB8fCByMy50eXBlICE9PSBuMy50eXBlKSAmJiAoZTMubGVuZ3RoICE9PSAyIHx8IHIzLnR5cGUgIT09ICJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiIgfHwgbjMudHlwZSAhPT0gIkFycmF5RXhwcmVzc2lvbiIpICYmICEoZTMubGVuZ3RoID4gMSAmJiBuMy50eXBlID09PSAiQXJyYXlFeHByZXNzaW9uIiAmJiBPUyhuMywgdDMpKTsKICAgICAgICAgIH0oaTIsIHQyKTsKICAgICAgICAgIGlmIChmMiB8fCBkMikgewogICAgICAgICAgICBpZiAoZjIgPyBjMi5zbGljZSgxKS5zb21lKGtTKSA6IGMyLnNsaWNlKDAsIC0xKS5zb21lKGtTKSkKICAgICAgICAgICAgICByZXR1cm4gcDIoKTsKICAgICAgICAgICAgbGV0IHQzID0gW107CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgZTIudHJ5KCgpID0+IHsKICAgICAgICAgICAgICAgIERTKGUyLCAoZTMsIHIzKSA9PiB7CiAgICAgICAgICAgICAgICAgIGYyICYmIHIzID09PSAwICYmICh0MyA9IFtbbjIoW10sIHsgZXhwYW5kRmlyc3RBcmc6IHRydWUgfSksIGMyLmxlbmd0aCA+IDEgPyAiLCIgOiAiIiwgczIgPyBGUyA6IEFTLCBzMiA/IEZTIDogIiJdLCAuLi5jMi5zbGljZSgxKV0pLCBkMiAmJiByMyA9PT0gYTIgJiYgKHQzID0gWy4uLmMyLnNsaWNlKDAsIC0xKSwgbjIoW10sIHsgZXhwYW5kTGFzdEFyZzogdHJ1ZSB9KV0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUzKSB7CiAgICAgICAgICAgICAgaWYgKGUzIGluc3RhbmNlb2YgUFMpCiAgICAgICAgICAgICAgICByZXR1cm4gcDIoKTsKICAgICAgICAgICAgICB0aHJvdyBlMzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gW2MyLnNvbWUoa1MpID8gTlMgOiAiIiwgVFMoW1siKCIsIC4uLnQzLCAiKSJdLCBmMiA/IFsiKCIsIFNTKHQzWzBdLCB7IHNob3VsZEJyZWFrOiB0cnVlIH0pLCAuLi50My5zbGljZSgxKSwgIikiXSA6IFsiKCIsIC4uLmMyLnNsaWNlKDAsIC0xKSwgU1MoYVModDMpLCB7IHNob3VsZEJyZWFrOiB0cnVlIH0pLCAiKSJdLCBwMigpXSldOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgaDIgPSBbIigiLCB3UyhbeFMsIC4uLmMyXSksIEJTKGwyKSwgeFMsICIpIl07CiAgICAgICAgICByZXR1cm4gZ1MoZTIpID8gaDIgOiBTUyhoMiwgeyBzaG91bGRCcmVhazogYzIuc29tZShrUykgfHwgdTIgfSk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IHNvZnRsaW5lOiBfUywgZ3JvdXA6IE1TLCBpbmRlbnQ6IFJTLCBsYWJlbDogVlMgfSB9ID0gWmMsIHsgaXNOdW1lcmljTGl0ZXJhbDogJFMsIGlzTWVtYmVyRXhwcmVzc2lvbjogV1MsIGlzQ2FsbEV4cHJlc3Npb246IHFTIH0gPSBDQywgeyBwcmludE9wdGlvbmFsVG9rZW46IFVTIH0gPSBfeDsKICAgICAgICBmdW5jdGlvbiB6UyhlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IG4yKCJwcm9wZXJ0eSIpLCBvMiA9IGUyLmdldFZhbHVlKCksIGkyID0gVVMoZTIpOwogICAgICAgICAgcmV0dXJuIG8yLmNvbXB1dGVkID8gIW8yLnByb3BlcnR5IHx8ICRTKG8yLnByb3BlcnR5KSA/IFtpMiwgIlsiLCByMiwgIl0iXSA6IE1TKFtpMiwgIlsiLCBSUyhbX1MsIHIyXSksIF9TLCAiXSJdKSA6IFtpMiwgIi4iLCByMl07CiAgICAgICAgfQogICAgICAgIHZhciBHUyA9IHsgcHJpbnRNZW1iZXJFeHByZXNzaW9uOiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCksIG8yID0gZTIuZ2V0UGFyZW50Tm9kZSgpOwogICAgICAgICAgbGV0IGkyLCB1MiA9IDA7CiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIGkyID0gZTIuZ2V0UGFyZW50Tm9kZSh1MiksIHUyKys7CiAgICAgICAgICB9IHdoaWxlIChpMiAmJiAoV1MoaTIpIHx8IGkyLnR5cGUgPT09ICJUU05vbk51bGxFeHByZXNzaW9uIikpOwogICAgICAgICAgY29uc3QgczIgPSBuMigib2JqZWN0IiksIGEyID0gelMoZTIsIHQyLCBuMiksIGMyID0gaTIgJiYgKGkyLnR5cGUgPT09ICJOZXdFeHByZXNzaW9uIiB8fCBpMi50eXBlID09PSAiQmluZEV4cHJlc3Npb24iIHx8IGkyLnR5cGUgPT09ICJBc3NpZ25tZW50RXhwcmVzc2lvbiIgJiYgaTIubGVmdC50eXBlICE9PSAiSWRlbnRpZmllciIpIHx8IHIyLmNvbXB1dGVkIHx8IHIyLm9iamVjdC50eXBlID09PSAiSWRlbnRpZmllciIgJiYgcjIucHJvcGVydHkudHlwZSA9PT0gIklkZW50aWZpZXIiICYmICFXUyhvMikgfHwgKG8yLnR5cGUgPT09ICJBc3NpZ25tZW50RXhwcmVzc2lvbiIgfHwgbzIudHlwZSA9PT0gIlZhcmlhYmxlRGVjbGFyYXRvciIpICYmIChxUyhyMi5vYmplY3QpICYmIHIyLm9iamVjdC5hcmd1bWVudHMubGVuZ3RoID4gMCB8fCByMi5vYmplY3QudHlwZSA9PT0gIlRTTm9uTnVsbEV4cHJlc3Npb24iICYmIHFTKHIyLm9iamVjdC5leHByZXNzaW9uKSAmJiByMi5vYmplY3QuZXhwcmVzc2lvbi5hcmd1bWVudHMubGVuZ3RoID4gMCB8fCBzMi5sYWJlbCA9PT0gIm1lbWJlci1jaGFpbiIpOwogICAgICAgICAgcmV0dXJuIFZTKHMyLmxhYmVsID09PSAibWVtYmVyLWNoYWluIiA/ICJtZW1iZXItY2hhaW4iIDogIm1lbWJlciIsIFtzMiwgYzIgPyBhMiA6IE1TKFJTKFtfUywgYTJdKSldKTsKICAgICAgICB9LCBwcmludE1lbWJlckxvb2t1cDogelMgfTsKICAgICAgICBjb25zdCB7IHByaW50Q29tbWVudHM6IEhTIH0gPSB0RCwgeyBnZXRMYXN0OiBKUywgaXNOZXh0TGluZUVtcHR5QWZ0ZXJJbmRleDogWFMsIGdldE5leHROb25TcGFjZU5vbkNvbW1lbnRDaGFyYWN0ZXJJbmRleDogWVMgfSA9IGRjLCBLUyA9IHdBLCB7IGlzQ2FsbEV4cHJlc3Npb246IFFTLCBpc01lbWJlckV4cHJlc3Npb246IFpTLCBpc0Z1bmN0aW9uT3JBcnJvd0V4cHJlc3Npb246IGV3LCBpc0xvbmdDdXJyaWVkQ2FsbEV4cHJlc3Npb246IHR3LCBpc01lbWJlcmlzaDogbncsIGlzTnVtZXJpY0xpdGVyYWw6IHJ3LCBpc1NpbXBsZUNhbGxBcmd1bWVudDogb3csIGhhc0NvbW1lbnQ6IGl3LCBDb21tZW50Q2hlY2tGbGFnczogdXcsIGlzTmV4dExpbmVFbXB0eTogc3cgfSA9IENDLCB7IGxvY0VuZDogYXcgfSA9IG9nLCB7IGJ1aWxkZXJzOiB7IGpvaW46IGN3LCBoYXJkbGluZTogbHcsIGdyb3VwOiBwdywgaW5kZW50OiBmdywgY29uZGl0aW9uYWxHcm91cDogZHcsIGJyZWFrUGFyZW50OiBodywgbGFiZWw6IGd3IH0sIHV0aWxzOiB7IHdpbGxCcmVhazogbXcgfSB9ID0gWmMsIHl3ID0galMsIHsgcHJpbnRNZW1iZXJMb29rdXA6IER3IH0gPSBHUywgeyBwcmludE9wdGlvbmFsVG9rZW46IEV3LCBwcmludEZ1bmN0aW9uVHlwZVBhcmFtZXRlcnM6IEN3LCBwcmludEJpbmRFeHByZXNzaW9uQ2FsbGVlOiBidyB9ID0gX3g7CiAgICAgICAgdmFyIHZ3ID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRQYXJlbnROb2RlKCksIG8yID0gIXIyIHx8IHIyLnR5cGUgPT09ICJFeHByZXNzaW9uU3RhdGVtZW50IiwgaTIgPSBbXTsKICAgICAgICAgIGZ1bmN0aW9uIHUyKGUzKSB7CiAgICAgICAgICAgIGNvbnN0IHsgb3JpZ2luYWxUZXh0OiBuMyB9ID0gdDIsIHIzID0gWVMobjMsIGUzLCBhdyk7CiAgICAgICAgICAgIHJldHVybiBuMy5jaGFyQXQocjMpID09PSAiKSIgPyByMyAhPT0gZmFsc2UgJiYgWFMobjMsIHIzICsgMSkgOiBzdyhlMywgdDIpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gczIoZTMpIHsKICAgICAgICAgICAgY29uc3QgcjMgPSBlMy5nZXRWYWx1ZSgpOwogICAgICAgICAgICBRUyhyMykgJiYgKG53KHIzLmNhbGxlZSkgfHwgUVMocjMuY2FsbGVlKSkgPyAoaTIudW5zaGlmdCh7IG5vZGU6IHIzLCBwcmludGVkOiBbSFMoZTMsIFtFdyhlMyksIEN3KGUzLCB0MiwgbjIpLCB5dyhlMywgdDIsIG4yKV0sIHQyKSwgdTIocjMpID8gbHcgOiAiIl0gfSksIGUzLmNhbGwoKGU0KSA9PiBzMihlNCksICJjYWxsZWUiKSkgOiBudyhyMykgPyAoaTIudW5zaGlmdCh7IG5vZGU6IHIzLCBuZWVkc1BhcmVuczogS1MoZTMsIHQyKSwgcHJpbnRlZDogSFMoZTMsIFpTKHIzKSA/IER3KGUzLCB0MiwgbjIpIDogYncoZTMsIHQyLCBuMiksIHQyKSB9KSwgZTMuY2FsbCgoZTQpID0+IHMyKGU0KSwgIm9iamVjdCIpKSA6IHIzLnR5cGUgPT09ICJUU05vbk51bGxFeHByZXNzaW9uIiA/IChpMi51bnNoaWZ0KHsgbm9kZTogcjMsIHByaW50ZWQ6IEhTKGUzLCAiISIsIHQyKSB9KSwgZTMuY2FsbCgoZTQpID0+IHMyKGU0KSwgImV4cHJlc3Npb24iKSkgOiBpMi51bnNoaWZ0KHsgbm9kZTogcjMsIHByaW50ZWQ6IG4yKCkgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBhMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBpMi51bnNoaWZ0KHsgbm9kZTogYTIsIHByaW50ZWQ6IFtFdyhlMiksIEN3KGUyLCB0MiwgbjIpLCB5dyhlMiwgdDIsIG4yKV0gfSksIGEyLmNhbGxlZSAmJiBlMi5jYWxsKChlMykgPT4gczIoZTMpLCAiY2FsbGVlIik7CiAgICAgICAgICBjb25zdCBjMiA9IFtdOwogICAgICAgICAgbGV0IGwyID0gW2kyWzBdXSwgcDIgPSAxOwogICAgICAgICAgZm9yICg7IHAyIDwgaTIubGVuZ3RoICYmIChpMltwMl0ubm9kZS50eXBlID09PSAiVFNOb25OdWxsRXhwcmVzc2lvbiIgfHwgUVMoaTJbcDJdLm5vZGUpIHx8IFpTKGkyW3AyXS5ub2RlKSAmJiBpMltwMl0ubm9kZS5jb21wdXRlZCAmJiBydyhpMltwMl0ubm9kZS5wcm9wZXJ0eSkpOyArK3AyKQogICAgICAgICAgICBsMi5wdXNoKGkyW3AyXSk7CiAgICAgICAgICBpZiAoIVFTKGkyWzBdLm5vZGUpKQogICAgICAgICAgICBmb3IgKDsgcDIgKyAxIDwgaTIubGVuZ3RoICYmIChudyhpMltwMl0ubm9kZSkgJiYgbncoaTJbcDIgKyAxXS5ub2RlKSk7ICsrcDIpCiAgICAgICAgICAgICAgbDIucHVzaChpMltwMl0pOwogICAgICAgICAgYzIucHVzaChsMiksIGwyID0gW107CiAgICAgICAgICBsZXQgZjIgPSBmYWxzZTsKICAgICAgICAgIGZvciAoOyBwMiA8IGkyLmxlbmd0aDsgKytwMikgewogICAgICAgICAgICBpZiAoZjIgJiYgbncoaTJbcDJdLm5vZGUpKSB7CiAgICAgICAgICAgICAgaWYgKGkyW3AyXS5ub2RlLmNvbXB1dGVkICYmIHJ3KGkyW3AyXS5ub2RlLnByb3BlcnR5KSkgewogICAgICAgICAgICAgICAgbDIucHVzaChpMltwMl0pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGMyLnB1c2gobDIpLCBsMiA9IFtdLCBmMiA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIChRUyhpMltwMl0ubm9kZSkgfHwgaTJbcDJdLm5vZGUudHlwZSA9PT0gIkltcG9ydEV4cHJlc3Npb24iKSAmJiAoZjIgPSB0cnVlKSwgbDIucHVzaChpMltwMl0pLCBpdyhpMltwMl0ubm9kZSwgdXcuVHJhaWxpbmcpICYmIChjMi5wdXNoKGwyKSwgbDIgPSBbXSwgZjIgPSBmYWxzZSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBkMihlMykgewogICAgICAgICAgICByZXR1cm4gL15bQS1aXXxeWyRfXSskLy50ZXN0KGUzKTsKICAgICAgICAgIH0KICAgICAgICAgIGwyLmxlbmd0aCA+IDAgJiYgYzIucHVzaChsMik7CiAgICAgICAgICBjb25zdCBoMiA9IGMyLmxlbmd0aCA+PSAyICYmICFpdyhjMlsxXVswXS5ub2RlKSAmJiBmdW5jdGlvbihlMykgewogICAgICAgICAgICBjb25zdCBuMyA9IGUzWzFdLmxlbmd0aCA+IDAgJiYgZTNbMV1bMF0ubm9kZS5jb21wdXRlZDsKICAgICAgICAgICAgaWYgKGUzWzBdLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgIGNvbnN0IHI0ID0gZTNbMF1bMF0ubm9kZTsKICAgICAgICAgICAgICByZXR1cm4gcjQudHlwZSA9PT0gIlRoaXNFeHByZXNzaW9uIiB8fCByNC50eXBlID09PSAiSWRlbnRpZmllciIgJiYgKGQyKHI0Lm5hbWUpIHx8IG8yICYmIGZ1bmN0aW9uKGU0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZTQubGVuZ3RoIDw9IHQyLnRhYldpZHRoOwogICAgICAgICAgICAgIH0ocjQubmFtZSkgfHwgbjMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHIzID0gSlMoZTNbMF0pLm5vZGU7CiAgICAgICAgICAgIHJldHVybiBaUyhyMykgJiYgcjMucHJvcGVydHkudHlwZSA9PT0gIklkZW50aWZpZXIiICYmIChkMihyMy5wcm9wZXJ0eS5uYW1lKSB8fCBuMyk7CiAgICAgICAgICB9KGMyKTsKICAgICAgICAgIGZ1bmN0aW9uIGcyKGUzKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gZTMubWFwKChlNCkgPT4gZTQucHJpbnRlZCk7CiAgICAgICAgICAgIHJldHVybiBlMy5sZW5ndGggPiAwICYmIEpTKGUzKS5uZWVkc1BhcmVucyA/IFsiKCIsIC4uLnQzLCAiKSJdIDogdDM7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBtMiA9IGMyLm1hcChnMiksIHkyID0gbTIsIEQyID0gaDIgPyAzIDogMiwgRTIgPSBjMi5mbGF0KCksIEMyID0gRTIuc2xpY2UoMSwgLTEpLnNvbWUoKGUzKSA9PiBpdyhlMy5ub2RlLCB1dy5MZWFkaW5nKSkgfHwgRTIuc2xpY2UoMCwgLTEpLnNvbWUoKGUzKSA9PiBpdyhlMy5ub2RlLCB1dy5UcmFpbGluZykpIHx8IGMyW0QyXSAmJiBpdyhjMltEMl1bMF0ubm9kZSwgdXcuTGVhZGluZyk7CiAgICAgICAgICBpZiAoYzIubGVuZ3RoIDw9IEQyICYmICFDMikKICAgICAgICAgICAgcmV0dXJuIHR3KGUyKSA/IHkyIDogcHcoeTIpOwogICAgICAgICAgY29uc3QgYjIgPSBKUyhjMltoMiA/IDEgOiAwXSkubm9kZSwgdjIgPSAhUVMoYjIpICYmIHUyKGIyKSwgQTIgPSBbZzIoYzJbMF0pLCBoMiA/IGMyLnNsaWNlKDEsIDIpLm1hcChnMikgOiAiIiwgdjIgPyBsdyA6ICIiLCBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gZTMubGVuZ3RoID09PSAwID8gIiIgOiBmdyhwdyhbbHcsIGN3KGx3LCBlMy5tYXAoZzIpKV0pKTsKICAgICAgICAgIH0oYzIuc2xpY2UoaDIgPyAyIDogMSkpXSwgRjIgPSBpMi5tYXAoKGUzKSA9PiB7CiAgICAgICAgICAgIGxldCB7IG5vZGU6IHQzIH0gPSBlMzsKICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfSkuZmlsdGVyKFFTKTsKICAgICAgICAgIGxldCB4MjsKICAgICAgICAgIHJldHVybiB4MiA9IEMyIHx8IEYyLmxlbmd0aCA+IDIgJiYgRjIuc29tZSgoZTMpID0+ICFlMy5hcmd1bWVudHMuZXZlcnkoKGU0KSA9PiBvdyhlNCwgMCkpKSB8fCBtMi5zbGljZSgwLCAtMSkuc29tZShtdykgfHwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gSlMoSlMoYzIpKS5ub2RlLCB0MyA9IEpTKG0yKTsKICAgICAgICAgICAgcmV0dXJuIFFTKGUzKSAmJiBtdyh0MykgJiYgRjIuc2xpY2UoMCwgLTEpLnNvbWUoKGU0KSA9PiBlNC5hcmd1bWVudHMuc29tZShldykpOwogICAgICAgICAgfSgpID8gcHcoQTIpIDogW213KHkyKSB8fCB2MiA/IGh3IDogIiIsIGR3KFt5MiwgQTJdKV0sIGd3KCJtZW1iZXItY2hhaW4iLCB4Mik7CiAgICAgICAgfTsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IGpvaW46IEF3LCBncm91cDogRncgfSB9ID0gWmMsIHh3ID0gd0EsIHsgZ2V0Q2FsbEFyZ3VtZW50czogU3csIGhhc0Zsb3dBbm5vdGF0aW9uQ29tbWVudDogd3csIGlzQ2FsbEV4cHJlc3Npb246IFR3LCBpc01lbWJlcmlzaDogQncsIGlzU3RyaW5nTGl0ZXJhbDogTncsIGlzVGVtcGxhdGVPbkl0c093bkxpbmU6IGt3LCBpc1Rlc3RDYWxsOiBQdywgaXRlcmF0ZUNhbGxBcmd1bWVudHNQYXRoOiBPdyB9ID0gQ0MsIEl3ID0gdncsIEx3ID0galMsIHsgcHJpbnRPcHRpb25hbFRva2VuOiBqdywgcHJpbnRGdW5jdGlvblR5cGVQYXJhbWV0ZXJzOiBfdyB9ID0gX3g7CiAgICAgICAgdmFyIE13ID0geyBwcmludENhbGxFeHByZXNzaW9uOiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCksIG8yID0gZTIuZ2V0UGFyZW50Tm9kZSgpLCBpMiA9IHIyLnR5cGUgPT09ICJOZXdFeHByZXNzaW9uIiwgdTIgPSByMi50eXBlID09PSAiSW1wb3J0RXhwcmVzc2lvbiIsIHMyID0gancoZTIpLCBhMiA9IFN3KHIyKTsKICAgICAgICAgIGlmIChhMi5sZW5ndGggPiAwICYmICghdTIgJiYgIWkyICYmIGZ1bmN0aW9uKGUzLCB0MykgewogICAgICAgICAgICBpZiAoZTMuY2FsbGVlLnR5cGUgIT09ICJJZGVudGlmaWVyIikKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChlMy5jYWxsZWUubmFtZSA9PT0gInJlcXVpcmUiKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoZTMuY2FsbGVlLm5hbWUgPT09ICJkZWZpbmUiKSB7CiAgICAgICAgICAgICAgY29uc3QgbjMgPSBTdyhlMyk7CiAgICAgICAgICAgICAgcmV0dXJuIHQzLnR5cGUgPT09ICJFeHByZXNzaW9uU3RhdGVtZW50IiAmJiAobjMubGVuZ3RoID09PSAxIHx8IG4zLmxlbmd0aCA9PT0gMiAmJiBuM1swXS50eXBlID09PSAiQXJyYXlFeHByZXNzaW9uIiB8fCBuMy5sZW5ndGggPT09IDMgJiYgTncobjNbMF0pICYmIG4zWzFdLnR5cGUgPT09ICJBcnJheUV4cHJlc3Npb24iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9KHIyLCBvMikgfHwgYTIubGVuZ3RoID09PSAxICYmIGt3KGEyWzBdLCB0Mi5vcmlnaW5hbFRleHQpIHx8ICFpMiAmJiBQdyhyMiwgbzIpKSkgewogICAgICAgICAgICBjb25zdCByMyA9IFtdOwogICAgICAgICAgICByZXR1cm4gT3coZTIsICgpID0+IHsKICAgICAgICAgICAgICByMy5wdXNoKG4yKCkpOwogICAgICAgICAgICB9KSwgW2kyID8gIm5ldyAiIDogIiIsIG4yKCJjYWxsZWUiKSwgczIsIF93KGUyLCB0MiwgbjIpLCAiKCIsIEF3KCIsICIsIHIzKSwgIikiXTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGMyID0gKHQyLnBhcnNlciA9PT0gImJhYmVsIiB8fCB0Mi5wYXJzZXIgPT09ICJiYWJlbC1mbG93IikgJiYgcjIuY2FsbGVlICYmIHIyLmNhbGxlZS50eXBlID09PSAiSWRlbnRpZmllciIgJiYgd3cocjIuY2FsbGVlLnRyYWlsaW5nQ29tbWVudHMpOwogICAgICAgICAgaWYgKGMyICYmIChyMi5jYWxsZWUudHJhaWxpbmdDb21tZW50c1swXS5wcmludGVkID0gdHJ1ZSksICF1MiAmJiAhaTIgJiYgQncocjIuY2FsbGVlKSAmJiAhZTIuY2FsbCgoZTMpID0+IHh3KGUzLCB0MiksICJjYWxsZWUiKSkKICAgICAgICAgICAgcmV0dXJuIEl3KGUyLCB0MiwgbjIpOwogICAgICAgICAgY29uc3QgbDIgPSBbaTIgPyAibmV3ICIgOiAiIiwgdTIgPyAiaW1wb3J0IiA6IG4yKCJjYWxsZWUiKSwgczIsIGMyID8gIi8qOjogIi5jb25jYXQocjIuY2FsbGVlLnRyYWlsaW5nQ29tbWVudHNbMF0udmFsdWUuc2xpY2UoMikudHJpbSgpLCAiICovIikgOiAiIiwgX3coZTIsIHQyLCBuMiksIEx3KGUyLCB0MiwgbjIpXTsKICAgICAgICAgIHJldHVybiB1MiB8fCBUdyhyMi5jYWxsZWUpID8gRncobDIpIDogbDI7CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IHsgaXNOb25FbXB0eUFycmF5OiBSdywgZ2V0U3RyaW5nV2lkdGg6IFZ3IH0gPSBkYywgeyBidWlsZGVyczogeyBsaW5lOiAkdywgZ3JvdXA6IFd3LCBpbmRlbnQ6IHF3LCBpbmRlbnRJZkJyZWFrOiBVdyB9LCB1dGlsczogeyBjbGVhbkRvYzogencsIHdpbGxCcmVhazogR3csIGNhbkJyZWFrOiBIdyB9IH0gPSBaYywgeyBoYXNMZWFkaW5nT3duTGluZUNvbW1lbnQ6IEp3LCBpc0JpbmFyeWlzaDogWHcsIGlzU3RyaW5nTGl0ZXJhbDogWXcsIGlzTGl0ZXJhbDogS3csIGlzTnVtZXJpY0xpdGVyYWw6IFF3LCBpc0NhbGxFeHByZXNzaW9uOiBadywgaXNNZW1iZXJFeHByZXNzaW9uOiBlVCwgZ2V0Q2FsbEFyZ3VtZW50czogdFQsIHJhd1RleHQ6IG5ULCBoYXNDb21tZW50OiByVCwgaXNTaWduZWROdW1lcmljTGl0ZXJhbDogb1QsIGlzT2JqZWN0UHJvcGVydHk6IGlUIH0gPSBDQywgeyBzaG91bGRJbmxpbmVMb2dpY2FsRXhwcmVzc2lvbjogdVQgfSA9IHNGLCB7IHByaW50Q2FsbEV4cHJlc3Npb246IHNUIH0gPSBNdzsKICAgICAgICBmdW5jdGlvbiBhVChlMiwgdDIsIG4yLCByMiwgbzIsIGkyKSB7CiAgICAgICAgICBjb25zdCB1MiA9IGZ1bmN0aW9uKGUzLCB0MywgbjMsIHIzLCBvMykgewogICAgICAgICAgICBjb25zdCBpMyA9IGUzLmdldFZhbHVlKCksIHUzID0gaTNbbzNdOwogICAgICAgICAgICBpZiAoIXUzKQogICAgICAgICAgICAgIHJldHVybiAib25seS1sZWZ0IjsKICAgICAgICAgICAgY29uc3QgczMgPSAhY1QodTMpLCBhMiA9IGUzLm1hdGNoKGNULCBsVCwgKGU0KSA9PiAhczMgfHwgZTQudHlwZSAhPT0gIkV4cHJlc3Npb25TdGF0ZW1lbnQiICYmIGU0LnR5cGUgIT09ICJWYXJpYWJsZURlY2xhcmF0aW9uIik7CiAgICAgICAgICAgIGlmIChhMikKICAgICAgICAgICAgICByZXR1cm4gczMgPyB1My50eXBlID09PSAiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iICYmIHUzLmJvZHkudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiA/ICJjaGFpbi10YWlsLWFycm93LWNoYWluIiA6ICJjaGFpbi10YWlsIiA6ICJjaGFpbiI7CiAgICAgICAgICAgIGlmICghczMgJiYgY1QodTMucmlnaHQpIHx8IEp3KHQzLm9yaWdpbmFsVGV4dCwgdTMpKQogICAgICAgICAgICAgIHJldHVybiAiYnJlYWstYWZ0ZXItb3BlcmF0b3IiOwogICAgICAgICAgICBpZiAodTMudHlwZSA9PT0gIkNhbGxFeHByZXNzaW9uIiAmJiB1My5jYWxsZWUubmFtZSA9PT0gInJlcXVpcmUiIHx8IHQzLnBhcnNlciA9PT0gImpzb241IiB8fCB0My5wYXJzZXIgPT09ICJqc29uIikKICAgICAgICAgICAgICByZXR1cm4gIm5ldmVyLWJyZWFrLWFmdGVyLW9wZXJhdG9yIjsKICAgICAgICAgICAgaWYgKGZ1bmN0aW9uKGU0KSB7CiAgICAgICAgICAgICAgaWYgKGxUKGU0KSkgewogICAgICAgICAgICAgICAgY29uc3QgdDQgPSBlNC5sZWZ0IHx8IGU0LmlkOwogICAgICAgICAgICAgICAgcmV0dXJuIHQ0LnR5cGUgPT09ICJPYmplY3RQYXR0ZXJuIiAmJiB0NC5wcm9wZXJ0aWVzLmxlbmd0aCA+IDIgJiYgdDQucHJvcGVydGllcy5zb21lKChlNSkgPT4gaVQoZTUpICYmICghZTUuc2hvcnRoYW5kIHx8IGU1LnZhbHVlICYmIGU1LnZhbHVlLnR5cGUgPT09ICJBc3NpZ25tZW50UGF0dGVybiIpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9KGkzKSB8fCBmdW5jdGlvbihlNCkgewogICAgICAgICAgICAgIGNvbnN0IHQ0ID0gZnVuY3Rpb24oZTUpIHsKICAgICAgICAgICAgICAgIGlmIChmdW5jdGlvbihlNikgewogICAgICAgICAgICAgICAgICByZXR1cm4gZTYudHlwZSA9PT0gIlRTVHlwZUFsaWFzRGVjbGFyYXRpb24iIHx8IGU2LnR5cGUgPT09ICJUeXBlQWxpYXMiOwogICAgICAgICAgICAgICAgfShlNSkgJiYgZTUudHlwZVBhcmFtZXRlcnMgJiYgZTUudHlwZVBhcmFtZXRlcnMucGFyYW1zKQogICAgICAgICAgICAgICAgICByZXR1cm4gZTUudHlwZVBhcmFtZXRlcnMucGFyYW1zOwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgfShlNCk7CiAgICAgICAgICAgICAgaWYgKFJ3KHQ0KSkgewogICAgICAgICAgICAgICAgY29uc3QgbjQgPSBlNC50eXBlID09PSAiVFNUeXBlQWxpYXNEZWNsYXJhdGlvbiIgPyAiY29uc3RyYWludCIgOiAiYm91bmQiOwogICAgICAgICAgICAgICAgaWYgKHQ0Lmxlbmd0aCA+IDEgJiYgdDQuc29tZSgoZTUpID0+IGU1W240XSB8fCBlNS5kZWZhdWx0KSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfShpMykgfHwgZnVuY3Rpb24oZTQpIHsKICAgICAgICAgICAgICBpZiAoZTQudHlwZSAhPT0gIlZhcmlhYmxlRGVjbGFyYXRvciIpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgY29uc3QgeyB0eXBlQW5ub3RhdGlvbjogdDQgfSA9IGU0LmlkOwogICAgICAgICAgICAgIGlmICghdDQgfHwgIXQ0LnR5cGVBbm5vdGF0aW9uKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIGNvbnN0IG40ID0gZlQodDQudHlwZUFubm90YXRpb24pOwogICAgICAgICAgICAgIHJldHVybiBSdyhuNCkgJiYgbjQubGVuZ3RoID4gMSAmJiBuNC5zb21lKChlNSkgPT4gUncoZlQoZTUpKSB8fCBlNS50eXBlID09PSAiVFNDb25kaXRpb25hbFR5cGUiKTsKICAgICAgICAgICAgfShpMykgfHwgcFQoaTMpICYmIEh3KHIzKSkKICAgICAgICAgICAgICByZXR1cm4gImJyZWFrLWxocyI7CiAgICAgICAgICAgIGNvbnN0IGMyID0gZnVuY3Rpb24oZTQsIHQ0LCBuNCkgewogICAgICAgICAgICAgIGlmICghaVQoZTQpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIHQ0ID0gencodDQpOwogICAgICAgICAgICAgIGNvbnN0IHI0ID0gMzsKICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHQ0ID09ICJzdHJpbmciICYmIFZ3KHQ0KSA8IG40LnRhYldpZHRoICsgcjQ7CiAgICAgICAgICAgIH0oaTMsIHIzLCB0Myk7CiAgICAgICAgICAgIGlmIChlMy5jYWxsKCgpID0+IGZ1bmN0aW9uKGU0LCB0NCwgbjQsIHI0KSB7CiAgICAgICAgICAgICAgY29uc3QgbzQgPSBlNC5nZXRWYWx1ZSgpOwogICAgICAgICAgICAgIGlmIChYdyhvNCkgJiYgIXVUKG80KSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIHN3aXRjaCAobzQudHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAiU3RyaW5nTGl0ZXJhbFR5cGVBbm5vdGF0aW9uIjoKICAgICAgICAgICAgICAgIGNhc2UgIlNlcXVlbmNlRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgY2FzZSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIjogewogICAgICAgICAgICAgICAgICBjb25zdCB7IHRlc3Q6IGU1IH0gPSBvNDsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFh3KGU1KSAmJiAhdVQoZTUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAiQ2xhc3NFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIFJ3KG80LmRlY29yYXRvcnMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAocjQpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgbGV0IGk0ID0gbzQ7CiAgICAgICAgICAgICAgY29uc3QgdTQgPSBbXTsKICAgICAgICAgICAgICBmb3IgKDsgOyApCiAgICAgICAgICAgICAgICBpZiAoaTQudHlwZSA9PT0gIlVuYXJ5RXhwcmVzc2lvbiIpCiAgICAgICAgICAgICAgICAgIGk0ID0gaTQuYXJndW1lbnQsIHU0LnB1c2goImFyZ3VtZW50Iik7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgaWYgKGk0LnR5cGUgIT09ICJUU05vbk51bGxFeHByZXNzaW9uIikKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgaTQgPSBpNC5leHByZXNzaW9uLCB1NC5wdXNoKCJleHByZXNzaW9uIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKFl3KGk0KSB8fCBlNC5jYWxsKCgpID0+IGRUKGU0LCB0NCwgbjQpLCAuLi51NCkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0oZTMsIHQzLCBuMywgYzIpLCBvMykpCiAgICAgICAgICAgICAgcmV0dXJuICJicmVhay1hZnRlci1vcGVyYXRvciI7CiAgICAgICAgICAgIGlmIChjMiB8fCB1My50eXBlID09PSAiVGVtcGxhdGVMaXRlcmFsIiB8fCB1My50eXBlID09PSAiVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uIiB8fCB1My50eXBlID09PSAiQm9vbGVhbkxpdGVyYWwiIHx8IFF3KHUzKSB8fCB1My50eXBlID09PSAiQ2xhc3NFeHByZXNzaW9uIikKICAgICAgICAgICAgICByZXR1cm4gIm5ldmVyLWJyZWFrLWFmdGVyLW9wZXJhdG9yIjsKICAgICAgICAgICAgcmV0dXJuICJmbHVpZCI7CiAgICAgICAgICB9KGUyLCB0MiwgbjIsIHIyLCBpMiksIHMyID0gbjIoaTIsIHsgYXNzaWdubWVudExheW91dDogdTIgfSk7CiAgICAgICAgICBzd2l0Y2ggKHUyKSB7CiAgICAgICAgICAgIGNhc2UgImJyZWFrLWFmdGVyLW9wZXJhdG9yIjoKICAgICAgICAgICAgICByZXR1cm4gV3coW1d3KHIyKSwgbzIsIFd3KHF3KFskdywgczJdKSldKTsKICAgICAgICAgICAgY2FzZSAibmV2ZXItYnJlYWstYWZ0ZXItb3BlcmF0b3IiOgogICAgICAgICAgICAgIHJldHVybiBXdyhbV3cocjIpLCBvMiwgIiAiLCBzMl0pOwogICAgICAgICAgICBjYXNlICJmbHVpZCI6IHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IFN5bWJvbCgiYXNzaWdubWVudCIpOwogICAgICAgICAgICAgIHJldHVybiBXdyhbV3cocjIpLCBvMiwgV3cocXcoJHcpLCB7IGlkOiBlMyB9KSwgVXcoczIsIHsgZ3JvdXBJZDogZTMgfSldKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJicmVhay1saHMiOgogICAgICAgICAgICAgIHJldHVybiBXdyhbcjIsIG8yLCAiICIsIFd3KHMyKV0pOwogICAgICAgICAgICBjYXNlICJjaGFpbiI6CiAgICAgICAgICAgICAgcmV0dXJuIFtXdyhyMiksIG8yLCAkdywgczJdOwogICAgICAgICAgICBjYXNlICJjaGFpbi10YWlsIjoKICAgICAgICAgICAgICByZXR1cm4gW1d3KHIyKSwgbzIsIHF3KFskdywgczJdKV07CiAgICAgICAgICAgIGNhc2UgImNoYWluLXRhaWwtYXJyb3ctY2hhaW4iOgogICAgICAgICAgICAgIHJldHVybiBbV3cocjIpLCBvMiwgczJdOwogICAgICAgICAgICBjYXNlICJvbmx5LWxlZnQiOgogICAgICAgICAgICAgIHJldHVybiByMjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY1QoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAiQXNzaWdubWVudEV4cHJlc3Npb24iOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBsVChlMikgewogICAgICAgICAgcmV0dXJuIGNUKGUyKSB8fCBlMi50eXBlID09PSAiVmFyaWFibGVEZWNsYXJhdG9yIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcFQoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAiVmFyaWFibGVEZWNsYXJhdG9yIiAmJiBlMi5pbml0ICYmIGUyLmluaXQudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZlQoZTIpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gZTMudHlwZSA9PT0gIlRTVHlwZVJlZmVyZW5jZSIgfHwgZTMudHlwZSA9PT0gIkdlbmVyaWNUeXBlQW5ub3RhdGlvbiI7CiAgICAgICAgICB9KGUyKSAmJiBlMi50eXBlUGFyYW1ldGVycyAmJiBlMi50eXBlUGFyYW1ldGVycy5wYXJhbXMgPyBlMi50eXBlUGFyYW1ldGVycy5wYXJhbXMgOiBudWxsOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBkVChlMiwgdDIsIG4yKSB7CiAgICAgICAgICBsZXQgcjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHZvaWQgMCAmJiBhcmd1bWVudHNbM107CiAgICAgICAgICBjb25zdCBvMiA9IGUyLmdldFZhbHVlKCksIGkyID0gKCkgPT4gZFQoZTIsIHQyLCBuMiwgdHJ1ZSk7CiAgICAgICAgICBpZiAobzIudHlwZSA9PT0gIlRTTm9uTnVsbEV4cHJlc3Npb24iKQogICAgICAgICAgICByZXR1cm4gZTIuY2FsbChpMiwgImV4cHJlc3Npb24iKTsKICAgICAgICAgIGlmIChadyhvMikpIHsKICAgICAgICAgICAgaWYgKHNUKGUyLCB0MiwgbjIpLmxhYmVsID09PSAibWVtYmVyLWNoYWluIikKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHIzID0gdFQobzIpOwogICAgICAgICAgICByZXR1cm4gISEocjMubGVuZ3RoID09PSAwIHx8IHIzLmxlbmd0aCA9PT0gMSAmJiBoVChyM1swXSwgdDIpKSAmJiAoIWdUKG8yLCBuMikgJiYgZTIuY2FsbChpMiwgImNhbGxlZSIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlVChvMikgPyBlMi5jYWxsKGkyLCAib2JqZWN0IikgOiByMiAmJiAobzIudHlwZSA9PT0gIklkZW50aWZpZXIiIHx8IG8yLnR5cGUgPT09ICJUaGlzRXhwcmVzc2lvbiIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBoVChlMiwgdDIpIHsKICAgICAgICAgIGxldCB7IHByaW50V2lkdGg6IG4yIH0gPSB0MjsKICAgICAgICAgIGlmIChyVChlMikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIGNvbnN0IHIyID0gMC4yNSAqIG4yOwogICAgICAgICAgaWYgKGUyLnR5cGUgPT09ICJUaGlzRXhwcmVzc2lvbiIgfHwgZTIudHlwZSA9PT0gIklkZW50aWZpZXIiICYmIGUyLm5hbWUubGVuZ3RoIDw9IHIyIHx8IG9UKGUyKSAmJiAhclQoZTIuYXJndW1lbnQpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIGNvbnN0IG8yID0gZTIudHlwZSA9PT0gIkxpdGVyYWwiICYmICJyZWdleCIgaW4gZTIgJiYgZTIucmVnZXgucGF0dGVybiB8fCBlMi50eXBlID09PSAiUmVnRXhwTGl0ZXJhbCIgJiYgZTIucGF0dGVybjsKICAgICAgICAgIHJldHVybiBvMiA/IG8yLmxlbmd0aCA8PSByMiA6IFl3KGUyKSA/IG5UKGUyKS5sZW5ndGggPD0gcjIgOiBlMi50eXBlID09PSAiVGVtcGxhdGVMaXRlcmFsIiA/IGUyLmV4cHJlc3Npb25zLmxlbmd0aCA9PT0gMCAmJiBlMi5xdWFzaXNbMF0udmFsdWUucmF3Lmxlbmd0aCA8PSByMiAmJiAhZTIucXVhc2lzWzBdLnZhbHVlLnJhdy5pbmNsdWRlcygiXG4iKSA6IEt3KGUyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZ1QoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMy50eXBlUGFyYW1ldGVycyAmJiBlMy50eXBlUGFyYW1ldGVycy5wYXJhbXMgfHwgZTMudHlwZUFyZ3VtZW50cyAmJiBlMy50eXBlQXJndW1lbnRzLnBhcmFtczsKICAgICAgICAgIH0oZTIpOwogICAgICAgICAgaWYgKFJ3KG4yKSkgewogICAgICAgICAgICBpZiAobjIubGVuZ3RoID4gMSkKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKG4yLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gbjJbMF07CiAgICAgICAgICAgICAgaWYgKGUzLnR5cGUgPT09ICJUU1VuaW9uVHlwZSIgfHwgZTMudHlwZSA9PT0gIlVuaW9uVHlwZUFubm90YXRpb24iIHx8IGUzLnR5cGUgPT09ICJUU0ludGVyc2VjdGlvblR5cGUiIHx8IGUzLnR5cGUgPT09ICJJbnRlcnNlY3Rpb25UeXBlQW5ub3RhdGlvbiIpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCByMiA9IGUyLnR5cGVQYXJhbWV0ZXJzID8gInR5cGVQYXJhbWV0ZXJzIiA6ICJ0eXBlQXJndW1lbnRzIjsKICAgICAgICAgICAgaWYgKEd3KHQyKHIyKSkpCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciBtVCA9IHsgcHJpbnRWYXJpYWJsZURlY2xhcmF0b3I6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBhVChlMiwgdDIsIG4yLCBuMigiaWQiKSwgIiA9IiwgImluaXQiKTsKICAgICAgICB9LCBwcmludEFzc2lnbm1lbnRFeHByZXNzaW9uOiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICByZXR1cm4gYVQoZTIsIHQyLCBuMiwgbjIoImxlZnQiKSwgWyIgIiwgcjIub3BlcmF0b3JdLCAicmlnaHQiKTsKICAgICAgICB9LCBwcmludEFzc2lnbm1lbnQ6IGFULCBpc0Fycm93RnVuY3Rpb25WYXJpYWJsZURlY2xhcmF0b3I6IHBUIH07CiAgICAgICAgY29uc3QgeyBnZXROZXh0Tm9uU3BhY2VOb25Db21tZW50Q2hhcmFjdGVyOiB5VCB9ID0gZGMsIHsgcHJpbnREYW5nbGluZ0NvbW1lbnRzOiBEVCB9ID0gdEQsIHsgYnVpbGRlcnM6IHsgbGluZTogRVQsIGhhcmRsaW5lOiBDVCwgc29mdGxpbmU6IGJULCBncm91cDogdlQsIGluZGVudDogQVQsIGlmQnJlYWs6IEZUIH0sIHV0aWxzOiB7IHJlbW92ZUxpbmVzOiB4VCwgd2lsbEJyZWFrOiBTVCB9IH0gPSBaYywgeyBnZXRGdW5jdGlvblBhcmFtZXRlcnM6IHdULCBpdGVyYXRlRnVuY3Rpb25QYXJhbWV0ZXJzUGF0aDogVFQsIGlzU2ltcGxlVHlwZTogQlQsIGlzVGVzdENhbGw6IE5ULCBpc1R5cGVBbm5vdGF0aW9uQUZ1bmN0aW9uOiBrVCwgaXNPYmplY3RUeXBlOiBQVCwgaXNPYmplY3RUeXBlUHJvcGVydHlBRnVuY3Rpb246IE9ULCBoYXNSZXN0UGFyYW1ldGVyOiBJVCwgc2hvdWxkUHJpbnRDb21tYTogTFQsIGhhc0NvbW1lbnQ6IGpULCBpc05leHRMaW5lRW1wdHk6IF9UIH0gPSBDQywgeyBsb2NFbmQ6IE1UIH0gPSBvZywgeyBBcmdFeHBhbnNpb25CYWlsb3V0OiBSVCB9ID0gQ3AsIHsgcHJpbnRGdW5jdGlvblR5cGVQYXJhbWV0ZXJzOiBWVCB9ID0gX3g7CiAgICAgICAgZnVuY3Rpb24gJFQoZTIpIHsKICAgICAgICAgIGlmICghZTIpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIGNvbnN0IHQyID0gd1QoZTIpOwogICAgICAgICAgaWYgKHQyLmxlbmd0aCAhPT0gMSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgY29uc3QgW24yXSA9IHQyOwogICAgICAgICAgcmV0dXJuICFqVChuMikgJiYgKG4yLnR5cGUgPT09ICJPYmplY3RQYXR0ZXJuIiB8fCBuMi50eXBlID09PSAiQXJyYXlQYXR0ZXJuIiB8fCBuMi50eXBlID09PSAiSWRlbnRpZmllciIgJiYgbjIudHlwZUFubm90YXRpb24gJiYgKG4yLnR5cGVBbm5vdGF0aW9uLnR5cGUgPT09ICJUeXBlQW5ub3RhdGlvbiIgfHwgbjIudHlwZUFubm90YXRpb24udHlwZSA9PT0gIlRTVHlwZUFubm90YXRpb24iKSAmJiBQVChuMi50eXBlQW5ub3RhdGlvbi50eXBlQW5ub3RhdGlvbikgfHwgbjIudHlwZSA9PT0gIkZ1bmN0aW9uVHlwZVBhcmFtIiAmJiBQVChuMi50eXBlQW5ub3RhdGlvbikgfHwgbjIudHlwZSA9PT0gIkFzc2lnbm1lbnRQYXR0ZXJuIiAmJiAobjIubGVmdC50eXBlID09PSAiT2JqZWN0UGF0dGVybiIgfHwgbjIubGVmdC50eXBlID09PSAiQXJyYXlQYXR0ZXJuIikgJiYgKG4yLnJpZ2h0LnR5cGUgPT09ICJJZGVudGlmaWVyIiB8fCBuMi5yaWdodC50eXBlID09PSAiT2JqZWN0RXhwcmVzc2lvbiIgJiYgbjIucmlnaHQucHJvcGVydGllcy5sZW5ndGggPT09IDAgfHwgbjIucmlnaHQudHlwZSA9PT0gIkFycmF5RXhwcmVzc2lvbiIgJiYgbjIucmlnaHQuZWxlbWVudHMubGVuZ3RoID09PSAwKSk7CiAgICAgICAgfQogICAgICAgIHZhciBXVCA9IHsgcHJpbnRGdW5jdGlvblBhcmFtZXRlcnM6IGZ1bmN0aW9uKGUyLCB0MiwgbjIsIHIyLCBvMikgewogICAgICAgICAgY29uc3QgaTIgPSBlMi5nZXRWYWx1ZSgpLCB1MiA9IHdUKGkyKSwgczIgPSBvMiA/IFZUKGUyLCBuMiwgdDIpIDogIiI7CiAgICAgICAgICBpZiAodTIubGVuZ3RoID09PSAwKQogICAgICAgICAgICByZXR1cm4gW3MyLCAiKCIsIERUKGUyLCBuMiwgdHJ1ZSwgKGUzKSA9PiB5VChuMi5vcmlnaW5hbFRleHQsIGUzLCBNVCkgPT09ICIpIiksICIpIl07CiAgICAgICAgICBjb25zdCBhMiA9IGUyLmdldFBhcmVudE5vZGUoKSwgYzIgPSBOVChhMiksIGwyID0gJFQoaTIpLCBwMiA9IFtdOwogICAgICAgICAgaWYgKFRUKGUyLCAoZTMsIHIzKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IG8zID0gcjMgPT09IHUyLmxlbmd0aCAtIDE7CiAgICAgICAgICAgIG8zICYmIGkyLnJlc3QgJiYgcDIucHVzaCgiLi4uIiksIHAyLnB1c2godDIoKSksIG8zIHx8IChwMi5wdXNoKCIsIiksIGMyIHx8IGwyID8gcDIucHVzaCgiICIpIDogX1QodTJbcjNdLCBuMikgPyBwMi5wdXNoKENULCBDVCkgOiBwMi5wdXNoKEVUKSk7CiAgICAgICAgICB9KSwgcjIpIHsKICAgICAgICAgICAgaWYgKFNUKHMyKSB8fCBTVChwMikpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFJUKCk7CiAgICAgICAgICAgIHJldHVybiB2VChbeFQoczIpLCAiKCIsIHhUKHAyKSwgIikiXSk7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBmMiA9IHUyLmV2ZXJ5KChlMykgPT4gIWUzLmRlY29yYXRvcnMpOwogICAgICAgICAgcmV0dXJuIGwyICYmIGYyIHx8IGMyID8gW3MyLCAiKCIsIC4uLnAyLCAiKSJdIDogKE9UKGEyKSB8fCBrVChhMikgfHwgYTIudHlwZSA9PT0gIlR5cGVBbGlhcyIgfHwgYTIudHlwZSA9PT0gIlVuaW9uVHlwZUFubm90YXRpb24iIHx8IGEyLnR5cGUgPT09ICJUU1VuaW9uVHlwZSIgfHwgYTIudHlwZSA9PT0gIkludGVyc2VjdGlvblR5cGVBbm5vdGF0aW9uIiB8fCBhMi50eXBlID09PSAiRnVuY3Rpb25UeXBlQW5ub3RhdGlvbiIgJiYgYTIucmV0dXJuVHlwZSA9PT0gaTIpICYmIHUyLmxlbmd0aCA9PT0gMSAmJiB1MlswXS5uYW1lID09PSBudWxsICYmIGkyLnRoaXMgIT09IHUyWzBdICYmIHUyWzBdLnR5cGVBbm5vdGF0aW9uICYmIGkyLnR5cGVQYXJhbWV0ZXJzID09PSBudWxsICYmIEJUKHUyWzBdLnR5cGVBbm5vdGF0aW9uKSAmJiAhaTIucmVzdCA/IG4yLmFycm93UGFyZW5zID09PSAiYWx3YXlzIiA/IFsiKCIsIC4uLnAyLCAiKSJdIDogcDIgOiBbczIsICIoIiwgQVQoW2JULCAuLi5wMl0pLCBGVCghSVQoaTIpICYmIExUKG4yLCAiYWxsIikgPyAiLCIgOiAiIiksIGJULCAiKSJdOwogICAgICAgIH0sIHNob3VsZEh1Z0Z1bmN0aW9uUGFyYW1ldGVyczogJFQsIHNob3VsZEdyb3VwRnVuY3Rpb25QYXJhbWV0ZXJzOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgbGV0IHQzOwogICAgICAgICAgICByZXR1cm4gZTMucmV0dXJuVHlwZSA/ICh0MyA9IGUzLnJldHVyblR5cGUsIHQzLnR5cGVBbm5vdGF0aW9uICYmICh0MyA9IHQzLnR5cGVBbm5vdGF0aW9uKSkgOiBlMy50eXBlQW5ub3RhdGlvbiAmJiAodDMgPSBlMy50eXBlQW5ub3RhdGlvbiksIHQzOwogICAgICAgICAgfShlMik7CiAgICAgICAgICBpZiAoIW4yKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBjb25zdCByMiA9IGUyLnR5cGVQYXJhbWV0ZXJzICYmIGUyLnR5cGVQYXJhbWV0ZXJzLnBhcmFtczsKICAgICAgICAgIGlmIChyMikgewogICAgICAgICAgICBpZiAocjIubGVuZ3RoID4gMSkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChyMi5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IHIyWzBdOwogICAgICAgICAgICAgIGlmIChlMy5jb25zdHJhaW50IHx8IGUzLmRlZmF1bHQpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB3VChlMikubGVuZ3RoID09PSAxICYmIChQVChuMikgfHwgU1QodDIpKTsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgeyBwcmludENvbW1lbnRzOiBxVCwgcHJpbnREYW5nbGluZ0NvbW1lbnRzOiBVVCB9ID0gdEQsIHsgZ2V0TGFzdDogelQsIGlzTm9uRW1wdHlBcnJheTogR1QgfSA9IGRjLCB7IGJ1aWxkZXJzOiB7IGdyb3VwOiBIVCwgam9pbjogSlQsIGxpbmU6IFhULCBzb2Z0bGluZTogWVQsIGluZGVudDogS1QsIGFsaWduOiBRVCwgaWZCcmVhazogWlQgfSB9ID0gWmMsIGVCID0gd0EsIHsgbG9jU3RhcnQ6IHRCIH0gPSBvZywgeyBpc1NpbXBsZVR5cGU6IG5CLCBpc09iamVjdFR5cGU6IHJCLCBoYXNMZWFkaW5nT3duTGluZUNvbW1lbnQ6IG9CLCBpc09iamVjdFR5cGVQcm9wZXJ0eUFGdW5jdGlvbjogaUIsIHNob3VsZFByaW50Q29tbWE6IHVCIH0gPSBDQywgeyBwcmludEFzc2lnbm1lbnQ6IHNCIH0gPSBtVCwgeyBwcmludEZ1bmN0aW9uUGFyYW1ldGVyczogYUIsIHNob3VsZEdyb3VwRnVuY3Rpb25QYXJhbWV0ZXJzOiBjQiB9ID0gV1QsIHsgcHJpbnRBcnJheUl0ZW1zOiBsQiB9ID0gdVM7CiAgICAgICAgZnVuY3Rpb24gcEIoZTIpIHsKICAgICAgICAgIGlmIChuQihlMikgfHwgckIoZTIpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIGlmIChlMi50eXBlID09PSAiVW5pb25UeXBlQW5ub3RhdGlvbiIgfHwgZTIudHlwZSA9PT0gIlRTVW5pb25UeXBlIikgewogICAgICAgICAgICBjb25zdCB0MiA9IGUyLnR5cGVzLmZpbHRlcigoZTMpID0+IGUzLnR5cGUgPT09ICJWb2lkVHlwZUFubm90YXRpb24iIHx8IGUzLnR5cGUgPT09ICJUU1ZvaWRLZXl3b3JkIiB8fCBlMy50eXBlID09PSAiTnVsbExpdGVyYWxUeXBlQW5ub3RhdGlvbiIgfHwgZTMudHlwZSA9PT0gIlRTTnVsbEtleXdvcmQiKS5sZW5ndGgsIG4yID0gZTIudHlwZXMuc29tZSgoZTMpID0+IGUzLnR5cGUgPT09ICJPYmplY3RUeXBlQW5ub3RhdGlvbiIgfHwgZTMudHlwZSA9PT0gIlRTVHlwZUxpdGVyYWwiIHx8IGUzLnR5cGUgPT09ICJHZW5lcmljVHlwZUFubm90YXRpb24iIHx8IGUzLnR5cGUgPT09ICJUU1R5cGVSZWZlcmVuY2UiKTsKICAgICAgICAgICAgaWYgKGUyLnR5cGVzLmxlbmd0aCAtIDEgPT09IHQyICYmIG4yKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgZkIgPSB7IHByaW50T3BhcXVlVHlwZTogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSB0Mi5zZW1pID8gIjsiIDogIiIsIG8yID0gZTIuZ2V0VmFsdWUoKSwgaTIgPSBbXTsKICAgICAgICAgIHJldHVybiBpMi5wdXNoKCJvcGFxdWUgdHlwZSAiLCBuMigiaWQiKSwgbjIoInR5cGVQYXJhbWV0ZXJzIikpLCBvMi5zdXBlcnR5cGUgJiYgaTIucHVzaCgiOiAiLCBuMigic3VwZXJ0eXBlIikpLCBvMi5pbXBsdHlwZSAmJiBpMi5wdXNoKCIgPSAiLCBuMigiaW1wbHR5cGUiKSksIGkyLnB1c2gocjIpLCBpMjsKICAgICAgICB9LCBwcmludFR5cGVBbGlhczogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSB0Mi5zZW1pID8gIjsiIDogIiIsIG8yID0gZTIuZ2V0VmFsdWUoKSwgaTIgPSBbXTsKICAgICAgICAgIG8yLmRlY2xhcmUgJiYgaTIucHVzaCgiZGVjbGFyZSAiKSwgaTIucHVzaCgidHlwZSAiLCBuMigiaWQiKSwgbjIoInR5cGVQYXJhbWV0ZXJzIikpOwogICAgICAgICAgY29uc3QgdTIgPSBvMi50eXBlID09PSAiVFNUeXBlQWxpYXNEZWNsYXJhdGlvbiIgPyAidHlwZUFubm90YXRpb24iIDogInJpZ2h0IjsKICAgICAgICAgIHJldHVybiBbc0IoZTIsIHQyLCBuMiwgaTIsICIgPSIsIHUyKSwgcjJdOwogICAgICAgIH0sIHByaW50SW50ZXJzZWN0aW9uVHlwZTogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLCBvMiA9IGUyLm1hcChuMiwgInR5cGVzIiksIGkyID0gW107CiAgICAgICAgICBsZXQgdTIgPSBmYWxzZTsKICAgICAgICAgIGZvciAobGV0IGUzID0gMDsgZTMgPCBvMi5sZW5ndGg7ICsrZTMpCiAgICAgICAgICAgIGUzID09PSAwID8gaTIucHVzaChvMltlM10pIDogckIocjIudHlwZXNbZTMgLSAxXSkgJiYgckIocjIudHlwZXNbZTNdKSA/IGkyLnB1c2goWyIgJiAiLCB1MiA/IEtUKG8yW2UzXSkgOiBvMltlM11dKSA6IHJCKHIyLnR5cGVzW2UzIC0gMV0pIHx8IHJCKHIyLnR5cGVzW2UzXSkgPyAoZTMgPiAxICYmICh1MiA9IHRydWUpLCBpMi5wdXNoKCIgJiAiLCBlMyA+IDEgPyBLVChvMltlM10pIDogbzJbZTNdKSkgOiBpMi5wdXNoKEtUKFsiICYiLCBYVCwgbzJbZTNdXSkpOwogICAgICAgICAgcmV0dXJuIEhUKGkyKTsKICAgICAgICB9LCBwcmludFVuaW9uVHlwZTogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLCBvMiA9IGUyLmdldFBhcmVudE5vZGUoKSwgaTIgPSAhKG8yLnR5cGUgPT09ICJUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbiIgfHwgbzIudHlwZSA9PT0gIlRTVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iIHx8IG8yLnR5cGUgPT09ICJHZW5lcmljVHlwZUFubm90YXRpb24iIHx8IG8yLnR5cGUgPT09ICJUU1R5cGVSZWZlcmVuY2UiIHx8IG8yLnR5cGUgPT09ICJUU1R5cGVBc3NlcnRpb24iIHx8IG8yLnR5cGUgPT09ICJUdXBsZVR5cGVBbm5vdGF0aW9uIiB8fCBvMi50eXBlID09PSAiVFNUdXBsZVR5cGUiIHx8IG8yLnR5cGUgPT09ICJGdW5jdGlvblR5cGVQYXJhbSIgJiYgIW8yLm5hbWUgJiYgZTIuZ2V0UGFyZW50Tm9kZSgxKS50aGlzICE9PSBvMiB8fCAobzIudHlwZSA9PT0gIlR5cGVBbGlhcyIgfHwgbzIudHlwZSA9PT0gIlZhcmlhYmxlRGVjbGFyYXRvciIgfHwgbzIudHlwZSA9PT0gIlRTVHlwZUFsaWFzRGVjbGFyYXRpb24iKSAmJiBvQih0Mi5vcmlnaW5hbFRleHQsIHIyKSksIHUyID0gcEIocjIpLCBzMiA9IGUyLm1hcCgoZTMpID0+IHsKICAgICAgICAgICAgbGV0IHIzID0gbjIoKTsKICAgICAgICAgICAgcmV0dXJuIHUyIHx8IChyMyA9IFFUKDIsIHIzKSksIHFUKGUzLCByMywgdDIpOwogICAgICAgICAgfSwgInR5cGVzIik7CiAgICAgICAgICBpZiAodTIpCiAgICAgICAgICAgIHJldHVybiBKVCgiIHwgIiwgczIpOwogICAgICAgICAgY29uc3QgYTIgPSBpMiAmJiAhb0IodDIub3JpZ2luYWxUZXh0LCByMiksIGMyID0gW1pUKFthMiA/IFhUIDogIiIsICJ8ICJdKSwgSlQoW1hULCAifCAiXSwgczIpXTsKICAgICAgICAgIHJldHVybiBlQihlMiwgdDIpID8gSFQoW0tUKGMyKSwgWVRdKSA6IG8yLnR5cGUgPT09ICJUdXBsZVR5cGVBbm5vdGF0aW9uIiAmJiBvMi50eXBlcy5sZW5ndGggPiAxIHx8IG8yLnR5cGUgPT09ICJUU1R1cGxlVHlwZSIgJiYgbzIuZWxlbWVudFR5cGVzLmxlbmd0aCA+IDEgPyBIVChbS1QoW1pUKFsiKCIsIFlUXSksIGMyXSksIFlULCBaVCgiKSIpXSkgOiBIVChpMiA/IEtUKGMyKSA6IGMyKTsKICAgICAgICB9LCBwcmludEZ1bmN0aW9uVHlwZTogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLCBvMiA9IFtdLCBpMiA9IGUyLmdldFBhcmVudE5vZGUoMCksIHUyID0gZTIuZ2V0UGFyZW50Tm9kZSgxKSwgczIgPSBlMi5nZXRQYXJlbnROb2RlKDIpOwogICAgICAgICAgbGV0IGEyID0gcjIudHlwZSA9PT0gIlRTRnVuY3Rpb25UeXBlIiB8fCAhKChpMi50eXBlID09PSAiT2JqZWN0VHlwZVByb3BlcnR5IiB8fCBpMi50eXBlID09PSAiT2JqZWN0VHlwZUludGVybmFsU2xvdCIpICYmICFpMi52YXJpYW5jZSAmJiAhaTIub3B0aW9uYWwgJiYgdEIoaTIpID09PSB0QihyMikgfHwgaTIudHlwZSA9PT0gIk9iamVjdFR5cGVDYWxsUHJvcGVydHkiIHx8IHMyICYmIHMyLnR5cGUgPT09ICJEZWNsYXJlRnVuY3Rpb24iKSwgYzIgPSBhMiAmJiAoaTIudHlwZSA9PT0gIlR5cGVBbm5vdGF0aW9uIiB8fCBpMi50eXBlID09PSAiVFNUeXBlQW5ub3RhdGlvbiIpOwogICAgICAgICAgY29uc3QgbDIgPSBjMiAmJiBhMiAmJiAoaTIudHlwZSA9PT0gIlR5cGVBbm5vdGF0aW9uIiB8fCBpMi50eXBlID09PSAiVFNUeXBlQW5ub3RhdGlvbiIpICYmIHUyLnR5cGUgPT09ICJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiI7CiAgICAgICAgICBpQihpMikgJiYgKGEyID0gdHJ1ZSwgYzIgPSB0cnVlKSwgbDIgJiYgbzIucHVzaCgiKCIpOwogICAgICAgICAgY29uc3QgcDIgPSBhQihlMiwgbjIsIHQyLCBmYWxzZSwgdHJ1ZSksIGYyID0gcjIucmV0dXJuVHlwZSB8fCByMi5wcmVkaWNhdGUgfHwgcjIudHlwZUFubm90YXRpb24gPyBbYTIgPyAiID0+ICIgOiAiOiAiLCBuMigicmV0dXJuVHlwZSIpLCBuMigicHJlZGljYXRlIiksIG4yKCJ0eXBlQW5ub3RhdGlvbiIpXSA6ICIiLCBkMiA9IGNCKHIyLCBmMik7CiAgICAgICAgICByZXR1cm4gbzIucHVzaChkMiA/IEhUKHAyKSA6IHAyKSwgZjIgJiYgbzIucHVzaChmMiksIGwyICYmIG8yLnB1c2goIikiKSwgSFQobzIpOwogICAgICAgIH0sIHByaW50VHVwbGVUeXBlOiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCksIG8yID0gcjIudHlwZSA9PT0gIlRTVHVwbGVUeXBlIiA/ICJlbGVtZW50VHlwZXMiIDogInR5cGVzIiwgaTIgPSByMltvMl0sIHUyID0gR1QoaTIpLCBzMiA9IHUyICYmIHpUKGkyKS50eXBlID09PSAiVFNSZXN0VHlwZSIsIGEyID0gdTIgPyBZVCA6ICIiOwogICAgICAgICAgcmV0dXJuIEhUKFsiWyIsIEtUKFthMiwgbEIoZTIsIHQyLCBvMiwgbjIpXSksIFpUKHUyICYmIHVCKHQyLCAiYWxsIikgJiYgIXMyID8gIiwiIDogIiIpLCBVVChlMiwgdDIsIHRydWUpLCBhMiwgIl0iXSk7CiAgICAgICAgfSwgcHJpbnRJbmRleGVkQWNjZXNzVHlwZTogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLCBvMiA9IHIyLnR5cGUgPT09ICJPcHRpb25hbEluZGV4ZWRBY2Nlc3NUeXBlIiAmJiByMi5vcHRpb25hbCA/ICI/LlsiIDogIlsiOwogICAgICAgICAgcmV0dXJuIFtuMigib2JqZWN0VHlwZSIpLCBvMiwgbjIoImluZGV4VHlwZSIpLCAiXSJdOwogICAgICAgIH0sIHNob3VsZEh1Z1R5cGU6IHBCIH07CiAgICAgICAgY29uc3QgeyBwcmludERhbmdsaW5nQ29tbWVudHM6IGRCIH0gPSB0RCwgeyBidWlsZGVyczogeyBqb2luOiBoQiwgbGluZTogZ0IsIGhhcmRsaW5lOiBtQiwgc29mdGxpbmU6IHlCLCBncm91cDogREIsIGluZGVudDogRUIsIGlmQnJlYWs6IENCIH0gfSA9IFpjLCB7IGlzVGVzdENhbGw6IGJCLCBoYXNDb21tZW50OiB2QiwgQ29tbWVudENoZWNrRmxhZ3M6IEFCLCBpc1RTWEZpbGU6IEZCLCBzaG91bGRQcmludENvbW1hOiB4QiwgZ2V0RnVuY3Rpb25QYXJhbWV0ZXJzOiBTQiwgaXNPYmplY3RUeXBlOiB3QiB9ID0gQ0MsIHsgY3JlYXRlR3JvdXBJZE1hcHBlcjogVEIgfSA9IGRjLCB7IHNob3VsZEh1Z1R5cGU6IEJCIH0gPSBmQiwgeyBpc0Fycm93RnVuY3Rpb25WYXJpYWJsZURlY2xhcmF0b3I6IE5CIH0gPSBtVCwga0IgPSBUQigidHlwZVBhcmFtZXRlcnMiKTsKICAgICAgICBmdW5jdGlvbiBQQihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIGlmICghdkIobjIsIEFCLkRhbmdsaW5nKSkKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgY29uc3QgcjIgPSAhdkIobjIsIEFCLkxpbmUpLCBvMiA9IGRCKGUyLCB0MiwgcjIpOwogICAgICAgICAgcmV0dXJuIHIyID8gbzIgOiBbbzIsIG1CXTsKICAgICAgICB9CiAgICAgICAgdmFyIE9CID0geyBwcmludFR5cGVQYXJhbWV0ZXI6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKSwgbzIgPSBbXSwgaTIgPSBlMi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICByZXR1cm4gaTIudHlwZSA9PT0gIlRTTWFwcGVkVHlwZSIgPyAobzIucHVzaCgiWyIsIG4yKCJuYW1lIikpLCByMi5jb25zdHJhaW50ICYmIG8yLnB1c2goIiBpbiAiLCBuMigiY29uc3RyYWludCIpKSwgaTIubmFtZVR5cGUgJiYgbzIucHVzaCgiIGFzICIsIGUyLmNhbGxQYXJlbnQoKCkgPT4gbjIoIm5hbWVUeXBlIikpKSwgbzIucHVzaCgiXSIpLCBvMikgOiAocjIudmFyaWFuY2UgJiYgbzIucHVzaChuMigidmFyaWFuY2UiKSksIG8yLnB1c2gobjIoIm5hbWUiKSksIHIyLmJvdW5kICYmIG8yLnB1c2goIjogIiwgbjIoImJvdW5kIikpLCByMi5jb25zdHJhaW50ICYmIG8yLnB1c2goIiBleHRlbmRzICIsIG4yKCJjb25zdHJhaW50IikpLCByMi5kZWZhdWx0ICYmIG8yLnB1c2goIiA9ICIsIG4yKCJkZWZhdWx0IikpLCBvMik7CiAgICAgICAgfSwgcHJpbnRUeXBlUGFyYW1ldGVyczogZnVuY3Rpb24oZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIGNvbnN0IG8yID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIGlmICghbzJbcjJdKQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobzJbcjJdKSkKICAgICAgICAgICAgcmV0dXJuIG4yKHIyKTsKICAgICAgICAgIGNvbnN0IGkyID0gZTIuZ2V0Tm9kZSgyKSwgdTIgPSBpMiAmJiBiQihpMiksIHMyID0gZTIubWF0Y2goKGUzKSA9PiAhKGUzW3IyXS5sZW5ndGggPT09IDEgJiYgd0IoZTNbcjJdWzBdKSksIHZvaWQgMCwgKGUzLCB0MykgPT4gdDMgPT09ICJ0eXBlQW5ub3RhdGlvbiIsIChlMykgPT4gZTMudHlwZSA9PT0gIklkZW50aWZpZXIiLCBOQik7CiAgICAgICAgICBpZiAoIXMyICYmICh1MiB8fCBvMltyMl0ubGVuZ3RoID09PSAwIHx8IG8yW3IyXS5sZW5ndGggPT09IDEgJiYgKG8yW3IyXVswXS50eXBlID09PSAiTnVsbGFibGVUeXBlQW5ub3RhdGlvbiIgfHwgQkIobzJbcjJdWzBdKSkpKQogICAgICAgICAgICByZXR1cm4gWyI8IiwgaEIoIiwgIiwgZTIubWFwKG4yLCByMikpLCBQQihlMiwgdDIpLCAiPiJdOwogICAgICAgICAgY29uc3QgYTIgPSBvMi50eXBlID09PSAiVFNUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbiIgPyAiIiA6IFNCKG8yKS5sZW5ndGggPT09IDEgJiYgRkIodDIpICYmICFvMltyMl1bMF0uY29uc3RyYWludCAmJiBlMi5nZXRQYXJlbnROb2RlKCkudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiA/ICIsIiA6IHhCKHQyLCAiYWxsIikgPyBDQigiLCIpIDogIiI7CiAgICAgICAgICByZXR1cm4gREIoWyI8IiwgRUIoW3lCLCBoQihbIiwiLCBnQl0sIGUyLm1hcChuMiwgcjIpKV0pLCBhMiwgeUIsICI+Il0sIHsgaWQ6IGtCKG8yKSB9KTsKICAgICAgICB9LCBnZXRUeXBlUGFyYW1ldGVyc0dyb3VwSWQ6IGtCIH07CiAgICAgICAgY29uc3QgeyBwcmludENvbW1lbnRzOiBJQiB9ID0gdEQsIHsgcHJpbnRTdHJpbmc6IExCLCBwcmludE51bWJlcjogakIgfSA9IGRjLCB7IGlzTnVtZXJpY0xpdGVyYWw6IF9CLCBpc1NpbXBsZU51bWJlcjogTUIsIGlzU3RyaW5nTGl0ZXJhbDogUkIsIGlzU3RyaW5nUHJvcFNhZmVUb1VucXVvdGU6IFZCLCByYXdUZXh0OiAkQiB9ID0gQ0MsIHsgcHJpbnRBc3NpZ25tZW50OiBXQiB9ID0gbVQsIHFCID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7CiAgICAgICAgZnVuY3Rpb24gVUIoZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXROb2RlKCk7CiAgICAgICAgICBpZiAocjIuY29tcHV0ZWQpCiAgICAgICAgICAgIHJldHVybiBbIlsiLCBuMigia2V5IiksICJdIl07CiAgICAgICAgICBjb25zdCBvMiA9IGUyLmdldFBhcmVudE5vZGUoKSwgeyBrZXk6IGkyIH0gPSByMjsKICAgICAgICAgIGlmIChyMi50eXBlID09PSAiQ2xhc3NQcml2YXRlUHJvcGVydHkiICYmIGkyLnR5cGUgPT09ICJJZGVudGlmaWVyIikKICAgICAgICAgICAgcmV0dXJuIFsiIyIsIG4yKCJrZXkiKV07CiAgICAgICAgICBpZiAodDIucXVvdGVQcm9wcyA9PT0gImNvbnNpc3RlbnQiICYmICFxQi5oYXMobzIpKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gKG8yLnByb3BlcnRpZXMgfHwgbzIuYm9keSB8fCBvMi5tZW1iZXJzKS5zb21lKChlNCkgPT4gIWU0LmNvbXB1dGVkICYmIGU0LmtleSAmJiBSQihlNC5rZXkpICYmICFWQihlNCwgdDIpKTsKICAgICAgICAgICAgcUIuc2V0KG8yLCBlMyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoKGkyLnR5cGUgPT09ICJJZGVudGlmaWVyIiB8fCBfQihpMikgJiYgTUIoakIoJEIoaTIpKSkgJiYgU3RyaW5nKGkyLnZhbHVlKSA9PT0gakIoJEIoaTIpKSAmJiB0Mi5wYXJzZXIgIT09ICJ0eXBlc2NyaXB0IiAmJiB0Mi5wYXJzZXIgIT09ICJiYWJlbC10cyIpICYmICh0Mi5wYXJzZXIgPT09ICJqc29uIiB8fCB0Mi5xdW90ZVByb3BzID09PSAiY29uc2lzdGVudCIgJiYgcUIuZ2V0KG8yKSkpIHsKICAgICAgICAgICAgY29uc3QgbjMgPSBMQihKU09OLnN0cmluZ2lmeShpMi50eXBlID09PSAiSWRlbnRpZmllciIgPyBpMi5uYW1lIDogaTIudmFsdWUudG9TdHJpbmcoKSksIHQyKTsKICAgICAgICAgICAgcmV0dXJuIGUyLmNhbGwoKGUzKSA9PiBJQihlMywgbjMsIHQyKSwgImtleSIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFZCKHIyLCB0MikgJiYgKHQyLnF1b3RlUHJvcHMgPT09ICJhcy1uZWVkZWQiIHx8IHQyLnF1b3RlUHJvcHMgPT09ICJjb25zaXN0ZW50IiAmJiAhcUIuZ2V0KG8yKSkgPyBlMi5jYWxsKChlMykgPT4gSUIoZTMsIC9eXGQvLnRlc3QoaTIudmFsdWUpID8gakIoaTIudmFsdWUpIDogaTIudmFsdWUsIHQyKSwgImtleSIpIDogbjIoImtleSIpOwogICAgICAgIH0KICAgICAgICB2YXIgekIgPSB7IHByaW50UHJvcGVydHk6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBlMi5nZXRWYWx1ZSgpLnNob3J0aGFuZCA/IG4yKCJ2YWx1ZSIpIDogV0IoZTIsIHQyLCBuMiwgVUIoZTIsIHQyLCBuMiksICI6IiwgInZhbHVlIik7CiAgICAgICAgfSwgcHJpbnRQcm9wZXJ0eUtleTogVUIgfTsKICAgICAgICBjb25zdCBHQiA9IFR5LCB7IHByaW50RGFuZ2xpbmdDb21tZW50czogSEIsIHByaW50Q29tbWVudHNTZXBhcmF0ZWx5OiBKQiB9ID0gdEQsIFhCID0gYXUsIHsgZ2V0TmV4dE5vblNwYWNlTm9uQ29tbWVudENoYXJhY3RlckluZGV4OiBZQiB9ID0gZGMsIHsgYnVpbGRlcnM6IHsgbGluZTogS0IsIHNvZnRsaW5lOiBRQiwgZ3JvdXA6IFpCLCBpbmRlbnQ6IGVOLCBpZkJyZWFrOiB0TiwgaGFyZGxpbmU6IG5OLCBqb2luOiByTiwgaW5kZW50SWZCcmVhazogb04gfSwgdXRpbHM6IHsgcmVtb3ZlTGluZXM6IGlOLCB3aWxsQnJlYWs6IHVOIH0gfSA9IFpjLCB7IEFyZ0V4cGFuc2lvbkJhaWxvdXQ6IHNOIH0gPSBDcCwgeyBnZXRGdW5jdGlvblBhcmFtZXRlcnM6IGFOLCBoYXNMZWFkaW5nT3duTGluZUNvbW1lbnQ6IGNOLCBpc0Zsb3dBbm5vdGF0aW9uQ29tbWVudDogbE4sIGlzSnN4Tm9kZTogcE4sIGlzVGVtcGxhdGVPbkl0c093bkxpbmU6IGZOLCBzaG91bGRQcmludENvbW1hOiBkTiwgc3RhcnRzV2l0aE5vTG9va2FoZWFkVG9rZW46IGhOLCBpc0JpbmFyeWlzaDogZ04sIGlzTGluZUNvbW1lbnQ6IG1OLCBoYXNDb21tZW50OiB5TiwgZ2V0Q29tbWVudHM6IEROLCBDb21tZW50Q2hlY2tGbGFnczogRU4sIGlzQ2FsbExpa2VFeHByZXNzaW9uOiBDTiwgaXNDYWxsRXhwcmVzc2lvbjogYk4sIGdldENhbGxBcmd1bWVudHM6IHZOLCBoYXNOYWtlZExlZnRTaWRlOiBBTiwgZ2V0TGVmdFNpZGU6IEZOIH0gPSBDQywgeyBsb2NFbmQ6IHhOIH0gPSBvZywgeyBwcmludEZ1bmN0aW9uUGFyYW1ldGVyczogU04sIHNob3VsZEdyb3VwRnVuY3Rpb25QYXJhbWV0ZXJzOiB3TiB9ID0gV1QsIHsgcHJpbnRQcm9wZXJ0eUtleTogVE4gfSA9IHpCLCB7IHByaW50RnVuY3Rpb25UeXBlUGFyYW1ldGVyczogQk4gfSA9IF94OwogICAgICAgIGZ1bmN0aW9uIE5OKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0Tm9kZSgpLCBvMiA9IFNOKGUyLCBuMiwgdDIpLCBpMiA9IFBOKGUyLCBuMiwgdDIpLCB1MiA9IHdOKHIyLCBpMiksIHMyID0gW0JOKGUyLCB0MiwgbjIpLCBaQihbdTIgPyBaQihvMikgOiBvMiwgaTJdKV07CiAgICAgICAgICByZXR1cm4gcjIuYm9keSA/IHMyLnB1c2goIiAiLCBuMigiYm9keSIpKSA6IHMyLnB1c2godDIuc2VtaSA/ICI7IiA6ICIiKSwgczI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGtOKGUyLCB0MikgewogICAgICAgICAgaWYgKHQyLmFycm93UGFyZW5zID09PSAiYWx3YXlzIikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgaWYgKHQyLmFycm93UGFyZW5zID09PSAiYXZvaWQiKSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMykgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gYU4oZTMpOwogICAgICAgICAgICAgIHJldHVybiAhKHQzLmxlbmd0aCAhPT0gMSB8fCBlMy50eXBlUGFyYW1ldGVycyB8fCB5TihlMywgRU4uRGFuZ2xpbmcpIHx8IHQzWzBdLnR5cGUgIT09ICJJZGVudGlmaWVyIiB8fCB0M1swXS50eXBlQW5ub3RhdGlvbiB8fCB5Tih0M1swXSkgfHwgdDNbMF0ub3B0aW9uYWwgfHwgZTMucHJlZGljYXRlIHx8IGUzLnJldHVyblR5cGUpOwogICAgICAgICAgICB9KGUyLmdldFZhbHVlKCkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBQTihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCksIG8yID0gdDIoInJldHVyblR5cGUiKTsKICAgICAgICAgIGlmIChyMi5yZXR1cm5UeXBlICYmIGxOKG4yLm9yaWdpbmFsVGV4dCwgcjIucmV0dXJuVHlwZSkpCiAgICAgICAgICAgIHJldHVybiBbIiAvKjogIiwgbzIsICIgKi8iXTsKICAgICAgICAgIGNvbnN0IGkyID0gW28yXTsKICAgICAgICAgIHJldHVybiByMi5yZXR1cm5UeXBlICYmIHIyLnJldHVyblR5cGUudHlwZUFubm90YXRpb24gJiYgaTIudW5zaGlmdCgiOiAiKSwgcjIucHJlZGljYXRlICYmIGkyLnB1c2gocjIucmV0dXJuVHlwZSA/ICIgIiA6ICI6ICIsIHQyKCJwcmVkaWNhdGUiKSksIGkyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBPTihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCksIG8yID0gdDIuc2VtaSA/ICI7IiA6ICIiLCBpMiA9IFtdOwogICAgICAgICAgcjIuYXJndW1lbnQgJiYgKCFmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgaWYgKGNOKGUzLm9yaWdpbmFsVGV4dCwgdDMpKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoQU4odDMpKSB7CiAgICAgICAgICAgICAgbGV0IG4zLCByMyA9IHQzOwogICAgICAgICAgICAgIGZvciAoOyBuMyA9IEZOKHIzKTsgKQogICAgICAgICAgICAgICAgaWYgKHIzID0gbjMsIGNOKGUzLm9yaWdpbmFsVGV4dCwgcjMpKQogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9KHQyLCByMi5hcmd1bWVudCkgPyBnTihyMi5hcmd1bWVudCkgfHwgcjIuYXJndW1lbnQudHlwZSA9PT0gIlNlcXVlbmNlRXhwcmVzc2lvbiIgPyBpMi5wdXNoKFpCKFt0TigiICgiLCAiICIpLCBlTihbUUIsIG4yKCJhcmd1bWVudCIpXSksIFFCLCB0TigiKSIpXSkpIDogaTIucHVzaCgiICIsIG4yKCJhcmd1bWVudCIpKSA6IGkyLnB1c2goWyIgKCIsIGVOKFtuTiwgbjIoImFyZ3VtZW50IildKSwgbk4sICIpIl0pKTsKICAgICAgICAgIGNvbnN0IHUyID0gRE4ocjIpLCBzMiA9IFhCKHUyKSwgYTIgPSBzMiAmJiBtTihzMik7CiAgICAgICAgICByZXR1cm4gYTIgJiYgaTIucHVzaChvMiksIHlOKHIyLCBFTi5EYW5nbGluZykgJiYgaTIucHVzaCgiICIsIEhCKGUyLCB0MiwgdHJ1ZSkpLCBhMiB8fCBpMi5wdXNoKG8yKSwgaTI7CiAgICAgICAgfQogICAgICAgIHZhciBJTiA9IHsgcHJpbnRGdW5jdGlvbjogZnVuY3Rpb24oZTIsIHQyLCBuMiwgcjIpIHsKICAgICAgICAgIGNvbnN0IG8yID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIGxldCBpMiA9IGZhbHNlOwogICAgICAgICAgaWYgKChvMi50eXBlID09PSAiRnVuY3Rpb25EZWNsYXJhdGlvbiIgfHwgbzIudHlwZSA9PT0gIkZ1bmN0aW9uRXhwcmVzc2lvbiIpICYmIHIyICYmIHIyLmV4cGFuZExhc3RBcmcpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBlMi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICAgIGJOKHQzKSAmJiB2Tih0MykubGVuZ3RoID4gMSAmJiAoaTIgPSB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHUyID0gW107CiAgICAgICAgICBvMi50eXBlID09PSAiVFNEZWNsYXJlRnVuY3Rpb24iICYmIG8yLmRlY2xhcmUgJiYgdTIucHVzaCgiZGVjbGFyZSAiKSwgbzIuYXN5bmMgJiYgdTIucHVzaCgiYXN5bmMgIiksIG8yLmdlbmVyYXRvciA/IHUyLnB1c2goImZ1bmN0aW9uKiAiKSA6IHUyLnB1c2goImZ1bmN0aW9uICIpLCBvMi5pZCAmJiB1Mi5wdXNoKHQyKCJpZCIpKTsKICAgICAgICAgIGNvbnN0IHMyID0gU04oZTIsIHQyLCBuMiwgaTIpLCBhMiA9IFBOKGUyLCB0MiwgbjIpLCBjMiA9IHdOKG8yLCBhMik7CiAgICAgICAgICByZXR1cm4gdTIucHVzaChCTihlMiwgbjIsIHQyKSwgWkIoW2MyID8gWkIoczIpIDogczIsIGEyXSksIG8yLmJvZHkgPyAiICIgOiAiIiwgdDIoImJvZHkiKSksICFuMi5zZW1pIHx8ICFvMi5kZWNsYXJlICYmIG8yLmJvZHkgfHwgdTIucHVzaCgiOyIpLCB1MjsKICAgICAgICB9LCBwcmludEFycm93RnVuY3Rpb246IGZ1bmN0aW9uKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICBsZXQgbzIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgY29uc3QgaTIgPSBbXSwgdTIgPSBbXTsKICAgICAgICAgIGxldCBzMiA9IGZhbHNlOwogICAgICAgICAgaWYgKGZ1bmN0aW9uIGEzKCkgewogICAgICAgICAgICBjb25zdCBjMyA9IGZ1bmN0aW9uKGUzLCB0MywgbjMsIHIzKSB7CiAgICAgICAgICAgICAgY29uc3QgbzMgPSBbXTsKICAgICAgICAgICAgICBpZiAoZTMuZ2V0VmFsdWUoKS5hc3luYyAmJiBvMy5wdXNoKCJhc3luYyAiKSwga04oZTMsIHQzKSkKICAgICAgICAgICAgICAgIG8zLnB1c2gobjMoWyJwYXJhbXMiLCAwXSkpOwogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgaTQgPSByMyAmJiAocjMuZXhwYW5kTGFzdEFyZyB8fCByMy5leHBhbmRGaXJzdEFyZyk7CiAgICAgICAgICAgICAgICBsZXQgdTMgPSBQTihlMywgbjMsIHQzKTsKICAgICAgICAgICAgICAgIGlmIChpNCkgewogICAgICAgICAgICAgICAgICBpZiAodU4odTMpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBzTigpOwogICAgICAgICAgICAgICAgICB1MyA9IFpCKGlOKHUzKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBvMy5wdXNoKFpCKFtTTihlMywgbjMsIHQzLCBpNCwgdHJ1ZSksIHUzXSkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBpMyA9IEhCKGUzLCB0MywgdHJ1ZSwgKGU0KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBuNCA9IFlCKHQzLm9yaWdpbmFsVGV4dCwgZTQsIHhOKTsKICAgICAgICAgICAgICAgIHJldHVybiBuNCAhPT0gZmFsc2UgJiYgdDMub3JpZ2luYWxUZXh0LnNsaWNlKG40LCBuNCArIDIpID09PSAiPT4iOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiBpMyAmJiBvMy5wdXNoKCIgIiwgaTMpLCBvMzsKICAgICAgICAgICAgfShlMiwgdDIsIG4yLCByMik7CiAgICAgICAgICAgIGlmIChpMi5sZW5ndGggPT09IDApCiAgICAgICAgICAgICAgaTIucHVzaChjMyk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGNvbnN0IHsgbGVhZGluZzogbjMsIHRyYWlsaW5nOiByMyB9ID0gSkIoZTIsIHQyKTsKICAgICAgICAgICAgICBpMi5wdXNoKFtuMywgYzNdKSwgdTIudW5zaGlmdChyMyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgczIgPSBzMiB8fCBvMi5yZXR1cm5UeXBlICYmIGFOKG8yKS5sZW5ndGggPiAwIHx8IG8yLnR5cGVQYXJhbWV0ZXJzIHx8IGFOKG8yKS5zb21lKChlMykgPT4gZTMudHlwZSAhPT0gIklkZW50aWZpZXIiKSwgbzIuYm9keS50eXBlICE9PSAiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iIHx8IHIyICYmIHIyLmV4cGFuZExhc3RBcmcgPyB1Mi51bnNoaWZ0KG4yKCJib2R5IiwgcjIpKSA6IChvMiA9IG8yLmJvZHksIGUyLmNhbGwoYTMsICJib2R5IikpOwogICAgICAgICAgfSgpLCBpMi5sZW5ndGggPiAxKQogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTMsIHQzLCBuMywgcjMsIG8zLCBpMykgewogICAgICAgICAgICAgIGNvbnN0IHUzID0gZTMuZ2V0TmFtZSgpLCBzMyA9IGUzLmdldFBhcmVudE5vZGUoKSwgYTMgPSBDTihzMykgJiYgdTMgPT09ICJjYWxsZWUiLCBjMyA9IEJvb2xlYW4odDMgJiYgdDMuYXNzaWdubWVudExheW91dCksIGwzID0gaTMuYm9keS50eXBlICE9PSAiQmxvY2tTdGF0ZW1lbnQiICYmIGkzLmJvZHkudHlwZSAhPT0gIk9iamVjdEV4cHJlc3Npb24iICYmIGkzLmJvZHkudHlwZSAhPT0gIlNlcXVlbmNlRXhwcmVzc2lvbiIsIHAzID0gYTMgJiYgbDMgfHwgdDMgJiYgdDMuYXNzaWdubWVudExheW91dCA9PT0gImNoYWluLXRhaWwtYXJyb3ctY2hhaW4iLCBmMiA9IFN5bWJvbCgiYXJyb3ctY2hhaW4iKTsKICAgICAgICAgICAgICByZXR1cm4gaTMuYm9keS50eXBlID09PSAiU2VxdWVuY2VFeHByZXNzaW9uIiAmJiAobzMgPSBaQihbIigiLCBlTihbUUIsIG8zXSksIFFCLCAiKSJdKSksIFpCKFtaQihlTihbYTMgfHwgYzMgPyBRQiA6ICIiLCBaQihyTihbIiA9PiIsIEtCXSwgbjMpLCB7IHNob3VsZEJyZWFrOiByMyB9KV0pLCB7IGlkOiBmMiwgc2hvdWxkQnJlYWs6IHAzIH0pLCAiID0+Iiwgb04obDMgPyBlTihbS0IsIG8zXSkgOiBbIiAiLCBvM10sIHsgZ3JvdXBJZDogZjIgfSksIGEzID8gdE4oUUIsICIiLCB7IGdyb3VwSWQ6IGYyIH0pIDogIiJdKTsKICAgICAgICAgICAgfShlMiwgcjIsIGkyLCBzMiwgdTIsIG8yKTsKICAgICAgICAgIGNvbnN0IGEyID0gaTI7CiAgICAgICAgICBpZiAoYTIucHVzaCgiID0+IiksICFjTih0Mi5vcmlnaW5hbFRleHQsIG8yLmJvZHkpICYmIChvMi5ib2R5LnR5cGUgPT09ICJBcnJheUV4cHJlc3Npb24iIHx8IG8yLmJvZHkudHlwZSA9PT0gIk9iamVjdEV4cHJlc3Npb24iIHx8IG8yLmJvZHkudHlwZSA9PT0gIkJsb2NrU3RhdGVtZW50IiB8fCBwTihvMi5ib2R5KSB8fCBmTihvMi5ib2R5LCB0Mi5vcmlnaW5hbFRleHQpIHx8IG8yLmJvZHkudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiB8fCBvMi5ib2R5LnR5cGUgPT09ICJEb0V4cHJlc3Npb24iKSkKICAgICAgICAgICAgcmV0dXJuIFpCKFsuLi5hMiwgIiAiLCB1Ml0pOwogICAgICAgICAgaWYgKG8yLmJvZHkudHlwZSA9PT0gIlNlcXVlbmNlRXhwcmVzc2lvbiIpCiAgICAgICAgICAgIHJldHVybiBaQihbLi4uYTIsIFpCKFsiICgiLCBlTihbUUIsIHUyXSksIFFCLCAiKSJdKV0pOwogICAgICAgICAgY29uc3QgYzIgPSAocjIgJiYgcjIuZXhwYW5kTGFzdEFyZyB8fCBlMi5nZXRQYXJlbnROb2RlKCkudHlwZSA9PT0gIkpTWEV4cHJlc3Npb25Db250YWluZXIiKSAmJiAheU4obzIpLCBsMiA9IHIyICYmIHIyLmV4cGFuZExhc3RBcmcgJiYgZE4odDIsICJhbGwiKSwgcDIgPSBvMi5ib2R5LnR5cGUgPT09ICJDb25kaXRpb25hbEV4cHJlc3Npb24iICYmICFoTihvMi5ib2R5LCBmYWxzZSk7CiAgICAgICAgICByZXR1cm4gWkIoWy4uLmEyLCBaQihbZU4oW0tCLCBwMiA/IHROKCIiLCAiKCIpIDogIiIsIHUyLCBwMiA/IHROKCIiLCAiKSIpIDogIiJdKSwgYzIgPyBbdE4obDIgPyAiLCIgOiAiIiksIFFCXSA6ICIiXSldKTsKICAgICAgICB9LCBwcmludE1ldGhvZDogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXROb2RlKCksIHsga2luZDogbzIgfSA9IHIyLCBpMiA9IHIyLnZhbHVlIHx8IHIyLCB1MiA9IFtdOwogICAgICAgICAgcmV0dXJuIG8yICYmIG8yICE9PSAiaW5pdCIgJiYgbzIgIT09ICJtZXRob2QiICYmIG8yICE9PSAiY29uc3RydWN0b3IiID8gKEdCLm9rKG8yID09PSAiZ2V0IiB8fCBvMiA9PT0gInNldCIpLCB1Mi5wdXNoKG8yLCAiICIpKSA6IGkyLmFzeW5jICYmIHUyLnB1c2goImFzeW5jICIpLCBpMi5nZW5lcmF0b3IgJiYgdTIucHVzaCgiKiIpLCB1Mi5wdXNoKFROKGUyLCB0MiwgbjIpLCByMi5vcHRpb25hbCB8fCByMi5rZXkub3B0aW9uYWwgPyAiPyIgOiAiIiksIHIyID09PSBpMiA/IHUyLnB1c2goTk4oZTIsIHQyLCBuMikpIDogaTIudHlwZSA9PT0gIkZ1bmN0aW9uRXhwcmVzc2lvbiIgPyB1Mi5wdXNoKGUyLmNhbGwoKGUzKSA9PiBOTihlMywgdDIsIG4yKSwgInZhbHVlIikpIDogdTIucHVzaChuMigidmFsdWUiKSksIHUyOwogICAgICAgIH0sIHByaW50UmV0dXJuU3RhdGVtZW50OiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gWyJyZXR1cm4iLCBPTihlMiwgdDIsIG4yKV07CiAgICAgICAgfSwgcHJpbnRUaHJvd1N0YXRlbWVudDogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIFsidGhyb3ciLCBPTihlMiwgdDIsIG4yKV07CiAgICAgICAgfSwgcHJpbnRNZXRob2RJbnRlcm5hbDogTk4sIHNob3VsZFByaW50UGFyYW1zV2l0aG91dFBhcmVuczoga04gfTsKICAgICAgICBjb25zdCB7IGlzTm9uRW1wdHlBcnJheTogTE4sIGhhc05ld2xpbmU6IGpOIH0gPSBkYywgeyBidWlsZGVyczogeyBsaW5lOiBfTiwgaGFyZGxpbmU6IE1OLCBqb2luOiBSTiwgYnJlYWtQYXJlbnQ6IFZOLCBncm91cDogJE4gfSB9ID0gWmMsIHsgbG9jU3RhcnQ6IFdOLCBsb2NFbmQ6IHFOIH0gPSBvZywgeyBnZXRQYXJlbnRFeHBvcnREZWNsYXJhdGlvbjogVU4gfSA9IENDOwogICAgICAgIGZ1bmN0aW9uIHpOKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGUyLmRlY29yYXRvcnMuc29tZSgoZTMpID0+IGpOKHQyLm9yaWdpbmFsVGV4dCwgcU4oZTMpKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEdOKGUyKSB7CiAgICAgICAgICBpZiAoZTIudHlwZSAhPT0gIkV4cG9ydERlZmF1bHREZWNsYXJhdGlvbiIgJiYgZTIudHlwZSAhPT0gIkV4cG9ydE5hbWVkRGVjbGFyYXRpb24iICYmIGUyLnR5cGUgIT09ICJEZWNsYXJlRXhwb3J0RGVjbGFyYXRpb24iKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBjb25zdCB0MiA9IGUyLmRlY2xhcmF0aW9uICYmIGUyLmRlY2xhcmF0aW9uLmRlY29yYXRvcnM7CiAgICAgICAgICByZXR1cm4gTE4odDIpICYmIFdOKGUyLCB7IGlnbm9yZURlY29yYXRvcnM6IHRydWUgfSkgPiBXTih0MlswXSk7CiAgICAgICAgfQogICAgICAgIHZhciBITiA9IHsgcHJpbnREZWNvcmF0b3JzOiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCksIHsgZGVjb3JhdG9yczogbzIgfSA9IHIyOwogICAgICAgICAgaWYgKCFMTihvMikgfHwgR04oZTIuZ2V0UGFyZW50Tm9kZSgpKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY29uc3QgaTIgPSByMi50eXBlID09PSAiQ2xhc3NFeHByZXNzaW9uIiB8fCByMi50eXBlID09PSAiQ2xhc3NEZWNsYXJhdGlvbiIgfHwgek4ocjIsIHQyKTsKICAgICAgICAgIHJldHVybiBbVU4oZTIpID8gTU4gOiBpMiA/IFZOIDogIiIsIFJOKF9OLCBlMi5tYXAobjIsICJkZWNvcmF0b3JzIikpLCBfTl07CiAgICAgICAgfSwgcHJpbnRDbGFzc01lbWJlckRlY29yYXRvcnM6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIHJldHVybiAkTihbUk4oX04sIGUyLm1hcChuMiwgImRlY29yYXRvcnMiKSksIHpOKHIyLCB0MikgPyBNTiA6IF9OXSk7CiAgICAgICAgfSwgcHJpbnREZWNvcmF0b3JzQmVmb3JlRXhwb3J0OiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gW1JOKE1OLCBlMi5tYXAobjIsICJkZWNsYXJhdGlvbiIsICJkZWNvcmF0b3JzIikpLCBNTl07CiAgICAgICAgfSwgaGFzRGVjb3JhdG9yc0JlZm9yZUV4cG9ydDogR04gfTsKICAgICAgICBjb25zdCB7IGlzTm9uRW1wdHlBcnJheTogSk4sIGNyZWF0ZUdyb3VwSWRNYXBwZXI6IFhOIH0gPSBkYywgeyBwcmludENvbW1lbnRzOiBZTiwgcHJpbnREYW5nbGluZ0NvbW1lbnRzOiBLTiB9ID0gdEQsIHsgYnVpbGRlcnM6IHsgam9pbjogUU4sIGxpbmU6IFpOLCBoYXJkbGluZTogZWssIHNvZnRsaW5lOiB0aywgZ3JvdXA6IG5rLCBpbmRlbnQ6IHJrLCBpZkJyZWFrOiBvayB9IH0gPSBaYywgeyBoYXNDb21tZW50OiBpaywgQ29tbWVudENoZWNrRmxhZ3M6IHVrIH0gPSBDQywgeyBnZXRUeXBlUGFyYW1ldGVyc0dyb3VwSWQ6IHNrIH0gPSBPQiwgeyBwcmludE1ldGhvZDogYWsgfSA9IElOLCB7IHByaW50T3B0aW9uYWxUb2tlbjogY2ssIHByaW50VHlwZUFubm90YXRpb246IGxrIH0gPSBfeCwgeyBwcmludFByb3BlcnR5S2V5OiBwayB9ID0gekIsIHsgcHJpbnRBc3NpZ25tZW50OiBmayB9ID0gbVQsIHsgcHJpbnRDbGFzc01lbWJlckRlY29yYXRvcnM6IGRrIH0gPSBITjsKICAgICAgICBjb25zdCBoayA9IFhOKCJoZXJpdGFnZUdyb3VwIik7CiAgICAgICAgZnVuY3Rpb24gZ2soZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlUGFyYW1ldGVycyAmJiAhaWsoZTIudHlwZVBhcmFtZXRlcnMsIHVrLlRyYWlsaW5nIHwgdWsuTGluZSkgJiYgIWZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBbInN1cGVyQ2xhc3MiLCAiZXh0ZW5kcyIsICJtaXhpbnMiLCAiaW1wbGVtZW50cyJdLmZpbHRlcigodDIpID0+IEJvb2xlYW4oZTNbdDJdKSkubGVuZ3RoID4gMTsKICAgICAgICAgIH0oZTIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBtayhlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgY29uc3QgbzIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgaWYgKCFKTihvMltyMl0pKQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICBjb25zdCBpMiA9IEtOKGUyLCB0MiwgdHJ1ZSwgKGUzKSA9PiB7CiAgICAgICAgICAgIGxldCB7IG1hcmtlcjogdDMgfSA9IGUzOwogICAgICAgICAgICByZXR1cm4gdDMgPT09IHIyOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gW2drKG8yKSA/IG9rKCIgIiwgWk4sIHsgZ3JvdXBJZDogc2sobzIudHlwZVBhcmFtZXRlcnMpIH0pIDogWk4sIGkyLCBpMiAmJiBlaywgcjIsIG5rKHJrKFtaTiwgUU4oWyIsIiwgWk5dLCBlMi5tYXAobjIsIHIyKSldKSldOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB5ayhlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IG4yKCJzdXBlckNsYXNzIik7CiAgICAgICAgICByZXR1cm4gZTIuZ2V0UGFyZW50Tm9kZSgpLnR5cGUgPT09ICJBc3NpZ25tZW50RXhwcmVzc2lvbiIgPyBuayhvayhbIigiLCByayhbdGssIHIyXSksIHRrLCAiKSJdLCByMikpIDogcjI7CiAgICAgICAgfQogICAgICAgIHZhciBEayA9IHsgcHJpbnRDbGFzczogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLCBvMiA9IFtdOwogICAgICAgICAgcjIuZGVjbGFyZSAmJiBvMi5wdXNoKCJkZWNsYXJlICIpLCByMi5hYnN0cmFjdCAmJiBvMi5wdXNoKCJhYnN0cmFjdCAiKSwgbzIucHVzaCgiY2xhc3MiKTsKICAgICAgICAgIGNvbnN0IGkyID0gcjIuaWQgJiYgaWsocjIuaWQsIHVrLlRyYWlsaW5nKSB8fCByMi5zdXBlckNsYXNzICYmIGlrKHIyLnN1cGVyQ2xhc3MpIHx8IEpOKHIyLmV4dGVuZHMpIHx8IEpOKHIyLm1peGlucykgfHwgSk4ocjIuaW1wbGVtZW50cyksIHUyID0gW10sIHMyID0gW107CiAgICAgICAgICBpZiAocjIuaWQgJiYgdTIucHVzaCgiICIsIG4yKCJpZCIpKSwgdTIucHVzaChuMigidHlwZVBhcmFtZXRlcnMiKSksIHIyLnN1cGVyQ2xhc3MpIHsKICAgICAgICAgICAgY29uc3QgcjMgPSBbImV4dGVuZHMgIiwgeWsoZTIsIHQyLCBuMiksIG4yKCJzdXBlclR5cGVQYXJhbWV0ZXJzIildLCBvMyA9IGUyLmNhbGwoKGUzKSA9PiBZTihlMywgcjMsIHQyKSwgInN1cGVyQ2xhc3MiKTsKICAgICAgICAgICAgaTIgPyBzMi5wdXNoKFpOLCBuayhvMykpIDogczIucHVzaCgiICIsIG8zKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBzMi5wdXNoKG1rKGUyLCB0MiwgbjIsICJleHRlbmRzIikpOwogICAgICAgICAgaWYgKHMyLnB1c2gobWsoZTIsIHQyLCBuMiwgIm1peGlucyIpLCBtayhlMiwgdDIsIG4yLCAiaW1wbGVtZW50cyIpKSwgaTIpIHsKICAgICAgICAgICAgbGV0IGUzOwogICAgICAgICAgICBlMyA9IGdrKHIyKSA/IFsuLi51MiwgcmsoczIpXSA6IHJrKFsuLi51MiwgczJdKSwgbzIucHVzaChuayhlMywgeyBpZDogaGsocjIpIH0pKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBvMi5wdXNoKC4uLnUyLCAuLi5zMik7CiAgICAgICAgICByZXR1cm4gbzIucHVzaCgiICIsIG4yKCJib2R5IikpLCBvMjsKICAgICAgICB9LCBwcmludENsYXNzTWV0aG9kOiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCksIG8yID0gW107CiAgICAgICAgICByZXR1cm4gSk4ocjIuZGVjb3JhdG9ycykgJiYgbzIucHVzaChkayhlMiwgdDIsIG4yKSksIHIyLmFjY2Vzc2liaWxpdHkgJiYgbzIucHVzaChyMi5hY2Nlc3NpYmlsaXR5ICsgIiAiKSwgcjIucmVhZG9ubHkgJiYgbzIucHVzaCgicmVhZG9ubHkgIiksIHIyLmRlY2xhcmUgJiYgbzIucHVzaCgiZGVjbGFyZSAiKSwgcjIuc3RhdGljICYmIG8yLnB1c2goInN0YXRpYyAiKSwgKHIyLnR5cGUgPT09ICJUU0Fic3RyYWN0TWV0aG9kRGVmaW5pdGlvbiIgfHwgcjIuYWJzdHJhY3QpICYmIG8yLnB1c2goImFic3RyYWN0ICIpLCByMi5vdmVycmlkZSAmJiBvMi5wdXNoKCJvdmVycmlkZSAiKSwgbzIucHVzaChhayhlMiwgdDIsIG4yKSksIG8yOwogICAgICAgIH0sIHByaW50Q2xhc3NQcm9wZXJ0eTogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLCBvMiA9IFtdLCBpMiA9IHQyLnNlbWkgPyAiOyIgOiAiIjsKICAgICAgICAgIHJldHVybiBKTihyMi5kZWNvcmF0b3JzKSAmJiBvMi5wdXNoKGRrKGUyLCB0MiwgbjIpKSwgcjIuYWNjZXNzaWJpbGl0eSAmJiBvMi5wdXNoKHIyLmFjY2Vzc2liaWxpdHkgKyAiICIpLCByMi5kZWNsYXJlICYmIG8yLnB1c2goImRlY2xhcmUgIiksIHIyLnN0YXRpYyAmJiBvMi5wdXNoKCJzdGF0aWMgIiksIChyMi50eXBlID09PSAiVFNBYnN0cmFjdFByb3BlcnR5RGVmaW5pdGlvbiIgfHwgcjIuYWJzdHJhY3QpICYmIG8yLnB1c2goImFic3RyYWN0ICIpLCByMi5vdmVycmlkZSAmJiBvMi5wdXNoKCJvdmVycmlkZSAiKSwgcjIucmVhZG9ubHkgJiYgbzIucHVzaCgicmVhZG9ubHkgIiksIHIyLnZhcmlhbmNlICYmIG8yLnB1c2gobjIoInZhcmlhbmNlIikpLCBvMi5wdXNoKHBrKGUyLCB0MiwgbjIpLCBjayhlMiksIGxrKGUyLCB0MiwgbjIpKSwgW2ZrKGUyLCB0MiwgbjIsIG8yLCAiID0iLCAidmFsdWUiKSwgaTJdOwogICAgICAgIH0sIHByaW50SGFyZGxpbmVBZnRlckhlcml0YWdlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIG9rKGVrLCAiIiwgeyBncm91cElkOiBoayhlMikgfSk7CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IHsgaXNOb25FbXB0eUFycmF5OiBFayB9ID0gZGMsIHsgYnVpbGRlcnM6IHsgam9pbjogQ2ssIGxpbmU6IGJrLCBncm91cDogdmssIGluZGVudDogQWssIGlmQnJlYWs6IEZrIH0gfSA9IFpjLCB7IGhhc0NvbW1lbnQ6IHhrLCBpZGVudGl0eTogU2ssIENvbW1lbnRDaGVja0ZsYWdzOiB3ayB9ID0gQ0MsIHsgZ2V0VHlwZVBhcmFtZXRlcnNHcm91cElkOiBUayB9ID0gT0IsIHsgcHJpbnRUeXBlU2NyaXB0TW9kaWZpZXJzOiBCayB9ID0gX3g7CiAgICAgICAgdmFyIE5rID0geyBwcmludEludGVyZmFjZTogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLCBvMiA9IFtdOwogICAgICAgICAgcjIuZGVjbGFyZSAmJiBvMi5wdXNoKCJkZWNsYXJlICIpLCByMi50eXBlID09PSAiVFNJbnRlcmZhY2VEZWNsYXJhdGlvbiIgJiYgbzIucHVzaChyMi5hYnN0cmFjdCA/ICJhYnN0cmFjdCAiIDogIiIsIEJrKGUyLCB0MiwgbjIpKSwgbzIucHVzaCgiaW50ZXJmYWNlIik7CiAgICAgICAgICBjb25zdCBpMiA9IFtdLCB1MiA9IFtdOwogICAgICAgICAgcjIudHlwZSAhPT0gIkludGVyZmFjZVR5cGVBbm5vdGF0aW9uIiAmJiBpMi5wdXNoKCIgIiwgbjIoImlkIiksIG4yKCJ0eXBlUGFyYW1ldGVycyIpKTsKICAgICAgICAgIGNvbnN0IHMyID0gcjIudHlwZVBhcmFtZXRlcnMgJiYgIXhrKHIyLnR5cGVQYXJhbWV0ZXJzLCB3ay5UcmFpbGluZyB8IHdrLkxpbmUpOwogICAgICAgICAgcmV0dXJuIEVrKHIyLmV4dGVuZHMpICYmIHUyLnB1c2goczIgPyBGaygiICIsIGJrLCB7IGdyb3VwSWQ6IFRrKHIyLnR5cGVQYXJhbWV0ZXJzKSB9KSA6IGJrLCAiZXh0ZW5kcyAiLCAocjIuZXh0ZW5kcy5sZW5ndGggPT09IDEgPyBTayA6IEFrKShDayhbIiwiLCBia10sIGUyLm1hcChuMiwgImV4dGVuZHMiKSkpKSwgcjIuaWQgJiYgeGsocjIuaWQsIHdrLlRyYWlsaW5nKSB8fCBFayhyMi5leHRlbmRzKSA/IHMyID8gbzIucHVzaCh2ayhbLi4uaTIsIEFrKHUyKV0pKSA6IG8yLnB1c2godmsoQWsoWy4uLmkyLCAuLi51Ml0pKSkgOiBvMi5wdXNoKC4uLmkyLCAuLi51MiksIG8yLnB1c2goIiAiLCBuMigiYm9keSIpKSwgdmsobzIpOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IGlzTm9uRW1wdHlBcnJheToga2sgfSA9IGRjLCB7IGJ1aWxkZXJzOiB7IHNvZnRsaW5lOiBQaywgZ3JvdXA6IE9rLCBpbmRlbnQ6IElrLCBqb2luOiBMaywgbGluZTogamssIGlmQnJlYWs6IF9rLCBoYXJkbGluZTogTWsgfSB9ID0gWmMsIHsgcHJpbnREYW5nbGluZ0NvbW1lbnRzOiBSayB9ID0gdEQsIHsgaGFzQ29tbWVudDogVmssIENvbW1lbnRDaGVja0ZsYWdzOiAkaywgc2hvdWxkUHJpbnRDb21tYTogV2ssIG5lZWRzSGFyZGxpbmVBZnRlckRhbmdsaW5nQ29tbWVudDogcWsgfSA9IENDLCB7IGxvY1N0YXJ0OiBVaywgaGFzU2FtZUxvYzogemsgfSA9IG9nLCB7IGhhc0RlY29yYXRvcnNCZWZvcmVFeHBvcnQ6IEdrLCBwcmludERlY29yYXRvcnNCZWZvcmVFeHBvcnQ6IEhrIH0gPSBITjsKICAgICAgICBmdW5jdGlvbiBKayhlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBpZiAoIXIyLnNvdXJjZSkKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgY29uc3QgbzIgPSBbXTsKICAgICAgICAgIHJldHVybiBZayhyMiwgdDIpIHx8IG8yLnB1c2goIiBmcm9tIiksIG8yLnB1c2goIiAiLCBuMigic291cmNlIikpLCBvMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gWGsoZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgaWYgKFlrKHIyLCB0MikpCiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgIGNvbnN0IG8yID0gWyIgIl07CiAgICAgICAgICBpZiAoa2socjIuc3BlY2lmaWVycykpIHsKICAgICAgICAgICAgY29uc3QgaTIgPSBbXSwgdTIgPSBbXTsKICAgICAgICAgICAgaWYgKGUyLmVhY2goKCkgPT4gewogICAgICAgICAgICAgIGNvbnN0IHQzID0gZTIuZ2V0VmFsdWUoKS50eXBlOwogICAgICAgICAgICAgIGlmICh0MyA9PT0gIkV4cG9ydE5hbWVzcGFjZVNwZWNpZmllciIgfHwgdDMgPT09ICJFeHBvcnREZWZhdWx0U3BlY2lmaWVyIiB8fCB0MyA9PT0gIkltcG9ydE5hbWVzcGFjZVNwZWNpZmllciIgfHwgdDMgPT09ICJJbXBvcnREZWZhdWx0U3BlY2lmaWVyIikKICAgICAgICAgICAgICAgIGkyLnB1c2gobjIoKSk7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodDMgIT09ICJFeHBvcnRTcGVjaWZpZXIiICYmIHQzICE9PSAiSW1wb3J0U3BlY2lmaWVyIikKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIHNwZWNpZmllciB0eXBlICIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHQzKSkpOwogICAgICAgICAgICAgICAgdTIucHVzaChuMigpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sICJzcGVjaWZpZXJzIiksIG8yLnB1c2goTGsoIiwgIiwgaTIpKSwgdTIubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGkyLmxlbmd0aCA+IDAgJiYgbzIucHVzaCgiLCAiKTsKICAgICAgICAgICAgICB1Mi5sZW5ndGggPiAxIHx8IGkyLmxlbmd0aCA+IDAgfHwgcjIuc3BlY2lmaWVycy5zb21lKChlMykgPT4gVmsoZTMpKSA/IG8yLnB1c2goT2soWyJ7IiwgSWsoW3QyLmJyYWNrZXRTcGFjaW5nID8gamsgOiBQaywgTGsoWyIsIiwgamtdLCB1MildKSwgX2soV2sodDIpID8gIiwiIDogIiIpLCB0Mi5icmFja2V0U3BhY2luZyA/IGprIDogUGssICJ9Il0pKSA6IG8yLnB1c2goWyJ7IiwgdDIuYnJhY2tldFNwYWNpbmcgPyAiICIgOiAiIiwgLi4udTIsIHQyLmJyYWNrZXRTcGFjaW5nID8gIiAiIDogIiIsICJ9Il0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgbzIucHVzaCgie30iKTsKICAgICAgICAgIHJldHVybiBvMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gWWsoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCB7IHR5cGU6IG4yLCBpbXBvcnRLaW5kOiByMiwgc291cmNlOiBvMiwgc3BlY2lmaWVyczogaTIgfSA9IGUyOwogICAgICAgICAgcmV0dXJuIG4yID09PSAiSW1wb3J0RGVjbGFyYXRpb24iICYmICFrayhpMikgJiYgcjIgIT09ICJ0eXBlIiAmJiAhL3tccyp9Ly50ZXN0KHQyLm9yaWdpbmFsVGV4dC5zbGljZShVayhlMiksIFVrKG8yKSkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBLayhlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldE5vZGUoKTsKICAgICAgICAgIHJldHVybiBrayhyMi5hc3NlcnRpb25zKSA/IFsiIGFzc2VydCB7IiwgdDIuYnJhY2tldFNwYWNpbmcgPyAiICIgOiAiIiwgTGsoIiwgIiwgZTIubWFwKG4yLCAiYXNzZXJ0aW9ucyIpKSwgdDIuYnJhY2tldFNwYWNpbmcgPyAiICIgOiAiIiwgIn0iXSA6ICIiOwogICAgICAgIH0KICAgICAgICB2YXIgUWsgPSB7IHByaW50SW1wb3J0RGVjbGFyYXRpb246IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKSwgbzIgPSB0Mi5zZW1pID8gIjsiIDogIiIsIGkyID0gW10sIHsgaW1wb3J0S2luZDogdTIgfSA9IHIyOwogICAgICAgICAgcmV0dXJuIGkyLnB1c2goImltcG9ydCIpLCB1MiAmJiB1MiAhPT0gInZhbHVlIiAmJiBpMi5wdXNoKCIgIiwgdTIpLCBpMi5wdXNoKFhrKGUyLCB0MiwgbjIpLCBKayhlMiwgdDIsIG4yKSwgS2soZTIsIHQyLCBuMiksIG8yKSwgaTI7CiAgICAgICAgfSwgcHJpbnRFeHBvcnREZWNsYXJhdGlvbjogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLCBvMiA9IFtdOwogICAgICAgICAgR2socjIpICYmIG8yLnB1c2goSGsoZTIsIHQyLCBuMikpOwogICAgICAgICAgY29uc3QgeyB0eXBlOiBpMiwgZXhwb3J0S2luZDogdTIsIGRlY2xhcmF0aW9uOiBzMiB9ID0gcjI7CiAgICAgICAgICByZXR1cm4gbzIucHVzaCgiZXhwb3J0IiksIChyMi5kZWZhdWx0IHx8IGkyID09PSAiRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uIikgJiYgbzIucHVzaCgiIGRlZmF1bHQiKSwgVmsocjIsICRrLkRhbmdsaW5nKSAmJiAobzIucHVzaCgiICIsIFJrKGUyLCB0MiwgdHJ1ZSkpLCBxayhyMikgJiYgbzIucHVzaChNaykpLCBzMiA/IG8yLnB1c2goIiAiLCBuMigiZGVjbGFyYXRpb24iKSkgOiBvMi5wdXNoKHUyID09PSAidHlwZSIgPyAiIHR5cGUiIDogIiIsIFhrKGUyLCB0MiwgbjIpLCBKayhlMiwgdDIsIG4yKSwgS2soZTIsIHQyLCBuMikpLCBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgaWYgKCF0My5zZW1pKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgeyB0eXBlOiBuMywgZGVjbGFyYXRpb246IHIzIH0gPSBlMywgbzMgPSBlMy5kZWZhdWx0IHx8IG4zID09PSAiRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uIjsKICAgICAgICAgICAgaWYgKCFyMykKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgeyB0eXBlOiBpMyB9ID0gcjM7CiAgICAgICAgICAgIGlmIChvMyAmJiBpMyAhPT0gIkNsYXNzRGVjbGFyYXRpb24iICYmIGkzICE9PSAiRnVuY3Rpb25EZWNsYXJhdGlvbiIgJiYgaTMgIT09ICJUU0ludGVyZmFjZURlY2xhcmF0aW9uIiAmJiBpMyAhPT0gIkRlY2xhcmVDbGFzcyIgJiYgaTMgIT09ICJEZWNsYXJlRnVuY3Rpb24iICYmIGkzICE9PSAiVFNEZWNsYXJlRnVuY3Rpb24iICYmIGkzICE9PSAiRW51bURlY2xhcmF0aW9uIikKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfShyMiwgdDIpICYmIG8yLnB1c2goIjsiKSwgbzI7CiAgICAgICAgfSwgcHJpbnRFeHBvcnRBbGxEZWNsYXJhdGlvbjogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLCBvMiA9IHQyLnNlbWkgPyAiOyIgOiAiIiwgaTIgPSBbXSwgeyBleHBvcnRLaW5kOiB1MiwgZXhwb3J0ZWQ6IHMyIH0gPSByMjsKICAgICAgICAgIHJldHVybiBpMi5wdXNoKCJleHBvcnQiKSwgdTIgPT09ICJ0eXBlIiAmJiBpMi5wdXNoKCIgdHlwZSIpLCBpMi5wdXNoKCIgKiIpLCBzMiAmJiBpMi5wdXNoKCIgYXMgIiwgbjIoImV4cG9ydGVkIikpLCBpMi5wdXNoKEprKGUyLCB0MiwgbjIpLCBLayhlMiwgdDIsIG4yKSwgbzIpLCBpMjsKICAgICAgICB9LCBwcmludE1vZHVsZVNwZWNpZmllcjogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXROb2RlKCksIHsgdHlwZTogbzIgfSA9IHIyLCBpMiA9IFtdLCB1MiA9IG8yID09PSAiSW1wb3J0U3BlY2lmaWVyIiA/IHIyLmltcG9ydEtpbmQgOiByMi5leHBvcnRLaW5kOwogICAgICAgICAgdTIgJiYgdTIgIT09ICJ2YWx1ZSIgJiYgaTIucHVzaCh1MiwgIiAiKTsKICAgICAgICAgIGNvbnN0IHMyID0gbzIuc3RhcnRzV2l0aCgiSW1wb3J0IiksIGEyID0gczIgPyAiaW1wb3J0ZWQiIDogImxvY2FsIiwgYzIgPSBzMiA/ICJsb2NhbCIgOiAiZXhwb3J0ZWQiOwogICAgICAgICAgbGV0IGwyID0gIiIsIHAyID0gIiI7CiAgICAgICAgICByZXR1cm4gbzIgPT09ICJFeHBvcnROYW1lc3BhY2VTcGVjaWZpZXIiIHx8IG8yID09PSAiSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyIiA/IGwyID0gIioiIDogcjJbYTJdICYmIChsMiA9IG4yKGEyKSksICFyMltjMl0gfHwgcjJbYTJdICYmIHprKHIyW2EyXSwgcjJbYzJdKSB8fCAocDIgPSBuMihjMikpLCBpMi5wdXNoKGwyLCBsMiAmJiBwMiA/ICIgYXMgIiA6ICIiLCBwMiksIGkyOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IHByaW50RGFuZ2xpbmdDb21tZW50czogWmsgfSA9IHRELCB7IGJ1aWxkZXJzOiB7IGxpbmU6IGVQLCBzb2Z0bGluZTogdFAsIGdyb3VwOiBuUCwgaW5kZW50OiByUCwgaWZCcmVhazogb1AsIGhhcmRsaW5lOiBpUCB9IH0gPSBaYywgeyBnZXRMYXN0OiB1UCwgaGFzTmV3bGluZUluUmFuZ2U6IHNQLCBoYXNOZXdsaW5lOiBhUCwgaXNOb25FbXB0eUFycmF5OiBjUCB9ID0gZGMsIHsgc2hvdWxkUHJpbnRDb21tYTogbFAsIGhhc0NvbW1lbnQ6IHBQLCBnZXRDb21tZW50czogZlAsIENvbW1lbnRDaGVja0ZsYWdzOiBkUCwgaXNOZXh0TGluZUVtcHR5OiBoUCB9ID0gQ0MsIHsgbG9jU3RhcnQ6IGdQLCBsb2NFbmQ6IG1QIH0gPSBvZywgeyBwcmludE9wdGlvbmFsVG9rZW46IHlQLCBwcmludFR5cGVBbm5vdGF0aW9uOiBEUCB9ID0gX3gsIHsgc2hvdWxkSHVnRnVuY3Rpb25QYXJhbWV0ZXJzOiBFUCB9ID0gV1QsIHsgc2hvdWxkSHVnVHlwZTogQ1AgfSA9IGZCLCB7IHByaW50SGFyZGxpbmVBZnRlckhlcml0YWdlOiBiUCB9ID0gRGs7CiAgICAgICAgdmFyIHZQID0geyBwcmludE9iamVjdDogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSB0Mi5zZW1pID8gIjsiIDogIiIsIG8yID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIGxldCBpMjsKICAgICAgICAgIGkyID0gbzIudHlwZSA9PT0gIlRTVHlwZUxpdGVyYWwiID8gIm1lbWJlcnMiIDogbzIudHlwZSA9PT0gIlRTSW50ZXJmYWNlQm9keSIgPyAiYm9keSIgOiAicHJvcGVydGllcyI7CiAgICAgICAgICBjb25zdCB1MiA9IG8yLnR5cGUgPT09ICJPYmplY3RUeXBlQW5ub3RhdGlvbiIsIHMyID0gW2kyXTsKICAgICAgICAgIHUyICYmIHMyLnB1c2goImluZGV4ZXJzIiwgImNhbGxQcm9wZXJ0aWVzIiwgImludGVybmFsU2xvdHMiKTsKICAgICAgICAgIGNvbnN0IGEyID0gczIubWFwKChlMykgPT4gbzJbZTNdWzBdKS5zb3J0KChlMywgdDMpID0+IGdQKGUzKSAtIGdQKHQzKSlbMF0sIGMyID0gZTIuZ2V0UGFyZW50Tm9kZSgwKSwgbDIgPSB1MiAmJiBjMiAmJiAoYzIudHlwZSA9PT0gIkludGVyZmFjZURlY2xhcmF0aW9uIiB8fCBjMi50eXBlID09PSAiRGVjbGFyZUludGVyZmFjZSIgfHwgYzIudHlwZSA9PT0gIkRlY2xhcmVDbGFzcyIpICYmIGUyLmdldE5hbWUoKSA9PT0gImJvZHkiLCBwMiA9IG8yLnR5cGUgPT09ICJUU0ludGVyZmFjZUJvZHkiIHx8IGwyIHx8IG8yLnR5cGUgPT09ICJPYmplY3RQYXR0ZXJuIiAmJiBjMi50eXBlICE9PSAiRnVuY3Rpb25EZWNsYXJhdGlvbiIgJiYgYzIudHlwZSAhPT0gIkZ1bmN0aW9uRXhwcmVzc2lvbiIgJiYgYzIudHlwZSAhPT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiAmJiBjMi50eXBlICE9PSAiT2JqZWN0TWV0aG9kIiAmJiBjMi50eXBlICE9PSAiQ2xhc3NNZXRob2QiICYmIGMyLnR5cGUgIT09ICJDbGFzc1ByaXZhdGVNZXRob2QiICYmIGMyLnR5cGUgIT09ICJBc3NpZ25tZW50UGF0dGVybiIgJiYgYzIudHlwZSAhPT0gIkNhdGNoQ2xhdXNlIiAmJiBvMi5wcm9wZXJ0aWVzLnNvbWUoKGUzKSA9PiBlMy52YWx1ZSAmJiAoZTMudmFsdWUudHlwZSA9PT0gIk9iamVjdFBhdHRlcm4iIHx8IGUzLnZhbHVlLnR5cGUgPT09ICJBcnJheVBhdHRlcm4iKSkgfHwgbzIudHlwZSAhPT0gIk9iamVjdFBhdHRlcm4iICYmIGEyICYmIHNQKHQyLm9yaWdpbmFsVGV4dCwgZ1AobzIpLCBnUChhMikpLCBmMiA9IGwyID8gIjsiIDogbzIudHlwZSA9PT0gIlRTSW50ZXJmYWNlQm9keSIgfHwgbzIudHlwZSA9PT0gIlRTVHlwZUxpdGVyYWwiID8gb1AocjIsICI7IikgOiAiLCIsIGQyID0gbzIudHlwZSA9PT0gIlJlY29yZEV4cHJlc3Npb24iID8gIiN7IiA6IG8yLmV4YWN0ID8gInt8IiA6ICJ7IiwgaDIgPSBvMi5leGFjdCA/ICJ8fSIgOiAifSIsIGcyID0gW107CiAgICAgICAgICBmb3IgKGNvbnN0IHQzIG9mIHMyKQogICAgICAgICAgICBlMi5lYWNoKChlMykgPT4gewogICAgICAgICAgICAgIGNvbnN0IHQ0ID0gZTMuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICBnMi5wdXNoKHsgbm9kZTogdDQsIHByaW50ZWQ6IG4yKCksIGxvYzogZ1AodDQpIH0pOwogICAgICAgICAgICB9LCB0Myk7CiAgICAgICAgICBzMi5sZW5ndGggPiAxICYmIGcyLnNvcnQoKGUzLCB0MykgPT4gZTMubG9jIC0gdDMubG9jKTsKICAgICAgICAgIGxldCBtMiA9IFtdOwogICAgICAgICAgY29uc3QgeTIgPSBnMi5tYXAoKGUzKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IG4zID0gWy4uLm0yLCBuUChlMy5wcmludGVkKV07CiAgICAgICAgICAgIHJldHVybiBtMiA9IFtmMiwgZVBdLCBlMy5ub2RlLnR5cGUgIT09ICJUU1Byb3BlcnR5U2lnbmF0dXJlIiAmJiBlMy5ub2RlLnR5cGUgIT09ICJUU01ldGhvZFNpZ25hdHVyZSIgJiYgZTMubm9kZS50eXBlICE9PSAiVFNDb25zdHJ1Y3RTaWduYXR1cmVEZWNsYXJhdGlvbiIgfHwgIXBQKGUzLm5vZGUsIGRQLlByZXR0aWVySWdub3JlKSB8fCBtMi5zaGlmdCgpLCBoUChlMy5ub2RlLCB0MikgJiYgbTIucHVzaChpUCksIG4zOwogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAobzIuaW5leGFjdCkgewogICAgICAgICAgICBsZXQgbjM7CiAgICAgICAgICAgIGlmIChwUChvMiwgZFAuRGFuZ2xpbmcpKSB7CiAgICAgICAgICAgICAgY29uc3QgcjMgPSBwUChvMiwgZFAuTGluZSk7CiAgICAgICAgICAgICAgbjMgPSBbWmsoZTIsIHQyLCB0cnVlKSwgcjMgfHwgYVAodDIub3JpZ2luYWxUZXh0LCBtUCh1UChmUChvMikpKSkgPyBpUCA6IGVQLCAiLi4uIl07CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIG4zID0gWyIuLi4iXTsKICAgICAgICAgICAgeTIucHVzaChbLi4ubTIsIC4uLm4zXSk7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBEMiA9IHVQKG8yW2kyXSksIEUyID0gIShvMi5pbmV4YWN0IHx8IEQyICYmIEQyLnR5cGUgPT09ICJSZXN0RWxlbWVudCIgfHwgRDIgJiYgKEQyLnR5cGUgPT09ICJUU1Byb3BlcnR5U2lnbmF0dXJlIiB8fCBEMi50eXBlID09PSAiVFNDYWxsU2lnbmF0dXJlRGVjbGFyYXRpb24iIHx8IEQyLnR5cGUgPT09ICJUU01ldGhvZFNpZ25hdHVyZSIgfHwgRDIudHlwZSA9PT0gIlRTQ29uc3RydWN0U2lnbmF0dXJlRGVjbGFyYXRpb24iKSAmJiBwUChEMiwgZFAuUHJldHRpZXJJZ25vcmUpKTsKICAgICAgICAgIGxldCBDMjsKICAgICAgICAgIGlmICh5Mi5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgaWYgKCFwUChvMiwgZFAuRGFuZ2xpbmcpKQogICAgICAgICAgICAgIHJldHVybiBbZDIsIGgyLCBEUChlMiwgdDIsIG4yKV07CiAgICAgICAgICAgIEMyID0gblAoW2QyLCBaayhlMiwgdDIpLCB0UCwgaDIsIHlQKGUyKSwgRFAoZTIsIHQyLCBuMildKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBDMiA9IFtsMiAmJiBjUChvMi5wcm9wZXJ0aWVzKSA/IGJQKGMyKSA6ICIiLCBkMiwgclAoW3QyLmJyYWNrZXRTcGFjaW5nID8gZVAgOiB0UCwgLi4ueTJdKSwgb1AoRTIgJiYgKGYyICE9PSAiLCIgfHwgbFAodDIpKSA/IGYyIDogIiIpLCB0Mi5icmFja2V0U3BhY2luZyA/IGVQIDogdFAsIGgyLCB5UChlMiksIERQKGUyLCB0MiwgbjIpXTsKICAgICAgICAgIHJldHVybiBlMi5tYXRjaCgoZTMpID0+IGUzLnR5cGUgPT09ICJPYmplY3RQYXR0ZXJuIiAmJiAhZTMuZGVjb3JhdG9ycywgKGUzLCB0MywgbjMpID0+IEVQKGUzKSAmJiAodDMgPT09ICJwYXJhbXMiIHx8IHQzID09PSAicGFyYW1ldGVycyIgfHwgdDMgPT09ICJ0aGlzIiB8fCB0MyA9PT0gInJlc3QiKSAmJiBuMyA9PT0gMCkgfHwgZTIubWF0Y2goQ1AsIChlMywgdDMpID0+IHQzID09PSAidHlwZUFubm90YXRpb24iLCAoZTMsIHQzKSA9PiB0MyA9PT0gInR5cGVBbm5vdGF0aW9uIiwgKGUzLCB0MywgbjMpID0+IEVQKGUzKSAmJiAodDMgPT09ICJwYXJhbXMiIHx8IHQzID09PSAicGFyYW1ldGVycyIgfHwgdDMgPT09ICJ0aGlzIiB8fCB0MyA9PT0gInJlc3QiKSAmJiBuMyA9PT0gMCkgfHwgIXAyICYmIGUyLm1hdGNoKChlMykgPT4gZTMudHlwZSA9PT0gIk9iamVjdFBhdHRlcm4iLCAoZTMpID0+IGUzLnR5cGUgPT09ICJBc3NpZ25tZW50RXhwcmVzc2lvbiIgfHwgZTMudHlwZSA9PT0gIlZhcmlhYmxlRGVjbGFyYXRvciIpID8gQzIgOiBuUChDMiwgeyBzaG91bGRCcmVhazogcDIgfSk7CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IEFQID0gVHksIHsgcHJpbnREYW5nbGluZ0NvbW1lbnRzOiBGUCB9ID0gdEQsIHsgcHJpbnRTdHJpbmc6IHhQLCBwcmludE51bWJlcjogU1AgfSA9IGRjLCB7IGJ1aWxkZXJzOiB7IGhhcmRsaW5lOiB3UCwgc29mdGxpbmU6IFRQLCBncm91cDogQlAsIGluZGVudDogTlAgfSB9ID0gWmMsIHsgZ2V0UGFyZW50RXhwb3J0RGVjbGFyYXRpb246IGtQLCBpc0Z1bmN0aW9uTm90YXRpb246IFBQLCBpc0dldHRlck9yU2V0dGVyOiBPUCwgcmF3VGV4dDogSVAsIHNob3VsZFByaW50Q29tbWE6IExQIH0gPSBDQywgeyBsb2NTdGFydDogalAsIGxvY0VuZDogX1AgfSA9IG9nLCB7IHByaW50Q2xhc3M6IE1QIH0gPSBEaywgeyBwcmludE9wYXF1ZVR5cGU6IFJQLCBwcmludFR5cGVBbGlhczogVlAsIHByaW50SW50ZXJzZWN0aW9uVHlwZTogJFAsIHByaW50VW5pb25UeXBlOiBXUCwgcHJpbnRGdW5jdGlvblR5cGU6IHFQLCBwcmludFR1cGxlVHlwZTogVVAsIHByaW50SW5kZXhlZEFjY2Vzc1R5cGU6IHpQIH0gPSBmQiwgeyBwcmludEludGVyZmFjZTogR1AgfSA9IE5rLCB7IHByaW50VHlwZVBhcmFtZXRlcjogSFAsIHByaW50VHlwZVBhcmFtZXRlcnM6IEpQIH0gPSBPQiwgeyBwcmludEV4cG9ydERlY2xhcmF0aW9uOiBYUCwgcHJpbnRFeHBvcnRBbGxEZWNsYXJhdGlvbjogWVAgfSA9IFFrLCB7IHByaW50QXJyYXlJdGVtczogS1AgfSA9IHVTLCB7IHByaW50T2JqZWN0OiBRUCB9ID0gdlAsIHsgcHJpbnRQcm9wZXJ0eUtleTogWlAgfSA9IHpCLCB7IHByaW50T3B0aW9uYWxUb2tlbjogZU8sIHByaW50VHlwZUFubm90YXRpb246IHRPLCBwcmludFJlc3RTcHJlYWQ6IG5PIH0gPSBfeDsKICAgICAgICBmdW5jdGlvbiByTyhlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0ga1AoZTIpOwogICAgICAgICAgcmV0dXJuIG4yID8gKEFQLnN0cmljdEVxdWFsKG4yLnR5cGUsICJEZWNsYXJlRXhwb3J0RGVjbGFyYXRpb24iKSwgdDIpIDogWyJkZWNsYXJlICIsIHQyXTsKICAgICAgICB9CiAgICAgICAgdmFyIG9PID0geyBwcmludEZsb3c6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKSwgbzIgPSB0Mi5zZW1pID8gIjsiIDogIiIsIGkyID0gW107CiAgICAgICAgICBzd2l0Y2ggKHIyLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiRGVjbGFyZUNsYXNzIjoKICAgICAgICAgICAgICByZXR1cm4gck8oZTIsIE1QKGUyLCB0MiwgbjIpKTsKICAgICAgICAgICAgY2FzZSAiRGVjbGFyZUZ1bmN0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gck8oZTIsIFsiZnVuY3Rpb24gIiwgbjIoImlkIiksIHIyLnByZWRpY2F0ZSA/ICIgIiA6ICIiLCBuMigicHJlZGljYXRlIiksIG8yXSk7CiAgICAgICAgICAgIGNhc2UgIkRlY2xhcmVNb2R1bGUiOgogICAgICAgICAgICAgIHJldHVybiByTyhlMiwgWyJtb2R1bGUgIiwgbjIoImlkIiksICIgIiwgbjIoImJvZHkiKV0pOwogICAgICAgICAgICBjYXNlICJEZWNsYXJlTW9kdWxlRXhwb3J0cyI6CiAgICAgICAgICAgICAgcmV0dXJuIHJPKGUyLCBbIm1vZHVsZS5leHBvcnRzIiwgIjogIiwgbjIoInR5cGVBbm5vdGF0aW9uIiksIG8yXSk7CiAgICAgICAgICAgIGNhc2UgIkRlY2xhcmVWYXJpYWJsZSI6CiAgICAgICAgICAgICAgcmV0dXJuIHJPKGUyLCBbInZhciAiLCBuMigiaWQiKSwgbzJdKTsKICAgICAgICAgICAgY2FzZSAiRGVjbGFyZU9wYXF1ZVR5cGUiOgogICAgICAgICAgICAgIHJldHVybiByTyhlMiwgUlAoZTIsIHQyLCBuMikpOwogICAgICAgICAgICBjYXNlICJEZWNsYXJlSW50ZXJmYWNlIjoKICAgICAgICAgICAgICByZXR1cm4gck8oZTIsIEdQKGUyLCB0MiwgbjIpKTsKICAgICAgICAgICAgY2FzZSAiRGVjbGFyZVR5cGVBbGlhcyI6CiAgICAgICAgICAgICAgcmV0dXJuIHJPKGUyLCBWUChlMiwgdDIsIG4yKSk7CiAgICAgICAgICAgIGNhc2UgIkRlY2xhcmVFeHBvcnREZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHJPKGUyLCBYUChlMiwgdDIsIG4yKSk7CiAgICAgICAgICAgIGNhc2UgIkRlY2xhcmVFeHBvcnRBbGxEZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHJPKGUyLCBZUChlMiwgdDIsIG4yKSk7CiAgICAgICAgICAgIGNhc2UgIk9wYXF1ZVR5cGUiOgogICAgICAgICAgICAgIHJldHVybiBSUChlMiwgdDIsIG4yKTsKICAgICAgICAgICAgY2FzZSAiVHlwZUFsaWFzIjoKICAgICAgICAgICAgICByZXR1cm4gVlAoZTIsIHQyLCBuMik7CiAgICAgICAgICAgIGNhc2UgIkludGVyc2VjdGlvblR5cGVBbm5vdGF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gJFAoZTIsIHQyLCBuMik7CiAgICAgICAgICAgIGNhc2UgIlVuaW9uVHlwZUFubm90YXRpb24iOgogICAgICAgICAgICAgIHJldHVybiBXUChlMiwgdDIsIG4yKTsKICAgICAgICAgICAgY2FzZSAiRnVuY3Rpb25UeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHFQKGUyLCB0MiwgbjIpOwogICAgICAgICAgICBjYXNlICJUdXBsZVR5cGVBbm5vdGF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gVVAoZTIsIHQyLCBuMik7CiAgICAgICAgICAgIGNhc2UgIkdlbmVyaWNUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIFtuMigiaWQiKSwgSlAoZTIsIHQyLCBuMiwgInR5cGVQYXJhbWV0ZXJzIildOwogICAgICAgICAgICBjYXNlICJJbmRleGVkQWNjZXNzVHlwZSI6CiAgICAgICAgICAgIGNhc2UgIk9wdGlvbmFsSW5kZXhlZEFjY2Vzc1R5cGUiOgogICAgICAgICAgICAgIHJldHVybiB6UChlMiwgdDIsIG4yKTsKICAgICAgICAgICAgY2FzZSAiVHlwZUFubm90YXRpb24iOgogICAgICAgICAgICAgIHJldHVybiBuMigidHlwZUFubm90YXRpb24iKTsKICAgICAgICAgICAgY2FzZSAiVHlwZVBhcmFtZXRlciI6CiAgICAgICAgICAgICAgcmV0dXJuIEhQKGUyLCB0MiwgbjIpOwogICAgICAgICAgICBjYXNlICJUeXBlb2ZUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIFsidHlwZW9mICIsIG4yKCJhcmd1bWVudCIpXTsKICAgICAgICAgICAgY2FzZSAiRXhpc3RzVHlwZUFubm90YXRpb24iOgogICAgICAgICAgICAgIHJldHVybiAiKiI7CiAgICAgICAgICAgIGNhc2UgIkVtcHR5VHlwZUFubm90YXRpb24iOgogICAgICAgICAgICAgIHJldHVybiAiZW1wdHkiOwogICAgICAgICAgICBjYXNlICJNaXhlZFR5cGVBbm5vdGF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gIm1peGVkIjsKICAgICAgICAgICAgY2FzZSAiQXJyYXlUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIFtuMigiZWxlbWVudFR5cGUiKSwgIltdIl07CiAgICAgICAgICAgIGNhc2UgIkJvb2xlYW5MaXRlcmFsVHlwZUFubm90YXRpb24iOgogICAgICAgICAgICAgIHJldHVybiBTdHJpbmcocjIudmFsdWUpOwogICAgICAgICAgICBjYXNlICJFbnVtRGVjbGFyYXRpb24iOgogICAgICAgICAgICAgIHJldHVybiBbImVudW0gIiwgbjIoImlkIiksICIgIiwgbjIoImJvZHkiKV07CiAgICAgICAgICAgIGNhc2UgIkVudW1Cb29sZWFuQm9keSI6CiAgICAgICAgICAgIGNhc2UgIkVudW1OdW1iZXJCb2R5IjoKICAgICAgICAgICAgY2FzZSAiRW51bVN0cmluZ0JvZHkiOgogICAgICAgICAgICBjYXNlICJFbnVtU3ltYm9sQm9keSI6CiAgICAgICAgICAgICAgaWYgKHIyLnR5cGUgPT09ICJFbnVtU3ltYm9sQm9keSIgfHwgcjIuZXhwbGljaXRUeXBlKSB7CiAgICAgICAgICAgICAgICBsZXQgZTMgPSBudWxsOwogICAgICAgICAgICAgICAgc3dpdGNoIChyMi50eXBlKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgIkVudW1Cb29sZWFuQm9keSI6CiAgICAgICAgICAgICAgICAgICAgZTMgPSAiYm9vbGVhbiI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgIkVudW1OdW1iZXJCb2R5IjoKICAgICAgICAgICAgICAgICAgICBlMyA9ICJudW1iZXIiOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlICJFbnVtU3RyaW5nQm9keSI6CiAgICAgICAgICAgICAgICAgICAgZTMgPSAic3RyaW5nIjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAiRW51bVN5bWJvbEJvZHkiOgogICAgICAgICAgICAgICAgICAgIGUzID0gInN5bWJvbCI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpMi5wdXNoKCJvZiAiLCBlMywgIiAiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHIyLm1lbWJlcnMubGVuZ3RoICE9PSAwIHx8IHIyLmhhc1Vua25vd25NZW1iZXJzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvMyA9IHIyLm1lbWJlcnMubGVuZ3RoID4gMCA/IFt3UCwgS1AoZTIsIHQyLCAibWVtYmVycyIsIG4yKSwgcjIuaGFzVW5rbm93bk1lbWJlcnMgfHwgTFAodDIpID8gIiwiIDogIiJdIDogW107CiAgICAgICAgICAgICAgICBpMi5wdXNoKEJQKFsieyIsIE5QKFsuLi5vMywgLi4ucjIuaGFzVW5rbm93bk1lbWJlcnMgPyBbd1AsICIuLi4iXSA6IFtdXSksIEZQKGUyLCB0MiwgdHJ1ZSksIHdQLCAifSJdKSk7CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBpMi5wdXNoKEJQKFsieyIsIEZQKGUyLCB0MiksIFRQLCAifSJdKSk7CiAgICAgICAgICAgICAgcmV0dXJuIGkyOwogICAgICAgICAgICBjYXNlICJFbnVtQm9vbGVhbk1lbWJlciI6CiAgICAgICAgICAgIGNhc2UgIkVudW1OdW1iZXJNZW1iZXIiOgogICAgICAgICAgICBjYXNlICJFbnVtU3RyaW5nTWVtYmVyIjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJpZCIpLCAiID0gIiwgdHlwZW9mIHIyLmluaXQgPT0gIm9iamVjdCIgPyBuMigiaW5pdCIpIDogU3RyaW5nKHIyLmluaXQpXTsKICAgICAgICAgICAgY2FzZSAiRW51bURlZmF1bHRlZE1lbWJlciI6CiAgICAgICAgICAgICAgcmV0dXJuIG4yKCJpZCIpOwogICAgICAgICAgICBjYXNlICJGdW5jdGlvblR5cGVQYXJhbSI6IHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IHIyLm5hbWUgPyBuMigibmFtZSIpIDogZTIuZ2V0UGFyZW50Tm9kZSgpLnRoaXMgPT09IHIyID8gInRoaXMiIDogIiI7CiAgICAgICAgICAgICAgcmV0dXJuIFt0MywgZU8oZTIpLCB0MyA/ICI6ICIgOiAiIiwgbjIoInR5cGVBbm5vdGF0aW9uIildOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgIkludGVyZmFjZURlY2xhcmF0aW9uIjoKICAgICAgICAgICAgY2FzZSAiSW50ZXJmYWNlVHlwZUFubm90YXRpb24iOgogICAgICAgICAgICAgIHJldHVybiBHUChlMiwgdDIsIG4yKTsKICAgICAgICAgICAgY2FzZSAiQ2xhc3NJbXBsZW1lbnRzIjoKICAgICAgICAgICAgY2FzZSAiSW50ZXJmYWNlRXh0ZW5kcyI6CiAgICAgICAgICAgICAgcmV0dXJuIFtuMigiaWQiKSwgbjIoInR5cGVQYXJhbWV0ZXJzIildOwogICAgICAgICAgICBjYXNlICJOdWxsYWJsZVR5cGVBbm5vdGF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gWyI/IiwgbjIoInR5cGVBbm5vdGF0aW9uIildOwogICAgICAgICAgICBjYXNlICJWYXJpYW5jZSI6IHsKICAgICAgICAgICAgICBjb25zdCB7IGtpbmQ6IGUzIH0gPSByMjsKICAgICAgICAgICAgICByZXR1cm4gQVAub2soZTMgPT09ICJwbHVzIiB8fCBlMyA9PT0gIm1pbnVzIiksIGUzID09PSAicGx1cyIgPyAiKyIgOiAiLSI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiT2JqZWN0VHlwZUNhbGxQcm9wZXJ0eSI6CiAgICAgICAgICAgICAgcmV0dXJuIHIyLnN0YXRpYyAmJiBpMi5wdXNoKCJzdGF0aWMgIiksIGkyLnB1c2gobjIoInZhbHVlIikpLCBpMjsKICAgICAgICAgICAgY2FzZSAiT2JqZWN0VHlwZUluZGV4ZXIiOgogICAgICAgICAgICAgIHJldHVybiBbcjIudmFyaWFuY2UgPyBuMigidmFyaWFuY2UiKSA6ICIiLCAiWyIsIG4yKCJpZCIpLCByMi5pZCA/ICI6ICIgOiAiIiwgbjIoImtleSIpLCAiXTogIiwgbjIoInZhbHVlIildOwogICAgICAgICAgICBjYXNlICJPYmplY3RUeXBlUHJvcGVydHkiOiB7CiAgICAgICAgICAgICAgbGV0IG8zID0gIiI7CiAgICAgICAgICAgICAgcmV0dXJuIHIyLnByb3RvID8gbzMgPSAicHJvdG8gIiA6IHIyLnN0YXRpYyAmJiAobzMgPSAic3RhdGljICIpLCBbbzMsIE9QKHIyKSA/IHIyLmtpbmQgKyAiICIgOiAiIiwgcjIudmFyaWFuY2UgPyBuMigidmFyaWFuY2UiKSA6ICIiLCBaUChlMiwgdDIsIG4yKSwgZU8oZTIpLCBQUChyMikgPyAiIiA6ICI6ICIsIG4yKCJ2YWx1ZSIpXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJPYmplY3RUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIFFQKGUyLCB0MiwgbjIpOwogICAgICAgICAgICBjYXNlICJPYmplY3RUeXBlSW50ZXJuYWxTbG90IjoKICAgICAgICAgICAgICByZXR1cm4gW3IyLnN0YXRpYyA/ICJzdGF0aWMgIiA6ICIiLCAiW1siLCBuMigiaWQiKSwgIl1dIiwgZU8oZTIpLCByMi5tZXRob2QgPyAiIiA6ICI6ICIsIG4yKCJ2YWx1ZSIpXTsKICAgICAgICAgICAgY2FzZSAiT2JqZWN0VHlwZVNwcmVhZFByb3BlcnR5IjoKICAgICAgICAgICAgICByZXR1cm4gbk8oZTIsIHQyLCBuMik7CiAgICAgICAgICAgIGNhc2UgIlF1YWxpZmllZFR5cGVJZGVudGlmaWVyIjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJxdWFsaWZpY2F0aW9uIiksICIuIiwgbjIoImlkIildOwogICAgICAgICAgICBjYXNlICJTdHJpbmdMaXRlcmFsVHlwZUFubm90YXRpb24iOgogICAgICAgICAgICAgIHJldHVybiB4UChJUChyMiksIHQyKTsKICAgICAgICAgICAgY2FzZSAiTnVtYmVyTGl0ZXJhbFR5cGVBbm5vdGF0aW9uIjoKICAgICAgICAgICAgICBBUC5zdHJpY3RFcXVhbCh0eXBlb2YgcjIudmFsdWUsICJudW1iZXIiKTsKICAgICAgICAgICAgY2FzZSAiQmlnSW50TGl0ZXJhbFR5cGVBbm5vdGF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gcjIuZXh0cmEgPyBTUChyMi5leHRyYS5yYXcpIDogU1AocjIucmF3KTsKICAgICAgICAgICAgY2FzZSAiVHlwZUNhc3RFeHByZXNzaW9uIjoKICAgICAgICAgICAgICByZXR1cm4gWyIoIiwgbjIoImV4cHJlc3Npb24iKSwgdE8oZTIsIHQyLCBuMiksICIpIl07CiAgICAgICAgICAgIGNhc2UgIlR5cGVQYXJhbWV0ZXJEZWNsYXJhdGlvbiI6CiAgICAgICAgICAgIGNhc2UgIlR5cGVQYXJhbWV0ZXJJbnN0YW50aWF0aW9uIjogewogICAgICAgICAgICAgIGNvbnN0IG8zID0gSlAoZTIsIHQyLCBuMiwgInBhcmFtcyIpOwogICAgICAgICAgICAgIGlmICh0Mi5wYXJzZXIgPT09ICJmbG93IikgewogICAgICAgICAgICAgICAgY29uc3QgZTMgPSBqUChyMiksIG4zID0gX1AocjIpLCBpMyA9IHQyLm9yaWdpbmFsVGV4dC5sYXN0SW5kZXhPZigiLyoiLCBlMyksIHUyID0gdDIub3JpZ2luYWxUZXh0LmluZGV4T2YoIiovIiwgbjMpOwogICAgICAgICAgICAgICAgaWYgKGkzICE9PSAtMSAmJiB1MiAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZTQgPSB0Mi5vcmlnaW5hbFRleHQuc2xpY2UoaTMgKyAyLCB1MikudHJpbSgpOwogICAgICAgICAgICAgICAgICBpZiAoZTQuc3RhcnRzV2l0aCgiOjoiKSAmJiAhZTQuaW5jbHVkZXMoIi8qIikgJiYgIWU0LmluY2x1ZGVzKCIqLyIpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbIi8qOjogIiwgbzMsICIgKi8iXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIG8zOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgIkluZmVycmVkUHJlZGljYXRlIjoKICAgICAgICAgICAgICByZXR1cm4gIiVjaGVja3MiOwogICAgICAgICAgICBjYXNlICJEZWNsYXJlZFByZWRpY2F0ZSI6CiAgICAgICAgICAgICAgcmV0dXJuIFsiJWNoZWNrcygiLCBuMigidmFsdWUiKSwgIikiXTsKICAgICAgICAgICAgY2FzZSAiQW55VHlwZUFubm90YXRpb24iOgogICAgICAgICAgICAgIHJldHVybiAiYW55IjsKICAgICAgICAgICAgY2FzZSAiQm9vbGVhblR5cGVBbm5vdGF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gImJvb2xlYW4iOwogICAgICAgICAgICBjYXNlICJCaWdJbnRUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuICJiaWdpbnQiOwogICAgICAgICAgICBjYXNlICJOdWxsTGl0ZXJhbFR5cGVBbm5vdGF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gIm51bGwiOwogICAgICAgICAgICBjYXNlICJOdW1iZXJUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuICJudW1iZXIiOwogICAgICAgICAgICBjYXNlICJTeW1ib2xUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuICJzeW1ib2wiOwogICAgICAgICAgICBjYXNlICJTdHJpbmdUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuICJzdHJpbmciOwogICAgICAgICAgICBjYXNlICJWb2lkVHlwZUFubm90YXRpb24iOgogICAgICAgICAgICAgIHJldHVybiAidm9pZCI7CiAgICAgICAgICAgIGNhc2UgIlRoaXNUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuICJ0aGlzIjsKICAgICAgICAgICAgY2FzZSAiTm9kZSI6CiAgICAgICAgICAgIGNhc2UgIlByaW50YWJsZSI6CiAgICAgICAgICAgIGNhc2UgIlNvdXJjZUxvY2F0aW9uIjoKICAgICAgICAgICAgY2FzZSAiUG9zaXRpb24iOgogICAgICAgICAgICBjYXNlICJTdGF0ZW1lbnQiOgogICAgICAgICAgICBjYXNlICJGdW5jdGlvbiI6CiAgICAgICAgICAgIGNhc2UgIlBhdHRlcm4iOgogICAgICAgICAgICBjYXNlICJFeHByZXNzaW9uIjoKICAgICAgICAgICAgY2FzZSAiRGVjbGFyYXRpb24iOgogICAgICAgICAgICBjYXNlICJTcGVjaWZpZXIiOgogICAgICAgICAgICBjYXNlICJOYW1lZFNwZWNpZmllciI6CiAgICAgICAgICAgIGNhc2UgIkNvbW1lbnQiOgogICAgICAgICAgICBjYXNlICJNZW1iZXJUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgIGNhc2UgIlR5cGUiOgogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5wcmludGFibGUgdHlwZTogIiArIEpTT04uc3RyaW5naWZ5KHIyLnR5cGUpKTsKICAgICAgICAgIH0KICAgICAgICB9IH07CiAgICAgICAgY29uc3QgeyBoYXNOZXdsaW5lSW5SYW5nZTogaU8gfSA9IGRjLCB7IGlzSnN4Tm9kZTogdU8sIGlzQmxvY2tDb21tZW50OiBzTywgZ2V0Q29tbWVudHM6IGFPLCBpc0NhbGxFeHByZXNzaW9uOiBjTywgaXNNZW1iZXJFeHByZXNzaW9uOiBsTyB9ID0gQ0MsIHsgbG9jU3RhcnQ6IHBPLCBsb2NFbmQ6IGZPIH0gPSBvZywgeyBidWlsZGVyczogeyBsaW5lOiBkTywgc29mdGxpbmU6IGhPLCBncm91cDogZ08sIGluZGVudDogbU8sIGFsaWduOiB5TywgaWZCcmVhazogRE8sIGRlZGVudDogRU8sIGJyZWFrUGFyZW50OiBDTyB9IH0gPSBaYzsKICAgICAgICBmdW5jdGlvbiBiTyhlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCksIG8yID0gcjIudHlwZSA9PT0gIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiIsIGkyID0gbzIgPyAiYWx0ZXJuYXRlIiA6ICJmYWxzZVR5cGUiLCB1MiA9IGUyLmdldFBhcmVudE5vZGUoKSwgczIgPSBvMiA/IG4yKCJ0ZXN0IikgOiBbbjIoImNoZWNrVHlwZSIpLCAiICIsICJleHRlbmRzIiwgIiAiLCBuMigiZXh0ZW5kc1R5cGUiKV07CiAgICAgICAgICByZXR1cm4gdTIudHlwZSA9PT0gcjIudHlwZSAmJiB1MltpMl0gPT09IHIyID8geU8oMiwgczIpIDogczI7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHZPID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoW1siQXNzaWdubWVudEV4cHJlc3Npb24iLCAicmlnaHQiXSwgWyJWYXJpYWJsZURlY2xhcmF0b3IiLCAiaW5pdCJdLCBbIlJldHVyblN0YXRlbWVudCIsICJhcmd1bWVudCJdLCBbIlRocm93U3RhdGVtZW50IiwgImFyZ3VtZW50Il0sIFsiVW5hcnlFeHByZXNzaW9uIiwgImFyZ3VtZW50Il0sIFsiWWllbGRFeHByZXNzaW9uIiwgImFyZ3VtZW50Il1dKTsKICAgICAgICB2YXIgQU8gPSB7IHByaW50VGVybmFyeTogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLCBvMiA9IHIyLnR5cGUgPT09ICJDb25kaXRpb25hbEV4cHJlc3Npb24iLCBpMiA9IG8yID8gImNvbnNlcXVlbnQiIDogInRydWVUeXBlIiwgdTIgPSBvMiA/ICJhbHRlcm5hdGUiIDogImZhbHNlVHlwZSIsIHMyID0gbzIgPyBbInRlc3QiXSA6IFsiY2hlY2tUeXBlIiwgImV4dGVuZHNUeXBlIl0sIGEyID0gcjJbaTJdLCBjMiA9IHIyW3UyXSwgbDIgPSBbXTsKICAgICAgICAgIGxldCBwMiA9IGZhbHNlOwogICAgICAgICAgY29uc3QgZjIgPSBlMi5nZXRQYXJlbnROb2RlKCksIGQyID0gZjIudHlwZSA9PT0gcjIudHlwZSAmJiBzMi5zb21lKChlMykgPT4gZjJbZTNdID09PSByMik7CiAgICAgICAgICBsZXQgaDIsIGcyLCBtMiA9IGYyLnR5cGUgPT09IHIyLnR5cGUgJiYgIWQyLCB5MiA9IDA7CiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIGcyID0gaDIgfHwgcjIsIGgyID0gZTIuZ2V0UGFyZW50Tm9kZSh5MiksIHkyKys7CiAgICAgICAgICB9IHdoaWxlIChoMiAmJiBoMi50eXBlID09PSByMi50eXBlICYmIHMyLmV2ZXJ5KChlMykgPT4gaDJbZTNdICE9PSBnMikpOwogICAgICAgICAgY29uc3QgRDIgPSBoMiB8fCBmMiwgRTIgPSBnMjsKICAgICAgICAgIGlmIChvMiAmJiAodU8ocjJbczJbMF1dKSB8fCB1TyhhMikgfHwgdU8oYzIpIHx8IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gW2UzXTsKICAgICAgICAgICAgZm9yIChsZXQgZTQgPSAwOyBlNCA8IHQzLmxlbmd0aDsgZTQrKykgewogICAgICAgICAgICAgIGNvbnN0IG4zID0gdDNbZTRdOwogICAgICAgICAgICAgIGZvciAoY29uc3QgZTUgb2YgWyJ0ZXN0IiwgImNvbnNlcXVlbnQiLCAiYWx0ZXJuYXRlIl0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHIzID0gbjNbZTVdOwogICAgICAgICAgICAgICAgaWYgKHVPKHIzKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICByMy50eXBlID09PSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIiAmJiB0My5wdXNoKHIzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfShFMikpKSB7CiAgICAgICAgICAgIHAyID0gdHJ1ZSwgbTIgPSB0cnVlOwogICAgICAgICAgICBjb25zdCBlMyA9IChlNCkgPT4gW0RPKCIoIiksIG1PKFtoTywgZTRdKSwgaE8sIERPKCIpIildLCB0MyA9IChlNCkgPT4gZTQudHlwZSA9PT0gIk51bGxMaXRlcmFsIiB8fCBlNC50eXBlID09PSAiTGl0ZXJhbCIgJiYgZTQudmFsdWUgPT09IG51bGwgfHwgZTQudHlwZSA9PT0gIklkZW50aWZpZXIiICYmIGU0Lm5hbWUgPT09ICJ1bmRlZmluZWQiOwogICAgICAgICAgICBsMi5wdXNoKCIgPyAiLCB0MyhhMikgPyBuMihpMikgOiBlMyhuMihpMikpLCAiIDogIiwgYzIudHlwZSA9PT0gcjIudHlwZSB8fCB0MyhjMikgPyBuMih1MikgOiBlMyhuMih1MikpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gW2RPLCAiPyAiLCBhMi50eXBlID09PSByMi50eXBlID8gRE8oIiIsICIoIikgOiAiIiwgeU8oMiwgbjIoaTIpKSwgYTIudHlwZSA9PT0gcjIudHlwZSA/IERPKCIiLCAiKSIpIDogIiIsIGRPLCAiOiAiLCBjMi50eXBlID09PSByMi50eXBlID8gbjIodTIpIDogeU8oMiwgbjIodTIpKV07CiAgICAgICAgICAgIGwyLnB1c2goZjIudHlwZSAhPT0gcjIudHlwZSB8fCBmMlt1Ml0gPT09IHIyIHx8IGQyID8gZTMgOiB0Mi51c2VUYWJzID8gRU8obU8oZTMpKSA6IHlPKE1hdGgubWF4KDAsIHQyLnRhYldpZHRoIC0gMiksIGUzKSk7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBDMiA9IFsuLi5zMi5tYXAoKGUzKSA9PiBhTyhyMltlM10pKSwgYU8oYTIpLCBhTyhjMildLmZsYXQoKS5zb21lKChlMykgPT4gc08oZTMpICYmIGlPKHQyLm9yaWdpbmFsVGV4dCwgcE8oZTMpLCBmTyhlMykpKSwgYjIgPSAhcDIgJiYgKGxPKGYyKSB8fCBmMi50eXBlID09PSAiTkdQaXBlRXhwcmVzc2lvbiIgJiYgZjIubGVmdCA9PT0gcjIpICYmICFmMi5jb21wdXRlZCwgdjIgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICBjb25zdCB0MyA9IGUzLmdldFZhbHVlKCk7CiAgICAgICAgICAgIGlmICh0My50eXBlICE9PSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIikKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGxldCBuMywgcjMgPSB0MzsKICAgICAgICAgICAgZm9yIChsZXQgdDQgPSAwOyAhbjM7IHQ0KyspIHsKICAgICAgICAgICAgICBjb25zdCBvMyA9IGUzLmdldFBhcmVudE5vZGUodDQpOwogICAgICAgICAgICAgIGNPKG8zKSAmJiBvMy5jYWxsZWUgPT09IHIzIHx8IGxPKG8zKSAmJiBvMy5vYmplY3QgPT09IHIzIHx8IG8zLnR5cGUgPT09ICJUU05vbk51bGxFeHByZXNzaW9uIiAmJiBvMy5leHByZXNzaW9uID09PSByMyA/IHIzID0gbzMgOiBvMy50eXBlID09PSAiTmV3RXhwcmVzc2lvbiIgJiYgbzMuY2FsbGVlID09PSByMyB8fCBvMy50eXBlID09PSAiVFNBc0V4cHJlc3Npb24iICYmIG8zLmV4cHJlc3Npb24gPT09IHIzID8gKG4zID0gZTMuZ2V0UGFyZW50Tm9kZSh0NCArIDEpLCByMyA9IG8zKSA6IG4zID0gbzM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHIzICE9PSB0MyAmJiBuM1t2Ty5nZXQobjMudHlwZSldID09PSByMzsKICAgICAgICAgIH0oZTIpLCBBMiA9ICgoZTMpID0+IGYyID09PSBEMiA/IGdPKGUzLCB7IHNob3VsZEJyZWFrOiBDMiB9KSA6IEMyID8gW2UzLCBDT10gOiBlMykoW2JPKGUyLCAwLCBuMiksIG0yID8gbDIgOiBtTyhsMiksIG8yICYmIGIyICYmICF2MiA/IGhPIDogIiJdKTsKICAgICAgICAgIHJldHVybiBkMiB8fCB2MiA/IGdPKFttTyhbaE8sIEEyXSksIGhPXSkgOiBBMjsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgeyBidWlsZGVyczogeyBoYXJkbGluZTogRk8gfSB9ID0gWmMsIHhPID0gd0EsIHsgZ2V0TGVmdFNpZGVQYXRoTmFtZTogU08sIGhhc05ha2VkTGVmdFNpZGU6IHdPLCBpc0pzeE5vZGU6IFRPLCBpc1RoZU9ubHlKc3hFbGVtZW50SW5NYXJrZG93bjogQk8sIGhhc0NvbW1lbnQ6IE5PLCBDb21tZW50Q2hlY2tGbGFnczoga08sIGlzTmV4dExpbmVFbXB0eTogUE8gfSA9IENDLCB7IHNob3VsZFByaW50UGFyYW1zV2l0aG91dFBhcmVuczogT08gfSA9IElOOwogICAgICAgIGZ1bmN0aW9uIElPKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICBjb25zdCBvMiA9IGUyLmdldFZhbHVlKCksIGkyID0gW10sIHUyID0gbzIudHlwZSA9PT0gIkNsYXNzQm9keSIsIHMyID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgZm9yIChsZXQgdDMgPSBlMy5sZW5ndGggLSAxOyB0MyA+PSAwOyB0My0tKSB7CiAgICAgICAgICAgICAgY29uc3QgbjMgPSBlM1t0M107CiAgICAgICAgICAgICAgaWYgKG4zLnR5cGUgIT09ICJFbXB0eVN0YXRlbWVudCIpCiAgICAgICAgICAgICAgICByZXR1cm4gbjM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0obzJbcjJdKTsKICAgICAgICAgIHJldHVybiBlMi5lYWNoKChlMywgcjMsIG8zKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGEyID0gZTMuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgaWYgKGEyLnR5cGUgPT09ICJFbXB0eVN0YXRlbWVudCIpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBjMiA9IG4yKCk7CiAgICAgICAgICAgIHQyLnNlbWkgfHwgdTIgfHwgQk8odDIsIGUzKSB8fCAhZnVuY3Rpb24oZTQsIHQzKSB7CiAgICAgICAgICAgICAgaWYgKGU0LmdldE5vZGUoKS50eXBlICE9PSAiRXhwcmVzc2lvblN0YXRlbWVudCIpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgcmV0dXJuIGU0LmNhbGwoKGU1KSA9PiBMTyhlNSwgdDMpLCAiZXhwcmVzc2lvbiIpOwogICAgICAgICAgICB9KGUzLCB0MikgPyBpMi5wdXNoKGMyKSA6IE5PKGEyLCBrTy5MZWFkaW5nKSA/IGkyLnB1c2gobjIoW10sIHsgbmVlZHNTZW1pOiB0cnVlIH0pKSA6IGkyLnB1c2goIjsiLCBjMiksICF0Mi5zZW1pICYmIHUyICYmIGpPKGEyKSAmJiBmdW5jdGlvbihlNCwgdDMpIHsKICAgICAgICAgICAgICBjb25zdCBuMyA9IGU0LmtleSAmJiBlNC5rZXkubmFtZTsKICAgICAgICAgICAgICBpZiAoIShuMyAhPT0gInN0YXRpYyIgJiYgbjMgIT09ICJnZXQiICYmIG4zICE9PSAic2V0IiB8fCBlNC52YWx1ZSB8fCBlNC50eXBlQW5ub3RhdGlvbikpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICBpZiAoIXQzKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIGlmICh0My5zdGF0aWMgfHwgdDMuYWNjZXNzaWJpbGl0eSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICBpZiAoIXQzLmNvbXB1dGVkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlNSA9IHQzLmtleSAmJiB0My5rZXkubmFtZTsKICAgICAgICAgICAgICAgIGlmIChlNSA9PT0gImluIiB8fCBlNSA9PT0gImluc3RhbmNlb2YiKQogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGpPKHQzKSAmJiB0My52YXJpYW5jZSAmJiAhdDMuc3RhdGljICYmICF0My5kZWNsYXJlKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgc3dpdGNoICh0My50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJDbGFzc1Byb3BlcnR5IjoKICAgICAgICAgICAgICAgIGNhc2UgIlByb3BlcnR5RGVmaW5pdGlvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJUU0Fic3RyYWN0UHJvcGVydHlEZWZpbml0aW9uIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHQzLmNvbXB1dGVkOwogICAgICAgICAgICAgICAgY2FzZSAiTWV0aG9kRGVmaW5pdGlvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJUU0Fic3RyYWN0TWV0aG9kRGVmaW5pdGlvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJDbGFzc01ldGhvZCI6CiAgICAgICAgICAgICAgICBjYXNlICJDbGFzc1ByaXZhdGVNZXRob2QiOiB7CiAgICAgICAgICAgICAgICAgIGlmICgodDMudmFsdWUgPyB0My52YWx1ZS5hc3luYyA6IHQzLmFzeW5jKSB8fCB0My5raW5kID09PSAiZ2V0IiB8fCB0My5raW5kID09PSAic2V0IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGU1ID0gdDMudmFsdWUgPyB0My52YWx1ZS5nZW5lcmF0b3IgOiB0My5nZW5lcmF0b3I7CiAgICAgICAgICAgICAgICAgIHJldHVybiAhKCF0My5jb21wdXRlZCAmJiAhZTUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAiVFNJbmRleFNpZ25hdHVyZSI6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0oYTIsIG8zW3IzICsgMV0pICYmIGkyLnB1c2goIjsiKSwgYTIgIT09IHMyICYmIChpMi5wdXNoKEZPKSwgUE8oYTIsIHQyKSAmJiBpMi5wdXNoKEZPKSk7CiAgICAgICAgICB9LCByMiksIGkyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBMTyhlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIHN3aXRjaCAobjIudHlwZSkgewogICAgICAgICAgICBjYXNlICJQYXJlbnRoZXNpemVkRXhwcmVzc2lvbiI6CiAgICAgICAgICAgIGNhc2UgIlR5cGVDYXN0RXhwcmVzc2lvbiI6CiAgICAgICAgICAgIGNhc2UgIkFycmF5RXhwcmVzc2lvbiI6CiAgICAgICAgICAgIGNhc2UgIkFycmF5UGF0dGVybiI6CiAgICAgICAgICAgIGNhc2UgIlRlbXBsYXRlTGl0ZXJhbCI6CiAgICAgICAgICAgIGNhc2UgIlRlbXBsYXRlRWxlbWVudCI6CiAgICAgICAgICAgIGNhc2UgIlJlZ0V4cExpdGVyYWwiOgogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBjYXNlICJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgaWYgKCFPTyhlMiwgdDIpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIlVuYXJ5RXhwcmVzc2lvbiI6IHsKICAgICAgICAgICAgICBjb25zdCB7IHByZWZpeDogZTMsIG9wZXJhdG9yOiB0MyB9ID0gbjI7CiAgICAgICAgICAgICAgaWYgKGUzICYmICh0MyA9PT0gIisiIHx8IHQzID09PSAiLSIpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiQmluZEV4cHJlc3Npb24iOgogICAgICAgICAgICAgIGlmICghbjIub2JqZWN0KQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIkxpdGVyYWwiOgogICAgICAgICAgICAgIGlmIChuMi5yZWdleCkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGlmIChUTyhuMikpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAhIXhPKGUyLCB0MikgfHwgISF3TyhuMikgJiYgZTIuY2FsbCgoZTMpID0+IExPKGUzLCB0MiksIC4uLlNPKGUyLCBuMikpOwogICAgICAgIH0KICAgICAgICBjb25zdCBqTyA9IChlMikgPT4gewogICAgICAgICAgbGV0IHsgdHlwZTogdDIgfSA9IGUyOwogICAgICAgICAgcmV0dXJuIHQyID09PSAiQ2xhc3NQcm9wZXJ0eSIgfHwgdDIgPT09ICJQcm9wZXJ0eURlZmluaXRpb24iIHx8IHQyID09PSAiQ2xhc3NQcml2YXRlUHJvcGVydHkiOwogICAgICAgIH07CiAgICAgICAgdmFyIF9PID0geyBwcmludEJvZHk6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBJTyhlMiwgdDIsIG4yLCAiYm9keSIpOwogICAgICAgIH0sIHByaW50U3dpdGNoQ2FzZUNvbnNlcXVlbnQ6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBJTyhlMiwgdDIsIG4yLCAiY29uc2VxdWVudCIpOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IHByaW50RGFuZ2xpbmdDb21tZW50czogTU8gfSA9IHRELCB7IGlzTm9uRW1wdHlBcnJheTogUk8gfSA9IGRjLCB7IGJ1aWxkZXJzOiB7IGhhcmRsaW5lOiBWTywgaW5kZW50OiAkTyB9IH0gPSBaYywgeyBoYXNDb21tZW50OiBXTywgQ29tbWVudENoZWNrRmxhZ3M6IHFPLCBpc05leHRMaW5lRW1wdHk6IFVPIH0gPSBDQywgeyBwcmludEhhcmRsaW5lQWZ0ZXJIZXJpdGFnZTogek8gfSA9IERrLCB7IHByaW50Qm9keTogR08gfSA9IF9POwogICAgICAgIGZ1bmN0aW9uIEhPKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKSwgbzIgPSBSTyhyMi5kaXJlY3RpdmVzKSwgaTIgPSByMi5ib2R5LnNvbWUoKGUzKSA9PiBlMy50eXBlICE9PSAiRW1wdHlTdGF0ZW1lbnQiKSwgdTIgPSBXTyhyMiwgcU8uRGFuZ2xpbmcpOwogICAgICAgICAgaWYgKCFvMiAmJiAhaTIgJiYgIXUyKQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICBjb25zdCBzMiA9IFtdOwogICAgICAgICAgaWYgKG8yICYmIGUyLmVhY2goKGUzLCByMywgbzMpID0+IHsKICAgICAgICAgICAgczIucHVzaChuMigpKSwgKHIzIDwgbzMubGVuZ3RoIC0gMSB8fCBpMiB8fCB1MikgJiYgKHMyLnB1c2goVk8pLCBVTyhlMy5nZXRWYWx1ZSgpLCB0MikgJiYgczIucHVzaChWTykpOwogICAgICAgICAgfSwgImRpcmVjdGl2ZXMiKSwgaTIgJiYgczIucHVzaChHTyhlMiwgdDIsIG4yKSksIHUyICYmIHMyLnB1c2goTU8oZTIsIHQyLCB0cnVlKSksIHIyLnR5cGUgPT09ICJQcm9ncmFtIikgewogICAgICAgICAgICBjb25zdCB0MyA9IGUyLmdldFBhcmVudE5vZGUoKTsKICAgICAgICAgICAgdDMgJiYgdDMudHlwZSA9PT0gIk1vZHVsZUV4cHJlc3Npb24iIHx8IHMyLnB1c2goVk8pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHMyOwogICAgICAgIH0KICAgICAgICB2YXIgSk8gPSB7IHByaW50QmxvY2s6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKSwgbzIgPSBbXTsKICAgICAgICAgIGlmIChyMi50eXBlID09PSAiU3RhdGljQmxvY2siICYmIG8yLnB1c2goInN0YXRpYyAiKSwgcjIudHlwZSA9PT0gIkNsYXNzQm9keSIgJiYgUk8ocjIuYm9keSkpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBlMi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICAgIG8yLnB1c2goek8odDMpKTsKICAgICAgICAgIH0KICAgICAgICAgIG8yLnB1c2goInsiKTsKICAgICAgICAgIGNvbnN0IGkyID0gSE8oZTIsIHQyLCBuMik7CiAgICAgICAgICBpZiAoaTIpCiAgICAgICAgICAgIG8yLnB1c2goJE8oW1ZPLCBpMl0pLCBWTyk7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBlMi5nZXRQYXJlbnROb2RlKCksIG4zID0gZTIuZ2V0UGFyZW50Tm9kZSgxKTsKICAgICAgICAgICAgdDMudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiB8fCB0My50eXBlID09PSAiRnVuY3Rpb25FeHByZXNzaW9uIiB8fCB0My50eXBlID09PSAiRnVuY3Rpb25EZWNsYXJhdGlvbiIgfHwgdDMudHlwZSA9PT0gIk9iamVjdE1ldGhvZCIgfHwgdDMudHlwZSA9PT0gIkNsYXNzTWV0aG9kIiB8fCB0My50eXBlID09PSAiQ2xhc3NQcml2YXRlTWV0aG9kIiB8fCB0My50eXBlID09PSAiRm9yU3RhdGVtZW50IiB8fCB0My50eXBlID09PSAiV2hpbGVTdGF0ZW1lbnQiIHx8IHQzLnR5cGUgPT09ICJEb1doaWxlU3RhdGVtZW50IiB8fCB0My50eXBlID09PSAiRG9FeHByZXNzaW9uIiB8fCB0My50eXBlID09PSAiQ2F0Y2hDbGF1c2UiICYmICFuMy5maW5hbGl6ZXIgfHwgdDMudHlwZSA9PT0gIlRTTW9kdWxlRGVjbGFyYXRpb24iIHx8IHQzLnR5cGUgPT09ICJUU0RlY2xhcmVGdW5jdGlvbiIgfHwgcjIudHlwZSA9PT0gIlN0YXRpY0Jsb2NrIiB8fCByMi50eXBlID09PSAiQ2xhc3NCb2R5IiB8fCBvMi5wdXNoKFZPKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBvMi5wdXNoKCJ9IiksIG8yOwogICAgICAgIH0sIHByaW50QmxvY2tCb2R5OiBITyB9OwogICAgICAgIGNvbnN0IHsgcHJpbnREYW5nbGluZ0NvbW1lbnRzOiBYTyB9ID0gdEQsIHsgaGFzTmV3bGluZUluUmFuZ2U6IFlPIH0gPSBkYywgeyBidWlsZGVyczogeyBqb2luOiBLTywgbGluZTogUU8sIGhhcmRsaW5lOiBaTywgc29mdGxpbmU6IGVJLCBncm91cDogdEksIGluZGVudDogbkksIGNvbmRpdGlvbmFsR3JvdXA6IHJJLCBpZkJyZWFrOiBvSSB9IH0gPSBaYywgeyBpc0xpdGVyYWw6IGlJLCBnZXRUeXBlU2NyaXB0TWFwcGVkVHlwZU1vZGlmaWVyOiB1SSwgc2hvdWxkUHJpbnRDb21tYTogc0ksIGlzQ2FsbEV4cHJlc3Npb246IGFJLCBpc01lbWJlckV4cHJlc3Npb246IGNJIH0gPSBDQywgeyBsb2NTdGFydDogbEksIGxvY0VuZDogcEkgfSA9IG9nLCB7IHByaW50T3B0aW9uYWxUb2tlbjogZkksIHByaW50VHlwZVNjcmlwdE1vZGlmaWVyczogZEkgfSA9IF94LCB7IHByaW50VGVybmFyeTogaEkgfSA9IEFPLCB7IHByaW50RnVuY3Rpb25QYXJhbWV0ZXJzOiBnSSwgc2hvdWxkR3JvdXBGdW5jdGlvblBhcmFtZXRlcnM6IG1JIH0gPSBXVCwgeyBwcmludFRlbXBsYXRlTGl0ZXJhbDogeUkgfSA9IFZDLCB7IHByaW50QXJyYXlJdGVtczogREkgfSA9IHVTLCB7IHByaW50T2JqZWN0OiBFSSB9ID0gdlAsIHsgcHJpbnRDbGFzc1Byb3BlcnR5OiBDSSwgcHJpbnRDbGFzc01ldGhvZDogYkkgfSA9IERrLCB7IHByaW50VHlwZVBhcmFtZXRlcjogdkksIHByaW50VHlwZVBhcmFtZXRlcnM6IEFJIH0gPSBPQiwgeyBwcmludFByb3BlcnR5S2V5OiBGSSB9ID0gekIsIHsgcHJpbnRGdW5jdGlvbjogeEksIHByaW50TWV0aG9kSW50ZXJuYWw6IFNJIH0gPSBJTiwgeyBwcmludEludGVyZmFjZTogd0kgfSA9IE5rLCB7IHByaW50QmxvY2s6IFRJIH0gPSBKTywgeyBwcmludFR5cGVBbGlhczogQkksIHByaW50SW50ZXJzZWN0aW9uVHlwZTogTkksIHByaW50VW5pb25UeXBlOiBrSSwgcHJpbnRGdW5jdGlvblR5cGU6IFBJLCBwcmludFR1cGxlVHlwZTogT0ksIHByaW50SW5kZXhlZEFjY2Vzc1R5cGU6IElJIH0gPSBmQjsKICAgICAgICB2YXIgTEkgPSB7IHByaW50VHlwZXNjcmlwdDogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgaWYgKCFyMi50eXBlLnN0YXJ0c1dpdGgoIlRTIikpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIGlmIChyMi50eXBlLmVuZHNXaXRoKCJLZXl3b3JkIikpCiAgICAgICAgICAgIHJldHVybiByMi50eXBlLnNsaWNlKDIsIC03KS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgY29uc3QgbzIgPSB0Mi5zZW1pID8gIjsiIDogIiIsIGkyID0gW107CiAgICAgICAgICBzd2l0Y2ggKHIyLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiVFNUaGlzVHlwZSI6CiAgICAgICAgICAgICAgcmV0dXJuICJ0aGlzIjsKICAgICAgICAgICAgY2FzZSAiVFNUeXBlQXNzZXJ0aW9uIjogewogICAgICAgICAgICAgIGNvbnN0IGUzID0gIShyMi5leHByZXNzaW9uLnR5cGUgPT09ICJBcnJheUV4cHJlc3Npb24iIHx8IHIyLmV4cHJlc3Npb24udHlwZSA9PT0gIk9iamVjdEV4cHJlc3Npb24iKSwgdDMgPSB0SShbIjwiLCBuSShbZUksIG4yKCJ0eXBlQW5ub3RhdGlvbiIpXSksIGVJLCAiPiJdKSwgbzMgPSBbb0koIigiKSwgbkkoW2VJLCBuMigiZXhwcmVzc2lvbiIpXSksIGVJLCBvSSgiKSIpXTsKICAgICAgICAgICAgICByZXR1cm4gZTMgPyBySShbW3QzLCBuMigiZXhwcmVzc2lvbiIpXSwgW3QzLCB0SShvMywgeyBzaG91bGRCcmVhazogdHJ1ZSB9KV0sIFt0MywgbjIoImV4cHJlc3Npb24iKV1dKSA6IHRJKFt0MywgbjIoImV4cHJlc3Npb24iKV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgIlRTRGVjbGFyZUZ1bmN0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4geEkoZTIsIG4yLCB0Mik7CiAgICAgICAgICAgIGNhc2UgIlRTRXhwb3J0QXNzaWdubWVudCI6CiAgICAgICAgICAgICAgcmV0dXJuIFsiZXhwb3J0ID0gIiwgbjIoImV4cHJlc3Npb24iKSwgbzJdOwogICAgICAgICAgICBjYXNlICJUU01vZHVsZUJsb2NrIjoKICAgICAgICAgICAgICByZXR1cm4gVEkoZTIsIHQyLCBuMik7CiAgICAgICAgICAgIGNhc2UgIlRTSW50ZXJmYWNlQm9keSI6CiAgICAgICAgICAgIGNhc2UgIlRTVHlwZUxpdGVyYWwiOgogICAgICAgICAgICAgIHJldHVybiBFSShlMiwgdDIsIG4yKTsKICAgICAgICAgICAgY2FzZSAiVFNUeXBlQWxpYXNEZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIEJJKGUyLCB0MiwgbjIpOwogICAgICAgICAgICBjYXNlICJUU1F1YWxpZmllZE5hbWUiOgogICAgICAgICAgICAgIHJldHVybiBLTygiLiIsIFtuMigibGVmdCIpLCBuMigicmlnaHQiKV0pOwogICAgICAgICAgICBjYXNlICJUU0Fic3RyYWN0TWV0aG9kRGVmaW5pdGlvbiI6CiAgICAgICAgICAgIGNhc2UgIlRTRGVjbGFyZU1ldGhvZCI6CiAgICAgICAgICAgICAgcmV0dXJuIGJJKGUyLCB0MiwgbjIpOwogICAgICAgICAgICBjYXNlICJUU0Fic3RyYWN0UHJvcGVydHlEZWZpbml0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gQ0koZTIsIHQyLCBuMik7CiAgICAgICAgICAgIGNhc2UgIlRTSW50ZXJmYWNlSGVyaXRhZ2UiOgogICAgICAgICAgICBjYXNlICJUU0V4cHJlc3Npb25XaXRoVHlwZUFyZ3VtZW50cyI6CiAgICAgICAgICAgICAgcmV0dXJuIGkyLnB1c2gobjIoImV4cHJlc3Npb24iKSksIHIyLnR5cGVQYXJhbWV0ZXJzICYmIGkyLnB1c2gobjIoInR5cGVQYXJhbWV0ZXJzIikpLCBpMjsKICAgICAgICAgICAgY2FzZSAiVFNUZW1wbGF0ZUxpdGVyYWxUeXBlIjoKICAgICAgICAgICAgICByZXR1cm4geUkoZTIsIG4yLCB0Mik7CiAgICAgICAgICAgIGNhc2UgIlRTTmFtZWRUdXBsZU1lbWJlciI6CiAgICAgICAgICAgICAgcmV0dXJuIFtuMigibGFiZWwiKSwgcjIub3B0aW9uYWwgPyAiPyIgOiAiIiwgIjogIiwgbjIoImVsZW1lbnRUeXBlIildOwogICAgICAgICAgICBjYXNlICJUU1Jlc3RUeXBlIjoKICAgICAgICAgICAgICByZXR1cm4gWyIuLi4iLCBuMigidHlwZUFubm90YXRpb24iKV07CiAgICAgICAgICAgIGNhc2UgIlRTT3B0aW9uYWxUeXBlIjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJ0eXBlQW5ub3RhdGlvbiIpLCAiPyJdOwogICAgICAgICAgICBjYXNlICJUU0ludGVyZmFjZURlY2xhcmF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gd0koZTIsIHQyLCBuMik7CiAgICAgICAgICAgIGNhc2UgIlRTQ2xhc3NJbXBsZW1lbnRzIjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJleHByZXNzaW9uIiksIG4yKCJ0eXBlUGFyYW1ldGVycyIpXTsKICAgICAgICAgICAgY2FzZSAiVFNUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24iOgogICAgICAgICAgICBjYXNlICJUU1R5cGVQYXJhbWV0ZXJJbnN0YW50aWF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gQUkoZTIsIHQyLCBuMiwgInBhcmFtcyIpOwogICAgICAgICAgICBjYXNlICJUU1R5cGVQYXJhbWV0ZXIiOgogICAgICAgICAgICAgIHJldHVybiB2SShlMiwgdDIsIG4yKTsKICAgICAgICAgICAgY2FzZSAiVFNBc0V4cHJlc3Npb24iOiB7CiAgICAgICAgICAgICAgaTIucHVzaChuMigiZXhwcmVzc2lvbiIpLCAiIGFzICIsIG4yKCJ0eXBlQW5ub3RhdGlvbiIpKTsKICAgICAgICAgICAgICBjb25zdCB0MyA9IGUyLmdldFBhcmVudE5vZGUoKTsKICAgICAgICAgICAgICByZXR1cm4gYUkodDMpICYmIHQzLmNhbGxlZSA9PT0gcjIgfHwgY0kodDMpICYmIHQzLm9iamVjdCA9PT0gcjIgPyB0SShbbkkoW2VJLCAuLi5pMl0pLCBlSV0pIDogaTI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiVFNBcnJheVR5cGUiOgogICAgICAgICAgICAgIHJldHVybiBbbjIoImVsZW1lbnRUeXBlIiksICJbXSJdOwogICAgICAgICAgICBjYXNlICJUU1Byb3BlcnR5U2lnbmF0dXJlIjoKICAgICAgICAgICAgICByZXR1cm4gcjIucmVhZG9ubHkgJiYgaTIucHVzaCgicmVhZG9ubHkgIiksIGkyLnB1c2goRkkoZTIsIHQyLCBuMiksIGZJKGUyKSksIHIyLnR5cGVBbm5vdGF0aW9uICYmIGkyLnB1c2goIjogIiwgbjIoInR5cGVBbm5vdGF0aW9uIikpLCByMi5pbml0aWFsaXplciAmJiBpMi5wdXNoKCIgPSAiLCBuMigiaW5pdGlhbGl6ZXIiKSksIGkyOwogICAgICAgICAgICBjYXNlICJUU1BhcmFtZXRlclByb3BlcnR5IjoKICAgICAgICAgICAgICByZXR1cm4gcjIuYWNjZXNzaWJpbGl0eSAmJiBpMi5wdXNoKHIyLmFjY2Vzc2liaWxpdHkgKyAiICIpLCByMi5leHBvcnQgJiYgaTIucHVzaCgiZXhwb3J0ICIpLCByMi5zdGF0aWMgJiYgaTIucHVzaCgic3RhdGljICIpLCByMi5vdmVycmlkZSAmJiBpMi5wdXNoKCJvdmVycmlkZSAiKSwgcjIucmVhZG9ubHkgJiYgaTIucHVzaCgicmVhZG9ubHkgIiksIGkyLnB1c2gobjIoInBhcmFtZXRlciIpKSwgaTI7CiAgICAgICAgICAgIGNhc2UgIlRTVHlwZVF1ZXJ5IjoKICAgICAgICAgICAgICByZXR1cm4gWyJ0eXBlb2YgIiwgbjIoImV4cHJOYW1lIildOwogICAgICAgICAgICBjYXNlICJUU0luZGV4U2lnbmF0dXJlIjogewogICAgICAgICAgICAgIGNvbnN0IGkzID0gZTIuZ2V0UGFyZW50Tm9kZSgpLCB1MiA9IHIyLnBhcmFtZXRlcnMubGVuZ3RoID4gMSA/IG9JKHNJKHQyKSA/ICIsIiA6ICIiKSA6ICIiLCBzMiA9IHRJKFtuSShbZUksIEtPKFsiLCAiLCBlSV0sIGUyLm1hcChuMiwgInBhcmFtZXRlcnMiKSldKSwgdTIsIGVJXSk7CiAgICAgICAgICAgICAgcmV0dXJuIFtyMi5leHBvcnQgPyAiZXhwb3J0ICIgOiAiIiwgcjIuYWNjZXNzaWJpbGl0eSA/IFtyMi5hY2Nlc3NpYmlsaXR5LCAiICJdIDogIiIsIHIyLnN0YXRpYyA/ICJzdGF0aWMgIiA6ICIiLCByMi5yZWFkb25seSA/ICJyZWFkb25seSAiIDogIiIsIHIyLmRlY2xhcmUgPyAiZGVjbGFyZSAiIDogIiIsICJbIiwgcjIucGFyYW1ldGVycyA/IHMyIDogIiIsIHIyLnR5cGVBbm5vdGF0aW9uID8gIl06ICIgOiAiXSIsIHIyLnR5cGVBbm5vdGF0aW9uID8gbjIoInR5cGVBbm5vdGF0aW9uIikgOiAiIiwgaTMudHlwZSA9PT0gIkNsYXNzQm9keSIgPyBvMiA6ICIiXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJUU1R5cGVQcmVkaWNhdGUiOgogICAgICAgICAgICAgIHJldHVybiBbcjIuYXNzZXJ0cyA/ICJhc3NlcnRzICIgOiAiIiwgbjIoInBhcmFtZXRlck5hbWUiKSwgcjIudHlwZUFubm90YXRpb24gPyBbIiBpcyAiLCBuMigidHlwZUFubm90YXRpb24iKV0gOiAiIl07CiAgICAgICAgICAgIGNhc2UgIlRTTm9uTnVsbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgIHJldHVybiBbbjIoImV4cHJlc3Npb24iKSwgIiEiXTsKICAgICAgICAgICAgY2FzZSAiVFNJbXBvcnRUeXBlIjoKICAgICAgICAgICAgICByZXR1cm4gW3IyLmlzVHlwZU9mID8gInR5cGVvZiAiIDogIiIsICJpbXBvcnQoIiwgbjIocjIucGFyYW1ldGVyID8gInBhcmFtZXRlciIgOiAiYXJndW1lbnQiKSwgIikiLCByMi5xdWFsaWZpZXIgPyBbIi4iLCBuMigicXVhbGlmaWVyIildIDogIiIsIEFJKGUyLCB0MiwgbjIsICJ0eXBlUGFyYW1ldGVycyIpXTsKICAgICAgICAgICAgY2FzZSAiVFNMaXRlcmFsVHlwZSI6CiAgICAgICAgICAgICAgcmV0dXJuIG4yKCJsaXRlcmFsIik7CiAgICAgICAgICAgIGNhc2UgIlRTSW5kZXhlZEFjY2Vzc1R5cGUiOgogICAgICAgICAgICAgIHJldHVybiBJSShlMiwgdDIsIG4yKTsKICAgICAgICAgICAgY2FzZSAiVFNDb25zdHJ1Y3RTaWduYXR1cmVEZWNsYXJhdGlvbiI6CiAgICAgICAgICAgIGNhc2UgIlRTQ2FsbFNpZ25hdHVyZURlY2xhcmF0aW9uIjoKICAgICAgICAgICAgY2FzZSAiVFNDb25zdHJ1Y3RvclR5cGUiOgogICAgICAgICAgICAgIGlmIChyMi50eXBlID09PSAiVFNDb25zdHJ1Y3RvclR5cGUiICYmIHIyLmFic3RyYWN0ICYmIGkyLnB1c2goImFic3RyYWN0ICIpLCByMi50eXBlICE9PSAiVFNDYWxsU2lnbmF0dXJlRGVjbGFyYXRpb24iICYmIGkyLnB1c2goIm5ldyAiKSwgaTIucHVzaCh0SShnSShlMiwgbjIsIHQyLCBmYWxzZSwgdHJ1ZSkpKSwgcjIucmV0dXJuVHlwZSB8fCByMi50eXBlQW5ub3RhdGlvbikgewogICAgICAgICAgICAgICAgY29uc3QgZTMgPSByMi50eXBlID09PSAiVFNDb25zdHJ1Y3RvclR5cGUiOwogICAgICAgICAgICAgICAgaTIucHVzaChlMyA/ICIgPT4gIiA6ICI6ICIsIG4yKCJyZXR1cm5UeXBlIiksIG4yKCJ0eXBlQW5ub3RhdGlvbiIpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGkyOwogICAgICAgICAgICBjYXNlICJUU1R5cGVPcGVyYXRvciI6CiAgICAgICAgICAgICAgcmV0dXJuIFtyMi5vcGVyYXRvciwgIiAiLCBuMigidHlwZUFubm90YXRpb24iKV07CiAgICAgICAgICAgIGNhc2UgIlRTTWFwcGVkVHlwZSI6IHsKICAgICAgICAgICAgICBjb25zdCBpMyA9IFlPKHQyLm9yaWdpbmFsVGV4dCwgbEkocjIpLCBwSShyMikpOwogICAgICAgICAgICAgIHJldHVybiB0SShbInsiLCBuSShbdDIuYnJhY2tldFNwYWNpbmcgPyBRTyA6IGVJLCByMi5yZWFkb25seSA/IFt1SShyMi5yZWFkb25seSwgInJlYWRvbmx5IiksICIgIl0gOiAiIiwgZEkoZTIsIHQyLCBuMiksIG4yKCJ0eXBlUGFyYW1ldGVyIiksIHIyLm9wdGlvbmFsID8gdUkocjIub3B0aW9uYWwsICI/IikgOiAiIiwgcjIudHlwZUFubm90YXRpb24gPyAiOiAiIDogIiIsIG4yKCJ0eXBlQW5ub3RhdGlvbiIpLCBvSShvMildKSwgWE8oZTIsIHQyLCB0cnVlKSwgdDIuYnJhY2tldFNwYWNpbmcgPyBRTyA6IGVJLCAifSJdLCB7IHNob3VsZEJyZWFrOiBpMyB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJUU01ldGhvZFNpZ25hdHVyZSI6IHsKICAgICAgICAgICAgICBjb25zdCBvMyA9IHIyLmtpbmQgJiYgcjIua2luZCAhPT0gIm1ldGhvZCIgPyAiIi5jb25jYXQocjIua2luZCwgIiAiKSA6ICIiOwogICAgICAgICAgICAgIGkyLnB1c2gocjIuYWNjZXNzaWJpbGl0eSA/IFtyMi5hY2Nlc3NpYmlsaXR5LCAiICJdIDogIiIsIG8zLCByMi5leHBvcnQgPyAiZXhwb3J0ICIgOiAiIiwgcjIuc3RhdGljID8gInN0YXRpYyAiIDogIiIsIHIyLnJlYWRvbmx5ID8gInJlYWRvbmx5ICIgOiAiIiwgcjIuYWJzdHJhY3QgPyAiYWJzdHJhY3QgIiA6ICIiLCByMi5kZWNsYXJlID8gImRlY2xhcmUgIiA6ICIiLCByMi5jb21wdXRlZCA/ICJbIiA6ICIiLCBuMigia2V5IiksIHIyLmNvbXB1dGVkID8gIl0iIDogIiIsIGZJKGUyKSk7CiAgICAgICAgICAgICAgY29uc3QgdTIgPSBnSShlMiwgbjIsIHQyLCBmYWxzZSwgdHJ1ZSksIHMyID0gcjIucmV0dXJuVHlwZSA/ICJyZXR1cm5UeXBlIiA6ICJ0eXBlQW5ub3RhdGlvbiIsIGEyID0gcjJbczJdLCBjMiA9IGEyID8gbjIoczIpIDogIiIsIGwyID0gbUkocjIsIGMyKTsKICAgICAgICAgICAgICByZXR1cm4gaTIucHVzaChsMiA/IHRJKHUyKSA6IHUyKSwgYTIgJiYgaTIucHVzaCgiOiAiLCB0SShjMikpLCB0SShpMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiVFNOYW1lc3BhY2VFeHBvcnREZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIGkyLnB1c2goImV4cG9ydCBhcyBuYW1lc3BhY2UgIiwgbjIoImlkIikpLCB0Mi5zZW1pICYmIGkyLnB1c2goIjsiKSwgdEkoaTIpOwogICAgICAgICAgICBjYXNlICJUU0VudW1EZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHIyLmRlY2xhcmUgJiYgaTIucHVzaCgiZGVjbGFyZSAiKSwgcjIubW9kaWZpZXJzICYmIGkyLnB1c2goZEkoZTIsIHQyLCBuMikpLCByMi5jb25zdCAmJiBpMi5wdXNoKCJjb25zdCAiKSwgaTIucHVzaCgiZW51bSAiLCBuMigiaWQiKSwgIiAiKSwgcjIubWVtYmVycy5sZW5ndGggPT09IDAgPyBpMi5wdXNoKHRJKFsieyIsIFhPKGUyLCB0MiksIGVJLCAifSJdKSkgOiBpMi5wdXNoKHRJKFsieyIsIG5JKFtaTywgREkoZTIsIHQyLCAibWVtYmVycyIsIG4yKSwgc0kodDIsICJlczUiKSA/ICIsIiA6ICIiXSksIFhPKGUyLCB0MiwgdHJ1ZSksIFpPLCAifSJdKSksIGkyOwogICAgICAgICAgICBjYXNlICJUU0VudW1NZW1iZXIiOgogICAgICAgICAgICAgIHJldHVybiBpMi5wdXNoKG4yKCJpZCIpKSwgcjIuaW5pdGlhbGl6ZXIgJiYgaTIucHVzaCgiID0gIiwgbjIoImluaXRpYWxpemVyIikpLCBpMjsKICAgICAgICAgICAgY2FzZSAiVFNJbXBvcnRFcXVhbHNEZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHIyLmlzRXhwb3J0ICYmIGkyLnB1c2goImV4cG9ydCAiKSwgaTIucHVzaCgiaW1wb3J0ICIpLCByMi5pbXBvcnRLaW5kICYmIHIyLmltcG9ydEtpbmQgIT09ICJ2YWx1ZSIgJiYgaTIucHVzaChyMi5pbXBvcnRLaW5kLCAiICIpLCBpMi5wdXNoKG4yKCJpZCIpLCAiID0gIiwgbjIoIm1vZHVsZVJlZmVyZW5jZSIpKSwgdDIuc2VtaSAmJiBpMi5wdXNoKCI7IiksIHRJKGkyKTsKICAgICAgICAgICAgY2FzZSAiVFNFeHRlcm5hbE1vZHVsZVJlZmVyZW5jZSI6CiAgICAgICAgICAgICAgcmV0dXJuIFsicmVxdWlyZSgiLCBuMigiZXhwcmVzc2lvbiIpLCAiKSJdOwogICAgICAgICAgICBjYXNlICJUU01vZHVsZURlY2xhcmF0aW9uIjogewogICAgICAgICAgICAgIGNvbnN0IHUyID0gZTIuZ2V0UGFyZW50Tm9kZSgpLCBzMiA9IGlJKHIyLmlkKSwgYTIgPSB1Mi50eXBlID09PSAiVFNNb2R1bGVEZWNsYXJhdGlvbiIsIGMyID0gcjIuYm9keSAmJiByMi5ib2R5LnR5cGUgPT09ICJUU01vZHVsZURlY2xhcmF0aW9uIjsKICAgICAgICAgICAgICBpZiAoYTIpCiAgICAgICAgICAgICAgICBpMi5wdXNoKCIuIik7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByMi5kZWNsYXJlICYmIGkyLnB1c2goImRlY2xhcmUgIiksIGkyLnB1c2goZEkoZTIsIHQyLCBuMikpOwogICAgICAgICAgICAgICAgY29uc3QgbzMgPSB0Mi5vcmlnaW5hbFRleHQuc2xpY2UobEkocjIpLCBsSShyMi5pZCkpOwogICAgICAgICAgICAgICAgcjIuaWQudHlwZSA9PT0gIklkZW50aWZpZXIiICYmIHIyLmlkLm5hbWUgPT09ICJnbG9iYWwiICYmICEvbmFtZXNwYWNlfG1vZHVsZS8udGVzdChvMykgfHwgaTIucHVzaChzMiB8fCAvKD86Xnxccyltb2R1bGUoPzpcc3wkKS8udGVzdChvMykgPyAibW9kdWxlICIgOiAibmFtZXNwYWNlICIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gaTIucHVzaChuMigiaWQiKSksIGMyID8gaTIucHVzaChuMigiYm9keSIpKSA6IHIyLmJvZHkgPyBpMi5wdXNoKCIgIiwgdEkobjIoImJvZHkiKSkpIDogaTIucHVzaChvMiksIGkyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgIlRTQ29uZGl0aW9uYWxUeXBlIjoKICAgICAgICAgICAgICByZXR1cm4gaEkoZTIsIHQyLCBuMik7CiAgICAgICAgICAgIGNhc2UgIlRTSW5mZXJUeXBlIjoKICAgICAgICAgICAgICByZXR1cm4gWyJpbmZlciIsICIgIiwgbjIoInR5cGVQYXJhbWV0ZXIiKV07CiAgICAgICAgICAgIGNhc2UgIlRTSW50ZXJzZWN0aW9uVHlwZSI6CiAgICAgICAgICAgICAgcmV0dXJuIE5JKGUyLCB0MiwgbjIpOwogICAgICAgICAgICBjYXNlICJUU1VuaW9uVHlwZSI6CiAgICAgICAgICAgICAgcmV0dXJuIGtJKGUyLCB0MiwgbjIpOwogICAgICAgICAgICBjYXNlICJUU0Z1bmN0aW9uVHlwZSI6CiAgICAgICAgICAgICAgcmV0dXJuIFBJKGUyLCB0MiwgbjIpOwogICAgICAgICAgICBjYXNlICJUU1R1cGxlVHlwZSI6CiAgICAgICAgICAgICAgcmV0dXJuIE9JKGUyLCB0MiwgbjIpOwogICAgICAgICAgICBjYXNlICJUU1R5cGVSZWZlcmVuY2UiOgogICAgICAgICAgICAgIHJldHVybiBbbjIoInR5cGVOYW1lIiksIEFJKGUyLCB0MiwgbjIsICJ0eXBlUGFyYW1ldGVycyIpXTsKICAgICAgICAgICAgY2FzZSAiVFNUeXBlQW5ub3RhdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIG4yKCJ0eXBlQW5ub3RhdGlvbiIpOwogICAgICAgICAgICBjYXNlICJUU0VtcHR5Qm9keUZ1bmN0aW9uRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIFNJKGUyLCB0MiwgbjIpOwogICAgICAgICAgICBjYXNlICJUU0pTRG9jQWxsVHlwZSI6CiAgICAgICAgICAgICAgcmV0dXJuICIqIjsKICAgICAgICAgICAgY2FzZSAiVFNKU0RvY1Vua25vd25UeXBlIjoKICAgICAgICAgICAgICByZXR1cm4gIj8iOwogICAgICAgICAgICBjYXNlICJUU0pTRG9jTnVsbGFibGVUeXBlIjoKICAgICAgICAgICAgICByZXR1cm4gWyI/IiwgbjIoInR5cGVBbm5vdGF0aW9uIildOwogICAgICAgICAgICBjYXNlICJUU0pTRG9jTm9uTnVsbGFibGVUeXBlIjoKICAgICAgICAgICAgICByZXR1cm4gWyIhIiwgbjIoInR5cGVBbm5vdGF0aW9uIildOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBUeXBlU2NyaXB0IG5vZGUgdHlwZTogIi5jb25jYXQoSlNPTi5zdHJpbmdpZnkocjIudHlwZSksICIuIikpOwogICAgICAgICAgfQogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IGhhc05ld2xpbmU6IGpJIH0gPSBkYywgeyBidWlsZGVyczogeyBqb2luOiBfSSwgaGFyZGxpbmU6IE1JIH0sIHV0aWxzOiB7IHJlcGxhY2VUZXh0RW5kT2ZMaW5lOiBSSSB9IH0gPSBaYywgeyBpc0xpbmVDb21tZW50OiBWSSwgaXNCbG9ja0NvbW1lbnQ6ICRJIH0gPSBDQywgeyBsb2NTdGFydDogV0ksIGxvY0VuZDogcUkgfSA9IG9nOwogICAgICAgIHZhciBVSSA9IHsgcHJpbnRDb21tZW50OiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIGlmIChWSShuMikpCiAgICAgICAgICAgIHJldHVybiB0Mi5vcmlnaW5hbFRleHQuc2xpY2UoV0kobjIpLCBxSShuMikpLnRyaW1FbmQoKTsKICAgICAgICAgIGlmICgkSShuMikpIHsKICAgICAgICAgICAgaWYgKGZ1bmN0aW9uKGU0KSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSAiKiIuY29uY2F0KGU0LnZhbHVlLCAiKiIpLnNwbGl0KCJcbiIpOwogICAgICAgICAgICAgIHJldHVybiB0My5sZW5ndGggPiAxICYmIHQzLmV2ZXJ5KChlNSkgPT4gZTUudHJpbSgpWzBdID09PSAiKiIpOwogICAgICAgICAgICB9KG4yKSkgewogICAgICAgICAgICAgIGNvbnN0IGU0ID0gZnVuY3Rpb24oZTUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gZTUudmFsdWUuc3BsaXQoIlxuIik7CiAgICAgICAgICAgICAgICByZXR1cm4gWyIvKiIsIF9JKE1JLCB0My5tYXAoKGU2LCBuMykgPT4gbjMgPT09IDAgPyBlNi50cmltRW5kKCkgOiAiICIgKyAobjMgPCB0My5sZW5ndGggLSAxID8gZTYudHJpbSgpIDogZTYudHJpbVN0YXJ0KCkpKSksICIqLyJdOwogICAgICAgICAgICAgIH0objIpOwogICAgICAgICAgICAgIHJldHVybiBuMi50cmFpbGluZyAmJiAhakkodDIub3JpZ2luYWxUZXh0LCBXSShuMiksIHsgYmFja3dhcmRzOiB0cnVlIH0pID8gW01JLCBlNF0gOiBlNDsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBlMyA9IHFJKG4yKSwgcjIgPSB0Mi5vcmlnaW5hbFRleHQuc2xpY2UoZTMgLSAzLCBlMykgPT09ICIqLS8iOwogICAgICAgICAgICByZXR1cm4gWyIvKiIsIFJJKG4yLnZhbHVlKSwgcjIgPyAiKi0vIiA6ICIqLyJdOwogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgYSBjb21tZW50OiAiICsgSlNPTi5zdHJpbmdpZnkobjIpKTsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgeyBwcmludFN0cmluZzogekksIHByaW50TnVtYmVyOiBHSSB9ID0gZGM7CiAgICAgICAgZnVuY3Rpb24gSEkoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50b0xvd2VyQ2FzZSgpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBKSShlMikgewogICAgICAgICAgbGV0IHsgcGF0dGVybjogdDIsIGZsYWdzOiBuMiB9ID0gZTI7CiAgICAgICAgICByZXR1cm4gbjIgPSBbLi4ubjJdLnNvcnQoKS5qb2luKCIiKSwgIi8iLmNvbmNhdCh0MiwgIi8iKS5jb25jYXQobjIpOwogICAgICAgIH0KICAgICAgICB2YXIgWEkgPSB7IHByaW50TGl0ZXJhbDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IGUyLmdldE5vZGUoKTsKICAgICAgICAgIHN3aXRjaCAobjIudHlwZSkgewogICAgICAgICAgICBjYXNlICJSZWdFeHBMaXRlcmFsIjoKICAgICAgICAgICAgICByZXR1cm4gSkkobjIpOwogICAgICAgICAgICBjYXNlICJCaWdJbnRMaXRlcmFsIjoKICAgICAgICAgICAgICByZXR1cm4gSEkobjIuYmlnaW50IHx8IG4yLmV4dHJhLnJhdyk7CiAgICAgICAgICAgIGNhc2UgIk51bWVyaWNMaXRlcmFsIjoKICAgICAgICAgICAgICByZXR1cm4gR0kobjIuZXh0cmEucmF3KTsKICAgICAgICAgICAgY2FzZSAiU3RyaW5nTGl0ZXJhbCI6CiAgICAgICAgICAgICAgcmV0dXJuIHpJKG4yLmV4dHJhLnJhdywgdDIpOwogICAgICAgICAgICBjYXNlICJOdWxsTGl0ZXJhbCI6CiAgICAgICAgICAgICAgcmV0dXJuICJudWxsIjsKICAgICAgICAgICAgY2FzZSAiQm9vbGVhbkxpdGVyYWwiOgogICAgICAgICAgICAgIHJldHVybiBTdHJpbmcobjIudmFsdWUpOwogICAgICAgICAgICBjYXNlICJEZWNpbWFsTGl0ZXJhbCI6CiAgICAgICAgICAgICAgcmV0dXJuIEdJKG4yLnZhbHVlKSArICJtIjsKICAgICAgICAgICAgY2FzZSAiTGl0ZXJhbCI6IHsKICAgICAgICAgICAgICBpZiAobjIucmVnZXgpCiAgICAgICAgICAgICAgICByZXR1cm4gSkkobjIucmVnZXgpOwogICAgICAgICAgICAgIGlmIChuMi5iaWdpbnQpCiAgICAgICAgICAgICAgICByZXR1cm4gSEkobjIucmF3KTsKICAgICAgICAgICAgICBpZiAobjIuZGVjaW1hbCkKICAgICAgICAgICAgICAgIHJldHVybiBHSShuMi5kZWNpbWFsKSArICJtIjsKICAgICAgICAgICAgICBjb25zdCB7IHZhbHVlOiBlMyB9ID0gbjI7CiAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBlMyA9PSAibnVtYmVyIiA/IEdJKG4yLnJhdykgOiB0eXBlb2YgZTMgPT0gInN0cmluZyIgPyB6SShuMi5yYXcsIHQyKSA6IFN0cmluZyhlMyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IH07CiAgICAgICAgY29uc3QgeyBwcmludERhbmdsaW5nQ29tbWVudHM6IFlJIH0gPSB0RCwgeyBoYXNOZXdsaW5lOiBLSSB9ID0gZGMsIHsgYnVpbGRlcnM6IHsgam9pbjogUUksIGxpbmU6IFpJLCBoYXJkbGluZTogZUwsIHNvZnRsaW5lOiB0TCwgZ3JvdXA6IG5MLCBpbmRlbnQ6IHJMIH0sIHV0aWxzOiB7IHJlcGxhY2VUZXh0RW5kT2ZMaW5lOiBvTCB9IH0gPSBaYywgaUwgPSBOYiwgdUwgPSBMYiwgeyBpbnNlcnRQcmFnbWE6IHNMIH0gPSBpdiwgYUwgPSBsQSwgY0wgPSB3QSwgbEwgPSBUQSwgeyBoYXNGbG93U2hvcnRoYW5kQW5ub3RhdGlvbkNvbW1lbnQ6IHBMLCBoYXNDb21tZW50OiBmTCwgQ29tbWVudENoZWNrRmxhZ3M6IGRMLCBpc1RoZU9ubHlKc3hFbGVtZW50SW5NYXJrZG93bjogaEwsIGlzQmxvY2tDb21tZW50OiBnTCwgaXNMaW5lQ29tbWVudDogbUwsIGlzTmV4dExpbmVFbXB0eTogeUwsIG5lZWRzSGFyZGxpbmVBZnRlckRhbmdsaW5nQ29tbWVudDogREwsIHJhd1RleHQ6IEVMLCBoYXNJZ25vcmVDb21tZW50OiBDTCwgaXNDYWxsRXhwcmVzc2lvbjogYkwsIGlzTWVtYmVyRXhwcmVzc2lvbjogdkwgfSA9IENDLCB7IGxvY1N0YXJ0OiBBTCwgbG9jRW5kOiBGTCB9ID0gb2csIHsgcHJpbnRIdG1sQmluZGluZzogeEwsIGlzVnVlRXZlbnRCaW5kaW5nRXhwcmVzc2lvbjogU0wgfSA9IElBLCB7IHByaW50QW5ndWxhcjogd0wgfSA9IG1GLCB7IHByaW50SnN4OiBUTCwgaGFzSnN4SWdub3JlQ29tbWVudDogQkwgfSA9IFpGLCB7IHByaW50RmxvdzogTkwgfSA9IG9PLCB7IHByaW50VHlwZXNjcmlwdDoga0wgfSA9IExJLCB7IHByaW50T3B0aW9uYWxUb2tlbjogUEwsIHByaW50QmluZEV4cHJlc3Npb25DYWxsZWU6IE9MLCBwcmludFR5cGVBbm5vdGF0aW9uOiBJTCwgYWRqdXN0Q2xhdXNlOiBMTCwgcHJpbnRSZXN0U3ByZWFkOiBqTCB9ID0gX3gsIHsgcHJpbnRJbXBvcnREZWNsYXJhdGlvbjogX0wsIHByaW50RXhwb3J0RGVjbGFyYXRpb246IE1MLCBwcmludEV4cG9ydEFsbERlY2xhcmF0aW9uOiBSTCwgcHJpbnRNb2R1bGVTcGVjaWZpZXI6IFZMIH0gPSBRaywgeyBwcmludFRlcm5hcnk6ICRMIH0gPSBBTywgeyBwcmludFRlbXBsYXRlTGl0ZXJhbDogV0wgfSA9IFZDLCB7IHByaW50QXJyYXk6IHFMIH0gPSB1UywgeyBwcmludE9iamVjdDogVUwgfSA9IHZQLCB7IHByaW50Q2xhc3M6IHpMLCBwcmludENsYXNzTWV0aG9kOiBHTCwgcHJpbnRDbGFzc1Byb3BlcnR5OiBITCB9ID0gRGssIHsgcHJpbnRQcm9wZXJ0eTogSkwgfSA9IHpCLCB7IHByaW50RnVuY3Rpb246IFhMLCBwcmludEFycm93RnVuY3Rpb246IFlMLCBwcmludE1ldGhvZDogS0wsIHByaW50UmV0dXJuU3RhdGVtZW50OiBRTCwgcHJpbnRUaHJvd1N0YXRlbWVudDogWkwgfSA9IElOLCB7IHByaW50Q2FsbEV4cHJlc3Npb246IGVqIH0gPSBNdywgeyBwcmludFZhcmlhYmxlRGVjbGFyYXRvcjogdGosIHByaW50QXNzaWdubWVudEV4cHJlc3Npb246IG5qIH0gPSBtVCwgeyBwcmludEJpbmFyeWlzaEV4cHJlc3Npb246IHJqIH0gPSBzRiwgeyBwcmludFN3aXRjaENhc2VDb25zZXF1ZW50OiBvaiB9ID0gX08sIHsgcHJpbnRNZW1iZXJFeHByZXNzaW9uOiBpaiB9ID0gR1MsIHsgcHJpbnRCbG9jazogdWosIHByaW50QmxvY2tCb2R5OiBzaiB9ID0gSk8sIHsgcHJpbnRDb21tZW50OiBhaiB9ID0gVUksIHsgcHJpbnRMaXRlcmFsOiBjaiB9ID0gWEksIHsgcHJpbnREZWNvcmF0b3JzOiBsaiB9ID0gSE47CiAgICAgICAgZnVuY3Rpb24gcGooZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IEVMKGUyKSwgcjIgPSBuMi5zbGljZSgxLCAtMSk7CiAgICAgICAgICBpZiAocjIuaW5jbHVkZXMoJyInKSB8fCByMi5pbmNsdWRlcygiJyIpKQogICAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgICBjb25zdCBvMiA9IHQyLnNpbmdsZVF1b3RlID8gIiciIDogJyInOwogICAgICAgICAgcmV0dXJuIG8yICsgcjIgKyBvMjsKICAgICAgICB9CiAgICAgICAgdmFyIGZqID0geyBwcmVwcm9jZXNzOiBsTCwgcHJpbnQ6IGZ1bmN0aW9uKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICBjb25zdCBvMiA9IGZ1bmN0aW9uKGUzLCB0MywgbjMsIHIzKSB7CiAgICAgICAgICAgIGNvbnN0IG8zID0gZTMuZ2V0VmFsdWUoKSwgaTMgPSB0My5zZW1pID8gIjsiIDogIiI7CiAgICAgICAgICAgIGlmICghbzMpCiAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICBpZiAodHlwZW9mIG8zID09ICJzdHJpbmciKQogICAgICAgICAgICAgIHJldHVybiBvMzsKICAgICAgICAgICAgZm9yIChjb25zdCByNCBvZiBbY2osIHhMLCB3TCwgVEwsIE5MLCBrTF0pIHsKICAgICAgICAgICAgICBjb25zdCBvNCA9IHI0KGUzLCB0MywgbjMpOwogICAgICAgICAgICAgIGlmIChvNCAhPT0gdm9pZCAwKQogICAgICAgICAgICAgICAgcmV0dXJuIG80OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCB1MyA9IFtdOwogICAgICAgICAgICBzd2l0Y2ggKG8zLnR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICJKc0V4cHJlc3Npb25Sb290IjoKICAgICAgICAgICAgICAgIHJldHVybiBuMygibm9kZSIpOwogICAgICAgICAgICAgIGNhc2UgIkpzb25Sb290IjoKICAgICAgICAgICAgICAgIHJldHVybiBbbjMoIm5vZGUiKSwgZUxdOwogICAgICAgICAgICAgIGNhc2UgIkZpbGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIG8zLnByb2dyYW0gJiYgbzMucHJvZ3JhbS5pbnRlcnByZXRlciAmJiB1My5wdXNoKG4zKFsicHJvZ3JhbSIsICJpbnRlcnByZXRlciJdKSksIHUzLnB1c2gobjMoInByb2dyYW0iKSksIHUzOwogICAgICAgICAgICAgIGNhc2UgIlByb2dyYW0iOgogICAgICAgICAgICAgICAgcmV0dXJuIHNqKGUzLCB0MywgbjMpOwogICAgICAgICAgICAgIGNhc2UgIkVtcHR5U3RhdGVtZW50IjoKICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICBjYXNlICJFeHByZXNzaW9uU3RhdGVtZW50IjoKICAgICAgICAgICAgICAgIGlmIChvMy5kaXJlY3RpdmUpCiAgICAgICAgICAgICAgICAgIHJldHVybiBbcGoobzMuZXhwcmVzc2lvbiwgdDMpLCBpM107CiAgICAgICAgICAgICAgICBpZiAodDMucGFyc2VyID09PSAiX192dWVfZXZlbnRfYmluZGluZyIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdDQgPSBlMy5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICAgICAgICAgIGlmICh0NC50eXBlID09PSAiUHJvZ3JhbSIgJiYgdDQuYm9keS5sZW5ndGggPT09IDEgJiYgdDQuYm9keVswXSA9PT0gbzMpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtuMygiZXhwcmVzc2lvbiIpLCBTTChvMy5leHByZXNzaW9uKSA/ICI7IiA6ICIiXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBbbjMoImV4cHJlc3Npb24iKSwgaEwodDMsIGUzKSA/ICIiIDogaTNdOwogICAgICAgICAgICAgIGNhc2UgIlBhcmVudGhlc2l6ZWRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiAhZkwobzMuZXhwcmVzc2lvbikgJiYgKG8zLmV4cHJlc3Npb24udHlwZSA9PT0gIk9iamVjdEV4cHJlc3Npb24iIHx8IG8zLmV4cHJlc3Npb24udHlwZSA9PT0gIkFycmF5RXhwcmVzc2lvbiIpID8gWyIoIiwgbjMoImV4cHJlc3Npb24iKSwgIikiXSA6IG5MKFsiKCIsIHJMKFt0TCwgbjMoImV4cHJlc3Npb24iKV0pLCB0TCwgIikiXSk7CiAgICAgICAgICAgICAgY2FzZSAiQXNzaWdubWVudEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIG5qKGUzLCB0MywgbjMpOwogICAgICAgICAgICAgIGNhc2UgIlZhcmlhYmxlRGVjbGFyYXRvciI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGooZTMsIHQzLCBuMyk7CiAgICAgICAgICAgICAgY2FzZSAiQmluYXJ5RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiTG9naWNhbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIHJqKGUzLCB0MywgbjMpOwogICAgICAgICAgICAgIGNhc2UgIkFzc2lnbm1lbnRQYXR0ZXJuIjoKICAgICAgICAgICAgICAgIHJldHVybiBbbjMoImxlZnQiKSwgIiA9ICIsIG4zKCJyaWdodCIpXTsKICAgICAgICAgICAgICBjYXNlICJPcHRpb25hbE1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICAgIGNhc2UgIk1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIGlqKGUzLCB0MywgbjMpOwogICAgICAgICAgICAgIGNhc2UgIk1ldGFQcm9wZXJ0eSI6CiAgICAgICAgICAgICAgICByZXR1cm4gW24zKCJtZXRhIiksICIuIiwgbjMoInByb3BlcnR5IildOwogICAgICAgICAgICAgIGNhc2UgIkJpbmRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiBvMy5vYmplY3QgJiYgdTMucHVzaChuMygib2JqZWN0IikpLCB1My5wdXNoKG5MKHJMKFt0TCwgT0woZTMsIHQzLCBuMyldKSkpLCB1MzsKICAgICAgICAgICAgICBjYXNlICJJZGVudGlmaWVyIjoKICAgICAgICAgICAgICAgIHJldHVybiBbbzMubmFtZSwgUEwoZTMpLCBJTChlMywgdDMsIG4zKV07CiAgICAgICAgICAgICAgY2FzZSAiVjhJbnRyaW5zaWNJZGVudGlmaWVyIjoKICAgICAgICAgICAgICAgIHJldHVybiBbIiUiLCBvMy5uYW1lXTsKICAgICAgICAgICAgICBjYXNlICJTcHJlYWRFbGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJTcHJlYWRFbGVtZW50UGF0dGVybiI6CiAgICAgICAgICAgICAgY2FzZSAiU3ByZWFkUHJvcGVydHkiOgogICAgICAgICAgICAgIGNhc2UgIlNwcmVhZFByb3BlcnR5UGF0dGVybiI6CiAgICAgICAgICAgICAgY2FzZSAiUmVzdEVsZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIGpMKGUzLCB0MywgbjMpOwogICAgICAgICAgICAgIGNhc2UgIkZ1bmN0aW9uRGVjbGFyYXRpb24iOgogICAgICAgICAgICAgIGNhc2UgIkZ1bmN0aW9uRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gWEwoZTMsIG4zLCB0MywgcjMpOwogICAgICAgICAgICAgIGNhc2UgIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiBZTChlMywgdDMsIG4zLCByMyk7CiAgICAgICAgICAgICAgY2FzZSAiWWllbGRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiB1My5wdXNoKCJ5aWVsZCIpLCBvMy5kZWxlZ2F0ZSAmJiB1My5wdXNoKCIqIiksIG8zLmFyZ3VtZW50ICYmIHUzLnB1c2goIiAiLCBuMygiYXJndW1lbnQiKSksIHUzOwogICAgICAgICAgICAgIGNhc2UgIkF3YWl0RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBpZiAodTMucHVzaCgiYXdhaXQiKSwgbzMuYXJndW1lbnQpIHsKICAgICAgICAgICAgICAgICAgdTMucHVzaCgiICIsIG4zKCJhcmd1bWVudCIpKTsKICAgICAgICAgICAgICAgICAgY29uc3QgdDQgPSBlMy5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICAgICAgICAgIGlmIChiTCh0NCkgJiYgdDQuY2FsbGVlID09PSBvMyB8fCB2TCh0NCkgJiYgdDQub2JqZWN0ID09PSBvMykgewogICAgICAgICAgICAgICAgICAgIHUzID0gW3JMKFt0TCwgLi4udTNdKSwgdExdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHQ1ID0gZTMuZmluZEFuY2VzdG9yKChlNCkgPT4gZTQudHlwZSA9PT0gIkF3YWl0RXhwcmVzc2lvbiIgfHwgZTQudHlwZSA9PT0gIkJsb2NrU3RhdGVtZW50Iik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0NSB8fCB0NS50eXBlICE9PSAiQXdhaXRFeHByZXNzaW9uIikKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuTCh1Myk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB1MzsKICAgICAgICAgICAgICBjYXNlICJFeHBvcnREZWZhdWx0RGVjbGFyYXRpb24iOgogICAgICAgICAgICAgIGNhc2UgIkV4cG9ydE5hbWVkRGVjbGFyYXRpb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIE1MKGUzLCB0MywgbjMpOwogICAgICAgICAgICAgIGNhc2UgIkV4cG9ydEFsbERlY2xhcmF0aW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiBSTChlMywgdDMsIG4zKTsKICAgICAgICAgICAgICBjYXNlICJJbXBvcnREZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gX0woZTMsIHQzLCBuMyk7CiAgICAgICAgICAgICAgY2FzZSAiSW1wb3J0U3BlY2lmaWVyIjoKICAgICAgICAgICAgICBjYXNlICJFeHBvcnRTcGVjaWZpZXIiOgogICAgICAgICAgICAgIGNhc2UgIkltcG9ydE5hbWVzcGFjZVNwZWNpZmllciI6CiAgICAgICAgICAgICAgY2FzZSAiRXhwb3J0TmFtZXNwYWNlU3BlY2lmaWVyIjoKICAgICAgICAgICAgICBjYXNlICJJbXBvcnREZWZhdWx0U3BlY2lmaWVyIjoKICAgICAgICAgICAgICBjYXNlICJFeHBvcnREZWZhdWx0U3BlY2lmaWVyIjoKICAgICAgICAgICAgICAgIHJldHVybiBWTChlMywgdDMsIG4zKTsKICAgICAgICAgICAgICBjYXNlICJJbXBvcnRBdHRyaWJ1dGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIFtuMygia2V5IiksICI6ICIsIG4zKCJ2YWx1ZSIpXTsKICAgICAgICAgICAgICBjYXNlICJJbXBvcnQiOgogICAgICAgICAgICAgICAgcmV0dXJuICJpbXBvcnQiOwogICAgICAgICAgICAgIGNhc2UgIkJsb2NrU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJTdGF0aWNCbG9jayI6CiAgICAgICAgICAgICAgY2FzZSAiQ2xhc3NCb2R5IjoKICAgICAgICAgICAgICAgIHJldHVybiB1aihlMywgdDMsIG4zKTsKICAgICAgICAgICAgICBjYXNlICJUaHJvd1N0YXRlbWVudCI6CiAgICAgICAgICAgICAgICByZXR1cm4gWkwoZTMsIHQzLCBuMyk7CiAgICAgICAgICAgICAgY2FzZSAiUmV0dXJuU3RhdGVtZW50IjoKICAgICAgICAgICAgICAgIHJldHVybiBRTChlMywgdDMsIG4zKTsKICAgICAgICAgICAgICBjYXNlICJOZXdFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJJbXBvcnRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJPcHRpb25hbENhbGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJDYWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gZWooZTMsIHQzLCBuMyk7CiAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0UGF0dGVybiI6CiAgICAgICAgICAgICAgY2FzZSAiUmVjb3JkRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gVUwoZTMsIHQzLCBuMyk7CiAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0UHJvcGVydHkiOgogICAgICAgICAgICAgIGNhc2UgIlByb3BlcnR5IjoKICAgICAgICAgICAgICAgIHJldHVybiBvMy5tZXRob2QgfHwgbzMua2luZCA9PT0gImdldCIgfHwgbzMua2luZCA9PT0gInNldCIgPyBLTChlMywgdDMsIG4zKSA6IEpMKGUzLCB0MywgbjMpOwogICAgICAgICAgICAgIGNhc2UgIk9iamVjdE1ldGhvZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gS0woZTMsIHQzLCBuMyk7CiAgICAgICAgICAgICAgY2FzZSAiRGVjb3JhdG9yIjoKICAgICAgICAgICAgICAgIHJldHVybiBbIkAiLCBuMygiZXhwcmVzc2lvbiIpXTsKICAgICAgICAgICAgICBjYXNlICJBcnJheUV4cHJlc3Npb24iOgogICAgICAgICAgICAgIGNhc2UgIkFycmF5UGF0dGVybiI6CiAgICAgICAgICAgICAgY2FzZSAiVHVwbGVFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiBxTChlMywgdDMsIG4zKTsKICAgICAgICAgICAgICBjYXNlICJTZXF1ZW5jZUV4cHJlc3Npb24iOiB7CiAgICAgICAgICAgICAgICBjb25zdCB0NCA9IGUzLmdldFBhcmVudE5vZGUoMCk7CiAgICAgICAgICAgICAgICBpZiAodDQudHlwZSA9PT0gIkV4cHJlc3Npb25TdGF0ZW1lbnQiIHx8IHQ0LnR5cGUgPT09ICJGb3JTdGF0ZW1lbnQiKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHQ1ID0gW107CiAgICAgICAgICAgICAgICAgIHJldHVybiBlMy5lYWNoKChlNCwgcjQpID0+IHsKICAgICAgICAgICAgICAgICAgICByNCA9PT0gMCA/IHQ1LnB1c2gobjMoKSkgOiB0NS5wdXNoKCIsIiwgckwoW1pJLCBuMygpXSkpOwogICAgICAgICAgICAgICAgICB9LCAiZXhwcmVzc2lvbnMiKSwgbkwodDUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG5MKFFJKFsiLCIsIFpJXSwgZTMubWFwKG4zLCAiZXhwcmVzc2lvbnMiKSkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlICJUaGlzRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gInRoaXMiOwogICAgICAgICAgICAgIGNhc2UgIlN1cGVyIjoKICAgICAgICAgICAgICAgIHJldHVybiAic3VwZXIiOwogICAgICAgICAgICAgIGNhc2UgIkRpcmVjdGl2ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gW24zKCJ2YWx1ZSIpLCBpM107CiAgICAgICAgICAgICAgY2FzZSAiRGlyZWN0aXZlTGl0ZXJhbCI6CiAgICAgICAgICAgICAgICByZXR1cm4gcGoobzMsIHQzKTsKICAgICAgICAgICAgICBjYXNlICJVbmFyeUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIHUzLnB1c2gobzMub3BlcmF0b3IpLCAvW2Etel0kLy50ZXN0KG8zLm9wZXJhdG9yKSAmJiB1My5wdXNoKCIgIiksIGZMKG8zLmFyZ3VtZW50KSA/IHUzLnB1c2gobkwoWyIoIiwgckwoW3RMLCBuMygiYXJndW1lbnQiKV0pLCB0TCwgIikiXSkpIDogdTMucHVzaChuMygiYXJndW1lbnQiKSksIHUzOwogICAgICAgICAgICAgIGNhc2UgIlVwZGF0ZUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIHUzLnB1c2gobjMoImFyZ3VtZW50IiksIG8zLm9wZXJhdG9yKSwgbzMucHJlZml4ICYmIHUzLnJldmVyc2UoKSwgdTM7CiAgICAgICAgICAgICAgY2FzZSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiAkTChlMywgdDMsIG4zKTsKICAgICAgICAgICAgICBjYXNlICJWYXJpYWJsZURlY2xhcmF0aW9uIjogewogICAgICAgICAgICAgICAgY29uc3QgdDQgPSBlMy5tYXAobjMsICJkZWNsYXJhdGlvbnMiKSwgcjQgPSBlMy5nZXRQYXJlbnROb2RlKCksIHMzID0gcjQudHlwZSA9PT0gIkZvclN0YXRlbWVudCIgfHwgcjQudHlwZSA9PT0gIkZvckluU3RhdGVtZW50IiB8fCByNC50eXBlID09PSAiRm9yT2ZTdGF0ZW1lbnQiLCBhMyA9IG8zLmRlY2xhcmF0aW9ucy5zb21lKChlNCkgPT4gZTQuaW5pdCk7CiAgICAgICAgICAgICAgICBsZXQgYzI7CiAgICAgICAgICAgICAgICByZXR1cm4gdDQubGVuZ3RoICE9PSAxIHx8IGZMKG8zLmRlY2xhcmF0aW9uc1swXSkgPyB0NC5sZW5ndGggPiAwICYmIChjMiA9IHJMKHQ0WzBdKSkgOiBjMiA9IHQ0WzBdLCB1MyA9IFtvMy5kZWNsYXJlID8gImRlY2xhcmUgIiA6ICIiLCBvMy5raW5kLCBjMiA/IFsiICIsIGMyXSA6ICIiLCByTCh0NC5zbGljZSgxKS5tYXAoKGU0KSA9PiBbIiwiLCBhMyAmJiAhczMgPyBlTCA6IFpJLCBlNF0pKV0sIHMzICYmIHI0LmJvZHkgIT09IG8zIHx8IHUzLnB1c2goaTMpLCBuTCh1Myk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgIldpdGhTdGF0ZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIG5MKFsid2l0aCAoIiwgbjMoIm9iamVjdCIpLCAiKSIsIExMKG8zLmJvZHksIG4zKCJib2R5IikpXSk7CiAgICAgICAgICAgICAgY2FzZSAiSWZTdGF0ZW1lbnQiOiB7CiAgICAgICAgICAgICAgICBjb25zdCByNCA9IExMKG8zLmNvbnNlcXVlbnQsIG4zKCJjb25zZXF1ZW50IikpLCBpNCA9IG5MKFsiaWYgKCIsIG5MKFtyTChbdEwsIG4zKCJ0ZXN0IildKSwgdExdKSwgIikiLCByNF0pOwogICAgICAgICAgICAgICAgaWYgKHUzLnB1c2goaTQpLCBvMy5hbHRlcm5hdGUpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgcjUgPSBmTChvMy5jb25zZXF1ZW50LCBkTC5UcmFpbGluZyB8IGRMLkxpbmUpIHx8IERMKG8zKSwgaTUgPSBvMy5jb25zZXF1ZW50LnR5cGUgPT09ICJCbG9ja1N0YXRlbWVudCIgJiYgIXI1OwogICAgICAgICAgICAgICAgICB1My5wdXNoKGk1ID8gIiAiIDogZUwpLCBmTChvMywgZEwuRGFuZ2xpbmcpICYmIHUzLnB1c2goWUkoZTMsIHQzLCB0cnVlKSwgcjUgPyBlTCA6ICIgIiksIHUzLnB1c2goImVsc2UiLCBuTChMTChvMy5hbHRlcm5hdGUsIG4zKCJhbHRlcm5hdGUiKSwgbzMuYWx0ZXJuYXRlLnR5cGUgPT09ICJJZlN0YXRlbWVudCIpKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdTM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgIkZvclN0YXRlbWVudCI6IHsKICAgICAgICAgICAgICAgIGNvbnN0IHI0ID0gTEwobzMuYm9keSwgbjMoImJvZHkiKSksIGk0ID0gWUkoZTMsIHQzLCB0cnVlKSwgdTQgPSBpNCA/IFtpNCwgdExdIDogIiI7CiAgICAgICAgICAgICAgICByZXR1cm4gbzMuaW5pdCB8fCBvMy50ZXN0IHx8IG8zLnVwZGF0ZSA/IFt1NCwgbkwoWyJmb3IgKCIsIG5MKFtyTChbdEwsIG4zKCJpbml0IiksICI7IiwgWkksIG4zKCJ0ZXN0IiksICI7IiwgWkksIG4zKCJ1cGRhdGUiKV0pLCB0TF0pLCAiKSIsIHI0XSldIDogW3U0LCBuTChbImZvciAoOzspIiwgcjRdKV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgIldoaWxlU3RhdGVtZW50IjoKICAgICAgICAgICAgICAgIHJldHVybiBuTChbIndoaWxlICgiLCBuTChbckwoW3RMLCBuMygidGVzdCIpXSksIHRMXSksICIpIiwgTEwobzMuYm9keSwgbjMoImJvZHkiKSldKTsKICAgICAgICAgICAgICBjYXNlICJGb3JJblN0YXRlbWVudCI6CiAgICAgICAgICAgICAgICByZXR1cm4gbkwoWyJmb3IgKCIsIG4zKCJsZWZ0IiksICIgaW4gIiwgbjMoInJpZ2h0IiksICIpIiwgTEwobzMuYm9keSwgbjMoImJvZHkiKSldKTsKICAgICAgICAgICAgICBjYXNlICJGb3JPZlN0YXRlbWVudCI6CiAgICAgICAgICAgICAgICByZXR1cm4gbkwoWyJmb3IiLCBvMy5hd2FpdCA/ICIgYXdhaXQiIDogIiIsICIgKCIsIG4zKCJsZWZ0IiksICIgb2YgIiwgbjMoInJpZ2h0IiksICIpIiwgTEwobzMuYm9keSwgbjMoImJvZHkiKSldKTsKICAgICAgICAgICAgICBjYXNlICJEb1doaWxlU3RhdGVtZW50IjogewogICAgICAgICAgICAgICAgY29uc3QgZTQgPSBMTChvMy5ib2R5LCBuMygiYm9keSIpKTsKICAgICAgICAgICAgICAgIHJldHVybiB1MyA9IFtuTChbImRvIiwgZTRdKV0sIG8zLmJvZHkudHlwZSA9PT0gIkJsb2NrU3RhdGVtZW50IiA/IHUzLnB1c2goIiAiKSA6IHUzLnB1c2goZUwpLCB1My5wdXNoKCJ3aGlsZSAoIiwgbkwoW3JMKFt0TCwgbjMoInRlc3QiKV0pLCB0TF0pLCAiKSIsIGkzKSwgdTM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgIkRvRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gW28zLmFzeW5jID8gImFzeW5jICIgOiAiIiwgImRvICIsIG4zKCJib2R5IildOwogICAgICAgICAgICAgIGNhc2UgIkJyZWFrU3RhdGVtZW50IjoKICAgICAgICAgICAgICAgIHJldHVybiB1My5wdXNoKCJicmVhayIpLCBvMy5sYWJlbCAmJiB1My5wdXNoKCIgIiwgbjMoImxhYmVsIikpLCB1My5wdXNoKGkzKSwgdTM7CiAgICAgICAgICAgICAgY2FzZSAiQ29udGludWVTdGF0ZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIHUzLnB1c2goImNvbnRpbnVlIiksIG8zLmxhYmVsICYmIHUzLnB1c2goIiAiLCBuMygibGFiZWwiKSksIHUzLnB1c2goaTMpLCB1MzsKICAgICAgICAgICAgICBjYXNlICJMYWJlbGVkU3RhdGVtZW50IjoKICAgICAgICAgICAgICAgIHJldHVybiBvMy5ib2R5LnR5cGUgPT09ICJFbXB0eVN0YXRlbWVudCIgPyBbbjMoImxhYmVsIiksICI6OyJdIDogW24zKCJsYWJlbCIpLCAiOiAiLCBuMygiYm9keSIpXTsKICAgICAgICAgICAgICBjYXNlICJUcnlTdGF0ZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIFsidHJ5ICIsIG4zKCJibG9jayIpLCBvMy5oYW5kbGVyID8gWyIgIiwgbjMoImhhbmRsZXIiKV0gOiAiIiwgbzMuZmluYWxpemVyID8gWyIgZmluYWxseSAiLCBuMygiZmluYWxpemVyIildIDogIiJdOwogICAgICAgICAgICAgIGNhc2UgIkNhdGNoQ2xhdXNlIjoKICAgICAgICAgICAgICAgIGlmIChvMy5wYXJhbSkgewogICAgICAgICAgICAgICAgICBjb25zdCBlNCA9IGZMKG8zLnBhcmFtLCAoZTUpID0+ICFnTChlNSkgfHwgZTUubGVhZGluZyAmJiBLSSh0My5vcmlnaW5hbFRleHQsIEZMKGU1KSkgfHwgZTUudHJhaWxpbmcgJiYgS0kodDMub3JpZ2luYWxUZXh0LCBBTChlNSksIHsgYmFja3dhcmRzOiB0cnVlIH0pKSwgcjQgPSBuMygicGFyYW0iKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFsiY2F0Y2ggIiwgZTQgPyBbIigiLCByTChbdEwsIHI0XSksIHRMLCAiKSAiXSA6IFsiKCIsIHI0LCAiKSAiXSwgbjMoImJvZHkiKV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gWyJjYXRjaCAiLCBuMygiYm9keSIpXTsKICAgICAgICAgICAgICBjYXNlICJTd2l0Y2hTdGF0ZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIFtuTChbInN3aXRjaCAoIiwgckwoW3RMLCBuMygiZGlzY3JpbWluYW50IildKSwgdEwsICIpIl0pLCAiIHsiLCBvMy5jYXNlcy5sZW5ndGggPiAwID8gckwoW2VMLCBRSShlTCwgZTMubWFwKChlNCwgcjQsIG80KSA9PiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGk0ID0gZTQuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFtuMygpLCByNCAhPT0gbzQubGVuZ3RoIC0gMSAmJiB5TChpNCwgdDMpID8gZUwgOiAiIl07CiAgICAgICAgICAgICAgICB9LCAiY2FzZXMiKSldKSA6ICIiLCBlTCwgIn0iXTsKICAgICAgICAgICAgICBjYXNlICJTd2l0Y2hDYXNlIjogewogICAgICAgICAgICAgICAgbzMudGVzdCA/IHUzLnB1c2goImNhc2UgIiwgbjMoInRlc3QiKSwgIjoiKSA6IHUzLnB1c2goImRlZmF1bHQ6Iik7CiAgICAgICAgICAgICAgICBjb25zdCByNCA9IG8zLmNvbnNlcXVlbnQuZmlsdGVyKChlNCkgPT4gZTQudHlwZSAhPT0gIkVtcHR5U3RhdGVtZW50Iik7CiAgICAgICAgICAgICAgICBpZiAocjQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICBjb25zdCBvNCA9IG9qKGUzLCB0MywgbjMpOwogICAgICAgICAgICAgICAgICB1My5wdXNoKHI0Lmxlbmd0aCA9PT0gMSAmJiByNFswXS50eXBlID09PSAiQmxvY2tTdGF0ZW1lbnQiID8gWyIgIiwgbzRdIDogckwoW2VMLCBvNF0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB1MzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY2FzZSAiRGVidWdnZXJTdGF0ZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIFsiZGVidWdnZXIiLCBpM107CiAgICAgICAgICAgICAgY2FzZSAiQ2xhc3NEZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgY2FzZSAiQ2xhc3NFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiB6TChlMywgdDMsIG4zKTsKICAgICAgICAgICAgICBjYXNlICJDbGFzc01ldGhvZCI6CiAgICAgICAgICAgICAgY2FzZSAiQ2xhc3NQcml2YXRlTWV0aG9kIjoKICAgICAgICAgICAgICBjYXNlICJNZXRob2REZWZpbml0aW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiBHTChlMywgdDMsIG4zKTsKICAgICAgICAgICAgICBjYXNlICJDbGFzc1Byb3BlcnR5IjoKICAgICAgICAgICAgICBjYXNlICJQcm9wZXJ0eURlZmluaXRpb24iOgogICAgICAgICAgICAgIGNhc2UgIkNsYXNzUHJpdmF0ZVByb3BlcnR5IjoKICAgICAgICAgICAgICAgIHJldHVybiBITChlMywgdDMsIG4zKTsKICAgICAgICAgICAgICBjYXNlICJUZW1wbGF0ZUVsZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIG9MKG8zLnZhbHVlLnJhdyk7CiAgICAgICAgICAgICAgY2FzZSAiVGVtcGxhdGVMaXRlcmFsIjoKICAgICAgICAgICAgICAgIHJldHVybiBXTChlMywgbjMsIHQzKTsKICAgICAgICAgICAgICBjYXNlICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIFtuMygidGFnIiksIG4zKCJ0eXBlUGFyYW1ldGVycyIpLCBuMygicXVhc2kiKV07CiAgICAgICAgICAgICAgY2FzZSAiUHJpdmF0ZUlkZW50aWZpZXIiOgogICAgICAgICAgICAgICAgcmV0dXJuIFsiIyIsIG4zKCJuYW1lIildOwogICAgICAgICAgICAgIGNhc2UgIlByaXZhdGVOYW1lIjoKICAgICAgICAgICAgICAgIHJldHVybiBbIiMiLCBuMygiaWQiKV07CiAgICAgICAgICAgICAgY2FzZSAiSW50ZXJwcmV0ZXJEaXJlY3RpdmUiOgogICAgICAgICAgICAgICAgcmV0dXJuIHUzLnB1c2goIiMhIiwgbzMudmFsdWUsIGVMKSwgeUwobzMsIHQzKSAmJiB1My5wdXNoKGVMKSwgdTM7CiAgICAgICAgICAgICAgY2FzZSAiVG9waWNSZWZlcmVuY2UiOgogICAgICAgICAgICAgICAgcmV0dXJuICIlIjsKICAgICAgICAgICAgICBjYXNlICJBcmd1bWVudFBsYWNlaG9sZGVyIjoKICAgICAgICAgICAgICAgIHJldHVybiAiPyI7CiAgICAgICAgICAgICAgY2FzZSAiTW9kdWxlRXhwcmVzc2lvbiI6IHsKICAgICAgICAgICAgICAgIHUzLnB1c2goIm1vZHVsZSB7Iik7CiAgICAgICAgICAgICAgICBjb25zdCBlNCA9IG4zKCJib2R5Iik7CiAgICAgICAgICAgICAgICByZXR1cm4gZTQgJiYgdTMucHVzaChyTChbZUwsIGU0XSksIGVMKSwgdTMucHVzaCgifSIpLCB1MzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5rbm93biB0eXBlOiAiICsgSlNPTi5zdHJpbmdpZnkobzMudHlwZSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KGUyLCB0MiwgbjIsIHIyKTsKICAgICAgICAgIGlmICghbzIpCiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgIGNvbnN0IGkyID0gZTIuZ2V0VmFsdWUoKSwgeyB0eXBlOiB1MiB9ID0gaTI7CiAgICAgICAgICBpZiAodTIgPT09ICJDbGFzc01ldGhvZCIgfHwgdTIgPT09ICJDbGFzc1ByaXZhdGVNZXRob2QiIHx8IHUyID09PSAiQ2xhc3NQcm9wZXJ0eSIgfHwgdTIgPT09ICJQcm9wZXJ0eURlZmluaXRpb24iIHx8IHUyID09PSAiVFNBYnN0cmFjdFByb3BlcnR5RGVmaW5pdGlvbiIgfHwgdTIgPT09ICJDbGFzc1ByaXZhdGVQcm9wZXJ0eSIgfHwgdTIgPT09ICJNZXRob2REZWZpbml0aW9uIiB8fCB1MiA9PT0gIlRTQWJzdHJhY3RNZXRob2REZWZpbml0aW9uIiB8fCB1MiA9PT0gIlRTRGVjbGFyZU1ldGhvZCIpCiAgICAgICAgICAgIHJldHVybiBvMjsKICAgICAgICAgIGNvbnN0IHMyID0gbGooZTIsIHQyLCBuMik7CiAgICAgICAgICBpZiAoczIpCiAgICAgICAgICAgIHJldHVybiBuTChbLi4uczIsIG8yXSk7CiAgICAgICAgICBpZiAoIWNMKGUyLCB0MikpCiAgICAgICAgICAgIHJldHVybiByMiAmJiByMi5uZWVkc1NlbWkgPyBbIjsiLCBvMl0gOiBvMjsKICAgICAgICAgIGNvbnN0IGEyID0gW3IyICYmIHIyLm5lZWRzU2VtaSA/ICI7KCIgOiAiKCIsIG8yXTsKICAgICAgICAgIGlmIChwTChpMikpIHsKICAgICAgICAgICAgY29uc3QgW2UzXSA9IGkyLnRyYWlsaW5nQ29tbWVudHM7CiAgICAgICAgICAgIGEyLnB1c2goIiAvKiIsIGUzLnZhbHVlLnRyaW1TdGFydCgpLCAiKi8iKSwgZTMucHJpbnRlZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYTIucHVzaCgiKSIpLCBhMjsKICAgICAgICB9LCBlbWJlZDogaUwsIGluc2VydFByYWdtYTogc0wsIG1hc3NhZ2VBc3ROb2RlOiB1TCwgaGFzUHJldHRpZXJJZ25vcmU6IChlMikgPT4gQ0woZTIpIHx8IEJMKGUyKSwgd2lsbFByaW50T3duQ29tbWVudHM6IGFMLndpbGxQcmludE93bkNvbW1lbnRzLCBjYW5BdHRhY2hDb21tZW50OiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgJiYgIWdMKGUyKSAmJiAhbUwoZTIpICYmIGUyLnR5cGUgIT09ICJFbXB0eVN0YXRlbWVudCIgJiYgZTIudHlwZSAhPT0gIlRlbXBsYXRlRWxlbWVudCIgJiYgZTIudHlwZSAhPT0gIkltcG9ydCIgJiYgZTIudHlwZSAhPT0gIlRTRW1wdHlCb2R5RnVuY3Rpb25FeHByZXNzaW9uIjsKICAgICAgICB9LCBwcmludENvbW1lbnQ6IGFqLCBpc0Jsb2NrQ29tbWVudDogZ0wsIGhhbmRsZUNvbW1lbnRzOiB7IGF2b2lkQXN0TXV0YXRpb246IHRydWUsIG93bkxpbmU6IGFMLmhhbmRsZU93bkxpbmVDb21tZW50LCBlbmRPZkxpbmU6IGFMLmhhbmRsZUVuZE9mTGluZUNvbW1lbnQsIHJlbWFpbmluZzogYUwuaGFuZGxlUmVtYWluaW5nQ29tbWVudCB9LCBnZXRDb21tZW50Q2hpbGROb2RlczogYUwuZ2V0Q29tbWVudENoaWxkTm9kZXMgfTsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IGhhcmRsaW5lOiBkaiwgaW5kZW50OiBoaiwgam9pbjogZ2ogfSB9ID0gWmMsIG1qID0gVEE7CiAgICAgICAgY29uc3QgeWogPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldChbInN0YXJ0IiwgImVuZCIsICJleHRyYSIsICJsb2MiLCAiY29tbWVudHMiLCAibGVhZGluZ0NvbW1lbnRzIiwgInRyYWlsaW5nQ29tbWVudHMiLCAiaW5uZXJDb21tZW50cyIsICJlcnJvcnMiLCAicmFuZ2UiLCAidG9rZW5zIl0pOwogICAgICAgIGZ1bmN0aW9uIERqKGUyLCB0MikgewogICAgICAgICAgY29uc3QgeyB0eXBlOiBuMiB9ID0gZTI7CiAgICAgICAgICBpZiAobjIgIT09ICJPYmplY3RQcm9wZXJ0eSIgfHwgZTIua2V5LnR5cGUgIT09ICJJZGVudGlmaWVyIikgewogICAgICAgICAgICBpZiAobjIgPT09ICJVbmFyeUV4cHJlc3Npb24iICYmIGUyLm9wZXJhdG9yID09PSAiKyIpCiAgICAgICAgICAgICAgcmV0dXJuIHQyLmFyZ3VtZW50OwogICAgICAgICAgICBpZiAobjIgIT09ICJBcnJheUV4cHJlc3Npb24iKQogICAgICAgICAgICAgIHJldHVybiBuMiA9PT0gIlRlbXBsYXRlTGl0ZXJhbCIgPyB7IHR5cGU6ICJTdHJpbmdMaXRlcmFsIiwgdmFsdWU6IGUyLnF1YXNpc1swXS52YWx1ZS5jb29rZWQgfSA6IHZvaWQgMDsKICAgICAgICAgICAgZm9yIChjb25zdCBbbjMsIHIyXSBvZiBlMi5lbGVtZW50cy5lbnRyaWVzKCkpCiAgICAgICAgICAgICAgcjIgPT09IG51bGwgJiYgdDIuZWxlbWVudHMuc3BsaWNlKG4zLCAwLCB7IHR5cGU6ICJOdWxsTGl0ZXJhbCIgfSk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgdDIua2V5ID0geyB0eXBlOiAiU3RyaW5nTGl0ZXJhbCIsIHZhbHVlOiBlMi5rZXkubmFtZSB9OwogICAgICAgIH0KICAgICAgICBEai5pZ25vcmVkUHJvcGVydGllcyA9IHlqOwogICAgICAgIHZhciBFaiA9IHsgcHJlcHJvY2VzczogbWosIHByaW50OiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBzd2l0Y2ggKHIyLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiSnNvblJvb3QiOgogICAgICAgICAgICAgIHJldHVybiBbbjIoIm5vZGUiKSwgZGpdOwogICAgICAgICAgICBjYXNlICJBcnJheUV4cHJlc3Npb24iOiB7CiAgICAgICAgICAgICAgaWYgKHIyLmVsZW1lbnRzLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiAiW10iOwogICAgICAgICAgICAgIGNvbnN0IHQzID0gZTIubWFwKCgpID0+IGUyLmdldFZhbHVlKCkgPT09IG51bGwgPyAibnVsbCIgOiBuMigpLCAiZWxlbWVudHMiKTsKICAgICAgICAgICAgICByZXR1cm4gWyJbIiwgaGooW2RqLCBnaihbIiwiLCBkal0sIHQzKV0pLCBkaiwgIl0iXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJPYmplY3RFeHByZXNzaW9uIjoKICAgICAgICAgICAgICByZXR1cm4gcjIucHJvcGVydGllcy5sZW5ndGggPT09IDAgPyAie30iIDogWyJ7IiwgaGooW2RqLCBnaihbIiwiLCBkal0sIGUyLm1hcChuMiwgInByb3BlcnRpZXMiKSldKSwgZGosICJ9Il07CiAgICAgICAgICAgIGNhc2UgIk9iamVjdFByb3BlcnR5IjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJrZXkiKSwgIjogIiwgbjIoInZhbHVlIildOwogICAgICAgICAgICBjYXNlICJVbmFyeUV4cHJlc3Npb24iOgogICAgICAgICAgICAgIHJldHVybiBbcjIub3BlcmF0b3IgPT09ICIrIiA/ICIiIDogcjIub3BlcmF0b3IsIG4yKCJhcmd1bWVudCIpXTsKICAgICAgICAgICAgY2FzZSAiTnVsbExpdGVyYWwiOgogICAgICAgICAgICAgIHJldHVybiAibnVsbCI7CiAgICAgICAgICAgIGNhc2UgIkJvb2xlYW5MaXRlcmFsIjoKICAgICAgICAgICAgICByZXR1cm4gcjIudmFsdWUgPyAidHJ1ZSIgOiAiZmFsc2UiOwogICAgICAgICAgICBjYXNlICJTdHJpbmdMaXRlcmFsIjoKICAgICAgICAgICAgY2FzZSAiTnVtZXJpY0xpdGVyYWwiOgogICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShyMi52YWx1ZSk7CiAgICAgICAgICAgIGNhc2UgIklkZW50aWZpZXIiOiB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSBlMi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICAgICAgcmV0dXJuIHQzICYmIHQzLnR5cGUgPT09ICJPYmplY3RQcm9wZXJ0eSIgJiYgdDMua2V5ID09PSByMiA/IEpTT04uc3RyaW5naWZ5KHIyLm5hbWUpIDogcjIubmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJUZW1wbGF0ZUxpdGVyYWwiOgogICAgICAgICAgICAgIHJldHVybiBuMihbInF1YXNpcyIsIDBdKTsKICAgICAgICAgICAgY2FzZSAiVGVtcGxhdGVFbGVtZW50IjoKICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkocjIudmFsdWUuY29va2VkKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInVua25vd24gdHlwZTogIiArIEpTT04uc3RyaW5naWZ5KHIyLnR5cGUpKTsKICAgICAgICAgIH0KICAgICAgICB9LCBtYXNzYWdlQXN0Tm9kZTogRGogfTsKICAgICAgICBjb25zdCBDaiA9ICJDb21tb24iOwogICAgICAgIHZhciBiaiA9IHsgYnJhY2tldFNwYWNpbmc6IHsgc2luY2U6ICIwLjAuMCIsIGNhdGVnb3J5OiBDaiwgdHlwZTogImJvb2xlYW4iLCBkZWZhdWx0OiB0cnVlLCBkZXNjcmlwdGlvbjogIlByaW50IHNwYWNlcyBiZXR3ZWVuIGJyYWNrZXRzLiIsIG9wcG9zaXRlRGVzY3JpcHRpb246ICJEbyBub3QgcHJpbnQgc3BhY2VzIGJldHdlZW4gYnJhY2tldHMuIiB9LCBzaW5nbGVRdW90ZTogeyBzaW5jZTogIjAuMC4wIiwgY2F0ZWdvcnk6IENqLCB0eXBlOiAiYm9vbGVhbiIsIGRlZmF1bHQ6IGZhbHNlLCBkZXNjcmlwdGlvbjogIlVzZSBzaW5nbGUgcXVvdGVzIGluc3RlYWQgb2YgZG91YmxlIHF1b3Rlcy4iIH0sIHByb3NlV3JhcDogeyBzaW5jZTogIjEuOC4yIiwgY2F0ZWdvcnk6IENqLCB0eXBlOiAiY2hvaWNlIiwgZGVmYXVsdDogW3sgc2luY2U6ICIxLjguMiIsIHZhbHVlOiB0cnVlIH0sIHsgc2luY2U6ICIxLjkuMCIsIHZhbHVlOiAicHJlc2VydmUiIH1dLCBkZXNjcmlwdGlvbjogIkhvdyB0byB3cmFwIHByb3NlLiIsIGNob2ljZXM6IFt7IHNpbmNlOiAiMS45LjAiLCB2YWx1ZTogImFsd2F5cyIsIGRlc2NyaXB0aW9uOiAiV3JhcCBwcm9zZSBpZiBpdCBleGNlZWRzIHRoZSBwcmludCB3aWR0aC4iIH0sIHsgc2luY2U6ICIxLjkuMCIsIHZhbHVlOiAibmV2ZXIiLCBkZXNjcmlwdGlvbjogIkRvIG5vdCB3cmFwIHByb3NlLiIgfSwgeyBzaW5jZTogIjEuOS4wIiwgdmFsdWU6ICJwcmVzZXJ2ZSIsIGRlc2NyaXB0aW9uOiAiV3JhcCBwcm9zZSBhcy1pcy4iIH1dIH0sIGJyYWNrZXRTYW1lTGluZTogeyBzaW5jZTogIjIuNC4wIiwgY2F0ZWdvcnk6IENqLCB0eXBlOiAiYm9vbGVhbiIsIGRlZmF1bHQ6IGZhbHNlLCBkZXNjcmlwdGlvbjogIlB1dCA+IG9mIG9wZW5pbmcgdGFncyBvbiB0aGUgbGFzdCBsaW5lIGluc3RlYWQgb2Ygb24gYSBuZXcgbGluZS4iIH0gfTsKICAgICAgICBjb25zdCB2aiA9ICJKYXZhU2NyaXB0IjsKICAgICAgICB2YXIgQWogPSB7IG5hbWU6ICJKYXZhU2NyaXB0IiwgdHlwZTogInByb2dyYW1taW5nIiwgdG1TY29wZTogInNvdXJjZS5qcyIsIGFjZU1vZGU6ICJqYXZhc2NyaXB0IiwgY29kZW1pcnJvck1vZGU6ICJqYXZhc2NyaXB0IiwgY29kZW1pcnJvck1pbWVUeXBlOiAidGV4dC9qYXZhc2NyaXB0IiwgY29sb3I6ICIjZjFlMDVhIiwgYWxpYXNlczogWyJqcyIsICJub2RlIl0sIGV4dGVuc2lvbnM6IFsiLmpzIiwgIi5fanMiLCAiLmJvbmVzIiwgIi5janMiLCAiLmVzIiwgIi5lczYiLCAiLmZyYWciLCAiLmdzIiwgIi5qYWtlIiwgIi5qc2IiLCAiLmpzY2FkIiwgIi5qc2ZsIiwgIi5qc20iLCAiLmpzcyIsICIuanN4IiwgIi5tanMiLCAiLm5qcyIsICIucGFjIiwgIi5zanMiLCAiLnNzanMiLCAiLnhzanMiLCAiLnhzanNsaWIiXSwgZmlsZW5hbWVzOiBbIkpha2VmaWxlIl0sIGludGVycHJldGVyczogWyJjaGFrcmEiLCAiZDgiLCAiZ2pzIiwgImpzIiwgIm5vZGUiLCAibm9kZWpzIiwgInFqcyIsICJyaGlubyIsICJ2OCIsICJ2OC1zaGVsbCJdLCBsYW5ndWFnZUlkOiAxODMgfSwgRmogPSB7IG5hbWU6ICJUeXBlU2NyaXB0IiwgdHlwZTogInByb2dyYW1taW5nIiwgY29sb3I6ICIjMmI3NDg5IiwgYWxpYXNlczogWyJ0cyJdLCBpbnRlcnByZXRlcnM6IFsiZGVubyIsICJ0cy1ub2RlIl0sIGV4dGVuc2lvbnM6IFsiLnRzIl0sIHRtU2NvcGU6ICJzb3VyY2UudHMiLCBhY2VNb2RlOiAidHlwZXNjcmlwdCIsIGNvZGVtaXJyb3JNb2RlOiAiamF2YXNjcmlwdCIsIGNvZGVtaXJyb3JNaW1lVHlwZTogImFwcGxpY2F0aW9uL3R5cGVzY3JpcHQiLCBsYW5ndWFnZUlkOiAzNzggfSwgeGogPSB7IG5hbWU6ICJUU1giLCB0eXBlOiAicHJvZ3JhbW1pbmciLCBncm91cDogIlR5cGVTY3JpcHQiLCBleHRlbnNpb25zOiBbIi50c3giXSwgdG1TY29wZTogInNvdXJjZS50c3giLCBhY2VNb2RlOiAiamF2YXNjcmlwdCIsIGNvZGVtaXJyb3JNb2RlOiAianN4IiwgY29kZW1pcnJvck1pbWVUeXBlOiAidGV4dC9qc3giLCBsYW5ndWFnZUlkOiA5NDkwMTkyNCB9LCBTaiA9IHsgbmFtZTogIkpTT04iLCB0eXBlOiAiZGF0YSIsIHRtU2NvcGU6ICJzb3VyY2UuanNvbiIsIGFjZU1vZGU6ICJqc29uIiwgY29kZW1pcnJvck1vZGU6ICJqYXZhc2NyaXB0IiwgY29kZW1pcnJvck1pbWVUeXBlOiAiYXBwbGljYXRpb24vanNvbiIsIGV4dGVuc2lvbnM6IFsiLmpzb24iLCAiLmF2c2MiLCAiLmdlb2pzb24iLCAiLmdsdGYiLCAiLmhhciIsICIuaWNlIiwgIi5KU09OLXRtTGFuZ3VhZ2UiLCAiLmpzb25sIiwgIi5tY21ldGEiLCAiLnRmc3RhdGUiLCAiLnRmc3RhdGUuYmFja3VwIiwgIi50b3BvanNvbiIsICIud2ViYXBwIiwgIi53ZWJtYW5pZmVzdCIsICIueXkiLCAiLnl5cCJdLCBmaWxlbmFtZXM6IFsiLmFyY2NvbmZpZyIsICIuaHRtbGhpbnRyYyIsICIuaW1nYm90Y29uZmlnIiwgIi50ZXJuLWNvbmZpZyIsICIudGVybi1wcm9qZWN0IiwgIi53YXRjaG1hbmNvbmZpZyIsICJQaXBmaWxlLmxvY2siLCAiY29tcG9zZXIubG9jayIsICJtY21vZC5pbmZvIl0sIGxhbmd1YWdlSWQ6IDE3NCB9LCB3aiA9IHsgbmFtZTogIkpTT04gd2l0aCBDb21tZW50cyIsIHR5cGU6ICJkYXRhIiwgZ3JvdXA6ICJKU09OIiwgdG1TY29wZTogInNvdXJjZS5qcyIsIGFjZU1vZGU6ICJqYXZhc2NyaXB0IiwgY29kZW1pcnJvck1vZGU6ICJqYXZhc2NyaXB0IiwgY29kZW1pcnJvck1pbWVUeXBlOiAidGV4dC9qYXZhc2NyaXB0IiwgYWxpYXNlczogWyJqc29uYyJdLCBleHRlbnNpb25zOiBbIi5qc29uYyIsICIuc3VibGltZS1idWlsZCIsICIuc3VibGltZS1jb21tYW5kcyIsICIuc3VibGltZS1jb21wbGV0aW9ucyIsICIuc3VibGltZS1rZXltYXAiLCAiLnN1YmxpbWUtbWFjcm8iLCAiLnN1YmxpbWUtbWVudSIsICIuc3VibGltZS1tb3VzZW1hcCIsICIuc3VibGltZS1wcm9qZWN0IiwgIi5zdWJsaW1lLXNldHRpbmdzIiwgIi5zdWJsaW1lLXRoZW1lIiwgIi5zdWJsaW1lLXdvcmtzcGFjZSIsICIuc3VibGltZV9tZXRyaWNzIiwgIi5zdWJsaW1lX3Nlc3Npb24iXSwgZmlsZW5hbWVzOiBbIi5iYWJlbHJjIiwgIi5lc2xpbnRyYy5qc29uIiwgIi5qc2NzcmMiLCAiLmpzaGludHJjIiwgIi5qc2xpbnRyYyIsICJhcGktZXh0cmFjdG9yLmpzb24iLCAiZGV2Y29udGFpbmVyLmpzb24iLCAianNjb25maWcuanNvbiIsICJsYW5ndWFnZS1jb25maWd1cmF0aW9uLmpzb24iLCAidHNjb25maWcuanNvbiIsICJ0c2xpbnQuanNvbiJdLCBsYW5ndWFnZUlkOiA0MjMgfSwgVGogPSB7IG5hbWU6ICJKU09ONSIsIHR5cGU6ICJkYXRhIiwgZXh0ZW5zaW9uczogWyIuanNvbjUiXSwgdG1TY29wZTogInNvdXJjZS5qcyIsIGFjZU1vZGU6ICJqYXZhc2NyaXB0IiwgY29kZW1pcnJvck1vZGU6ICJqYXZhc2NyaXB0IiwgY29kZW1pcnJvck1pbWVUeXBlOiAiYXBwbGljYXRpb24vanNvbiIsIGxhbmd1YWdlSWQ6IDE3NSB9OwogICAgICAgIGNvbnN0IEJqID0gYkUsIE5qID0gZmosIGtqID0gRWosIFBqID0geyBhcnJvd1BhcmVuczogeyBzaW5jZTogIjEuOS4wIiwgY2F0ZWdvcnk6IHZqLCB0eXBlOiAiY2hvaWNlIiwgZGVmYXVsdDogW3sgc2luY2U6ICIxLjkuMCIsIHZhbHVlOiAiYXZvaWQiIH0sIHsgc2luY2U6ICIyLjAuMCIsIHZhbHVlOiAiYWx3YXlzIiB9XSwgZGVzY3JpcHRpb246ICJJbmNsdWRlIHBhcmVudGhlc2VzIGFyb3VuZCBhIHNvbGUgYXJyb3cgZnVuY3Rpb24gcGFyYW1ldGVyLiIsIGNob2ljZXM6IFt7IHZhbHVlOiAiYWx3YXlzIiwgZGVzY3JpcHRpb246ICJBbHdheXMgaW5jbHVkZSBwYXJlbnMuIEV4YW1wbGU6IGAoeCkgPT4geGAiIH0sIHsgdmFsdWU6ICJhdm9pZCIsIGRlc2NyaXB0aW9uOiAiT21pdCBwYXJlbnMgd2hlbiBwb3NzaWJsZS4gRXhhbXBsZTogYHggPT4geGAiIH1dIH0sIGJyYWNrZXRTYW1lTGluZTogYmouYnJhY2tldFNhbWVMaW5lLCBicmFja2V0U3BhY2luZzogYmouYnJhY2tldFNwYWNpbmcsIGpzeEJyYWNrZXRTYW1lTGluZTogeyBzaW5jZTogIjAuMTcuMCIsIGNhdGVnb3J5OiB2aiwgdHlwZTogImJvb2xlYW4iLCBkZXNjcmlwdGlvbjogIlB1dCA+IG9uIHRoZSBsYXN0IGxpbmUgaW5zdGVhZCBvZiBhdCBhIG5ldyBsaW5lLiIsIGRlcHJlY2F0ZWQ6ICIyLjQuMCIgfSwgc2VtaTogeyBzaW5jZTogIjEuMC4wIiwgY2F0ZWdvcnk6IHZqLCB0eXBlOiAiYm9vbGVhbiIsIGRlZmF1bHQ6IHRydWUsIGRlc2NyaXB0aW9uOiAiUHJpbnQgc2VtaWNvbG9ucy4iLCBvcHBvc2l0ZURlc2NyaXB0aW9uOiAiRG8gbm90IHByaW50IHNlbWljb2xvbnMsIGV4Y2VwdCBhdCB0aGUgYmVnaW5uaW5nIG9mIGxpbmVzIHdoaWNoIG1heSBuZWVkIHRoZW0uIiB9LCBzaW5nbGVRdW90ZTogYmouc2luZ2xlUXVvdGUsIGpzeFNpbmdsZVF1b3RlOiB7IHNpbmNlOiAiMS4xNS4wIiwgY2F0ZWdvcnk6IHZqLCB0eXBlOiAiYm9vbGVhbiIsIGRlZmF1bHQ6IGZhbHNlLCBkZXNjcmlwdGlvbjogIlVzZSBzaW5nbGUgcXVvdGVzIGluIEpTWC4iIH0sIHF1b3RlUHJvcHM6IHsgc2luY2U6ICIxLjE3LjAiLCBjYXRlZ29yeTogdmosIHR5cGU6ICJjaG9pY2UiLCBkZWZhdWx0OiAiYXMtbmVlZGVkIiwgZGVzY3JpcHRpb246ICJDaGFuZ2Ugd2hlbiBwcm9wZXJ0aWVzIGluIG9iamVjdHMgYXJlIHF1b3RlZC4iLCBjaG9pY2VzOiBbeyB2YWx1ZTogImFzLW5lZWRlZCIsIGRlc2NyaXB0aW9uOiAiT25seSBhZGQgcXVvdGVzIGFyb3VuZCBvYmplY3QgcHJvcGVydGllcyB3aGVyZSByZXF1aXJlZC4iIH0sIHsgdmFsdWU6ICJjb25zaXN0ZW50IiwgZGVzY3JpcHRpb246ICJJZiBhdCBsZWFzdCBvbmUgcHJvcGVydHkgaW4gYW4gb2JqZWN0IHJlcXVpcmVzIHF1b3RlcywgcXVvdGUgYWxsIHByb3BlcnRpZXMuIiB9LCB7IHZhbHVlOiAicHJlc2VydmUiLCBkZXNjcmlwdGlvbjogIlJlc3BlY3QgdGhlIGlucHV0IHVzZSBvZiBxdW90ZXMgaW4gb2JqZWN0IHByb3BlcnRpZXMuIiB9XSB9LCB0cmFpbGluZ0NvbW1hOiB7IHNpbmNlOiAiMC4wLjAiLCBjYXRlZ29yeTogdmosIHR5cGU6ICJjaG9pY2UiLCBkZWZhdWx0OiBbeyBzaW5jZTogIjAuMC4wIiwgdmFsdWU6IGZhbHNlIH0sIHsgc2luY2U6ICIwLjE5LjAiLCB2YWx1ZTogIm5vbmUiIH0sIHsgc2luY2U6ICIyLjAuMCIsIHZhbHVlOiAiZXM1IiB9XSwgZGVzY3JpcHRpb246ICJQcmludCB0cmFpbGluZyBjb21tYXMgd2hlcmV2ZXIgcG9zc2libGUgd2hlbiBtdWx0aS1saW5lLiIsIGNob2ljZXM6IFt7IHZhbHVlOiAiZXM1IiwgZGVzY3JpcHRpb246ICJUcmFpbGluZyBjb21tYXMgd2hlcmUgdmFsaWQgaW4gRVM1IChvYmplY3RzLCBhcnJheXMsIGV0Yy4pIiB9LCB7IHZhbHVlOiAibm9uZSIsIGRlc2NyaXB0aW9uOiAiTm8gdHJhaWxpbmcgY29tbWFzLiIgfSwgeyB2YWx1ZTogImFsbCIsIGRlc2NyaXB0aW9uOiAiVHJhaWxpbmcgY29tbWFzIHdoZXJldmVyIHBvc3NpYmxlIChpbmNsdWRpbmcgZnVuY3Rpb24gYXJndW1lbnRzKS4iIH1dIH0gfSwgT2ogPSBbQmooQWosIChlMikgPT4gKHsgc2luY2U6ICIwLjAuMCIsIHBhcnNlcnM6IFsiYmFiZWwiLCAiZXNwcmVlIiwgIm1lcml5YWgiLCAiYmFiZWwtZmxvdyIsICJiYWJlbC10cyIsICJmbG93IiwgInR5cGVzY3JpcHQiXSwgdnNjb2RlTGFuZ3VhZ2VJZHM6IFsiamF2YXNjcmlwdCIsICJtb25nbyJdLCBpbnRlcnByZXRlcnM6IFsuLi5lMi5pbnRlcnByZXRlcnMsICJ6eCJdLCBleHRlbnNpb25zOiBbLi4uZTIuZXh0ZW5zaW9ucy5maWx0ZXIoKGUzKSA9PiBlMyAhPT0gIi5qc3giKSwgIi53eHMiXSB9KSksIEJqKEFqLCAoKSA9PiAoeyBuYW1lOiAiRmxvdyIsIHNpbmNlOiAiMC4wLjAiLCBwYXJzZXJzOiBbImZsb3ciLCAiYmFiZWwtZmxvdyJdLCB2c2NvZGVMYW5ndWFnZUlkczogWyJqYXZhc2NyaXB0Il0sIGFsaWFzZXM6IFtdLCBmaWxlbmFtZXM6IFtdLCBleHRlbnNpb25zOiBbIi5qcy5mbG93Il0gfSkpLCBCaihBaiwgKCkgPT4gKHsgbmFtZTogIkpTWCIsIHNpbmNlOiAiMC4wLjAiLCBwYXJzZXJzOiBbImJhYmVsIiwgImJhYmVsLWZsb3ciLCAiYmFiZWwtdHMiLCAiZmxvdyIsICJ0eXBlc2NyaXB0IiwgImVzcHJlZSIsICJtZXJpeWFoIl0sIHZzY29kZUxhbmd1YWdlSWRzOiBbImphdmFzY3JpcHRyZWFjdCJdLCBhbGlhc2VzOiB2b2lkIDAsIGZpbGVuYW1lczogdm9pZCAwLCBleHRlbnNpb25zOiBbIi5qc3giXSwgZ3JvdXA6ICJKYXZhU2NyaXB0IiwgaW50ZXJwcmV0ZXJzOiB2b2lkIDAsIHRtU2NvcGU6ICJzb3VyY2UuanMuanN4IiwgYWNlTW9kZTogImphdmFzY3JpcHQiLCBjb2RlbWlycm9yTW9kZTogImpzeCIsIGNvZGVtaXJyb3JNaW1lVHlwZTogInRleHQvanN4IiwgY29sb3I6IHZvaWQgMCB9KSksIEJqKEZqLCAoZTIpID0+ICh7IHNpbmNlOiAiMS40LjAiLCBwYXJzZXJzOiBbInR5cGVzY3JpcHQiLCAiYmFiZWwtdHMiXSwgdnNjb2RlTGFuZ3VhZ2VJZHM6IFsidHlwZXNjcmlwdCJdLCBleHRlbnNpb25zOiBbLi4uZTIuZXh0ZW5zaW9ucywgIi5tdHMiLCAiLmN0cyJdIH0pKSwgQmooeGosICgpID0+ICh7IHNpbmNlOiAiMS40LjAiLCBwYXJzZXJzOiBbInR5cGVzY3JpcHQiLCAiYmFiZWwtdHMiXSwgdnNjb2RlTGFuZ3VhZ2VJZHM6IFsidHlwZXNjcmlwdHJlYWN0Il0gfSkpLCBCaihTaiwgKCkgPT4gKHsgbmFtZTogIkpTT04uc3RyaW5naWZ5Iiwgc2luY2U6ICIxLjEzLjAiLCBwYXJzZXJzOiBbImpzb24tc3RyaW5naWZ5Il0sIHZzY29kZUxhbmd1YWdlSWRzOiBbImpzb24iXSwgZXh0ZW5zaW9uczogW10sIGZpbGVuYW1lczogWyJwYWNrYWdlLmpzb24iLCAicGFja2FnZS1sb2NrLmpzb24iLCAiY29tcG9zZXIuanNvbiJdIH0pKSwgQmooU2osIChlMikgPT4gKHsgc2luY2U6ICIxLjUuMCIsIHBhcnNlcnM6IFsianNvbiJdLCB2c2NvZGVMYW5ndWFnZUlkczogWyJqc29uIl0sIGV4dGVuc2lvbnM6IGUyLmV4dGVuc2lvbnMuZmlsdGVyKChlMykgPT4gZTMgIT09ICIuanNvbmwiKSB9KSksIEJqKHdqLCAoZTIpID0+ICh7IHNpbmNlOiAiMS41LjAiLCBwYXJzZXJzOiBbImpzb24iXSwgdnNjb2RlTGFuZ3VhZ2VJZHM6IFsianNvbmMiXSwgZmlsZW5hbWVzOiBbLi4uZTIuZmlsZW5hbWVzLCAiLmVzbGludHJjIl0gfSkpLCBCaihUaiwgKCkgPT4gKHsgc2luY2U6ICIxLjEzLjAiLCBwYXJzZXJzOiBbImpzb241Il0sIHZzY29kZUxhbmd1YWdlSWRzOiBbImpzb241Il0gfSkpXTsKICAgICAgICB2YXIgSWogPSB7IGxhbmd1YWdlczogT2osIG9wdGlvbnM6IFBqLCBwcmludGVyczogeyBlc3RyZWU6IE5qLCAiZXN0cmVlLWpzb24iOiBraiB9LCBwYXJzZXJzOiB2b2lkIDAgfTsKICAgICAgICBjb25zdCB7IGlzRnJvbnRNYXR0ZXJOb2RlOiBMaiB9ID0gZGMsIGpqID0gYXUsIF9qID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJyYXciLCAicmF3cyIsICJzb3VyY2VJbmRleCIsICJzb3VyY2UiLCAiYmVmb3JlIiwgImFmdGVyIiwgInRyYWlsaW5nQ29tbWEiXSk7CiAgICAgICAgZnVuY3Rpb24gTWooZTIsIHQyLCBuMikgewogICAgICAgICAgaWYgKExqKGUyKSAmJiBlMi5sYW5nID09PSAieWFtbCIgJiYgZGVsZXRlIHQyLnZhbHVlLCBlMi50eXBlID09PSAiY3NzLWNvbW1lbnQiICYmIG4yLnR5cGUgPT09ICJjc3Mtcm9vdCIgJiYgbjIubm9kZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBpZiAoKG4yLm5vZGVzWzBdID09PSBlMiB8fCBMaihuMi5ub2Rlc1swXSkgJiYgbjIubm9kZXNbMV0gPT09IGUyKSAmJiAoZGVsZXRlIHQyLnRleHQsIC9eXCpccypAKD86Zm9ybWF0fHByZXR0aWVyKVxzKiQvLnRlc3QoZTIudGV4dCkpKQogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAobjIudHlwZSA9PT0gImNzcy1yb290IiAmJiBqaihuMi5ub2RlcykgPT09IGUyKQogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGUyLnR5cGUgPT09ICJ2YWx1ZS1yb290IiAmJiBkZWxldGUgdDIudGV4dCwgZTIudHlwZSAhPT0gIm1lZGlhLXF1ZXJ5IiAmJiBlMi50eXBlICE9PSAibWVkaWEtcXVlcnktbGlzdCIgJiYgZTIudHlwZSAhPT0gIm1lZGlhLWZlYXR1cmUtZXhwcmVzc2lvbiIgfHwgZGVsZXRlIHQyLnZhbHVlLCBlMi50eXBlID09PSAiY3NzLXJ1bGUiICYmIGRlbGV0ZSB0Mi5wYXJhbXMsIGUyLnR5cGUgPT09ICJzZWxlY3Rvci1jb21iaW5hdG9yIiAmJiAodDIudmFsdWUgPSB0Mi52YWx1ZS5yZXBsYWNlKC9ccysvZywgIiAiKSksIGUyLnR5cGUgPT09ICJtZWRpYS1mZWF0dXJlIiAmJiAodDIudmFsdWUgPSB0Mi52YWx1ZS5yZXBsYWNlKC8gL2csICIiKSksIChlMi50eXBlID09PSAidmFsdWUtd29yZCIgJiYgKGUyLmlzQ29sb3IgJiYgZTIuaXNIZXggfHwgWyJpbml0aWFsIiwgImluaGVyaXQiLCAidW5zZXQiLCAicmV2ZXJ0Il0uaW5jbHVkZXModDIudmFsdWUucmVwbGFjZSgpLnRvTG93ZXJDYXNlKCkpKSB8fCBlMi50eXBlID09PSAibWVkaWEtZmVhdHVyZSIgfHwgZTIudHlwZSA9PT0gInNlbGVjdG9yLXJvb3QtaW52YWxpZCIgfHwgZTIudHlwZSA9PT0gInNlbGVjdG9yLXBzZXVkbyIpICYmICh0Mi52YWx1ZSA9IHQyLnZhbHVlLnRvTG93ZXJDYXNlKCkpLCBlMi50eXBlID09PSAiY3NzLWRlY2wiICYmICh0Mi5wcm9wID0gdDIucHJvcC50b0xvd2VyQ2FzZSgpKSwgZTIudHlwZSAhPT0gImNzcy1hdHJ1bGUiICYmIGUyLnR5cGUgIT09ICJjc3MtaW1wb3J0IiB8fCAodDIubmFtZSA9IHQyLm5hbWUudG9Mb3dlckNhc2UoKSksIGUyLnR5cGUgPT09ICJ2YWx1ZS1udW1iZXIiICYmICh0Mi51bml0ID0gdDIudW5pdC50b0xvd2VyQ2FzZSgpKSwgZTIudHlwZSAhPT0gIm1lZGlhLWZlYXR1cmUiICYmIGUyLnR5cGUgIT09ICJtZWRpYS1rZXl3b3JkIiAmJiBlMi50eXBlICE9PSAibWVkaWEtdHlwZSIgJiYgZTIudHlwZSAhPT0gIm1lZGlhLXVua25vd24iICYmIGUyLnR5cGUgIT09ICJtZWRpYS11cmwiICYmIGUyLnR5cGUgIT09ICJtZWRpYS12YWx1ZSIgJiYgZTIudHlwZSAhPT0gInNlbGVjdG9yLWF0dHJpYnV0ZSIgJiYgZTIudHlwZSAhPT0gInNlbGVjdG9yLXN0cmluZyIgJiYgZTIudHlwZSAhPT0gInNlbGVjdG9yLWNsYXNzIiAmJiBlMi50eXBlICE9PSAic2VsZWN0b3ItY29tYmluYXRvciIgJiYgZTIudHlwZSAhPT0gInZhbHVlLXN0cmluZyIgfHwgIXQyLnZhbHVlIHx8ICh0Mi52YWx1ZSA9IHQyLnZhbHVlLnJlcGxhY2UoLycvZywgJyInKS5yZXBsYWNlKC9cXChbXlxkQS1GYS1mXSkvZywgIiQxIikpLCBlMi50eXBlID09PSAic2VsZWN0b3ItYXR0cmlidXRlIiAmJiAodDIuYXR0cmlidXRlID0gdDIuYXR0cmlidXRlLnRyaW0oKSwgdDIubmFtZXNwYWNlICYmIHR5cGVvZiB0Mi5uYW1lc3BhY2UgPT0gInN0cmluZyIgJiYgKHQyLm5hbWVzcGFjZSA9IHQyLm5hbWVzcGFjZS50cmltKCksIHQyLm5hbWVzcGFjZS5sZW5ndGggPT09IDAgJiYgKHQyLm5hbWVzcGFjZSA9IHRydWUpKSwgdDIudmFsdWUgJiYgKHQyLnZhbHVlID0gdDIudmFsdWUudHJpbSgpLnJlcGxhY2UoL15bIiddfFsiJ10kL2csICIiKSwgZGVsZXRlIHQyLnF1b3RlZCkpLCBlMi50eXBlICE9PSAibWVkaWEtdmFsdWUiICYmIGUyLnR5cGUgIT09ICJtZWRpYS10eXBlIiAmJiBlMi50eXBlICE9PSAidmFsdWUtbnVtYmVyIiAmJiBlMi50eXBlICE9PSAic2VsZWN0b3Itcm9vdC1pbnZhbGlkIiAmJiBlMi50eXBlICE9PSAic2VsZWN0b3ItY2xhc3MiICYmIGUyLnR5cGUgIT09ICJzZWxlY3Rvci1jb21iaW5hdG9yIiAmJiBlMi50eXBlICE9PSAic2VsZWN0b3ItdGFnIiB8fCAhdDIudmFsdWUgfHwgKHQyLnZhbHVlID0gdDIudmFsdWUucmVwbGFjZSgvKFtcZCsuRWUtXSspKFtBLVphLXpdKikvZywgKGUzLCB0MywgbjMpID0+IHsKICAgICAgICAgICAgY29uc3QgcjIgPSBOdW1iZXIodDMpOwogICAgICAgICAgICByZXR1cm4gTnVtYmVyLmlzTmFOKHIyKSA/IGUzIDogcjIgKyBuMy50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgfSkpLCBlMi50eXBlID09PSAic2VsZWN0b3ItdGFnIikgewogICAgICAgICAgICBjb25zdCBuMyA9IGUyLnZhbHVlLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIFsiZnJvbSIsICJ0byJdLmluY2x1ZGVzKG4zKSAmJiAodDIudmFsdWUgPSBuMyk7CiAgICAgICAgICB9CiAgICAgICAgICBlMi50eXBlID09PSAiY3NzLWF0cnVsZSIgJiYgZTIubmFtZS50b0xvd2VyQ2FzZSgpID09PSAic3VwcG9ydHMiICYmIGRlbGV0ZSB0Mi52YWx1ZSwgZTIudHlwZSA9PT0gInNlbGVjdG9yLXVua25vd24iICYmIGRlbGV0ZSB0Mi52YWx1ZTsKICAgICAgICB9CiAgICAgICAgTWouaWdub3JlZFByb3BlcnRpZXMgPSBfajsKICAgICAgICB2YXIgUmogPSBNajsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IGhhcmRsaW5lOiBWaiwgbWFya0FzUm9vdDogJGogfSB9ID0gWmM7CiAgICAgICAgdmFyIFdqID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBpZiAoZTIubGFuZyA9PT0gInlhbWwiKSB7CiAgICAgICAgICAgIGNvbnN0IG4yID0gZTIudmFsdWUudHJpbSgpLCByMiA9IG4yID8gdDIobjIsIHsgcGFyc2VyOiAieWFtbCIgfSwgeyBzdHJpcFRyYWlsaW5nSGFyZGxpbmU6IHRydWUgfSkgOiAiIjsKICAgICAgICAgICAgcmV0dXJuICRqKFtlMi5zdGFydERlbGltaXRlciwgVmosIHIyLCByMiA/IFZqIDogIiIsIGUyLmVuZERlbGltaXRlcl0pOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY29uc3QgeyBidWlsZGVyczogeyBoYXJkbGluZTogcWogfSB9ID0gWmMsIFVqID0gV2o7CiAgICAgICAgdmFyIHpqID0gZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgaWYgKHIyLnR5cGUgPT09ICJmcm9udC1tYXR0ZXIiKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gVWoocjIsIG4yKTsKICAgICAgICAgICAgcmV0dXJuIGUzID8gW2UzLCBxal0gOiAiIjsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNvbnN0IEdqID0gbmV3IFJlZ0V4cCgiXig/PHN0YXJ0RGVsaW1pdGVyPi17M318XFwrezN9KSg/PGxhbmd1YWdlPlteXFxuXSopXFxuKD86fCg/PHZhbHVlPi4qPylcXG4pKD88ZW5kRGVsaW1pdGVyPlxcazxzdGFydERlbGltaXRlcj58XFwuezN9KVteXFxTXFxuXSooPzpcXG58JCkiLCAicyIpOwogICAgICAgIHZhciBIaiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyLm1hdGNoKEdqKTsKICAgICAgICAgIGlmICghdDIpCiAgICAgICAgICAgIHJldHVybiB7IGNvbnRlbnQ6IGUyIH07CiAgICAgICAgICBjb25zdCB7IHN0YXJ0RGVsaW1pdGVyOiBuMiwgbGFuZ3VhZ2U6IHIyLCB2YWx1ZTogbzIgPSAiIiwgZW5kRGVsaW1pdGVyOiBpMiB9ID0gdDIuZ3JvdXBzOwogICAgICAgICAgbGV0IHUyID0gcjIudHJpbSgpIHx8ICJ5YW1sIjsKICAgICAgICAgIGlmIChuMiA9PT0gIisrKyIgJiYgKHUyID0gInRvbWwiKSwgdTIgIT09ICJ5YW1sIiAmJiBuMiAhPT0gaTIpCiAgICAgICAgICAgIHJldHVybiB7IGNvbnRlbnQ6IGUyIH07CiAgICAgICAgICBjb25zdCBbczJdID0gdDI7CiAgICAgICAgICByZXR1cm4geyBmcm9udE1hdHRlcjogeyB0eXBlOiAiZnJvbnQtbWF0dGVyIiwgbGFuZzogdTIsIHZhbHVlOiBvMiwgc3RhcnREZWxpbWl0ZXI6IG4yLCBlbmREZWxpbWl0ZXI6IGkyLCByYXc6IHMyLnJlcGxhY2UoL1xuJC8sICIiKSB9LCBjb250ZW50OiBzMi5yZXBsYWNlKC9bXlxuXS9nLCAiICIpICsgZTIuc2xpY2UoczIubGVuZ3RoKSB9OwogICAgICAgIH07CiAgICAgICAgY29uc3QgSmogPSBpdiwgWGogPSBIajsKICAgICAgICB2YXIgWWogPSB7IGhhc1ByYWdtYTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBKai5oYXNQcmFnbWEoWGooZTIpLmNvbnRlbnQpOwogICAgICAgIH0sIGluc2VydFByYWdtYTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHsgZnJvbnRNYXR0ZXI6IHQyLCBjb250ZW50OiBuMiB9ID0gWGooZTIpOwogICAgICAgICAgcmV0dXJuICh0MiA/IHQyLnJhdyArICJcblxuIiA6ICIiKSArIEpqLmluc2VydFByYWdtYShuMik7CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IHsgaXNOb25FbXB0eUFycmF5OiBLaiB9ID0gZGMsIFFqID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJyZWQiLCAiZ3JlZW4iLCAiYmx1ZSIsICJhbHBoYSIsICJhIiwgInJnYiIsICJodWUiLCAiaCIsICJzYXR1cmF0aW9uIiwgInMiLCAibGlnaHRuZXNzIiwgImwiLCAid2hpdGVuZXNzIiwgInciLCAiYmxhY2tuZXNzIiwgImIiLCAidGludCIsICJzaGFkZSIsICJibGVuZCIsICJibGVuZGEiLCAiY29udHJhc3QiLCAiaHNsIiwgImhzbGEiLCAiaHdiIiwgImh3YmEiXSksIFpqID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJpbXBvcnQiLCAidXNlIiwgImZvcndhcmQiXSk7CiAgICAgICAgZnVuY3Rpb24gZV8oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IEFycmF5LmlzQXJyYXkodDIpID8gdDIgOiBbdDJdOwogICAgICAgICAgbGV0IHIyLCBvMiA9IC0xOwogICAgICAgICAgZm9yICg7IHIyID0gZTIuZ2V0UGFyZW50Tm9kZSgrK28yKTsgKQogICAgICAgICAgICBpZiAobjIuaW5jbHVkZXMocjIudHlwZSkpCiAgICAgICAgICAgICAgcmV0dXJuIG8yOwogICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0XyhlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gZV8oZTIsIHQyKTsKICAgICAgICAgIHJldHVybiBuMiA9PT0gLTEgPyBudWxsIDogZTIuZ2V0UGFyZW50Tm9kZShuMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG5fKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gInZhbHVlLW9wZXJhdG9yIiAmJiBlMi52YWx1ZSA9PT0gIioiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiByXyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJ2YWx1ZS1vcGVyYXRvciIgJiYgZTIudmFsdWUgPT09ICIvIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb18oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAidmFsdWUtb3BlcmF0b3IiICYmIGUyLnZhbHVlID09PSAiKyI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlfKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gInZhbHVlLW9wZXJhdG9yIiAmJiBlMi52YWx1ZSA9PT0gIi0iOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB1XyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJ2YWx1ZS1vcGVyYXRvciIgJiYgZTIudmFsdWUgPT09ICIlIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc18oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAidmFsdWUtY29tbWFfZ3JvdXAiICYmIGUyLmdyb3VwcyAmJiBlMi5ncm91cHNbMV0gJiYgZTIuZ3JvdXBzWzFdLnR5cGUgPT09ICJ2YWx1ZS1jb2xvbiI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFfKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gInZhbHVlLXBhcmVuX2dyb3VwIiAmJiBlMi5ncm91cHMgJiYgZTIuZ3JvdXBzWzBdICYmIHNfKGUyLmdyb3Vwc1swXSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNfKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgZTIudHlwZSA9PT0gInZhbHVlLWNvbG9uIjsKICAgICAgICB9CiAgICAgICAgdmFyIGxfID0geyBnZXRBbmNlc3RvckNvdW50ZXI6IGVfLCBnZXRBbmNlc3Rvck5vZGU6IHRfLCBnZXRQcm9wT2ZEZWNsTm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gdF8oZTIsICJjc3MtZGVjbCIpOwogICAgICAgICAgcmV0dXJuIHQyICYmIHQyLnByb3AgJiYgdDIucHJvcC50b0xvd2VyQ2FzZSgpOwogICAgICAgIH0sIGhhc1NDU1NJbnRlcnBvbGF0aW9uOiBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKEtqKGUyKSkgewogICAgICAgICAgICBmb3IgKGxldCB0MiA9IGUyLmxlbmd0aCAtIDE7IHQyID4gMDsgdDItLSkKICAgICAgICAgICAgICBpZiAoZTJbdDJdLnR5cGUgPT09ICJ3b3JkIiAmJiBlMlt0Ml0udmFsdWUgPT09ICJ7IiAmJiBlMlt0MiAtIDFdLnR5cGUgPT09ICJ3b3JkIiAmJiBlMlt0MiAtIDFdLnZhbHVlLmVuZHNXaXRoKCIjIikpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LCBoYXNTdHJpbmdPckZ1bmN0aW9uOiBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKEtqKGUyKSkgewogICAgICAgICAgICBmb3IgKGxldCB0MiA9IDA7IHQyIDwgZTIubGVuZ3RoOyB0MisrKQogICAgICAgICAgICAgIGlmIChlMlt0Ml0udHlwZSA9PT0gInN0cmluZyIgfHwgZTJbdDJdLnR5cGUgPT09ICJmdW5jIikKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0sIG1heWJlVG9Mb3dlckNhc2U6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIuaW5jbHVkZXMoIiQiKSB8fCBlMi5pbmNsdWRlcygiQCIpIHx8IGUyLmluY2x1ZGVzKCIjIikgfHwgZTIuc3RhcnRzV2l0aCgiJSIpIHx8IGUyLnN0YXJ0c1dpdGgoIi0tIikgfHwgZTIuc3RhcnRzV2l0aCgiOi0tIikgfHwgZTIuaW5jbHVkZXMoIigiKSAmJiBlMi5pbmNsdWRlcygiKSIpID8gZTIgOiBlMi50b0xvd2VyQ2FzZSgpOwogICAgICAgIH0sIGluc2lkZVZhbHVlRnVuY3Rpb25Ob2RlOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gdF8oZTIsICJ2YWx1ZS1mdW5jIik7CiAgICAgICAgICByZXR1cm4gbjIgJiYgbjIudmFsdWUgJiYgbjIudmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gdDI7CiAgICAgICAgfSwgaW5zaWRlSUNTU1J1bGVOb2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSB0XyhlMiwgImNzcy1ydWxlIik7CiAgICAgICAgICByZXR1cm4gdDIgJiYgdDIucmF3cyAmJiB0Mi5yYXdzLnNlbGVjdG9yICYmICh0Mi5yYXdzLnNlbGVjdG9yLnN0YXJ0c1dpdGgoIjppbXBvcnQiKSB8fCB0Mi5yYXdzLnNlbGVjdG9yLnN0YXJ0c1dpdGgoIjpleHBvcnQiKSk7CiAgICAgICAgfSwgaW5zaWRlQXRSdWxlTm9kZTogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IEFycmF5LmlzQXJyYXkodDIpID8gdDIgOiBbdDJdLCByMiA9IHRfKGUyLCAiY3NzLWF0cnVsZSIpOwogICAgICAgICAgcmV0dXJuIHIyICYmIG4yLmluY2x1ZGVzKHIyLm5hbWUudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgfSwgaW5zaWRlVVJMRnVuY3Rpb25JbkltcG9ydEF0UnVsZU5vZGU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyLmdldFZhbHVlKCksIG4yID0gdF8oZTIsICJjc3MtYXRydWxlIik7CiAgICAgICAgICByZXR1cm4gbjIgJiYgbjIubmFtZSA9PT0gImltcG9ydCIgJiYgdDIuZ3JvdXBzWzBdLnZhbHVlID09PSAidXJsIiAmJiB0Mi5ncm91cHMubGVuZ3RoID09PSAyOwogICAgICAgIH0sIGlzS2V5ZnJhbWVBdFJ1bGVLZXl3b3JkczogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IHRfKGUyLCAiY3NzLWF0cnVsZSIpOwogICAgICAgICAgcmV0dXJuIG4yICYmIG4yLm5hbWUgJiYgbjIubmFtZS50b0xvd2VyQ2FzZSgpLmVuZHNXaXRoKCJrZXlmcmFtZXMiKSAmJiBbImZyb20iLCAidG8iXS5pbmNsdWRlcyh0Mi50b0xvd2VyQ2FzZSgpKTsKICAgICAgICB9LCBpc1dpZGVLZXl3b3JkczogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBbImluaXRpYWwiLCAiaW5oZXJpdCIsICJ1bnNldCIsICJyZXZlcnQiXS5pbmNsdWRlcyhlMi50b0xvd2VyQ2FzZSgpKTsKICAgICAgICB9LCBpc1NDU1M6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGUyID09PSAibGVzcyIgfHwgZTIgPT09ICJzY3NzIiA/IGUyID09PSAic2NzcyIgOiAvKD86XHdccyo6XHMqW146fV0rfCMpe3xAaW1wb3J0W15cbl0rKD86dXJsfCwpLy50ZXN0KHQyKTsKICAgICAgICB9LCBpc1NDU1NWYXJpYWJsZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBCb29sZWFuKGUyICYmIGUyLnR5cGUgPT09ICJ3b3JkIiAmJiBlMi52YWx1ZS5zdGFydHNXaXRoKCIkIikpOwogICAgICAgIH0sIGlzTGFzdE5vZGU6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSBlMi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICBpZiAoIW4yKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBjb25zdCB7IG5vZGVzOiByMiB9ID0gbjI7CiAgICAgICAgICByZXR1cm4gcjIgJiYgcjIuaW5kZXhPZih0MikgPT09IHIyLmxlbmd0aCAtIDE7CiAgICAgICAgfSwgaXNMZXNzUGFyc2VyOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnBhcnNlciA9PT0gImNzcyIgfHwgZTIucGFyc2VyID09PSAibGVzcyI7CiAgICAgICAgfSwgaXNTQ1NTQ29udHJvbERpcmVjdGl2ZU5vZGU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gImNzcy1hdHJ1bGUiICYmIFsiaWYiLCAiZWxzZSIsICJmb3IiLCAiZWFjaCIsICJ3aGlsZSJdLmluY2x1ZGVzKGUyLm5hbWUpOwogICAgICAgIH0sIGlzRGV0YWNoZWRSdWxlc2V0RGVjbGFyYXRpb25Ob2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuICEhZTIuc2VsZWN0b3IgJiYgKHR5cGVvZiBlMi5zZWxlY3RvciA9PSAic3RyaW5nIiAmJiAvXkAuKzouKiQvLnRlc3QoZTIuc2VsZWN0b3IpIHx8IGUyLnNlbGVjdG9yLnZhbHVlICYmIC9eQC4rOi4qJC8udGVzdChlMi5zZWxlY3Rvci52YWx1ZSkpOwogICAgICAgIH0sIGlzUmVsYXRpb25hbE9wZXJhdG9yTm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAidmFsdWUtd29yZCIgJiYgWyI8IiwgIj4iLCAiPD0iLCAiPj0iXS5pbmNsdWRlcyhlMi52YWx1ZSk7CiAgICAgICAgfSwgaXNFcXVhbGl0eU9wZXJhdG9yTm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAidmFsdWUtd29yZCIgJiYgWyI9PSIsICIhPSJdLmluY2x1ZGVzKGUyLnZhbHVlKTsKICAgICAgICB9LCBpc011bHRpcGxpY2F0aW9uTm9kZTogbl8sIGlzRGl2aXNpb25Ob2RlOiByXywgaXNBZGRpdGlvbk5vZGU6IG9fLCBpc1N1YnRyYWN0aW9uTm9kZTogaV8sIGlzTW9kdWxvTm9kZTogdV8sIGlzTWF0aE9wZXJhdG9yTm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBuXyhlMikgfHwgcl8oZTIpIHx8IG9fKGUyKSB8fCBpXyhlMikgfHwgdV8oZTIpOwogICAgICAgIH0sIGlzRWFjaEtleXdvcmROb2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJ2YWx1ZS13b3JkIiAmJiBlMi52YWx1ZSA9PT0gImluIjsKICAgICAgICB9LCBpc0ZvcktleXdvcmROb2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJ2YWx1ZS13b3JkIiAmJiBbImZyb20iLCAidGhyb3VnaCIsICJlbmQiXS5pbmNsdWRlcyhlMi52YWx1ZSk7CiAgICAgICAgfSwgaXNVUkxGdW5jdGlvbk5vZGU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gInZhbHVlLWZ1bmMiICYmIGUyLnZhbHVlLnRvTG93ZXJDYXNlKCkgPT09ICJ1cmwiOwogICAgICAgIH0sIGlzSWZFbHNlS2V5d29yZE5vZGU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gInZhbHVlLXdvcmQiICYmIFsiYW5kIiwgIm9yIiwgIm5vdCJdLmluY2x1ZGVzKGUyLnZhbHVlKTsKICAgICAgICB9LCBoYXNDb21wb3Nlc05vZGU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudmFsdWUgJiYgZTIudmFsdWUudHlwZSA9PT0gInZhbHVlLXJvb3QiICYmIGUyLnZhbHVlLmdyb3VwICYmIGUyLnZhbHVlLmdyb3VwLnR5cGUgPT09ICJ2YWx1ZS12YWx1ZSIgJiYgZTIucHJvcC50b0xvd2VyQ2FzZSgpID09PSAiY29tcG9zZXMiOwogICAgICAgIH0sIGhhc1BhcmVuc0Fyb3VuZE5vZGU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudmFsdWUgJiYgZTIudmFsdWUuZ3JvdXAgJiYgZTIudmFsdWUuZ3JvdXAuZ3JvdXAgJiYgZTIudmFsdWUuZ3JvdXAuZ3JvdXAudHlwZSA9PT0gInZhbHVlLXBhcmVuX2dyb3VwIiAmJiBlMi52YWx1ZS5ncm91cC5ncm91cC5vcGVuICE9PSBudWxsICYmIGUyLnZhbHVlLmdyb3VwLmdyb3VwLmNsb3NlICE9PSBudWxsOwogICAgICAgIH0sIGhhc0VtcHR5UmF3QmVmb3JlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnJhd3MgJiYgZTIucmF3cy5iZWZvcmUgPT09ICIiOwogICAgICAgIH0sIGlzU0NTU05lc3RlZFByb3BlcnR5Tm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiAhIWUyLnNlbGVjdG9yICYmIGUyLnNlbGVjdG9yLnJlcGxhY2UoL1wvXCouKj9cKlwvLywgIiIpLnJlcGxhY2UoL1wvXC8uKj9cbi8sICIiKS50cmltKCkuZW5kc1dpdGgoIjoiKTsKICAgICAgICB9LCBpc0RldGFjaGVkUnVsZXNldENhbGxOb2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnJhd3MgJiYgZTIucmF3cy5wYXJhbXMgJiYgL15cKFxzKlwpJC8udGVzdChlMi5yYXdzLnBhcmFtcyk7CiAgICAgICAgfSwgaXNUZW1wbGF0ZVBsYWNlaG9sZGVyTm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5uYW1lLnN0YXJ0c1dpdGgoInByZXR0aWVyLXBsYWNlaG9sZGVyIik7CiAgICAgICAgfSwgaXNUZW1wbGF0ZVByb3BOb2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnByb3Auc3RhcnRzV2l0aCgiQHByZXR0aWVyLXBsYWNlaG9sZGVyIik7CiAgICAgICAgfSwgaXNQb3N0Y3NzU2ltcGxlVmFyTm9kZTogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gZTIudmFsdWUgPT09ICIkJCIgJiYgZTIudHlwZSA9PT0gInZhbHVlLWZ1bmMiICYmIHQyICYmIHQyLnR5cGUgPT09ICJ2YWx1ZS13b3JkIiAmJiAhdDIucmF3cy5iZWZvcmU7CiAgICAgICAgfSwgaXNLZXlWYWx1ZVBhaXJOb2RlOiBzXywgaXNLZXlWYWx1ZVBhaXJJblBhcmVuR3JvdXBOb2RlOiBhXywgaXNLZXlJblZhbHVlUGFpck5vZGU6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgaWYgKCFzXyh0MikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIGNvbnN0IHsgZ3JvdXBzOiBuMiB9ID0gdDIsIHIyID0gbjIuaW5kZXhPZihlMik7CiAgICAgICAgICByZXR1cm4gcjIgIT09IC0xICYmIGNfKG4yW3IyICsgMV0pOwogICAgICAgIH0sIGlzU0NTU01hcEl0ZW1Ob2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgaWYgKHQyLmdyb3Vwcy5sZW5ndGggPT09IDApCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIGNvbnN0IG4yID0gZTIuZ2V0UGFyZW50Tm9kZSgxKTsKICAgICAgICAgIGlmICghKGFfKHQyKSB8fCBuMiAmJiBhXyhuMikpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBjb25zdCByMiA9IHRfKGUyLCAiY3NzLWRlY2wiKTsKICAgICAgICAgIHJldHVybiAhIShyMiAmJiByMi5wcm9wICYmIHIyLnByb3Auc3RhcnRzV2l0aCgiJCIpKSB8fCAoISFhXyhuMikgfHwgbjIudHlwZSA9PT0gInZhbHVlLWZ1bmMiKTsKICAgICAgICB9LCBpc0lubGluZVZhbHVlQ29tbWVudE5vZGU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gInZhbHVlLWNvbW1lbnQiICYmIGUyLmlubGluZTsKICAgICAgICB9LCBpc0hhc2hOb2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJ2YWx1ZS13b3JkIiAmJiBlMi52YWx1ZSA9PT0gIiMiOwogICAgICAgIH0sIGlzTGVmdEN1cmx5QnJhY2VOb2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJ2YWx1ZS13b3JkIiAmJiBlMi52YWx1ZSA9PT0gInsiOwogICAgICAgIH0sIGlzUmlnaHRDdXJseUJyYWNlTm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAidmFsdWUtd29yZCIgJiYgZTIudmFsdWUgPT09ICJ9IjsKICAgICAgICB9LCBpc1dvcmROb2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFsidmFsdWUtd29yZCIsICJ2YWx1ZS1hdHdvcmQiXS5pbmNsdWRlcyhlMi50eXBlKTsKICAgICAgICB9LCBpc0NvbG9uTm9kZTogY18sIGlzTWVkaWFBbmRTdXBwb3J0c0tleXdvcmRzOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnZhbHVlICYmIFsibm90IiwgImFuZCIsICJvciJdLmluY2x1ZGVzKGUyLnZhbHVlLnRvTG93ZXJDYXNlKCkpOwogICAgICAgIH0sIGlzQ29sb3JBZGp1c3RlckZ1bmNOb2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJ2YWx1ZS1mdW5jIiAmJiBRai5oYXMoZTIudmFsdWUudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgfSwgbGFzdExpbmVIYXNJbmxpbmVDb21tZW50OiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIC9cL1wvLy50ZXN0KGUyLnNwbGl0KC9bXG5ccl0vKS5wb3AoKSk7CiAgICAgICAgfSwgc3RyaW5naWZ5Tm9kZTogZnVuY3Rpb24gZTIodDIpIHsKICAgICAgICAgIGlmICh0Mi5ncm91cHMpIHsKICAgICAgICAgICAgcmV0dXJuICh0Mi5vcGVuICYmIHQyLm9wZW4udmFsdWUgPyB0Mi5vcGVuLnZhbHVlIDogIiIpICsgdDIuZ3JvdXBzLnJlZHVjZSgobjMsIHIzLCBvMikgPT4gbjMgKyBlMihyMykgKyAodDIuZ3JvdXBzWzBdLnR5cGUgPT09ICJjb21tYV9ncm91cCIgJiYgbzIgIT09IHQyLmdyb3Vwcy5sZW5ndGggLSAxID8gIiwiIDogIiIpLCAiIikgKyAodDIuY2xvc2UgJiYgdDIuY2xvc2UudmFsdWUgPyB0Mi5jbG9zZS52YWx1ZSA6ICIiKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IG4yID0gdDIucmF3cyAmJiB0Mi5yYXdzLmJlZm9yZSA/IHQyLnJhd3MuYmVmb3JlIDogIiIsIHIyID0gdDIucmF3cyAmJiB0Mi5yYXdzLnF1b3RlID8gdDIucmF3cy5xdW90ZSA6ICIiOwogICAgICAgICAgcmV0dXJuIG4yICsgcjIgKyAodDIudHlwZSA9PT0gImF0d29yZCIgPyAiQCIgOiAiIikgKyAodDIudmFsdWUgPyB0Mi52YWx1ZSA6ICIiKSArIHIyICsgKHQyLnVuaXQgPyB0Mi51bml0IDogIiIpICsgKHQyLmdyb3VwID8gZTIodDIuZ3JvdXApIDogIiIpICsgKHQyLnJhd3MgJiYgdDIucmF3cy5hZnRlciA/IHQyLnJhd3MuYWZ0ZXIgOiAiIik7CiAgICAgICAgfSwgaXNBdFdvcmRQbGFjZWhvbGRlck5vZGU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgZTIudHlwZSA9PT0gInZhbHVlLWF0d29yZCIgJiYgZTIudmFsdWUuc3RhcnRzV2l0aCgicHJldHRpZXItcGxhY2Vob2xkZXItIik7CiAgICAgICAgfSwgaXNNb2R1bGVSdWxlTmFtZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBaai5oYXMoZTIpOwogICAgICAgIH0sIGlzQ29uZmlndXJhdGlvbk5vZGU6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgaWYgKCFlMi5vcGVuIHx8IGUyLm9wZW4udmFsdWUgIT09ICIoIiB8fCAhZTIuY2xvc2UgfHwgZTIuY2xvc2UudmFsdWUgIT09ICIpIiB8fCBlMi5ncm91cHMuc29tZSgoZTMpID0+IGUzLnR5cGUgIT09ICJ2YWx1ZS1jb21tYV9ncm91cCIpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBpZiAodDIudHlwZSA9PT0gInZhbHVlLWNvbW1hX2dyb3VwIikgewogICAgICAgICAgICBjb25zdCBuMiA9IHQyLmdyb3Vwcy5pbmRleE9mKGUyKSAtIDEsIHIyID0gdDIuZ3JvdXBzW24yXTsKICAgICAgICAgICAgaWYgKHIyICYmIHIyLnR5cGUgPT09ICJ2YWx1ZS13b3JkIiAmJiByMi52YWx1ZSA9PT0gIndpdGgiKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0sIGlzUGFyZW5Hcm91cE5vZGU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gInZhbHVlLXBhcmVuX2dyb3VwIiAmJiBlMi5vcGVuICYmIGUyLm9wZW4udmFsdWUgPT09ICIoIiAmJiBlMi5jbG9zZSAmJiBlMi5jbG9zZS52YWx1ZSA9PT0gIikiOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCBwXyA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgbGV0IG4yID0gMDsKICAgICAgICAgIGZvciAobGV0IHIyID0gMDsgcjIgPCBlMi5saW5lIC0gMTsgKytyMikKICAgICAgICAgICAgbjIgPSB0Mi5pbmRleE9mKCJcbiIsIG4yKSArIDE7CiAgICAgICAgICByZXR1cm4gbjIgKyBlMi5jb2x1bW47CiAgICAgICAgfSwgeyBnZXRMYXN0OiBmXywgc2tpcEV2ZXJ5dGhpbmdCdXROZXdMaW5lOiBkXyB9ID0gZGM7CiAgICAgICAgZnVuY3Rpb24gaF8oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGUyLnNvdXJjZUluZGV4ID09ICJudW1iZXIiID8gZTIuc291cmNlSW5kZXggOiBlMi5zb3VyY2UgPyBwXyhlMi5zb3VyY2Uuc3RhcnQsIHQyKSAtIDEgOiBudWxsOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnXyhlMiwgdDIpIHsKICAgICAgICAgIGlmIChlMi50eXBlID09PSAiY3NzLWNvbW1lbnQiICYmIGUyLmlubGluZSkKICAgICAgICAgICAgcmV0dXJuIGRfKHQyLCBlMi5zb3VyY2Uuc3RhcnRPZmZzZXQpOwogICAgICAgICAgY29uc3QgbjIgPSBlMi5ub2RlcyAmJiBmXyhlMi5ub2Rlcyk7CiAgICAgICAgICByZXR1cm4gbjIgJiYgZTIuc291cmNlICYmICFlMi5zb3VyY2UuZW5kICYmIChlMiA9IG4yKSwgZTIuc291cmNlICYmIGUyLnNvdXJjZS5lbmQgPyBwXyhlMi5zb3VyY2UuZW5kLCB0MikgOiBudWxsOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBtXyhlMiwgdDIsIG4yKSB7CiAgICAgICAgICBlMi5zb3VyY2UgJiYgKGUyLnNvdXJjZS5zdGFydE9mZnNldCA9IGhfKGUyLCBuMikgKyB0MiwgZTIuc291cmNlLmVuZE9mZnNldCA9IGdfKGUyLCBuMikgKyB0Mik7CiAgICAgICAgICBmb3IgKGNvbnN0IHIyIGluIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IG8yID0gZTJbcjJdOwogICAgICAgICAgICByMiAhPT0gInNvdXJjZSIgJiYgbzIgJiYgdHlwZW9mIG8yID09ICJvYmplY3QiICYmIG1fKG8yLCB0MiwgbjIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB5XyhlMikgewogICAgICAgICAgbGV0IHQyID0gZTIuc291cmNlLnN0YXJ0T2Zmc2V0OwogICAgICAgICAgcmV0dXJuIHR5cGVvZiBlMi5wcm9wID09ICJzdHJpbmciICYmICh0MiArPSBlMi5wcm9wLmxlbmd0aCksIGUyLnR5cGUgPT09ICJjc3MtYXRydWxlIiAmJiB0eXBlb2YgZTIubmFtZSA9PSAic3RyaW5nIiAmJiAodDIgKz0gMSArIGUyLm5hbWUubGVuZ3RoICsgZTIucmF3cy5hZnRlck5hbWUubWF0Y2goL15ccyo6P1xzKi8pWzBdLmxlbmd0aCksIGUyLnR5cGUgIT09ICJjc3MtYXRydWxlIiAmJiBlMi5yYXdzICYmIHR5cGVvZiBlMi5yYXdzLmJldHdlZW4gPT0gInN0cmluZyIgJiYgKHQyICs9IGUyLnJhd3MuYmV0d2Vlbi5sZW5ndGgpLCB0MjsKICAgICAgICB9CiAgICAgICAgdmFyIERfID0geyBsb2NTdGFydDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5zb3VyY2Uuc3RhcnRPZmZzZXQ7CiAgICAgICAgfSwgbG9jRW5kOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnNvdXJjZS5lbmRPZmZzZXQ7CiAgICAgICAgfSwgY2FsY3VsYXRlTG9jOiBmdW5jdGlvbiBlMih0MiwgbjIpIHsKICAgICAgICAgIHQyLnNvdXJjZSAmJiAodDIuc291cmNlLnN0YXJ0T2Zmc2V0ID0gaF8odDIsIG4yKSwgdDIuc291cmNlLmVuZE9mZnNldCA9IGdfKHQyLCBuMikpOwogICAgICAgICAgZm9yIChjb25zdCByMiBpbiB0MikgewogICAgICAgICAgICBjb25zdCBvMiA9IHQyW3IyXTsKICAgICAgICAgICAgcjIgIT09ICJzb3VyY2UiICYmIG8yICYmIHR5cGVvZiBvMiA9PSAib2JqZWN0IiAmJiAobzIudHlwZSA9PT0gInZhbHVlLXJvb3QiIHx8IG8yLnR5cGUgPT09ICJ2YWx1ZS11bmtub3duIiA/IG1fKG8yLCB5Xyh0MiksIG8yLnRleHQgfHwgbzIudmFsdWUpIDogZTIobzIsIG4yKSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgcmVwbGFjZVF1b3Rlc0luSW5saW5lQ29tbWVudHM6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBsZXQgdDIsIG4yID0gImluaXRpYWwiLCByMiA9ICJpbml0aWFsIiwgbzIgPSBmYWxzZTsKICAgICAgICAgIGNvbnN0IGkyID0gW107CiAgICAgICAgICBmb3IgKGxldCB1MiA9IDA7IHUyIDwgZTIubGVuZ3RoOyB1MisrKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gZTJbdTJdOwogICAgICAgICAgICBzd2l0Y2ggKG4yKSB7CiAgICAgICAgICAgICAgY2FzZSAiaW5pdGlhbCI6CiAgICAgICAgICAgICAgICBpZiAoczIgPT09ICInIikgewogICAgICAgICAgICAgICAgICBuMiA9ICJzaW5nbGUtcXVvdGVzIjsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoczIgPT09ICciJykgewogICAgICAgICAgICAgICAgICBuMiA9ICJkb3VibGUtcXVvdGVzIjsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoKHMyID09PSAidSIgfHwgczIgPT09ICJVIikgJiYgZTIuc2xpY2UodTIsIHUyICsgNCkudG9Mb3dlckNhc2UoKSA9PT0gInVybCgiKSB7CiAgICAgICAgICAgICAgICAgIG4yID0gInVybCIsIHUyICs9IDM7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHMyID09PSAiKiIgJiYgZTJbdTIgLSAxXSA9PT0gIi8iKSB7CiAgICAgICAgICAgICAgICAgIG4yID0gImNvbW1lbnQtYmxvY2siOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzMiA9PT0gIi8iICYmIGUyW3UyIC0gMV0gPT09ICIvIikgewogICAgICAgICAgICAgICAgICBuMiA9ICJjb21tZW50LWlubGluZSIsIHQyID0gdTIgLSAxOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIGNhc2UgInNpbmdsZS1xdW90ZXMiOgogICAgICAgICAgICAgICAgaWYgKHMyID09PSAiJyIgJiYgZTJbdTIgLSAxXSAhPT0gIlxcIiAmJiAobjIgPSByMiwgcjIgPSAiaW5pdGlhbCIpLCBzMiA9PT0gIlxuIiB8fCBzMiA9PT0gIlxyIikKICAgICAgICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgY2FzZSAiZG91YmxlLXF1b3RlcyI6CiAgICAgICAgICAgICAgICBpZiAoczIgPT09ICciJyAmJiBlMlt1MiAtIDFdICE9PSAiXFwiICYmIChuMiA9IHIyLCByMiA9ICJpbml0aWFsIiksIHMyID09PSAiXG4iIHx8IHMyID09PSAiXHIiKQogICAgICAgICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICBjYXNlICJ1cmwiOgogICAgICAgICAgICAgICAgaWYgKHMyID09PSAiKSIgJiYgKG4yID0gImluaXRpYWwiKSwgczIgPT09ICJcbiIgfHwgczIgPT09ICJcciIpCiAgICAgICAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICAgICAgICAgIGlmIChzMiA9PT0gIiciKSB7CiAgICAgICAgICAgICAgICAgIG4yID0gInNpbmdsZS1xdW90ZXMiLCByMiA9ICJ1cmwiOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzMiA9PT0gJyInKSB7CiAgICAgICAgICAgICAgICAgIG4yID0gImRvdWJsZS1xdW90ZXMiLCByMiA9ICJ1cmwiOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIGNhc2UgImNvbW1lbnQtYmxvY2siOgogICAgICAgICAgICAgICAgczIgPT09ICIvIiAmJiBlMlt1MiAtIDFdID09PSAiKiIgJiYgKG4yID0gImluaXRpYWwiKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIGNhc2UgImNvbW1lbnQtaW5saW5lIjoKICAgICAgICAgICAgICAgIHMyICE9PSAnIicgJiYgczIgIT09ICInIiAmJiBzMiAhPT0gIioiIHx8IChvMiA9IHRydWUpLCBzMiAhPT0gIlxuIiAmJiBzMiAhPT0gIlxyIiB8fCAobzIgJiYgaTIucHVzaChbdDIsIHUyXSksIG4yID0gImluaXRpYWwiLCBvMiA9IGZhbHNlKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGNvbnN0IFt0MywgbjNdIG9mIGkyKQogICAgICAgICAgICBlMiA9IGUyLnNsaWNlKDAsIHQzKSArIGUyLnNsaWNlKHQzLCBuMykucmVwbGFjZSgvWyInKl0vZywgIiAiKSArIGUyLnNsaWNlKG4zKTsKICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgRV8gPSBhdSwgeyBwcmludE51bWJlcjogQ18sIHByaW50U3RyaW5nOiBiXywgaGFzTmV3bGluZTogdl8sIGlzRnJvbnRNYXR0ZXJOb2RlOiBBXywgaXNOZXh0TGluZUVtcHR5OiBGXywgaXNOb25FbXB0eUFycmF5OiB4XyB9ID0gZGMsIHsgYnVpbGRlcnM6IHsgam9pbjogU18sIGxpbmU6IHdfLCBoYXJkbGluZTogVF8sIHNvZnRsaW5lOiBCXywgZ3JvdXA6IE5fLCBmaWxsOiBrXywgaW5kZW50OiBQXywgZGVkZW50OiBPXywgaWZCcmVhazogSV8sIGJyZWFrUGFyZW50OiBMXyB9LCB1dGlsczogeyByZW1vdmVMaW5lczogal8sIGdldERvY1BhcnRzOiBfXyB9IH0gPSBaYywgTV8gPSBSaiwgUl8gPSB6aiwgeyBpbnNlcnRQcmFnbWE6IFZfIH0gPSBZaiwgeyBnZXRBbmNlc3Rvck5vZGU6ICRfLCBnZXRQcm9wT2ZEZWNsTm9kZTogV18sIG1heWJlVG9Mb3dlckNhc2U6IHFfLCBpbnNpZGVWYWx1ZUZ1bmN0aW9uTm9kZTogVV8sIGluc2lkZUlDU1NSdWxlTm9kZTogel8sIGluc2lkZUF0UnVsZU5vZGU6IEdfLCBpbnNpZGVVUkxGdW5jdGlvbkluSW1wb3J0QXRSdWxlTm9kZTogSF8sIGlzS2V5ZnJhbWVBdFJ1bGVLZXl3b3JkczogSl8sIGlzV2lkZUtleXdvcmRzOiBYXywgaXNTQ1NTOiBZXywgaXNMYXN0Tm9kZTogS18sIGlzTGVzc1BhcnNlcjogUV8sIGlzU0NTU0NvbnRyb2xEaXJlY3RpdmVOb2RlOiBaXywgaXNEZXRhY2hlZFJ1bGVzZXREZWNsYXJhdGlvbk5vZGU6IGVNLCBpc1JlbGF0aW9uYWxPcGVyYXRvck5vZGU6IHRNLCBpc0VxdWFsaXR5T3BlcmF0b3JOb2RlOiBuTSwgaXNNdWx0aXBsaWNhdGlvbk5vZGU6IHJNLCBpc0RpdmlzaW9uTm9kZTogb00sIGlzQWRkaXRpb25Ob2RlOiBpTSwgaXNTdWJ0cmFjdGlvbk5vZGU6IHVNLCBpc01hdGhPcGVyYXRvck5vZGU6IHNNLCBpc0VhY2hLZXl3b3JkTm9kZTogYU0sIGlzRm9yS2V5d29yZE5vZGU6IGNNLCBpc1VSTEZ1bmN0aW9uTm9kZTogbE0sIGlzSWZFbHNlS2V5d29yZE5vZGU6IHBNLCBoYXNDb21wb3Nlc05vZGU6IGZNLCBoYXNQYXJlbnNBcm91bmROb2RlOiBkTSwgaGFzRW1wdHlSYXdCZWZvcmU6IGhNLCBpc0tleVZhbHVlUGFpck5vZGU6IGdNLCBpc0tleUluVmFsdWVQYWlyTm9kZTogbU0sIGlzRGV0YWNoZWRSdWxlc2V0Q2FsbE5vZGU6IHlNLCBpc1RlbXBsYXRlUGxhY2Vob2xkZXJOb2RlOiBETSwgaXNUZW1wbGF0ZVByb3BOb2RlOiBFTSwgaXNQb3N0Y3NzU2ltcGxlVmFyTm9kZTogQ00sIGlzU0NTU01hcEl0ZW1Ob2RlOiBiTSwgaXNJbmxpbmVWYWx1ZUNvbW1lbnROb2RlOiB2TSwgaXNIYXNoTm9kZTogQU0sIGlzTGVmdEN1cmx5QnJhY2VOb2RlOiBGTSwgaXNSaWdodEN1cmx5QnJhY2VOb2RlOiB4TSwgaXNXb3JkTm9kZTogU00sIGlzQ29sb25Ob2RlOiB3TSwgaXNNZWRpYUFuZFN1cHBvcnRzS2V5d29yZHM6IFRNLCBpc0NvbG9yQWRqdXN0ZXJGdW5jTm9kZTogQk0sIGxhc3RMaW5lSGFzSW5saW5lQ29tbWVudDogTk0sIGlzQXRXb3JkUGxhY2Vob2xkZXJOb2RlOiBrTSwgaXNDb25maWd1cmF0aW9uTm9kZTogUE0sIGlzUGFyZW5Hcm91cE5vZGU6IE9NIH0gPSBsXywgeyBsb2NTdGFydDogSU0sIGxvY0VuZDogTE0gfSA9IERfOwogICAgICAgIGZ1bmN0aW9uIGpNKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHJhaWxpbmdDb21tYSA9PT0gImVzNSIgfHwgZTIudHJhaWxpbmdDb21tYSA9PT0gImFsbCI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIF9NKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gW107CiAgICAgICAgICByZXR1cm4gZTIuZWFjaCgoZTMsIG8yLCBpMikgPT4gewogICAgICAgICAgICBjb25zdCB1MiA9IGkyW28yIC0gMV07CiAgICAgICAgICAgIGlmICh1MiAmJiB1Mi50eXBlID09PSAiY3NzLWNvbW1lbnQiICYmIHUyLnRleHQudHJpbSgpID09PSAicHJldHRpZXItaWdub3JlIikgewogICAgICAgICAgICAgIGNvbnN0IG4zID0gZTMuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICByMi5wdXNoKHQyLm9yaWdpbmFsVGV4dC5zbGljZShJTShuMyksIExNKG4zKSkpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICByMi5wdXNoKG4yKCkpOwogICAgICAgICAgICBvMiAhPT0gaTIubGVuZ3RoIC0gMSAmJiAoaTJbbzIgKyAxXS50eXBlID09PSAiY3NzLWNvbW1lbnQiICYmICF2Xyh0Mi5vcmlnaW5hbFRleHQsIElNKGkyW28yICsgMV0pLCB7IGJhY2t3YXJkczogdHJ1ZSB9KSAmJiAhQV8oaTJbbzJdKSB8fCBpMltvMiArIDFdLnR5cGUgPT09ICJjc3MtYXRydWxlIiAmJiBpMltvMiArIDFdLm5hbWUgPT09ICJlbHNlIiAmJiBpMltvMl0udHlwZSAhPT0gImNzcy1jb21tZW50IiA/IHIyLnB1c2goIiAiKSA6IChyMi5wdXNoKHQyLl9faXNIVE1MU3R5bGVBdHRyaWJ1dGUgPyB3XyA6IFRfKSwgRl8odDIub3JpZ2luYWxUZXh0LCBlMy5nZXRWYWx1ZSgpLCBMTSkgJiYgIUFfKGkyW28yXSkgJiYgcjIucHVzaChUXykpKTsKICAgICAgICAgIH0sICJub2RlcyIpLCByMjsKICAgICAgICB9CiAgICAgICAgY29uc3QgTU0gPSAvKFsiJ10pKD86KD8hXDEpW15cXF18XFwuKSpcMS9ncywgUk0gPSBuZXcgUmVnRXhwKE1NLnNvdXJjZSArICJ8IiArICIoIi5jb25jYXQoL1skQF0/W0EtWl9hLXpcdTAwODAtXHVGRkZGXVtcd1x1MDA4MC1cdUZGRkYtXSovZy5zb3VyY2UsICIpPyIpICsgIigiLmNvbmNhdCgvKD86XGQqXC5cZCt8XGQrXC4/KSg/OltFZV1bKy1dP1xkKyk/L2cuc291cmNlLCAiKSIpICsgIigiLmNvbmNhdCgvW0EtWmEtel0rL2cuc291cmNlLCAiKT8iKSwgImciKTsKICAgICAgICBmdW5jdGlvbiBWTShlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBlMi5yZXBsYWNlKE1NLCAoZTMpID0+IGJfKGUzLCB0MikpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiAkTShlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gdDIuc2luZ2xlUXVvdGUgPyAiJyIgOiAnIic7CiAgICAgICAgICByZXR1cm4gZTIuaW5jbHVkZXMoJyInKSB8fCBlMi5pbmNsdWRlcygiJyIpID8gZTIgOiBuMiArIGUyICsgbjI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFdNKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIucmVwbGFjZShSTSwgKGUzLCB0MiwgbjIsIHIyLCBvMikgPT4gIW4yICYmIHIyID8gcU0ocjIpICsgcV8obzIgfHwgIiIpIDogZTMpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBxTShlMikgewogICAgICAgICAgcmV0dXJuIENfKGUyKS5yZXBsYWNlKC9cLjAoPz0kfGUpLywgIiIpOwogICAgICAgIH0KICAgICAgICB2YXIgVU0gPSB7IHByaW50OiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBpZiAoIXIyKQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICBpZiAodHlwZW9mIHIyID09ICJzdHJpbmciKQogICAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgICBzd2l0Y2ggKHIyLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiZnJvbnQtbWF0dGVyIjoKICAgICAgICAgICAgICByZXR1cm4gW3IyLnJhdywgVF9dOwogICAgICAgICAgICBjYXNlICJjc3Mtcm9vdCI6IHsKICAgICAgICAgICAgICBjb25zdCBvMiA9IF9NKGUyLCB0MiwgbjIpLCBpMiA9IHIyLnJhd3MuYWZ0ZXIudHJpbSgpOwogICAgICAgICAgICAgIHJldHVybiBbbzIsIGkyID8gIiAiLmNvbmNhdChpMikgOiAiIiwgX18obzIpLmxlbmd0aCA+IDAgPyBUXyA6ICIiXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjc3MtY29tbWVudCI6IHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IHIyLmlubGluZSB8fCByMi5yYXdzLmlubGluZSwgbjMgPSB0Mi5vcmlnaW5hbFRleHQuc2xpY2UoSU0ocjIpLCBMTShyMikpOwogICAgICAgICAgICAgIHJldHVybiBlMyA/IG4zLnRyaW1FbmQoKSA6IG4zOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNzcy1ydWxlIjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJzZWxlY3RvciIpLCByMi5pbXBvcnRhbnQgPyAiICFpbXBvcnRhbnQiIDogIiIsIHIyLm5vZGVzID8gW3IyLnNlbGVjdG9yICYmIHIyLnNlbGVjdG9yLnR5cGUgPT09ICJzZWxlY3Rvci11bmtub3duIiAmJiBOTShyMi5zZWxlY3Rvci52YWx1ZSkgPyB3XyA6ICIgIiwgInsiLCByMi5ub2Rlcy5sZW5ndGggPiAwID8gUF8oW1RfLCBfTShlMiwgdDIsIG4yKV0pIDogIiIsIFRfLCAifSIsIGVNKHIyKSA/ICI7IiA6ICIiXSA6ICI7Il07CiAgICAgICAgICAgIGNhc2UgImNzcy1kZWNsIjogewogICAgICAgICAgICAgIGNvbnN0IG8yID0gZTIuZ2V0UGFyZW50Tm9kZSgpLCB7IGJldHdlZW46IGkyIH0gPSByMi5yYXdzLCB1MiA9IGkyLnRyaW0oKSwgczIgPSB1MiA9PT0gIjoiOwogICAgICAgICAgICAgIGxldCBhMiA9IGZNKHIyKSA/IGpfKG4yKCJ2YWx1ZSIpKSA6IG4yKCJ2YWx1ZSIpOwogICAgICAgICAgICAgIHJldHVybiAhczIgJiYgTk0odTIpICYmIChhMiA9IFBfKFtUXywgT18oYTIpXSkpLCBbcjIucmF3cy5iZWZvcmUucmVwbGFjZSgvW1xzO10vZywgIiIpLCB6XyhlMikgPyByMi5wcm9wIDogcV8ocjIucHJvcCksIHUyLnN0YXJ0c1dpdGgoIi8vIikgPyAiICIgOiAiIiwgdTIsIHIyLmV4dGVuZCA/ICIiIDogIiAiLCBRXyh0MikgJiYgcjIuZXh0ZW5kICYmIHIyLnNlbGVjdG9yID8gWyJleHRlbmQoIiwgbjIoInNlbGVjdG9yIiksICIpIl0gOiAiIiwgYTIsIHIyLnJhd3MuaW1wb3J0YW50ID8gcjIucmF3cy5pbXBvcnRhbnQucmVwbGFjZSgvXHMqIVxzKmltcG9ydGFudC9pLCAiICFpbXBvcnRhbnQiKSA6IHIyLmltcG9ydGFudCA/ICIgIWltcG9ydGFudCIgOiAiIiwgcjIucmF3cy5zY3NzRGVmYXVsdCA/IHIyLnJhd3Muc2Nzc0RlZmF1bHQucmVwbGFjZSgvXHMqIWRlZmF1bHQvaSwgIiAhZGVmYXVsdCIpIDogcjIuc2Nzc0RlZmF1bHQgPyAiICFkZWZhdWx0IiA6ICIiLCByMi5yYXdzLnNjc3NHbG9iYWwgPyByMi5yYXdzLnNjc3NHbG9iYWwucmVwbGFjZSgvXHMqIWdsb2JhbC9pLCAiICFnbG9iYWwiKSA6IHIyLnNjc3NHbG9iYWwgPyAiICFnbG9iYWwiIDogIiIsIHIyLm5vZGVzID8gWyIgeyIsIFBfKFtCXywgX00oZTIsIHQyLCBuMildKSwgQl8sICJ9Il0gOiBFTShyMikgJiYgIW8yLnJhd3Muc2VtaWNvbG9uICYmIHQyLm9yaWdpbmFsVGV4dFtMTShyMikgLSAxXSAhPT0gIjsiID8gIiIgOiB0Mi5fX2lzSFRNTFN0eWxlQXR0cmlidXRlICYmIEtfKGUyLCByMikgPyBJXygiOyIpIDogIjsiXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjc3MtYXRydWxlIjogewogICAgICAgICAgICAgIGNvbnN0IG8yID0gZTIuZ2V0UGFyZW50Tm9kZSgpLCBpMiA9IERNKHIyKSAmJiAhbzIucmF3cy5zZW1pY29sb24gJiYgdDIub3JpZ2luYWxUZXh0W0xNKHIyKSAtIDFdICE9PSAiOyI7CiAgICAgICAgICAgICAgaWYgKFFfKHQyKSkgewogICAgICAgICAgICAgICAgaWYgKHIyLm1peGluKQogICAgICAgICAgICAgICAgICByZXR1cm4gW24yKCJzZWxlY3RvciIpLCByMi5pbXBvcnRhbnQgPyAiICFpbXBvcnRhbnQiIDogIiIsIGkyID8gIiIgOiAiOyJdOwogICAgICAgICAgICAgICAgaWYgKHIyLmZ1bmN0aW9uKQogICAgICAgICAgICAgICAgICByZXR1cm4gW3IyLm5hbWUsIG4yKCJwYXJhbXMiKSwgaTIgPyAiIiA6ICI7Il07CiAgICAgICAgICAgICAgICBpZiAocjIudmFyaWFibGUpCiAgICAgICAgICAgICAgICAgIHJldHVybiBbIkAiLCByMi5uYW1lLCAiOiAiLCByMi52YWx1ZSA/IG4yKCJ2YWx1ZSIpIDogIiIsIHIyLnJhd3MuYmV0d2Vlbi50cmltKCkgPyByMi5yYXdzLmJldHdlZW4udHJpbSgpICsgIiAiIDogIiIsIHIyLm5vZGVzID8gWyJ7IiwgUF8oW3IyLm5vZGVzLmxlbmd0aCA+IDAgPyBCXyA6ICIiLCBfTShlMiwgdDIsIG4yKV0pLCBCXywgIn0iXSA6ICIiLCBpMiA/ICIiIDogIjsiXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIFsiQCIsIHlNKHIyKSB8fCByMi5uYW1lLmVuZHNXaXRoKCI6IikgPyByMi5uYW1lIDogcV8ocjIubmFtZSksIHIyLnBhcmFtcyA/IFt5TShyMikgPyAiIiA6IERNKHIyKSA/IHIyLnJhd3MuYWZ0ZXJOYW1lID09PSAiIiA/ICIiIDogcjIubmFtZS5lbmRzV2l0aCgiOiIpID8gIiAiIDogL15ccypcblxzKlxuLy50ZXN0KHIyLnJhd3MuYWZ0ZXJOYW1lKSA/IFtUXywgVF9dIDogL15ccypcbi8udGVzdChyMi5yYXdzLmFmdGVyTmFtZSkgPyBUXyA6ICIgIiA6ICIgIiwgbjIoInBhcmFtcyIpXSA6ICIiLCByMi5zZWxlY3RvciA/IFBfKFsiICIsIG4yKCJzZWxlY3RvciIpXSkgOiAiIiwgcjIudmFsdWUgPyBOXyhbIiAiLCBuMigidmFsdWUiKSwgWl8ocjIpID8gZE0ocjIpID8gIiAiIDogd18gOiAiIl0pIDogcjIubmFtZSA9PT0gImVsc2UiID8gIiAiIDogIiIsIHIyLm5vZGVzID8gW1pfKHIyKSA/ICIiIDogcjIuc2VsZWN0b3IgJiYgIXIyLnNlbGVjdG9yLm5vZGVzICYmIHR5cGVvZiByMi5zZWxlY3Rvci52YWx1ZSA9PSAic3RyaW5nIiAmJiBOTShyMi5zZWxlY3Rvci52YWx1ZSkgfHwgIXIyLnNlbGVjdG9yICYmIHR5cGVvZiByMi5wYXJhbXMgPT0gInN0cmluZyIgJiYgTk0ocjIucGFyYW1zKSA/IHdfIDogIiAiLCAieyIsIFBfKFtyMi5ub2Rlcy5sZW5ndGggPiAwID8gQl8gOiAiIiwgX00oZTIsIHQyLCBuMildKSwgQl8sICJ9Il0gOiBpMiA/ICIiIDogIjsiXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJtZWRpYS1xdWVyeS1saXN0IjogewogICAgICAgICAgICAgIGNvbnN0IHQzID0gW107CiAgICAgICAgICAgICAgcmV0dXJuIGUyLmVhY2goKGUzKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCByMyA9IGUzLmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICByMy50eXBlID09PSAibWVkaWEtcXVlcnkiICYmIHIzLnZhbHVlID09PSAiIiB8fCB0My5wdXNoKG4yKCkpOwogICAgICAgICAgICAgIH0sICJub2RlcyIpLCBOXyhQXyhTXyh3XywgdDMpKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAibWVkaWEtcXVlcnkiOgogICAgICAgICAgICAgIHJldHVybiBbU18oIiAiLCBlMi5tYXAobjIsICJub2RlcyIpKSwgS18oZTIsIHIyKSA/ICIiIDogIiwiXTsKICAgICAgICAgICAgY2FzZSAibWVkaWEtdHlwZSI6CiAgICAgICAgICAgIGNhc2UgIm1lZGlhLXZhbHVlIjoKICAgICAgICAgICAgICByZXR1cm4gV00oVk0ocjIudmFsdWUsIHQyKSk7CiAgICAgICAgICAgIGNhc2UgIm1lZGlhLWZlYXR1cmUtZXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHIyLm5vZGVzID8gWyIoIiwgLi4uZTIubWFwKG4yLCAibm9kZXMiKSwgIikiXSA6IHIyLnZhbHVlOwogICAgICAgICAgICBjYXNlICJtZWRpYS1mZWF0dXJlIjoKICAgICAgICAgICAgICByZXR1cm4gcV8oVk0ocjIudmFsdWUucmVwbGFjZSgvICsvZywgIiAiKSwgdDIpKTsKICAgICAgICAgICAgY2FzZSAibWVkaWEtY29sb24iOgogICAgICAgICAgICBjYXNlICJ2YWx1ZS1jb21tYSI6CiAgICAgICAgICAgICAgcmV0dXJuIFtyMi52YWx1ZSwgIiAiXTsKICAgICAgICAgICAgY2FzZSAibWVkaWEta2V5d29yZCI6CiAgICAgICAgICAgIGNhc2UgInNlbGVjdG9yLXN0cmluZyI6CiAgICAgICAgICAgICAgcmV0dXJuIFZNKHIyLnZhbHVlLCB0Mik7CiAgICAgICAgICAgIGNhc2UgIm1lZGlhLXVybCI6CiAgICAgICAgICAgICAgcmV0dXJuIFZNKHIyLnZhbHVlLnJlcGxhY2UoL151cmxcKFxzKy9naSwgInVybCgiKS5yZXBsYWNlKC9ccytcKSQvZywgIikiKSwgdDIpOwogICAgICAgICAgICBjYXNlICJtZWRpYS11bmtub3duIjoKICAgICAgICAgICAgY2FzZSAic2VsZWN0b3ItY29tbWVudCI6CiAgICAgICAgICAgIGNhc2UgInNlbGVjdG9yLW5lc3RpbmciOgogICAgICAgICAgICBjYXNlICJ2YWx1ZS1wYXJlbiI6CiAgICAgICAgICAgIGNhc2UgInZhbHVlLW9wZXJhdG9yIjoKICAgICAgICAgICAgY2FzZSAidmFsdWUtdW5pY29kZS1yYW5nZSI6CiAgICAgICAgICAgIGNhc2UgInZhbHVlLXVua25vd24iOgogICAgICAgICAgICAgIHJldHVybiByMi52YWx1ZTsKICAgICAgICAgICAgY2FzZSAic2VsZWN0b3Itcm9vdCI6CiAgICAgICAgICAgICAgcmV0dXJuIE5fKFtHXyhlMiwgImN1c3RvbS1zZWxlY3RvciIpID8gWyRfKGUyLCAiY3NzLWF0cnVsZSIpLmN1c3RvbVNlbGVjdG9yLCB3X10gOiAiIiwgU18oWyIsIiwgR18oZTIsIFsiZXh0ZW5kIiwgImN1c3RvbS1zZWxlY3RvciIsICJuZXN0Il0pID8gd18gOiBUX10sIGUyLm1hcChuMiwgIm5vZGVzIikpXSk7CiAgICAgICAgICAgIGNhc2UgInNlbGVjdG9yLXNlbGVjdG9yIjoKICAgICAgICAgICAgICByZXR1cm4gTl8oUF8oZTIubWFwKG4yLCAibm9kZXMiKSkpOwogICAgICAgICAgICBjYXNlICJzZWxlY3Rvci10YWciOiB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSBlMi5nZXRQYXJlbnROb2RlKCksIG4zID0gdDMgJiYgdDMubm9kZXMuaW5kZXhPZihyMiksIG8yID0gbjMgJiYgdDMubm9kZXNbbjMgLSAxXTsKICAgICAgICAgICAgICByZXR1cm4gW3IyLm5hbWVzcGFjZSA/IFtyMi5uYW1lc3BhY2UgPT09IHRydWUgPyAiIiA6IHIyLm5hbWVzcGFjZS50cmltKCksICJ8Il0gOiAiIiwgbzIudHlwZSA9PT0gInNlbGVjdG9yLW5lc3RpbmciID8gcjIudmFsdWUgOiBXTShKXyhlMiwgcjIudmFsdWUpID8gcjIudmFsdWUudG9Mb3dlckNhc2UoKSA6IHIyLnZhbHVlKV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAic2VsZWN0b3ItaWQiOgogICAgICAgICAgICAgIHJldHVybiBbIiMiLCByMi52YWx1ZV07CiAgICAgICAgICAgIGNhc2UgInNlbGVjdG9yLWNsYXNzIjoKICAgICAgICAgICAgICByZXR1cm4gWyIuIiwgV00oVk0ocjIudmFsdWUsIHQyKSldOwogICAgICAgICAgICBjYXNlICJzZWxlY3Rvci1hdHRyaWJ1dGUiOgogICAgICAgICAgICAgIHJldHVybiBbIlsiLCByMi5uYW1lc3BhY2UgPyBbcjIubmFtZXNwYWNlID09PSB0cnVlID8gIiIgOiByMi5uYW1lc3BhY2UudHJpbSgpLCAifCJdIDogIiIsIHIyLmF0dHJpYnV0ZS50cmltKCksIHIyLm9wZXJhdG9yID8gcjIub3BlcmF0b3IgOiAiIiwgcjIudmFsdWUgPyAkTShWTShyMi52YWx1ZS50cmltKCksIHQyKSwgdDIpIDogIiIsIHIyLmluc2Vuc2l0aXZlID8gIiBpIiA6ICIiLCAiXSJdOwogICAgICAgICAgICBjYXNlICJzZWxlY3Rvci1jb21iaW5hdG9yIjoKICAgICAgICAgICAgICBpZiAocjIudmFsdWUgPT09ICIrIiB8fCByMi52YWx1ZSA9PT0gIj4iIHx8IHIyLnZhbHVlID09PSAifiIgfHwgcjIudmFsdWUgPT09ICI+Pj4iKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IGUyLmdldFBhcmVudE5vZGUoKTsKICAgICAgICAgICAgICAgIHJldHVybiBbdDMudHlwZSA9PT0gInNlbGVjdG9yLXNlbGVjdG9yIiAmJiB0My5ub2Rlc1swXSA9PT0gcjIgPyAiIiA6IHdfLCByMi52YWx1ZSwgS18oZTIsIHIyKSA/ICIiIDogIiAiXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIFtyMi52YWx1ZS50cmltKCkuc3RhcnRzV2l0aCgiKCIpID8gd18gOiAiIiwgV00oVk0ocjIudmFsdWUudHJpbSgpLCB0MikpIHx8IHdfXTsKICAgICAgICAgICAgY2FzZSAic2VsZWN0b3ItdW5pdmVyc2FsIjoKICAgICAgICAgICAgICByZXR1cm4gW3IyLm5hbWVzcGFjZSA/IFtyMi5uYW1lc3BhY2UgPT09IHRydWUgPyAiIiA6IHIyLm5hbWVzcGFjZS50cmltKCksICJ8Il0gOiAiIiwgcjIudmFsdWVdOwogICAgICAgICAgICBjYXNlICJzZWxlY3Rvci1wc2V1ZG8iOgogICAgICAgICAgICAgIHJldHVybiBbcV8ocjIudmFsdWUpLCB4XyhyMi5ub2RlcykgPyBbIigiLCBTXygiLCAiLCBlMi5tYXAobjIsICJub2RlcyIpKSwgIikiXSA6ICIiXTsKICAgICAgICAgICAgY2FzZSAic2VsZWN0b3ItdW5rbm93biI6IHsKICAgICAgICAgICAgICBjb25zdCBuMyA9ICRfKGUyLCAiY3NzLXJ1bGUiKTsKICAgICAgICAgICAgICBpZiAobjMgJiYgbjMuaXNTQ1NTTmVzdGVyUHJvcGVydHkpCiAgICAgICAgICAgICAgICByZXR1cm4gV00oVk0ocV8ocjIudmFsdWUpLCB0MikpOwogICAgICAgICAgICAgIGNvbnN0IG8yID0gZTIuZ2V0UGFyZW50Tm9kZSgpOwogICAgICAgICAgICAgIGlmIChvMi5yYXdzICYmIG8yLnJhd3Muc2VsZWN0b3IpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGUzID0gSU0obzIpLCBuNCA9IGUzICsgbzIucmF3cy5zZWxlY3Rvci5sZW5ndGg7CiAgICAgICAgICAgICAgICByZXR1cm4gdDIub3JpZ2luYWxUZXh0LnNsaWNlKGUzLCBuNCkudHJpbSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBpMiA9IGUyLmdldFBhcmVudE5vZGUoMSk7CiAgICAgICAgICAgICAgaWYgKG8yLnR5cGUgPT09ICJ2YWx1ZS1wYXJlbl9ncm91cCIgJiYgaTIgJiYgaTIudHlwZSA9PT0gInZhbHVlLWZ1bmMiICYmIGkyLnZhbHVlID09PSAic2VsZWN0b3IiKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlMyA9IElNKG8yLm9wZW4pICsgMSwgbjQgPSBMTShvMi5jbG9zZSkgLSAxLCByMyA9IHQyLm9yaWdpbmFsVGV4dC5zbGljZShlMywgbjQpLnRyaW0oKTsKICAgICAgICAgICAgICAgIHJldHVybiBOTShyMykgPyBbTF8sIHIzXSA6IHIzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gcjIudmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAidmFsdWUtdmFsdWUiOgogICAgICAgICAgICBjYXNlICJ2YWx1ZS1yb290IjoKICAgICAgICAgICAgICByZXR1cm4gbjIoImdyb3VwIik7CiAgICAgICAgICAgIGNhc2UgInZhbHVlLWNvbW1lbnQiOgogICAgICAgICAgICAgIHJldHVybiB0Mi5vcmlnaW5hbFRleHQuc2xpY2UoSU0ocjIpLCBMTShyMikpOwogICAgICAgICAgICBjYXNlICJ2YWx1ZS1jb21tYV9ncm91cCI6IHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IGUyLmdldFBhcmVudE5vZGUoKSwgbzIgPSBlMi5nZXRQYXJlbnROb2RlKDEpLCBpMiA9IFdfKGUyKSwgdTIgPSBpMiAmJiB0My50eXBlID09PSAidmFsdWUtdmFsdWUiICYmIChpMiA9PT0gImdyaWQiIHx8IGkyLnN0YXJ0c1dpdGgoImdyaWQtdGVtcGxhdGUiKSksIHMyID0gJF8oZTIsICJjc3MtYXRydWxlIiksIGEyID0gczIgJiYgWl8oczIpLCBjMiA9IHIyLmdyb3Vwcy5zb21lKChlMykgPT4gdk0oZTMpKSwgbDIgPSBlMi5tYXAobjIsICJncm91cHMiKSwgcDIgPSBbXSwgZjIgPSBVXyhlMiwgInVybCIpOwogICAgICAgICAgICAgIGxldCBkMiA9IGZhbHNlLCBoMiA9IGZhbHNlOwogICAgICAgICAgICAgIGZvciAobGV0IG4zID0gMDsgbjMgPCByMi5ncm91cHMubGVuZ3RoOyArK24zKSB7CiAgICAgICAgICAgICAgICBwMi5wdXNoKGwyW24zXSk7CiAgICAgICAgICAgICAgICBjb25zdCBpMyA9IHIyLmdyb3Vwc1tuMyAtIDFdLCBjMyA9IHIyLmdyb3Vwc1tuM10sIGcyID0gcjIuZ3JvdXBzW24zICsgMV0sIG0yID0gcjIuZ3JvdXBzW24zICsgMl07CiAgICAgICAgICAgICAgICBpZiAoZjIpIHsKICAgICAgICAgICAgICAgICAgKGcyICYmIGlNKGcyKSB8fCBpTShjMykpICYmIHAyLnB1c2goIiAiKTsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoR18oZTIsICJmb3J3YXJkIikgJiYgYzMudHlwZSA9PT0gInZhbHVlLXdvcmQiICYmIGMzLnZhbHVlICYmIGkzICE9PSB2b2lkIDAgJiYgaTMudHlwZSA9PT0gInZhbHVlLXdvcmQiICYmIGkzLnZhbHVlID09PSAiYXMiICYmIGcyLnR5cGUgPT09ICJ2YWx1ZS1vcGVyYXRvciIgJiYgZzIudmFsdWUgPT09ICIqIikKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAoIWcyKQogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChjMy50eXBlID09PSAidmFsdWUtd29yZCIgJiYgYzMudmFsdWUuZW5kc1dpdGgoIi0iKSAmJiBrTShnMikpCiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgY29uc3QgeTIgPSBjMy50eXBlID09PSAidmFsdWUtc3RyaW5nIiAmJiBjMy52YWx1ZS5zdGFydHNXaXRoKCIjeyIpLCBEMiA9IGQyICYmIGcyLnR5cGUgPT09ICJ2YWx1ZS1zdHJpbmciICYmIGcyLnZhbHVlLmVuZHNXaXRoKCJ9Iik7CiAgICAgICAgICAgICAgICBpZiAoeTIgfHwgRDIpIHsKICAgICAgICAgICAgICAgICAgZDIgPSAhZDI7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGQyKQogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmICh3TShjMykgfHwgd00oZzIpKQogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChjMy50eXBlID09PSAidmFsdWUtYXR3b3JkIiAmJiBjMy52YWx1ZSA9PT0gIiIpCiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKGMzLnZhbHVlID09PSAifiIpCiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKGMzLnZhbHVlICYmIGMzLnZhbHVlLmluY2x1ZGVzKCJcXCIpICYmIGcyICYmIGcyLnR5cGUgIT09ICJ2YWx1ZS1jb21tZW50IikKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAoaTMgJiYgaTMudmFsdWUgJiYgaTMudmFsdWUuaW5kZXhPZigiXFwiKSA9PT0gaTMudmFsdWUubGVuZ3RoIC0gMSAmJiBjMy50eXBlID09PSAidmFsdWUtb3BlcmF0b3IiICYmIGMzLnZhbHVlID09PSAiLyIpCiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKGMzLnZhbHVlID09PSAiXFwiKQogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChDTShjMywgZzIpKQogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChBTShjMykgfHwgRk0oYzMpIHx8IHhNKGcyKSB8fCBGTShnMikgJiYgaE0oZzIpIHx8IHhNKGMzKSAmJiBoTShnMikpCiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKGMzLnZhbHVlID09PSAiLS0iICYmIEFNKGcyKSkKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBjb25zdCBFMiA9IHNNKGMzKSwgQzIgPSBzTShnMik7CiAgICAgICAgICAgICAgICBpZiAoKEUyICYmIEFNKGcyKSB8fCBDMiAmJiB4TShjMykpICYmIGhNKGcyKSkKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAoIWkzICYmIG9NKGMzKSkKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAoVV8oZTIsICJjYWxjIikgJiYgKGlNKGMzKSB8fCBpTShnMikgfHwgdU0oYzMpIHx8IHVNKGcyKSkgJiYgaE0oZzIpKQogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGIyID0gKGlNKGMzKSB8fCB1TShjMykpICYmIG4zID09PSAwICYmIChnMi50eXBlID09PSAidmFsdWUtbnVtYmVyIiB8fCBnMi5pc0hleCkgJiYgbzIgJiYgQk0obzIpICYmICFoTShnMiksIHYyID0gbTIgJiYgbTIudHlwZSA9PT0gInZhbHVlLWZ1bmMiIHx8IG0yICYmIFNNKG0yKSB8fCBjMy50eXBlID09PSAidmFsdWUtZnVuYyIgfHwgU00oYzMpLCBBMiA9IGcyLnR5cGUgPT09ICJ2YWx1ZS1mdW5jIiB8fCBTTShnMikgfHwgaTMgJiYgaTMudHlwZSA9PT0gInZhbHVlLWZ1bmMiIHx8IGkzICYmIFNNKGkzKTsKICAgICAgICAgICAgICAgIGlmIChyTShnMikgfHwgck0oYzMpIHx8IFVfKGUyLCAiY2FsYyIpIHx8IGIyIHx8ICEob00oZzIpICYmICF2MiB8fCBvTShjMykgJiYgIUEyIHx8IGlNKGcyKSAmJiAhdjIgfHwgaU0oYzMpICYmICFBMiB8fCB1TShnMikgfHwgdU0oYzMpKSB8fCAhKGhNKGcyKSB8fCBFMiAmJiAoIWkzIHx8IGkzICYmIHNNKGkzKSkpKQogICAgICAgICAgICAgICAgICBpZiAodk0oYzMpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJ2YWx1ZS1wYXJlbl9ncm91cCIpIHsKICAgICAgICAgICAgICAgICAgICAgIHAyLnB1c2goT18oVF8pKTsKICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwMi5wdXNoKFRfKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgYTIgJiYgKG5NKGcyKSB8fCB0TShnMikgfHwgcE0oZzIpIHx8IGFNKGMzKSB8fCBjTShjMykpIHx8IHMyICYmIHMyLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gIm5hbWVzcGFjZSIgPyBwMi5wdXNoKCIgIikgOiB1MiA/IGMzLnNvdXJjZSAmJiBnMi5zb3VyY2UgJiYgYzMuc291cmNlLnN0YXJ0LmxpbmUgIT09IGcyLnNvdXJjZS5zdGFydC5saW5lID8gKHAyLnB1c2goVF8pLCBoMiA9IHRydWUpIDogcDIucHVzaCgiICIpIDogQzIgPyBwMi5wdXNoKCIgIikgOiBnMiAmJiBnMi52YWx1ZSA9PT0gIi4uLiIgfHwga00oYzMpICYmIGtNKGcyKSAmJiBMTShjMykgPT09IElNKGcyKSB8fCAoa00oYzMpICYmIE9NKGcyKSAmJiBMTShjMykgPT09IElNKGcyLm9wZW4pID8gcDIucHVzaChCXykgOiBjMy52YWx1ZSA9PT0gIndpdGgiICYmIE9NKGcyKSA/IHAyLnB1c2goIiAiKSA6IHAyLnB1c2god18pKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGMyICYmIHAyLnB1c2goTF8pLCBoMiAmJiBwMi51bnNoaWZ0KFRfKSwgYTIgPyBOXyhQXyhwMikpIDogSF8oZTIpID8gTl8oa18ocDIpKSA6IE5fKFBfKGtfKHAyKSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgInZhbHVlLXBhcmVuX2dyb3VwIjogewogICAgICAgICAgICAgIGNvbnN0IG8yID0gZTIuZ2V0UGFyZW50Tm9kZSgpOwogICAgICAgICAgICAgIGlmIChvMiAmJiBsTShvMikgJiYgKHIyLmdyb3Vwcy5sZW5ndGggPT09IDEgfHwgcjIuZ3JvdXBzLmxlbmd0aCA+IDAgJiYgcjIuZ3JvdXBzWzBdLnR5cGUgPT09ICJ2YWx1ZS1jb21tYV9ncm91cCIgJiYgcjIuZ3JvdXBzWzBdLmdyb3Vwcy5sZW5ndGggPiAwICYmIHIyLmdyb3Vwc1swXS5ncm91cHNbMF0udHlwZSA9PT0gInZhbHVlLXdvcmQiICYmIHIyLmdyb3Vwc1swXS5ncm91cHNbMF0udmFsdWUuc3RhcnRzV2l0aCgiZGF0YToiKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gW3IyLm9wZW4gPyBuMigib3BlbiIpIDogIiIsIFNfKCIsIiwgZTIubWFwKG4yLCAiZ3JvdXBzIikpLCByMi5jbG9zZSA/IG4yKCJjbG9zZSIpIDogIiJdOwogICAgICAgICAgICAgIGlmICghcjIub3BlbikgewogICAgICAgICAgICAgICAgY29uc3QgdDMgPSBlMi5tYXAobjIsICJncm91cHMiKSwgcjMgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGUzID0gMDsgZTMgPCB0My5sZW5ndGg7IGUzKyspCiAgICAgICAgICAgICAgICAgIGUzICE9PSAwICYmIHIzLnB1c2goWyIsIiwgd19dKSwgcjMucHVzaCh0M1tlM10pOwogICAgICAgICAgICAgICAgcmV0dXJuIE5fKFBfKGtfKHIzKSkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBpMiA9IGJNKGUyKSwgdTIgPSBFXyhyMi5ncm91cHMpLCBzMiA9IHUyICYmIHUyLnR5cGUgPT09ICJ2YWx1ZS1jb21tZW50IiwgYTIgPSBtTShyMiwgbzIpLCBjMiA9IFBNKHIyLCBvMiksIGwyID0gYzIgfHwgaTIgJiYgIWEyLCBwMiA9IGMyIHx8IGEyLCBmMiA9IE5fKFtyMi5vcGVuID8gbjIoIm9wZW4iKSA6ICIiLCBQXyhbQl8sIFNfKFsiLCIsIHdfXSwgZTIubWFwKChlMykgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdDMgPSBlMy5nZXRWYWx1ZSgpLCByMyA9IG4yKCk7CiAgICAgICAgICAgICAgICBpZiAoZ00odDMpICYmIHQzLnR5cGUgPT09ICJ2YWx1ZS1jb21tYV9ncm91cCIgJiYgdDMuZ3JvdXBzICYmIHQzLmdyb3Vwc1swXS50eXBlICE9PSAidmFsdWUtcGFyZW5fZ3JvdXAiICYmIHQzLmdyb3Vwc1syXSAmJiB0My5ncm91cHNbMl0udHlwZSA9PT0gInZhbHVlLXBhcmVuX2dyb3VwIikgewogICAgICAgICAgICAgICAgICBjb25zdCBlNCA9IF9fKHIzLmNvbnRlbnRzLmNvbnRlbnRzKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGU0WzFdID0gTl8oZTRbMV0pLCBOXyhPXyhyMykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHIzOwogICAgICAgICAgICAgIH0sICJncm91cHMiKSldKSwgSV8oIXMyICYmIFlfKHQyLnBhcnNlciwgdDIub3JpZ2luYWxUZXh0KSAmJiBpMiAmJiBqTSh0MikgPyAiLCIgOiAiIiksIEJfLCByMi5jbG9zZSA/IG4yKCJjbG9zZSIpIDogIiJdLCB7IHNob3VsZEJyZWFrOiBsMiB9KTsKICAgICAgICAgICAgICByZXR1cm4gcDIgPyBPXyhmMikgOiBmMjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJ2YWx1ZS1mdW5jIjoKICAgICAgICAgICAgICByZXR1cm4gW3IyLnZhbHVlLCBHXyhlMiwgInN1cHBvcnRzIikgJiYgVE0ocjIpID8gIiAiIDogIiIsIG4yKCJncm91cCIpXTsKICAgICAgICAgICAgY2FzZSAidmFsdWUtbnVtYmVyIjoKICAgICAgICAgICAgICByZXR1cm4gW3FNKHIyLnZhbHVlKSwgcV8ocjIudW5pdCldOwogICAgICAgICAgICBjYXNlICJ2YWx1ZS13b3JkIjoKICAgICAgICAgICAgICByZXR1cm4gcjIuaXNDb2xvciAmJiByMi5pc0hleCB8fCBYXyhyMi52YWx1ZSkgPyByMi52YWx1ZS50b0xvd2VyQ2FzZSgpIDogcjIudmFsdWU7CiAgICAgICAgICAgIGNhc2UgInZhbHVlLWNvbG9uIjogewogICAgICAgICAgICAgIGNvbnN0IHQzID0gZTIuZ2V0UGFyZW50Tm9kZSgpLCBuMyA9IHQzICYmIHQzLmdyb3Vwcy5pbmRleE9mKHIyKSwgbzIgPSBuMyAmJiB0My5ncm91cHNbbjMgLSAxXTsKICAgICAgICAgICAgICByZXR1cm4gW3IyLnZhbHVlLCBvMiAmJiB0eXBlb2YgbzIudmFsdWUgPT0gInN0cmluZyIgJiYgRV8obzIudmFsdWUpID09PSAiXFwiIHx8IFVfKGUyLCAidXJsIikgPyAiIiA6IHdfXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJ2YWx1ZS1zdHJpbmciOgogICAgICAgICAgICAgIHJldHVybiBiXyhyMi5yYXdzLnF1b3RlICsgcjIudmFsdWUgKyByMi5yYXdzLnF1b3RlLCB0Mik7CiAgICAgICAgICAgIGNhc2UgInZhbHVlLWF0d29yZCI6CiAgICAgICAgICAgICAgcmV0dXJuIFsiQCIsIHIyLnZhbHVlXTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gcG9zdGNzcyB0eXBlICIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHIyLnR5cGUpKSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgZW1iZWQ6IFJfLCBpbnNlcnRQcmFnbWE6IFZfLCBtYXNzYWdlQXN0Tm9kZTogTV8gfTsKICAgICAgICB2YXIgek0gPSB7IG5hbWU6ICJQb3N0Q1NTIiwgdHlwZTogIm1hcmt1cCIsIHRtU2NvcGU6ICJzb3VyY2UucG9zdGNzcyIsIGdyb3VwOiAiQ1NTIiwgZXh0ZW5zaW9uczogWyIucGNzcyIsICIucG9zdGNzcyJdLCBhY2VNb2RlOiAidGV4dCIsIGxhbmd1YWdlSWQ6IDI2Mjc2NDQzNyB9LCBHTSA9IHsgbmFtZTogIkxlc3MiLCB0eXBlOiAibWFya3VwIiwgY29sb3I6ICIjMWQzNjVkIiwgZXh0ZW5zaW9uczogWyIubGVzcyJdLCB0bVNjb3BlOiAic291cmNlLmNzcy5sZXNzIiwgYWNlTW9kZTogImxlc3MiLCBjb2RlbWlycm9yTW9kZTogImNzcyIsIGNvZGVtaXJyb3JNaW1lVHlwZTogInRleHQvY3NzIiwgbGFuZ3VhZ2VJZDogMTk4IH0sIEhNID0geyBuYW1lOiAiU0NTUyIsIHR5cGU6ICJtYXJrdXAiLCBjb2xvcjogIiNjNjUzOGMiLCB0bVNjb3BlOiAic291cmNlLmNzcy5zY3NzIiwgYWNlTW9kZTogInNjc3MiLCBjb2RlbWlycm9yTW9kZTogImNzcyIsIGNvZGVtaXJyb3JNaW1lVHlwZTogInRleHQveC1zY3NzIiwgZXh0ZW5zaW9uczogWyIuc2NzcyJdLCBsYW5ndWFnZUlkOiAzMjkgfTsKICAgICAgICBjb25zdCBKTSA9IGJFLCBYTSA9IFVNLCBZTSA9IHsgc2luZ2xlUXVvdGU6IGJqLnNpbmdsZVF1b3RlIH0sIEtNID0gW0pNKHsgbmFtZTogIkNTUyIsIHR5cGU6ICJtYXJrdXAiLCB0bVNjb3BlOiAic291cmNlLmNzcyIsIGFjZU1vZGU6ICJjc3MiLCBjb2RlbWlycm9yTW9kZTogImNzcyIsIGNvZGVtaXJyb3JNaW1lVHlwZTogInRleHQvY3NzIiwgY29sb3I6ICIjNTYzZDdjIiwgZXh0ZW5zaW9uczogWyIuY3NzIl0sIGxhbmd1YWdlSWQ6IDUwIH0sIChlMikgPT4gKHsgc2luY2U6ICIxLjQuMCIsIHBhcnNlcnM6IFsiY3NzIl0sIHZzY29kZUxhbmd1YWdlSWRzOiBbImNzcyJdLCBleHRlbnNpb25zOiBbLi4uZTIuZXh0ZW5zaW9ucywgIi53eHNzIl0gfSkpLCBKTSh6TSwgKCkgPT4gKHsgc2luY2U6ICIxLjQuMCIsIHBhcnNlcnM6IFsiY3NzIl0sIHZzY29kZUxhbmd1YWdlSWRzOiBbInBvc3Rjc3MiXSB9KSksIEpNKEdNLCAoKSA9PiAoeyBzaW5jZTogIjEuNC4wIiwgcGFyc2VyczogWyJsZXNzIl0sIHZzY29kZUxhbmd1YWdlSWRzOiBbImxlc3MiXSB9KSksIEpNKEhNLCAoKSA9PiAoeyBzaW5jZTogIjEuNC4wIiwgcGFyc2VyczogWyJzY3NzIl0sIHZzY29kZUxhbmd1YWdlSWRzOiBbInNjc3MiXSB9KSldOwogICAgICAgIHZhciBRTSA9IHsgbGFuZ3VhZ2VzOiBLTSwgb3B0aW9uczogWU0sIHByaW50ZXJzOiB7IHBvc3Rjc3M6IFhNIH0sIHBhcnNlcnM6IHZvaWQgMCB9OwogICAgICAgIHZhciBaTSA9IHsgbG9jU3RhcnQ6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIubG9jLnN0YXJ0Lm9mZnNldDsKICAgICAgICB9LCBsb2NFbmQ6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIubG9jLmVuZC5vZmZzZXQ7CiAgICAgICAgfSB9OwogICAgICAgIGZ1bmN0aW9uIGVSKGUyLCB0MikgewogICAgICAgICAgaWYgKGUyLnR5cGUgPT09ICJUZXh0Tm9kZSIpIHsKICAgICAgICAgICAgY29uc3QgbjIgPSBlMi5jaGFycy50cmltKCk7CiAgICAgICAgICAgIGlmICghbjIpCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHQyLmNoYXJzID0gbjIucmVwbGFjZSgvW1x0XG5cZlxyIF0rL2csICIgIik7CiAgICAgICAgICB9CiAgICAgICAgICBlMi50eXBlID09PSAiQXR0ck5vZGUiICYmIGUyLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImNsYXNzIiAmJiBkZWxldGUgdDIudmFsdWU7CiAgICAgICAgfQogICAgICAgIGVSLmlnbm9yZWRQcm9wZXJ0aWVzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJsb2MiLCAic2VsZkNsb3NpbmciXSk7CiAgICAgICAgdmFyIHRSID0gZVI7CiAgICAgICAgY29uc3QgblIgPSBhdTsKICAgICAgICBjb25zdCByUiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KFsiYXJlYSIsICJiYXNlIiwgImJhc2Vmb250IiwgImJnc291bmQiLCAiYnIiLCAiY29sIiwgImNvbW1hbmQiLCAiZW1iZWQiLCAiZnJhbWUiLCAiaHIiLCAiaW1hZ2UiLCAiaW1nIiwgImlucHV0IiwgImlzaW5kZXgiLCAia2V5Z2VuIiwgImxpbmsiLCAibWVudWl0ZW0iLCAibWV0YSIsICJuZXh0aWQiLCAicGFyYW0iLCAic291cmNlIiwgInRyYWNrIiwgIndiciJdKTsKICAgICAgICBmdW5jdGlvbiBvUihlMikgewogICAgICAgICAgcmV0dXJuIGlSKGUyLCBbIlRleHROb2RlIl0pICYmICEvXFMvLnRlc3QoZTIuY2hhcnMpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpUihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBlMiAmJiB0Mi5pbmNsdWRlcyhlMi50eXBlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdVIoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gaVIoZTIuZ2V0UGFyZW50Tm9kZSgwKSwgdDIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzUihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gZTIuZ2V0VmFsdWUoKSwgcjIgPSBlMi5nZXRQYXJlbnROb2RlKDApIHx8IHt9LCBvMiA9IHIyLmNoaWxkcmVuIHx8IHIyLmJvZHkgfHwgcjIucGFydHMgfHwgW10sIGkyID0gbzIuaW5kZXhPZihuMik7CiAgICAgICAgICByZXR1cm4gaTIgIT09IC0xICYmIG8yW2kyICsgdDJdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhUihlMikgewogICAgICAgICAgbGV0IHQyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMV0gOiAxOwogICAgICAgICAgcmV0dXJuIHNSKGUyLCAtdDIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjUihlMikgewogICAgICAgICAgcmV0dXJuIHNSKGUyLCAxKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbFIoZTIpIHsKICAgICAgICAgIHJldHVybiBpUihlMiwgWyJNdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQiXSkgJiYgdHlwZW9mIGUyLnZhbHVlID09ICJzdHJpbmciICYmIGUyLnZhbHVlLnRyaW0oKSA9PT0gInByZXR0aWVyLWlnbm9yZSI7CiAgICAgICAgfQogICAgICAgIHZhciBwUiA9IHsgZ2V0TmV4dE5vZGU6IGNSLCBnZXRQcmV2aW91c05vZGU6IGFSLCBoYXNQcmV0dGllcklnbm9yZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTIuZ2V0VmFsdWUoKSwgbjIgPSBhUihlMiwgMik7CiAgICAgICAgICByZXR1cm4gbFIodDIpIHx8IGxSKG4yKTsKICAgICAgICB9LCBpc0xhc3ROb2RlT2ZTaWJsaW5nczogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTIuZ2V0VmFsdWUoKSwgbjIgPSBlMi5nZXRQYXJlbnROb2RlKDApOwogICAgICAgICAgcmV0dXJuICEoIXVSKGUyLCBbIkVsZW1lbnROb2RlIl0pIHx8IG5SKG4yLmNoaWxkcmVuKSAhPT0gdDIpIHx8ICEoIXVSKGUyLCBbIkJsb2NrIl0pIHx8IG5SKG4yLmJvZHkpICE9PSB0Mik7CiAgICAgICAgfSwgaXNOZXh0Tm9kZU9mU29tZVR5cGU6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGlSKGNSKGUyKSwgdDIpOwogICAgICAgIH0sIGlzTm9kZU9mU29tZVR5cGU6IGlSLCBpc1BhcmVudE9mU29tZVR5cGU6IHVSLCBpc1ByZXZpb3VzTm9kZU9mU29tZVR5cGU6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGlSKGFSKGUyKSwgdDIpOwogICAgICAgIH0sIGlzVm9pZDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gaVIoZTMsIFsiRWxlbWVudE5vZGUiXSkgJiYgdHlwZW9mIGUzLnRhZyA9PSAic3RyaW5nIiAmJiBlMy50YWdbMF0gIT09ICI6IiAmJiAoZnVuY3Rpb24oZTQpIHsKICAgICAgICAgICAgICByZXR1cm4gZTQudG9VcHBlckNhc2UoKSA9PT0gZTQ7CiAgICAgICAgICAgIH0oZTMudGFnWzBdKSB8fCBlMy50YWcuaW5jbHVkZXMoIi4iKSk7CiAgICAgICAgICB9KGUyKSAmJiBlMi5jaGlsZHJlbi5ldmVyeSgoZTMpID0+IG9SKGUzKSkgfHwgclIuaGFzKGUyLnRhZyk7CiAgICAgICAgfSwgaXNXaGl0ZXNwYWNlTm9kZTogb1IgfTsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IGRlZGVudDogZlIsIGZpbGw6IGRSLCBncm91cDogaFIsIGhhcmRsaW5lOiBnUiwgaWZCcmVhazogbVIsIGluZGVudDogeVIsIGpvaW46IERSLCBsaW5lOiBFUiwgc29mdGxpbmU6IENSIH0sIHV0aWxzOiB7IGdldERvY1BhcnRzOiBiUiwgcmVwbGFjZVRleHRFbmRPZkxpbmU6IHZSIH0gfSA9IFpjLCB7IGdldFByZWZlcnJlZFF1b3RlOiBBUiwgaXNOb25FbXB0eUFycmF5OiBGUiB9ID0gZGMsIHsgbG9jU3RhcnQ6IHhSLCBsb2NFbmQ6IFNSIH0gPSBaTSwgd1IgPSB0UiwgeyBnZXROZXh0Tm9kZTogVFIsIGdldFByZXZpb3VzTm9kZTogQlIsIGhhc1ByZXR0aWVySWdub3JlOiBOUiwgaXNMYXN0Tm9kZU9mU2libGluZ3M6IGtSLCBpc05leHROb2RlT2ZTb21lVHlwZTogUFIsIGlzTm9kZU9mU29tZVR5cGU6IE9SLCBpc1BhcmVudE9mU29tZVR5cGU6IElSLCBpc1ByZXZpb3VzTm9kZU9mU29tZVR5cGU6IExSLCBpc1ZvaWQ6IGpSLCBpc1doaXRlc3BhY2VOb2RlOiBfUiB9ID0gcFI7CiAgICAgICAgZnVuY3Rpb24gTVIoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4geFIoZTIpIC0geFIodDIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBSUihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCkuY2hpbGRyZW4uZXZlcnkoKGUzKSA9PiBfUihlMykpOwogICAgICAgICAgcmV0dXJuIHQyLmh0bWxXaGl0ZXNwYWNlU2Vuc2l0aXZpdHkgPT09ICJpZ25vcmUiICYmIHIyID8gIiIgOiBlMi5tYXAoKGUzLCByMykgPT4gewogICAgICAgICAgICBjb25zdCBvMiA9IG4yKCk7CiAgICAgICAgICAgIHJldHVybiByMyA9PT0gMCAmJiB0Mi5odG1sV2hpdGVzcGFjZVNlbnNpdGl2aXR5ID09PSAiaWdub3JlIiA/IFtDUiwgbzJdIDogbzI7CiAgICAgICAgICB9LCAiY2hpbGRyZW4iKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVlIoZTIpIHsKICAgICAgICAgIHJldHVybiBqUihlMikgPyBtUihbQ1IsICIvPiJdLCBbIiAvPiIsIENSXSkgOiBtUihbQ1IsICI+Il0sICI+Iik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uICRSKGUyKSB7CiAgICAgICAgICByZXR1cm4gW2UyLmVzY2FwZWQgPT09IGZhbHNlID8gInt7eyIgOiAie3siLCBlMi5zdHJpcCAmJiBlMi5zdHJpcC5vcGVuID8gIn4iIDogIiJdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBXUihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMi5lc2NhcGVkID09PSBmYWxzZSA/ICJ9fX0iIDogIn19IjsKICAgICAgICAgIHJldHVybiBbZTIuc3RyaXAgJiYgZTIuc3RyaXAuY2xvc2UgPyAifiIgOiAiIiwgdDJdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBxUihlMikgewogICAgICAgICAgcmV0dXJuIFskUihlMiksIGUyLmNsb3NlU3RyaXAub3BlbiA/ICJ+IiA6ICIiLCAiLyJdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBVUihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBXUihlMik7CiAgICAgICAgICByZXR1cm4gW2UyLmNsb3NlU3RyaXAuY2xvc2UgPyAifiIgOiAiIiwgdDJdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB6UihlMikgewogICAgICAgICAgcmV0dXJuIFskUihlMiksIGUyLmludmVyc2VTdHJpcC5vcGVuID8gIn4iIDogIiJdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBHUihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBXUihlMik7CiAgICAgICAgICByZXR1cm4gW2UyLmludmVyc2VTdHJpcC5jbG9zZSA/ICJ+IiA6ICIiLCB0Ml07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEhSKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSBlMi5nZXRWYWx1ZSgpLCByMiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBbJFIoZTMpLCBlMy5vcGVuU3RyaXAub3BlbiA/ICJ+IiA6ICIiLCAiIyJdOwogICAgICAgICAgfShuMiksIG8yID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBXUihlMyk7CiAgICAgICAgICAgIHJldHVybiBbZTMub3BlblN0cmlwLmNsb3NlID8gIn4iIDogIiIsIHQzXTsKICAgICAgICAgIH0objIpLCBpMiA9IFtzVihlMiwgdDIpXSwgdTIgPSBhVihlMiwgdDIpOwogICAgICAgICAgaWYgKHUyICYmIGkyLnB1c2goRVIsIHUyKSwgRlIobjIucHJvZ3JhbS5ibG9ja1BhcmFtcykpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSBjVihuMi5wcm9ncmFtKTsKICAgICAgICAgICAgaTIucHVzaChFUiwgZTMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGhSKFtyMiwgeVIoaTIpLCBDUiwgbzJdKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gSlIoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gW3QyLmh0bWxXaGl0ZXNwYWNlU2Vuc2l0aXZpdHkgPT09ICJpZ25vcmUiID8gZ1IgOiAiIiwgelIoZTIpLCAiZWxzZSIsIEdSKGUyKV07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFhSKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSBlMi5nZXRQYXJlbnROb2RlKDEpOwogICAgICAgICAgcmV0dXJuIFt6UihuMiksICJlbHNlIGlmICIsIGFWKGUyLCB0MiksIEdSKG4yKV07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFlSKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIGlmIChuMi5odG1sV2hpdGVzcGFjZVNlbnNpdGl2aXR5ID09PSAiaWdub3JlIikgewogICAgICAgICAgICByZXR1cm4gW0tSKHIyKSA/IENSIDogZ1IsIHFSKHIyKSwgdDIoInBhdGgiKSwgVVIocjIpXTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbcVIocjIpLCB0MigicGF0aCIpLCBVUihyMildOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBLUihlMikgewogICAgICAgICAgcmV0dXJuIE9SKGUyLCBbIkJsb2NrU3RhdGVtZW50Il0pICYmIGUyLnByb2dyYW0uYm9keS5ldmVyeSgoZTMpID0+IF9SKGUzKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFFSKGUyKSB7CiAgICAgICAgICByZXR1cm4gT1IoZTIsIFsiQmxvY2tTdGF0ZW1lbnQiXSkgJiYgZTIuaW52ZXJzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gWlIoZTIsIHQyLCBuMikgewogICAgICAgICAgaWYgKEtSKGUyLmdldFZhbHVlKCkpKQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICBjb25zdCByMiA9IHQyKCJwcm9ncmFtIik7CiAgICAgICAgICByZXR1cm4gbjIuaHRtbFdoaXRlc3BhY2VTZW5zaXRpdml0eSA9PT0gImlnbm9yZSIgPyB5UihbZ1IsIHIyXSkgOiB5UihyMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGVWKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKSwgbzIgPSB0MigiaW52ZXJzZSIpLCBpMiA9IG4yLmh0bWxXaGl0ZXNwYWNlU2Vuc2l0aXZpdHkgPT09ICJpZ25vcmUiID8gW2dSLCBvMl0gOiBvMjsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gUVIoZTMpICYmIGUzLmludmVyc2UuYm9keS5sZW5ndGggPT09IDEgJiYgT1IoZTMuaW52ZXJzZS5ib2R5WzBdLCBbIkJsb2NrU3RhdGVtZW50Il0pICYmIGUzLmludmVyc2UuYm9keVswXS5wYXRoLnBhcnRzWzBdID09PSAiaWYiOwogICAgICAgICAgfShyMikgPyBpMiA6IFFSKHIyKSA/IFtKUihyMiwgbjIpLCB5UihpMildIDogIiI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRWKGUyKSB7CiAgICAgICAgICByZXR1cm4gYlIoRFIoRVIsIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMy5zcGxpdCgvW1x0XG5cZlxyIF0rLyk7CiAgICAgICAgICB9KGUyKSkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBuVihlMikgewogICAgICAgICAgcmV0dXJuIChlMiA9IHR5cGVvZiBlMiA9PSAic3RyaW5nIiA/IGUyIDogIiIpLnNwbGl0KCJcbiIpLmxlbmd0aCAtIDE7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJWKCkgewogICAgICAgICAgbGV0IGUyID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMF0gOiAwOwogICAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oeyBsZW5ndGg6IE1hdGgubWluKGUyLCAyKSB9KS5maWxsKGdSKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb1YoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCB7IHF1b3RlOiBuMiwgcmVnZXg6IHIyIH0gPSBBUihlMiwgdDIpOwogICAgICAgICAgcmV0dXJuIFtuMiwgZTIucmVwbGFjZShyMiwgIlxcIi5jb25jYXQobjIpKSwgbjJdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpVihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gc1YoZTIsIHQyKSwgcjIgPSBhVihlMiwgdDIpOwogICAgICAgICAgcmV0dXJuIHIyID8geVIoW24yLCBFUiwgaFIocjIpXSkgOiBuMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdVYoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IHNWKGUyLCB0MiksIHIyID0gYVYoZTIsIHQyKTsKICAgICAgICAgIHJldHVybiByMiA/IFt5UihbbjIsIEVSLCByMl0pLCBDUl0gOiBuMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc1YoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIoInBhdGgiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYVYoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IGUyLmdldFZhbHVlKCksIHIyID0gW107CiAgICAgICAgICBpZiAobjIucGFyYW1zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgbjMgPSBlMi5tYXAodDIsICJwYXJhbXMiKTsKICAgICAgICAgICAgcjIucHVzaCguLi5uMyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobjIuaGFzaCAmJiBuMi5oYXNoLnBhaXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgZTMgPSB0MigiaGFzaCIpOwogICAgICAgICAgICByMi5wdXNoKGUzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByMi5sZW5ndGggPT09IDAgPyAiIiA6IERSKEVSLCByMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNWKGUyKSB7CiAgICAgICAgICByZXR1cm4gWyJhcyB8IiwgZTIuYmxvY2tQYXJhbXMuam9pbigiICIpLCAifCJdOwogICAgICAgIH0KICAgICAgICB2YXIgbFYgPSB7IHByaW50OiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBpZiAoIXIyKQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICBpZiAoTlIoZTIpKQogICAgICAgICAgICByZXR1cm4gdDIub3JpZ2luYWxUZXh0LnNsaWNlKHhSKHIyKSwgU1IocjIpKTsKICAgICAgICAgIGNvbnN0IG8yID0gdDIuc2luZ2xlUXVvdGUgPyAiJyIgOiAnIic7CiAgICAgICAgICBzd2l0Y2ggKHIyLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiQmxvY2siOgogICAgICAgICAgICBjYXNlICJQcm9ncmFtIjoKICAgICAgICAgICAgY2FzZSAiVGVtcGxhdGUiOgogICAgICAgICAgICAgIHJldHVybiBoUihlMi5tYXAobjIsICJib2R5IikpOwogICAgICAgICAgICBjYXNlICJFbGVtZW50Tm9kZSI6IHsKICAgICAgICAgICAgICBjb25zdCBvMyA9IGhSKGZ1bmN0aW9uKGUzLCB0MykgewogICAgICAgICAgICAgICAgY29uc3QgbjMgPSBlMy5nZXRWYWx1ZSgpLCByMyA9IFsiYXR0cmlidXRlcyIsICJtb2RpZmllcnMiLCAiY29tbWVudHMiXS5maWx0ZXIoKGU0KSA9PiBGUihuM1tlNF0pKSwgbzQgPSByMy5mbGF0TWFwKChlNCkgPT4gbjNbZTRdKS5zb3J0KE1SKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbjQgb2YgcjMpCiAgICAgICAgICAgICAgICAgIGUzLmVhY2goKGU0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbjUgPSBvNC5pbmRleE9mKGU0LmdldFZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIG80LnNwbGljZShuNSwgMSwgW0VSLCB0MygpXSk7CiAgICAgICAgICAgICAgICAgIH0sIG40KTsKICAgICAgICAgICAgICAgIEZSKG4zLmJsb2NrUGFyYW1zKSAmJiBvNC5wdXNoKEVSLCBjVihuMykpOwogICAgICAgICAgICAgICAgcmV0dXJuIFsiPCIsIG4zLnRhZywgeVIobzQpLCBWUihuMyldOwogICAgICAgICAgICAgIH0oZTIsIG4yKSksIGkyID0gdDIuaHRtbFdoaXRlc3BhY2VTZW5zaXRpdml0eSA9PT0gImlnbm9yZSIgJiYgUFIoZTIsIFsiRWxlbWVudE5vZGUiXSkgPyBDUiA6ICIiOwogICAgICAgICAgICAgIGlmIChqUihyMikpCiAgICAgICAgICAgICAgICByZXR1cm4gW28zLCBpMl07CiAgICAgICAgICAgICAgY29uc3QgdTIgPSBbIjwvIiwgcjIudGFnLCAiPiJdOwogICAgICAgICAgICAgIHJldHVybiByMi5jaGlsZHJlbi5sZW5ndGggPT09IDAgPyBbbzMsIHlSKHUyKSwgaTJdIDogdDIuaHRtbFdoaXRlc3BhY2VTZW5zaXRpdml0eSA9PT0gImlnbm9yZSIgPyBbbzMsIHlSKFJSKGUyLCB0MiwgbjIpKSwgZ1IsIHlSKHUyKSwgaTJdIDogW28zLCB5UihoUihSUihlMiwgdDIsIG4yKSkpLCB5Uih1MiksIGkyXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJCbG9ja1N0YXRlbWVudCI6IHsKICAgICAgICAgICAgICBjb25zdCBvMyA9IGUyLmdldFBhcmVudE5vZGUoMSk7CiAgICAgICAgICAgICAgcmV0dXJuIG8zICYmIG8zLmludmVyc2UgJiYgbzMuaW52ZXJzZS5ib2R5Lmxlbmd0aCA9PT0gMSAmJiBvMy5pbnZlcnNlLmJvZHlbMF0gPT09IHIyICYmIG8zLmludmVyc2UuYm9keVswXS5wYXRoLnBhcnRzWzBdID09PSAiaWYiID8gW1hSKGUyLCBuMiksIFpSKGUyLCBuMiwgdDIpLCBlVihlMiwgbjIsIHQyKV0gOiBbSFIoZTIsIG4yKSwgaFIoW1pSKGUyLCBuMiwgdDIpLCBlVihlMiwgbjIsIHQyKSwgWVIoZTIsIG4yLCB0MildKV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiRWxlbWVudE1vZGlmaWVyU3RhdGVtZW50IjoKICAgICAgICAgICAgICByZXR1cm4gaFIoWyJ7eyIsIHVWKGUyLCBuMiksICJ9fSJdKTsKICAgICAgICAgICAgY2FzZSAiTXVzdGFjaGVTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIHJldHVybiBoUihbJFIocjIpLCB1VihlMiwgbjIpLCBXUihyMildKTsKICAgICAgICAgICAgY2FzZSAiU3ViRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIGhSKFsiKCIsIGlWKGUyLCBuMiksIENSLCAiKSJdKTsKICAgICAgICAgICAgY2FzZSAiQXR0ck5vZGUiOiB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSByMi52YWx1ZS50eXBlID09PSAiVGV4dE5vZGUiOwogICAgICAgICAgICAgIGlmIChlMyAmJiByMi52YWx1ZS5jaGFycyA9PT0gIiIgJiYgeFIocjIudmFsdWUpID09PSBTUihyMi52YWx1ZSkpCiAgICAgICAgICAgICAgICByZXR1cm4gcjIubmFtZTsKICAgICAgICAgICAgICBjb25zdCB0MyA9IGUzID8gQVIocjIudmFsdWUuY2hhcnMsIG8yKS5xdW90ZSA6IHIyLnZhbHVlLnR5cGUgPT09ICJDb25jYXRTdGF0ZW1lbnQiID8gQVIocjIudmFsdWUucGFydHMuZmlsdGVyKChlNCkgPT4gZTQudHlwZSA9PT0gIlRleHROb2RlIikubWFwKChlNCkgPT4gZTQuY2hhcnMpLmpvaW4oIiIpLCBvMikucXVvdGUgOiAiIiwgaTIgPSBuMigidmFsdWUiKTsKICAgICAgICAgICAgICByZXR1cm4gW3IyLm5hbWUsICI9IiwgdDMsIHIyLm5hbWUgPT09ICJjbGFzcyIgJiYgdDMgPyBoUih5UihpMikpIDogaTIsIHQzXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJDb25jYXRTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIHJldHVybiBlMi5tYXAobjIsICJwYXJ0cyIpOwogICAgICAgICAgICBjYXNlICJIYXNoIjoKICAgICAgICAgICAgICByZXR1cm4gRFIoRVIsIGUyLm1hcChuMiwgInBhaXJzIikpOwogICAgICAgICAgICBjYXNlICJIYXNoUGFpciI6CiAgICAgICAgICAgICAgcmV0dXJuIFtyMi5rZXksICI9IiwgbjIoInZhbHVlIildOwogICAgICAgICAgICBjYXNlICJUZXh0Tm9kZSI6IHsKICAgICAgICAgICAgICBsZXQgbjMgPSByMi5jaGFycy5yZXBsYWNlKC97ey9nLCAiXFx7eyIpOwogICAgICAgICAgICAgIGNvbnN0IG8zID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHQzID0gMDsgdDMgPCAyOyB0MysrKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG40ID0gZTMuZ2V0UGFyZW50Tm9kZSh0Myk7CiAgICAgICAgICAgICAgICAgIGlmIChuNCAmJiBuNC50eXBlID09PSAiQXR0ck5vZGUiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuNC5uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfShlMik7CiAgICAgICAgICAgICAgaWYgKG8zKSB7CiAgICAgICAgICAgICAgICBpZiAobzMgPT09ICJjbGFzcyIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdDMgPSBuMy50cmltKCkuc3BsaXQoL1xzKy8pLmpvaW4oIiAiKTsKICAgICAgICAgICAgICAgICAgbGV0IHIzID0gZmFsc2UsIG80ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHJldHVybiBJUihlMiwgWyJDb25jYXRTdGF0ZW1lbnQiXSkgJiYgKExSKGUyLCBbIk11c3RhY2hlU3RhdGVtZW50Il0pICYmIC9eXHMvLnRlc3QobjMpICYmIChyMyA9IHRydWUpLCBQUihlMiwgWyJNdXN0YWNoZVN0YXRlbWVudCJdKSAmJiAvXHMkLy50ZXN0KG4zKSAmJiB0MyAhPT0gIiIgJiYgKG80ID0gdHJ1ZSkpLCBbcjMgPyBFUiA6ICIiLCB0MywgbzQgPyBFUiA6ICIiXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB2UihuMyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGkyID0gL15bXHRcblxmXHIgXSokLy50ZXN0KG4zKSwgdTIgPSAhQlIoZTIpLCBzMiA9ICFUUihlMik7CiAgICAgICAgICAgICAgaWYgKHQyLmh0bWxXaGl0ZXNwYWNlU2Vuc2l0aXZpdHkgIT09ICJpZ25vcmUiKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IC9eW1x0XG5cZlxyIF0qLywgcjMgPSAvW1x0XG5cZlxyIF0qJC8sIG80ID0gczIgJiYgSVIoZTIsIFsiVGVtcGxhdGUiXSksIGEzID0gdTIgJiYgSVIoZTIsIFsiVGVtcGxhdGUiXSk7CiAgICAgICAgICAgICAgICBpZiAoaTIpIHsKICAgICAgICAgICAgICAgICAgaWYgKGEzIHx8IG80KQogICAgICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICAgICAgbGV0IHQ0ID0gW0VSXTsKICAgICAgICAgICAgICAgICAgY29uc3QgcjQgPSBuVihuMyk7CiAgICAgICAgICAgICAgICAgIHJldHVybiByNCAmJiAodDQgPSByVihyNCkpLCBrUihlMikgJiYgKHQ0ID0gdDQubWFwKChlMykgPT4gZlIoZTMpKSksIHQ0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgW2MzXSA9IG4zLm1hdGNoKHQzKSwgW2wzXSA9IG4zLm1hdGNoKHIzKTsKICAgICAgICAgICAgICAgIGxldCBwMyA9IFtdOwogICAgICAgICAgICAgICAgaWYgKGMzKSB7CiAgICAgICAgICAgICAgICAgIHAzID0gW0VSXTsKICAgICAgICAgICAgICAgICAgY29uc3QgZTMgPSBuVihjMyk7CiAgICAgICAgICAgICAgICAgIGUzICYmIChwMyA9IHJWKGUzKSksIG4zID0gbjMucmVwbGFjZSh0MywgIiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGV0IGYzID0gW107CiAgICAgICAgICAgICAgICBpZiAobDMpIHsKICAgICAgICAgICAgICAgICAgaWYgKCFvNCkgewogICAgICAgICAgICAgICAgICAgIGYzID0gW0VSXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0NCA9IG5WKGwzKTsKICAgICAgICAgICAgICAgICAgICB0NCAmJiAoZjMgPSByVih0NCkpLCBrUihlMikgJiYgKGYzID0gZjMubWFwKChlMykgPT4gZlIoZTMpKSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgbjMgPSBuMy5yZXBsYWNlKHIzLCAiIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gWy4uLnAzLCBkUih0VihuMykpLCAuLi5mM107CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGEyID0gblYobjMpOwogICAgICAgICAgICAgIGxldCBjMiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gblYoKChlMyA9IHR5cGVvZiBlMyA9PSAic3RyaW5nIiA/IGUzIDogIiIpLm1hdGNoKC9eKFteXFNcblxyXSpbXG5ccl0pKy9nKSB8fCBbXSlbMF0gfHwgIiIpOwogICAgICAgICAgICAgIH0objMpLCBsMiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gblYoKChlMyA9IHR5cGVvZiBlMyA9PSAic3RyaW5nIiA/IGUzIDogIiIpLm1hdGNoKC8oW1xuXHJdW15cU1xuXHJdKikrJC9nKSB8fCBbXSlbMF0gfHwgIiIpOwogICAgICAgICAgICAgIH0objMpOwogICAgICAgICAgICAgIGlmICgodTIgfHwgczIpICYmIGkyICYmIElSKGUyLCBbIkJsb2NrIiwgIkVsZW1lbnROb2RlIiwgIlRlbXBsYXRlIl0pKQogICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICAgIGkyICYmIGEyID8gKGMyID0gTWF0aC5taW4oYTIsIDIpLCBsMiA9IDApIDogKFBSKGUyLCBbIkJsb2NrU3RhdGVtZW50IiwgIkVsZW1lbnROb2RlIl0pICYmIChsMiA9IE1hdGgubWF4KGwyLCAxKSksIExSKGUyLCBbIkJsb2NrU3RhdGVtZW50IiwgIkVsZW1lbnROb2RlIl0pICYmIChjMiA9IE1hdGgubWF4KGMyLCAxKSkpOwogICAgICAgICAgICAgIGxldCBwMiA9ICIiLCBmMiA9ICIiOwogICAgICAgICAgICAgIHJldHVybiBsMiA9PT0gMCAmJiBQUihlMiwgWyJNdXN0YWNoZVN0YXRlbWVudCJdKSAmJiAoZjIgPSAiICIpLCBjMiA9PT0gMCAmJiBMUihlMiwgWyJNdXN0YWNoZVN0YXRlbWVudCJdKSAmJiAocDIgPSAiICIpLCB1MiAmJiAoYzIgPSAwLCBwMiA9ICIiKSwgczIgJiYgKGwyID0gMCwgZjIgPSAiIiksIG4zID0gbjMucmVwbGFjZSgvXltcdFxuXGZcciBdKy9nLCBwMikucmVwbGFjZSgvW1x0XG5cZlxyIF0rJC8sIGYyKSwgWy4uLnJWKGMyKSwgZFIodFYobjMpKSwgLi4uclYobDIpXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJNdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQiOiB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB4UihyMiksIG4zID0gU1IocjIpLCBvMyA9IHQyLm9yaWdpbmFsVGV4dC5jaGFyQXQoZTMgKyAyKSA9PT0gIn4iLCBpMiA9IHQyLm9yaWdpbmFsVGV4dC5jaGFyQXQobjMgLSAzKSA9PT0gIn4iLCB1MiA9IHIyLnZhbHVlLmluY2x1ZGVzKCJ9fSIpID8gIi0tIiA6ICIiOwogICAgICAgICAgICAgIHJldHVybiBbInt7IiwgbzMgPyAifiIgOiAiIiwgIiEiLCB1MiwgcjIudmFsdWUsIHUyLCBpMiA/ICJ+IiA6ICIiLCAifX0iXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJQYXRoRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHIyLm9yaWdpbmFsOwogICAgICAgICAgICBjYXNlICJCb29sZWFuTGl0ZXJhbCI6CiAgICAgICAgICAgIGNhc2UgIk51bWJlckxpdGVyYWwiOgogICAgICAgICAgICAgIHJldHVybiBTdHJpbmcocjIudmFsdWUpOwogICAgICAgICAgICBjYXNlICJDb21tZW50U3RhdGVtZW50IjoKICAgICAgICAgICAgICByZXR1cm4gWyI8IS0tIiwgcjIudmFsdWUsICItLT4iXTsKICAgICAgICAgICAgY2FzZSAiU3RyaW5nTGl0ZXJhbCI6CiAgICAgICAgICAgICAgaWYgKGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgICAgICBsZXQgdDMgPSAwLCBuMyA9IGUzLmdldFBhcmVudE5vZGUodDMpOwogICAgICAgICAgICAgICAgZm9yICg7IG4zICYmIE9SKG4zLCBbIlN1YkV4cHJlc3Npb24iXSk7ICkKICAgICAgICAgICAgICAgICAgdDMrKywgbjMgPSBlMy5nZXRQYXJlbnROb2RlKHQzKTsKICAgICAgICAgICAgICAgIGlmIChuMyAmJiBPUihlMy5nZXRQYXJlbnROb2RlKHQzICsgMSksIFsiQ29uY2F0U3RhdGVtZW50Il0pICYmIE9SKGUzLmdldFBhcmVudE5vZGUodDMgKyAyKSwgWyJBdHRyTm9kZSJdKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfShlMikpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGUzID0gdDIuc2luZ2xlUXVvdGUgPyAnIicgOiAiJyI7CiAgICAgICAgICAgICAgICByZXR1cm4gb1YocjIudmFsdWUsIGUzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIG9WKHIyLnZhbHVlLCBvMik7CiAgICAgICAgICAgIGNhc2UgIlVuZGVmaW5lZExpdGVyYWwiOgogICAgICAgICAgICAgIHJldHVybiAidW5kZWZpbmVkIjsKICAgICAgICAgICAgY2FzZSAiTnVsbExpdGVyYWwiOgogICAgICAgICAgICAgIHJldHVybiAibnVsbCI7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bmtub3duIGdsaW1tZXIgdHlwZTogIiArIEpTT04uc3RyaW5naWZ5KHIyLnR5cGUpKTsKICAgICAgICAgIH0KICAgICAgICB9LCBtYXNzYWdlQXN0Tm9kZTogd1IgfTsKICAgICAgICBjb25zdCBwViA9IGxWOwogICAgICAgIHZhciBmViA9IHsgbGFuZ3VhZ2VzOiBbYkUoeyBuYW1lOiAiSGFuZGxlYmFycyIsIHR5cGU6ICJtYXJrdXAiLCBjb2xvcjogIiNmNzkzMWUiLCBhbGlhc2VzOiBbImhicyIsICJodG1sYmFycyJdLCBleHRlbnNpb25zOiBbIi5oYW5kbGViYXJzIiwgIi5oYnMiXSwgdG1TY29wZTogInRleHQuaHRtbC5oYW5kbGViYXJzIiwgYWNlTW9kZTogImhhbmRsZWJhcnMiLCBsYW5ndWFnZUlkOiAxNTUgfSwgKCkgPT4gKHsgc2luY2U6ICIyLjMuMCIsIHBhcnNlcnM6IFsiZ2xpbW1lciJdLCB2c2NvZGVMYW5ndWFnZUlkczogWyJoYW5kbGViYXJzIl0gfSkpXSwgcHJpbnRlcnM6IHsgZ2xpbW1lcjogcFYgfSwgcGFyc2Vyczogdm9pZCAwIH07CiAgICAgICAgdmFyIGRWID0geyBoYXNQcmFnbWE6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gL15ccyojW15cU1xuXSpAKD86Zm9ybWF0fHByZXR0aWVyKVxzKig/OlxufCQpLy50ZXN0KGUyKTsKICAgICAgICB9LCBpbnNlcnRQcmFnbWE6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gIiMgQGZvcm1hdFxuXG4iICsgZTI7CiAgICAgICAgfSB9OwogICAgICAgIHZhciBoViA9IHsgbG9jU3RhcnQ6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGUyLnN0YXJ0ID09ICJudW1iZXIiID8gZTIuc3RhcnQgOiBlMi5sb2MgJiYgZTIubG9jLnN0YXJ0OwogICAgICAgIH0sIGxvY0VuZDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiB0eXBlb2YgZTIuZW5kID09ICJudW1iZXIiID8gZTIuZW5kIDogZTIubG9jICYmIGUyLmxvYy5lbmQ7CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IHsgYnVpbGRlcnM6IHsgam9pbjogZ1YsIGhhcmRsaW5lOiBtViwgbGluZTogeVYsIHNvZnRsaW5lOiBEViwgZ3JvdXA6IEVWLCBpbmRlbnQ6IENWLCBpZkJyZWFrOiBiViB9IH0gPSBaYywgeyBpc05leHRMaW5lRW1wdHk6IHZWLCBpc05vbkVtcHR5QXJyYXk6IEFWIH0gPSBkYywgeyBpbnNlcnRQcmFnbWE6IEZWIH0gPSBkViwgeyBsb2NTdGFydDogeFYsIGxvY0VuZDogU1YgfSA9IGhWOwogICAgICAgIGZ1bmN0aW9uIHdWKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGlmIChuMi5kaXJlY3RpdmVzLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgY29uc3QgcjIgPSBnVih5ViwgZTIubWFwKHQyLCAiZGlyZWN0aXZlcyIpKTsKICAgICAgICAgIHJldHVybiBuMi5raW5kID09PSAiRnJhZ21lbnREZWZpbml0aW9uIiB8fCBuMi5raW5kID09PSAiT3BlcmF0aW9uRGVmaW5pdGlvbiIgPyBFVihbeVYsIHIyXSkgOiBbIiAiLCBFVihDVihbRFYsIHIyXSkpXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVFYoZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLmxlbmd0aDsKICAgICAgICAgIHJldHVybiBlMi5tYXAoKGUzLCBvMikgPT4gewogICAgICAgICAgICBjb25zdCBpMiA9IG4yKCk7CiAgICAgICAgICAgIHJldHVybiB2Vih0Mi5vcmlnaW5hbFRleHQsIGUzLmdldFZhbHVlKCksIFNWKSAmJiBvMiA8IHIyIC0gMSA/IFtpMiwgbVZdIDogaTI7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQlYoZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXROb2RlKCksIG8yID0gW10sIHsgaW50ZXJmYWNlczogaTIgfSA9IHIyLCB1MiA9IGUyLm1hcCgoZTMpID0+IG4yKGUzKSwgImludGVyZmFjZXMiKTsKICAgICAgICAgIGZvciAobGV0IGUzID0gMDsgZTMgPCBpMi5sZW5ndGg7IGUzKyspIHsKICAgICAgICAgICAgY29uc3QgbjMgPSBpMltlM107CiAgICAgICAgICAgIG8yLnB1c2godTJbZTNdKTsKICAgICAgICAgICAgY29uc3QgcjMgPSBpMltlMyArIDFdOwogICAgICAgICAgICBpZiAocjMpIHsKICAgICAgICAgICAgICBjb25zdCBlNCA9IHQyLm9yaWdpbmFsVGV4dC5zbGljZShuMy5sb2MuZW5kLCByMy5sb2Muc3RhcnQpLCBpMyA9IGU0LmluY2x1ZGVzKCIjIiksIHUzID0gZTQucmVwbGFjZSgvIy4qL2csICIiKS50cmltKCk7CiAgICAgICAgICAgICAgbzIucHVzaCh1MyA9PT0gIiwiID8gIiwiIDogIiAmIiwgaTMgPyB5ViA6ICIgIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBvMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gTlYoKSB7CiAgICAgICAgfQogICAgICAgIE5WLmlnbm9yZWRQcm9wZXJ0aWVzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJsb2MiLCAiY29tbWVudHMiXSk7CiAgICAgICAgdmFyIGtWID0geyBwcmludDogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgaWYgKCFyMikKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgaWYgKHR5cGVvZiByMiA9PSAic3RyaW5nIikKICAgICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgICAgc3dpdGNoIChyMi5raW5kKSB7CiAgICAgICAgICAgIGNhc2UgIkRvY3VtZW50IjogewogICAgICAgICAgICAgIGNvbnN0IHIzID0gW107CiAgICAgICAgICAgICAgcmV0dXJuIGUyLmVhY2goKGUzLCBvMiwgaTIpID0+IHsKICAgICAgICAgICAgICAgIHIzLnB1c2gobjIoKSksIG8yICE9PSBpMi5sZW5ndGggLSAxICYmIChyMy5wdXNoKG1WKSwgdlYodDIub3JpZ2luYWxUZXh0LCBlMy5nZXRWYWx1ZSgpLCBTVikgJiYgcjMucHVzaChtVikpOwogICAgICAgICAgICAgIH0sICJkZWZpbml0aW9ucyIpLCBbLi4ucjMsIG1WXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJPcGVyYXRpb25EZWZpbml0aW9uIjogewogICAgICAgICAgICAgIGNvbnN0IG8yID0gdDIub3JpZ2luYWxUZXh0W3hWKHIyKV0gIT09ICJ7IiwgaTIgPSBCb29sZWFuKHIyLm5hbWUpOwogICAgICAgICAgICAgIHJldHVybiBbbzIgPyByMi5vcGVyYXRpb24gOiAiIiwgbzIgJiYgaTIgPyBbIiAiLCBuMigibmFtZSIpXSA6ICIiLCBvMiAmJiAhaTIgJiYgQVYocjIudmFyaWFibGVEZWZpbml0aW9ucykgPyAiICIgOiAiIiwgQVYocjIudmFyaWFibGVEZWZpbml0aW9ucykgPyBFVihbIigiLCBDVihbRFYsIGdWKFtiVigiIiwgIiwgIiksIERWXSwgZTIubWFwKG4yLCAidmFyaWFibGVEZWZpbml0aW9ucyIpKV0pLCBEViwgIikiXSkgOiAiIiwgd1YoZTIsIG4yLCByMiksIHIyLnNlbGVjdGlvblNldCAmJiAobzIgfHwgaTIpID8gIiAiIDogIiIsIG4yKCJzZWxlY3Rpb25TZXQiKV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiRnJhZ21lbnREZWZpbml0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gWyJmcmFnbWVudCAiLCBuMigibmFtZSIpLCBBVihyMi52YXJpYWJsZURlZmluaXRpb25zKSA/IEVWKFsiKCIsIENWKFtEViwgZ1YoW2JWKCIiLCAiLCAiKSwgRFZdLCBlMi5tYXAobjIsICJ2YXJpYWJsZURlZmluaXRpb25zIikpXSksIERWLCAiKSJdKSA6ICIiLCAiIG9uICIsIG4yKCJ0eXBlQ29uZGl0aW9uIiksIHdWKGUyLCBuMiwgcjIpLCAiICIsIG4yKCJzZWxlY3Rpb25TZXQiKV07CiAgICAgICAgICAgIGNhc2UgIlNlbGVjdGlvblNldCI6CiAgICAgICAgICAgICAgcmV0dXJuIFsieyIsIENWKFttViwgZ1YobVYsIGUyLmNhbGwoKGUzKSA9PiBUVihlMywgdDIsIG4yKSwgInNlbGVjdGlvbnMiKSldKSwgbVYsICJ9Il07CiAgICAgICAgICAgIGNhc2UgIkZpZWxkIjoKICAgICAgICAgICAgICByZXR1cm4gRVYoW3IyLmFsaWFzID8gW24yKCJhbGlhcyIpLCAiOiAiXSA6ICIiLCBuMigibmFtZSIpLCByMi5hcmd1bWVudHMubGVuZ3RoID4gMCA/IEVWKFsiKCIsIENWKFtEViwgZ1YoW2JWKCIiLCAiLCAiKSwgRFZdLCBlMi5jYWxsKChlMykgPT4gVFYoZTMsIHQyLCBuMiksICJhcmd1bWVudHMiKSldKSwgRFYsICIpIl0pIDogIiIsIHdWKGUyLCBuMiwgcjIpLCByMi5zZWxlY3Rpb25TZXQgPyAiICIgOiAiIiwgbjIoInNlbGVjdGlvblNldCIpXSk7CiAgICAgICAgICAgIGNhc2UgIk5hbWUiOgogICAgICAgICAgICBjYXNlICJJbnRWYWx1ZSI6CiAgICAgICAgICAgIGNhc2UgIkZsb2F0VmFsdWUiOgogICAgICAgICAgICBjYXNlICJFbnVtVmFsdWUiOgogICAgICAgICAgICAgIHJldHVybiByMi52YWx1ZTsKICAgICAgICAgICAgY2FzZSAiU3RyaW5nVmFsdWUiOgogICAgICAgICAgICAgIHJldHVybiByMi5ibG9jayA/IFsnIiIiJywgbVYsIGdWKG1WLCByMi52YWx1ZS5yZXBsYWNlKC8iIiIvZywgIlxcJCYiKS5zcGxpdCgiXG4iKSksIG1WLCAnIiIiJ10gOiBbJyInLCByMi52YWx1ZS5yZXBsYWNlKC9bIlxcXS9nLCAiXFwkJiIpLnJlcGxhY2UoL1xuL2csICJcXG4iKSwgJyInXTsKICAgICAgICAgICAgY2FzZSAiQm9vbGVhblZhbHVlIjoKICAgICAgICAgICAgICByZXR1cm4gcjIudmFsdWUgPyAidHJ1ZSIgOiAiZmFsc2UiOwogICAgICAgICAgICBjYXNlICJOdWxsVmFsdWUiOgogICAgICAgICAgICAgIHJldHVybiAibnVsbCI7CiAgICAgICAgICAgIGNhc2UgIlZhcmlhYmxlIjoKICAgICAgICAgICAgICByZXR1cm4gWyIkIiwgbjIoIm5hbWUiKV07CiAgICAgICAgICAgIGNhc2UgIkxpc3RWYWx1ZSI6CiAgICAgICAgICAgICAgcmV0dXJuIEVWKFsiWyIsIENWKFtEViwgZ1YoW2JWKCIiLCAiLCAiKSwgRFZdLCBlMi5tYXAobjIsICJ2YWx1ZXMiKSldKSwgRFYsICJdIl0pOwogICAgICAgICAgICBjYXNlICJPYmplY3RWYWx1ZSI6CiAgICAgICAgICAgICAgcmV0dXJuIEVWKFsieyIsIHQyLmJyYWNrZXRTcGFjaW5nICYmIHIyLmZpZWxkcy5sZW5ndGggPiAwID8gIiAiIDogIiIsIENWKFtEViwgZ1YoW2JWKCIiLCAiLCAiKSwgRFZdLCBlMi5tYXAobjIsICJmaWVsZHMiKSldKSwgRFYsIGJWKCIiLCB0Mi5icmFja2V0U3BhY2luZyAmJiByMi5maWVsZHMubGVuZ3RoID4gMCA/ICIgIiA6ICIiKSwgIn0iXSk7CiAgICAgICAgICAgIGNhc2UgIk9iamVjdEZpZWxkIjoKICAgICAgICAgICAgY2FzZSAiQXJndW1lbnQiOgogICAgICAgICAgICAgIHJldHVybiBbbjIoIm5hbWUiKSwgIjogIiwgbjIoInZhbHVlIildOwogICAgICAgICAgICBjYXNlICJEaXJlY3RpdmUiOgogICAgICAgICAgICAgIHJldHVybiBbIkAiLCBuMigibmFtZSIpLCByMi5hcmd1bWVudHMubGVuZ3RoID4gMCA/IEVWKFsiKCIsIENWKFtEViwgZ1YoW2JWKCIiLCAiLCAiKSwgRFZdLCBlMi5jYWxsKChlMykgPT4gVFYoZTMsIHQyLCBuMiksICJhcmd1bWVudHMiKSldKSwgRFYsICIpIl0pIDogIiJdOwogICAgICAgICAgICBjYXNlICJOYW1lZFR5cGUiOgogICAgICAgICAgICAgIHJldHVybiBuMigibmFtZSIpOwogICAgICAgICAgICBjYXNlICJWYXJpYWJsZURlZmluaXRpb24iOgogICAgICAgICAgICAgIHJldHVybiBbbjIoInZhcmlhYmxlIiksICI6ICIsIG4yKCJ0eXBlIiksIHIyLmRlZmF1bHRWYWx1ZSA/IFsiID0gIiwgbjIoImRlZmF1bHRWYWx1ZSIpXSA6ICIiLCB3VihlMiwgbjIsIHIyKV07CiAgICAgICAgICAgIGNhc2UgIk9iamVjdFR5cGVFeHRlbnNpb24iOgogICAgICAgICAgICBjYXNlICJPYmplY3RUeXBlRGVmaW5pdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIFtuMigiZGVzY3JpcHRpb24iKSwgcjIuZGVzY3JpcHRpb24gPyBtViA6ICIiLCByMi5raW5kID09PSAiT2JqZWN0VHlwZUV4dGVuc2lvbiIgPyAiZXh0ZW5kICIgOiAiIiwgInR5cGUgIiwgbjIoIm5hbWUiKSwgcjIuaW50ZXJmYWNlcy5sZW5ndGggPiAwID8gWyIgaW1wbGVtZW50cyAiLCAuLi5CVihlMiwgdDIsIG4yKV0gOiAiIiwgd1YoZTIsIG4yLCByMiksIHIyLmZpZWxkcy5sZW5ndGggPiAwID8gWyIgeyIsIENWKFttViwgZ1YobVYsIGUyLmNhbGwoKGUzKSA9PiBUVihlMywgdDIsIG4yKSwgImZpZWxkcyIpKV0pLCBtViwgIn0iXSA6ICIiXTsKICAgICAgICAgICAgY2FzZSAiRmllbGREZWZpbml0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJkZXNjcmlwdGlvbiIpLCByMi5kZXNjcmlwdGlvbiA/IG1WIDogIiIsIG4yKCJuYW1lIiksIHIyLmFyZ3VtZW50cy5sZW5ndGggPiAwID8gRVYoWyIoIiwgQ1YoW0RWLCBnVihbYlYoIiIsICIsICIpLCBEVl0sIGUyLmNhbGwoKGUzKSA9PiBUVihlMywgdDIsIG4yKSwgImFyZ3VtZW50cyIpKV0pLCBEViwgIikiXSkgOiAiIiwgIjogIiwgbjIoInR5cGUiKSwgd1YoZTIsIG4yLCByMildOwogICAgICAgICAgICBjYXNlICJEaXJlY3RpdmVEZWZpbml0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJkZXNjcmlwdGlvbiIpLCByMi5kZXNjcmlwdGlvbiA/IG1WIDogIiIsICJkaXJlY3RpdmUgIiwgIkAiLCBuMigibmFtZSIpLCByMi5hcmd1bWVudHMubGVuZ3RoID4gMCA/IEVWKFsiKCIsIENWKFtEViwgZ1YoW2JWKCIiLCAiLCAiKSwgRFZdLCBlMi5jYWxsKChlMykgPT4gVFYoZTMsIHQyLCBuMiksICJhcmd1bWVudHMiKSldKSwgRFYsICIpIl0pIDogIiIsIHIyLnJlcGVhdGFibGUgPyAiIHJlcGVhdGFibGUiIDogIiIsICIgb24gIiwgZ1YoIiB8ICIsIGUyLm1hcChuMiwgImxvY2F0aW9ucyIpKV07CiAgICAgICAgICAgIGNhc2UgIkVudW1UeXBlRXh0ZW5zaW9uIjoKICAgICAgICAgICAgY2FzZSAiRW51bVR5cGVEZWZpbml0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJkZXNjcmlwdGlvbiIpLCByMi5kZXNjcmlwdGlvbiA/IG1WIDogIiIsIHIyLmtpbmQgPT09ICJFbnVtVHlwZUV4dGVuc2lvbiIgPyAiZXh0ZW5kICIgOiAiIiwgImVudW0gIiwgbjIoIm5hbWUiKSwgd1YoZTIsIG4yLCByMiksIHIyLnZhbHVlcy5sZW5ndGggPiAwID8gWyIgeyIsIENWKFttViwgZ1YobVYsIGUyLmNhbGwoKGUzKSA9PiBUVihlMywgdDIsIG4yKSwgInZhbHVlcyIpKV0pLCBtViwgIn0iXSA6ICIiXTsKICAgICAgICAgICAgY2FzZSAiRW51bVZhbHVlRGVmaW5pdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIFtuMigiZGVzY3JpcHRpb24iKSwgcjIuZGVzY3JpcHRpb24gPyBtViA6ICIiLCBuMigibmFtZSIpLCB3VihlMiwgbjIsIHIyKV07CiAgICAgICAgICAgIGNhc2UgIklucHV0VmFsdWVEZWZpbml0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJkZXNjcmlwdGlvbiIpLCByMi5kZXNjcmlwdGlvbiA/IHIyLmRlc2NyaXB0aW9uLmJsb2NrID8gbVYgOiB5ViA6ICIiLCBuMigibmFtZSIpLCAiOiAiLCBuMigidHlwZSIpLCByMi5kZWZhdWx0VmFsdWUgPyBbIiA9ICIsIG4yKCJkZWZhdWx0VmFsdWUiKV0gOiAiIiwgd1YoZTIsIG4yLCByMildOwogICAgICAgICAgICBjYXNlICJJbnB1dE9iamVjdFR5cGVFeHRlbnNpb24iOgogICAgICAgICAgICBjYXNlICJJbnB1dE9iamVjdFR5cGVEZWZpbml0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJkZXNjcmlwdGlvbiIpLCByMi5kZXNjcmlwdGlvbiA/IG1WIDogIiIsIHIyLmtpbmQgPT09ICJJbnB1dE9iamVjdFR5cGVFeHRlbnNpb24iID8gImV4dGVuZCAiIDogIiIsICJpbnB1dCAiLCBuMigibmFtZSIpLCB3VihlMiwgbjIsIHIyKSwgcjIuZmllbGRzLmxlbmd0aCA+IDAgPyBbIiB7IiwgQ1YoW21WLCBnVihtViwgZTIuY2FsbCgoZTMpID0+IFRWKGUzLCB0MiwgbjIpLCAiZmllbGRzIikpXSksIG1WLCAifSJdIDogIiJdOwogICAgICAgICAgICBjYXNlICJTY2hlbWFEZWZpbml0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gWyJzY2hlbWEiLCB3VihlMiwgbjIsIHIyKSwgIiB7IiwgcjIub3BlcmF0aW9uVHlwZXMubGVuZ3RoID4gMCA/IENWKFttViwgZ1YobVYsIGUyLmNhbGwoKGUzKSA9PiBUVihlMywgdDIsIG4yKSwgIm9wZXJhdGlvblR5cGVzIikpXSkgOiAiIiwgbVYsICJ9Il07CiAgICAgICAgICAgIGNhc2UgIk9wZXJhdGlvblR5cGVEZWZpbml0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJvcGVyYXRpb24iKSwgIjogIiwgbjIoInR5cGUiKV07CiAgICAgICAgICAgIGNhc2UgIkludGVyZmFjZVR5cGVFeHRlbnNpb24iOgogICAgICAgICAgICBjYXNlICJJbnRlcmZhY2VUeXBlRGVmaW5pdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIFtuMigiZGVzY3JpcHRpb24iKSwgcjIuZGVzY3JpcHRpb24gPyBtViA6ICIiLCByMi5raW5kID09PSAiSW50ZXJmYWNlVHlwZUV4dGVuc2lvbiIgPyAiZXh0ZW5kICIgOiAiIiwgImludGVyZmFjZSAiLCBuMigibmFtZSIpLCByMi5pbnRlcmZhY2VzLmxlbmd0aCA+IDAgPyBbIiBpbXBsZW1lbnRzICIsIC4uLkJWKGUyLCB0MiwgbjIpXSA6ICIiLCB3VihlMiwgbjIsIHIyKSwgcjIuZmllbGRzLmxlbmd0aCA+IDAgPyBbIiB7IiwgQ1YoW21WLCBnVihtViwgZTIuY2FsbCgoZTMpID0+IFRWKGUzLCB0MiwgbjIpLCAiZmllbGRzIikpXSksIG1WLCAifSJdIDogIiJdOwogICAgICAgICAgICBjYXNlICJGcmFnbWVudFNwcmVhZCI6CiAgICAgICAgICAgICAgcmV0dXJuIFsiLi4uIiwgbjIoIm5hbWUiKSwgd1YoZTIsIG4yLCByMildOwogICAgICAgICAgICBjYXNlICJJbmxpbmVGcmFnbWVudCI6CiAgICAgICAgICAgICAgcmV0dXJuIFsiLi4uIiwgcjIudHlwZUNvbmRpdGlvbiA/IFsiIG9uICIsIG4yKCJ0eXBlQ29uZGl0aW9uIildIDogIiIsIHdWKGUyLCBuMiwgcjIpLCAiICIsIG4yKCJzZWxlY3Rpb25TZXQiKV07CiAgICAgICAgICAgIGNhc2UgIlVuaW9uVHlwZUV4dGVuc2lvbiI6CiAgICAgICAgICAgIGNhc2UgIlVuaW9uVHlwZURlZmluaXRpb24iOgogICAgICAgICAgICAgIHJldHVybiBFVihbbjIoImRlc2NyaXB0aW9uIiksIHIyLmRlc2NyaXB0aW9uID8gbVYgOiAiIiwgRVYoW3IyLmtpbmQgPT09ICJVbmlvblR5cGVFeHRlbnNpb24iID8gImV4dGVuZCAiIDogIiIsICJ1bmlvbiAiLCBuMigibmFtZSIpLCB3VihlMiwgbjIsIHIyKSwgcjIudHlwZXMubGVuZ3RoID4gMCA/IFsiID0iLCBiVigiIiwgIiAiKSwgQ1YoW2JWKFt5ViwgIiAgIl0pLCBnVihbeVYsICJ8ICJdLCBlMi5tYXAobjIsICJ0eXBlcyIpKV0pXSA6ICIiXSldKTsKICAgICAgICAgICAgY2FzZSAiU2NhbGFyVHlwZUV4dGVuc2lvbiI6CiAgICAgICAgICAgIGNhc2UgIlNjYWxhclR5cGVEZWZpbml0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gW24yKCJkZXNjcmlwdGlvbiIpLCByMi5kZXNjcmlwdGlvbiA/IG1WIDogIiIsIHIyLmtpbmQgPT09ICJTY2FsYXJUeXBlRXh0ZW5zaW9uIiA/ICJleHRlbmQgIiA6ICIiLCAic2NhbGFyICIsIG4yKCJuYW1lIiksIHdWKGUyLCBuMiwgcjIpXTsKICAgICAgICAgICAgY2FzZSAiTm9uTnVsbFR5cGUiOgogICAgICAgICAgICAgIHJldHVybiBbbjIoInR5cGUiKSwgIiEiXTsKICAgICAgICAgICAgY2FzZSAiTGlzdFR5cGUiOgogICAgICAgICAgICAgIHJldHVybiBbIlsiLCBuMigidHlwZSIpLCAiXSJdOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5rbm93biBncmFwaHFsIHR5cGU6ICIgKyBKU09OLnN0cmluZ2lmeShyMi5raW5kKSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgbWFzc2FnZUFzdE5vZGU6IE5WLCBoYXNQcmV0dGllcklnbm9yZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIHJldHVybiB0MiAmJiBBcnJheS5pc0FycmF5KHQyLmNvbW1lbnRzKSAmJiB0Mi5jb21tZW50cy5zb21lKChlMykgPT4gZTMudmFsdWUudHJpbSgpID09PSAicHJldHRpZXItaWdub3JlIik7CiAgICAgICAgfSwgaW5zZXJ0UHJhZ21hOiBGViwgcHJpbnRDb21tZW50OiBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgaWYgKHQyLmtpbmQgPT09ICJDb21tZW50IikKICAgICAgICAgICAgcmV0dXJuICIjIiArIHQyLnZhbHVlLnRyaW1FbmQoKTsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm90IGEgY29tbWVudDogIiArIEpTT04uc3RyaW5naWZ5KHQyKSk7CiAgICAgICAgfSwgY2FuQXR0YWNoQ29tbWVudDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5raW5kICYmIGUyLmtpbmQgIT09ICJDb21tZW50IjsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgUFYgPSBrViwgT1YgPSB7IGJyYWNrZXRTcGFjaW5nOiBiai5icmFja2V0U3BhY2luZyB9OwogICAgICAgIHZhciBJViA9IHsgbGFuZ3VhZ2VzOiBbYkUoeyBuYW1lOiAiR3JhcGhRTCIsIHR5cGU6ICJkYXRhIiwgY29sb3I6ICIjZTEwMDk4IiwgZXh0ZW5zaW9uczogWyIuZ3JhcGhxbCIsICIuZ3FsIiwgIi5ncmFwaHFscyJdLCB0bVNjb3BlOiAic291cmNlLmdyYXBocWwiLCBhY2VNb2RlOiAidGV4dCIsIGxhbmd1YWdlSWQ6IDEzOSB9LCAoKSA9PiAoeyBzaW5jZTogIjEuNS4wIiwgcGFyc2VyczogWyJncmFwaHFsIl0sIHZzY29kZUxhbmd1YWdlSWRzOiBbImdyYXBocWwiXSB9KSldLCBvcHRpb25zOiBPViwgcHJpbnRlcnM6IHsgZ3JhcGhxbDogUFYgfSwgcGFyc2Vyczogdm9pZCAwIH07CiAgICAgICAgdmFyIExWID0geyBsb2NTdGFydDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5wb3NpdGlvbi5zdGFydC5vZmZzZXQ7CiAgICAgICAgfSwgbG9jRW5kOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnBvc2l0aW9uLmVuZC5vZmZzZXQ7CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IHsgZ2V0TGFzdDogalYgfSA9IGRjLCB7IGxvY1N0YXJ0OiBfViwgbG9jRW5kOiBNViB9ID0gTFYsIHsgY2prUGF0dGVybjogUlYsIGtQYXR0ZXJuOiBWViwgcHVuY3R1YXRpb25QYXR0ZXJuOiAkViB9ID0geyBjamtQYXR0ZXJuOiAiKD86W1xcdTAyZWEtXFx1MDJlYlxcdTExMDAtXFx1MTFmZlxcdTJlODAtXFx1MmU5OVxcdTJlOWItXFx1MmVmM1xcdTJmMDAtXFx1MmZkNVxcdTJmZjAtXFx1MzAzZlxcdTMwNDEtXFx1MzA5NlxcdTMwOTktXFx1MzA5ZlxcdTMwYTEtXFx1MzBmYVxcdTMwZmMtXFx1MzBmZlxcdTMxMDUtXFx1MzEyZlxcdTMxMzEtXFx1MzE4ZVxcdTMxOTAtXFx1MzE5MVxcdTMxOTYtXFx1MzFiYVxcdTMxYzAtXFx1MzFlM1xcdTMxZjAtXFx1MzIxZVxcdTMyMmEtXFx1MzI0N1xcdTMyNjAtXFx1MzI3ZVxcdTMyOGEtXFx1MzJiMFxcdTMyYzAtXFx1MzJjYlxcdTMyZDAtXFx1MzM3MFxcdTMzN2ItXFx1MzM3ZlxcdTMzZTAtXFx1MzNmZVxcdTM0MDAtXFx1NGRiNVxcdTRlMDAtXFx1OWZlZlxcdWE5NjAtXFx1YTk3Y1xcdWFjMDAtXFx1ZDdhM1xcdWQ3YjAtXFx1ZDdjNlxcdWQ3Y2ItXFx1ZDdmYlxcdWY5MDAtXFx1ZmE2ZFxcdWZhNzAtXFx1ZmFkOVxcdWZlMTAtXFx1ZmUxZlxcdWZlMzAtXFx1ZmU2ZlxcdWZmMDAtXFx1ZmZlZl18W1xcdWQ4NDAtXFx1ZDg2OFxcdWQ4NmEtXFx1ZDg2Y1xcdWQ4NmYtXFx1ZDg3MlxcdWQ4NzQtXFx1ZDg3OV1bXFx1ZGMwMC1cXHVkZmZmXXxcXHVkODJjW1xcdWRjMDAtXFx1ZGQxZVxcdWRkNTAtXFx1ZGQ1MlxcdWRkNjQtXFx1ZGQ2N118XFx1ZDgzY1tcXHVkZTAwXFx1ZGU1MC1cXHVkZTUxXXxcXHVkODY5W1xcdWRjMDAtXFx1ZGVkNlxcdWRmMDAtXFx1ZGZmZl18XFx1ZDg2ZFtcXHVkYzAwLVxcdWRmMzRcXHVkZjQwLVxcdWRmZmZdfFxcdWQ4NmVbXFx1ZGMwMC1cXHVkYzFkXFx1ZGMyMC1cXHVkZmZmXXxcXHVkODczW1xcdWRjMDAtXFx1ZGVhMVxcdWRlYjAtXFx1ZGZmZl18XFx1ZDg3YVtcXHVkYzAwLVxcdWRmZTBdfFxcdWQ4N2VbXFx1ZGMwMC1cXHVkZTFkXSkoPzpbXFx1ZmUwMC1cXHVmZTBmXXxcXHVkYjQwW1xcdWRkMDAtXFx1ZGRlZl0pPyIsIGtQYXR0ZXJuOiAiW1xcdTExMDAtXFx1MTFmZlxcdTMwMDEtXFx1MzAwM1xcdTMwMDgtXFx1MzAxMVxcdTMwMTMtXFx1MzAxZlxcdTMwMmUtXFx1MzAzMFxcdTMwMzdcXHUzMGZiXFx1MzEzMS1cXHUzMThlXFx1MzIwMC1cXHUzMjFlXFx1MzI2MC1cXHUzMjdlXFx1YTk2MC1cXHVhOTdjXFx1YWMwMC1cXHVkN2EzXFx1ZDdiMC1cXHVkN2M2XFx1ZDdjYi1cXHVkN2ZiXFx1ZmU0NS1cXHVmZTQ2XFx1ZmY2MS1cXHVmZjY1XFx1ZmZhMC1cXHVmZmJlXFx1ZmZjMi1cXHVmZmM3XFx1ZmZjYS1cXHVmZmNmXFx1ZmZkMi1cXHVmZmQ3XFx1ZmZkYS1cXHVmZmRjXSIsIHB1bmN0dWF0aW9uUGF0dGVybjogIltcXHUwMDIxLVxcdTAwMmZcXHUwMDNhLVxcdTAwNDBcXHUwMDViLVxcdTAwNjBcXHUwMDdiLVxcdTAwN2VcXHUwMGExXFx1MDBhN1xcdTAwYWJcXHUwMGI2LVxcdTAwYjdcXHUwMGJiXFx1MDBiZlxcdTAzN2VcXHUwMzg3XFx1MDU1YS1cXHUwNTVmXFx1MDU4OS1cXHUwNThhXFx1MDViZVxcdTA1YzBcXHUwNWMzXFx1MDVjNlxcdTA1ZjMtXFx1MDVmNFxcdTA2MDktXFx1MDYwYVxcdTA2MGMtXFx1MDYwZFxcdTA2MWJcXHUwNjFlLVxcdTA2MWZcXHUwNjZhLVxcdTA2NmRcXHUwNmQ0XFx1MDcwMC1cXHUwNzBkXFx1MDdmNy1cXHUwN2Y5XFx1MDgzMC1cXHUwODNlXFx1MDg1ZVxcdTA5NjQtXFx1MDk2NVxcdTA5NzBcXHUwOWZkXFx1MGE3NlxcdTBhZjBcXHUwYzc3XFx1MGM4NFxcdTBkZjRcXHUwZTRmXFx1MGU1YS1cXHUwZTViXFx1MGYwNC1cXHUwZjEyXFx1MGYxNFxcdTBmM2EtXFx1MGYzZFxcdTBmODVcXHUwZmQwLVxcdTBmZDRcXHUwZmQ5LVxcdTBmZGFcXHUxMDRhLVxcdTEwNGZcXHUxMGZiXFx1MTM2MC1cXHUxMzY4XFx1MTQwMFxcdTE2NmVcXHUxNjliLVxcdTE2OWNcXHUxNmViLVxcdTE2ZWRcXHUxNzM1LVxcdTE3MzZcXHUxN2Q0LVxcdTE3ZDZcXHUxN2Q4LVxcdTE3ZGFcXHUxODAwLVxcdTE4MGFcXHUxOTQ0LVxcdTE5NDVcXHUxYTFlLVxcdTFhMWZcXHUxYWEwLVxcdTFhYTZcXHUxYWE4LVxcdTFhYWRcXHUxYjVhLVxcdTFiNjBcXHUxYmZjLVxcdTFiZmZcXHUxYzNiLVxcdTFjM2ZcXHUxYzdlLVxcdTFjN2ZcXHUxY2MwLVxcdTFjYzdcXHUxY2QzXFx1MjAxMC1cXHUyMDI3XFx1MjAzMC1cXHUyMDQzXFx1MjA0NS1cXHUyMDUxXFx1MjA1My1cXHUyMDVlXFx1MjA3ZC1cXHUyMDdlXFx1MjA4ZC1cXHUyMDhlXFx1MjMwOC1cXHUyMzBiXFx1MjMyOS1cXHUyMzJhXFx1Mjc2OC1cXHUyNzc1XFx1MjdjNS1cXHUyN2M2XFx1MjdlNi1cXHUyN2VmXFx1Mjk4My1cXHUyOTk4XFx1MjlkOC1cXHUyOWRiXFx1MjlmYy1cXHUyOWZkXFx1MmNmOS1cXHUyY2ZjXFx1MmNmZS1cXHUyY2ZmXFx1MmQ3MFxcdTJlMDAtXFx1MmUyZVxcdTJlMzAtXFx1MmU0ZlxcdTMwMDEtXFx1MzAwM1xcdTMwMDgtXFx1MzAxMVxcdTMwMTQtXFx1MzAxZlxcdTMwMzBcXHUzMDNkXFx1MzBhMFxcdTMwZmJcXHVhNGZlLVxcdWE0ZmZcXHVhNjBkLVxcdWE2MGZcXHVhNjczXFx1YTY3ZVxcdWE2ZjItXFx1YTZmN1xcdWE4NzQtXFx1YTg3N1xcdWE4Y2UtXFx1YThjZlxcdWE4ZjgtXFx1YThmYVxcdWE4ZmNcXHVhOTJlLVxcdWE5MmZcXHVhOTVmXFx1YTljMS1cXHVhOWNkXFx1YTlkZS1cXHVhOWRmXFx1YWE1Yy1cXHVhYTVmXFx1YWFkZS1cXHVhYWRmXFx1YWFmMC1cXHVhYWYxXFx1YWJlYlxcdWZkM2UtXFx1ZmQzZlxcdWZlMTAtXFx1ZmUxOVxcdWZlMzAtXFx1ZmU1MlxcdWZlNTQtXFx1ZmU2MVxcdWZlNjNcXHVmZTY4XFx1ZmU2YS1cXHVmZTZiXFx1ZmYwMS1cXHVmZjAzXFx1ZmYwNS1cXHVmZjBhXFx1ZmYwYy1cXHVmZjBmXFx1ZmYxYS1cXHVmZjFiXFx1ZmYxZi1cXHVmZjIwXFx1ZmYzYi1cXHVmZjNkXFx1ZmYzZlxcdWZmNWJcXHVmZjVkXFx1ZmY1Zi1cXHVmZjY1XXxcXHVkODAwW1xcdWRkMDAtXFx1ZGQwMlxcdWRmOWZcXHVkZmQwXXxcXHVkODAxW1xcdWRkNmZdfFxcdWQ4MDJbXFx1ZGM1N1xcdWRkMWZcXHVkZDNmXFx1ZGU1MC1cXHVkZTU4XFx1ZGU3ZlxcdWRlZjAtXFx1ZGVmNlxcdWRmMzktXFx1ZGYzZlxcdWRmOTktXFx1ZGY5Y118XFx1ZDgwM1tcXHVkZjU1LVxcdWRmNTldfFxcdWQ4MDRbXFx1ZGM0Ny1cXHVkYzRkXFx1ZGNiYi1cXHVkY2JjXFx1ZGNiZS1cXHVkY2MxXFx1ZGQ0MC1cXHVkZDQzXFx1ZGQ3NC1cXHVkZDc1XFx1ZGRjNS1cXHVkZGM4XFx1ZGRjZFxcdWRkZGJcXHVkZGRkLVxcdWRkZGZcXHVkZTM4LVxcdWRlM2RcXHVkZWE5XXxcXHVkODA1W1xcdWRjNGItXFx1ZGM0ZlxcdWRjNWJcXHVkYzVkXFx1ZGNjNlxcdWRkYzEtXFx1ZGRkN1xcdWRlNDEtXFx1ZGU0M1xcdWRlNjAtXFx1ZGU2Y1xcdWRmM2MtXFx1ZGYzZV18XFx1ZDgwNltcXHVkYzNiXFx1ZGRlMlxcdWRlM2YtXFx1ZGU0NlxcdWRlOWEtXFx1ZGU5Y1xcdWRlOWUtXFx1ZGVhMl18XFx1ZDgwN1tcXHVkYzQxLVxcdWRjNDVcXHVkYzcwLVxcdWRjNzFcXHVkZWY3LVxcdWRlZjhcXHVkZmZmXXxcXHVkODA5W1xcdWRjNzAtXFx1ZGM3NF18XFx1ZDgxYVtcXHVkZTZlLVxcdWRlNmZcXHVkZWY1XFx1ZGYzNy1cXHVkZjNiXFx1ZGY0NF18XFx1ZDgxYltcXHVkZTk3LVxcdWRlOWFcXHVkZmUyXXxcXHVkODJmW1xcdWRjOWZdfFxcdWQ4MzZbXFx1ZGU4Ny1cXHVkZThiXXxcXHVkODNhW1xcdWRkNWUtXFx1ZGQ1Zl0iIH0sIFdWID0gWyJsaXF1aWROb2RlIiwgImlubGluZUNvZGUiLCAiZW1waGFzaXMiLCAiZXNDb21tZW50IiwgInN0cm9uZyIsICJkZWxldGUiLCAid2lraUxpbmsiLCAibGluayIsICJsaW5rUmVmZXJlbmNlIiwgImltYWdlIiwgImltYWdlUmVmZXJlbmNlIiwgImZvb3Rub3RlIiwgImZvb3Rub3RlUmVmZXJlbmNlIiwgInNlbnRlbmNlIiwgIndoaXRlc3BhY2UiLCAid29yZCIsICJicmVhayIsICJpbmxpbmVNYXRoIl0sIHFWID0gWy4uLldWLCAidGFibGVDZWxsIiwgInBhcmFncmFwaCIsICJoZWFkaW5nIl0sIFVWID0gbmV3IFJlZ0V4cChWViksIHpWID0gbmV3IFJlZ0V4cCgkVik7CiAgICAgICAgZnVuY3Rpb24gR1YoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBbLCBuMiwgcjIsIG8yXSA9IHQyLnNsaWNlKGUyLnBvc2l0aW9uLnN0YXJ0Lm9mZnNldCwgZTIucG9zaXRpb24uZW5kLm9mZnNldCkubWF0Y2goL15ccyooXGQrKShcLnxcKSkoXHMqKS8pOwogICAgICAgICAgcmV0dXJuIHsgbnVtYmVyVGV4dDogbjIsIG1hcmtlcjogcjIsIGxlYWRpbmdTcGFjZXM6IG8yIH07CiAgICAgICAgfQogICAgICAgIHZhciBIViA9IHsgbWFwQXN0OiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBlMyhuMiwgcjIsIG8yKSB7CiAgICAgICAgICAgIGNvbnN0IGkyID0gT2JqZWN0LmFzc2lnbih7fSwgdDIobjIsIHIyLCBvMikpOwogICAgICAgICAgICByZXR1cm4gaTIuY2hpbGRyZW4gJiYgKGkyLmNoaWxkcmVuID0gaTIuY2hpbGRyZW4ubWFwKCh0MywgbjMpID0+IGUzKHQzLCBuMywgW2kyLCAuLi5vMl0pKSksIGkyOwogICAgICAgICAgfShlMiwgbnVsbCwgW10pOwogICAgICAgIH0sIHNwbGl0VGV4dDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9ICJub24tY2prIiwgcjIgPSAiY2otbGV0dGVyIiwgbzIgPSAiY2prLXB1bmN0dWF0aW9uIiwgaTIgPSBbXSwgdTIgPSAodDIucHJvc2VXcmFwID09PSAicHJlc2VydmUiID8gZTIgOiBlMi5yZXBsYWNlKG5ldyBSZWdFeHAoIigiLmNvbmNhdChSViwgIilcbigiKS5jb25jYXQoUlYsICIpIiksICJnIiksICIkMSQyIikpLnNwbGl0KC8oW1x0XG4gXSspLyk7CiAgICAgICAgICBmb3IgKGNvbnN0IFtlMywgdDNdIG9mIHUyLmVudHJpZXMoKSkgewogICAgICAgICAgICBpZiAoZTMgJSAyID09IDEpIHsKICAgICAgICAgICAgICBpMi5wdXNoKHsgdHlwZTogIndoaXRlc3BhY2UiLCB2YWx1ZTogL1xuLy50ZXN0KHQzKSA/ICJcbiIgOiAiICIgfSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKChlMyA9PT0gMCB8fCBlMyA9PT0gdTIubGVuZ3RoIC0gMSkgJiYgdDMgPT09ICIiKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjb25zdCBhMiA9IHQzLnNwbGl0KG5ldyBSZWdFeHAoIigiLmNvbmNhdChSViwgIikiKSkpOwogICAgICAgICAgICBmb3IgKGNvbnN0IFtlNCwgdDRdIG9mIGEyLmVudHJpZXMoKSkKICAgICAgICAgICAgICAoZTQgIT09IDAgJiYgZTQgIT09IGEyLmxlbmd0aCAtIDEgfHwgdDQgIT09ICIiKSAmJiAoZTQgJSAyICE9IDAgPyBzMih6Vi50ZXN0KHQ0KSA/IHsgdHlwZTogIndvcmQiLCB2YWx1ZTogdDQsIGtpbmQ6IG8yLCBoYXNMZWFkaW5nUHVuY3R1YXRpb246IHRydWUsIGhhc1RyYWlsaW5nUHVuY3R1YXRpb246IHRydWUgfSA6IHsgdHlwZTogIndvcmQiLCB2YWx1ZTogdDQsIGtpbmQ6IFVWLnRlc3QodDQpID8gImstbGV0dGVyIiA6IHIyLCBoYXNMZWFkaW5nUHVuY3R1YXRpb246IGZhbHNlLCBoYXNUcmFpbGluZ1B1bmN0dWF0aW9uOiBmYWxzZSB9KSA6IHQ0ICE9PSAiIiAmJiBzMih7IHR5cGU6ICJ3b3JkIiwgdmFsdWU6IHQ0LCBraW5kOiBuMiwgaGFzTGVhZGluZ1B1bmN0dWF0aW9uOiB6Vi50ZXN0KHQ0WzBdKSwgaGFzVHJhaWxpbmdQdW5jdHVhdGlvbjogelYudGVzdChqVih0NCkpIH0pKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICAgIGZ1bmN0aW9uIHMyKGUzKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0galYoaTIpOwogICAgICAgICAgICB2YXIgdTMsIHMzOwogICAgICAgICAgICB0MyAmJiB0My50eXBlID09PSAid29yZCIgJiYgKHQzLmtpbmQgPT09IG4yICYmIGUzLmtpbmQgPT09IHIyICYmICF0My5oYXNUcmFpbGluZ1B1bmN0dWF0aW9uIHx8IHQzLmtpbmQgPT09IHIyICYmIGUzLmtpbmQgPT09IG4yICYmICFlMy5oYXNMZWFkaW5nUHVuY3R1YXRpb24gPyBpMi5wdXNoKHsgdHlwZTogIndoaXRlc3BhY2UiLCB2YWx1ZTogIiAiIH0pIDogKHUzID0gbjIsIHMzID0gbzIsIHQzLmtpbmQgPT09IHUzICYmIGUzLmtpbmQgPT09IHMzIHx8IHQzLmtpbmQgPT09IHMzICYmIGUzLmtpbmQgPT09IHUzIHx8IFt0My52YWx1ZSwgZTMudmFsdWVdLnNvbWUoKGU0KSA9PiAvXHUzMDAwLy50ZXN0KGU0KSkgfHwgaTIucHVzaCh7IHR5cGU6ICJ3aGl0ZXNwYWNlIiwgdmFsdWU6ICIiIH0pKSksIGkyLnB1c2goZTMpOwogICAgICAgICAgfQogICAgICAgIH0sIHB1bmN0dWF0aW9uUGF0dGVybjogJFYsIGdldEZlbmNlZENvZGVCbG9ja1ZhbHVlOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IHsgdmFsdWU6IG4yIH0gPSBlMjsKICAgICAgICAgIHJldHVybiBlMi5wb3NpdGlvbi5lbmQub2Zmc2V0ID09PSB0Mi5sZW5ndGggJiYgbjIuZW5kc1dpdGgoIlxuIikgJiYgdDIuZW5kc1dpdGgoIlxuIikgPyBuMi5zbGljZSgwLCAtMSkgOiBuMjsKICAgICAgICB9LCBnZXRPcmRlcmVkTGlzdEl0ZW1JbmZvOiBHViwgaGFzR2l0RGlmZkZyaWVuZGx5T3JkZXJlZExpc3Q6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgaWYgKCFlMi5vcmRlcmVkKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBpZiAoZTIuY2hpbGRyZW4ubGVuZ3RoIDwgMikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgY29uc3QgbjIgPSBOdW1iZXIoR1YoZTIuY2hpbGRyZW5bMF0sIHQyLm9yaWdpbmFsVGV4dCkubnVtYmVyVGV4dCksIHIyID0gTnVtYmVyKEdWKGUyLmNoaWxkcmVuWzFdLCB0Mi5vcmlnaW5hbFRleHQpLm51bWJlclRleHQpOwogICAgICAgICAgaWYgKG4yID09PSAwICYmIGUyLmNoaWxkcmVuLmxlbmd0aCA+IDIpIHsKICAgICAgICAgICAgY29uc3QgbjMgPSBOdW1iZXIoR1YoZTIuY2hpbGRyZW5bMl0sIHQyLm9yaWdpbmFsVGV4dCkubnVtYmVyVGV4dCk7CiAgICAgICAgICAgIHJldHVybiByMiA9PT0gMSAmJiBuMyA9PT0gMTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByMiA9PT0gMTsKICAgICAgICB9LCBJTkxJTkVfTk9ERV9UWVBFUzogV1YsIElOTElORV9OT0RFX1dSQVBQRVJfVFlQRVM6IHFWLCBpc0F1dG9saW5rOiBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKCFlMiB8fCBlMi50eXBlICE9PSAibGluayIgfHwgZTIuY2hpbGRyZW4ubGVuZ3RoICE9PSAxKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBjb25zdCB0MiA9IGUyLmNoaWxkcmVuWzBdOwogICAgICAgICAgcmV0dXJuIHQyICYmIF9WKGUyKSA9PT0gX1YodDIpICYmIE1WKGUyKSA9PT0gTVYodDIpOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IGluZmVyUGFyc2VyQnlMYW5ndWFnZTogSlYsIGdldE1heENvbnRpbnVvdXNDb3VudDogWFYgfSA9IGRjLCB7IGJ1aWxkZXJzOiB7IGhhcmRsaW5lOiBZViwgbWFya0FzUm9vdDogS1YgfSwgdXRpbHM6IHsgcmVwbGFjZUVuZE9mTGluZTogUVYgfSB9ID0gWmMsIFpWID0gV2osIHsgZ2V0RmVuY2VkQ29kZUJsb2NrVmFsdWU6IGUkIH0gPSBIVjsKICAgICAgICB2YXIgdCQgPSBmdW5jdGlvbihlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgY29uc3QgbzIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgaWYgKG8yLnR5cGUgPT09ICJjb2RlIiAmJiBvMi5sYW5nICE9PSBudWxsKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gSlYobzIubGFuZywgcjIpOwogICAgICAgICAgICBpZiAoZTMpIHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IHIyLl9faW5Kc1RlbXBsYXRlID8gIn4iIDogImAiLCBpMiA9IHQzLnJlcGVhdChNYXRoLm1heCgzLCBYVihvMi52YWx1ZSwgdDMpICsgMSkpLCB1MiA9IHsgcGFyc2VyOiBlMyB9OwogICAgICAgICAgICAgIG8yLmxhbmcgPT09ICJ0c3giICYmICh1Mi5maWxlcGF0aCA9ICJkdW1teS50c3giKTsKICAgICAgICAgICAgICBjb25zdCBzMiA9IG4yKGUkKG8yLCByMi5vcmlnaW5hbFRleHQpLCB1MiwgeyBzdHJpcFRyYWlsaW5nSGFyZGxpbmU6IHRydWUgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIEtWKFtpMiwgbzIubGFuZywgbzIubWV0YSA/ICIgIiArIG8yLm1ldGEgOiAiIiwgWVYsIFFWKHMyKSwgWVYsIGkyXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHN3aXRjaCAobzIudHlwZSkgewogICAgICAgICAgICBjYXNlICJmcm9udC1tYXR0ZXIiOgogICAgICAgICAgICAgIHJldHVybiBaVihvMiwgbjIpOwogICAgICAgICAgICBjYXNlICJpbXBvcnRFeHBvcnQiOgogICAgICAgICAgICAgIHJldHVybiBbbjIobzIudmFsdWUsIHsgcGFyc2VyOiAiYmFiZWwiIH0sIHsgc3RyaXBUcmFpbGluZ0hhcmRsaW5lOiB0cnVlIH0pLCBZVl07CiAgICAgICAgICAgIGNhc2UgImpzeCI6CiAgICAgICAgICAgICAgcmV0dXJuIG4yKCI8JD4iLmNvbmNhdChvMi52YWx1ZSwgIjwvJD4iKSwgeyBwYXJzZXI6ICJfX2pzX2V4cHJlc3Npb24iLCByb290TWFya2VyOiAibWR4IiB9LCB7IHN0cmlwVHJhaWxpbmdIYXJkbGluZTogdHJ1ZSB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH07CiAgICAgICAgY29uc3QgbiQgPSBIaiwgciQgPSBbImZvcm1hdCIsICJwcmV0dGllciJdOwogICAgICAgIGZ1bmN0aW9uIG8kKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9ICJAKCIuY29uY2F0KHIkLmpvaW4oInwiKSwgIikiKSwgbjIgPSBuZXcgUmVnRXhwKFsiPCEtLVxccyoiLmNvbmNhdCh0MiwgIlxccyotLT4iKSwgIntcXHMqXFwvXFwqXFxzKiIuY29uY2F0KHQyLCAiXFxzKlxcKlxcL1xccyp9IiksICI8IS0tLipccj9cbltcXHNcXFNdKihefFxuKVteXFxTXG5dKiIuY29uY2F0KHQyLCAiW15cXFNcbl0qKCR8XG4pW1xcc1xcU10qXG4uKi0tPiIpXS5qb2luKCJ8IiksICJtIiksIHIyID0gZTIubWF0Y2gobjIpOwogICAgICAgICAgcmV0dXJuIHIyICYmIHIyLmluZGV4ID09PSAwOwogICAgICAgIH0KICAgICAgICB2YXIgaSQgPSB7IHN0YXJ0V2l0aFByYWdtYTogbyQsIGhhc1ByYWdtYTogKGUyKSA9PiBvJChuJChlMikuY29udGVudC50cmltU3RhcnQoKSksIGluc2VydFByYWdtYTogKGUyKSA9PiB7CiAgICAgICAgICBjb25zdCB0MiA9IG4kKGUyKSwgbjIgPSAiPCEtLSBAIi5jb25jYXQociRbMF0sICIgLS0+Iik7CiAgICAgICAgICByZXR1cm4gdDIuZnJvbnRNYXR0ZXIgPyAiIi5jb25jYXQodDIuZnJvbnRNYXR0ZXIucmF3LCAiXG5cbiIpLmNvbmNhdChuMiwgIlxuXG4iKS5jb25jYXQodDIuY29udGVudCkgOiAiIi5jb25jYXQobjIsICJcblxuIikuY29uY2F0KHQyLmNvbnRlbnQpOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB1JCA9IGF1LCB7IGdldE9yZGVyZWRMaXN0SXRlbUluZm86IHMkLCBtYXBBc3Q6IGEkLCBzcGxpdFRleHQ6IGMkIH0gPSBIViwgbCQgPSAvXi4kL3VzOwogICAgICAgIGZ1bmN0aW9uIHAkKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBhJChlMiwgKGUzKSA9PiB7CiAgICAgICAgICAgIGlmICghZTMuY2hpbGRyZW4pCiAgICAgICAgICAgICAgcmV0dXJuIGUzOwogICAgICAgICAgICBjb25zdCByMiA9IGUzLmNoaWxkcmVuLnJlZHVjZSgoZTQsIHIzKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgbzIgPSB1JChlNCk7CiAgICAgICAgICAgICAgcmV0dXJuIG8yICYmIHQyKG8yLCByMykgPyBlNC5zcGxpY2UoLTEsIDEsIG4yKG8yLCByMykpIDogZTQucHVzaChyMyksIGU0OwogICAgICAgICAgICB9LCBbXSk7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGUzKSwge30sIHsgY2hpbGRyZW46IHIyIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHZhciBmJCA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGUyID0gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIHJldHVybiBhJChlMywgKGU0KSA9PiBlNC50eXBlID09PSAidGV4dCIgJiYgZTQudmFsdWUgIT09ICIqIiAmJiBlNC52YWx1ZSAhPT0gIl8iICYmIGwkLnRlc3QoZTQudmFsdWUpICYmIGU0LnBvc2l0aW9uLmVuZC5vZmZzZXQgLSBlNC5wb3NpdGlvbi5zdGFydC5vZmZzZXQgIT09IGU0LnZhbHVlLmxlbmd0aCA/IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZTQpLCB7fSwgeyB2YWx1ZTogdDMub3JpZ2luYWxUZXh0LnNsaWNlKGU0LnBvc2l0aW9uLnN0YXJ0Lm9mZnNldCwgZTQucG9zaXRpb24uZW5kLm9mZnNldCkgfSkgOiBlNCk7CiAgICAgICAgICB9KGUyLCB0MiksIGUyID0gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIHJldHVybiBhJChlMywgKGU0LCBuMiwgcjIpID0+IHsKICAgICAgICAgICAgICBpZiAoZTQudHlwZSA9PT0gImNvZGUiKSB7CiAgICAgICAgICAgICAgICBjb25zdCBuMyA9IC9eXG4/KD86IHs0LH18XHQpLy50ZXN0KHQzLm9yaWdpbmFsVGV4dC5zbGljZShlNC5wb3NpdGlvbi5zdGFydC5vZmZzZXQsIGU0LnBvc2l0aW9uLmVuZC5vZmZzZXQpKTsKICAgICAgICAgICAgICAgIGlmIChlNC5pc0luZGVudGVkID0gbjMsIG4zKQogICAgICAgICAgICAgICAgICBmb3IgKGxldCBlNSA9IDA7IGU1IDwgcjIubGVuZ3RoOyBlNSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdDQgPSByMltlNV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHQ0Lmhhc0luZGVudGVkQ29kZWJsb2NrKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgdDQudHlwZSA9PT0gImxpc3QiICYmICh0NC5oYXNJbmRlbnRlZENvZGVibG9jayA9IHRydWUpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBlNDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KGUyID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGEkKGUzLCAoZTQpID0+IGU0LnR5cGUgIT09ICJpbmxpbmVDb2RlIiA/IGU0IDogT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlNCksIHt9LCB7IHZhbHVlOiBlNC52YWx1ZS5yZXBsYWNlKC9ccysvZywgIiAiKSB9KSk7CiAgICAgICAgICB9KGUyID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIHAkKGUzLCAoZTQsIHQzKSA9PiBlNC50eXBlID09PSAidGV4dCIgJiYgdDMudHlwZSA9PT0gInRleHQiLCAoZTQsIHQzKSA9PiAoeyB0eXBlOiAidGV4dCIsIHZhbHVlOiBlNC52YWx1ZSArIHQzLnZhbHVlLCBwb3NpdGlvbjogeyBzdGFydDogZTQucG9zaXRpb24uc3RhcnQsIGVuZDogdDMucG9zaXRpb24uZW5kIH0gfSkpOwogICAgICAgICAgfShlMikpLCB0MiksIGUyID0gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIHJldHVybiBhJChlMywgKGU0LCB0NCwgbjMpID0+IHsKICAgICAgICAgICAgICBpZiAoZTQudHlwZSA9PT0gImxpc3QiICYmIGU0LmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHQ1ID0gMDsgdDUgPCBuMy5sZW5ndGg7IHQ1KyspIHsKICAgICAgICAgICAgICAgICAgY29uc3QgcjMgPSBuM1t0NV07CiAgICAgICAgICAgICAgICAgIGlmIChyMy50eXBlID09PSAibGlzdCIgJiYgIXIzLmlzQWxpZ25lZCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZTQuaXNBbGlnbmVkID0gZmFsc2UsIGU0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZTQuaXNBbGlnbmVkID0gcjIoZTQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gZTQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBmdW5jdGlvbiBuMihlNCkgewogICAgICAgICAgICAgIHJldHVybiBlNC5jaGlsZHJlbi5sZW5ndGggPT09IDAgPyAtMSA6IGU0LmNoaWxkcmVuWzBdLnBvc2l0aW9uLnN0YXJ0LmNvbHVtbiAtIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcjIoZTQpIHsKICAgICAgICAgICAgICBpZiAoIWU0Lm9yZGVyZWQpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCBbcjMsIG8yXSA9IGU0LmNoaWxkcmVuOwogICAgICAgICAgICAgIGlmIChzJChyMywgdDMub3JpZ2luYWxUZXh0KS5sZWFkaW5nU3BhY2VzLmxlbmd0aCA+IDEpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCBpMiA9IG4yKHIzKTsKICAgICAgICAgICAgICBpZiAoaTIgPT09IC0xKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIGlmIChlNC5jaGlsZHJlbi5sZW5ndGggPT09IDEpCiAgICAgICAgICAgICAgICByZXR1cm4gaTIgJSB0My50YWJXaWR0aCA9PSAwOwogICAgICAgICAgICAgIGlmIChpMiAhPT0gbjIobzIpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIGlmIChpMiAlIHQzLnRhYldpZHRoID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICByZXR1cm4gcyQobzIsIHQzLm9yaWdpbmFsVGV4dCkubGVhZGluZ1NwYWNlcy5sZW5ndGggPiAxOwogICAgICAgICAgICB9CiAgICAgICAgICB9KGUyLCB0MiksIGUyID0gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIHJldHVybiBhJChlMywgKGU0LCBuMiwgcjIpID0+IHsKICAgICAgICAgICAgICBsZXQgW28yXSA9IHIyOwogICAgICAgICAgICAgIGlmIChlNC50eXBlICE9PSAidGV4dCIpCiAgICAgICAgICAgICAgICByZXR1cm4gZTQ7CiAgICAgICAgICAgICAgbGV0IHsgdmFsdWU6IGkyIH0gPSBlNDsKICAgICAgICAgICAgICByZXR1cm4gbzIudHlwZSA9PT0gInBhcmFncmFwaCIgJiYgKG4yID09PSAwICYmIChpMiA9IGkyLnRyaW1TdGFydCgpKSwgbjIgPT09IG8yLmNoaWxkcmVuLmxlbmd0aCAtIDEgJiYgKGkyID0gaTIudHJpbUVuZCgpKSksIHsgdHlwZTogInNlbnRlbmNlIiwgcG9zaXRpb246IGU0LnBvc2l0aW9uLCBjaGlsZHJlbjogYyQoaTIsIHQzKSB9OwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0oZTIsIHQyKSwgZTIgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gcCQoZTMsIChlNCwgdDMpID0+IGU0LnR5cGUgPT09ICJpbXBvcnRFeHBvcnQiICYmIHQzLnR5cGUgPT09ICJpbXBvcnRFeHBvcnQiLCAoZTQsIHQzKSA9PiAoeyB0eXBlOiAiaW1wb3J0RXhwb3J0IiwgdmFsdWU6IGU0LnZhbHVlICsgIlxuXG4iICsgdDMudmFsdWUsIHBvc2l0aW9uOiB7IHN0YXJ0OiBlNC5wb3NpdGlvbi5zdGFydCwgZW5kOiB0My5wb3NpdGlvbi5lbmQgfSB9KSk7CiAgICAgICAgICB9KGUyID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGEkKGUzLCAoZTQpID0+IGU0LnR5cGUgIT09ICJpbXBvcnQiICYmIGU0LnR5cGUgIT09ICJleHBvcnQiID8gZTQgOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGU0KSwge30sIHsgdHlwZTogImltcG9ydEV4cG9ydCIgfSkpOwogICAgICAgICAgfShlMikpOwogICAgICAgIH07CiAgICAgICAgY29uc3QgeyBpc0Zyb250TWF0dGVyTm9kZTogZCQgfSA9IGRjLCB7IHN0YXJ0V2l0aFByYWdtYTogaCQgfSA9IGkkLCBnJCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KFsicG9zaXRpb24iLCAicmF3Il0pOwogICAgICAgIGZ1bmN0aW9uIG0kKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlICE9PSAiZnJvbnQtbWF0dGVyIiAmJiBlMi50eXBlICE9PSAiY29kZSIgJiYgZTIudHlwZSAhPT0gInlhbWwiICYmIGUyLnR5cGUgIT09ICJpbXBvcnQiICYmIGUyLnR5cGUgIT09ICJleHBvcnQiICYmIGUyLnR5cGUgIT09ICJqc3giIHx8IGRlbGV0ZSB0Mi52YWx1ZSwgZTIudHlwZSA9PT0gImxpc3QiICYmIGRlbGV0ZSB0Mi5pc0FsaWduZWQsIGUyLnR5cGUgIT09ICJsaXN0IiAmJiBlMi50eXBlICE9PSAibGlzdEl0ZW0iIHx8IChkZWxldGUgdDIuc3ByZWFkLCBkZWxldGUgdDIubG9vc2UpLCBlMi50eXBlID09PSAidGV4dCIgPyBudWxsIDogKGUyLnR5cGUgPT09ICJpbmxpbmVDb2RlIiAmJiAodDIudmFsdWUgPSBlMi52YWx1ZS5yZXBsYWNlKC9bXHRcbiBdKy9nLCAiICIpKSwgZTIudHlwZSA9PT0gIndpa2lMaW5rIiAmJiAodDIudmFsdWUgPSBlMi52YWx1ZS50cmltKCkucmVwbGFjZSgvW1x0XG5dKy9nLCAiICIpKSwgZTIudHlwZSAhPT0gImRlZmluaXRpb24iICYmIGUyLnR5cGUgIT09ICJsaW5rUmVmZXJlbmNlIiB8fCAodDIubGFiZWwgPSBlMi5sYWJlbC50cmltKCkucmVwbGFjZSgvW1x0XG4gXSsvZywgIiAiKS50b0xvd2VyQ2FzZSgpKSwgZTIudHlwZSAhPT0gImRlZmluaXRpb24iICYmIGUyLnR5cGUgIT09ICJsaW5rIiAmJiBlMi50eXBlICE9PSAiaW1hZ2UiIHx8ICFlMi50aXRsZSB8fCAodDIudGl0bGUgPSBlMi50aXRsZS5yZXBsYWNlKC9cXChbIicpXSkvZywgIiQxIikpLCBuMiAmJiBuMi50eXBlID09PSAicm9vdCIgJiYgbjIuY2hpbGRyZW4ubGVuZ3RoID4gMCAmJiAobjIuY2hpbGRyZW5bMF0gPT09IGUyIHx8IGQkKG4yLmNoaWxkcmVuWzBdKSAmJiBuMi5jaGlsZHJlblsxXSA9PT0gZTIpICYmIGUyLnR5cGUgPT09ICJodG1sIiAmJiBoJChlMi52YWx1ZSkgPyBudWxsIDogdm9pZCAwKTsKICAgICAgICB9CiAgICAgICAgbSQuaWdub3JlZFByb3BlcnRpZXMgPSBnJDsKICAgICAgICB2YXIgeSQgPSBtJDsKICAgICAgICBjb25zdCB7IGdldExhc3Q6IEQkLCBnZXRNaW5Ob3RQcmVzZW50Q29udGludW91c0NvdW50OiBFJCwgZ2V0TWF4Q29udGludW91c0NvdW50OiBDJCwgZ2V0U3RyaW5nV2lkdGg6IGIkLCBpc05vbkVtcHR5QXJyYXk6IHYkIH0gPSBkYywgeyBidWlsZGVyczogeyBicmVha1BhcmVudDogQSQsIGpvaW46IEYkLCBsaW5lOiB4JCwgbGl0ZXJhbGxpbmU6IFMkLCBtYXJrQXNSb290OiB3JCwgaGFyZGxpbmU6IFQkLCBzb2Z0bGluZTogQiQsIGlmQnJlYWs6IE4kLCBmaWxsOiBrJCwgYWxpZ246IFAkLCBpbmRlbnQ6IE8kLCBncm91cDogSSQsIGhhcmRsaW5lV2l0aG91dEJyZWFrUGFyZW50OiBMJCB9LCB1dGlsczogeyBub3JtYWxpemVEb2M6IGokLCByZXBsYWNlVGV4dEVuZE9mTGluZTogXyQgfSwgcHJpbnRlcjogeyBwcmludERvY1RvU3RyaW5nOiBNJCB9IH0gPSBaYywgUiQgPSB0JCwgeyBpbnNlcnRQcmFnbWE6IFYkIH0gPSBpJCwgeyBsb2NTdGFydDogJCQsIGxvY0VuZDogVyQgfSA9IExWLCBxJCA9IGYkLCBVJCA9IHkkLCB7IGdldEZlbmNlZENvZGVCbG9ja1ZhbHVlOiB6JCwgaGFzR2l0RGlmZkZyaWVuZGx5T3JkZXJlZExpc3Q6IEckLCBzcGxpdFRleHQ6IEgkLCBwdW5jdHVhdGlvblBhdHRlcm46IEokLCBJTkxJTkVfTk9ERV9UWVBFUzogWCQsIElOTElORV9OT0RFX1dSQVBQRVJfVFlQRVM6IFkkLCBpc0F1dG9saW5rOiBLJCB9ID0gSFYsIFEkID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJpbXBvcnRFeHBvcnQiXSksIFokID0gWyJoZWFkaW5nIiwgInRhYmxlQ2VsbCIsICJsaW5rIiwgIndpa2lMaW5rIl0sIGVXID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJsaXN0SXRlbSIsICJkZWZpbml0aW9uIiwgImZvb3Rub3RlRGVmaW5pdGlvbiJdKTsKICAgICAgICBmdW5jdGlvbiB0VyhlMiwgdDIsIG4yLCByMikgewogICAgICAgICAgY29uc3QgbzIgPSBlMi5nZXRWYWx1ZSgpLCBpMiA9IG8yLmNoZWNrZWQgPT09IG51bGwgPyAiIiA6IG8yLmNoZWNrZWQgPyAiW3hdICIgOiAiWyBdICI7CiAgICAgICAgICByZXR1cm4gW2kyLCBzVyhlMiwgdDIsIG4yLCB7IHByb2Nlc3NvcjogKGUzLCBvMykgPT4gewogICAgICAgICAgICBpZiAobzMgPT09IDAgJiYgZTMuZ2V0VmFsdWUoKS50eXBlICE9PSAibGlzdCIpCiAgICAgICAgICAgICAgcmV0dXJuIFAkKCIgIi5yZXBlYXQoaTIubGVuZ3RoKSwgbjIoKSk7CiAgICAgICAgICAgIGNvbnN0IHUyID0gIiAiLnJlcGVhdChmdW5jdGlvbihlNCwgdDMsIG4zKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGU0IDwgdDMgPyB0MyA6IGU0ID4gbjMgPyBuMyA6IGU0OwogICAgICAgICAgICB9KHQyLnRhYldpZHRoIC0gcjIubGVuZ3RoLCAwLCAzKSk7CiAgICAgICAgICAgIHJldHVybiBbdTIsIFAkKHUyLCBuMigpKV07CiAgICAgICAgICB9IH0pXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gblcoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTMsIHQzLCBuMikgewogICAgICAgICAgICBsZXQgcjIgPSAtMTsKICAgICAgICAgICAgZm9yIChjb25zdCBvMiBvZiB0My5jaGlsZHJlbikKICAgICAgICAgICAgICBpZiAobzIudHlwZSA9PT0gZTMudHlwZSAmJiBuMihvMikgPyByMisrIDogcjIgPSAtMSwgbzIgPT09IGUzKQogICAgICAgICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgICAgfShlMiwgdDIsICh0MykgPT4gdDMub3JkZXJlZCA9PT0gZTIub3JkZXJlZCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJXKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSBBcnJheS5pc0FycmF5KHQyKSA/IHQyIDogW3QyXTsKICAgICAgICAgIGxldCByMiwgbzIgPSAtMTsKICAgICAgICAgIGZvciAoOyByMiA9IGUyLmdldFBhcmVudE5vZGUoKytvMik7ICkKICAgICAgICAgICAgaWYgKG4yLmluY2x1ZGVzKHIyLnR5cGUpKQogICAgICAgICAgICAgIHJldHVybiBvMjsKICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb1coZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IHJXKGUyLCB0Mik7CiAgICAgICAgICByZXR1cm4gbjIgPT09IC0xID8gbnVsbCA6IGUyLmdldFBhcmVudE5vZGUobjIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpVyhlMiwgdDIsIG4yKSB7CiAgICAgICAgICBpZiAobjIucHJvc2VXcmFwID09PSAicHJlc2VydmUiICYmIHQyID09PSAiXG4iKQogICAgICAgICAgICByZXR1cm4gVCQ7CiAgICAgICAgICBjb25zdCByMiA9IG4yLnByb3NlV3JhcCA9PT0gImFsd2F5cyIgJiYgIW9XKGUyLCBaJCk7CiAgICAgICAgICByZXR1cm4gdDIgIT09ICIiID8gcjIgPyB4JCA6ICIgIiA6IHIyID8gQiQgOiAiIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdVcoZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBbXTsKICAgICAgICAgIGxldCBvMiA9IG51bGw7CiAgICAgICAgICBjb25zdCB7IGNoaWxkcmVuOiBpMiB9ID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIGZvciAoY29uc3QgW2UzLCB0M10gb2YgaTIuZW50cmllcygpKQogICAgICAgICAgICBzd2l0Y2ggKGNXKHQzKSkgewogICAgICAgICAgICAgIGNhc2UgInN0YXJ0IjoKICAgICAgICAgICAgICAgIG8yID09PSBudWxsICYmIChvMiA9IHsgaW5kZXg6IGUzLCBvZmZzZXQ6IHQzLnBvc2l0aW9uLmVuZC5vZmZzZXQgfSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgbzIgIT09IG51bGwgJiYgKHIyLnB1c2goeyBzdGFydDogbzIsIGVuZDogeyBpbmRleDogZTMsIG9mZnNldDogdDMucG9zaXRpb24uc3RhcnQub2Zmc2V0IH0gfSksIG8yID0gbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBzVyhlMiwgdDIsIG4yLCB7IHByb2Nlc3NvcjogKGUzLCBvMykgPT4gewogICAgICAgICAgICBpZiAocjIubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGNvbnN0IGU0ID0gcjJbMF07CiAgICAgICAgICAgICAgaWYgKG8zID09PSBlNC5zdGFydC5pbmRleCkKICAgICAgICAgICAgICAgIHJldHVybiBbaTJbZTQuc3RhcnQuaW5kZXhdLnZhbHVlLCB0Mi5vcmlnaW5hbFRleHQuc2xpY2UoZTQuc3RhcnQub2Zmc2V0LCBlNC5lbmQub2Zmc2V0KSwgaTJbZTQuZW5kLmluZGV4XS52YWx1ZV07CiAgICAgICAgICAgICAgaWYgKGU0LnN0YXJ0LmluZGV4IDwgbzMgJiYgbzMgPCBlNC5lbmQuaW5kZXgpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKG8zID09PSBlNC5lbmQuaW5kZXgpCiAgICAgICAgICAgICAgICByZXR1cm4gcjIuc2hpZnQoKSwgZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG4yKCk7CiAgICAgICAgICB9IH0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzVyhlMiwgdDIsIG4yKSB7CiAgICAgICAgICBsZXQgcjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1szXSA6IHt9OwogICAgICAgICAgY29uc3QgeyBwb3N0cHJvY2Vzc29yOiBvMiB9ID0gcjIsIGkyID0gcjIucHJvY2Vzc29yIHx8ICgoKSA9PiBuMigpKSwgdTIgPSBlMi5nZXRWYWx1ZSgpLCBzMiA9IFtdOwogICAgICAgICAgbGV0IGEyOwogICAgICAgICAgcmV0dXJuIGUyLmVhY2goKGUzLCBuMykgPT4gewogICAgICAgICAgICBjb25zdCByMyA9IGUzLmdldFZhbHVlKCksIG8zID0gaTIoZTMsIG4zKTsKICAgICAgICAgICAgaWYgKG8zICE9PSBmYWxzZSkgewogICAgICAgICAgICAgIGNvbnN0IGU0ID0geyBwYXJ0czogczIsIHByZXZOb2RlOiBhMiwgcGFyZW50Tm9kZTogdTIsIG9wdGlvbnM6IHQyIH07CiAgICAgICAgICAgICAgbFcocjMsIGU0KSAmJiAoczIucHVzaChUJCksIGEyICYmIFEkLmhhcyhhMi50eXBlKSB8fCAocFcocjMsIGU0KSB8fCBmVyhyMywgZTQpKSAmJiBzMi5wdXNoKFQkKSwgZlcocjMsIGU0KSAmJiBzMi5wdXNoKFQkKSksIHMyLnB1c2gobzMpLCBhMiA9IHIzOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCAiY2hpbGRyZW4iKSwgbzIgPyBvMihzMikgOiBzMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYVcoZTIpIHsKICAgICAgICAgIGxldCB0MiA9IGUyOwogICAgICAgICAgZm9yICg7IHYkKHQyLmNoaWxkcmVuKTsgKQogICAgICAgICAgICB0MiA9IEQkKHQyLmNoaWxkcmVuKTsKICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY1coZTIpIHsKICAgICAgICAgIGxldCB0MjsKICAgICAgICAgIGlmIChlMi50eXBlID09PSAiaHRtbCIpCiAgICAgICAgICAgIHQyID0gZTIudmFsdWUubWF0Y2goL148IS0tXHMqcHJldHRpZXItaWdub3JlKD86LShzdGFydHxlbmQpKT9ccyotLT4kLyk7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbGV0IG4yOwogICAgICAgICAgICBlMi50eXBlID09PSAiZXNDb21tZW50IiA/IG4yID0gZTIgOiBlMi50eXBlID09PSAicGFyYWdyYXBoIiAmJiBlMi5jaGlsZHJlbi5sZW5ndGggPT09IDEgJiYgZTIuY2hpbGRyZW5bMF0udHlwZSA9PT0gImVzQ29tbWVudCIgJiYgKG4yID0gZTIuY2hpbGRyZW5bMF0pLCBuMiAmJiAodDIgPSBuMi52YWx1ZS5tYXRjaCgvXnByZXR0aWVyLWlnbm9yZSg/Oi0oc3RhcnR8ZW5kKSk/JC8pKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAhIXQyICYmICh0MlsxXSA/IHQyWzFdIDogIm5leHQiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbFcoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IHQyLnBhcnRzLmxlbmd0aCA9PT0gMCwgcjIgPSBYJC5pbmNsdWRlcyhlMi50eXBlKSwgbzIgPSBlMi50eXBlID09PSAiaHRtbCIgJiYgWSQuaW5jbHVkZXModDIucGFyZW50Tm9kZS50eXBlKTsKICAgICAgICAgIHJldHVybiAhbjIgJiYgIXIyICYmICFvMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcFcoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9ICh0Mi5wcmV2Tm9kZSAmJiB0Mi5wcmV2Tm9kZS50eXBlKSA9PT0gZTIudHlwZSAmJiBlVy5oYXMoZTIudHlwZSksIHIyID0gdDIucGFyZW50Tm9kZS50eXBlID09PSAibGlzdEl0ZW0iICYmICF0Mi5wYXJlbnROb2RlLmxvb3NlLCBvMiA9IHQyLnByZXZOb2RlICYmIHQyLnByZXZOb2RlLnR5cGUgPT09ICJsaXN0SXRlbSIgJiYgdDIucHJldk5vZGUubG9vc2UsIGkyID0gY1codDIucHJldk5vZGUpID09PSAibmV4dCIsIHUyID0gZTIudHlwZSA9PT0gImh0bWwiICYmIHQyLnByZXZOb2RlICYmIHQyLnByZXZOb2RlLnR5cGUgPT09ICJodG1sIiAmJiB0Mi5wcmV2Tm9kZS5wb3NpdGlvbi5lbmQubGluZSArIDEgPT09IGUyLnBvc2l0aW9uLnN0YXJ0LmxpbmUsIHMyID0gZTIudHlwZSA9PT0gImh0bWwiICYmIHQyLnBhcmVudE5vZGUudHlwZSA9PT0gImxpc3RJdGVtIiAmJiB0Mi5wcmV2Tm9kZSAmJiB0Mi5wcmV2Tm9kZS50eXBlID09PSAicGFyYWdyYXBoIiAmJiB0Mi5wcmV2Tm9kZS5wb3NpdGlvbi5lbmQubGluZSArIDEgPT09IGUyLnBvc2l0aW9uLnN0YXJ0LmxpbmU7CiAgICAgICAgICByZXR1cm4gbzIgfHwgIShuMiB8fCByMiB8fCBpMiB8fCB1MiB8fCBzMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGZXKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSB0Mi5wcmV2Tm9kZSAmJiB0Mi5wcmV2Tm9kZS50eXBlID09PSAibGlzdCIsIHIyID0gZTIudHlwZSA9PT0gImNvZGUiICYmIGUyLmlzSW5kZW50ZWQ7CiAgICAgICAgICByZXR1cm4gbjIgJiYgcjI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGRXKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IFtdOwogICAgICAgICAgY29uc3QgbjIgPSBbIiAiLCAuLi5BcnJheS5pc0FycmF5KHQyKSA/IHQyIDogW3QyXV07CiAgICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cChuMi5tYXAoKGUzKSA9PiAiXFwiLmNvbmNhdChlMykpLmpvaW4oInwiKSkudGVzdChlMikgPyAiPCIuY29uY2F0KGUyLCAiPiIpIDogZTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGhXKGUyLCB0MikgewogICAgICAgICAgbGV0IG4yID0gIShhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCkgfHwgYXJndW1lbnRzWzJdOwogICAgICAgICAgaWYgKCFlMikKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgaWYgKG4yKQogICAgICAgICAgICByZXR1cm4gIiAiICsgaFcoZTIsIHQyLCBmYWxzZSk7CiAgICAgICAgICBpZiAoKGUyID0gZTIucmVwbGFjZSgvXFwoWyInKV0pL2csICIkMSIpKS5pbmNsdWRlcygnIicpICYmIGUyLmluY2x1ZGVzKCInIikgJiYgIWUyLmluY2x1ZGVzKCIpIikpCiAgICAgICAgICAgIHJldHVybiAiKCIuY29uY2F0KGUyLCAiKSIpOwogICAgICAgICAgY29uc3QgcjIgPSBlMi5zcGxpdCgiJyIpLmxlbmd0aCAtIDEsIG8yID0gZTIuc3BsaXQoJyInKS5sZW5ndGggLSAxLCBpMiA9IHIyID4gbzIgPyAnIicgOiBvMiA+IHIyIHx8IHQyLnNpbmdsZVF1b3RlID8gIiciIDogJyInOwogICAgICAgICAgcmV0dXJuIGUyID0gKGUyID0gZTIucmVwbGFjZSgvXFwvLCAiXFxcXCIpKS5yZXBsYWNlKG5ldyBSZWdFeHAoIigiLmNvbmNhdChpMiwgIikiKSwgImciKSwgIlxcJDEiKSwgIiIuY29uY2F0KGkyKS5jb25jYXQoZTIpLmNvbmNhdChpMik7CiAgICAgICAgfQogICAgICAgIHZhciBnVyA9IHsgcHJlcHJvY2VzczogcSQsIHByaW50OiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBpZiAoZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBvVyhlMywgWyJsaW5rUmVmZXJlbmNlIiwgImltYWdlUmVmZXJlbmNlIl0pOwogICAgICAgICAgICByZXR1cm4gdDMgJiYgKHQzLnR5cGUgIT09ICJsaW5rUmVmZXJlbmNlIiB8fCB0My5yZWZlcmVuY2VUeXBlICE9PSAiZnVsbCIpOwogICAgICAgICAgfShlMikpCiAgICAgICAgICAgIHJldHVybiBIJCh0Mi5vcmlnaW5hbFRleHQuc2xpY2UocjIucG9zaXRpb24uc3RhcnQub2Zmc2V0LCByMi5wb3NpdGlvbi5lbmQub2Zmc2V0KSwgdDIpLm1hcCgobjMpID0+IG4zLnR5cGUgPT09ICJ3b3JkIiA/IG4zLnZhbHVlIDogbjMudmFsdWUgPT09ICIiID8gIiIgOiBpVyhlMiwgbjMudmFsdWUsIHQyKSk7CiAgICAgICAgICBzd2l0Y2ggKHIyLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiZnJvbnQtbWF0dGVyIjoKICAgICAgICAgICAgICByZXR1cm4gdDIub3JpZ2luYWxUZXh0LnNsaWNlKHIyLnBvc2l0aW9uLnN0YXJ0Lm9mZnNldCwgcjIucG9zaXRpb24uZW5kLm9mZnNldCk7CiAgICAgICAgICAgIGNhc2UgInJvb3QiOgogICAgICAgICAgICAgIHJldHVybiByMi5jaGlsZHJlbi5sZW5ndGggPT09IDAgPyAiIiA6IFtqJCh1VyhlMiwgdDIsIG4yKSksIFEkLmhhcyhhVyhyMikudHlwZSkgPyAiIiA6IFQkXTsKICAgICAgICAgICAgY2FzZSAicGFyYWdyYXBoIjoKICAgICAgICAgICAgICByZXR1cm4gc1coZTIsIHQyLCBuMiwgeyBwb3N0cHJvY2Vzc29yOiBrJCB9KTsKICAgICAgICAgICAgY2FzZSAic2VudGVuY2UiOgogICAgICAgICAgICAgIHJldHVybiBzVyhlMiwgdDIsIG4yKTsKICAgICAgICAgICAgY2FzZSAid29yZCI6IHsKICAgICAgICAgICAgICBsZXQgdDMgPSByMi52YWx1ZS5yZXBsYWNlKC9cKi9nLCAiXFwkJiIpLnJlcGxhY2UobmV3IFJlZ0V4cChbIihefCIuY29uY2F0KEokLCAiKShfKykiKSwgIihfKykoIi5jb25jYXQoSiQsICJ8JCkiKV0uam9pbigifCIpLCAiZyIpLCAoZTMsIHQ0LCBuNCwgcjMsIG8zKSA9PiAobjQgPyAiIi5jb25jYXQodDQpLmNvbmNhdChuNCkgOiAiIi5jb25jYXQocjMpLmNvbmNhdChvMykpLnJlcGxhY2UoL18vZywgIlxcXyIpKTsKICAgICAgICAgICAgICBjb25zdCBuMyA9IChlMywgdDQsIG40KSA9PiBlMy50eXBlID09PSAic2VudGVuY2UiICYmIG40ID09PSAwLCBvMiA9IChlMywgdDQsIG40KSA9PiBLJChlMy5jaGlsZHJlbltuNCAtIDFdKTsKICAgICAgICAgICAgICByZXR1cm4gdDMgIT09IHIyLnZhbHVlICYmIChlMi5tYXRjaCh2b2lkIDAsIG4zLCBvMikgfHwgZTIubWF0Y2godm9pZCAwLCBuMywgKGUzLCB0NCwgbjQpID0+IGUzLnR5cGUgPT09ICJlbXBoYXNpcyIgJiYgbjQgPT09IDAsIG8yKSkgJiYgKHQzID0gdDMucmVwbGFjZSgvXihcXD9bKl9dKSsvLCAoZTMpID0+IGUzLnJlcGxhY2UoL1xcL2csICIiKSkpLCB0MzsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJ3aGl0ZXNwYWNlIjogewogICAgICAgICAgICAgIGNvbnN0IG4zID0gZTIuZ2V0UGFyZW50Tm9kZSgpLCBvMiA9IG4zLmNoaWxkcmVuLmluZGV4T2YocjIpLCBpMiA9IG4zLmNoaWxkcmVuW28yICsgMV0sIHUyID0gaTIgJiYgL14+fF4oPzpbKistXXwjezEsNn18XGQrWykuXSkkLy50ZXN0KGkyLnZhbHVlKSA/ICJuZXZlciIgOiB0Mi5wcm9zZVdyYXA7CiAgICAgICAgICAgICAgcmV0dXJuIGlXKGUyLCByMi52YWx1ZSwgeyBwcm9zZVdyYXA6IHUyIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImVtcGhhc2lzIjogewogICAgICAgICAgICAgIGxldCBvMjsKICAgICAgICAgICAgICBpZiAoSyQocjIuY2hpbGRyZW5bMF0pKQogICAgICAgICAgICAgICAgbzIgPSB0Mi5vcmlnaW5hbFRleHRbcjIucG9zaXRpb24uc3RhcnQub2Zmc2V0XTsKICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gZTIuZ2V0UGFyZW50Tm9kZSgpLCBuMyA9IHQzLmNoaWxkcmVuLmluZGV4T2YocjIpLCBpMiA9IHQzLmNoaWxkcmVuW24zIC0gMV0sIHUyID0gdDMuY2hpbGRyZW5bbjMgKyAxXTsKICAgICAgICAgICAgICAgIG8yID0gaTIgJiYgaTIudHlwZSA9PT0gInNlbnRlbmNlIiAmJiBpMi5jaGlsZHJlbi5sZW5ndGggPiAwICYmIEQkKGkyLmNoaWxkcmVuKS50eXBlID09PSAid29yZCIgJiYgIUQkKGkyLmNoaWxkcmVuKS5oYXNUcmFpbGluZ1B1bmN0dWF0aW9uIHx8IHUyICYmIHUyLnR5cGUgPT09ICJzZW50ZW5jZSIgJiYgdTIuY2hpbGRyZW4ubGVuZ3RoID4gMCAmJiB1Mi5jaGlsZHJlblswXS50eXBlID09PSAid29yZCIgJiYgIXUyLmNoaWxkcmVuWzBdLmhhc0xlYWRpbmdQdW5jdHVhdGlvbiB8fCBvVyhlMiwgImVtcGhhc2lzIikgPyAiKiIgOiAiXyI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBbbzIsIHNXKGUyLCB0MiwgbjIpLCBvMl07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAic3Ryb25nIjoKICAgICAgICAgICAgICByZXR1cm4gWyIqKiIsIHNXKGUyLCB0MiwgbjIpLCAiKioiXTsKICAgICAgICAgICAgY2FzZSAiZGVsZXRlIjoKICAgICAgICAgICAgICByZXR1cm4gWyJ+fiIsIHNXKGUyLCB0MiwgbjIpLCAifn4iXTsKICAgICAgICAgICAgY2FzZSAiaW5saW5lQ29kZSI6IHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IEUkKHIyLnZhbHVlLCAiYCIpLCB0MyA9ICJgIi5yZXBlYXQoZTMgfHwgMSksIG4zID0gZTMgJiYgIS9eXHMvLnRlc3QocjIudmFsdWUpID8gIiAiIDogIiI7CiAgICAgICAgICAgICAgcmV0dXJuIFt0MywgbjMsIHIyLnZhbHVlLCBuMywgdDNdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgIndpa2lMaW5rIjogewogICAgICAgICAgICAgIGxldCBlMyA9ICIiOwogICAgICAgICAgICAgIHJldHVybiBlMyA9IHQyLnByb3NlV3JhcCA9PT0gInByZXNlcnZlIiA/IHIyLnZhbHVlIDogcjIudmFsdWUucmVwbGFjZSgvW1x0XG5dKy9nLCAiICIpLCBbIltbIiwgZTMsICJdXSJdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImxpbmsiOgogICAgICAgICAgICAgIHN3aXRjaCAodDIub3JpZ2luYWxUZXh0W3IyLnBvc2l0aW9uLnN0YXJ0Lm9mZnNldF0pIHsKICAgICAgICAgICAgICAgIGNhc2UgIjwiOiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGUzID0gIm1haWx0bzoiOwogICAgICAgICAgICAgICAgICByZXR1cm4gWyI8IiwgcjIudXJsLnN0YXJ0c1dpdGgoZTMpICYmIHQyLm9yaWdpbmFsVGV4dC5zbGljZShyMi5wb3NpdGlvbi5zdGFydC5vZmZzZXQgKyAxLCByMi5wb3NpdGlvbi5zdGFydC5vZmZzZXQgKyAxICsgZTMubGVuZ3RoKSAhPT0gZTMgPyByMi51cmwuc2xpY2UoZTMubGVuZ3RoKSA6IHIyLnVybCwgIj4iXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgIlsiOgogICAgICAgICAgICAgICAgICByZXR1cm4gWyJbIiwgc1coZTIsIHQyLCBuMiksICJdKCIsIGRXKHIyLnVybCwgIikiKSwgaFcocjIudGl0bGUsIHQyKSwgIikiXTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0Mi5vcmlnaW5hbFRleHQuc2xpY2UocjIucG9zaXRpb24uc3RhcnQub2Zmc2V0LCByMi5wb3NpdGlvbi5lbmQub2Zmc2V0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImltYWdlIjoKICAgICAgICAgICAgICByZXR1cm4gWyIhWyIsIHIyLmFsdCB8fCAiIiwgIl0oIiwgZFcocjIudXJsLCAiKSIpLCBoVyhyMi50aXRsZSwgdDIpLCAiKSJdOwogICAgICAgICAgICBjYXNlICJibG9ja3F1b3RlIjoKICAgICAgICAgICAgICByZXR1cm4gWyI+ICIsIFAkKCI+ICIsIHNXKGUyLCB0MiwgbjIpKV07CiAgICAgICAgICAgIGNhc2UgImhlYWRpbmciOgogICAgICAgICAgICAgIHJldHVybiBbIiMiLnJlcGVhdChyMi5kZXB0aCkgKyAiICIsIHNXKGUyLCB0MiwgbjIpXTsKICAgICAgICAgICAgY2FzZSAiY29kZSI6IHsKICAgICAgICAgICAgICBpZiAocjIuaXNJbmRlbnRlZCkgewogICAgICAgICAgICAgICAgY29uc3QgZTQgPSAiICIucmVwZWF0KDQpOwogICAgICAgICAgICAgICAgcmV0dXJuIFAkKGU0LCBbZTQsIC4uLl8kKHIyLnZhbHVlLCBUJCldKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0Mi5fX2luSnNUZW1wbGF0ZSA/ICJ+IiA6ICJgIiwgbjMgPSBlMy5yZXBlYXQoTWF0aC5tYXgoMywgQyQocjIudmFsdWUsIGUzKSArIDEpKTsKICAgICAgICAgICAgICByZXR1cm4gW24zLCByMi5sYW5nIHx8ICIiLCByMi5tZXRhID8gIiAiICsgcjIubWV0YSA6ICIiLCBUJCwgLi4uXyQoeiQocjIsIHQyLm9yaWdpbmFsVGV4dCksIFQkKSwgVCQsIG4zXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJodG1sIjogewogICAgICAgICAgICAgIGNvbnN0IHQzID0gZTIuZ2V0UGFyZW50Tm9kZSgpLCBuMyA9IHQzLnR5cGUgPT09ICJyb290IiAmJiBEJCh0My5jaGlsZHJlbikgPT09IHIyID8gcjIudmFsdWUudHJpbUVuZCgpIDogcjIudmFsdWUsIG8yID0gL148IS0tLiotLT4kL3MudGVzdChuMyk7CiAgICAgICAgICAgICAgcmV0dXJuIF8kKG4zLCBvMiA/IFQkIDogdyQoUyQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJsaXN0IjogewogICAgICAgICAgICAgIGNvbnN0IG8yID0gblcocjIsIGUyLmdldFBhcmVudE5vZGUoKSksIGkyID0gRyQocjIsIHQyKTsKICAgICAgICAgICAgICByZXR1cm4gc1coZTIsIHQyLCBuMiwgeyBwcm9jZXNzb3I6IChlMywgdTIpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHMyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGU0ID0gcjIub3JkZXJlZCA/ICh1MiA9PT0gMCA/IHIyLnN0YXJ0IDogaTIgPyAxIDogcjIuc3RhcnQgKyB1MikgKyAobzIgJSAyID09IDAgPyAiLiAiIDogIikgIikgOiBvMiAlIDIgPT0gMCA/ICItICIgOiAiKiAiOwogICAgICAgICAgICAgICAgICByZXR1cm4gcjIuaXNBbGlnbmVkIHx8IHIyLmhhc0luZGVudGVkQ29kZWJsb2NrID8gZnVuY3Rpb24oZTUsIHQzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbjMgPSByMygpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBlNSArICIgIi5yZXBlYXQobjMgPj0gNCA/IDAgOiBuMyk7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gcjMoKSB7CiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuNCA9IGU1Lmxlbmd0aCAlIHQzLnRhYldpZHRoOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG40ID09PSAwID8gMCA6IHQzLnRhYldpZHRoIC0gbjQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KGU0LCB0MikgOiBlNDsKICAgICAgICAgICAgICAgIH0oKSwgYTIgPSBlMy5nZXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGEyLmNoaWxkcmVuLmxlbmd0aCA9PT0gMiAmJiBhMi5jaGlsZHJlblsxXS50eXBlID09PSAiaHRtbCIgJiYgYTIuY2hpbGRyZW5bMF0ucG9zaXRpb24uc3RhcnQuY29sdW1uICE9PSBhMi5jaGlsZHJlblsxXS5wb3NpdGlvbi5zdGFydC5jb2x1bW4gPyBbczIsIHRXKGUzLCB0MiwgbjIsIHMyKV0gOiBbczIsIFAkKCIgIi5yZXBlYXQoczIubGVuZ3RoKSwgdFcoZTMsIHQyLCBuMiwgczIpKV07CiAgICAgICAgICAgICAgfSB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJ0aGVtYXRpY0JyZWFrIjogewogICAgICAgICAgICAgIGNvbnN0IHQzID0gclcoZTIsICJsaXN0Iik7CiAgICAgICAgICAgICAgaWYgKHQzID09PSAtMSkKICAgICAgICAgICAgICAgIHJldHVybiAiLS0tIjsKICAgICAgICAgICAgICByZXR1cm4gblcoZTIuZ2V0UGFyZW50Tm9kZSh0MyksIGUyLmdldFBhcmVudE5vZGUodDMgKyAxKSkgJSAyID09IDAgPyAiKioqIiA6ICItLS0iOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImxpbmtSZWZlcmVuY2UiOgogICAgICAgICAgICAgIHJldHVybiBbIlsiLCBzVyhlMiwgdDIsIG4yKSwgIl0iLCByMi5yZWZlcmVuY2VUeXBlID09PSAiZnVsbCIgPyBbIlsiLCByMi5pZGVudGlmaWVyLCAiXSJdIDogcjIucmVmZXJlbmNlVHlwZSA9PT0gImNvbGxhcHNlZCIgPyAiW10iIDogIiJdOwogICAgICAgICAgICBjYXNlICJpbWFnZVJlZmVyZW5jZSI6CiAgICAgICAgICAgICAgcmV0dXJuIHIyLnJlZmVyZW5jZVR5cGUgPT09ICJmdWxsIiA/IFsiIVsiLCByMi5hbHQgfHwgIiIsICJdWyIsIHIyLmlkZW50aWZpZXIsICJdIl0gOiBbIiFbIiwgcjIuYWx0LCAiXSIsIHIyLnJlZmVyZW5jZVR5cGUgPT09ICJjb2xsYXBzZWQiID8gIltdIiA6ICIiXTsKICAgICAgICAgICAgY2FzZSAiZGVmaW5pdGlvbiI6IHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IHQyLnByb3NlV3JhcCA9PT0gImFsd2F5cyIgPyB4JCA6ICIgIjsKICAgICAgICAgICAgICByZXR1cm4gSSQoWyJbIiwgcjIuaWRlbnRpZmllciwgIl06IiwgTyQoW2UzLCBkVyhyMi51cmwpLCByMi50aXRsZSA9PT0gbnVsbCA/ICIiIDogW2UzLCBoVyhyMi50aXRsZSwgdDIsIGZhbHNlKV1dKV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZvb3Rub3RlIjoKICAgICAgICAgICAgICByZXR1cm4gWyJbXiIsIHNXKGUyLCB0MiwgbjIpLCAiXSJdOwogICAgICAgICAgICBjYXNlICJmb290bm90ZVJlZmVyZW5jZSI6CiAgICAgICAgICAgICAgcmV0dXJuIFsiW14iLCByMi5pZGVudGlmaWVyLCAiXSJdOwogICAgICAgICAgICBjYXNlICJmb290bm90ZURlZmluaXRpb24iOiB7CiAgICAgICAgICAgICAgY29uc3QgbzIgPSBlMi5nZXRQYXJlbnROb2RlKCkuY2hpbGRyZW5bZTIuZ2V0TmFtZSgpICsgMV0sIGkyID0gcjIuY2hpbGRyZW4ubGVuZ3RoID09PSAxICYmIHIyLmNoaWxkcmVuWzBdLnR5cGUgPT09ICJwYXJhZ3JhcGgiICYmICh0Mi5wcm9zZVdyYXAgPT09ICJuZXZlciIgfHwgdDIucHJvc2VXcmFwID09PSAicHJlc2VydmUiICYmIHIyLmNoaWxkcmVuWzBdLnBvc2l0aW9uLnN0YXJ0LmxpbmUgPT09IHIyLmNoaWxkcmVuWzBdLnBvc2l0aW9uLmVuZC5saW5lKTsKICAgICAgICAgICAgICByZXR1cm4gWyJbXiIsIHIyLmlkZW50aWZpZXIsICJdOiAiLCBpMiA/IHNXKGUyLCB0MiwgbjIpIDogSSQoW1AkKCIgIi5yZXBlYXQoNCksIHNXKGUyLCB0MiwgbjIsIHsgcHJvY2Vzc29yOiAoZTMsIHQzKSA9PiB0MyA9PT0gMCA/IEkkKFtCJCwgbjIoKV0pIDogbjIoKSB9KSksIG8yICYmIG8yLnR5cGUgPT09ICJmb290bm90ZURlZmluaXRpb24iID8gQiQgOiAiIl0pXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJ0YWJsZSI6CiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUzLCB0MywgbjMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHIzID0gZTMuZ2V0VmFsdWUoKSwgbzIgPSBbXSwgaTIgPSBlMy5tYXAoKGU0KSA9PiBlNC5tYXAoKGU1LCByNCkgPT4gewogICAgICAgICAgICAgICAgICBjb25zdCBpMyA9IE0kKG4zKCksIHQzKS5mb3JtYXR0ZWQsIHUzID0gYiQoaTMpOwogICAgICAgICAgICAgICAgICByZXR1cm4gbzJbcjRdID0gTWF0aC5tYXgobzJbcjRdIHx8IDMsIHUzKSwgeyB0ZXh0OiBpMywgd2lkdGg6IHUzIH07CiAgICAgICAgICAgICAgICB9LCAiY2hpbGRyZW4iKSwgImNoaWxkcmVuIiksIHUyID0gYTIoZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKHQzLnByb3NlV3JhcCAhPT0gIm5ldmVyIikKICAgICAgICAgICAgICAgICAgcmV0dXJuIFtBJCwgdTJdOwogICAgICAgICAgICAgICAgY29uc3QgczIgPSBhMih0cnVlKTsKICAgICAgICAgICAgICAgIHJldHVybiBbQSQsIEkkKE4kKHMyLCB1MikpXTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGEyKGU0KSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHQ0ID0gW2wyKGkyWzBdLCBlNCksIGMyKGU0KV07CiAgICAgICAgICAgICAgICAgIHJldHVybiBpMi5sZW5ndGggPiAxICYmIHQ0LnB1c2goRiQoTCQsIGkyLnNsaWNlKDEpLm1hcCgodDUpID0+IGwyKHQ1LCBlNCkpKSksIEYkKEwkLCB0NCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjMihlNCkgewogICAgICAgICAgICAgICAgICBjb25zdCB0NCA9IG8yLm1hcCgodDUsIG40KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbzMgPSByMy5hbGlnbltuNF0sIGkzID0gbzMgPT09ICJjZW50ZXIiIHx8IG8zID09PSAibGVmdCIgPyAiOiIgOiAiLSIsIHUzID0gbzMgPT09ICJjZW50ZXIiIHx8IG8zID09PSAicmlnaHQiID8gIjoiIDogIi0iLCBzMyA9IGU0ID8gIi0iIDogIi0iLnJlcGVhdCh0NSAtIDIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAiIi5jb25jYXQoaTMpLmNvbmNhdChzMykuY29uY2F0KHUzKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiAifCAiLmNvbmNhdCh0NC5qb2luKCIgfCAiKSwgIiB8Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBsMihlNCwgdDQpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgbjQgPSBlNC5tYXAoKGU1LCBuNSkgPT4gewogICAgICAgICAgICAgICAgICAgIGxldCB7IHRleHQ6IGkzLCB3aWR0aDogdTMgfSA9IGU1OwogICAgICAgICAgICAgICAgICAgIGlmICh0NCkKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpMzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzMyA9IG8yW241XSAtIHUzLCBhMyA9IHIzLmFsaWduW241XTsKICAgICAgICAgICAgICAgICAgICBsZXQgYzMgPSAwOwogICAgICAgICAgICAgICAgICAgIGEzID09PSAicmlnaHQiID8gYzMgPSBzMyA6IGEzID09PSAiY2VudGVyIiAmJiAoYzMgPSBNYXRoLmZsb29yKHMzIC8gMikpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGwzID0gczMgLSBjMzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiIuY29uY2F0KCIgIi5yZXBlYXQoYzMpKS5jb25jYXQoaTMpLmNvbmNhdCgiICIucmVwZWF0KGwzKSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICByZXR1cm4gInwgIi5jb25jYXQobjQuam9pbigiIHwgIiksICIgfCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0oZTIsIHQyLCBuMik7CiAgICAgICAgICAgIGNhc2UgInRhYmxlQ2VsbCI6CiAgICAgICAgICAgICAgcmV0dXJuIHNXKGUyLCB0MiwgbjIpOwogICAgICAgICAgICBjYXNlICJicmVhayI6CiAgICAgICAgICAgICAgcmV0dXJuIC9ccy8udGVzdCh0Mi5vcmlnaW5hbFRleHRbcjIucG9zaXRpb24uc3RhcnQub2Zmc2V0XSkgPyBbIiAgIiwgdyQoUyQpXSA6IFsiXFwiLCBUJF07CiAgICAgICAgICAgIGNhc2UgImxpcXVpZE5vZGUiOgogICAgICAgICAgICAgIHJldHVybiBfJChyMi52YWx1ZSwgVCQpOwogICAgICAgICAgICBjYXNlICJpbXBvcnRFeHBvcnQiOgogICAgICAgICAgICAgIHJldHVybiBbcjIudmFsdWUsIFQkXTsKICAgICAgICAgICAgY2FzZSAiZXNDb21tZW50IjoKICAgICAgICAgICAgICByZXR1cm4gWyJ7LyogIiwgcjIudmFsdWUsICIgKi99Il07CiAgICAgICAgICAgIGNhc2UgImpzeCI6CiAgICAgICAgICAgICAgcmV0dXJuIHIyLnZhbHVlOwogICAgICAgICAgICBjYXNlICJtYXRoIjoKICAgICAgICAgICAgICByZXR1cm4gWyIkJCIsIFQkLCByMi52YWx1ZSA/IFsuLi5fJChyMi52YWx1ZSwgVCQpLCBUJF0gOiAiIiwgIiQkIl07CiAgICAgICAgICAgIGNhc2UgImlubGluZU1hdGgiOgogICAgICAgICAgICAgIHJldHVybiB0Mi5vcmlnaW5hbFRleHQuc2xpY2UoJCQocjIpLCBXJChyMikpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBtYXJrZG93biB0eXBlICIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHIyLnR5cGUpKSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgZW1iZWQ6IFIkLCBtYXNzYWdlQXN0Tm9kZTogVSQsIGhhc1ByZXR0aWVySWdub3JlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBOdW1iZXIoZTIuZ2V0TmFtZSgpKTsKICAgICAgICAgIHJldHVybiB0MiAhPT0gMCAmJiBjVyhlMi5nZXRQYXJlbnROb2RlKCkuY2hpbGRyZW5bdDIgLSAxXSkgPT09ICJuZXh0IjsKICAgICAgICB9LCBpbnNlcnRQcmFnbWE6IFYkIH07CiAgICAgICAgdmFyIG1XID0geyBuYW1lOiAiTWFya2Rvd24iLCB0eXBlOiAicHJvc2UiLCBjb2xvcjogIiMwODNmYTEiLCBhbGlhc2VzOiBbInBhbmRvYyJdLCBhY2VNb2RlOiAibWFya2Rvd24iLCBjb2RlbWlycm9yTW9kZTogImdmbSIsIGNvZGVtaXJyb3JNaW1lVHlwZTogInRleHQveC1nZm0iLCB3cmFwOiB0cnVlLCBleHRlbnNpb25zOiBbIi5tZCIsICIubWFya2Rvd24iLCAiLm1kb3duIiwgIi5tZHduIiwgIi5tZHgiLCAiLm1rZCIsICIubWtkbiIsICIubWtkb3duIiwgIi5yb25uIiwgIi5zY2QiLCAiLndvcmtib29rIl0sIGZpbGVuYW1lczogWyJjb250ZW50cy5sciJdLCB0bVNjb3BlOiAic291cmNlLmdmbSIsIGxhbmd1YWdlSWQ6IDIyMiB9OwogICAgICAgIGNvbnN0IHlXID0gYkUsIERXID0gZ1csIEVXID0geyBwcm9zZVdyYXA6IGJqLnByb3NlV3JhcCwgc2luZ2xlUXVvdGU6IGJqLnNpbmdsZVF1b3RlIH0sIENXID0gW3lXKG1XLCAoZTIpID0+ICh7IHNpbmNlOiAiMS44LjAiLCBwYXJzZXJzOiBbIm1hcmtkb3duIl0sIHZzY29kZUxhbmd1YWdlSWRzOiBbIm1hcmtkb3duIl0sIGZpbGVuYW1lczogWy4uLmUyLmZpbGVuYW1lcywgIlJFQURNRSJdLCBleHRlbnNpb25zOiBlMi5leHRlbnNpb25zLmZpbHRlcigoZTMpID0+IGUzICE9PSAiLm1keCIpIH0pKSwgeVcobVcsICgpID0+ICh7IG5hbWU6ICJNRFgiLCBzaW5jZTogIjEuMTUuMCIsIHBhcnNlcnM6IFsibWR4Il0sIHZzY29kZUxhbmd1YWdlSWRzOiBbIm1keCJdLCBmaWxlbmFtZXM6IFtdLCBleHRlbnNpb25zOiBbIi5tZHgiXSB9KSldOwogICAgICAgIHZhciBiVyA9IHsgbGFuZ3VhZ2VzOiBDVywgb3B0aW9uczogRVcsIHByaW50ZXJzOiB7IG1kYXN0OiBEVyB9LCBwYXJzZXJzOiB2b2lkIDAgfTsKICAgICAgICBjb25zdCB7IGlzRnJvbnRNYXR0ZXJOb2RlOiB2VyB9ID0gZGMsIEFXID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJzb3VyY2VTcGFuIiwgInN0YXJ0U291cmNlU3BhbiIsICJlbmRTb3VyY2VTcGFuIiwgIm5hbWVTcGFuIiwgInZhbHVlU3BhbiJdKTsKICAgICAgICBmdW5jdGlvbiBGVyhlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAidGV4dCIgfHwgZTIudHlwZSA9PT0gImNvbW1lbnQiIHx8IHZXKGUyKSB8fCBlMi50eXBlID09PSAieWFtbCIgfHwgZTIudHlwZSA9PT0gInRvbWwiID8gbnVsbCA6IChlMi50eXBlID09PSAiYXR0cmlidXRlIiAmJiBkZWxldGUgdDIudmFsdWUsIHZvaWQgKGUyLnR5cGUgPT09ICJkb2NUeXBlIiAmJiBkZWxldGUgdDIudmFsdWUpKTsKICAgICAgICB9CiAgICAgICAgRlcuaWdub3JlZFByb3BlcnRpZXMgPSBBVzsKICAgICAgICB2YXIgeFcgPSBGVzsKICAgICAgICBjb25zdCBTVyA9IFsiYSIsICJhYmJyIiwgImFjcm9ueW0iLCAiYWRkcmVzcyIsICJhcHBsZXQiLCAiYXJlYSIsICJhcnRpY2xlIiwgImFzaWRlIiwgImF1ZGlvIiwgImIiLCAiYmFzZSIsICJiYXNlZm9udCIsICJiZGkiLCAiYmRvIiwgImJnc291bmQiLCAiYmlnIiwgImJsaW5rIiwgImJsb2NrcXVvdGUiLCAiYm9keSIsICJiciIsICJidXR0b24iLCAiY2FudmFzIiwgImNhcHRpb24iLCAiY2VudGVyIiwgImNpdGUiLCAiY29kZSIsICJjb2wiLCAiY29sZ3JvdXAiLCAiY29tbWFuZCIsICJjb250ZW50IiwgImRhdGEiLCAiZGF0YWxpc3QiLCAiZGQiLCAiZGVsIiwgImRldGFpbHMiLCAiZGZuIiwgImRpYWxvZyIsICJkaXIiLCAiZGl2IiwgImRsIiwgImR0IiwgImVsZW1lbnQiLCAiZW0iLCAiZW1iZWQiLCAiZmllbGRzZXQiLCAiZmlnY2FwdGlvbiIsICJmaWd1cmUiLCAiZm9udCIsICJmb290ZXIiLCAiZm9ybSIsICJmcmFtZSIsICJmcmFtZXNldCIsICJoMSIsICJoMiIsICJoMyIsICJoNCIsICJoNSIsICJoNiIsICJoZWFkIiwgImhlYWRlciIsICJoZ3JvdXAiLCAiaHIiLCAiaHRtbCIsICJpIiwgImlmcmFtZSIsICJpbWFnZSIsICJpbWciLCAiaW5wdXQiLCAiaW5zIiwgImlzaW5kZXgiLCAia2JkIiwgImtleWdlbiIsICJsYWJlbCIsICJsZWdlbmQiLCAibGkiLCAibGluayIsICJsaXN0aW5nIiwgIm1haW4iLCAibWFwIiwgIm1hcmsiLCAibWFycXVlZSIsICJtYXRoIiwgIm1lbnUiLCAibWVudWl0ZW0iLCAibWV0YSIsICJtZXRlciIsICJtdWx0aWNvbCIsICJuYXYiLCAibmV4dGlkIiwgIm5vYnIiLCAibm9lbWJlZCIsICJub2ZyYW1lcyIsICJub3NjcmlwdCIsICJvYmplY3QiLCAib2wiLCAib3B0Z3JvdXAiLCAib3B0aW9uIiwgIm91dHB1dCIsICJwIiwgInBhcmFtIiwgInBpY3R1cmUiLCAicGxhaW50ZXh0IiwgInByZSIsICJwcm9ncmVzcyIsICJxIiwgInJiIiwgInJiYyIsICJycCIsICJydCIsICJydGMiLCAicnVieSIsICJzIiwgInNhbXAiLCAic2NyaXB0IiwgInNlY3Rpb24iLCAic2VsZWN0IiwgInNoYWRvdyIsICJzbG90IiwgInNtYWxsIiwgInNvdXJjZSIsICJzcGFjZXIiLCAic3BhbiIsICJzdHJpa2UiLCAic3Ryb25nIiwgInN0eWxlIiwgInN1YiIsICJzdW1tYXJ5IiwgInN1cCIsICJzdmciLCAidGFibGUiLCAidGJvZHkiLCAidGQiLCAidGVtcGxhdGUiLCAidGV4dGFyZWEiLCAidGZvb3QiLCAidGgiLCAidGhlYWQiLCAidGltZSIsICJ0aXRsZSIsICJ0ciIsICJ0cmFjayIsICJ0dCIsICJ1IiwgInVsIiwgInZhciIsICJ2aWRlbyIsICJ3YnIiLCAieG1wIl0sIHdXID0geyAiKiI6IFsiYWNjZXNza2V5IiwgImF1dG9jYXBpdGFsaXplIiwgImF1dG9mb2N1cyIsICJjbGFzcyIsICJjb250ZW50ZWRpdGFibGUiLCAiZGlyIiwgImRyYWdnYWJsZSIsICJlbnRlcmtleWhpbnQiLCAiaGlkZGVuIiwgImlkIiwgImlucHV0bW9kZSIsICJpcyIsICJpdGVtaWQiLCAiaXRlbXByb3AiLCAiaXRlbXJlZiIsICJpdGVtc2NvcGUiLCAiaXRlbXR5cGUiLCAibGFuZyIsICJub25jZSIsICJzbG90IiwgInNwZWxsY2hlY2siLCAic3R5bGUiLCAidGFiaW5kZXgiLCAidGl0bGUiLCAidHJhbnNsYXRlIl0sIGE6IFsiYWNjZXNza2V5IiwgImNoYXJzZXQiLCAiY29vcmRzIiwgImRvd25sb2FkIiwgImhyZWYiLCAiaHJlZmxhbmciLCAibmFtZSIsICJwaW5nIiwgInJlZmVycmVycG9saWN5IiwgInJlbCIsICJyZXYiLCAic2hhcGUiLCAidGFiaW5kZXgiLCAidGFyZ2V0IiwgInR5cGUiXSwgYWJicjogWyJ0aXRsZSJdLCBhcHBsZXQ6IFsiYWxpZ24iLCAiYWx0IiwgImFyY2hpdmUiLCAiY29kZSIsICJjb2RlYmFzZSIsICJoZWlnaHQiLCAiaHNwYWNlIiwgIm5hbWUiLCAib2JqZWN0IiwgInZzcGFjZSIsICJ3aWR0aCJdLCBhcmVhOiBbImFjY2Vzc2tleSIsICJhbHQiLCAiY29vcmRzIiwgImRvd25sb2FkIiwgImhyZWYiLCAiaHJlZmxhbmciLCAibm9ocmVmIiwgInBpbmciLCAicmVmZXJyZXJwb2xpY3kiLCAicmVsIiwgInNoYXBlIiwgInRhYmluZGV4IiwgInRhcmdldCIsICJ0eXBlIl0sIGF1ZGlvOiBbImF1dG9wbGF5IiwgImNvbnRyb2xzIiwgImNyb3Nzb3JpZ2luIiwgImxvb3AiLCAibXV0ZWQiLCAicHJlbG9hZCIsICJzcmMiXSwgYmFzZTogWyJocmVmIiwgInRhcmdldCJdLCBiYXNlZm9udDogWyJjb2xvciIsICJmYWNlIiwgInNpemUiXSwgYmRvOiBbImRpciJdLCBibG9ja3F1b3RlOiBbImNpdGUiXSwgYm9keTogWyJhbGluayIsICJiYWNrZ3JvdW5kIiwgImJnY29sb3IiLCAibGluayIsICJ0ZXh0IiwgInZsaW5rIl0sIGJyOiBbImNsZWFyIl0sIGJ1dHRvbjogWyJhY2Nlc3NrZXkiLCAiYXV0b2ZvY3VzIiwgImRpc2FibGVkIiwgImZvcm0iLCAiZm9ybWFjdGlvbiIsICJmb3JtZW5jdHlwZSIsICJmb3JtbWV0aG9kIiwgImZvcm1ub3ZhbGlkYXRlIiwgImZvcm10YXJnZXQiLCAibmFtZSIsICJ0YWJpbmRleCIsICJ0eXBlIiwgInZhbHVlIl0sIGNhbnZhczogWyJoZWlnaHQiLCAid2lkdGgiXSwgY2FwdGlvbjogWyJhbGlnbiJdLCBjb2w6IFsiYWxpZ24iLCAiY2hhciIsICJjaGFyb2ZmIiwgInNwYW4iLCAidmFsaWduIiwgIndpZHRoIl0sIGNvbGdyb3VwOiBbImFsaWduIiwgImNoYXIiLCAiY2hhcm9mZiIsICJzcGFuIiwgInZhbGlnbiIsICJ3aWR0aCJdLCBkYXRhOiBbInZhbHVlIl0sIGRlbDogWyJjaXRlIiwgImRhdGV0aW1lIl0sIGRldGFpbHM6IFsib3BlbiJdLCBkZm46IFsidGl0bGUiXSwgZGlhbG9nOiBbIm9wZW4iXSwgZGlyOiBbImNvbXBhY3QiXSwgZGl2OiBbImFsaWduIl0sIGRsOiBbImNvbXBhY3QiXSwgZW1iZWQ6IFsiaGVpZ2h0IiwgInNyYyIsICJ0eXBlIiwgIndpZHRoIl0sIGZpZWxkc2V0OiBbImRpc2FibGVkIiwgImZvcm0iLCAibmFtZSJdLCBmb250OiBbImNvbG9yIiwgImZhY2UiLCAic2l6ZSJdLCBmb3JtOiBbImFjY2VwdCIsICJhY2NlcHQtY2hhcnNldCIsICJhY3Rpb24iLCAiYXV0b2NvbXBsZXRlIiwgImVuY3R5cGUiLCAibWV0aG9kIiwgIm5hbWUiLCAibm92YWxpZGF0ZSIsICJ0YXJnZXQiXSwgZnJhbWU6IFsiZnJhbWVib3JkZXIiLCAibG9uZ2Rlc2MiLCAibWFyZ2luaGVpZ2h0IiwgIm1hcmdpbndpZHRoIiwgIm5hbWUiLCAibm9yZXNpemUiLCAic2Nyb2xsaW5nIiwgInNyYyJdLCBmcmFtZXNldDogWyJjb2xzIiwgInJvd3MiXSwgaDE6IFsiYWxpZ24iXSwgaDI6IFsiYWxpZ24iXSwgaDM6IFsiYWxpZ24iXSwgaDQ6IFsiYWxpZ24iXSwgaDU6IFsiYWxpZ24iXSwgaDY6IFsiYWxpZ24iXSwgaGVhZDogWyJwcm9maWxlIl0sIGhyOiBbImFsaWduIiwgIm5vc2hhZGUiLCAic2l6ZSIsICJ3aWR0aCJdLCBodG1sOiBbIm1hbmlmZXN0IiwgInZlcnNpb24iXSwgaWZyYW1lOiBbImFsaWduIiwgImFsbG93IiwgImFsbG93ZnVsbHNjcmVlbiIsICJhbGxvd3BheW1lbnRyZXF1ZXN0IiwgImFsbG93dXNlcm1lZGlhIiwgImZyYW1lYm9yZGVyIiwgImhlaWdodCIsICJsb2FkaW5nIiwgImxvbmdkZXNjIiwgIm1hcmdpbmhlaWdodCIsICJtYXJnaW53aWR0aCIsICJuYW1lIiwgInJlZmVycmVycG9saWN5IiwgInNhbmRib3giLCAic2Nyb2xsaW5nIiwgInNyYyIsICJzcmNkb2MiLCAid2lkdGgiXSwgaW1nOiBbImFsaWduIiwgImFsdCIsICJib3JkZXIiLCAiY3Jvc3NvcmlnaW4iLCAiZGVjb2RpbmciLCAiaGVpZ2h0IiwgImhzcGFjZSIsICJpc21hcCIsICJsb2FkaW5nIiwgImxvbmdkZXNjIiwgIm5hbWUiLCAicmVmZXJyZXJwb2xpY3kiLCAic2l6ZXMiLCAic3JjIiwgInNyY3NldCIsICJ1c2VtYXAiLCAidnNwYWNlIiwgIndpZHRoIl0sIGlucHV0OiBbImFjY2VwdCIsICJhY2Nlc3NrZXkiLCAiYWxpZ24iLCAiYWx0IiwgImF1dG9jb21wbGV0ZSIsICJhdXRvZm9jdXMiLCAiY2hlY2tlZCIsICJkaXJuYW1lIiwgImRpc2FibGVkIiwgImZvcm0iLCAiZm9ybWFjdGlvbiIsICJmb3JtZW5jdHlwZSIsICJmb3JtbWV0aG9kIiwgImZvcm1ub3ZhbGlkYXRlIiwgImZvcm10YXJnZXQiLCAiaGVpZ2h0IiwgImlzbWFwIiwgImxpc3QiLCAibWF4IiwgIm1heGxlbmd0aCIsICJtaW4iLCAibWlubGVuZ3RoIiwgIm11bHRpcGxlIiwgIm5hbWUiLCAicGF0dGVybiIsICJwbGFjZWhvbGRlciIsICJyZWFkb25seSIsICJyZXF1aXJlZCIsICJzaXplIiwgInNyYyIsICJzdGVwIiwgInRhYmluZGV4IiwgInRpdGxlIiwgInR5cGUiLCAidXNlbWFwIiwgInZhbHVlIiwgIndpZHRoIl0sIGluczogWyJjaXRlIiwgImRhdGV0aW1lIl0sIGlzaW5kZXg6IFsicHJvbXB0Il0sIGxhYmVsOiBbImFjY2Vzc2tleSIsICJmb3IiLCAiZm9ybSJdLCBsZWdlbmQ6IFsiYWNjZXNza2V5IiwgImFsaWduIl0sIGxpOiBbInR5cGUiLCAidmFsdWUiXSwgbGluazogWyJhcyIsICJjaGFyc2V0IiwgImNvbG9yIiwgImNyb3Nzb3JpZ2luIiwgImRpc2FibGVkIiwgImhyZWYiLCAiaHJlZmxhbmciLCAiaW1hZ2VzaXplcyIsICJpbWFnZXNyY3NldCIsICJpbnRlZ3JpdHkiLCAibWVkaWEiLCAibm9uY2UiLCAicmVmZXJyZXJwb2xpY3kiLCAicmVsIiwgInJldiIsICJzaXplcyIsICJ0YXJnZXQiLCAidGl0bGUiLCAidHlwZSJdLCBtYXA6IFsibmFtZSJdLCBtZW51OiBbImNvbXBhY3QiXSwgbWV0YTogWyJjaGFyc2V0IiwgImNvbnRlbnQiLCAiaHR0cC1lcXVpdiIsICJuYW1lIiwgInNjaGVtZSJdLCBtZXRlcjogWyJoaWdoIiwgImxvdyIsICJtYXgiLCAibWluIiwgIm9wdGltdW0iLCAidmFsdWUiXSwgb2JqZWN0OiBbImFsaWduIiwgImFyY2hpdmUiLCAiYm9yZGVyIiwgImNsYXNzaWQiLCAiY29kZWJhc2UiLCAiY29kZXR5cGUiLCAiZGF0YSIsICJkZWNsYXJlIiwgImZvcm0iLCAiaGVpZ2h0IiwgImhzcGFjZSIsICJuYW1lIiwgInN0YW5kYnkiLCAidGFiaW5kZXgiLCAidHlwZSIsICJ0eXBlbXVzdG1hdGNoIiwgInVzZW1hcCIsICJ2c3BhY2UiLCAid2lkdGgiXSwgb2w6IFsiY29tcGFjdCIsICJyZXZlcnNlZCIsICJzdGFydCIsICJ0eXBlIl0sIG9wdGdyb3VwOiBbImRpc2FibGVkIiwgImxhYmVsIl0sIG9wdGlvbjogWyJkaXNhYmxlZCIsICJsYWJlbCIsICJzZWxlY3RlZCIsICJ2YWx1ZSJdLCBvdXRwdXQ6IFsiZm9yIiwgImZvcm0iLCAibmFtZSJdLCBwOiBbImFsaWduIl0sIHBhcmFtOiBbIm5hbWUiLCAidHlwZSIsICJ2YWx1ZSIsICJ2YWx1ZXR5cGUiXSwgcHJlOiBbIndpZHRoIl0sIHByb2dyZXNzOiBbIm1heCIsICJ2YWx1ZSJdLCBxOiBbImNpdGUiXSwgc2NyaXB0OiBbImFzeW5jIiwgImNoYXJzZXQiLCAiY3Jvc3NvcmlnaW4iLCAiZGVmZXIiLCAiaW50ZWdyaXR5IiwgImxhbmd1YWdlIiwgIm5vbW9kdWxlIiwgIm5vbmNlIiwgInJlZmVycmVycG9saWN5IiwgInNyYyIsICJ0eXBlIl0sIHNlbGVjdDogWyJhdXRvY29tcGxldGUiLCAiYXV0b2ZvY3VzIiwgImRpc2FibGVkIiwgImZvcm0iLCAibXVsdGlwbGUiLCAibmFtZSIsICJyZXF1aXJlZCIsICJzaXplIiwgInRhYmluZGV4Il0sIHNsb3Q6IFsibmFtZSJdLCBzb3VyY2U6IFsibWVkaWEiLCAic2l6ZXMiLCAic3JjIiwgInNyY3NldCIsICJ0eXBlIl0sIHN0eWxlOiBbIm1lZGlhIiwgIm5vbmNlIiwgInRpdGxlIiwgInR5cGUiXSwgdGFibGU6IFsiYWxpZ24iLCAiYmdjb2xvciIsICJib3JkZXIiLCAiY2VsbHBhZGRpbmciLCAiY2VsbHNwYWNpbmciLCAiZnJhbWUiLCAicnVsZXMiLCAic3VtbWFyeSIsICJ3aWR0aCJdLCB0Ym9keTogWyJhbGlnbiIsICJjaGFyIiwgImNoYXJvZmYiLCAidmFsaWduIl0sIHRkOiBbImFiYnIiLCAiYWxpZ24iLCAiYXhpcyIsICJiZ2NvbG9yIiwgImNoYXIiLCAiY2hhcm9mZiIsICJjb2xzcGFuIiwgImhlYWRlcnMiLCAiaGVpZ2h0IiwgIm5vd3JhcCIsICJyb3dzcGFuIiwgInNjb3BlIiwgInZhbGlnbiIsICJ3aWR0aCJdLCB0ZXh0YXJlYTogWyJhY2Nlc3NrZXkiLCAiYXV0b2NvbXBsZXRlIiwgImF1dG9mb2N1cyIsICJjb2xzIiwgImRpcm5hbWUiLCAiZGlzYWJsZWQiLCAiZm9ybSIsICJtYXhsZW5ndGgiLCAibWlubGVuZ3RoIiwgIm5hbWUiLCAicGxhY2Vob2xkZXIiLCAicmVhZG9ubHkiLCAicmVxdWlyZWQiLCAicm93cyIsICJ0YWJpbmRleCIsICJ3cmFwIl0sIHRmb290OiBbImFsaWduIiwgImNoYXIiLCAiY2hhcm9mZiIsICJ2YWxpZ24iXSwgdGg6IFsiYWJiciIsICJhbGlnbiIsICJheGlzIiwgImJnY29sb3IiLCAiY2hhciIsICJjaGFyb2ZmIiwgImNvbHNwYW4iLCAiaGVhZGVycyIsICJoZWlnaHQiLCAibm93cmFwIiwgInJvd3NwYW4iLCAic2NvcGUiLCAidmFsaWduIiwgIndpZHRoIl0sIHRoZWFkOiBbImFsaWduIiwgImNoYXIiLCAiY2hhcm9mZiIsICJ2YWxpZ24iXSwgdGltZTogWyJkYXRldGltZSJdLCB0cjogWyJhbGlnbiIsICJiZ2NvbG9yIiwgImNoYXIiLCAiY2hhcm9mZiIsICJ2YWxpZ24iXSwgdHJhY2s6IFsiZGVmYXVsdCIsICJraW5kIiwgImxhYmVsIiwgInNyYyIsICJzcmNsYW5nIl0sIHVsOiBbImNvbXBhY3QiLCAidHlwZSJdLCB2aWRlbzogWyJhdXRvcGxheSIsICJjb250cm9scyIsICJjcm9zc29yaWdpbiIsICJoZWlnaHQiLCAibG9vcCIsICJtdXRlZCIsICJwbGF5c2lubGluZSIsICJwb3N0ZXIiLCAicHJlbG9hZCIsICJzcmMiLCAid2lkdGgiXSB9LCB7IGluZmVyUGFyc2VyQnlMYW5ndWFnZTogVFcsIGlzRnJvbnRNYXR0ZXJOb2RlOiBCVyB9ID0gZGMsIHsgYnVpbGRlcnM6IHsgbGluZTogTlcsIGhhcmRsaW5lOiBrVywgam9pbjogUFcgfSwgdXRpbHM6IHsgZ2V0RG9jUGFydHM6IE9XLCByZXBsYWNlVGV4dEVuZE9mTGluZTogSVcgfSB9ID0gWmMsIHsgQ1NTX0RJU1BMQVlfVEFHUzogTFcsIENTU19ESVNQTEFZX0RFRkFVTFQ6IGpXLCBDU1NfV0hJVEVfU1BBQ0VfVEFHUzogX1csIENTU19XSElURV9TUEFDRV9ERUZBVUxUOiBNVyB9ID0geyBDU1NfRElTUExBWV9UQUdTOiB7IGFyZWE6ICJub25lIiwgYmFzZTogIm5vbmUiLCBiYXNlZm9udDogIm5vbmUiLCBkYXRhbGlzdDogIm5vbmUiLCBoZWFkOiAibm9uZSIsIGxpbms6ICJub25lIiwgbWV0YTogIm5vbmUiLCBub2VtYmVkOiAibm9uZSIsIG5vZnJhbWVzOiAibm9uZSIsIHBhcmFtOiAiYmxvY2siLCBycDogIm5vbmUiLCBzY3JpcHQ6ICJibG9jayIsIHNvdXJjZTogImJsb2NrIiwgc3R5bGU6ICJub25lIiwgdGVtcGxhdGU6ICJpbmxpbmUiLCB0cmFjazogImJsb2NrIiwgdGl0bGU6ICJub25lIiwgaHRtbDogImJsb2NrIiwgYm9keTogImJsb2NrIiwgYWRkcmVzczogImJsb2NrIiwgYmxvY2txdW90ZTogImJsb2NrIiwgY2VudGVyOiAiYmxvY2siLCBkaXY6ICJibG9jayIsIGZpZ3VyZTogImJsb2NrIiwgZmlnY2FwdGlvbjogImJsb2NrIiwgZm9vdGVyOiAiYmxvY2siLCBmb3JtOiAiYmxvY2siLCBoZWFkZXI6ICJibG9jayIsIGhyOiAiYmxvY2siLCBsZWdlbmQ6ICJibG9jayIsIGxpc3Rpbmc6ICJibG9jayIsIG1haW46ICJibG9jayIsIHA6ICJibG9jayIsIHBsYWludGV4dDogImJsb2NrIiwgcHJlOiAiYmxvY2siLCB4bXA6ICJibG9jayIsIHNsb3Q6ICJjb250ZW50cyIsIHJ1Ynk6ICJydWJ5IiwgcnQ6ICJydWJ5LXRleHQiLCBhcnRpY2xlOiAiYmxvY2siLCBhc2lkZTogImJsb2NrIiwgaDE6ICJibG9jayIsIGgyOiAiYmxvY2siLCBoMzogImJsb2NrIiwgaDQ6ICJibG9jayIsIGg1OiAiYmxvY2siLCBoNjogImJsb2NrIiwgaGdyb3VwOiAiYmxvY2siLCBuYXY6ICJibG9jayIsIHNlY3Rpb246ICJibG9jayIsIGRpcjogImJsb2NrIiwgZGQ6ICJibG9jayIsIGRsOiAiYmxvY2siLCBkdDogImJsb2NrIiwgb2w6ICJibG9jayIsIHVsOiAiYmxvY2siLCBsaTogImxpc3QtaXRlbSIsIHRhYmxlOiAidGFibGUiLCBjYXB0aW9uOiAidGFibGUtY2FwdGlvbiIsIGNvbGdyb3VwOiAidGFibGUtY29sdW1uLWdyb3VwIiwgY29sOiAidGFibGUtY29sdW1uIiwgdGhlYWQ6ICJ0YWJsZS1oZWFkZXItZ3JvdXAiLCB0Ym9keTogInRhYmxlLXJvdy1ncm91cCIsIHRmb290OiAidGFibGUtZm9vdGVyLWdyb3VwIiwgdHI6ICJ0YWJsZS1yb3ciLCB0ZDogInRhYmxlLWNlbGwiLCB0aDogInRhYmxlLWNlbGwiLCBmaWVsZHNldDogImJsb2NrIiwgYnV0dG9uOiAiaW5saW5lLWJsb2NrIiwgZGV0YWlsczogImJsb2NrIiwgc3VtbWFyeTogImJsb2NrIiwgZGlhbG9nOiAiYmxvY2siLCBtZXRlcjogImlubGluZS1ibG9jayIsIHByb2dyZXNzOiAiaW5saW5lLWJsb2NrIiwgb2JqZWN0OiAiaW5saW5lLWJsb2NrIiwgdmlkZW86ICJpbmxpbmUtYmxvY2siLCBhdWRpbzogImlubGluZS1ibG9jayIsIHNlbGVjdDogImlubGluZS1ibG9jayIsIG9wdGlvbjogImJsb2NrIiwgb3B0Z3JvdXA6ICJibG9jayIgfSwgQ1NTX0RJU1BMQVlfREVGQVVMVDogImlubGluZSIsIENTU19XSElURV9TUEFDRV9UQUdTOiB7IGxpc3Rpbmc6ICJwcmUiLCBwbGFpbnRleHQ6ICJwcmUiLCBwcmU6ICJwcmUiLCB4bXA6ICJwcmUiLCBub2JyOiAibm93cmFwIiwgdGFibGU6ICJpbml0aWFsIiwgdGV4dGFyZWE6ICJwcmUtd3JhcCIgfSwgQ1NTX1dISVRFX1NQQUNFX0RFRkFVTFQ6ICJub3JtYWwiIH0sIFJXID0gR1coU1cpLCBWVyA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIGZvciAoY29uc3QgW3IyLCBvMl0gb2YgT2JqZWN0LmVudHJpZXMoZTIpKQogICAgICAgICAgICBuMltyMl0gPSB0MihvMiwgcjIpOwogICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgIH0od1csIEdXKSwgJFcgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldChbIgkiLCAiXG4iLCAiXGYiLCAiXHIiLCAiICJdKSwgV1cgPSAoZTIpID0+IGUyLnJlcGxhY2UoL1tcdFxuXGZcciBdKyQvLCAiIiksIHFXID0gKGUyKSA9PiAoKGUzKSA9PiBlMy5yZXBsYWNlKC9eW1x0XGZcciBdKj9cbi9nLCAiIikpKFdXKGUyKSksIFVXID0gKGUyKSA9PiBlMi5zcGxpdCgvW1x0XG5cZlxyIF0rLyksIHpXID0gKGUyKSA9PiBlMi5tYXRjaCgvXltcdFxuXGZcciBdKi8pWzBdOwogICAgICAgIGZ1bmN0aW9uIEdXKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgZm9yIChjb25zdCBuMiBvZiBlMikKICAgICAgICAgICAgdDJbbjJdID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gSFcoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAiZWxlbWVudCIgJiYgKGUyLmZ1bGxOYW1lID09PSAic2NyaXB0IiB8fCBlMi5mdWxsTmFtZSA9PT0gInN0eWxlIiB8fCBlMi5mdWxsTmFtZSA9PT0gInN2ZzpzdHlsZSIgfHwgb3EoZTIpICYmIChlMi5uYW1lID09PSAic2NyaXB0IiB8fCBlMi5uYW1lID09PSAic3R5bGUiKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEpXKGUyKSB7CiAgICAgICAgICByZXR1cm4gaXEoZTIpLnN0YXJ0c1dpdGgoInByZSIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBYVyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJlbGVtZW50IiAmJiBlMi5jaGlsZHJlbi5sZW5ndGggPiAwICYmIChbImh0bWwiLCAiaGVhZCIsICJ1bCIsICJvbCIsICJzZWxlY3QiXS5pbmNsdWRlcyhlMi5uYW1lKSB8fCBlMi5jc3NEaXNwbGF5LnN0YXJ0c1dpdGgoInRhYmxlIikgJiYgZTIuY3NzRGlzcGxheSAhPT0gInRhYmxlLWNlbGwiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gWVcoZTIpIHsKICAgICAgICAgIHJldHVybiBlcShlMikgfHwgZTIudHlwZSA9PT0gImVsZW1lbnQiICYmIGUyLmZ1bGxOYW1lID09PSAiYnIiIHx8IEtXKGUyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gS1coZTIpIHsKICAgICAgICAgIHJldHVybiBRVyhlMikgJiYgWlcoZTIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBRVyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLmhhc0xlYWRpbmdTcGFjZXMgJiYgKGUyLnByZXYgPyBlMi5wcmV2LnNvdXJjZVNwYW4uZW5kLmxpbmUgPCBlMi5zb3VyY2VTcGFuLnN0YXJ0LmxpbmUgOiBlMi5wYXJlbnQudHlwZSA9PT0gInJvb3QiIHx8IGUyLnBhcmVudC5zdGFydFNvdXJjZVNwYW4uZW5kLmxpbmUgPCBlMi5zb3VyY2VTcGFuLnN0YXJ0LmxpbmUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBaVyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLmhhc1RyYWlsaW5nU3BhY2VzICYmIChlMi5uZXh0ID8gZTIubmV4dC5zb3VyY2VTcGFuLnN0YXJ0LmxpbmUgPiBlMi5zb3VyY2VTcGFuLmVuZC5saW5lIDogZTIucGFyZW50LnR5cGUgPT09ICJyb290IiB8fCBlMi5wYXJlbnQuZW5kU291cmNlU3BhbiAmJiBlMi5wYXJlbnQuZW5kU291cmNlU3Bhbi5zdGFydC5saW5lID4gZTIuc291cmNlU3Bhbi5lbmQubGluZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGVxKGUyKSB7CiAgICAgICAgICBzd2l0Y2ggKGUyLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiaWVDb25kaXRpb25hbENvbW1lbnQiOgogICAgICAgICAgICBjYXNlICJjb21tZW50IjoKICAgICAgICAgICAgY2FzZSAiZGlyZWN0aXZlIjoKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgY2FzZSAiZWxlbWVudCI6CiAgICAgICAgICAgICAgcmV0dXJuIFsic2NyaXB0IiwgInNlbGVjdCJdLmluY2x1ZGVzKGUyLm5hbWUpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0cShlMikgewogICAgICAgICAgY29uc3QgeyB0eXBlOiB0MiwgbGFuZzogbjIgfSA9IGUyLmF0dHJNYXA7CiAgICAgICAgICByZXR1cm4gdDIgPT09ICJtb2R1bGUiIHx8IHQyID09PSAidGV4dC9qYXZhc2NyaXB0IiB8fCB0MiA9PT0gInRleHQvYmFiZWwiIHx8IHQyID09PSAiYXBwbGljYXRpb24vamF2YXNjcmlwdCIgfHwgbjIgPT09ICJqc3giID8gImJhYmVsIiA6IHQyID09PSAiYXBwbGljYXRpb24veC10eXBlc2NyaXB0IiB8fCBuMiA9PT0gInRzIiB8fCBuMiA9PT0gInRzeCIgPyAidHlwZXNjcmlwdCIgOiB0MiA9PT0gInRleHQvbWFya2Rvd24iID8gIm1hcmtkb3duIiA6IHQyID09PSAidGV4dC9odG1sIiA/ICJodG1sIiA6IHQyICYmICh0Mi5lbmRzV2l0aCgianNvbiIpIHx8IHQyLmVuZHNXaXRoKCJpbXBvcnRtYXAiKSkgPyAianNvbiIgOiB0MiA9PT0gInRleHQveC1oYW5kbGViYXJzLXRlbXBsYXRlIiA/ICJnbGltbWVyIiA6IHZvaWQgMDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbnEoZTIpIHsKICAgICAgICAgIHJldHVybiBlMiA9PT0gImJsb2NrIiB8fCBlMiA9PT0gImxpc3QtaXRlbSIgfHwgZTIuc3RhcnRzV2l0aCgidGFibGUiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcnEoZTIpIHsKICAgICAgICAgIHJldHVybiBpcShlMikuc3RhcnRzV2l0aCgicHJlIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG9xKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gImVsZW1lbnQiICYmICFlMi5oYXNFeHBsaWNpdE5hbWVzcGFjZSAmJiAhWyJodG1sIiwgInN2ZyJdLmluY2x1ZGVzKGUyLm5hbWVzcGFjZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlxKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gImVsZW1lbnQiICYmICghZTIubmFtZXNwYWNlIHx8IG9xKGUyKSkgJiYgX1dbZTIubmFtZV0gfHwgTVc7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHVxKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFk7CiAgICAgICAgICBmb3IgKGNvbnN0IG4yIG9mIGUyLnNwbGl0KCJcbiIpKSB7CiAgICAgICAgICAgIGlmIChuMi5sZW5ndGggPT09IDApCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGlmICghJFcuaGFzKG4yWzBdKSkKICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgY29uc3QgZTMgPSB6VyhuMikubGVuZ3RoOwogICAgICAgICAgICBuMi5sZW5ndGggIT09IGUzICYmIChlMyA8IHQyICYmICh0MiA9IGUzKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdDIgPT09IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSA/IDAgOiB0MjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc3EoZTIpIHsKICAgICAgICAgIGxldCB0MiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDogdXEoZTIpOwogICAgICAgICAgcmV0dXJuIHQyID09PSAwID8gZTIgOiBlMi5zcGxpdCgiXG4iKS5tYXAoKGUzKSA9PiBlMy5zbGljZSh0MikpLmpvaW4oIlxuIik7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGFxID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJ0ZW1wbGF0ZSIsICJzdHlsZSIsICJzY3JpcHQiXSk7CiAgICAgICAgZnVuY3Rpb24gY3EoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gbHEoZTIsIHQyKSAmJiAhYXEuaGFzKGUyLmZ1bGxOYW1lKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbHEoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIucGFyc2VyID09PSAidnVlIiAmJiBlMi50eXBlID09PSAiZWxlbWVudCIgJiYgZTIucGFyZW50LnR5cGUgPT09ICJyb290IiAmJiBlMi5mdWxsTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAiaHRtbCI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHBxKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGxxKGUyLCB0MikgJiYgKGNxKGUyLCB0MikgfHwgZTIuYXR0ck1hcC5sYW5nICYmIGUyLmF0dHJNYXAubGFuZyAhPT0gImh0bWwiKTsKICAgICAgICB9CiAgICAgICAgdmFyIGZxID0geyBIVE1MX0VMRU1FTlRfQVRUUklCVVRFUzogVlcsIEhUTUxfVEFHUzogUlcsIGh0bWxUcmltOiAoZTIpID0+ICgoZTMpID0+IGUzLnJlcGxhY2UoL15bXHRcblxmXHIgXSsvLCAiIikpKFdXKGUyKSksIGh0bWxUcmltUHJlc2VydmVJbmRlbnRhdGlvbjogcVcsIGhhc0h0bWxXaGl0ZXNwYWNlOiAoZTIpID0+IC9bXHRcblxmXHIgXS8udGVzdChlMiksIGdldExlYWRpbmdBbmRUcmFpbGluZ0h0bWxXaGl0ZXNwYWNlOiAoZTIpID0+IHsKICAgICAgICAgIGNvbnN0IFssIHQyLCBuMiwgcjJdID0gZTIubWF0Y2goL14oW1x0XG5cZlxyIF0qKSguKj8pKFtcdFxuXGZcciBdKikkL3MpOwogICAgICAgICAgcmV0dXJuIHsgbGVhZGluZ1doaXRlc3BhY2U6IHQyLCB0cmFpbGluZ1doaXRlc3BhY2U6IHIyLCB0ZXh0OiBuMiB9OwogICAgICAgIH0sIGNhbkhhdmVJbnRlcnBvbGF0aW9uOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLmNoaWxkcmVuICYmICFIVyhlMik7CiAgICAgICAgfSwgY291bnRDaGFyczogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBsZXQgbjIgPSAwOwogICAgICAgICAgZm9yIChsZXQgcjIgPSAwOyByMiA8IGUyLmxlbmd0aDsgcjIrKykKICAgICAgICAgICAgZTJbcjJdID09PSB0MiAmJiBuMisrOwogICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgIH0sIGNvdW50UGFyZW50czogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBsZXQgbjIgPSAwOwogICAgICAgICAgZm9yIChsZXQgcjIgPSBlMi5zdGFjay5sZW5ndGggLSAxOyByMiA+PSAwOyByMi0tKSB7CiAgICAgICAgICAgIGNvbnN0IG8yID0gZTIuc3RhY2tbcjJdOwogICAgICAgICAgICBvMiAmJiB0eXBlb2YgbzIgPT0gIm9iamVjdCIgJiYgIUFycmF5LmlzQXJyYXkobzIpICYmIHQyKG8yKSAmJiBuMisrOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgIH0sIGRlZGVudFN0cmluZzogc3EsIGZvcmNlQnJlYWtDaGlsZHJlbjogWFcsIGZvcmNlQnJlYWtDb250ZW50OiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFhXKGUyKSB8fCBlMi50eXBlID09PSAiZWxlbWVudCIgJiYgZTIuY2hpbGRyZW4ubGVuZ3RoID4gMCAmJiAoWyJib2R5IiwgInNjcmlwdCIsICJzdHlsZSJdLmluY2x1ZGVzKGUyLm5hbWUpIHx8IGUyLmNoaWxkcmVuLnNvbWUoKGUzKSA9PiBmdW5jdGlvbihlNCkgewogICAgICAgICAgICByZXR1cm4gZTQuY2hpbGRyZW4gJiYgZTQuY2hpbGRyZW4uc29tZSgoZTUpID0+IGU1LnR5cGUgIT09ICJ0ZXh0Iik7CiAgICAgICAgICB9KGUzKSkpIHx8IGUyLmZpcnN0Q2hpbGQgJiYgZTIuZmlyc3RDaGlsZCA9PT0gZTIubGFzdENoaWxkICYmIGUyLmZpcnN0Q2hpbGQudHlwZSAhPT0gInRleHQiICYmIFFXKGUyLmZpcnN0Q2hpbGQpICYmICghZTIubGFzdENoaWxkLmlzVHJhaWxpbmdTcGFjZVNlbnNpdGl2ZSB8fCBaVyhlMi5sYXN0Q2hpbGQpKTsKICAgICAgICB9LCBmb3JjZU5leHRFbXB0eUxpbmU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gQlcoZTIpIHx8IGUyLm5leHQgJiYgZTIuc291cmNlU3Bhbi5lbmQgJiYgZTIuc291cmNlU3Bhbi5lbmQubGluZSArIDEgPCBlMi5uZXh0LnNvdXJjZVNwYW4uc3RhcnQubGluZTsKICAgICAgICB9LCBnZXRMYXN0RGVzY2VuZGFudDogZnVuY3Rpb24gZTIodDIpIHsKICAgICAgICAgIHJldHVybiB0Mi5sYXN0Q2hpbGQgPyBlMih0Mi5sYXN0Q2hpbGQpIDogdDI7CiAgICAgICAgfSwgZ2V0Tm9kZUNzc1N0eWxlRGlzcGxheTogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBpZiAoZTIucHJldiAmJiBlMi5wcmV2LnR5cGUgPT09ICJjb21tZW50IikgewogICAgICAgICAgICBjb25zdCB0MyA9IGUyLnByZXYudmFsdWUubWF0Y2goL15ccypkaXNwbGF5OlxzKihbYS16XSspXHMqJC8pOwogICAgICAgICAgICBpZiAodDMpCiAgICAgICAgICAgICAgcmV0dXJuIHQzWzFdOwogICAgICAgICAgfQogICAgICAgICAgbGV0IG4yID0gZmFsc2U7CiAgICAgICAgICBpZiAoZTIudHlwZSA9PT0gImVsZW1lbnQiICYmIGUyLm5hbWVzcGFjZSA9PT0gInN2ZyIpIHsKICAgICAgICAgICAgaWYgKCFmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgICBsZXQgbjMgPSBlMzsKICAgICAgICAgICAgICBmb3IgKDsgbjM7ICkgewogICAgICAgICAgICAgICAgaWYgKHQzKG4zKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICBuMyA9IG4zLnBhcmVudDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9KGUyLCAoZTMpID0+IGUzLmZ1bGxOYW1lID09PSAic3ZnOmZvcmVpZ25PYmplY3QiKSkKICAgICAgICAgICAgICByZXR1cm4gZTIubmFtZSA9PT0gInN2ZyIgPyAiaW5saW5lLWJsb2NrIiA6ICJibG9jayI7CiAgICAgICAgICAgIG4yID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHN3aXRjaCAodDIuaHRtbFdoaXRlc3BhY2VTZW5zaXRpdml0eSkgewogICAgICAgICAgICBjYXNlICJzdHJpY3QiOgogICAgICAgICAgICAgIHJldHVybiAiaW5saW5lIjsKICAgICAgICAgICAgY2FzZSAiaWdub3JlIjoKICAgICAgICAgICAgICByZXR1cm4gImJsb2NrIjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXR1cm4gdDIucGFyc2VyID09PSAidnVlIiAmJiBlMi5wYXJlbnQgJiYgZTIucGFyZW50LnR5cGUgPT09ICJyb290IiA/ICJibG9jayIgOiBlMi50eXBlID09PSAiZWxlbWVudCIgJiYgKCFlMi5uYW1lc3BhY2UgfHwgbjIgfHwgb3EoZTIpKSAmJiBMV1tlMi5uYW1lXSB8fCBqVzsKICAgICAgICAgIH0KICAgICAgICB9LCBnZXROb2RlQ3NzU3R5bGVXaGl0ZVNwYWNlOiBpcSwgaGFzUHJldHRpZXJJZ25vcmU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSAhPT0gImF0dHJpYnV0ZSIgJiYgKCEhZTIucGFyZW50ICYmICh0eXBlb2YgZTIuaW5kZXggPT0gIm51bWJlciIgJiYgZTIuaW5kZXggIT09IDAgJiYgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzLnR5cGUgPT09ICJjb21tZW50IiAmJiBlMy52YWx1ZS50cmltKCkgPT09ICJwcmV0dGllci1pZ25vcmUiOwogICAgICAgICAgfShlMi5wYXJlbnQuY2hpbGRyZW5bZTIuaW5kZXggLSAxXSkpKTsKICAgICAgICB9LCBpbmZlclNjcmlwdFBhcnNlcjogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gZTIubmFtZSAhPT0gInNjcmlwdCIgfHwgZTIuYXR0ck1hcC5zcmMgPyBlMi5uYW1lID09PSAic3R5bGUiID8gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgY29uc3QgeyBsYW5nOiB0MyB9ID0gZTMuYXR0ck1hcDsKICAgICAgICAgICAgcmV0dXJuIHQzICYmIHQzICE9PSAicG9zdGNzcyIgJiYgdDMgIT09ICJjc3MiID8gdDMgPT09ICJzY3NzIiA/ICJzY3NzIiA6IHQzID09PSAibGVzcyIgPyAibGVzcyIgOiB2b2lkIDAgOiAiY3NzIjsKICAgICAgICAgIH0oZTIpIDogdDIgJiYgcHEoZTIsIHQyKSA/IHRxKGUyKSB8fCAhKCJzcmMiIGluIGUyLmF0dHJNYXApICYmIFRXKGUyLmF0dHJNYXAubGFuZywgdDIpIDogdm9pZCAwIDogZTIuYXR0ck1hcC5sYW5nIHx8IGUyLmF0dHJNYXAudHlwZSA/IHRxKGUyKSA6ICJiYWJlbCI7CiAgICAgICAgfSwgaXNWdWVDdXN0b21CbG9jazogY3EsIGlzVnVlTm9uSHRtbEJsb2NrOiBwcSwgaXNWdWVTbG90QXR0cmlidXRlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBlMi5mdWxsTmFtZTsKICAgICAgICAgIHJldHVybiB0Mi5jaGFyQXQoMCkgPT09ICIjIiB8fCB0MiA9PT0gInNsb3Qtc2NvcGUiIHx8IHQyID09PSAidi1zbG90IiB8fCB0Mi5zdGFydHNXaXRoKCJ2LXNsb3Q6Iik7CiAgICAgICAgfSwgaXNWdWVTZmNCaW5kaW5nc0F0dHJpYnV0ZTogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IGUyLnBhcmVudDsKICAgICAgICAgIGlmICghbHEobjIsIHQyKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgY29uc3QgcjIgPSBuMi5mdWxsTmFtZSwgbzIgPSBlMi5mdWxsTmFtZTsKICAgICAgICAgIHJldHVybiByMiA9PT0gInNjcmlwdCIgJiYgbzIgPT09ICJzZXR1cCIgfHwgcjIgPT09ICJzdHlsZSIgJiYgbzIgPT09ICJ2YXJzIjsKICAgICAgICB9LCBpc0RhbmdsaW5nU3BhY2VTZW5zaXRpdmVOb2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuICEodDIgPSBlMi5jc3NEaXNwbGF5LCBucSh0MikgfHwgdDIgPT09ICJpbmxpbmUtYmxvY2siIHx8IEhXKGUyKSk7CiAgICAgICAgICB2YXIgdDI7CiAgICAgICAgfSwgaXNJbmRlbnRhdGlvblNlbnNpdGl2ZU5vZGU6IEpXLCBpc0xlYWRpbmdTcGFjZVNlbnNpdGl2ZU5vZGU6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKEJXKGUyKSkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICgoZTIudHlwZSA9PT0gInRleHQiIHx8IGUyLnR5cGUgPT09ICJpbnRlcnBvbGF0aW9uIikgJiYgZTIucHJldiAmJiAoZTIucHJldi50eXBlID09PSAidGV4dCIgfHwgZTIucHJldi50eXBlID09PSAiaW50ZXJwb2xhdGlvbiIpKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoIWUyLnBhcmVudCB8fCBlMi5wYXJlbnQuY3NzRGlzcGxheSA9PT0gIm5vbmUiKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKHJxKGUyLnBhcmVudCkpCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmICghZTIucHJldiAmJiAoZTIucGFyZW50LnR5cGUgPT09ICJyb290IiB8fCBycShlMikgJiYgZTIucGFyZW50IHx8IEhXKGUyLnBhcmVudCkgfHwgY3EoZTIucGFyZW50LCB0MikgfHwgKG4zID0gZTIucGFyZW50LmNzc0Rpc3BsYXksIG5xKG4zKSB8fCBuMyA9PT0gImlubGluZS1ibG9jayIpKSkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHZhciBuMzsKICAgICAgICAgICAgaWYgKGUyLnByZXYgJiYgIWZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgICAgcmV0dXJuICFucShlMyk7CiAgICAgICAgICAgIH0oZTIucHJldi5jc3NEaXNwbGF5KSkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSgpOwogICAgICAgICAgcmV0dXJuIG4yICYmICFlMi5wcmV2ICYmIGUyLnBhcmVudCAmJiBlMi5wYXJlbnQudGFnRGVmaW5pdGlvbiAmJiBlMi5wYXJlbnQudGFnRGVmaW5pdGlvbi5pZ25vcmVGaXJzdExmID8gZTIudHlwZSA9PT0gImludGVycG9sYXRpb24iIDogbjI7CiAgICAgICAgfSwgaXNQcmVMaWtlTm9kZTogcnEsIGlzU2NyaXB0TGlrZVRhZzogSFcsIGlzVGV4dExpa2VOb2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJ0ZXh0IiB8fCBlMi50eXBlID09PSAiY29tbWVudCI7CiAgICAgICAgfSwgaXNUcmFpbGluZ1NwYWNlU2Vuc2l0aXZlTm9kZTogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gIUJXKGUyKSAmJiAoIShlMi50eXBlICE9PSAidGV4dCIgJiYgZTIudHlwZSAhPT0gImludGVycG9sYXRpb24iIHx8ICFlMi5uZXh0IHx8IGUyLm5leHQudHlwZSAhPT0gInRleHQiICYmIGUyLm5leHQudHlwZSAhPT0gImludGVycG9sYXRpb24iKSB8fCAhKCFlMi5wYXJlbnQgfHwgZTIucGFyZW50LmNzc0Rpc3BsYXkgPT09ICJub25lIikgJiYgKCEhcnEoZTIucGFyZW50KSB8fCAhKCFlMi5uZXh0ICYmIChlMi5wYXJlbnQudHlwZSA9PT0gInJvb3QiIHx8IHJxKGUyKSAmJiBlMi5wYXJlbnQgfHwgSFcoZTIucGFyZW50KSB8fCBjcShlMi5wYXJlbnQsIHQyKSB8fCAobjIgPSBlMi5wYXJlbnQuY3NzRGlzcGxheSwgbnEobjIpIHx8IG4yID09PSAiaW5saW5lLWJsb2NrIikpKSAmJiAhKGUyLm5leHQgJiYgIWZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiAhbnEoZTMpOwogICAgICAgICAgfShlMi5uZXh0LmNzc0Rpc3BsYXkpKSkpOwogICAgICAgICAgdmFyIG4yOwogICAgICAgIH0sIGlzV2hpdGVzcGFjZVNlbnNpdGl2ZU5vZGU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gSFcoZTIpIHx8IGUyLnR5cGUgPT09ICJpbnRlcnBvbGF0aW9uIiB8fCBKVyhlMik7CiAgICAgICAgfSwgaXNVbmtub3duTmFtZXNwYWNlOiBvcSwgcHJlZmVySGFyZGxpbmVBc0xlYWRpbmdTcGFjZXM6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZXEoZTIpIHx8IGUyLnByZXYgJiYgWVcoZTIucHJldikgfHwgS1coZTIpOwogICAgICAgIH0sIHByZWZlckhhcmRsaW5lQXNUcmFpbGluZ1NwYWNlczogWVcsIHNob3VsZFByZXNlcnZlQ29udGVudDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gIShlMi50eXBlICE9PSAiaWVDb25kaXRpb25hbENvbW1lbnQiIHx8ICFlMi5sYXN0Q2hpbGQgfHwgZTIubGFzdENoaWxkLmlzU2VsZkNsb3NpbmcgfHwgZTIubGFzdENoaWxkLmVuZFNvdXJjZVNwYW4pIHx8IChlMi50eXBlID09PSAiaWVDb25kaXRpb25hbENvbW1lbnQiICYmICFlMi5jb21wbGV0ZSB8fCAoISghcnEoZTIpIHx8ICFlMi5jaGlsZHJlbi5zb21lKChlMykgPT4gZTMudHlwZSAhPT0gInRleHQiICYmIGUzLnR5cGUgIT09ICJpbnRlcnBvbGF0aW9uIikpIHx8ICEoIXBxKGUyLCB0MikgfHwgSFcoZTIpIHx8IGUyLnR5cGUgPT09ICJpbnRlcnBvbGF0aW9uIikpKTsKICAgICAgICB9LCB1bmVzY2FwZVF1b3RlRW50aXRpZXM6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIucmVwbGFjZSgvJmFwb3M7L2csICInIikucmVwbGFjZSgvJnF1b3Q7L2csICciJyk7CiAgICAgICAgfSwgZ2V0VGV4dFZhbHVlUGFydHM6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IGUyLnZhbHVlOwogICAgICAgICAgcmV0dXJuIGUyLnBhcmVudC5pc1doaXRlc3BhY2VTZW5zaXRpdmUgPyBlMi5wYXJlbnQuaXNJbmRlbnRhdGlvblNlbnNpdGl2ZSA/IElXKHQyKSA6IElXKHNxKHFXKHQyKSksIGtXKSA6IE9XKFBXKE5XLCBVVyh0MikpKTsKICAgICAgICB9IH0sIGRxID0ge30sIGhxID0ge307CiAgICAgICAgIWZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBmdW5jdGlvbiB0Mih0MykgewogICAgICAgICAgICByZXR1cm4gZTIuJDAgPD0gdDMgJiYgdDMgPD0gZTIuJDk7CiAgICAgICAgICB9CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KSwgZTIuJEVPRiA9IDAsIGUyLiRCU1BBQ0UgPSA4LCBlMi4kVEFCID0gOSwgZTIuJExGID0gMTAsIGUyLiRWVEFCID0gMTEsIGUyLiRGRiA9IDEyLCBlMi4kQ1IgPSAxMywgZTIuJFNQQUNFID0gMzIsIGUyLiRCQU5HID0gMzMsIGUyLiREUSA9IDM0LCBlMi4kSEFTSCA9IDM1LCBlMi4kJCA9IDM2LCBlMi4kUEVSQ0VOVCA9IDM3LCBlMi4kQU1QRVJTQU5EID0gMzgsIGUyLiRTUSA9IDM5LCBlMi4kTFBBUkVOID0gNDAsIGUyLiRSUEFSRU4gPSA0MSwgZTIuJFNUQVIgPSA0MiwgZTIuJFBMVVMgPSA0MywgZTIuJENPTU1BID0gNDQsIGUyLiRNSU5VUyA9IDQ1LCBlMi4kUEVSSU9EID0gNDYsIGUyLiRTTEFTSCA9IDQ3LCBlMi4kQ09MT04gPSA1OCwgZTIuJFNFTUlDT0xPTiA9IDU5LCBlMi4kTFQgPSA2MCwgZTIuJEVRID0gNjEsIGUyLiRHVCA9IDYyLCBlMi4kUVVFU1RJT04gPSA2MywgZTIuJDAgPSA0OCwgZTIuJDcgPSA1NSwgZTIuJDkgPSA1NywgZTIuJEEgPSA2NSwgZTIuJEUgPSA2OSwgZTIuJEYgPSA3MCwgZTIuJFggPSA4OCwgZTIuJFogPSA5MCwgZTIuJExCUkFDS0VUID0gOTEsIGUyLiRCQUNLU0xBU0ggPSA5MiwgZTIuJFJCUkFDS0VUID0gOTMsIGUyLiRDQVJFVCA9IDk0LCBlMi4kXyA9IDk1LCBlMi4kYSA9IDk3LCBlMi4kYiA9IDk4LCBlMi4kZSA9IDEwMSwgZTIuJGYgPSAxMDIsIGUyLiRuID0gMTEwLCBlMi4kciA9IDExNCwgZTIuJHQgPSAxMTYsIGUyLiR1ID0gMTE3LCBlMi4kdiA9IDExOCwgZTIuJHggPSAxMjAsIGUyLiR6ID0gMTIyLCBlMi4kTEJSQUNFID0gMTIzLCBlMi4kQkFSID0gMTI0LCBlMi4kUkJSQUNFID0gMTI1LCBlMi4kTkJTUCA9IDE2MCwgZTIuJFBJUEUgPSAxMjQsIGUyLiRUSUxEQSA9IDEyNiwgZTIuJEFUID0gNjQsIGUyLiRCVCA9IDk2LCBlMi5pc1doaXRlc3BhY2UgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gdDMgPj0gZTIuJFRBQiAmJiB0MyA8PSBlMi4kU1BBQ0UgfHwgdDMgPT0gZTIuJE5CU1A7CiAgICAgICAgICB9LCBlMi5pc0RpZ2l0ID0gdDIsIGUyLmlzQXNjaWlMZXR0ZXIgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gdDMgPj0gZTIuJGEgJiYgdDMgPD0gZTIuJHogfHwgdDMgPj0gZTIuJEEgJiYgdDMgPD0gZTIuJFo7CiAgICAgICAgICB9LCBlMi5pc0FzY2lpSGV4RGlnaXQgPSBmdW5jdGlvbihuMikgewogICAgICAgICAgICByZXR1cm4gbjIgPj0gZTIuJGEgJiYgbjIgPD0gZTIuJGYgfHwgbjIgPj0gZTIuJEEgJiYgbjIgPD0gZTIuJEYgfHwgdDIobjIpOwogICAgICAgICAgfSwgZTIuaXNOZXdMaW5lID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgcmV0dXJuIHQzID09PSBlMi4kTEYgfHwgdDMgPT09IGUyLiRDUjsKICAgICAgICAgIH0sIGUyLmlzT2N0YWxEaWdpdCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiBlMi4kMCA8PSB0MyAmJiB0MyA8PSBlMi4kNzsKICAgICAgICAgIH07CiAgICAgICAgfShocSk7CiAgICAgICAgdmFyIGdxID0ge30sIG1xID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG1xLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgY2xhc3MgeXEgewogICAgICAgICAgY29uc3RydWN0b3IoZTIsIHQyLCBuMikgewogICAgICAgICAgICB0aGlzLmZpbGVQYXRoID0gZTIsIHRoaXMubmFtZSA9IHQyLCB0aGlzLm1lbWJlcnMgPSBuMjsKICAgICAgICAgIH0KICAgICAgICAgIGFzc2VydE5vTWVtYmVycygpIHsKICAgICAgICAgICAgaWYgKHRoaXMubWVtYmVycy5sZW5ndGgpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbGxlZ2FsIHN0YXRlOiBzeW1ib2wgd2l0aG91dCBtZW1iZXJzIGV4cGVjdGVkLCBidXQgZ290ICIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHRoaXMpLCAiLiIpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbXEuU3RhdGljU3ltYm9sID0geXE7CiAgICAgICAgbXEuU3RhdGljU3ltYm9sQ2FjaGUgPSBjbGFzcyB7CiAgICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgdGhpcy5jYWNoZSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgICAgICAgICB9CiAgICAgICAgICBnZXQoZTIsIHQyLCBuMikgewogICAgICAgICAgICBjb25zdCByMiA9IChuMiA9IG4yIHx8IFtdKS5sZW5ndGggPyAiLiIuY29uY2F0KG4yLmpvaW4oIi4iKSkgOiAiIiwgbzIgPSAnIicuY29uY2F0KGUyLCAnIi4nKS5jb25jYXQodDIpLmNvbmNhdChyMik7CiAgICAgICAgICAgIGxldCBpMiA9IHRoaXMuY2FjaGUuZ2V0KG8yKTsKICAgICAgICAgICAgcmV0dXJuIGkyIHx8IChpMiA9IG5ldyB5cShlMiwgdDIsIG4yKSwgdGhpcy5jYWNoZS5zZXQobzIsIGkyKSksIGkyOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgdmFyIERxID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KERxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgY29uc3QgRXEgPSAvLSsoW2EtejAtOV0pL2c7CiAgICAgICAgZnVuY3Rpb24gQ3EoZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5pbmRleE9mKHQyKTsKICAgICAgICAgIHJldHVybiByMiA9PSAtMSA/IG4yIDogW2UyLnNsaWNlKDAsIHIyKS50cmltKCksIGUyLnNsaWNlKHIyICsgMSkudHJpbSgpXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYnEoZTIsIHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoZTIpID8gdDIudmlzaXRBcnJheShlMiwgbjIpIDogZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBlMyA9PSAib2JqZWN0IiAmJiBlMyAhPT0gbnVsbCAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YoZTMpID09PSBGcTsKICAgICAgICAgIH0oZTIpID8gdDIudmlzaXRTdHJpbmdNYXAoZTIsIG4yKSA6IGUyID09IG51bGwgfHwgdHlwZW9mIGUyID09ICJzdHJpbmciIHx8IHR5cGVvZiBlMiA9PSAibnVtYmVyIiB8fCB0eXBlb2YgZTIgPT0gImJvb2xlYW4iID8gdDIudmlzaXRQcmltaXRpdmUoZTIsIG4yKSA6IHQyLnZpc2l0T3RoZXIoZTIsIG4yKTsKICAgICAgICB9CiAgICAgICAgRHEuZGFzaENhc2VUb0NhbWVsQ2FzZSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIucmVwbGFjZShFcSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZvciAodmFyIGUzID0gYXJndW1lbnRzLmxlbmd0aCwgdDIgPSBuZXcgQXJyYXkoZTMpLCBuMiA9IDA7IG4yIDwgZTM7IG4yKyspCiAgICAgICAgICAgICAgdDJbbjJdID0gYXJndW1lbnRzW24yXTsKICAgICAgICAgICAgcmV0dXJuIHQyWzFdLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9LCBEcS5zcGxpdEF0Q29sb24gPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBDcShlMiwgIjoiLCB0Mik7CiAgICAgICAgfSwgRHEuc3BsaXRBdFBlcmlvZCA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIENxKGUyLCAiLiIsIHQyKTsKICAgICAgICB9LCBEcS52aXNpdFZhbHVlID0gYnEsIERxLmlzRGVmaW5lZCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgIT0gbnVsbDsKICAgICAgICB9LCBEcS5ub1VuZGVmaW5lZCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgPT09IHZvaWQgMCA/IG51bGwgOiBlMjsKICAgICAgICB9OwogICAgICAgIERxLlZhbHVlVHJhbnNmb3JtZXIgPSBjbGFzcyB7CiAgICAgICAgICB2aXNpdEFycmF5KGUyLCB0MikgewogICAgICAgICAgICByZXR1cm4gZTIubWFwKChlMykgPT4gYnEoZTMsIHRoaXMsIHQyKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2aXNpdFN0cmluZ01hcChlMiwgdDIpIHsKICAgICAgICAgICAgY29uc3QgbjIgPSB7fTsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKGUyKS5mb3JFYWNoKChyMikgPT4gewogICAgICAgICAgICAgIG4yW3IyXSA9IGJxKGUyW3IyXSwgdGhpcywgdDIpOwogICAgICAgICAgICB9KSwgbjI7CiAgICAgICAgICB9CiAgICAgICAgICB2aXNpdFByaW1pdGl2ZShlMiwgdDIpIHsKICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgfQogICAgICAgICAgdmlzaXRPdGhlcihlMiwgdDIpIHsKICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgfQogICAgICAgIH0sIERxLlN5bmNBc3luYyA9IHsgYXNzZXJ0U3luYzogKGUyKSA9PiB7CiAgICAgICAgICBpZiAoeHEoZTIpKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIklsbGVnYWwgc3RhdGU6IHZhbHVlIGNhbm5vdCBiZSBhIHByb21pc2UiKTsKICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICB9LCB0aGVuOiAoZTIsIHQyKSA9PiB4cShlMikgPyBlMi50aGVuKHQyKSA6IHQyKGUyKSwgYWxsOiAoZTIpID0+IGUyLnNvbWUoeHEpID8gUHJvbWlzZS5hbGwoZTIpIDogZTIgfSwgRHEuZXJyb3IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnRlcm5hbCBFcnJvcjogIi5jb25jYXQoZTIpKTsKICAgICAgICB9LCBEcS5zeW50YXhFcnJvciA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgbjIgPSBFcnJvcihlMik7CiAgICAgICAgICByZXR1cm4gbjJbdnFdID0gdHJ1ZSwgdDIgJiYgKG4yW0FxXSA9IHQyKSwgbjI7CiAgICAgICAgfTsKICAgICAgICBjb25zdCB2cSA9ICJuZ1N5bnRheEVycm9yIiwgQXEgPSAibmdQYXJzZUVycm9ycyI7CiAgICAgICAgRHEuaXNTeW50YXhFcnJvciA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTJbdnFdOwogICAgICAgIH0sIERxLmdldFBhcnNlRXJyb3JzID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMltBcV0gfHwgW107CiAgICAgICAgfSwgRHEuZXNjYXBlUmVnRXhwID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5yZXBsYWNlKC8oWy4qKz9ePSE6JHt9KCl8W1xdXC9cXF0pL2csICJcXCQxIik7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBGcSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih7fSk7CiAgICAgICAgZnVuY3Rpb24geHEoZTIpIHsKICAgICAgICAgIHJldHVybiAhIWUyICYmIHR5cGVvZiBlMi50aGVuID09ICJmdW5jdGlvbiI7CiAgICAgICAgfQogICAgICAgIERxLnV0ZjhFbmNvZGUgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgbGV0IHQyID0gIiI7CiAgICAgICAgICBmb3IgKGxldCBuMiA9IDA7IG4yIDwgZTIubGVuZ3RoOyBuMisrKSB7CiAgICAgICAgICAgIGxldCByMiA9IGUyLmNoYXJDb2RlQXQobjIpOwogICAgICAgICAgICBpZiAocjIgPj0gNTUyOTYgJiYgcjIgPD0gNTYzMTkgJiYgZTIubGVuZ3RoID4gbjIgKyAxKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSBlMi5jaGFyQ29kZUF0KG4yICsgMSk7CiAgICAgICAgICAgICAgdDMgPj0gNTYzMjAgJiYgdDMgPD0gNTczNDMgJiYgKG4yKyssIHIyID0gKHIyIC0gNTUyOTYgPDwgMTApICsgdDMgLSA1NjMyMCArIDY1NTM2KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByMiA8PSAxMjcgPyB0MiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHIyKSA6IHIyIDw9IDIwNDcgPyB0MiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHIyID4+IDYgJiAzMSB8IDE5MiwgNjMgJiByMiB8IDEyOCkgOiByMiA8PSA2NTUzNSA/IHQyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUocjIgPj4gMTIgfCAyMjQsIHIyID4+IDYgJiA2MyB8IDEyOCwgNjMgJiByMiB8IDEyOCkgOiByMiA8PSAyMDk3MTUxICYmICh0MiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHIyID4+IDE4ICYgNyB8IDI0MCwgcjIgPj4gMTIgJiA2MyB8IDEyOCwgcjIgPj4gNiAmIDYzIHwgMTI4LCA2MyAmIHIyIHwgMTI4KSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfSwgRHEuc3RyaW5naWZ5ID0gZnVuY3Rpb24gZTIodDIpIHsKICAgICAgICAgIGlmICh0eXBlb2YgdDIgPT0gInN0cmluZyIpCiAgICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICAgIGlmICh0MiBpbnN0YW5jZW9mIEFycmF5KQogICAgICAgICAgICByZXR1cm4gIlsiICsgdDIubWFwKGUyKS5qb2luKCIsICIpICsgIl0iOwogICAgICAgICAgaWYgKHQyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiAiIiArIHQyOwogICAgICAgICAgaWYgKHQyLm92ZXJyaWRkZW5OYW1lKQogICAgICAgICAgICByZXR1cm4gIiIuY29uY2F0KHQyLm92ZXJyaWRkZW5OYW1lKTsKICAgICAgICAgIGlmICh0Mi5uYW1lKQogICAgICAgICAgICByZXR1cm4gIiIuY29uY2F0KHQyLm5hbWUpOwogICAgICAgICAgaWYgKCF0Mi50b1N0cmluZykKICAgICAgICAgICAgcmV0dXJuICJvYmplY3QiOwogICAgICAgICAgY29uc3QgbjIgPSB0Mi50b1N0cmluZygpOwogICAgICAgICAgaWYgKG4yID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiAiIiArIG4yOwogICAgICAgICAgY29uc3QgcjIgPSBuMi5pbmRleE9mKCJcbiIpOwogICAgICAgICAgcmV0dXJuIHIyID09PSAtMSA/IG4yIDogbjIuc3Vic3RyaW5nKDAsIHIyKTsKICAgICAgICB9LCBEcS5yZXNvbHZlRm9yd2FyZFJlZiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGUyID09ICJmdW5jdGlvbiIgJiYgZTIuaGFzT3duUHJvcGVydHkoIl9fZm9yd2FyZF9yZWZfXyIpID8gZTIoKSA6IGUyOwogICAgICAgIH0sIERxLmlzUHJvbWlzZSA9IHhxOwogICAgICAgIERxLlZlcnNpb24gPSBjbGFzcyB7CiAgICAgICAgICBjb25zdHJ1Y3RvcihlMikgewogICAgICAgICAgICB0aGlzLmZ1bGwgPSBlMjsKICAgICAgICAgICAgY29uc3QgdDIgPSBlMi5zcGxpdCgiLiIpOwogICAgICAgICAgICB0aGlzLm1ham9yID0gdDJbMF0sIHRoaXMubWlub3IgPSB0MlsxXSwgdGhpcy5wYXRjaCA9IHQyLnNsaWNlKDIpLmpvaW4oIi4iKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNvbnN0IFNxID0gdHlwZW9mIHdpbmRvdyAhPSAidW5kZWZpbmVkIiAmJiB3aW5kb3csIHdxID0gdHlwZW9mIHNlbGYgIT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIFdvcmtlckdsb2JhbFNjb3BlICE9ICJ1bmRlZmluZWQiICYmIHNlbGYgaW5zdGFuY2VvZiBXb3JrZXJHbG9iYWxTY29wZSAmJiBzZWxmLCBUcSA9IGUgIT09IHZvaWQgMCAmJiBlIHx8IFNxIHx8IHdxOwogICAgICAgIERxLmdsb2JhbCA9IFRxLCBmdW5jdGlvbihlMikgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgICBjb25zdCB0MiA9IG1xLCBuMiA9IERxLCByMiA9IC9eKD86KD86XFsoW15cXV0rKVxdKXwoPzpcKChbXlwpXSspXCkpKXwoXEBbLVx3XSspJC87CiAgICAgICAgICBmdW5jdGlvbiBvMihlMykgewogICAgICAgICAgICByZXR1cm4gZTMucmVwbGFjZSgvXFcvZywgIl8iKTsKICAgICAgICAgIH0KICAgICAgICAgIGUyLnNhbml0aXplSWRlbnRpZmllciA9IG8yOwogICAgICAgICAgbGV0IGkyID0gMDsKICAgICAgICAgIGZ1bmN0aW9uIHUyKGUzKSB7CiAgICAgICAgICAgIGlmICghZTMgfHwgIWUzLnJlZmVyZW5jZSkKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgY29uc3QgcjMgPSBlMy5yZWZlcmVuY2U7CiAgICAgICAgICAgIGlmIChyMyBpbnN0YW5jZW9mIHQyLlN0YXRpY1N5bWJvbCkKICAgICAgICAgICAgICByZXR1cm4gcjMubmFtZTsKICAgICAgICAgICAgaWYgKHIzLl9fYW5vbnltb3VzVHlwZSkKICAgICAgICAgICAgICByZXR1cm4gcjMuX19hbm9ueW1vdXNUeXBlOwogICAgICAgICAgICBsZXQgdTMgPSBuMi5zdHJpbmdpZnkocjMpOwogICAgICAgICAgICByZXR1cm4gdTMuaW5kZXhPZigiKCIpID49IDAgPyAodTMgPSAiYW5vbnltb3VzXyIuY29uY2F0KGkyKyspLCByMy5fX2Fub255bW91c1R5cGUgPSB1MykgOiB1MyA9IG8yKHUzKSwgdTM7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgczI7CiAgICAgICAgICBlMi5pZGVudGlmaWVyTmFtZSA9IHUyLCBlMi5pZGVudGlmaWVyTW9kdWxlVXJsID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgY29uc3QgcjMgPSBlMy5yZWZlcmVuY2U7CiAgICAgICAgICAgIHJldHVybiByMyBpbnN0YW5jZW9mIHQyLlN0YXRpY1N5bWJvbCA/IHIzLmZpbGVQYXRoIDogIi4vIi5jb25jYXQobjIuc3RyaW5naWZ5KHIzKSk7CiAgICAgICAgICB9LCBlMi52aWV3Q2xhc3NOYW1lID0gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIHJldHVybiAiVmlld18iLmNvbmNhdCh1Mih7IHJlZmVyZW5jZTogZTMgfSksICJfIikuY29uY2F0KHQzKTsKICAgICAgICAgIH0sIGUyLnJlbmRlcmVyVHlwZU5hbWUgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gIlJlbmRlclR5cGVfIi5jb25jYXQodTIoeyByZWZlcmVuY2U6IGUzIH0pKTsKICAgICAgICAgIH0sIGUyLmhvc3RWaWV3Q2xhc3NOYW1lID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuICJIb3N0Vmlld18iLmNvbmNhdCh1Mih7IHJlZmVyZW5jZTogZTMgfSkpOwogICAgICAgICAgfSwgZTIuY29tcG9uZW50RmFjdG9yeU5hbWUgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gIiIuY29uY2F0KHUyKHsgcmVmZXJlbmNlOiBlMyB9KSwgIk5nRmFjdG9yeSIpOwogICAgICAgICAgfSwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgZTNbZTMuUGlwZSA9IDBdID0gIlBpcGUiLCBlM1tlMy5EaXJlY3RpdmUgPSAxXSA9ICJEaXJlY3RpdmUiLCBlM1tlMy5OZ01vZHVsZSA9IDJdID0gIk5nTW9kdWxlIiwgZTNbZTMuSW5qZWN0YWJsZSA9IDNdID0gIkluamVjdGFibGUiOwogICAgICAgICAgfShzMiA9IGUyLkNvbXBpbGVTdW1tYXJ5S2luZCB8fCAoZTIuQ29tcGlsZVN1bW1hcnlLaW5kID0ge30pKSwgZTIudG9rZW5OYW1lID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzLnZhbHVlICE9IG51bGwgPyBvMihlMy52YWx1ZSkgOiB1MihlMy5pZGVudGlmaWVyKTsKICAgICAgICAgIH0sIGUyLnRva2VuUmVmZXJlbmNlID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzLmlkZW50aWZpZXIgIT0gbnVsbCA/IGUzLmlkZW50aWZpZXIucmVmZXJlbmNlIDogZTMudmFsdWU7CiAgICAgICAgICB9OwogICAgICAgICAgZTIuQ29tcGlsZVN0eWxlc2hlZXRNZXRhZGF0YSA9IGNsYXNzIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgICAgbGV0IHsgbW9kdWxlVXJsOiBlMywgc3R5bGVzOiB0Mywgc3R5bGVVcmxzOiBuMyB9ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgICAgICAgICB0aGlzLm1vZHVsZVVybCA9IGUzIHx8IG51bGwsIHRoaXMuc3R5bGVzID0gYzIodDMpLCB0aGlzLnN0eWxlVXJscyA9IGMyKG4zKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIGUyLkNvbXBpbGVUZW1wbGF0ZU1ldGFkYXRhID0gY2xhc3MgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihlMykgewogICAgICAgICAgICAgIGxldCB7IGVuY2Fwc3VsYXRpb246IHQzLCB0ZW1wbGF0ZTogbjMsIHRlbXBsYXRlVXJsOiByMywgaHRtbEFzdDogbzMsIHN0eWxlczogaTMsIHN0eWxlVXJsczogdTMsIGV4dGVybmFsU3R5bGVzaGVldHM6IHMzLCBhbmltYXRpb25zOiBhMywgbmdDb250ZW50U2VsZWN0b3JzOiBwMywgaW50ZXJwb2xhdGlvbjogZjIsIGlzSW5saW5lOiBkMiwgcHJlc2VydmVXaGl0ZXNwYWNlczogaDIgfSA9IGUzOwogICAgICAgICAgICAgIGlmICh0aGlzLmVuY2Fwc3VsYXRpb24gPSB0MywgdGhpcy50ZW1wbGF0ZSA9IG4zLCB0aGlzLnRlbXBsYXRlVXJsID0gcjMsIHRoaXMuaHRtbEFzdCA9IG8zLCB0aGlzLnN0eWxlcyA9IGMyKGkzKSwgdGhpcy5zdHlsZVVybHMgPSBjMih1MyksIHRoaXMuZXh0ZXJuYWxTdHlsZXNoZWV0cyA9IGMyKHMzKSwgdGhpcy5hbmltYXRpb25zID0gYTMgPyBsMihhMykgOiBbXSwgdGhpcy5uZ0NvbnRlbnRTZWxlY3RvcnMgPSBwMyB8fCBbXSwgZjIgJiYgZjIubGVuZ3RoICE9IDIpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIidpbnRlcnBvbGF0aW9uJyBzaG91bGQgaGF2ZSBhIHN0YXJ0IGFuZCBhbiBlbmQgc3ltYm9sLiIpOwogICAgICAgICAgICAgIHRoaXMuaW50ZXJwb2xhdGlvbiA9IGYyLCB0aGlzLmlzSW5saW5lID0gZDIsIHRoaXMucHJlc2VydmVXaGl0ZXNwYWNlcyA9IGgyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvU3VtbWFyeSgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBuZ0NvbnRlbnRTZWxlY3RvcnM6IHRoaXMubmdDb250ZW50U2VsZWN0b3JzLCBlbmNhcHN1bGF0aW9uOiB0aGlzLmVuY2Fwc3VsYXRpb24sIHN0eWxlczogdGhpcy5zdHlsZXMsIGFuaW1hdGlvbnM6IHRoaXMuYW5pbWF0aW9ucyB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgY2xhc3MgYTIgewogICAgICAgICAgICBzdGF0aWMgY3JlYXRlKGUzKSB7CiAgICAgICAgICAgICAgbGV0IHsgaXNIb3N0OiB0MywgdHlwZTogbzMsIGlzQ29tcG9uZW50OiBpMywgc2VsZWN0b3I6IHUzLCBleHBvcnRBczogczMsIGNoYW5nZURldGVjdGlvbjogYzMsIGlucHV0czogbDMsIG91dHB1dHM6IHAzLCBob3N0OiBmMiwgcHJvdmlkZXJzOiBkMiwgdmlld1Byb3ZpZGVyczogaDIsIHF1ZXJpZXM6IGcyLCBndWFyZHM6IG0yLCB2aWV3UXVlcmllczogeTIsIGVudHJ5Q29tcG9uZW50czogRDIsIHRlbXBsYXRlOiBFMiwgY29tcG9uZW50Vmlld1R5cGU6IEMyLCByZW5kZXJlclR5cGU6IGIyLCBjb21wb25lbnRGYWN0b3J5OiB2MiB9ID0gZTM7CiAgICAgICAgICAgICAgY29uc3QgQTIgPSB7fSwgRjIgPSB7fSwgeDIgPSB7fTsKICAgICAgICAgICAgICBmMiAhPSBudWxsICYmIE9iamVjdC5rZXlzKGYyKS5mb3JFYWNoKChlNCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdDQgPSBmMltlNF0sIG4zID0gZTQubWF0Y2gocjIpOwogICAgICAgICAgICAgICAgbjMgPT09IG51bGwgPyB4MltlNF0gPSB0NCA6IG4zWzFdICE9IG51bGwgPyBGMltuM1sxXV0gPSB0NCA6IG4zWzJdICE9IG51bGwgJiYgKEEyW24zWzJdXSA9IHQ0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBjb25zdCBTMiA9IHt9OwogICAgICAgICAgICAgIGwzICE9IG51bGwgJiYgbDMuZm9yRWFjaCgoZTQpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHQ0ID0gbjIuc3BsaXRBdENvbG9uKGU0LCBbZTQsIGU0XSk7CiAgICAgICAgICAgICAgICBTMlt0NFswXV0gPSB0NFsxXTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBjb25zdCB3MiA9IHt9OwogICAgICAgICAgICAgIHJldHVybiBwMyAhPSBudWxsICYmIHAzLmZvckVhY2goKGU0KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0NCA9IG4yLnNwbGl0QXRDb2xvbihlNCwgW2U0LCBlNF0pOwogICAgICAgICAgICAgICAgdzJbdDRbMF1dID0gdDRbMV07CiAgICAgICAgICAgICAgfSksIG5ldyBhMih7IGlzSG9zdDogdDMsIHR5cGU6IG8zLCBpc0NvbXBvbmVudDogISFpMywgc2VsZWN0b3I6IHUzLCBleHBvcnRBczogczMsIGNoYW5nZURldGVjdGlvbjogYzMsIGlucHV0czogUzIsIG91dHB1dHM6IHcyLCBob3N0TGlzdGVuZXJzOiBBMiwgaG9zdFByb3BlcnRpZXM6IEYyLCBob3N0QXR0cmlidXRlczogeDIsIHByb3ZpZGVyczogZDIsIHZpZXdQcm92aWRlcnM6IGgyLCBxdWVyaWVzOiBnMiwgZ3VhcmRzOiBtMiwgdmlld1F1ZXJpZXM6IHkyLCBlbnRyeUNvbXBvbmVudHM6IEQyLCB0ZW1wbGF0ZTogRTIsIGNvbXBvbmVudFZpZXdUeXBlOiBDMiwgcmVuZGVyZXJUeXBlOiBiMiwgY29tcG9uZW50RmFjdG9yeTogdjIgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3RydWN0b3IoZTMpIHsKICAgICAgICAgICAgICBsZXQgeyBpc0hvc3Q6IHQzLCB0eXBlOiBuMywgaXNDb21wb25lbnQ6IHIzLCBzZWxlY3RvcjogbzMsIGV4cG9ydEFzOiBpMywgY2hhbmdlRGV0ZWN0aW9uOiB1MywgaW5wdXRzOiBzMywgb3V0cHV0czogYTMsIGhvc3RMaXN0ZW5lcnM6IGwzLCBob3N0UHJvcGVydGllczogcDMsIGhvc3RBdHRyaWJ1dGVzOiBmMiwgcHJvdmlkZXJzOiBkMiwgdmlld1Byb3ZpZGVyczogaDIsIHF1ZXJpZXM6IGcyLCBndWFyZHM6IG0yLCB2aWV3UXVlcmllczogeTIsIGVudHJ5Q29tcG9uZW50czogRDIsIHRlbXBsYXRlOiBFMiwgY29tcG9uZW50Vmlld1R5cGU6IEMyLCByZW5kZXJlclR5cGU6IGIyLCBjb21wb25lbnRGYWN0b3J5OiB2MiB9ID0gZTM7CiAgICAgICAgICAgICAgdGhpcy5pc0hvc3QgPSAhIXQzLCB0aGlzLnR5cGUgPSBuMywgdGhpcy5pc0NvbXBvbmVudCA9IHIzLCB0aGlzLnNlbGVjdG9yID0gbzMsIHRoaXMuZXhwb3J0QXMgPSBpMywgdGhpcy5jaGFuZ2VEZXRlY3Rpb24gPSB1MywgdGhpcy5pbnB1dHMgPSBzMywgdGhpcy5vdXRwdXRzID0gYTMsIHRoaXMuaG9zdExpc3RlbmVycyA9IGwzLCB0aGlzLmhvc3RQcm9wZXJ0aWVzID0gcDMsIHRoaXMuaG9zdEF0dHJpYnV0ZXMgPSBmMiwgdGhpcy5wcm92aWRlcnMgPSBjMihkMiksIHRoaXMudmlld1Byb3ZpZGVycyA9IGMyKGgyKSwgdGhpcy5xdWVyaWVzID0gYzIoZzIpLCB0aGlzLmd1YXJkcyA9IG0yLCB0aGlzLnZpZXdRdWVyaWVzID0gYzIoeTIpLCB0aGlzLmVudHJ5Q29tcG9uZW50cyA9IGMyKEQyKSwgdGhpcy50ZW1wbGF0ZSA9IEUyLCB0aGlzLmNvbXBvbmVudFZpZXdUeXBlID0gQzIsIHRoaXMucmVuZGVyZXJUeXBlID0gYjIsIHRoaXMuY29tcG9uZW50RmFjdG9yeSA9IHYyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvU3VtbWFyeSgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBzdW1tYXJ5S2luZDogczIuRGlyZWN0aXZlLCB0eXBlOiB0aGlzLnR5cGUsIGlzQ29tcG9uZW50OiB0aGlzLmlzQ29tcG9uZW50LCBzZWxlY3RvcjogdGhpcy5zZWxlY3RvciwgZXhwb3J0QXM6IHRoaXMuZXhwb3J0QXMsIGlucHV0czogdGhpcy5pbnB1dHMsIG91dHB1dHM6IHRoaXMub3V0cHV0cywgaG9zdExpc3RlbmVyczogdGhpcy5ob3N0TGlzdGVuZXJzLCBob3N0UHJvcGVydGllczogdGhpcy5ob3N0UHJvcGVydGllcywgaG9zdEF0dHJpYnV0ZXM6IHRoaXMuaG9zdEF0dHJpYnV0ZXMsIHByb3ZpZGVyczogdGhpcy5wcm92aWRlcnMsIHZpZXdQcm92aWRlcnM6IHRoaXMudmlld1Byb3ZpZGVycywgcXVlcmllczogdGhpcy5xdWVyaWVzLCBndWFyZHM6IHRoaXMuZ3VhcmRzLCB2aWV3UXVlcmllczogdGhpcy52aWV3UXVlcmllcywgZW50cnlDb21wb25lbnRzOiB0aGlzLmVudHJ5Q29tcG9uZW50cywgY2hhbmdlRGV0ZWN0aW9uOiB0aGlzLmNoYW5nZURldGVjdGlvbiwgdGVtcGxhdGU6IHRoaXMudGVtcGxhdGUgJiYgdGhpcy50ZW1wbGF0ZS50b1N1bW1hcnkoKSwgY29tcG9uZW50Vmlld1R5cGU6IHRoaXMuY29tcG9uZW50Vmlld1R5cGUsIHJlbmRlcmVyVHlwZTogdGhpcy5yZW5kZXJlclR5cGUsIGNvbXBvbmVudEZhY3Rvcnk6IHRoaXMuY29tcG9uZW50RmFjdG9yeSB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBlMi5Db21waWxlRGlyZWN0aXZlTWV0YWRhdGEgPSBhMjsKICAgICAgICAgIGUyLkNvbXBpbGVQaXBlTWV0YWRhdGEgPSBjbGFzcyB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGUzKSB7CiAgICAgICAgICAgICAgbGV0IHsgdHlwZTogdDMsIG5hbWU6IG4zLCBwdXJlOiByMyB9ID0gZTM7CiAgICAgICAgICAgICAgdGhpcy50eXBlID0gdDMsIHRoaXMubmFtZSA9IG4zLCB0aGlzLnB1cmUgPSAhIXIzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvU3VtbWFyeSgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBzdW1tYXJ5S2luZDogczIuUGlwZSwgdHlwZTogdGhpcy50eXBlLCBuYW1lOiB0aGlzLm5hbWUsIHB1cmU6IHRoaXMucHVyZSB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgZTIuQ29tcGlsZVNoYWxsb3dNb2R1bGVNZXRhZGF0YSA9IGNsYXNzIHsKICAgICAgICAgIH07CiAgICAgICAgICBlMi5Db21waWxlTmdNb2R1bGVNZXRhZGF0YSA9IGNsYXNzIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoZTMpIHsKICAgICAgICAgICAgICBsZXQgeyB0eXBlOiB0MywgcHJvdmlkZXJzOiBuMywgZGVjbGFyZWREaXJlY3RpdmVzOiByMywgZXhwb3J0ZWREaXJlY3RpdmVzOiBvMywgZGVjbGFyZWRQaXBlczogaTMsIGV4cG9ydGVkUGlwZXM6IHUzLCBlbnRyeUNvbXBvbmVudHM6IHMzLCBib290c3RyYXBDb21wb25lbnRzOiBhMywgaW1wb3J0ZWRNb2R1bGVzOiBsMywgZXhwb3J0ZWRNb2R1bGVzOiBwMywgc2NoZW1hczogZjIsIHRyYW5zaXRpdmVNb2R1bGU6IGQyLCBpZDogaDIgfSA9IGUzOwogICAgICAgICAgICAgIHRoaXMudHlwZSA9IHQzIHx8IG51bGwsIHRoaXMuZGVjbGFyZWREaXJlY3RpdmVzID0gYzIocjMpLCB0aGlzLmV4cG9ydGVkRGlyZWN0aXZlcyA9IGMyKG8zKSwgdGhpcy5kZWNsYXJlZFBpcGVzID0gYzIoaTMpLCB0aGlzLmV4cG9ydGVkUGlwZXMgPSBjMih1MyksIHRoaXMucHJvdmlkZXJzID0gYzIobjMpLCB0aGlzLmVudHJ5Q29tcG9uZW50cyA9IGMyKHMzKSwgdGhpcy5ib290c3RyYXBDb21wb25lbnRzID0gYzIoYTMpLCB0aGlzLmltcG9ydGVkTW9kdWxlcyA9IGMyKGwzKSwgdGhpcy5leHBvcnRlZE1vZHVsZXMgPSBjMihwMyksIHRoaXMuc2NoZW1hcyA9IGMyKGYyKSwgdGhpcy5pZCA9IGgyIHx8IG51bGwsIHRoaXMudHJhbnNpdGl2ZU1vZHVsZSA9IGQyIHx8IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG9TdW1tYXJ5KCkgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy50cmFuc2l0aXZlTW9kdWxlOwogICAgICAgICAgICAgIHJldHVybiB7IHN1bW1hcnlLaW5kOiBzMi5OZ01vZHVsZSwgdHlwZTogdGhpcy50eXBlLCBlbnRyeUNvbXBvbmVudHM6IGUzLmVudHJ5Q29tcG9uZW50cywgcHJvdmlkZXJzOiBlMy5wcm92aWRlcnMsIG1vZHVsZXM6IGUzLm1vZHVsZXMsIGV4cG9ydGVkRGlyZWN0aXZlczogZTMuZXhwb3J0ZWREaXJlY3RpdmVzLCBleHBvcnRlZFBpcGVzOiBlMy5leHBvcnRlZFBpcGVzIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgICBmdW5jdGlvbiBjMihlMykgewogICAgICAgICAgICByZXR1cm4gZTMgfHwgW107CiAgICAgICAgICB9CiAgICAgICAgICBlMi5UcmFuc2l0aXZlQ29tcGlsZU5nTW9kdWxlTWV0YWRhdGEgPSBjbGFzcyB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICAgIHRoaXMuZGlyZWN0aXZlc1NldCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCksIHRoaXMuZGlyZWN0aXZlcyA9IFtdLCB0aGlzLmV4cG9ydGVkRGlyZWN0aXZlc1NldCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCksIHRoaXMuZXhwb3J0ZWREaXJlY3RpdmVzID0gW10sIHRoaXMucGlwZXNTZXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCB0aGlzLnBpcGVzID0gW10sIHRoaXMuZXhwb3J0ZWRQaXBlc1NldCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCksIHRoaXMuZXhwb3J0ZWRQaXBlcyA9IFtdLCB0aGlzLm1vZHVsZXNTZXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCB0aGlzLm1vZHVsZXMgPSBbXSwgdGhpcy5lbnRyeUNvbXBvbmVudHNTZXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCB0aGlzLmVudHJ5Q29tcG9uZW50cyA9IFtdLCB0aGlzLnByb3ZpZGVycyA9IFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFkZFByb3ZpZGVyKGUzLCB0MykgewogICAgICAgICAgICAgIHRoaXMucHJvdmlkZXJzLnB1c2goeyBwcm92aWRlcjogZTMsIG1vZHVsZTogdDMgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkRGlyZWN0aXZlKGUzKSB7CiAgICAgICAgICAgICAgdGhpcy5kaXJlY3RpdmVzU2V0LmhhcyhlMy5yZWZlcmVuY2UpIHx8ICh0aGlzLmRpcmVjdGl2ZXNTZXQuYWRkKGUzLnJlZmVyZW5jZSksIHRoaXMuZGlyZWN0aXZlcy5wdXNoKGUzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkRXhwb3J0ZWREaXJlY3RpdmUoZTMpIHsKICAgICAgICAgICAgICB0aGlzLmV4cG9ydGVkRGlyZWN0aXZlc1NldC5oYXMoZTMucmVmZXJlbmNlKSB8fCAodGhpcy5leHBvcnRlZERpcmVjdGl2ZXNTZXQuYWRkKGUzLnJlZmVyZW5jZSksIHRoaXMuZXhwb3J0ZWREaXJlY3RpdmVzLnB1c2goZTMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZGRQaXBlKGUzKSB7CiAgICAgICAgICAgICAgdGhpcy5waXBlc1NldC5oYXMoZTMucmVmZXJlbmNlKSB8fCAodGhpcy5waXBlc1NldC5hZGQoZTMucmVmZXJlbmNlKSwgdGhpcy5waXBlcy5wdXNoKGUzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkRXhwb3J0ZWRQaXBlKGUzKSB7CiAgICAgICAgICAgICAgdGhpcy5leHBvcnRlZFBpcGVzU2V0LmhhcyhlMy5yZWZlcmVuY2UpIHx8ICh0aGlzLmV4cG9ydGVkUGlwZXNTZXQuYWRkKGUzLnJlZmVyZW5jZSksIHRoaXMuZXhwb3J0ZWRQaXBlcy5wdXNoKGUzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkTW9kdWxlKGUzKSB7CiAgICAgICAgICAgICAgdGhpcy5tb2R1bGVzU2V0LmhhcyhlMy5yZWZlcmVuY2UpIHx8ICh0aGlzLm1vZHVsZXNTZXQuYWRkKGUzLnJlZmVyZW5jZSksIHRoaXMubW9kdWxlcy5wdXNoKGUzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkRW50cnlDb21wb25lbnQoZTMpIHsKICAgICAgICAgICAgICB0aGlzLmVudHJ5Q29tcG9uZW50c1NldC5oYXMoZTMuY29tcG9uZW50VHlwZSkgfHwgKHRoaXMuZW50cnlDb21wb25lbnRzU2V0LmFkZChlMy5jb21wb25lbnRUeXBlKSwgdGhpcy5lbnRyeUNvbXBvbmVudHMucHVzaChlMykpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgZnVuY3Rpb24gbDIoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzLnJlZHVjZSgoZTQsIHQzKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgbjMgPSBBcnJheS5pc0FycmF5KHQzKSA/IGwyKHQzKSA6IHQzOwogICAgICAgICAgICAgIHJldHVybiBlNC5jb25jYXQobjMpOwogICAgICAgICAgICB9LCBbXSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBwMihlMykgewogICAgICAgICAgICByZXR1cm4gZTMucmVwbGFjZSgvKFx3KzpcL1wvW1x3Oi1dKyk/KFwvKyk/LywgIm5nOi8vLyIpOwogICAgICAgICAgfQogICAgICAgICAgZTIuUHJvdmlkZXJNZXRhID0gY2xhc3MgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihlMywgdDMpIHsKICAgICAgICAgICAgICBsZXQgeyB1c2VDbGFzczogbjMsIHVzZVZhbHVlOiByMywgdXNlRXhpc3Rpbmc6IG8zLCB1c2VGYWN0b3J5OiBpMywgZGVwczogdTMsIG11bHRpOiBzMyB9ID0gdDM7CiAgICAgICAgICAgICAgdGhpcy50b2tlbiA9IGUzLCB0aGlzLnVzZUNsYXNzID0gbjMgfHwgbnVsbCwgdGhpcy51c2VWYWx1ZSA9IHIzLCB0aGlzLnVzZUV4aXN0aW5nID0gbzMsIHRoaXMudXNlRmFjdG9yeSA9IGkzIHx8IG51bGwsIHRoaXMuZGVwZW5kZW5jaWVzID0gdTMgfHwgbnVsbCwgdGhpcy5tdWx0aSA9ICEhczM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIGUyLmZsYXR0ZW4gPSBsMiwgZTIudGVtcGxhdGVTb3VyY2VVcmwgPSBmdW5jdGlvbihlMywgbjMsIHIzKSB7CiAgICAgICAgICAgIGxldCBvMzsKICAgICAgICAgICAgcmV0dXJuIG8zID0gcjMuaXNJbmxpbmUgPyBuMy50eXBlLnJlZmVyZW5jZSBpbnN0YW5jZW9mIHQyLlN0YXRpY1N5bWJvbCA/ICIiLmNvbmNhdChuMy50eXBlLnJlZmVyZW5jZS5maWxlUGF0aCwgIi4iKS5jb25jYXQobjMudHlwZS5yZWZlcmVuY2UubmFtZSwgIi5odG1sIikgOiAiIi5jb25jYXQodTIoZTMpLCAiLyIpLmNvbmNhdCh1MihuMy50eXBlKSwgIi5odG1sIikgOiByMy50ZW1wbGF0ZVVybCwgbjMudHlwZS5yZWZlcmVuY2UgaW5zdGFuY2VvZiB0Mi5TdGF0aWNTeW1ib2wgPyBvMyA6IHAyKG8zKTsKICAgICAgICAgIH0sIGUyLnNoYXJlZFN0eWxlc2hlZXRKaXRVcmwgPSBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgY29uc3QgbjMgPSBlMy5tb2R1bGVVcmwuc3BsaXQoL1wvXFwvZyksIHIzID0gbjNbbjMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIHJldHVybiBwMigiY3NzLyIuY29uY2F0KHQzKS5jb25jYXQocjMsICIubmdzdHlsZS5qcyIpKTsKICAgICAgICAgIH0sIGUyLm5nTW9kdWxlSml0VXJsID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIHAyKCIiLmNvbmNhdCh1MihlMy50eXBlKSwgIi9tb2R1bGUubmdmYWN0b3J5LmpzIikpOwogICAgICAgICAgfSwgZTIudGVtcGxhdGVKaXRVcmwgPSBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgcmV0dXJuIHAyKCIiLmNvbmNhdCh1MihlMyksICIvIikuY29uY2F0KHUyKHQzLnR5cGUpLCAiLm5nZmFjdG9yeS5qcyIpKTsKICAgICAgICAgIH07CiAgICAgICAgfShncSksIGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgICAgIGNvbnN0IHQyID0gaHEsIG4yID0gZ3E7CiAgICAgICAgICBjbGFzcyByMiB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGUzLCB0MywgbjMsIHIzKSB7CiAgICAgICAgICAgICAgdGhpcy5maWxlID0gZTMsIHRoaXMub2Zmc2V0ID0gdDMsIHRoaXMubGluZSA9IG4zLCB0aGlzLmNvbCA9IHIzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvU3RyaW5nKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLm9mZnNldCAhPSBudWxsID8gIiIuY29uY2F0KHRoaXMuZmlsZS51cmwsICJAIikuY29uY2F0KHRoaXMubGluZSwgIjoiKS5jb25jYXQodGhpcy5jb2wpIDogdGhpcy5maWxlLnVybDsKICAgICAgICAgICAgfQogICAgICAgICAgICBtb3ZlQnkoZTMpIHsKICAgICAgICAgICAgICBjb25zdCBuMyA9IHRoaXMuZmlsZS5jb250ZW50LCBvMyA9IG4zLmxlbmd0aDsKICAgICAgICAgICAgICBsZXQgaTMgPSB0aGlzLm9mZnNldCwgdTMgPSB0aGlzLmxpbmUsIHMyID0gdGhpcy5jb2w7CiAgICAgICAgICAgICAgZm9yICg7IGkzID4gMCAmJiBlMyA8IDA7ICkgewogICAgICAgICAgICAgICAgaTMtLSwgZTMrKzsKICAgICAgICAgICAgICAgIGlmIChuMy5jaGFyQ29kZUF0KGkzKSA9PSB0Mi4kTEYpIHsKICAgICAgICAgICAgICAgICAgdTMtLTsKICAgICAgICAgICAgICAgICAgY29uc3QgZTQgPSBuMy5zdWJzdHIoMCwgaTMgLSAxKS5sYXN0SW5kZXhPZihTdHJpbmcuZnJvbUNoYXJDb2RlKHQyLiRMRikpOwogICAgICAgICAgICAgICAgICBzMiA9IGU0ID4gMCA/IGkzIC0gZTQgOiBpMzsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICBzMi0tOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmb3IgKDsgaTMgPCBvMyAmJiBlMyA+IDA7ICkgewogICAgICAgICAgICAgICAgY29uc3QgcjMgPSBuMy5jaGFyQ29kZUF0KGkzKTsKICAgICAgICAgICAgICAgIGkzKyssIGUzLS0sIHIzID09IHQyLiRMRiA/ICh1MysrLCBzMiA9IDApIDogczIrKzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyByMih0aGlzLmZpbGUsIGkzLCB1MywgczIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldENvbnRleHQoZTMsIHQzKSB7CiAgICAgICAgICAgICAgY29uc3QgbjMgPSB0aGlzLmZpbGUuY29udGVudDsKICAgICAgICAgICAgICBsZXQgcjMgPSB0aGlzLm9mZnNldDsKICAgICAgICAgICAgICBpZiAocjMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgcjMgPiBuMy5sZW5ndGggLSAxICYmIChyMyA9IG4zLmxlbmd0aCAtIDEpOwogICAgICAgICAgICAgICAgbGV0IG8zID0gcjMsIGkzID0gMCwgdTMgPSAwOwogICAgICAgICAgICAgICAgZm9yICg7IGkzIDwgZTMgJiYgcjMgPiAwICYmIChyMy0tLCBpMysrLCBuM1tyM10gIT0gIlxuIiB8fCArK3UzICE9IHQzKTsgKQogICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICBmb3IgKGkzID0gMCwgdTMgPSAwOyBpMyA8IGUzICYmIG8zIDwgbjMubGVuZ3RoIC0gMSAmJiAobzMrKywgaTMrKywgbjNbbzNdICE9ICJcbiIgfHwgKyt1MyAhPSB0Myk7ICkKICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgcmV0dXJuIHsgYmVmb3JlOiBuMy5zdWJzdHJpbmcocjMsIHRoaXMub2Zmc2V0KSwgYWZ0ZXI6IG4zLnN1YnN0cmluZyh0aGlzLm9mZnNldCwgbzMgKyAxKSB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZTIuUGFyc2VMb2NhdGlvbiA9IHIyOwogICAgICAgICAgY2xhc3MgbzIgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihlMywgdDMpIHsKICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSBlMywgdGhpcy51cmwgPSB0MzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZTIuUGFyc2VTb3VyY2VGaWxlID0gbzI7CiAgICAgICAgICBjbGFzcyBpMiB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGUzLCB0MykgewogICAgICAgICAgICAgIGxldCBuMyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzJdIDogbnVsbDsKICAgICAgICAgICAgICB0aGlzLnN0YXJ0ID0gZTMsIHRoaXMuZW5kID0gdDMsIHRoaXMuZGV0YWlscyA9IG4zOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvU3RyaW5nKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXJ0LmZpbGUuY29udGVudC5zdWJzdHJpbmcodGhpcy5zdGFydC5vZmZzZXQsIHRoaXMuZW5kLm9mZnNldCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHZhciB1MjsKICAgICAgICAgIGUyLlBhcnNlU291cmNlU3BhbiA9IGkyLCBlMi5FTVBUWV9QQVJTRV9MT0NBVElPTiA9IG5ldyByMihuZXcgbzIoIiIsICIiKSwgMCwgMCwgMCksIGUyLkVNUFRZX1NPVVJDRV9TUEFOID0gbmV3IGkyKGUyLkVNUFRZX1BBUlNFX0xPQ0FUSU9OLCBlMi5FTVBUWV9QQVJTRV9MT0NBVElPTiksIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGUzW2UzLldBUk5JTkcgPSAwXSA9ICJXQVJOSU5HIiwgZTNbZTMuRVJST1IgPSAxXSA9ICJFUlJPUiI7CiAgICAgICAgICB9KHUyID0gZTIuUGFyc2VFcnJvckxldmVsIHx8IChlMi5QYXJzZUVycm9yTGV2ZWwgPSB7fSkpOwogICAgICAgICAgZTIuUGFyc2VFcnJvciA9IGNsYXNzIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoZTMsIHQzKSB7CiAgICAgICAgICAgICAgbGV0IG4zID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMl0gOiB1Mi5FUlJPUjsKICAgICAgICAgICAgICB0aGlzLnNwYW4gPSBlMywgdGhpcy5tc2cgPSB0MywgdGhpcy5sZXZlbCA9IG4zOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRleHR1YWxNZXNzYWdlKCkgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5zcGFuLnN0YXJ0LmdldENvbnRleHQoMTAwLCAzKTsKICAgICAgICAgICAgICByZXR1cm4gZTMgPyAiIi5jb25jYXQodGhpcy5tc2csICcgKCInKS5jb25jYXQoZTMuYmVmb3JlLCAiWyIpLmNvbmNhdCh1Mlt0aGlzLmxldmVsXSwgIiAtPl0iKS5jb25jYXQoZTMuYWZ0ZXIsICciKScpIDogdGhpcy5tc2c7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLnNwYW4uZGV0YWlscyA/ICIsICIuY29uY2F0KHRoaXMuc3Bhbi5kZXRhaWxzKSA6ICIiOwogICAgICAgICAgICAgIHJldHVybiAiIi5jb25jYXQodGhpcy5jb250ZXh0dWFsTWVzc2FnZSgpLCAiOiAiKS5jb25jYXQodGhpcy5zcGFuLnN0YXJ0KS5jb25jYXQoZTMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCBlMi50eXBlU291cmNlU3BhbiA9IGZ1bmN0aW9uKGUzLCB0MykgewogICAgICAgICAgICBjb25zdCB1MyA9IG4yLmlkZW50aWZpZXJNb2R1bGVVcmwodDMpLCBzMiA9IHUzICE9IG51bGwgPyAiaW4gIi5jb25jYXQoZTMsICIgIikuY29uY2F0KG4yLmlkZW50aWZpZXJOYW1lKHQzKSwgIiBpbiAiKS5jb25jYXQodTMpIDogImluICIuY29uY2F0KGUzLCAiICIpLmNvbmNhdChuMi5pZGVudGlmaWVyTmFtZSh0MykpLCBhMiA9IG5ldyBvMigiIiwgczIpOwogICAgICAgICAgICByZXR1cm4gbmV3IGkyKG5ldyByMihhMiwgLTEsIC0xLCAtMSksIG5ldyByMihhMiwgLTEsIC0xLCAtMSkpOwogICAgICAgICAgfSwgZTIucjNKaXRUeXBlU291cmNlU3BhbiA9IGZ1bmN0aW9uKGUzLCB0MywgbjMpIHsKICAgICAgICAgICAgY29uc3QgdTMgPSAiaW4gIi5jb25jYXQoZTMsICIgIikuY29uY2F0KHQzLCAiIGluICIpLmNvbmNhdChuMyksIHMyID0gbmV3IG8yKCIiLCB1Myk7CiAgICAgICAgICAgIHJldHVybiBuZXcgaTIobmV3IHIyKHMyLCAtMSwgLTEsIC0xKSwgbmV3IHIyKHMyLCAtMSwgLTEsIC0xKSk7CiAgICAgICAgICB9OwogICAgICAgIH0oZHEpOwogICAgICAgIGNvbnN0IHsgUGFyc2VTb3VyY2VTcGFuOiBCcSB9ID0gZHEsIE5xID0gYXUsIHsgaHRtbFRyaW06IGtxLCBnZXRMZWFkaW5nQW5kVHJhaWxpbmdIdG1sV2hpdGVzcGFjZTogUHEsIGhhc0h0bWxXaGl0ZXNwYWNlOiBPcSwgY2FuSGF2ZUludGVycG9sYXRpb246IElxLCBnZXROb2RlQ3NzU3R5bGVEaXNwbGF5OiBMcSwgaXNEYW5nbGluZ1NwYWNlU2Vuc2l0aXZlTm9kZToganEsIGlzSW5kZW50YXRpb25TZW5zaXRpdmVOb2RlOiBfcSwgaXNMZWFkaW5nU3BhY2VTZW5zaXRpdmVOb2RlOiBNcSwgaXNUcmFpbGluZ1NwYWNlU2Vuc2l0aXZlTm9kZTogUnEsIGlzV2hpdGVzcGFjZVNlbnNpdGl2ZU5vZGU6IFZxIH0gPSBmcSwgJHEgPSBbZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGUyLndhbGsoKGUzKSA9PiB7CiAgICAgICAgICAgIGlmIChlMy50eXBlID09PSAiZWxlbWVudCIgJiYgZTMudGFnRGVmaW5pdGlvbi5pZ25vcmVGaXJzdExmICYmIGUzLmNoaWxkcmVuLmxlbmd0aCA+IDAgJiYgZTMuY2hpbGRyZW5bMF0udHlwZSA9PT0gInRleHQiICYmIGUzLmNoaWxkcmVuWzBdLnZhbHVlWzBdID09PSAiXG4iKSB7CiAgICAgICAgICAgICAgY29uc3QgW3QyLCAuLi5uMl0gPSBlMy5jaGlsZHJlbjsKICAgICAgICAgICAgICBlMy5zZXRDaGlsZHJlbih0Mi52YWx1ZS5sZW5ndGggPT09IDEgPyBuMiA6IFt0Mi5jbG9uZSh7IHZhbHVlOiB0Mi52YWx1ZS5zbGljZSgxKSB9KSwgLi4ubjJdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gKGUzKSA9PiBlMy50eXBlID09PSAiZWxlbWVudCIgJiYgZTMucHJldiAmJiBlMy5wcmV2LnR5cGUgPT09ICJpZUNvbmRpdGlvbmFsU3RhcnRDb21tZW50IiAmJiBlMy5wcmV2LnNvdXJjZVNwYW4uZW5kLm9mZnNldCA9PT0gZTMuc3RhcnRTb3VyY2VTcGFuLnN0YXJ0Lm9mZnNldCAmJiBlMy5maXJzdENoaWxkICYmIGUzLmZpcnN0Q2hpbGQudHlwZSA9PT0gImllQ29uZGl0aW9uYWxFbmRDb21tZW50IiAmJiBlMy5maXJzdENoaWxkLnNvdXJjZVNwYW4uc3RhcnQub2Zmc2V0ID09PSBlMy5zdGFydFNvdXJjZVNwYW4uZW5kLm9mZnNldDsKICAgICAgICAgIGUyLndhbGsoKGUzKSA9PiB7CiAgICAgICAgICAgIGlmIChlMy5jaGlsZHJlbikgewogICAgICAgICAgICAgIGNvbnN0IG4yID0gZTMuY2hpbGRyZW4ubWFwKHQyKTsKICAgICAgICAgICAgICBpZiAobjIuc29tZShCb29sZWFuKSkgewogICAgICAgICAgICAgICAgY29uc3QgdDMgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IHIyID0gMDsgcjIgPCBlMy5jaGlsZHJlbi5sZW5ndGg7IHIyKyspIHsKICAgICAgICAgICAgICAgICAgY29uc3QgbzIgPSBlMy5jaGlsZHJlbltyMl07CiAgICAgICAgICAgICAgICAgIGlmICghbjJbcjIgKyAxXSkKICAgICAgICAgICAgICAgICAgICBpZiAobjJbcjJdKSB7CiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlNCA9IG8yLnByZXYsIG4zID0gbzIuZmlyc3RDaGlsZCwgcjMgPSBuZXcgQnEoZTQuc291cmNlU3Bhbi5zdGFydCwgbjMuc291cmNlU3Bhbi5lbmQpLCBpMiA9IG5ldyBCcShyMy5zdGFydCwgbzIuc291cmNlU3Bhbi5lbmQpOwogICAgICAgICAgICAgICAgICAgICAgdDMucHVzaChvMi5jbG9uZSh7IGNvbmRpdGlvbjogZTQuY29uZGl0aW9uLCBzb3VyY2VTcGFuOiBpMiwgc3RhcnRTb3VyY2VTcGFuOiByMywgY2hpbGRyZW46IG8yLmNoaWxkcmVuLnNsaWNlKDEpIH0pKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgIHQzLnB1c2gobzIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZTMuc2V0Q2hpbGRyZW4odDMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMywgdDIsIG4yKSB7CiAgICAgICAgICAgIGUzLndhbGsoKGU0KSA9PiB7CiAgICAgICAgICAgICAgaWYgKGU0LmNoaWxkcmVuKSB7CiAgICAgICAgICAgICAgICBjb25zdCByMiA9IGU0LmNoaWxkcmVuLm1hcCh0Mik7CiAgICAgICAgICAgICAgICBpZiAocjIuc29tZShCb29sZWFuKSkgewogICAgICAgICAgICAgICAgICBjb25zdCB0MyA9IFtdOwogICAgICAgICAgICAgICAgICBmb3IgKGxldCBvMiA9IDA7IG8yIDwgZTQuY2hpbGRyZW4ubGVuZ3RoOyBvMisrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaTIgPSBlNC5jaGlsZHJlbltvMl07CiAgICAgICAgICAgICAgICAgICAgaWYgKGkyLnR5cGUgIT09ICJ0ZXh0IiAmJiAhcjJbbzJdKSB7CiAgICAgICAgICAgICAgICAgICAgICB0My5wdXNoKGkyKTsKICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb25zdCB1MiA9IGkyLnR5cGUgPT09ICJ0ZXh0IiA/IGkyIDogaTIuY2xvbmUoeyB0eXBlOiAidGV4dCIsIHZhbHVlOiBuMihpMikgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHQzLmxlbmd0aCA9PT0gMCB8fCBOcSh0MykudHlwZSAhPT0gInRleHQiKSB7CiAgICAgICAgICAgICAgICAgICAgICB0My5wdXNoKHUyKTsKICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb25zdCBzMiA9IHQzLnBvcCgpOwogICAgICAgICAgICAgICAgICAgIHQzLnB1c2goczIuY2xvbmUoeyB2YWx1ZTogczIudmFsdWUgKyB1Mi52YWx1ZSwgc291cmNlU3BhbjogbmV3IEJxKHMyLnNvdXJjZVNwYW4uc3RhcnQsIHUyLnNvdXJjZVNwYW4uZW5kKSB9KSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZTQuc2V0Q2hpbGRyZW4odDMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KGUyLCAoZTMpID0+IGUzLnR5cGUgPT09ICJjZGF0YSIsIChlMykgPT4gIjwhW0NEQVRBWyIuY29uY2F0KGUzLnZhbHVlLCAiXV0+IikpOwogICAgICAgIH0sIGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgaWYgKHQyLnBhcnNlciA9PT0gImh0bWwiKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBjb25zdCBuMiA9IC97eyguKz8pfX0vczsKICAgICAgICAgIGUyLndhbGsoKGUzKSA9PiB7CiAgICAgICAgICAgIGlmICghSXEoZTMpKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgY29uc3QgdDMgPSBbXTsKICAgICAgICAgICAgZm9yIChjb25zdCByMiBvZiBlMy5jaGlsZHJlbikgewogICAgICAgICAgICAgIGlmIChyMi50eXBlICE9PSAidGV4dCIpIHsKICAgICAgICAgICAgICAgIHQzLnB1c2gocjIpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxldCBlNCA9IHIyLnNvdXJjZVNwYW4uc3RhcnQsIG8yID0gbnVsbDsKICAgICAgICAgICAgICBjb25zdCBpMiA9IHIyLnZhbHVlLnNwbGl0KG4yKTsKICAgICAgICAgICAgICBmb3IgKGxldCBuMyA9IDA7IG4zIDwgaTIubGVuZ3RoOyBuMysrLCBlNCA9IG8yKSB7CiAgICAgICAgICAgICAgICBjb25zdCByMyA9IGkyW24zXTsKICAgICAgICAgICAgICAgIG4zICUgMiAhPSAwID8gKG8yID0gZTQubW92ZUJ5KHIzLmxlbmd0aCArIDQpLCB0My5wdXNoKHsgdHlwZTogImludGVycG9sYXRpb24iLCBzb3VyY2VTcGFuOiBuZXcgQnEoZTQsIG8yKSwgY2hpbGRyZW46IHIzLmxlbmd0aCA9PT0gMCA/IFtdIDogW3sgdHlwZTogInRleHQiLCB2YWx1ZTogcjMsIHNvdXJjZVNwYW46IG5ldyBCcShlNC5tb3ZlQnkoMiksIG8yLm1vdmVCeSgtMikpIH1dIH0pKSA6IChvMiA9IGU0Lm1vdmVCeShyMy5sZW5ndGgpLCByMy5sZW5ndGggPiAwICYmIHQzLnB1c2goeyB0eXBlOiAidGV4dCIsIHZhbHVlOiByMywgc291cmNlU3BhbjogbmV3IEJxKGU0LCBvMikgfSkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlMy5zZXRDaGlsZHJlbih0Myk7CiAgICAgICAgICB9KTsKICAgICAgICB9LCBmdW5jdGlvbihlMikgewogICAgICAgICAgZTIud2FsaygoZTMpID0+IHsKICAgICAgICAgICAgaWYgKCFlMy5jaGlsZHJlbikKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChlMy5jaGlsZHJlbi5sZW5ndGggPT09IDAgfHwgZTMuY2hpbGRyZW4ubGVuZ3RoID09PSAxICYmIGUzLmNoaWxkcmVuWzBdLnR5cGUgPT09ICJ0ZXh0IiAmJiBrcShlMy5jaGlsZHJlblswXS52YWx1ZSkubGVuZ3RoID09PSAwKQogICAgICAgICAgICAgIHJldHVybiBlMy5oYXNEYW5nbGluZ1NwYWNlcyA9IGUzLmNoaWxkcmVuLmxlbmd0aCA+IDAsIHZvaWQgKGUzLmNoaWxkcmVuID0gW10pOwogICAgICAgICAgICBjb25zdCB0MiA9IFZxKGUzKSwgbjIgPSBfcShlMyk7CiAgICAgICAgICAgIGUzLnNldENoaWxkcmVuKGUzLmNoaWxkcmVuLmZsYXRNYXAoKGU0KSA9PiB7CiAgICAgICAgICAgICAgaWYgKGU0LnR5cGUgIT09ICJ0ZXh0IiB8fCB0MikKICAgICAgICAgICAgICAgIHJldHVybiBlNDsKICAgICAgICAgICAgICBjb25zdCBuMyA9IFtdLCB7IGxlYWRpbmdXaGl0ZXNwYWNlOiByMiwgdGV4dDogbzIsIHRyYWlsaW5nV2hpdGVzcGFjZTogaTIgfSA9IFBxKGU0LnZhbHVlKTsKICAgICAgICAgICAgICByZXR1cm4gcjIgJiYgbjMucHVzaChXcSksIG8yICYmIG4zLnB1c2goeyB0eXBlOiAidGV4dCIsIHZhbHVlOiBvMiwgc291cmNlU3BhbjogbmV3IEJxKGU0LnNvdXJjZVNwYW4uc3RhcnQubW92ZUJ5KHIyLmxlbmd0aCksIGU0LnNvdXJjZVNwYW4uZW5kLm1vdmVCeSgtaTIubGVuZ3RoKSkgfSksIGkyICYmIG4zLnB1c2goV3EpLCBuMzsKICAgICAgICAgICAgfSkubWFwKChlNCwgdDMsIG4zKSA9PiB7CiAgICAgICAgICAgICAgaWYgKGU0ICE9PSBXcSkKICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGU0KSwge30sIHsgaGFzTGVhZGluZ1NwYWNlczogbjNbdDMgLSAxXSA9PT0gV3EsIGhhc1RyYWlsaW5nU3BhY2VzOiBuM1t0MyArIDFdID09PSBXcSB9KTsKICAgICAgICAgICAgfSkuZmlsdGVyKEJvb2xlYW4pKSwgZTMuaXNXaGl0ZXNwYWNlU2Vuc2l0aXZlID0gdDIsIGUzLmlzSW5kZW50YXRpb25TZW5zaXRpdmUgPSBuMjsKICAgICAgICAgIH0pOwogICAgICAgIH0sIGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgZTIud2FsaygoZTMpID0+IE9iamVjdC5hc3NpZ24oZTMsIHsgY3NzRGlzcGxheTogTHEoZTMsIHQyKSB9KSk7CiAgICAgICAgfSwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGUyLndhbGsoKGUzKSA9PiBPYmplY3QuYXNzaWduKGUzLCB7IGlzU2VsZkNsb3Npbmc6ICFlMy5jaGlsZHJlbiB8fCBlMy50eXBlID09PSAiZWxlbWVudCIgJiYgKGUzLnRhZ0RlZmluaXRpb24uaXNWb2lkIHx8IGUzLnN0YXJ0U291cmNlU3BhbiA9PT0gZTMuZW5kU291cmNlU3BhbikgfSkpOwogICAgICAgIH0sIGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgZTIud2FsaygoZTMpID0+IGUzLnR5cGUgIT09ICJlbGVtZW50IiA/IGUzIDogT2JqZWN0LmFzc2lnbihlMywgeyBoYXNIdG1Db21wb25lbnRDbG9zaW5nVGFnOiBlMy5lbmRTb3VyY2VTcGFuICYmIC9ePFxzKlwvXHMqXC9ccyo+JC8udGVzdCh0Mi5vcmlnaW5hbFRleHQuc2xpY2UoZTMuZW5kU291cmNlU3Bhbi5zdGFydC5vZmZzZXQsIGUzLmVuZFNvdXJjZVNwYW4uZW5kLm9mZnNldCkpIH0pKTsKICAgICAgICB9LCBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGUyLndhbGsoKGUzKSA9PiB7CiAgICAgICAgICAgIGUzLmNoaWxkcmVuICYmIChlMy5jaGlsZHJlbi5sZW5ndGggIT09IDAgPyBlMy5zZXRDaGlsZHJlbihlMy5jaGlsZHJlbi5tYXAoKGU0KSA9PiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGU0KSwge30sIHsgaXNMZWFkaW5nU3BhY2VTZW5zaXRpdmU6IE1xKGU0LCB0MiksIGlzVHJhaWxpbmdTcGFjZVNlbnNpdGl2ZTogUnEoZTQsIHQyKSB9KSkubWFwKChlNCwgdDMsIG4yKSA9PiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGU0KSwge30sIHsgaXNMZWFkaW5nU3BhY2VTZW5zaXRpdmU6ICh0MyA9PT0gMCB8fCBuMlt0MyAtIDFdLmlzVHJhaWxpbmdTcGFjZVNlbnNpdGl2ZSkgJiYgZTQuaXNMZWFkaW5nU3BhY2VTZW5zaXRpdmUsIGlzVHJhaWxpbmdTcGFjZVNlbnNpdGl2ZTogKHQzID09PSBuMi5sZW5ndGggLSAxIHx8IG4yW3QzICsgMV0uaXNMZWFkaW5nU3BhY2VTZW5zaXRpdmUpICYmIGU0LmlzVHJhaWxpbmdTcGFjZVNlbnNpdGl2ZSB9KSkpIDogZTMuaXNEYW5nbGluZ1NwYWNlU2Vuc2l0aXZlID0ganEoZTMpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sIGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IChlMykgPT4gZTMudHlwZSA9PT0gImVsZW1lbnQiICYmIGUzLmF0dHJzLmxlbmd0aCA9PT0gMCAmJiBlMy5jaGlsZHJlbi5sZW5ndGggPT09IDEgJiYgZTMuZmlyc3RDaGlsZC50eXBlID09PSAidGV4dCIgJiYgIU9xKGUzLmNoaWxkcmVuWzBdLnZhbHVlKSAmJiAhZTMuZmlyc3RDaGlsZC5oYXNMZWFkaW5nU3BhY2VzICYmICFlMy5maXJzdENoaWxkLmhhc1RyYWlsaW5nU3BhY2VzICYmIGUzLmlzTGVhZGluZ1NwYWNlU2Vuc2l0aXZlICYmICFlMy5oYXNMZWFkaW5nU3BhY2VzICYmIGUzLmlzVHJhaWxpbmdTcGFjZVNlbnNpdGl2ZSAmJiAhZTMuaGFzVHJhaWxpbmdTcGFjZXMgJiYgZTMucHJldiAmJiBlMy5wcmV2LnR5cGUgPT09ICJ0ZXh0IiAmJiBlMy5uZXh0ICYmIGUzLm5leHQudHlwZSA9PT0gInRleHQiOwogICAgICAgICAgZTIud2FsaygoZTMpID0+IHsKICAgICAgICAgICAgaWYgKGUzLmNoaWxkcmVuKSB7CiAgICAgICAgICAgICAgY29uc3QgbjIgPSBlMy5jaGlsZHJlbi5tYXAodDIpOwogICAgICAgICAgICAgIGlmIChuMi5zb21lKEJvb2xlYW4pKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IFtdOwogICAgICAgICAgICAgICAgZm9yIChsZXQgcjIgPSAwOyByMiA8IGUzLmNoaWxkcmVuLmxlbmd0aDsgcjIrKykgewogICAgICAgICAgICAgICAgICBjb25zdCBvMiA9IGUzLmNoaWxkcmVuW3IyXTsKICAgICAgICAgICAgICAgICAgaWYgKG4yW3IyXSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG4zID0gdDMucG9wKCksIGkyID0gZTMuY2hpbGRyZW5bKytyMl0sIHsgaXNUcmFpbGluZ1NwYWNlU2Vuc2l0aXZlOiB1MiwgaGFzVHJhaWxpbmdTcGFjZXM6IHMyIH0gPSBpMjsKICAgICAgICAgICAgICAgICAgICB0My5wdXNoKG4zLmNsb25lKHsgdmFsdWU6IG4zLnZhbHVlICsgIjwiLmNvbmNhdChvMi5yYXdOYW1lLCAiPiIpICsgbzIuZmlyc3RDaGlsZC52YWx1ZSArICI8LyIuY29uY2F0KG8yLnJhd05hbWUsICI+IikgKyBpMi52YWx1ZSwgc291cmNlU3BhbjogbmV3IEJxKG4zLnNvdXJjZVNwYW4uc3RhcnQsIGkyLnNvdXJjZVNwYW4uZW5kKSwgaXNUcmFpbGluZ1NwYWNlU2Vuc2l0aXZlOiB1MiwgaGFzVHJhaWxpbmdTcGFjZXM6IHMyIH0pKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgdDMucHVzaChvMik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlMy5zZXRDaGlsZHJlbih0Myk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9XTsKICAgICAgICBjb25zdCBXcSA9IHsgdHlwZTogIndoaXRlc3BhY2UiIH07CiAgICAgICAgdmFyIHFxID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IGUyLm1hcCgoZTMpID0+IGUzKTsKICAgICAgICAgIGZvciAoY29uc3QgZTMgb2YgJHEpCiAgICAgICAgICAgIGUzKG4yLCB0Mik7CiAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgfTsKICAgICAgICB2YXIgVXEgPSB7IGhhc1ByYWdtYTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiAvXlxzKjwhLS1ccypAKD86Zm9ybWF0fHByZXR0aWVyKVxzKi0tPi8udGVzdChlMik7CiAgICAgICAgfSwgaW5zZXJ0UHJhZ21hOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuICI8IS0tIEBmb3JtYXQgLS0+XG5cbiIgKyBlMi5yZXBsYWNlKC9eXHMqXG4vLCAiIik7CiAgICAgICAgfSB9OwogICAgICAgIHZhciB6cSA9IHsgbG9jU3RhcnQ6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIuc291cmNlU3Bhbi5zdGFydC5vZmZzZXQ7CiAgICAgICAgfSwgbG9jRW5kOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnNvdXJjZVNwYW4uZW5kLm9mZnNldDsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgR3EgPSBUeSwgeyBpc05vbkVtcHR5QXJyYXk6IEhxIH0gPSBkYywgeyBidWlsZGVyczogeyBpbmRlbnQ6IEpxLCBqb2luOiBYcSwgbGluZTogWXEsIHNvZnRsaW5lOiBLcSB9LCB1dGlsczogeyByZXBsYWNlVGV4dEVuZE9mTGluZTogUXEgfSB9ID0gWmMsIHsgbG9jU3RhcnQ6IFpxLCBsb2NFbmQ6IGVVIH0gPSB6cSwgeyBpc1RleHRMaWtlTm9kZTogdFUsIGdldExhc3REZXNjZW5kYW50OiBuVSwgaXNQcmVMaWtlTm9kZTogclUsIGhhc1ByZXR0aWVySWdub3JlOiBvVSwgc2hvdWxkUHJlc2VydmVDb250ZW50OiBpVSB9ID0gZnE7CiAgICAgICAgZnVuY3Rpb24gdVUoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gZTIubGFzdENoaWxkICYmIGdVKGUyLmxhc3RDaGlsZCkgPyAiIiA6IFthVShlMiwgdDIpLCBsVShlMiwgdDIpXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc1UoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gKGUyLm5leHQgPyBkVShlMi5uZXh0KSA6IGhVKGUyLnBhcmVudCkpID8gIiIgOiBbcFUoZTIsIHQyKSwgY1UoZTIsIHQyKV07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFVKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGhVKGUyKSA/IHBVKGUyLmxhc3RDaGlsZCwgdDIpIDogIiI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNVKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGdVKGUyKSA/IGxVKGUyLnBhcmVudCwgdDIpIDogbVUoZTIpID8gdlUoZTIubmV4dCkgOiAiIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbFUoZTIsIHQyKSB7CiAgICAgICAgICBpZiAoR3EoIWUyLmlzU2VsZkNsb3NpbmcpLCBmVShlMiwgdDIpKQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICBzd2l0Y2ggKGUyLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiaWVDb25kaXRpb25hbENvbW1lbnQiOgogICAgICAgICAgICAgIHJldHVybiAiPCEiOwogICAgICAgICAgICBjYXNlICJlbGVtZW50IjoKICAgICAgICAgICAgICBpZiAoZTIuaGFzSHRtQ29tcG9uZW50Q2xvc2luZ1RhZykKICAgICAgICAgICAgICAgIHJldHVybiAiPC8vIjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXR1cm4gIjwvIi5jb25jYXQoZTIucmF3TmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHBVKGUyLCB0MikgewogICAgICAgICAgaWYgKGZVKGUyLCB0MikpCiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgIHN3aXRjaCAoZTIudHlwZSkgewogICAgICAgICAgICBjYXNlICJpZUNvbmRpdGlvbmFsQ29tbWVudCI6CiAgICAgICAgICAgIGNhc2UgImllQ29uZGl0aW9uYWxFbmRDb21tZW50IjoKICAgICAgICAgICAgICByZXR1cm4gIltlbmRpZl0tLT4iOwogICAgICAgICAgICBjYXNlICJpZUNvbmRpdGlvbmFsU3RhcnRDb21tZW50IjoKICAgICAgICAgICAgICByZXR1cm4gIl0+PCEtLT4iOwogICAgICAgICAgICBjYXNlICJpbnRlcnBvbGF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gIn19IjsKICAgICAgICAgICAgY2FzZSAiZWxlbWVudCI6CiAgICAgICAgICAgICAgaWYgKGUyLmlzU2VsZkNsb3NpbmcpCiAgICAgICAgICAgICAgICByZXR1cm4gIi8+IjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXR1cm4gIj4iOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBmVShlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiAhZTIuaXNTZWxmQ2xvc2luZyAmJiAhZTIuZW5kU291cmNlU3BhbiAmJiAob1UoZTIpIHx8IGlVKGUyLnBhcmVudCwgdDIpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZFUoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5wcmV2ICYmIGUyLnByZXYudHlwZSAhPT0gImRvY1R5cGUiICYmICF0VShlMi5wcmV2KSAmJiBlMi5pc0xlYWRpbmdTcGFjZVNlbnNpdGl2ZSAmJiAhZTIuaGFzTGVhZGluZ1NwYWNlczsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaFUoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5sYXN0Q2hpbGQgJiYgZTIubGFzdENoaWxkLmlzVHJhaWxpbmdTcGFjZVNlbnNpdGl2ZSAmJiAhZTIubGFzdENoaWxkLmhhc1RyYWlsaW5nU3BhY2VzICYmICF0VShuVShlMi5sYXN0Q2hpbGQpKSAmJiAhclUoZTIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnVShlMikgewogICAgICAgICAgcmV0dXJuICFlMi5uZXh0ICYmICFlMi5oYXNUcmFpbGluZ1NwYWNlcyAmJiBlMi5pc1RyYWlsaW5nU3BhY2VTZW5zaXRpdmUgJiYgdFUoblUoZTIpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbVUoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5uZXh0ICYmICF0VShlMi5uZXh0KSAmJiB0VShlMikgJiYgZTIuaXNUcmFpbGluZ1NwYWNlU2Vuc2l0aXZlICYmICFlMi5oYXNUcmFpbGluZ1NwYWNlczsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24geVUoZTIpIHsKICAgICAgICAgIHJldHVybiAhZTIucHJldiAmJiBlMi5pc0xlYWRpbmdTcGFjZVNlbnNpdGl2ZSAmJiAhZTIuaGFzTGVhZGluZ1NwYWNlczsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gRFUoZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgaWYgKCFIcShyMi5hdHRycykpCiAgICAgICAgICAgIHJldHVybiByMi5pc1NlbGZDbG9zaW5nID8gIiAiIDogIiI7CiAgICAgICAgICBjb25zdCBvMiA9IHIyLnByZXYgJiYgcjIucHJldi50eXBlID09PSAiY29tbWVudCIgJiYgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBlMy50cmltKCkubWF0Y2goL15wcmV0dGllci1pZ25vcmUtYXR0cmlidXRlKD86XHMrKC4rKSk/JC9zKTsKICAgICAgICAgICAgcmV0dXJuICEhdDMgJiYgKCF0M1sxXSB8fCB0M1sxXS5zcGxpdCgvXHMrLykpOwogICAgICAgICAgfShyMi5wcmV2LnZhbHVlKSwgaTIgPSB0eXBlb2YgbzIgPT0gImJvb2xlYW4iID8gKCkgPT4gbzIgOiBBcnJheS5pc0FycmF5KG8yKSA/IChlMykgPT4gbzIuaW5jbHVkZXMoZTMucmF3TmFtZSkgOiAoKSA9PiBmYWxzZSwgdTIgPSBlMi5tYXAoKGUzKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHIzID0gZTMuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgcmV0dXJuIGkyKHIzKSA/IFFxKHQyLm9yaWdpbmFsVGV4dC5zbGljZShacShyMyksIGVVKHIzKSkpIDogbjIoKTsKICAgICAgICAgIH0sICJhdHRycyIpLCBzMiA9IHIyLnR5cGUgPT09ICJlbGVtZW50IiAmJiByMi5mdWxsTmFtZSA9PT0gInNjcmlwdCIgJiYgcjIuYXR0cnMubGVuZ3RoID09PSAxICYmIHIyLmF0dHJzWzBdLmZ1bGxOYW1lID09PSAic3JjIiAmJiByMi5jaGlsZHJlbi5sZW5ndGggPT09IDAsIGEyID0gW0pxKFtzMiA/ICIgIiA6IFlxLCBYcShZcSwgdTIpXSldOwogICAgICAgICAgcmV0dXJuIHIyLmZpcnN0Q2hpbGQgJiYgeVUocjIuZmlyc3RDaGlsZCkgfHwgcjIuaXNTZWxmQ2xvc2luZyAmJiBoVShyMi5wYXJlbnQpIHx8IHMyID8gYTIucHVzaChyMi5pc1NlbGZDbG9zaW5nID8gIiAiIDogIiIpIDogYTIucHVzaCh0Mi5icmFja2V0U2FtZUxpbmUgPyByMi5pc1NlbGZDbG9zaW5nID8gIiAiIDogIiIgOiByMi5pc1NlbGZDbG9zaW5nID8gWXEgOiBLcSksIGEyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBFVShlMikgewogICAgICAgICAgcmV0dXJuIGUyLmZpcnN0Q2hpbGQgJiYgeVUoZTIuZmlyc3RDaGlsZCkgPyAiIiA6IEFVKGUyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQ1UoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gZTIucHJldiAmJiBtVShlMi5wcmV2KSA/ICIiIDogW2JVKGUyLCB0MiksIHZVKGUyKV07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJVKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHlVKGUyKSA/IEFVKGUyLnBhcmVudCkgOiBkVShlMikgPyBwVShlMi5wcmV2LCB0MikgOiAiIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdlUoZTIpIHsKICAgICAgICAgIHN3aXRjaCAoZTIudHlwZSkgewogICAgICAgICAgICBjYXNlICJpZUNvbmRpdGlvbmFsQ29tbWVudCI6CiAgICAgICAgICAgIGNhc2UgImllQ29uZGl0aW9uYWxTdGFydENvbW1lbnQiOgogICAgICAgICAgICAgIHJldHVybiAiPCEtLVtpZiAiLmNvbmNhdChlMi5jb25kaXRpb24pOwogICAgICAgICAgICBjYXNlICJpZUNvbmRpdGlvbmFsRW5kQ29tbWVudCI6CiAgICAgICAgICAgICAgcmV0dXJuICI8IS0tPCEiOwogICAgICAgICAgICBjYXNlICJpbnRlcnBvbGF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gInt7IjsKICAgICAgICAgICAgY2FzZSAiZG9jVHlwZSI6CiAgICAgICAgICAgICAgcmV0dXJuICI8IURPQ1RZUEUiOwogICAgICAgICAgICBjYXNlICJlbGVtZW50IjoKICAgICAgICAgICAgICBpZiAoZTIuY29uZGl0aW9uKQogICAgICAgICAgICAgICAgcmV0dXJuICI8IS0tW2lmICIuY29uY2F0KGUyLmNvbmRpdGlvbiwgIl0+PCEtLT48IikuY29uY2F0KGUyLnJhd05hbWUpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHJldHVybiAiPCIuY29uY2F0KGUyLnJhd05hbWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBBVShlMikgewogICAgICAgICAgc3dpdGNoIChHcSghZTIuaXNTZWxmQ2xvc2luZyksIGUyLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiaWVDb25kaXRpb25hbENvbW1lbnQiOgogICAgICAgICAgICAgIHJldHVybiAiXT4iOwogICAgICAgICAgICBjYXNlICJlbGVtZW50IjoKICAgICAgICAgICAgICBpZiAoZTIuY29uZGl0aW9uKQogICAgICAgICAgICAgICAgcmV0dXJuICI+PCEtLTwhW2VuZGlmXS0tPiI7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgcmV0dXJuICI+IjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIEZVID0geyBwcmludENsb3NpbmdUYWc6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIFtlMi5pc1NlbGZDbG9zaW5nID8gIiIgOiB1VShlMiwgdDIpLCBzVShlMiwgdDIpXTsKICAgICAgICB9LCBwcmludENsb3NpbmdUYWdTdGFydDogdVUsIHByaW50Q2xvc2luZ1RhZ1N0YXJ0TWFya2VyOiBsVSwgcHJpbnRDbG9zaW5nVGFnRW5kTWFya2VyOiBwVSwgcHJpbnRDbG9zaW5nVGFnU3VmZml4OiBjVSwgcHJpbnRDbG9zaW5nVGFnRW5kOiBzVSwgbmVlZHNUb0JvcnJvd0xhc3RDaGlsZENsb3NpbmdUYWdFbmRNYXJrZXI6IGhVLCBuZWVkc1RvQm9ycm93UGFyZW50Q2xvc2luZ1RhZ1N0YXJ0TWFya2VyOiBnVSwgbmVlZHNUb0JvcnJvd1ByZXZDbG9zaW5nVGFnRW5kTWFya2VyOiBkVSwgcHJpbnRPcGVuaW5nVGFnOiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICByZXR1cm4gW0NVKHIyLCB0MiksIERVKGUyLCB0MiwgbjIpLCByMi5pc1NlbGZDbG9zaW5nID8gIiIgOiBFVShyMildOwogICAgICAgIH0sIHByaW50T3BlbmluZ1RhZ1N0YXJ0OiBDVSwgcHJpbnRPcGVuaW5nVGFnUHJlZml4OiBiVSwgcHJpbnRPcGVuaW5nVGFnU3RhcnRNYXJrZXI6IHZVLCBwcmludE9wZW5pbmdUYWdFbmRNYXJrZXI6IEFVLCBuZWVkc1RvQm9ycm93TmV4dE9wZW5pbmdUYWdTdGFydE1hcmtlcjogbVUsIG5lZWRzVG9Cb3Jyb3dQYXJlbnRPcGVuaW5nVGFnRW5kTWFya2VyOiB5VSB9LCB4VSA9IHsgZXhwb3J0czoge30gfTsKICAgICAgICAhZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHZhciBuMiwgcjI7CiAgICAgICAgICBuMiA9IGUsIHIyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMiwgdDMpIHsKICAgICAgICAgICAgICB2YXIgbjMgPSB0MyAmJiB0My5sb2dnZXIgfHwgY29uc29sZTsKICAgICAgICAgICAgICBmdW5jdGlvbiByMyhlMykgewogICAgICAgICAgICAgICAgcmV0dXJuIGUzID09PSAiICIgfHwgZTMgPT09ICIJIiB8fCBlMyA9PT0gIlxuIiB8fCBlMyA9PT0gIlxmIiB8fCBlMyA9PT0gIlxyIjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZnVuY3Rpb24gbzIodDQpIHsKICAgICAgICAgICAgICAgIHZhciBuNCwgcjQgPSB0NC5leGVjKGUyLnN1YnN0cmluZyh5MikpOwogICAgICAgICAgICAgICAgaWYgKHI0KQogICAgICAgICAgICAgICAgICByZXR1cm4gbjQgPSByNFswXSwgeTIgKz0gbjQubGVuZ3RoLCBuNDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZm9yICh2YXIgaTIsIHUyLCBzMiwgYTIsIGMyLCBsMiA9IGUyLmxlbmd0aCwgcDIgPSAvXlsgXHRcblxyXHUwMDBjXSsvLCBmMiA9IC9eWywgXHRcblxyXHUwMDBjXSsvLCBkMiA9IC9eW14gXHRcblxyXHUwMDBjXSsvLCBoMiA9IC9bLF0rJC8sIGcyID0gL15cZCskLywgbTIgPSAvXi0/KD86WzAtOV0rfFswLTldKlwuWzAtOV0rKSg/OltlRV1bKy1dP1swLTldKyk/JC8sIHkyID0gMCwgRDIgPSBbXTsgOyApIHsKICAgICAgICAgICAgICAgIGlmIChvMihmMiksIHkyID49IGwyKQogICAgICAgICAgICAgICAgICByZXR1cm4gRDI7CiAgICAgICAgICAgICAgICBpMiA9IG8yKGQyKSwgdTIgPSBbXSwgaTIuc2xpY2UoLTEpID09PSAiLCIgPyAoaTIgPSBpMi5yZXBsYWNlKGgyLCAiIiksIEMyKCkpIDogRTIoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZnVuY3Rpb24gRTIoKSB7CiAgICAgICAgICAgICAgICBmb3IgKG8yKHAyKSwgczIgPSAiIiwgYTIgPSAiaW4gZGVzY3JpcHRvciI7IDsgKSB7CiAgICAgICAgICAgICAgICAgIGlmIChjMiA9IGUyLmNoYXJBdCh5MiksIGEyID09PSAiaW4gZGVzY3JpcHRvciIpCiAgICAgICAgICAgICAgICAgICAgaWYgKHIzKGMyKSkKICAgICAgICAgICAgICAgICAgICAgIHMyICYmICh1Mi5wdXNoKHMyKSwgczIgPSAiIiwgYTIgPSAiYWZ0ZXIgZGVzY3JpcHRvciIpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGMyID09PSAiLCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB5MiArPSAxLCBzMiAmJiB1Mi5wdXNoKHMyKSwgdm9pZCBDMigpOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGMyID09PSAiKCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHMyICs9IGMyLCBhMiA9ICJpbiBwYXJlbnMiOwogICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjMiA9PT0gIiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMyICYmIHUyLnB1c2goczIpLCB2b2lkIEMyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHMyICs9IGMyOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYTIgPT09ICJpbiBwYXJlbnMiKQogICAgICAgICAgICAgICAgICAgIGlmIChjMiA9PT0gIikiKQogICAgICAgICAgICAgICAgICAgICAgczIgKz0gYzIsIGEyID0gImluIGRlc2NyaXB0b3IiOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGMyID09PSAiIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHUyLnB1c2goczIpLCB2b2lkIEMyKCk7CiAgICAgICAgICAgICAgICAgICAgICBzMiArPSBjMjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGEyID09PSAiYWZ0ZXIgZGVzY3JpcHRvciIpCiAgICAgICAgICAgICAgICAgICAgaWYgKHIzKGMyKSkKICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChjMiA9PT0gIiIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIEMyKCk7CiAgICAgICAgICAgICAgICAgICAgICBhMiA9ICJpbiBkZXNjcmlwdG9yIiwgeTIgLT0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHkyICs9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZ1bmN0aW9uIEMyKCkgewogICAgICAgICAgICAgICAgdmFyIHQ0LCByNCwgbzMsIHMzLCBhMywgYzMsIGwzLCBwMywgZjMsIGQzID0gZmFsc2UsIGgzID0ge307CiAgICAgICAgICAgICAgICBmb3IgKHMzID0gMDsgczMgPCB1Mi5sZW5ndGg7IHMzKyspCiAgICAgICAgICAgICAgICAgIGMzID0gKGEzID0gdTJbczNdKVthMy5sZW5ndGggLSAxXSwgbDMgPSBhMy5zdWJzdHJpbmcoMCwgYTMubGVuZ3RoIC0gMSksIHAzID0gcGFyc2VJbnQobDMsIDEwKSwgZjMgPSBwYXJzZUZsb2F0KGwzKSwgZzIudGVzdChsMykgJiYgYzMgPT09ICJ3IiA/ICgodDQgfHwgcjQpICYmIChkMyA9IHRydWUpLCBwMyA9PT0gMCA/IGQzID0gdHJ1ZSA6IHQ0ID0gcDMpIDogbTIudGVzdChsMykgJiYgYzMgPT09ICJ4IiA/ICgodDQgfHwgcjQgfHwgbzMpICYmIChkMyA9IHRydWUpLCBmMyA8IDAgPyBkMyA9IHRydWUgOiByNCA9IGYzKSA6IGcyLnRlc3QobDMpICYmIGMzID09PSAiaCIgPyAoKG8zIHx8IHI0KSAmJiAoZDMgPSB0cnVlKSwgcDMgPT09IDAgPyBkMyA9IHRydWUgOiBvMyA9IHAzKSA6IGQzID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGQzID8gbjMgJiYgbjMuZXJyb3IgJiYgbjMuZXJyb3IoIkludmFsaWQgc3Jjc2V0IGRlc2NyaXB0b3IgZm91bmQgaW4gJyIgKyBlMiArICInIGF0ICciICsgYTMgKyAiJy4iKSA6IChoMy51cmwgPSBpMiwgdDQgJiYgKGgzLncgPSB0NCksIHI0ICYmIChoMy5kID0gcjQpLCBvMyAmJiAoaDMuaCA9IG8zKSwgRDIucHVzaChoMykpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgIH0sIHQyLmV4cG9ydHMgPyB0Mi5leHBvcnRzID0gcjIoKSA6IG4yLnBhcnNlU3Jjc2V0ID0gcjIoKTsKICAgICAgICB9KHhVKTsKICAgICAgICBjb25zdCBTVSA9IHhVLmV4cG9ydHMsIHsgYnVpbGRlcnM6IHsgaWZCcmVhazogd1UsIGpvaW46IFRVLCBsaW5lOiBCVSB9IH0gPSBaYzsKICAgICAgICB2YXIgTlUgPSB7IHByaW50SW1nU3Jjc2V0OiBmdW5jdGlvbihlMikgewogICAgICAgICAgY29uc3QgdDIgPSBTVShlMiwgeyBsb2dnZXI6IHsgZXJyb3IoZTMpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGUzKTsKICAgICAgICAgIH0gfSB9KSwgbjIgPSB0Mi5zb21lKChlMykgPT4gewogICAgICAgICAgICBsZXQgeyB3OiB0MyB9ID0gZTM7CiAgICAgICAgICAgIHJldHVybiB0MzsKICAgICAgICAgIH0pLCByMiA9IHQyLnNvbWUoKGUzKSA9PiB7CiAgICAgICAgICAgIGxldCB7IGg6IHQzIH0gPSBlMzsKICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAobjIgKyByMiArIHQyLnNvbWUoKGUzKSA9PiB7CiAgICAgICAgICAgIGxldCB7IGQ6IHQzIH0gPSBlMzsKICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfSkgPiAxKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1peGVkIGRlc2NyaXB0b3IgaW4gc3Jjc2V0IGlzIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICAgIGNvbnN0IG8yID0gbjIgPyAidyIgOiByMiA/ICJoIiA6ICJkIiwgaTIgPSBuMiA/ICJ3IiA6IHIyID8gImgiIDogIngiLCB1MiA9IChlMykgPT4gTWF0aC5tYXgoLi4uZTMpLCBzMiA9IHQyLm1hcCgoZTMpID0+IGUzLnVybCksIGEyID0gdTIoczIubWFwKChlMykgPT4gZTMubGVuZ3RoKSksIGMyID0gdDIubWFwKChlMykgPT4gZTNbbzJdKS5tYXAoKGUzKSA9PiBlMyA/IGUzLnRvU3RyaW5nKCkgOiAiIiksIGwyID0gYzIubWFwKChlMykgPT4gewogICAgICAgICAgICBjb25zdCB0MyA9IGUzLmluZGV4T2YoIi4iKTsKICAgICAgICAgICAgcmV0dXJuIHQzID09PSAtMSA/IGUzLmxlbmd0aCA6IHQzOwogICAgICAgICAgfSksIHAyID0gdTIobDIpOwogICAgICAgICAgcmV0dXJuIFRVKFsiLCIsIEJVXSwgczIubWFwKChlMywgdDMpID0+IHsKICAgICAgICAgICAgY29uc3QgbjMgPSBbZTNdLCByMyA9IGMyW3QzXTsKICAgICAgICAgICAgaWYgKHIzKSB7CiAgICAgICAgICAgICAgY29uc3QgbzMgPSBhMiAtIGUzLmxlbmd0aCArIDEsIHUzID0gcDIgLSBsMlt0M10sIHMzID0gIiAiLnJlcGVhdChvMyArIHUzKTsKICAgICAgICAgICAgICBuMy5wdXNoKHdVKHMzLCAiICIpLCByMyArIGkyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbjM7CiAgICAgICAgICB9KSk7CiAgICAgICAgfSwgcHJpbnRDbGFzc05hbWVzOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnRyaW0oKS5zcGxpdCgvXHMrLykuam9pbigiICIpOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IGdyb3VwOiBrVSB9IH0gPSBaYzsKICAgICAgICB2YXIgUFUgPSB7IGlzVnVlRXZlbnRCaW5kaW5nRXhwcmVzc2lvbjogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTIudHJpbSgpOwogICAgICAgICAgcmV0dXJuIC9eKD86W1x3JF0rfFwoW14pXSo/XCkpXHMqPT58XmZ1bmN0aW9uXHMqXCgvLnRlc3QodDIpIHx8IC9eWyRBLVpfYS16XVtcdyRdKig/OlwuWyRBLVpfYS16XVtcdyRdKnxcWydbXiddKj8nXXxcWyJbXiJdKj8iXXxcW1xkK118XFtbJEEtWl9hLXpdW1x3JF0qXSkqJC8udGVzdCh0Mik7CiAgICAgICAgfSwgcHJpbnRWdWVGb3I6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgeyBsZWZ0OiBuMiwgb3BlcmF0b3I6IHIyLCByaWdodDogbzIgfSA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gLyguKj8pXHMrKGlufG9mKVxzKyguKikvcywgbjMgPSAvLChbXixcXX1dKikoPzosKFteLFxdfV0qKSk/JC8sIHIzID0gL15cKHxcKSQvZywgbzMgPSBlMy5tYXRjaCh0Myk7CiAgICAgICAgICAgIGlmICghbzMpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBpMiA9IHt9OwogICAgICAgICAgICBpMi5mb3IgPSBvM1szXS50cmltKCk7CiAgICAgICAgICAgIGNvbnN0IHUyID0gbzNbMV0udHJpbSgpLnJlcGxhY2UocjMsICIiKSwgczIgPSB1Mi5tYXRjaChuMyk7CiAgICAgICAgICAgIHMyID8gKGkyLmFsaWFzID0gdTIucmVwbGFjZShuMywgIiIpLCBpMi5pdGVyYXRvcjEgPSBzMlsxXS50cmltKCksIHMyWzJdICYmIChpMi5pdGVyYXRvcjIgPSBzMlsyXS50cmltKCkpKSA6IGkyLmFsaWFzID0gdTI7CiAgICAgICAgICAgIHJldHVybiB7IGxlZnQ6ICIiLmNvbmNhdChbaTIuYWxpYXMsIGkyLml0ZXJhdG9yMSwgaTIuaXRlcmF0b3IyXS5maWx0ZXIoQm9vbGVhbikuam9pbigiLCIpKSwgb3BlcmF0b3I6IG8zWzJdLCByaWdodDogaTIuZm9yIH07CiAgICAgICAgICB9KGUyKTsKICAgICAgICAgIHJldHVybiBba1UodDIoImZ1bmN0aW9uIF8oIi5jb25jYXQobjIsICIpIHt9IiksIHsgcGFyc2VyOiAiYmFiZWwiLCBfX2lzVnVlRm9yQmluZGluZ0xlZnQ6IHRydWUgfSkpLCAiICIsIHIyLCAiICIsIHQyKG8yLCB7IHBhcnNlcjogIl9fanNfZXhwcmVzc2lvbiIgfSwgeyBzdHJpcFRyYWlsaW5nSGFyZGxpbmU6IHRydWUgfSldOwogICAgICAgIH0sIHByaW50VnVlQmluZGluZ3M6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHQyKCJmdW5jdGlvbiBfKCIuY29uY2F0KGUyLCAiKSB7fSIpLCB7IHBhcnNlcjogImJhYmVsIiwgX19pc1Z1ZUJpbmRpbmdzOiB0cnVlIH0pOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IG5lZWRzVG9Cb3Jyb3dQYXJlbnRDbG9zaW5nVGFnU3RhcnRNYXJrZXI6IE9VLCBwcmludENsb3NpbmdUYWdTdGFydE1hcmtlcjogSVUsIG5lZWRzVG9Cb3Jyb3dMYXN0Q2hpbGRDbG9zaW5nVGFnRW5kTWFya2VyOiBMVSwgcHJpbnRDbG9zaW5nVGFnRW5kTWFya2VyOiBqVSwgbmVlZHNUb0JvcnJvd1BhcmVudE9wZW5pbmdUYWdFbmRNYXJrZXI6IF9VLCBwcmludE9wZW5pbmdUYWdFbmRNYXJrZXI6IE1VIH0gPSBGVTsKICAgICAgICB2YXIgUlUgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGxldCBuMiA9IGUyLnN0YXJ0U291cmNlU3Bhbi5lbmQub2Zmc2V0OwogICAgICAgICAgZTIuZmlyc3RDaGlsZCAmJiBfVShlMi5maXJzdENoaWxkKSAmJiAobjIgLT0gTVUoZTIpLmxlbmd0aCk7CiAgICAgICAgICBsZXQgcjIgPSBlMi5lbmRTb3VyY2VTcGFuLnN0YXJ0Lm9mZnNldDsKICAgICAgICAgIHJldHVybiBlMi5sYXN0Q2hpbGQgJiYgT1UoZTIubGFzdENoaWxkKSA/IHIyICs9IElVKGUyLCB0MikubGVuZ3RoIDogTFUoZTIpICYmIChyMiAtPSBqVShlMi5sYXN0Q2hpbGQsIHQyKS5sZW5ndGgpLCB0Mi5vcmlnaW5hbFRleHQuc2xpY2UobjIsIHIyKTsKICAgICAgICB9OwogICAgICAgIGNvbnN0IHsgYnVpbGRlcnM6IHsgYnJlYWtQYXJlbnQ6IFZVLCBncm91cDogJFUsIGhhcmRsaW5lOiBXVSwgaW5kZW50OiBxVSwgbGluZTogVVUsIGZpbGw6IHpVLCBzb2Z0bGluZTogR1UgfSwgdXRpbHM6IHsgbWFwRG9jOiBIVSwgcmVwbGFjZVRleHRFbmRPZkxpbmU6IEpVIH0gfSA9IFpjLCBYVSA9IFdqLCB7IHByaW50Q2xvc2luZ1RhZzogWVUsIHByaW50Q2xvc2luZ1RhZ1N1ZmZpeDogS1UsIG5lZWRzVG9Cb3Jyb3dQcmV2Q2xvc2luZ1RhZ0VuZE1hcmtlcjogUVUsIHByaW50T3BlbmluZ1RhZ1ByZWZpeDogWlUsIHByaW50T3BlbmluZ1RhZzogZXogfSA9IEZVLCB7IHByaW50SW1nU3Jjc2V0OiB0eiwgcHJpbnRDbGFzc05hbWVzOiBueiB9ID0gTlUsIHsgcHJpbnRWdWVGb3I6IHJ6LCBwcmludFZ1ZUJpbmRpbmdzOiBveiwgaXNWdWVFdmVudEJpbmRpbmdFeHByZXNzaW9uOiBpeiB9ID0gUFUsIHsgaXNTY3JpcHRMaWtlVGFnOiB1eiwgaXNWdWVOb25IdG1sQmxvY2s6IHN6LCBpbmZlclNjcmlwdFBhcnNlcjogYXosIGh0bWxUcmltUHJlc2VydmVJbmRlbnRhdGlvbjogY3osIGRlZGVudFN0cmluZzogbHosIHVuZXNjYXBlUXVvdGVFbnRpdGllczogcHosIGlzVnVlU2xvdEF0dHJpYnV0ZTogZnosIGlzVnVlU2ZjQmluZGluZ3NBdHRyaWJ1dGU6IGR6LCBnZXRUZXh0VmFsdWVQYXJ0czogaHogfSA9IGZxLCBneiA9IFJVOwogICAgICAgIGZ1bmN0aW9uIG16KGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gKHQzKSA9PiBuZXcgUmVnRXhwKHQzLmpvaW4oInwiKSkudGVzdChlMi5mdWxsTmFtZSksIG8yID0gKCkgPT4gcHooZTIudmFsdWUpOwogICAgICAgICAgbGV0IGkyID0gZmFsc2U7CiAgICAgICAgICBjb25zdCB1MiA9IChlMywgdDMpID0+IHsKICAgICAgICAgICAgY29uc3QgbjMgPSBlMy50eXBlID09PSAiTkdSb290IiA/IGUzLm5vZGUudHlwZSA9PT0gIk5HTWljcm9zeW50YXgiICYmIGUzLm5vZGUuYm9keS5sZW5ndGggPT09IDEgJiYgZTMubm9kZS5ib2R5WzBdLnR5cGUgPT09ICJOR01pY3Jvc3ludGF4RXhwcmVzc2lvbiIgPyBlMy5ub2RlLmJvZHlbMF0uZXhwcmVzc2lvbiA6IGUzLm5vZGUgOiBlMy50eXBlID09PSAiSnNFeHByZXNzaW9uUm9vdCIgPyBlMy5ub2RlIDogZTM7CiAgICAgICAgICAgICFuMyB8fCBuMy50eXBlICE9PSAiT2JqZWN0RXhwcmVzc2lvbiIgJiYgbjMudHlwZSAhPT0gIkFycmF5RXhwcmVzc2lvbiIgJiYgKHQzLnBhcnNlciAhPT0gIl9fdnVlX2V4cHJlc3Npb24iIHx8IG4zLnR5cGUgIT09ICJUZW1wbGF0ZUxpdGVyYWwiICYmIG4zLnR5cGUgIT09ICJTdHJpbmdMaXRlcmFsIikgfHwgKGkyID0gdHJ1ZSk7CiAgICAgICAgICB9LCBzMiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGxldCB0MyA9ICEoYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDApIHx8IGFyZ3VtZW50c1sxXTsKICAgICAgICAgICAgcmV0dXJuICRVKFtxVShbR1UsIGUzXSksIHQzID8gR1UgOiAiIl0pOwogICAgICAgICAgfSwgYTIgPSAoZTMpID0+IGkyID8gKChlNCkgPT4gJFUoZTQpKShlMykgOiBzMihlMyksIGMyID0gKGUzLCBuMykgPT4gdDIoZTMsIE9iamVjdC5hc3NpZ24oeyBfX29uSHRtbEJpbmRpbmdSb290OiB1MiwgX19lbWJlZGRlZEluSHRtbDogdHJ1ZSB9LCBuMyksIHsgc3RyaXBUcmFpbGluZ0hhcmRsaW5lOiB0cnVlIH0pOwogICAgICAgICAgaWYgKGUyLmZ1bGxOYW1lID09PSAic3Jjc2V0IiAmJiAoZTIucGFyZW50LmZ1bGxOYW1lID09PSAiaW1nIiB8fCBlMi5wYXJlbnQuZnVsbE5hbWUgPT09ICJzb3VyY2UiKSkKICAgICAgICAgICAgcmV0dXJuIHMyKHR6KG8yKCkpKTsKICAgICAgICAgIGlmIChlMi5mdWxsTmFtZSA9PT0gImNsYXNzIiAmJiAhbjIucGFyZW50UGFyc2VyKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gbzIoKTsKICAgICAgICAgICAgaWYgKCFlMy5pbmNsdWRlcygie3siKSkKICAgICAgICAgICAgICByZXR1cm4gbnooZTMpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGUyLmZ1bGxOYW1lID09PSAic3R5bGUiICYmICFuMi5wYXJlbnRQYXJzZXIpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSBvMigpOwogICAgICAgICAgICBpZiAoIWUzLmluY2x1ZGVzKCJ7eyIpKQogICAgICAgICAgICAgIHJldHVybiBzMihjMihlMywgeyBwYXJzZXI6ICJjc3MiLCBfX2lzSFRNTFN0eWxlQXR0cmlidXRlOiB0cnVlIH0pKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChuMi5wYXJzZXIgPT09ICJ2dWUiKSB7CiAgICAgICAgICAgIGlmIChlMi5mdWxsTmFtZSA9PT0gInYtZm9yIikKICAgICAgICAgICAgICByZXR1cm4gcnoobzIoKSwgYzIpOwogICAgICAgICAgICBpZiAoZnooZTIpIHx8IGR6KGUyLCBuMikpCiAgICAgICAgICAgICAgcmV0dXJuIG96KG8yKCksIGMyKTsKICAgICAgICAgICAgY29uc3QgdDMgPSBbIl46IiwgIl52LWJpbmQ6Il0sIGkzID0gWyJedi0iXTsKICAgICAgICAgICAgaWYgKHIyKFsiXkAiLCAiXnYtb246Il0pKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSBvMigpOwogICAgICAgICAgICAgIHJldHVybiBhMihjMihlMywgeyBwYXJzZXI6IGl6KGUzKSA/ICJfX2pzX2V4cHJlc3Npb24iIDogIl9fdnVlX2V2ZW50X2JpbmRpbmciIH0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocjIodDMpKQogICAgICAgICAgICAgIHJldHVybiBhMihjMihvMigpLCB7IHBhcnNlcjogIl9fdnVlX2V4cHJlc3Npb24iIH0pKTsKICAgICAgICAgICAgaWYgKHIyKGkzKSkKICAgICAgICAgICAgICByZXR1cm4gYTIoYzIobzIoKSwgeyBwYXJzZXI6ICJfX2pzX2V4cHJlc3Npb24iIH0pKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChuMi5wYXJzZXIgPT09ICJhbmd1bGFyIikgewogICAgICAgICAgICBjb25zdCB0MyA9IChlMywgdDQpID0+IGMyKGUzLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHQ0KSwge30sIHsgdHJhaWxpbmdDb21tYTogIm5vbmUiIH0pKSwgbjMgPSBbIl5cXCoiXSwgaTMgPSBbIl5cXFsuK1xcXSQiLCAiXmJpbmQob24pPy0iLCAiXm5nLShpZnxzaG93fGhpZGV8Y2xhc3N8c3R5bGUpJCJdLCB1MyA9IFsiXmkxOG4oLS4rKT8kIl07CiAgICAgICAgICAgIGlmIChyMihbIl5cXCguK1xcKSQiLCAiXm9uLSJdKSkKICAgICAgICAgICAgICByZXR1cm4gYTIodDMobzIoKSwgeyBwYXJzZXI6ICJfX25nX2FjdGlvbiIgfSkpOwogICAgICAgICAgICBpZiAocjIoaTMpKQogICAgICAgICAgICAgIHJldHVybiBhMih0MyhvMigpLCB7IHBhcnNlcjogIl9fbmdfYmluZGluZyIgfSkpOwogICAgICAgICAgICBpZiAocjIodTMpKSB7CiAgICAgICAgICAgICAgY29uc3QgdDQgPSBvMigpLnRyaW0oKTsKICAgICAgICAgICAgICByZXR1cm4gczIoelUoaHooZTIsIHQ0KSksICF0NC5pbmNsdWRlcygiQEAiKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHIyKG4zKSkKICAgICAgICAgICAgICByZXR1cm4gYTIodDMobzIoKSwgeyBwYXJzZXI6ICJfX25nX2RpcmVjdGl2ZSIgfSkpOwogICAgICAgICAgICBjb25zdCBsMiA9IC97eyguKz8pfX0vcywgcDIgPSBvMigpOwogICAgICAgICAgICBpZiAobDIudGVzdChwMikpIHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IFtdOwogICAgICAgICAgICAgIGZvciAoY29uc3QgW240LCByM10gb2YgcDIuc3BsaXQobDIpLmVudHJpZXMoKSkKICAgICAgICAgICAgICAgIGlmIChuNCAlIDIgPT0gMCkKICAgICAgICAgICAgICAgICAgZTMucHVzaChKVShyMykpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGUzLnB1c2goJFUoWyJ7eyIsIHFVKFtVVSwgdDMocjMsIHsgcGFyc2VyOiAiX19uZ19pbnRlcnBvbGF0aW9uIiwgX19pc0luSHRtbEludGVycG9sYXRpb246IHRydWUgfSldKSwgVVUsICJ9fSJdKSk7CiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGU0KSB7CiAgICAgICAgICAgICAgICAgICAgZTMucHVzaCgie3siLCBKVShyMyksICJ9fSIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuICRVKGUzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHZhciB5eiA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICBjb25zdCBvMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBzd2l0Y2ggKG8yLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiZWxlbWVudCI6CiAgICAgICAgICAgICAgaWYgKHV6KG8yKSB8fCBvMi50eXBlID09PSAiaW50ZXJwb2xhdGlvbiIpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgaWYgKCFvMi5pc1NlbGZDbG9zaW5nICYmIHN6KG8yLCByMikpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkyID0gYXoobzIsIHIyKTsKICAgICAgICAgICAgICAgIGlmICghaTIpCiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IHUyID0gZ3oobzIsIHIyKTsKICAgICAgICAgICAgICAgIGxldCBzMiA9IC9eXHMqJC8udGVzdCh1MiksIGEyID0gIiI7CiAgICAgICAgICAgICAgICByZXR1cm4gczIgfHwgKGEyID0gbjIoY3oodTIpLCB7IHBhcnNlcjogaTIsIF9fZW1iZWRkZWRJbkh0bWw6IHRydWUgfSwgeyBzdHJpcFRyYWlsaW5nSGFyZGxpbmU6IHRydWUgfSksIHMyID0gYTIgPT09ICIiKSwgW1pVKG8yLCByMiksICRVKGV6KGUyLCByMiwgdDIpKSwgczIgPyAiIiA6IFdVLCBhMiwgczIgPyAiIiA6IFdVLCBZVShvMiwgcjIpLCBLVShvMiwgcjIpXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInRleHQiOgogICAgICAgICAgICAgIGlmICh1eihvMi5wYXJlbnQpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlMyA9IGF6KG8yLnBhcmVudCk7CiAgICAgICAgICAgICAgICBpZiAoZTMpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdDMgPSBlMyA9PT0gIm1hcmtkb3duIiA/IGx6KG8yLnZhbHVlLnJlcGxhY2UoL15bXlxTXG5dKj9cbi8sICIiKSkgOiBvMi52YWx1ZSwgaTIgPSB7IHBhcnNlcjogZTMsIF9fZW1iZWRkZWRJbkh0bWw6IHRydWUgfTsKICAgICAgICAgICAgICAgICAgaWYgKHIyLnBhcnNlciA9PT0gImh0bWwiICYmIGUzID09PSAiYmFiZWwiKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGU0ID0gInNjcmlwdCI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBhdHRyTWFwOiB0NCB9ID0gbzIucGFyZW50OwogICAgICAgICAgICAgICAgICAgIHQ0ICYmICh0NC50eXBlID09PSAibW9kdWxlIiB8fCB0NC50eXBlID09PSAidGV4dC9iYWJlbCIgJiYgdDRbImRhdGEtdHlwZSJdID09PSAibW9kdWxlIikgJiYgKGU0ID0gIm1vZHVsZSIpLCBpMi5fX2JhYmVsU291cmNlVHlwZSA9IGU0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiBbVlUsIFpVKG8yLCByMiksIG4yKHQzLCBpMiwgeyBzdHJpcFRyYWlsaW5nSGFyZGxpbmU6IHRydWUgfSksIEtVKG8yLCByMildOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAobzIucGFyZW50LnR5cGUgPT09ICJpbnRlcnBvbGF0aW9uIikgewogICAgICAgICAgICAgICAgY29uc3QgZTMgPSB7IF9faXNJbkh0bWxJbnRlcnBvbGF0aW9uOiB0cnVlLCBfX2VtYmVkZGVkSW5IdG1sOiB0cnVlIH07CiAgICAgICAgICAgICAgICByZXR1cm4gcjIucGFyc2VyID09PSAiYW5ndWxhciIgPyAoZTMucGFyc2VyID0gIl9fbmdfaW50ZXJwb2xhdGlvbiIsIGUzLnRyYWlsaW5nQ29tbWEgPSAibm9uZSIpIDogcjIucGFyc2VyID09PSAidnVlIiA/IGUzLnBhcnNlciA9ICJfX3Z1ZV9leHByZXNzaW9uIiA6IGUzLnBhcnNlciA9ICJfX2pzX2V4cHJlc3Npb24iLCBbcVUoW1VVLCBuMihvMi52YWx1ZSwgZTMsIHsgc3RyaXBUcmFpbGluZ0hhcmRsaW5lOiB0cnVlIH0pXSksIG8yLnBhcmVudC5uZXh0ICYmIFFVKG8yLnBhcmVudC5uZXh0KSA/ICIgIiA6IFVVXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImF0dHJpYnV0ZSI6IHsKICAgICAgICAgICAgICBpZiAoIW8yLnZhbHVlKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgaWYgKC9eUFJFVFRJRVJfSFRNTF9QTEFDRUhPTERFUl9cZCtfXGQrX0lOX0pTJC8udGVzdChyMi5vcmlnaW5hbFRleHQuc2xpY2UobzIudmFsdWVTcGFuLnN0YXJ0Lm9mZnNldCwgbzIudmFsdWVTcGFuLmVuZC5vZmZzZXQpKSkKICAgICAgICAgICAgICAgIHJldHVybiBbbzIucmF3TmFtZSwgIj0iLCBvMi52YWx1ZV07CiAgICAgICAgICAgICAgaWYgKHIyLnBhcnNlciA9PT0gImx3YyIpIHsKICAgICAgICAgICAgICAgIGlmICgvXnsuKn0kL3MudGVzdChyMi5vcmlnaW5hbFRleHQuc2xpY2UobzIudmFsdWVTcGFuLnN0YXJ0Lm9mZnNldCwgbzIudmFsdWVTcGFuLmVuZC5vZmZzZXQpKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIFtvMi5yYXdOYW1lLCAiPSIsIG8yLnZhbHVlXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZTMgPSBteihvMiwgKGU0LCB0MykgPT4gbjIoZTQsIE9iamVjdC5hc3NpZ24oeyBfX2lzSW5IdG1sQXR0cmlidXRlOiB0cnVlLCBfX2VtYmVkZGVkSW5IdG1sOiB0cnVlIH0sIHQzKSwgeyBzdHJpcFRyYWlsaW5nSGFyZGxpbmU6IHRydWUgfSksIHIyKTsKICAgICAgICAgICAgICBpZiAoZTMpCiAgICAgICAgICAgICAgICByZXR1cm4gW28yLnJhd05hbWUsICc9IicsICRVKEhVKGUzLCAoZTQpID0+IHR5cGVvZiBlNCA9PSAic3RyaW5nIiA/IGU0LnJlcGxhY2UoLyIvZywgIiZxdW90OyIpIDogZTQpKSwgJyInXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmcm9udC1tYXR0ZXIiOgogICAgICAgICAgICAgIHJldHVybiBYVShvMiwgbjIpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY29uc3QgeyBidWlsZGVyczogeyBicmVha1BhcmVudDogRHosIGdyb3VwOiBFeiwgaWZCcmVhazogQ3osIGxpbmU6IGJ6LCBzb2Z0bGluZTogdnosIGhhcmRsaW5lOiBBeiB9LCB1dGlsczogeyByZXBsYWNlVGV4dEVuZE9mTGluZTogRnogfSB9ID0gWmMsIHsgbG9jU3RhcnQ6IHh6LCBsb2NFbmQ6IFN6IH0gPSB6cSwgeyBmb3JjZUJyZWFrQ2hpbGRyZW46IHd6LCBmb3JjZU5leHRFbXB0eUxpbmU6IFR6LCBpc1RleHRMaWtlTm9kZTogQnosIGhhc1ByZXR0aWVySWdub3JlOiBOeiwgcHJlZmVySGFyZGxpbmVBc0xlYWRpbmdTcGFjZXM6IGt6IH0gPSBmcSwgeyBwcmludE9wZW5pbmdUYWdQcmVmaXg6IFB6LCBuZWVkc1RvQm9ycm93TmV4dE9wZW5pbmdUYWdTdGFydE1hcmtlcjogT3osIHByaW50T3BlbmluZ1RhZ1N0YXJ0TWFya2VyOiBJeiwgbmVlZHNUb0JvcnJvd1ByZXZDbG9zaW5nVGFnRW5kTWFya2VyOiBMeiwgcHJpbnRDbG9zaW5nVGFnRW5kTWFya2VyOiBqeiwgcHJpbnRDbG9zaW5nVGFnU3VmZml4OiBfeiwgbmVlZHNUb0JvcnJvd1BhcmVudENsb3NpbmdUYWdTdGFydE1hcmtlcjogTXogfSA9IEZVOwogICAgICAgIGZ1bmN0aW9uIFJ6KGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIHJldHVybiBOeihyMikgPyBbUHoocjIsIHQyKSwgLi4uRnoodDIub3JpZ2luYWxUZXh0LnNsaWNlKHh6KHIyKSArIChyMi5wcmV2ICYmIE96KHIyLnByZXYpID8gSXoocjIpLmxlbmd0aCA6IDApLCBTeihyMikgLSAocjIubmV4dCAmJiBMeihyMi5uZXh0KSA/IGp6KHIyLCB0MikubGVuZ3RoIDogMCkpKSwgX3oocjIsIHQyKV0gOiBuMigpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBWeihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBCeihlMikgJiYgQnoodDIpID8gZTIuaXNUcmFpbGluZ1NwYWNlU2Vuc2l0aXZlID8gZTIuaGFzVHJhaWxpbmdTcGFjZXMgPyBreih0MikgPyBBeiA6IGJ6IDogIiIgOiBreih0MikgPyBBeiA6IHZ6IDogT3ooZTIpICYmIChOeih0MikgfHwgdDIuZmlyc3RDaGlsZCB8fCB0Mi5pc1NlbGZDbG9zaW5nIHx8IHQyLnR5cGUgPT09ICJlbGVtZW50IiAmJiB0Mi5hdHRycy5sZW5ndGggPiAwKSB8fCBlMi50eXBlID09PSAiZWxlbWVudCIgJiYgZTIuaXNTZWxmQ2xvc2luZyAmJiBMeih0MikgPyAiIiA6ICF0Mi5pc0xlYWRpbmdTcGFjZVNlbnNpdGl2ZSB8fCBreih0MikgfHwgTHoodDIpICYmIGUyLmxhc3RDaGlsZCAmJiBNeihlMi5sYXN0Q2hpbGQpICYmIGUyLmxhc3RDaGlsZC5sYXN0Q2hpbGQgJiYgTXooZTIubGFzdENoaWxkLmxhc3RDaGlsZCkgPyBBeiA6IHQyLmhhc0xlYWRpbmdTcGFjZXMgPyBieiA6IHZ6OwogICAgICAgIH0KICAgICAgICB2YXIgJHogPSB7IHByaW50Q2hpbGRyZW46IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKTsKICAgICAgICAgIGlmICh3eihyMikpCiAgICAgICAgICAgIHJldHVybiBbRHosIC4uLmUyLm1hcCgoZTMpID0+IHsKICAgICAgICAgICAgICBjb25zdCByMyA9IGUzLmdldFZhbHVlKCksIG8zID0gcjMucHJldiA/IFZ6KHIzLnByZXYsIHIzKSA6ICIiOwogICAgICAgICAgICAgIHJldHVybiBbbzMgPyBbbzMsIFR6KHIzLnByZXYpID8gQXogOiAiIl0gOiAiIiwgUnooZTMsIHQyLCBuMildOwogICAgICAgICAgICB9LCAiY2hpbGRyZW4iKV07CiAgICAgICAgICBjb25zdCBvMiA9IHIyLmNoaWxkcmVuLm1hcCgoKSA9PiBTeW1ib2woIiIpKTsKICAgICAgICAgIHJldHVybiBlMi5tYXAoKGUzLCByMykgPT4gewogICAgICAgICAgICBjb25zdCBpMiA9IGUzLmdldFZhbHVlKCk7CiAgICAgICAgICAgIGlmIChCeihpMikpIHsKICAgICAgICAgICAgICBpZiAoaTIucHJldiAmJiBCeihpMi5wcmV2KSkgewogICAgICAgICAgICAgICAgY29uc3QgcjQgPSBWeihpMi5wcmV2LCBpMik7CiAgICAgICAgICAgICAgICBpZiAocjQpCiAgICAgICAgICAgICAgICAgIHJldHVybiBUeihpMi5wcmV2KSA/IFtBeiwgQXosIFJ6KGUzLCB0MiwgbjIpXSA6IFtyNCwgUnooZTMsIHQyLCBuMildOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gUnooZTMsIHQyLCBuMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgdTIgPSBbXSwgczIgPSBbXSwgYTIgPSBbXSwgYzIgPSBbXSwgbDIgPSBpMi5wcmV2ID8gVnooaTIucHJldiwgaTIpIDogIiIsIHAyID0gaTIubmV4dCA/IFZ6KGkyLCBpMi5uZXh0KSA6ICIiOwogICAgICAgICAgICByZXR1cm4gbDIgJiYgKFR6KGkyLnByZXYpID8gdTIucHVzaChBeiwgQXopIDogbDIgPT09IEF6ID8gdTIucHVzaChBeikgOiBCeihpMi5wcmV2KSA/IHMyLnB1c2gobDIpIDogczIucHVzaChDeigiIiwgdnosIHsgZ3JvdXBJZDogbzJbcjMgLSAxXSB9KSkpLCBwMiAmJiAoVHooaTIpID8gQnooaTIubmV4dCkgJiYgYzIucHVzaChBeiwgQXopIDogcDIgPT09IEF6ID8gQnooaTIubmV4dCkgJiYgYzIucHVzaChBeikgOiBhMi5wdXNoKHAyKSksIFsuLi51MiwgRXooWy4uLnMyLCBFeihbUnooZTMsIHQyLCBuMiksIC4uLmEyXSwgeyBpZDogbzJbcjNdIH0pXSksIC4uLmMyXTsKICAgICAgICAgIH0sICJjaGlsZHJlbiIpOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IGJyZWFrUGFyZW50OiBXeiwgZGVkZW50VG9Sb290OiBxeiwgZ3JvdXA6IFV6LCBpZkJyZWFrOiB6eiwgaW5kZW50SWZCcmVhazogR3osIGluZGVudDogSHosIGxpbmU6IEp6LCBzb2Z0bGluZTogWHogfSwgdXRpbHM6IHsgcmVwbGFjZVRleHRFbmRPZkxpbmU6IFl6IH0gfSA9IFpjLCBLeiA9IFJVLCB7IHNob3VsZFByZXNlcnZlQ29udGVudDogUXosIGlzU2NyaXB0TGlrZVRhZzogWnosIGlzVnVlQ3VzdG9tQmxvY2s6IGVHLCBjb3VudFBhcmVudHM6IHRHLCBmb3JjZUJyZWFrQ29udGVudDogbkcgfSA9IGZxLCB7IHByaW50T3BlbmluZ1RhZ1ByZWZpeDogckcsIHByaW50T3BlbmluZ1RhZzogb0csIHByaW50Q2xvc2luZ1RhZ1N1ZmZpeDogaUcsIHByaW50Q2xvc2luZ1RhZzogdUcsIG5lZWRzVG9Cb3Jyb3dQcmV2Q2xvc2luZ1RhZ0VuZE1hcmtlcjogc0csIG5lZWRzVG9Cb3Jyb3dMYXN0Q2hpbGRDbG9zaW5nVGFnRW5kTWFya2VyOiBhRyB9ID0gRlUsIHsgcHJpbnRDaGlsZHJlbjogY0cgfSA9ICR6OwogICAgICAgIHZhciBsRyA9IHsgcHJpbnRFbGVtZW50OiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBpZiAoUXoocjIsIHQyKSkKICAgICAgICAgICAgcmV0dXJuIFtyRyhyMiwgdDIpLCBVeihvRyhlMiwgdDIsIG4yKSksIC4uLll6KEt6KHIyLCB0MikpLCAuLi51RyhyMiwgdDIpLCBpRyhyMiwgdDIpXTsKICAgICAgICAgIGNvbnN0IG8yID0gcjIuY2hpbGRyZW4ubGVuZ3RoID09PSAxICYmIHIyLmZpcnN0Q2hpbGQudHlwZSA9PT0gImludGVycG9sYXRpb24iICYmIHIyLmZpcnN0Q2hpbGQuaXNMZWFkaW5nU3BhY2VTZW5zaXRpdmUgJiYgIXIyLmZpcnN0Q2hpbGQuaGFzTGVhZGluZ1NwYWNlcyAmJiByMi5sYXN0Q2hpbGQuaXNUcmFpbGluZ1NwYWNlU2Vuc2l0aXZlICYmICFyMi5sYXN0Q2hpbGQuaGFzVHJhaWxpbmdTcGFjZXMsIGkyID0gU3ltYm9sKCJlbGVtZW50LWF0dHItZ3JvdXAtaWQiKSwgdTIgPSAobzMpID0+IFV6KFtVeihvRyhlMiwgdDIsIG4yKSwgeyBpZDogaTIgfSksIG8zLCB1RyhyMiwgdDIpXSk7CiAgICAgICAgICByZXR1cm4gcjIuY2hpbGRyZW4ubGVuZ3RoID09PSAwID8gdTIocjIuaGFzRGFuZ2xpbmdTcGFjZXMgJiYgcjIuaXNEYW5nbGluZ1NwYWNlU2Vuc2l0aXZlID8gSnogOiAiIikgOiB1MihbbkcocjIpID8gV3ogOiAiIiwgKHMyID0gW28yID8genooWHosICIiLCB7IGdyb3VwSWQ6IGkyIH0pIDogcjIuZmlyc3RDaGlsZC5oYXNMZWFkaW5nU3BhY2VzICYmIHIyLmZpcnN0Q2hpbGQuaXNMZWFkaW5nU3BhY2VTZW5zaXRpdmUgPyBKeiA6IHIyLmZpcnN0Q2hpbGQudHlwZSA9PT0gInRleHQiICYmIHIyLmlzV2hpdGVzcGFjZVNlbnNpdGl2ZSAmJiByMi5pc0luZGVudGF0aW9uU2Vuc2l0aXZlID8gcXooWHopIDogWHosIGNHKGUyLCB0MiwgbjIpXSwgbzIgPyBHeihzMiwgeyBncm91cElkOiBpMiB9KSA6ICFaeihyMikgJiYgIWVHKHIyLCB0MikgfHwgcjIucGFyZW50LnR5cGUgIT09ICJyb290IiB8fCB0Mi5wYXJzZXIgIT09ICJ2dWUiIHx8IHQyLnZ1ZUluZGVudFNjcmlwdEFuZFN0eWxlID8gSHooczIpIDogczIpLCAocjIubmV4dCA/IHNHKHIyLm5leHQpIDogYUcocjIucGFyZW50KSkgPyByMi5sYXN0Q2hpbGQuaGFzVHJhaWxpbmdTcGFjZXMgJiYgcjIubGFzdENoaWxkLmlzVHJhaWxpbmdTcGFjZVNlbnNpdGl2ZSA/ICIgIiA6ICIiIDogbzIgPyB6eihYeiwgIiIsIHsgZ3JvdXBJZDogaTIgfSkgOiByMi5sYXN0Q2hpbGQuaGFzVHJhaWxpbmdTcGFjZXMgJiYgcjIubGFzdENoaWxkLmlzVHJhaWxpbmdTcGFjZVNlbnNpdGl2ZSA/IEp6IDogKHIyLmxhc3RDaGlsZC50eXBlID09PSAiY29tbWVudCIgfHwgcjIubGFzdENoaWxkLnR5cGUgPT09ICJ0ZXh0IiAmJiByMi5pc1doaXRlc3BhY2VTZW5zaXRpdmUgJiYgcjIuaXNJbmRlbnRhdGlvblNlbnNpdGl2ZSkgJiYgbmV3IFJlZ0V4cCgiXFxuW1xcdCBdeyIuY29uY2F0KHQyLnRhYldpZHRoICogdEcoZTIsIChlMykgPT4gZTMucGFyZW50ICYmIGUzLnBhcmVudC50eXBlICE9PSAicm9vdCIpLCAifSQiKSkudGVzdChyMi5sYXN0Q2hpbGQudmFsdWUpID8gIiIgOiBYel0pOwogICAgICAgICAgdmFyIHMyOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IGZpbGw6IHBHLCBncm91cDogZkcsIGhhcmRsaW5lOiBkRywgbGl0ZXJhbGxpbmU6IGhHIH0sIHV0aWxzOiB7IGNsZWFuRG9jOiBnRywgZ2V0RG9jUGFydHM6IG1HLCBpc0NvbmNhdDogeUcsIHJlcGxhY2VUZXh0RW5kT2ZMaW5lOiBERyB9IH0gPSBaYywgRUcgPSB4VywgeyBjb3VudENoYXJzOiBDRywgdW5lc2NhcGVRdW90ZUVudGl0aWVzOiBiRywgZ2V0VGV4dFZhbHVlUGFydHM6IHZHIH0gPSBmcSwgQUcgPSBxcSwgeyBpbnNlcnRQcmFnbWE6IEZHIH0gPSBVcSwgeyBsb2NTdGFydDogeEcsIGxvY0VuZDogU0cgfSA9IHpxLCB3RyA9IHl6LCB7IHByaW50Q2xvc2luZ1RhZ1N1ZmZpeDogVEcsIHByaW50Q2xvc2luZ1RhZ0VuZDogQkcsIHByaW50T3BlbmluZ1RhZ1ByZWZpeDogTkcsIHByaW50T3BlbmluZ1RhZ1N0YXJ0OiBrRyB9ID0gRlUsIHsgcHJpbnRFbGVtZW50OiBQRyB9ID0gbEcsIHsgcHJpbnRDaGlsZHJlbjogT0cgfSA9ICR6OwogICAgICAgIHZhciBJRyA9IHsgcHJlcHJvY2VzczogQUcsIHByaW50OiBmdW5jdGlvbihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBzd2l0Y2ggKHIyLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAiZnJvbnQtbWF0dGVyIjoKICAgICAgICAgICAgICByZXR1cm4gREcocjIucmF3KTsKICAgICAgICAgICAgY2FzZSAicm9vdCI6CiAgICAgICAgICAgICAgcmV0dXJuIHQyLl9fb25IdG1sUm9vdCAmJiB0Mi5fX29uSHRtbFJvb3QocjIpLCBbZkcoT0coZTIsIHQyLCBuMikpLCBkR107CiAgICAgICAgICAgIGNhc2UgImVsZW1lbnQiOgogICAgICAgICAgICBjYXNlICJpZUNvbmRpdGlvbmFsQ29tbWVudCI6CiAgICAgICAgICAgICAgcmV0dXJuIFBHKGUyLCB0MiwgbjIpOwogICAgICAgICAgICBjYXNlICJpZUNvbmRpdGlvbmFsU3RhcnRDb21tZW50IjoKICAgICAgICAgICAgY2FzZSAiaWVDb25kaXRpb25hbEVuZENvbW1lbnQiOgogICAgICAgICAgICAgIHJldHVybiBba0cocjIpLCBCRyhyMildOwogICAgICAgICAgICBjYXNlICJpbnRlcnBvbGF0aW9uIjoKICAgICAgICAgICAgICByZXR1cm4gW2tHKHIyLCB0MiksIC4uLmUyLm1hcChuMiwgImNoaWxkcmVuIiksIEJHKHIyLCB0MildOwogICAgICAgICAgICBjYXNlICJ0ZXh0IjogewogICAgICAgICAgICAgIGlmIChyMi5wYXJlbnQudHlwZSA9PT0gImludGVycG9sYXRpb24iKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlNCA9IC9cblteXFNcbl0qPyQvLCB0MyA9IGU0LnRlc3QocjIudmFsdWUpLCBuMyA9IHQzID8gcjIudmFsdWUucmVwbGFjZShlNCwgIiIpIDogcjIudmFsdWU7CiAgICAgICAgICAgICAgICByZXR1cm4gWy4uLkRHKG4zKSwgdDMgPyBkRyA6ICIiXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZTMgPSBnRyhbTkcocjIsIHQyKSwgLi4udkcocjIpLCBURyhyMiwgdDIpXSk7CiAgICAgICAgICAgICAgcmV0dXJuIHlHKGUzKSB8fCBlMy50eXBlID09PSAiZmlsbCIgPyBwRyhtRyhlMykpIDogZTM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZG9jVHlwZSI6CiAgICAgICAgICAgICAgcmV0dXJuIFtmRyhba0cocjIsIHQyKSwgIiAiLCByMi52YWx1ZS5yZXBsYWNlKC9eaHRtbFxiL2ksICJodG1sIikucmVwbGFjZSgvXHMrL2csICIgIildKSwgQkcocjIsIHQyKV07CiAgICAgICAgICAgIGNhc2UgImNvbW1lbnQiOgogICAgICAgICAgICAgIHJldHVybiBbTkcocjIsIHQyKSwgLi4uREcodDIub3JpZ2luYWxUZXh0LnNsaWNlKHhHKHIyKSwgU0cocjIpKSwgaEcpLCBURyhyMiwgdDIpXTsKICAgICAgICAgICAgY2FzZSAiYXR0cmlidXRlIjogewogICAgICAgICAgICAgIGlmIChyMi52YWx1ZSA9PT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiByMi5yYXdOYW1lOwogICAgICAgICAgICAgIGNvbnN0IGUzID0gYkcocjIudmFsdWUpLCB0MyA9IENHKGUzLCAiJyIpIDwgQ0coZTMsICciJykgPyAiJyIgOiAnIic7CiAgICAgICAgICAgICAgcmV0dXJuIFtyMi5yYXdOYW1lLCAiPSIsIHQzLCAuLi5ERyh0MyA9PT0gJyInID8gZTMucmVwbGFjZSgvIi9nLCAiJnF1b3Q7IikgOiBlMy5yZXBsYWNlKC8nL2csICImYXBvczsiKSksIHQzXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBub2RlIHR5cGUgIi5jb25jYXQocjIudHlwZSkpOwogICAgICAgICAgfQogICAgICAgIH0sIGluc2VydFByYWdtYTogRkcsIG1hc3NhZ2VBc3ROb2RlOiBFRywgZW1iZWQ6IHdHIH07CiAgICAgICAgY29uc3QgTEcgPSAiSFRNTCI7CiAgICAgICAgdmFyIGpHID0geyBuYW1lOiAiSFRNTCIsIHR5cGU6ICJtYXJrdXAiLCB0bVNjb3BlOiAidGV4dC5odG1sLmJhc2ljIiwgYWNlTW9kZTogImh0bWwiLCBjb2RlbWlycm9yTW9kZTogImh0bWxtaXhlZCIsIGNvZGVtaXJyb3JNaW1lVHlwZTogInRleHQvaHRtbCIsIGNvbG9yOiAiI2UzNGMyNiIsIGFsaWFzZXM6IFsieGh0bWwiXSwgZXh0ZW5zaW9uczogWyIuaHRtbCIsICIuaHRtIiwgIi5odG1sLmhsIiwgIi5pbmMiLCAiLnhodCIsICIueGh0bWwiXSwgbGFuZ3VhZ2VJZDogMTQ2IH0sIF9HID0geyBuYW1lOiAiVnVlIiwgdHlwZTogIm1hcmt1cCIsIGNvbG9yOiAiIzQxYjg4MyIsIGV4dGVuc2lvbnM6IFsiLnZ1ZSJdLCB0bVNjb3BlOiAidGV4dC5odG1sLnZ1ZSIsIGFjZU1vZGU6ICJodG1sIiwgbGFuZ3VhZ2VJZDogMzkxIH07CiAgICAgICAgY29uc3QgTUcgPSBiRSwgUkcgPSBJRywgVkcgPSB7IGJyYWNrZXRTYW1lTGluZTogYmouYnJhY2tldFNhbWVMaW5lLCBodG1sV2hpdGVzcGFjZVNlbnNpdGl2aXR5OiB7IHNpbmNlOiAiMS4xNS4wIiwgY2F0ZWdvcnk6IExHLCB0eXBlOiAiY2hvaWNlIiwgZGVmYXVsdDogImNzcyIsIGRlc2NyaXB0aW9uOiAiSG93IHRvIGhhbmRsZSB3aGl0ZXNwYWNlcyBpbiBIVE1MLiIsIGNob2ljZXM6IFt7IHZhbHVlOiAiY3NzIiwgZGVzY3JpcHRpb246ICJSZXNwZWN0IHRoZSBkZWZhdWx0IHZhbHVlIG9mIENTUyBkaXNwbGF5IHByb3BlcnR5LiIgfSwgeyB2YWx1ZTogInN0cmljdCIsIGRlc2NyaXB0aW9uOiAiV2hpdGVzcGFjZXMgYXJlIGNvbnNpZGVyZWQgc2Vuc2l0aXZlLiIgfSwgeyB2YWx1ZTogImlnbm9yZSIsIGRlc2NyaXB0aW9uOiAiV2hpdGVzcGFjZXMgYXJlIGNvbnNpZGVyZWQgaW5zZW5zaXRpdmUuIiB9XSB9LCB2dWVJbmRlbnRTY3JpcHRBbmRTdHlsZTogeyBzaW5jZTogIjEuMTkuMCIsIGNhdGVnb3J5OiBMRywgdHlwZTogImJvb2xlYW4iLCBkZWZhdWx0OiBmYWxzZSwgZGVzY3JpcHRpb246ICJJbmRlbnQgc2NyaXB0IGFuZCBzdHlsZSB0YWdzIGluIFZ1ZSBmaWxlcy4iIH0gfSwgJEcgPSBbTUcoakcsICgpID0+ICh7IG5hbWU6ICJBbmd1bGFyIiwgc2luY2U6ICIxLjE1LjAiLCBwYXJzZXJzOiBbImFuZ3VsYXIiXSwgdnNjb2RlTGFuZ3VhZ2VJZHM6IFsiaHRtbCJdLCBleHRlbnNpb25zOiBbIi5jb21wb25lbnQuaHRtbCJdLCBmaWxlbmFtZXM6IFtdIH0pKSwgTUcoakcsIChlMikgPT4gKHsgc2luY2U6ICIxLjE1LjAiLCBwYXJzZXJzOiBbImh0bWwiXSwgdnNjb2RlTGFuZ3VhZ2VJZHM6IFsiaHRtbCJdLCBleHRlbnNpb25zOiBbLi4uZTIuZXh0ZW5zaW9ucywgIi5tam1sIl0gfSkpLCBNRyhqRywgKCkgPT4gKHsgbmFtZTogIkxpZ2h0bmluZyBXZWIgQ29tcG9uZW50cyIsIHNpbmNlOiAiMS4xNy4wIiwgcGFyc2VyczogWyJsd2MiXSwgdnNjb2RlTGFuZ3VhZ2VJZHM6IFsiaHRtbCJdLCBleHRlbnNpb25zOiBbXSwgZmlsZW5hbWVzOiBbXSB9KSksIE1HKF9HLCAoKSA9PiAoeyBzaW5jZTogIjEuMTAuMCIsIHBhcnNlcnM6IFsidnVlIl0sIHZzY29kZUxhbmd1YWdlSWRzOiBbInZ1ZSJdIH0pKV07CiAgICAgICAgdmFyIFdHID0geyBsYW5ndWFnZXM6ICRHLCBwcmludGVyczogeyBodG1sOiBSRyB9LCBvcHRpb25zOiBWRywgcGFyc2Vyczogdm9pZCAwIH07CiAgICAgICAgdmFyIHFHID0geyBpc1ByYWdtYTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiAvXlxzKkAoPzpwcmV0dGllcnxmb3JtYXQpXHMqJC8udGVzdChlMik7CiAgICAgICAgfSwgaGFzUHJhZ21hOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIC9eXHMqI1teXFNcbl0qQCg/OnByZXR0aWVyfGZvcm1hdClccyo/KD86XG58JCkvLnRlc3QoZTIpOwogICAgICAgIH0sIGluc2VydFByYWdtYTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiAiIyBAZm9ybWF0XG5cbiIuY29uY2F0KGUyKTsKICAgICAgICB9IH07CiAgICAgICAgdmFyIFVHID0geyBsb2NTdGFydDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5wb3NpdGlvbi5zdGFydC5vZmZzZXQ7CiAgICAgICAgfSwgbG9jRW5kOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnBvc2l0aW9uLmVuZC5vZmZzZXQ7CiAgICAgICAgfSB9OwogICAgICAgIHZhciB6RyA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIsIHIyKSB7CiAgICAgICAgICBpZiAoZTIuZ2V0VmFsdWUoKS50eXBlID09PSAicm9vdCIgJiYgcjIuZmlsZXBhdGggJiYgLyg/OlsvXFxdfF4pXC4oPzpwcmV0dGllcnxzdHlsZWxpbnQpcmMkLy50ZXN0KHIyLmZpbGVwYXRoKSkKICAgICAgICAgICAgcmV0dXJuIG4yKHIyLm9yaWdpbmFsVGV4dCwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCByMiksIHt9LCB7IHBhcnNlcjogImpzb24iIH0pKTsKICAgICAgICB9OwogICAgICAgIGNvbnN0IHsgZ2V0TGFzdDogR0csIGlzTm9uRW1wdHlBcnJheTogSEcgfSA9IGRjOwogICAgICAgIGZ1bmN0aW9uIEpHKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGUyICYmIHR5cGVvZiBlMi50eXBlID09ICJzdHJpbmciICYmICghdDIgfHwgdDIuaW5jbHVkZXMoZTIudHlwZSkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBYRyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLnZhbHVlLnRyaW0oKSA9PT0gInByZXR0aWVyLWlnbm9yZSI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFlHKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgSEcoZTIubGVhZGluZ0NvbW1lbnRzKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gS0coZTIpIHsKICAgICAgICAgIHJldHVybiBlMiAmJiBIRyhlMi5taWRkbGVDb21tZW50cyk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFFHKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgZTIuaW5kaWNhdG9yQ29tbWVudDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gWkcoZTIpIHsKICAgICAgICAgIHJldHVybiBlMiAmJiBlMi50cmFpbGluZ0NvbW1lbnQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGVIKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgSEcoZTIuZW5kQ29tbWVudHMpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0SChlMikgewogICAgICAgICAgY29uc3QgdDIgPSBbXTsKICAgICAgICAgIGxldCBuMjsKICAgICAgICAgIGZvciAoY29uc3QgcjIgb2YgZTIuc3BsaXQoLyggKykvKSkKICAgICAgICAgICAgcjIgIT09ICIgIiA/IG4yID09PSAiICIgPyB0Mi5wdXNoKHIyKSA6IHQyLnB1c2goKHQyLnBvcCgpIHx8ICIiKSArIHIyKSA6IG4yID09PSB2b2lkIDAgJiYgdDIudW5zaGlmdCgiIiksIG4yID0gcjI7CiAgICAgICAgICByZXR1cm4gbjIgPT09ICIgIiAmJiB0Mi5wdXNoKCh0Mi5wb3AoKSB8fCAiIikgKyAiICIpLCB0MlswXSA9PT0gIiIgJiYgKHQyLnNoaWZ0KCksIHQyLnVuc2hpZnQoIiAiICsgKHQyLnNoaWZ0KCkgfHwgIiIpKSksIHQyOwogICAgICAgIH0KICAgICAgICB2YXIgbkggPSB7IGdldExhc3Q6IEdHLCBnZXRBbmNlc3RvckNvdW50OiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGxldCBuMiA9IDA7CiAgICAgICAgICBjb25zdCByMiA9IGUyLnN0YWNrLmxlbmd0aCAtIDE7CiAgICAgICAgICBmb3IgKGxldCBvMiA9IDA7IG8yIDwgcjI7IG8yKyspIHsKICAgICAgICAgICAgY29uc3QgcjMgPSBlMi5zdGFja1tvMl07CiAgICAgICAgICAgIEpHKHIzKSAmJiB0MihyMykgJiYgbjIrKzsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICB9LCBpc05vZGU6IEpHLCBpc0VtcHR5Tm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiAhSEcoZTIuY2hpbGRyZW4pICYmICFmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gWUcoZTMpIHx8IEtHKGUzKSB8fCBRRyhlMykgfHwgWkcoZTMpIHx8IGVIKGUzKTsKICAgICAgICAgIH0oZTIpOwogICAgICAgIH0sIGlzSW5saW5lTm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGlmICghZTIpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgc3dpdGNoIChlMi50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInBsYWluIjoKICAgICAgICAgICAgY2FzZSAicXVvdGVEb3VibGUiOgogICAgICAgICAgICBjYXNlICJxdW90ZVNpbmdsZSI6CiAgICAgICAgICAgIGNhc2UgImFsaWFzIjoKICAgICAgICAgICAgY2FzZSAiZmxvd01hcHBpbmciOgogICAgICAgICAgICBjYXNlICJmbG93U2VxdWVuY2UiOgogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9LCBtYXBOb2RlOiBmdW5jdGlvbiBlMih0MiwgbjIsIHIyKSB7CiAgICAgICAgICByZXR1cm4gbjIoImNoaWxkcmVuIiBpbiB0MiA/IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdDIpLCB7fSwgeyBjaGlsZHJlbjogdDIuY2hpbGRyZW4ubWFwKChyMykgPT4gZTIocjMsIG4yLCB0MikpIH0pIDogdDIsIHIyKTsKICAgICAgICB9LCBkZWZpbmVTaG9ydGN1dDogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUyLCB0MiwgeyBnZXQ6IG4yLCBlbnVtZXJhYmxlOiBmYWxzZSB9KTsKICAgICAgICB9LCBpc05leHRMaW5lRW1wdHk6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgbGV0IG4yID0gMDsKICAgICAgICAgIGNvbnN0IHIyID0gdDIubGVuZ3RoOwogICAgICAgICAgZm9yIChsZXQgbzIgPSBlMi5wb3NpdGlvbi5lbmQub2Zmc2V0IC0gMTsgbzIgPCByMjsgbzIrKykgewogICAgICAgICAgICBjb25zdCBlMyA9IHQyW28yXTsKICAgICAgICAgICAgaWYgKGUzID09PSAiXG4iICYmIG4yKyssIG4yID09PSAxICYmIC9cUy8udGVzdChlMykpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAobjIgPT09IDIpCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSwgaXNMYXN0RGVzY2VuZGFudE5vZGU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBzd2l0Y2ggKGUyLmdldFZhbHVlKCkudHlwZSkgewogICAgICAgICAgICBjYXNlICJ0YWciOgogICAgICAgICAgICBjYXNlICJhbmNob3IiOgogICAgICAgICAgICBjYXNlICJjb21tZW50IjoKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCB0MiA9IGUyLnN0YWNrLmxlbmd0aDsKICAgICAgICAgIGZvciAobGV0IG4yID0gMTsgbjIgPCB0MjsgbjIrKykgewogICAgICAgICAgICBjb25zdCB0MyA9IGUyLnN0YWNrW24yXSwgcjIgPSBlMi5zdGFja1tuMiAtIDFdOwogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyMikgJiYgdHlwZW9mIHQzID09ICJudW1iZXIiICYmIHQzICE9PSByMi5sZW5ndGggLSAxKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0sIGdldEJsb2NrVmFsdWVMaW5lQ29udGVudHM6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgbGV0IHsgcGFyZW50SW5kZW50OiBuMiwgaXNMYXN0RGVzY2VuZGFudDogcjIsIG9wdGlvbnM6IG8yIH0gPSB0MjsKICAgICAgICAgIGNvbnN0IGkyID0gZTIucG9zaXRpb24uc3RhcnQubGluZSA9PT0gZTIucG9zaXRpb24uZW5kLmxpbmUgPyAiIiA6IG8yLm9yaWdpbmFsVGV4dC5zbGljZShlMi5wb3NpdGlvbi5zdGFydC5vZmZzZXQsIGUyLnBvc2l0aW9uLmVuZC5vZmZzZXQpLm1hdGNoKC9eW15cbl0qP1xuKC4qKSQvcylbMV0sIHUyID0gZTIuaW5kZW50ID09PSBudWxsID8gKChlMykgPT4gZTMgPyBlM1sxXS5sZW5ndGggOiBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpKGkyLm1hdGNoKC9eKCAqKVxTL20pKSA6IGUyLmluZGVudCAtIDEgKyBuMiwgczIgPSBpMi5zcGxpdCgiXG4iKS5tYXAoKGUzKSA9PiBlMy5zbGljZSh1MikpOwogICAgICAgICAgcmV0dXJuIG8yLnByb3NlV3JhcCA9PT0gInByZXNlcnZlIiB8fCBlMi50eXBlID09PSAiYmxvY2tMaXRlcmFsIiA/IGEyKHMyLm1hcCgoZTMpID0+IGUzLmxlbmd0aCA9PT0gMCA/IFtdIDogW2UzXSkpIDogYTIoczIubWFwKChlMykgPT4gZTMubGVuZ3RoID09PSAwID8gW10gOiB0SChlMykpLnJlZHVjZSgoZTMsIHQzLCBuMykgPT4gbjMgIT09IDAgJiYgczJbbjMgLSAxXS5sZW5ndGggPiAwICYmIHQzLmxlbmd0aCA+IDAgJiYgIS9eXHMvLnRlc3QodDNbMF0pICYmICEvXlxzfFxzJC8udGVzdChHRyhlMykpID8gWy4uLmUzLnNsaWNlKDAsIC0xKSwgWy4uLkdHKGUzKSwgLi4udDNdXSA6IFsuLi5lMywgdDNdLCBbXSkubWFwKChlMykgPT4gZTMucmVkdWNlKChlNCwgdDMpID0+IGU0Lmxlbmd0aCA+IDAgJiYgL1xzJC8udGVzdChHRyhlNCkpID8gWy4uLmU0LnNsaWNlKDAsIC0xKSwgR0coZTQpICsgIiAiICsgdDNdIDogWy4uLmU0LCB0M10sIFtdKSkubWFwKChlMykgPT4gbzIucHJvc2VXcmFwID09PSAibmV2ZXIiID8gW2UzLmpvaW4oIiAiKV0gOiBlMykpOwogICAgICAgICAgZnVuY3Rpb24gYTIodDMpIHsKICAgICAgICAgICAgaWYgKGUyLmNob21waW5nID09PSAia2VlcCIpCiAgICAgICAgICAgICAgcmV0dXJuIEdHKHQzKS5sZW5ndGggPT09IDAgPyB0My5zbGljZSgwLCAtMSkgOiB0MzsKICAgICAgICAgICAgbGV0IG4zID0gMDsKICAgICAgICAgICAgZm9yIChsZXQgZTMgPSB0My5sZW5ndGggLSAxOyBlMyA+PSAwICYmIHQzW2UzXS5sZW5ndGggPT09IDA7IGUzLS0pCiAgICAgICAgICAgICAgbjMrKzsKICAgICAgICAgICAgcmV0dXJuIG4zID09PSAwID8gdDMgOiBuMyA+PSAyICYmICFyMiA/IHQzLnNsaWNlKDAsIC0objMgLSAxKSkgOiB0My5zbGljZSgwLCAtbjMpOwogICAgICAgICAgfQogICAgICAgIH0sIGdldEZsb3dTY2FsYXJMaW5lQ29udGVudHM6IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gdDIuc3BsaXQoIlxuIikubWFwKChlMywgdDMsIG4zKSA9PiB0MyA9PT0gMCAmJiB0MyA9PT0gbjMubGVuZ3RoIC0gMSA/IGUzIDogdDMgIT09IDAgJiYgdDMgIT09IG4zLmxlbmd0aCAtIDEgPyBlMy50cmltKCkgOiB0MyA9PT0gMCA/IGUzLnRyaW1FbmQoKSA6IGUzLnRyaW1TdGFydCgpKTsKICAgICAgICAgIHJldHVybiBuMi5wcm9zZVdyYXAgPT09ICJwcmVzZXJ2ZSIgPyByMi5tYXAoKGUzKSA9PiBlMy5sZW5ndGggPT09IDAgPyBbXSA6IFtlM10pIDogcjIubWFwKChlMykgPT4gZTMubGVuZ3RoID09PSAwID8gW10gOiB0SChlMykpLnJlZHVjZSgodDMsIG4zLCBvMikgPT4gbzIgIT09IDAgJiYgcjJbbzIgLSAxXS5sZW5ndGggPiAwICYmIG4zLmxlbmd0aCA+IDAgJiYgKGUyICE9PSAicXVvdGVEb3VibGUiIHx8ICFHRyhHRyh0MykpLmVuZHNXaXRoKCJcXCIpKSA/IFsuLi50My5zbGljZSgwLCAtMSksIFsuLi5HRyh0MyksIC4uLm4zXV0gOiBbLi4udDMsIG4zXSwgW10pLm1hcCgoZTMpID0+IG4yLnByb3NlV3JhcCA9PT0gIm5ldmVyIiA/IFtlMy5qb2luKCIgIildIDogZTMpOwogICAgICAgIH0sIGdldExhc3REZXNjZW5kYW50Tm9kZTogZnVuY3Rpb24gZTIodDIpIHsKICAgICAgICAgIHJldHVybiBIRyh0Mi5jaGlsZHJlbikgPyBlMihHRyh0Mi5jaGlsZHJlbikpIDogdDI7CiAgICAgICAgfSwgaGFzUHJldHRpZXJJZ25vcmU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyLmdldFZhbHVlKCk7CiAgICAgICAgICBpZiAodDIudHlwZSA9PT0gImRvY3VtZW50Qm9keSIpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBlMi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiBlSCh0My5oZWFkKSAmJiBYRyhHRyh0My5oZWFkLmVuZENvbW1lbnRzKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gWUcodDIpICYmIFhHKEdHKHQyLmxlYWRpbmdDb21tZW50cykpOwogICAgICAgIH0sIGhhc0xlYWRpbmdDb21tZW50czogWUcsIGhhc01pZGRsZUNvbW1lbnRzOiBLRywgaGFzSW5kaWNhdG9yQ29tbWVudDogUUcsIGhhc1RyYWlsaW5nQ29tbWVudDogWkcsIGhhc0VuZENvbW1lbnRzOiBlSCB9OwogICAgICAgIGNvbnN0IHsgZGVmaW5lU2hvcnRjdXQ6IHJILCBtYXBOb2RlOiBvSCB9ID0gbkg7CiAgICAgICAgZnVuY3Rpb24gaUgoZTIpIHsKICAgICAgICAgIHN3aXRjaCAoZTIudHlwZSkgewogICAgICAgICAgICBjYXNlICJkb2N1bWVudCI6CiAgICAgICAgICAgICAgckgoZTIsICJoZWFkIiwgKCkgPT4gZTIuY2hpbGRyZW5bMF0pLCBySChlMiwgImJvZHkiLCAoKSA9PiBlMi5jaGlsZHJlblsxXSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImRvY3VtZW50Qm9keSI6CiAgICAgICAgICAgIGNhc2UgInNlcXVlbmNlSXRlbSI6CiAgICAgICAgICAgIGNhc2UgImZsb3dTZXF1ZW5jZUl0ZW0iOgogICAgICAgICAgICBjYXNlICJtYXBwaW5nS2V5IjoKICAgICAgICAgICAgY2FzZSAibWFwcGluZ1ZhbHVlIjoKICAgICAgICAgICAgICBySChlMiwgImNvbnRlbnQiLCAoKSA9PiBlMi5jaGlsZHJlblswXSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIm1hcHBpbmdJdGVtIjoKICAgICAgICAgICAgY2FzZSAiZmxvd01hcHBpbmdJdGVtIjoKICAgICAgICAgICAgICBySChlMiwgImtleSIsICgpID0+IGUyLmNoaWxkcmVuWzBdKSwgckgoZTIsICJ2YWx1ZSIsICgpID0+IGUyLmNoaWxkcmVuWzFdKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICB9CiAgICAgICAgdmFyIHVIID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBvSChlMiwgaUgpOwogICAgICAgIH07CiAgICAgICAgY29uc3QgeyBidWlsZGVyczogeyBzb2Z0bGluZTogc0gsIGFsaWduOiBhSCB9IH0gPSBaYywgeyBoYXNFbmRDb21tZW50czogY0gsIGlzTmV4dExpbmVFbXB0eTogbEgsIGlzTm9kZTogcEggfSA9IG5ILCBmSCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgV2Vha01hcCgpOwogICAgICAgIGZ1bmN0aW9uIGRIKGUyKSB7CiAgICAgICAgICByZXR1cm4gY0goZTIpICYmICFwSChlMiwgWyJkb2N1bWVudEhlYWQiLCAiZG9jdW1lbnRCb2R5IiwgImZsb3dNYXBwaW5nIiwgImZsb3dTZXF1ZW5jZSJdKTsKICAgICAgICB9CiAgICAgICAgdmFyIGhIID0geyBhbGlnbldpdGhTcGFjZXM6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGFIKCIgIi5yZXBlYXQoZTIpLCB0Mik7CiAgICAgICAgfSwgc2hvdWxkUHJpbnRFbmRDb21tZW50czogZEgsIHByaW50TmV4dEVtcHR5TGluZTogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IGUyLmdldFZhbHVlKCksIHIyID0gZTIuc3RhY2tbMF07CiAgICAgICAgICBsZXQgbzI7CiAgICAgICAgICByZXR1cm4gZkguaGFzKHIyKSA/IG8yID0gZkguZ2V0KHIyKSA6IChvMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCksIGZILnNldChyMiwgbzIpKSwgbzIuaGFzKG4yLnBvc2l0aW9uLmVuZC5saW5lKSB8fCAobzIuYWRkKG4yLnBvc2l0aW9uLmVuZC5saW5lKSwgIWxIKG4yLCB0MikgfHwgZEgoZTIuZ2V0UGFyZW50Tm9kZSgpKSkgPyAiIiA6IHNIOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IGlmQnJlYWs6IGdILCBsaW5lOiBtSCwgc29mdGxpbmU6IHlILCBoYXJkbGluZTogREgsIGpvaW46IEVIIH0gfSA9IFpjLCB7IGlzRW1wdHlOb2RlOiBDSCwgZ2V0TGFzdDogYkgsIGhhc0VuZENvbW1lbnRzOiB2SCB9ID0gbkgsIHsgcHJpbnROZXh0RW1wdHlMaW5lOiBBSCwgYWxpZ25XaXRoU3BhY2VzOiBGSCB9ID0gaEg7CiAgICAgICAgZnVuY3Rpb24geEgoZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLCBvMiA9IHIyLnR5cGUgPT09ICJmbG93TWFwcGluZyIsIGkyID0gbzIgPyAieyIgOiAiWyIsIHUyID0gbzIgPyAifSIgOiAiXSI7CiAgICAgICAgICBsZXQgczIgPSB5SDsKICAgICAgICAgIG8yICYmIHIyLmNoaWxkcmVuLmxlbmd0aCA+IDAgJiYgbjIuYnJhY2tldFNwYWNpbmcgJiYgKHMyID0gbUgpOwogICAgICAgICAgY29uc3QgYTIgPSBiSChyMi5jaGlsZHJlbiksIGMyID0gYTIgJiYgYTIudHlwZSA9PT0gImZsb3dNYXBwaW5nSXRlbSIgJiYgQ0goYTIua2V5KSAmJiBDSChhMi52YWx1ZSk7CiAgICAgICAgICByZXR1cm4gW2kyLCBGSChuMi50YWJXaWR0aCwgW3MyLCBTSChlMiwgdDIsIG4yKSwgbjIudHJhaWxpbmdDb21tYSA9PT0gIm5vbmUiID8gIiIgOiBnSCgiLCIpLCB2SChyMikgPyBbREgsIEVIKERILCBlMi5tYXAodDIsICJlbmRDb21tZW50cyIpKV0gOiAiIl0pLCBjMiA/ICIiIDogczIsIHUyXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gU0goZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpOwogICAgICAgICAgcmV0dXJuIGUyLm1hcCgoZTMsIG8yKSA9PiBbdDIoKSwgbzIgPT09IHIyLmNoaWxkcmVuLmxlbmd0aCAtIDEgPyAiIiA6IFsiLCIsIG1ILCByMi5jaGlsZHJlbltvMl0ucG9zaXRpb24uc3RhcnQubGluZSAhPT0gcjIuY2hpbGRyZW5bbzIgKyAxXS5wb3NpdGlvbi5zdGFydC5saW5lID8gQUgoZTMsIG4yLm9yaWdpbmFsVGV4dCkgOiAiIl1dLCAiY2hpbGRyZW4iKTsKICAgICAgICB9CiAgICAgICAgdmFyIHdIID0geyBwcmludEZsb3dNYXBwaW5nOiB4SCwgcHJpbnRGbG93U2VxdWVuY2U6IHhIIH07CiAgICAgICAgY29uc3QgeyBidWlsZGVyczogeyBjb25kaXRpb25hbEdyb3VwOiBUSCwgZ3JvdXA6IEJILCBoYXJkbGluZTogTkgsIGlmQnJlYWs6IGtILCBqb2luOiBQSCwgbGluZTogT0ggfSB9ID0gWmMsIHsgaGFzTGVhZGluZ0NvbW1lbnRzOiBJSCwgaGFzTWlkZGxlQ29tbWVudHM6IExILCBoYXNUcmFpbGluZ0NvbW1lbnQ6IGpILCBoYXNFbmRDb21tZW50czogX0gsIGlzTm9kZTogTUgsIGlzRW1wdHlOb2RlOiBSSCwgaXNJbmxpbmVOb2RlOiBWSCB9ID0gbkgsIHsgYWxpZ25XaXRoU3BhY2VzOiAkSCB9ID0gaEg7CiAgICAgICAgZnVuY3Rpb24gV0goZTIsIHQyKSB7CiAgICAgICAgICBpZiAoIWUyKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIHN3aXRjaCAoZTIudHlwZSkgewogICAgICAgICAgICBjYXNlICJwbGFpbiI6CiAgICAgICAgICAgIGNhc2UgInF1b3RlU2luZ2xlIjoKICAgICAgICAgICAgY2FzZSAicXVvdGVEb3VibGUiOgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJhbGlhcyI6CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHQyLnByb3NlV3JhcCA9PT0gInByZXNlcnZlIikKICAgICAgICAgICAgcmV0dXJuIGUyLnBvc2l0aW9uLnN0YXJ0LmxpbmUgPT09IGUyLnBvc2l0aW9uLmVuZC5saW5lOwogICAgICAgICAgaWYgKC9cXCQvbS50ZXN0KHQyLm9yaWdpbmFsVGV4dC5zbGljZShlMi5wb3NpdGlvbi5zdGFydC5vZmZzZXQsIGUyLnBvc2l0aW9uLmVuZC5vZmZzZXQpKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgc3dpdGNoICh0Mi5wcm9zZVdyYXApIHsKICAgICAgICAgICAgY2FzZSAibmV2ZXIiOgogICAgICAgICAgICAgIHJldHVybiAhZTIudmFsdWUuaW5jbHVkZXMoIlxuIik7CiAgICAgICAgICAgIGNhc2UgImFsd2F5cyI6CiAgICAgICAgICAgICAgcmV0dXJuICEvW1xuIF0vLnRlc3QoZTIudmFsdWUpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIHFIID0gZnVuY3Rpb24oZTIsIHQyLCBuMiwgcjIsIG8yKSB7CiAgICAgICAgICBjb25zdCB7IGtleTogaTIsIHZhbHVlOiB1MiB9ID0gZTIsIHMyID0gUkgoaTIpLCBhMiA9IFJIKHUyKTsKICAgICAgICAgIGlmIChzMiAmJiBhMikKICAgICAgICAgICAgcmV0dXJuICI6ICI7CiAgICAgICAgICBjb25zdCBjMiA9IHIyKCJrZXkiKSwgbDIgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gZTMua2V5LmNvbnRlbnQgJiYgZTMua2V5LmNvbnRlbnQudHlwZSA9PT0gImFsaWFzIjsKICAgICAgICAgIH0oZTIpID8gIiAiIDogIiI7CiAgICAgICAgICBpZiAoYTIpCiAgICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAiZmxvd01hcHBpbmdJdGVtIiAmJiB0Mi50eXBlID09PSAiZmxvd01hcHBpbmciID8gYzIgOiBlMi50eXBlICE9PSAibWFwcGluZ0l0ZW0iIHx8ICFXSChpMi5jb250ZW50LCBvMikgfHwgakgoaTIuY29udGVudCkgfHwgdDIudGFnICYmIHQyLnRhZy52YWx1ZSA9PT0gInRhZzp5YW1sLm9yZywyMDAyOnNldCIgPyBbIj8gIiwgJEgoMiwgYzIpXSA6IFtjMiwgbDIsICI6Il07CiAgICAgICAgICBjb25zdCBwMiA9IHIyKCJ2YWx1ZSIpOwogICAgICAgICAgaWYgKHMyKQogICAgICAgICAgICByZXR1cm4gWyI6ICIsICRIKDIsIHAyKV07CiAgICAgICAgICBpZiAoSUgodTIpIHx8ICFWSChpMi5jb250ZW50KSkKICAgICAgICAgICAgcmV0dXJuIFsiPyAiLCAkSCgyLCBjMiksIE5ILCBQSCgiIiwgbjIubWFwKHIyLCAidmFsdWUiLCAibGVhZGluZ0NvbW1lbnRzIikubWFwKChlMykgPT4gW2UzLCBOSF0pKSwgIjogIiwgJEgoMiwgcDIpXTsKICAgICAgICAgIGlmIChmdW5jdGlvbihlMykgewogICAgICAgICAgICBpZiAoIWUzKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBzd2l0Y2ggKGUzLnR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICJwbGFpbiI6CiAgICAgICAgICAgICAgY2FzZSAicXVvdGVEb3VibGUiOgogICAgICAgICAgICAgIGNhc2UgInF1b3RlU2luZ2xlIjoKICAgICAgICAgICAgICAgIHJldHVybiBlMy5wb3NpdGlvbi5zdGFydC5saW5lID09PSBlMy5wb3NpdGlvbi5lbmQubGluZTsKICAgICAgICAgICAgICBjYXNlICJhbGlhcyI6CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KGkyLmNvbnRlbnQpICYmICFJSChpMi5jb250ZW50KSAmJiAhTEgoaTIuY29udGVudCkgJiYgIWpIKGkyLmNvbnRlbnQpICYmICFfSChpMikgJiYgIUlIKHUyLmNvbnRlbnQpICYmICFMSCh1Mi5jb250ZW50KSAmJiAhX0godTIpICYmIFdIKHUyLmNvbnRlbnQsIG8yKSkKICAgICAgICAgICAgcmV0dXJuIFtjMiwgbDIsICI6ICIsIHAyXTsKICAgICAgICAgIGNvbnN0IGYyID0gU3ltYm9sKCJtYXBwaW5nS2V5IiksIGQyID0gQkgoW2tIKCI/ICIpLCBCSCgkSCgyLCBjMiksIHsgaWQ6IGYyIH0pXSksIGgyID0gW05ILCAiOiAiLCAkSCgyLCBwMildLCBnMiA9IFtsMiwgIjoiXTsKICAgICAgICAgIElIKHUyLmNvbnRlbnQpIHx8IF9IKHUyKSAmJiB1Mi5jb250ZW50ICYmICFNSCh1Mi5jb250ZW50LCBbIm1hcHBpbmciLCAic2VxdWVuY2UiXSkgfHwgdDIudHlwZSA9PT0gIm1hcHBpbmciICYmIGpIKGkyLmNvbnRlbnQpICYmIFZIKHUyLmNvbnRlbnQpIHx8IE1IKHUyLmNvbnRlbnQsIFsibWFwcGluZyIsICJzZXF1ZW5jZSJdKSAmJiB1Mi5jb250ZW50LnRhZyA9PT0gbnVsbCAmJiB1Mi5jb250ZW50LmFuY2hvciA9PT0gbnVsbCA/IGcyLnB1c2goTkgpIDogdTIuY29udGVudCAmJiBnMi5wdXNoKE9IKSwgZzIucHVzaChwMik7CiAgICAgICAgICBjb25zdCBtMiA9ICRIKG8yLnRhYldpZHRoLCBnMik7CiAgICAgICAgICByZXR1cm4gIVdIKGkyLmNvbnRlbnQsIG8yKSB8fCBJSChpMi5jb250ZW50KSB8fCBMSChpMi5jb250ZW50KSB8fCBfSChpMikgPyBUSChbW2QyLCBrSChoMiwgbTIsIHsgZ3JvdXBJZDogZjIgfSldXSkgOiBUSChbW2MyLCBtMl1dKTsKICAgICAgICB9OwogICAgICAgIGNvbnN0IHsgYnVpbGRlcnM6IHsgZGVkZW50OiBVSCwgZGVkZW50VG9Sb290OiB6SCwgZmlsbDogR0gsIGhhcmRsaW5lOiBISCwgam9pbjogSkgsIGxpbmU6IFhILCBsaXRlcmFsbGluZTogWUgsIG1hcmtBc1Jvb3Q6IEtIIH0sIHV0aWxzOiB7IGdldERvY1BhcnRzOiBRSCB9IH0gPSBaYywgeyBnZXRBbmNlc3RvckNvdW50OiBaSCwgZ2V0QmxvY2tWYWx1ZUxpbmVDb250ZW50czogZUosIGhhc0luZGljYXRvckNvbW1lbnQ6IHRKLCBpc0xhc3REZXNjZW5kYW50Tm9kZTogbkosIGlzTm9kZTogckogfSA9IG5ILCB7IGFsaWduV2l0aFNwYWNlczogb0ogfSA9IGhIOwogICAgICAgIHZhciBpSiA9IGZ1bmN0aW9uKGUyLCB0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuZ2V0VmFsdWUoKSwgbzIgPSBaSChlMiwgKGUzKSA9PiBySihlMywgWyJzZXF1ZW5jZSIsICJtYXBwaW5nIl0pKSwgaTIgPSBuSihlMiksIHUyID0gW3IyLnR5cGUgPT09ICJibG9ja0ZvbGRlZCIgPyAiPiIgOiAifCJdOwogICAgICAgICAgcjIuaW5kZW50ICE9PSBudWxsICYmIHUyLnB1c2gocjIuaW5kZW50LnRvU3RyaW5nKCkpLCByMi5jaG9tcGluZyAhPT0gImNsaXAiICYmIHUyLnB1c2gocjIuY2hvbXBpbmcgPT09ICJrZWVwIiA/ICIrIiA6ICItIiksIHRKKHIyKSAmJiB1Mi5wdXNoKCIgIiwgdDIoImluZGljYXRvckNvbW1lbnQiKSk7CiAgICAgICAgICBjb25zdCBzMiA9IGVKKHIyLCB7IHBhcmVudEluZGVudDogbzIsIGlzTGFzdERlc2NlbmRhbnQ6IGkyLCBvcHRpb25zOiBuMiB9KSwgYTIgPSBbXTsKICAgICAgICAgIGZvciAoY29uc3QgW2UzLCB0M10gb2YgczIuZW50cmllcygpKQogICAgICAgICAgICBlMyA9PT0gMCAmJiBhMi5wdXNoKEhIKSwgYTIucHVzaChHSChRSChKSChYSCwgdDMpKSkpLCBlMyAhPT0gczIubGVuZ3RoIC0gMSA/IGEyLnB1c2godDMubGVuZ3RoID09PSAwID8gSEggOiBLSChZSCkpIDogcjIuY2hvbXBpbmcgPT09ICJrZWVwIiAmJiBpMiAmJiBhMi5wdXNoKHpIKHQzLmxlbmd0aCA9PT0gMCA/IEhIIDogWUgpKTsKICAgICAgICAgIHJldHVybiByMi5pbmRlbnQgPT09IG51bGwgPyB1Mi5wdXNoKFVIKG9KKG4yLnRhYldpZHRoLCBhMikpKSA6IHUyLnB1c2goekgob0oocjIuaW5kZW50IC0gMSArIG8yLCBhMikpKSwgdTI7CiAgICAgICAgfTsKICAgICAgICBjb25zdCB7IGJ1aWxkZXJzOiB7IGJyZWFrUGFyZW50OiB1SiwgZmlsbDogc0osIGdyb3VwOiBhSiwgaGFyZGxpbmU6IGNKLCBqb2luOiBsSiwgbGluZTogcEosIGxpbmVTdWZmaXg6IGZKLCBsaXRlcmFsbGluZTogZEogfSwgdXRpbHM6IHsgZ2V0RG9jUGFydHM6IGhKLCByZXBsYWNlVGV4dEVuZE9mTGluZTogZ0ogfSB9ID0gWmMsIHsgaXNQcmV2aW91c0xpbmVFbXB0eTogbUogfSA9IGRjLCB7IGluc2VydFByYWdtYTogeUosIGlzUHJhZ21hOiBESiB9ID0gcUcsIHsgbG9jU3RhcnQ6IEVKIH0gPSBVRywgQ0ogPSB6RywgeyBnZXRGbG93U2NhbGFyTGluZUNvbnRlbnRzOiBiSiwgZ2V0TGFzdERlc2NlbmRhbnROb2RlOiB2SiwgaGFzTGVhZGluZ0NvbW1lbnRzOiBBSiwgaGFzTWlkZGxlQ29tbWVudHM6IEZKLCBoYXNUcmFpbGluZ0NvbW1lbnQ6IHhKLCBoYXNFbmRDb21tZW50czogU0osIGhhc1ByZXR0aWVySWdub3JlOiB3SiwgaXNMYXN0RGVzY2VuZGFudE5vZGU6IFRKLCBpc05vZGU6IEJKLCBpc0lubGluZU5vZGU6IE5KIH0gPSBuSCwga0ogPSB1SCwgeyBhbGlnbldpdGhTcGFjZXM6IFBKLCBwcmludE5leHRFbXB0eUxpbmU6IE9KLCBzaG91bGRQcmludEVuZENvbW1lbnRzOiBJSiB9ID0gaEgsIHsgcHJpbnRGbG93TWFwcGluZzogTEosIHByaW50Rmxvd1NlcXVlbmNlOiBqSiB9ID0gd0gsIF9KID0gcUgsIE1KID0gaUo7CiAgICAgICAgZnVuY3Rpb24gUkooZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4geEooZTIpIHx8IHQyICYmICh0Mi5oZWFkLmNoaWxkcmVuLmxlbmd0aCA+IDAgfHwgU0oodDIuaGVhZCkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBWSihlMiwgdDIsIG4yKSB7CiAgICAgICAgICBjb25zdCByMiA9IGJKKGUyLCB0MiwgbjIpOwogICAgICAgICAgcmV0dXJuIGxKKGNKLCByMi5tYXAoKGUzKSA9PiBzSihoSihsSihwSiwgZTMpKSkpKTsKICAgICAgICB9CiAgICAgICAgdmFyICRKID0geyBwcmVwcm9jZXNzOiBrSiwgZW1iZWQ6IENKLCBwcmludDogZnVuY3Rpb24oZTIsIHQyLCBuMikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRWYWx1ZSgpLCBvMiA9IFtdOwogICAgICAgICAgcjIudHlwZSAhPT0gIm1hcHBpbmdWYWx1ZSIgJiYgQUoocjIpICYmIG8yLnB1c2goW2xKKGNKLCBlMi5tYXAobjIsICJsZWFkaW5nQ29tbWVudHMiKSksIGNKXSk7CiAgICAgICAgICBjb25zdCB7IHRhZzogaTIsIGFuY2hvcjogdTIgfSA9IHIyOwogICAgICAgICAgaTIgJiYgbzIucHVzaChuMigidGFnIikpLCBpMiAmJiB1MiAmJiBvMi5wdXNoKCIgIiksIHUyICYmIG8yLnB1c2gobjIoImFuY2hvciIpKTsKICAgICAgICAgIGxldCBzMiA9ICIiOwogICAgICAgICAgQkoocjIsIFsibWFwcGluZyIsICJzZXF1ZW5jZSIsICJjb21tZW50IiwgImRpcmVjdGl2ZSIsICJtYXBwaW5nSXRlbSIsICJzZXF1ZW5jZUl0ZW0iXSkgJiYgIVRKKGUyKSAmJiAoczIgPSBPSihlMiwgdDIub3JpZ2luYWxUZXh0KSksIChpMiB8fCB1MikgJiYgKEJKKHIyLCBbInNlcXVlbmNlIiwgIm1hcHBpbmciXSkgJiYgIUZKKHIyKSA/IG8yLnB1c2goY0opIDogbzIucHVzaCgiICIpKSwgRkoocjIpICYmIG8yLnB1c2goW3IyLm1pZGRsZUNvbW1lbnRzLmxlbmd0aCA9PT0gMSA/ICIiIDogY0osIGxKKGNKLCBlMi5tYXAobjIsICJtaWRkbGVDb21tZW50cyIpKSwgY0pdKTsKICAgICAgICAgIGNvbnN0IGEyID0gZTIuZ2V0UGFyZW50Tm9kZSgpOwogICAgICAgICAgcmV0dXJuIHdKKGUyKSA/IG8yLnB1c2goZ0oodDIub3JpZ2luYWxUZXh0LnNsaWNlKHIyLnBvc2l0aW9uLnN0YXJ0Lm9mZnNldCwgcjIucG9zaXRpb24uZW5kLm9mZnNldCkudHJpbUVuZCgpLCBkSikpIDogbzIucHVzaChhSihmdW5jdGlvbihlMywgdDMsIG4zLCByMywgbzMpIHsKICAgICAgICAgICAgc3dpdGNoIChlMy50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAicm9vdCI6IHsKICAgICAgICAgICAgICAgIGNvbnN0IHsgY2hpbGRyZW46IHQ0IH0gPSBlMywgcjQgPSBbXTsKICAgICAgICAgICAgICAgIG4zLmVhY2goKGU0LCBuNCkgPT4gewogICAgICAgICAgICAgICAgICBjb25zdCBpNCA9IHQ0W240XSwgdTMgPSB0NFtuNCArIDFdOwogICAgICAgICAgICAgICAgICBuNCAhPT0gMCAmJiByNC5wdXNoKGNKKSwgcjQucHVzaChvMygpKSwgUkooaTQsIHUzKSA/IChyNC5wdXNoKGNKLCAiLi4uIiksIHhKKGk0KSAmJiByNC5wdXNoKCIgIiwgbzMoInRyYWlsaW5nQ29tbWVudCIpKSkgOiB1MyAmJiAheEoodTMuaGVhZCkgJiYgcjQucHVzaChjSiwgIi0tLSIpOwogICAgICAgICAgICAgICAgfSwgImNoaWxkcmVuIik7CiAgICAgICAgICAgICAgICBjb25zdCBpMyA9IHZKKGUzKTsKICAgICAgICAgICAgICAgIHJldHVybiBCSihpMywgWyJibG9ja0xpdGVyYWwiLCAiYmxvY2tGb2xkZWQiXSkgJiYgaTMuY2hvbXBpbmcgPT09ICJrZWVwIiB8fCByNC5wdXNoKGNKKSwgcjQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgImRvY3VtZW50IjogewogICAgICAgICAgICAgICAgY29uc3QgaTMgPSBbXTsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlNCwgdDQsIG40LCByNCkgewogICAgICAgICAgICAgICAgICBpZiAobjQuY2hpbGRyZW5bMF0gPT09IGU0ICYmIC8tLS0oPzpcc3wkKS8udGVzdChyNC5vcmlnaW5hbFRleHQuc2xpY2UoRUooZTQpLCBFSihlNCkgKyA0KSkgfHwgZTQuaGVhZC5jaGlsZHJlbi5sZW5ndGggPiAwIHx8IFNKKGU0LmhlYWQpIHx8IHhKKGU0LmhlYWQpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAiaGVhZCI7CiAgICAgICAgICAgICAgICAgIGlmIChSSihlNCwgdDQpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgcmV0dXJuICEhdDQgJiYgInJvb3QiOwogICAgICAgICAgICAgICAgfShlMywgdDMuY2hpbGRyZW5bbjMuZ2V0TmFtZSgpICsgMV0sIHQzLCByMykgPT09ICJoZWFkIiAmJiAoKGUzLmhlYWQuY2hpbGRyZW4ubGVuZ3RoID4gMCB8fCBlMy5oZWFkLmVuZENvbW1lbnRzLmxlbmd0aCA+IDApICYmIGkzLnB1c2gobzMoImhlYWQiKSksIHhKKGUzLmhlYWQpID8gaTMucHVzaChbIi0tLSIsICIgIiwgbzMoWyJoZWFkIiwgInRyYWlsaW5nQ29tbWVudCJdKV0pIDogaTMucHVzaCgiLS0tIikpLCBmdW5jdGlvbihlNCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZTQuYm9keS5jaGlsZHJlbi5sZW5ndGggPiAwIHx8IFNKKGU0LmJvZHkpOwogICAgICAgICAgICAgICAgfShlMykgJiYgaTMucHVzaChvMygiYm9keSIpKSwgbEooY0osIGkzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY2FzZSAiZG9jdW1lbnRIZWFkIjoKICAgICAgICAgICAgICAgIHJldHVybiBsSihjSiwgWy4uLm4zLm1hcChvMywgImNoaWxkcmVuIiksIC4uLm4zLm1hcChvMywgImVuZENvbW1lbnRzIildKTsKICAgICAgICAgICAgICBjYXNlICJkb2N1bWVudEJvZHkiOiB7CiAgICAgICAgICAgICAgICBjb25zdCB7IGNoaWxkcmVuOiB0NCwgZW5kQ29tbWVudHM6IHI0IH0gPSBlMzsKICAgICAgICAgICAgICAgIGxldCBpMyA9ICIiOwogICAgICAgICAgICAgICAgaWYgKHQ0Lmxlbmd0aCA+IDAgJiYgcjQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICBjb25zdCB0NSA9IHZKKGUzKTsKICAgICAgICAgICAgICAgICAgQkoodDUsIFsiYmxvY2tGb2xkZWQiLCAiYmxvY2tMaXRlcmFsIl0pID8gdDUuY2hvbXBpbmcgIT09ICJrZWVwIiAmJiAoaTMgPSBbY0osIGNKXSkgOiBpMyA9IGNKOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIFtsSihjSiwgbjMubWFwKG8zLCAiY2hpbGRyZW4iKSksIGkzLCBsSihjSiwgbjMubWFwKG8zLCAiZW5kQ29tbWVudHMiKSldOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlICJkaXJlY3RpdmUiOgogICAgICAgICAgICAgICAgcmV0dXJuIFsiJSIsIGxKKCIgIiwgW2UzLm5hbWUsIC4uLmUzLnBhcmFtZXRlcnNdKV07CiAgICAgICAgICAgICAgY2FzZSAiY29tbWVudCI6CiAgICAgICAgICAgICAgICByZXR1cm4gWyIjIiwgZTMudmFsdWVdOwogICAgICAgICAgICAgIGNhc2UgImFsaWFzIjoKICAgICAgICAgICAgICAgIHJldHVybiBbIioiLCBlMy52YWx1ZV07CiAgICAgICAgICAgICAgY2FzZSAidGFnIjoKICAgICAgICAgICAgICAgIHJldHVybiByMy5vcmlnaW5hbFRleHQuc2xpY2UoZTMucG9zaXRpb24uc3RhcnQub2Zmc2V0LCBlMy5wb3NpdGlvbi5lbmQub2Zmc2V0KTsKICAgICAgICAgICAgICBjYXNlICJhbmNob3IiOgogICAgICAgICAgICAgICAgcmV0dXJuIFsiJiIsIGUzLnZhbHVlXTsKICAgICAgICAgICAgICBjYXNlICJwbGFpbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gVkooZTMudHlwZSwgcjMub3JpZ2luYWxUZXh0LnNsaWNlKGUzLnBvc2l0aW9uLnN0YXJ0Lm9mZnNldCwgZTMucG9zaXRpb24uZW5kLm9mZnNldCksIHIzKTsKICAgICAgICAgICAgICBjYXNlICJxdW90ZURvdWJsZSI6CiAgICAgICAgICAgICAgY2FzZSAicXVvdGVTaW5nbGUiOiB7CiAgICAgICAgICAgICAgICBjb25zdCB0NCA9ICInIiwgbjQgPSAnIicsIG80ID0gcjMub3JpZ2luYWxUZXh0LnNsaWNlKGUzLnBvc2l0aW9uLnN0YXJ0Lm9mZnNldCArIDEsIGUzLnBvc2l0aW9uLmVuZC5vZmZzZXQgLSAxKTsKICAgICAgICAgICAgICAgIGlmIChlMy50eXBlID09PSAicXVvdGVTaW5nbGUiICYmIG80LmluY2x1ZGVzKCJcXCIpIHx8IGUzLnR5cGUgPT09ICJxdW90ZURvdWJsZSIgJiYgL1xcW14iXS8udGVzdChvNCkpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgaTQgPSBlMy50eXBlID09PSAicXVvdGVEb3VibGUiID8gbjQgOiB0NDsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFtpNCwgVkooZTMudHlwZSwgbzQsIHIzKSwgaTRdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG80LmluY2x1ZGVzKG40KSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIFt0NCwgVkooZTMudHlwZSwgZTMudHlwZSA9PT0gInF1b3RlRG91YmxlIiA/IG80LnJlcGxhY2UoL1xcIi9nLCBuNCkucmVwbGFjZSgvJy9nLCB0NC5yZXBlYXQoMikpIDogbzQsIHIzKSwgdDRdOwogICAgICAgICAgICAgICAgaWYgKG80LmluY2x1ZGVzKHQ0KSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIFtuNCwgVkooZTMudHlwZSwgZTMudHlwZSA9PT0gInF1b3RlU2luZ2xlIiA/IG80LnJlcGxhY2UoLycnL2csIHQ0KSA6IG80LCByMyksIG40XTsKICAgICAgICAgICAgICAgIGNvbnN0IGkzID0gcjMuc2luZ2xlUXVvdGUgPyB0NCA6IG40OwogICAgICAgICAgICAgICAgcmV0dXJuIFtpMywgVkooZTMudHlwZSwgbzQsIHIzKSwgaTNdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlICJibG9ja0ZvbGRlZCI6CiAgICAgICAgICAgICAgY2FzZSAiYmxvY2tMaXRlcmFsIjoKICAgICAgICAgICAgICAgIHJldHVybiBNSihuMywgbzMsIHIzKTsKICAgICAgICAgICAgICBjYXNlICJtYXBwaW5nIjoKICAgICAgICAgICAgICBjYXNlICJzZXF1ZW5jZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gbEooY0osIG4zLm1hcChvMywgImNoaWxkcmVuIikpOwogICAgICAgICAgICAgIGNhc2UgInNlcXVlbmNlSXRlbSI6CiAgICAgICAgICAgICAgICByZXR1cm4gWyItICIsIFBKKDIsIGUzLmNvbnRlbnQgPyBvMygiY29udGVudCIpIDogIiIpXTsKICAgICAgICAgICAgICBjYXNlICJtYXBwaW5nS2V5IjoKICAgICAgICAgICAgICBjYXNlICJtYXBwaW5nVmFsdWUiOgogICAgICAgICAgICAgICAgcmV0dXJuIGUzLmNvbnRlbnQgPyBvMygiY29udGVudCIpIDogIiI7CiAgICAgICAgICAgICAgY2FzZSAibWFwcGluZ0l0ZW0iOgogICAgICAgICAgICAgIGNhc2UgImZsb3dNYXBwaW5nSXRlbSI6CiAgICAgICAgICAgICAgICByZXR1cm4gX0ooZTMsIHQzLCBuMywgbzMsIHIzKTsKICAgICAgICAgICAgICBjYXNlICJmbG93TWFwcGluZyI6CiAgICAgICAgICAgICAgICByZXR1cm4gTEoobjMsIG8zLCByMyk7CiAgICAgICAgICAgICAgY2FzZSAiZmxvd1NlcXVlbmNlIjoKICAgICAgICAgICAgICAgIHJldHVybiBqSihuMywgbzMsIHIzKTsKICAgICAgICAgICAgICBjYXNlICJmbG93U2VxdWVuY2VJdGVtIjoKICAgICAgICAgICAgICAgIHJldHVybiBvMygiY29udGVudCIpOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgbm9kZSB0eXBlICIuY29uY2F0KGUzLnR5cGUpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfShyMiwgYTIsIGUyLCB0MiwgbjIpKSksIHhKKHIyKSAmJiAhQkoocjIsIFsiZG9jdW1lbnQiLCAiZG9jdW1lbnRIZWFkIl0pICYmIG8yLnB1c2goZkooW3IyLnR5cGUgIT09ICJtYXBwaW5nVmFsdWUiIHx8IHIyLmNvbnRlbnQgPyAiICIgOiAiIiwgYTIudHlwZSA9PT0gIm1hcHBpbmdLZXkiICYmIGUyLmdldFBhcmVudE5vZGUoMikudHlwZSA9PT0gIm1hcHBpbmciICYmIE5KKHIyKSA/ICIiIDogdUosIG4yKCJ0cmFpbGluZ0NvbW1lbnQiKV0pKSwgSUoocjIpICYmIG8yLnB1c2goUEoocjIudHlwZSA9PT0gInNlcXVlbmNlSXRlbSIgPyAyIDogMCwgW2NKLCBsSihjSiwgZTIubWFwKChlMykgPT4gW21KKHQyLm9yaWdpbmFsVGV4dCwgZTMuZ2V0VmFsdWUoKSwgRUopID8gY0ogOiAiIiwgbjIoKV0sICJlbmRDb21tZW50cyIpKV0pKSwgbzIucHVzaChzMiksIG8yOwogICAgICAgIH0sIG1hc3NhZ2VBc3ROb2RlOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGlmIChCSih0MikpCiAgICAgICAgICAgIHN3aXRjaCAoZGVsZXRlIHQyLnBvc2l0aW9uLCB0Mi50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiY29tbWVudCI6CiAgICAgICAgICAgICAgICBpZiAoREoodDIudmFsdWUpKQogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInF1b3RlRG91YmxlIjoKICAgICAgICAgICAgICBjYXNlICJxdW90ZVNpbmdsZSI6CiAgICAgICAgICAgICAgICB0Mi50eXBlID0gInF1b3RlIjsKICAgICAgICAgICAgfQogICAgICAgIH0sIGluc2VydFByYWdtYTogeUogfTsKICAgICAgICBjb25zdCBXSiA9ICRKLCBxSiA9IHsgYnJhY2tldFNwYWNpbmc6IGJqLmJyYWNrZXRTcGFjaW5nLCBzaW5nbGVRdW90ZTogYmouc2luZ2xlUXVvdGUsIHByb3NlV3JhcDogYmoucHJvc2VXcmFwIH0sIFVKID0gW2JFKHsgbmFtZTogIllBTUwiLCB0eXBlOiAiZGF0YSIsIGNvbG9yOiAiI2NiMTcxZSIsIHRtU2NvcGU6ICJzb3VyY2UueWFtbCIsIGFsaWFzZXM6IFsieW1sIl0sIGV4dGVuc2lvbnM6IFsiLnltbCIsICIubWlyIiwgIi5yZWVrIiwgIi5ydml6IiwgIi5zdWJsaW1lLXN5bnRheCIsICIuc3ludGF4IiwgIi55YW1sIiwgIi55YW1sLXRtbGFuZ3VhZ2UiLCAiLnlhbWwuc2VkIiwgIi55bWwubXlzcWwiXSwgZmlsZW5hbWVzOiBbIi5jbGFuZy1mb3JtYXQiLCAiLmNsYW5nLXRpZHkiLCAiLmdlbXJjIiwgImdsaWRlLmxvY2siLCAieWFybi5sb2NrIl0sIGFjZU1vZGU6ICJ5YW1sIiwgY29kZW1pcnJvck1vZGU6ICJ5YW1sIiwgY29kZW1pcnJvck1pbWVUeXBlOiAidGV4dC94LXlhbWwiLCBsYW5ndWFnZUlkOiA0MDcgfSwgKGUyKSA9PiAoeyBzaW5jZTogIjEuMTQuMCIsIHBhcnNlcnM6IFsieWFtbCJdLCB2c2NvZGVMYW5ndWFnZUlkczogWyJ5YW1sIiwgImFuc2libGUiLCAiaG9tZS1hc3Npc3RhbnQiXSwgZmlsZW5hbWVzOiBbLi4uZTIuZmlsZW5hbWVzLmZpbHRlcigoZTMpID0+IGUzICE9PSAieWFybi5sb2NrIiksICIucHJldHRpZXJyYyIsICIuc3R5bGVsaW50cmMiXSB9KSldOwogICAgICAgIHZhciB6SiA9IFtJaiwgUU0sIGZWLCBJViwgYlcsIFdHLCB7IGxhbmd1YWdlczogVUosIHByaW50ZXJzOiB7IHlhbWw6IFdKIH0sIG9wdGlvbnM6IHFKLCBwYXJzZXJzOiB2b2lkIDAgfV07CiAgICAgICAgY29uc3QgeyB2ZXJzaW9uOiBHSiB9ID0gbiwgSEogPSBYRCwgeyBnZXRTdXBwb3J0SW5mbzogSkogfSA9IHphLCBYSiA9IEVFLCBZSiA9IHpKLCBLSiA9IFpjOwogICAgICAgIGZ1bmN0aW9uIFFKKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IDE7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZvciAodmFyIG4yID0gYXJndW1lbnRzLmxlbmd0aCwgcjIgPSBuZXcgQXJyYXkobjIpLCBvMiA9IDA7IG8yIDwgbjI7IG8yKyspCiAgICAgICAgICAgICAgcjJbbzJdID0gYXJndW1lbnRzW28yXTsKICAgICAgICAgICAgY29uc3QgaTIgPSByMlt0Ml0gfHwge30sIHUyID0gaTIucGx1Z2lucyB8fCBbXTsKICAgICAgICAgICAgcmV0dXJuIHIyW3QyXSA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgaTIpLCB7fSwgeyBwbHVnaW5zOiBbLi4uWUosIC4uLkFycmF5LmlzQXJyYXkodTIpID8gdTIgOiBPYmplY3QudmFsdWVzKHUyKV0gfSksIGUyKC4uLnIyKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGNvbnN0IFpKID0gUUooSEouZm9ybWF0V2l0aEN1cnNvcik7CiAgICAgICAgdmFyIGVYID0geyBmb3JtYXRXaXRoQ3Vyc29yOiBaSiwgZm9ybWF0OiAoZTIsIHQyKSA9PiBaSihlMiwgdDIpLmZvcm1hdHRlZCwgY2hlY2soZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCB7IGZvcm1hdHRlZDogbjIgfSA9IFpKKGUyLCB0Mik7CiAgICAgICAgICByZXR1cm4gbjIgPT09IGUyOwogICAgICAgIH0sIGRvYzogS0osIGdldFN1cHBvcnRJbmZvOiBRSihKSiwgMCksIHZlcnNpb246IEdKLCB1dGlsOiBYSiwgX19kZWJ1ZzogeyBwYXJzZTogUUooSEoucGFyc2UpLCBmb3JtYXRBU1Q6IFFKKEhKLmZvcm1hdEFTVCksIGZvcm1hdERvYzogUUooSEouZm9ybWF0RG9jKSwgcHJpbnRUb0RvYzogUUooSEoucHJpbnRUb0RvYyksIHByaW50RG9jVG9TdHJpbmc6IFFKKEhKLnByaW50RG9jVG9TdHJpbmcpIH0gfTsKICAgICAgICByZXR1cm4gZVg7CiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyAuLi8uLi9ub2RlX21vZHVsZXMvcHJldHRpZXIvcGFyc2VyLWJhYmVsLmpzCiAgdmFyIHJlcXVpcmVfcGFyc2VyX2JhYmVsID0gX19jb21tb25KUyh7CiAgICAiLi4vLi4vbm9kZV9tb2R1bGVzL3ByZXR0aWVyL3BhcnNlci1iYWJlbC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgICFmdW5jdGlvbih0LCBlKSB7CiAgICAgICAgdHlwZW9mIGV4cG9ydHMgPT0gIm9iamVjdCIgJiYgdHlwZW9mIG1vZHVsZSAhPSAidW5kZWZpbmVkIiA/IG1vZHVsZS5leHBvcnRzID0gZSgpIDogdHlwZW9mIGRlZmluZSA9PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoZSkgOiAoKHQgPSB0eXBlb2YgZ2xvYmFsVGhpcyAhPSAidW5kZWZpbmVkIiA/IGdsb2JhbFRoaXMgOiB0IHx8IHNlbGYpLnByZXR0aWVyUGx1Z2lucyA9IHQucHJldHRpZXJQbHVnaW5zIHx8IHt9LCB0LnByZXR0aWVyUGx1Z2lucy5iYWJlbCA9IGUoKSk7CiAgICAgIH0oZXhwb3J0cywgZnVuY3Rpb24oKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciB0ID0gdHlwZW9mIGdsb2JhbFRoaXMgIT0gInVuZGVmaW5lZCIgPyBnbG9iYWxUaGlzIDogdHlwZW9mIHdpbmRvdyAhPSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT0gInVuZGVmaW5lZCIgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPSAidW5kZWZpbmVkIiA/IHNlbGYgOiB7fTsKICAgICAgICBmdW5jdGlvbiBlKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQyLCAiZGVmYXVsdCIpID8gdDIuZGVmYXVsdCA6IHQyOwogICAgICAgIH0KICAgICAgICB2YXIgcyA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIgJiYgdDIuTWF0aCA9PSBNYXRoICYmIHQyOwogICAgICAgIH0sIHIgPSBzKHR5cGVvZiBnbG9iYWxUaGlzID09ICJvYmplY3QiICYmIGdsb2JhbFRoaXMpIHx8IHModHlwZW9mIHdpbmRvdyA9PSAib2JqZWN0IiAmJiB3aW5kb3cpIHx8IHModHlwZW9mIHNlbGYgPT0gIm9iamVjdCIgJiYgc2VsZikgfHwgcyh0eXBlb2YgdCA9PSAib2JqZWN0IiAmJiB0KSB8fCBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0oKSB8fCBGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpLCBpID0ge30sIG4gPSBmdW5jdGlvbih0MikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuICEhdDIoKTsKICAgICAgICAgIH0gY2F0Y2ggKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0sIGEgPSAhbihmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sIDEsIHsgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIDc7CiAgICAgICAgICB9IH0pWzFdICE9IDc7CiAgICAgICAgfSksIG8gPSBGdW5jdGlvbi5wcm90b3R5cGUuY2FsbCwgdSA9IG8uYmluZCA/IG8uYmluZChvKSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIG8uYXBwbHkobywgYXJndW1lbnRzKTsKICAgICAgICB9LCBoID0ge30sIHAgPSB7fS5wcm9wZXJ0eUlzRW51bWVyYWJsZSwgYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsIGwgPSBjICYmICFwLmNhbGwoeyAxOiAyIH0sIDEpOwogICAgICAgIGguZiA9IGwgPyBmdW5jdGlvbih0MikgewogICAgICAgICAgdmFyIGUyID0gYyh0aGlzLCB0Mik7CiAgICAgICAgICByZXR1cm4gISFlMiAmJiBlMi5lbnVtZXJhYmxlOwogICAgICAgIH0gOiBwOwogICAgICAgIHZhciBkLCBELCBtID0gZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICByZXR1cm4geyBlbnVtZXJhYmxlOiAhKDEgJiB0MiksIGNvbmZpZ3VyYWJsZTogISgyICYgdDIpLCB3cml0YWJsZTogISg0ICYgdDIpLCB2YWx1ZTogZTIgfTsKICAgICAgICB9LCBmID0gRnVuY3Rpb24ucHJvdG90eXBlLCB5ID0gZi5iaW5kLCBFID0gZi5jYWxsLCBBID0geSAmJiB5LmJpbmQoRSksIEMgPSB5ID8gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiB0MiAmJiBBKEUsIHQyKTsKICAgICAgICB9IDogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiB0MiAmJiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIEUuYXBwbHkodDIsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9OwogICAgICAgIH0sIHggPSBDLCBGID0geCh7fS50b1N0cmluZyksIGcgPSB4KCIiLnNsaWNlKSwgUCA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gZyhGKHQyKSwgOCwgLTEpOwogICAgICAgIH0sIFQgPSBDLCBiID0gbiwgUyA9IFAsIHcgPSByLk9iamVjdCwgQiA9IFQoIiIuc3BsaXQpLCBOID0gYihmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAhdygieiIpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApOwogICAgICAgIH0pID8gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiBTKHQyKSA9PSAiU3RyaW5nIiA/IEIodDIsICIiKSA6IHcodDIpOwogICAgICAgIH0gOiB3LCBJID0gci5UeXBlRXJyb3IsIHYgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgaWYgKHQyID09IG51bGwpCiAgICAgICAgICAgIHRocm93IEkoIkNhbid0IGNhbGwgbWV0aG9kIG9uICIgKyB0Mik7CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfSwgayA9IE4sIEwgPSB2LCBPID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiBrKEwodDIpKTsKICAgICAgICB9LCBNID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiB0eXBlb2YgdDIgPT0gImZ1bmN0aW9uIjsKICAgICAgICB9LCBSID0gTSwgaiA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIHQyID09ICJvYmplY3QiID8gdDIgIT09IG51bGwgOiBSKHQyKTsKICAgICAgICB9LCBVID0gciwgXyA9IE0sIHogPSBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIF8odDIpID8gdDIgOiB2b2lkIDA7CiAgICAgICAgfSwgSCA9IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAyID8geihVW3QyXSkgOiBVW3QyXSAmJiBVW3QyXVtlMl07CiAgICAgICAgfSwgViA9IEMoe30uaXNQcm90b3R5cGVPZiksIHEgPSBIKCJuYXZpZ2F0b3IiLCAidXNlckFnZW50IikgfHwgIiIsIFcgPSByLCBLID0gcSwgRyA9IFcucHJvY2VzcywgWCA9IFcuRGVubywgSiA9IEcgJiYgRy52ZXJzaW9ucyB8fCBYICYmIFgudmVyc2lvbiwgJCA9IEogJiYgSi52ODsKICAgICAgICAkICYmIChEID0gKGQgPSAkLnNwbGl0KCIuIikpWzBdID4gMCAmJiBkWzBdIDwgNCA/IDEgOiArKGRbMF0gKyBkWzFdKSksICFEICYmIEsgJiYgKCEoZCA9IEsubWF0Y2goL0VkZ2VcLyhcZCspLykpIHx8IGRbMV0gPj0gNzQpICYmIChkID0gSy5tYXRjaCgvQ2hyb21lXC8oXGQrKS8pKSAmJiAoRCA9ICtkWzFdKTsKICAgICAgICB2YXIgWSA9IEQsIFEgPSBZLCBaID0gbiwgdHQgPSAhIU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgJiYgIVooZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgdDIgPSBTeW1ib2woKTsKICAgICAgICAgIHJldHVybiAhU3RyaW5nKHQyKSB8fCAhKE9iamVjdCh0MikgaW5zdGFuY2VvZiBTeW1ib2wpIHx8ICFTeW1ib2wuc2hhbSAmJiBRICYmIFEgPCA0MTsKICAgICAgICB9KSwgZXQgPSB0dCAmJiAhU3ltYm9sLnNoYW0gJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PSAic3ltYm9sIiwgc3QgPSBILCBydCA9IE0sIGl0ID0gViwgbnQgPSBldCwgYXQgPSByLk9iamVjdCwgb3QgPSBudCA/IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIHQyID09ICJzeW1ib2wiOwogICAgICAgIH0gOiBmdW5jdGlvbih0MikgewogICAgICAgICAgdmFyIGUyID0gc3QoIlN5bWJvbCIpOwogICAgICAgICAgcmV0dXJuIHJ0KGUyKSAmJiBpdChlMi5wcm90b3R5cGUsIGF0KHQyKSk7CiAgICAgICAgfSwgdXQgPSByLlN0cmluZywgaHQgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHV0KHQyKTsKICAgICAgICAgIH0gY2F0Y2ggKHQzKSB7CiAgICAgICAgICAgIHJldHVybiAiT2JqZWN0IjsKICAgICAgICAgIH0KICAgICAgICB9LCBwdCA9IE0sIGN0ID0gaHQsIGx0ID0gci5UeXBlRXJyb3IsIGR0ID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIGlmIChwdCh0MikpCiAgICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICAgIHRocm93IGx0KGN0KHQyKSArICIgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICB9LCBEdCA9IGR0LCBtdCA9IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgdmFyIHMyID0gdDJbZTJdOwogICAgICAgICAgcmV0dXJuIHMyID09IG51bGwgPyB2b2lkIDAgOiBEdChzMik7CiAgICAgICAgfSwgZnQgPSB1LCB5dCA9IE0sIEV0ID0gaiwgQXQgPSByLlR5cGVFcnJvciwgQ3QgPSB7IGV4cG9ydHM6IHt9IH0sIHh0ID0gciwgRnQgPSBPYmplY3QuZGVmaW5lUHJvcGVydHksIGd0ID0gZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBGdCh4dCwgdDIsIHsgdmFsdWU6IGUyLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOwogICAgICAgICAgfSBjYXRjaCAoczIpIHsKICAgICAgICAgICAgeHRbdDJdID0gZTI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgfSwgUHQgPSBndCwgVHQgPSAiX19jb3JlLWpzX3NoYXJlZF9fIiwgYnQgPSByW1R0XSB8fCBQdChUdCwge30pLCBTdCA9IGJ0OwogICAgICAgIChDdC5leHBvcnRzID0gZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICByZXR1cm4gU3RbdDJdIHx8IChTdFt0Ml0gPSBlMiAhPT0gdm9pZCAwID8gZTIgOiB7fSk7CiAgICAgICAgfSkoInZlcnNpb25zIiwgW10pLnB1c2goeyB2ZXJzaW9uOiAiMy4xOS4xIiwgbW9kZTogImdsb2JhbCIsIGNvcHlyaWdodDogIlx4QTkgMjAyMSBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KSIgfSk7CiAgICAgICAgdmFyIHd0ID0gdiwgQnQgPSByLk9iamVjdCwgTnQgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIEJ0KHd0KHQyKSk7CiAgICAgICAgfSwgSXQgPSBOdCwgdnQgPSBDKHt9Lmhhc093blByb3BlcnR5KSwga3QgPSBPYmplY3QuaGFzT3duIHx8IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgcmV0dXJuIHZ0KEl0KHQyKSwgZTIpOwogICAgICAgIH0sIEx0ID0gQywgT3QgPSAwLCBNdCA9IE1hdGgucmFuZG9tKCksIFJ0ID0gTHQoMSAudG9TdHJpbmcpLCBqdCA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gIlN5bWJvbCgiICsgKHQyID09PSB2b2lkIDAgPyAiIiA6IHQyKSArICIpXyIgKyBSdCgrK090ICsgTXQsIDM2KTsKICAgICAgICB9LCBVdCA9IHIsIF90ID0gQ3QuZXhwb3J0cywgenQgPSBrdCwgSHQgPSBqdCwgVnQgPSB0dCwgcXQgPSBldCwgV3QgPSBfdCgid2tzIiksIEt0ID0gVXQuU3ltYm9sLCBHdCA9IEt0ICYmIEt0LmZvciwgWHQgPSBxdCA/IEt0IDogS3QgJiYgS3Qud2l0aG91dFNldHRlciB8fCBIdCwgSnQgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgaWYgKCF6dChXdCwgdDIpIHx8ICFWdCAmJiB0eXBlb2YgV3RbdDJdICE9ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHZhciBlMiA9ICJTeW1ib2wuIiArIHQyOwogICAgICAgICAgICBWdCAmJiB6dChLdCwgdDIpID8gV3RbdDJdID0gS3RbdDJdIDogV3RbdDJdID0gcXQgJiYgR3QgPyBHdChlMikgOiBYdChlMik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gV3RbdDJdOwogICAgICAgIH0sICR0ID0gdSwgWXQgPSBqLCBRdCA9IG90LCBadCA9IG10LCB0ZSA9IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgdmFyIHMyLCByMjsKICAgICAgICAgIGlmIChlMiA9PT0gInN0cmluZyIgJiYgeXQoczIgPSB0Mi50b1N0cmluZykgJiYgIUV0KHIyID0gZnQoczIsIHQyKSkpCiAgICAgICAgICAgIHJldHVybiByMjsKICAgICAgICAgIGlmICh5dChzMiA9IHQyLnZhbHVlT2YpICYmICFFdChyMiA9IGZ0KHMyLCB0MikpKQogICAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgICBpZiAoZTIgIT09ICJzdHJpbmciICYmIHl0KHMyID0gdDIudG9TdHJpbmcpICYmICFFdChyMiA9IGZ0KHMyLCB0MikpKQogICAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgICB0aHJvdyBBdCgiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIik7CiAgICAgICAgfSwgZWUgPSBKdCwgc2UgPSByLlR5cGVFcnJvciwgcmUgPSBlZSgidG9QcmltaXRpdmUiKSwgaWUgPSBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIGlmICghWXQodDIpIHx8IFF0KHQyKSkKICAgICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgICAgdmFyIHMyLCByMiA9IFp0KHQyLCByZSk7CiAgICAgICAgICBpZiAocjIpIHsKICAgICAgICAgICAgaWYgKGUyID09PSB2b2lkIDAgJiYgKGUyID0gImRlZmF1bHQiKSwgczIgPSAkdChyMiwgdDIsIGUyKSwgIVl0KHMyKSB8fCBRdChzMikpCiAgICAgICAgICAgICAgcmV0dXJuIHMyOwogICAgICAgICAgICB0aHJvdyBzZSgiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZTIgPT09IHZvaWQgMCAmJiAoZTIgPSAibnVtYmVyIiksIHRlKHQyLCBlMik7CiAgICAgICAgfSwgbmUgPSBvdCwgYWUgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgdmFyIGUyID0gaWUodDIsICJzdHJpbmciKTsKICAgICAgICAgIHJldHVybiBuZShlMikgPyBlMiA6IGUyICsgIiI7CiAgICAgICAgfSwgb2UgPSBqLCB1ZSA9IHIuZG9jdW1lbnQsIGhlID0gb2UodWUpICYmIG9lKHVlLmNyZWF0ZUVsZW1lbnQpLCBwZSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gaGUgPyB1ZS5jcmVhdGVFbGVtZW50KHQyKSA6IHt9OwogICAgICAgIH0sIGNlID0gIWEgJiYgIW4oZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHBlKCJkaXYiKSwgImEiLCB7IGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiA3OwogICAgICAgICAgfSB9KS5hICE9IDc7CiAgICAgICAgfSksIGxlID0gYSwgZGUgPSB1LCBEZSA9IGgsIG1lID0gbSwgZmUgPSBPLCB5ZSA9IGFlLCBFZSA9IGt0LCBBZSA9IGNlLCBDZSA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgICAgICAgaS5mID0gbGUgPyBDZSA6IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgaWYgKHQyID0gZmUodDIpLCBlMiA9IHllKGUyKSwgQWUpCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIENlKHQyLCBlMik7CiAgICAgICAgICAgIH0gY2F0Y2ggKHQzKSB7CiAgICAgICAgICAgIH0KICAgICAgICAgIGlmIChFZSh0MiwgZTIpKQogICAgICAgICAgICByZXR1cm4gbWUoIWRlKERlLmYsIHQyLCBlMiksIHQyW2UyXSk7CiAgICAgICAgfTsKICAgICAgICB2YXIgeGUgPSB7fSwgRmUgPSByLCBnZSA9IGosIFBlID0gRmUuU3RyaW5nLCBUZSA9IEZlLlR5cGVFcnJvciwgYmUgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgaWYgKGdlKHQyKSkKICAgICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgICAgdGhyb3cgVGUoUGUodDIpICsgIiBpcyBub3QgYW4gb2JqZWN0Iik7CiAgICAgICAgfSwgU2UgPSBhLCB3ZSA9IGNlLCBCZSA9IGJlLCBOZSA9IGFlLCBJZSA9IHIuVHlwZUVycm9yLCB2ZSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKICAgICAgICB4ZS5mID0gU2UgPyB2ZSA6IGZ1bmN0aW9uKHQyLCBlMiwgczIpIHsKICAgICAgICAgIGlmIChCZSh0MiksIGUyID0gTmUoZTIpLCBCZShzMiksIHdlKQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiB2ZSh0MiwgZTIsIHMyKTsKICAgICAgICAgICAgfSBjYXRjaCAodDMpIHsKICAgICAgICAgICAgfQogICAgICAgICAgaWYgKCJnZXQiIGluIHMyIHx8ICJzZXQiIGluIHMyKQogICAgICAgICAgICB0aHJvdyBJZSgiQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICAgIHJldHVybiAidmFsdWUiIGluIHMyICYmICh0MltlMl0gPSBzMi52YWx1ZSksIHQyOwogICAgICAgIH07CiAgICAgICAgdmFyIGtlID0geGUsIExlID0gbSwgT2UgPSBhID8gZnVuY3Rpb24odDIsIGUyLCBzMikgewogICAgICAgICAgcmV0dXJuIGtlLmYodDIsIGUyLCBMZSgxLCBzMikpOwogICAgICAgIH0gOiBmdW5jdGlvbih0MiwgZTIsIHMyKSB7CiAgICAgICAgICByZXR1cm4gdDJbZTJdID0gczIsIHQyOwogICAgICAgIH0sIE1lID0geyBleHBvcnRzOiB7fSB9LCBSZSA9IE0sIGplID0gYnQsIFVlID0gQyhGdW5jdGlvbi50b1N0cmluZyk7CiAgICAgICAgUmUoamUuaW5zcGVjdFNvdXJjZSkgfHwgKGplLmluc3BlY3RTb3VyY2UgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIFVlKHQyKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgX2UsIHplLCBIZSwgVmUgPSBqZS5pbnNwZWN0U291cmNlLCBxZSA9IE0sIFdlID0gVmUsIEtlID0gci5XZWFrTWFwLCBHZSA9IHFlKEtlKSAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoV2UoS2UpKSwgWGUgPSBDdC5leHBvcnRzLCBKZSA9IGp0LCAkZSA9IFhlKCJrZXlzIiksIFllID0ge30sIFFlID0gR2UsIFplID0gciwgdHMgPSBDLCBlcyA9IGosIHNzID0gT2UsIHJzID0ga3QsIGlzID0gYnQsIG5zID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiAkZVt0Ml0gfHwgKCRlW3QyXSA9IEplKHQyKSk7CiAgICAgICAgfSwgYXMgPSBZZSwgb3MgPSAiT2JqZWN0IGFscmVhZHkgaW5pdGlhbGl6ZWQiLCB1cyA9IFplLlR5cGVFcnJvciwgaHMgPSBaZS5XZWFrTWFwOwogICAgICAgIGlmIChRZSB8fCBpcy5zdGF0ZSkgewogICAgICAgICAgdmFyIHBzID0gaXMuc3RhdGUgfHwgKGlzLnN0YXRlID0gbmV3IGhzKCkpLCBjcyA9IHRzKHBzLmdldCksIGxzID0gdHMocHMuaGFzKSwgZHMgPSB0cyhwcy5zZXQpOwogICAgICAgICAgX2UgPSBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgICAgaWYgKGxzKHBzLCB0MikpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IHVzKG9zKTsKICAgICAgICAgICAgcmV0dXJuIGUyLmZhY2FkZSA9IHQyLCBkcyhwcywgdDIsIGUyKSwgZTI7CiAgICAgICAgICB9LCB6ZSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICAgIHJldHVybiBjcyhwcywgdDIpIHx8IHt9OwogICAgICAgICAgfSwgSGUgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgICByZXR1cm4gbHMocHMsIHQyKTsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBEcyA9IG5zKCJzdGF0ZSIpOwogICAgICAgICAgYXNbRHNdID0gdHJ1ZSwgX2UgPSBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgICAgaWYgKHJzKHQyLCBEcykpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IHVzKG9zKTsKICAgICAgICAgICAgcmV0dXJuIGUyLmZhY2FkZSA9IHQyLCBzcyh0MiwgRHMsIGUyKSwgZTI7CiAgICAgICAgICB9LCB6ZSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICAgIHJldHVybiBycyh0MiwgRHMpID8gdDJbRHNdIDoge307CiAgICAgICAgICB9LCBIZSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICAgIHJldHVybiBycyh0MiwgRHMpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgdmFyIG1zID0geyBzZXQ6IF9lLCBnZXQ6IHplLCBoYXM6IEhlLCBlbmZvcmNlOiBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIEhlKHQyKSA/IHplKHQyKSA6IF9lKHQyLCB7fSk7CiAgICAgICAgfSwgZ2V0dGVyRm9yOiBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICAgIHZhciBzMjsKICAgICAgICAgICAgaWYgKCFlcyhlMikgfHwgKHMyID0gemUoZTIpKS50eXBlICE9PSB0MikKICAgICAgICAgICAgICB0aHJvdyB1cygiSW5jb21wYXRpYmxlIHJlY2VpdmVyLCAiICsgdDIgKyAiIHJlcXVpcmVkIik7CiAgICAgICAgICAgIHJldHVybiBzMjsKICAgICAgICAgIH07CiAgICAgICAgfSB9LCBmcyA9IGEsIHlzID0ga3QsIEVzID0gRnVuY3Rpb24ucHJvdG90eXBlLCBBcyA9IGZzICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsIENzID0geXMoRXMsICJuYW1lIiksIHhzID0gQ3MgJiYgZnVuY3Rpb24oKSB7CiAgICAgICAgfS5uYW1lID09PSAic29tZXRoaW5nIiwgRnMgPSBDcyAmJiAoIWZzIHx8IGZzICYmIEFzKEVzLCAibmFtZSIpLmNvbmZpZ3VyYWJsZSksIGdzID0gciwgUHMgPSBNLCBUcyA9IGt0LCBicyA9IE9lLCBTcyA9IGd0LCB3cyA9IFZlLCBCcyA9IHsgRVhJU1RTOiBDcywgUFJPUEVSOiB4cywgQ09ORklHVVJBQkxFOiBGcyB9LkNPTkZJR1VSQUJMRSwgTnMgPSBtcy5nZXQsIElzID0gbXMuZW5mb3JjZSwgdnMgPSBTdHJpbmcoU3RyaW5nKS5zcGxpdCgiU3RyaW5nIik7CiAgICAgICAgKE1lLmV4cG9ydHMgPSBmdW5jdGlvbih0MiwgZTIsIHMyLCByMikgewogICAgICAgICAgdmFyIGkyLCBuMiA9ICEhcjIgJiYgISFyMi51bnNhZmUsIGEyID0gISFyMiAmJiAhIXIyLmVudW1lcmFibGUsIG8yID0gISFyMiAmJiAhIXIyLm5vVGFyZ2V0R2V0LCB1MiA9IHIyICYmIHIyLm5hbWUgIT09IHZvaWQgMCA/IHIyLm5hbWUgOiBlMjsKICAgICAgICAgIFBzKHMyKSAmJiAoU3RyaW5nKHUyKS5zbGljZSgwLCA3KSA9PT0gIlN5bWJvbCgiICYmICh1MiA9ICJbIiArIFN0cmluZyh1MikucmVwbGFjZSgvXlN5bWJvbFwoKFteKV0qKVwpLywgIiQxIikgKyAiXSIpLCAoIVRzKHMyLCAibmFtZSIpIHx8IEJzICYmIHMyLm5hbWUgIT09IHUyKSAmJiBicyhzMiwgIm5hbWUiLCB1MiksIChpMiA9IElzKHMyKSkuc291cmNlIHx8IChpMi5zb3VyY2UgPSB2cy5qb2luKHR5cGVvZiB1MiA9PSAic3RyaW5nIiA/IHUyIDogIiIpKSksIHQyICE9PSBncyA/IChuMiA/ICFvMiAmJiB0MltlMl0gJiYgKGEyID0gdHJ1ZSkgOiBkZWxldGUgdDJbZTJdLCBhMiA/IHQyW2UyXSA9IHMyIDogYnModDIsIGUyLCBzMikpIDogYTIgPyB0MltlMl0gPSBzMiA6IFNzKGUyLCBzMik7CiAgICAgICAgfSkoRnVuY3Rpb24ucHJvdG90eXBlLCAidG9TdHJpbmciLCBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBQcyh0aGlzKSAmJiBOcyh0aGlzKS5zb3VyY2UgfHwgd3ModGhpcyk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGtzID0ge30sIExzID0gTWF0aC5jZWlsLCBPcyA9IE1hdGguZmxvb3IsIE1zID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHZhciBlMiA9ICt0MjsKICAgICAgICAgIHJldHVybiBlMiAhPSBlMiB8fCBlMiA9PT0gMCA/IDAgOiAoZTIgPiAwID8gT3MgOiBMcykoZTIpOwogICAgICAgIH0sIFJzID0gTXMsIGpzID0gTWF0aC5tYXgsIFVzID0gTWF0aC5taW4sIF9zID0gTXMsIHpzID0gTWF0aC5taW4sIEhzID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiB0MiA+IDAgPyB6cyhfcyh0MiksIDkwMDcxOTkyNTQ3NDA5OTEpIDogMDsKICAgICAgICB9LCBWcyA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gSHModDIubGVuZ3RoKTsKICAgICAgICB9LCBxcyA9IE8sIFdzID0gZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICB2YXIgczIgPSBScyh0Mik7CiAgICAgICAgICByZXR1cm4gczIgPCAwID8ganMoczIgKyBlMiwgMCkgOiBVcyhzMiwgZTIpOwogICAgICAgIH0sIEtzID0gVnMsIEdzID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlMiwgczIsIHIyKSB7CiAgICAgICAgICAgIHZhciBpMiwgbjIgPSBxcyhlMiksIGEyID0gS3MobjIpLCBvMiA9IFdzKHIyLCBhMik7CiAgICAgICAgICAgIGlmICh0MiAmJiBzMiAhPSBzMikgewogICAgICAgICAgICAgIGZvciAoOyBhMiA+IG8yOyApCiAgICAgICAgICAgICAgICBpZiAoKGkyID0gbjJbbzIrK10pICE9IGkyKQogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgZm9yICg7IGEyID4gbzI7IG8yKyspCiAgICAgICAgICAgICAgICBpZiAoKHQyIHx8IG8yIGluIG4yKSAmJiBuMltvMl0gPT09IHMyKQogICAgICAgICAgICAgICAgICByZXR1cm4gdDIgfHwgbzIgfHwgMDsKICAgICAgICAgICAgcmV0dXJuICF0MiAmJiAtMTsKICAgICAgICAgIH07CiAgICAgICAgfSwgWHMgPSB7IGluY2x1ZGVzOiBHcyh0cnVlKSwgaW5kZXhPZjogR3MoZmFsc2UpIH0sIEpzID0ga3QsICRzID0gTywgWXMgPSBYcy5pbmRleE9mLCBRcyA9IFllLCBacyA9IEMoW10ucHVzaCksIHRyID0gZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICB2YXIgczIsIHIyID0gJHModDIpLCBpMiA9IDAsIG4yID0gW107CiAgICAgICAgICBmb3IgKHMyIGluIHIyKQogICAgICAgICAgICAhSnMoUXMsIHMyKSAmJiBKcyhyMiwgczIpICYmIFpzKG4yLCBzMik7CiAgICAgICAgICBmb3IgKDsgZTIubGVuZ3RoID4gaTI7ICkKICAgICAgICAgICAgSnMocjIsIHMyID0gZTJbaTIrK10pICYmICh+WXMobjIsIHMyKSB8fCBacyhuMiwgczIpKTsKICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICB9LCBlciA9IFsiY29uc3RydWN0b3IiLCAiaGFzT3duUHJvcGVydHkiLCAiaXNQcm90b3R5cGVPZiIsICJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsICJ0b0xvY2FsZVN0cmluZyIsICJ0b1N0cmluZyIsICJ2YWx1ZU9mIl0uY29uY2F0KCJsZW5ndGgiLCAicHJvdG90eXBlIik7CiAgICAgICAga3MuZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHx8IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gdHIodDIsIGVyKTsKICAgICAgICB9OwogICAgICAgIHZhciBzciA9IHt9OwogICAgICAgIHNyLmYgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzOwogICAgICAgIHZhciByciA9IEgsIGlyID0ga3MsIG5yID0gc3IsIGFyID0gYmUsIG9yID0gQyhbXS5jb25jYXQpLCB1ciA9IHJyKCJSZWZsZWN0IiwgIm93bktleXMiKSB8fCBmdW5jdGlvbih0MikgewogICAgICAgICAgdmFyIGUyID0gaXIuZihhcih0MikpLCBzMiA9IG5yLmY7CiAgICAgICAgICByZXR1cm4gczIgPyBvcihlMiwgczIodDIpKSA6IGUyOwogICAgICAgIH0sIGhyID0ga3QsIHByID0gdXIsIGNyID0gaSwgbHIgPSB4ZSwgZHIgPSBuLCBEciA9IE0sIG1yID0gLyN8XC5wcm90b3R5cGVcLi8sIGZyID0gZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICB2YXIgczIgPSBFclt5cih0MildOwogICAgICAgICAgcmV0dXJuIHMyID09IENyIHx8IHMyICE9IEFyICYmIChEcihlMikgPyBkcihlMikgOiAhIWUyKTsKICAgICAgICB9LCB5ciA9IGZyLm5vcm1hbGl6ZSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gU3RyaW5nKHQyKS5yZXBsYWNlKG1yLCAiLiIpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgfSwgRXIgPSBmci5kYXRhID0ge30sIEFyID0gZnIuTkFUSVZFID0gIk4iLCBDciA9IGZyLlBPTFlGSUxMID0gIlAiLCB4ciA9IGZyLCBGciA9IHIsIGdyID0gaS5mLCBQciA9IE9lLCBUciA9IE1lLmV4cG9ydHMsIGJyID0gZ3QsIFNyID0gZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICBmb3IgKHZhciBzMiA9IHByKGUyKSwgcjIgPSBsci5mLCBpMiA9IGNyLmYsIG4yID0gMDsgbjIgPCBzMi5sZW5ndGg7IG4yKyspIHsKICAgICAgICAgICAgdmFyIGEyID0gczJbbjJdOwogICAgICAgICAgICBocih0MiwgYTIpIHx8IHIyKHQyLCBhMiwgaTIoZTIsIGEyKSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgd3IgPSB4ciwgQnIgPSBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIHZhciBzMiwgcjIsIGkyLCBuMiwgYTIsIG8yID0gdDIudGFyZ2V0LCB1MiA9IHQyLmdsb2JhbCwgaDIgPSB0Mi5zdGF0OwogICAgICAgICAgaWYgKHMyID0gdTIgPyBGciA6IGgyID8gRnJbbzJdIHx8IGJyKG8yLCB7fSkgOiAoRnJbbzJdIHx8IHt9KS5wcm90b3R5cGUpCiAgICAgICAgICAgIGZvciAocjIgaW4gZTIpIHsKICAgICAgICAgICAgICBpZiAobjIgPSBlMltyMl0sIGkyID0gdDIubm9UYXJnZXRHZXQgPyAoYTIgPSBncihzMiwgcjIpKSAmJiBhMi52YWx1ZSA6IHMyW3IyXSwgIXdyKHUyID8gcjIgOiBvMiArIChoMiA/ICIuIiA6ICIjIikgKyByMiwgdDIuZm9yY2VkKSAmJiBpMiAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG4yID09IHR5cGVvZiBpMikKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBTcihuMiwgaTIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAodDIuc2hhbSB8fCBpMiAmJiBpMi5zaGFtKSAmJiBQcihuMiwgInNoYW0iLCB0cnVlKSwgVHIoczIsIHIyLCBuMiwgdDIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgTnIgPSBQLCBJciA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiBOcih0MikgPT0gIkFycmF5IjsKICAgICAgICB9LCB2ciA9IGR0LCBrciA9IEMoQy5iaW5kKSwgTHIgPSBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIHJldHVybiB2cih0MiksIGUyID09PSB2b2lkIDAgPyB0MiA6IGtyID8ga3IodDIsIGUyKSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdDIuYXBwbHkoZTIsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9OwogICAgICAgIH0sIE9yID0gSXIsIE1yID0gVnMsIFJyID0gTHIsIGpyID0gci5UeXBlRXJyb3IsIFVyID0gZnVuY3Rpb24odDIsIGUyLCBzMiwgcjIsIGkyLCBuMiwgYTIsIG8yKSB7CiAgICAgICAgICBmb3IgKHZhciB1MiwgaDIsIHAyID0gaTIsIGMyID0gMCwgbDIgPSAhIWEyICYmIFJyKGEyLCBvMik7IGMyIDwgcjI7ICkgewogICAgICAgICAgICBpZiAoYzIgaW4gczIpIHsKICAgICAgICAgICAgICBpZiAodTIgPSBsMiA/IGwyKHMyW2MyXSwgYzIsIGUyKSA6IHMyW2MyXSwgbjIgPiAwICYmIE9yKHUyKSkKICAgICAgICAgICAgICAgIGgyID0gTXIodTIpLCBwMiA9IFVyKHQyLCBlMiwgdTIsIGgyLCBwMiwgbjIgLSAxKSAtIDE7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAocDIgPj0gOTAwNzE5OTI1NDc0MDk5MSkKICAgICAgICAgICAgICAgICAgdGhyb3cganIoIkV4Y2VlZCB0aGUgYWNjZXB0YWJsZSBhcnJheSBsZW5ndGgiKTsKICAgICAgICAgICAgICAgIHQyW3AyXSA9IHUyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBwMisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGMyKys7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcDI7CiAgICAgICAgfSwgX3IgPSBVciwgenIgPSB7fTsKICAgICAgICB6cltKdCgidG9TdHJpbmdUYWciKV0gPSAieiI7CiAgICAgICAgdmFyIEhyID0gciwgVnIgPSBTdHJpbmcoenIpID09PSAiW29iamVjdCB6XSIsIHFyID0gTSwgV3IgPSBQLCBLciA9IEp0KCJ0b1N0cmluZ1RhZyIpLCBHciA9IEhyLk9iamVjdCwgWHIgPSBXcihmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHM7CiAgICAgICAgfSgpKSA9PSAiQXJndW1lbnRzIiwgSnIgPSBWciA/IFdyIDogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHZhciBlMiwgczIsIHIyOwogICAgICAgICAgcmV0dXJuIHQyID09PSB2b2lkIDAgPyAiVW5kZWZpbmVkIiA6IHQyID09PSBudWxsID8gIk51bGwiIDogdHlwZW9mIChzMiA9IGZ1bmN0aW9uKHQzLCBlMykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiB0M1tlM107CiAgICAgICAgICAgIH0gY2F0Y2ggKHQ0KSB7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0oZTIgPSBHcih0MiksIEtyKSkgPT0gInN0cmluZyIgPyBzMiA6IFhyID8gV3IoZTIpIDogKHIyID0gV3IoZTIpKSA9PSAiT2JqZWN0IiAmJiBxcihlMi5jYWxsZWUpID8gIkFyZ3VtZW50cyIgOiByMjsKICAgICAgICB9LCAkciA9IEMsIFlyID0gbiwgUXIgPSBNLCBaciA9IEpyLCB0aSA9IFZlLCBlaSA9IGZ1bmN0aW9uKCkgewogICAgICAgIH0sIHNpID0gW10sIHJpID0gSCgiUmVmbGVjdCIsICJjb25zdHJ1Y3QiKSwgaWkgPSAvXlxzKig/OmNsYXNzfGZ1bmN0aW9uKVxiLywgbmkgPSAkcihpaS5leGVjKSwgYWkgPSAhaWkuZXhlYyhlaSksIG9pID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIGlmICghUXIodDIpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gcmkoZWksIHNpLCB0MiksIHRydWU7CiAgICAgICAgICB9IGNhdGNoICh0MykgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSwgdWkgPSAhcmkgfHwgWXIoZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgdDI7CiAgICAgICAgICByZXR1cm4gb2kob2kuY2FsbCkgfHwgIW9pKE9iamVjdCkgfHwgIW9pKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0MiA9IHRydWU7CiAgICAgICAgICB9KSB8fCB0MjsKICAgICAgICB9KSA/IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICBpZiAoIVFyKHQyKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgc3dpdGNoIChacih0MikpIHsKICAgICAgICAgICAgY2FzZSAiQXN5bmNGdW5jdGlvbiI6CiAgICAgICAgICAgIGNhc2UgIkdlbmVyYXRvckZ1bmN0aW9uIjoKICAgICAgICAgICAgY2FzZSAiQXN5bmNHZW5lcmF0b3JGdW5jdGlvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGFpIHx8ICEhbmkoaWksIHRpKHQyKSk7CiAgICAgICAgfSA6IG9pLCBoaSA9IHIsIHBpID0gSXIsIGNpID0gdWksIGxpID0gaiwgZGkgPSBKdCgic3BlY2llcyIpLCBEaSA9IGhpLkFycmF5LCBtaSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICB2YXIgZTI7CiAgICAgICAgICByZXR1cm4gcGkodDIpICYmIChlMiA9IHQyLmNvbnN0cnVjdG9yLCAoY2koZTIpICYmIChlMiA9PT0gRGkgfHwgcGkoZTIucHJvdG90eXBlKSkgfHwgbGkoZTIpICYmIChlMiA9IGUyW2RpXSkgPT09IG51bGwpICYmIChlMiA9IHZvaWQgMCkpLCBlMiA9PT0gdm9pZCAwID8gRGkgOiBlMjsKICAgICAgICB9LCBmaSA9IF9yLCB5aSA9IGR0LCBFaSA9IE50LCBBaSA9IFZzLCBDaSA9IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgcmV0dXJuIG5ldyAobWkodDIpKShlMiA9PT0gMCA/IDAgOiBlMik7CiAgICAgICAgfTsKICAgICAgICBCcih7IHRhcmdldDogIkFycmF5IiwgcHJvdG86IHRydWUgfSwgeyBmbGF0TWFwOiBmdW5jdGlvbih0MikgewogICAgICAgICAgdmFyIGUyLCBzMiA9IEVpKHRoaXMpLCByMiA9IEFpKHMyKTsKICAgICAgICAgIHJldHVybiB5aSh0MiksIChlMiA9IENpKHMyLCAwKSkubGVuZ3RoID0gZmkoZTIsIHMyLCBzMiwgcjIsIDAsIDEsIHQyLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHZvaWQgMCksIGUyOwogICAgICAgIH0gfSk7CiAgICAgICAgdmFyIHhpID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBsZXQgdDI7CiAgICAgICAgICBmb3IgKHZhciBlMiA9IGFyZ3VtZW50cy5sZW5ndGgsIHMyID0gbmV3IEFycmF5KGUyKSwgcjIgPSAwOyByMiA8IGUyOyByMisrKQogICAgICAgICAgICBzMltyMl0gPSBhcmd1bWVudHNbcjJdOwogICAgICAgICAgZm9yIChjb25zdCBbZTMsIHIzXSBvZiBzMi5lbnRyaWVzKCkpCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsgcmVzdWx0OiByMygpIH07CiAgICAgICAgICAgIH0gY2F0Y2ggKHMzKSB7CiAgICAgICAgICAgICAgZTMgPT09IDAgJiYgKHQyID0gczMpOwogICAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4geyBlcnJvcjogdDIgfTsKICAgICAgICB9LCBGaSA9IHsgZXhwb3J0czoge30gfTsKICAgICAgICBjb25zdCBnaSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgbGV0IHsgb25seUZpcnN0OiB0MiA9IGZhbHNlIH0gPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICAgICAgY29uc3QgZTIgPSBbIltcXHUwMDFCXFx1MDA5Ql1bW1xcXSgpIzs/XSooPzooPzooPzooPzo7Wy1hLXpBLVpcXGRcXC8jJi46PT8lQH5fXSspKnxbYS16QS1aXFxkXSsoPzo7Wy1hLXpBLVpcXGRcXC8jJi46PT8lQH5fXSopKik/XFx1MDAwNykiLCAiKD86KD86XFxkezEsNH0oPzo7XFxkezAsNH0pKik/W1xcZEEtUFItVFpjZi1udHFyeT0+PH5dKSkiXS5qb2luKCJ8Iik7CiAgICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cChlMiwgdDIgPyB2b2lkIDAgOiAiZyIpOwogICAgICAgIH07CiAgICAgICAgdmFyIFBpID0geyBleHBvcnRzOiB7fSB9OwogICAgICAgIGNvbnN0IFRpID0gKHQyKSA9PiAhTnVtYmVyLmlzTmFOKHQyKSAmJiAodDIgPj0gNDM1MiAmJiAodDIgPD0gNDQ0NyB8fCB0MiA9PT0gOTAwMSB8fCB0MiA9PT0gOTAwMiB8fCAxMTkwNCA8PSB0MiAmJiB0MiA8PSAxMjg3MSAmJiB0MiAhPT0gMTIzNTEgfHwgMTI4ODAgPD0gdDIgJiYgdDIgPD0gMTk5MDMgfHwgMTk5NjggPD0gdDIgJiYgdDIgPD0gNDIxODIgfHwgNDMzNjAgPD0gdDIgJiYgdDIgPD0gNDMzODggfHwgNDQwMzIgPD0gdDIgJiYgdDIgPD0gNTUyMDMgfHwgNjM3NDQgPD0gdDIgJiYgdDIgPD0gNjQyNTUgfHwgNjUwNDAgPD0gdDIgJiYgdDIgPD0gNjUwNDkgfHwgNjUwNzIgPD0gdDIgJiYgdDIgPD0gNjUxMzEgfHwgNjUyODEgPD0gdDIgJiYgdDIgPD0gNjUzNzYgfHwgNjU1MDQgPD0gdDIgJiYgdDIgPD0gNjU1MTAgfHwgMTEwNTkyIDw9IHQyICYmIHQyIDw9IDExMDU5MyB8fCAxMjc0ODggPD0gdDIgJiYgdDIgPD0gMTI3NTY5IHx8IDEzMTA3MiA8PSB0MiAmJiB0MiA8PSAyNjIxNDEpKTsKICAgICAgICBQaS5leHBvcnRzID0gVGksIFBpLmV4cG9ydHMuZGVmYXVsdCA9IFRpOwogICAgICAgIGNvbnN0IGJpID0gKHQyKSA9PiB0eXBlb2YgdDIgPT0gInN0cmluZyIgPyB0Mi5yZXBsYWNlKGdpKCksICIiKSA6IHQyLCBTaSA9IFBpLmV4cG9ydHMsIHdpID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gL1x1RDgzQ1x1REZGNFx1REI0MFx1REM2N1x1REI0MFx1REM2Mig/Olx1REI0MFx1REM2NVx1REI0MFx1REM2RVx1REI0MFx1REM2N3xcdURCNDBcdURDNzNcdURCNDBcdURDNjNcdURCNDBcdURDNzR8XHVEQjQwXHVEQzc3XHVEQjQwXHVEQzZDXHVEQjQwXHVEQzczKVx1REI0MFx1REM3RnxcdUQ4M0RcdURDNjgoPzpcdUQ4M0NcdURGRkNcdTIwMEQoPzpcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0RcdURDNjhcdUQ4M0NcdURGRkJ8XHVEODNDW1x1REYzRVx1REY3M1x1REY5M1x1REZBNFx1REZBOFx1REZFQlx1REZFRF18XHVEODNEW1x1RENCQlx1RENCQ1x1REQyN1x1REQyQ1x1REU4MFx1REU5Ml18XHVEODNFW1x1RERBRi1cdUREQjNcdUREQkNcdUREQkRdKXxcdUQ4M0NcdURGRkZcdTIwMEQoPzpcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0RcdURDNjgoPzpcdUQ4M0NbXHVERkZCLVx1REZGRV0pfFx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSl8XHVEODNDXHVERkZFXHUyMDBEKD86XHVEODNFXHVERDFEXHUyMDBEXHVEODNEXHVEQzY4KD86XHVEODNDW1x1REZGQi1cdURGRkRdKXxcdUQ4M0NbXHVERjNFXHVERjczXHVERjkzXHVERkE0XHVERkE4XHVERkVCXHVERkVEXXxcdUQ4M0RbXHVEQ0JCXHVEQ0JDXHVERDI3XHVERDJDXHVERTgwXHVERTkyXXxcdUQ4M0VbXHVEREFGLVx1RERCM1x1RERCQ1x1RERCRF0pfFx1RDgzQ1x1REZGRFx1MjAwRCg/Olx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRFx1REM2OCg/Olx1RDgzQ1tcdURGRkJcdURGRkNdKXxcdUQ4M0NbXHVERjNFXHVERjczXHVERjkzXHVERkE0XHVERkE4XHVERkVCXHVERkVEXXxcdUQ4M0RbXHVEQ0JCXHVEQ0JDXHVERDI3XHVERDJDXHVERTgwXHVERTkyXXxcdUQ4M0VbXHVEREFGLVx1RERCM1x1RERCQ1x1RERCRF0pfFx1MjAwRCg/Olx1Mjc2NFx1RkUwRlx1MjAwRCg/Olx1RDgzRFx1REM4Qlx1MjAwRCk/XHVEODNEXHVEQzY4fCg/Olx1RDgzRFtcdURDNjhcdURDNjldKVx1MjAwRCg/Olx1RDgzRFx1REM2Nlx1MjAwRFx1RDgzRFx1REM2NnxcdUQ4M0RcdURDNjdcdTIwMEQoPzpcdUQ4M0RbXHVEQzY2XHVEQzY3XSkpfFx1RDgzRFx1REM2Nlx1MjAwRFx1RDgzRFx1REM2NnxcdUQ4M0RcdURDNjdcdTIwMEQoPzpcdUQ4M0RbXHVEQzY2XHVEQzY3XSl8KD86XHVEODNEW1x1REM2OFx1REM2OV0pXHUyMDBEKD86XHVEODNEW1x1REM2Nlx1REM2N10pfFtcdTI2OTVcdTI2OTZcdTI3MDhdXHVGRTBGfFx1RDgzRFtcdURDNjZcdURDNjddfFx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSl8KD86XHVEODNDXHVERkZCXHUyMDBEW1x1MjY5NVx1MjY5Nlx1MjcwOF18XHVEODNDXHVERkZGXHUyMDBEW1x1MjY5NVx1MjY5Nlx1MjcwOF18XHVEODNDXHVERkZFXHUyMDBEW1x1MjY5NVx1MjY5Nlx1MjcwOF18XHVEODNDXHVERkZEXHUyMDBEW1x1MjY5NVx1MjY5Nlx1MjcwOF18XHVEODNDXHVERkZDXHUyMDBEW1x1MjY5NVx1MjY5Nlx1MjcwOF0pXHVGRTBGfFx1RDgzQ1x1REZGQlx1MjAwRCg/Olx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSl8XHVEODNDW1x1REZGQi1cdURGRkZdKXwoPzpcdUQ4M0VcdURERDFcdUQ4M0NcdURGRkJcdTIwMERcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0VcdURERDF8XHVEODNEXHVEQzY5XHVEODNDXHVERkZDXHUyMDBEXHVEODNFXHVERDFEXHUyMDBEXHVEODNEXHVEQzY5KVx1RDgzQ1x1REZGQnxcdUQ4M0VcdURERDEoPzpcdUQ4M0NcdURGRkZcdTIwMERcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0VcdURERDEoPzpcdUQ4M0NbXHVERkZCLVx1REZGRl0pfFx1MjAwRFx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRVx1REREMSl8KD86XHVEODNFXHVEREQxXHVEODNDXHVERkZFXHUyMDBEXHVEODNFXHVERDFEXHUyMDBEXHVEODNFXHVEREQxfFx1RDgzRFx1REM2OVx1RDgzQ1x1REZGRlx1MjAwRFx1RDgzRVx1REQxRFx1MjAwRCg/Olx1RDgzRFtcdURDNjhcdURDNjldKSkoPzpcdUQ4M0NbXHVERkZCLVx1REZGRV0pfCg/Olx1RDgzRVx1REREMVx1RDgzQ1x1REZGQ1x1MjAwRFx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRVx1REREMXxcdUQ4M0RcdURDNjlcdUQ4M0NcdURGRkRcdTIwMERcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0RcdURDNjkpKD86XHVEODNDW1x1REZGQlx1REZGQ10pfFx1RDgzRFx1REM2OSg/Olx1RDgzQ1x1REZGRVx1MjAwRCg/Olx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRFx1REM2OCg/Olx1RDgzQ1tcdURGRkItXHVERkZEXHVERkZGXSl8XHVEODNDW1x1REYzRVx1REY3M1x1REY5M1x1REZBNFx1REZBOFx1REZFQlx1REZFRF18XHVEODNEW1x1RENCQlx1RENCQ1x1REQyN1x1REQyQ1x1REU4MFx1REU5Ml18XHVEODNFW1x1RERBRi1cdUREQjNcdUREQkNcdUREQkRdKXxcdUQ4M0NcdURGRkNcdTIwMEQoPzpcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0RcdURDNjgoPzpcdUQ4M0NbXHVERkZCXHVERkZELVx1REZGRl0pfFx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSl8XHVEODNDXHVERkZCXHUyMDBEKD86XHVEODNFXHVERDFEXHUyMDBEXHVEODNEXHVEQzY4KD86XHVEODNDW1x1REZGQy1cdURGRkZdKXxcdUQ4M0NbXHVERjNFXHVERjczXHVERjkzXHVERkE0XHVERkE4XHVERkVCXHVERkVEXXxcdUQ4M0RbXHVEQ0JCXHVEQ0JDXHVERDI3XHVERDJDXHVERTgwXHVERTkyXXxcdUQ4M0VbXHVEREFGLVx1RERCM1x1RERCQ1x1RERCRF0pfFx1RDgzQ1x1REZGRFx1MjAwRCg/Olx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRFx1REM2OCg/Olx1RDgzQ1tcdURGRkJcdURGRkNcdURGRkVcdURGRkZdKXxcdUQ4M0NbXHVERjNFXHVERjczXHVERjkzXHVERkE0XHVERkE4XHVERkVCXHVERkVEXXxcdUQ4M0RbXHVEQ0JCXHVEQ0JDXHVERDI3XHVERDJDXHVERTgwXHVERTkyXXxcdUQ4M0VbXHVEREFGLVx1RERCM1x1RERCQ1x1RERCRF0pfFx1MjAwRCg/Olx1Mjc2NFx1RkUwRlx1MjAwRCg/Olx1RDgzRFx1REM4Qlx1MjAwRCg/Olx1RDgzRFtcdURDNjhcdURDNjldKXxcdUQ4M0RbXHVEQzY4XHVEQzY5XSl8XHVEODNDW1x1REYzRVx1REY3M1x1REY5M1x1REZBNFx1REZBOFx1REZFQlx1REZFRF18XHVEODNEW1x1RENCQlx1RENCQ1x1REQyN1x1REQyQ1x1REU4MFx1REU5Ml18XHVEODNFW1x1RERBRi1cdUREQjNcdUREQkNcdUREQkRdKXxcdUQ4M0NcdURGRkZcdTIwMEQoPzpcdUQ4M0NbXHVERjNFXHVERjczXHVERjkzXHVERkE0XHVERkE4XHVERkVCXHVERkVEXXxcdUQ4M0RbXHVEQ0JCXHVEQ0JDXHVERDI3XHVERDJDXHVERTgwXHVERTkyXXxcdUQ4M0VbXHVEREFGLVx1RERCM1x1RERCQ1x1RERCRF0pKXxcdUQ4M0RcdURDNjlcdTIwMERcdUQ4M0RcdURDNjlcdTIwMEQoPzpcdUQ4M0RcdURDNjZcdTIwMERcdUQ4M0RcdURDNjZ8XHVEODNEXHVEQzY3XHUyMDBEKD86XHVEODNEW1x1REM2Nlx1REM2N10pKXwoPzpcdUQ4M0VcdURERDFcdUQ4M0NcdURGRkRcdTIwMERcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0VcdURERDF8XHVEODNEXHVEQzY5XHVEODNDXHVERkZFXHUyMDBEXHVEODNFXHVERDFEXHUyMDBEXHVEODNEXHVEQzY5KSg/Olx1RDgzQ1tcdURGRkItXHVERkZEXSl8XHVEODNEXHVEQzY5XHUyMDBEXHVEODNEXHVEQzY2XHUyMDBEXHVEODNEXHVEQzY2fFx1RDgzRFx1REM2OVx1MjAwRFx1RDgzRFx1REM2OVx1MjAwRCg/Olx1RDgzRFtcdURDNjZcdURDNjddKXwoPzpcdUQ4M0RcdURDNDFcdUZFMEZcdTIwMERcdUQ4M0RcdURERTh8XHVEODNEXHVEQzY5KD86XHVEODNDXHVERkZGXHUyMDBEW1x1MjY5NVx1MjY5Nlx1MjcwOF18XHVEODNDXHVERkZFXHUyMDBEW1x1MjY5NVx1MjY5Nlx1MjcwOF18XHVEODNDXHVERkZDXHUyMDBEW1x1MjY5NVx1MjY5Nlx1MjcwOF18XHVEODNDXHVERkZCXHUyMDBEW1x1MjY5NVx1MjY5Nlx1MjcwOF18XHVEODNDXHVERkZEXHUyMDBEW1x1MjY5NVx1MjY5Nlx1MjcwOF18XHUyMDBEW1x1MjY5NVx1MjY5Nlx1MjcwOF0pfCg/Oig/Olx1MjZGOXxcdUQ4M0NbXHVERkNCXHVERkNDXXxcdUQ4M0RcdURENzUpXHVGRTBGfFx1RDgzRFx1REM2RnxcdUQ4M0VbXHVERDNDXHVERERFXHVERERGXSlcdTIwMERbXHUyNjQwXHUyNjQyXXwoPzpcdTI2Rjl8XHVEODNDW1x1REZDQlx1REZDQ118XHVEODNEXHVERDc1KSg/Olx1RDgzQ1tcdURGRkItXHVERkZGXSlcdTIwMERbXHUyNjQwXHUyNjQyXXwoPzpcdUQ4M0NbXHVERkMzXHVERkM0XHVERkNBXXxcdUQ4M0RbXHVEQzZFXHVEQzcxXHVEQzczXHVEQzc3XHVEQzgxXHVEQzgyXHVEQzg2XHVEQzg3XHVERTQ1LVx1REU0N1x1REU0Qlx1REU0RFx1REU0RVx1REVBM1x1REVCNC1cdURFQjZdfFx1RDgzRVtcdUREMjZcdUREMzctXHVERDM5XHVERDNEXHVERDNFXHVEREI4XHVEREI5XHVERENELVx1RERDRlx1RERENi1cdURERERdKSg/Oig/Olx1RDgzQ1tcdURGRkItXHVERkZGXSlcdTIwMERbXHUyNjQwXHUyNjQyXXxcdTIwMERbXHUyNjQwXHUyNjQyXSl8XHVEODNDXHVERkY0XHUyMDBEXHUyNjIwKVx1RkUwRnxcdUQ4M0RcdURDNjlcdTIwMERcdUQ4M0RcdURDNjdcdTIwMEQoPzpcdUQ4M0RbXHVEQzY2XHVEQzY3XSl8XHVEODNDXHVERkYzXHVGRTBGXHUyMDBEXHVEODNDXHVERjA4fFx1RDgzRFx1REMxNVx1MjAwRFx1RDgzRVx1RERCQXxcdUQ4M0RcdURDNjlcdTIwMERcdUQ4M0RcdURDNjZ8XHVEODNEXHVEQzY5XHUyMDBEXHVEODNEXHVEQzY3fFx1RDgzQ1x1RERGRFx1RDgzQ1x1RERGMHxcdUQ4M0NcdURERjRcdUQ4M0NcdURERjJ8XHVEODNDXHVEREY2XHVEODNDXHVEREU2fFsjXCowLTldXHVGRTBGXHUyMEUzfFx1RDgzQ1x1RERFNyg/Olx1RDgzQ1tcdURERTZcdURERTdcdURERTktXHVEREVGXHVEREYxLVx1RERGNFx1RERGNi1cdURERjlcdURERkJcdURERkNcdURERkVcdURERkZdKXxcdUQ4M0NcdURERjkoPzpcdUQ4M0NbXHVEREU2XHVEREU4XHVEREU5XHVEREVCLVx1RERFRFx1RERFRi1cdURERjRcdURERjdcdURERjlcdURERkJcdURERkNcdURERkZdKXxcdUQ4M0NcdURERUEoPzpcdUQ4M0NbXHVEREU2XHVEREU4XHVEREVBXHVEREVDXHVEREVEXHVEREY3LVx1RERGQV0pfFx1RDgzRVx1REREMSg/Olx1RDgzQ1tcdURGRkItXHVERkZGXSl8XHVEODNDXHVEREY3KD86XHVEODNDW1x1RERFQVx1RERGNFx1RERGOFx1RERGQVx1RERGQ10pfFx1RDgzRFx1REM2OSg/Olx1RDgzQ1tcdURGRkItXHVERkZGXSl8XHVEODNDXHVEREYyKD86XHVEODNDW1x1RERFNlx1RERFOC1cdURERURcdURERjAtXHVEREZGXSl8XHVEODNDXHVEREU2KD86XHVEODNDW1x1RERFOC1cdURERUNcdURERUVcdURERjFcdURERjJcdURERjRcdURERjYtXHVEREZBXHVEREZDXHVEREZEXHVEREZGXSl8XHVEODNDXHVEREYwKD86XHVEODNDW1x1RERFQVx1RERFQy1cdURERUVcdURERjJcdURERjNcdURERjVcdURERjdcdURERkNcdURERkVcdURERkZdKXxcdUQ4M0NcdURERUQoPzpcdUQ4M0NbXHVEREYwXHVEREYyXHVEREYzXHVEREY3XHVEREY5XHVEREZBXSl8XHVEODNDXHVEREU5KD86XHVEODNDW1x1RERFQVx1RERFQ1x1RERFRlx1RERGMFx1RERGMlx1RERGNFx1RERGRl0pfFx1RDgzQ1x1RERGRSg/Olx1RDgzQ1tcdURERUFcdURERjldKXxcdUQ4M0NcdURERUMoPzpcdUQ4M0NbXHVEREU2XHVEREU3XHVEREU5LVx1RERFRVx1RERGMS1cdURERjNcdURERjUtXHVEREZBXHVEREZDXHVEREZFXSl8XHVEODNDXHVEREY4KD86XHVEODNDW1x1RERFNi1cdURERUFcdURERUMtXHVEREY0XHVEREY3LVx1RERGOVx1RERGQlx1RERGRC1cdURERkZdKXxcdUQ4M0NcdURERUIoPzpcdUQ4M0NbXHVEREVFLVx1RERGMFx1RERGMlx1RERGNFx1RERGN10pfFx1RDgzQ1x1RERGNSg/Olx1RDgzQ1tcdURERTZcdURERUEtXHVEREVEXHVEREYwLVx1RERGM1x1RERGNy1cdURERjlcdURERkNcdURERkVdKXxcdUQ4M0NcdURERkIoPzpcdUQ4M0NbXHVEREU2XHVEREU4XHVEREVBXHVEREVDXHVEREVFXHVEREYzXHVEREZBXSl8XHVEODNDXHVEREYzKD86XHVEODNDW1x1RERFNlx1RERFOFx1RERFQS1cdURERUNcdURERUVcdURERjFcdURERjRcdURERjVcdURERjdcdURERkFcdURERkZdKXxcdUQ4M0NcdURERTgoPzpcdUQ4M0NbXHVEREU2XHVEREU4XHVEREU5XHVEREVCLVx1RERFRVx1RERGMC1cdURERjVcdURERjdcdURERkEtXHVEREZGXSl8XHVEODNDXHVEREYxKD86XHVEODNDW1x1RERFNi1cdURERThcdURERUVcdURERjBcdURERjctXHVEREZCXHVEREZFXSl8XHVEODNDXHVEREZGKD86XHVEODNDW1x1RERFNlx1RERGMlx1RERGQ10pfFx1RDgzQ1x1RERGQyg/Olx1RDgzQ1tcdURERUJcdURERjhdKXxcdUQ4M0NcdURERkEoPzpcdUQ4M0NbXHVEREU2XHVEREVDXHVEREYyXHVEREYzXHVEREY4XHVEREZFXHVEREZGXSl8XHVEODNDXHVEREVFKD86XHVEODNDW1x1RERFOC1cdURERUFcdURERjEtXHVEREY0XHVEREY2LVx1RERGOV0pfFx1RDgzQ1x1RERFRig/Olx1RDgzQ1tcdURERUFcdURERjJcdURERjRcdURERjVdKXwoPzpcdUQ4M0NbXHVERkMzXHVERkM0XHVERkNBXXxcdUQ4M0RbXHVEQzZFXHVEQzcxXHVEQzczXHVEQzc3XHVEQzgxXHVEQzgyXHVEQzg2XHVEQzg3XHVERTQ1LVx1REU0N1x1REU0Qlx1REU0RFx1REU0RVx1REVBM1x1REVCNC1cdURFQjZdfFx1RDgzRVtcdUREMjZcdUREMzctXHVERDM5XHVERDNEXHVERDNFXHVEREI4XHVEREI5XHVERENELVx1RERDRlx1RERENi1cdURERERdKSg/Olx1RDgzQ1tcdURGRkItXHVERkZGXSl8KD86XHUyNkY5fFx1RDgzQ1tcdURGQ0JcdURGQ0NdfFx1RDgzRFx1REQ3NSkoPzpcdUQ4M0NbXHVERkZCLVx1REZGRl0pfCg/OltcdTI2MURcdTI3MEEtXHUyNzBEXXxcdUQ4M0NbXHVERjg1XHVERkMyXHVERkM3XXxcdUQ4M0RbXHVEQzQyXHVEQzQzXHVEQzQ2LVx1REM1MFx1REM2Nlx1REM2N1x1REM2Qi1cdURDNkRcdURDNzBcdURDNzJcdURDNzQtXHVEQzc2XHVEQzc4XHVEQzdDXHVEQzgzXHVEQzg1XHVEQ0FBXHVERDc0XHVERDdBXHVERDkwXHVERDk1XHVERDk2XHVERTRDXHVERTRGXHVERUMwXHVERUNDXXxcdUQ4M0VbXHVERDBGXHVERDE4LVx1REQxQ1x1REQxRVx1REQxRlx1REQzMC1cdUREMzZcdUREQjVcdUREQjZcdUREQkJcdURERDItXHVEREQ1XSkoPzpcdUQ4M0NbXHVERkZCLVx1REZGRl0pfCg/OltcdTIzMUFcdTIzMUJcdTIzRTktXHUyM0VDXHUyM0YwXHUyM0YzXHUyNUZEXHUyNUZFXHUyNjE0XHUyNjE1XHUyNjQ4LVx1MjY1M1x1MjY3Rlx1MjY5M1x1MjZBMVx1MjZBQVx1MjZBQlx1MjZCRFx1MjZCRVx1MjZDNFx1MjZDNVx1MjZDRVx1MjZENFx1MjZFQVx1MjZGMlx1MjZGM1x1MjZGNVx1MjZGQVx1MjZGRFx1MjcwNVx1MjcwQVx1MjcwQlx1MjcyOFx1Mjc0Q1x1Mjc0RVx1Mjc1My1cdTI3NTVcdTI3NTdcdTI3OTUtXHUyNzk3XHUyN0IwXHUyN0JGXHUyQjFCXHUyQjFDXHUyQjUwXHUyQjU1XXxcdUQ4M0NbXHVEQzA0XHVEQ0NGXHVERDhFXHVERDkxLVx1REQ5QVx1RERFNi1cdURERkZcdURFMDFcdURFMUFcdURFMkZcdURFMzItXHVERTM2XHVERTM4LVx1REUzQVx1REU1MFx1REU1MVx1REYwMC1cdURGMjBcdURGMkQtXHVERjM1XHVERjM3LVx1REY3Q1x1REY3RS1cdURGOTNcdURGQTAtXHVERkNBXHVERkNGLVx1REZEM1x1REZFMC1cdURGRjBcdURGRjRcdURGRjgtXHVERkZGXXxcdUQ4M0RbXHVEQzAwLVx1REMzRVx1REM0MFx1REM0Mi1cdURDRkNcdURDRkYtXHVERDNEXHVERDRCLVx1REQ0RVx1REQ1MC1cdURENjdcdUREN0FcdUREOTVcdUREOTZcdUREQTRcdURERkItXHVERTRGXHVERTgwLVx1REVDNVx1REVDQ1x1REVEMC1cdURFRDJcdURFRDVcdURFRUJcdURFRUNcdURFRjQtXHVERUZBXHVERkUwLVx1REZFQl18XHVEODNFW1x1REQwRC1cdUREM0FcdUREM0MtXHVERDQ1XHVERDQ3LVx1REQ3MVx1REQ3My1cdURENzZcdUREN0EtXHVEREEyXHVEREE1LVx1RERBQVx1RERBRS1cdUREQ0FcdUREQ0QtXHVEREZGXHVERTcwLVx1REU3M1x1REU3OC1cdURFN0FcdURFODAtXHVERTgyXHVERTkwLVx1REU5NV0pfCg/OlsjXCowLTlceEE5XHhBRVx1MjAzQ1x1MjA0OVx1MjEyMlx1MjEzOVx1MjE5NC1cdTIxOTlcdTIxQTlcdTIxQUFcdTIzMUFcdTIzMUJcdTIzMjhcdTIzQ0ZcdTIzRTktXHUyM0YzXHUyM0Y4LVx1MjNGQVx1MjRDMlx1MjVBQVx1MjVBQlx1MjVCNlx1MjVDMFx1MjVGQi1cdTI1RkVcdTI2MDAtXHUyNjA0XHUyNjBFXHUyNjExXHUyNjE0XHUyNjE1XHUyNjE4XHUyNjFEXHUyNjIwXHUyNjIyXHUyNjIzXHUyNjI2XHUyNjJBXHUyNjJFXHUyNjJGXHUyNjM4LVx1MjYzQVx1MjY0MFx1MjY0Mlx1MjY0OC1cdTI2NTNcdTI2NUZcdTI2NjBcdTI2NjNcdTI2NjVcdTI2NjZcdTI2NjhcdTI2N0JcdTI2N0VcdTI2N0ZcdTI2OTItXHUyNjk3XHUyNjk5XHUyNjlCXHUyNjlDXHUyNkEwXHUyNkExXHUyNkFBXHUyNkFCXHUyNkIwXHUyNkIxXHUyNkJEXHUyNkJFXHUyNkM0XHUyNkM1XHUyNkM4XHUyNkNFXHUyNkNGXHUyNkQxXHUyNkQzXHUyNkQ0XHUyNkU5XHUyNkVBXHUyNkYwLVx1MjZGNVx1MjZGNy1cdTI2RkFcdTI2RkRcdTI3MDJcdTI3MDVcdTI3MDgtXHUyNzBEXHUyNzBGXHUyNzEyXHUyNzE0XHUyNzE2XHUyNzFEXHUyNzIxXHUyNzI4XHUyNzMzXHUyNzM0XHUyNzQ0XHUyNzQ3XHUyNzRDXHUyNzRFXHUyNzUzLVx1Mjc1NVx1Mjc1N1x1Mjc2M1x1Mjc2NFx1Mjc5NS1cdTI3OTdcdTI3QTFcdTI3QjBcdTI3QkZcdTI5MzRcdTI5MzVcdTJCMDUtXHUyQjA3XHUyQjFCXHUyQjFDXHUyQjUwXHUyQjU1XHUzMDMwXHUzMDNEXHUzMjk3XHUzMjk5XXxcdUQ4M0NbXHVEQzA0XHVEQ0NGXHVERDcwXHVERDcxXHVERDdFXHVERDdGXHVERDhFXHVERDkxLVx1REQ5QVx1RERFNi1cdURERkZcdURFMDFcdURFMDJcdURFMUFcdURFMkZcdURFMzItXHVERTNBXHVERTUwXHVERTUxXHVERjAwLVx1REYyMVx1REYyNC1cdURGOTNcdURGOTZcdURGOTdcdURGOTktXHVERjlCXHVERjlFLVx1REZGMFx1REZGMy1cdURGRjVcdURGRjctXHVERkZGXXxcdUQ4M0RbXHVEQzAwLVx1RENGRFx1RENGRi1cdUREM0RcdURENDktXHVERDRFXHVERDUwLVx1REQ2N1x1REQ2Rlx1REQ3MFx1REQ3My1cdUREN0FcdUREODdcdUREOEEtXHVERDhEXHVERDkwXHVERDk1XHVERDk2XHVEREE0XHVEREE1XHVEREE4XHVEREIxXHVEREIyXHVEREJDXHVEREMyLVx1RERDNFx1REREMS1cdURERDNcdUREREMtXHVERERFXHVEREUxXHVEREUzXHVEREU4XHVEREVGXHVEREYzXHVEREZBLVx1REU0Rlx1REU4MC1cdURFQzVcdURFQ0ItXHVERUQyXHVERUQ1XHVERUUwLVx1REVFNVx1REVFOVx1REVFQlx1REVFQ1x1REVGMFx1REVGMy1cdURFRkFcdURGRTAtXHVERkVCXXxcdUQ4M0VbXHVERDBELVx1REQzQVx1REQzQy1cdURENDVcdURENDctXHVERDcxXHVERDczLVx1REQ3Nlx1REQ3QS1cdUREQTJcdUREQTUtXHVEREFBXHVEREFFLVx1RERDQVx1RERDRC1cdURERkZcdURFNzAtXHVERTczXHVERTc4LVx1REU3QVx1REU4MC1cdURFODJcdURFOTAtXHVERTk1XSlcdUZFMEZ8KD86W1x1MjYxRFx1MjZGOVx1MjcwQS1cdTI3MERdfFx1RDgzQ1tcdURGODVcdURGQzItXHVERkM0XHVERkM3XHVERkNBLVx1REZDQ118XHVEODNEW1x1REM0Mlx1REM0M1x1REM0Ni1cdURDNTBcdURDNjYtXHVEQzc4XHVEQzdDXHVEQzgxLVx1REM4M1x1REM4NS1cdURDODdcdURDOEZcdURDOTFcdURDQUFcdURENzRcdURENzVcdUREN0FcdUREOTBcdUREOTVcdUREOTZcdURFNDUtXHVERTQ3XHVERTRCLVx1REU0Rlx1REVBM1x1REVCNC1cdURFQjZcdURFQzBcdURFQ0NdfFx1RDgzRVtcdUREMEZcdUREMTgtXHVERDFGXHVERDI2XHVERDMwLVx1REQzOVx1REQzQy1cdUREM0VcdUREQjVcdUREQjZcdUREQjhcdUREQjlcdUREQkJcdUREQ0QtXHVERENGXHVEREQxLVx1RERERF0pL2c7CiAgICAgICAgfSwgQmkgPSAodDIpID0+IHsKICAgICAgICAgIGlmICh0eXBlb2YgdDIgIT0gInN0cmluZyIgfHwgdDIubGVuZ3RoID09PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIGlmICgodDIgPSBiaSh0MikpLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICB0MiA9IHQyLnJlcGxhY2Uod2koKSwgIiAgIik7CiAgICAgICAgICBsZXQgZTIgPSAwOwogICAgICAgICAgZm9yIChsZXQgczIgPSAwOyBzMiA8IHQyLmxlbmd0aDsgczIrKykgewogICAgICAgICAgICBjb25zdCByMiA9IHQyLmNvZGVQb2ludEF0KHMyKTsKICAgICAgICAgICAgcjIgPD0gMzEgfHwgcjIgPj0gMTI3ICYmIHIyIDw9IDE1OSB8fCAocjIgPj0gNzY4ICYmIHIyIDw9IDg3OSB8fCAocjIgPiA2NTUzNSAmJiBzMisrLCBlMiArPSBTaShyMikgPyAyIDogMSkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgIH07CiAgICAgICAgRmkuZXhwb3J0cyA9IEJpLCBGaS5leHBvcnRzLmRlZmF1bHQgPSBCaTsKICAgICAgICB2YXIgTmkgPSAodDIpID0+IHQyW3QyLmxlbmd0aCAtIDFdOwogICAgICAgIGZ1bmN0aW9uIElpKHQyLCBlMikgewogICAgICAgICAgaWYgKHQyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICAgIHZhciBzMiwgcjIsIGkyID0gZnVuY3Rpb24odDMsIGUzKSB7CiAgICAgICAgICAgIGlmICh0MyA9PSBudWxsKQogICAgICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICAgICAgdmFyIHMzLCByMywgaTMgPSB7fSwgbjMgPSBPYmplY3Qua2V5cyh0Myk7CiAgICAgICAgICAgIGZvciAocjMgPSAwOyByMyA8IG4zLmxlbmd0aDsgcjMrKykKICAgICAgICAgICAgICBzMyA9IG4zW3IzXSwgZTMuaW5kZXhPZihzMykgPj0gMCB8fCAoaTNbczNdID0gdDNbczNdKTsKICAgICAgICAgICAgcmV0dXJuIGkzOwogICAgICAgICAgfSh0MiwgZTIpOwogICAgICAgICAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgICAgICAgICAgdmFyIG4yID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyh0Mik7CiAgICAgICAgICAgIGZvciAocjIgPSAwOyByMiA8IG4yLmxlbmd0aDsgcjIrKykKICAgICAgICAgICAgICBzMiA9IG4yW3IyXSwgZTIuaW5kZXhPZihzMikgPj0gMCB8fCBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwodDIsIHMyKSAmJiAoaTJbczJdID0gdDJbczJdKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdmkodDIsIGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgfHwgKGUyID0gdDIuc2xpY2UoMCkpLCBPYmplY3QuZnJlZXplKE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHQyLCB7IHJhdzogeyB2YWx1ZTogT2JqZWN0LmZyZWV6ZShlMikgfSB9KSk7CiAgICAgICAgfQogICAgICAgIHZhciBraSA9IEpyLCBMaSA9IHIuU3RyaW5nLCBPaSA9IEMoW10uc2xpY2UpLCBNaSA9IE1hdGguZmxvb3IsIFJpID0gZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICB2YXIgczIgPSB0Mi5sZW5ndGgsIHIyID0gTWkoczIgLyAyKTsKICAgICAgICAgIHJldHVybiBzMiA8IDggPyBqaSh0MiwgZTIpIDogVWkodDIsIFJpKE9pKHQyLCAwLCByMiksIGUyKSwgUmkoT2kodDIsIHIyKSwgZTIpLCBlMik7CiAgICAgICAgfSwgamkgPSBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIGZvciAodmFyIHMyLCByMiwgaTIgPSB0Mi5sZW5ndGgsIG4yID0gMTsgbjIgPCBpMjsgKSB7CiAgICAgICAgICAgIGZvciAocjIgPSBuMiwgczIgPSB0MltuMl07IHIyICYmIGUyKHQyW3IyIC0gMV0sIHMyKSA+IDA7ICkKICAgICAgICAgICAgICB0MltyMl0gPSB0MlstLXIyXTsKICAgICAgICAgICAgcjIgIT09IG4yKysgJiYgKHQyW3IyXSA9IHMyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9LCBVaSA9IGZ1bmN0aW9uKHQyLCBlMiwgczIsIHIyKSB7CiAgICAgICAgICBmb3IgKHZhciBpMiA9IGUyLmxlbmd0aCwgbjIgPSBzMi5sZW5ndGgsIGEyID0gMCwgbzIgPSAwOyBhMiA8IGkyIHx8IG8yIDwgbjI7ICkKICAgICAgICAgICAgdDJbYTIgKyBvMl0gPSBhMiA8IGkyICYmIG8yIDwgbjIgPyByMihlMlthMl0sIHMyW28yXSkgPD0gMCA/IGUyW2EyKytdIDogczJbbzIrK10gOiBhMiA8IGkyID8gZTJbYTIrK10gOiBzMltvMisrXTsKICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9LCBfaSA9IFJpLCB6aSA9IG4sIEhpID0gcS5tYXRjaCgvZmlyZWZveFwvKFxkKykvaSksIFZpID0gISFIaSAmJiArSGlbMV0sIHFpID0gL01TSUV8VHJpZGVudC8udGVzdChxKSwgV2kgPSBxLm1hdGNoKC9BcHBsZVdlYktpdFwvKFxkKylcLi8pLCBLaSA9ICEhV2kgJiYgK1dpWzFdLCBHaSA9IEJyLCBYaSA9IEMsIEppID0gZHQsICRpID0gTnQsIFlpID0gVnMsIFFpID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIGlmIChraSh0MikgPT09ICJTeW1ib2wiKQogICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBjb252ZXJ0IGEgU3ltYm9sIHZhbHVlIHRvIGEgc3RyaW5nIik7CiAgICAgICAgICByZXR1cm4gTGkodDIpOwogICAgICAgIH0sIFppID0gbiwgdG4gPSBfaSwgZW4gPSBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIHZhciBzMiA9IFtdW3QyXTsKICAgICAgICAgIHJldHVybiAhIXMyICYmIHppKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBzMi5jYWxsKG51bGwsIGUyIHx8IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHRocm93IDE7CiAgICAgICAgICAgIH0sIDEpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwgc24gPSBWaSwgcm4gPSBxaSwgbm4gPSBZLCBhbiA9IEtpLCBvbiA9IFtdLCB1biA9IFhpKG9uLnNvcnQpLCBobiA9IFhpKG9uLnB1c2gpLCBwbiA9IFppKGZ1bmN0aW9uKCkgewogICAgICAgICAgb24uc29ydCh2b2lkIDApOwogICAgICAgIH0pLCBjbiA9IFppKGZ1bmN0aW9uKCkgewogICAgICAgICAgb24uc29ydChudWxsKTsKICAgICAgICB9KSwgbG4gPSBlbigic29ydCIpLCBkbiA9ICFaaShmdW5jdGlvbigpIHsKICAgICAgICAgIGlmIChubikKICAgICAgICAgICAgcmV0dXJuIG5uIDwgNzA7CiAgICAgICAgICBpZiAoIShzbiAmJiBzbiA+IDMpKSB7CiAgICAgICAgICAgIGlmIChybikKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKGFuKQogICAgICAgICAgICAgIHJldHVybiBhbiA8IDYwMzsKICAgICAgICAgICAgdmFyIHQyLCBlMiwgczIsIHIyLCBpMiA9ICIiOwogICAgICAgICAgICBmb3IgKHQyID0gNjU7IHQyIDwgNzY7IHQyKyspIHsKICAgICAgICAgICAgICBzd2l0Y2ggKGUyID0gU3RyaW5nLmZyb21DaGFyQ29kZSh0MiksIHQyKSB7CiAgICAgICAgICAgICAgICBjYXNlIDY2OgogICAgICAgICAgICAgICAgY2FzZSA2OToKICAgICAgICAgICAgICAgIGNhc2UgNzA6CiAgICAgICAgICAgICAgICBjYXNlIDcyOgogICAgICAgICAgICAgICAgICBzMiA9IDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSA2ODoKICAgICAgICAgICAgICAgIGNhc2UgNzE6CiAgICAgICAgICAgICAgICAgIHMyID0gNDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICBzMiA9IDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZvciAocjIgPSAwOyByMiA8IDQ3OyByMisrKQogICAgICAgICAgICAgICAgb24ucHVzaCh7IGs6IGUyICsgcjIsIHY6IHMyIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAob24uc29ydChmdW5jdGlvbih0MywgZTMpIHsKICAgICAgICAgICAgICByZXR1cm4gZTMudiAtIHQzLnY7CiAgICAgICAgICAgIH0pLCByMiA9IDA7IHIyIDwgb24ubGVuZ3RoOyByMisrKQogICAgICAgICAgICAgIGUyID0gb25bcjJdLmsuY2hhckF0KDApLCBpMi5jaGFyQXQoaTIubGVuZ3RoIC0gMSkgIT09IGUyICYmIChpMiArPSBlMik7CiAgICAgICAgICAgIHJldHVybiBpMiAhPT0gIkRHQkVGSEFDSUpLIjsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBHaSh7IHRhcmdldDogIkFycmF5IiwgcHJvdG86IHRydWUsIGZvcmNlZDogcG4gfHwgIWNuIHx8ICFsbiB8fCAhZG4gfSwgeyBzb3J0OiBmdW5jdGlvbih0MikgewogICAgICAgICAgdDIgIT09IHZvaWQgMCAmJiBKaSh0Mik7CiAgICAgICAgICB2YXIgZTIgPSAkaSh0aGlzKTsKICAgICAgICAgIGlmIChkbikKICAgICAgICAgICAgcmV0dXJuIHQyID09PSB2b2lkIDAgPyB1bihlMikgOiB1bihlMiwgdDIpOwogICAgICAgICAgdmFyIHMyLCByMiwgaTIgPSBbXSwgbjIgPSBZaShlMik7CiAgICAgICAgICBmb3IgKHIyID0gMDsgcjIgPCBuMjsgcjIrKykKICAgICAgICAgICAgcjIgaW4gZTIgJiYgaG4oaTIsIGUyW3IyXSk7CiAgICAgICAgICBmb3IgKHRuKGkyLCBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTMsIHMzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHMzID09PSB2b2lkIDAgPyAtMSA6IGUzID09PSB2b2lkIDAgPyAxIDogdDMgIT09IHZvaWQgMCA/ICt0MyhlMywgczMpIHx8IDAgOiBRaShlMykgPiBRaShzMykgPyAxIDogLTE7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KHQyKSksIHMyID0gaTIubGVuZ3RoLCByMiA9IDA7IHIyIDwgczI7ICkKICAgICAgICAgICAgZTJbcjJdID0gaTJbcjIrK107CiAgICAgICAgICBmb3IgKDsgcjIgPCBuMjsgKQogICAgICAgICAgICBkZWxldGUgZTJbcjIrK107CiAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgfSB9KTsKICAgICAgICB2YXIgRG4gPSB7fSwgbW4gPSBEbiwgZm4gPSBKdCgiaXRlcmF0b3IiKSwgeW4gPSBBcnJheS5wcm90b3R5cGUsIEVuID0gSnIsIEFuID0gbXQsIENuID0gRG4sIHhuID0gSnQoIml0ZXJhdG9yIiksIEZuID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIGlmICh0MiAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gQW4odDIsIHhuKSB8fCBBbih0MiwgIkBAaXRlcmF0b3IiKSB8fCBDbltFbih0MildOwogICAgICAgIH0sIGduID0gdSwgUG4gPSBkdCwgVG4gPSBiZSwgYm4gPSBodCwgU24gPSBGbiwgd24gPSByLlR5cGVFcnJvciwgQm4gPSB1LCBObiA9IGJlLCBJbiA9IG10LCB2biA9IExyLCBrbiA9IHUsIExuID0gYmUsIE9uID0gaHQsIE1uID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiB0MiAhPT0gdm9pZCAwICYmIChtbi5BcnJheSA9PT0gdDIgfHwgeW5bZm5dID09PSB0Mik7CiAgICAgICAgfSwgUm4gPSBWcywgam4gPSBWLCBVbiA9IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgdmFyIHMyID0gYXJndW1lbnRzLmxlbmd0aCA8IDIgPyBTbih0MikgOiBlMjsKICAgICAgICAgIGlmIChQbihzMikpCiAgICAgICAgICAgIHJldHVybiBUbihnbihzMiwgdDIpKTsKICAgICAgICAgIHRocm93IHduKGJuKHQyKSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgICAgICAgfSwgX24gPSBGbiwgem4gPSBmdW5jdGlvbih0MiwgZTIsIHMyKSB7CiAgICAgICAgICB2YXIgcjIsIGkyOwogICAgICAgICAgTm4odDIpOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCEocjIgPSBJbih0MiwgInJldHVybiIpKSkgewogICAgICAgICAgICAgIGlmIChlMiA9PT0gInRocm93IikKICAgICAgICAgICAgICAgIHRocm93IHMyOwogICAgICAgICAgICAgIHJldHVybiBzMjsKICAgICAgICAgICAgfQogICAgICAgICAgICByMiA9IEJuKHIyLCB0Mik7CiAgICAgICAgICB9IGNhdGNoICh0MykgewogICAgICAgICAgICBpMiA9IHRydWUsIHIyID0gdDM7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZTIgPT09ICJ0aHJvdyIpCiAgICAgICAgICAgIHRocm93IHMyOwogICAgICAgICAgaWYgKGkyKQogICAgICAgICAgICB0aHJvdyByMjsKICAgICAgICAgIHJldHVybiBObihyMiksIHMyOwogICAgICAgIH0sIEhuID0gci5UeXBlRXJyb3IsIFZuID0gZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICB0aGlzLnN0b3BwZWQgPSB0MiwgdGhpcy5yZXN1bHQgPSBlMjsKICAgICAgICB9LCBxbiA9IFZuLnByb3RvdHlwZSwgV24gPSBhZSwgS24gPSB4ZSwgR24gPSBtLCBYbiA9IGZ1bmN0aW9uKHQyLCBlMiwgczIpIHsKICAgICAgICAgIHZhciByMiwgaTIsIG4yLCBhMiwgbzIsIHUyLCBoMiwgcDIgPSBzMiAmJiBzMi50aGF0LCBjMiA9ICEoIXMyIHx8ICFzMi5BU19FTlRSSUVTKSwgbDIgPSAhKCFzMiB8fCAhczIuSVNfSVRFUkFUT1IpLCBkMiA9ICEoIXMyIHx8ICFzMi5JTlRFUlJVUFRFRCksIEQyID0gdm4oZTIsIHAyKSwgbTIgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gcjIgJiYgem4ocjIsICJub3JtYWwiLCB0MyksIG5ldyBWbih0cnVlLCB0Myk7CiAgICAgICAgICB9LCBmMiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiBjMiA/IChMbih0MyksIGQyID8gRDIodDNbMF0sIHQzWzFdLCBtMikgOiBEMih0M1swXSwgdDNbMV0pKSA6IGQyID8gRDIodDMsIG0yKSA6IEQyKHQzKTsKICAgICAgICAgIH07CiAgICAgICAgICBpZiAobDIpCiAgICAgICAgICAgIHIyID0gdDI7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKCEoaTIgPSBfbih0MikpKQogICAgICAgICAgICAgIHRocm93IEhuKE9uKHQyKSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgICAgICAgICAgIGlmIChNbihpMikpIHsKICAgICAgICAgICAgICBmb3IgKG4yID0gMCwgYTIgPSBSbih0Mik7IGEyID4gbjI7IG4yKyspCiAgICAgICAgICAgICAgICBpZiAoKG8yID0gZjIodDJbbjJdKSkgJiYgam4ocW4sIG8yKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIG8yOwogICAgICAgICAgICAgIHJldHVybiBuZXcgVm4oZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHIyID0gVW4odDIsIGkyKTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAodTIgPSByMi5uZXh0OyAhKGgyID0ga24odTIsIHIyKSkuZG9uZTsgKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgbzIgPSBmMihoMi52YWx1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKHQzKSB7CiAgICAgICAgICAgICAgem4ocjIsICJ0aHJvdyIsIHQzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZW9mIG8yID09ICJvYmplY3QiICYmIG8yICYmIGpuKHFuLCBvMikpCiAgICAgICAgICAgICAgcmV0dXJuIG8yOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5ldyBWbihmYWxzZSk7CiAgICAgICAgfSwgSm4gPSBmdW5jdGlvbih0MiwgZTIsIHMyKSB7CiAgICAgICAgICB2YXIgcjIgPSBXbihlMik7CiAgICAgICAgICByMiBpbiB0MiA/IEtuLmYodDIsIHIyLCBHbigwLCBzMikpIDogdDJbcjJdID0gczI7CiAgICAgICAgfTsKICAgICAgICBCcih7IHRhcmdldDogIk9iamVjdCIsIHN0YXQ6IHRydWUgfSwgeyBmcm9tRW50cmllczogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHZhciBlMiA9IHt9OwogICAgICAgICAgcmV0dXJuIFhuKHQyLCBmdW5jdGlvbih0MywgczIpIHsKICAgICAgICAgICAgSm4oZTIsIHQzLCBzMik7CiAgICAgICAgICB9LCB7IEFTX0VOVFJJRVM6IHRydWUgfSksIGUyOwogICAgICAgIH0gfSk7CiAgICAgICAgdmFyICRuID0gJG4gIT09IHZvaWQgMCA/ICRuIDogdHlwZW9mIHNlbGYgIT0gInVuZGVmaW5lZCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHt9OwogICAgICAgIGZ1bmN0aW9uIFluKCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJzZXRUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFFuKCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQiKTsKICAgICAgICB9CiAgICAgICAgdmFyIFpuID0gWW4sIHRhID0gUW47CiAgICAgICAgZnVuY3Rpb24gZWEodDIpIHsKICAgICAgICAgIGlmIChabiA9PT0gc2V0VGltZW91dCkKICAgICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQodDIsIDApOwogICAgICAgICAgaWYgKChabiA9PT0gWW4gfHwgIVpuKSAmJiBzZXRUaW1lb3V0KQogICAgICAgICAgICByZXR1cm4gWm4gPSBzZXRUaW1lb3V0LCBzZXRUaW1lb3V0KHQyLCAwKTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBabih0MiwgMCk7CiAgICAgICAgICB9IGNhdGNoIChlMikgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBabi5jYWxsKG51bGwsIHQyLCAwKTsKICAgICAgICAgICAgfSBjYXRjaCAoZTMpIHsKICAgICAgICAgICAgICByZXR1cm4gWm4uY2FsbCh0aGlzLCB0MiwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdHlwZW9mICRuLnNldFRpbWVvdXQgPT0gImZ1bmN0aW9uIiAmJiAoWm4gPSBzZXRUaW1lb3V0KSwgdHlwZW9mICRuLmNsZWFyVGltZW91dCA9PSAiZnVuY3Rpb24iICYmICh0YSA9IGNsZWFyVGltZW91dCk7CiAgICAgICAgdmFyIHNhLCByYSA9IFtdLCBpYSA9IGZhbHNlLCBuYSA9IC0xOwogICAgICAgIGZ1bmN0aW9uIGFhKCkgewogICAgICAgICAgaWEgJiYgc2EgJiYgKGlhID0gZmFsc2UsIHNhLmxlbmd0aCA/IHJhID0gc2EuY29uY2F0KHJhKSA6IG5hID0gLTEsIHJhLmxlbmd0aCAmJiBvYSgpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb2EoKSB7CiAgICAgICAgICBpZiAoIWlhKSB7CiAgICAgICAgICAgIHZhciB0MiA9IGVhKGFhKTsKICAgICAgICAgICAgaWEgPSB0cnVlOwogICAgICAgICAgICBmb3IgKHZhciBlMiA9IHJhLmxlbmd0aDsgZTI7ICkgewogICAgICAgICAgICAgIGZvciAoc2EgPSByYSwgcmEgPSBbXTsgKytuYSA8IGUyOyApCiAgICAgICAgICAgICAgICBzYSAmJiBzYVtuYV0ucnVuKCk7CiAgICAgICAgICAgICAgbmEgPSAtMSwgZTIgPSByYS5sZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2EgPSBudWxsLCBpYSA9IGZhbHNlLCBmdW5jdGlvbih0MykgewogICAgICAgICAgICAgIGlmICh0YSA9PT0gY2xlYXJUaW1lb3V0KQogICAgICAgICAgICAgICAgcmV0dXJuIGNsZWFyVGltZW91dCh0Myk7CiAgICAgICAgICAgICAgaWYgKCh0YSA9PT0gUW4gfHwgIXRhKSAmJiBjbGVhclRpbWVvdXQpCiAgICAgICAgICAgICAgICByZXR1cm4gdGEgPSBjbGVhclRpbWVvdXQsIGNsZWFyVGltZW91dCh0Myk7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHRhKHQzKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlMykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRhLmNhbGwobnVsbCwgdDMpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZTQpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRhLmNhbGwodGhpcywgdDMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSh0Mik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHVhKHQyLCBlMikgewogICAgICAgICAgdGhpcy5mdW4gPSB0MiwgdGhpcy5hcnJheSA9IGUyOwogICAgICAgIH0KICAgICAgICB1YS5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB0aGlzLmZ1bi5hcHBseShudWxsLCB0aGlzLmFycmF5KTsKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIGhhKCkgewogICAgICAgIH0KICAgICAgICB2YXIgcGEgPSBoYSwgY2EgPSBoYSwgbGEgPSBoYSwgZGEgPSBoYSwgRGEgPSBoYSwgbWEgPSBoYSwgZmEgPSBoYTsKICAgICAgICB2YXIgeWEgPSAkbi5wZXJmb3JtYW5jZSB8fCB7fSwgRWEgPSB5YS5ub3cgfHwgeWEubW96Tm93IHx8IHlhLm1zTm93IHx8IHlhLm9Ob3cgfHwgeWEud2Via2l0Tm93IHx8IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIH07CiAgICAgICAgdmFyIEFhID0gbmV3IERhdGUoKTsKICAgICAgICB2YXIgQ2EgPSB7IG5leHRUaWNrOiBmdW5jdGlvbih0MikgewogICAgICAgICAgdmFyIGUyID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGggLSAxKTsKICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkKICAgICAgICAgICAgZm9yICh2YXIgczIgPSAxOyBzMiA8IGFyZ3VtZW50cy5sZW5ndGg7IHMyKyspCiAgICAgICAgICAgICAgZTJbczIgLSAxXSA9IGFyZ3VtZW50c1tzMl07CiAgICAgICAgICByYS5wdXNoKG5ldyB1YSh0MiwgZTIpKSwgcmEubGVuZ3RoICE9PSAxIHx8IGlhIHx8IGVhKG9hKTsKICAgICAgICB9LCB0aXRsZTogImJyb3dzZXIiLCBicm93c2VyOiB0cnVlLCBlbnY6IHt9LCBhcmd2OiBbXSwgdmVyc2lvbjogIiIsIHZlcnNpb25zOiB7fSwgb246IHBhLCBhZGRMaXN0ZW5lcjogY2EsIG9uY2U6IGxhLCBvZmY6IGRhLCByZW1vdmVMaXN0ZW5lcjogRGEsIHJlbW92ZUFsbExpc3RlbmVyczogbWEsIGVtaXQ6IGZhLCBiaW5kaW5nOiBmdW5jdGlvbih0MikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCIpOwogICAgICAgIH0sIGN3ZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gIi8iOwogICAgICAgIH0sIGNoZGlyOiBmdW5jdGlvbih0MikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICB9LCB1bWFzazogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9LCBocnRpbWU6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICB2YXIgZTIgPSAxZS0zICogRWEuY2FsbCh5YSksIHMyID0gTWF0aC5mbG9vcihlMiksIHIyID0gTWF0aC5mbG9vcihlMiAlIDEgKiAxZTkpOwogICAgICAgICAgcmV0dXJuIHQyICYmIChzMiAtPSB0MlswXSwgKHIyIC09IHQyWzFdKSA8IDAgJiYgKHMyLS0sIHIyICs9IDFlOSkpLCBbczIsIHIyXTsKICAgICAgICB9LCBwbGF0Zm9ybTogImJyb3dzZXIiLCByZWxlYXNlOiB7fSwgY29uZmlnOiB7fSwgdXB0aW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAobmV3IERhdGUoKSAtIEFhKSAvIDFlMzsKICAgICAgICB9IH0sIHhhID0gQ2E7CiAgICAgICAgY29uc3QgRmEgPSB0eXBlb2YgeGEgPT0gIm9iamVjdCIgJiYgeGEuZW52ICYmIHhhLmVudi5OT0RFX0RFQlVHICYmIC9cYnNlbXZlclxiL2kudGVzdCh4YS5lbnYuTk9ERV9ERUJVRykgPyBmdW5jdGlvbigpIHsKICAgICAgICAgIGZvciAodmFyIHQyID0gYXJndW1lbnRzLmxlbmd0aCwgZTIgPSBuZXcgQXJyYXkodDIpLCBzMiA9IDA7IHMyIDwgdDI7IHMyKyspCiAgICAgICAgICAgIGUyW3MyXSA9IGFyZ3VtZW50c1tzMl07CiAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcigiU0VNVkVSIiwgLi4uZTIpOwogICAgICAgIH0gOiAoKSA9PiB7CiAgICAgICAgfTsKICAgICAgICB2YXIgZ2EgPSBGYTsKICAgICAgICB2YXIgUGEgPSB7IFNFTVZFUl9TUEVDX1ZFUlNJT046ICIyLjAuMCIsIE1BWF9MRU5HVEg6IDI1NiwgTUFYX1NBRkVfSU5URUdFUjogTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgfHwgOTAwNzE5OTI1NDc0MDk5MSwgTUFYX1NBRkVfQ09NUE9ORU5UX0xFTkdUSDogMTYgfSwgVGEgPSB7IGV4cG9ydHM6IHt9IH07CiAgICAgICAgIWZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgY29uc3QgeyBNQVhfU0FGRV9DT01QT05FTlRfTEVOR1RIOiBzMiB9ID0gUGEsIHIyID0gZ2EsIGkyID0gKGUyID0gdDIuZXhwb3J0cyA9IHt9KS5yZSA9IFtdLCBuMiA9IGUyLnNyYyA9IFtdLCBhMiA9IGUyLnQgPSB7fTsKICAgICAgICAgIGxldCBvMiA9IDA7CiAgICAgICAgICBjb25zdCB1MiA9ICh0MywgZTMsIHMzKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHUzID0gbzIrKzsKICAgICAgICAgICAgcjIodTMsIGUzKSwgYTJbdDNdID0gdTMsIG4yW3UzXSA9IGUzLCBpMlt1M10gPSBuZXcgUmVnRXhwKGUzLCBzMyA/ICJnIiA6IHZvaWQgMCk7CiAgICAgICAgICB9OwogICAgICAgICAgdTIoIk5VTUVSSUNJREVOVElGSUVSIiwgIjB8WzEtOV1cXGQqIiksIHUyKCJOVU1FUklDSURFTlRJRklFUkxPT1NFIiwgIlswLTldKyIpLCB1MigiTk9OTlVNRVJJQ0lERU5USUZJRVIiLCAiXFxkKlthLXpBLVotXVthLXpBLVowLTktXSoiKSwgdTIoIk1BSU5WRVJTSU9OIiwgIigiLmNvbmNhdChuMlthMi5OVU1FUklDSURFTlRJRklFUl0sICIpXFwuIikgKyAiKCIuY29uY2F0KG4yW2EyLk5VTUVSSUNJREVOVElGSUVSXSwgIilcXC4iKSArICIoIi5jb25jYXQobjJbYTIuTlVNRVJJQ0lERU5USUZJRVJdLCAiKSIpKSwgdTIoIk1BSU5WRVJTSU9OTE9PU0UiLCAiKCIuY29uY2F0KG4yW2EyLk5VTUVSSUNJREVOVElGSUVSTE9PU0VdLCAiKVxcLiIpICsgIigiLmNvbmNhdChuMlthMi5OVU1FUklDSURFTlRJRklFUkxPT1NFXSwgIilcXC4iKSArICIoIi5jb25jYXQobjJbYTIuTlVNRVJJQ0lERU5USUZJRVJMT09TRV0sICIpIikpLCB1MigiUFJFUkVMRUFTRUlERU5USUZJRVIiLCAiKD86Ii5jb25jYXQobjJbYTIuTlVNRVJJQ0lERU5USUZJRVJdLCAifCIpLmNvbmNhdChuMlthMi5OT05OVU1FUklDSURFTlRJRklFUl0sICIpIikpLCB1MigiUFJFUkVMRUFTRUlERU5USUZJRVJMT09TRSIsICIoPzoiLmNvbmNhdChuMlthMi5OVU1FUklDSURFTlRJRklFUkxPT1NFXSwgInwiKS5jb25jYXQobjJbYTIuTk9OTlVNRVJJQ0lERU5USUZJRVJdLCAiKSIpKSwgdTIoIlBSRVJFTEVBU0UiLCAiKD86LSgiLmNvbmNhdChuMlthMi5QUkVSRUxFQVNFSURFTlRJRklFUl0sICIoPzpcXC4iKS5jb25jYXQobjJbYTIuUFJFUkVMRUFTRUlERU5USUZJRVJdLCAiKSopKSIpKSwgdTIoIlBSRVJFTEVBU0VMT09TRSIsICIoPzotPygiLmNvbmNhdChuMlthMi5QUkVSRUxFQVNFSURFTlRJRklFUkxPT1NFXSwgIig/OlxcLiIpLmNvbmNhdChuMlthMi5QUkVSRUxFQVNFSURFTlRJRklFUkxPT1NFXSwgIikqKSkiKSksIHUyKCJCVUlMRElERU5USUZJRVIiLCAiWzAtOUEtWmEtei1dKyIpLCB1MigiQlVJTEQiLCAiKD86XFwrKCIuY29uY2F0KG4yW2EyLkJVSUxESURFTlRJRklFUl0sICIoPzpcXC4iKS5jb25jYXQobjJbYTIuQlVJTERJREVOVElGSUVSXSwgIikqKSkiKSksIHUyKCJGVUxMUExBSU4iLCAidj8iLmNvbmNhdChuMlthMi5NQUlOVkVSU0lPTl0pLmNvbmNhdChuMlthMi5QUkVSRUxFQVNFXSwgIj8iKS5jb25jYXQobjJbYTIuQlVJTERdLCAiPyIpKSwgdTIoIkZVTEwiLCAiXiIuY29uY2F0KG4yW2EyLkZVTExQTEFJTl0sICIkIikpLCB1MigiTE9PU0VQTEFJTiIsICJbdj1cXHNdKiIuY29uY2F0KG4yW2EyLk1BSU5WRVJTSU9OTE9PU0VdKS5jb25jYXQobjJbYTIuUFJFUkVMRUFTRUxPT1NFXSwgIj8iKS5jb25jYXQobjJbYTIuQlVJTERdLCAiPyIpKSwgdTIoIkxPT1NFIiwgIl4iLmNvbmNhdChuMlthMi5MT09TRVBMQUlOXSwgIiQiKSksIHUyKCJHVExUIiwgIigoPzo8fD4pPz0/KSIpLCB1MigiWFJBTkdFSURFTlRJRklFUkxPT1NFIiwgIiIuY29uY2F0KG4yW2EyLk5VTUVSSUNJREVOVElGSUVSTE9PU0VdLCAifHh8WHxcXCoiKSksIHUyKCJYUkFOR0VJREVOVElGSUVSIiwgIiIuY29uY2F0KG4yW2EyLk5VTUVSSUNJREVOVElGSUVSXSwgInx4fFh8XFwqIikpLCB1MigiWFJBTkdFUExBSU4iLCAiW3Y9XFxzXSooIi5jb25jYXQobjJbYTIuWFJBTkdFSURFTlRJRklFUl0sICIpIikgKyAiKD86XFwuKCIuY29uY2F0KG4yW2EyLlhSQU5HRUlERU5USUZJRVJdLCAiKSIpICsgIig/OlxcLigiLmNvbmNhdChuMlthMi5YUkFOR0VJREVOVElGSUVSXSwgIikiKSArICIoPzoiLmNvbmNhdChuMlthMi5QUkVSRUxFQVNFXSwgIik/IikuY29uY2F0KG4yW2EyLkJVSUxEXSwgIj8iKSArICIpPyk/IiksIHUyKCJYUkFOR0VQTEFJTkxPT1NFIiwgIlt2PVxcc10qKCIuY29uY2F0KG4yW2EyLlhSQU5HRUlERU5USUZJRVJMT09TRV0sICIpIikgKyAiKD86XFwuKCIuY29uY2F0KG4yW2EyLlhSQU5HRUlERU5USUZJRVJMT09TRV0sICIpIikgKyAiKD86XFwuKCIuY29uY2F0KG4yW2EyLlhSQU5HRUlERU5USUZJRVJMT09TRV0sICIpIikgKyAiKD86Ii5jb25jYXQobjJbYTIuUFJFUkVMRUFTRUxPT1NFXSwgIik/IikuY29uY2F0KG4yW2EyLkJVSUxEXSwgIj8iKSArICIpPyk/IiksIHUyKCJYUkFOR0UiLCAiXiIuY29uY2F0KG4yW2EyLkdUTFRdLCAiXFxzKiIpLmNvbmNhdChuMlthMi5YUkFOR0VQTEFJTl0sICIkIikpLCB1MigiWFJBTkdFTE9PU0UiLCAiXiIuY29uY2F0KG4yW2EyLkdUTFRdLCAiXFxzKiIpLmNvbmNhdChuMlthMi5YUkFOR0VQTEFJTkxPT1NFXSwgIiQiKSksIHUyKCJDT0VSQ0UiLCAiIi5jb25jYXQoIihefFteXFxkXSkoXFxkezEsIikuY29uY2F0KHMyLCAifSkiKSArICIoPzpcXC4oXFxkezEsIi5jb25jYXQoczIsICJ9KSk/IikgKyAiKD86XFwuKFxcZHsxLCIuY29uY2F0KHMyLCAifSkpPyIpICsgIig/OiR8W15cXGRdKSIpLCB1MigiQ09FUkNFUlRMIiwgbjJbYTIuQ09FUkNFXSwgdHJ1ZSksIHUyKCJMT05FVElMREUiLCAiKD86fj4/KSIpLCB1MigiVElMREVUUklNIiwgIihcXHMqKSIuY29uY2F0KG4yW2EyLkxPTkVUSUxERV0sICJcXHMrIiksIHRydWUpLCBlMi50aWxkZVRyaW1SZXBsYWNlID0gIiQxfiIsIHUyKCJUSUxERSIsICJeIi5jb25jYXQobjJbYTIuTE9ORVRJTERFXSkuY29uY2F0KG4yW2EyLlhSQU5HRVBMQUlOXSwgIiQiKSksIHUyKCJUSUxERUxPT1NFIiwgIl4iLmNvbmNhdChuMlthMi5MT05FVElMREVdKS5jb25jYXQobjJbYTIuWFJBTkdFUExBSU5MT09TRV0sICIkIikpLCB1MigiTE9ORUNBUkVUIiwgIig/OlxcXikiKSwgdTIoIkNBUkVUVFJJTSIsICIoXFxzKikiLmNvbmNhdChuMlthMi5MT05FQ0FSRVRdLCAiXFxzKyIpLCB0cnVlKSwgZTIuY2FyZXRUcmltUmVwbGFjZSA9ICIkMV4iLCB1MigiQ0FSRVQiLCAiXiIuY29uY2F0KG4yW2EyLkxPTkVDQVJFVF0pLmNvbmNhdChuMlthMi5YUkFOR0VQTEFJTl0sICIkIikpLCB1MigiQ0FSRVRMT09TRSIsICJeIi5jb25jYXQobjJbYTIuTE9ORUNBUkVUXSkuY29uY2F0KG4yW2EyLlhSQU5HRVBMQUlOTE9PU0VdLCAiJCIpKSwgdTIoIkNPTVBBUkFUT1JMT09TRSIsICJeIi5jb25jYXQobjJbYTIuR1RMVF0sICJcXHMqKCIpLmNvbmNhdChuMlthMi5MT09TRVBMQUlOXSwgIikkfF4kIikpLCB1MigiQ09NUEFSQVRPUiIsICJeIi5jb25jYXQobjJbYTIuR1RMVF0sICJcXHMqKCIpLmNvbmNhdChuMlthMi5GVUxMUExBSU5dLCAiKSR8XiQiKSksIHUyKCJDT01QQVJBVE9SVFJJTSIsICIoXFxzKikiLmNvbmNhdChuMlthMi5HVExUXSwgIlxccyooIikuY29uY2F0KG4yW2EyLkxPT1NFUExBSU5dLCAifCIpLmNvbmNhdChuMlthMi5YUkFOR0VQTEFJTl0sICIpIiksIHRydWUpLCBlMi5jb21wYXJhdG9yVHJpbVJlcGxhY2UgPSAiJDEkMiQzIiwgdTIoIkhZUEhFTlJBTkdFIiwgIl5cXHMqKCIuY29uY2F0KG4yW2EyLlhSQU5HRVBMQUlOXSwgIikiKSArICJcXHMrLVxccysiICsgIigiLmNvbmNhdChuMlthMi5YUkFOR0VQTEFJTl0sICIpIikgKyAiXFxzKiQiKSwgdTIoIkhZUEhFTlJBTkdFTE9PU0UiLCAiXlxccyooIi5jb25jYXQobjJbYTIuWFJBTkdFUExBSU5MT09TRV0sICIpIikgKyAiXFxzKy1cXHMrIiArICIoIi5jb25jYXQobjJbYTIuWFJBTkdFUExBSU5MT09TRV0sICIpIikgKyAiXFxzKiQiKSwgdTIoIlNUQVIiLCAiKDx8Pik/PT9cXHMqXFwqIiksIHUyKCJHVEUwIiwgIl5cXHMqPj1cXHMqMC4wLjBcXHMqJCIpLCB1MigiR1RFMFBSRSIsICJeXFxzKj49XFxzKjAuMC4wLTBcXHMqJCIpOwogICAgICAgIH0oVGEsIFRhLmV4cG9ydHMpOwogICAgICAgIGNvbnN0IGJhID0gWyJpbmNsdWRlUHJlcmVsZWFzZSIsICJsb29zZSIsICJydGwiXTsKICAgICAgICB2YXIgU2EgPSAodDIpID0+IHQyID8gdHlwZW9mIHQyICE9ICJvYmplY3QiID8geyBsb29zZTogdHJ1ZSB9IDogYmEuZmlsdGVyKChlMikgPT4gdDJbZTJdKS5yZWR1Y2UoKHQzLCBlMikgPT4gKHQzW2UyXSA9IHRydWUsIHQzKSwge30pIDoge307CiAgICAgICAgY29uc3Qgd2EgPSAvXlswLTldKyQvLCBCYSA9ICh0MiwgZTIpID0+IHsKICAgICAgICAgIGNvbnN0IHMyID0gd2EudGVzdCh0MiksIHIyID0gd2EudGVzdChlMik7CiAgICAgICAgICByZXR1cm4gczIgJiYgcjIgJiYgKHQyID0gK3QyLCBlMiA9ICtlMiksIHQyID09PSBlMiA/IDAgOiBzMiAmJiAhcjIgPyAtMSA6IHIyICYmICFzMiA/IDEgOiB0MiA8IGUyID8gLTEgOiAxOwogICAgICAgIH07CiAgICAgICAgdmFyIE5hID0geyBjb21wYXJlSWRlbnRpZmllcnM6IEJhLCByY29tcGFyZUlkZW50aWZpZXJzOiAodDIsIGUyKSA9PiBCYShlMiwgdDIpIH07CiAgICAgICAgY29uc3QgSWEgPSBnYSwgeyBNQVhfTEVOR1RIOiB2YSwgTUFYX1NBRkVfSU5URUdFUjoga2EgfSA9IFBhLCB7IHJlOiBMYSwgdDogT2EgfSA9IFRhLmV4cG9ydHMsIE1hID0gU2EsIHsgY29tcGFyZUlkZW50aWZpZXJzOiBSYSB9ID0gTmE7CiAgICAgICAgY2xhc3MgamEgewogICAgICAgICAgY29uc3RydWN0b3IodDIsIGUyKSB7CiAgICAgICAgICAgIGlmIChlMiA9IE1hKGUyKSwgdDIgaW5zdGFuY2VvZiBqYSkgewogICAgICAgICAgICAgIGlmICh0Mi5sb29zZSA9PT0gISFlMi5sb29zZSAmJiB0Mi5pbmNsdWRlUHJlcmVsZWFzZSA9PT0gISFlMi5pbmNsdWRlUHJlcmVsZWFzZSkKICAgICAgICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICAgICAgICB0MiA9IHQyLnZlcnNpb247CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHQyICE9ICJzdHJpbmciKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgVmVyc2lvbjogIi5jb25jYXQodDIpKTsKICAgICAgICAgICAgaWYgKHQyLmxlbmd0aCA+IHZhKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoInZlcnNpb24gaXMgbG9uZ2VyIHRoYW4gIi5jb25jYXQodmEsICIgY2hhcmFjdGVycyIpKTsKICAgICAgICAgICAgSWEoIlNlbVZlciIsIHQyLCBlMiksIHRoaXMub3B0aW9ucyA9IGUyLCB0aGlzLmxvb3NlID0gISFlMi5sb29zZSwgdGhpcy5pbmNsdWRlUHJlcmVsZWFzZSA9ICEhZTIuaW5jbHVkZVByZXJlbGVhc2U7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdDIudHJpbSgpLm1hdGNoKGUyLmxvb3NlID8gTGFbT2EuTE9PU0VdIDogTGFbT2EuRlVMTF0pOwogICAgICAgICAgICBpZiAoIXMyKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgVmVyc2lvbjogIi5jb25jYXQodDIpKTsKICAgICAgICAgICAgaWYgKHRoaXMucmF3ID0gdDIsIHRoaXMubWFqb3IgPSArczJbMV0sIHRoaXMubWlub3IgPSArczJbMl0sIHRoaXMucGF0Y2ggPSArczJbM10sIHRoaXMubWFqb3IgPiBrYSB8fCB0aGlzLm1ham9yIDwgMCkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIG1ham9yIHZlcnNpb24iKTsKICAgICAgICAgICAgaWYgKHRoaXMubWlub3IgPiBrYSB8fCB0aGlzLm1pbm9yIDwgMCkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIG1pbm9yIHZlcnNpb24iKTsKICAgICAgICAgICAgaWYgKHRoaXMucGF0Y2ggPiBrYSB8fCB0aGlzLnBhdGNoIDwgMCkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIHBhdGNoIHZlcnNpb24iKTsKICAgICAgICAgICAgczJbNF0gPyB0aGlzLnByZXJlbGVhc2UgPSBzMls0XS5zcGxpdCgiLiIpLm1hcCgodDMpID0+IHsKICAgICAgICAgICAgICBpZiAoL15bMC05XSskLy50ZXN0KHQzKSkgewogICAgICAgICAgICAgICAgY29uc3QgZTMgPSArdDM7CiAgICAgICAgICAgICAgICBpZiAoZTMgPj0gMCAmJiBlMyA8IGthKQogICAgICAgICAgICAgICAgICByZXR1cm4gZTM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB0MzsKICAgICAgICAgICAgfSkgOiB0aGlzLnByZXJlbGVhc2UgPSBbXSwgdGhpcy5idWlsZCA9IHMyWzVdID8gczJbNV0uc3BsaXQoIi4iKSA6IFtdLCB0aGlzLmZvcm1hdCgpOwogICAgICAgICAgfQogICAgICAgICAgZm9ybWF0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uID0gIiIuY29uY2F0KHRoaXMubWFqb3IsICIuIikuY29uY2F0KHRoaXMubWlub3IsICIuIikuY29uY2F0KHRoaXMucGF0Y2gpLCB0aGlzLnByZXJlbGVhc2UubGVuZ3RoICYmICh0aGlzLnZlcnNpb24gKz0gIi0iLmNvbmNhdCh0aGlzLnByZXJlbGVhc2Uuam9pbigiLiIpKSksIHRoaXMudmVyc2lvbjsKICAgICAgICAgIH0KICAgICAgICAgIHRvU3RyaW5nKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uOwogICAgICAgICAgfQogICAgICAgICAgY29tcGFyZSh0MikgewogICAgICAgICAgICBpZiAoSWEoIlNlbVZlci5jb21wYXJlIiwgdGhpcy52ZXJzaW9uLCB0aGlzLm9wdGlvbnMsIHQyKSwgISh0MiBpbnN0YW5jZW9mIGphKSkgewogICAgICAgICAgICAgIGlmICh0eXBlb2YgdDIgPT0gInN0cmluZyIgJiYgdDIgPT09IHRoaXMudmVyc2lvbikKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgIHQyID0gbmV3IGphKHQyLCB0aGlzLm9wdGlvbnMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0Mi52ZXJzaW9uID09PSB0aGlzLnZlcnNpb24gPyAwIDogdGhpcy5jb21wYXJlTWFpbih0MikgfHwgdGhpcy5jb21wYXJlUHJlKHQyKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbXBhcmVNYWluKHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0MiBpbnN0YW5jZW9mIGphIHx8ICh0MiA9IG5ldyBqYSh0MiwgdGhpcy5vcHRpb25zKSksIFJhKHRoaXMubWFqb3IsIHQyLm1ham9yKSB8fCBSYSh0aGlzLm1pbm9yLCB0Mi5taW5vcikgfHwgUmEodGhpcy5wYXRjaCwgdDIucGF0Y2gpOwogICAgICAgICAgfQogICAgICAgICAgY29tcGFyZVByZSh0MikgewogICAgICAgICAgICBpZiAodDIgaW5zdGFuY2VvZiBqYSB8fCAodDIgPSBuZXcgamEodDIsIHRoaXMub3B0aW9ucykpLCB0aGlzLnByZXJlbGVhc2UubGVuZ3RoICYmICF0Mi5wcmVyZWxlYXNlLmxlbmd0aCkKICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIGlmICghdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCAmJiB0Mi5wcmVyZWxlYXNlLmxlbmd0aCkKICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgaWYgKCF0aGlzLnByZXJlbGVhc2UubGVuZ3RoICYmICF0Mi5wcmVyZWxlYXNlLmxlbmd0aCkKICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgbGV0IGUyID0gMDsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5wcmVyZWxlYXNlW2UyXSwgcjIgPSB0Mi5wcmVyZWxlYXNlW2UyXTsKICAgICAgICAgICAgICBpZiAoSWEoInByZXJlbGVhc2UgY29tcGFyZSIsIGUyLCBzMiwgcjIpLCBzMiA9PT0gdm9pZCAwICYmIHIyID09PSB2b2lkIDApCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICBpZiAocjIgPT09IHZvaWQgMCkKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICAgIGlmIChzMiA9PT0gdm9pZCAwKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICAgIGlmIChzMiAhPT0gcjIpCiAgICAgICAgICAgICAgICByZXR1cm4gUmEoczIsIHIyKTsKICAgICAgICAgICAgfSB3aGlsZSAoKytlMik7CiAgICAgICAgICB9CiAgICAgICAgICBjb21wYXJlQnVpbGQodDIpIHsKICAgICAgICAgICAgdDIgaW5zdGFuY2VvZiBqYSB8fCAodDIgPSBuZXcgamEodDIsIHRoaXMub3B0aW9ucykpOwogICAgICAgICAgICBsZXQgZTIgPSAwOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgY29uc3QgczIgPSB0aGlzLmJ1aWxkW2UyXSwgcjIgPSB0Mi5idWlsZFtlMl07CiAgICAgICAgICAgICAgaWYgKElhKCJwcmVyZWxlYXNlIGNvbXBhcmUiLCBlMiwgczIsIHIyKSwgczIgPT09IHZvaWQgMCAmJiByMiA9PT0gdm9pZCAwKQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgaWYgKHIyID09PSB2b2lkIDApCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICBpZiAoczIgPT09IHZvaWQgMCkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgICBpZiAoczIgIT09IHIyKQogICAgICAgICAgICAgICAgcmV0dXJuIFJhKHMyLCByMik7CiAgICAgICAgICAgIH0gd2hpbGUgKCsrZTIpOwogICAgICAgICAgfQogICAgICAgICAgaW5jKHQyLCBlMikgewogICAgICAgICAgICBzd2l0Y2ggKHQyKSB7CiAgICAgICAgICAgICAgY2FzZSAicHJlbWFqb3IiOgogICAgICAgICAgICAgICAgdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCA9IDAsIHRoaXMucGF0Y2ggPSAwLCB0aGlzLm1pbm9yID0gMCwgdGhpcy5tYWpvcisrLCB0aGlzLmluYygicHJlIiwgZTIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAicHJlbWlub3IiOgogICAgICAgICAgICAgICAgdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCA9IDAsIHRoaXMucGF0Y2ggPSAwLCB0aGlzLm1pbm9yKyssIHRoaXMuaW5jKCJwcmUiLCBlMik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJwcmVwYXRjaCI6CiAgICAgICAgICAgICAgICB0aGlzLnByZXJlbGVhc2UubGVuZ3RoID0gMCwgdGhpcy5pbmMoInBhdGNoIiwgZTIpLCB0aGlzLmluYygicHJlIiwgZTIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAicHJlcmVsZWFzZSI6CiAgICAgICAgICAgICAgICB0aGlzLnByZXJlbGVhc2UubGVuZ3RoID09PSAwICYmIHRoaXMuaW5jKCJwYXRjaCIsIGUyKSwgdGhpcy5pbmMoInByZSIsIGUyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIm1ham9yIjoKICAgICAgICAgICAgICAgIHRoaXMubWlub3IgPT09IDAgJiYgdGhpcy5wYXRjaCA9PT0gMCAmJiB0aGlzLnByZXJlbGVhc2UubGVuZ3RoICE9PSAwIHx8IHRoaXMubWFqb3IrKywgdGhpcy5taW5vciA9IDAsIHRoaXMucGF0Y2ggPSAwLCB0aGlzLnByZXJlbGVhc2UgPSBbXTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIm1pbm9yIjoKICAgICAgICAgICAgICAgIHRoaXMucGF0Y2ggPT09IDAgJiYgdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCAhPT0gMCB8fCB0aGlzLm1pbm9yKyssIHRoaXMucGF0Y2ggPSAwLCB0aGlzLnByZXJlbGVhc2UgPSBbXTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInBhdGNoIjoKICAgICAgICAgICAgICAgIHRoaXMucHJlcmVsZWFzZS5sZW5ndGggPT09IDAgJiYgdGhpcy5wYXRjaCsrLCB0aGlzLnByZXJlbGVhc2UgPSBbXTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInByZSI6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmVyZWxlYXNlLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgICAgICAgdGhpcy5wcmVyZWxlYXNlID0gWzBdOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIGxldCB0MyA9IHRoaXMucHJlcmVsZWFzZS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgIGZvciAoOyAtLXQzID49IDA7ICkKICAgICAgICAgICAgICAgICAgICB0eXBlb2YgdGhpcy5wcmVyZWxlYXNlW3QzXSA9PSAibnVtYmVyIiAmJiAodGhpcy5wcmVyZWxlYXNlW3QzXSsrLCB0MyA9IC0yKTsKICAgICAgICAgICAgICAgICAgdDMgPT09IC0xICYmIHRoaXMucHJlcmVsZWFzZS5wdXNoKDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZTIgJiYgKHRoaXMucHJlcmVsZWFzZVswXSA9PT0gZTIgPyBpc05hTih0aGlzLnByZXJlbGVhc2VbMV0pICYmICh0aGlzLnByZXJlbGVhc2UgPSBbZTIsIDBdKSA6IHRoaXMucHJlcmVsZWFzZSA9IFtlMiwgMF0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBpbmNyZW1lbnQgYXJndW1lbnQ6ICIuY29uY2F0KHQyKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0KCksIHRoaXMucmF3ID0gdGhpcy52ZXJzaW9uLCB0aGlzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBVYSA9IGphOwogICAgICAgIHZhciBfYSA9ICh0MiwgZTIsIHMyKSA9PiBuZXcgVWEodDIsIHMyKS5jb21wYXJlKG5ldyBVYShlMiwgczIpKTsKICAgICAgICBjb25zdCB6YSA9IF9hOwogICAgICAgIHZhciBIYSA9ICh0MiwgZTIsIHMyKSA9PiB6YSh0MiwgZTIsIHMyKSA8IDA7CiAgICAgICAgY29uc3QgVmEgPSBfYTsKICAgICAgICB2YXIgcWEsIFdhLCBLYSwgR2EsIFhhLCBKYSwgJGEgPSAodDIsIGUyLCBzMikgPT4gVmEodDIsIGUyLCBzMikgPj0gMCwgWWEgPSB7IGV4cG9ydHM6IHt9IH07CiAgICAgICAgIWZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgZnVuY3Rpb24gczIoKSB7CiAgICAgICAgICAgIGZvciAodmFyIHQzID0gW10sIGUzID0gMDsgZTMgPCBhcmd1bWVudHMubGVuZ3RoOyBlMysrKQogICAgICAgICAgICAgIHQzW2UzXSA9IGFyZ3VtZW50c1tlM107CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiByMigpIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBXZWFrTWFwICE9ICJ1bmRlZmluZWQiID8gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCkgOiB7IGFkZDogczIsIGRlbGV0ZTogczIsIGdldDogczIsIHNldDogczIsIGhhczogZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0gfTsKICAgICAgICAgIH0KICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCBlMi5vdXRkZW50ID0gdm9pZCAwOwogICAgICAgICAgdmFyIGkyID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSwgbjIgPSBmdW5jdGlvbih0MywgZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGkyLmNhbGwodDMsIGUzKTsKICAgICAgICAgIH07CiAgICAgICAgICBmdW5jdGlvbiBhMih0MywgZTMpIHsKICAgICAgICAgICAgZm9yICh2YXIgczMgaW4gZTMpCiAgICAgICAgICAgICAgbjIoZTMsIHMzKSAmJiAodDNbczNdID0gZTNbczNdKTsKICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfQogICAgICAgICAgdmFyIG8yID0gL15bIFx0XSooPzpcclxufFxyfFxuKS8sIHUyID0gLyg/OlxyXG58XHJ8XG4pWyBcdF0qJC8sIGgyID0gL14oPzpbXHJcbl18JCkvLCBwMiA9IC8oPzpcclxufFxyfFxuKShbIFx0XSopKD86W14gXHRcclxuXXwkKS8sIGMyID0gL15bIFx0XSpbXHJcbl1bIFx0XHJcbl0qJC87CiAgICAgICAgICBmdW5jdGlvbiBsMih0MywgZTMsIHMzKSB7CiAgICAgICAgICAgIHZhciByMyA9IDAsIGkzID0gdDNbMF0ubWF0Y2gocDIpOwogICAgICAgICAgICBpMyAmJiAocjMgPSBpM1sxXS5sZW5ndGgpOwogICAgICAgICAgICB2YXIgbjMgPSBuZXcgUmVnRXhwKCIoXFxyXFxufFxccnxcXG4pLnswLCIgKyByMyArICJ9IiwgImciKTsKICAgICAgICAgICAgZTMgJiYgKHQzID0gdDMuc2xpY2UoMSkpOwogICAgICAgICAgICB2YXIgYTMgPSBzMy5uZXdsaW5lLCBoMyA9IHMzLnRyaW1MZWFkaW5nTmV3bGluZSwgYzMgPSBzMy50cmltVHJhaWxpbmdOZXdsaW5lLCBsMyA9IHR5cGVvZiBhMyA9PSAic3RyaW5nIiwgZDMgPSB0My5sZW5ndGg7CiAgICAgICAgICAgIHJldHVybiB0My5tYXAoZnVuY3Rpb24odDQsIGU0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQ0ID0gdDQucmVwbGFjZShuMywgIiQxIiksIGU0ID09PSAwICYmIGgzICYmICh0NCA9IHQ0LnJlcGxhY2UobzIsICIiKSksIGU0ID09PSBkMyAtIDEgJiYgYzMgJiYgKHQ0ID0gdDQucmVwbGFjZSh1MiwgIiIpKSwgbDMgJiYgKHQ0ID0gdDQucmVwbGFjZSgvXHJcbnxcbnxcci9nLCBmdW5jdGlvbih0NSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGEzOwogICAgICAgICAgICAgIH0pKSwgdDQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gZDIodDMsIGUzKSB7CiAgICAgICAgICAgIGZvciAodmFyIHMzID0gIiIsIHIzID0gMCwgaTMgPSB0My5sZW5ndGg7IHIzIDwgaTM7IHIzKyspCiAgICAgICAgICAgICAgczMgKz0gdDNbcjNdLCByMyA8IGkzIC0gMSAmJiAoczMgKz0gZTNbcjNdKTsKICAgICAgICAgICAgcmV0dXJuIHMzOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gRDIodDMpIHsKICAgICAgICAgICAgcmV0dXJuIG4yKHQzLCAicmF3IikgJiYgbjIodDMsICJsZW5ndGgiKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBtMiA9IGZ1bmN0aW9uIHQzKGUzKSB7CiAgICAgICAgICAgIHZhciBzMyA9IHIyKCksIGkzID0gcjIoKSwgbjMgPSBhMihmdW5jdGlvbiByMyhuNCkgewogICAgICAgICAgICAgIGZvciAodmFyIG8zID0gW10sIHUzID0gMTsgdTMgPCBhcmd1bWVudHMubGVuZ3RoOyB1MysrKQogICAgICAgICAgICAgICAgbzNbdTMgLSAxXSA9IGFyZ3VtZW50c1t1M107CiAgICAgICAgICAgICAgaWYgKEQyKG40KSkgewogICAgICAgICAgICAgICAgdmFyIHAzID0gbjQsIGYyID0gKG8zWzBdID09PSByMyB8fCBvM1swXSA9PT0gbTIpICYmIGMyLnRlc3QocDNbMF0pICYmIGgyLnRlc3QocDNbMV0pLCB5MiA9IGYyID8gaTMgOiBzMywgRTIgPSB5Mi5nZXQocDMpOwogICAgICAgICAgICAgICAgaWYgKEUyIHx8IChFMiA9IGwyKHAzLCBmMiwgZTMpLCB5Mi5zZXQocDMsIEUyKSksIG8zLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgICAgICAgcmV0dXJuIEUyWzBdOwogICAgICAgICAgICAgICAgdmFyIEEyID0gZDIoRTIsIGYyID8gbzMuc2xpY2UoMSkgOiBvMyk7CiAgICAgICAgICAgICAgICByZXR1cm4gQTI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB0MyhhMihhMih7fSwgZTMpLCBuNCB8fCB7fSkpOwogICAgICAgICAgICB9LCB7IHN0cmluZzogZnVuY3Rpb24odDQpIHsKICAgICAgICAgICAgICByZXR1cm4gbDIoW3Q0XSwgZmFsc2UsIGUzKVswXTsKICAgICAgICAgICAgfSB9KTsKICAgICAgICAgICAgcmV0dXJuIG4zOwogICAgICAgICAgfSh7IHRyaW1MZWFkaW5nTmV3bGluZTogdHJ1ZSwgdHJpbVRyYWlsaW5nTmV3bGluZTogdHJ1ZSB9KTsKICAgICAgICAgIGUyLm91dGRlbnQgPSBtMiwgZTIuZGVmYXVsdCA9IG0yOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdDIuZXhwb3J0cyA9IG0yLCBPYmplY3QuZGVmaW5lUHJvcGVydHkobTIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KSwgbTIuZGVmYXVsdCA9IG0yLCBtMi5vdXRkZW50ID0gbTI7CiAgICAgICAgICB9IGNhdGNoICh0MykgewogICAgICAgICAgfQogICAgICAgIH0oWWEsIFlhLmV4cG9ydHMpOwogICAgICAgIGNvbnN0IHsgb3V0ZGVudDogUWEgfSA9IFlhLmV4cG9ydHMsIFphID0gIkNvbmZpZyIsIHRvID0gIkVkaXRvciIsIGVvID0gIk90aGVyIiwgc28gPSAiR2xvYmFsIiwgcm8gPSAiU3BlY2lhbCIsIGlvID0geyBjdXJzb3JPZmZzZXQ6IHsgc2luY2U6ICIxLjQuMCIsIGNhdGVnb3J5OiBybywgdHlwZTogImludCIsIGRlZmF1bHQ6IC0xLCByYW5nZTogeyBzdGFydDogLTEsIGVuZDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBzdGVwOiAxIH0sIGRlc2NyaXB0aW9uOiBRYShxYSB8fCAocWEgPSB2aShbIlxuICAgICAgUHJpbnQgKHRvIHN0ZGVycikgd2hlcmUgYSBjdXJzb3IgYXQgdGhlIGdpdmVuIHBvc2l0aW9uIHdvdWxkIG1vdmUgdG8gYWZ0ZXIgZm9ybWF0dGluZy5cbiAgICAgIFRoaXMgb3B0aW9uIGNhbm5vdCBiZSB1c2VkIHdpdGggLS1yYW5nZS1zdGFydCBhbmQgLS1yYW5nZS1lbmQuXG4gICAgIl0pKSksIGNsaUNhdGVnb3J5OiB0byB9LCBlbmRPZkxpbmU6IHsgc2luY2U6ICIxLjE1LjAiLCBjYXRlZ29yeTogc28sIHR5cGU6ICJjaG9pY2UiLCBkZWZhdWx0OiBbeyBzaW5jZTogIjEuMTUuMCIsIHZhbHVlOiAiYXV0byIgfSwgeyBzaW5jZTogIjIuMC4wIiwgdmFsdWU6ICJsZiIgfV0sIGRlc2NyaXB0aW9uOiAiV2hpY2ggZW5kIG9mIGxpbmUgY2hhcmFjdGVycyB0byBhcHBseS4iLCBjaG9pY2VzOiBbeyB2YWx1ZTogImxmIiwgZGVzY3JpcHRpb246ICJMaW5lIEZlZWQgb25seSAoXFxuKSwgY29tbW9uIG9uIExpbnV4IGFuZCBtYWNPUyBhcyB3ZWxsIGFzIGluc2lkZSBnaXQgcmVwb3MiIH0sIHsgdmFsdWU6ICJjcmxmIiwgZGVzY3JpcHRpb246ICJDYXJyaWFnZSBSZXR1cm4gKyBMaW5lIEZlZWQgY2hhcmFjdGVycyAoXFxyXFxuKSwgY29tbW9uIG9uIFdpbmRvd3MiIH0sIHsgdmFsdWU6ICJjciIsIGRlc2NyaXB0aW9uOiAiQ2FycmlhZ2UgUmV0dXJuIGNoYXJhY3RlciBvbmx5IChcXHIpLCB1c2VkIHZlcnkgcmFyZWx5IiB9LCB7IHZhbHVlOiAiYXV0byIsIGRlc2NyaXB0aW9uOiBRYShXYSB8fCAoV2EgPSB2aShbIlxuICAgICAgICAgIE1haW50YWluIGV4aXN0aW5nXG4gICAgICAgICAgKG1peGVkIHZhbHVlcyB3aXRoaW4gb25lIGZpbGUgYXJlIG5vcm1hbGlzZWQgYnkgbG9va2luZyBhdCB3aGF0J3MgdXNlZCBhZnRlciB0aGUgZmlyc3QgbGluZSlcbiAgICAgICAgIl0pKSkgfV0gfSwgZmlsZXBhdGg6IHsgc2luY2U6ICIxLjQuMCIsIGNhdGVnb3J5OiBybywgdHlwZTogInBhdGgiLCBkZXNjcmlwdGlvbjogIlNwZWNpZnkgdGhlIGlucHV0IGZpbGVwYXRoLiBUaGlzIHdpbGwgYmUgdXNlZCB0byBkbyBwYXJzZXIgaW5mZXJlbmNlLiIsIGNsaU5hbWU6ICJzdGRpbi1maWxlcGF0aCIsIGNsaUNhdGVnb3J5OiBlbywgY2xpRGVzY3JpcHRpb246ICJQYXRoIHRvIHRoZSBmaWxlIHRvIHByZXRlbmQgdGhhdCBzdGRpbiBjb21lcyBmcm9tLiIgfSwgaW5zZXJ0UHJhZ21hOiB7IHNpbmNlOiAiMS44LjAiLCBjYXRlZ29yeTogcm8sIHR5cGU6ICJib29sZWFuIiwgZGVmYXVsdDogZmFsc2UsIGRlc2NyaXB0aW9uOiAiSW5zZXJ0IEBmb3JtYXQgcHJhZ21hIGludG8gZmlsZSdzIGZpcnN0IGRvY2Jsb2NrIGNvbW1lbnQuIiwgY2xpQ2F0ZWdvcnk6IGVvIH0sIHBhcnNlcjogeyBzaW5jZTogIjAuMC4xMCIsIGNhdGVnb3J5OiBzbywgdHlwZTogImNob2ljZSIsIGRlZmF1bHQ6IFt7IHNpbmNlOiAiMC4wLjEwIiwgdmFsdWU6ICJiYWJ5bG9uIiB9LCB7IHNpbmNlOiAiMS4xMy4wIiwgdmFsdWU6IHZvaWQgMCB9XSwgZGVzY3JpcHRpb246ICJXaGljaCBwYXJzZXIgdG8gdXNlLiIsIGV4Y2VwdGlvbjogKHQyKSA9PiB0eXBlb2YgdDIgPT0gInN0cmluZyIgfHwgdHlwZW9mIHQyID09ICJmdW5jdGlvbiIsIGNob2ljZXM6IFt7IHZhbHVlOiAiZmxvdyIsIGRlc2NyaXB0aW9uOiAiRmxvdyIgfSwgeyB2YWx1ZTogImJhYmVsIiwgc2luY2U6ICIxLjE2LjAiLCBkZXNjcmlwdGlvbjogIkphdmFTY3JpcHQiIH0sIHsgdmFsdWU6ICJiYWJlbC1mbG93Iiwgc2luY2U6ICIxLjE2LjAiLCBkZXNjcmlwdGlvbjogIkZsb3ciIH0sIHsgdmFsdWU6ICJiYWJlbC10cyIsIHNpbmNlOiAiMi4wLjAiLCBkZXNjcmlwdGlvbjogIlR5cGVTY3JpcHQiIH0sIHsgdmFsdWU6ICJ0eXBlc2NyaXB0Iiwgc2luY2U6ICIxLjQuMCIsIGRlc2NyaXB0aW9uOiAiVHlwZVNjcmlwdCIgfSwgeyB2YWx1ZTogImVzcHJlZSIsIHNpbmNlOiAiMi4yLjAiLCBkZXNjcmlwdGlvbjogIkphdmFTY3JpcHQiIH0sIHsgdmFsdWU6ICJtZXJpeWFoIiwgc2luY2U6ICIyLjIuMCIsIGRlc2NyaXB0aW9uOiAiSmF2YVNjcmlwdCIgfSwgeyB2YWx1ZTogImNzcyIsIHNpbmNlOiAiMS43LjEiLCBkZXNjcmlwdGlvbjogIkNTUyIgfSwgeyB2YWx1ZTogImxlc3MiLCBzaW5jZTogIjEuNy4xIiwgZGVzY3JpcHRpb246ICJMZXNzIiB9LCB7IHZhbHVlOiAic2NzcyIsIHNpbmNlOiAiMS43LjEiLCBkZXNjcmlwdGlvbjogIlNDU1MiIH0sIHsgdmFsdWU6ICJqc29uIiwgc2luY2U6ICIxLjUuMCIsIGRlc2NyaXB0aW9uOiAiSlNPTiIgfSwgeyB2YWx1ZTogImpzb241Iiwgc2luY2U6ICIxLjEzLjAiLCBkZXNjcmlwdGlvbjogIkpTT041IiB9LCB7IHZhbHVlOiAianNvbi1zdHJpbmdpZnkiLCBzaW5jZTogIjEuMTMuMCIsIGRlc2NyaXB0aW9uOiAiSlNPTi5zdHJpbmdpZnkiIH0sIHsgdmFsdWU6ICJncmFwaHFsIiwgc2luY2U6ICIxLjUuMCIsIGRlc2NyaXB0aW9uOiAiR3JhcGhRTCIgfSwgeyB2YWx1ZTogIm1hcmtkb3duIiwgc2luY2U6ICIxLjguMCIsIGRlc2NyaXB0aW9uOiAiTWFya2Rvd24iIH0sIHsgdmFsdWU6ICJtZHgiLCBzaW5jZTogIjEuMTUuMCIsIGRlc2NyaXB0aW9uOiAiTURYIiB9LCB7IHZhbHVlOiAidnVlIiwgc2luY2U6ICIxLjEwLjAiLCBkZXNjcmlwdGlvbjogIlZ1ZSIgfSwgeyB2YWx1ZTogInlhbWwiLCBzaW5jZTogIjEuMTQuMCIsIGRlc2NyaXB0aW9uOiAiWUFNTCIgfSwgeyB2YWx1ZTogImdsaW1tZXIiLCBzaW5jZTogIjIuMy4wIiwgZGVzY3JpcHRpb246ICJFbWJlciAvIEhhbmRsZWJhcnMiIH0sIHsgdmFsdWU6ICJodG1sIiwgc2luY2U6ICIxLjE1LjAiLCBkZXNjcmlwdGlvbjogIkhUTUwiIH0sIHsgdmFsdWU6ICJhbmd1bGFyIiwgc2luY2U6ICIxLjE1LjAiLCBkZXNjcmlwdGlvbjogIkFuZ3VsYXIiIH0sIHsgdmFsdWU6ICJsd2MiLCBzaW5jZTogIjEuMTcuMCIsIGRlc2NyaXB0aW9uOiAiTGlnaHRuaW5nIFdlYiBDb21wb25lbnRzIiB9XSB9LCBwbHVnaW5zOiB7IHNpbmNlOiAiMS4xMC4wIiwgdHlwZTogInBhdGgiLCBhcnJheTogdHJ1ZSwgZGVmYXVsdDogW3sgdmFsdWU6IFtdIH1dLCBjYXRlZ29yeTogc28sIGRlc2NyaXB0aW9uOiAiQWRkIGEgcGx1Z2luLiBNdWx0aXBsZSBwbHVnaW5zIGNhbiBiZSBwYXNzZWQgYXMgc2VwYXJhdGUgYC0tcGx1Z2luYHMuIiwgZXhjZXB0aW9uOiAodDIpID0+IHR5cGVvZiB0MiA9PSAic3RyaW5nIiB8fCB0eXBlb2YgdDIgPT0gIm9iamVjdCIsIGNsaU5hbWU6ICJwbHVnaW4iLCBjbGlDYXRlZ29yeTogWmEgfSwgcGx1Z2luU2VhcmNoRGlyczogeyBzaW5jZTogIjEuMTMuMCIsIHR5cGU6ICJwYXRoIiwgYXJyYXk6IHRydWUsIGRlZmF1bHQ6IFt7IHZhbHVlOiBbXSB9XSwgY2F0ZWdvcnk6IHNvLCBkZXNjcmlwdGlvbjogUWEoS2EgfHwgKEthID0gdmkoWyJcbiAgICAgIEN1c3RvbSBkaXJlY3RvcnkgdGhhdCBjb250YWlucyBwcmV0dGllciBwbHVnaW5zIGluIG5vZGVfbW9kdWxlcyBzdWJkaXJlY3RvcnkuXG4gICAgICBPdmVycmlkZXMgZGVmYXVsdCBiZWhhdmlvciB3aGVuIHBsdWdpbnMgYXJlIHNlYXJjaGVkIHJlbGF0aXZlbHkgdG8gdGhlIGxvY2F0aW9uIG9mIFByZXR0aWVyLlxuICAgICAgTXVsdGlwbGUgdmFsdWVzIGFyZSBhY2NlcHRlZC5cbiAgICAiXSkpKSwgZXhjZXB0aW9uOiAodDIpID0+IHR5cGVvZiB0MiA9PSAic3RyaW5nIiB8fCB0eXBlb2YgdDIgPT0gIm9iamVjdCIsIGNsaU5hbWU6ICJwbHVnaW4tc2VhcmNoLWRpciIsIGNsaUNhdGVnb3J5OiBaYSB9LCBwcmludFdpZHRoOiB7IHNpbmNlOiAiMC4wLjAiLCBjYXRlZ29yeTogc28sIHR5cGU6ICJpbnQiLCBkZWZhdWx0OiA4MCwgZGVzY3JpcHRpb246ICJUaGUgbGluZSBsZW5ndGggd2hlcmUgUHJldHRpZXIgd2lsbCB0cnkgd3JhcC4iLCByYW5nZTogeyBzdGFydDogMCwgZW5kOiBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIHN0ZXA6IDEgfSB9LCByYW5nZUVuZDogeyBzaW5jZTogIjEuNC4wIiwgY2F0ZWdvcnk6IHJvLCB0eXBlOiAiaW50IiwgZGVmYXVsdDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCByYW5nZTogeyBzdGFydDogMCwgZW5kOiBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIHN0ZXA6IDEgfSwgZGVzY3JpcHRpb246IFFhKEdhIHx8IChHYSA9IHZpKFsiXG4gICAgICBGb3JtYXQgY29kZSBlbmRpbmcgYXQgYSBnaXZlbiBjaGFyYWN0ZXIgb2Zmc2V0IChleGNsdXNpdmUpLlxuICAgICAgVGhlIHJhbmdlIHdpbGwgZXh0ZW5kIGZvcndhcmRzIHRvIHRoZSBlbmQgb2YgdGhlIHNlbGVjdGVkIHN0YXRlbWVudC5cbiAgICAgIFRoaXMgb3B0aW9uIGNhbm5vdCBiZSB1c2VkIHdpdGggLS1jdXJzb3Itb2Zmc2V0LlxuICAgICJdKSkpLCBjbGlDYXRlZ29yeTogdG8gfSwgcmFuZ2VTdGFydDogeyBzaW5jZTogIjEuNC4wIiwgY2F0ZWdvcnk6IHJvLCB0eXBlOiAiaW50IiwgZGVmYXVsdDogMCwgcmFuZ2U6IHsgc3RhcnQ6IDAsIGVuZDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBzdGVwOiAxIH0sIGRlc2NyaXB0aW9uOiBRYShYYSB8fCAoWGEgPSB2aShbIlxuICAgICAgRm9ybWF0IGNvZGUgc3RhcnRpbmcgYXQgYSBnaXZlbiBjaGFyYWN0ZXIgb2Zmc2V0LlxuICAgICAgVGhlIHJhbmdlIHdpbGwgZXh0ZW5kIGJhY2t3YXJkcyB0byB0aGUgc3RhcnQgb2YgdGhlIGZpcnN0IGxpbmUgY29udGFpbmluZyB0aGUgc2VsZWN0ZWQgc3RhdGVtZW50LlxuICAgICAgVGhpcyBvcHRpb24gY2Fubm90IGJlIHVzZWQgd2l0aCAtLWN1cnNvci1vZmZzZXQuXG4gICAgIl0pKSksIGNsaUNhdGVnb3J5OiB0byB9LCByZXF1aXJlUHJhZ21hOiB7IHNpbmNlOiAiMS43LjAiLCBjYXRlZ29yeTogcm8sIHR5cGU6ICJib29sZWFuIiwgZGVmYXVsdDogZmFsc2UsIGRlc2NyaXB0aW9uOiBRYShKYSB8fCAoSmEgPSB2aShbIlxuICAgICAgUmVxdWlyZSBlaXRoZXIgJ0BwcmV0dGllcicgb3IgJ0Bmb3JtYXQnIHRvIGJlIHByZXNlbnQgaW4gdGhlIGZpbGUncyBmaXJzdCBkb2NibG9jayBjb21tZW50XG4gICAgICBpbiBvcmRlciBmb3IgaXQgdG8gYmUgZm9ybWF0dGVkLlxuICAgICJdKSkpLCBjbGlDYXRlZ29yeTogZW8gfSwgdGFiV2lkdGg6IHsgdHlwZTogImludCIsIGNhdGVnb3J5OiBzbywgZGVmYXVsdDogMiwgZGVzY3JpcHRpb246ICJOdW1iZXIgb2Ygc3BhY2VzIHBlciBpbmRlbnRhdGlvbiBsZXZlbC4iLCByYW5nZTogeyBzdGFydDogMCwgZW5kOiBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIHN0ZXA6IDEgfSB9LCB1c2VUYWJzOiB7IHNpbmNlOiAiMS4wLjAiLCBjYXRlZ29yeTogc28sIHR5cGU6ICJib29sZWFuIiwgZGVmYXVsdDogZmFsc2UsIGRlc2NyaXB0aW9uOiAiSW5kZW50IHdpdGggdGFicyBpbnN0ZWFkIG9mIHNwYWNlcy4iIH0sIGVtYmVkZGVkTGFuZ3VhZ2VGb3JtYXR0aW5nOiB7IHNpbmNlOiAiMi4xLjAiLCBjYXRlZ29yeTogc28sIHR5cGU6ICJjaG9pY2UiLCBkZWZhdWx0OiBbeyBzaW5jZTogIjIuMS4wIiwgdmFsdWU6ICJhdXRvIiB9XSwgZGVzY3JpcHRpb246ICJDb250cm9sIGhvdyBQcmV0dGllciBmb3JtYXRzIHF1b3RlZCBjb2RlIGVtYmVkZGVkIGluIHRoZSBmaWxlLiIsIGNob2ljZXM6IFt7IHZhbHVlOiAiYXV0byIsIGRlc2NyaXB0aW9uOiAiRm9ybWF0IGVtYmVkZGVkIGNvZGUgaWYgUHJldHRpZXIgY2FuIGF1dG9tYXRpY2FsbHkgaWRlbnRpZnkgaXQuIiB9LCB7IHZhbHVlOiAib2ZmIiwgZGVzY3JpcHRpb246ICJOZXZlciBhdXRvbWF0aWNhbGx5IGZvcm1hdCBlbWJlZGRlZCBjb2RlLiIgfV0gfSB9OwogICAgICAgIGNvbnN0IG5vID0gWyJjbGlOYW1lIiwgImNsaUNhdGVnb3J5IiwgImNsaURlc2NyaXB0aW9uIl0sIGFvID0geyBjb21wYXJlOiBfYSwgbHQ6IEhhLCBndGU6ICRhIH0sIG9vID0gKHQyLCBlMikgPT4gT2JqZWN0LmVudHJpZXModDIpLm1hcCgodDMpID0+IHsKICAgICAgICAgIGxldCBbczIsIHIyXSA9IHQzOwogICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oeyBbZTJdOiBzMiB9LCByMik7CiAgICAgICAgfSksIHVvID0gIjIuNS4xIiwgaG8gPSB7IENBVEVHT1JZX0NPTkZJRzogWmEsIENBVEVHT1JZX0VESVRPUjogdG8sIENBVEVHT1JZX0ZPUk1BVDogIkZvcm1hdCIsIENBVEVHT1JZX09USEVSOiBlbywgQ0FURUdPUllfT1VUUFVUOiAiT3V0cHV0IiwgQ0FURUdPUllfR0xPQkFMOiBzbywgQ0FURUdPUllfU1BFQ0lBTDogcm8sIG9wdGlvbnM6IGlvIH0ub3B0aW9uczsKICAgICAgICBmdW5jdGlvbiBwbyh0MiwgZTIsIHMyKSB7CiAgICAgICAgICBjb25zdCByMiA9IG5ldyBTZXQodDIuY2hvaWNlcy5tYXAoKHQzKSA9PiB0My52YWx1ZSkpOwogICAgICAgICAgZm9yIChjb25zdCBpMiBvZiBlMikKICAgICAgICAgICAgaWYgKGkyLnBhcnNlcnMpIHsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIGkyLnBhcnNlcnMpCiAgICAgICAgICAgICAgICBpZiAoIXIyLmhhcyhlMykpIHsKICAgICAgICAgICAgICAgICAgcjIuYWRkKGUzKTsKICAgICAgICAgICAgICAgICAgY29uc3QgbjIgPSBzMi5maW5kKCh0MykgPT4gdDMucGFyc2VycyAmJiB0My5wYXJzZXJzW2UzXSk7CiAgICAgICAgICAgICAgICAgIGxldCBhMiA9IGkyLm5hbWU7CiAgICAgICAgICAgICAgICAgIG4yICYmIG4yLm5hbWUgJiYgKGEyICs9ICIgKHBsdWdpbjogIi5jb25jYXQobjIubmFtZSwgIikiKSksIHQyLmNob2ljZXMucHVzaCh7IHZhbHVlOiBlMywgZGVzY3JpcHRpb246IGEyIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBjbyA9IHsgZ2V0U3VwcG9ydEluZm86IGZ1bmN0aW9uKCkgewogICAgICAgICAgbGV0IHsgcGx1Z2luczogdDIgPSBbXSwgc2hvd1VucmVsZWFzZWQ6IGUyID0gZmFsc2UsIHNob3dEZXByZWNhdGVkOiBzMiA9IGZhbHNlLCBzaG93SW50ZXJuYWw6IHIyID0gZmFsc2UgfSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgICAgICBjb25zdCBpMiA9IHVvLnNwbGl0KCItIiwgMSlbMF0sIG4yID0gdDIuZmxhdE1hcCgodDMpID0+IHQzLmxhbmd1YWdlcyB8fCBbXSkuZmlsdGVyKG8yKSwgYTIgPSBvbyhPYmplY3QuYXNzaWduKHt9LCAuLi50Mi5tYXAoKHQzKSA9PiB7CiAgICAgICAgICAgIGxldCB7IG9wdGlvbnM6IGUzIH0gPSB0MzsKICAgICAgICAgICAgcmV0dXJuIGUzOwogICAgICAgICAgfSksIGhvKSwgIm5hbWUiKS5maWx0ZXIoKHQzKSA9PiBvMih0MykgJiYgdTIodDMpKS5zb3J0KCh0MywgZTMpID0+IHQzLm5hbWUgPT09IGUzLm5hbWUgPyAwIDogdDMubmFtZSA8IGUzLm5hbWUgPyAtMSA6IDEpLm1hcChoMikubWFwKChlMykgPT4gewogICAgICAgICAgICBlMyA9IE9iamVjdC5hc3NpZ24oe30sIGUzKSwgQXJyYXkuaXNBcnJheShlMy5kZWZhdWx0KSAmJiAoZTMuZGVmYXVsdCA9IGUzLmRlZmF1bHQubGVuZ3RoID09PSAxID8gZTMuZGVmYXVsdFswXS52YWx1ZSA6IGUzLmRlZmF1bHQuZmlsdGVyKG8yKS5zb3J0KCh0MywgZTQpID0+IGFvLmNvbXBhcmUoZTQuc2luY2UsIHQzLnNpbmNlKSlbMF0udmFsdWUpLCBBcnJheS5pc0FycmF5KGUzLmNob2ljZXMpICYmIChlMy5jaG9pY2VzID0gZTMuY2hvaWNlcy5maWx0ZXIoKHQzKSA9PiBvMih0MykgJiYgdTIodDMpKSwgZTMubmFtZSA9PT0gInBhcnNlciIgJiYgcG8oZTMsIG4yLCB0MikpOwogICAgICAgICAgICBjb25zdCBzMyA9IE9iamVjdC5mcm9tRW50cmllcyh0Mi5maWx0ZXIoKHQzKSA9PiB0My5kZWZhdWx0T3B0aW9ucyAmJiB0My5kZWZhdWx0T3B0aW9uc1tlMy5uYW1lXSAhPT0gdm9pZCAwKS5tYXAoKHQzKSA9PiBbdDMubmFtZSwgdDMuZGVmYXVsdE9wdGlvbnNbZTMubmFtZV1dKSk7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGUzKSwge30sIHsgcGx1Z2luRGVmYXVsdHM6IHMzIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4geyBsYW5ndWFnZXM6IG4yLCBvcHRpb25zOiBhMiB9OwogICAgICAgICAgZnVuY3Rpb24gbzIodDMpIHsKICAgICAgICAgICAgcmV0dXJuIGUyIHx8ICEoInNpbmNlIiBpbiB0MykgfHwgdDMuc2luY2UgJiYgYW8uZ3RlKGkyLCB0My5zaW5jZSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiB1Mih0MykgewogICAgICAgICAgICByZXR1cm4gczIgfHwgISgiZGVwcmVjYXRlZCIgaW4gdDMpIHx8IHQzLmRlcHJlY2F0ZWQgJiYgYW8ubHQoaTIsIHQzLmRlcHJlY2F0ZWQpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gaDIodDMpIHsKICAgICAgICAgICAgaWYgKHIyKQogICAgICAgICAgICAgIHJldHVybiB0MzsKICAgICAgICAgICAgcmV0dXJuIElpKHQzLCBubyk7CiAgICAgICAgICB9CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IGxvID0gRmkuZXhwb3J0cywgRG8gPSAodDIpID0+IHsKICAgICAgICAgIGlmICh0eXBlb2YgdDIgIT0gInN0cmluZyIpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkV4cGVjdGVkIGEgc3RyaW5nIik7CiAgICAgICAgICByZXR1cm4gdDIucmVwbGFjZSgvW3xcXHt9KClbXF1eJCsqPy5dL2csICJcXCQmIikucmVwbGFjZSgvLS9nLCAiXFx4MmQiKTsKICAgICAgICB9LCBtbyA9IE5pLCB7IGdldFN1cHBvcnRJbmZvOiBmbyB9ID0gY28sIHlvID0gL1teXHgyMC1ceDdGXS87CiAgICAgICAgZnVuY3Rpb24gRW8odDIpIHsKICAgICAgICAgIHJldHVybiAoZTIsIHMyLCByMikgPT4gewogICAgICAgICAgICBjb25zdCBpMiA9IHIyICYmIHIyLmJhY2t3YXJkczsKICAgICAgICAgICAgaWYgKHMyID09PSBmYWxzZSkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHsgbGVuZ3RoOiBuMiB9ID0gZTI7CiAgICAgICAgICAgIGxldCBhMiA9IHMyOwogICAgICAgICAgICBmb3IgKDsgYTIgPj0gMCAmJiBhMiA8IG4yOyApIHsKICAgICAgICAgICAgICBjb25zdCBzMyA9IGUyLmNoYXJBdChhMik7CiAgICAgICAgICAgICAgaWYgKHQyIGluc3RhbmNlb2YgUmVnRXhwKSB7CiAgICAgICAgICAgICAgICBpZiAoIXQyLnRlc3QoczMpKQogICAgICAgICAgICAgICAgICByZXR1cm4gYTI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICghdDIuaW5jbHVkZXMoczMpKQogICAgICAgICAgICAgICAgcmV0dXJuIGEyOwogICAgICAgICAgICAgIGkyID8gYTItLSA6IGEyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChhMiA9PT0gLTEgfHwgYTIgPT09IG4yKSAmJiBhMjsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGNvbnN0IEFvID0gRW8oL1xzLyksIENvID0gRW8oIiAJIiksIHhvID0gRW8oIiw7IAkiKSwgRm8gPSBFbygvW15cblxyXS8pOwogICAgICAgIGZ1bmN0aW9uIGdvKHQyLCBlMikgewogICAgICAgICAgaWYgKGUyID09PSBmYWxzZSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgaWYgKHQyLmNoYXJBdChlMikgPT09ICIvIiAmJiB0Mi5jaGFyQXQoZTIgKyAxKSA9PT0gIioiKSB7CiAgICAgICAgICAgIGZvciAobGV0IHMyID0gZTIgKyAyOyBzMiA8IHQyLmxlbmd0aDsgKytzMikKICAgICAgICAgICAgICBpZiAodDIuY2hhckF0KHMyKSA9PT0gIioiICYmIHQyLmNoYXJBdChzMiArIDEpID09PSAiLyIpCiAgICAgICAgICAgICAgICByZXR1cm4gczIgKyAyOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBQbyh0MiwgZTIpIHsKICAgICAgICAgIHJldHVybiBlMiAhPT0gZmFsc2UgJiYgKHQyLmNoYXJBdChlMikgPT09ICIvIiAmJiB0Mi5jaGFyQXQoZTIgKyAxKSA9PT0gIi8iID8gRm8odDIsIGUyKSA6IGUyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVG8odDIsIGUyLCBzMikgewogICAgICAgICAgY29uc3QgcjIgPSBzMiAmJiBzMi5iYWNrd2FyZHM7CiAgICAgICAgICBpZiAoZTIgPT09IGZhbHNlKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBjb25zdCBpMiA9IHQyLmNoYXJBdChlMik7CiAgICAgICAgICBpZiAocjIpIHsKICAgICAgICAgICAgaWYgKHQyLmNoYXJBdChlMiAtIDEpID09PSAiXHIiICYmIGkyID09PSAiXG4iKQogICAgICAgICAgICAgIHJldHVybiBlMiAtIDI7CiAgICAgICAgICAgIGlmIChpMiA9PT0gIlxuIiB8fCBpMiA9PT0gIlxyIiB8fCBpMiA9PT0gIlx1MjAyOCIgfHwgaTIgPT09ICJcdTIwMjkiKQogICAgICAgICAgICAgIHJldHVybiBlMiAtIDE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoaTIgPT09ICJcciIgJiYgdDIuY2hhckF0KGUyICsgMSkgPT09ICJcbiIpCiAgICAgICAgICAgICAgcmV0dXJuIGUyICsgMjsKICAgICAgICAgICAgaWYgKGkyID09PSAiXG4iIHx8IGkyID09PSAiXHIiIHx8IGkyID09PSAiXHUyMDI4IiB8fCBpMiA9PT0gIlx1MjAyOSIpCiAgICAgICAgICAgICAgcmV0dXJuIGUyICsgMTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYm8odDIsIGUyKSB7CiAgICAgICAgICBsZXQgczIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICAgICAgY29uc3QgcjIgPSBDbyh0MiwgczIuYmFja3dhcmRzID8gZTIgLSAxIDogZTIsIHMyKSwgaTIgPSBUbyh0MiwgcjIsIHMyKTsKICAgICAgICAgIHJldHVybiByMiAhPT0gaTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFNvKHQyLCBlMikgewogICAgICAgICAgbGV0IHMyID0gbnVsbCwgcjIgPSBlMjsKICAgICAgICAgIGZvciAoOyByMiAhPT0gczI7ICkKICAgICAgICAgICAgczIgPSByMiwgcjIgPSB4byh0MiwgcjIpLCByMiA9IGdvKHQyLCByMiksIHIyID0gQ28odDIsIHIyKTsKICAgICAgICAgIHJldHVybiByMiA9IFBvKHQyLCByMiksIHIyID0gVG8odDIsIHIyKSwgcjIgIT09IGZhbHNlICYmIGJvKHQyLCByMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHdvKHQyLCBlMikgewogICAgICAgICAgbGV0IHMyID0gbnVsbCwgcjIgPSBlMjsKICAgICAgICAgIGZvciAoOyByMiAhPT0gczI7ICkKICAgICAgICAgICAgczIgPSByMiwgcjIgPSBDbyh0MiwgcjIpLCByMiA9IGdvKHQyLCByMiksIHIyID0gUG8odDIsIHIyKSwgcjIgPSBUbyh0MiwgcjIpOwogICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBCbyh0MiwgZTIsIHMyKSB7CiAgICAgICAgICByZXR1cm4gd28odDIsIHMyKGUyKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE5vKHQyLCBlMikgewogICAgICAgICAgbGV0IHMyID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMl0gOiAwLCByMiA9IDA7CiAgICAgICAgICBmb3IgKGxldCBpMiA9IHMyOyBpMiA8IHQyLmxlbmd0aDsgKytpMikKICAgICAgICAgICAgdDJbaTJdID09PSAiCSIgPyByMiA9IHIyICsgZTIgLSByMiAlIGUyIDogcjIrKzsKICAgICAgICAgIHJldHVybiByMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gSW8odDIsIGUyKSB7CiAgICAgICAgICBjb25zdCBzMiA9IHsgcXVvdGU6ICciJywgcmVnZXg6IC8iL2csIGVzY2FwZWQ6ICImcXVvdDsiIH0sIHIyID0geyBxdW90ZTogIiciLCByZWdleDogLycvZywgZXNjYXBlZDogIiZhcG9zOyIgfSwgaTIgPSBlMiA9PT0gIiciID8gcjIgOiBzMiwgbjIgPSBpMiA9PT0gcjIgPyBzMiA6IHIyOwogICAgICAgICAgbGV0IGEyID0gaTI7CiAgICAgICAgICBpZiAodDIuaW5jbHVkZXMoaTIucXVvdGUpIHx8IHQyLmluY2x1ZGVzKG4yLnF1b3RlKSkgewogICAgICAgICAgICBhMiA9ICh0Mi5tYXRjaChpMi5yZWdleCkgfHwgW10pLmxlbmd0aCA+ICh0Mi5tYXRjaChuMi5yZWdleCkgfHwgW10pLmxlbmd0aCA/IG4yIDogaTI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHZvKHQyLCBlMiwgczIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIgPT09ICciJyA/ICInIiA6ICciJywgaTIgPSB0Mi5yZXBsYWNlKC9cXCguKXwoWyInXSkvZ3MsICh0MywgaTMsIG4yKSA9PiBpMyA9PT0gcjIgPyBpMyA6IG4yID09PSBlMiA/ICJcXCIgKyBuMiA6IG4yIHx8IChzMiAmJiAvXlteXG5cciInMC03XFxiZm5ydC12eFx1MjAyOFx1MjAyOV0kLy50ZXN0KGkzKSA/IGkzIDogIlxcIiArIGkzKSk7CiAgICAgICAgICByZXR1cm4gZTIgKyBpMiArIGUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBrbyh0MiwgZTIpIHsKICAgICAgICAgICh0Mi5jb21tZW50cyB8fCAodDIuY29tbWVudHMgPSBbXSkpLnB1c2goZTIpLCBlMi5wcmludGVkID0gZmFsc2UsIGUyLm5vZGVEZXNjcmlwdGlvbiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gdDMudHlwZSB8fCB0My5raW5kIHx8ICIodW5rbm93biB0eXBlKSI7CiAgICAgICAgICAgIGxldCBzMiA9IFN0cmluZyh0My5uYW1lIHx8IHQzLmlkICYmICh0eXBlb2YgdDMuaWQgPT0gIm9iamVjdCIgPyB0My5pZC5uYW1lIDogdDMuaWQpIHx8IHQzLmtleSAmJiAodHlwZW9mIHQzLmtleSA9PSAib2JqZWN0IiA/IHQzLmtleS5uYW1lIDogdDMua2V5KSB8fCB0My52YWx1ZSAmJiAodHlwZW9mIHQzLnZhbHVlID09ICJvYmplY3QiID8gIiIgOiBTdHJpbmcodDMudmFsdWUpKSB8fCB0My5vcGVyYXRvciB8fCAiIik7CiAgICAgICAgICAgIHMyLmxlbmd0aCA+IDIwICYmIChzMiA9IHMyLnNsaWNlKDAsIDE5KSArICJcdTIwMjYiKTsKICAgICAgICAgICAgcmV0dXJuIGUzICsgKHMyID8gIiAiICsgczIgOiAiIik7CiAgICAgICAgICB9KHQyKTsKICAgICAgICB9CiAgICAgICAgdmFyIExvLCBPbyA9IHsgaW5mZXJQYXJzZXJCeUxhbmd1YWdlOiBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIGNvbnN0IHsgbGFuZ3VhZ2VzOiBzMiB9ID0gZm8oeyBwbHVnaW5zOiBlMi5wbHVnaW5zIH0pLCByMiA9IHMyLmZpbmQoKGUzKSA9PiB7CiAgICAgICAgICAgIGxldCB7IG5hbWU6IHMzIH0gPSBlMzsKICAgICAgICAgICAgcmV0dXJuIHMzLnRvTG93ZXJDYXNlKCkgPT09IHQyOwogICAgICAgICAgfSkgfHwgczIuZmluZCgoZTMpID0+IHsKICAgICAgICAgICAgbGV0IHsgYWxpYXNlczogczMgfSA9IGUzOwogICAgICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShzMykgJiYgczMuaW5jbHVkZXModDIpOwogICAgICAgICAgfSkgfHwgczIuZmluZCgoZTMpID0+IHsKICAgICAgICAgICAgbGV0IHsgZXh0ZW5zaW9uczogczMgfSA9IGUzOwogICAgICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShzMykgJiYgczMuaW5jbHVkZXMoIi4iLmNvbmNhdCh0MikpOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gcjIgJiYgcjIucGFyc2Vyc1swXTsKICAgICAgICB9LCBnZXRTdHJpbmdXaWR0aDogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiB0MiA/IHlvLnRlc3QodDIpID8gbG8odDIpIDogdDIubGVuZ3RoIDogMDsKICAgICAgICB9LCBnZXRNYXhDb250aW51b3VzQ291bnQ6IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgY29uc3QgczIgPSB0Mi5tYXRjaChuZXcgUmVnRXhwKCIoIi5jb25jYXQoRG8oZTIpLCAiKSsiKSwgImciKSk7CiAgICAgICAgICByZXR1cm4gczIgPT09IG51bGwgPyAwIDogczIucmVkdWNlKCh0MywgczMpID0+IE1hdGgubWF4KHQzLCBzMy5sZW5ndGggLyBlMi5sZW5ndGgpLCAwKTsKICAgICAgICB9LCBnZXRNaW5Ob3RQcmVzZW50Q29udGludW91c0NvdW50OiBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIGNvbnN0IHMyID0gdDIubWF0Y2gobmV3IFJlZ0V4cCgiKCIuY29uY2F0KERvKGUyKSwgIikrIiksICJnIikpOwogICAgICAgICAgaWYgKHMyID09PSBudWxsKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIGNvbnN0IHIyID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICAgICAgICAgIGxldCBpMiA9IDA7CiAgICAgICAgICBmb3IgKGNvbnN0IHQzIG9mIHMyKSB7CiAgICAgICAgICAgIGNvbnN0IHMzID0gdDMubGVuZ3RoIC8gZTIubGVuZ3RoOwogICAgICAgICAgICByMi5zZXQoczMsIHRydWUpLCBzMyA+IGkyICYmIChpMiA9IHMzKTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAobGV0IHQzID0gMTsgdDMgPCBpMjsgdDMrKykKICAgICAgICAgICAgaWYgKCFyMi5nZXQodDMpKQogICAgICAgICAgICAgIHJldHVybiB0MzsKICAgICAgICAgIHJldHVybiBpMiArIDE7CiAgICAgICAgfSwgZ2V0UGVudWx0aW1hdGU6ICh0MikgPT4gdDJbdDIubGVuZ3RoIC0gMl0sIGdldExhc3Q6IG1vLCBnZXROZXh0Tm9uU3BhY2VOb25Db21tZW50Q2hhcmFjdGVySW5kZXhXaXRoU3RhcnRJbmRleDogd28sIGdldE5leHROb25TcGFjZU5vbkNvbW1lbnRDaGFyYWN0ZXJJbmRleDogQm8sIGdldE5leHROb25TcGFjZU5vbkNvbW1lbnRDaGFyYWN0ZXI6IGZ1bmN0aW9uKHQyLCBlMiwgczIpIHsKICAgICAgICAgIHJldHVybiB0Mi5jaGFyQXQoQm8odDIsIGUyLCBzMikpOwogICAgICAgIH0sIHNraXA6IEVvLCBza2lwV2hpdGVzcGFjZTogQW8sIHNraXBTcGFjZXM6IENvLCBza2lwVG9MaW5lRW5kOiB4bywgc2tpcEV2ZXJ5dGhpbmdCdXROZXdMaW5lOiBGbywgc2tpcElubGluZUNvbW1lbnQ6IGdvLCBza2lwVHJhaWxpbmdDb21tZW50OiBQbywgc2tpcE5ld2xpbmU6IFRvLCBpc05leHRMaW5lRW1wdHlBZnRlckluZGV4OiBTbywgaXNOZXh0TGluZUVtcHR5OiBmdW5jdGlvbih0MiwgZTIsIHMyKSB7CiAgICAgICAgICByZXR1cm4gU28odDIsIHMyKGUyKSk7CiAgICAgICAgfSwgaXNQcmV2aW91c0xpbmVFbXB0eTogZnVuY3Rpb24odDIsIGUyLCBzMikgewogICAgICAgICAgbGV0IHIyID0gczIoZTIpIC0gMTsKICAgICAgICAgIHJldHVybiByMiA9IENvKHQyLCByMiwgeyBiYWNrd2FyZHM6IHRydWUgfSksIHIyID0gVG8odDIsIHIyLCB7IGJhY2t3YXJkczogdHJ1ZSB9KSwgcjIgPSBDbyh0MiwgcjIsIHsgYmFja3dhcmRzOiB0cnVlIH0pLCByMiAhPT0gVG8odDIsIHIyLCB7IGJhY2t3YXJkczogdHJ1ZSB9KTsKICAgICAgICB9LCBoYXNOZXdsaW5lOiBibywgaGFzTmV3bGluZUluUmFuZ2U6IGZ1bmN0aW9uKHQyLCBlMiwgczIpIHsKICAgICAgICAgIGZvciAobGV0IHIyID0gZTI7IHIyIDwgczI7ICsrcjIpCiAgICAgICAgICAgIGlmICh0Mi5jaGFyQXQocjIpID09PSAiXG4iKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0sIGhhc1NwYWNlczogZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICBsZXQgczIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICAgICAgY29uc3QgcjIgPSBDbyh0MiwgczIuYmFja3dhcmRzID8gZTIgLSAxIDogZTIsIHMyKTsKICAgICAgICAgIHJldHVybiByMiAhPT0gZTI7CiAgICAgICAgfSwgZ2V0QWxpZ25tZW50U2l6ZTogTm8sIGdldEluZGVudFNpemU6IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgY29uc3QgczIgPSB0Mi5sYXN0SW5kZXhPZigiXG4iKTsKICAgICAgICAgIHJldHVybiBzMiA9PT0gLTEgPyAwIDogTm8odDIuc2xpY2UoczIgKyAxKS5tYXRjaCgvXltcdCBdKi8pWzBdLCBlMik7CiAgICAgICAgfSwgZ2V0UHJlZmVycmVkUXVvdGU6IElvLCBwcmludFN0cmluZzogZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICBjb25zdCBzMiA9IHQyLnNsaWNlKDEsIC0xKTsKICAgICAgICAgIHJldHVybiB2byhzMiwgZTIucGFyc2VyID09PSAianNvbiIgfHwgZTIucGFyc2VyID09PSAianNvbjUiICYmIGUyLnF1b3RlUHJvcHMgPT09ICJwcmVzZXJ2ZSIgJiYgIWUyLnNpbmdsZVF1b3RlID8gJyInIDogZTIuX19pc0luSHRtbEF0dHJpYnV0ZSA/ICInIiA6IElvKHMyLCBlMi5zaW5nbGVRdW90ZSA/ICInIiA6ICciJykucXVvdGUsICEoZTIucGFyc2VyID09PSAiY3NzIiB8fCBlMi5wYXJzZXIgPT09ICJsZXNzIiB8fCBlMi5wYXJzZXIgPT09ICJzY3NzIiB8fCBlMi5fX2VtYmVkZGVkSW5IdG1sKSk7CiAgICAgICAgfSwgcHJpbnROdW1iZXI6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9eKFsrLV0/W1xkLl0rZSkoPzpcK3woLSkpPzAqKFxkKS8sICIkMSQyJDMiKS5yZXBsYWNlKC9eKFsrLV0/W1xkLl0rKWVbKy1dPzArJC8sICIkMSIpLnJlcGxhY2UoL14oWystXSk/XC4vLCAiJDEwLiIpLnJlcGxhY2UoLyhcLlxkKz8pMCsoPz1lfCQpLywgIiQxIikucmVwbGFjZSgvXC4oPz1lfCQpLywgIiIpOwogICAgICAgIH0sIG1ha2VTdHJpbmc6IHZvLCBhZGRMZWFkaW5nQ29tbWVudDogZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICBlMi5sZWFkaW5nID0gdHJ1ZSwgZTIudHJhaWxpbmcgPSBmYWxzZSwga28odDIsIGUyKTsKICAgICAgICB9LCBhZGREYW5nbGluZ0NvbW1lbnQ6IGZ1bmN0aW9uKHQyLCBlMiwgczIpIHsKICAgICAgICAgIGUyLmxlYWRpbmcgPSBmYWxzZSwgZTIudHJhaWxpbmcgPSBmYWxzZSwgczIgJiYgKGUyLm1hcmtlciA9IHMyKSwga28odDIsIGUyKTsKICAgICAgICB9LCBhZGRUcmFpbGluZ0NvbW1lbnQ6IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgZTIubGVhZGluZyA9IGZhbHNlLCBlMi50cmFpbGluZyA9IHRydWUsIGtvKHQyLCBlMik7CiAgICAgICAgfSwgaXNGcm9udE1hdHRlck5vZGU6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIgJiYgdDIudHlwZSA9PT0gImZyb250LW1hdHRlciI7CiAgICAgICAgfSwgZ2V0U2hlYmFuZzogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIGlmICghdDIuc3RhcnRzV2l0aCgiIyEiKSkKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgY29uc3QgZTIgPSB0Mi5pbmRleE9mKCJcbiIpOwogICAgICAgICAgcmV0dXJuIGUyID09PSAtMSA/IHQyIDogdDIuc2xpY2UoMCwgZTIpOwogICAgICAgIH0sIGlzTm9uRW1wdHlBcnJheTogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHQyKSAmJiB0Mi5sZW5ndGggPiAwOwogICAgICAgIH0sIGNyZWF0ZUdyb3VwSWRNYXBwZXI6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICBjb25zdCBlMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgV2Vha01hcCgpOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHMyKSB7CiAgICAgICAgICAgIHJldHVybiBlMi5oYXMoczIpIHx8IGUyLnNldChzMiwgU3ltYm9sKHQyKSksIGUyLmdldChzMik7CiAgICAgICAgICB9OwogICAgICAgIH0gfSwgTW8gPSB7fTsKICAgICAgICBmdW5jdGlvbiBSbygpIHsKICAgICAgICAgIGlmIChMbyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHZhciB0MiA9IG5ldyBBcnJheUJ1ZmZlcigyKSwgZTIgPSBuZXcgVWludDhBcnJheSh0MiksIHMyID0gbmV3IFVpbnQxNkFycmF5KHQyKTsKICAgICAgICAgICAgaWYgKGUyWzBdID0gMSwgZTJbMV0gPSAyLCBzMlswXSA9PT0gMjU4KQogICAgICAgICAgICAgIExvID0gIkJFIjsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHMyWzBdICE9PSA1MTMpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInVuYWJsZSB0byBmaWd1cmUgb3V0IGVuZGlhbmVzcyIpOwogICAgICAgICAgICAgIExvID0gIkxFIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIExvOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBqbygpIHsKICAgICAgICAgIHJldHVybiAkbi5sb2NhdGlvbiAhPT0gdm9pZCAwID8gJG4ubG9jYXRpb24uaG9zdG5hbWUgOiAiIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVW8oKSB7CiAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIF9vKCkgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHpvKCkgewogICAgICAgICAgcmV0dXJuIE51bWJlci5NQVhfVkFMVUU7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEhvKCkgewogICAgICAgICAgcmV0dXJuIE51bWJlci5NQVhfVkFMVUU7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFZvKCkgewogICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBxbygpIHsKICAgICAgICAgIHJldHVybiAiQnJvd3NlciI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFdvKCkgewogICAgICAgICAgcmV0dXJuICRuLm5hdmlnYXRvciAhPT0gdm9pZCAwID8gJG4ubmF2aWdhdG9yLmFwcFZlcnNpb24gOiAiIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gS28oKSB7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEdvKCkgewogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBYbygpIHsKICAgICAgICAgIHJldHVybiAiamF2YXNjcmlwdCI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEpvKCkgewogICAgICAgICAgcmV0dXJuICJicm93c2VyIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gJG8oKSB7CiAgICAgICAgICByZXR1cm4gIi90bXAiOwogICAgICAgIH0KICAgICAgICB2YXIgWW8gPSAkbywgUW8gPSB7IEVPTDogIlxuIiwgYXJjaDogWG8sIHBsYXRmb3JtOiBKbywgdG1wZGlyOiBZbywgdG1wRGlyOiAkbywgbmV0d29ya0ludGVyZmFjZXM6IEtvLCBnZXROZXR3b3JrSW50ZXJmYWNlczogR28sIHJlbGVhc2U6IFdvLCB0eXBlOiBxbywgY3B1czogVm8sIHRvdGFsbWVtOiBIbywgZnJlZW1lbTogem8sIHVwdGltZTogX28sIGxvYWRhdmc6IFVvLCBob3N0bmFtZTogam8sIGVuZGlhbm5lc3M6IFJvIH0sIFpvID0gZShPYmplY3QuZnJlZXplKHsgX19wcm90b19fOiBudWxsLCBlbmRpYW5uZXNzOiBSbywgaG9zdG5hbWU6IGpvLCBsb2FkYXZnOiBVbywgdXB0aW1lOiBfbywgZnJlZW1lbTogem8sIHRvdGFsbWVtOiBIbywgY3B1czogVm8sIHR5cGU6IHFvLCByZWxlYXNlOiBXbywgbmV0d29ya0ludGVyZmFjZXM6IEtvLCBnZXROZXR3b3JrSW50ZXJmYWNlczogR28sIGFyY2g6IFhvLCBwbGF0Zm9ybTogSm8sIHRtcERpcjogJG8sIHRtcGRpcjogWW8sIEVPTDogIlxuIiwgZGVmYXVsdDogUW8gfSkpLCB0dSA9IHsgZXhwb3J0czoge30gfTsKICAgICAgICBjb25zdCBldSA9ICh0MikgPT4gewogICAgICAgICAgaWYgKHR5cGVvZiB0MiAhPSAic3RyaW5nIikKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiRXhwZWN0ZWQgYSBzdHJpbmciKTsKICAgICAgICAgIGNvbnN0IGUyID0gdDIubWF0Y2goLyg/OlxyP1xuKS9nKSB8fCBbXTsKICAgICAgICAgIGlmIChlMi5sZW5ndGggPT09IDApCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIGNvbnN0IHMyID0gZTIuZmlsdGVyKCh0MykgPT4gdDMgPT09ICJcclxuIikubGVuZ3RoOwogICAgICAgICAgcmV0dXJuIHMyID4gZTIubGVuZ3RoIC0gczIgPyAiXHJcbiIgOiAiXG4iOwogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gc3UoKSB7CiAgICAgICAgICBjb25zdCB0MiA9IFpvOwogICAgICAgICAgcmV0dXJuIHN1ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICAgIH0sIHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBydSgpIHsKICAgICAgICAgIGNvbnN0IHQyID0gKGUyID0gdHUuZXhwb3J0cykgJiYgZTIuX19lc01vZHVsZSA/IGUyIDogeyBkZWZhdWx0OiBlMiB9OwogICAgICAgICAgdmFyIGUyOwogICAgICAgICAgcmV0dXJuIHJ1ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICAgIH0sIHQyOwogICAgICAgIH0KICAgICAgICB0dS5leHBvcnRzID0gZXUsIHR1LmV4cG9ydHMuZ3JhY2VmdWwgPSAodDIpID0+IHR5cGVvZiB0MiA9PSAic3RyaW5nIiAmJiBldSh0MikgfHwgIlxuIiwgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1vLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIE1vLmV4dHJhY3QgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgY29uc3QgZTIgPSB0Mi5tYXRjaChhdSk7CiAgICAgICAgICByZXR1cm4gZTIgPyBlMlswXS50cmltTGVmdCgpIDogIiI7CiAgICAgICAgfSwgTW8uc3RyaXAgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgY29uc3QgZTIgPSB0Mi5tYXRjaChhdSk7CiAgICAgICAgICByZXR1cm4gZTIgJiYgZTJbMF0gPyB0Mi5zdWJzdHJpbmcoZTJbMF0ubGVuZ3RoKSA6IHQyOwogICAgICAgIH0sIE1vLnBhcnNlID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiBkdSh0MikucHJhZ21hczsKICAgICAgICB9LCBNby5wYXJzZVdpdGhDb21tZW50cyA9IGR1LCBNby5wcmludCA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50czogZTIgPSAiIiwgcHJhZ21hczogczIgPSB7fSB9ID0gdDI7CiAgICAgICAgICBjb25zdCByMiA9ICgwLCBydSgpLmRlZmF1bHQpKGUyKSB8fCBzdSgpLkVPTCwgaTIgPSAiICoiLCBuMiA9IE9iamVjdC5rZXlzKHMyKSwgYTIgPSBuMi5tYXAoKHQzKSA9PiBEdSh0MywgczJbdDNdKSkucmVkdWNlKCh0MywgZTMpID0+IHQzLmNvbmNhdChlMyksIFtdKS5tYXAoKHQzKSA9PiAiICogIiArIHQzICsgcjIpLmpvaW4oIiIpOwogICAgICAgICAgaWYgKCFlMikgewogICAgICAgICAgICBpZiAobjIubGVuZ3RoID09PSAwKQogICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgaWYgKG4yLmxlbmd0aCA9PT0gMSAmJiAhQXJyYXkuaXNBcnJheShzMltuMlswXV0pKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSBzMltuMlswXV07CiAgICAgICAgICAgICAgcmV0dXJuICIiLmNvbmNhdCgiLyoqIiwgIiAiKS5jb25jYXQoRHUobjJbMF0sIHQzKVswXSkuY29uY2F0KCIgKi8iKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY29uc3QgbzIgPSBlMi5zcGxpdChyMikubWFwKCh0MykgPT4gIiIuY29uY2F0KGkyLCAiICIpLmNvbmNhdCh0MykpLmpvaW4ocjIpICsgcjI7CiAgICAgICAgICByZXR1cm4gIi8qKiIgKyByMiArIChlMiA/IG8yIDogIiIpICsgKGUyICYmIG4yLmxlbmd0aCA/IGkyICsgcjIgOiAiIikgKyBhMiArICIgKi8iOwogICAgICAgIH07CiAgICAgICAgY29uc3QgaXUgPSAvXCpcLyQvLCBudSA9IC9eXC9cKlwqLywgYXUgPSAvXlxzKihcL1wqXCo/KC58XHI/XG4pKj9cKlwvKS8sIG91ID0gLyhefFxzKylcL1wvKFteXHJcbl0qKS9nLCB1dSA9IC9eKFxyP1xuKSsvLCBodSA9IC8oPzpefFxyP1xuKSAqKEBbXlxyXG5dKj8pICpccj9cbiAqKD8hW15AXHJcbl0qXC9cL1teXSopKFteQFxyXG5cc11bXkBcclxuXSs/KSAqXHI/XG4vZywgcHUgPSAvKD86Xnxccj9cbikgKkAoXFMrKSAqKFteXHJcbl0qKS9nLCBjdSA9IC8oXHI/XG58XikgKlwqID8vZywgbHUgPSBbXTsKICAgICAgICBmdW5jdGlvbiBkdSh0MikgewogICAgICAgICAgY29uc3QgZTIgPSAoMCwgcnUoKS5kZWZhdWx0KSh0MikgfHwgc3UoKS5FT0w7CiAgICAgICAgICB0MiA9IHQyLnJlcGxhY2UobnUsICIiKS5yZXBsYWNlKGl1LCAiIikucmVwbGFjZShjdSwgIiQxIik7CiAgICAgICAgICBsZXQgczIgPSAiIjsKICAgICAgICAgIGZvciAoOyBzMiAhPT0gdDI7ICkKICAgICAgICAgICAgczIgPSB0MiwgdDIgPSB0Mi5yZXBsYWNlKGh1LCAiIi5jb25jYXQoZTIsICIkMSAkMiIpLmNvbmNhdChlMikpOwogICAgICAgICAgdDIgPSB0Mi5yZXBsYWNlKHV1LCAiIikudHJpbVJpZ2h0KCk7CiAgICAgICAgICBjb25zdCByMiA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpLCBpMiA9IHQyLnJlcGxhY2UocHUsICIiKS5yZXBsYWNlKHV1LCAiIikudHJpbVJpZ2h0KCk7CiAgICAgICAgICBsZXQgbjI7CiAgICAgICAgICBmb3IgKDsgbjIgPSBwdS5leGVjKHQyKTsgKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gbjJbMl0ucmVwbGFjZShvdSwgIiIpOwogICAgICAgICAgICB0eXBlb2YgcjJbbjJbMV1dID09ICJzdHJpbmciIHx8IEFycmF5LmlzQXJyYXkocjJbbjJbMV1dKSA/IHIyW24yWzFdXSA9IGx1LmNvbmNhdChyMltuMlsxXV0sIHQzKSA6IHIyW24yWzFdXSA9IHQzOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHsgY29tbWVudHM6IGkyLCBwcmFnbWFzOiByMiB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBEdSh0MiwgZTIpIHsKICAgICAgICAgIHJldHVybiBsdS5jb25jYXQoZTIpLm1hcCgoZTMpID0+ICJAIi5jb25jYXQodDIsICIgIikuY29uY2F0KGUzKS50cmltKCkpOwogICAgICAgIH0KICAgICAgICB2YXIgbXUgPSB7IGd1ZXNzRW5kT2ZMaW5lOiBmdW5jdGlvbih0MikgewogICAgICAgICAgY29uc3QgZTIgPSB0Mi5pbmRleE9mKCJcciIpOwogICAgICAgICAgcmV0dXJuIGUyID49IDAgPyB0Mi5jaGFyQXQoZTIgKyAxKSA9PT0gIlxuIiA/ICJjcmxmIiA6ICJjciIgOiAibGYiOwogICAgICAgIH0sIGNvbnZlcnRFbmRPZkxpbmVUb0NoYXJzOiBmdW5jdGlvbih0MikgewogICAgICAgICAgc3dpdGNoICh0MikgewogICAgICAgICAgICBjYXNlICJjciI6CiAgICAgICAgICAgICAgcmV0dXJuICJcciI7CiAgICAgICAgICAgIGNhc2UgImNybGYiOgogICAgICAgICAgICAgIHJldHVybiAiXHJcbiI7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgcmV0dXJuICJcbiI7CiAgICAgICAgICB9CiAgICAgICAgfSwgY291bnRFbmRPZkxpbmVDaGFyczogZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICBsZXQgczI7CiAgICAgICAgICBpZiAoZTIgPT09ICJcbiIpCiAgICAgICAgICAgIHMyID0gL1xuL2c7CiAgICAgICAgICBlbHNlIGlmIChlMiA9PT0gIlxyIikKICAgICAgICAgICAgczIgPSAvXHIvZzsKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiAoZTIgIT09ICJcclxuIikKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuZXhwZWN0ZWQgImVvbCIgJy5jb25jYXQoSlNPTi5zdHJpbmdpZnkoZTIpLCAiLiIpKTsKICAgICAgICAgICAgczIgPSAvXHJcbi9nOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgcjIgPSB0Mi5tYXRjaChzMik7CiAgICAgICAgICByZXR1cm4gcjIgPyByMi5sZW5ndGggOiAwOwogICAgICAgIH0sIG5vcm1hbGl6ZUVuZE9mTGluZTogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiB0Mi5yZXBsYWNlKC9cclxuPy9nLCAiXG4iKTsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgeyBwYXJzZVdpdGhDb21tZW50czogZnUsIHN0cmlwOiB5dSwgZXh0cmFjdDogRXUsIHByaW50OiBBdSB9ID0gTW8sIHsgZ2V0U2hlYmFuZzogQ3UgfSA9IE9vLCB7IG5vcm1hbGl6ZUVuZE9mTGluZTogeHUgfSA9IG11OwogICAgICAgIGZ1bmN0aW9uIEZ1KHQyKSB7CiAgICAgICAgICBjb25zdCBlMiA9IEN1KHQyKTsKICAgICAgICAgIGUyICYmICh0MiA9IHQyLnNsaWNlKGUyLmxlbmd0aCArIDEpKTsKICAgICAgICAgIGNvbnN0IHMyID0gRXUodDIpLCB7IHByYWdtYXM6IHIyLCBjb21tZW50czogaTIgfSA9IGZ1KHMyKTsKICAgICAgICAgIHJldHVybiB7IHNoZWJhbmc6IGUyLCB0ZXh0OiB0MiwgcHJhZ21hczogcjIsIGNvbW1lbnRzOiBpMiB9OwogICAgICAgIH0KICAgICAgICB2YXIgZ3UgPSB7IGhhc1ByYWdtYTogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIGNvbnN0IGUyID0gT2JqZWN0LmtleXMoRnUodDIpLnByYWdtYXMpOwogICAgICAgICAgcmV0dXJuIGUyLmluY2x1ZGVzKCJwcmV0dGllciIpIHx8IGUyLmluY2x1ZGVzKCJmb3JtYXQiKTsKICAgICAgICB9LCBpbnNlcnRQcmFnbWE6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICBjb25zdCB7IHNoZWJhbmc6IGUyLCB0ZXh0OiBzMiwgcHJhZ21hczogcjIsIGNvbW1lbnRzOiBpMiB9ID0gRnUodDIpLCBuMiA9IHl1KHMyKSwgYTIgPSBBdSh7IHByYWdtYXM6IE9iamVjdC5hc3NpZ24oeyBmb3JtYXQ6ICIiIH0sIHIyKSwgY29tbWVudHM6IGkyLnRyaW1TdGFydCgpIH0pOwogICAgICAgICAgcmV0dXJuIChlMiA/ICIiLmNvbmNhdChlMiwgIlxuIikgOiAiIikgKyB4dShhMikgKyAobjIuc3RhcnRzV2l0aCgiXG4iKSA/ICJcbiIgOiAiXG5cbiIpICsgbjI7CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IHsgaXNOb25FbXB0eUFycmF5OiBQdSB9ID0gT287CiAgICAgICAgZnVuY3Rpb24gVHUodDIsIGUyKSB7CiAgICAgICAgICBjb25zdCB7IGlnbm9yZURlY29yYXRvcnM6IHMyIH0gPSBlMiB8fCB7fTsKICAgICAgICAgIGlmICghczIpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSB0Mi5kZWNsYXJhdGlvbiAmJiB0Mi5kZWNsYXJhdGlvbi5kZWNvcmF0b3JzIHx8IHQyLmRlY29yYXRvcnM7CiAgICAgICAgICAgIGlmIChQdShlMykpCiAgICAgICAgICAgICAgcmV0dXJuIFR1KGUzWzBdKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0Mi5yYW5nZSA/IHQyLnJhbmdlWzBdIDogdDIuc3RhcnQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJ1KHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIucmFuZ2UgPyB0Mi5yYW5nZVsxXSA6IHQyLmVuZDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gU3UodDIsIGUyKSB7CiAgICAgICAgICByZXR1cm4gVHUodDIpID09PSBUdShlMik7CiAgICAgICAgfQogICAgICAgIHZhciB3dSA9IHsgbG9jU3RhcnQ6IFR1LCBsb2NFbmQ6IGJ1LCBoYXNTYW1lTG9jU3RhcnQ6IFN1LCBoYXNTYW1lTG9jOiBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIHJldHVybiBTdSh0MiwgZTIpICYmIGZ1bmN0aW9uKHQzLCBlMykgewogICAgICAgICAgICByZXR1cm4gYnUodDMpID09PSBidShlMyk7CiAgICAgICAgICB9KHQyLCBlMik7CiAgICAgICAgfSB9OwogICAgICAgIGNvbnN0IHsgaGFzUHJhZ21hOiBCdSB9ID0gZ3UsIHsgbG9jU3RhcnQ6IE51LCBsb2NFbmQ6IEl1IH0gPSB3dTsKICAgICAgICB2YXIgdnUgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIHQyID0gdHlwZW9mIHQyID09ICJmdW5jdGlvbiIgPyB7IHBhcnNlOiB0MiB9IDogdDIsIE9iamVjdC5hc3NpZ24oeyBhc3RGb3JtYXQ6ICJlc3RyZWUiLCBoYXNQcmFnbWE6IEJ1LCBsb2NTdGFydDogTnUsIGxvY0VuZDogSXUgfSwgdDIpOwogICAgICAgIH07CiAgICAgICAgdmFyIGt1ID0gZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICBjb25zdCBzMiA9IG5ldyBTeW50YXhFcnJvcih0MiArICIgKCIgKyBlMi5zdGFydC5saW5lICsgIjoiICsgZTIuc3RhcnQuY29sdW1uICsgIikiKTsKICAgICAgICAgIHJldHVybiBzMi5sb2MgPSBlMiwgczI7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBMdSA9IGt1OwogICAgICAgIHZhciBPdSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICBjb25zdCB7IG1lc3NhZ2U6IGUyLCBsb2M6IHMyIH0gPSB0MjsKICAgICAgICAgIHJldHVybiBMdShlMi5yZXBsYWNlKC8gXCguKlwpLywgIiIpLCB7IHN0YXJ0OiB7IGxpbmU6IHMyID8gczIubGluZSA6IDAsIGNvbHVtbjogczIgPyBzMi5jb2x1bW4gKyAxIDogMCB9IH0pOwogICAgICAgIH0sIE11ID0ge30sIFJ1ID0geyBleHBvcnRzOiB7fSB9OwogICAgICAgICFmdW5jdGlvbigpIHsKICAgICAgICAgIGZ1bmN0aW9uIHQyKHQzKSB7CiAgICAgICAgICAgIGlmICh0MyA9PSBudWxsKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3dpdGNoICh0My50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiQmxvY2tTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIkJyZWFrU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJDb250aW51ZVN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiRGVidWdnZXJTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIkRvV2hpbGVTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIkVtcHR5U3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJFeHByZXNzaW9uU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJGb3JJblN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiRm9yU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJJZlN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiTGFiZWxlZFN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiUmV0dXJuU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJTd2l0Y2hTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIlRocm93U3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJUcnlTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIlZhcmlhYmxlRGVjbGFyYXRpb24iOgogICAgICAgICAgICAgIGNhc2UgIldoaWxlU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJXaXRoU3RhdGVtZW50IjoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGUyKHQzKSB7CiAgICAgICAgICAgIHN3aXRjaCAodDMudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgIklmU3RhdGVtZW50IjoKICAgICAgICAgICAgICAgIHJldHVybiB0My5hbHRlcm5hdGUgIT0gbnVsbCA/IHQzLmFsdGVybmF0ZSA6IHQzLmNvbnNlcXVlbnQ7CiAgICAgICAgICAgICAgY2FzZSAiTGFiZWxlZFN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiRm9yU3RhdGVtZW50IjoKICAgICAgICAgICAgICBjYXNlICJGb3JJblN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiV2hpbGVTdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIldpdGhTdGF0ZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIHQzLmJvZHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBSdS5leHBvcnRzID0geyBpc0V4cHJlc3Npb246IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIGlmICh0MyA9PSBudWxsKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3dpdGNoICh0My50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiQXJyYXlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJBc3NpZ25tZW50RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiQmluYXJ5RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiQ2FsbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgIGNhc2UgIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiRnVuY3Rpb25FeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJJZGVudGlmaWVyIjoKICAgICAgICAgICAgICBjYXNlICJMaXRlcmFsIjoKICAgICAgICAgICAgICBjYXNlICJMb2dpY2FsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiTmV3RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiU2VxdWVuY2VFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJUaGlzRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiVW5hcnlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJVcGRhdGVFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0sIGlzU3RhdGVtZW50OiB0MiwgaXNJdGVyYXRpb25TdGF0ZW1lbnQ6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIGlmICh0MyA9PSBudWxsKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3dpdGNoICh0My50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiRG9XaGlsZVN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiRm9ySW5TdGF0ZW1lbnQiOgogICAgICAgICAgICAgIGNhc2UgIkZvclN0YXRlbWVudCI6CiAgICAgICAgICAgICAgY2FzZSAiV2hpbGVTdGF0ZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfSwgaXNTb3VyY2VFbGVtZW50OiBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gdDIoZTMpIHx8IGUzICE9IG51bGwgJiYgZTMudHlwZSA9PT0gIkZ1bmN0aW9uRGVjbGFyYXRpb24iOwogICAgICAgICAgfSwgaXNQcm9ibGVtYXRpY0lmU3RhdGVtZW50OiBmdW5jdGlvbih0MykgewogICAgICAgICAgICB2YXIgczI7CiAgICAgICAgICAgIGlmICh0My50eXBlICE9PSAiSWZTdGF0ZW1lbnQiKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKHQzLmFsdGVybmF0ZSA9PSBudWxsKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgczIgPSB0My5jb25zZXF1ZW50OwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgaWYgKHMyLnR5cGUgPT09ICJJZlN0YXRlbWVudCIgJiYgczIuYWx0ZXJuYXRlID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICBzMiA9IGUyKHMyKTsKICAgICAgICAgICAgfSB3aGlsZSAoczIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9LCB0cmFpbGluZ1N0YXRlbWVudDogZTIgfTsKICAgICAgICB9KCk7CiAgICAgICAgdmFyIGp1ID0geyBleHBvcnRzOiB7fSB9OwogICAgICAgICFmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciB0MiwgZTIsIHMyLCByMiwgaTIsIG4yOwogICAgICAgICAgZnVuY3Rpb24gYTIodDMpIHsKICAgICAgICAgICAgcmV0dXJuIHQzIDw9IDY1NTM1ID8gU3RyaW5nLmZyb21DaGFyQ29kZSh0MykgOiBTdHJpbmcuZnJvbUNoYXJDb2RlKE1hdGguZmxvb3IoKHQzIC0gNjU1MzYpIC8gMTAyNCkgKyA1NTI5NikgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKCh0MyAtIDY1NTM2KSAlIDEwMjQgKyA1NjMyMCk7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGUyID0geyBOb25Bc2NpaUlkZW50aWZpZXJTdGFydDogL1tceEFBXHhCNVx4QkFceEMwLVx4RDZceEQ4LVx4RjZceEY4LVx1MDJDMVx1MDJDNi1cdTAyRDFcdTAyRTAtXHUwMkU0XHUwMkVDXHUwMkVFXHUwMzcwLVx1MDM3NFx1MDM3Nlx1MDM3N1x1MDM3QS1cdTAzN0RcdTAzN0ZcdTAzODZcdTAzODgtXHUwMzhBXHUwMzhDXHUwMzhFLVx1MDNBMVx1MDNBMy1cdTAzRjVcdTAzRjctXHUwNDgxXHUwNDhBLVx1MDUyRlx1MDUzMS1cdTA1NTZcdTA1NTlcdTA1NjEtXHUwNTg3XHUwNUQwLVx1MDVFQVx1MDVGMC1cdTA1RjJcdTA2MjAtXHUwNjRBXHUwNjZFXHUwNjZGXHUwNjcxLVx1MDZEM1x1MDZENVx1MDZFNVx1MDZFNlx1MDZFRVx1MDZFRlx1MDZGQS1cdTA2RkNcdTA2RkZcdTA3MTBcdTA3MTItXHUwNzJGXHUwNzRELVx1MDdBNVx1MDdCMVx1MDdDQS1cdTA3RUFcdTA3RjRcdTA3RjVcdTA3RkFcdTA4MDAtXHUwODE1XHUwODFBXHUwODI0XHUwODI4XHUwODQwLVx1MDg1OFx1MDhBMC1cdTA4QjRcdTA4QjYtXHUwOEJEXHUwOTA0LVx1MDkzOVx1MDkzRFx1MDk1MFx1MDk1OC1cdTA5NjFcdTA5NzEtXHUwOTgwXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCRFx1MDlDRVx1MDlEQ1x1MDlERFx1MDlERi1cdTA5RTFcdTA5RjBcdTA5RjFcdTBBMDUtXHUwQTBBXHUwQTBGXHUwQTEwXHUwQTEzLVx1MEEyOFx1MEEyQS1cdTBBMzBcdTBBMzJcdTBBMzNcdTBBMzVcdTBBMzZcdTBBMzhcdTBBMzlcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTcyLVx1MEE3NFx1MEE4NS1cdTBBOERcdTBBOEYtXHUwQTkxXHUwQTkzLVx1MEFBOFx1MEFBQS1cdTBBQjBcdTBBQjJcdTBBQjNcdTBBQjUtXHUwQUI5XHUwQUJEXHUwQUQwXHUwQUUwXHUwQUUxXHUwQUY5XHUwQjA1LVx1MEIwQ1x1MEIwRlx1MEIxMFx1MEIxMy1cdTBCMjhcdTBCMkEtXHUwQjMwXHUwQjMyXHUwQjMzXHUwQjM1LVx1MEIzOVx1MEIzRFx1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjFcdTBCNzFcdTBCODNcdTBCODUtXHUwQjhBXHUwQjhFLVx1MEI5MFx1MEI5Mi1cdTBCOTVcdTBCOTlcdTBCOUFcdTBCOUNcdTBCOUVcdTBCOUZcdTBCQTNcdTBCQTRcdTBCQTgtXHUwQkFBXHUwQkFFLVx1MEJCOVx1MEJEMFx1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0RcdTBDNTgtXHUwQzVBXHUwQzYwXHUwQzYxXHUwQzgwXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkRcdTBDREVcdTBDRTBcdTBDRTFcdTBDRjFcdTBDRjJcdTBEMDUtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0RcdTBENEVcdTBENTQtXHUwRDU2XHUwRDVGLVx1MEQ2MVx1MEQ3QS1cdTBEN0ZcdTBEODUtXHUwRDk2XHUwRDlBLVx1MERCMVx1MERCMy1cdTBEQkJcdTBEQkRcdTBEQzAtXHUwREM2XHUwRTAxLVx1MEUzMFx1MEUzMlx1MEUzM1x1MEU0MC1cdTBFNDZcdTBFODFcdTBFODJcdTBFODRcdTBFODdcdTBFODhcdTBFOEFcdTBFOERcdTBFOTQtXHUwRTk3XHUwRTk5LVx1MEU5Rlx1MEVBMS1cdTBFQTNcdTBFQTVcdTBFQTdcdTBFQUFcdTBFQUJcdTBFQUQtXHUwRUIwXHUwRUIyXHUwRUIzXHUwRUJEXHUwRUMwLVx1MEVDNFx1MEVDNlx1MEVEQy1cdTBFREZcdTBGMDBcdTBGNDAtXHUwRjQ3XHUwRjQ5LVx1MEY2Q1x1MEY4OC1cdTBGOENcdTEwMDAtXHUxMDJBXHUxMDNGXHUxMDUwLVx1MTA1NVx1MTA1QS1cdTEwNURcdTEwNjFcdTEwNjVcdTEwNjZcdTEwNkUtXHUxMDcwXHUxMDc1LVx1MTA4MVx1MTA4RVx1MTBBMC1cdTEwQzVcdTEwQzdcdTEwQ0RcdTEwRDAtXHUxMEZBXHUxMEZDLVx1MTI0OFx1MTI0QS1cdTEyNERcdTEyNTAtXHUxMjU2XHUxMjU4XHUxMjVBLVx1MTI1RFx1MTI2MC1cdTEyODhcdTEyOEEtXHUxMjhEXHUxMjkwLVx1MTJCMFx1MTJCMi1cdTEyQjVcdTEyQjgtXHUxMkJFXHUxMkMwXHUxMkMyLVx1MTJDNVx1MTJDOC1cdTEyRDZcdTEyRDgtXHUxMzEwXHUxMzEyLVx1MTMxNVx1MTMxOC1cdTEzNUFcdTEzODAtXHUxMzhGXHUxM0EwLVx1MTNGNVx1MTNGOC1cdTEzRkRcdTE0MDEtXHUxNjZDXHUxNjZGLVx1MTY3Rlx1MTY4MS1cdTE2OUFcdTE2QTAtXHUxNkVBXHUxNkVFLVx1MTZGOFx1MTcwMC1cdTE3MENcdTE3MEUtXHUxNzExXHUxNzIwLVx1MTczMVx1MTc0MC1cdTE3NTFcdTE3NjAtXHUxNzZDXHUxNzZFLVx1MTc3MFx1MTc4MC1cdTE3QjNcdTE3RDdcdTE3RENcdTE4MjAtXHUxODc3XHUxODgwLVx1MTg4NFx1MTg4Ny1cdTE4QThcdTE4QUFcdTE4QjAtXHUxOEY1XHUxOTAwLVx1MTkxRVx1MTk1MC1cdTE5NkRcdTE5NzAtXHUxOTc0XHUxOTgwLVx1MTlBQlx1MTlCMC1cdTE5QzlcdTFBMDAtXHUxQTE2XHUxQTIwLVx1MUE1NFx1MUFBN1x1MUIwNS1cdTFCMzNcdTFCNDUtXHUxQjRCXHUxQjgzLVx1MUJBMFx1MUJBRVx1MUJBRlx1MUJCQS1cdTFCRTVcdTFDMDAtXHUxQzIzXHUxQzRELVx1MUM0Rlx1MUM1QS1cdTFDN0RcdTFDODAtXHUxQzg4XHUxQ0U5LVx1MUNFQ1x1MUNFRS1cdTFDRjFcdTFDRjVcdTFDRjZcdTFEMDAtXHUxREJGXHUxRTAwLVx1MUYxNVx1MUYxOC1cdTFGMURcdTFGMjAtXHUxRjQ1XHUxRjQ4LVx1MUY0RFx1MUY1MC1cdTFGNTdcdTFGNTlcdTFGNUJcdTFGNURcdTFGNUYtXHUxRjdEXHUxRjgwLVx1MUZCNFx1MUZCNi1cdTFGQkNcdTFGQkVcdTFGQzItXHUxRkM0XHUxRkM2LVx1MUZDQ1x1MUZEMC1cdTFGRDNcdTFGRDYtXHUxRkRCXHUxRkUwLVx1MUZFQ1x1MUZGMi1cdTFGRjRcdTFGRjYtXHUxRkZDXHUyMDcxXHUyMDdGXHUyMDkwLVx1MjA5Q1x1MjEwMlx1MjEwN1x1MjEwQS1cdTIxMTNcdTIxMTVcdTIxMTktXHUyMTFEXHUyMTI0XHUyMTI2XHUyMTI4XHUyMTJBLVx1MjEyRFx1MjEyRi1cdTIxMzlcdTIxM0MtXHUyMTNGXHUyMTQ1LVx1MjE0OVx1MjE0RVx1MjE2MC1cdTIxODhcdTJDMDAtXHUyQzJFXHUyQzMwLVx1MkM1RVx1MkM2MC1cdTJDRTRcdTJDRUItXHUyQ0VFXHUyQ0YyXHUyQ0YzXHUyRDAwLVx1MkQyNVx1MkQyN1x1MkQyRFx1MkQzMC1cdTJENjdcdTJENkZcdTJEODAtXHUyRDk2XHUyREEwLVx1MkRBNlx1MkRBOC1cdTJEQUVcdTJEQjAtXHUyREI2XHUyREI4LVx1MkRCRVx1MkRDMC1cdTJEQzZcdTJEQzgtXHUyRENFXHUyREQwLVx1MkRENlx1MkREOC1cdTJEREVcdTJFMkZcdTMwMDUtXHUzMDA3XHUzMDIxLVx1MzAyOVx1MzAzMS1cdTMwMzVcdTMwMzgtXHUzMDNDXHUzMDQxLVx1MzA5Nlx1MzA5RC1cdTMwOUZcdTMwQTEtXHUzMEZBXHUzMEZDLVx1MzBGRlx1MzEwNS1cdTMxMkRcdTMxMzEtXHUzMThFXHUzMUEwLVx1MzFCQVx1MzFGMC1cdTMxRkZcdTM0MDAtXHU0REI1XHU0RTAwLVx1OUZENVx1QTAwMC1cdUE0OENcdUE0RDAtXHVBNEZEXHVBNTAwLVx1QTYwQ1x1QTYxMC1cdUE2MUZcdUE2MkFcdUE2MkJcdUE2NDAtXHVBNjZFXHVBNjdGLVx1QTY5RFx1QTZBMC1cdUE2RUZcdUE3MTctXHVBNzFGXHVBNzIyLVx1QTc4OFx1QTc4Qi1cdUE3QUVcdUE3QjAtXHVBN0I3XHVBN0Y3LVx1QTgwMVx1QTgwMy1cdUE4MDVcdUE4MDctXHVBODBBXHVBODBDLVx1QTgyMlx1QTg0MC1cdUE4NzNcdUE4ODItXHVBOEIzXHVBOEYyLVx1QThGN1x1QThGQlx1QThGRFx1QTkwQS1cdUE5MjVcdUE5MzAtXHVBOTQ2XHVBOTYwLVx1QTk3Q1x1QTk4NC1cdUE5QjJcdUE5Q0ZcdUE5RTAtXHVBOUU0XHVBOUU2LVx1QTlFRlx1QTlGQS1cdUE5RkVcdUFBMDAtXHVBQTI4XHVBQTQwLVx1QUE0Mlx1QUE0NC1cdUFBNEJcdUFBNjAtXHVBQTc2XHVBQTdBXHVBQTdFLVx1QUFBRlx1QUFCMVx1QUFCNVx1QUFCNlx1QUFCOS1cdUFBQkRcdUFBQzBcdUFBQzJcdUFBREItXHVBQUREXHVBQUUwLVx1QUFFQVx1QUFGMi1cdUFBRjRcdUFCMDEtXHVBQjA2XHVBQjA5LVx1QUIwRVx1QUIxMS1cdUFCMTZcdUFCMjAtXHVBQjI2XHVBQjI4LVx1QUIyRVx1QUIzMC1cdUFCNUFcdUFCNUMtXHVBQjY1XHVBQjcwLVx1QUJFMlx1QUMwMC1cdUQ3QTNcdUQ3QjAtXHVEN0M2XHVEN0NCLVx1RDdGQlx1RjkwMC1cdUZBNkRcdUZBNzAtXHVGQUQ5XHVGQjAwLVx1RkIwNlx1RkIxMy1cdUZCMTdcdUZCMURcdUZCMUYtXHVGQjI4XHVGQjJBLVx1RkIzNlx1RkIzOC1cdUZCM0NcdUZCM0VcdUZCNDBcdUZCNDFcdUZCNDNcdUZCNDRcdUZCNDYtXHVGQkIxXHVGQkQzLVx1RkQzRFx1RkQ1MC1cdUZEOEZcdUZEOTItXHVGREM3XHVGREYwLVx1RkRGQlx1RkU3MC1cdUZFNzRcdUZFNzYtXHVGRUZDXHVGRjIxLVx1RkYzQVx1RkY0MS1cdUZGNUFcdUZGNjYtXHVGRkJFXHVGRkMyLVx1RkZDN1x1RkZDQS1cdUZGQ0ZcdUZGRDItXHVGRkQ3XHVGRkRBLVx1RkZEQ10vLCBOb25Bc2NpaUlkZW50aWZpZXJQYXJ0OiAvW1x4QUFceEI1XHhCQVx4QzAtXHhENlx4RDgtXHhGNlx4RjgtXHUwMkMxXHUwMkM2LVx1MDJEMVx1MDJFMC1cdTAyRTRcdTAyRUNcdTAyRUVcdTAzMDAtXHUwMzc0XHUwMzc2XHUwMzc3XHUwMzdBLVx1MDM3RFx1MDM3Rlx1MDM4Nlx1MDM4OC1cdTAzOEFcdTAzOENcdTAzOEUtXHUwM0ExXHUwM0EzLVx1MDNGNVx1MDNGNy1cdTA0ODFcdTA0ODMtXHUwNDg3XHUwNDhBLVx1MDUyRlx1MDUzMS1cdTA1NTZcdTA1NTlcdTA1NjEtXHUwNTg3XHUwNTkxLVx1MDVCRFx1MDVCRlx1MDVDMVx1MDVDMlx1MDVDNFx1MDVDNVx1MDVDN1x1MDVEMC1cdTA1RUFcdTA1RjAtXHUwNUYyXHUwNjEwLVx1MDYxQVx1MDYyMC1cdTA2NjlcdTA2NkUtXHUwNkQzXHUwNkQ1LVx1MDZEQ1x1MDZERi1cdTA2RThcdTA2RUEtXHUwNkZDXHUwNkZGXHUwNzEwLVx1MDc0QVx1MDc0RC1cdTA3QjFcdTA3QzAtXHUwN0Y1XHUwN0ZBXHUwODAwLVx1MDgyRFx1MDg0MC1cdTA4NUJcdTA4QTAtXHUwOEI0XHUwOEI2LVx1MDhCRFx1MDhENC1cdTA4RTFcdTA4RTMtXHUwOTYzXHUwOTY2LVx1MDk2Rlx1MDk3MS1cdTA5ODNcdTA5ODUtXHUwOThDXHUwOThGXHUwOTkwXHUwOTkzLVx1MDlBOFx1MDlBQS1cdTA5QjBcdTA5QjJcdTA5QjYtXHUwOUI5XHUwOUJDLVx1MDlDNFx1MDlDN1x1MDlDOFx1MDlDQi1cdTA5Q0VcdTA5RDdcdTA5RENcdTA5RERcdTA5REYtXHUwOUUzXHUwOUU2LVx1MDlGMVx1MEEwMS1cdTBBMDNcdTBBMDUtXHUwQTBBXHUwQTBGXHUwQTEwXHUwQTEzLVx1MEEyOFx1MEEyQS1cdTBBMzBcdTBBMzJcdTBBMzNcdTBBMzVcdTBBMzZcdTBBMzhcdTBBMzlcdTBBM0NcdTBBM0UtXHUwQTQyXHUwQTQ3XHUwQTQ4XHUwQTRCLVx1MEE0RFx1MEE1MVx1MEE1OS1cdTBBNUNcdTBBNUVcdTBBNjYtXHUwQTc1XHUwQTgxLVx1MEE4M1x1MEE4NS1cdTBBOERcdTBBOEYtXHUwQTkxXHUwQTkzLVx1MEFBOFx1MEFBQS1cdTBBQjBcdTBBQjJcdTBBQjNcdTBBQjUtXHUwQUI5XHUwQUJDLVx1MEFDNVx1MEFDNy1cdTBBQzlcdTBBQ0ItXHUwQUNEXHUwQUQwXHUwQUUwLVx1MEFFM1x1MEFFNi1cdTBBRUZcdTBBRjlcdTBCMDEtXHUwQjAzXHUwQjA1LVx1MEIwQ1x1MEIwRlx1MEIxMFx1MEIxMy1cdTBCMjhcdTBCMkEtXHUwQjMwXHUwQjMyXHUwQjMzXHUwQjM1LVx1MEIzOVx1MEIzQy1cdTBCNDRcdTBCNDdcdTBCNDhcdTBCNEItXHUwQjREXHUwQjU2XHUwQjU3XHUwQjVDXHUwQjVEXHUwQjVGLVx1MEI2M1x1MEI2Ni1cdTBCNkZcdTBCNzFcdTBCODJcdTBCODNcdTBCODUtXHUwQjhBXHUwQjhFLVx1MEI5MFx1MEI5Mi1cdTBCOTVcdTBCOTlcdTBCOUFcdTBCOUNcdTBCOUVcdTBCOUZcdTBCQTNcdTBCQTRcdTBCQTgtXHUwQkFBXHUwQkFFLVx1MEJCOVx1MEJCRS1cdTBCQzJcdTBCQzYtXHUwQkM4XHUwQkNBLVx1MEJDRFx1MEJEMFx1MEJEN1x1MEJFNi1cdTBCRUZcdTBDMDAtXHUwQzAzXHUwQzA1LVx1MEMwQ1x1MEMwRS1cdTBDMTBcdTBDMTItXHUwQzI4XHUwQzJBLVx1MEMzOVx1MEMzRC1cdTBDNDRcdTBDNDYtXHUwQzQ4XHUwQzRBLVx1MEM0RFx1MEM1NVx1MEM1Nlx1MEM1OC1cdTBDNUFcdTBDNjAtXHUwQzYzXHUwQzY2LVx1MEM2Rlx1MEM4MC1cdTBDODNcdTBDODUtXHUwQzhDXHUwQzhFLVx1MEM5MFx1MEM5Mi1cdTBDQThcdTBDQUEtXHUwQ0IzXHUwQ0I1LVx1MENCOVx1MENCQy1cdTBDQzRcdTBDQzYtXHUwQ0M4XHUwQ0NBLVx1MENDRFx1MENENVx1MENENlx1MENERVx1MENFMC1cdTBDRTNcdTBDRTYtXHUwQ0VGXHUwQ0YxXHUwQ0YyXHUwRDAxLVx1MEQwM1x1MEQwNS1cdTBEMENcdTBEMEUtXHUwRDEwXHUwRDEyLVx1MEQzQVx1MEQzRC1cdTBENDRcdTBENDYtXHUwRDQ4XHUwRDRBLVx1MEQ0RVx1MEQ1NC1cdTBENTdcdTBENUYtXHUwRDYzXHUwRDY2LVx1MEQ2Rlx1MEQ3QS1cdTBEN0ZcdTBEODJcdTBEODNcdTBEODUtXHUwRDk2XHUwRDlBLVx1MERCMVx1MERCMy1cdTBEQkJcdTBEQkRcdTBEQzAtXHUwREM2XHUwRENBXHUwRENGLVx1MERENFx1MERENlx1MEREOC1cdTBEREZcdTBERTYtXHUwREVGXHUwREYyXHUwREYzXHUwRTAxLVx1MEUzQVx1MEU0MC1cdTBFNEVcdTBFNTAtXHUwRTU5XHUwRTgxXHUwRTgyXHUwRTg0XHUwRTg3XHUwRTg4XHUwRThBXHUwRThEXHUwRTk0LVx1MEU5N1x1MEU5OS1cdTBFOUZcdTBFQTEtXHUwRUEzXHUwRUE1XHUwRUE3XHUwRUFBXHUwRUFCXHUwRUFELVx1MEVCOVx1MEVCQi1cdTBFQkRcdTBFQzAtXHUwRUM0XHUwRUM2XHUwRUM4LVx1MEVDRFx1MEVEMC1cdTBFRDlcdTBFREMtXHUwRURGXHUwRjAwXHUwRjE4XHUwRjE5XHUwRjIwLVx1MEYyOVx1MEYzNVx1MEYzN1x1MEYzOVx1MEYzRS1cdTBGNDdcdTBGNDktXHUwRjZDXHUwRjcxLVx1MEY4NFx1MEY4Ni1cdTBGOTdcdTBGOTktXHUwRkJDXHUwRkM2XHUxMDAwLVx1MTA0OVx1MTA1MC1cdTEwOURcdTEwQTAtXHUxMEM1XHUxMEM3XHUxMENEXHUxMEQwLVx1MTBGQVx1MTBGQy1cdTEyNDhcdTEyNEEtXHUxMjREXHUxMjUwLVx1MTI1Nlx1MTI1OFx1MTI1QS1cdTEyNURcdTEyNjAtXHUxMjg4XHUxMjhBLVx1MTI4RFx1MTI5MC1cdTEyQjBcdTEyQjItXHUxMkI1XHUxMkI4LVx1MTJCRVx1MTJDMFx1MTJDMi1cdTEyQzVcdTEyQzgtXHUxMkQ2XHUxMkQ4LVx1MTMxMFx1MTMxMi1cdTEzMTVcdTEzMTgtXHUxMzVBXHUxMzVELVx1MTM1Rlx1MTM4MC1cdTEzOEZcdTEzQTAtXHUxM0Y1XHUxM0Y4LVx1MTNGRFx1MTQwMS1cdTE2NkNcdTE2NkYtXHUxNjdGXHUxNjgxLVx1MTY5QVx1MTZBMC1cdTE2RUFcdTE2RUUtXHUxNkY4XHUxNzAwLVx1MTcwQ1x1MTcwRS1cdTE3MTRcdTE3MjAtXHUxNzM0XHUxNzQwLVx1MTc1M1x1MTc2MC1cdTE3NkNcdTE3NkUtXHUxNzcwXHUxNzcyXHUxNzczXHUxNzgwLVx1MTdEM1x1MTdEN1x1MTdEQ1x1MTdERFx1MTdFMC1cdTE3RTlcdTE4MEItXHUxODBEXHUxODEwLVx1MTgxOVx1MTgyMC1cdTE4NzdcdTE4ODAtXHUxOEFBXHUxOEIwLVx1MThGNVx1MTkwMC1cdTE5MUVcdTE5MjAtXHUxOTJCXHUxOTMwLVx1MTkzQlx1MTk0Ni1cdTE5NkRcdTE5NzAtXHUxOTc0XHUxOTgwLVx1MTlBQlx1MTlCMC1cdTE5QzlcdTE5RDAtXHUxOUQ5XHUxQTAwLVx1MUExQlx1MUEyMC1cdTFBNUVcdTFBNjAtXHUxQTdDXHUxQTdGLVx1MUE4OVx1MUE5MC1cdTFBOTlcdTFBQTdcdTFBQjAtXHUxQUJEXHUxQjAwLVx1MUI0Qlx1MUI1MC1cdTFCNTlcdTFCNkItXHUxQjczXHUxQjgwLVx1MUJGM1x1MUMwMC1cdTFDMzdcdTFDNDAtXHUxQzQ5XHUxQzRELVx1MUM3RFx1MUM4MC1cdTFDODhcdTFDRDAtXHUxQ0QyXHUxQ0Q0LVx1MUNGNlx1MUNGOFx1MUNGOVx1MUQwMC1cdTFERjVcdTFERkItXHUxRjE1XHUxRjE4LVx1MUYxRFx1MUYyMC1cdTFGNDVcdTFGNDgtXHUxRjREXHUxRjUwLVx1MUY1N1x1MUY1OVx1MUY1Qlx1MUY1RFx1MUY1Ri1cdTFGN0RcdTFGODAtXHUxRkI0XHUxRkI2LVx1MUZCQ1x1MUZCRVx1MUZDMi1cdTFGQzRcdTFGQzYtXHUxRkNDXHUxRkQwLVx1MUZEM1x1MUZENi1cdTFGREJcdTFGRTAtXHUxRkVDXHUxRkYyLVx1MUZGNFx1MUZGNi1cdTFGRkNcdTIwMENcdTIwMERcdTIwM0ZcdTIwNDBcdTIwNTRcdTIwNzFcdTIwN0ZcdTIwOTAtXHUyMDlDXHUyMEQwLVx1MjBEQ1x1MjBFMVx1MjBFNS1cdTIwRjBcdTIxMDJcdTIxMDdcdTIxMEEtXHUyMTEzXHUyMTE1XHUyMTE5LVx1MjExRFx1MjEyNFx1MjEyNlx1MjEyOFx1MjEyQS1cdTIxMkRcdTIxMkYtXHUyMTM5XHUyMTNDLVx1MjEzRlx1MjE0NS1cdTIxNDlcdTIxNEVcdTIxNjAtXHUyMTg4XHUyQzAwLVx1MkMyRVx1MkMzMC1cdTJDNUVcdTJDNjAtXHUyQ0U0XHUyQ0VCLVx1MkNGM1x1MkQwMC1cdTJEMjVcdTJEMjdcdTJEMkRcdTJEMzAtXHUyRDY3XHUyRDZGXHUyRDdGLVx1MkQ5Nlx1MkRBMC1cdTJEQTZcdTJEQTgtXHUyREFFXHUyREIwLVx1MkRCNlx1MkRCOC1cdTJEQkVcdTJEQzAtXHUyREM2XHUyREM4LVx1MkRDRVx1MkREMC1cdTJERDZcdTJERDgtXHUyRERFXHUyREUwLVx1MkRGRlx1MkUyRlx1MzAwNS1cdTMwMDdcdTMwMjEtXHUzMDJGXHUzMDMxLVx1MzAzNVx1MzAzOC1cdTMwM0NcdTMwNDEtXHUzMDk2XHUzMDk5XHUzMDlBXHUzMDlELVx1MzA5Rlx1MzBBMS1cdTMwRkFcdTMwRkMtXHUzMEZGXHUzMTA1LVx1MzEyRFx1MzEzMS1cdTMxOEVcdTMxQTAtXHUzMUJBXHUzMUYwLVx1MzFGRlx1MzQwMC1cdTREQjVcdTRFMDAtXHU5RkQ1XHVBMDAwLVx1QTQ4Q1x1QTREMC1cdUE0RkRcdUE1MDAtXHVBNjBDXHVBNjEwLVx1QTYyQlx1QTY0MC1cdUE2NkZcdUE2NzQtXHVBNjdEXHVBNjdGLVx1QTZGMVx1QTcxNy1cdUE3MUZcdUE3MjItXHVBNzg4XHVBNzhCLVx1QTdBRVx1QTdCMC1cdUE3QjdcdUE3RjctXHVBODI3XHVBODQwLVx1QTg3M1x1QTg4MC1cdUE4QzVcdUE4RDAtXHVBOEQ5XHVBOEUwLVx1QThGN1x1QThGQlx1QThGRFx1QTkwMC1cdUE5MkRcdUE5MzAtXHVBOTUzXHVBOTYwLVx1QTk3Q1x1QTk4MC1cdUE5QzBcdUE5Q0YtXHVBOUQ5XHVBOUUwLVx1QTlGRVx1QUEwMC1cdUFBMzZcdUFBNDAtXHVBQTREXHVBQTUwLVx1QUE1OVx1QUE2MC1cdUFBNzZcdUFBN0EtXHVBQUMyXHVBQURCLVx1QUFERFx1QUFFMC1cdUFBRUZcdUFBRjItXHVBQUY2XHVBQjAxLVx1QUIwNlx1QUIwOS1cdUFCMEVcdUFCMTEtXHVBQjE2XHVBQjIwLVx1QUIyNlx1QUIyOC1cdUFCMkVcdUFCMzAtXHVBQjVBXHVBQjVDLVx1QUI2NVx1QUI3MC1cdUFCRUFcdUFCRUNcdUFCRURcdUFCRjAtXHVBQkY5XHVBQzAwLVx1RDdBM1x1RDdCMC1cdUQ3QzZcdUQ3Q0ItXHVEN0ZCXHVGOTAwLVx1RkE2RFx1RkE3MC1cdUZBRDlcdUZCMDAtXHVGQjA2XHVGQjEzLVx1RkIxN1x1RkIxRC1cdUZCMjhcdUZCMkEtXHVGQjM2XHVGQjM4LVx1RkIzQ1x1RkIzRVx1RkI0MFx1RkI0MVx1RkI0M1x1RkI0NFx1RkI0Ni1cdUZCQjFcdUZCRDMtXHVGRDNEXHVGRDUwLVx1RkQ4Rlx1RkQ5Mi1cdUZEQzdcdUZERjAtXHVGREZCXHVGRTAwLVx1RkUwRlx1RkUyMC1cdUZFMkZcdUZFMzNcdUZFMzRcdUZFNEQtXHVGRTRGXHVGRTcwLVx1RkU3NFx1RkU3Ni1cdUZFRkNcdUZGMTAtXHVGRjE5XHVGRjIxLVx1RkYzQVx1RkYzRlx1RkY0MS1cdUZGNUFcdUZGNjYtXHVGRkJFXHVGRkMyLVx1RkZDN1x1RkZDQS1cdUZGQ0ZcdUZGRDItXHVGRkQ3XHVGRkRBLVx1RkZEQ10vIH0sIHQyID0geyBOb25Bc2NpaUlkZW50aWZpZXJTdGFydDogL1tceEFBXHhCNVx4QkFceEMwLVx4RDZceEQ4LVx4RjZceEY4LVx1MDJDMVx1MDJDNi1cdTAyRDFcdTAyRTAtXHUwMkU0XHUwMkVDXHUwMkVFXHUwMzcwLVx1MDM3NFx1MDM3Nlx1MDM3N1x1MDM3QS1cdTAzN0RcdTAzN0ZcdTAzODZcdTAzODgtXHUwMzhBXHUwMzhDXHUwMzhFLVx1MDNBMVx1MDNBMy1cdTAzRjVcdTAzRjctXHUwNDgxXHUwNDhBLVx1MDUyRlx1MDUzMS1cdTA1NTZcdTA1NTlcdTA1NjEtXHUwNTg3XHUwNUQwLVx1MDVFQVx1MDVGMC1cdTA1RjJcdTA2MjAtXHUwNjRBXHUwNjZFXHUwNjZGXHUwNjcxLVx1MDZEM1x1MDZENVx1MDZFNVx1MDZFNlx1MDZFRVx1MDZFRlx1MDZGQS1cdTA2RkNcdTA2RkZcdTA3MTBcdTA3MTItXHUwNzJGXHUwNzRELVx1MDdBNVx1MDdCMVx1MDdDQS1cdTA3RUFcdTA3RjRcdTA3RjVcdTA3RkFcdTA4MDAtXHUwODE1XHUwODFBXHUwODI0XHUwODI4XHUwODQwLVx1MDg1OFx1MDhBMC1cdTA4QjRcdTA4QjYtXHUwOEJEXHUwOTA0LVx1MDkzOVx1MDkzRFx1MDk1MFx1MDk1OC1cdTA5NjFcdTA5NzEtXHUwOTgwXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCRFx1MDlDRVx1MDlEQ1x1MDlERFx1MDlERi1cdTA5RTFcdTA5RjBcdTA5RjFcdTBBMDUtXHUwQTBBXHUwQTBGXHUwQTEwXHUwQTEzLVx1MEEyOFx1MEEyQS1cdTBBMzBcdTBBMzJcdTBBMzNcdTBBMzVcdTBBMzZcdTBBMzhcdTBBMzlcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTcyLVx1MEE3NFx1MEE4NS1cdTBBOERcdTBBOEYtXHUwQTkxXHUwQTkzLVx1MEFBOFx1MEFBQS1cdTBBQjBcdTBBQjJcdTBBQjNcdTBBQjUtXHUwQUI5XHUwQUJEXHUwQUQwXHUwQUUwXHUwQUUxXHUwQUY5XHUwQjA1LVx1MEIwQ1x1MEIwRlx1MEIxMFx1MEIxMy1cdTBCMjhcdTBCMkEtXHUwQjMwXHUwQjMyXHUwQjMzXHUwQjM1LVx1MEIzOVx1MEIzRFx1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjFcdTBCNzFcdTBCODNcdTBCODUtXHUwQjhBXHUwQjhFLVx1MEI5MFx1MEI5Mi1cdTBCOTVcdTBCOTlcdTBCOUFcdTBCOUNcdTBCOUVcdTBCOUZcdTBCQTNcdTBCQTRcdTBCQTgtXHUwQkFBXHUwQkFFLVx1MEJCOVx1MEJEMFx1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0RcdTBDNTgtXHUwQzVBXHUwQzYwXHUwQzYxXHUwQzgwXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkRcdTBDREVcdTBDRTBcdTBDRTFcdTBDRjFcdTBDRjJcdTBEMDUtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0RcdTBENEVcdTBENTQtXHUwRDU2XHUwRDVGLVx1MEQ2MVx1MEQ3QS1cdTBEN0ZcdTBEODUtXHUwRDk2XHUwRDlBLVx1MERCMVx1MERCMy1cdTBEQkJcdTBEQkRcdTBEQzAtXHUwREM2XHUwRTAxLVx1MEUzMFx1MEUzMlx1MEUzM1x1MEU0MC1cdTBFNDZcdTBFODFcdTBFODJcdTBFODRcdTBFODdcdTBFODhcdTBFOEFcdTBFOERcdTBFOTQtXHUwRTk3XHUwRTk5LVx1MEU5Rlx1MEVBMS1cdTBFQTNcdTBFQTVcdTBFQTdcdTBFQUFcdTBFQUJcdTBFQUQtXHUwRUIwXHUwRUIyXHUwRUIzXHUwRUJEXHUwRUMwLVx1MEVDNFx1MEVDNlx1MEVEQy1cdTBFREZcdTBGMDBcdTBGNDAtXHUwRjQ3XHUwRjQ5LVx1MEY2Q1x1MEY4OC1cdTBGOENcdTEwMDAtXHUxMDJBXHUxMDNGXHUxMDUwLVx1MTA1NVx1MTA1QS1cdTEwNURcdTEwNjFcdTEwNjVcdTEwNjZcdTEwNkUtXHUxMDcwXHUxMDc1LVx1MTA4MVx1MTA4RVx1MTBBMC1cdTEwQzVcdTEwQzdcdTEwQ0RcdTEwRDAtXHUxMEZBXHUxMEZDLVx1MTI0OFx1MTI0QS1cdTEyNERcdTEyNTAtXHUxMjU2XHUxMjU4XHUxMjVBLVx1MTI1RFx1MTI2MC1cdTEyODhcdTEyOEEtXHUxMjhEXHUxMjkwLVx1MTJCMFx1MTJCMi1cdTEyQjVcdTEyQjgtXHUxMkJFXHUxMkMwXHUxMkMyLVx1MTJDNVx1MTJDOC1cdTEyRDZcdTEyRDgtXHUxMzEwXHUxMzEyLVx1MTMxNVx1MTMxOC1cdTEzNUFcdTEzODAtXHUxMzhGXHUxM0EwLVx1MTNGNVx1MTNGOC1cdTEzRkRcdTE0MDEtXHUxNjZDXHUxNjZGLVx1MTY3Rlx1MTY4MS1cdTE2OUFcdTE2QTAtXHUxNkVBXHUxNkVFLVx1MTZGOFx1MTcwMC1cdTE3MENcdTE3MEUtXHUxNzExXHUxNzIwLVx1MTczMVx1MTc0MC1cdTE3NTFcdTE3NjAtXHUxNzZDXHUxNzZFLVx1MTc3MFx1MTc4MC1cdTE3QjNcdTE3RDdcdTE3RENcdTE4MjAtXHUxODc3XHUxODgwLVx1MThBOFx1MThBQVx1MThCMC1cdTE4RjVcdTE5MDAtXHUxOTFFXHUxOTUwLVx1MTk2RFx1MTk3MC1cdTE5NzRcdTE5ODAtXHUxOUFCXHUxOUIwLVx1MTlDOVx1MUEwMC1cdTFBMTZcdTFBMjAtXHUxQTU0XHUxQUE3XHUxQjA1LVx1MUIzM1x1MUI0NS1cdTFCNEJcdTFCODMtXHUxQkEwXHUxQkFFXHUxQkFGXHUxQkJBLVx1MUJFNVx1MUMwMC1cdTFDMjNcdTFDNEQtXHUxQzRGXHUxQzVBLVx1MUM3RFx1MUM4MC1cdTFDODhcdTFDRTktXHUxQ0VDXHUxQ0VFLVx1MUNGMVx1MUNGNVx1MUNGNlx1MUQwMC1cdTFEQkZcdTFFMDAtXHUxRjE1XHUxRjE4LVx1MUYxRFx1MUYyMC1cdTFGNDVcdTFGNDgtXHUxRjREXHUxRjUwLVx1MUY1N1x1MUY1OVx1MUY1Qlx1MUY1RFx1MUY1Ri1cdTFGN0RcdTFGODAtXHUxRkI0XHUxRkI2LVx1MUZCQ1x1MUZCRVx1MUZDMi1cdTFGQzRcdTFGQzYtXHUxRkNDXHUxRkQwLVx1MUZEM1x1MUZENi1cdTFGREJcdTFGRTAtXHUxRkVDXHUxRkYyLVx1MUZGNFx1MUZGNi1cdTFGRkNcdTIwNzFcdTIwN0ZcdTIwOTAtXHUyMDlDXHUyMTAyXHUyMTA3XHUyMTBBLVx1MjExM1x1MjExNVx1MjExOC1cdTIxMURcdTIxMjRcdTIxMjZcdTIxMjhcdTIxMkEtXHUyMTM5XHUyMTNDLVx1MjEzRlx1MjE0NS1cdTIxNDlcdTIxNEVcdTIxNjAtXHUyMTg4XHUyQzAwLVx1MkMyRVx1MkMzMC1cdTJDNUVcdTJDNjAtXHUyQ0U0XHUyQ0VCLVx1MkNFRVx1MkNGMlx1MkNGM1x1MkQwMC1cdTJEMjVcdTJEMjdcdTJEMkRcdTJEMzAtXHUyRDY3XHUyRDZGXHUyRDgwLVx1MkQ5Nlx1MkRBMC1cdTJEQTZcdTJEQTgtXHUyREFFXHUyREIwLVx1MkRCNlx1MkRCOC1cdTJEQkVcdTJEQzAtXHUyREM2XHUyREM4LVx1MkRDRVx1MkREMC1cdTJERDZcdTJERDgtXHUyRERFXHUzMDA1LVx1MzAwN1x1MzAyMS1cdTMwMjlcdTMwMzEtXHUzMDM1XHUzMDM4LVx1MzAzQ1x1MzA0MS1cdTMwOTZcdTMwOUItXHUzMDlGXHUzMEExLVx1MzBGQVx1MzBGQy1cdTMwRkZcdTMxMDUtXHUzMTJEXHUzMTMxLVx1MzE4RVx1MzFBMC1cdTMxQkFcdTMxRjAtXHUzMUZGXHUzNDAwLVx1NERCNVx1NEUwMC1cdTlGRDVcdUEwMDAtXHVBNDhDXHVBNEQwLVx1QTRGRFx1QTUwMC1cdUE2MENcdUE2MTAtXHVBNjFGXHVBNjJBXHVBNjJCXHVBNjQwLVx1QTY2RVx1QTY3Ri1cdUE2OURcdUE2QTAtXHVBNkVGXHVBNzE3LVx1QTcxRlx1QTcyMi1cdUE3ODhcdUE3OEItXHVBN0FFXHVBN0IwLVx1QTdCN1x1QTdGNy1cdUE4MDFcdUE4MDMtXHVBODA1XHVBODA3LVx1QTgwQVx1QTgwQy1cdUE4MjJcdUE4NDAtXHVBODczXHVBODgyLVx1QThCM1x1QThGMi1cdUE4RjdcdUE4RkJcdUE4RkRcdUE5MEEtXHVBOTI1XHVBOTMwLVx1QTk0Nlx1QTk2MC1cdUE5N0NcdUE5ODQtXHVBOUIyXHVBOUNGXHVBOUUwLVx1QTlFNFx1QTlFNi1cdUE5RUZcdUE5RkEtXHVBOUZFXHVBQTAwLVx1QUEyOFx1QUE0MC1cdUFBNDJcdUFBNDQtXHVBQTRCXHVBQTYwLVx1QUE3Nlx1QUE3QVx1QUE3RS1cdUFBQUZcdUFBQjFcdUFBQjVcdUFBQjZcdUFBQjktXHVBQUJEXHVBQUMwXHVBQUMyXHVBQURCLVx1QUFERFx1QUFFMC1cdUFBRUFcdUFBRjItXHVBQUY0XHVBQjAxLVx1QUIwNlx1QUIwOS1cdUFCMEVcdUFCMTEtXHVBQjE2XHVBQjIwLVx1QUIyNlx1QUIyOC1cdUFCMkVcdUFCMzAtXHVBQjVBXHVBQjVDLVx1QUI2NVx1QUI3MC1cdUFCRTJcdUFDMDAtXHVEN0EzXHVEN0IwLVx1RDdDNlx1RDdDQi1cdUQ3RkJcdUY5MDAtXHVGQTZEXHVGQTcwLVx1RkFEOVx1RkIwMC1cdUZCMDZcdUZCMTMtXHVGQjE3XHVGQjFEXHVGQjFGLVx1RkIyOFx1RkIyQS1cdUZCMzZcdUZCMzgtXHVGQjNDXHVGQjNFXHVGQjQwXHVGQjQxXHVGQjQzXHVGQjQ0XHVGQjQ2LVx1RkJCMVx1RkJEMy1cdUZEM0RcdUZENTAtXHVGRDhGXHVGRDkyLVx1RkRDN1x1RkRGMC1cdUZERkJcdUZFNzAtXHVGRTc0XHVGRTc2LVx1RkVGQ1x1RkYyMS1cdUZGM0FcdUZGNDEtXHVGRjVBXHVGRjY2LVx1RkZCRVx1RkZDMi1cdUZGQzdcdUZGQ0EtXHVGRkNGXHVGRkQyLVx1RkZEN1x1RkZEQS1cdUZGRENdfFx1RDgwMFtcdURDMDAtXHVEQzBCXHVEQzBELVx1REMyNlx1REMyOC1cdURDM0FcdURDM0NcdURDM0RcdURDM0YtXHVEQzREXHVEQzUwLVx1REM1RFx1REM4MC1cdURDRkFcdURENDAtXHVERDc0XHVERTgwLVx1REU5Q1x1REVBMC1cdURFRDBcdURGMDAtXHVERjFGXHVERjMwLVx1REY0QVx1REY1MC1cdURGNzVcdURGODAtXHVERjlEXHVERkEwLVx1REZDM1x1REZDOC1cdURGQ0ZcdURGRDEtXHVERkQ1XXxcdUQ4MDFbXHVEQzAwLVx1REM5RFx1RENCMC1cdURDRDNcdURDRDgtXHVEQ0ZCXHVERDAwLVx1REQyN1x1REQzMC1cdURENjNcdURFMDAtXHVERjM2XHVERjQwLVx1REY1NVx1REY2MC1cdURGNjddfFx1RDgwMltcdURDMDAtXHVEQzA1XHVEQzA4XHVEQzBBLVx1REMzNVx1REMzN1x1REMzOFx1REMzQ1x1REMzRi1cdURDNTVcdURDNjAtXHVEQzc2XHVEQzgwLVx1REM5RVx1RENFMC1cdURDRjJcdURDRjRcdURDRjVcdUREMDAtXHVERDE1XHVERDIwLVx1REQzOVx1REQ4MC1cdUREQjdcdUREQkVcdUREQkZcdURFMDBcdURFMTAtXHVERTEzXHVERTE1LVx1REUxN1x1REUxOS1cdURFMzNcdURFNjAtXHVERTdDXHVERTgwLVx1REU5Q1x1REVDMC1cdURFQzdcdURFQzktXHVERUU0XHVERjAwLVx1REYzNVx1REY0MC1cdURGNTVcdURGNjAtXHVERjcyXHVERjgwLVx1REY5MV18XHVEODAzW1x1REMwMC1cdURDNDhcdURDODAtXHVEQ0IyXHVEQ0MwLVx1RENGMl18XHVEODA0W1x1REMwMy1cdURDMzdcdURDODMtXHVEQ0FGXHVEQ0QwLVx1RENFOFx1REQwMy1cdUREMjZcdURENTAtXHVERDcyXHVERDc2XHVERDgzLVx1RERCMlx1RERDMS1cdUREQzRcdUREREFcdURERENcdURFMDAtXHVERTExXHVERTEzLVx1REUyQlx1REU4MC1cdURFODZcdURFODhcdURFOEEtXHVERThEXHVERThGLVx1REU5RFx1REU5Ri1cdURFQThcdURFQjAtXHVERURFXHVERjA1LVx1REYwQ1x1REYwRlx1REYxMFx1REYxMy1cdURGMjhcdURGMkEtXHVERjMwXHVERjMyXHVERjMzXHVERjM1LVx1REYzOVx1REYzRFx1REY1MFx1REY1RC1cdURGNjFdfFx1RDgwNVtcdURDMDAtXHVEQzM0XHVEQzQ3LVx1REM0QVx1REM4MC1cdURDQUZcdURDQzRcdURDQzVcdURDQzdcdUREODAtXHVEREFFXHVEREQ4LVx1REREQlx1REUwMC1cdURFMkZcdURFNDRcdURFODAtXHVERUFBXHVERjAwLVx1REYxOV18XHVEODA2W1x1RENBMC1cdURDREZcdURDRkZcdURFQzAtXHVERUY4XXxcdUQ4MDdbXHVEQzAwLVx1REMwOFx1REMwQS1cdURDMkVcdURDNDBcdURDNzItXHVEQzhGXXxcdUQ4MDhbXHVEQzAwLVx1REY5OV18XHVEODA5W1x1REMwMC1cdURDNkVcdURDODAtXHVERDQzXXxbXHVEODBDXHVEODFDLVx1RDgyMFx1RDg0MC1cdUQ4NjhcdUQ4NkEtXHVEODZDXHVEODZGLVx1RDg3Ml1bXHVEQzAwLVx1REZGRl18XHVEODBEW1x1REMwMC1cdURDMkVdfFx1RDgxMVtcdURDMDAtXHVERTQ2XXxcdUQ4MUFbXHVEQzAwLVx1REUzOFx1REU0MC1cdURFNUVcdURFRDAtXHVERUVEXHVERjAwLVx1REYyRlx1REY0MC1cdURGNDNcdURGNjMtXHVERjc3XHVERjdELVx1REY4Rl18XHVEODFCW1x1REYwMC1cdURGNDRcdURGNTBcdURGOTMtXHVERjlGXHVERkUwXXxcdUQ4MjFbXHVEQzAwLVx1REZFQ118XHVEODIyW1x1REMwMC1cdURFRjJdfFx1RDgyQ1tcdURDMDBcdURDMDFdfFx1RDgyRltcdURDMDAtXHVEQzZBXHVEQzcwLVx1REM3Q1x1REM4MC1cdURDODhcdURDOTAtXHVEQzk5XXxcdUQ4MzVbXHVEQzAwLVx1REM1NFx1REM1Ni1cdURDOUNcdURDOUVcdURDOUZcdURDQTJcdURDQTVcdURDQTZcdURDQTktXHVEQ0FDXHVEQ0FFLVx1RENCOVx1RENCQlx1RENCRC1cdURDQzNcdURDQzUtXHVERDA1XHVERDA3LVx1REQwQVx1REQwRC1cdUREMTRcdUREMTYtXHVERDFDXHVERDFFLVx1REQzOVx1REQzQi1cdUREM0VcdURENDAtXHVERDQ0XHVERDQ2XHVERDRBLVx1REQ1MFx1REQ1Mi1cdURFQTVcdURFQTgtXHVERUMwXHVERUMyLVx1REVEQVx1REVEQy1cdURFRkFcdURFRkMtXHVERjE0XHVERjE2LVx1REYzNFx1REYzNi1cdURGNEVcdURGNTAtXHVERjZFXHVERjcwLVx1REY4OFx1REY4QS1cdURGQThcdURGQUEtXHVERkMyXHVERkM0LVx1REZDQl18XHVEODNBW1x1REMwMC1cdURDQzRcdUREMDAtXHVERDQzXXxcdUQ4M0JbXHVERTAwLVx1REUwM1x1REUwNS1cdURFMUZcdURFMjFcdURFMjJcdURFMjRcdURFMjdcdURFMjktXHVERTMyXHVERTM0LVx1REUzN1x1REUzOVx1REUzQlx1REU0Mlx1REU0N1x1REU0OVx1REU0Qlx1REU0RC1cdURFNEZcdURFNTFcdURFNTJcdURFNTRcdURFNTdcdURFNTlcdURFNUJcdURFNURcdURFNUZcdURFNjFcdURFNjJcdURFNjRcdURFNjctXHVERTZBXHVERTZDLVx1REU3Mlx1REU3NC1cdURFNzdcdURFNzktXHVERTdDXHVERTdFXHVERTgwLVx1REU4OVx1REU4Qi1cdURFOUJcdURFQTEtXHVERUEzXHVERUE1LVx1REVBOVx1REVBQi1cdURFQkJdfFx1RDg2OVtcdURDMDAtXHVERUQ2XHVERjAwLVx1REZGRl18XHVEODZEW1x1REMwMC1cdURGMzRcdURGNDAtXHVERkZGXXxcdUQ4NkVbXHVEQzAwLVx1REMxRFx1REMyMC1cdURGRkZdfFx1RDg3M1tcdURDMDAtXHVERUExXXxcdUQ4N0VbXHVEQzAwLVx1REUxRF0vLCBOb25Bc2NpaUlkZW50aWZpZXJQYXJ0OiAvW1x4QUFceEI1XHhCN1x4QkFceEMwLVx4RDZceEQ4LVx4RjZceEY4LVx1MDJDMVx1MDJDNi1cdTAyRDFcdTAyRTAtXHUwMkU0XHUwMkVDXHUwMkVFXHUwMzAwLVx1MDM3NFx1MDM3Nlx1MDM3N1x1MDM3QS1cdTAzN0RcdTAzN0ZcdTAzODYtXHUwMzhBXHUwMzhDXHUwMzhFLVx1MDNBMVx1MDNBMy1cdTAzRjVcdTAzRjctXHUwNDgxXHUwNDgzLVx1MDQ4N1x1MDQ4QS1cdTA1MkZcdTA1MzEtXHUwNTU2XHUwNTU5XHUwNTYxLVx1MDU4N1x1MDU5MS1cdTA1QkRcdTA1QkZcdTA1QzFcdTA1QzJcdTA1QzRcdTA1QzVcdTA1QzdcdTA1RDAtXHUwNUVBXHUwNUYwLVx1MDVGMlx1MDYxMC1cdTA2MUFcdTA2MjAtXHUwNjY5XHUwNjZFLVx1MDZEM1x1MDZENS1cdTA2RENcdTA2REYtXHUwNkU4XHUwNkVBLVx1MDZGQ1x1MDZGRlx1MDcxMC1cdTA3NEFcdTA3NEQtXHUwN0IxXHUwN0MwLVx1MDdGNVx1MDdGQVx1MDgwMC1cdTA4MkRcdTA4NDAtXHUwODVCXHUwOEEwLVx1MDhCNFx1MDhCNi1cdTA4QkRcdTA4RDQtXHUwOEUxXHUwOEUzLVx1MDk2M1x1MDk2Ni1cdTA5NkZcdTA5NzEtXHUwOTgzXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCQy1cdTA5QzRcdTA5QzdcdTA5QzhcdTA5Q0ItXHUwOUNFXHUwOUQ3XHUwOURDXHUwOUREXHUwOURGLVx1MDlFM1x1MDlFNi1cdTA5RjFcdTBBMDEtXHUwQTAzXHUwQTA1LVx1MEEwQVx1MEEwRlx1MEExMFx1MEExMy1cdTBBMjhcdTBBMkEtXHUwQTMwXHUwQTMyXHUwQTMzXHUwQTM1XHUwQTM2XHUwQTM4XHUwQTM5XHUwQTNDXHUwQTNFLVx1MEE0Mlx1MEE0N1x1MEE0OFx1MEE0Qi1cdTBBNERcdTBBNTFcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTY2LVx1MEE3NVx1MEE4MS1cdTBBODNcdTBBODUtXHUwQThEXHUwQThGLVx1MEE5MVx1MEE5My1cdTBBQThcdTBBQUEtXHUwQUIwXHUwQUIyXHUwQUIzXHUwQUI1LVx1MEFCOVx1MEFCQy1cdTBBQzVcdTBBQzctXHUwQUM5XHUwQUNCLVx1MEFDRFx1MEFEMFx1MEFFMC1cdTBBRTNcdTBBRTYtXHUwQUVGXHUwQUY5XHUwQjAxLVx1MEIwM1x1MEIwNS1cdTBCMENcdTBCMEZcdTBCMTBcdTBCMTMtXHUwQjI4XHUwQjJBLVx1MEIzMFx1MEIzMlx1MEIzM1x1MEIzNS1cdTBCMzlcdTBCM0MtXHUwQjQ0XHUwQjQ3XHUwQjQ4XHUwQjRCLVx1MEI0RFx1MEI1Nlx1MEI1N1x1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjNcdTBCNjYtXHUwQjZGXHUwQjcxXHUwQjgyXHUwQjgzXHUwQjg1LVx1MEI4QVx1MEI4RS1cdTBCOTBcdTBCOTItXHUwQjk1XHUwQjk5XHUwQjlBXHUwQjlDXHUwQjlFXHUwQjlGXHUwQkEzXHUwQkE0XHUwQkE4LVx1MEJBQVx1MEJBRS1cdTBCQjlcdTBCQkUtXHUwQkMyXHUwQkM2LVx1MEJDOFx1MEJDQS1cdTBCQ0RcdTBCRDBcdTBCRDdcdTBCRTYtXHUwQkVGXHUwQzAwLVx1MEMwM1x1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0QtXHUwQzQ0XHUwQzQ2LVx1MEM0OFx1MEM0QS1cdTBDNERcdTBDNTVcdTBDNTZcdTBDNTgtXHUwQzVBXHUwQzYwLVx1MEM2M1x1MEM2Ni1cdTBDNkZcdTBDODAtXHUwQzgzXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkMtXHUwQ0M0XHUwQ0M2LVx1MENDOFx1MENDQS1cdTBDQ0RcdTBDRDVcdTBDRDZcdTBDREVcdTBDRTAtXHUwQ0UzXHUwQ0U2LVx1MENFRlx1MENGMVx1MENGMlx1MEQwMS1cdTBEMDNcdTBEMDUtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0QtXHUwRDQ0XHUwRDQ2LVx1MEQ0OFx1MEQ0QS1cdTBENEVcdTBENTQtXHUwRDU3XHUwRDVGLVx1MEQ2M1x1MEQ2Ni1cdTBENkZcdTBEN0EtXHUwRDdGXHUwRDgyXHUwRDgzXHUwRDg1LVx1MEQ5Nlx1MEQ5QS1cdTBEQjFcdTBEQjMtXHUwREJCXHUwREJEXHUwREMwLVx1MERDNlx1MERDQVx1MERDRi1cdTBERDRcdTBERDZcdTBERDgtXHUwRERGXHUwREU2LVx1MERFRlx1MERGMlx1MERGM1x1MEUwMS1cdTBFM0FcdTBFNDAtXHUwRTRFXHUwRTUwLVx1MEU1OVx1MEU4MVx1MEU4Mlx1MEU4NFx1MEU4N1x1MEU4OFx1MEU4QVx1MEU4RFx1MEU5NC1cdTBFOTdcdTBFOTktXHUwRTlGXHUwRUExLVx1MEVBM1x1MEVBNVx1MEVBN1x1MEVBQVx1MEVBQlx1MEVBRC1cdTBFQjlcdTBFQkItXHUwRUJEXHUwRUMwLVx1MEVDNFx1MEVDNlx1MEVDOC1cdTBFQ0RcdTBFRDAtXHUwRUQ5XHUwRURDLVx1MEVERlx1MEYwMFx1MEYxOFx1MEYxOVx1MEYyMC1cdTBGMjlcdTBGMzVcdTBGMzdcdTBGMzlcdTBGM0UtXHUwRjQ3XHUwRjQ5LVx1MEY2Q1x1MEY3MS1cdTBGODRcdTBGODYtXHUwRjk3XHUwRjk5LVx1MEZCQ1x1MEZDNlx1MTAwMC1cdTEwNDlcdTEwNTAtXHUxMDlEXHUxMEEwLVx1MTBDNVx1MTBDN1x1MTBDRFx1MTBEMC1cdTEwRkFcdTEwRkMtXHUxMjQ4XHUxMjRBLVx1MTI0RFx1MTI1MC1cdTEyNTZcdTEyNThcdTEyNUEtXHUxMjVEXHUxMjYwLVx1MTI4OFx1MTI4QS1cdTEyOERcdTEyOTAtXHUxMkIwXHUxMkIyLVx1MTJCNVx1MTJCOC1cdTEyQkVcdTEyQzBcdTEyQzItXHUxMkM1XHUxMkM4LVx1MTJENlx1MTJEOC1cdTEzMTBcdTEzMTItXHUxMzE1XHUxMzE4LVx1MTM1QVx1MTM1RC1cdTEzNUZcdTEzNjktXHUxMzcxXHUxMzgwLVx1MTM4Rlx1MTNBMC1cdTEzRjVcdTEzRjgtXHUxM0ZEXHUxNDAxLVx1MTY2Q1x1MTY2Ri1cdTE2N0ZcdTE2ODEtXHUxNjlBXHUxNkEwLVx1MTZFQVx1MTZFRS1cdTE2RjhcdTE3MDAtXHUxNzBDXHUxNzBFLVx1MTcxNFx1MTcyMC1cdTE3MzRcdTE3NDAtXHUxNzUzXHUxNzYwLVx1MTc2Q1x1MTc2RS1cdTE3NzBcdTE3NzJcdTE3NzNcdTE3ODAtXHUxN0QzXHUxN0Q3XHUxN0RDXHUxN0REXHUxN0UwLVx1MTdFOVx1MTgwQi1cdTE4MERcdTE4MTAtXHUxODE5XHUxODIwLVx1MTg3N1x1MTg4MC1cdTE4QUFcdTE4QjAtXHUxOEY1XHUxOTAwLVx1MTkxRVx1MTkyMC1cdTE5MkJcdTE5MzAtXHUxOTNCXHUxOTQ2LVx1MTk2RFx1MTk3MC1cdTE5NzRcdTE5ODAtXHUxOUFCXHUxOUIwLVx1MTlDOVx1MTlEMC1cdTE5REFcdTFBMDAtXHUxQTFCXHUxQTIwLVx1MUE1RVx1MUE2MC1cdTFBN0NcdTFBN0YtXHUxQTg5XHUxQTkwLVx1MUE5OVx1MUFBN1x1MUFCMC1cdTFBQkRcdTFCMDAtXHUxQjRCXHUxQjUwLVx1MUI1OVx1MUI2Qi1cdTFCNzNcdTFCODAtXHUxQkYzXHUxQzAwLVx1MUMzN1x1MUM0MC1cdTFDNDlcdTFDNEQtXHUxQzdEXHUxQzgwLVx1MUM4OFx1MUNEMC1cdTFDRDJcdTFDRDQtXHUxQ0Y2XHUxQ0Y4XHUxQ0Y5XHUxRDAwLVx1MURGNVx1MURGQi1cdTFGMTVcdTFGMTgtXHUxRjFEXHUxRjIwLVx1MUY0NVx1MUY0OC1cdTFGNERcdTFGNTAtXHUxRjU3XHUxRjU5XHUxRjVCXHUxRjVEXHUxRjVGLVx1MUY3RFx1MUY4MC1cdTFGQjRcdTFGQjYtXHUxRkJDXHUxRkJFXHUxRkMyLVx1MUZDNFx1MUZDNi1cdTFGQ0NcdTFGRDAtXHUxRkQzXHUxRkQ2LVx1MUZEQlx1MUZFMC1cdTFGRUNcdTFGRjItXHUxRkY0XHUxRkY2LVx1MUZGQ1x1MjAwQ1x1MjAwRFx1MjAzRlx1MjA0MFx1MjA1NFx1MjA3MVx1MjA3Rlx1MjA5MC1cdTIwOUNcdTIwRDAtXHUyMERDXHUyMEUxXHUyMEU1LVx1MjBGMFx1MjEwMlx1MjEwN1x1MjEwQS1cdTIxMTNcdTIxMTVcdTIxMTgtXHUyMTFEXHUyMTI0XHUyMTI2XHUyMTI4XHUyMTJBLVx1MjEzOVx1MjEzQy1cdTIxM0ZcdTIxNDUtXHUyMTQ5XHUyMTRFXHUyMTYwLVx1MjE4OFx1MkMwMC1cdTJDMkVcdTJDMzAtXHUyQzVFXHUyQzYwLVx1MkNFNFx1MkNFQi1cdTJDRjNcdTJEMDAtXHUyRDI1XHUyRDI3XHUyRDJEXHUyRDMwLVx1MkQ2N1x1MkQ2Rlx1MkQ3Ri1cdTJEOTZcdTJEQTAtXHUyREE2XHUyREE4LVx1MkRBRVx1MkRCMC1cdTJEQjZcdTJEQjgtXHUyREJFXHUyREMwLVx1MkRDNlx1MkRDOC1cdTJEQ0VcdTJERDAtXHUyREQ2XHUyREQ4LVx1MkRERVx1MkRFMC1cdTJERkZcdTMwMDUtXHUzMDA3XHUzMDIxLVx1MzAyRlx1MzAzMS1cdTMwMzVcdTMwMzgtXHUzMDNDXHUzMDQxLVx1MzA5Nlx1MzA5OS1cdTMwOUZcdTMwQTEtXHUzMEZBXHUzMEZDLVx1MzBGRlx1MzEwNS1cdTMxMkRcdTMxMzEtXHUzMThFXHUzMUEwLVx1MzFCQVx1MzFGMC1cdTMxRkZcdTM0MDAtXHU0REI1XHU0RTAwLVx1OUZENVx1QTAwMC1cdUE0OENcdUE0RDAtXHVBNEZEXHVBNTAwLVx1QTYwQ1x1QTYxMC1cdUE2MkJcdUE2NDAtXHVBNjZGXHVBNjc0LVx1QTY3RFx1QTY3Ri1cdUE2RjFcdUE3MTctXHVBNzFGXHVBNzIyLVx1QTc4OFx1QTc4Qi1cdUE3QUVcdUE3QjAtXHVBN0I3XHVBN0Y3LVx1QTgyN1x1QTg0MC1cdUE4NzNcdUE4ODAtXHVBOEM1XHVBOEQwLVx1QThEOVx1QThFMC1cdUE4RjdcdUE4RkJcdUE4RkRcdUE5MDAtXHVBOTJEXHVBOTMwLVx1QTk1M1x1QTk2MC1cdUE5N0NcdUE5ODAtXHVBOUMwXHVBOUNGLVx1QTlEOVx1QTlFMC1cdUE5RkVcdUFBMDAtXHVBQTM2XHVBQTQwLVx1QUE0RFx1QUE1MC1cdUFBNTlcdUFBNjAtXHVBQTc2XHVBQTdBLVx1QUFDMlx1QUFEQi1cdUFBRERcdUFBRTAtXHVBQUVGXHVBQUYyLVx1QUFGNlx1QUIwMS1cdUFCMDZcdUFCMDktXHVBQjBFXHVBQjExLVx1QUIxNlx1QUIyMC1cdUFCMjZcdUFCMjgtXHVBQjJFXHVBQjMwLVx1QUI1QVx1QUI1Qy1cdUFCNjVcdUFCNzAtXHVBQkVBXHVBQkVDXHVBQkVEXHVBQkYwLVx1QUJGOVx1QUMwMC1cdUQ3QTNcdUQ3QjAtXHVEN0M2XHVEN0NCLVx1RDdGQlx1RjkwMC1cdUZBNkRcdUZBNzAtXHVGQUQ5XHVGQjAwLVx1RkIwNlx1RkIxMy1cdUZCMTdcdUZCMUQtXHVGQjI4XHVGQjJBLVx1RkIzNlx1RkIzOC1cdUZCM0NcdUZCM0VcdUZCNDBcdUZCNDFcdUZCNDNcdUZCNDRcdUZCNDYtXHVGQkIxXHVGQkQzLVx1RkQzRFx1RkQ1MC1cdUZEOEZcdUZEOTItXHVGREM3XHVGREYwLVx1RkRGQlx1RkUwMC1cdUZFMEZcdUZFMjAtXHVGRTJGXHVGRTMzXHVGRTM0XHVGRTRELVx1RkU0Rlx1RkU3MC1cdUZFNzRcdUZFNzYtXHVGRUZDXHVGRjEwLVx1RkYxOVx1RkYyMS1cdUZGM0FcdUZGM0ZcdUZGNDEtXHVGRjVBXHVGRjY2LVx1RkZCRVx1RkZDMi1cdUZGQzdcdUZGQ0EtXHVGRkNGXHVGRkQyLVx1RkZEN1x1RkZEQS1cdUZGRENdfFx1RDgwMFtcdURDMDAtXHVEQzBCXHVEQzBELVx1REMyNlx1REMyOC1cdURDM0FcdURDM0NcdURDM0RcdURDM0YtXHVEQzREXHVEQzUwLVx1REM1RFx1REM4MC1cdURDRkFcdURENDAtXHVERDc0XHVEREZEXHVERTgwLVx1REU5Q1x1REVBMC1cdURFRDBcdURFRTBcdURGMDAtXHVERjFGXHVERjMwLVx1REY0QVx1REY1MC1cdURGN0FcdURGODAtXHVERjlEXHVERkEwLVx1REZDM1x1REZDOC1cdURGQ0ZcdURGRDEtXHVERkQ1XXxcdUQ4MDFbXHVEQzAwLVx1REM5RFx1RENBMC1cdURDQTlcdURDQjAtXHVEQ0QzXHVEQ0Q4LVx1RENGQlx1REQwMC1cdUREMjdcdUREMzAtXHVERDYzXHVERTAwLVx1REYzNlx1REY0MC1cdURGNTVcdURGNjAtXHVERjY3XXxcdUQ4MDJbXHVEQzAwLVx1REMwNVx1REMwOFx1REMwQS1cdURDMzVcdURDMzdcdURDMzhcdURDM0NcdURDM0YtXHVEQzU1XHVEQzYwLVx1REM3Nlx1REM4MC1cdURDOUVcdURDRTAtXHVEQ0YyXHVEQ0Y0XHVEQ0Y1XHVERDAwLVx1REQxNVx1REQyMC1cdUREMzlcdUREODAtXHVEREI3XHVEREJFXHVEREJGXHVERTAwLVx1REUwM1x1REUwNVx1REUwNlx1REUwQy1cdURFMTNcdURFMTUtXHVERTE3XHVERTE5LVx1REUzM1x1REUzOC1cdURFM0FcdURFM0ZcdURFNjAtXHVERTdDXHVERTgwLVx1REU5Q1x1REVDMC1cdURFQzdcdURFQzktXHVERUU2XHVERjAwLVx1REYzNVx1REY0MC1cdURGNTVcdURGNjAtXHVERjcyXHVERjgwLVx1REY5MV18XHVEODAzW1x1REMwMC1cdURDNDhcdURDODAtXHVEQ0IyXHVEQ0MwLVx1RENGMl18XHVEODA0W1x1REMwMC1cdURDNDZcdURDNjYtXHVEQzZGXHVEQzdGLVx1RENCQVx1RENEMC1cdURDRThcdURDRjAtXHVEQ0Y5XHVERDAwLVx1REQzNFx1REQzNi1cdUREM0ZcdURENTAtXHVERDczXHVERDc2XHVERDgwLVx1RERDNFx1RERDQS1cdUREQ0NcdURERDAtXHVERERBXHVERERDXHVERTAwLVx1REUxMVx1REUxMy1cdURFMzdcdURFM0VcdURFODAtXHVERTg2XHVERTg4XHVERThBLVx1REU4RFx1REU4Ri1cdURFOURcdURFOUYtXHVERUE4XHVERUIwLVx1REVFQVx1REVGMC1cdURFRjlcdURGMDAtXHVERjAzXHVERjA1LVx1REYwQ1x1REYwRlx1REYxMFx1REYxMy1cdURGMjhcdURGMkEtXHVERjMwXHVERjMyXHVERjMzXHVERjM1LVx1REYzOVx1REYzQy1cdURGNDRcdURGNDdcdURGNDhcdURGNEItXHVERjREXHVERjUwXHVERjU3XHVERjVELVx1REY2M1x1REY2Ni1cdURGNkNcdURGNzAtXHVERjc0XXxcdUQ4MDVbXHVEQzAwLVx1REM0QVx1REM1MC1cdURDNTlcdURDODAtXHVEQ0M1XHVEQ0M3XHVEQ0QwLVx1RENEOVx1REQ4MC1cdUREQjVcdUREQjgtXHVEREMwXHVEREQ4LVx1RERERFx1REUwMC1cdURFNDBcdURFNDRcdURFNTAtXHVERTU5XHVERTgwLVx1REVCN1x1REVDMC1cdURFQzlcdURGMDAtXHVERjE5XHVERjFELVx1REYyQlx1REYzMC1cdURGMzldfFx1RDgwNltcdURDQTAtXHVEQ0U5XHVEQ0ZGXHVERUMwLVx1REVGOF18XHVEODA3W1x1REMwMC1cdURDMDhcdURDMEEtXHVEQzM2XHVEQzM4LVx1REM0MFx1REM1MC1cdURDNTlcdURDNzItXHVEQzhGXHVEQzkyLVx1RENBN1x1RENBOS1cdURDQjZdfFx1RDgwOFtcdURDMDAtXHVERjk5XXxcdUQ4MDlbXHVEQzAwLVx1REM2RVx1REM4MC1cdURENDNdfFtcdUQ4MENcdUQ4MUMtXHVEODIwXHVEODQwLVx1RDg2OFx1RDg2QS1cdUQ4NkNcdUQ4NkYtXHVEODcyXVtcdURDMDAtXHVERkZGXXxcdUQ4MERbXHVEQzAwLVx1REMyRV18XHVEODExW1x1REMwMC1cdURFNDZdfFx1RDgxQVtcdURDMDAtXHVERTM4XHVERTQwLVx1REU1RVx1REU2MC1cdURFNjlcdURFRDAtXHVERUVEXHVERUYwLVx1REVGNFx1REYwMC1cdURGMzZcdURGNDAtXHVERjQzXHVERjUwLVx1REY1OVx1REY2My1cdURGNzdcdURGN0QtXHVERjhGXXxcdUQ4MUJbXHVERjAwLVx1REY0NFx1REY1MC1cdURGN0VcdURGOEYtXHVERjlGXHVERkUwXXxcdUQ4MjFbXHVEQzAwLVx1REZFQ118XHVEODIyW1x1REMwMC1cdURFRjJdfFx1RDgyQ1tcdURDMDBcdURDMDFdfFx1RDgyRltcdURDMDAtXHVEQzZBXHVEQzcwLVx1REM3Q1x1REM4MC1cdURDODhcdURDOTAtXHVEQzk5XHVEQzlEXHVEQzlFXXxcdUQ4MzRbXHVERDY1LVx1REQ2OVx1REQ2RC1cdURENzJcdUREN0ItXHVERDgyXHVERDg1LVx1REQ4Qlx1RERBQS1cdUREQURcdURFNDItXHVERTQ0XXxcdUQ4MzVbXHVEQzAwLVx1REM1NFx1REM1Ni1cdURDOUNcdURDOUVcdURDOUZcdURDQTJcdURDQTVcdURDQTZcdURDQTktXHVEQ0FDXHVEQ0FFLVx1RENCOVx1RENCQlx1RENCRC1cdURDQzNcdURDQzUtXHVERDA1XHVERDA3LVx1REQwQVx1REQwRC1cdUREMTRcdUREMTYtXHVERDFDXHVERDFFLVx1REQzOVx1REQzQi1cdUREM0VcdURENDAtXHVERDQ0XHVERDQ2XHVERDRBLVx1REQ1MFx1REQ1Mi1cdURFQTVcdURFQTgtXHVERUMwXHVERUMyLVx1REVEQVx1REVEQy1cdURFRkFcdURFRkMtXHVERjE0XHVERjE2LVx1REYzNFx1REYzNi1cdURGNEVcdURGNTAtXHVERjZFXHVERjcwLVx1REY4OFx1REY4QS1cdURGQThcdURGQUEtXHVERkMyXHVERkM0LVx1REZDQlx1REZDRS1cdURGRkZdfFx1RDgzNltcdURFMDAtXHVERTM2XHVERTNCLVx1REU2Q1x1REU3NVx1REU4NFx1REU5Qi1cdURFOUZcdURFQTEtXHVERUFGXXxcdUQ4MzhbXHVEQzAwLVx1REMwNlx1REMwOC1cdURDMThcdURDMUItXHVEQzIxXHVEQzIzXHVEQzI0XHVEQzI2LVx1REMyQV18XHVEODNBW1x1REMwMC1cdURDQzRcdURDRDAtXHVEQ0Q2XHVERDAwLVx1REQ0QVx1REQ1MC1cdURENTldfFx1RDgzQltcdURFMDAtXHVERTAzXHVERTA1LVx1REUxRlx1REUyMVx1REUyMlx1REUyNFx1REUyN1x1REUyOS1cdURFMzJcdURFMzQtXHVERTM3XHVERTM5XHVERTNCXHVERTQyXHVERTQ3XHVERTQ5XHVERTRCXHVERTRELVx1REU0Rlx1REU1MVx1REU1Mlx1REU1NFx1REU1N1x1REU1OVx1REU1Qlx1REU1RFx1REU1Rlx1REU2MVx1REU2Mlx1REU2NFx1REU2Ny1cdURFNkFcdURFNkMtXHVERTcyXHVERTc0LVx1REU3N1x1REU3OS1cdURFN0NcdURFN0VcdURFODAtXHVERTg5XHVERThCLVx1REU5Qlx1REVBMS1cdURFQTNcdURFQTUtXHVERUE5XHVERUFCLVx1REVCQl18XHVEODY5W1x1REMwMC1cdURFRDZcdURGMDAtXHVERkZGXXxcdUQ4NkRbXHVEQzAwLVx1REYzNFx1REY0MC1cdURGRkZdfFx1RDg2RVtcdURDMDAtXHVEQzFEXHVEQzIwLVx1REZGRl18XHVEODczW1x1REMwMC1cdURFQTFdfFx1RDg3RVtcdURDMDAtXHVERTFEXXxcdURCNDBbXHVERDAwLVx1RERFRl0vIH0sIHMyID0gWzU3NjAsIDgxOTIsIDgxOTMsIDgxOTQsIDgxOTUsIDgxOTYsIDgxOTcsIDgxOTgsIDgxOTksIDgyMDAsIDgyMDEsIDgyMDIsIDgyMzksIDgyODcsIDEyMjg4LCA2NTI3OV0sIHIyID0gbmV3IEFycmF5KDEyOCksIG4yID0gMDsgbjIgPCAxMjg7ICsrbjIpCiAgICAgICAgICAgIHIyW24yXSA9IG4yID49IDk3ICYmIG4yIDw9IDEyMiB8fCBuMiA+PSA2NSAmJiBuMiA8PSA5MCB8fCBuMiA9PT0gMzYgfHwgbjIgPT09IDk1OwogICAgICAgICAgZm9yIChpMiA9IG5ldyBBcnJheSgxMjgpLCBuMiA9IDA7IG4yIDwgMTI4OyArK24yKQogICAgICAgICAgICBpMltuMl0gPSBuMiA+PSA5NyAmJiBuMiA8PSAxMjIgfHwgbjIgPj0gNjUgJiYgbjIgPD0gOTAgfHwgbjIgPj0gNDggJiYgbjIgPD0gNTcgfHwgbjIgPT09IDM2IHx8IG4yID09PSA5NTsKICAgICAgICAgIGp1LmV4cG9ydHMgPSB7IGlzRGVjaW1hbERpZ2l0OiBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gNDggPD0gdDMgJiYgdDMgPD0gNTc7CiAgICAgICAgICB9LCBpc0hleERpZ2l0OiBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gNDggPD0gdDMgJiYgdDMgPD0gNTcgfHwgOTcgPD0gdDMgJiYgdDMgPD0gMTAyIHx8IDY1IDw9IHQzICYmIHQzIDw9IDcwOwogICAgICAgICAgfSwgaXNPY3RhbERpZ2l0OiBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gdDMgPj0gNDggJiYgdDMgPD0gNTU7CiAgICAgICAgICB9LCBpc1doaXRlU3BhY2U6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0MyA9PT0gMzIgfHwgdDMgPT09IDkgfHwgdDMgPT09IDExIHx8IHQzID09PSAxMiB8fCB0MyA9PT0gMTYwIHx8IHQzID49IDU3NjAgJiYgczIuaW5kZXhPZih0MykgPj0gMDsKICAgICAgICAgIH0sIGlzTGluZVRlcm1pbmF0b3I6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0MyA9PT0gMTAgfHwgdDMgPT09IDEzIHx8IHQzID09PSA4MjMyIHx8IHQzID09PSA4MjMzOwogICAgICAgICAgfSwgaXNJZGVudGlmaWVyU3RhcnRFUzU6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0MyA8IDEyOCA/IHIyW3QzXSA6IGUyLk5vbkFzY2lpSWRlbnRpZmllclN0YXJ0LnRlc3QoYTIodDMpKTsKICAgICAgICAgIH0sIGlzSWRlbnRpZmllclBhcnRFUzU6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0MyA8IDEyOCA/IGkyW3QzXSA6IGUyLk5vbkFzY2lpSWRlbnRpZmllclBhcnQudGVzdChhMih0MykpOwogICAgICAgICAgfSwgaXNJZGVudGlmaWVyU3RhcnRFUzY6IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMyA8IDEyOCA/IHIyW2UzXSA6IHQyLk5vbkFzY2lpSWRlbnRpZmllclN0YXJ0LnRlc3QoYTIoZTMpKTsKICAgICAgICAgIH0sIGlzSWRlbnRpZmllclBhcnRFUzY6IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMyA8IDEyOCA/IGkyW2UzXSA6IHQyLk5vbkFzY2lpSWRlbnRpZmllclBhcnQudGVzdChhMihlMykpOwogICAgICAgICAgfSB9OwogICAgICAgIH0oKTsKICAgICAgICB2YXIgVXUgPSB7IGV4cG9ydHM6IHt9IH07CiAgICAgICAgIWZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHQyID0ganUuZXhwb3J0czsKICAgICAgICAgIGZ1bmN0aW9uIGUyKHQzLCBlMykgewogICAgICAgICAgICByZXR1cm4gISghZTMgJiYgdDMgPT09ICJ5aWVsZCIpICYmIHMyKHQzLCBlMyk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBzMih0MywgZTMpIHsKICAgICAgICAgICAgaWYgKGUzICYmIGZ1bmN0aW9uKHQ0KSB7CiAgICAgICAgICAgICAgc3dpdGNoICh0NCkgewogICAgICAgICAgICAgICAgY2FzZSAiaW1wbGVtZW50cyI6CiAgICAgICAgICAgICAgICBjYXNlICJpbnRlcmZhY2UiOgogICAgICAgICAgICAgICAgY2FzZSAicGFja2FnZSI6CiAgICAgICAgICAgICAgICBjYXNlICJwcml2YXRlIjoKICAgICAgICAgICAgICAgIGNhc2UgInByb3RlY3RlZCI6CiAgICAgICAgICAgICAgICBjYXNlICJwdWJsaWMiOgogICAgICAgICAgICAgICAgY2FzZSAic3RhdGljIjoKICAgICAgICAgICAgICAgIGNhc2UgImxldCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSh0MykpCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIHN3aXRjaCAodDMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmV0dXJuIHQzID09PSAiaWYiIHx8IHQzID09PSAiaW4iIHx8IHQzID09PSAiZG8iOwogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJldHVybiB0MyA9PT0gInZhciIgfHwgdDMgPT09ICJmb3IiIHx8IHQzID09PSAibmV3IiB8fCB0MyA9PT0gInRyeSI7CiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgcmV0dXJuIHQzID09PSAidGhpcyIgfHwgdDMgPT09ICJlbHNlIiB8fCB0MyA9PT0gImNhc2UiIHx8IHQzID09PSAidm9pZCIgfHwgdDMgPT09ICJ3aXRoIiB8fCB0MyA9PT0gImVudW0iOwogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiB0MyA9PT0gIndoaWxlIiB8fCB0MyA9PT0gImJyZWFrIiB8fCB0MyA9PT0gImNhdGNoIiB8fCB0MyA9PT0gInRocm93IiB8fCB0MyA9PT0gImNvbnN0IiB8fCB0MyA9PT0gInlpZWxkIiB8fCB0MyA9PT0gImNsYXNzIiB8fCB0MyA9PT0gInN1cGVyIjsKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICByZXR1cm4gdDMgPT09ICJyZXR1cm4iIHx8IHQzID09PSAidHlwZW9mIiB8fCB0MyA9PT0gImRlbGV0ZSIgfHwgdDMgPT09ICJzd2l0Y2giIHx8IHQzID09PSAiZXhwb3J0IiB8fCB0MyA9PT0gImltcG9ydCI7CiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgcmV0dXJuIHQzID09PSAiZGVmYXVsdCIgfHwgdDMgPT09ICJmaW5hbGx5IiB8fCB0MyA9PT0gImV4dGVuZHMiOwogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIHJldHVybiB0MyA9PT0gImZ1bmN0aW9uIiB8fCB0MyA9PT0gImNvbnRpbnVlIiB8fCB0MyA9PT0gImRlYnVnZ2VyIjsKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgcmV0dXJuIHQzID09PSAiaW5zdGFuY2VvZiI7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gcjIodDMsIHMzKSB7CiAgICAgICAgICAgIHJldHVybiB0MyA9PT0gIm51bGwiIHx8IHQzID09PSAidHJ1ZSIgfHwgdDMgPT09ICJmYWxzZSIgfHwgZTIodDMsIHMzKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGkyKHQzLCBlMykgewogICAgICAgICAgICByZXR1cm4gdDMgPT09ICJudWxsIiB8fCB0MyA9PT0gInRydWUiIHx8IHQzID09PSAiZmFsc2UiIHx8IHMyKHQzLCBlMyk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBuMihlMykgewogICAgICAgICAgICB2YXIgczMsIHIzLCBpMzsKICAgICAgICAgICAgaWYgKGUzLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChpMyA9IGUzLmNoYXJDb2RlQXQoMCksICF0Mi5pc0lkZW50aWZpZXJTdGFydEVTNShpMykpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBmb3IgKHMzID0gMSwgcjMgPSBlMy5sZW5ndGg7IHMzIDwgcjM7ICsrczMpCiAgICAgICAgICAgICAgaWYgKGkzID0gZTMuY2hhckNvZGVBdChzMyksICF0Mi5pc0lkZW50aWZpZXJQYXJ0RVM1KGkzKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBhMihlMykgewogICAgICAgICAgICB2YXIgczMsIHIzLCBpMywgbjMsIGEzOwogICAgICAgICAgICBpZiAoZTMubGVuZ3RoID09PSAwKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgZm9yIChhMyA9IHQyLmlzSWRlbnRpZmllclN0YXJ0RVM2LCBzMyA9IDAsIHIzID0gZTMubGVuZ3RoOyBzMyA8IHIzOyArK3MzKSB7CiAgICAgICAgICAgICAgaWYgKDU1Mjk2IDw9IChpMyA9IGUzLmNoYXJDb2RlQXQoczMpKSAmJiBpMyA8PSA1NjMxOSkgewogICAgICAgICAgICAgICAgaWYgKCsrczMgPj0gcjMpCiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICghKDU2MzIwIDw9IChuMyA9IGUzLmNoYXJDb2RlQXQoczMpKSAmJiBuMyA8PSA1NzM0MykpCiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGkzID0gMTAyNCAqIChpMyAtIDU1Mjk2KSArIChuMyAtIDU2MzIwKSArIDY1NTM2OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoIWEzKGkzKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICBhMyA9IHQyLmlzSWRlbnRpZmllclBhcnRFUzY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBVdS5leHBvcnRzID0geyBpc0tleXdvcmRFUzU6IGUyLCBpc0tleXdvcmRFUzY6IHMyLCBpc1Jlc2VydmVkV29yZEVTNTogcjIsIGlzUmVzZXJ2ZWRXb3JkRVM2OiBpMiwgaXNSZXN0cmljdGVkV29yZDogZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgcmV0dXJuIHQzID09PSAiZXZhbCIgfHwgdDMgPT09ICJhcmd1bWVudHMiOwogICAgICAgICAgfSwgaXNJZGVudGlmaWVyTmFtZUVTNTogbjIsIGlzSWRlbnRpZmllck5hbWVFUzY6IGEyLCBpc0lkZW50aWZpZXJFUzU6IGZ1bmN0aW9uKHQzLCBlMykgewogICAgICAgICAgICByZXR1cm4gbjIodDMpICYmICFyMih0MywgZTMpOwogICAgICAgICAgfSwgaXNJZGVudGlmaWVyRVM2OiBmdW5jdGlvbih0MywgZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGEyKHQzKSAmJiAhaTIodDMsIGUzKTsKICAgICAgICAgIH0gfTsKICAgICAgICB9KCksIE11LmFzdCA9IFJ1LmV4cG9ydHMsIE11LmNvZGUgPSBqdS5leHBvcnRzLCBNdS5rZXl3b3JkID0gVXUuZXhwb3J0czsKICAgICAgICBjb25zdCBfdSA9IE11LmtleXdvcmQuaXNJZGVudGlmaWVyTmFtZUVTNSwgeyBnZXRMYXN0OiB6dSwgaGFzTmV3bGluZTogSHUsIHNraXBXaGl0ZXNwYWNlOiBWdSwgaXNOb25FbXB0eUFycmF5OiBxdSwgaXNOZXh0TGluZUVtcHR5QWZ0ZXJJbmRleDogV3UsIGdldFN0cmluZ1dpZHRoOiBLdSB9ID0gT28sIHsgbG9jU3RhcnQ6IEd1LCBsb2NFbmQ6IFh1LCBoYXNTYW1lTG9jU3RhcnQ6IEp1IH0gPSB3dSwgJHUgPSAiKD86KD89LilcXHMpIiwgWXUgPSBuZXcgUmVnRXhwKCJeIi5jb25jYXQoJHUsICIqOiIpKSwgUXUgPSBuZXcgUmVnRXhwKCJeIi5jb25jYXQoJHUsICIqOjoiKSk7CiAgICAgICAgZnVuY3Rpb24gWnUodDIpIHsKICAgICAgICAgIHJldHVybiB0Mi50eXBlID09PSAiQmxvY2siIHx8IHQyLnR5cGUgPT09ICJDb21tZW50QmxvY2siIHx8IHQyLnR5cGUgPT09ICJNdWx0aUxpbmUiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0aCh0MikgewogICAgICAgICAgcmV0dXJuIHQyLnR5cGUgPT09ICJMaW5lIiB8fCB0Mi50eXBlID09PSAiQ29tbWVudExpbmUiIHx8IHQyLnR5cGUgPT09ICJTaW5nbGVMaW5lIiB8fCB0Mi50eXBlID09PSAiSGFzaGJhbmdDb21tZW50IiB8fCB0Mi50eXBlID09PSAiSFRNTE9wZW4iIHx8IHQyLnR5cGUgPT09ICJIVE1MQ2xvc2UiOwogICAgICAgIH0KICAgICAgICBjb25zdCBlaCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KFsiRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uIiwgIkV4cG9ydERlZmF1bHRTcGVjaWZpZXIiLCAiRGVjbGFyZUV4cG9ydERlY2xhcmF0aW9uIiwgIkV4cG9ydE5hbWVkRGVjbGFyYXRpb24iLCAiRXhwb3J0QWxsRGVjbGFyYXRpb24iXSk7CiAgICAgICAgZnVuY3Rpb24gc2godDIpIHsKICAgICAgICAgIHJldHVybiB0MiAmJiBlaC5oYXModDIudHlwZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJoKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIudHlwZSA9PT0gIk51bWVyaWNMaXRlcmFsIiB8fCB0Mi50eXBlID09PSAiTGl0ZXJhbCIgJiYgdHlwZW9mIHQyLnZhbHVlID09ICJudW1iZXIiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpaCh0MikgewogICAgICAgICAgcmV0dXJuIHQyLnR5cGUgPT09ICJTdHJpbmdMaXRlcmFsIiB8fCB0Mi50eXBlID09PSAiTGl0ZXJhbCIgJiYgdHlwZW9mIHQyLnZhbHVlID09ICJzdHJpbmciOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBuaCh0MikgewogICAgICAgICAgcmV0dXJuIHQyLnR5cGUgPT09ICJGdW5jdGlvbkV4cHJlc3Npb24iIHx8IHQyLnR5cGUgPT09ICJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFoKHQyKSB7CiAgICAgICAgICByZXR1cm4gZGgodDIpICYmIHQyLmNhbGxlZS50eXBlID09PSAiSWRlbnRpZmllciIgJiYgKHQyLmNhbGxlZS5uYW1lID09PSAiYXN5bmMiIHx8IHQyLmNhbGxlZS5uYW1lID09PSAiaW5qZWN0IiB8fCB0Mi5jYWxsZWUubmFtZSA9PT0gImZha2VBc3luYyIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvaCh0MikgewogICAgICAgICAgcmV0dXJuIHQyLnR5cGUgPT09ICJKU1hFbGVtZW50IiB8fCB0Mi50eXBlID09PSAiSlNYRnJhZ21lbnQiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB1aCh0MikgewogICAgICAgICAgcmV0dXJuIHQyLmtpbmQgPT09ICJnZXQiIHx8IHQyLmtpbmQgPT09ICJzZXQiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBoaCh0MikgewogICAgICAgICAgcmV0dXJuIHVoKHQyKSB8fCBKdSh0MiwgdDIudmFsdWUpOwogICAgICAgIH0KICAgICAgICBjb25zdCBwaCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KFsiQmluYXJ5RXhwcmVzc2lvbiIsICJMb2dpY2FsRXhwcmVzc2lvbiIsICJOR1BpcGVFeHByZXNzaW9uIl0pOwogICAgICAgIGNvbnN0IGNoID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJBbnlUeXBlQW5ub3RhdGlvbiIsICJUU0FueUtleXdvcmQiLCAiTnVsbExpdGVyYWxUeXBlQW5ub3RhdGlvbiIsICJUU051bGxLZXl3b3JkIiwgIlRoaXNUeXBlQW5ub3RhdGlvbiIsICJUU1RoaXNUeXBlIiwgIk51bWJlclR5cGVBbm5vdGF0aW9uIiwgIlRTTnVtYmVyS2V5d29yZCIsICJWb2lkVHlwZUFubm90YXRpb24iLCAiVFNWb2lkS2V5d29yZCIsICJCb29sZWFuVHlwZUFubm90YXRpb24iLCAiVFNCb29sZWFuS2V5d29yZCIsICJCaWdJbnRUeXBlQW5ub3RhdGlvbiIsICJUU0JpZ0ludEtleXdvcmQiLCAiU3ltYm9sVHlwZUFubm90YXRpb24iLCAiVFNTeW1ib2xLZXl3b3JkIiwgIlN0cmluZ1R5cGVBbm5vdGF0aW9uIiwgIlRTU3RyaW5nS2V5d29yZCIsICJCb29sZWFuTGl0ZXJhbFR5cGVBbm5vdGF0aW9uIiwgIlN0cmluZ0xpdGVyYWxUeXBlQW5ub3RhdGlvbiIsICJCaWdJbnRMaXRlcmFsVHlwZUFubm90YXRpb24iLCAiTnVtYmVyTGl0ZXJhbFR5cGVBbm5vdGF0aW9uIiwgIlRTTGl0ZXJhbFR5cGUiLCAiVFNUZW1wbGF0ZUxpdGVyYWxUeXBlIiwgIkVtcHR5VHlwZUFubm90YXRpb24iLCAiTWl4ZWRUeXBlQW5ub3RhdGlvbiIsICJUU05ldmVyS2V5d29yZCIsICJUU09iamVjdEtleXdvcmQiLCAiVFNVbmRlZmluZWRLZXl3b3JkIiwgIlRTVW5rbm93bktleXdvcmQiXSk7CiAgICAgICAgY29uc3QgbGggPSAvXig/OnNraXB8W2Z4XT8oPzppdHxkZXNjcmliZXx0ZXN0KSkkLzsKICAgICAgICBmdW5jdGlvbiBkaCh0MikgewogICAgICAgICAgcmV0dXJuIHQyICYmICh0Mi50eXBlID09PSAiQ2FsbEV4cHJlc3Npb24iIHx8IHQyLnR5cGUgPT09ICJPcHRpb25hbENhbGxFeHByZXNzaW9uIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIERoKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIgJiYgKHQyLnR5cGUgPT09ICJNZW1iZXJFeHByZXNzaW9uIiB8fCB0Mi50eXBlID09PSAiT3B0aW9uYWxNZW1iZXJFeHByZXNzaW9uIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG1oKHQyKSB7CiAgICAgICAgICByZXR1cm4gL14oPzpcZCt8XGQrXC5cZCspJC8udGVzdCh0Mik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGZoKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIucXVhc2lzLnNvbWUoKHQzKSA9PiB0My52YWx1ZS5yYXcuaW5jbHVkZXMoIlxuIikpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB5aCh0MikgewogICAgICAgICAgcmV0dXJuIHQyLmV4dHJhID8gdDIuZXh0cmEucmF3IDogdDIucmF3OwogICAgICAgIH0KICAgICAgICBjb25zdCBFaCA9IHsgIj09IjogdHJ1ZSwgIiE9IjogdHJ1ZSwgIj09PSI6IHRydWUsICIhPT0iOiB0cnVlIH0sIEFoID0geyAiKiI6IHRydWUsICIvIjogdHJ1ZSwgIiUiOiB0cnVlIH0sIENoID0geyAiPj4iOiB0cnVlLCAiPj4+IjogdHJ1ZSwgIjw8IjogdHJ1ZSB9OwogICAgICAgIGNvbnN0IHhoID0ge307CiAgICAgICAgZm9yIChjb25zdCBbdDIsIGUyXSBvZiBbWyJ8PiJdLCBbIj8/Il0sIFsifHwiXSwgWyImJiJdLCBbInwiXSwgWyJeIl0sIFsiJiJdLCBbIj09IiwgIj09PSIsICIhPSIsICIhPT0iXSwgWyI8IiwgIj4iLCAiPD0iLCAiPj0iLCAiaW4iLCAiaW5zdGFuY2VvZiJdLCBbIj4+IiwgIjw8IiwgIj4+PiJdLCBbIisiLCAiLSJdLCBbIioiLCAiLyIsICIlIl0sIFsiKioiXV0uZW50cmllcygpKQogICAgICAgICAgZm9yIChjb25zdCBzMiBvZiBlMikKICAgICAgICAgICAgeGhbczJdID0gdDI7CiAgICAgICAgZnVuY3Rpb24gRmgodDIpIHsKICAgICAgICAgIHJldHVybiB4aFt0Ml07CiAgICAgICAgfQogICAgICAgIGNvbnN0IGdoID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7CiAgICAgICAgZnVuY3Rpb24gUGgodDIpIHsKICAgICAgICAgIGlmIChnaC5oYXModDIpKQogICAgICAgICAgICByZXR1cm4gZ2guZ2V0KHQyKTsKICAgICAgICAgIGNvbnN0IGUyID0gW107CiAgICAgICAgICByZXR1cm4gdDIudGhpcyAmJiBlMi5wdXNoKHQyLnRoaXMpLCBBcnJheS5pc0FycmF5KHQyLnBhcmFtZXRlcnMpID8gZTIucHVzaCguLi50Mi5wYXJhbWV0ZXJzKSA6IEFycmF5LmlzQXJyYXkodDIucGFyYW1zKSAmJiBlMi5wdXNoKC4uLnQyLnBhcmFtcyksIHQyLnJlc3QgJiYgZTIucHVzaCh0Mi5yZXN0KSwgZ2guc2V0KHQyLCBlMiksIGUyOwogICAgICAgIH0KICAgICAgICBjb25zdCBUaCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgV2Vha01hcCgpOwogICAgICAgIGZ1bmN0aW9uIGJoKHQyKSB7CiAgICAgICAgICBpZiAoVGguaGFzKHQyKSkKICAgICAgICAgICAgcmV0dXJuIFRoLmdldCh0Mik7CiAgICAgICAgICBsZXQgZTIgPSB0Mi5hcmd1bWVudHM7CiAgICAgICAgICByZXR1cm4gdDIudHlwZSA9PT0gIkltcG9ydEV4cHJlc3Npb24iICYmIChlMiA9IFt0Mi5zb3VyY2VdLCB0Mi5hdHRyaWJ1dGVzICYmIGUyLnB1c2godDIuYXR0cmlidXRlcykpLCBUaC5zZXQodDIsIGUyKSwgZTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFNoKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIudmFsdWUudHJpbSgpID09PSAicHJldHRpZXItaWdub3JlIiAmJiAhdDIudW5pZ25vcmU7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHdoKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIgJiYgKHQyLnByZXR0aWVySWdub3JlIHx8IEloKHQyLCBCaC5QcmV0dGllcklnbm9yZSkpOwogICAgICAgIH0KICAgICAgICBjb25zdCBCaCA9IHsgTGVhZGluZzogMiwgVHJhaWxpbmc6IDQsIERhbmdsaW5nOiA4LCBCbG9jazogMTYsIExpbmU6IDMyLCBQcmV0dGllcklnbm9yZTogNjQsIEZpcnN0OiAxMjgsIExhc3Q6IDI1NiB9LCBOaCA9ICh0MiwgZTIpID0+IHsKICAgICAgICAgIGlmICh0eXBlb2YgdDIgPT0gImZ1bmN0aW9uIiAmJiAoZTIgPSB0MiwgdDIgPSAwKSwgdDIgfHwgZTIpCiAgICAgICAgICAgIHJldHVybiAoczIsIHIyLCBpMikgPT4gISh0MiAmIEJoLkxlYWRpbmcgJiYgIXMyLmxlYWRpbmcgfHwgdDIgJiBCaC5UcmFpbGluZyAmJiAhczIudHJhaWxpbmcgfHwgdDIgJiBCaC5EYW5nbGluZyAmJiAoczIubGVhZGluZyB8fCBzMi50cmFpbGluZykgfHwgdDIgJiBCaC5CbG9jayAmJiAhWnUoczIpIHx8IHQyICYgQmguTGluZSAmJiAhdGgoczIpIHx8IHQyICYgQmguRmlyc3QgJiYgcjIgIT09IDAgfHwgdDIgJiBCaC5MYXN0ICYmIHIyICE9PSBpMi5sZW5ndGggLSAxIHx8IHQyICYgQmguUHJldHRpZXJJZ25vcmUgJiYgIVNoKHMyKSB8fCBlMiAmJiAhZTIoczIpKTsKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIEloKHQyLCBlMiwgczIpIHsKICAgICAgICAgIGlmICghdDIgfHwgIXF1KHQyLmNvbW1lbnRzKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgY29uc3QgcjIgPSBOaChlMiwgczIpOwogICAgICAgICAgcmV0dXJuICFyMiB8fCB0Mi5jb21tZW50cy5zb21lKHIyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdmgodDIsIGUyLCBzMikgewogICAgICAgICAgaWYgKCF0MiB8fCAhQXJyYXkuaXNBcnJheSh0Mi5jb21tZW50cykpCiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgIGNvbnN0IHIyID0gTmgoZTIsIHMyKTsKICAgICAgICAgIHJldHVybiByMiA/IHQyLmNvbW1lbnRzLmZpbHRlcihyMikgOiB0Mi5jb21tZW50czsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24ga2godDIpIHsKICAgICAgICAgIHJldHVybiBkaCh0MikgfHwgdDIudHlwZSA9PT0gIk5ld0V4cHJlc3Npb24iIHx8IHQyLnR5cGUgPT09ICJJbXBvcnRFeHByZXNzaW9uIjsKICAgICAgICB9CiAgICAgICAgdmFyIExoID0geyBnZXRGdW5jdGlvblBhcmFtZXRlcnM6IFBoLCBpdGVyYXRlRnVuY3Rpb25QYXJhbWV0ZXJzUGF0aDogZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICBjb25zdCBzMiA9IHQyLmdldFZhbHVlKCk7CiAgICAgICAgICBsZXQgcjIgPSAwOwogICAgICAgICAgY29uc3QgaTIgPSAodDMpID0+IGUyKHQzLCByMisrKTsKICAgICAgICAgIHMyLnRoaXMgJiYgdDIuY2FsbChpMiwgInRoaXMiKSwgQXJyYXkuaXNBcnJheShzMi5wYXJhbWV0ZXJzKSA/IHQyLmVhY2goaTIsICJwYXJhbWV0ZXJzIikgOiBBcnJheS5pc0FycmF5KHMyLnBhcmFtcykgJiYgdDIuZWFjaChpMiwgInBhcmFtcyIpLCBzMi5yZXN0ICYmIHQyLmNhbGwoaTIsICJyZXN0Iik7CiAgICAgICAgfSwgZ2V0Q2FsbEFyZ3VtZW50czogYmgsIGl0ZXJhdGVDYWxsQXJndW1lbnRzUGF0aDogZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICBjb25zdCBzMiA9IHQyLmdldFZhbHVlKCk7CiAgICAgICAgICBzMi50eXBlID09PSAiSW1wb3J0RXhwcmVzc2lvbiIgPyAodDIuY2FsbCgodDMpID0+IGUyKHQzLCAwKSwgInNvdXJjZSIpLCBzMi5hdHRyaWJ1dGVzICYmIHQyLmNhbGwoKHQzKSA9PiBlMih0MywgMSksICJhdHRyaWJ1dGVzIikpIDogdDIuZWFjaChlMiwgImFyZ3VtZW50cyIpOwogICAgICAgIH0sIGhhc1Jlc3RQYXJhbWV0ZXI6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICBpZiAodDIucmVzdCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICBjb25zdCBlMiA9IFBoKHQyKTsKICAgICAgICAgIHJldHVybiBlMi5sZW5ndGggPiAwICYmIHp1KGUyKS50eXBlID09PSAiUmVzdEVsZW1lbnQiOwogICAgICAgIH0sIGdldExlZnRTaWRlOiBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIHQyLmV4cHJlc3Npb25zID8gdDIuZXhwcmVzc2lvbnNbMF0gOiB0Mi5sZWZ0IHx8IHQyLnRlc3QgfHwgdDIuY2FsbGVlIHx8IHQyLm9iamVjdCB8fCB0Mi50YWcgfHwgdDIuYXJndW1lbnQgfHwgdDIuZXhwcmVzc2lvbjsKICAgICAgICB9LCBnZXRMZWZ0U2lkZVBhdGhOYW1lOiBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIGlmIChlMi5leHByZXNzaW9ucykKICAgICAgICAgICAgcmV0dXJuIFsiZXhwcmVzc2lvbnMiLCAwXTsKICAgICAgICAgIGlmIChlMi5sZWZ0KQogICAgICAgICAgICByZXR1cm4gWyJsZWZ0Il07CiAgICAgICAgICBpZiAoZTIudGVzdCkKICAgICAgICAgICAgcmV0dXJuIFsidGVzdCJdOwogICAgICAgICAgaWYgKGUyLm9iamVjdCkKICAgICAgICAgICAgcmV0dXJuIFsib2JqZWN0Il07CiAgICAgICAgICBpZiAoZTIuY2FsbGVlKQogICAgICAgICAgICByZXR1cm4gWyJjYWxsZWUiXTsKICAgICAgICAgIGlmIChlMi50YWcpCiAgICAgICAgICAgIHJldHVybiBbInRhZyJdOwogICAgICAgICAgaWYgKGUyLmFyZ3VtZW50KQogICAgICAgICAgICByZXR1cm4gWyJhcmd1bWVudCJdOwogICAgICAgICAgaWYgKGUyLmV4cHJlc3Npb24pCiAgICAgICAgICAgIHJldHVybiBbImV4cHJlc3Npb24iXTsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBub2RlIGhhcyBubyBsZWZ0IHNpZGUuIik7CiAgICAgICAgfSwgZ2V0UGFyZW50RXhwb3J0RGVjbGFyYXRpb246IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICBjb25zdCBlMiA9IHQyLmdldFBhcmVudE5vZGUoKTsKICAgICAgICAgIHJldHVybiB0Mi5nZXROYW1lKCkgPT09ICJkZWNsYXJhdGlvbiIgJiYgc2goZTIpID8gZTIgOiBudWxsOwogICAgICAgIH0sIGdldFR5cGVTY3JpcHRNYXBwZWRUeXBlTW9kaWZpZXI6IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgcmV0dXJuIHQyID09PSAiKyIgPyAiKyIgKyBlMiA6IHQyID09PSAiLSIgPyAiLSIgKyBlMiA6IGUyOwogICAgICAgIH0sIGhhc0Zsb3dBbm5vdGF0aW9uQ29tbWVudDogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiBxdSh0MikgJiYgWnUodDJbMF0pICYmIFF1LnRlc3QodDJbMF0udmFsdWUpOwogICAgICAgIH0sIGhhc0Zsb3dTaG9ydGhhbmRBbm5vdGF0aW9uQ29tbWVudDogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiB0Mi5leHRyYSAmJiB0Mi5leHRyYS5wYXJlbnRoZXNpemVkICYmIHF1KHQyLnRyYWlsaW5nQ29tbWVudHMpICYmIFp1KHQyLnRyYWlsaW5nQ29tbWVudHNbMF0pICYmIFl1LnRlc3QodDIudHJhaWxpbmdDb21tZW50c1swXS52YWx1ZSk7CiAgICAgICAgfSwgaGFzTGVhZGluZ093bkxpbmVDb21tZW50OiBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIHJldHVybiBvaChlMikgPyB3aChlMikgOiBJaChlMiwgQmguTGVhZGluZywgKGUzKSA9PiBIdSh0MiwgWHUoZTMpKSk7CiAgICAgICAgfSwgaGFzTmFrZWRMZWZ0U2lkZTogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiB0Mi50eXBlID09PSAiQXNzaWdubWVudEV4cHJlc3Npb24iIHx8IHQyLnR5cGUgPT09ICJCaW5hcnlFeHByZXNzaW9uIiB8fCB0Mi50eXBlID09PSAiTG9naWNhbEV4cHJlc3Npb24iIHx8IHQyLnR5cGUgPT09ICJOR1BpcGVFeHByZXNzaW9uIiB8fCB0Mi50eXBlID09PSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIiB8fCBkaCh0MikgfHwgRGgodDIpIHx8IHQyLnR5cGUgPT09ICJTZXF1ZW5jZUV4cHJlc3Npb24iIHx8IHQyLnR5cGUgPT09ICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iIHx8IHQyLnR5cGUgPT09ICJCaW5kRXhwcmVzc2lvbiIgfHwgdDIudHlwZSA9PT0gIlVwZGF0ZUV4cHJlc3Npb24iICYmICF0Mi5wcmVmaXggfHwgdDIudHlwZSA9PT0gIlRTQXNFeHByZXNzaW9uIiB8fCB0Mi50eXBlID09PSAiVFNOb25OdWxsRXhwcmVzc2lvbiI7CiAgICAgICAgfSwgaGFzTm9kZTogZnVuY3Rpb24gdDIoZTIsIHMyKSB7CiAgICAgICAgICBpZiAoIWUyIHx8IHR5cGVvZiBlMiAhPSAib2JqZWN0IikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZTIpKQogICAgICAgICAgICByZXR1cm4gZTIuc29tZSgoZTMpID0+IHQyKGUzLCBzMikpOwogICAgICAgICAgY29uc3QgcjIgPSBzMihlMik7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIHIyID09ICJib29sZWFuIiA/IHIyIDogT2JqZWN0LnZhbHVlcyhlMikuc29tZSgoZTMpID0+IHQyKGUzLCBzMikpOwogICAgICAgIH0sIGhhc0lnbm9yZUNvbW1lbnQ6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gd2godDIuZ2V0VmFsdWUoKSk7CiAgICAgICAgfSwgaGFzTm9kZUlnbm9yZUNvbW1lbnQ6IHdoLCBpZGVudGl0eTogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9LCBpc0JpbmFyeWlzaDogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiBwaC5oYXModDIudHlwZSk7CiAgICAgICAgfSwgaXNCbG9ja0NvbW1lbnQ6IFp1LCBpc0NhbGxMaWtlRXhwcmVzc2lvbjoga2gsIGlzRW5hYmxlZEhhY2tQaXBlbGluZTogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiBCb29sZWFuKHQyLl9faXNVc2luZ0hhY2tQaXBlbGluZSk7CiAgICAgICAgfSwgaXNMaW5lQ29tbWVudDogdGgsIGlzUHJldHRpZXJJZ25vcmVDb21tZW50OiBTaCwgaXNDYWxsRXhwcmVzc2lvbjogZGgsIGlzTWVtYmVyRXhwcmVzc2lvbjogRGgsIGlzRXhwb3J0RGVjbGFyYXRpb246IHNoLCBpc0Zsb3dBbm5vdGF0aW9uQ29tbWVudDogZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICBjb25zdCBzMiA9IEd1KGUyKSwgcjIgPSBWdSh0MiwgWHUoZTIpKTsKICAgICAgICAgIHJldHVybiByMiAhPT0gZmFsc2UgJiYgdDIuc2xpY2UoczIsIHMyICsgMikgPT09ICIvKiIgJiYgdDIuc2xpY2UocjIsIHIyICsgMikgPT09ICIqLyI7CiAgICAgICAgfSwgaXNGdW5jdGlvbkNvbXBvc2l0aW9uQXJnczogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIGlmICh0Mi5sZW5ndGggPD0gMSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgbGV0IGUyID0gMDsKICAgICAgICAgIGZvciAoY29uc3QgczIgb2YgdDIpCiAgICAgICAgICAgIGlmIChuaChzMikpIHsKICAgICAgICAgICAgICBpZiAoZTIgKz0gMSwgZTIgPiAxKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGgoczIpKSB7CiAgICAgICAgICAgICAgZm9yIChjb25zdCB0MyBvZiBzMi5hcmd1bWVudHMpCiAgICAgICAgICAgICAgICBpZiAobmgodDMpKQogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0sIGlzRnVuY3Rpb25Ob3RhdGlvbjogaGgsIGlzRnVuY3Rpb25PckFycm93RXhwcmVzc2lvbjogbmgsIGlzR2V0dGVyT3JTZXR0ZXI6IHVoLCBpc0plc3RFYWNoVGVtcGxhdGVMaXRlcmFsOiBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIGNvbnN0IHMyID0gL15bZnhdPyg/OmRlc2NyaWJlfGl0fHRlc3QpJC87CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gIlRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbiIgJiYgZTIucXVhc2kgPT09IHQyICYmIGUyLnRhZy50eXBlID09PSAiTWVtYmVyRXhwcmVzc2lvbiIgJiYgZTIudGFnLnByb3BlcnR5LnR5cGUgPT09ICJJZGVudGlmaWVyIiAmJiBlMi50YWcucHJvcGVydHkubmFtZSA9PT0gImVhY2giICYmIChlMi50YWcub2JqZWN0LnR5cGUgPT09ICJJZGVudGlmaWVyIiAmJiBzMi50ZXN0KGUyLnRhZy5vYmplY3QubmFtZSkgfHwgZTIudGFnLm9iamVjdC50eXBlID09PSAiTWVtYmVyRXhwcmVzc2lvbiIgJiYgZTIudGFnLm9iamVjdC5wcm9wZXJ0eS50eXBlID09PSAiSWRlbnRpZmllciIgJiYgKGUyLnRhZy5vYmplY3QucHJvcGVydHkubmFtZSA9PT0gIm9ubHkiIHx8IGUyLnRhZy5vYmplY3QucHJvcGVydHkubmFtZSA9PT0gInNraXAiKSAmJiBlMi50YWcub2JqZWN0Lm9iamVjdC50eXBlID09PSAiSWRlbnRpZmllciIgJiYgczIudGVzdChlMi50YWcub2JqZWN0Lm9iamVjdC5uYW1lKSk7CiAgICAgICAgfSwgaXNKc3hOb2RlOiBvaCwgaXNMaXRlcmFsOiBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIHQyLnR5cGUgPT09ICJCb29sZWFuTGl0ZXJhbCIgfHwgdDIudHlwZSA9PT0gIkRpcmVjdGl2ZUxpdGVyYWwiIHx8IHQyLnR5cGUgPT09ICJMaXRlcmFsIiB8fCB0Mi50eXBlID09PSAiTnVsbExpdGVyYWwiIHx8IHQyLnR5cGUgPT09ICJOdW1lcmljTGl0ZXJhbCIgfHwgdDIudHlwZSA9PT0gIkJpZ0ludExpdGVyYWwiIHx8IHQyLnR5cGUgPT09ICJEZWNpbWFsTGl0ZXJhbCIgfHwgdDIudHlwZSA9PT0gIlJlZ0V4cExpdGVyYWwiIHx8IHQyLnR5cGUgPT09ICJTdHJpbmdMaXRlcmFsIiB8fCB0Mi50eXBlID09PSAiVGVtcGxhdGVMaXRlcmFsIiB8fCB0Mi50eXBlID09PSAiVFNUeXBlTGl0ZXJhbCIgfHwgdDIudHlwZSA9PT0gIkpTWFRleHQiOwogICAgICAgIH0sIGlzTG9uZ0N1cnJpZWRDYWxsRXhwcmVzc2lvbjogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIGNvbnN0IGUyID0gdDIuZ2V0VmFsdWUoKSwgczIgPSB0Mi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICByZXR1cm4gZGgoZTIpICYmIGRoKHMyKSAmJiBzMi5jYWxsZWUgPT09IGUyICYmIGUyLmFyZ3VtZW50cy5sZW5ndGggPiBzMi5hcmd1bWVudHMubGVuZ3RoICYmIHMyLmFyZ3VtZW50cy5sZW5ndGggPiAwOwogICAgICAgIH0sIGlzU2ltcGxlQ2FsbEFyZ3VtZW50OiBmdW5jdGlvbiB0MihlMiwgczIpIHsKICAgICAgICAgIGlmIChzMiA+PSAyKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBjb25zdCByMiA9IChlMykgPT4gdDIoZTMsIHMyICsgMSksIGkyID0gZTIudHlwZSA9PT0gIkxpdGVyYWwiICYmICJyZWdleCIgaW4gZTIgJiYgZTIucmVnZXgucGF0dGVybiB8fCBlMi50eXBlID09PSAiUmVnRXhwTGl0ZXJhbCIgJiYgZTIucGF0dGVybjsKICAgICAgICAgIHJldHVybiAhKGkyICYmIEt1KGkyKSA+IDUpICYmIChlMi50eXBlID09PSAiTGl0ZXJhbCIgfHwgZTIudHlwZSA9PT0gIkJpZ0ludExpdGVyYWwiIHx8IGUyLnR5cGUgPT09ICJEZWNpbWFsTGl0ZXJhbCIgfHwgZTIudHlwZSA9PT0gIkJvb2xlYW5MaXRlcmFsIiB8fCBlMi50eXBlID09PSAiTnVsbExpdGVyYWwiIHx8IGUyLnR5cGUgPT09ICJOdW1lcmljTGl0ZXJhbCIgfHwgZTIudHlwZSA9PT0gIlJlZ0V4cExpdGVyYWwiIHx8IGUyLnR5cGUgPT09ICJTdHJpbmdMaXRlcmFsIiB8fCBlMi50eXBlID09PSAiSWRlbnRpZmllciIgfHwgZTIudHlwZSA9PT0gIlRoaXNFeHByZXNzaW9uIiB8fCBlMi50eXBlID09PSAiU3VwZXIiIHx8IGUyLnR5cGUgPT09ICJQcml2YXRlTmFtZSIgfHwgZTIudHlwZSA9PT0gIlByaXZhdGVJZGVudGlmaWVyIiB8fCBlMi50eXBlID09PSAiQXJndW1lbnRQbGFjZWhvbGRlciIgfHwgZTIudHlwZSA9PT0gIkltcG9ydCIgfHwgKGUyLnR5cGUgPT09ICJUZW1wbGF0ZUxpdGVyYWwiID8gZTIucXVhc2lzLmV2ZXJ5KCh0MykgPT4gIXQzLnZhbHVlLnJhdy5pbmNsdWRlcygiXG4iKSkgJiYgZTIuZXhwcmVzc2lvbnMuZXZlcnkocjIpIDogZTIudHlwZSA9PT0gIk9iamVjdEV4cHJlc3Npb24iID8gZTIucHJvcGVydGllcy5ldmVyeSgodDMpID0+ICF0My5jb21wdXRlZCAmJiAodDMuc2hvcnRoYW5kIHx8IHQzLnZhbHVlICYmIHIyKHQzLnZhbHVlKSkpIDogZTIudHlwZSA9PT0gIkFycmF5RXhwcmVzc2lvbiIgPyBlMi5lbGVtZW50cy5ldmVyeSgodDMpID0+IHQzID09PSBudWxsIHx8IHIyKHQzKSkgOiBraChlMikgPyAoZTIudHlwZSA9PT0gIkltcG9ydEV4cHJlc3Npb24iIHx8IHQyKGUyLmNhbGxlZSwgczIpKSAmJiBiaChlMikuZXZlcnkocjIpIDogRGgoZTIpID8gdDIoZTIub2JqZWN0LCBzMikgJiYgdDIoZTIucHJvcGVydHksIHMyKSA6IGUyLnR5cGUgIT09ICJVbmFyeUV4cHJlc3Npb24iIHx8IGUyLm9wZXJhdG9yICE9PSAiISIgJiYgZTIub3BlcmF0b3IgIT09ICItIiA/IGUyLnR5cGUgPT09ICJUU05vbk51bGxFeHByZXNzaW9uIiAmJiB0MihlMi5leHByZXNzaW9uLCBzMikgOiB0MihlMi5hcmd1bWVudCwgczIpKSk7CiAgICAgICAgfSwgaXNNZW1iZXJpc2g6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gRGgodDIpIHx8IHQyLnR5cGUgPT09ICJCaW5kRXhwcmVzc2lvbiIgJiYgQm9vbGVhbih0Mi5vYmplY3QpOwogICAgICAgIH0sIGlzTnVtZXJpY0xpdGVyYWw6IHJoLCBpc1NpZ25lZE51bWVyaWNMaXRlcmFsOiBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIHQyLnR5cGUgPT09ICJVbmFyeUV4cHJlc3Npb24iICYmICh0Mi5vcGVyYXRvciA9PT0gIisiIHx8IHQyLm9wZXJhdG9yID09PSAiLSIpICYmIHJoKHQyLmFyZ3VtZW50KTsKICAgICAgICB9LCBpc09iamVjdFByb3BlcnR5OiBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIHQyICYmICh0Mi50eXBlID09PSAiT2JqZWN0UHJvcGVydHkiIHx8IHQyLnR5cGUgPT09ICJQcm9wZXJ0eSIgJiYgIXQyLm1ldGhvZCAmJiB0Mi5raW5kID09PSAiaW5pdCIpOwogICAgICAgIH0sIGlzT2JqZWN0VHlwZTogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiB0Mi50eXBlID09PSAiT2JqZWN0VHlwZUFubm90YXRpb24iIHx8IHQyLnR5cGUgPT09ICJUU1R5cGVMaXRlcmFsIiB8fCB0Mi50eXBlID09PSAiVFNNYXBwZWRUeXBlIjsKICAgICAgICB9LCBpc09iamVjdFR5cGVQcm9wZXJ0eUFGdW5jdGlvbjogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiAhKHQyLnR5cGUgIT09ICJPYmplY3RUeXBlUHJvcGVydHkiICYmIHQyLnR5cGUgIT09ICJPYmplY3RUeXBlSW50ZXJuYWxTbG90IiB8fCB0Mi52YWx1ZS50eXBlICE9PSAiRnVuY3Rpb25UeXBlQW5ub3RhdGlvbiIgfHwgdDIuc3RhdGljIHx8IGhoKHQyKSk7CiAgICAgICAgfSwgaXNTaW1wbGVUeXBlOiBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuICEhdDIgJiYgKCEodDIudHlwZSAhPT0gIkdlbmVyaWNUeXBlQW5ub3RhdGlvbiIgJiYgdDIudHlwZSAhPT0gIlRTVHlwZVJlZmVyZW5jZSIgfHwgdDIudHlwZVBhcmFtZXRlcnMpIHx8ICEhY2guaGFzKHQyLnR5cGUpKTsKICAgICAgICB9LCBpc1NpbXBsZU51bWJlcjogbWgsIGlzU2ltcGxlVGVtcGxhdGVMaXRlcmFsOiBmdW5jdGlvbih0MikgewogICAgICAgICAgbGV0IGUyID0gImV4cHJlc3Npb25zIjsKICAgICAgICAgIHQyLnR5cGUgPT09ICJUU1RlbXBsYXRlTGl0ZXJhbFR5cGUiICYmIChlMiA9ICJ0eXBlcyIpOwogICAgICAgICAgY29uc3QgczIgPSB0MltlMl07CiAgICAgICAgICByZXR1cm4gczIubGVuZ3RoICE9PSAwICYmIHMyLmV2ZXJ5KCh0MykgPT4gewogICAgICAgICAgICBpZiAoSWgodDMpKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJJZGVudGlmaWVyIiB8fCB0My50eXBlID09PSAiVGhpc0V4cHJlc3Npb24iKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoRGgodDMpKSB7CiAgICAgICAgICAgICAgbGV0IGUzID0gdDM7CiAgICAgICAgICAgICAgZm9yICg7IERoKGUzKTsgKSB7CiAgICAgICAgICAgICAgICBpZiAoZTMucHJvcGVydHkudHlwZSAhPT0gIklkZW50aWZpZXIiICYmIGUzLnByb3BlcnR5LnR5cGUgIT09ICJMaXRlcmFsIiAmJiBlMy5wcm9wZXJ0eS50eXBlICE9PSAiU3RyaW5nTGl0ZXJhbCIgJiYgZTMucHJvcGVydHkudHlwZSAhPT0gIk51bWVyaWNMaXRlcmFsIikKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGUzID0gZTMub2JqZWN0LCBJaChlMykpCiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGUzLnR5cGUgPT09ICJJZGVudGlmaWVyIiB8fCBlMy50eXBlID09PSAiVGhpc0V4cHJlc3Npb24iOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgIH0sIGlzU3RyaW5nTGl0ZXJhbDogaWgsIGlzU3RyaW5nUHJvcFNhZmVUb1VucXVvdGU6IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgcmV0dXJuIGUyLnBhcnNlciAhPT0gImpzb24iICYmIGloKHQyLmtleSkgJiYgeWgodDIua2V5KS5zbGljZSgxLCAtMSkgPT09IHQyLmtleS52YWx1ZSAmJiAoX3UodDIua2V5LnZhbHVlKSAmJiAhKGUyLnBhcnNlciA9PT0gImJhYmVsLXRzIiAmJiB0Mi50eXBlID09PSAiQ2xhc3NQcm9wZXJ0eSIgfHwgZTIucGFyc2VyID09PSAidHlwZXNjcmlwdCIgJiYgdDIudHlwZSA9PT0gIlByb3BlcnR5RGVmaW5pdGlvbiIpIHx8IG1oKHQyLmtleS52YWx1ZSkgJiYgU3RyaW5nKE51bWJlcih0Mi5rZXkudmFsdWUpKSA9PT0gdDIua2V5LnZhbHVlICYmIChlMi5wYXJzZXIgPT09ICJiYWJlbCIgfHwgZTIucGFyc2VyID09PSAiZXNwcmVlIiB8fCBlMi5wYXJzZXIgPT09ICJtZXJpeWFoIiB8fCBlMi5wYXJzZXIgPT09ICJfX2JhYmVsX2VzdHJlZSIpKTsKICAgICAgICB9LCBpc1RlbXBsYXRlT25JdHNPd25MaW5lOiBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIHJldHVybiAodDIudHlwZSA9PT0gIlRlbXBsYXRlTGl0ZXJhbCIgJiYgZmgodDIpIHx8IHQyLnR5cGUgPT09ICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iICYmIGZoKHQyLnF1YXNpKSkgJiYgIUh1KGUyLCBHdSh0MiksIHsgYmFja3dhcmRzOiB0cnVlIH0pOwogICAgICAgIH0sIGlzVGVzdENhbGw6IGZ1bmN0aW9uIHQyKGUyLCBzMikgewogICAgICAgICAgaWYgKGUyLnR5cGUgIT09ICJDYWxsRXhwcmVzc2lvbiIpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIGlmIChlMi5hcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIGlmIChhaChlMikgJiYgczIgJiYgdDIoczIpKQogICAgICAgICAgICAgIHJldHVybiBuaChlMi5hcmd1bWVudHNbMF0pOwogICAgICAgICAgICBpZiAoZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICByZXR1cm4gdDMuY2FsbGVlLnR5cGUgPT09ICJJZGVudGlmaWVyIiAmJiAvXig/OmJlZm9yZXxhZnRlcikoPzpFYWNofEFsbCkkLy50ZXN0KHQzLmNhbGxlZS5uYW1lKSAmJiB0My5hcmd1bWVudHMubGVuZ3RoID09PSAxOwogICAgICAgICAgICB9KGUyKSkKICAgICAgICAgICAgICByZXR1cm4gYWgoZTIuYXJndW1lbnRzWzBdKTsKICAgICAgICAgIH0gZWxzZSBpZiAoKGUyLmFyZ3VtZW50cy5sZW5ndGggPT09IDIgfHwgZTIuYXJndW1lbnRzLmxlbmd0aCA9PT0gMykgJiYgKGUyLmNhbGxlZS50eXBlID09PSAiSWRlbnRpZmllciIgJiYgbGgudGVzdChlMi5jYWxsZWUubmFtZSkgfHwgZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgcmV0dXJuIERoKHQzLmNhbGxlZSkgJiYgdDMuY2FsbGVlLm9iamVjdC50eXBlID09PSAiSWRlbnRpZmllciIgJiYgdDMuY2FsbGVlLnByb3BlcnR5LnR5cGUgPT09ICJJZGVudGlmaWVyIiAmJiBsaC50ZXN0KHQzLmNhbGxlZS5vYmplY3QubmFtZSkgJiYgKHQzLmNhbGxlZS5wcm9wZXJ0eS5uYW1lID09PSAib25seSIgfHwgdDMuY2FsbGVlLnByb3BlcnR5Lm5hbWUgPT09ICJza2lwIik7CiAgICAgICAgICB9KGUyKSkgJiYgKGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0My50eXBlID09PSAiVGVtcGxhdGVMaXRlcmFsIjsKICAgICAgICAgIH0oZTIuYXJndW1lbnRzWzBdKSB8fCBpaChlMi5hcmd1bWVudHNbMF0pKSkKICAgICAgICAgICAgcmV0dXJuICEoZTIuYXJndW1lbnRzWzJdICYmICFyaChlMi5hcmd1bWVudHNbMl0pKSAmJiAoKGUyLmFyZ3VtZW50cy5sZW5ndGggPT09IDIgPyBuaChlMi5hcmd1bWVudHNbMV0pIDogZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICByZXR1cm4gdDMudHlwZSA9PT0gIkZ1bmN0aW9uRXhwcmVzc2lvbiIgfHwgdDMudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiAmJiB0My5ib2R5LnR5cGUgPT09ICJCbG9ja1N0YXRlbWVudCI7CiAgICAgICAgICAgIH0oZTIuYXJndW1lbnRzWzFdKSAmJiBQaChlMi5hcmd1bWVudHNbMV0pLmxlbmd0aCA8PSAxKSB8fCBhaChlMi5hcmd1bWVudHNbMV0pKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LCBpc1RoZU9ubHlKc3hFbGVtZW50SW5NYXJrZG93bjogZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICBpZiAodDIucGFyZW50UGFyc2VyICE9PSAibWFya2Rvd24iICYmIHQyLnBhcmVudFBhcnNlciAhPT0gIm1keCIpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIGNvbnN0IHMyID0gZTIuZ2V0Tm9kZSgpOwogICAgICAgICAgaWYgKCFzMi5leHByZXNzaW9uIHx8ICFvaChzMi5leHByZXNzaW9uKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgY29uc3QgcjIgPSBlMi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICByZXR1cm4gcjIudHlwZSA9PT0gIlByb2dyYW0iICYmIHIyLmJvZHkubGVuZ3RoID09PSAxOwogICAgICAgIH0sIGlzVFNYRmlsZTogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiB0Mi5maWxlcGF0aCAmJiAvXC50c3gkL2kudGVzdCh0Mi5maWxlcGF0aCk7CiAgICAgICAgfSwgaXNUeXBlQW5ub3RhdGlvbkFGdW5jdGlvbjogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiAhKHQyLnR5cGUgIT09ICJUeXBlQW5ub3RhdGlvbiIgJiYgdDIudHlwZSAhPT0gIlRTVHlwZUFubm90YXRpb24iIHx8IHQyLnR5cGVBbm5vdGF0aW9uLnR5cGUgIT09ICJGdW5jdGlvblR5cGVBbm5vdGF0aW9uIiB8fCB0Mi5zdGF0aWMgfHwgSnUodDIsIHQyLnR5cGVBbm5vdGF0aW9uKSk7CiAgICAgICAgfSwgaXNOZXh0TGluZUVtcHR5OiAodDIsIGUyKSA9PiB7CiAgICAgICAgICBsZXQgeyBvcmlnaW5hbFRleHQ6IHMyIH0gPSBlMjsKICAgICAgICAgIHJldHVybiBXdShzMiwgWHUodDIpKTsKICAgICAgICB9LCBuZWVkc0hhcmRsaW5lQWZ0ZXJEYW5nbGluZ0NvbW1lbnQ6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICBpZiAoIUloKHQyKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgY29uc3QgZTIgPSB6dSh2aCh0MiwgQmguRGFuZ2xpbmcpKTsKICAgICAgICAgIHJldHVybiBlMiAmJiAhWnUoZTIpOwogICAgICAgIH0sIHJhd1RleHQ6IHloLCBzaG91bGRQcmludENvbW1hOiBmdW5jdGlvbih0MikgewogICAgICAgICAgbGV0IGUyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMV0gOiAiZXM1IjsKICAgICAgICAgIHJldHVybiB0Mi50cmFpbGluZ0NvbW1hID09PSAiZXM1IiAmJiBlMiA9PT0gImVzNSIgfHwgdDIudHJhaWxpbmdDb21tYSA9PT0gImFsbCIgJiYgKGUyID09PSAiYWxsIiB8fCBlMiA9PT0gImVzNSIpOwogICAgICAgIH0sIGlzQml0d2lzZU9wZXJhdG9yOiBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIEJvb2xlYW4oQ2hbdDJdKSB8fCB0MiA9PT0gInwiIHx8IHQyID09PSAiXiIgfHwgdDIgPT09ICImIjsKICAgICAgICB9LCBzaG91bGRGbGF0dGVuOiBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIHJldHVybiBGaChlMikgPT09IEZoKHQyKSAmJiAodDIgIT09ICIqKiIgJiYgKCghRWhbdDJdIHx8ICFFaFtlMl0pICYmICghKGUyID09PSAiJSIgJiYgQWhbdDJdIHx8IHQyID09PSAiJSIgJiYgQWhbZTJdKSAmJiAoKGUyID09PSB0MiB8fCAhQWhbZTJdIHx8ICFBaFt0Ml0pICYmICghQ2hbdDJdIHx8ICFDaFtlMl0pKSkpKTsKICAgICAgICB9LCBzdGFydHNXaXRoTm9Mb29rYWhlYWRUb2tlbjogZnVuY3Rpb24gdDIoZTIsIHMyKSB7CiAgICAgICAgICBzd2l0Y2ggKChlMiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIGZvciAoOyB0My5sZWZ0OyApCiAgICAgICAgICAgICAgdDMgPSB0My5sZWZ0OwogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9KGUyKSkudHlwZSkgewogICAgICAgICAgICBjYXNlICJGdW5jdGlvbkV4cHJlc3Npb24iOgogICAgICAgICAgICBjYXNlICJDbGFzc0V4cHJlc3Npb24iOgogICAgICAgICAgICBjYXNlICJEb0V4cHJlc3Npb24iOgogICAgICAgICAgICAgIHJldHVybiBzMjsKICAgICAgICAgICAgY2FzZSAiT2JqZWN0RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGNhc2UgIk1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICBjYXNlICJPcHRpb25hbE1lbWJlckV4cHJlc3Npb24iOgogICAgICAgICAgICAgIHJldHVybiB0MihlMi5vYmplY3QsIHMyKTsKICAgICAgICAgICAgY2FzZSAiVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uIjoKICAgICAgICAgICAgICByZXR1cm4gZTIudGFnLnR5cGUgIT09ICJGdW5jdGlvbkV4cHJlc3Npb24iICYmIHQyKGUyLnRhZywgczIpOwogICAgICAgICAgICBjYXNlICJDYWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgIGNhc2UgIk9wdGlvbmFsQ2FsbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgIHJldHVybiBlMi5jYWxsZWUudHlwZSAhPT0gIkZ1bmN0aW9uRXhwcmVzc2lvbiIgJiYgdDIoZTIuY2FsbGVlLCBzMik7CiAgICAgICAgICAgIGNhc2UgIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHQyKGUyLnRlc3QsIHMyKTsKICAgICAgICAgICAgY2FzZSAiVXBkYXRlRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuICFlMi5wcmVmaXggJiYgdDIoZTIuYXJndW1lbnQsIHMyKTsKICAgICAgICAgICAgY2FzZSAiQmluZEV4cHJlc3Npb24iOgogICAgICAgICAgICAgIHJldHVybiBlMi5vYmplY3QgJiYgdDIoZTIub2JqZWN0LCBzMik7CiAgICAgICAgICAgIGNhc2UgIlNlcXVlbmNlRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHQyKGUyLmV4cHJlc3Npb25zWzBdLCBzMik7CiAgICAgICAgICAgIGNhc2UgIlRTQXNFeHByZXNzaW9uIjoKICAgICAgICAgICAgY2FzZSAiVFNOb25OdWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgcmV0dXJuIHQyKGUyLmV4cHJlc3Npb24sIHMyKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSwgZ2V0UHJlY2VkZW5jZTogRmgsIGhhc0NvbW1lbnQ6IEloLCBnZXRDb21tZW50czogdmgsIENvbW1lbnRDaGVja0ZsYWdzOiBCaCB9OwogICAgICAgIGNvbnN0IHsgZ2V0TGFzdDogT2gsIGhhc05ld2xpbmU6IE1oLCBnZXROZXh0Tm9uU3BhY2VOb25Db21tZW50Q2hhcmFjdGVySW5kZXhXaXRoU3RhcnRJbmRleDogUmgsIGdldE5leHROb25TcGFjZU5vbkNvbW1lbnRDaGFyYWN0ZXI6IGpoLCBoYXNOZXdsaW5lSW5SYW5nZTogVWgsIGFkZExlYWRpbmdDb21tZW50OiBfaCwgYWRkVHJhaWxpbmdDb21tZW50OiB6aCwgYWRkRGFuZ2xpbmdDb21tZW50OiBIaCwgZ2V0TmV4dE5vblNwYWNlTm9uQ29tbWVudENoYXJhY3RlckluZGV4OiBWaCwgaXNOb25FbXB0eUFycmF5OiBxaCB9ID0gT28sIHsgaXNCbG9ja0NvbW1lbnQ6IFdoLCBnZXRGdW5jdGlvblBhcmFtZXRlcnM6IEtoLCBpc1ByZXR0aWVySWdub3JlQ29tbWVudDogR2gsIGlzSnN4Tm9kZTogWGgsIGhhc0Zsb3dTaG9ydGhhbmRBbm5vdGF0aW9uQ29tbWVudDogSmgsIGhhc0Zsb3dBbm5vdGF0aW9uQ29tbWVudDogJGgsIGhhc0lnbm9yZUNvbW1lbnQ6IFloLCBpc0NhbGxMaWtlRXhwcmVzc2lvbjogUWgsIGdldENhbGxBcmd1bWVudHM6IFpoLCBpc0NhbGxFeHByZXNzaW9uOiB0cCwgaXNNZW1iZXJFeHByZXNzaW9uOiBlcCwgaXNPYmplY3RQcm9wZXJ0eTogc3AsIGdldENvbW1lbnRzOiBycCwgQ29tbWVudENoZWNrRmxhZ3M6IGlwIH0gPSBMaCwgeyBsb2NTdGFydDogbnAsIGxvY0VuZDogYXAgfSA9IHd1OwogICAgICAgIGZ1bmN0aW9uIG9wKHQyLCBlMikgewogICAgICAgICAgY29uc3QgczIgPSAodDIuYm9keSB8fCB0Mi5wcm9wZXJ0aWVzKS5maW5kKCh0MykgPT4gewogICAgICAgICAgICBsZXQgeyB0eXBlOiBlMyB9ID0gdDM7CiAgICAgICAgICAgIHJldHVybiBlMyAhPT0gIkVtcHR5U3RhdGVtZW50IjsKICAgICAgICAgIH0pOwogICAgICAgICAgczIgPyBfaChzMiwgZTIpIDogSGgodDIsIGUyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdXAodDIsIGUyKSB7CiAgICAgICAgICB0Mi50eXBlID09PSAiQmxvY2tTdGF0ZW1lbnQiID8gb3AodDIsIGUyKSA6IF9oKHQyLCBlMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGhwKHQyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiBlMiwgZm9sbG93aW5nTm9kZTogczIgfSA9IHQyOwogICAgICAgICAgcmV0dXJuICEoIXMyIHx8ICFqcChlMikpICYmIChfaChzMiwgZTIpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcHAodDIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IGUyLCBwcmVjZWRpbmdOb2RlOiBzMiwgZW5jbG9zaW5nTm9kZTogcjIsIGZvbGxvd2luZ05vZGU6IGkyLCB0ZXh0OiBuMiB9ID0gdDI7CiAgICAgICAgICBpZiAoIXIyIHx8IHIyLnR5cGUgIT09ICJJZlN0YXRlbWVudCIgfHwgIWkyKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICByZXR1cm4gamgobjIsIGUyLCBhcCkgPT09ICIpIiA/ICh6aChzMiwgZTIpLCB0cnVlKSA6IHMyID09PSByMi5jb25zZXF1ZW50ICYmIGkyID09PSByMi5hbHRlcm5hdGUgPyAoczIudHlwZSA9PT0gIkJsb2NrU3RhdGVtZW50IiA/IHpoKHMyLCBlMikgOiBIaChyMiwgZTIpLCB0cnVlKSA6IGkyLnR5cGUgPT09ICJCbG9ja1N0YXRlbWVudCIgPyAob3AoaTIsIGUyKSwgdHJ1ZSkgOiBpMi50eXBlID09PSAiSWZTdGF0ZW1lbnQiID8gKHVwKGkyLmNvbnNlcXVlbnQsIGUyKSwgdHJ1ZSkgOiByMi5jb25zZXF1ZW50ID09PSBpMiAmJiAoX2goaTIsIGUyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNwKHQyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiBlMiwgcHJlY2VkaW5nTm9kZTogczIsIGVuY2xvc2luZ05vZGU6IHIyLCBmb2xsb3dpbmdOb2RlOiBpMiwgdGV4dDogbjIgfSA9IHQyOwogICAgICAgICAgaWYgKCFyMiB8fCByMi50eXBlICE9PSAiV2hpbGVTdGF0ZW1lbnQiIHx8ICFpMikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgcmV0dXJuIGpoKG4yLCBlMiwgYXApID09PSAiKSIgPyAoemgoczIsIGUyKSwgdHJ1ZSkgOiBpMi50eXBlID09PSAiQmxvY2tTdGF0ZW1lbnQiID8gKG9wKGkyLCBlMiksIHRydWUpIDogcjIuYm9keSA9PT0gaTIgJiYgKF9oKGkyLCBlMiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBscCh0MikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogZTIsIHByZWNlZGluZ05vZGU6IHMyLCBlbmNsb3NpbmdOb2RlOiByMiwgZm9sbG93aW5nTm9kZTogaTIgfSA9IHQyOwogICAgICAgICAgcmV0dXJuICEoIXIyIHx8IHIyLnR5cGUgIT09ICJUcnlTdGF0ZW1lbnQiICYmIHIyLnR5cGUgIT09ICJDYXRjaENsYXVzZSIgfHwgIWkyKSAmJiAocjIudHlwZSA9PT0gIkNhdGNoQ2xhdXNlIiAmJiBzMiA/ICh6aChzMiwgZTIpLCB0cnVlKSA6IGkyLnR5cGUgPT09ICJCbG9ja1N0YXRlbWVudCIgPyAob3AoaTIsIGUyKSwgdHJ1ZSkgOiBpMi50eXBlID09PSAiVHJ5U3RhdGVtZW50IiA/ICh1cChpMi5maW5hbGl6ZXIsIGUyKSwgdHJ1ZSkgOiBpMi50eXBlID09PSAiQ2F0Y2hDbGF1c2UiICYmICh1cChpMi5ib2R5LCBlMiksIHRydWUpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZHAodDIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IGUyLCBlbmNsb3NpbmdOb2RlOiBzMiwgZm9sbG93aW5nTm9kZTogcjIgfSA9IHQyOwogICAgICAgICAgcmV0dXJuICEoIWVwKHMyKSB8fCAhcjIgfHwgcjIudHlwZSAhPT0gIklkZW50aWZpZXIiKSAmJiAoX2goczIsIGUyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIERwKHQyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiBlMiwgcHJlY2VkaW5nTm9kZTogczIsIGVuY2xvc2luZ05vZGU6IHIyLCBmb2xsb3dpbmdOb2RlOiBpMiwgdGV4dDogbjIgfSA9IHQyOwogICAgICAgICAgY29uc3QgYTIgPSBzMiAmJiAhVWgobjIsIGFwKHMyKSwgbnAoZTIpKTsKICAgICAgICAgIHJldHVybiAhKHMyICYmIGEyIHx8ICFyMiB8fCByMi50eXBlICE9PSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIiAmJiByMi50eXBlICE9PSAiVFNDb25kaXRpb25hbFR5cGUiIHx8ICFpMikgJiYgKF9oKGkyLCBlMiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBtcCh0MikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogZTIsIHByZWNlZGluZ05vZGU6IHMyLCBlbmNsb3NpbmdOb2RlOiByMiB9ID0gdDI7CiAgICAgICAgICByZXR1cm4gISghc3AocjIpIHx8ICFyMi5zaG9ydGhhbmQgfHwgcjIua2V5ICE9PSBzMiB8fCByMi52YWx1ZS50eXBlICE9PSAiQXNzaWdubWVudFBhdHRlcm4iKSAmJiAoemgocjIudmFsdWUubGVmdCwgZTIpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZnAodDIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IGUyLCBwcmVjZWRpbmdOb2RlOiBzMiwgZW5jbG9zaW5nTm9kZTogcjIsIGZvbGxvd2luZ05vZGU6IGkyIH0gPSB0MjsKICAgICAgICAgIGlmIChyMiAmJiAocjIudHlwZSA9PT0gIkNsYXNzRGVjbGFyYXRpb24iIHx8IHIyLnR5cGUgPT09ICJDbGFzc0V4cHJlc3Npb24iIHx8IHIyLnR5cGUgPT09ICJEZWNsYXJlQ2xhc3MiIHx8IHIyLnR5cGUgPT09ICJEZWNsYXJlSW50ZXJmYWNlIiB8fCByMi50eXBlID09PSAiSW50ZXJmYWNlRGVjbGFyYXRpb24iIHx8IHIyLnR5cGUgPT09ICJUU0ludGVyZmFjZURlY2xhcmF0aW9uIikpIHsKICAgICAgICAgICAgaWYgKHFoKHIyLmRlY29yYXRvcnMpICYmICghaTIgfHwgaTIudHlwZSAhPT0gIkRlY29yYXRvciIpKQogICAgICAgICAgICAgIHJldHVybiB6aChPaChyMi5kZWNvcmF0b3JzKSwgZTIpLCB0cnVlOwogICAgICAgICAgICBpZiAocjIuYm9keSAmJiBpMiA9PT0gcjIuYm9keSkKICAgICAgICAgICAgICByZXR1cm4gb3AocjIuYm9keSwgZTIpLCB0cnVlOwogICAgICAgICAgICBpZiAoaTIpIHsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQzIG9mIFsiaW1wbGVtZW50cyIsICJleHRlbmRzIiwgIm1peGlucyJdKQogICAgICAgICAgICAgICAgaWYgKHIyW3QzXSAmJiBpMiA9PT0gcjJbdDNdWzBdKQogICAgICAgICAgICAgICAgICByZXR1cm4gIXMyIHx8IHMyICE9PSByMi5pZCAmJiBzMiAhPT0gcjIudHlwZVBhcmFtZXRlcnMgJiYgczIgIT09IHIyLnN1cGVyQ2xhc3MgPyBIaChyMiwgZTIsIHQzKSA6IHpoKHMyLCBlMiksIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24geXAodDIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IGUyLCBwcmVjZWRpbmdOb2RlOiBzMiwgZW5jbG9zaW5nTm9kZTogcjIsIHRleHQ6IGkyIH0gPSB0MjsKICAgICAgICAgIHJldHVybiAocjIgJiYgczIgJiYgKHIyLnR5cGUgPT09ICJQcm9wZXJ0eSIgfHwgcjIudHlwZSA9PT0gIlRTRGVjbGFyZU1ldGhvZCIgfHwgcjIudHlwZSA9PT0gIlRTQWJzdHJhY3RNZXRob2REZWZpbml0aW9uIikgJiYgczIudHlwZSA9PT0gIklkZW50aWZpZXIiICYmIHIyLmtleSA9PT0gczIgJiYgamgoaTIsIHMyLCBhcCkgIT09ICI6IiB8fCAhKCFzMiB8fCAhcjIgfHwgczIudHlwZSAhPT0gIkRlY29yYXRvciIgfHwgcjIudHlwZSAhPT0gIkNsYXNzTWV0aG9kIiAmJiByMi50eXBlICE9PSAiQ2xhc3NQcm9wZXJ0eSIgJiYgcjIudHlwZSAhPT0gIlByb3BlcnR5RGVmaW5pdGlvbiIgJiYgcjIudHlwZSAhPT0gIlRTQWJzdHJhY3RQcm9wZXJ0eURlZmluaXRpb24iICYmIHIyLnR5cGUgIT09ICJUU0Fic3RyYWN0TWV0aG9kRGVmaW5pdGlvbiIgJiYgcjIudHlwZSAhPT0gIlRTRGVjbGFyZU1ldGhvZCIgJiYgcjIudHlwZSAhPT0gIk1ldGhvZERlZmluaXRpb24iKSkgJiYgKHpoKHMyLCBlMiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBFcCh0MikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogZTIsIHByZWNlZGluZ05vZGU6IHMyLCBlbmNsb3NpbmdOb2RlOiByMiwgdGV4dDogaTIgfSA9IHQyOwogICAgICAgICAgcmV0dXJuIGpoKGkyLCBlMiwgYXApID09PSAiKCIgJiYgKCEoIXMyIHx8ICFyMiB8fCByMi50eXBlICE9PSAiRnVuY3Rpb25EZWNsYXJhdGlvbiIgJiYgcjIudHlwZSAhPT0gIkZ1bmN0aW9uRXhwcmVzc2lvbiIgJiYgcjIudHlwZSAhPT0gIkNsYXNzTWV0aG9kIiAmJiByMi50eXBlICE9PSAiTWV0aG9kRGVmaW5pdGlvbiIgJiYgcjIudHlwZSAhPT0gIk9iamVjdE1ldGhvZCIpICYmICh6aChzMiwgZTIpLCB0cnVlKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEFwKHQyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiBlMiwgZW5jbG9zaW5nTm9kZTogczIsIHRleHQ6IHIyIH0gPSB0MjsKICAgICAgICAgIGlmICghczIgfHwgczIudHlwZSAhPT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgY29uc3QgaTIgPSBWaChyMiwgZTIsIGFwKTsKICAgICAgICAgIHJldHVybiBpMiAhPT0gZmFsc2UgJiYgcjIuc2xpY2UoaTIsIGkyICsgMikgPT09ICI9PiIgJiYgKEhoKHMyLCBlMiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBDcCh0MikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogZTIsIGVuY2xvc2luZ05vZGU6IHMyLCB0ZXh0OiByMiB9ID0gdDI7CiAgICAgICAgICByZXR1cm4gamgocjIsIGUyLCBhcCkgPT09ICIpIiAmJiAoczIgJiYgKFJwKHMyKSAmJiBLaChzMikubGVuZ3RoID09PSAwIHx8IFFoKHMyKSAmJiBaaChzMikubGVuZ3RoID09PSAwKSA/IChIaChzMiwgZTIpLCB0cnVlKSA6ICEoIXMyIHx8IHMyLnR5cGUgIT09ICJNZXRob2REZWZpbml0aW9uIiAmJiBzMi50eXBlICE9PSAiVFNBYnN0cmFjdE1ldGhvZERlZmluaXRpb24iIHx8IEtoKHMyLnZhbHVlKS5sZW5ndGggIT09IDApICYmIChIaChzMi52YWx1ZSwgZTIpLCB0cnVlKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHhwKHQyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiBlMiwgcHJlY2VkaW5nTm9kZTogczIsIGVuY2xvc2luZ05vZGU6IHIyLCBmb2xsb3dpbmdOb2RlOiBpMiwgdGV4dDogbjIgfSA9IHQyOwogICAgICAgICAgaWYgKHMyICYmIHMyLnR5cGUgPT09ICJGdW5jdGlvblR5cGVQYXJhbSIgJiYgcjIgJiYgcjIudHlwZSA9PT0gIkZ1bmN0aW9uVHlwZUFubm90YXRpb24iICYmIGkyICYmIGkyLnR5cGUgIT09ICJGdW5jdGlvblR5cGVQYXJhbSIpCiAgICAgICAgICAgIHJldHVybiB6aChzMiwgZTIpLCB0cnVlOwogICAgICAgICAgaWYgKHMyICYmIChzMi50eXBlID09PSAiSWRlbnRpZmllciIgfHwgczIudHlwZSA9PT0gIkFzc2lnbm1lbnRQYXR0ZXJuIikgJiYgcjIgJiYgUnAocjIpICYmIGpoKG4yLCBlMiwgYXApID09PSAiKSIpCiAgICAgICAgICAgIHJldHVybiB6aChzMiwgZTIpLCB0cnVlOwogICAgICAgICAgaWYgKHIyICYmIHIyLnR5cGUgPT09ICJGdW5jdGlvbkRlY2xhcmF0aW9uIiAmJiBpMiAmJiBpMi50eXBlID09PSAiQmxvY2tTdGF0ZW1lbnQiKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gKCgpID0+IHsKICAgICAgICAgICAgICBjb25zdCB0NCA9IEtoKHIyKTsKICAgICAgICAgICAgICBpZiAodDQubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIHJldHVybiBSaChuMiwgYXAoT2godDQpKSk7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSBSaChuMiwgYXAocjIuaWQpKTsKICAgICAgICAgICAgICByZXR1cm4gZTMgIT09IGZhbHNlICYmIFJoKG4yLCBlMyArIDEpOwogICAgICAgICAgICB9KSgpOwogICAgICAgICAgICBpZiAobnAoZTIpID4gdDMpCiAgICAgICAgICAgICAgcmV0dXJuIG9wKGkyLCBlMiksIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEZwKHQyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiBlMiwgZW5jbG9zaW5nTm9kZTogczIgfSA9IHQyOwogICAgICAgICAgcmV0dXJuICEoIXMyIHx8IHMyLnR5cGUgIT09ICJJbXBvcnRTcGVjaWZpZXIiKSAmJiAoX2goczIsIGUyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdwKHQyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiBlMiwgZW5jbG9zaW5nTm9kZTogczIgfSA9IHQyOwogICAgICAgICAgcmV0dXJuICEoIXMyIHx8IHMyLnR5cGUgIT09ICJMYWJlbGVkU3RhdGVtZW50IikgJiYgKF9oKHMyLCBlMiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBQcCh0MikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogZTIsIGVuY2xvc2luZ05vZGU6IHMyIH0gPSB0MjsKICAgICAgICAgIHJldHVybiAhKCFzMiB8fCBzMi50eXBlICE9PSAiQ29udGludWVTdGF0ZW1lbnQiICYmIHMyLnR5cGUgIT09ICJCcmVha1N0YXRlbWVudCIgfHwgczIubGFiZWwpICYmICh6aChzMiwgZTIpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVHAodDIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IGUyLCBwcmVjZWRpbmdOb2RlOiBzMiwgZW5jbG9zaW5nTm9kZTogcjIgfSA9IHQyOwogICAgICAgICAgcmV0dXJuICEhKHRwKHIyKSAmJiBzMiAmJiByMi5jYWxsZWUgPT09IHMyICYmIHIyLmFyZ3VtZW50cy5sZW5ndGggPiAwKSAmJiAoX2gocjIuYXJndW1lbnRzWzBdLCBlMiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBicCh0MikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogZTIsIHByZWNlZGluZ05vZGU6IHMyLCBlbmNsb3NpbmdOb2RlOiByMiwgZm9sbG93aW5nTm9kZTogaTIgfSA9IHQyOwogICAgICAgICAgcmV0dXJuICFyMiB8fCByMi50eXBlICE9PSAiVW5pb25UeXBlQW5ub3RhdGlvbiIgJiYgcjIudHlwZSAhPT0gIlRTVW5pb25UeXBlIiA/IChpMiAmJiAoaTIudHlwZSA9PT0gIlVuaW9uVHlwZUFubm90YXRpb24iIHx8IGkyLnR5cGUgPT09ICJUU1VuaW9uVHlwZSIpICYmIEdoKGUyKSAmJiAoaTIudHlwZXNbMF0ucHJldHRpZXJJZ25vcmUgPSB0cnVlLCBlMi51bmlnbm9yZSA9IHRydWUpLCBmYWxzZSkgOiAoR2goZTIpICYmIChpMi5wcmV0dGllcklnbm9yZSA9IHRydWUsIGUyLnVuaWdub3JlID0gdHJ1ZSksICEhczIgJiYgKHpoKHMyLCBlMiksIHRydWUpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gU3AodDIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IGUyLCBlbmNsb3NpbmdOb2RlOiBzMiB9ID0gdDI7CiAgICAgICAgICByZXR1cm4gISFzcChzMikgJiYgKF9oKHMyLCBlMiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB3cCh0MikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogZTIsIGVuY2xvc2luZ05vZGU6IHMyLCBmb2xsb3dpbmdOb2RlOiByMiwgYXN0OiBpMiwgaXNMYXN0Q29tbWVudDogbjIgfSA9IHQyOwogICAgICAgICAgcmV0dXJuIGkyICYmIGkyLmJvZHkgJiYgaTIuYm9keS5sZW5ndGggPT09IDAgPyAobjIgPyBIaChpMiwgZTIpIDogX2goaTIsIGUyKSwgdHJ1ZSkgOiBzMiAmJiBzMi50eXBlID09PSAiUHJvZ3JhbSIgJiYgczIuYm9keS5sZW5ndGggPT09IDAgJiYgIXFoKHMyLmRpcmVjdGl2ZXMpID8gKG4yID8gSGgoczIsIGUyKSA6IF9oKHMyLCBlMiksIHRydWUpIDogISghcjIgfHwgcjIudHlwZSAhPT0gIlByb2dyYW0iIHx8IHIyLmJvZHkubGVuZ3RoICE9PSAwIHx8ICFzMiB8fCBzMi50eXBlICE9PSAiTW9kdWxlRXhwcmVzc2lvbiIpICYmIChIaChyMiwgZTIpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQnAodDIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IGUyLCBlbmNsb3NpbmdOb2RlOiBzMiB9ID0gdDI7CiAgICAgICAgICByZXR1cm4gISghczIgfHwgczIudHlwZSAhPT0gIkZvckluU3RhdGVtZW50IiAmJiBzMi50eXBlICE9PSAiRm9yT2ZTdGF0ZW1lbnQiKSAmJiAoX2goczIsIGUyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE5wKHQyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiBlMiwgcHJlY2VkaW5nTm9kZTogczIsIGVuY2xvc2luZ05vZGU6IHIyLCB0ZXh0OiBpMiB9ID0gdDI7CiAgICAgICAgICByZXR1cm4gISEoczIgJiYgczIudHlwZSA9PT0gIkltcG9ydFNwZWNpZmllciIgJiYgcjIgJiYgcjIudHlwZSA9PT0gIkltcG9ydERlY2xhcmF0aW9uIiAmJiBNaChpMiwgYXAoZTIpKSkgJiYgKHpoKHMyLCBlMiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBJcCh0MikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogZTIsIGVuY2xvc2luZ05vZGU6IHMyIH0gPSB0MjsKICAgICAgICAgIHJldHVybiAhKCFzMiB8fCBzMi50eXBlICE9PSAiQXNzaWdubWVudFBhdHRlcm4iKSAmJiAoX2goczIsIGUyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHZwKHQyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiBlMiwgZW5jbG9zaW5nTm9kZTogczIgfSA9IHQyOwogICAgICAgICAgcmV0dXJuICEoIXMyIHx8IHMyLnR5cGUgIT09ICJUeXBlQWxpYXMiKSAmJiAoX2goczIsIGUyKSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGtwKHQyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiBlMiwgZW5jbG9zaW5nTm9kZTogczIsIGZvbGxvd2luZ05vZGU6IHIyIH0gPSB0MjsKICAgICAgICAgIHJldHVybiAhKCFzMiB8fCBzMi50eXBlICE9PSAiVmFyaWFibGVEZWNsYXJhdG9yIiAmJiBzMi50eXBlICE9PSAiQXNzaWdubWVudEV4cHJlc3Npb24iIHx8ICFyMiB8fCByMi50eXBlICE9PSAiT2JqZWN0RXhwcmVzc2lvbiIgJiYgcjIudHlwZSAhPT0gIkFycmF5RXhwcmVzc2lvbiIgJiYgcjIudHlwZSAhPT0gIlRlbXBsYXRlTGl0ZXJhbCIgJiYgcjIudHlwZSAhPT0gIlRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbiIgJiYgIVdoKGUyKSkgJiYgKF9oKHIyLCBlMiksIHRydWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBMcCh0MikgewogICAgICAgICAgbGV0IHsgY29tbWVudDogZTIsIGVuY2xvc2luZ05vZGU6IHMyLCBmb2xsb3dpbmdOb2RlOiByMiwgdGV4dDogaTIgfSA9IHQyOwogICAgICAgICAgcmV0dXJuICEocjIgfHwgIXMyIHx8IHMyLnR5cGUgIT09ICJUU01ldGhvZFNpZ25hdHVyZSIgJiYgczIudHlwZSAhPT0gIlRTRGVjbGFyZUZ1bmN0aW9uIiAmJiBzMi50eXBlICE9PSAiVFNBYnN0cmFjdE1ldGhvZERlZmluaXRpb24iIHx8IGpoKGkyLCBlMiwgYXApICE9PSAiOyIpICYmICh6aChzMiwgZTIpLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gT3AodDIpIHsKICAgICAgICAgIGxldCB7IGNvbW1lbnQ6IGUyLCBlbmNsb3NpbmdOb2RlOiBzMiwgZm9sbG93aW5nTm9kZTogcjIgfSA9IHQyOwogICAgICAgICAgaWYgKEdoKGUyKSAmJiBzMiAmJiBzMi50eXBlID09PSAiVFNNYXBwZWRUeXBlIiAmJiByMiAmJiByMi50eXBlID09PSAiVFNUeXBlUGFyYW1ldGVyIiAmJiByMi5jb25zdHJhaW50KQogICAgICAgICAgICByZXR1cm4gczIucHJldHRpZXJJZ25vcmUgPSB0cnVlLCBlMi51bmlnbm9yZSA9IHRydWUsIHRydWU7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE1wKHQyKSB7CiAgICAgICAgICBsZXQgeyBjb21tZW50OiBlMiwgcHJlY2VkaW5nTm9kZTogczIsIGVuY2xvc2luZ05vZGU6IHIyLCBmb2xsb3dpbmdOb2RlOiBpMiB9ID0gdDI7CiAgICAgICAgICByZXR1cm4gISghcjIgfHwgcjIudHlwZSAhPT0gIlRTTWFwcGVkVHlwZSIpICYmIChpMiAmJiBpMi50eXBlID09PSAiVFNUeXBlUGFyYW1ldGVyIiAmJiBpMi5uYW1lID8gKF9oKGkyLm5hbWUsIGUyKSwgdHJ1ZSkgOiAhKCFzMiB8fCBzMi50eXBlICE9PSAiVFNUeXBlUGFyYW1ldGVyIiB8fCAhczIuY29uc3RyYWludCkgJiYgKHpoKHMyLmNvbnN0cmFpbnQsIGUyKSwgdHJ1ZSkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBScCh0MikgewogICAgICAgICAgcmV0dXJuIHQyLnR5cGUgPT09ICJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiIgfHwgdDIudHlwZSA9PT0gIkZ1bmN0aW9uRXhwcmVzc2lvbiIgfHwgdDIudHlwZSA9PT0gIkZ1bmN0aW9uRGVjbGFyYXRpb24iIHx8IHQyLnR5cGUgPT09ICJPYmplY3RNZXRob2QiIHx8IHQyLnR5cGUgPT09ICJDbGFzc01ldGhvZCIgfHwgdDIudHlwZSA9PT0gIlRTRGVjbGFyZUZ1bmN0aW9uIiB8fCB0Mi50eXBlID09PSAiVFNDYWxsU2lnbmF0dXJlRGVjbGFyYXRpb24iIHx8IHQyLnR5cGUgPT09ICJUU0NvbnN0cnVjdFNpZ25hdHVyZURlY2xhcmF0aW9uIiB8fCB0Mi50eXBlID09PSAiVFNNZXRob2RTaWduYXR1cmUiIHx8IHQyLnR5cGUgPT09ICJUU0NvbnN0cnVjdG9yVHlwZSIgfHwgdDIudHlwZSA9PT0gIlRTRnVuY3Rpb25UeXBlIiB8fCB0Mi50eXBlID09PSAiVFNEZWNsYXJlTWV0aG9kIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24ganAodDIpIHsKICAgICAgICAgIHJldHVybiBXaCh0MikgJiYgdDIudmFsdWVbMF0gPT09ICIqIiAmJiAvQHR5cGVcYi8udGVzdCh0Mi52YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHZhciBVcCA9IHsgaGFuZGxlT3duTGluZUNvbW1lbnQ6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gW09wLCB4cCwgZHAsIHBwLCBjcCwgbHAsIGZwLCBGcCwgQnAsIGJwLCB3cCwgTnAsIElwLCB5cCwgZ3BdLnNvbWUoKGUyKSA9PiBlMih0MikpOwogICAgICAgIH0sIGhhbmRsZUVuZE9mTGluZUNvbW1lbnQ6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICByZXR1cm4gW2hwLCB4cCwgRHAsIEZwLCBwcCwgY3AsIGxwLCBmcCwgZ3AsIFRwLCBTcCwgd3AsIHZwLCBrcF0uc29tZSgoZTIpID0+IGUyKHQyKSk7CiAgICAgICAgfSwgaGFuZGxlUmVtYWluaW5nQ29tbWVudDogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiBbT3AsIHBwLCBjcCwgbXAsIENwLCB5cCwgd3AsIEFwLCBFcCwgTXAsIFBwLCBMcF0uc29tZSgoZTIpID0+IGUyKHQyKSk7CiAgICAgICAgfSwgaXNUeXBlQ2FzdENvbW1lbnQ6IGpwLCBnZXRDb21tZW50Q2hpbGROb2RlczogZnVuY3Rpb24odDIsIGUyKSB7CiAgICAgICAgICBpZiAoKGUyLnBhcnNlciA9PT0gInR5cGVzY3JpcHQiIHx8IGUyLnBhcnNlciA9PT0gImZsb3ciIHx8IGUyLnBhcnNlciA9PT0gImVzcHJlZSIgfHwgZTIucGFyc2VyID09PSAibWVyaXlhaCIgfHwgZTIucGFyc2VyID09PSAiX19iYWJlbF9lc3RyZWUiKSAmJiB0Mi50eXBlID09PSAiTWV0aG9kRGVmaW5pdGlvbiIgJiYgdDIudmFsdWUgJiYgdDIudmFsdWUudHlwZSA9PT0gIkZ1bmN0aW9uRXhwcmVzc2lvbiIgJiYgS2godDIudmFsdWUpLmxlbmd0aCA9PT0gMCAmJiAhdDIudmFsdWUucmV0dXJuVHlwZSAmJiAhcWgodDIudmFsdWUudHlwZVBhcmFtZXRlcnMpICYmIHQyLnZhbHVlLmJvZHkpCiAgICAgICAgICAgIHJldHVybiBbLi4udDIuZGVjb3JhdG9ycyB8fCBbXSwgdDIua2V5LCB0Mi52YWx1ZS5ib2R5XTsKICAgICAgICB9LCB3aWxsUHJpbnRPd25Db21tZW50czogZnVuY3Rpb24odDIpIHsKICAgICAgICAgIGNvbnN0IGUyID0gdDIuZ2V0VmFsdWUoKSwgczIgPSB0Mi5nZXRQYXJlbnROb2RlKCk7CiAgICAgICAgICByZXR1cm4gKGUyICYmIChYaChlMikgfHwgSmgoZTIpIHx8IHRwKHMyKSAmJiAoKHQzKSA9PiAkaChycCh0MywgaXAuTGVhZGluZykpIHx8ICRoKHJwKHQzLCBpcC5UcmFpbGluZykpKShlMikpIHx8IHMyICYmIChzMi50eXBlID09PSAiSlNYU3ByZWFkQXR0cmlidXRlIiB8fCBzMi50eXBlID09PSAiSlNYU3ByZWFkQ2hpbGQiIHx8IHMyLnR5cGUgPT09ICJVbmlvblR5cGVBbm5vdGF0aW9uIiB8fCBzMi50eXBlID09PSAiVFNVbmlvblR5cGUiIHx8IChzMi50eXBlID09PSAiQ2xhc3NEZWNsYXJhdGlvbiIgfHwgczIudHlwZSA9PT0gIkNsYXNzRXhwcmVzc2lvbiIpICYmIHMyLnN1cGVyQ2xhc3MgPT09IGUyKSkgJiYgKCFZaCh0MikgfHwgczIudHlwZSA9PT0gIlVuaW9uVHlwZUFubm90YXRpb24iIHx8IHMyLnR5cGUgPT09ICJUU1VuaW9uVHlwZSIpOwogICAgICAgIH0gfTsKICAgICAgICB2YXIgX3AgPSBmdW5jdGlvbiB0MihlMiwgczIpIHsKICAgICAgICAgIGxldCByMjsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGUyKSkKICAgICAgICAgICAgcjIgPSBlMi5lbnRyaWVzKCk7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKCFlMiB8fCB0eXBlb2YgZTIgIT0gIm9iamVjdCIgfHwgdHlwZW9mIGUyLnR5cGUgIT0gInN0cmluZyIpCiAgICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgICByMiA9IE9iamVjdC5lbnRyaWVzKGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoY29uc3QgW2kyLCBuMl0gb2YgcjIpCiAgICAgICAgICAgIGUyW2kyXSA9IHQyKG4yLCBzMik7CiAgICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShlMikgPyBlMiA6IHMyKGUyKSB8fCBlMjsKICAgICAgICB9OwogICAgICAgIGNvbnN0IHpwID0ga3UsIEhwID0gX3A7CiAgICAgICAgZnVuY3Rpb24gVnAodDIsIGUyKSB7CiAgICAgICAgICBjb25zdCB7IHN0YXJ0OiBzMiwgZW5kOiByMiB9ID0gdDIubG9jOwogICAgICAgICAgdGhyb3cgenAoZTIsIHsgc3RhcnQ6IHsgbGluZTogczIubGluZSwgY29sdW1uOiBzMi5jb2x1bW4gKyAxIH0sIGVuZDogeyBsaW5lOiByMi5saW5lLCBjb2x1bW46IHIyLmNvbHVtbiArIDEgfSB9KTsKICAgICAgICB9CiAgICAgICAgdmFyIHFwID0geyB0aHJvd0Vycm9yRm9ySW52YWxpZE5vZGVzOiBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIGNvbnN0IHsgZXNUcmVlTm9kZVRvVFNOb2RlTWFwOiBzMiwgdHNOb2RlVG9FU1RyZWVOb2RlTWFwOiByMiB9ID0gZTIudHNQYXJzZVJlc3VsdDsKICAgICAgICAgIHQyID0gSHAodDIsICh0MykgPT4gewogICAgICAgICAgICBjb25zdCBlMyA9IHMyLmdldCh0Myk7CiAgICAgICAgICAgIGlmICghZTMpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBpMiA9IHIyLmdldChlMyk7CiAgICAgICAgICAgIGkyID09PSB0MyAmJiAoZnVuY3Rpb24odDQsIGU0LCBzMykgewogICAgICAgICAgICAgIGNvbnN0IHIzID0gdDQuZGVjb3JhdG9yczsKICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocjMpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIGNvbnN0IGkzID0gZTQuZGVjb3JhdG9yczsKICAgICAgICAgICAgICBBcnJheS5pc0FycmF5KGkzKSAmJiBpMy5sZW5ndGggPT09IHIzLmxlbmd0aCAmJiAhcjMuc29tZSgodDUpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGU1ID0gczMuZ2V0KHQ1KTsKICAgICAgICAgICAgICAgIHJldHVybiAhZTUgfHwgIWkzLmluY2x1ZGVzKGU1KTsKICAgICAgICAgICAgICB9KSB8fCBWcChlNCwgIkxlYWRpbmcgZGVjb3JhdG9ycyBtdXN0IGJlIGF0dGFjaGVkIHRvIGEgY2xhc3MgZGVjbGFyYXRpb24iKTsKICAgICAgICAgICAgfShlMywgaTIsIHIyKSwgZnVuY3Rpb24odDQsIGU0KSB7CiAgICAgICAgICAgICAgdDQua2luZCAhPT0gMTY2IHx8IHQ0Lm1vZGlmaWVycyAmJiAhdDQubW9kaWZpZXJzLnNvbWUoKHQ1KSA9PiB0NS5raW5kID09PSAxMjYpIHx8IHQ0LmluaXRpYWxpemVyICYmIGU0LnZhbHVlID09PSBudWxsICYmIFZwKGU0LCAiQWJzdHJhY3QgcHJvcGVydHkgY2Fubm90IGhhdmUgYW4gaW5pdGlhbGl6ZXIiKTsKICAgICAgICAgICAgfShlMywgaTIpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IGdldExhc3Q6IFdwIH0gPSBPbywgeyBsb2NTdGFydDogS3AsIGxvY0VuZDogR3AgfSA9IHd1LCB7IGlzVHlwZUNhc3RDb21tZW50OiBYcCB9ID0gVXAsIEpwID0gX3AsIHsgdGhyb3dFcnJvckZvckludmFsaWROb2RlczogJHAgfSA9IHFwOwogICAgICAgIGZ1bmN0aW9uIFlwKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIudHlwZSA9PT0gIkNhbGxFeHByZXNzaW9uIiA/ICh0Mi50eXBlID0gIk9wdGlvbmFsQ2FsbEV4cHJlc3Npb24iLCB0Mi5jYWxsZWUgPSBZcCh0Mi5jYWxsZWUpKSA6IHQyLnR5cGUgPT09ICJNZW1iZXJFeHByZXNzaW9uIiA/ICh0Mi50eXBlID0gIk9wdGlvbmFsTWVtYmVyRXhwcmVzc2lvbiIsIHQyLm9iamVjdCA9IFlwKHQyLm9iamVjdCkpIDogdDIudHlwZSA9PT0gIlRTTm9uTnVsbEV4cHJlc3Npb24iICYmICh0Mi5leHByZXNzaW9uID0gWXAodDIuZXhwcmVzc2lvbikpLCB0MjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gUXAodDIpIHsKICAgICAgICAgIHJldHVybiB0Mi50eXBlID09PSAiTG9naWNhbEV4cHJlc3Npb24iICYmIHQyLnJpZ2h0LnR5cGUgPT09ICJMb2dpY2FsRXhwcmVzc2lvbiIgJiYgdDIub3BlcmF0b3IgPT09IHQyLnJpZ2h0Lm9wZXJhdG9yOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBacCh0MikgewogICAgICAgICAgcmV0dXJuIFFwKHQyKSA/IFpwKHsgdHlwZTogIkxvZ2ljYWxFeHByZXNzaW9uIiwgb3BlcmF0b3I6IHQyLm9wZXJhdG9yLCBsZWZ0OiBacCh7IHR5cGU6ICJMb2dpY2FsRXhwcmVzc2lvbiIsIG9wZXJhdG9yOiB0Mi5vcGVyYXRvciwgbGVmdDogdDIubGVmdCwgcmlnaHQ6IHQyLnJpZ2h0LmxlZnQsIHJhbmdlOiBbS3AodDIubGVmdCksIEdwKHQyLnJpZ2h0LmxlZnQpXSB9KSwgcmlnaHQ6IHQyLnJpZ2h0LnJpZ2h0LCByYW5nZTogW0twKHQyKSwgR3AodDIpXSB9KSA6IHQyOwogICAgICAgIH0KICAgICAgICB2YXIgdGMgPSBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIGlmIChlMi5wYXJzZXIgPT09ICJ0eXBlc2NyaXB0IiAmJiAvQHxhYnN0cmFjdC8udGVzdChlMi5vcmlnaW5hbFRleHQpICYmICRwKHQyLCBlMiksIGUyLnBhcnNlciAhPT0gInR5cGVzY3JpcHQiICYmIGUyLnBhcnNlciAhPT0gImZsb3ciICYmIGUyLnBhcnNlciAhPT0gImVzcHJlZSIgJiYgZTIucGFyc2VyICE9PSAibWVyaXlhaCIpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpOwogICAgICAgICAgICB0MiA9IEpwKHQyLCAodDMpID0+IHsKICAgICAgICAgICAgICB0My5sZWFkaW5nQ29tbWVudHMgJiYgdDMubGVhZGluZ0NvbW1lbnRzLnNvbWUoWHApICYmIGUzLmFkZChLcCh0MykpOwogICAgICAgICAgICB9KSwgdDIgPSBKcCh0MiwgKHQzKSA9PiB7CiAgICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJQYXJlbnRoZXNpemVkRXhwcmVzc2lvbiIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHsgZXhwcmVzc2lvbjogczIgfSA9IHQzOwogICAgICAgICAgICAgICAgaWYgKHMyLnR5cGUgPT09ICJUeXBlQ2FzdEV4cHJlc3Npb24iKQogICAgICAgICAgICAgICAgICByZXR1cm4gczIucmFuZ2UgPSB0My5yYW5nZSwgczI7CiAgICAgICAgICAgICAgICBjb25zdCByMiA9IEtwKHQzKTsKICAgICAgICAgICAgICAgIGlmICghZTMuaGFzKHIyKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHMyLmV4dHJhID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBzMi5leHRyYSksIHt9LCB7IHBhcmVudGhlc2l6ZWQ6IHRydWUgfSksIHMyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdDIgPSBKcCh0MiwgKHQzKSA9PiB7CiAgICAgICAgICAgIHN3aXRjaCAodDMudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgIkNoYWluRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gWXAodDMuZXhwcmVzc2lvbik7CiAgICAgICAgICAgICAgY2FzZSAiTG9naWNhbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgaWYgKFFwKHQzKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIFpwKHQzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIlZhcmlhYmxlRGVjbGFyYXRpb24iOiB7CiAgICAgICAgICAgICAgICBjb25zdCBzMiA9IFdwKHQzLmRlY2xhcmF0aW9ucyk7CiAgICAgICAgICAgICAgICBzMiAmJiBzMi5pbml0ICYmIGZ1bmN0aW9uKHQ0LCBzMykgewogICAgICAgICAgICAgICAgICBpZiAoZTIub3JpZ2luYWxUZXh0W0dwKHMzKV0gPT09ICI7IikKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIHQ0LnJhbmdlID0gW0twKHQ0KSwgR3AoczMpXTsKICAgICAgICAgICAgICAgIH0odDMsIHMyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlICJUU1BhcmVudGhlc2l6ZWRUeXBlIjoKICAgICAgICAgICAgICAgIHJldHVybiB0My50eXBlQW5ub3RhdGlvbi5yYW5nZSA9IFtLcCh0MyksIEdwKHQzKV0sIHQzLnR5cGVBbm5vdGF0aW9uOwogICAgICAgICAgICAgIGNhc2UgIlRTVHlwZVBhcmFtZXRlciI6CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHQzLm5hbWUgPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZTMgPSBLcCh0Myk7CiAgICAgICAgICAgICAgICAgIHQzLm5hbWUgPSB7IHR5cGU6ICJJZGVudGlmaWVyIiwgbmFtZTogdDMubmFtZSwgcmFuZ2U6IFtlMywgZTMgKyB0My5uYW1lLmxlbmd0aF0gfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIlNlcXVlbmNlRXhwcmVzc2lvbiI6IHsKICAgICAgICAgICAgICAgIGNvbnN0IGUzID0gV3AodDMuZXhwcmVzc2lvbnMpOwogICAgICAgICAgICAgICAgdDMucmFuZ2UgPSBbS3AodDMpLCBNYXRoLm1pbihHcChlMyksIEdwKHQzKSldOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgIlRvcGljUmVmZXJlbmNlIjoKICAgICAgICAgICAgICAgIGUyLl9faXNVc2luZ0hhY2tQaXBlbGluZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sIGVjID0ge307CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGVjLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgY29uc3Qgc2MgPSAvXHJcbj98W1xuXHUyMDI4XHUyMDI5XS8sIHJjID0gbmV3IFJlZ0V4cChzYy5zb3VyY2UsICJnIik7CiAgICAgICAgZnVuY3Rpb24gaWModDIpIHsKICAgICAgICAgIHN3aXRjaCAodDIpIHsKICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgY2FzZSA4MjMyOgogICAgICAgICAgICBjYXNlIDgyMzM6CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBuYyA9IC8oPzpcc3xcL1wvLip8XC9cKlteXSo/XCpcLykqL2csIGFjID0gbmV3IFJlZ0V4cCgiKD89KCIgKyAvKD86W15cU1xuXHJcdTIwMjhcdTIwMjldfFwvXC8uKnxcL1wqLio/XCpcLykqL3kuc291cmNlICsgIikpXFwxIiArIC8oPz1bXG5cclx1MjAyOFx1MjAyOV18XC9cKig/IS4qP1wqXC8pfCQpLy5zb3VyY2UsICJ5Iik7CiAgICAgICAgZnVuY3Rpb24gb2ModDIpIHsKICAgICAgICAgIHN3aXRjaCAodDIpIHsKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgICBjYXNlIDE2MDoKICAgICAgICAgICAgY2FzZSA1NzYwOgogICAgICAgICAgICBjYXNlIDgxOTI6CiAgICAgICAgICAgIGNhc2UgODE5MzoKICAgICAgICAgICAgY2FzZSA4MTk0OgogICAgICAgICAgICBjYXNlIDgxOTU6CiAgICAgICAgICAgIGNhc2UgODE5NjoKICAgICAgICAgICAgY2FzZSA4MTk3OgogICAgICAgICAgICBjYXNlIDgxOTg6CiAgICAgICAgICAgIGNhc2UgODE5OToKICAgICAgICAgICAgY2FzZSA4MjAwOgogICAgICAgICAgICBjYXNlIDgyMDE6CiAgICAgICAgICAgIGNhc2UgODIwMjoKICAgICAgICAgICAgY2FzZSA4MjM5OgogICAgICAgICAgICBjYXNlIDgyODc6CiAgICAgICAgICAgIGNhc2UgMTIyODg6CiAgICAgICAgICAgIGNhc2UgNjUyNzk6CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjbGFzcyB1YyB7CiAgICAgICAgICBjb25zdHJ1Y3Rvcih0MiwgZTIpIHsKICAgICAgICAgICAgdGhpcy5saW5lID0gdm9pZCAwLCB0aGlzLmNvbHVtbiA9IHZvaWQgMCwgdGhpcy5saW5lID0gdDIsIHRoaXMuY29sdW1uID0gZTI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNsYXNzIGhjIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKHQyLCBlMikgewogICAgICAgICAgICB0aGlzLnN0YXJ0ID0gdm9pZCAwLCB0aGlzLmVuZCA9IHZvaWQgMCwgdGhpcy5maWxlbmFtZSA9IHZvaWQgMCwgdGhpcy5pZGVudGlmaWVyTmFtZSA9IHZvaWQgMCwgdGhpcy5zdGFydCA9IHQyLCB0aGlzLmVuZCA9IGUyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBwYyh0MiwgZTIpIHsKICAgICAgICAgIHQyLnRyYWlsaW5nQ29tbWVudHMgPT09IHZvaWQgMCA/IHQyLnRyYWlsaW5nQ29tbWVudHMgPSBlMiA6IHQyLnRyYWlsaW5nQ29tbWVudHMudW5zaGlmdCguLi5lMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNjKHQyLCBlMikgewogICAgICAgICAgdDIuaW5uZXJDb21tZW50cyA9PT0gdm9pZCAwID8gdDIuaW5uZXJDb21tZW50cyA9IGUyIDogdDIuaW5uZXJDb21tZW50cy51bnNoaWZ0KC4uLmUyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbGModDIsIGUyLCBzMikgewogICAgICAgICAgbGV0IHIyID0gbnVsbCwgaTIgPSBlMi5sZW5ndGg7CiAgICAgICAgICBmb3IgKDsgcjIgPT09IG51bGwgJiYgaTIgPiAwOyApCiAgICAgICAgICAgIHIyID0gZTJbLS1pMl07CiAgICAgICAgICByMiA9PT0gbnVsbCB8fCByMi5zdGFydCA+IHMyLnN0YXJ0ID8gY2ModDIsIHMyLmNvbW1lbnRzKSA6IHBjKHIyLCBzMi5jb21tZW50cyk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRjID0gT2JqZWN0LmZyZWV6ZSh7IFN5bnRheEVycm9yOiAiQkFCRUxfUEFSU0VSX1NZTlRBWF9FUlJPUiIsIFNvdXJjZVR5cGVNb2R1bGVFcnJvcjogIkJBQkVMX1BBUlNFUl9TT1VSQ0VUWVBFX01PRFVMRV9SRVFVSVJFRCIgfSksIERjID0geWMoeyBBY2Nlc3NvcklzR2VuZXJhdG9yOiAiQSAlMHRlciBjYW5ub3QgYmUgYSBnZW5lcmF0b3IuIiwgQXJndW1lbnRzSW5DbGFzczogIidhcmd1bWVudHMnIGlzIG9ubHkgYWxsb3dlZCBpbiBmdW5jdGlvbnMgYW5kIGNsYXNzIG1ldGhvZHMuIiwgQXN5bmNGdW5jdGlvbkluU2luZ2xlU3RhdGVtZW50Q29udGV4dDogIkFzeW5jIGZ1bmN0aW9ucyBjYW4gb25seSBiZSBkZWNsYXJlZCBhdCB0aGUgdG9wIGxldmVsIG9yIGluc2lkZSBhIGJsb2NrLiIsIEF3YWl0QmluZGluZ0lkZW50aWZpZXI6ICJDYW4gbm90IHVzZSAnYXdhaXQnIGFzIGlkZW50aWZpZXIgaW5zaWRlIGFuIGFzeW5jIGZ1bmN0aW9uLiIsIEF3YWl0QmluZGluZ0lkZW50aWZpZXJJblN0YXRpY0Jsb2NrOiAiQ2FuIG5vdCB1c2UgJ2F3YWl0JyBhcyBpZGVudGlmaWVyIGluc2lkZSBhIHN0YXRpYyBibG9jay4iLCBBd2FpdEV4cHJlc3Npb25Gb3JtYWxQYXJhbWV0ZXI6ICInYXdhaXQnIGlzIG5vdCBhbGxvd2VkIGluIGFzeW5jIGZ1bmN0aW9uIHBhcmFtZXRlcnMuIiwgQXdhaXROb3RJbkFzeW5jQ29udGV4dDogIidhd2FpdCcgaXMgb25seSBhbGxvd2VkIHdpdGhpbiBhc3luYyBmdW5jdGlvbnMgYW5kIGF0IHRoZSB0b3AgbGV2ZWxzIG9mIG1vZHVsZXMuIiwgQXdhaXROb3RJbkFzeW5jRnVuY3Rpb246ICInYXdhaXQnIGlzIG9ubHkgYWxsb3dlZCB3aXRoaW4gYXN5bmMgZnVuY3Rpb25zLiIsIEJhZEdldHRlckFyaXR5OiAiQSAnZ2V0JyBhY2Nlc29yIG11c3Qgbm90IGhhdmUgYW55IGZvcm1hbCBwYXJhbWV0ZXJzLiIsIEJhZFNldHRlckFyaXR5OiAiQSAnc2V0JyBhY2Nlc29yIG11c3QgaGF2ZSBleGFjdGx5IG9uZSBmb3JtYWwgcGFyYW1ldGVyLiIsIEJhZFNldHRlclJlc3RQYXJhbWV0ZXI6ICJBICdzZXQnIGFjY2Vzb3IgZnVuY3Rpb24gYXJndW1lbnQgbXVzdCBub3QgYmUgYSByZXN0IHBhcmFtZXRlci4iLCBDb25zdHJ1Y3RvckNsYXNzRmllbGQ6ICJDbGFzc2VzIG1heSBub3QgaGF2ZSBhIGZpZWxkIG5hbWVkICdjb25zdHJ1Y3RvcicuIiwgQ29uc3RydWN0b3JDbGFzc1ByaXZhdGVGaWVsZDogIkNsYXNzZXMgbWF5IG5vdCBoYXZlIGEgcHJpdmF0ZSBmaWVsZCBuYW1lZCAnI2NvbnN0cnVjdG9yJy4iLCBDb25zdHJ1Y3RvcklzQWNjZXNzb3I6ICJDbGFzcyBjb25zdHJ1Y3RvciBtYXkgbm90IGJlIGFuIGFjY2Vzc29yLiIsIENvbnN0cnVjdG9ySXNBc3luYzogIkNvbnN0cnVjdG9yIGNhbid0IGJlIGFuIGFzeW5jIGZ1bmN0aW9uLiIsIENvbnN0cnVjdG9ySXNHZW5lcmF0b3I6ICJDb25zdHJ1Y3RvciBjYW4ndCBiZSBhIGdlbmVyYXRvci4iLCBEZWNsYXJhdGlvbk1pc3NpbmdJbml0aWFsaXplcjogIiclMCcgcmVxdWlyZSBhbiBpbml0aWFsaXphdGlvbiB2YWx1ZS4iLCBEZWNvcmF0b3JCZWZvcmVFeHBvcnQ6ICJEZWNvcmF0b3JzIG11c3QgYmUgcGxhY2VkICpiZWZvcmUqIHRoZSAnZXhwb3J0JyBrZXl3b3JkLiBZb3UgY2FuIHNldCB0aGUgJ2RlY29yYXRvcnNCZWZvcmVFeHBvcnQnIG9wdGlvbiB0byBmYWxzZSB0byB1c2UgdGhlICdleHBvcnQgQGRlY29yYXRvciBjbGFzcyB7fScgc3ludGF4LiIsIERlY29yYXRvckNvbnN0cnVjdG9yOiAiRGVjb3JhdG9ycyBjYW4ndCBiZSB1c2VkIHdpdGggYSBjb25zdHJ1Y3Rvci4gRGlkIHlvdSBtZWFuICdAZGVjIGNsYXNzIHsgLi4uIH0nPyIsIERlY29yYXRvckV4cG9ydENsYXNzOiAiVXNpbmcgdGhlIGV4cG9ydCBrZXl3b3JkIGJldHdlZW4gYSBkZWNvcmF0b3IgYW5kIGEgY2xhc3MgaXMgbm90IGFsbG93ZWQuIFBsZWFzZSB1c2UgYGV4cG9ydCBAZGVjIGNsYXNzYCBpbnN0ZWFkLiIsIERlY29yYXRvclNlbWljb2xvbjogIkRlY29yYXRvcnMgbXVzdCBub3QgYmUgZm9sbG93ZWQgYnkgYSBzZW1pY29sb24uIiwgRGVjb3JhdG9yU3RhdGljQmxvY2s6ICJEZWNvcmF0b3JzIGNhbid0IGJlIHVzZWQgd2l0aCBhIHN0YXRpYyBibG9jay4iLCBEZWxldGVQcml2YXRlRmllbGQ6ICJEZWxldGluZyBhIHByaXZhdGUgZmllbGQgaXMgbm90IGFsbG93ZWQuIiwgRGVzdHJ1Y3R1cmVOYW1lZEltcG9ydDogIkVTMjAxNSBuYW1lZCBpbXBvcnRzIGRvIG5vdCBkZXN0cnVjdHVyZS4gVXNlIGFub3RoZXIgc3RhdGVtZW50IGZvciBkZXN0cnVjdHVyaW5nIGFmdGVyIHRoZSBpbXBvcnQuIiwgRHVwbGljYXRlQ29uc3RydWN0b3I6ICJEdXBsaWNhdGUgY29uc3RydWN0b3IgaW4gdGhlIHNhbWUgY2xhc3MuIiwgRHVwbGljYXRlRGVmYXVsdEV4cG9ydDogIk9ubHkgb25lIGRlZmF1bHQgZXhwb3J0IGFsbG93ZWQgcGVyIG1vZHVsZS4iLCBEdXBsaWNhdGVFeHBvcnQ6ICJgJTBgIGhhcyBhbHJlYWR5IGJlZW4gZXhwb3J0ZWQuIEV4cG9ydGVkIGlkZW50aWZpZXJzIG11c3QgYmUgdW5pcXVlLiIsIER1cGxpY2F0ZVByb3RvOiAiUmVkZWZpbml0aW9uIG9mIF9fcHJvdG9fXyBwcm9wZXJ0eS4iLCBEdXBsaWNhdGVSZWdFeHBGbGFnczogIkR1cGxpY2F0ZSByZWd1bGFyIGV4cHJlc3Npb24gZmxhZy4iLCBFbGVtZW50QWZ0ZXJSZXN0OiAiUmVzdCBlbGVtZW50IG11c3QgYmUgbGFzdCBlbGVtZW50LiIsIEVzY2FwZWRDaGFyTm90QW5JZGVudGlmaWVyOiAiSW52YWxpZCBVbmljb2RlIGVzY2FwZS4iLCBFeHBvcnRCaW5kaW5nSXNTdHJpbmc6ICJBIHN0cmluZyBsaXRlcmFsIGNhbm5vdCBiZSB1c2VkIGFzIGFuIGV4cG9ydGVkIGJpbmRpbmcgd2l0aG91dCBgZnJvbWAuXG4tIERpZCB5b3UgbWVhbiBgZXhwb3J0IHsgJyUwJyBhcyAnJTEnIH0gZnJvbSAnc29tZS1tb2R1bGUnYD8iLCBFeHBvcnREZWZhdWx0RnJvbUFzSWRlbnRpZmllcjogIidmcm9tJyBpcyBub3QgYWxsb3dlZCBhcyBhbiBpZGVudGlmaWVyIGFmdGVyICdleHBvcnQgZGVmYXVsdCcuIiwgRm9ySW5PZkxvb3BJbml0aWFsaXplcjogIiclMCcgbG9vcCB2YXJpYWJsZSBkZWNsYXJhdGlvbiBtYXkgbm90IGhhdmUgYW4gaW5pdGlhbGl6ZXIuIiwgRm9yT2ZBc3luYzogIlRoZSBsZWZ0LWhhbmQgc2lkZSBvZiBhIGZvci1vZiBsb29wIG1heSBub3QgYmUgJ2FzeW5jJy4iLCBGb3JPZkxldDogIlRoZSBsZWZ0LWhhbmQgc2lkZSBvZiBhIGZvci1vZiBsb29wIG1heSBub3Qgc3RhcnQgd2l0aCAnbGV0Jy4iLCBHZW5lcmF0b3JJblNpbmdsZVN0YXRlbWVudENvbnRleHQ6ICJHZW5lcmF0b3JzIGNhbiBvbmx5IGJlIGRlY2xhcmVkIGF0IHRoZSB0b3AgbGV2ZWwgb3IgaW5zaWRlIGEgYmxvY2suIiwgSWxsZWdhbEJyZWFrQ29udGludWU6ICJVbnN5bnRhY3RpYyAlMC4iLCBJbGxlZ2FsTGFuZ3VhZ2VNb2RlRGlyZWN0aXZlOiAiSWxsZWdhbCAndXNlIHN0cmljdCcgZGlyZWN0aXZlIGluIGZ1bmN0aW9uIHdpdGggbm9uLXNpbXBsZSBwYXJhbWV0ZXIgbGlzdC4iLCBJbGxlZ2FsUmV0dXJuOiAiJ3JldHVybicgb3V0c2lkZSBvZiBmdW5jdGlvbi4iLCBJbXBvcnRCaW5kaW5nSXNTdHJpbmc6ICdBIHN0cmluZyBsaXRlcmFsIGNhbm5vdCBiZSB1c2VkIGFzIGFuIGltcG9ydGVkIGJpbmRpbmcuXG4tIERpZCB5b3UgbWVhbiBgaW1wb3J0IHsgIiUwIiBhcyBmb28gfWA/JywgSW1wb3J0Q2FsbEFyZ3VtZW50VHJhaWxpbmdDb21tYTogIlRyYWlsaW5nIGNvbW1hIGlzIGRpc2FsbG93ZWQgaW5zaWRlIGltcG9ydCguLi4pIGFyZ3VtZW50cy4iLCBJbXBvcnRDYWxsQXJpdHk6ICJgaW1wb3J0KClgIHJlcXVpcmVzIGV4YWN0bHkgJTAuIiwgSW1wb3J0Q2FsbE5vdE5ld0V4cHJlc3Npb246ICJDYW5ub3QgdXNlIG5ldyB3aXRoIGltcG9ydCguLi4pLiIsIEltcG9ydENhbGxTcHJlYWRBcmd1bWVudDogImAuLi5gIGlzIG5vdCBhbGxvd2VkIGluIGBpbXBvcnQoKWAuIiwgSW52YWxpZEJpZ0ludExpdGVyYWw6ICJJbnZhbGlkIEJpZ0ludExpdGVyYWwuIiwgSW52YWxpZENvZGVQb2ludDogIkNvZGUgcG9pbnQgb3V0IG9mIGJvdW5kcy4iLCBJbnZhbGlkRGVjaW1hbDogIkludmFsaWQgZGVjaW1hbC4iLCBJbnZhbGlkRGlnaXQ6ICJFeHBlY3RlZCBudW1iZXIgaW4gcmFkaXggJTAuIiwgSW52YWxpZEVzY2FwZVNlcXVlbmNlOiAiQmFkIGNoYXJhY3RlciBlc2NhcGUgc2VxdWVuY2UuIiwgSW52YWxpZEVzY2FwZVNlcXVlbmNlVGVtcGxhdGU6ICJJbnZhbGlkIGVzY2FwZSBzZXF1ZW5jZSBpbiB0ZW1wbGF0ZS4iLCBJbnZhbGlkRXNjYXBlZFJlc2VydmVkV29yZDogIkVzY2FwZSBzZXF1ZW5jZSBpbiBrZXl3b3JkICUwLiIsIEludmFsaWRJZGVudGlmaWVyOiAiSW52YWxpZCBpZGVudGlmaWVyICUwLiIsIEludmFsaWRMaHM6ICJJbnZhbGlkIGxlZnQtaGFuZCBzaWRlIGluICUwLiIsIEludmFsaWRMaHNCaW5kaW5nOiAiQmluZGluZyBpbnZhbGlkIGxlZnQtaGFuZCBzaWRlIGluICUwLiIsIEludmFsaWROdW1iZXI6ICJJbnZhbGlkIG51bWJlci4iLCBJbnZhbGlkT3JNaXNzaW5nRXhwb25lbnQ6ICJGbG9hdGluZy1wb2ludCBudW1iZXJzIHJlcXVpcmUgYSB2YWxpZCBleHBvbmVudCBhZnRlciB0aGUgJ2UnLiIsIEludmFsaWRPclVuZXhwZWN0ZWRUb2tlbjogIlVuZXhwZWN0ZWQgY2hhcmFjdGVyICclMCcuIiwgSW52YWxpZFBhcmVudGhlc2l6ZWRBc3NpZ25tZW50OiAiSW52YWxpZCBwYXJlbnRoZXNpemVkIGFzc2lnbm1lbnQgcGF0dGVybi4iLCBJbnZhbGlkUHJpdmF0ZUZpZWxkUmVzb2x1dGlvbjogIlByaXZhdGUgbmFtZSAjJTAgaXMgbm90IGRlZmluZWQuIiwgSW52YWxpZFByb3BlcnR5QmluZGluZ1BhdHRlcm46ICJCaW5kaW5nIG1lbWJlciBleHByZXNzaW9uLiIsIEludmFsaWRSZWNvcmRQcm9wZXJ0eTogIk9ubHkgcHJvcGVydGllcyBhbmQgc3ByZWFkIGVsZW1lbnRzIGFyZSBhbGxvd2VkIGluIHJlY29yZCBkZWZpbml0aW9ucy4iLCBJbnZhbGlkUmVzdEFzc2lnbm1lbnRQYXR0ZXJuOiAiSW52YWxpZCByZXN0IG9wZXJhdG9yJ3MgYXJndW1lbnQuIiwgTGFiZWxSZWRlY2xhcmF0aW9uOiAiTGFiZWwgJyUwJyBpcyBhbHJlYWR5IGRlY2xhcmVkLiIsIExldEluTGV4aWNhbEJpbmRpbmc6ICInbGV0JyBpcyBub3QgYWxsb3dlZCB0byBiZSB1c2VkIGFzIGEgbmFtZSBpbiAnbGV0JyBvciAnY29uc3QnIGRlY2xhcmF0aW9ucy4iLCBMaW5lVGVybWluYXRvckJlZm9yZUFycm93OiAiTm8gbGluZSBicmVhayBpcyBhbGxvd2VkIGJlZm9yZSAnPT4nLiIsIE1hbGZvcm1lZFJlZ0V4cEZsYWdzOiAiSW52YWxpZCByZWd1bGFyIGV4cHJlc3Npb24gZmxhZy4iLCBNaXNzaW5nQ2xhc3NOYW1lOiAiQSBjbGFzcyBuYW1lIGlzIHJlcXVpcmVkLiIsIE1pc3NpbmdFcUluQXNzaWdubWVudDogIk9ubHkgJz0nIG9wZXJhdG9yIGNhbiBiZSB1c2VkIGZvciBzcGVjaWZ5aW5nIGRlZmF1bHQgdmFsdWUuIiwgTWlzc2luZ1NlbWljb2xvbjogIk1pc3Npbmcgc2VtaWNvbG9uLiIsIE1pc3NpbmdVbmljb2RlRXNjYXBlOiAiRXhwZWN0aW5nIFVuaWNvZGUgZXNjYXBlIHNlcXVlbmNlIFxcdVhYWFguIiwgTWl4aW5nQ29hbGVzY2VXaXRoTG9naWNhbDogIk51bGxpc2ggY29hbGVzY2luZyBvcGVyYXRvcig/PykgcmVxdWlyZXMgcGFyZW5zIHdoZW4gbWl4aW5nIHdpdGggbG9naWNhbCBvcGVyYXRvcnMuIiwgTW9kdWxlQXR0cmlidXRlRGlmZmVyZW50RnJvbVR5cGU6ICJUaGUgb25seSBhY2NlcHRlZCBtb2R1bGUgYXR0cmlidXRlIGlzIGB0eXBlYC4iLCBNb2R1bGVBdHRyaWJ1dGVJbnZhbGlkVmFsdWU6ICJPbmx5IHN0cmluZyBsaXRlcmFscyBhcmUgYWxsb3dlZCBhcyBtb2R1bGUgYXR0cmlidXRlIHZhbHVlcy4iLCBNb2R1bGVBdHRyaWJ1dGVzV2l0aER1cGxpY2F0ZUtleXM6ICdEdXBsaWNhdGUga2V5ICIlMCIgaXMgbm90IGFsbG93ZWQgaW4gbW9kdWxlIGF0dHJpYnV0ZXMuJywgTW9kdWxlRXhwb3J0TmFtZUhhc0xvbmVTdXJyb2dhdGU6ICJBbiBleHBvcnQgbmFtZSBjYW5ub3QgaW5jbHVkZSBhIGxvbmUgc3Vycm9nYXRlLCBmb3VuZCAnXFx1JTAnLiIsIE1vZHVsZUV4cG9ydFVuZGVmaW5lZDogIkV4cG9ydCAnJTAnIGlzIG5vdCBkZWZpbmVkLiIsIE11bHRpcGxlRGVmYXVsdHNJblN3aXRjaDogIk11bHRpcGxlIGRlZmF1bHQgY2xhdXNlcy4iLCBOZXdsaW5lQWZ0ZXJUaHJvdzogIklsbGVnYWwgbmV3bGluZSBhZnRlciB0aHJvdy4iLCBOb0NhdGNoT3JGaW5hbGx5OiAiTWlzc2luZyBjYXRjaCBvciBmaW5hbGx5IGNsYXVzZS4iLCBOdW1iZXJJZGVudGlmaWVyOiAiSWRlbnRpZmllciBkaXJlY3RseSBhZnRlciBudW1iZXIuIiwgTnVtZXJpY1NlcGFyYXRvckluRXNjYXBlU2VxdWVuY2U6ICJOdW1lcmljIHNlcGFyYXRvcnMgYXJlIG5vdCBhbGxvd2VkIGluc2lkZSB1bmljb2RlIGVzY2FwZSBzZXF1ZW5jZXMgb3IgaGV4IGVzY2FwZSBzZXF1ZW5jZXMuIiwgT2Jzb2xldGVBd2FpdFN0YXI6ICInYXdhaXQqJyBoYXMgYmVlbiByZW1vdmVkIGZyb20gdGhlIGFzeW5jIGZ1bmN0aW9ucyBwcm9wb3NhbC4gVXNlIFByb21pc2UuYWxsKCkgaW5zdGVhZC4iLCBPcHRpb25hbENoYWluaW5nTm9OZXc6ICJDb25zdHJ1Y3RvcnMgaW4vYWZ0ZXIgYW4gT3B0aW9uYWwgQ2hhaW4gYXJlIG5vdCBhbGxvd2VkLiIsIE9wdGlvbmFsQ2hhaW5pbmdOb1RlbXBsYXRlOiAiVGFnZ2VkIFRlbXBsYXRlIExpdGVyYWxzIGFyZSBub3QgYWxsb3dlZCBpbiBvcHRpb25hbENoYWluLiIsIE92ZXJyaWRlT25Db25zdHJ1Y3RvcjogIidvdmVycmlkZScgbW9kaWZpZXIgY2Fubm90IGFwcGVhciBvbiBhIGNvbnN0cnVjdG9yIGRlY2xhcmF0aW9uLiIsIFBhcmFtRHVwZTogIkFyZ3VtZW50IG5hbWUgY2xhc2guIiwgUGF0dGVybkhhc0FjY2Vzc29yOiAiT2JqZWN0IHBhdHRlcm4gY2FuJ3QgY29udGFpbiBnZXR0ZXIgb3Igc2V0dGVyLiIsIFBhdHRlcm5IYXNNZXRob2Q6ICJPYmplY3QgcGF0dGVybiBjYW4ndCBjb250YWluIG1ldGhvZHMuIiwgUGlwZUJvZHlJc1RpZ2h0ZXI6ICJVbmV4cGVjdGVkICUwIGFmdGVyIHBpcGVsaW5lIGJvZHk7IGFueSAlMCBleHByZXNzaW9uIGFjdGluZyBhcyBIYWNrLXN0eWxlIHBpcGUgYm9keSBtdXN0IGJlIHBhcmVudGhlc2l6ZWQgZHVlIHRvIGl0cyBsb29zZSBvcGVyYXRvciBwcmVjZWRlbmNlLiIsIFBpcGVUb3BpY1JlcXVpcmVzSGFja1BpcGVzOiAnVG9waWMgcmVmZXJlbmNlIGlzIHVzZWQsIGJ1dCB0aGUgcGlwZWxpbmVPcGVyYXRvciBwbHVnaW4gd2FzIG5vdCBwYXNzZWQgYSAicHJvcG9zYWwiOiAiaGFjayIgb3IgInNtYXJ0IiBvcHRpb24uJywgUGlwZVRvcGljVW5ib3VuZDogIlRvcGljIHJlZmVyZW5jZSBpcyB1bmJvdW5kOyBpdCBtdXN0IGJlIGluc2lkZSBhIHBpcGUgYm9keS4iLCBQaXBlVG9waWNVbmNvbmZpZ3VyZWRUb2tlbjogJ0ludmFsaWQgdG9waWMgdG9rZW4gJTAuIEluIG9yZGVyIHRvIHVzZSAlMCBhcyBhIHRvcGljIHJlZmVyZW5jZSwgdGhlIHBpcGVsaW5lT3BlcmF0b3IgcGx1Z2luIG11c3QgYmUgY29uZmlndXJlZCB3aXRoIHsgInByb3Bvc2FsIjogImhhY2siLCAidG9waWNUb2tlbiI6ICIlMCIgfS4nLCBQaXBlVG9waWNVbnVzZWQ6ICJIYWNrLXN0eWxlIHBpcGUgYm9keSBkb2VzIG5vdCBjb250YWluIGEgdG9waWMgcmVmZXJlbmNlOyBIYWNrLXN0eWxlIHBpcGVzIG11c3QgdXNlIHRvcGljIGF0IGxlYXN0IG9uY2UuIiwgUGlwZVVucGFyZW50aGVzaXplZEJvZHk6ICJIYWNrLXN0eWxlIHBpcGUgYm9keSBjYW5ub3QgYmUgYW4gdW5wYXJlbnRoZXNpemVkICUwIGV4cHJlc3Npb247IHBsZWFzZSB3cmFwIGl0IGluIHBhcmVudGhlc2VzLiIsIFBpcGVsaW5lQm9keU5vQXJyb3c6ICdVbmV4cGVjdGVkIGFycm93ICI9PiIgYWZ0ZXIgcGlwZWxpbmUgYm9keTsgYXJyb3cgZnVuY3Rpb24gaW4gcGlwZWxpbmUgYm9keSBtdXN0IGJlIHBhcmVudGhlc2l6ZWQuJywgUGlwZWxpbmVCb2R5U2VxdWVuY2VFeHByZXNzaW9uOiAiUGlwZWxpbmUgYm9keSBtYXkgbm90IGJlIGEgY29tbWEtc2VwYXJhdGVkIHNlcXVlbmNlIGV4cHJlc3Npb24uIiwgUGlwZWxpbmVIZWFkU2VxdWVuY2VFeHByZXNzaW9uOiAiUGlwZWxpbmUgaGVhZCBzaG91bGQgbm90IGJlIGEgY29tbWEtc2VwYXJhdGVkIHNlcXVlbmNlIGV4cHJlc3Npb24uIiwgUGlwZWxpbmVUb3BpY1VudXNlZDogIlBpcGVsaW5lIGlzIGluIHRvcGljIHN0eWxlIGJ1dCBkb2VzIG5vdCB1c2UgdG9waWMgcmVmZXJlbmNlLiIsIFByaW1hcnlUb3BpY05vdEFsbG93ZWQ6ICJUb3BpYyByZWZlcmVuY2Ugd2FzIHVzZWQgaW4gYSBsZXhpY2FsIGNvbnRleHQgd2l0aG91dCB0b3BpYyBiaW5kaW5nLiIsIFByaW1hcnlUb3BpY1JlcXVpcmVzU21hcnRQaXBlbGluZTogJ1RvcGljIHJlZmVyZW5jZSBpcyB1c2VkLCBidXQgdGhlIHBpcGVsaW5lT3BlcmF0b3IgcGx1Z2luIHdhcyBub3QgcGFzc2VkIGEgInByb3Bvc2FsIjogImhhY2siIG9yICJzbWFydCIgb3B0aW9uLicsIFByaXZhdGVJbkV4cGVjdGVkSW46ICJQcml2YXRlIG5hbWVzIGFyZSBvbmx5IGFsbG93ZWQgaW4gcHJvcGVydHkgYWNjZXNzZXMgKGBvYmouIyUwYCkgb3IgaW4gYGluYCBleHByZXNzaW9ucyAoYCMlMCBpbiBvYmpgKS4iLCBQcml2YXRlTmFtZVJlZGVjbGFyYXRpb246ICJEdXBsaWNhdGUgcHJpdmF0ZSBuYW1lICMlMC4iLCBSZWNvcmRFeHByZXNzaW9uQmFySW5jb3JyZWN0RW5kU3ludGF4VHlwZTogIlJlY29yZCBleHByZXNzaW9ucyBlbmRpbmcgd2l0aCAnfH0nIGFyZSBvbmx5IGFsbG93ZWQgd2hlbiB0aGUgJ3N5bnRheFR5cGUnIG9wdGlvbiBvZiB0aGUgJ3JlY29yZEFuZFR1cGxlJyBwbHVnaW4gaXMgc2V0IHRvICdiYXInLiIsIFJlY29yZEV4cHJlc3Npb25CYXJJbmNvcnJlY3RTdGFydFN5bnRheFR5cGU6ICJSZWNvcmQgZXhwcmVzc2lvbnMgc3RhcnRpbmcgd2l0aCAne3wnIGFyZSBvbmx5IGFsbG93ZWQgd2hlbiB0aGUgJ3N5bnRheFR5cGUnIG9wdGlvbiBvZiB0aGUgJ3JlY29yZEFuZFR1cGxlJyBwbHVnaW4gaXMgc2V0IHRvICdiYXInLiIsIFJlY29yZEV4cHJlc3Npb25IYXNoSW5jb3JyZWN0U3RhcnRTeW50YXhUeXBlOiAiUmVjb3JkIGV4cHJlc3Npb25zIHN0YXJ0aW5nIHdpdGggJyN7JyBhcmUgb25seSBhbGxvd2VkIHdoZW4gdGhlICdzeW50YXhUeXBlJyBvcHRpb24gb2YgdGhlICdyZWNvcmRBbmRUdXBsZScgcGx1Z2luIGlzIHNldCB0byAnaGFzaCcuIiwgUmVjb3JkTm9Qcm90bzogIidfX3Byb3RvX18nIGlzIG5vdCBhbGxvd2VkIGluIFJlY29yZCBleHByZXNzaW9ucy4iLCBSZXN0VHJhaWxpbmdDb21tYTogIlVuZXhwZWN0ZWQgdHJhaWxpbmcgY29tbWEgYWZ0ZXIgcmVzdCBlbGVtZW50LiIsIFNsb3BweUZ1bmN0aW9uOiAiSW4gbm9uLXN0cmljdCBtb2RlIGNvZGUsIGZ1bmN0aW9ucyBjYW4gb25seSBiZSBkZWNsYXJlZCBhdCB0b3AgbGV2ZWwsIGluc2lkZSBhIGJsb2NrLCBvciBhcyB0aGUgYm9keSBvZiBhbiBpZiBzdGF0ZW1lbnQuIiwgU3RhdGljUHJvdG90eXBlOiAiQ2xhc3NlcyBtYXkgbm90IGhhdmUgc3RhdGljIHByb3BlcnR5IG5hbWVkIHByb3RvdHlwZS4iLCBTdHJpY3REZWxldGU6ICJEZWxldGluZyBsb2NhbCB2YXJpYWJsZSBpbiBzdHJpY3QgbW9kZS4iLCBTdHJpY3RFdmFsQXJndW1lbnRzOiAiQXNzaWduaW5nIHRvICclMCcgaW4gc3RyaWN0IG1vZGUuIiwgU3RyaWN0RXZhbEFyZ3VtZW50c0JpbmRpbmc6ICJCaW5kaW5nICclMCcgaW4gc3RyaWN0IG1vZGUuIiwgU3RyaWN0RnVuY3Rpb246ICJJbiBzdHJpY3QgbW9kZSBjb2RlLCBmdW5jdGlvbnMgY2FuIG9ubHkgYmUgZGVjbGFyZWQgYXQgdG9wIGxldmVsIG9yIGluc2lkZSBhIGJsb2NrLiIsIFN0cmljdE51bWVyaWNFc2NhcGU6ICJUaGUgb25seSB2YWxpZCBudW1lcmljIGVzY2FwZSBpbiBzdHJpY3QgbW9kZSBpcyAnXFwwJy4iLCBTdHJpY3RPY3RhbExpdGVyYWw6ICJMZWdhY3kgb2N0YWwgbGl0ZXJhbHMgYXJlIG5vdCBhbGxvd2VkIGluIHN0cmljdCBtb2RlLiIsIFN0cmljdFdpdGg6ICInd2l0aCcgaW4gc3RyaWN0IG1vZGUuIiwgU3VwZXJOb3RBbGxvd2VkOiAiYHN1cGVyKClgIGlzIG9ubHkgdmFsaWQgaW5zaWRlIGEgY2xhc3MgY29uc3RydWN0b3Igb2YgYSBzdWJjbGFzcy4gTWF5YmUgYSB0eXBvIGluIHRoZSBtZXRob2QgbmFtZSAoJ2NvbnN0cnVjdG9yJykgb3Igbm90IGV4dGVuZGluZyBhbm90aGVyIGNsYXNzPyIsIFN1cGVyUHJpdmF0ZUZpZWxkOiAiUHJpdmF0ZSBmaWVsZHMgY2FuJ3QgYmUgYWNjZXNzZWQgb24gc3VwZXIuIiwgVHJhaWxpbmdEZWNvcmF0b3I6ICJEZWNvcmF0b3JzIG11c3QgYmUgYXR0YWNoZWQgdG8gYSBjbGFzcyBlbGVtZW50LiIsIFR1cGxlRXhwcmVzc2lvbkJhckluY29ycmVjdEVuZFN5bnRheFR5cGU6ICJUdXBsZSBleHByZXNzaW9ucyBlbmRpbmcgd2l0aCAnfF0nIGFyZSBvbmx5IGFsbG93ZWQgd2hlbiB0aGUgJ3N5bnRheFR5cGUnIG9wdGlvbiBvZiB0aGUgJ3JlY29yZEFuZFR1cGxlJyBwbHVnaW4gaXMgc2V0IHRvICdiYXInLiIsIFR1cGxlRXhwcmVzc2lvbkJhckluY29ycmVjdFN0YXJ0U3ludGF4VHlwZTogIlR1cGxlIGV4cHJlc3Npb25zIHN0YXJ0aW5nIHdpdGggJ1t8JyBhcmUgb25seSBhbGxvd2VkIHdoZW4gdGhlICdzeW50YXhUeXBlJyBvcHRpb24gb2YgdGhlICdyZWNvcmRBbmRUdXBsZScgcGx1Z2luIGlzIHNldCB0byAnYmFyJy4iLCBUdXBsZUV4cHJlc3Npb25IYXNoSW5jb3JyZWN0U3RhcnRTeW50YXhUeXBlOiAiVHVwbGUgZXhwcmVzc2lvbnMgc3RhcnRpbmcgd2l0aCAnI1snIGFyZSBvbmx5IGFsbG93ZWQgd2hlbiB0aGUgJ3N5bnRheFR5cGUnIG9wdGlvbiBvZiB0aGUgJ3JlY29yZEFuZFR1cGxlJyBwbHVnaW4gaXMgc2V0IHRvICdoYXNoJy4iLCBVbmV4cGVjdGVkQXJndW1lbnRQbGFjZWhvbGRlcjogIlVuZXhwZWN0ZWQgYXJndW1lbnQgcGxhY2Vob2xkZXIuIiwgVW5leHBlY3RlZEF3YWl0QWZ0ZXJQaXBlbGluZUJvZHk6ICdVbmV4cGVjdGVkICJhd2FpdCIgYWZ0ZXIgcGlwZWxpbmUgYm9keTsgYXdhaXQgbXVzdCBoYXZlIHBhcmVudGhlc2VzIGluIG1pbmltYWwgcHJvcG9zYWwuJywgVW5leHBlY3RlZERpZ2l0QWZ0ZXJIYXNoOiAiVW5leHBlY3RlZCBkaWdpdCBhZnRlciBoYXNoIHRva2VuLiIsIFVuZXhwZWN0ZWRJbXBvcnRFeHBvcnQ6ICInaW1wb3J0JyBhbmQgJ2V4cG9ydCcgbWF5IG9ubHkgYXBwZWFyIGF0IHRoZSB0b3AgbGV2ZWwuIiwgVW5leHBlY3RlZEtleXdvcmQ6ICJVbmV4cGVjdGVkIGtleXdvcmQgJyUwJy4iLCBVbmV4cGVjdGVkTGVhZGluZ0RlY29yYXRvcjogIkxlYWRpbmcgZGVjb3JhdG9ycyBtdXN0IGJlIGF0dGFjaGVkIHRvIGEgY2xhc3MgZGVjbGFyYXRpb24uIiwgVW5leHBlY3RlZExleGljYWxEZWNsYXJhdGlvbjogIkxleGljYWwgZGVjbGFyYXRpb24gY2Fubm90IGFwcGVhciBpbiBhIHNpbmdsZS1zdGF0ZW1lbnQgY29udGV4dC4iLCBVbmV4cGVjdGVkTmV3VGFyZ2V0OiAiYG5ldy50YXJnZXRgIGNhbiBvbmx5IGJlIHVzZWQgaW4gZnVuY3Rpb25zIG9yIGNsYXNzIHByb3BlcnRpZXMuIiwgVW5leHBlY3RlZE51bWVyaWNTZXBhcmF0b3I6ICJBIG51bWVyaWMgc2VwYXJhdG9yIGlzIG9ubHkgYWxsb3dlZCBiZXR3ZWVuIHR3byBkaWdpdHMuIiwgVW5leHBlY3RlZFByaXZhdGVGaWVsZDogIlByaXZhdGUgbmFtZXMgY2FuIG9ubHkgYmUgdXNlZCBhcyB0aGUgbmFtZSBvZiBhIGNsYXNzIGVsZW1lbnQgKGkuZS4gY2xhc3MgQyB7ICNwID0gNDI7ICNtKCkge30gfSApXG4gb3IgYSBwcm9wZXJ0eSBvZiBtZW1iZXIgZXhwcmVzc2lvbiAoaS5lLiB0aGlzLiNwKS4iLCBVbmV4cGVjdGVkUmVzZXJ2ZWRXb3JkOiAiVW5leHBlY3RlZCByZXNlcnZlZCB3b3JkICclMCcuIiwgVW5leHBlY3RlZFN1cGVyOiAiJ3N1cGVyJyBpcyBvbmx5IGFsbG93ZWQgaW4gb2JqZWN0IG1ldGhvZHMgYW5kIGNsYXNzZXMuIiwgVW5leHBlY3RlZFRva2VuOiAiVW5leHBlY3RlZCB0b2tlbiAnJTAnLiIsIFVuZXhwZWN0ZWRUb2tlblVuYXJ5RXhwb25lbnRpYXRpb246ICJJbGxlZ2FsIGV4cHJlc3Npb24uIFdyYXAgbGVmdCBoYW5kIHNpZGUgb3IgZW50aXJlIGV4cG9uZW50aWF0aW9uIGluIHBhcmVudGhlc2VzLiIsIFVuc3VwcG9ydGVkQmluZDogIkJpbmRpbmcgc2hvdWxkIGJlIHBlcmZvcm1lZCBvbiBvYmplY3QgcHJvcGVydHkuIiwgVW5zdXBwb3J0ZWREZWNvcmF0b3JFeHBvcnQ6ICJBIGRlY29yYXRlZCBleHBvcnQgbXVzdCBleHBvcnQgYSBjbGFzcyBkZWNsYXJhdGlvbi4iLCBVbnN1cHBvcnRlZERlZmF1bHRFeHBvcnQ6ICJPbmx5IGV4cHJlc3Npb25zLCBmdW5jdGlvbnMgb3IgY2xhc3NlcyBhcmUgYWxsb3dlZCBhcyB0aGUgYGRlZmF1bHRgIGV4cG9ydC4iLCBVbnN1cHBvcnRlZEltcG9ydDogImBpbXBvcnRgIGNhbiBvbmx5IGJlIHVzZWQgaW4gYGltcG9ydCgpYCBvciBgaW1wb3J0Lm1ldGFgLiIsIFVuc3VwcG9ydGVkTWV0YVByb3BlcnR5OiAiVGhlIG9ubHkgdmFsaWQgbWV0YSBwcm9wZXJ0eSBmb3IgJTAgaXMgJTAuJTEuIiwgVW5zdXBwb3J0ZWRQYXJhbWV0ZXJEZWNvcmF0b3I6ICJEZWNvcmF0b3JzIGNhbm5vdCBiZSB1c2VkIHRvIGRlY29yYXRlIHBhcmFtZXRlcnMuIiwgVW5zdXBwb3J0ZWRQcm9wZXJ0eURlY29yYXRvcjogIkRlY29yYXRvcnMgY2Fubm90IGJlIHVzZWQgdG8gZGVjb3JhdGUgb2JqZWN0IGxpdGVyYWwgcHJvcGVydGllcy4iLCBVbnN1cHBvcnRlZFN1cGVyOiAiJ3N1cGVyJyBjYW4gb25seSBiZSB1c2VkIHdpdGggZnVuY3Rpb24gY2FsbHMgKGkuZS4gc3VwZXIoKSkgb3IgaW4gcHJvcGVydHkgYWNjZXNzZXMgKGkuZS4gc3VwZXIucHJvcCBvciBzdXBlcltwcm9wXSkuIiwgVW50ZXJtaW5hdGVkQ29tbWVudDogIlVudGVybWluYXRlZCBjb21tZW50LiIsIFVudGVybWluYXRlZFJlZ0V4cDogIlVudGVybWluYXRlZCByZWd1bGFyIGV4cHJlc3Npb24uIiwgVW50ZXJtaW5hdGVkU3RyaW5nOiAiVW50ZXJtaW5hdGVkIHN0cmluZyBjb25zdGFudC4iLCBVbnRlcm1pbmF0ZWRUZW1wbGF0ZTogIlVudGVybWluYXRlZCB0ZW1wbGF0ZS4iLCBWYXJSZWRlY2xhcmF0aW9uOiAiSWRlbnRpZmllciAnJTAnIGhhcyBhbHJlYWR5IGJlZW4gZGVjbGFyZWQuIiwgWWllbGRCaW5kaW5nSWRlbnRpZmllcjogIkNhbiBub3QgdXNlICd5aWVsZCcgYXMgaWRlbnRpZmllciBpbnNpZGUgYSBnZW5lcmF0b3IuIiwgWWllbGRJblBhcmFtZXRlcjogIllpZWxkIGV4cHJlc3Npb24gaXMgbm90IGFsbG93ZWQgaW4gZm9ybWFsIHBhcmFtZXRlcnMuIiwgWmVyb0RpZ2l0TnVtZXJpY1NlcGFyYXRvcjogIk51bWVyaWMgc2VwYXJhdG9yIGNhbiBub3QgYmUgdXNlZCBhZnRlciBsZWFkaW5nIDAuIiB9LCBkYy5TeW50YXhFcnJvciksIG1jID0geWMoeyBJbXBvcnRNZXRhT3V0c2lkZU1vZHVsZTogYGltcG9ydC5tZXRhIG1heSBhcHBlYXIgb25seSB3aXRoICdzb3VyY2VUeXBlOiAibW9kdWxlIidgLCBJbXBvcnRPdXRzaWRlTW9kdWxlOiBgJ2ltcG9ydCcgYW5kICdleHBvcnQnIG1heSBhcHBlYXIgb25seSB3aXRoICdzb3VyY2VUeXBlOiAibW9kdWxlIidgIH0sIGRjLlNvdXJjZVR5cGVNb2R1bGVFcnJvcik7CiAgICAgICAgZnVuY3Rpb24gZmModDIsIGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgPT09ICJmbG93IiAmJiB0MiA9PT0gIlBhdHRlcm5Jc09wdGlvbmFsIiA/ICJPcHRpb25hbEJpbmRpbmdQYXR0ZXJuIiA6IHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB5Yyh0MiwgZTIsIHMyKSB7CiAgICAgICAgICBjb25zdCByMiA9IHt9OwogICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHQyKS5mb3JFYWNoKChpMikgPT4gewogICAgICAgICAgICByMltpMl0gPSBPYmplY3QuZnJlZXplKHsgY29kZTogZTIsIHJlYXNvbkNvZGU6IGZjKGkyLCBzMiksIHRlbXBsYXRlOiB0MltpMl0gfSk7CiAgICAgICAgICB9KSwgT2JqZWN0LmZyZWV6ZShyMik7CiAgICAgICAgfQogICAgICAgIGNsYXNzIEVjIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKHQyLCBlMikgewogICAgICAgICAgICB0aGlzLnRva2VuID0gdm9pZCAwLCB0aGlzLnByZXNlcnZlU3BhY2UgPSB2b2lkIDAsIHRoaXMudG9rZW4gPSB0MiwgdGhpcy5wcmVzZXJ2ZVNwYWNlID0gISFlMjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc3QgQWMgPSB7IGJyYWNlOiBuZXcgRWMoInsiKSwgdGVtcGxhdGU6IG5ldyBFYygiYCIsIHRydWUpIH0sIENjID0gdHJ1ZSwgeGMgPSB0cnVlLCBGYyA9IHRydWUsIGdjID0gdHJ1ZSwgUGMgPSB0cnVlOwogICAgICAgIGNsYXNzIFRjIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKHQyKSB7CiAgICAgICAgICAgIGxldCBlMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgICAgICAgIHRoaXMubGFiZWwgPSB2b2lkIDAsIHRoaXMua2V5d29yZCA9IHZvaWQgMCwgdGhpcy5iZWZvcmVFeHByID0gdm9pZCAwLCB0aGlzLnN0YXJ0c0V4cHIgPSB2b2lkIDAsIHRoaXMucmlnaHRBc3NvY2lhdGl2ZSA9IHZvaWQgMCwgdGhpcy5pc0xvb3AgPSB2b2lkIDAsIHRoaXMuaXNBc3NpZ24gPSB2b2lkIDAsIHRoaXMucHJlZml4ID0gdm9pZCAwLCB0aGlzLnBvc3RmaXggPSB2b2lkIDAsIHRoaXMuYmlub3AgPSB2b2lkIDAsIHRoaXMubGFiZWwgPSB0MiwgdGhpcy5rZXl3b3JkID0gZTIua2V5d29yZCwgdGhpcy5iZWZvcmVFeHByID0gISFlMi5iZWZvcmVFeHByLCB0aGlzLnN0YXJ0c0V4cHIgPSAhIWUyLnN0YXJ0c0V4cHIsIHRoaXMucmlnaHRBc3NvY2lhdGl2ZSA9ICEhZTIucmlnaHRBc3NvY2lhdGl2ZSwgdGhpcy5pc0xvb3AgPSAhIWUyLmlzTG9vcCwgdGhpcy5pc0Fzc2lnbiA9ICEhZTIuaXNBc3NpZ24sIHRoaXMucHJlZml4ID0gISFlMi5wcmVmaXgsIHRoaXMucG9zdGZpeCA9ICEhZTIucG9zdGZpeCwgdGhpcy5iaW5vcCA9IGUyLmJpbm9wICE9IG51bGwgPyBlMi5iaW5vcCA6IG51bGwsIHRoaXMudXBkYXRlQ29udGV4dCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IGJjID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICAgICAgICBmdW5jdGlvbiBTYyh0MikgewogICAgICAgICAgbGV0IGUyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgICAgIGUyLmtleXdvcmQgPSB0MjsKICAgICAgICAgIGNvbnN0IHMyID0gTWModDIsIGUyKTsKICAgICAgICAgIHJldHVybiBiYy5zZXQodDIsIHMyKSwgczI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHdjKHQyLCBlMikgewogICAgICAgICAgcmV0dXJuIE1jKHQyLCB7IGJlZm9yZUV4cHI6IENjLCBiaW5vcDogZTIgfSk7CiAgICAgICAgfQogICAgICAgIGxldCBCYyA9IC0xOwogICAgICAgIGNvbnN0IE5jID0gW10sIEljID0gW10sIHZjID0gW10sIGtjID0gW10sIExjID0gW10sIE9jID0gW107CiAgICAgICAgZnVuY3Rpb24gTWModDIpIHsKICAgICAgICAgIGxldCBlMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgICAgICB2YXIgczIsIHIyLCBpMiwgbjI7CiAgICAgICAgICByZXR1cm4gKytCYywgSWMucHVzaCh0MiksIHZjLnB1c2goKHMyID0gZTIuYmlub3ApICE9IG51bGwgPyBzMiA6IC0xKSwga2MucHVzaCgocjIgPSBlMi5iZWZvcmVFeHByKSAhPSBudWxsICYmIHIyKSwgTGMucHVzaCgoaTIgPSBlMi5zdGFydHNFeHByKSAhPSBudWxsICYmIGkyKSwgT2MucHVzaCgobjIgPSBlMi5wcmVmaXgpICE9IG51bGwgJiYgbjIpLCBOYy5wdXNoKG5ldyBUYyh0MiwgZTIpKSwgQmM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFJjKHQyKSB7CiAgICAgICAgICBsZXQgZTIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICAgICAgdmFyIHMyLCByMiwgaTIsIG4yOwogICAgICAgICAgcmV0dXJuICsrQmMsIGJjLnNldCh0MiwgQmMpLCBJYy5wdXNoKHQyKSwgdmMucHVzaCgoczIgPSBlMi5iaW5vcCkgIT0gbnVsbCA/IHMyIDogLTEpLCBrYy5wdXNoKChyMiA9IGUyLmJlZm9yZUV4cHIpICE9IG51bGwgJiYgcjIpLCBMYy5wdXNoKChpMiA9IGUyLnN0YXJ0c0V4cHIpICE9IG51bGwgJiYgaTIpLCBPYy5wdXNoKChuMiA9IGUyLnByZWZpeCkgIT0gbnVsbCAmJiBuMiksIE5jLnB1c2gobmV3IFRjKCJuYW1lIiwgZTIpKSwgQmM7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGpjID0geyBicmFja2V0TDogTWMoIlsiLCB7IGJlZm9yZUV4cHI6IENjLCBzdGFydHNFeHByOiB4YyB9KSwgYnJhY2tldEhhc2hMOiBNYygiI1siLCB7IGJlZm9yZUV4cHI6IENjLCBzdGFydHNFeHByOiB4YyB9KSwgYnJhY2tldEJhckw6IE1jKCJbfCIsIHsgYmVmb3JlRXhwcjogQ2MsIHN0YXJ0c0V4cHI6IHhjIH0pLCBicmFja2V0UjogTWMoIl0iKSwgYnJhY2tldEJhclI6IE1jKCJ8XSIpLCBicmFjZUw6IE1jKCJ7IiwgeyBiZWZvcmVFeHByOiBDYywgc3RhcnRzRXhwcjogeGMgfSksIGJyYWNlQmFyTDogTWMoInt8IiwgeyBiZWZvcmVFeHByOiBDYywgc3RhcnRzRXhwcjogeGMgfSksIGJyYWNlSGFzaEw6IE1jKCIjeyIsIHsgYmVmb3JlRXhwcjogQ2MsIHN0YXJ0c0V4cHI6IHhjIH0pLCBicmFjZVI6IE1jKCJ9IiwgeyBiZWZvcmVFeHByOiBDYyB9KSwgYnJhY2VCYXJSOiBNYygifH0iKSwgcGFyZW5MOiBNYygiKCIsIHsgYmVmb3JlRXhwcjogQ2MsIHN0YXJ0c0V4cHI6IHhjIH0pLCBwYXJlblI6IE1jKCIpIiksIGNvbW1hOiBNYygiLCIsIHsgYmVmb3JlRXhwcjogQ2MgfSksIHNlbWk6IE1jKCI7IiwgeyBiZWZvcmVFeHByOiBDYyB9KSwgY29sb246IE1jKCI6IiwgeyBiZWZvcmVFeHByOiBDYyB9KSwgZG91YmxlQ29sb246IE1jKCI6OiIsIHsgYmVmb3JlRXhwcjogQ2MgfSksIGRvdDogTWMoIi4iKSwgcXVlc3Rpb246IE1jKCI/IiwgeyBiZWZvcmVFeHByOiBDYyB9KSwgcXVlc3Rpb25Eb3Q6IE1jKCI/LiIpLCBhcnJvdzogTWMoIj0+IiwgeyBiZWZvcmVFeHByOiBDYyB9KSwgdGVtcGxhdGU6IE1jKCJ0ZW1wbGF0ZSIpLCBlbGxpcHNpczogTWMoIi4uLiIsIHsgYmVmb3JlRXhwcjogQ2MgfSksIGJhY2tRdW90ZTogTWMoImAiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBkb2xsYXJCcmFjZUw6IE1jKCIkeyIsIHsgYmVmb3JlRXhwcjogQ2MsIHN0YXJ0c0V4cHI6IHhjIH0pLCBhdDogTWMoIkAiKSwgaGFzaDogTWMoIiMiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBpbnRlcnByZXRlckRpcmVjdGl2ZTogTWMoIiMhLi4uIiksIGVxOiBNYygiPSIsIHsgYmVmb3JlRXhwcjogQ2MsIGlzQXNzaWduOiBnYyB9KSwgYXNzaWduOiBNYygiXz0iLCB7IGJlZm9yZUV4cHI6IENjLCBpc0Fzc2lnbjogZ2MgfSksIHNsYXNoQXNzaWduOiBNYygiXz0iLCB7IGJlZm9yZUV4cHI6IENjLCBpc0Fzc2lnbjogZ2MgfSksIHhvckFzc2lnbjogTWMoIl89IiwgeyBiZWZvcmVFeHByOiBDYywgaXNBc3NpZ246IGdjIH0pLCBtb2R1bG9Bc3NpZ246IE1jKCJfPSIsIHsgYmVmb3JlRXhwcjogQ2MsIGlzQXNzaWduOiBnYyB9KSwgaW5jRGVjOiBNYygiKysvLS0iLCB7IHByZWZpeDogUGMsIHBvc3RmaXg6IHRydWUsIHN0YXJ0c0V4cHI6IHhjIH0pLCBiYW5nOiBNYygiISIsIHsgYmVmb3JlRXhwcjogQ2MsIHByZWZpeDogUGMsIHN0YXJ0c0V4cHI6IHhjIH0pLCB0aWxkZTogTWMoIn4iLCB7IGJlZm9yZUV4cHI6IENjLCBwcmVmaXg6IFBjLCBzdGFydHNFeHByOiB4YyB9KSwgcGlwZWxpbmU6IHdjKCJ8PiIsIDApLCBudWxsaXNoQ29hbGVzY2luZzogd2MoIj8/IiwgMSksIGxvZ2ljYWxPUjogd2MoInx8IiwgMSksIGxvZ2ljYWxBTkQ6IHdjKCImJiIsIDIpLCBiaXR3aXNlT1I6IHdjKCJ8IiwgMyksIGJpdHdpc2VYT1I6IHdjKCJeIiwgNCksIGJpdHdpc2VBTkQ6IHdjKCImIiwgNSksIGVxdWFsaXR5OiB3YygiPT0vIT0vPT09LyE9PSIsIDYpLCBsdDogd2MoIjwvPi88PS8+PSIsIDcpLCBndDogd2MoIjwvPi88PS8+PSIsIDcpLCByZWxhdGlvbmFsOiB3YygiPC8+Lzw9Lz49IiwgNyksIGJpdFNoaWZ0OiB3YygiPDwvPj4vPj4+IiwgOCksIHBsdXNNaW46IE1jKCIrLy0iLCB7IGJlZm9yZUV4cHI6IENjLCBiaW5vcDogOSwgcHJlZml4OiBQYywgc3RhcnRzRXhwcjogeGMgfSksIG1vZHVsbzogTWMoIiUiLCB7IGJpbm9wOiAxMCwgc3RhcnRzRXhwcjogeGMgfSksIHN0YXI6IE1jKCIqIiwgeyBiaW5vcDogMTAgfSksIHNsYXNoOiB3YygiLyIsIDEwKSwgZXhwb25lbnQ6IE1jKCIqKiIsIHsgYmVmb3JlRXhwcjogQ2MsIGJpbm9wOiAxMSwgcmlnaHRBc3NvY2lhdGl2ZTogdHJ1ZSB9KSwgX2luOiBTYygiaW4iLCB7IGJlZm9yZUV4cHI6IENjLCBiaW5vcDogNyB9KSwgX2luc3RhbmNlb2Y6IFNjKCJpbnN0YW5jZW9mIiwgeyBiZWZvcmVFeHByOiBDYywgYmlub3A6IDcgfSksIF9icmVhazogU2MoImJyZWFrIiksIF9jYXNlOiBTYygiY2FzZSIsIHsgYmVmb3JlRXhwcjogQ2MgfSksIF9jYXRjaDogU2MoImNhdGNoIiksIF9jb250aW51ZTogU2MoImNvbnRpbnVlIiksIF9kZWJ1Z2dlcjogU2MoImRlYnVnZ2VyIiksIF9kZWZhdWx0OiBTYygiZGVmYXVsdCIsIHsgYmVmb3JlRXhwcjogQ2MgfSksIF9lbHNlOiBTYygiZWxzZSIsIHsgYmVmb3JlRXhwcjogQ2MgfSksIF9maW5hbGx5OiBTYygiZmluYWxseSIpLCBfZnVuY3Rpb246IFNjKCJmdW5jdGlvbiIsIHsgc3RhcnRzRXhwcjogeGMgfSksIF9pZjogU2MoImlmIiksIF9yZXR1cm46IFNjKCJyZXR1cm4iLCB7IGJlZm9yZUV4cHI6IENjIH0pLCBfc3dpdGNoOiBTYygic3dpdGNoIiksIF90aHJvdzogU2MoInRocm93IiwgeyBiZWZvcmVFeHByOiBDYywgcHJlZml4OiBQYywgc3RhcnRzRXhwcjogeGMgfSksIF90cnk6IFNjKCJ0cnkiKSwgX3ZhcjogU2MoInZhciIpLCBfY29uc3Q6IFNjKCJjb25zdCIpLCBfd2l0aDogU2MoIndpdGgiKSwgX25ldzogU2MoIm5ldyIsIHsgYmVmb3JlRXhwcjogQ2MsIHN0YXJ0c0V4cHI6IHhjIH0pLCBfdGhpczogU2MoInRoaXMiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBfc3VwZXI6IFNjKCJzdXBlciIsIHsgc3RhcnRzRXhwcjogeGMgfSksIF9jbGFzczogU2MoImNsYXNzIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX2V4dGVuZHM6IFNjKCJleHRlbmRzIiwgeyBiZWZvcmVFeHByOiBDYyB9KSwgX2V4cG9ydDogU2MoImV4cG9ydCIpLCBfaW1wb3J0OiBTYygiaW1wb3J0IiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX251bGw6IFNjKCJudWxsIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX3RydWU6IFNjKCJ0cnVlIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX2ZhbHNlOiBTYygiZmFsc2UiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBfdHlwZW9mOiBTYygidHlwZW9mIiwgeyBiZWZvcmVFeHByOiBDYywgcHJlZml4OiBQYywgc3RhcnRzRXhwcjogeGMgfSksIF92b2lkOiBTYygidm9pZCIsIHsgYmVmb3JlRXhwcjogQ2MsIHByZWZpeDogUGMsIHN0YXJ0c0V4cHI6IHhjIH0pLCBfZGVsZXRlOiBTYygiZGVsZXRlIiwgeyBiZWZvcmVFeHByOiBDYywgcHJlZml4OiBQYywgc3RhcnRzRXhwcjogeGMgfSksIF9kbzogU2MoImRvIiwgeyBpc0xvb3A6IEZjLCBiZWZvcmVFeHByOiBDYyB9KSwgX2ZvcjogU2MoImZvciIsIHsgaXNMb29wOiBGYyB9KSwgX3doaWxlOiBTYygid2hpbGUiLCB7IGlzTG9vcDogRmMgfSksIF9hczogUmMoImFzIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX2Fzc2VydDogUmMoImFzc2VydCIsIHsgc3RhcnRzRXhwcjogeGMgfSksIF9hc3luYzogUmMoImFzeW5jIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX2F3YWl0OiBSYygiYXdhaXQiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBfZnJvbTogUmMoImZyb20iLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBfZ2V0OiBSYygiZ2V0IiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX2xldDogUmMoImxldCIsIHsgc3RhcnRzRXhwcjogeGMgfSksIF9tZXRhOiBSYygibWV0YSIsIHsgc3RhcnRzRXhwcjogeGMgfSksIF9vZjogUmMoIm9mIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX3NlbnQ6IFJjKCJzZW50IiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX3NldDogUmMoInNldCIsIHsgc3RhcnRzRXhwcjogeGMgfSksIF9zdGF0aWM6IFJjKCJzdGF0aWMiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBfeWllbGQ6IFJjKCJ5aWVsZCIsIHsgc3RhcnRzRXhwcjogeGMgfSksIF9hc3NlcnRzOiBSYygiYXNzZXJ0cyIsIHsgc3RhcnRzRXhwcjogeGMgfSksIF9jaGVja3M6IFJjKCJjaGVja3MiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBfZXhwb3J0czogUmMoImV4cG9ydHMiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBfZ2xvYmFsOiBSYygiZ2xvYmFsIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX2ltcGxlbWVudHM6IFJjKCJpbXBsZW1lbnRzIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX2ludHJpbnNpYzogUmMoImludHJpbnNpYyIsIHsgc3RhcnRzRXhwcjogeGMgfSksIF9pbmZlcjogUmMoImluZmVyIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX2lzOiBSYygiaXMiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBfbWl4aW5zOiBSYygibWl4aW5zIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX3Byb3RvOiBSYygicHJvdG8iLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBfcmVxdWlyZTogUmMoInJlcXVpcmUiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBfa2V5b2Y6IFJjKCJrZXlvZiIsIHsgc3RhcnRzRXhwcjogeGMgfSksIF9yZWFkb25seTogUmMoInJlYWRvbmx5IiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX3VuaXF1ZTogUmMoInVuaXF1ZSIsIHsgc3RhcnRzRXhwcjogeGMgfSksIF9hYnN0cmFjdDogUmMoImFic3RyYWN0IiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX2RlY2xhcmU6IFJjKCJkZWNsYXJlIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX2VudW06IFJjKCJlbnVtIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX21vZHVsZTogUmMoIm1vZHVsZSIsIHsgc3RhcnRzRXhwcjogeGMgfSksIF9uYW1lc3BhY2U6IFJjKCJuYW1lc3BhY2UiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBfaW50ZXJmYWNlOiBSYygiaW50ZXJmYWNlIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX3R5cGU6IFJjKCJ0eXBlIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgX29wYXF1ZTogUmMoIm9wYXF1ZSIsIHsgc3RhcnRzRXhwcjogeGMgfSksIG5hbWU6IE1jKCJuYW1lIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgc3RyaW5nOiBNYygic3RyaW5nIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgbnVtOiBNYygibnVtIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgYmlnaW50OiBNYygiYmlnaW50IiwgeyBzdGFydHNFeHByOiB4YyB9KSwgZGVjaW1hbDogTWMoImRlY2ltYWwiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCByZWdleHA6IE1jKCJyZWdleHAiLCB7IHN0YXJ0c0V4cHI6IHhjIH0pLCBwcml2YXRlTmFtZTogTWMoIiNuYW1lIiwgeyBzdGFydHNFeHByOiB4YyB9KSwgZW9mOiBNYygiZW9mIiksIGpzeE5hbWU6IE1jKCJqc3hOYW1lIiksIGpzeFRleHQ6IE1jKCJqc3hUZXh0IiwgeyBiZWZvcmVFeHByOiB0cnVlIH0pLCBqc3hUYWdTdGFydDogTWMoImpzeFRhZ1N0YXJ0IiwgeyBzdGFydHNFeHByOiB0cnVlIH0pLCBqc3hUYWdFbmQ6IE1jKCJqc3hUYWdFbmQiKSwgcGxhY2Vob2xkZXI6IE1jKCIlJSIsIHsgc3RhcnRzRXhwcjogdHJ1ZSB9KSB9OwogICAgICAgIGZ1bmN0aW9uIFVjKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIgPj0gODcgJiYgdDIgPD0gMTIyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBfYyh0MikgewogICAgICAgICAgcmV0dXJuIHQyID49IDUyICYmIHQyIDw9IDEyMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gemModDIpIHsKICAgICAgICAgIHJldHVybiB0MiA+PSA1MiAmJiB0MiA8PSAxMjY7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEhjKHQyKSB7CiAgICAgICAgICByZXR1cm4gTGNbdDJdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBWYyh0MikgewogICAgICAgICAgcmV0dXJuIHQyID49IDExOSAmJiB0MiA8PSAxMjE7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHFjKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIgPj0gNTIgJiYgdDIgPD0gODY7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFdjKHQyKSB7CiAgICAgICAgICByZXR1cm4gSWNbdDJdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBLYyh0MikgewogICAgICAgICAgcmV0dXJuIHZjW3QyXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gR2ModDIpIHsKICAgICAgICAgIHJldHVybiBOY1t0Ml07CiAgICAgICAgfQogICAgICAgIE5jWzhdLnVwZGF0ZUNvbnRleHQgPSAodDIpID0+IHsKICAgICAgICAgIHQyLnBvcCgpOwogICAgICAgIH0sIE5jWzVdLnVwZGF0ZUNvbnRleHQgPSBOY1s3XS51cGRhdGVDb250ZXh0ID0gTmNbMjNdLnVwZGF0ZUNvbnRleHQgPSAodDIpID0+IHsKICAgICAgICAgIHQyLnB1c2goQWMuYnJhY2UpOwogICAgICAgIH0sIE5jWzIyXS51cGRhdGVDb250ZXh0ID0gKHQyKSA9PiB7CiAgICAgICAgICB0Mlt0Mi5sZW5ndGggLSAxXSA9PT0gQWMudGVtcGxhdGUgPyB0Mi5wb3AoKSA6IHQyLnB1c2goQWMudGVtcGxhdGUpOwogICAgICAgIH0sIE5jWzEzMl0udXBkYXRlQ29udGV4dCA9ICh0MikgPT4gewogICAgICAgICAgdDIucHVzaChBYy5qX2V4cHIsIEFjLmpfb1RhZyk7CiAgICAgICAgfTsKICAgICAgICBsZXQgWGMgPSAiXHhBQVx4QjVceEJBXHhDMC1ceEQ2XHhEOC1ceEY2XHhGOC1cdTAyQzFcdTAyQzYtXHUwMkQxXHUwMkUwLVx1MDJFNFx1MDJFQ1x1MDJFRVx1MDM3MC1cdTAzNzRcdTAzNzZcdTAzNzdcdTAzN0EtXHUwMzdEXHUwMzdGXHUwMzg2XHUwMzg4LVx1MDM4QVx1MDM4Q1x1MDM4RS1cdTAzQTFcdTAzQTMtXHUwM0Y1XHUwM0Y3LVx1MDQ4MVx1MDQ4QS1cdTA1MkZcdTA1MzEtXHUwNTU2XHUwNTU5XHUwNTYwLVx1MDU4OFx1MDVEMC1cdTA1RUFcdTA1RUYtXHUwNUYyXHUwNjIwLVx1MDY0QVx1MDY2RVx1MDY2Rlx1MDY3MS1cdTA2RDNcdTA2RDVcdTA2RTVcdTA2RTZcdTA2RUVcdTA2RUZcdTA2RkEtXHUwNkZDXHUwNkZGXHUwNzEwXHUwNzEyLVx1MDcyRlx1MDc0RC1cdTA3QTVcdTA3QjFcdTA3Q0EtXHUwN0VBXHUwN0Y0XHUwN0Y1XHUwN0ZBXHUwODAwLVx1MDgxNVx1MDgxQVx1MDgyNFx1MDgyOFx1MDg0MC1cdTA4NThcdTA4NjAtXHUwODZBXHUwODcwLVx1MDg4N1x1MDg4OS1cdTA4OEVcdTA4QTAtXHUwOEM5XHUwOTA0LVx1MDkzOVx1MDkzRFx1MDk1MFx1MDk1OC1cdTA5NjFcdTA5NzEtXHUwOTgwXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCRFx1MDlDRVx1MDlEQ1x1MDlERFx1MDlERi1cdTA5RTFcdTA5RjBcdTA5RjFcdTA5RkNcdTBBMDUtXHUwQTBBXHUwQTBGXHUwQTEwXHUwQTEzLVx1MEEyOFx1MEEyQS1cdTBBMzBcdTBBMzJcdTBBMzNcdTBBMzVcdTBBMzZcdTBBMzhcdTBBMzlcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTcyLVx1MEE3NFx1MEE4NS1cdTBBOERcdTBBOEYtXHUwQTkxXHUwQTkzLVx1MEFBOFx1MEFBQS1cdTBBQjBcdTBBQjJcdTBBQjNcdTBBQjUtXHUwQUI5XHUwQUJEXHUwQUQwXHUwQUUwXHUwQUUxXHUwQUY5XHUwQjA1LVx1MEIwQ1x1MEIwRlx1MEIxMFx1MEIxMy1cdTBCMjhcdTBCMkEtXHUwQjMwXHUwQjMyXHUwQjMzXHUwQjM1LVx1MEIzOVx1MEIzRFx1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjFcdTBCNzFcdTBCODNcdTBCODUtXHUwQjhBXHUwQjhFLVx1MEI5MFx1MEI5Mi1cdTBCOTVcdTBCOTlcdTBCOUFcdTBCOUNcdTBCOUVcdTBCOUZcdTBCQTNcdTBCQTRcdTBCQTgtXHUwQkFBXHUwQkFFLVx1MEJCOVx1MEJEMFx1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0RcdTBDNTgtXHUwQzVBXHUwQzVEXHUwQzYwXHUwQzYxXHUwQzgwXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkRcdTBDRERcdTBDREVcdTBDRTBcdTBDRTFcdTBDRjFcdTBDRjJcdTBEMDQtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0RcdTBENEVcdTBENTQtXHUwRDU2XHUwRDVGLVx1MEQ2MVx1MEQ3QS1cdTBEN0ZcdTBEODUtXHUwRDk2XHUwRDlBLVx1MERCMVx1MERCMy1cdTBEQkJcdTBEQkRcdTBEQzAtXHUwREM2XHUwRTAxLVx1MEUzMFx1MEUzMlx1MEUzM1x1MEU0MC1cdTBFNDZcdTBFODFcdTBFODJcdTBFODRcdTBFODYtXHUwRThBXHUwRThDLVx1MEVBM1x1MEVBNVx1MEVBNy1cdTBFQjBcdTBFQjJcdTBFQjNcdTBFQkRcdTBFQzAtXHUwRUM0XHUwRUM2XHUwRURDLVx1MEVERlx1MEYwMFx1MEY0MC1cdTBGNDdcdTBGNDktXHUwRjZDXHUwRjg4LVx1MEY4Q1x1MTAwMC1cdTEwMkFcdTEwM0ZcdTEwNTAtXHUxMDU1XHUxMDVBLVx1MTA1RFx1MTA2MVx1MTA2NVx1MTA2Nlx1MTA2RS1cdTEwNzBcdTEwNzUtXHUxMDgxXHUxMDhFXHUxMEEwLVx1MTBDNVx1MTBDN1x1MTBDRFx1MTBEMC1cdTEwRkFcdTEwRkMtXHUxMjQ4XHUxMjRBLVx1MTI0RFx1MTI1MC1cdTEyNTZcdTEyNThcdTEyNUEtXHUxMjVEXHUxMjYwLVx1MTI4OFx1MTI4QS1cdTEyOERcdTEyOTAtXHUxMkIwXHUxMkIyLVx1MTJCNVx1MTJCOC1cdTEyQkVcdTEyQzBcdTEyQzItXHUxMkM1XHUxMkM4LVx1MTJENlx1MTJEOC1cdTEzMTBcdTEzMTItXHUxMzE1XHUxMzE4LVx1MTM1QVx1MTM4MC1cdTEzOEZcdTEzQTAtXHUxM0Y1XHUxM0Y4LVx1MTNGRFx1MTQwMS1cdTE2NkNcdTE2NkYtXHUxNjdGXHUxNjgxLVx1MTY5QVx1MTZBMC1cdTE2RUFcdTE2RUUtXHUxNkY4XHUxNzAwLVx1MTcxMVx1MTcxRi1cdTE3MzFcdTE3NDAtXHUxNzUxXHUxNzYwLVx1MTc2Q1x1MTc2RS1cdTE3NzBcdTE3ODAtXHUxN0IzXHUxN0Q3XHUxN0RDXHUxODIwLVx1MTg3OFx1MTg4MC1cdTE4QThcdTE4QUFcdTE4QjAtXHUxOEY1XHUxOTAwLVx1MTkxRVx1MTk1MC1cdTE5NkRcdTE5NzAtXHUxOTc0XHUxOTgwLVx1MTlBQlx1MTlCMC1cdTE5QzlcdTFBMDAtXHUxQTE2XHUxQTIwLVx1MUE1NFx1MUFBN1x1MUIwNS1cdTFCMzNcdTFCNDUtXHUxQjRDXHUxQjgzLVx1MUJBMFx1MUJBRVx1MUJBRlx1MUJCQS1cdTFCRTVcdTFDMDAtXHUxQzIzXHUxQzRELVx1MUM0Rlx1MUM1QS1cdTFDN0RcdTFDODAtXHUxQzg4XHUxQzkwLVx1MUNCQVx1MUNCRC1cdTFDQkZcdTFDRTktXHUxQ0VDXHUxQ0VFLVx1MUNGM1x1MUNGNVx1MUNGNlx1MUNGQVx1MUQwMC1cdTFEQkZcdTFFMDAtXHUxRjE1XHUxRjE4LVx1MUYxRFx1MUYyMC1cdTFGNDVcdTFGNDgtXHUxRjREXHUxRjUwLVx1MUY1N1x1MUY1OVx1MUY1Qlx1MUY1RFx1MUY1Ri1cdTFGN0RcdTFGODAtXHUxRkI0XHUxRkI2LVx1MUZCQ1x1MUZCRVx1MUZDMi1cdTFGQzRcdTFGQzYtXHUxRkNDXHUxRkQwLVx1MUZEM1x1MUZENi1cdTFGREJcdTFGRTAtXHUxRkVDXHUxRkYyLVx1MUZGNFx1MUZGNi1cdTFGRkNcdTIwNzFcdTIwN0ZcdTIwOTAtXHUyMDlDXHUyMTAyXHUyMTA3XHUyMTBBLVx1MjExM1x1MjExNVx1MjExOC1cdTIxMURcdTIxMjRcdTIxMjZcdTIxMjhcdTIxMkEtXHUyMTM5XHUyMTNDLVx1MjEzRlx1MjE0NS1cdTIxNDlcdTIxNEVcdTIxNjAtXHUyMTg4XHUyQzAwLVx1MkNFNFx1MkNFQi1cdTJDRUVcdTJDRjJcdTJDRjNcdTJEMDAtXHUyRDI1XHUyRDI3XHUyRDJEXHUyRDMwLVx1MkQ2N1x1MkQ2Rlx1MkQ4MC1cdTJEOTZcdTJEQTAtXHUyREE2XHUyREE4LVx1MkRBRVx1MkRCMC1cdTJEQjZcdTJEQjgtXHUyREJFXHUyREMwLVx1MkRDNlx1MkRDOC1cdTJEQ0VcdTJERDAtXHUyREQ2XHUyREQ4LVx1MkRERVx1MzAwNS1cdTMwMDdcdTMwMjEtXHUzMDI5XHUzMDMxLVx1MzAzNVx1MzAzOC1cdTMwM0NcdTMwNDEtXHUzMDk2XHUzMDlCLVx1MzA5Rlx1MzBBMS1cdTMwRkFcdTMwRkMtXHUzMEZGXHUzMTA1LVx1MzEyRlx1MzEzMS1cdTMxOEVcdTMxQTAtXHUzMUJGXHUzMUYwLVx1MzFGRlx1MzQwMC1cdTREQkZcdTRFMDAtXHVBNDhDXHVBNEQwLVx1QTRGRFx1QTUwMC1cdUE2MENcdUE2MTAtXHVBNjFGXHVBNjJBXHVBNjJCXHVBNjQwLVx1QTY2RVx1QTY3Ri1cdUE2OURcdUE2QTAtXHVBNkVGXHVBNzE3LVx1QTcxRlx1QTcyMi1cdUE3ODhcdUE3OEItXHVBN0NBXHVBN0QwXHVBN0QxXHVBN0QzXHVBN0Q1LVx1QTdEOVx1QTdGMi1cdUE4MDFcdUE4MDMtXHVBODA1XHVBODA3LVx1QTgwQVx1QTgwQy1cdUE4MjJcdUE4NDAtXHVBODczXHVBODgyLVx1QThCM1x1QThGMi1cdUE4RjdcdUE4RkJcdUE4RkRcdUE4RkVcdUE5MEEtXHVBOTI1XHVBOTMwLVx1QTk0Nlx1QTk2MC1cdUE5N0NcdUE5ODQtXHVBOUIyXHVBOUNGXHVBOUUwLVx1QTlFNFx1QTlFNi1cdUE5RUZcdUE5RkEtXHVBOUZFXHVBQTAwLVx1QUEyOFx1QUE0MC1cdUFBNDJcdUFBNDQtXHVBQTRCXHVBQTYwLVx1QUE3Nlx1QUE3QVx1QUE3RS1cdUFBQUZcdUFBQjFcdUFBQjVcdUFBQjZcdUFBQjktXHVBQUJEXHVBQUMwXHVBQUMyXHVBQURCLVx1QUFERFx1QUFFMC1cdUFBRUFcdUFBRjItXHVBQUY0XHVBQjAxLVx1QUIwNlx1QUIwOS1cdUFCMEVcdUFCMTEtXHVBQjE2XHVBQjIwLVx1QUIyNlx1QUIyOC1cdUFCMkVcdUFCMzAtXHVBQjVBXHVBQjVDLVx1QUI2OVx1QUI3MC1cdUFCRTJcdUFDMDAtXHVEN0EzXHVEN0IwLVx1RDdDNlx1RDdDQi1cdUQ3RkJcdUY5MDAtXHVGQTZEXHVGQTcwLVx1RkFEOVx1RkIwMC1cdUZCMDZcdUZCMTMtXHVGQjE3XHVGQjFEXHVGQjFGLVx1RkIyOFx1RkIyQS1cdUZCMzZcdUZCMzgtXHVGQjNDXHVGQjNFXHVGQjQwXHVGQjQxXHVGQjQzXHVGQjQ0XHVGQjQ2LVx1RkJCMVx1RkJEMy1cdUZEM0RcdUZENTAtXHVGRDhGXHVGRDkyLVx1RkRDN1x1RkRGMC1cdUZERkJcdUZFNzAtXHVGRTc0XHVGRTc2LVx1RkVGQ1x1RkYyMS1cdUZGM0FcdUZGNDEtXHVGRjVBXHVGRjY2LVx1RkZCRVx1RkZDMi1cdUZGQzdcdUZGQ0EtXHVGRkNGXHVGRkQyLVx1RkZEN1x1RkZEQS1cdUZGREMiLCBKYyA9ICJcdTIwMENcdTIwMERceEI3XHUwMzAwLVx1MDM2Rlx1MDM4N1x1MDQ4My1cdTA0ODdcdTA1OTEtXHUwNUJEXHUwNUJGXHUwNUMxXHUwNUMyXHUwNUM0XHUwNUM1XHUwNUM3XHUwNjEwLVx1MDYxQVx1MDY0Qi1cdTA2NjlcdTA2NzBcdTA2RDYtXHUwNkRDXHUwNkRGLVx1MDZFNFx1MDZFN1x1MDZFOFx1MDZFQS1cdTA2RURcdTA2RjAtXHUwNkY5XHUwNzExXHUwNzMwLVx1MDc0QVx1MDdBNi1cdTA3QjBcdTA3QzAtXHUwN0M5XHUwN0VCLVx1MDdGM1x1MDdGRFx1MDgxNi1cdTA4MTlcdTA4MUItXHUwODIzXHUwODI1LVx1MDgyN1x1MDgyOS1cdTA4MkRcdTA4NTktXHUwODVCXHUwODk4LVx1MDg5Rlx1MDhDQS1cdTA4RTFcdTA4RTMtXHUwOTAzXHUwOTNBLVx1MDkzQ1x1MDkzRS1cdTA5NEZcdTA5NTEtXHUwOTU3XHUwOTYyXHUwOTYzXHUwOTY2LVx1MDk2Rlx1MDk4MS1cdTA5ODNcdTA5QkNcdTA5QkUtXHUwOUM0XHUwOUM3XHUwOUM4XHUwOUNCLVx1MDlDRFx1MDlEN1x1MDlFMlx1MDlFM1x1MDlFNi1cdTA5RUZcdTA5RkVcdTBBMDEtXHUwQTAzXHUwQTNDXHUwQTNFLVx1MEE0Mlx1MEE0N1x1MEE0OFx1MEE0Qi1cdTBBNERcdTBBNTFcdTBBNjYtXHUwQTcxXHUwQTc1XHUwQTgxLVx1MEE4M1x1MEFCQ1x1MEFCRS1cdTBBQzVcdTBBQzctXHUwQUM5XHUwQUNCLVx1MEFDRFx1MEFFMlx1MEFFM1x1MEFFNi1cdTBBRUZcdTBBRkEtXHUwQUZGXHUwQjAxLVx1MEIwM1x1MEIzQ1x1MEIzRS1cdTBCNDRcdTBCNDdcdTBCNDhcdTBCNEItXHUwQjREXHUwQjU1LVx1MEI1N1x1MEI2Mlx1MEI2M1x1MEI2Ni1cdTBCNkZcdTBCODJcdTBCQkUtXHUwQkMyXHUwQkM2LVx1MEJDOFx1MEJDQS1cdTBCQ0RcdTBCRDdcdTBCRTYtXHUwQkVGXHUwQzAwLVx1MEMwNFx1MEMzQ1x1MEMzRS1cdTBDNDRcdTBDNDYtXHUwQzQ4XHUwQzRBLVx1MEM0RFx1MEM1NVx1MEM1Nlx1MEM2Mlx1MEM2M1x1MEM2Ni1cdTBDNkZcdTBDODEtXHUwQzgzXHUwQ0JDXHUwQ0JFLVx1MENDNFx1MENDNi1cdTBDQzhcdTBDQ0EtXHUwQ0NEXHUwQ0Q1XHUwQ0Q2XHUwQ0UyXHUwQ0UzXHUwQ0U2LVx1MENFRlx1MEQwMC1cdTBEMDNcdTBEM0JcdTBEM0NcdTBEM0UtXHUwRDQ0XHUwRDQ2LVx1MEQ0OFx1MEQ0QS1cdTBENERcdTBENTdcdTBENjJcdTBENjNcdTBENjYtXHUwRDZGXHUwRDgxLVx1MEQ4M1x1MERDQVx1MERDRi1cdTBERDRcdTBERDZcdTBERDgtXHUwRERGXHUwREU2LVx1MERFRlx1MERGMlx1MERGM1x1MEUzMVx1MEUzNC1cdTBFM0FcdTBFNDctXHUwRTRFXHUwRTUwLVx1MEU1OVx1MEVCMVx1MEVCNC1cdTBFQkNcdTBFQzgtXHUwRUNEXHUwRUQwLVx1MEVEOVx1MEYxOFx1MEYxOVx1MEYyMC1cdTBGMjlcdTBGMzVcdTBGMzdcdTBGMzlcdTBGM0VcdTBGM0ZcdTBGNzEtXHUwRjg0XHUwRjg2XHUwRjg3XHUwRjhELVx1MEY5N1x1MEY5OS1cdTBGQkNcdTBGQzZcdTEwMkItXHUxMDNFXHUxMDQwLVx1MTA0OVx1MTA1Ni1cdTEwNTlcdTEwNUUtXHUxMDYwXHUxMDYyLVx1MTA2NFx1MTA2Ny1cdTEwNkRcdTEwNzEtXHUxMDc0XHUxMDgyLVx1MTA4RFx1MTA4Ri1cdTEwOURcdTEzNUQtXHUxMzVGXHUxMzY5LVx1MTM3MVx1MTcxMi1cdTE3MTVcdTE3MzItXHUxNzM0XHUxNzUyXHUxNzUzXHUxNzcyXHUxNzczXHUxN0I0LVx1MTdEM1x1MTdERFx1MTdFMC1cdTE3RTlcdTE4MEItXHUxODBEXHUxODBGLVx1MTgxOVx1MThBOVx1MTkyMC1cdTE5MkJcdTE5MzAtXHUxOTNCXHUxOTQ2LVx1MTk0Rlx1MTlEMC1cdTE5REFcdTFBMTctXHUxQTFCXHUxQTU1LVx1MUE1RVx1MUE2MC1cdTFBN0NcdTFBN0YtXHUxQTg5XHUxQTkwLVx1MUE5OVx1MUFCMC1cdTFBQkRcdTFBQkYtXHUxQUNFXHUxQjAwLVx1MUIwNFx1MUIzNC1cdTFCNDRcdTFCNTAtXHUxQjU5XHUxQjZCLVx1MUI3M1x1MUI4MC1cdTFCODJcdTFCQTEtXHUxQkFEXHUxQkIwLVx1MUJCOVx1MUJFNi1cdTFCRjNcdTFDMjQtXHUxQzM3XHUxQzQwLVx1MUM0OVx1MUM1MC1cdTFDNTlcdTFDRDAtXHUxQ0QyXHUxQ0Q0LVx1MUNFOFx1MUNFRFx1MUNGNFx1MUNGNy1cdTFDRjlcdTFEQzAtXHUxREZGXHUyMDNGXHUyMDQwXHUyMDU0XHUyMEQwLVx1MjBEQ1x1MjBFMVx1MjBFNS1cdTIwRjBcdTJDRUYtXHUyQ0YxXHUyRDdGXHUyREUwLVx1MkRGRlx1MzAyQS1cdTMwMkZcdTMwOTlcdTMwOUFcdUE2MjAtXHVBNjI5XHVBNjZGXHVBNjc0LVx1QTY3RFx1QTY5RVx1QTY5Rlx1QTZGMFx1QTZGMVx1QTgwMlx1QTgwNlx1QTgwQlx1QTgyMy1cdUE4MjdcdUE4MkNcdUE4ODBcdUE4ODFcdUE4QjQtXHVBOEM1XHVBOEQwLVx1QThEOVx1QThFMC1cdUE4RjFcdUE4RkYtXHVBOTA5XHVBOTI2LVx1QTkyRFx1QTk0Ny1cdUE5NTNcdUE5ODAtXHVBOTgzXHVBOUIzLVx1QTlDMFx1QTlEMC1cdUE5RDlcdUE5RTVcdUE5RjAtXHVBOUY5XHVBQTI5LVx1QUEzNlx1QUE0M1x1QUE0Q1x1QUE0RFx1QUE1MC1cdUFBNTlcdUFBN0ItXHVBQTdEXHVBQUIwXHVBQUIyLVx1QUFCNFx1QUFCN1x1QUFCOFx1QUFCRVx1QUFCRlx1QUFDMVx1QUFFQi1cdUFBRUZcdUFBRjVcdUFBRjZcdUFCRTMtXHVBQkVBXHVBQkVDXHVBQkVEXHVBQkYwLVx1QUJGOVx1RkIxRVx1RkUwMC1cdUZFMEZcdUZFMjAtXHVGRTJGXHVGRTMzXHVGRTM0XHVGRTRELVx1RkU0Rlx1RkYxMC1cdUZGMTlcdUZGM0YiOwogICAgICAgIGNvbnN0ICRjID0gbmV3IFJlZ0V4cCgiWyIgKyBYYyArICJdIiksIFljID0gbmV3IFJlZ0V4cCgiWyIgKyBYYyArIEpjICsgIl0iKTsKICAgICAgICBYYyA9IEpjID0gbnVsbDsKICAgICAgICBjb25zdCBRYyA9IFswLCAxMSwgMiwgMjUsIDIsIDE4LCAyLCAxLCAyLCAxNCwgMywgMTMsIDM1LCAxMjIsIDcwLCA1MiwgMjY4LCAyOCwgNCwgNDgsIDQ4LCAzMSwgMTQsIDI5LCA2LCAzNywgMTEsIDI5LCAzLCAzNSwgNSwgNywgMiwgNCwgNDMsIDE1NywgMTksIDM1LCA1LCAzNSwgNSwgMzksIDksIDUxLCAxMywgMTAsIDIsIDE0LCAyLCA2LCAyLCAxLCAyLCAxMCwgMiwgMTQsIDIsIDYsIDIsIDEsIDY4LCAzMTAsIDEwLCAyMSwgMTEsIDcsIDI1LCA1LCAyLCA0MSwgMiwgOCwgNzAsIDUsIDMsIDAsIDIsIDQzLCAyLCAxLCA0LCAwLCAzLCAyMiwgMTEsIDIyLCAxMCwgMzAsIDY2LCAxOCwgMiwgMSwgMTEsIDIxLCAxMSwgMjUsIDcxLCA1NSwgNywgMSwgNjUsIDAsIDE2LCAzLCAyLCAyLCAyLCAyOCwgNDMsIDI4LCA0LCAyOCwgMzYsIDcsIDIsIDI3LCAyOCwgNTMsIDExLCAyMSwgMTEsIDE4LCAxNCwgMTcsIDExMSwgNzIsIDU2LCA1MCwgMTQsIDUwLCAxNCwgMzUsIDM0OSwgNDEsIDcsIDEsIDc5LCAyOCwgMTEsIDAsIDksIDIxLCA0MywgMTcsIDQ3LCAyMCwgMjgsIDIyLCAxMywgNTIsIDU4LCAxLCAzLCAwLCAxNCwgNDQsIDMzLCAyNCwgMjcsIDM1LCAzMCwgMCwgMywgMCwgOSwgMzQsIDQsIDAsIDEzLCA0NywgMTUsIDMsIDIyLCAwLCAyLCAwLCAzNiwgMTcsIDIsIDI0LCA4NSwgNiwgMiwgMCwgMiwgMywgMiwgMTQsIDIsIDksIDgsIDQ2LCAzOSwgNywgMywgMSwgMywgMjEsIDIsIDYsIDIsIDEsIDIsIDQsIDQsIDAsIDE5LCAwLCAxMywgNCwgMTU5LCA1MiwgMTksIDMsIDIxLCAyLCAzMSwgNDcsIDIxLCAxLCAyLCAwLCAxODUsIDQ2LCA0MiwgMywgMzcsIDQ3LCAyMSwgMCwgNjAsIDQyLCAxNCwgMCwgNzIsIDI2LCAzOCwgNiwgMTg2LCA0MywgMTE3LCA2MywgMzIsIDcsIDMsIDAsIDMsIDcsIDIsIDEsIDIsIDIzLCAxNiwgMCwgMiwgMCwgOTUsIDcsIDMsIDM4LCAxNywgMCwgMiwgMCwgMjksIDAsIDExLCAzOSwgOCwgMCwgMjIsIDAsIDEyLCA0NSwgMjAsIDAsIDE5LCA3MiwgMjY0LCA4LCAyLCAzNiwgMTgsIDAsIDUwLCAyOSwgMTEzLCA2LCAyLCAxLCAyLCAzNywgMjIsIDAsIDI2LCA1LCAyLCAxLCAyLCAzMSwgMTUsIDAsIDMyOCwgMTgsIDE5MCwgMCwgODAsIDkyMSwgMTAzLCAxMTAsIDE4LCAxOTUsIDI2MzcsIDk2LCAxNiwgMTA3MCwgNDA1MCwgNTgyLCA4NjM0LCA1NjgsIDgsIDMwLCAxOCwgNzgsIDE4LCAyOSwgMTksIDQ3LCAxNywgMywgMzIsIDIwLCA2LCAxOCwgNjg5LCA2MywgMTI5LCA3NCwgNiwgMCwgNjcsIDEyLCA2NSwgMSwgMiwgMCwgMjksIDYxMzUsIDksIDEyMzcsIDQzLCA4LCA4OTM2LCAzLCAyLCA2LCAyLCAxLCAyLCAyOTAsIDQ2LCAyLCAxOCwgMywgOSwgMzk1LCAyMzA5LCAxMDYsIDYsIDEyLCA0LCA4LCA4LCA5LCA1OTkxLCA4NCwgMiwgNzAsIDIsIDEsIDMsIDAsIDMsIDEsIDMsIDMsIDIsIDExLCAyLCAwLCAyLCA2LCAyLCA2NCwgMiwgMywgMywgNywgMiwgNiwgMiwgMjcsIDIsIDMsIDIsIDQsIDIsIDAsIDQsIDYsIDIsIDMzOSwgMywgMjQsIDIsIDI0LCAyLCAzMCwgMiwgMjQsIDIsIDMwLCAyLCAyNCwgMiwgMzAsIDIsIDI0LCAyLCAzMCwgMiwgMjQsIDIsIDcsIDE4NDUsIDMwLCA0ODIsIDQ0LCAxMSwgNiwgMTcsIDAsIDMyMiwgMjksIDE5LCA0MywgMTI2OSwgNiwgMiwgMywgMiwgMSwgMiwgMTQsIDIsIDE5NiwgNjAsIDY3LCA4LCAwLCAxMjA1LCAzLCAyLCAyNiwgMiwgMSwgMiwgMCwgMywgMCwgMiwgOSwgMiwgMywgMiwgMCwgMiwgMCwgNywgMCwgNSwgMCwgMiwgMCwgMiwgMCwgMiwgMiwgMiwgMSwgMiwgMCwgMywgMCwgMiwgMCwgMiwgMCwgMiwgMCwgMiwgMCwgMiwgMSwgMiwgMCwgMywgMywgMiwgNiwgMiwgMywgMiwgMywgMiwgMCwgMiwgOSwgMiwgMTYsIDYsIDIsIDIsIDQsIDIsIDE2LCA0NDIxLCA0MjcxOSwgMzMsIDQxNTIsIDgsIDIyMSwgMywgNTc2MSwgMTUsIDc0NzIsIDMxMDQsIDU0MSwgMTUwNywgNDkzOF0sIFpjID0gWzUwOSwgMCwgMjI3LCAwLCAxNTAsIDQsIDI5NCwgOSwgMTM2OCwgMiwgMiwgMSwgNiwgMywgNDEsIDIsIDUsIDAsIDE2NiwgMSwgNTc0LCAzLCA5LCA5LCAzNzAsIDEsIDE1NCwgMTAsIDUwLCAzLCAxMjMsIDIsIDU0LCAxNCwgMzIsIDEwLCAzLCAxLCAxMSwgMywgNDYsIDEwLCA4LCAwLCA0NiwgOSwgNywgMiwgMzcsIDEzLCAyLCA5LCA2LCAxLCA0NSwgMCwgMTMsIDIsIDQ5LCAxMywgOSwgMywgMiwgMTEsIDgzLCAxMSwgNywgMCwgMTYxLCAxMSwgNiwgOSwgNywgMywgNTYsIDEsIDIsIDYsIDMsIDEsIDMsIDIsIDEwLCAwLCAxMSwgMSwgMywgNiwgNCwgNCwgMTkzLCAxNywgMTAsIDksIDUsIDAsIDgyLCAxOSwgMTMsIDksIDIxNCwgNiwgMywgOCwgMjgsIDEsIDgzLCAxNiwgMTYsIDksIDgyLCAxMiwgOSwgOSwgODQsIDE0LCA1LCA5LCAyNDMsIDE0LCAxNjYsIDksIDcxLCA1LCAyLCAxLCAzLCAzLCAyLCAwLCAyLCAxLCAxMywgOSwgMTIwLCA2LCAzLCA2LCA0LCAwLCAyOSwgOSwgNDEsIDYsIDIsIDMsIDksIDAsIDEwLCAxMCwgNDcsIDE1LCA0MDYsIDcsIDIsIDcsIDE3LCA5LCA1NywgMjEsIDIsIDEzLCAxMjMsIDUsIDQsIDAsIDIsIDEsIDIsIDYsIDIsIDAsIDksIDksIDQ5LCA0LCAyLCAxLCAyLCA0LCA5LCA5LCAzMzAsIDMsIDE5MzA2LCA5LCA4NywgOSwgMzksIDQsIDYwLCA2LCAyNiwgOSwgMTAxNCwgMCwgMiwgNTQsIDgsIDMsIDgyLCAwLCAxMiwgMSwgMTk2MjgsIDEsIDQ3MDYsIDQ1LCAzLCAyMiwgNTQzLCA0LCA0LCA1LCA5LCA3LCAzLCA2LCAzMSwgMywgMTQ5LCAyLCAxNDE4LCA0OSwgNTEzLCA1NCwgNSwgNDksIDksIDAsIDE1LCAwLCAyMywgNCwgMiwgMTQsIDEzNjEsIDYsIDIsIDE2LCAzLCA2LCAyLCAxLCAyLCA0LCAyNjIsIDYsIDEwLCA5LCAzNTcsIDAsIDYyLCAxMywgMTQ5NSwgNiwgMTEwLCA2LCA2LCA5LCA0NzU5LCA5LCA3ODc3MTksIDIzOV07CiAgICAgICAgZnVuY3Rpb24gdGwodDIsIGUyKSB7CiAgICAgICAgICBsZXQgczIgPSA2NTUzNjsKICAgICAgICAgIGZvciAobGV0IHIyID0gMCwgaTIgPSBlMi5sZW5ndGg7IHIyIDwgaTI7IHIyICs9IDIpIHsKICAgICAgICAgICAgaWYgKHMyICs9IGUyW3IyXSwgczIgPiB0MikKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChzMiArPSBlMltyMiArIDFdLCBzMiA+PSB0MikKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZWwodDIpIHsKICAgICAgICAgIHJldHVybiB0MiA8IDY1ID8gdDIgPT09IDM2IDogdDIgPD0gOTAgfHwgKHQyIDwgOTcgPyB0MiA9PT0gOTUgOiB0MiA8PSAxMjIgfHwgKHQyIDw9IDY1NTM1ID8gdDIgPj0gMTcwICYmICRjLnRlc3QoU3RyaW5nLmZyb21DaGFyQ29kZSh0MikpIDogdGwodDIsIFFjKSkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzbCh0MikgewogICAgICAgICAgcmV0dXJuIHQyIDwgNDggPyB0MiA9PT0gMzYgOiB0MiA8IDU4IHx8ICEodDIgPCA2NSkgJiYgKHQyIDw9IDkwIHx8ICh0MiA8IDk3ID8gdDIgPT09IDk1IDogdDIgPD0gMTIyIHx8ICh0MiA8PSA2NTUzNSA/IHQyID49IDE3MCAmJiBZYy50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUodDIpKSA6IHRsKHQyLCBRYykgfHwgdGwodDIsIFpjKSkpKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcmwgPSBbImltcGxlbWVudHMiLCAiaW50ZXJmYWNlIiwgImxldCIsICJwYWNrYWdlIiwgInByaXZhdGUiLCAicHJvdGVjdGVkIiwgInB1YmxpYyIsICJzdGF0aWMiLCAieWllbGQiXSwgaWwgPSBbImV2YWwiLCAiYXJndW1lbnRzIl0sIG5sID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJicmVhayIsICJjYXNlIiwgImNhdGNoIiwgImNvbnRpbnVlIiwgImRlYnVnZ2VyIiwgImRlZmF1bHQiLCAiZG8iLCAiZWxzZSIsICJmaW5hbGx5IiwgImZvciIsICJmdW5jdGlvbiIsICJpZiIsICJyZXR1cm4iLCAic3dpdGNoIiwgInRocm93IiwgInRyeSIsICJ2YXIiLCAiY29uc3QiLCAid2hpbGUiLCAid2l0aCIsICJuZXciLCAidGhpcyIsICJzdXBlciIsICJjbGFzcyIsICJleHRlbmRzIiwgImV4cG9ydCIsICJpbXBvcnQiLCAibnVsbCIsICJ0cnVlIiwgImZhbHNlIiwgImluIiwgImluc3RhbmNlb2YiLCAidHlwZW9mIiwgInZvaWQiLCAiZGVsZXRlIl0pLCBhbCA9IG5ldyBTZXQocmwpLCBvbCA9IG5ldyBTZXQoaWwpOwogICAgICAgIGZ1bmN0aW9uIHVsKHQyLCBlMikgewogICAgICAgICAgcmV0dXJuIGUyICYmIHQyID09PSAiYXdhaXQiIHx8IHQyID09PSAiZW51bSI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGhsKHQyLCBlMikgewogICAgICAgICAgcmV0dXJuIHVsKHQyLCBlMikgfHwgYWwuaGFzKHQyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcGwodDIpIHsKICAgICAgICAgIHJldHVybiBvbC5oYXModDIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjbCh0MiwgZTIpIHsKICAgICAgICAgIHJldHVybiBobCh0MiwgZTIpIHx8IHBsKHQyKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbGwgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldChbImJyZWFrIiwgImNhc2UiLCAiY2F0Y2giLCAiY29udGludWUiLCAiZGVidWdnZXIiLCAiZGVmYXVsdCIsICJkbyIsICJlbHNlIiwgImZpbmFsbHkiLCAiZm9yIiwgImZ1bmN0aW9uIiwgImlmIiwgInJldHVybiIsICJzd2l0Y2giLCAidGhyb3ciLCAidHJ5IiwgInZhciIsICJjb25zdCIsICJ3aGlsZSIsICJ3aXRoIiwgIm5ldyIsICJ0aGlzIiwgInN1cGVyIiwgImNsYXNzIiwgImV4dGVuZHMiLCAiZXhwb3J0IiwgImltcG9ydCIsICJudWxsIiwgInRydWUiLCAiZmFsc2UiLCAiaW4iLCAiaW5zdGFuY2VvZiIsICJ0eXBlb2YiLCAidm9pZCIsICJkZWxldGUiLCAiaW1wbGVtZW50cyIsICJpbnRlcmZhY2UiLCAibGV0IiwgInBhY2thZ2UiLCAicHJpdmF0ZSIsICJwcm90ZWN0ZWQiLCAicHVibGljIiwgInN0YXRpYyIsICJ5aWVsZCIsICJldmFsIiwgImFyZ3VtZW50cyIsICJlbnVtIiwgImF3YWl0Il0pOwogICAgICAgIGNvbnN0IGRsID0gNjQsIERsID0gMjU2LCBtbCA9IDI1OSwgZmwgPSAxMjgsIHlsID0gMTAyNCwgRWwgPSAyMDQ4OwogICAgICAgIGNsYXNzIEFsIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKHQyKSB7CiAgICAgICAgICAgIHRoaXMudmFyID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKSwgdGhpcy5sZXhpY2FsID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKSwgdGhpcy5mdW5jdGlvbnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCB0aGlzLmZsYWdzID0gdDI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNsYXNzIENsIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKHQyLCBlMikgewogICAgICAgICAgICB0aGlzLnNjb3BlU3RhY2sgPSBbXSwgdGhpcy51bmRlZmluZWRFeHBvcnRzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSwgdGhpcy51bmRlZmluZWRQcml2YXRlTmFtZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLCB0aGlzLnJhaXNlID0gdDIsIHRoaXMuaW5Nb2R1bGUgPSBlMjsKICAgICAgICAgIH0KICAgICAgICAgIGdldCBpbkZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gKDIgJiB0aGlzLmN1cnJlbnRWYXJTY29wZUZsYWdzKCkpID4gMDsKICAgICAgICAgIH0KICAgICAgICAgIGdldCBhbGxvd1N1cGVyKCkgewogICAgICAgICAgICByZXR1cm4gKDE2ICYgdGhpcy5jdXJyZW50VGhpc1Njb3BlRmxhZ3MoKSkgPiAwOwogICAgICAgICAgfQogICAgICAgICAgZ2V0IGFsbG93RGlyZWN0U3VwZXIoKSB7CiAgICAgICAgICAgIHJldHVybiAoMzIgJiB0aGlzLmN1cnJlbnRUaGlzU2NvcGVGbGFncygpKSA+IDA7CiAgICAgICAgICB9CiAgICAgICAgICBnZXQgaW5DbGFzcygpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLmN1cnJlbnRUaGlzU2NvcGVGbGFncygpICYgZGwpID4gMDsKICAgICAgICAgIH0KICAgICAgICAgIGdldCBpbkNsYXNzQW5kTm90SW5Ob25BcnJvd0Z1bmN0aW9uKCkgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuY3VycmVudFRoaXNTY29wZUZsYWdzKCk7CiAgICAgICAgICAgIHJldHVybiAodDIgJiBkbCkgPiAwICYmICgyICYgdDIpID09IDA7CiAgICAgICAgICB9CiAgICAgICAgICBnZXQgaW5TdGF0aWNCbG9jaygpIHsKICAgICAgICAgICAgZm9yIChsZXQgdDIgPSB0aGlzLnNjb3BlU3RhY2subGVuZ3RoIC0gMTsgOyB0Mi0tKSB7CiAgICAgICAgICAgICAgY29uc3QgeyBmbGFnczogZTIgfSA9IHRoaXMuc2NvcGVTdGFja1t0Ml07CiAgICAgICAgICAgICAgaWYgKDEyOCAmIGUyKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgaWYgKDMyMyAmIGUyKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBnZXQgaW5Ob25BcnJvd0Z1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gKDIgJiB0aGlzLmN1cnJlbnRUaGlzU2NvcGVGbGFncygpKSA+IDA7CiAgICAgICAgICB9CiAgICAgICAgICBnZXQgdHJlYXRGdW5jdGlvbnNBc1ZhcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudHJlYXRGdW5jdGlvbnNBc1ZhckluU2NvcGUodGhpcy5jdXJyZW50U2NvcGUoKSk7CiAgICAgICAgICB9CiAgICAgICAgICBjcmVhdGVTY29wZSh0MikgewogICAgICAgICAgICByZXR1cm4gbmV3IEFsKHQyKTsKICAgICAgICAgIH0KICAgICAgICAgIGVudGVyKHQyKSB7CiAgICAgICAgICAgIHRoaXMuc2NvcGVTdGFjay5wdXNoKHRoaXMuY3JlYXRlU2NvcGUodDIpKTsKICAgICAgICAgIH0KICAgICAgICAgIGV4aXQoKSB7CiAgICAgICAgICAgIHRoaXMuc2NvcGVTdGFjay5wb3AoKTsKICAgICAgICAgIH0KICAgICAgICAgIHRyZWF0RnVuY3Rpb25zQXNWYXJJblNjb3BlKHQyKSB7CiAgICAgICAgICAgIHJldHVybiAhISgyICYgdDIuZmxhZ3MgfHwgIXRoaXMuaW5Nb2R1bGUgJiYgMSAmIHQyLmZsYWdzKTsKICAgICAgICAgIH0KICAgICAgICAgIGRlY2xhcmVOYW1lKHQyLCBlMiwgczIpIHsKICAgICAgICAgICAgbGV0IHIyID0gdGhpcy5jdXJyZW50U2NvcGUoKTsKICAgICAgICAgICAgaWYgKDggJiBlMiB8fCAxNiAmIGUyKQogICAgICAgICAgICAgIHRoaXMuY2hlY2tSZWRlY2xhcmF0aW9uSW5TY29wZShyMiwgdDIsIGUyLCBzMiksIDE2ICYgZTIgPyByMi5mdW5jdGlvbnMuYWRkKHQyKSA6IHIyLmxleGljYWwuYWRkKHQyKSwgOCAmIGUyICYmIHRoaXMubWF5YmVFeHBvcnREZWZpbmVkKHIyLCB0Mik7CiAgICAgICAgICAgIGVsc2UgaWYgKDQgJiBlMikKICAgICAgICAgICAgICBmb3IgKGxldCBpMiA9IHRoaXMuc2NvcGVTdGFjay5sZW5ndGggLSAxOyBpMiA+PSAwICYmIChyMiA9IHRoaXMuc2NvcGVTdGFja1tpMl0sIHRoaXMuY2hlY2tSZWRlY2xhcmF0aW9uSW5TY29wZShyMiwgdDIsIGUyLCBzMiksIHIyLnZhci5hZGQodDIpLCB0aGlzLm1heWJlRXhwb3J0RGVmaW5lZChyMiwgdDIpLCAhKHIyLmZsYWdzICYgbWwpKTsgLS1pMikKICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgdGhpcy5pbk1vZHVsZSAmJiAxICYgcjIuZmxhZ3MgJiYgdGhpcy51bmRlZmluZWRFeHBvcnRzLmRlbGV0ZSh0Mik7CiAgICAgICAgICB9CiAgICAgICAgICBtYXliZUV4cG9ydERlZmluZWQodDIsIGUyKSB7CiAgICAgICAgICAgIHRoaXMuaW5Nb2R1bGUgJiYgMSAmIHQyLmZsYWdzICYmIHRoaXMudW5kZWZpbmVkRXhwb3J0cy5kZWxldGUoZTIpOwogICAgICAgICAgfQogICAgICAgICAgY2hlY2tSZWRlY2xhcmF0aW9uSW5TY29wZSh0MiwgZTIsIHMyLCByMikgewogICAgICAgICAgICB0aGlzLmlzUmVkZWNsYXJlZEluU2NvcGUodDIsIGUyLCBzMikgJiYgdGhpcy5yYWlzZShyMiwgRGMuVmFyUmVkZWNsYXJhdGlvbiwgZTIpOwogICAgICAgICAgfQogICAgICAgICAgaXNSZWRlY2xhcmVkSW5TY29wZSh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIHJldHVybiAhISgxICYgczIpICYmICg4ICYgczIgPyB0Mi5sZXhpY2FsLmhhcyhlMikgfHwgdDIuZnVuY3Rpb25zLmhhcyhlMikgfHwgdDIudmFyLmhhcyhlMikgOiAxNiAmIHMyID8gdDIubGV4aWNhbC5oYXMoZTIpIHx8ICF0aGlzLnRyZWF0RnVuY3Rpb25zQXNWYXJJblNjb3BlKHQyKSAmJiB0Mi52YXIuaGFzKGUyKSA6IHQyLmxleGljYWwuaGFzKGUyKSAmJiAhKDggJiB0Mi5mbGFncyAmJiB0Mi5sZXhpY2FsLnZhbHVlcygpLm5leHQoKS52YWx1ZSA9PT0gZTIpIHx8ICF0aGlzLnRyZWF0RnVuY3Rpb25zQXNWYXJJblNjb3BlKHQyKSAmJiB0Mi5mdW5jdGlvbnMuaGFzKGUyKSk7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0xvY2FsRXhwb3J0KHQyKSB7CiAgICAgICAgICAgIGNvbnN0IHsgbmFtZTogZTIgfSA9IHQyLCBzMiA9IHRoaXMuc2NvcGVTdGFja1swXTsKICAgICAgICAgICAgczIubGV4aWNhbC5oYXMoZTIpIHx8IHMyLnZhci5oYXMoZTIpIHx8IHMyLmZ1bmN0aW9ucy5oYXMoZTIpIHx8IHRoaXMudW5kZWZpbmVkRXhwb3J0cy5zZXQoZTIsIHQyLnN0YXJ0KTsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnRTY29wZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NvcGVTdGFja1t0aGlzLnNjb3BlU3RhY2subGVuZ3RoIC0gMV07CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50VmFyU2NvcGVGbGFncygpIHsKICAgICAgICAgICAgZm9yIChsZXQgdDIgPSB0aGlzLnNjb3BlU3RhY2subGVuZ3RoIC0gMTsgOyB0Mi0tKSB7CiAgICAgICAgICAgICAgY29uc3QgeyBmbGFnczogZTIgfSA9IHRoaXMuc2NvcGVTdGFja1t0Ml07CiAgICAgICAgICAgICAgaWYgKGUyICYgbWwpCiAgICAgICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnRUaGlzU2NvcGVGbGFncygpIHsKICAgICAgICAgICAgZm9yIChsZXQgdDIgPSB0aGlzLnNjb3BlU3RhY2subGVuZ3RoIC0gMTsgOyB0Mi0tKSB7CiAgICAgICAgICAgICAgY29uc3QgeyBmbGFnczogZTIgfSA9IHRoaXMuc2NvcGVTdGFja1t0Ml07CiAgICAgICAgICAgICAgaWYgKDMyMyAmIGUyICYmICEoNCAmIGUyKSkKICAgICAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjbGFzcyB4bCBleHRlbmRzIEFsIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpLCB0aGlzLmRlY2xhcmVGdW5jdGlvbnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjbGFzcyBGbCBleHRlbmRzIENsIHsKICAgICAgICAgIGNyZWF0ZVNjb3BlKHQyKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgeGwodDIpOwogICAgICAgICAgfQogICAgICAgICAgZGVjbGFyZU5hbWUodDIsIGUyLCBzMikgewogICAgICAgICAgICBjb25zdCByMiA9IHRoaXMuY3VycmVudFNjb3BlKCk7CiAgICAgICAgICAgIGlmIChlMiAmIEVsKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoZWNrUmVkZWNsYXJhdGlvbkluU2NvcGUocjIsIHQyLCBlMiwgczIpLCB0aGlzLm1heWJlRXhwb3J0RGVmaW5lZChyMiwgdDIpLCB2b2lkIHIyLmRlY2xhcmVGdW5jdGlvbnMuYWRkKHQyKTsKICAgICAgICAgICAgc3VwZXIuZGVjbGFyZU5hbWUoLi4uYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIGlzUmVkZWNsYXJlZEluU2NvcGUodDIsIGUyLCBzMikgewogICAgICAgICAgICByZXR1cm4gISFzdXBlci5pc1JlZGVjbGFyZWRJblNjb3BlKC4uLmFyZ3VtZW50cykgfHwgISEoczIgJiBFbCkgJiYgKCF0Mi5kZWNsYXJlRnVuY3Rpb25zLmhhcyhlMikgJiYgKHQyLmxleGljYWwuaGFzKGUyKSB8fCB0Mi5mdW5jdGlvbnMuaGFzKGUyKSkpOwogICAgICAgICAgfQogICAgICAgICAgY2hlY2tMb2NhbEV4cG9ydCh0MikgewogICAgICAgICAgICB0aGlzLnNjb3BlU3RhY2tbMF0uZGVjbGFyZUZ1bmN0aW9ucy5oYXModDIubmFtZSkgfHwgc3VwZXIuY2hlY2tMb2NhbEV4cG9ydCh0Mik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNsYXNzIGdsIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICB0aGlzLnN0cmljdCA9IHZvaWQgMCwgdGhpcy5jdXJMaW5lID0gdm9pZCAwLCB0aGlzLmxpbmVTdGFydCA9IHZvaWQgMCwgdGhpcy5zdGFydExvYyA9IHZvaWQgMCwgdGhpcy5lbmRMb2MgPSB2b2lkIDAsIHRoaXMuZXJyb3JzID0gW10sIHRoaXMucG90ZW50aWFsQXJyb3dBdCA9IC0xLCB0aGlzLm5vQXJyb3dBdCA9IFtdLCB0aGlzLm5vQXJyb3dQYXJhbXNDb252ZXJzaW9uQXQgPSBbXSwgdGhpcy5tYXliZUluQXJyb3dQYXJhbWV0ZXJzID0gZmFsc2UsIHRoaXMuaW5UeXBlID0gZmFsc2UsIHRoaXMubm9Bbm9uRnVuY3Rpb25UeXBlID0gZmFsc2UsIHRoaXMuaGFzRmxvd0NvbW1lbnQgPSBmYWxzZSwgdGhpcy5pc0FtYmllbnRDb250ZXh0ID0gZmFsc2UsIHRoaXMuaW5BYnN0cmFjdENsYXNzID0gZmFsc2UsIHRoaXMudG9waWNDb250ZXh0ID0geyBtYXhOdW1PZlJlc29sdmFibGVUb3BpY3M6IDAsIG1heFRvcGljSW5kZXg6IG51bGwgfSwgdGhpcy5zb2xvQXdhaXQgPSBmYWxzZSwgdGhpcy5pbkZTaGFycFBpcGVsaW5lRGlyZWN0Qm9keSA9IGZhbHNlLCB0aGlzLmxhYmVscyA9IFtdLCB0aGlzLmRlY29yYXRvclN0YWNrID0gW1tdXSwgdGhpcy5jb21tZW50cyA9IFtdLCB0aGlzLmNvbW1lbnRTdGFjayA9IFtdLCB0aGlzLnBvcyA9IDAsIHRoaXMudHlwZSA9IDEyOSwgdGhpcy52YWx1ZSA9IG51bGwsIHRoaXMuc3RhcnQgPSAwLCB0aGlzLmVuZCA9IDAsIHRoaXMubGFzdFRva0VuZExvYyA9IG51bGwsIHRoaXMubGFzdFRva1N0YXJ0TG9jID0gbnVsbCwgdGhpcy5sYXN0VG9rU3RhcnQgPSAwLCB0aGlzLmxhc3RUb2tFbmQgPSAwLCB0aGlzLmNvbnRleHQgPSBbQWMuYnJhY2VdLCB0aGlzLmNhblN0YXJ0SlNYRWxlbWVudCA9IHRydWUsIHRoaXMuY29udGFpbnNFc2MgPSBmYWxzZSwgdGhpcy5zdHJpY3RFcnJvcnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLCB0aGlzLnRva2Vuc0xlbmd0aCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICBpbml0KHQyKSB7CiAgICAgICAgICAgIGxldCB7IHN0cmljdE1vZGU6IGUyLCBzb3VyY2VUeXBlOiBzMiwgc3RhcnRMaW5lOiByMiwgc3RhcnRDb2x1bW46IGkyIH0gPSB0MjsKICAgICAgICAgICAgdGhpcy5zdHJpY3QgPSBlMiAhPT0gZmFsc2UgJiYgKGUyID09PSB0cnVlIHx8IHMyID09PSAibW9kdWxlIiksIHRoaXMuY3VyTGluZSA9IHIyLCB0aGlzLmxpbmVTdGFydCA9IC1pMiwgdGhpcy5zdGFydExvYyA9IHRoaXMuZW5kTG9jID0gbmV3IHVjKHIyLCBpMik7CiAgICAgICAgICB9CiAgICAgICAgICBjdXJQb3NpdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyB1Yyh0aGlzLmN1ckxpbmUsIHRoaXMucG9zIC0gdGhpcy5saW5lU3RhcnQpOwogICAgICAgICAgfQogICAgICAgICAgY2xvbmUodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSBuZXcgZ2woKSwgczIgPSBPYmplY3Qua2V5cyh0aGlzKTsKICAgICAgICAgICAgZm9yIChsZXQgcjIgPSAwLCBpMiA9IHMyLmxlbmd0aDsgcjIgPCBpMjsgcjIrKykgewogICAgICAgICAgICAgIGNvbnN0IGkzID0gczJbcjJdOwogICAgICAgICAgICAgIGxldCBuMiA9IHRoaXNbaTNdOwogICAgICAgICAgICAgICF0MiAmJiBBcnJheS5pc0FycmF5KG4yKSAmJiAobjIgPSBuMi5zbGljZSgpKSwgZTJbaTNdID0gbjI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgUGwgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIHQyID49IDQ4ICYmIHQyIDw9IDU3OwogICAgICAgIH07CiAgICAgICAgY29uc3QgVGwgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldChbMTAzLCAxMDksIDExNSwgMTA1LCAxMjEsIDExNywgMTAwXSksIGJsID0geyBkZWNCaW5PY3Q6IFs0NiwgNjYsIDY5LCA3OSwgOTUsIDk4LCAxMDEsIDExMV0sIGhleDogWzQ2LCA4OCwgOTUsIDEyMF0gfSwgU2wgPSB7IGJpbjogWzQ4LCA0OV0gfTsKICAgICAgICBTbC5vY3QgPSBbLi4uU2wuYmluLCA1MCwgNTEsIDUyLCA1MywgNTQsIDU1XSwgU2wuZGVjID0gWy4uLlNsLm9jdCwgNTYsIDU3XSwgU2wuaGV4ID0gWy4uLlNsLmRlYywgNjUsIDY2LCA2NywgNjgsIDY5LCA3MCwgOTcsIDk4LCA5OSwgMTAwLCAxMDEsIDEwMl07CiAgICAgICAgY2xhc3Mgd2wgewogICAgICAgICAgY29uc3RydWN0b3IodDIpIHsKICAgICAgICAgICAgdGhpcy50eXBlID0gdDIudHlwZSwgdGhpcy52YWx1ZSA9IHQyLnZhbHVlLCB0aGlzLnN0YXJ0ID0gdDIuc3RhcnQsIHRoaXMuZW5kID0gdDIuZW5kLCB0aGlzLmxvYyA9IG5ldyBoYyh0Mi5zdGFydExvYywgdDIuZW5kTG9jKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2xhc3MgQmwgewogICAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHRoaXMucHJpdmF0ZU5hbWVzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKSwgdGhpcy5sb25lQWNjZXNzb3JzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSwgdGhpcy51bmRlZmluZWRQcml2YXRlTmFtZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjbGFzcyBObCB7CiAgICAgICAgICBjb25zdHJ1Y3Rvcih0MikgewogICAgICAgICAgICB0aGlzLnN0YWNrID0gW10sIHRoaXMudW5kZWZpbmVkUHJpdmF0ZU5hbWVzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSwgdGhpcy5yYWlzZSA9IHQyOwogICAgICAgICAgfQogICAgICAgICAgY3VycmVudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXTsKICAgICAgICAgIH0KICAgICAgICAgIGVudGVyKCkgewogICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2gobmV3IEJsKCkpOwogICAgICAgICAgfQogICAgICAgICAgZXhpdCgpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLnN0YWNrLnBvcCgpLCBlMiA9IHRoaXMuY3VycmVudCgpOwogICAgICAgICAgICBmb3IgKGNvbnN0IFtzMiwgcjJdIG9mIEFycmF5LmZyb20odDIudW5kZWZpbmVkUHJpdmF0ZU5hbWVzKSkKICAgICAgICAgICAgICBlMiA/IGUyLnVuZGVmaW5lZFByaXZhdGVOYW1lcy5oYXMoczIpIHx8IGUyLnVuZGVmaW5lZFByaXZhdGVOYW1lcy5zZXQoczIsIHIyKSA6IHRoaXMucmFpc2UocjIsIERjLkludmFsaWRQcml2YXRlRmllbGRSZXNvbHV0aW9uLCBzMik7CiAgICAgICAgICB9CiAgICAgICAgICBkZWNsYXJlUHJpdmF0ZU5hbWUodDIsIGUyLCBzMikgewogICAgICAgICAgICBjb25zdCByMiA9IHRoaXMuY3VycmVudCgpOwogICAgICAgICAgICBsZXQgaTIgPSByMi5wcml2YXRlTmFtZXMuaGFzKHQyKTsKICAgICAgICAgICAgaWYgKDMgJiBlMikgewogICAgICAgICAgICAgIGNvbnN0IHMzID0gaTIgJiYgcjIubG9uZUFjY2Vzc29ycy5nZXQodDIpOwogICAgICAgICAgICAgIGlmIChzMykgewogICAgICAgICAgICAgICAgY29uc3QgbjIgPSA0ICYgczMsIGEyID0gNCAmIGUyOwogICAgICAgICAgICAgICAgaTIgPSAoMyAmIHMzKSA9PT0gKDMgJiBlMikgfHwgbjIgIT09IGEyLCBpMiB8fCByMi5sb25lQWNjZXNzb3JzLmRlbGV0ZSh0Mik7CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBpMiB8fCByMi5sb25lQWNjZXNzb3JzLnNldCh0MiwgZTIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGkyICYmIHRoaXMucmFpc2UoczIsIERjLlByaXZhdGVOYW1lUmVkZWNsYXJhdGlvbiwgdDIpLCByMi5wcml2YXRlTmFtZXMuYWRkKHQyKSwgcjIudW5kZWZpbmVkUHJpdmF0ZU5hbWVzLmRlbGV0ZSh0Mik7CiAgICAgICAgICB9CiAgICAgICAgICB1c2VQcml2YXRlTmFtZSh0MiwgZTIpIHsKICAgICAgICAgICAgbGV0IHMyOwogICAgICAgICAgICBmb3IgKHMyIG9mIHRoaXMuc3RhY2spCiAgICAgICAgICAgICAgaWYgKHMyLnByaXZhdGVOYW1lcy5oYXModDIpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBzMiA/IHMyLnVuZGVmaW5lZFByaXZhdGVOYW1lcy5zZXQodDIsIGUyKSA6IHRoaXMucmFpc2UoZTIsIERjLkludmFsaWRQcml2YXRlRmllbGRSZXNvbHV0aW9uLCB0Mik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNsYXNzIElsIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICBsZXQgdDIgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1swXSA6IDA7CiAgICAgICAgICAgIHRoaXMudHlwZSA9IHZvaWQgMCwgdGhpcy50eXBlID0gdDI7CiAgICAgICAgICB9CiAgICAgICAgICBjYW5CZUFycm93UGFyYW1ldGVyRGVjbGFyYXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnR5cGUgPT09IDIgfHwgdGhpcy50eXBlID09PSAxOwogICAgICAgICAgfQogICAgICAgICAgaXNDZXJ0YWlubHlQYXJhbWV0ZXJEZWNsYXJhdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gMzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2xhc3MgdmwgZXh0ZW5kcyBJbCB7CiAgICAgICAgICBjb25zdHJ1Y3Rvcih0MikgewogICAgICAgICAgICBzdXBlcih0MiksIHRoaXMuZXJyb3JzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlY29yZERlY2xhcmF0aW9uRXJyb3IodDIsIGUyKSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3JzLnNldCh0MiwgZTIpOwogICAgICAgICAgfQogICAgICAgICAgY2xlYXJEZWNsYXJhdGlvbkVycm9yKHQyKSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3JzLmRlbGV0ZSh0Mik7CiAgICAgICAgICB9CiAgICAgICAgICBpdGVyYXRlRXJyb3JzKHQyKSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3JzLmZvckVhY2godDIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjbGFzcyBrbCB7CiAgICAgICAgICBjb25zdHJ1Y3Rvcih0MikgewogICAgICAgICAgICB0aGlzLnN0YWNrID0gW25ldyBJbCgpXSwgdGhpcy5yYWlzZSA9IHQyOwogICAgICAgICAgfQogICAgICAgICAgZW50ZXIodDIpIHsKICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKHQyKTsKICAgICAgICAgIH0KICAgICAgICAgIGV4aXQoKSB7CiAgICAgICAgICAgIHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgICByZWNvcmRQYXJhbWV0ZXJJbml0aWFsaXplckVycm9yKHQyLCBlMikgewogICAgICAgICAgICBjb25zdCB7IHN0YWNrOiBzMiB9ID0gdGhpczsKICAgICAgICAgICAgbGV0IHIyID0gczIubGVuZ3RoIC0gMSwgaTIgPSBzMltyMl07CiAgICAgICAgICAgIGZvciAoOyAhaTIuaXNDZXJ0YWlubHlQYXJhbWV0ZXJEZWNsYXJhdGlvbigpOyApIHsKICAgICAgICAgICAgICBpZiAoIWkyLmNhbkJlQXJyb3dQYXJhbWV0ZXJEZWNsYXJhdGlvbigpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIGkyLnJlY29yZERlY2xhcmF0aW9uRXJyb3IodDIsIGUyKSwgaTIgPSBzMlstLXIyXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnJhaXNlKHQyLCBlMik7CiAgICAgICAgICB9CiAgICAgICAgICByZWNvcmRQYXJlbnRoZXNpemVkSWRlbnRpZmllckVycm9yKHQyLCBlMikgewogICAgICAgICAgICBjb25zdCB7IHN0YWNrOiBzMiB9ID0gdGhpcywgcjIgPSBzMltzMi5sZW5ndGggLSAxXTsKICAgICAgICAgICAgaWYgKHIyLmlzQ2VydGFpbmx5UGFyYW1ldGVyRGVjbGFyYXRpb24oKSkKICAgICAgICAgICAgICB0aGlzLnJhaXNlKHQyLCBlMik7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGlmICghcjIuY2FuQmVBcnJvd1BhcmFtZXRlckRlY2xhcmF0aW9uKCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgcjIucmVjb3JkRGVjbGFyYXRpb25FcnJvcih0MiwgZTIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZWNvcmRBc3luY0Fycm93UGFyYW1ldGVyc0Vycm9yKHQyLCBlMikgewogICAgICAgICAgICBjb25zdCB7IHN0YWNrOiBzMiB9ID0gdGhpczsKICAgICAgICAgICAgbGV0IHIyID0gczIubGVuZ3RoIC0gMSwgaTIgPSBzMltyMl07CiAgICAgICAgICAgIGZvciAoOyBpMi5jYW5CZUFycm93UGFyYW1ldGVyRGVjbGFyYXRpb24oKTsgKQogICAgICAgICAgICAgIGkyLnR5cGUgPT09IDIgJiYgaTIucmVjb3JkRGVjbGFyYXRpb25FcnJvcih0MiwgZTIpLCBpMiA9IHMyWy0tcjJdOwogICAgICAgICAgfQogICAgICAgICAgdmFsaWRhdGVBc1BhdHRlcm4oKSB7CiAgICAgICAgICAgIGNvbnN0IHsgc3RhY2s6IHQyIH0gPSB0aGlzLCBlMiA9IHQyW3QyLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBlMi5jYW5CZUFycm93UGFyYW1ldGVyRGVjbGFyYXRpb24oKSAmJiBlMi5pdGVyYXRlRXJyb3JzKChlMywgczIpID0+IHsKICAgICAgICAgICAgICB0aGlzLnJhaXNlKHMyLCBlMyk7CiAgICAgICAgICAgICAgbGV0IHIyID0gdDIubGVuZ3RoIC0gMiwgaTIgPSB0MltyMl07CiAgICAgICAgICAgICAgZm9yICg7IGkyLmNhbkJlQXJyb3dQYXJhbWV0ZXJEZWNsYXJhdGlvbigpOyApCiAgICAgICAgICAgICAgICBpMi5jbGVhckRlY2xhcmF0aW9uRXJyb3IoczIpLCBpMiA9IHQyWy0tcjJdOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gTGwoKSB7CiAgICAgICAgICByZXR1cm4gbmV3IElsKCk7CiAgICAgICAgfQogICAgICAgIGNsYXNzIE9sIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICB0aGlzLnN0YWNrcyA9IFtdOwogICAgICAgICAgfQogICAgICAgICAgZW50ZXIodDIpIHsKICAgICAgICAgICAgdGhpcy5zdGFja3MucHVzaCh0Mik7CiAgICAgICAgICB9CiAgICAgICAgICBleGl0KCkgewogICAgICAgICAgICB0aGlzLnN0YWNrcy5wb3AoKTsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnRGbGFncygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhY2tzW3RoaXMuc3RhY2tzLmxlbmd0aCAtIDFdOwogICAgICAgICAgfQogICAgICAgICAgZ2V0IGhhc0F3YWl0KCkgewogICAgICAgICAgICByZXR1cm4gKDIgJiB0aGlzLmN1cnJlbnRGbGFncygpKSA+IDA7CiAgICAgICAgICB9CiAgICAgICAgICBnZXQgaGFzWWllbGQoKSB7CiAgICAgICAgICAgIHJldHVybiAoMSAmIHRoaXMuY3VycmVudEZsYWdzKCkpID4gMDsKICAgICAgICAgIH0KICAgICAgICAgIGdldCBoYXNSZXR1cm4oKSB7CiAgICAgICAgICAgIHJldHVybiAoNCAmIHRoaXMuY3VycmVudEZsYWdzKCkpID4gMDsKICAgICAgICAgIH0KICAgICAgICAgIGdldCBoYXNJbigpIHsKICAgICAgICAgICAgcmV0dXJuICg4ICYgdGhpcy5jdXJyZW50RmxhZ3MoKSkgPiAwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBNbCh0MiwgZTIpIHsKICAgICAgICAgIHJldHVybiAodDIgPyAyIDogMCkgfCAoZTIgPyAxIDogMCk7CiAgICAgICAgfQogICAgICAgIGNsYXNzIFJsIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICB0aGlzLnNob3J0aGFuZEFzc2lnbiA9IC0xLCB0aGlzLmRvdWJsZVByb3RvID0gLTEsIHRoaXMub3B0aW9uYWxQYXJhbWV0ZXJzID0gLTE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNsYXNzIGpsIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKHQyLCBlMiwgczIpIHsKICAgICAgICAgICAgdGhpcy50eXBlID0gIiIsIHRoaXMuc3RhcnQgPSBlMiwgdGhpcy5lbmQgPSAwLCB0aGlzLmxvYyA9IG5ldyBoYyhzMiksIHQyICE9IG51bGwgJiYgdDIub3B0aW9ucy5yYW5nZXMgJiYgKHRoaXMucmFuZ2UgPSBbZTIsIDBdKSwgdDIgIT0gbnVsbCAmJiB0Mi5maWxlbmFtZSAmJiAodGhpcy5sb2MuZmlsZW5hbWUgPSB0Mi5maWxlbmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IFVsID0gamwucHJvdG90eXBlOwogICAgICAgIGZ1bmN0aW9uIF9sKHQyKSB7CiAgICAgICAgICBjb25zdCB7IHR5cGU6IGUyLCBzdGFydDogczIsIGVuZDogcjIsIGxvYzogaTIsIHJhbmdlOiBuMiwgZXh0cmE6IGEyLCBuYW1lOiBvMiB9ID0gdDIsIHUyID0gT2JqZWN0LmNyZWF0ZShVbCk7CiAgICAgICAgICByZXR1cm4gdTIudHlwZSA9IGUyLCB1Mi5zdGFydCA9IHMyLCB1Mi5lbmQgPSByMiwgdTIubG9jID0gaTIsIHUyLnJhbmdlID0gbjIsIHUyLmV4dHJhID0gYTIsIHUyLm5hbWUgPSBvMiwgZTIgPT09ICJQbGFjZWhvbGRlciIgJiYgKHUyLmV4cGVjdGVkTm9kZSA9IHQyLmV4cGVjdGVkTm9kZSksIHUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB6bCh0MikgewogICAgICAgICAgY29uc3QgeyB0eXBlOiBlMiwgc3RhcnQ6IHMyLCBlbmQ6IHIyLCBsb2M6IGkyLCByYW5nZTogbjIsIGV4dHJhOiBhMiB9ID0gdDI7CiAgICAgICAgICBpZiAoZTIgPT09ICJQbGFjZWhvbGRlciIpCiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0MykgewogICAgICAgICAgICAgIHJldHVybiBfbCh0Myk7CiAgICAgICAgICAgIH0odDIpOwogICAgICAgICAgY29uc3QgbzIgPSBPYmplY3QuY3JlYXRlKFVsKTsKICAgICAgICAgIHJldHVybiBvMi50eXBlID0gIlN0cmluZ0xpdGVyYWwiLCBvMi5zdGFydCA9IHMyLCBvMi5lbmQgPSByMiwgbzIubG9jID0gaTIsIG8yLnJhbmdlID0gbjIsIG8yLmV4dHJhID0gYTIsIG8yLnZhbHVlID0gdDIudmFsdWUsIG8yOwogICAgICAgIH0KICAgICAgICBVbC5fX2Nsb25lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBjb25zdCB0MiA9IG5ldyBqbCgpLCBlMiA9IE9iamVjdC5rZXlzKHRoaXMpOwogICAgICAgICAgZm9yIChsZXQgczIgPSAwLCByMiA9IGUyLmxlbmd0aDsgczIgPCByMjsgczIrKykgewogICAgICAgICAgICBjb25zdCByMyA9IGUyW3MyXTsKICAgICAgICAgICAgcjMgIT09ICJsZWFkaW5nQ29tbWVudHMiICYmIHIzICE9PSAidHJhaWxpbmdDb21tZW50cyIgJiYgcjMgIT09ICJpbm5lckNvbW1lbnRzIiAmJiAodDJbcjNdID0gdGhpc1tyM10pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH07CiAgICAgICAgY29uc3QgSGwgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldChbIl8iLCAiYW55IiwgImJvb2wiLCAiYm9vbGVhbiIsICJlbXB0eSIsICJleHRlbmRzIiwgImZhbHNlIiwgImludGVyZmFjZSIsICJtaXhlZCIsICJudWxsIiwgIm51bWJlciIsICJzdGF0aWMiLCAic3RyaW5nIiwgInRydWUiLCAidHlwZW9mIiwgInZvaWQiXSksIFZsID0geWMoeyBBbWJpZ3VvdXNDb25kaXRpb25hbEFycm93OiAiQW1iaWd1b3VzIGV4cHJlc3Npb246IHdyYXAgdGhlIGFycm93IGZ1bmN0aW9ucyBpbiBwYXJlbnRoZXNlcyB0byBkaXNhbWJpZ3VhdGUuIiwgQW1iaWd1b3VzRGVjbGFyZU1vZHVsZUtpbmQ6ICJGb3VuZCBib3RoIGBkZWNsYXJlIG1vZHVsZS5leHBvcnRzYCBhbmQgYGRlY2xhcmUgZXhwb3J0YCBpbiB0aGUgc2FtZSBtb2R1bGUuIE1vZHVsZXMgY2FuIG9ubHkgaGF2ZSAxIHNpbmNlIHRoZXkgYXJlIGVpdGhlciBhbiBFUyBtb2R1bGUgb3IgdGhleSBhcmUgYSBDb21tb25KUyBtb2R1bGUuIiwgQXNzaWduUmVzZXJ2ZWRUeXBlOiAiQ2Fubm90IG92ZXJ3cml0ZSByZXNlcnZlZCB0eXBlICUwLiIsIERlY2xhcmVDbGFzc0VsZW1lbnQ6ICJUaGUgYGRlY2xhcmVgIG1vZGlmaWVyIGNhbiBvbmx5IGFwcGVhciBvbiBjbGFzcyBmaWVsZHMuIiwgRGVjbGFyZUNsYXNzRmllbGRJbml0aWFsaXplcjogIkluaXRpYWxpemVycyBhcmUgbm90IGFsbG93ZWQgaW4gZmllbGRzIHdpdGggdGhlIGBkZWNsYXJlYCBtb2RpZmllci4iLCBEdXBsaWNhdGVEZWNsYXJlTW9kdWxlRXhwb3J0czogIkR1cGxpY2F0ZSBgZGVjbGFyZSBtb2R1bGUuZXhwb3J0c2Agc3RhdGVtZW50LiIsIEVudW1Cb29sZWFuTWVtYmVyTm90SW5pdGlhbGl6ZWQ6ICJCb29sZWFuIGVudW0gbWVtYmVycyBuZWVkIHRvIGJlIGluaXRpYWxpemVkLiBVc2UgZWl0aGVyIGAlMCA9IHRydWUsYCBvciBgJTAgPSBmYWxzZSxgIGluIGVudW0gYCUxYC4iLCBFbnVtRHVwbGljYXRlTWVtYmVyTmFtZTogIkVudW0gbWVtYmVyIG5hbWVzIG5lZWQgdG8gYmUgdW5pcXVlLCBidXQgdGhlIG5hbWUgYCUwYCBoYXMgYWxyZWFkeSBiZWVuIHVzZWQgYmVmb3JlIGluIGVudW0gYCUxYC4iLCBFbnVtSW5jb25zaXN0ZW50TWVtYmVyVmFsdWVzOiAiRW51bSBgJTBgIGhhcyBpbmNvbnNpc3RlbnQgbWVtYmVyIGluaXRpYWxpemVycy4gRWl0aGVyIHVzZSBubyBpbml0aWFsaXplcnMsIG9yIGNvbnNpc3RlbnRseSB1c2UgbGl0ZXJhbHMgKGVpdGhlciBib29sZWFucywgbnVtYmVycywgb3Igc3RyaW5ncykgZm9yIGFsbCBtZW1iZXIgaW5pdGlhbGl6ZXJzLiIsIEVudW1JbnZhbGlkRXhwbGljaXRUeXBlOiAiRW51bSB0eXBlIGAlMWAgaXMgbm90IHZhbGlkLiBVc2Ugb25lIG9mIGBib29sZWFuYCwgYG51bWJlcmAsIGBzdHJpbmdgLCBvciBgc3ltYm9sYCBpbiBlbnVtIGAlMGAuIiwgRW51bUludmFsaWRFeHBsaWNpdFR5cGVVbmtub3duU3VwcGxpZWQ6ICJTdXBwbGllZCBlbnVtIHR5cGUgaXMgbm90IHZhbGlkLiBVc2Ugb25lIG9mIGBib29sZWFuYCwgYG51bWJlcmAsIGBzdHJpbmdgLCBvciBgc3ltYm9sYCBpbiBlbnVtIGAlMGAuIiwgRW51bUludmFsaWRNZW1iZXJJbml0aWFsaXplclByaW1hcnlUeXBlOiAiRW51bSBgJTBgIGhhcyB0eXBlIGAlMmAsIHNvIHRoZSBpbml0aWFsaXplciBvZiBgJTFgIG5lZWRzIHRvIGJlIGEgJTIgbGl0ZXJhbC4iLCBFbnVtSW52YWxpZE1lbWJlckluaXRpYWxpemVyU3ltYm9sVHlwZTogIlN5bWJvbCBlbnVtIG1lbWJlcnMgY2Fubm90IGJlIGluaXRpYWxpemVkLiBVc2UgYCUxLGAgaW4gZW51bSBgJTBgLiIsIEVudW1JbnZhbGlkTWVtYmVySW5pdGlhbGl6ZXJVbmtub3duVHlwZTogIlRoZSBlbnVtIG1lbWJlciBpbml0aWFsaXplciBmb3IgYCUxYCBuZWVkcyB0byBiZSBhIGxpdGVyYWwgKGVpdGhlciBhIGJvb2xlYW4sIG51bWJlciwgb3Igc3RyaW5nKSBpbiBlbnVtIGAlMGAuIiwgRW51bUludmFsaWRNZW1iZXJOYW1lOiAiRW51bSBtZW1iZXIgbmFtZXMgY2Fubm90IHN0YXJ0IHdpdGggbG93ZXJjYXNlICdhJyB0aHJvdWdoICd6Jy4gSW5zdGVhZCBvZiB1c2luZyBgJTBgLCBjb25zaWRlciB1c2luZyBgJTFgLCBpbiBlbnVtIGAlMmAuIiwgRW51bU51bWJlck1lbWJlck5vdEluaXRpYWxpemVkOiAiTnVtYmVyIGVudW0gbWVtYmVycyBuZWVkIHRvIGJlIGluaXRpYWxpemVkLCBlLmcuIGAlMSA9IDFgIGluIGVudW0gYCUwYC4iLCBFbnVtU3RyaW5nTWVtYmVySW5jb25zaXN0ZW50bHlJbml0YWlsaXplZDogIlN0cmluZyBlbnVtIG1lbWJlcnMgbmVlZCB0byBjb25zaXN0ZW50bHkgZWl0aGVyIGFsbCB1c2UgaW5pdGlhbGl6ZXJzLCBvciB1c2Ugbm8gaW5pdGlhbGl6ZXJzLCBpbiBlbnVtIGAlMGAuIiwgR2V0dGVyTWF5Tm90SGF2ZVRoaXNQYXJhbTogIkEgZ2V0dGVyIGNhbm5vdCBoYXZlIGEgYHRoaXNgIHBhcmFtZXRlci4iLCBJbXBvcnRUeXBlU2hvcnRoYW5kT25seUluUHVyZUltcG9ydDogIlRoZSBgdHlwZWAgYW5kIGB0eXBlb2ZgIGtleXdvcmRzIG9uIG5hbWVkIGltcG9ydHMgY2FuIG9ubHkgYmUgdXNlZCBvbiByZWd1bGFyIGBpbXBvcnRgIHN0YXRlbWVudHMuIEl0IGNhbm5vdCBiZSB1c2VkIHdpdGggYGltcG9ydCB0eXBlYCBvciBgaW1wb3J0IHR5cGVvZmAgc3RhdGVtZW50cy4iLCBJbmV4YWN0SW5zaWRlRXhhY3Q6ICJFeHBsaWNpdCBpbmV4YWN0IHN5bnRheCBjYW5ub3QgYXBwZWFyIGluc2lkZSBhbiBleHBsaWNpdCBleGFjdCBvYmplY3QgdHlwZS4iLCBJbmV4YWN0SW5zaWRlTm9uT2JqZWN0OiAiRXhwbGljaXQgaW5leGFjdCBzeW50YXggY2Fubm90IGFwcGVhciBpbiBjbGFzcyBvciBpbnRlcmZhY2UgZGVmaW5pdGlvbnMuIiwgSW5leGFjdFZhcmlhbmNlOiAiRXhwbGljaXQgaW5leGFjdCBzeW50YXggY2Fubm90IGhhdmUgdmFyaWFuY2UuIiwgSW52YWxpZE5vblR5cGVJbXBvcnRJbkRlY2xhcmVNb2R1bGU6ICJJbXBvcnRzIHdpdGhpbiBhIGBkZWNsYXJlIG1vZHVsZWAgYm9keSBtdXN0IGFsd2F5cyBiZSBgaW1wb3J0IHR5cGVgIG9yIGBpbXBvcnQgdHlwZW9mYC4iLCBNaXNzaW5nVHlwZVBhcmFtRGVmYXVsdDogIlR5cGUgcGFyYW1ldGVyIGRlY2xhcmF0aW9uIG5lZWRzIGEgZGVmYXVsdCwgc2luY2UgYSBwcmVjZWRpbmcgdHlwZSBwYXJhbWV0ZXIgZGVjbGFyYXRpb24gaGFzIGEgZGVmYXVsdC4iLCBOZXN0ZWREZWNsYXJlTW9kdWxlOiAiYGRlY2xhcmUgbW9kdWxlYCBjYW5ub3QgYmUgdXNlZCBpbnNpZGUgYW5vdGhlciBgZGVjbGFyZSBtb2R1bGVgLiIsIE5lc3RlZEZsb3dDb21tZW50OiAiQ2Fubm90IGhhdmUgYSBmbG93IGNvbW1lbnQgaW5zaWRlIGFub3RoZXIgZmxvdyBjb21tZW50LiIsIFBhdHRlcm5Jc09wdGlvbmFsOiAiQSBiaW5kaW5nIHBhdHRlcm4gcGFyYW1ldGVyIGNhbm5vdCBiZSBvcHRpb25hbCBpbiBhbiBpbXBsZW1lbnRhdGlvbiBzaWduYXR1cmUuIiwgU2V0dGVyTWF5Tm90SGF2ZVRoaXNQYXJhbTogIkEgc2V0dGVyIGNhbm5vdCBoYXZlIGEgYHRoaXNgIHBhcmFtZXRlci4iLCBTcHJlYWRWYXJpYW5jZTogIlNwcmVhZCBwcm9wZXJ0aWVzIGNhbm5vdCBoYXZlIHZhcmlhbmNlLiIsIFRoaXNQYXJhbUFubm90YXRpb25SZXF1aXJlZDogIkEgdHlwZSBhbm5vdGF0aW9uIGlzIHJlcXVpcmVkIGZvciB0aGUgYHRoaXNgIHBhcmFtZXRlci4iLCBUaGlzUGFyYW1CYW5uZWRJbkNvbnN0cnVjdG9yOiAiQ29uc3RydWN0b3JzIGNhbm5vdCBoYXZlIGEgYHRoaXNgIHBhcmFtZXRlcjsgY29uc3RydWN0b3JzIGRvbid0IGJpbmQgYHRoaXNgIGxpa2Ugb3RoZXIgZnVuY3Rpb25zLiIsIFRoaXNQYXJhbU1heU5vdEJlT3B0aW9uYWw6ICJUaGUgYHRoaXNgIHBhcmFtZXRlciBjYW5ub3QgYmUgb3B0aW9uYWwuIiwgVGhpc1BhcmFtTXVzdEJlRmlyc3Q6ICJUaGUgYHRoaXNgIHBhcmFtZXRlciBtdXN0IGJlIHRoZSBmaXJzdCBmdW5jdGlvbiBwYXJhbWV0ZXIuIiwgVGhpc1BhcmFtTm9EZWZhdWx0OiAiVGhlIGB0aGlzYCBwYXJhbWV0ZXIgbWF5IG5vdCBoYXZlIGEgZGVmYXVsdCB2YWx1ZS4iLCBUeXBlQmVmb3JlSW5pdGlhbGl6ZXI6ICJUeXBlIGFubm90YXRpb25zIG11c3QgY29tZSBiZWZvcmUgZGVmYXVsdCBhc3NpZ25tZW50cywgZS5nLiBpbnN0ZWFkIG9mIGBhZ2UgPSAyNTogbnVtYmVyYCB1c2UgYGFnZTogbnVtYmVyID0gMjVgLiIsIFR5cGVDYXN0SW5QYXR0ZXJuOiAiVGhlIHR5cGUgY2FzdCBleHByZXNzaW9uIGlzIGV4cGVjdGVkIHRvIGJlIHdyYXBwZWQgd2l0aCBwYXJlbnRoZXNpcy4iLCBVbmV4cGVjdGVkRXhwbGljaXRJbmV4YWN0SW5PYmplY3Q6ICJFeHBsaWNpdCBpbmV4YWN0IHN5bnRheCBtdXN0IGFwcGVhciBhdCB0aGUgZW5kIG9mIGFuIGluZXhhY3Qgb2JqZWN0LiIsIFVuZXhwZWN0ZWRSZXNlcnZlZFR5cGU6ICJVbmV4cGVjdGVkIHJlc2VydmVkIHR5cGUgJTAuIiwgVW5leHBlY3RlZFJlc2VydmVkVW5kZXJzY29yZTogImBfYCBpcyBvbmx5IGFsbG93ZWQgYXMgYSB0eXBlIGFyZ3VtZW50IHRvIGNhbGwgb3IgbmV3LiIsIFVuZXhwZWN0ZWRTcGFjZUJldHdlZW5Nb2R1bG9DaGVja3M6ICJTcGFjZXMgYmV0d2VlbiBgJWAgYW5kIGBjaGVja3NgIGFyZSBub3QgYWxsb3dlZCBoZXJlLiIsIFVuZXhwZWN0ZWRTcHJlYWRUeXBlOiAiU3ByZWFkIG9wZXJhdG9yIGNhbm5vdCBhcHBlYXIgaW4gY2xhc3Mgb3IgaW50ZXJmYWNlIGRlZmluaXRpb25zLiIsIFVuZXhwZWN0ZWRTdWJ0cmFjdGlvbk9wZXJhbmQ6ICdVbmV4cGVjdGVkIHRva2VuLCBleHBlY3RlZCAibnVtYmVyIiBvciAiYmlnaW50Ii4nLCBVbmV4cGVjdGVkVG9rZW5BZnRlclR5cGVQYXJhbWV0ZXI6ICJFeHBlY3RlZCBhbiBhcnJvdyBmdW5jdGlvbiBhZnRlciB0aGlzIHR5cGUgcGFyYW1ldGVyIGRlY2xhcmF0aW9uLiIsIFVuZXhwZWN0ZWRUeXBlUGFyYW1ldGVyQmVmb3JlQXN5bmNBcnJvd0Z1bmN0aW9uOiAiVHlwZSBwYXJhbWV0ZXJzIG11c3QgY29tZSBhZnRlciB0aGUgYXN5bmMga2V5d29yZCwgZS5nLiBpbnN0ZWFkIG9mIGA8VD4gYXN5bmMgKCkgPT4ge31gLCB1c2UgYGFzeW5jIDxUPigpID0+IHt9YC4iLCBVbnN1cHBvcnRlZERlY2xhcmVFeHBvcnRLaW5kOiAiYGRlY2xhcmUgZXhwb3J0ICUwYCBpcyBub3Qgc3VwcG9ydGVkLiBVc2UgYCUxYCBpbnN0ZWFkLiIsIFVuc3VwcG9ydGVkU3RhdGVtZW50SW5EZWNsYXJlTW9kdWxlOiAiT25seSBkZWNsYXJlcyBhbmQgdHlwZSBpbXBvcnRzIGFyZSBhbGxvd2VkIGluc2lkZSBkZWNsYXJlIG1vZHVsZS4iLCBVbnRlcm1pbmF0ZWRGbG93Q29tbWVudDogIlVudGVybWluYXRlZCBmbG93LWNvbW1lbnQuIiB9LCBkYy5TeW50YXhFcnJvciwgImZsb3ciKTsKICAgICAgICBmdW5jdGlvbiBxbCh0MikgewogICAgICAgICAgcmV0dXJuIHQyLmltcG9ydEtpbmQgPT09ICJ0eXBlIiB8fCB0Mi5pbXBvcnRLaW5kID09PSAidHlwZW9mIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gV2wodDIpIHsKICAgICAgICAgIHJldHVybiBfYyh0MikgJiYgdDIgIT09IDkxOwogICAgICAgIH0KICAgICAgICBjb25zdCBLbCA9IHsgY29uc3Q6ICJkZWNsYXJlIGV4cG9ydCB2YXIiLCBsZXQ6ICJkZWNsYXJlIGV4cG9ydCB2YXIiLCB0eXBlOiAiZXhwb3J0IHR5cGUiLCBpbnRlcmZhY2U6ICJleHBvcnQgaW50ZXJmYWNlIiB9OwogICAgICAgIGNvbnN0IEdsID0gL1wqP1xzKkAoKD86bm8pP2Zsb3cpXGIvOwogICAgICAgIGNvbnN0IFhsID0geyBxdW90OiAnIicsIGFtcDogIiYiLCBhcG9zOiAiJyIsIGx0OiAiPCIsIGd0OiAiPiIsIG5ic3A6ICJceEEwIiwgaWV4Y2w6ICJceEExIiwgY2VudDogIlx4QTIiLCBwb3VuZDogIlx4QTMiLCBjdXJyZW46ICJceEE0IiwgeWVuOiAiXHhBNSIsIGJydmJhcjogIlx4QTYiLCBzZWN0OiAiXHhBNyIsIHVtbDogIlx4QTgiLCBjb3B5OiAiXHhBOSIsIG9yZGY6ICJceEFBIiwgbGFxdW86ICJceEFCIiwgbm90OiAiXHhBQyIsIHNoeTogIlx4QUQiLCByZWc6ICJceEFFIiwgbWFjcjogIlx4QUYiLCBkZWc6ICJceEIwIiwgcGx1c21uOiAiXHhCMSIsIHN1cDI6ICJceEIyIiwgc3VwMzogIlx4QjMiLCBhY3V0ZTogIlx4QjQiLCBtaWNybzogIlx4QjUiLCBwYXJhOiAiXHhCNiIsIG1pZGRvdDogIlx4QjciLCBjZWRpbDogIlx4QjgiLCBzdXAxOiAiXHhCOSIsIG9yZG06ICJceEJBIiwgcmFxdW86ICJceEJCIiwgZnJhYzE0OiAiXHhCQyIsIGZyYWMxMjogIlx4QkQiLCBmcmFjMzQ6ICJceEJFIiwgaXF1ZXN0OiAiXHhCRiIsIEFncmF2ZTogIlx4QzAiLCBBYWN1dGU6ICJceEMxIiwgQWNpcmM6ICJceEMyIiwgQXRpbGRlOiAiXHhDMyIsIEF1bWw6ICJceEM0IiwgQXJpbmc6ICJceEM1IiwgQUVsaWc6ICJceEM2IiwgQ2NlZGlsOiAiXHhDNyIsIEVncmF2ZTogIlx4QzgiLCBFYWN1dGU6ICJceEM5IiwgRWNpcmM6ICJceENBIiwgRXVtbDogIlx4Q0IiLCBJZ3JhdmU6ICJceENDIiwgSWFjdXRlOiAiXHhDRCIsIEljaXJjOiAiXHhDRSIsIEl1bWw6ICJceENGIiwgRVRIOiAiXHhEMCIsIE50aWxkZTogIlx4RDEiLCBPZ3JhdmU6ICJceEQyIiwgT2FjdXRlOiAiXHhEMyIsIE9jaXJjOiAiXHhENCIsIE90aWxkZTogIlx4RDUiLCBPdW1sOiAiXHhENiIsIHRpbWVzOiAiXHhENyIsIE9zbGFzaDogIlx4RDgiLCBVZ3JhdmU6ICJceEQ5IiwgVWFjdXRlOiAiXHhEQSIsIFVjaXJjOiAiXHhEQiIsIFV1bWw6ICJceERDIiwgWWFjdXRlOiAiXHhERCIsIFRIT1JOOiAiXHhERSIsIHN6bGlnOiAiXHhERiIsIGFncmF2ZTogIlx4RTAiLCBhYWN1dGU6ICJceEUxIiwgYWNpcmM6ICJceEUyIiwgYXRpbGRlOiAiXHhFMyIsIGF1bWw6ICJceEU0IiwgYXJpbmc6ICJceEU1IiwgYWVsaWc6ICJceEU2IiwgY2NlZGlsOiAiXHhFNyIsIGVncmF2ZTogIlx4RTgiLCBlYWN1dGU6ICJceEU5IiwgZWNpcmM6ICJceEVBIiwgZXVtbDogIlx4RUIiLCBpZ3JhdmU6ICJceEVDIiwgaWFjdXRlOiAiXHhFRCIsIGljaXJjOiAiXHhFRSIsIGl1bWw6ICJceEVGIiwgZXRoOiAiXHhGMCIsIG50aWxkZTogIlx4RjEiLCBvZ3JhdmU6ICJceEYyIiwgb2FjdXRlOiAiXHhGMyIsIG9jaXJjOiAiXHhGNCIsIG90aWxkZTogIlx4RjUiLCBvdW1sOiAiXHhGNiIsIGRpdmlkZTogIlx4RjciLCBvc2xhc2g6ICJceEY4IiwgdWdyYXZlOiAiXHhGOSIsIHVhY3V0ZTogIlx4RkEiLCB1Y2lyYzogIlx4RkIiLCB1dW1sOiAiXHhGQyIsIHlhY3V0ZTogIlx4RkQiLCB0aG9ybjogIlx4RkUiLCB5dW1sOiAiXHhGRiIsIE9FbGlnOiAiXHUwMTUyIiwgb2VsaWc6ICJcdTAxNTMiLCBTY2Fyb246ICJcdTAxNjAiLCBzY2Fyb246ICJcdTAxNjEiLCBZdW1sOiAiXHUwMTc4IiwgZm5vZjogIlx1MDE5MiIsIGNpcmM6ICJcdTAyQzYiLCB0aWxkZTogIlx1MDJEQyIsIEFscGhhOiAiXHUwMzkxIiwgQmV0YTogIlx1MDM5MiIsIEdhbW1hOiAiXHUwMzkzIiwgRGVsdGE6ICJcdTAzOTQiLCBFcHNpbG9uOiAiXHUwMzk1IiwgWmV0YTogIlx1MDM5NiIsIEV0YTogIlx1MDM5NyIsIFRoZXRhOiAiXHUwMzk4IiwgSW90YTogIlx1MDM5OSIsIEthcHBhOiAiXHUwMzlBIiwgTGFtYmRhOiAiXHUwMzlCIiwgTXU6ICJcdTAzOUMiLCBOdTogIlx1MDM5RCIsIFhpOiAiXHUwMzlFIiwgT21pY3JvbjogIlx1MDM5RiIsIFBpOiAiXHUwM0EwIiwgUmhvOiAiXHUwM0ExIiwgU2lnbWE6ICJcdTAzQTMiLCBUYXU6ICJcdTAzQTQiLCBVcHNpbG9uOiAiXHUwM0E1IiwgUGhpOiAiXHUwM0E2IiwgQ2hpOiAiXHUwM0E3IiwgUHNpOiAiXHUwM0E4IiwgT21lZ2E6ICJcdTAzQTkiLCBhbHBoYTogIlx1MDNCMSIsIGJldGE6ICJcdTAzQjIiLCBnYW1tYTogIlx1MDNCMyIsIGRlbHRhOiAiXHUwM0I0IiwgZXBzaWxvbjogIlx1MDNCNSIsIHpldGE6ICJcdTAzQjYiLCBldGE6ICJcdTAzQjciLCB0aGV0YTogIlx1MDNCOCIsIGlvdGE6ICJcdTAzQjkiLCBrYXBwYTogIlx1MDNCQSIsIGxhbWJkYTogIlx1MDNCQiIsIG11OiAiXHUwM0JDIiwgbnU6ICJcdTAzQkQiLCB4aTogIlx1MDNCRSIsIG9taWNyb246ICJcdTAzQkYiLCBwaTogIlx1MDNDMCIsIHJobzogIlx1MDNDMSIsIHNpZ21hZjogIlx1MDNDMiIsIHNpZ21hOiAiXHUwM0MzIiwgdGF1OiAiXHUwM0M0IiwgdXBzaWxvbjogIlx1MDNDNSIsIHBoaTogIlx1MDNDNiIsIGNoaTogIlx1MDNDNyIsIHBzaTogIlx1MDNDOCIsIG9tZWdhOiAiXHUwM0M5IiwgdGhldGFzeW06ICJcdTAzRDEiLCB1cHNpaDogIlx1MDNEMiIsIHBpdjogIlx1MDNENiIsIGVuc3A6ICJcdTIwMDIiLCBlbXNwOiAiXHUyMDAzIiwgdGhpbnNwOiAiXHUyMDA5IiwgenduajogIlx1MjAwQyIsIHp3ajogIlx1MjAwRCIsIGxybTogIlx1MjAwRSIsIHJsbTogIlx1MjAwRiIsIG5kYXNoOiAiXHUyMDEzIiwgbWRhc2g6ICJcdTIwMTQiLCBsc3F1bzogIlx1MjAxOCIsIHJzcXVvOiAiXHUyMDE5Iiwgc2JxdW86ICJcdTIwMUEiLCBsZHF1bzogIlx1MjAxQyIsIHJkcXVvOiAiXHUyMDFEIiwgYmRxdW86ICJcdTIwMUUiLCBkYWdnZXI6ICJcdTIwMjAiLCBEYWdnZXI6ICJcdTIwMjEiLCBidWxsOiAiXHUyMDIyIiwgaGVsbGlwOiAiXHUyMDI2IiwgcGVybWlsOiAiXHUyMDMwIiwgcHJpbWU6ICJcdTIwMzIiLCBQcmltZTogIlx1MjAzMyIsIGxzYXF1bzogIlx1MjAzOSIsIHJzYXF1bzogIlx1MjAzQSIsIG9saW5lOiAiXHUyMDNFIiwgZnJhc2w6ICJcdTIwNDQiLCBldXJvOiAiXHUyMEFDIiwgaW1hZ2U6ICJcdTIxMTEiLCB3ZWllcnA6ICJcdTIxMTgiLCByZWFsOiAiXHUyMTFDIiwgdHJhZGU6ICJcdTIxMjIiLCBhbGVmc3ltOiAiXHUyMTM1IiwgbGFycjogIlx1MjE5MCIsIHVhcnI6ICJcdTIxOTEiLCByYXJyOiAiXHUyMTkyIiwgZGFycjogIlx1MjE5MyIsIGhhcnI6ICJcdTIxOTQiLCBjcmFycjogIlx1MjFCNSIsIGxBcnI6ICJcdTIxRDAiLCB1QXJyOiAiXHUyMUQxIiwgckFycjogIlx1MjFEMiIsIGRBcnI6ICJcdTIxRDMiLCBoQXJyOiAiXHUyMUQ0IiwgZm9yYWxsOiAiXHUyMjAwIiwgcGFydDogIlx1MjIwMiIsIGV4aXN0OiAiXHUyMjAzIiwgZW1wdHk6ICJcdTIyMDUiLCBuYWJsYTogIlx1MjIwNyIsIGlzaW46ICJcdTIyMDgiLCBub3RpbjogIlx1MjIwOSIsIG5pOiAiXHUyMjBCIiwgcHJvZDogIlx1MjIwRiIsIHN1bTogIlx1MjIxMSIsIG1pbnVzOiAiXHUyMjEyIiwgbG93YXN0OiAiXHUyMjE3IiwgcmFkaWM6ICJcdTIyMUEiLCBwcm9wOiAiXHUyMjFEIiwgaW5maW46ICJcdTIyMUUiLCBhbmc6ICJcdTIyMjAiLCBhbmQ6ICJcdTIyMjciLCBvcjogIlx1MjIyOCIsIGNhcDogIlx1MjIyOSIsIGN1cDogIlx1MjIyQSIsIGludDogIlx1MjIyQiIsIHRoZXJlNDogIlx1MjIzNCIsIHNpbTogIlx1MjIzQyIsIGNvbmc6ICJcdTIyNDUiLCBhc3ltcDogIlx1MjI0OCIsIG5lOiAiXHUyMjYwIiwgZXF1aXY6ICJcdTIyNjEiLCBsZTogIlx1MjI2NCIsIGdlOiAiXHUyMjY1Iiwgc3ViOiAiXHUyMjgyIiwgc3VwOiAiXHUyMjgzIiwgbnN1YjogIlx1MjI4NCIsIHN1YmU6ICJcdTIyODYiLCBzdXBlOiAiXHUyMjg3Iiwgb3BsdXM6ICJcdTIyOTUiLCBvdGltZXM6ICJcdTIyOTciLCBwZXJwOiAiXHUyMkE1Iiwgc2RvdDogIlx1MjJDNSIsIGxjZWlsOiAiXHUyMzA4IiwgcmNlaWw6ICJcdTIzMDkiLCBsZmxvb3I6ICJcdTIzMEEiLCByZmxvb3I6ICJcdTIzMEIiLCBsYW5nOiAiXHUyMzI5IiwgcmFuZzogIlx1MjMyQSIsIGxvejogIlx1MjVDQSIsIHNwYWRlczogIlx1MjY2MCIsIGNsdWJzOiAiXHUyNjYzIiwgaGVhcnRzOiAiXHUyNjY1IiwgZGlhbXM6ICJcdTI2NjYiIH0sIEpsID0gL15bXGRhLWZBLUZdKyQvLCAkbCA9IC9eXGQrJC8sIFlsID0geWMoeyBBdHRyaWJ1dGVJc0VtcHR5OiAiSlNYIGF0dHJpYnV0ZXMgbXVzdCBvbmx5IGJlIGFzc2lnbmVkIGEgbm9uLWVtcHR5IGV4cHJlc3Npb24uIiwgTWlzc2luZ0Nsb3NpbmdUYWdFbGVtZW50OiAiRXhwZWN0ZWQgY29ycmVzcG9uZGluZyBKU1ggY2xvc2luZyB0YWcgZm9yIDwlMD4uIiwgTWlzc2luZ0Nsb3NpbmdUYWdGcmFnbWVudDogIkV4cGVjdGVkIGNvcnJlc3BvbmRpbmcgSlNYIGNsb3NpbmcgdGFnIGZvciA8Pi4iLCBVbmV4cGVjdGVkU2VxdWVuY2VFeHByZXNzaW9uOiAiU2VxdWVuY2UgZXhwcmVzc2lvbnMgY2Fubm90IGJlIGRpcmVjdGx5IG5lc3RlZCBpbnNpZGUgSlNYLiBEaWQgeW91IG1lYW4gdG8gd3JhcCBpdCBpbiBwYXJlbnRoZXNlcyAoLi4uKT8iLCBVbnN1cHBvcnRlZEpzeFZhbHVlOiAiSlNYIHZhbHVlIHNob3VsZCBiZSBlaXRoZXIgYW4gZXhwcmVzc2lvbiBvciBhIHF1b3RlZCBKU1ggdGV4dC4iLCBVbnRlcm1pbmF0ZWRKc3hDb250ZW50OiAiVW50ZXJtaW5hdGVkIEpTWCBjb250ZW50cy4iLCBVbndyYXBwZWRBZGphY2VudEpTWEVsZW1lbnRzOiAiQWRqYWNlbnQgSlNYIGVsZW1lbnRzIG11c3QgYmUgd3JhcHBlZCBpbiBhbiBlbmNsb3NpbmcgdGFnLiBEaWQgeW91IHdhbnQgYSBKU1ggZnJhZ21lbnQgPD4uLi48Lz4/IiB9LCBkYy5TeW50YXhFcnJvciwgImpzeCIpOwogICAgICAgIGZ1bmN0aW9uIFFsKHQyKSB7CiAgICAgICAgICByZXR1cm4gISF0MiAmJiAodDIudHlwZSA9PT0gIkpTWE9wZW5pbmdGcmFnbWVudCIgfHwgdDIudHlwZSA9PT0gIkpTWENsb3NpbmdGcmFnbWVudCIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBabCh0MikgewogICAgICAgICAgaWYgKHQyLnR5cGUgPT09ICJKU1hJZGVudGlmaWVyIikKICAgICAgICAgICAgcmV0dXJuIHQyLm5hbWU7CiAgICAgICAgICBpZiAodDIudHlwZSA9PT0gIkpTWE5hbWVzcGFjZWROYW1lIikKICAgICAgICAgICAgcmV0dXJuIHQyLm5hbWVzcGFjZS5uYW1lICsgIjoiICsgdDIubmFtZS5uYW1lOwogICAgICAgICAgaWYgKHQyLnR5cGUgPT09ICJKU1hNZW1iZXJFeHByZXNzaW9uIikKICAgICAgICAgICAgcmV0dXJuIFpsKHQyLm9iamVjdCkgKyAiLiIgKyBabCh0Mi5wcm9wZXJ0eSk7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vZGUgaGFkIHVuZXhwZWN0ZWQgdHlwZTogIiArIHQyLnR5cGUpOwogICAgICAgIH0KICAgICAgICBBYy5qX29UYWcgPSBuZXcgRWMoIjx0YWciKSwgQWMual9jVGFnID0gbmV3IEVjKCI8L3RhZyIpLCBBYy5qX2V4cHIgPSBuZXcgRWMoIjx0YWc+Li4uPC90YWc+IiwgdHJ1ZSk7CiAgICAgICAgY2xhc3MgdGQgZXh0ZW5kcyBBbCB7CiAgICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKSwgdGhpcy50eXBlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCksIHRoaXMuZW51bXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCB0aGlzLmNvbnN0RW51bXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCB0aGlzLmNsYXNzZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCB0aGlzLmV4cG9ydE9ubHlCaW5kaW5ncyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNsYXNzIGVkIGV4dGVuZHMgQ2wgewogICAgICAgICAgY3JlYXRlU2NvcGUodDIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyB0ZCh0Mik7CiAgICAgICAgICB9CiAgICAgICAgICBkZWNsYXJlTmFtZSh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5jdXJyZW50U2NvcGUoKTsKICAgICAgICAgICAgaWYgKGUyICYgeWwpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF5YmVFeHBvcnREZWZpbmVkKHIyLCB0MiksIHZvaWQgcjIuZXhwb3J0T25seUJpbmRpbmdzLmFkZCh0Mik7CiAgICAgICAgICAgIHN1cGVyLmRlY2xhcmVOYW1lKC4uLmFyZ3VtZW50cyksIDIgJiBlMiAmJiAoMSAmIGUyIHx8ICh0aGlzLmNoZWNrUmVkZWNsYXJhdGlvbkluU2NvcGUocjIsIHQyLCBlMiwgczIpLCB0aGlzLm1heWJlRXhwb3J0RGVmaW5lZChyMiwgdDIpKSwgcjIudHlwZXMuYWRkKHQyKSksIDI1NiAmIGUyICYmIHIyLmVudW1zLmFkZCh0MiksIDUxMiAmIGUyICYmIHIyLmNvbnN0RW51bXMuYWRkKHQyKSwgZTIgJiBmbCAmJiByMi5jbGFzc2VzLmFkZCh0Mik7CiAgICAgICAgICB9CiAgICAgICAgICBpc1JlZGVjbGFyZWRJblNjb3BlKHQyLCBlMiwgczIpIHsKICAgICAgICAgICAgaWYgKHQyLmVudW1zLmhhcyhlMikpIHsKICAgICAgICAgICAgICBpZiAoMjU2ICYgczIpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhISg1MTIgJiBzMikgIT09IHQyLmNvbnN0RW51bXMuaGFzKGUyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHMyICYgZmwgJiYgdDIuY2xhc3Nlcy5oYXMoZTIpID8gISF0Mi5sZXhpY2FsLmhhcyhlMikgJiYgISEoMSAmIHMyKSA6ICEhKDIgJiBzMiAmJiB0Mi50eXBlcy5oYXMoZTIpKSB8fCBzdXBlci5pc1JlZGVjbGFyZWRJblNjb3BlKC4uLmFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0xvY2FsRXhwb3J0KHQyKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zY29wZVN0YWNrWzBdLCB7IG5hbWU6IHMyIH0gPSB0MjsKICAgICAgICAgICAgZTIudHlwZXMuaGFzKHMyKSB8fCBlMi5leHBvcnRPbmx5QmluZGluZ3MuaGFzKHMyKSB8fCBzdXBlci5jaGVja0xvY2FsRXhwb3J0KHQyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc2QodDIpIHsKICAgICAgICAgIGlmICghdDIpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQXNzZXJ0IGZhaWwiKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcmQgPSB5Yyh7IEFic3RyYWN0TWV0aG9kSGFzSW1wbGVtZW50YXRpb246ICJNZXRob2QgJyUwJyBjYW5ub3QgaGF2ZSBhbiBpbXBsZW1lbnRhdGlvbiBiZWNhdXNlIGl0IGlzIG1hcmtlZCBhYnN0cmFjdC4iLCBBYnN0cmFjdFByb3BlcnR5SGFzSW5pdGlhbGl6ZXI6ICJQcm9wZXJ0eSAnJTAnIGNhbm5vdCBoYXZlIGFuIGluaXRpYWxpemVyIGJlY2F1c2UgaXQgaXMgbWFya2VkIGFic3RyYWN0LiIsIEFjY2Vzb3JDYW5ub3REZWNsYXJlVGhpc1BhcmFtZXRlcjogIidnZXQnIGFuZCAnc2V0JyBhY2Nlc3NvcnMgY2Fubm90IGRlY2xhcmUgJ3RoaXMnIHBhcmFtZXRlcnMuIiwgQWNjZXNvckNhbm5vdEhhdmVUeXBlUGFyYW1ldGVyczogIkFuIGFjY2Vzc29yIGNhbm5vdCBoYXZlIHR5cGUgcGFyYW1ldGVycy4iLCBDbGFzc01ldGhvZEhhc0RlY2xhcmU6ICJDbGFzcyBtZXRob2RzIGNhbm5vdCBoYXZlIHRoZSAnZGVjbGFyZScgbW9kaWZpZXIuIiwgQ2xhc3NNZXRob2RIYXNSZWFkb25seTogIkNsYXNzIG1ldGhvZHMgY2Fubm90IGhhdmUgdGhlICdyZWFkb25seScgbW9kaWZpZXIuIiwgQ29uc3RydWN0b3JIYXNUeXBlUGFyYW1ldGVyczogIlR5cGUgcGFyYW1ldGVycyBjYW5ub3QgYXBwZWFyIG9uIGEgY29uc3RydWN0b3IgZGVjbGFyYXRpb24uIiwgRGVjbGFyZUFjY2Vzc29yOiAiJ2RlY2xhcmUnIGlzIG5vdCBhbGxvd2VkIGluICUwdGVycy4iLCBEZWNsYXJlQ2xhc3NGaWVsZEhhc0luaXRpYWxpemVyOiAiSW5pdGlhbGl6ZXJzIGFyZSBub3QgYWxsb3dlZCBpbiBhbWJpZW50IGNvbnRleHRzLiIsIERlY2xhcmVGdW5jdGlvbkhhc0ltcGxlbWVudGF0aW9uOiAiQW4gaW1wbGVtZW50YXRpb24gY2Fubm90IGJlIGRlY2xhcmVkIGluIGFtYmllbnQgY29udGV4dHMuIiwgRHVwbGljYXRlQWNjZXNzaWJpbGl0eU1vZGlmaWVyOiAiQWNjZXNzaWJpbGl0eSBtb2RpZmllciBhbHJlYWR5IHNlZW4uIiwgRHVwbGljYXRlTW9kaWZpZXI6ICJEdXBsaWNhdGUgbW9kaWZpZXI6ICclMCcuIiwgRW1wdHlIZXJpdGFnZUNsYXVzZVR5cGU6ICInJTAnIGxpc3QgY2Fubm90IGJlIGVtcHR5LiIsIEVtcHR5VHlwZUFyZ3VtZW50czogIlR5cGUgYXJndW1lbnQgbGlzdCBjYW5ub3QgYmUgZW1wdHkuIiwgRW1wdHlUeXBlUGFyYW1ldGVyczogIlR5cGUgcGFyYW1ldGVyIGxpc3QgY2Fubm90IGJlIGVtcHR5LiIsIEV4cGVjdGVkQW1iaWVudEFmdGVyRXhwb3J0RGVjbGFyZTogIidleHBvcnQgZGVjbGFyZScgbXVzdCBiZSBmb2xsb3dlZCBieSBhbiBhbWJpZW50IGRlY2xhcmF0aW9uLiIsIEltcG9ydEFsaWFzSGFzSW1wb3J0VHlwZTogIkFuIGltcG9ydCBhbGlhcyBjYW4gbm90IHVzZSAnaW1wb3J0IHR5cGUnLiIsIEluY29tcGF0aWJsZU1vZGlmaWVyczogIiclMCcgbW9kaWZpZXIgY2Fubm90IGJlIHVzZWQgd2l0aCAnJTEnIG1vZGlmaWVyLiIsIEluZGV4U2lnbmF0dXJlSGFzQWJzdHJhY3Q6ICJJbmRleCBzaWduYXR1cmVzIGNhbm5vdCBoYXZlIHRoZSAnYWJzdHJhY3QnIG1vZGlmaWVyLiIsIEluZGV4U2lnbmF0dXJlSGFzQWNjZXNzaWJpbGl0eTogIkluZGV4IHNpZ25hdHVyZXMgY2Fubm90IGhhdmUgYW4gYWNjZXNzaWJpbGl0eSBtb2RpZmllciAoJyUwJykuIiwgSW5kZXhTaWduYXR1cmVIYXNEZWNsYXJlOiAiSW5kZXggc2lnbmF0dXJlcyBjYW5ub3QgaGF2ZSB0aGUgJ2RlY2xhcmUnIG1vZGlmaWVyLiIsIEluZGV4U2lnbmF0dXJlSGFzT3ZlcnJpZGU6ICInb3ZlcnJpZGUnIG1vZGlmaWVyIGNhbm5vdCBhcHBlYXIgb24gYW4gaW5kZXggc2lnbmF0dXJlLiIsIEluZGV4U2lnbmF0dXJlSGFzU3RhdGljOiAiSW5kZXggc2lnbmF0dXJlcyBjYW5ub3QgaGF2ZSB0aGUgJ3N0YXRpYycgbW9kaWZpZXIuIiwgSW52YWxpZE1vZGlmaWVyT25UeXBlTWVtYmVyOiAiJyUwJyBtb2RpZmllciBjYW5ub3QgYXBwZWFyIG9uIGEgdHlwZSBtZW1iZXIuIiwgSW52YWxpZE1vZGlmaWVyc09yZGVyOiAiJyUwJyBtb2RpZmllciBtdXN0IHByZWNlZGUgJyUxJyBtb2RpZmllci4iLCBJbnZhbGlkVHVwbGVNZW1iZXJMYWJlbDogIlR1cGxlIG1lbWJlcnMgbXVzdCBiZSBsYWJlbGVkIHdpdGggYSBzaW1wbGUgaWRlbnRpZmllci4iLCBNaXNzaW5nSW50ZXJmYWNlTmFtZTogIidpbnRlcmZhY2UnIGRlY2xhcmF0aW9ucyBtdXN0IGJlIGZvbGxvd2VkIGJ5IGFuIGlkZW50aWZpZXIuIiwgTWl4ZWRMYWJlbGVkQW5kVW5sYWJlbGVkRWxlbWVudHM6ICJUdXBsZSBtZW1iZXJzIG11c3QgYWxsIGhhdmUgbmFtZXMgb3IgYWxsIG5vdCBoYXZlIG5hbWVzLiIsIE5vbkFic3RyYWN0Q2xhc3NIYXNBYnN0cmFjdE1ldGhvZDogIkFic3RyYWN0IG1ldGhvZHMgY2FuIG9ubHkgYXBwZWFyIHdpdGhpbiBhbiBhYnN0cmFjdCBjbGFzcy4iLCBOb25DbGFzc01ldGhvZFByb3BlcnR5SGFzQWJzdHJhY3RNb2RpZmVyOiAiJ2Fic3RyYWN0JyBtb2RpZmllciBjYW4gb25seSBhcHBlYXIgb24gYSBjbGFzcywgbWV0aG9kLCBvciBwcm9wZXJ0eSBkZWNsYXJhdGlvbi4iLCBPcHRpb25hbFR5cGVCZWZvcmVSZXF1aXJlZDogIkEgcmVxdWlyZWQgZWxlbWVudCBjYW5ub3QgZm9sbG93IGFuIG9wdGlvbmFsIGVsZW1lbnQuIiwgT3ZlcnJpZGVOb3RJblN1YkNsYXNzOiAiVGhpcyBtZW1iZXIgY2Fubm90IGhhdmUgYW4gJ292ZXJyaWRlJyBtb2RpZmllciBiZWNhdXNlIGl0cyBjb250YWluaW5nIGNsYXNzIGRvZXMgbm90IGV4dGVuZCBhbm90aGVyIGNsYXNzLiIsIFBhdHRlcm5Jc09wdGlvbmFsOiAiQSBiaW5kaW5nIHBhdHRlcm4gcGFyYW1ldGVyIGNhbm5vdCBiZSBvcHRpb25hbCBpbiBhbiBpbXBsZW1lbnRhdGlvbiBzaWduYXR1cmUuIiwgUHJpdmF0ZUVsZW1lbnRIYXNBYnN0cmFjdDogIlByaXZhdGUgZWxlbWVudHMgY2Fubm90IGhhdmUgdGhlICdhYnN0cmFjdCcgbW9kaWZpZXIuIiwgUHJpdmF0ZUVsZW1lbnRIYXNBY2Nlc3NpYmlsaXR5OiAiUHJpdmF0ZSBlbGVtZW50cyBjYW5ub3QgaGF2ZSBhbiBhY2Nlc3NpYmlsaXR5IG1vZGlmaWVyICgnJTAnKS4iLCBSZWFkb25seUZvck1ldGhvZFNpZ25hdHVyZTogIidyZWFkb25seScgbW9kaWZpZXIgY2FuIG9ubHkgYXBwZWFyIG9uIGEgcHJvcGVydHkgZGVjbGFyYXRpb24gb3IgaW5kZXggc2lnbmF0dXJlLiIsIFJlc2VydmVkQXJyb3dUeXBlUGFyYW06ICJUaGlzIHN5bnRheCBpcyByZXNlcnZlZCBpbiBmaWxlcyB3aXRoIHRoZSAubXRzIG9yIC5jdHMgZXh0ZW5zaW9uLiBBZGQgYSB0cmFpbGluZyBjb21tYSwgYXMgaW4gYDxULD4oKSA9PiAuLi5gLiIsIFJlc2VydmVkVHlwZUFzc2VydGlvbjogIlRoaXMgc3ludGF4IGlzIHJlc2VydmVkIGluIGZpbGVzIHdpdGggdGhlIC5tdHMgb3IgLmN0cyBleHRlbnNpb24uIFVzZSBhbiBgYXNgIGV4cHJlc3Npb24gaW5zdGVhZC4iLCBTZXRBY2Nlc29yQ2Fubm90SGF2ZU9wdGlvbmFsUGFyYW1ldGVyOiAiQSAnc2V0JyBhY2Nlc3NvciBjYW5ub3QgaGF2ZSBhbiBvcHRpb25hbCBwYXJhbWV0ZXIuIiwgU2V0QWNjZXNvckNhbm5vdEhhdmVSZXN0UGFyYW1ldGVyOiAiQSAnc2V0JyBhY2Nlc3NvciBjYW5ub3QgaGF2ZSByZXN0IHBhcmFtZXRlci4iLCBTZXRBY2Nlc29yQ2Fubm90SGF2ZVJldHVyblR5cGU6ICJBICdzZXQnIGFjY2Vzc29yIGNhbm5vdCBoYXZlIGEgcmV0dXJuIHR5cGUgYW5ub3RhdGlvbi4iLCBTdGF0aWNCbG9ja0Nhbm5vdEhhdmVNb2RpZmllcjogIlN0YXRpYyBjbGFzcyBibG9ja3MgY2Fubm90IGhhdmUgYW55IG1vZGlmaWVyLiIsIFR5cGVBbm5vdGF0aW9uQWZ0ZXJBc3NpZ246ICJUeXBlIGFubm90YXRpb25zIG11c3QgY29tZSBiZWZvcmUgZGVmYXVsdCBhc3NpZ25tZW50cywgZS5nLiBpbnN0ZWFkIG9mIGBhZ2UgPSAyNTogbnVtYmVyYCB1c2UgYGFnZTogbnVtYmVyID0gMjVgLiIsIFR5cGVJbXBvcnRDYW5ub3RTcGVjaWZ5RGVmYXVsdEFuZE5hbWVkOiAiQSB0eXBlLW9ubHkgaW1wb3J0IGNhbiBzcGVjaWZ5IGEgZGVmYXVsdCBpbXBvcnQgb3IgbmFtZWQgYmluZGluZ3MsIGJ1dCBub3QgYm90aC4iLCBUeXBlTW9kaWZpZXJJc1VzZWRJblR5cGVFeHBvcnRzOiAiVGhlICd0eXBlJyBtb2RpZmllciBjYW5ub3QgYmUgdXNlZCBvbiBhIG5hbWVkIGV4cG9ydCB3aGVuICdleHBvcnQgdHlwZScgaXMgdXNlZCBvbiBpdHMgZXhwb3J0IHN0YXRlbWVudC4iLCBUeXBlTW9kaWZpZXJJc1VzZWRJblR5cGVJbXBvcnRzOiAiVGhlICd0eXBlJyBtb2RpZmllciBjYW5ub3QgYmUgdXNlZCBvbiBhIG5hbWVkIGltcG9ydCB3aGVuICdpbXBvcnQgdHlwZScgaXMgdXNlZCBvbiBpdHMgaW1wb3J0IHN0YXRlbWVudC4iLCBVbmV4cGVjdGVkUGFyYW1ldGVyTW9kaWZpZXI6ICJBIHBhcmFtZXRlciBwcm9wZXJ0eSBpcyBvbmx5IGFsbG93ZWQgaW4gYSBjb25zdHJ1Y3RvciBpbXBsZW1lbnRhdGlvbi4iLCBVbmV4cGVjdGVkUmVhZG9ubHk6ICIncmVhZG9ubHknIHR5cGUgbW9kaWZpZXIgaXMgb25seSBwZXJtaXR0ZWQgb24gYXJyYXkgYW5kIHR1cGxlIGxpdGVyYWwgdHlwZXMuIiwgVW5leHBlY3RlZFR5cGVBbm5vdGF0aW9uOiAiRGlkIG5vdCBleHBlY3QgYSB0eXBlIGFubm90YXRpb24gaGVyZS4iLCBVbmV4cGVjdGVkVHlwZUNhc3RJblBhcmFtZXRlcjogIlVuZXhwZWN0ZWQgdHlwZSBjYXN0IGluIHBhcmFtZXRlciBwb3NpdGlvbi4iLCBVbnN1cHBvcnRlZEltcG9ydFR5cGVBcmd1bWVudDogIkFyZ3VtZW50IGluIGEgdHlwZSBpbXBvcnQgbXVzdCBiZSBhIHN0cmluZyBsaXRlcmFsLiIsIFVuc3VwcG9ydGVkUGFyYW1ldGVyUHJvcGVydHlLaW5kOiAiQSBwYXJhbWV0ZXIgcHJvcGVydHkgbWF5IG5vdCBiZSBkZWNsYXJlZCB1c2luZyBhIGJpbmRpbmcgcGF0dGVybi4iLCBVbnN1cHBvcnRlZFNpZ25hdHVyZVBhcmFtZXRlcktpbmQ6ICJOYW1lIGluIGEgc2lnbmF0dXJlIG11c3QgYmUgYW4gSWRlbnRpZmllciwgT2JqZWN0UGF0dGVybiBvciBBcnJheVBhdHRlcm4sIGluc3RlYWQgZ290ICUwLiIgfSwgZGMuU3ludGF4RXJyb3IsICJ0eXBlc2NyaXB0Iik7CiAgICAgICAgZnVuY3Rpb24gaWQodDIpIHsKICAgICAgICAgIHJldHVybiB0MiA9PT0gInByaXZhdGUiIHx8IHQyID09PSAicHVibGljIiB8fCB0MiA9PT0gInByb3RlY3RlZCI7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG5kID0geWMoeyBDbGFzc05hbWVJc1JlcXVpcmVkOiAiQSBjbGFzcyBuYW1lIGlzIHJlcXVpcmVkLiIgfSwgZGMuU3ludGF4RXJyb3IpOwogICAgICAgIGZ1bmN0aW9uIGFkKHQyLCBlMikgewogICAgICAgICAgcmV0dXJuIHQyLnNvbWUoKHQzKSA9PiBBcnJheS5pc0FycmF5KHQzKSA/IHQzWzBdID09PSBlMiA6IHQzID09PSBlMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG9kKHQyLCBlMiwgczIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gdDIuZmluZCgodDMpID0+IEFycmF5LmlzQXJyYXkodDMpID8gdDNbMF0gPT09IGUyIDogdDMgPT09IGUyKTsKICAgICAgICAgIHJldHVybiByMiAmJiBBcnJheS5pc0FycmF5KHIyKSA/IHIyWzFdW3MyXSA6IG51bGw7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHVkID0gWyJtaW5pbWFsIiwgImZzaGFycCIsICJoYWNrIiwgInNtYXJ0Il0sIGhkID0gWyJeIiwgIiUiLCAiIyJdLCBwZCA9IFsiaGFzaCIsICJiYXIiXTsKICAgICAgICBjb25zdCBjZCA9IHsgZXN0cmVlOiAodDIpID0+IGNsYXNzIGV4dGVuZHMgdDIgewogICAgICAgICAgcGFyc2VSZWdFeHBMaXRlcmFsKHQzKSB7CiAgICAgICAgICAgIGxldCB7IHBhdHRlcm46IGUyLCBmbGFnczogczIgfSA9IHQzLCByMiA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcjIgPSBuZXcgUmVnRXhwKGUyLCBzMik7CiAgICAgICAgICAgIH0gY2F0Y2ggKHQ0KSB7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLmVzdHJlZVBhcnNlTGl0ZXJhbChyMik7CiAgICAgICAgICAgIHJldHVybiBpMi5yZWdleCA9IHsgcGF0dGVybjogZTIsIGZsYWdzOiBzMiB9LCBpMjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQmlnSW50TGl0ZXJhbCh0MykgewogICAgICAgICAgICBsZXQgZTI7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgZTIgPSBCaWdJbnQodDMpOwogICAgICAgICAgICB9IGNhdGNoICh0NCkgewogICAgICAgICAgICAgIGUyID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuZXN0cmVlUGFyc2VMaXRlcmFsKGUyKTsKICAgICAgICAgICAgcmV0dXJuIHMyLmJpZ2ludCA9IFN0cmluZyhzMi52YWx1ZSB8fCB0MyksIHMyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VEZWNpbWFsTGl0ZXJhbCh0MykgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuZXN0cmVlUGFyc2VMaXRlcmFsKG51bGwpOwogICAgICAgICAgICByZXR1cm4gZTIuZGVjaW1hbCA9IFN0cmluZyhlMi52YWx1ZSB8fCB0MyksIGUyOwogICAgICAgICAgfQogICAgICAgICAgZXN0cmVlUGFyc2VMaXRlcmFsKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlTGl0ZXJhbCh0MywgIkxpdGVyYWwiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlU3RyaW5nTGl0ZXJhbCh0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5lc3RyZWVQYXJzZUxpdGVyYWwodDMpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VOdW1lcmljTGl0ZXJhbCh0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5lc3RyZWVQYXJzZUxpdGVyYWwodDMpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VOdWxsTGl0ZXJhbCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXN0cmVlUGFyc2VMaXRlcmFsKG51bGwpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VCb29sZWFuTGl0ZXJhbCh0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5lc3RyZWVQYXJzZUxpdGVyYWwodDMpOwogICAgICAgICAgfQogICAgICAgICAgZGlyZWN0aXZlVG9TdG10KHQzKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdDMudmFsdWUsIHMyID0gdGhpcy5zdGFydE5vZGVBdCh0My5zdGFydCwgdDMubG9jLnN0YXJ0KSwgcjIgPSB0aGlzLnN0YXJ0Tm9kZUF0KGUyLnN0YXJ0LCBlMi5sb2Muc3RhcnQpOwogICAgICAgICAgICByZXR1cm4gcjIudmFsdWUgPSBlMi5leHRyYS5leHByZXNzaW9uVmFsdWUsIHIyLnJhdyA9IGUyLmV4dHJhLnJhdywgczIuZXhwcmVzc2lvbiA9IHRoaXMuZmluaXNoTm9kZUF0KHIyLCAiTGl0ZXJhbCIsIGUyLmVuZCwgZTIubG9jLmVuZCksIHMyLmRpcmVjdGl2ZSA9IGUyLmV4dHJhLnJhdy5zbGljZSgxLCAtMSksIHRoaXMuZmluaXNoTm9kZUF0KHMyLCAiRXhwcmVzc2lvblN0YXRlbWVudCIsIHQzLmVuZCwgdDMubG9jLmVuZCk7CiAgICAgICAgICB9CiAgICAgICAgICBpbml0RnVuY3Rpb24odDMsIGUyKSB7CiAgICAgICAgICAgIHN1cGVyLmluaXRGdW5jdGlvbih0MywgZTIpLCB0My5leHByZXNzaW9uID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0RlY2xhcmF0aW9uKHQzKSB7CiAgICAgICAgICAgIHQzICE9IG51bGwgJiYgdGhpcy5pc09iamVjdFByb3BlcnR5KHQzKSA/IHRoaXMuY2hlY2tEZWNsYXJhdGlvbih0My52YWx1ZSkgOiBzdXBlci5jaGVja0RlY2xhcmF0aW9uKHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIGdldE9iamVjdE9yQ2xhc3NNZXRob2RQYXJhbXModDMpIHsKICAgICAgICAgICAgcmV0dXJuIHQzLnZhbHVlLnBhcmFtczsKICAgICAgICAgIH0KICAgICAgICAgIGlzVmFsaWREaXJlY3RpdmUodDMpIHsKICAgICAgICAgICAgdmFyIGUyOwogICAgICAgICAgICByZXR1cm4gdDMudHlwZSA9PT0gIkV4cHJlc3Npb25TdGF0ZW1lbnQiICYmIHQzLmV4cHJlc3Npb24udHlwZSA9PT0gIkxpdGVyYWwiICYmIHR5cGVvZiB0My5leHByZXNzaW9uLnZhbHVlID09ICJzdHJpbmciICYmICEoKGUyID0gdDMuZXhwcmVzc2lvbi5leHRyYSkgIT0gbnVsbCAmJiBlMi5wYXJlbnRoZXNpemVkKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQmxvY2tCb2R5KHQzKSB7CiAgICAgICAgICAgIGZvciAodmFyIGUyID0gYXJndW1lbnRzLmxlbmd0aCwgczIgPSBuZXcgQXJyYXkoZTIgPiAxID8gZTIgLSAxIDogMCksIHIyID0gMTsgcjIgPCBlMjsgcjIrKykKICAgICAgICAgICAgICBzMltyMiAtIDFdID0gYXJndW1lbnRzW3IyXTsKICAgICAgICAgICAgc3VwZXIucGFyc2VCbG9ja0JvZHkodDMsIC4uLnMyKTsKICAgICAgICAgICAgY29uc3QgaTIgPSB0My5kaXJlY3RpdmVzLm1hcCgodDQpID0+IHRoaXMuZGlyZWN0aXZlVG9TdG10KHQ0KSk7CiAgICAgICAgICAgIHQzLmJvZHkgPSBpMi5jb25jYXQodDMuYm9keSksIGRlbGV0ZSB0My5kaXJlY3RpdmVzOwogICAgICAgICAgfQogICAgICAgICAgcHVzaENsYXNzTWV0aG9kKHQzLCBlMiwgczIsIHIyLCBpMiwgbjIpIHsKICAgICAgICAgICAgdGhpcy5wYXJzZU1ldGhvZChlMiwgczIsIHIyLCBpMiwgbjIsICJDbGFzc01ldGhvZCIsIHRydWUpLCBlMi50eXBlUGFyYW1ldGVycyAmJiAoZTIudmFsdWUudHlwZVBhcmFtZXRlcnMgPSBlMi50eXBlUGFyYW1ldGVycywgZGVsZXRlIGUyLnR5cGVQYXJhbWV0ZXJzKSwgdDMuYm9keS5wdXNoKGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlUHJpdmF0ZU5hbWUoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gc3VwZXIucGFyc2VQcml2YXRlTmFtZSgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQbHVnaW5PcHRpb24oImVzdHJlZSIsICJjbGFzc0ZlYXR1cmVzIikgPyB0aGlzLmNvbnZlcnRQcml2YXRlTmFtZVRvUHJpdmF0ZUlkZW50aWZpZXIodDMpIDogdDM7CiAgICAgICAgICB9CiAgICAgICAgICBjb252ZXJ0UHJpdmF0ZU5hbWVUb1ByaXZhdGVJZGVudGlmaWVyKHQzKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gc3VwZXIuZ2V0UHJpdmF0ZU5hbWVTVih0Myk7CiAgICAgICAgICAgIHJldHVybiBkZWxldGUgKHQzID0gdDMpLmlkLCB0My5uYW1lID0gZTIsIHQzLnR5cGUgPSAiUHJpdmF0ZUlkZW50aWZpZXIiLCB0MzsKICAgICAgICAgIH0KICAgICAgICAgIGlzUHJpdmF0ZU5hbWUodDMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGx1Z2luT3B0aW9uKCJlc3RyZWUiLCAiY2xhc3NGZWF0dXJlcyIpID8gdDMudHlwZSA9PT0gIlByaXZhdGVJZGVudGlmaWVyIiA6IHN1cGVyLmlzUHJpdmF0ZU5hbWUodDMpOwogICAgICAgICAgfQogICAgICAgICAgZ2V0UHJpdmF0ZU5hbWVTVih0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQbHVnaW5PcHRpb24oImVzdHJlZSIsICJjbGFzc0ZlYXR1cmVzIikgPyB0My5uYW1lIDogc3VwZXIuZ2V0UHJpdmF0ZU5hbWVTVih0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUxpdGVyYWwodDMsIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gc3VwZXIucGFyc2VMaXRlcmFsKHQzLCBlMik7CiAgICAgICAgICAgIHJldHVybiBzMi5yYXcgPSBzMi5leHRyYS5yYXcsIGRlbGV0ZSBzMi5leHRyYSwgczI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUZ1bmN0aW9uQm9keSh0MywgZTIpIHsKICAgICAgICAgICAgbGV0IHMyID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgJiYgYXJndW1lbnRzWzJdOwogICAgICAgICAgICBzdXBlci5wYXJzZUZ1bmN0aW9uQm9keSh0MywgZTIsIHMyKSwgdDMuZXhwcmVzc2lvbiA9IHQzLmJvZHkudHlwZSAhPT0gIkJsb2NrU3RhdGVtZW50IjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlTWV0aG9kKHQzLCBlMiwgczIsIHIyLCBpMiwgbjIpIHsKICAgICAgICAgICAgbGV0IGEyID0gYXJndW1lbnRzLmxlbmd0aCA+IDYgJiYgYXJndW1lbnRzWzZdICE9PSB2b2lkIDAgJiYgYXJndW1lbnRzWzZdLCBvMiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiBvMi5raW5kID0gdDMua2luZCwgbzIgPSBzdXBlci5wYXJzZU1ldGhvZChvMiwgZTIsIHMyLCByMiwgaTIsIG4yLCBhMiksIG8yLnR5cGUgPSAiRnVuY3Rpb25FeHByZXNzaW9uIiwgZGVsZXRlIG8yLmtpbmQsIHQzLnZhbHVlID0gbzIsIG4yID09PSAiQ2xhc3NQcml2YXRlTWV0aG9kIiAmJiAodDMuY29tcHV0ZWQgPSBmYWxzZSksIG4yID0gIk1ldGhvZERlZmluaXRpb24iLCB0aGlzLmZpbmlzaE5vZGUodDMsIG4yKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3NQcm9wZXJ0eSgpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBzdXBlci5wYXJzZUNsYXNzUHJvcGVydHkoLi4uYXJndW1lbnRzKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGx1Z2luT3B0aW9uKCJlc3RyZWUiLCAiY2xhc3NGZWF0dXJlcyIpID8gKHQzLnR5cGUgPSAiUHJvcGVydHlEZWZpbml0aW9uIiwgdDMpIDogdDM7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNsYXNzUHJpdmF0ZVByb3BlcnR5KCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHN1cGVyLnBhcnNlQ2xhc3NQcml2YXRlUHJvcGVydHkoLi4uYXJndW1lbnRzKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGx1Z2luT3B0aW9uKCJlc3RyZWUiLCAiY2xhc3NGZWF0dXJlcyIpID8gKHQzLnR5cGUgPSAiUHJvcGVydHlEZWZpbml0aW9uIiwgdDMuY29tcHV0ZWQgPSBmYWxzZSwgdDMpIDogdDM7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU9iamVjdE1ldGhvZCh0MywgZTIsIHMyLCByMiwgaTIpIHsKICAgICAgICAgICAgY29uc3QgbjIgPSBzdXBlci5wYXJzZU9iamVjdE1ldGhvZCh0MywgZTIsIHMyLCByMiwgaTIpOwogICAgICAgICAgICByZXR1cm4gbjIgJiYgKG4yLnR5cGUgPSAiUHJvcGVydHkiLCBuMi5raW5kID09PSAibWV0aG9kIiAmJiAobjIua2luZCA9ICJpbml0IiksIG4yLnNob3J0aGFuZCA9IGZhbHNlKSwgbjI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU9iamVjdFByb3BlcnR5KHQzLCBlMiwgczIsIHIyLCBpMikgewogICAgICAgICAgICBjb25zdCBuMiA9IHN1cGVyLnBhcnNlT2JqZWN0UHJvcGVydHkodDMsIGUyLCBzMiwgcjIsIGkyKTsKICAgICAgICAgICAgcmV0dXJuIG4yICYmIChuMi5raW5kID0gImluaXQiLCBuMi50eXBlID0gIlByb3BlcnR5IiksIG4yOwogICAgICAgICAgfQogICAgICAgICAgaXNBc3NpZ25hYmxlKHQzLCBlMikgewogICAgICAgICAgICByZXR1cm4gdDMgIT0gbnVsbCAmJiB0aGlzLmlzT2JqZWN0UHJvcGVydHkodDMpID8gdGhpcy5pc0Fzc2lnbmFibGUodDMudmFsdWUsIGUyKSA6IHN1cGVyLmlzQXNzaWduYWJsZSh0MywgZTIpOwogICAgICAgICAgfQogICAgICAgICAgdG9Bc3NpZ25hYmxlKHQzKSB7CiAgICAgICAgICAgIGxldCBlMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwICYmIGFyZ3VtZW50c1sxXTsKICAgICAgICAgICAgcmV0dXJuIHQzICE9IG51bGwgJiYgdGhpcy5pc09iamVjdFByb3BlcnR5KHQzKSA/ICh0aGlzLnRvQXNzaWduYWJsZSh0My52YWx1ZSwgZTIpLCB0MykgOiBzdXBlci50b0Fzc2lnbmFibGUodDMsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHRvQXNzaWduYWJsZU9iamVjdEV4cHJlc3Npb25Qcm9wKHQzKSB7CiAgICAgICAgICAgIGlmICh0My5raW5kID09PSAiZ2V0IiB8fCB0My5raW5kID09PSAic2V0IikKICAgICAgICAgICAgICB0aGlzLnJhaXNlKHQzLmtleS5zdGFydCwgRGMuUGF0dGVybkhhc0FjY2Vzc29yKTsKICAgICAgICAgICAgZWxzZSBpZiAodDMubWV0aG9kKQogICAgICAgICAgICAgIHRoaXMucmFpc2UodDMua2V5LnN0YXJ0LCBEYy5QYXR0ZXJuSGFzTWV0aG9kKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgZTIgPSBhcmd1bWVudHMubGVuZ3RoLCBzMiA9IG5ldyBBcnJheShlMiA+IDEgPyBlMiAtIDEgOiAwKSwgcjIgPSAxOyByMiA8IGUyOyByMisrKQogICAgICAgICAgICAgICAgczJbcjIgLSAxXSA9IGFyZ3VtZW50c1tyMl07CiAgICAgICAgICAgICAgc3VwZXIudG9Bc3NpZ25hYmxlT2JqZWN0RXhwcmVzc2lvblByb3AodDMsIC4uLnMyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZmluaXNoQ2FsbEV4cHJlc3Npb24odDMsIGUyKSB7CiAgICAgICAgICAgIGlmIChzdXBlci5maW5pc2hDYWxsRXhwcmVzc2lvbih0MywgZTIpLCB0My5jYWxsZWUudHlwZSA9PT0gIkltcG9ydCIpIHsKICAgICAgICAgICAgICB2YXIgczI7CiAgICAgICAgICAgICAgaWYgKHQzLnR5cGUgPSAiSW1wb3J0RXhwcmVzc2lvbiIsIHQzLnNvdXJjZSA9IHQzLmFyZ3VtZW50c1swXSwgdGhpcy5oYXNQbHVnaW4oImltcG9ydEFzc2VydGlvbnMiKSkKICAgICAgICAgICAgICAgIHQzLmF0dHJpYnV0ZXMgPSAoczIgPSB0My5hcmd1bWVudHNbMV0pICE9IG51bGwgPyBzMiA6IG51bGw7CiAgICAgICAgICAgICAgZGVsZXRlIHQzLmFyZ3VtZW50cywgZGVsZXRlIHQzLmNhbGxlZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9CiAgICAgICAgICB0b1JlZmVyZW5jZWRBcmd1bWVudHModDMpIHsKICAgICAgICAgICAgdDMudHlwZSAhPT0gIkltcG9ydEV4cHJlc3Npb24iICYmIHN1cGVyLnRvUmVmZXJlbmNlZEFyZ3VtZW50cyh0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUV4cG9ydCh0MykgewogICAgICAgICAgICBzd2l0Y2ggKHN1cGVyLnBhcnNlRXhwb3J0KHQzKSwgdDMudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgIkV4cG9ydEFsbERlY2xhcmF0aW9uIjoKICAgICAgICAgICAgICAgIHQzLmV4cG9ydGVkID0gbnVsbDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIkV4cG9ydE5hbWVkRGVjbGFyYXRpb24iOgogICAgICAgICAgICAgICAgdDMuc3BlY2lmaWVycy5sZW5ndGggPT09IDEgJiYgdDMuc3BlY2lmaWVyc1swXS50eXBlID09PSAiRXhwb3J0TmFtZXNwYWNlU3BlY2lmaWVyIiAmJiAodDMudHlwZSA9ICJFeHBvcnRBbGxEZWNsYXJhdGlvbiIsIHQzLmV4cG9ydGVkID0gdDMuc3BlY2lmaWVyc1swXS5leHBvcnRlZCwgZGVsZXRlIHQzLnNwZWNpZmllcnMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0MzsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlU3Vic2NyaXB0KHQzLCBlMiwgczIsIHIyLCBpMikgewogICAgICAgICAgICBjb25zdCBuMiA9IHN1cGVyLnBhcnNlU3Vic2NyaXB0KHQzLCBlMiwgczIsIHIyLCBpMik7CiAgICAgICAgICAgIGlmIChpMi5vcHRpb25hbENoYWluTWVtYmVyKSB7CiAgICAgICAgICAgICAgaWYgKG4yLnR5cGUgIT09ICJPcHRpb25hbE1lbWJlckV4cHJlc3Npb24iICYmIG4yLnR5cGUgIT09ICJPcHRpb25hbENhbGxFeHByZXNzaW9uIiB8fCAobjIudHlwZSA9IG4yLnR5cGUuc3Vic3RyaW5nKDgpKSwgaTIuc3RvcCkgewogICAgICAgICAgICAgICAgY29uc3QgdDQgPSB0aGlzLnN0YXJ0Tm9kZUF0Tm9kZShuMik7CiAgICAgICAgICAgICAgICByZXR1cm4gdDQuZXhwcmVzc2lvbiA9IG4yLCB0aGlzLmZpbmlzaE5vZGUodDQsICJDaGFpbkV4cHJlc3Npb24iKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIG4yLnR5cGUgIT09ICJNZW1iZXJFeHByZXNzaW9uIiAmJiBuMi50eXBlICE9PSAiQ2FsbEV4cHJlc3Npb24iIHx8IChuMi5vcHRpb25hbCA9IGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgICAgfQogICAgICAgICAgaGFzUHJvcGVydHlBc1ByaXZhdGVOYW1lKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0My50eXBlID09PSAiQ2hhaW5FeHByZXNzaW9uIiAmJiAodDMgPSB0My5leHByZXNzaW9uKSwgc3VwZXIuaGFzUHJvcGVydHlBc1ByaXZhdGVOYW1lKHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIGlzT3B0aW9uYWxDaGFpbih0MykgewogICAgICAgICAgICByZXR1cm4gdDMudHlwZSA9PT0gIkNoYWluRXhwcmVzc2lvbiI7CiAgICAgICAgICB9CiAgICAgICAgICBpc09iamVjdFByb3BlcnR5KHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0My50eXBlID09PSAiUHJvcGVydHkiICYmIHQzLmtpbmQgPT09ICJpbml0IiAmJiAhdDMubWV0aG9kOwogICAgICAgICAgfQogICAgICAgICAgaXNPYmplY3RNZXRob2QodDMpIHsKICAgICAgICAgICAgcmV0dXJuIHQzLm1ldGhvZCB8fCB0My5raW5kID09PSAiZ2V0IiB8fCB0My5raW5kID09PSAic2V0IjsKICAgICAgICAgIH0KICAgICAgICB9LCBqc3g6ICh0MikgPT4gY2xhc3MgZXh0ZW5kcyB0MiB7CiAgICAgICAgICBqc3hSZWFkVG9rZW4oKSB7CiAgICAgICAgICAgIGxldCB0MyA9ICIiLCBlMiA9IHRoaXMuc3RhdGUucG9zOwogICAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5wb3MgPj0gdGhpcy5sZW5ndGgpCiAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIFlsLlVudGVybWluYXRlZEpzeENvbnRlbnQpOwogICAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zKTsKICAgICAgICAgICAgICBzd2l0Y2ggKHMyKSB7CiAgICAgICAgICAgICAgICBjYXNlIDYwOgogICAgICAgICAgICAgICAgY2FzZSAxMjM6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnBvcyA9PT0gdGhpcy5zdGF0ZS5zdGFydCA/IHMyID09PSA2MCAmJiB0aGlzLnN0YXRlLmNhblN0YXJ0SlNYRWxlbWVudCA/ICgrK3RoaXMuc3RhdGUucG9zLCB0aGlzLmZpbmlzaFRva2VuKDEzMikpIDogc3VwZXIuZ2V0VG9rZW5Gcm9tQ29kZShzMikgOiAodDMgKz0gdGhpcy5pbnB1dC5zbGljZShlMiwgdGhpcy5zdGF0ZS5wb3MpLCB0aGlzLmZpbmlzaFRva2VuKDEzMSwgdDMpKTsKICAgICAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgICAgICAgIHQzICs9IHRoaXMuaW5wdXQuc2xpY2UoZTIsIHRoaXMuc3RhdGUucG9zKSwgdDMgKz0gdGhpcy5qc3hSZWFkRW50aXR5KCksIGUyID0gdGhpcy5zdGF0ZS5wb3M7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgaWMoczIpID8gKHQzICs9IHRoaXMuaW5wdXQuc2xpY2UoZTIsIHRoaXMuc3RhdGUucG9zKSwgdDMgKz0gdGhpcy5qc3hSZWFkTmV3TGluZSh0cnVlKSwgZTIgPSB0aGlzLnN0YXRlLnBvcykgOiArK3RoaXMuc3RhdGUucG9zOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAganN4UmVhZE5ld0xpbmUodDMpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MpOwogICAgICAgICAgICBsZXQgczI7CiAgICAgICAgICAgIHJldHVybiArK3RoaXMuc3RhdGUucG9zLCBlMiA9PT0gMTMgJiYgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zKSA9PT0gMTAgPyAoKyt0aGlzLnN0YXRlLnBvcywgczIgPSB0MyA/ICJcbiIgOiAiXHJcbiIpIDogczIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGUyKSwgKyt0aGlzLnN0YXRlLmN1ckxpbmUsIHRoaXMuc3RhdGUubGluZVN0YXJ0ID0gdGhpcy5zdGF0ZS5wb3MsIHMyOwogICAgICAgICAgfQogICAgICAgICAganN4UmVhZFN0cmluZyh0MykgewogICAgICAgICAgICBsZXQgZTIgPSAiIiwgczIgPSArK3RoaXMuc3RhdGUucG9zOwogICAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5wb3MgPj0gdGhpcy5sZW5ndGgpCiAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIERjLlVudGVybWluYXRlZFN0cmluZyk7CiAgICAgICAgICAgICAgY29uc3QgcjIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MpOwogICAgICAgICAgICAgIGlmIChyMiA9PT0gdDMpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICByMiA9PT0gMzggPyAoZTIgKz0gdGhpcy5pbnB1dC5zbGljZShzMiwgdGhpcy5zdGF0ZS5wb3MpLCBlMiArPSB0aGlzLmpzeFJlYWRFbnRpdHkoKSwgczIgPSB0aGlzLnN0YXRlLnBvcykgOiBpYyhyMikgPyAoZTIgKz0gdGhpcy5pbnB1dC5zbGljZShzMiwgdGhpcy5zdGF0ZS5wb3MpLCBlMiArPSB0aGlzLmpzeFJlYWROZXdMaW5lKGZhbHNlKSwgczIgPSB0aGlzLnN0YXRlLnBvcykgOiArK3RoaXMuc3RhdGUucG9zOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlMiArPSB0aGlzLmlucHV0LnNsaWNlKHMyLCB0aGlzLnN0YXRlLnBvcysrKSwgdGhpcy5maW5pc2hUb2tlbigxMjMsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIGpzeFJlYWRFbnRpdHkoKSB7CiAgICAgICAgICAgIGxldCB0MywgZTIgPSAiIiwgczIgPSAwLCByMiA9IHRoaXMuaW5wdXRbdGhpcy5zdGF0ZS5wb3NdOwogICAgICAgICAgICBjb25zdCBpMiA9ICsrdGhpcy5zdGF0ZS5wb3M7CiAgICAgICAgICAgIGZvciAoOyB0aGlzLnN0YXRlLnBvcyA8IHRoaXMubGVuZ3RoICYmIHMyKysgPCAxMDsgKSB7CiAgICAgICAgICAgICAgaWYgKHIyID0gdGhpcy5pbnB1dFt0aGlzLnN0YXRlLnBvcysrXSwgcjIgPT09ICI7IikgewogICAgICAgICAgICAgICAgZTJbMF0gPT09ICIjIiA/IGUyWzFdID09PSAieCIgPyAoZTIgPSBlMi5zdWJzdHIoMiksIEpsLnRlc3QoZTIpICYmICh0MyA9IFN0cmluZy5mcm9tQ29kZVBvaW50KHBhcnNlSW50KGUyLCAxNikpKSkgOiAoZTIgPSBlMi5zdWJzdHIoMSksICRsLnRlc3QoZTIpICYmICh0MyA9IFN0cmluZy5mcm9tQ29kZVBvaW50KHBhcnNlSW50KGUyLCAxMCkpKSkgOiB0MyA9IFhsW2UyXTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlMiArPSByMjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDMgfHwgKHRoaXMuc3RhdGUucG9zID0gaTIsICImIik7CiAgICAgICAgICB9CiAgICAgICAgICBqc3hSZWFkV29yZCgpIHsKICAgICAgICAgICAgbGV0IHQzOwogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhdGUucG9zOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgdDMgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQoKyt0aGlzLnN0YXRlLnBvcyk7CiAgICAgICAgICAgIH0gd2hpbGUgKHNsKHQzKSB8fCB0MyA9PT0gNDUpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5maW5pc2hUb2tlbigxMzAsIHRoaXMuaW5wdXQuc2xpY2UoZTIsIHRoaXMuc3RhdGUucG9zKSk7CiAgICAgICAgICB9CiAgICAgICAgICBqc3hQYXJzZUlkZW50aWZpZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goMTMwKSA/IHQzLm5hbWUgPSB0aGlzLnN0YXRlLnZhbHVlIDogcWModGhpcy5zdGF0ZS50eXBlKSA/IHQzLm5hbWUgPSBXYyh0aGlzLnN0YXRlLnR5cGUpIDogdGhpcy51bmV4cGVjdGVkKCksIHRoaXMubmV4dCgpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJKU1hJZGVudGlmaWVyIik7CiAgICAgICAgICB9CiAgICAgICAgICBqc3hQYXJzZU5hbWVzcGFjZWROYW1lKCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhdGUuc3RhcnQsIGUyID0gdGhpcy5zdGF0ZS5zdGFydExvYywgczIgPSB0aGlzLmpzeFBhcnNlSWRlbnRpZmllcigpOwogICAgICAgICAgICBpZiAoIXRoaXMuZWF0KDE0KSkKICAgICAgICAgICAgICByZXR1cm4gczI7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGFydE5vZGVBdCh0MywgZTIpOwogICAgICAgICAgICByZXR1cm4gcjIubmFtZXNwYWNlID0gczIsIHIyLm5hbWUgPSB0aGlzLmpzeFBhcnNlSWRlbnRpZmllcigpLCB0aGlzLmZpbmlzaE5vZGUocjIsICJKU1hOYW1lc3BhY2VkTmFtZSIpOwogICAgICAgICAgfQogICAgICAgICAganN4UGFyc2VFbGVtZW50TmFtZSgpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXRlLnN0YXJ0LCBlMiA9IHRoaXMuc3RhdGUuc3RhcnRMb2M7CiAgICAgICAgICAgIGxldCBzMiA9IHRoaXMuanN4UGFyc2VOYW1lc3BhY2VkTmFtZSgpOwogICAgICAgICAgICBpZiAoczIudHlwZSA9PT0gIkpTWE5hbWVzcGFjZWROYW1lIikKICAgICAgICAgICAgICByZXR1cm4gczI7CiAgICAgICAgICAgIGZvciAoOyB0aGlzLmVhdCgxNik7ICkgewogICAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGFydE5vZGVBdCh0MywgZTIpOwogICAgICAgICAgICAgIHIyLm9iamVjdCA9IHMyLCByMi5wcm9wZXJ0eSA9IHRoaXMuanN4UGFyc2VJZGVudGlmaWVyKCksIHMyID0gdGhpcy5maW5pc2hOb2RlKHIyLCAiSlNYTWVtYmVyRXhwcmVzc2lvbiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzMjsKICAgICAgICAgIH0KICAgICAgICAgIGpzeFBhcnNlQXR0cmlidXRlVmFsdWUoKSB7CiAgICAgICAgICAgIGxldCB0MzsKICAgICAgICAgICAgc3dpdGNoICh0aGlzLnN0YXRlLnR5cGUpIHsKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICByZXR1cm4gdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpLCB0aGlzLm5leHQoKSwgdDMgPSB0aGlzLmpzeFBhcnNlRXhwcmVzc2lvbkNvbnRhaW5lcih0MyksIHQzLmV4cHJlc3Npb24udHlwZSA9PT0gIkpTWEVtcHR5RXhwcmVzc2lvbiIgJiYgdGhpcy5yYWlzZSh0My5zdGFydCwgWWwuQXR0cmlidXRlSXNFbXB0eSksIHQzOwogICAgICAgICAgICAgIGNhc2UgMTMyOgogICAgICAgICAgICAgIGNhc2UgMTIzOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VFeHByQXRvbSgpOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIFlsLlVuc3VwcG9ydGVkSnN4VmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBqc3hQYXJzZUVtcHR5RXhwcmVzc2lvbigpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZUF0KHRoaXMuc3RhdGUubGFzdFRva0VuZCwgdGhpcy5zdGF0ZS5sYXN0VG9rRW5kTG9jKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZUF0KHQzLCAiSlNYRW1wdHlFeHByZXNzaW9uIiwgdGhpcy5zdGF0ZS5zdGFydCwgdGhpcy5zdGF0ZS5zdGFydExvYyk7CiAgICAgICAgICB9CiAgICAgICAgICBqc3hQYXJzZVNwcmVhZENoaWxkKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdDMuZXhwcmVzc2lvbiA9IHRoaXMucGFyc2VFeHByZXNzaW9uKCksIHRoaXMuZXhwZWN0KDgpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJKU1hTcHJlYWRDaGlsZCIpOwogICAgICAgICAgfQogICAgICAgICAganN4UGFyc2VFeHByZXNzaW9uQ29udGFpbmVyKHQzKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDgpKQogICAgICAgICAgICAgIHQzLmV4cHJlc3Npb24gPSB0aGlzLmpzeFBhcnNlRW1wdHlFeHByZXNzaW9uKCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5wYXJzZUV4cHJlc3Npb24oKTsKICAgICAgICAgICAgICB0My5leHByZXNzaW9uID0gZTI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwZWN0KDgpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJKU1hFeHByZXNzaW9uQ29udGFpbmVyIik7CiAgICAgICAgICB9CiAgICAgICAgICBqc3hQYXJzZUF0dHJpYnV0ZSgpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5lYXQoNSkgPyAodGhpcy5leHBlY3QoMjEpLCB0My5hcmd1bWVudCA9IHRoaXMucGFyc2VNYXliZUFzc2lnbkFsbG93SW4oKSwgdGhpcy5leHBlY3QoOCksIHRoaXMuZmluaXNoTm9kZSh0MywgIkpTWFNwcmVhZEF0dHJpYnV0ZSIpKSA6ICh0My5uYW1lID0gdGhpcy5qc3hQYXJzZU5hbWVzcGFjZWROYW1lKCksIHQzLnZhbHVlID0gdGhpcy5lYXQoMjcpID8gdGhpcy5qc3hQYXJzZUF0dHJpYnV0ZVZhbHVlKCkgOiBudWxsLCB0aGlzLmZpbmlzaE5vZGUodDMsICJKU1hBdHRyaWJ1dGUiKSk7CiAgICAgICAgICB9CiAgICAgICAgICBqc3hQYXJzZU9wZW5pbmdFbGVtZW50QXQodDMsIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5zdGFydE5vZGVBdCh0MywgZTIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaCgxMzMpID8gKHRoaXMuZXhwZWN0KDEzMyksIHRoaXMuZmluaXNoTm9kZShzMiwgIkpTWE9wZW5pbmdGcmFnbWVudCIpKSA6IChzMi5uYW1lID0gdGhpcy5qc3hQYXJzZUVsZW1lbnROYW1lKCksIHRoaXMuanN4UGFyc2VPcGVuaW5nRWxlbWVudEFmdGVyTmFtZShzMikpOwogICAgICAgICAgfQogICAgICAgICAganN4UGFyc2VPcGVuaW5nRWxlbWVudEFmdGVyTmFtZSh0MykgewogICAgICAgICAgICBjb25zdCBlMiA9IFtdOwogICAgICAgICAgICBmb3IgKDsgIXRoaXMubWF0Y2goNTApICYmICF0aGlzLm1hdGNoKDEzMyk7ICkKICAgICAgICAgICAgICBlMi5wdXNoKHRoaXMuanN4UGFyc2VBdHRyaWJ1dGUoKSk7CiAgICAgICAgICAgIHJldHVybiB0My5hdHRyaWJ1dGVzID0gZTIsIHQzLnNlbGZDbG9zaW5nID0gdGhpcy5lYXQoNTApLCB0aGlzLmV4cGVjdCgxMzMpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJKU1hPcGVuaW5nRWxlbWVudCIpOwogICAgICAgICAgfQogICAgICAgICAganN4UGFyc2VDbG9zaW5nRWxlbWVudEF0KHQzLCBlMikgewogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhcnROb2RlQXQodDMsIGUyKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goMTMzKSA/ICh0aGlzLmV4cGVjdCgxMzMpLCB0aGlzLmZpbmlzaE5vZGUoczIsICJKU1hDbG9zaW5nRnJhZ21lbnQiKSkgOiAoczIubmFtZSA9IHRoaXMuanN4UGFyc2VFbGVtZW50TmFtZSgpLCB0aGlzLmV4cGVjdCgxMzMpLCB0aGlzLmZpbmlzaE5vZGUoczIsICJKU1hDbG9zaW5nRWxlbWVudCIpKTsKICAgICAgICAgIH0KICAgICAgICAgIGpzeFBhcnNlRWxlbWVudEF0KHQzLCBlMikgewogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhcnROb2RlQXQodDMsIGUyKSwgcjIgPSBbXSwgaTIgPSB0aGlzLmpzeFBhcnNlT3BlbmluZ0VsZW1lbnRBdCh0MywgZTIpOwogICAgICAgICAgICBsZXQgbjIgPSBudWxsOwogICAgICAgICAgICBpZiAoIWkyLnNlbGZDbG9zaW5nKSB7CiAgICAgICAgICAgICAgdDoKICAgICAgICAgICAgICAgIGZvciAoOyA7ICkKICAgICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLnN0YXRlLnR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEzMjoKICAgICAgICAgICAgICAgICAgICAgIGlmICh0MyA9IHRoaXMuc3RhdGUuc3RhcnQsIGUyID0gdGhpcy5zdGF0ZS5zdGFydExvYywgdGhpcy5uZXh0KCksIHRoaXMuZWF0KDUwKSkgewogICAgICAgICAgICAgICAgICAgICAgICBuMiA9IHRoaXMuanN4UGFyc2VDbG9zaW5nRWxlbWVudEF0KHQzLCBlMik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIHQ7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByMi5wdXNoKHRoaXMuanN4UGFyc2VFbGVtZW50QXQodDMsIGUyKSk7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEzMToKICAgICAgICAgICAgICAgICAgICAgIHIyLnB1c2godGhpcy5wYXJzZUV4cHJBdG9tKCkpOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OiB7CiAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0NCA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5leHQoKSwgdGhpcy5tYXRjaCgyMSkgPyByMi5wdXNoKHRoaXMuanN4UGFyc2VTcHJlYWRDaGlsZCh0NCkpIDogcjIucHVzaCh0aGlzLmpzeFBhcnNlRXhwcmVzc2lvbkNvbnRhaW5lcih0NCkpOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnVuZXhwZWN0ZWQoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIFFsKGkyKSAmJiAhUWwobjIpID8gdGhpcy5yYWlzZShuMi5zdGFydCwgWWwuTWlzc2luZ0Nsb3NpbmdUYWdGcmFnbWVudCkgOiAhUWwoaTIpICYmIFFsKG4yKSA/IHRoaXMucmFpc2UobjIuc3RhcnQsIFlsLk1pc3NpbmdDbG9zaW5nVGFnRWxlbWVudCwgWmwoaTIubmFtZSkpIDogUWwoaTIpIHx8IFFsKG4yKSB8fCBabChuMi5uYW1lKSAhPT0gWmwoaTIubmFtZSkgJiYgdGhpcy5yYWlzZShuMi5zdGFydCwgWWwuTWlzc2luZ0Nsb3NpbmdUYWdFbGVtZW50LCBabChpMi5uYW1lKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKFFsKGkyKSA/IChzMi5vcGVuaW5nRnJhZ21lbnQgPSBpMiwgczIuY2xvc2luZ0ZyYWdtZW50ID0gbjIpIDogKHMyLm9wZW5pbmdFbGVtZW50ID0gaTIsIHMyLmNsb3NpbmdFbGVtZW50ID0gbjIpLCBzMi5jaGlsZHJlbiA9IHIyLCB0aGlzLm1hdGNoKDQzKSkKICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIFlsLlVud3JhcHBlZEFkamFjZW50SlNYRWxlbWVudHMpOwogICAgICAgICAgICByZXR1cm4gUWwoaTIpID8gdGhpcy5maW5pc2hOb2RlKHMyLCAiSlNYRnJhZ21lbnQiKSA6IHRoaXMuZmluaXNoTm9kZShzMiwgIkpTWEVsZW1lbnQiKTsKICAgICAgICAgIH0KICAgICAgICAgIGpzeFBhcnNlRWxlbWVudCgpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXRlLnN0YXJ0LCBlMiA9IHRoaXMuc3RhdGUuc3RhcnRMb2M7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5qc3hQYXJzZUVsZW1lbnRBdCh0MywgZTIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHByQXRvbSh0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaCgxMzEpID8gdGhpcy5wYXJzZUxpdGVyYWwodGhpcy5zdGF0ZS52YWx1ZSwgIkpTWFRleHQiKSA6IHRoaXMubWF0Y2goMTMyKSA/IHRoaXMuanN4UGFyc2VFbGVtZW50KCkgOiB0aGlzLm1hdGNoKDQzKSAmJiB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MpICE9PSAzMyA/ICh0aGlzLnJlcGxhY2VUb2tlbigxMzIpLCB0aGlzLmpzeFBhcnNlRWxlbWVudCgpKSA6IHN1cGVyLnBhcnNlRXhwckF0b20odDMpOwogICAgICAgICAgfQogICAgICAgICAgZ2V0VG9rZW5Gcm9tQ29kZSh0MykgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuY3VyQ29udGV4dCgpOwogICAgICAgICAgICBpZiAoZTIgPT09IEFjLmpfZXhwcikKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5qc3hSZWFkVG9rZW4oKTsKICAgICAgICAgICAgaWYgKGUyID09PSBBYy5qX29UYWcgfHwgZTIgPT09IEFjLmpfY1RhZykgewogICAgICAgICAgICAgIGlmIChlbCh0MykpCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5qc3hSZWFkV29yZCgpOwogICAgICAgICAgICAgIGlmICh0MyA9PT0gNjIpCiAgICAgICAgICAgICAgICByZXR1cm4gKyt0aGlzLnN0YXRlLnBvcywgdGhpcy5maW5pc2hUb2tlbigxMzMpOwogICAgICAgICAgICAgIGlmICgodDMgPT09IDM0IHx8IHQzID09PSAzOSkgJiYgZTIgPT09IEFjLmpfb1RhZykKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmpzeFJlYWRTdHJpbmcodDMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0MyA9PT0gNjAgJiYgdGhpcy5zdGF0ZS5jYW5TdGFydEpTWEVsZW1lbnQgJiYgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zICsgMSkgIT09IDMzID8gKCsrdGhpcy5zdGF0ZS5wb3MsIHRoaXMuZmluaXNoVG9rZW4oMTMyKSkgOiBzdXBlci5nZXRUb2tlbkZyb21Db2RlKHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIHVwZGF0ZUNvbnRleHQodDMpIHsKICAgICAgICAgICAgc3VwZXIudXBkYXRlQ29udGV4dCh0Myk7CiAgICAgICAgICAgIGNvbnN0IHsgY29udGV4dDogZTIsIHR5cGU6IHMyIH0gPSB0aGlzLnN0YXRlOwogICAgICAgICAgICBpZiAoczIgPT09IDUwICYmIHQzID09PSAxMzIpCiAgICAgICAgICAgICAgZTIuc3BsaWNlKC0yLCAyLCBBYy5qX2NUYWcpLCB0aGlzLnN0YXRlLmNhblN0YXJ0SlNYRWxlbWVudCA9IGZhbHNlOwogICAgICAgICAgICBlbHNlIGlmIChzMiA9PT0gMTMyKQogICAgICAgICAgICAgIGUyLnB1c2goQWMual9leHByLCBBYy5qX29UYWcpOwogICAgICAgICAgICBlbHNlIGlmIChzMiA9PT0gMTMzKSB7CiAgICAgICAgICAgICAgY29uc3QgczMgPSBlMi5wb3AoKTsKICAgICAgICAgICAgICBzMyA9PT0gQWMual9vVGFnICYmIHQzID09PSA1MCB8fCBzMyA9PT0gQWMual9jVGFnID8gKGUyLnBvcCgpLCB0aGlzLnN0YXRlLmNhblN0YXJ0SlNYRWxlbWVudCA9IGUyW2UyLmxlbmd0aCAtIDFdID09PSBBYy5qX2V4cHIpIDogdGhpcy5zdGF0ZS5jYW5TdGFydEpTWEVsZW1lbnQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICB0aGlzLnN0YXRlLmNhblN0YXJ0SlNYRWxlbWVudCA9IGtjW3MyXTsKICAgICAgICAgIH0KICAgICAgICB9LCBmbG93OiAodDIpID0+IGNsYXNzIGV4dGVuZHMgdDIgewogICAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyksIHRoaXMuZmxvd1ByYWdtYSA9IHZvaWQgMDsKICAgICAgICAgIH0KICAgICAgICAgIGdldFNjb3BlSGFuZGxlcigpIHsKICAgICAgICAgICAgcmV0dXJuIEZsOwogICAgICAgICAgfQogICAgICAgICAgc2hvdWxkUGFyc2VUeXBlcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGx1Z2luT3B0aW9uKCJmbG93IiwgImFsbCIpIHx8IHRoaXMuZmxvd1ByYWdtYSA9PT0gImZsb3ciOwogICAgICAgICAgfQogICAgICAgICAgc2hvdWxkUGFyc2VFbnVtcygpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5nZXRQbHVnaW5PcHRpb24oImZsb3ciLCAiZW51bXMiKTsKICAgICAgICAgIH0KICAgICAgICAgIGZpbmlzaFRva2VuKHQzLCBlMikgewogICAgICAgICAgICByZXR1cm4gdDMgIT09IDEyMyAmJiB0MyAhPT0gMTMgJiYgdDMgIT09IDI2ICYmIHRoaXMuZmxvd1ByYWdtYSA9PT0gdm9pZCAwICYmICh0aGlzLmZsb3dQcmFnbWEgPSBudWxsKSwgc3VwZXIuZmluaXNoVG9rZW4odDMsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIGFkZENvbW1lbnQodDMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZmxvd1ByYWdtYSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSBHbC5leGVjKHQzLnZhbHVlKTsKICAgICAgICAgICAgICBpZiAoZTIpCiAgICAgICAgICAgICAgICBpZiAoZTJbMV0gPT09ICJmbG93IikKICAgICAgICAgICAgICAgICAgdGhpcy5mbG93UHJhZ21hID0gImZsb3ciOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIGlmIChlMlsxXSAhPT0gIm5vZmxvdyIpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkIGZsb3cgcHJhZ21hIik7CiAgICAgICAgICAgICAgICAgIHRoaXMuZmxvd1ByYWdtYSA9ICJub2Zsb3ciOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc3VwZXIuYWRkQ29tbWVudCh0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VUeXBlSW5pdGlhbGlzZXIodDMpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXRlLmluVHlwZTsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5pblR5cGUgPSB0cnVlLCB0aGlzLmV4cGVjdCh0MyB8fCAxNCk7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5mbG93UGFyc2VUeXBlKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmluVHlwZSA9IGUyLCBzMjsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZVByZWRpY2F0ZSgpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpLCBlMiA9IHRoaXMuc3RhdGUuc3RhcnQ7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5leHBlY3RDb250ZXh0dWFsKDEwMSksIHRoaXMuc3RhdGUubGFzdFRva1N0YXJ0ID4gZTIgKyAxICYmIHRoaXMucmFpc2UoZTIsIFZsLlVuZXhwZWN0ZWRTcGFjZUJldHdlZW5Nb2R1bG9DaGVja3MpLCB0aGlzLmVhdCgxMCkgPyAodDMudmFsdWUgPSB0aGlzLnBhcnNlRXhwcmVzc2lvbigpLCB0aGlzLmV4cGVjdCgxMSksIHRoaXMuZmluaXNoTm9kZSh0MywgIkRlY2xhcmVkUHJlZGljYXRlIikpIDogdGhpcy5maW5pc2hOb2RlKHQzLCAiSW5mZXJyZWRQcmVkaWNhdGUiKTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZVR5cGVBbmRQcmVkaWNhdGVJbml0aWFsaXNlcigpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXRlLmluVHlwZTsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5pblR5cGUgPSB0cnVlLCB0aGlzLmV4cGVjdCgxNCk7CiAgICAgICAgICAgIGxldCBlMiA9IG51bGwsIHMyID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goNDgpID8gKHRoaXMuc3RhdGUuaW5UeXBlID0gdDMsIHMyID0gdGhpcy5mbG93UGFyc2VQcmVkaWNhdGUoKSkgOiAoZTIgPSB0aGlzLmZsb3dQYXJzZVR5cGUoKSwgdGhpcy5zdGF0ZS5pblR5cGUgPSB0MywgdGhpcy5tYXRjaCg0OCkgJiYgKHMyID0gdGhpcy5mbG93UGFyc2VQcmVkaWNhdGUoKSkpLCBbZTIsIHMyXTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZURlY2xhcmVDbGFzcyh0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMuZmxvd1BhcnNlSW50ZXJmYWNlaXNoKHQzLCB0cnVlKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiRGVjbGFyZUNsYXNzIik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VEZWNsYXJlRnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdDMuaWQgPSB0aGlzLnBhcnNlSWRlbnRpZmllcigpLCBzMiA9IHRoaXMuc3RhcnROb2RlKCksIHIyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgdGhpcy5tYXRjaCg0MykgPyBzMi50eXBlUGFyYW1ldGVycyA9IHRoaXMuZmxvd1BhcnNlVHlwZVBhcmFtZXRlckRlY2xhcmF0aW9uKCkgOiBzMi50eXBlUGFyYW1ldGVycyA9IG51bGwsIHRoaXMuZXhwZWN0KDEwKTsKICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLmZsb3dQYXJzZUZ1bmN0aW9uVHlwZVBhcmFtcygpOwogICAgICAgICAgICByZXR1cm4gczIucGFyYW1zID0gaTIucGFyYW1zLCBzMi5yZXN0ID0gaTIucmVzdCwgczIudGhpcyA9IGkyLl90aGlzLCB0aGlzLmV4cGVjdCgxMSksIFtzMi5yZXR1cm5UeXBlLCB0My5wcmVkaWNhdGVdID0gdGhpcy5mbG93UGFyc2VUeXBlQW5kUHJlZGljYXRlSW5pdGlhbGlzZXIoKSwgcjIudHlwZUFubm90YXRpb24gPSB0aGlzLmZpbmlzaE5vZGUoczIsICJGdW5jdGlvblR5cGVBbm5vdGF0aW9uIiksIGUyLnR5cGVBbm5vdGF0aW9uID0gdGhpcy5maW5pc2hOb2RlKHIyLCAiVHlwZUFubm90YXRpb24iKSwgdGhpcy5yZXNldEVuZExvY2F0aW9uKGUyKSwgdGhpcy5zZW1pY29sb24oKSwgdGhpcy5zY29wZS5kZWNsYXJlTmFtZSh0My5pZC5uYW1lLCAyMDQ4LCB0My5pZC5zdGFydCksIHRoaXMuZmluaXNoTm9kZSh0MywgIkRlY2xhcmVGdW5jdGlvbiIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlRGVjbGFyZSh0MywgZTIpIHsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goNzQpKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLmZsb3dQYXJzZURlY2xhcmVDbGFzcyh0Myk7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDYyKSkKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mbG93UGFyc2VEZWNsYXJlRnVuY3Rpb24odDMpOwogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCg2OCkpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmxvd1BhcnNlRGVjbGFyZVZhcmlhYmxlKHQzKTsKICAgICAgICAgICAgaWYgKHRoaXMuZWF0Q29udGV4dHVhbCgxMTcpKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDE2KSA/IHRoaXMuZmxvd1BhcnNlRGVjbGFyZU1vZHVsZUV4cG9ydHModDMpIDogKGUyICYmIHRoaXMucmFpc2UodGhpcy5zdGF0ZS5sYXN0VG9rU3RhcnQsIFZsLk5lc3RlZERlY2xhcmVNb2R1bGUpLCB0aGlzLmZsb3dQYXJzZURlY2xhcmVNb2R1bGUodDMpKTsKICAgICAgICAgICAgaWYgKHRoaXMuaXNDb250ZXh0dWFsKDEyMCkpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmxvd1BhcnNlRGVjbGFyZVR5cGVBbGlhcyh0Myk7CiAgICAgICAgICAgIGlmICh0aGlzLmlzQ29udGV4dHVhbCgxMjEpKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLmZsb3dQYXJzZURlY2xhcmVPcGFxdWVUeXBlKHQzKTsKICAgICAgICAgICAgaWYgKHRoaXMuaXNDb250ZXh0dWFsKDExOSkpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmxvd1BhcnNlRGVjbGFyZUludGVyZmFjZSh0Myk7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDc2KSkKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mbG93UGFyc2VEZWNsYXJlRXhwb3J0RGVjbGFyYXRpb24odDMsIGUyKTsKICAgICAgICAgICAgdGhyb3cgdGhpcy51bmV4cGVjdGVkKCk7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VEZWNsYXJlVmFyaWFibGUodDMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0My5pZCA9IHRoaXMuZmxvd1BhcnNlVHlwZUFubm90YXRhYmxlSWRlbnRpZmllcih0cnVlKSwgdGhpcy5zY29wZS5kZWNsYXJlTmFtZSh0My5pZC5uYW1lLCA1LCB0My5pZC5zdGFydCksIHRoaXMuc2VtaWNvbG9uKCksIHRoaXMuZmluaXNoTm9kZSh0MywgIkRlY2xhcmVWYXJpYWJsZSIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlRGVjbGFyZU1vZHVsZSh0MykgewogICAgICAgICAgICB0aGlzLnNjb3BlLmVudGVyKDApLCB0aGlzLm1hdGNoKDEyMykgPyB0My5pZCA9IHRoaXMucGFyc2VFeHByQXRvbSgpIDogdDMuaWQgPSB0aGlzLnBhcnNlSWRlbnRpZmllcigpOwogICAgICAgICAgICBjb25zdCBlMiA9IHQzLmJvZHkgPSB0aGlzLnN0YXJ0Tm9kZSgpLCBzMiA9IGUyLmJvZHkgPSBbXTsKICAgICAgICAgICAgZm9yICh0aGlzLmV4cGVjdCg1KTsgIXRoaXMubWF0Y2goOCk7ICkgewogICAgICAgICAgICAgIGxldCB0NCA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgICAgdGhpcy5tYXRjaCg3NykgPyAodGhpcy5uZXh0KCksIHRoaXMuaXNDb250ZXh0dWFsKDEyMCkgfHwgdGhpcy5tYXRjaCg4MSkgfHwgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLmxhc3RUb2tTdGFydCwgVmwuSW52YWxpZE5vblR5cGVJbXBvcnRJbkRlY2xhcmVNb2R1bGUpLCB0aGlzLnBhcnNlSW1wb3J0KHQ0KSkgOiAodGhpcy5leHBlY3RDb250ZXh0dWFsKDExNSwgVmwuVW5zdXBwb3J0ZWRTdGF0ZW1lbnRJbkRlY2xhcmVNb2R1bGUpLCB0NCA9IHRoaXMuZmxvd1BhcnNlRGVjbGFyZSh0NCwgdHJ1ZSkpLCBzMi5wdXNoKHQ0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNjb3BlLmV4aXQoKSwgdGhpcy5leHBlY3QoOCksIHRoaXMuZmluaXNoTm9kZShlMiwgIkJsb2NrU3RhdGVtZW50Iik7CiAgICAgICAgICAgIGxldCByMiA9IG51bGwsIGkyID0gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiBzMi5mb3JFYWNoKCh0NCkgPT4gewogICAgICAgICAgICAgICFmdW5jdGlvbih0NSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHQ1LnR5cGUgPT09ICJEZWNsYXJlRXhwb3J0QWxsRGVjbGFyYXRpb24iIHx8IHQ1LnR5cGUgPT09ICJEZWNsYXJlRXhwb3J0RGVjbGFyYXRpb24iICYmICghdDUuZGVjbGFyYXRpb24gfHwgdDUuZGVjbGFyYXRpb24udHlwZSAhPT0gIlR5cGVBbGlhcyIgJiYgdDUuZGVjbGFyYXRpb24udHlwZSAhPT0gIkludGVyZmFjZURlY2xhcmF0aW9uIik7CiAgICAgICAgICAgICAgfSh0NCkgPyB0NC50eXBlID09PSAiRGVjbGFyZU1vZHVsZUV4cG9ydHMiICYmIChpMiAmJiB0aGlzLnJhaXNlKHQ0LnN0YXJ0LCBWbC5EdXBsaWNhdGVEZWNsYXJlTW9kdWxlRXhwb3J0cyksIHIyID09PSAiRVMiICYmIHRoaXMucmFpc2UodDQuc3RhcnQsIFZsLkFtYmlndW91c0RlY2xhcmVNb2R1bGVLaW5kKSwgcjIgPSAiQ29tbW9uSlMiLCBpMiA9IHRydWUpIDogKHIyID09PSAiQ29tbW9uSlMiICYmIHRoaXMucmFpc2UodDQuc3RhcnQsIFZsLkFtYmlndW91c0RlY2xhcmVNb2R1bGVLaW5kKSwgcjIgPSAiRVMiKTsKICAgICAgICAgICAgfSksIHQzLmtpbmQgPSByMiB8fCAiQ29tbW9uSlMiLCB0aGlzLmZpbmlzaE5vZGUodDMsICJEZWNsYXJlTW9kdWxlIik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VEZWNsYXJlRXhwb3J0RGVjbGFyYXRpb24odDMsIGUyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmV4cGVjdCg3NiksIHRoaXMuZWF0KDU5KSkKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaCg2MikgfHwgdGhpcy5tYXRjaCg3NCkgPyB0My5kZWNsYXJhdGlvbiA9IHRoaXMuZmxvd1BhcnNlRGVjbGFyZSh0aGlzLnN0YXJ0Tm9kZSgpKSA6ICh0My5kZWNsYXJhdGlvbiA9IHRoaXMuZmxvd1BhcnNlVHlwZSgpLCB0aGlzLnNlbWljb2xvbigpKSwgdDMuZGVmYXVsdCA9IHRydWUsIHRoaXMuZmluaXNoTm9kZSh0MywgIkRlY2xhcmVFeHBvcnREZWNsYXJhdGlvbiIpOwogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCg2OSkgfHwgdGhpcy5pc0xldCgpIHx8ICh0aGlzLmlzQ29udGV4dHVhbCgxMjApIHx8IHRoaXMuaXNDb250ZXh0dWFsKDExOSkpICYmICFlMikgewogICAgICAgICAgICAgIGNvbnN0IHQ0ID0gdGhpcy5zdGF0ZS52YWx1ZSwgZTMgPSBLbFt0NF07CiAgICAgICAgICAgICAgdGhyb3cgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0LCBWbC5VbnN1cHBvcnRlZERlY2xhcmVFeHBvcnRLaW5kLCB0NCwgZTMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDY4KSB8fCB0aGlzLm1hdGNoKDYyKSB8fCB0aGlzLm1hdGNoKDc0KSB8fCB0aGlzLmlzQ29udGV4dHVhbCgxMjEpKQogICAgICAgICAgICAgIHJldHVybiB0My5kZWNsYXJhdGlvbiA9IHRoaXMuZmxvd1BhcnNlRGVjbGFyZSh0aGlzLnN0YXJ0Tm9kZSgpKSwgdDMuZGVmYXVsdCA9IGZhbHNlLCB0aGlzLmZpbmlzaE5vZGUodDMsICJEZWNsYXJlRXhwb3J0RGVjbGFyYXRpb24iKTsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goNDkpIHx8IHRoaXMubWF0Y2goNSkgfHwgdGhpcy5pc0NvbnRleHR1YWwoMTE5KSB8fCB0aGlzLmlzQ29udGV4dHVhbCgxMjApIHx8IHRoaXMuaXNDb250ZXh0dWFsKDEyMSkpCiAgICAgICAgICAgICAgcmV0dXJuICh0MyA9IHRoaXMucGFyc2VFeHBvcnQodDMpKS50eXBlID09PSAiRXhwb3J0TmFtZWREZWNsYXJhdGlvbiIgJiYgKHQzLnR5cGUgPSAiRXhwb3J0RGVjbGFyYXRpb24iLCB0My5kZWZhdWx0ID0gZmFsc2UsIGRlbGV0ZSB0My5leHBvcnRLaW5kKSwgdDMudHlwZSA9ICJEZWNsYXJlIiArIHQzLnR5cGUsIHQzOwogICAgICAgICAgICB0aHJvdyB0aGlzLnVuZXhwZWN0ZWQoKTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZURlY2xhcmVNb2R1bGVFeHBvcnRzKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5leHBlY3RDb250ZXh0dWFsKDEwMiksIHQzLnR5cGVBbm5vdGF0aW9uID0gdGhpcy5mbG93UGFyc2VUeXBlQW5ub3RhdGlvbigpLCB0aGlzLnNlbWljb2xvbigpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJEZWNsYXJlTW9kdWxlRXhwb3J0cyIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlRGVjbGFyZVR5cGVBbGlhcyh0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMuZmxvd1BhcnNlVHlwZUFsaWFzKHQzKSwgdDMudHlwZSA9ICJEZWNsYXJlVHlwZUFsaWFzIiwgdDM7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VEZWNsYXJlT3BhcXVlVHlwZSh0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMuZmxvd1BhcnNlT3BhcXVlVHlwZSh0MywgdHJ1ZSksIHQzLnR5cGUgPSAiRGVjbGFyZU9wYXF1ZVR5cGUiLCB0MzsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZURlY2xhcmVJbnRlcmZhY2UodDMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0aGlzLmZsb3dQYXJzZUludGVyZmFjZWlzaCh0MyksIHRoaXMuZmluaXNoTm9kZSh0MywgIkRlY2xhcmVJbnRlcmZhY2UiKTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZUludGVyZmFjZWlzaCh0MykgewogICAgICAgICAgICBsZXQgZTIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCAmJiBhcmd1bWVudHNbMV07CiAgICAgICAgICAgIGlmICh0My5pZCA9IHRoaXMuZmxvd1BhcnNlUmVzdHJpY3RlZElkZW50aWZpZXIoIWUyLCB0cnVlKSwgdGhpcy5zY29wZS5kZWNsYXJlTmFtZSh0My5pZC5uYW1lLCBlMiA/IDE3IDogOSwgdDMuaWQuc3RhcnQpLCB0aGlzLm1hdGNoKDQzKSA/IHQzLnR5cGVQYXJhbWV0ZXJzID0gdGhpcy5mbG93UGFyc2VUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24oKSA6IHQzLnR5cGVQYXJhbWV0ZXJzID0gbnVsbCwgdDMuZXh0ZW5kcyA9IFtdLCB0My5pbXBsZW1lbnRzID0gW10sIHQzLm1peGlucyA9IFtdLCB0aGlzLmVhdCg3NSkpCiAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgdDMuZXh0ZW5kcy5wdXNoKHRoaXMuZmxvd1BhcnNlSW50ZXJmYWNlRXh0ZW5kcygpKTsKICAgICAgICAgICAgICB9IHdoaWxlICghZTIgJiYgdGhpcy5lYXQoMTIpKTsKICAgICAgICAgICAgaWYgKHRoaXMuaXNDb250ZXh0dWFsKDEwOCkpIHsKICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICB0My5taXhpbnMucHVzaCh0aGlzLmZsb3dQYXJzZUludGVyZmFjZUV4dGVuZHMoKSk7CiAgICAgICAgICAgICAgfSB3aGlsZSAodGhpcy5lYXQoMTIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5pc0NvbnRleHR1YWwoMTA0KSkgewogICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIHQzLmltcGxlbWVudHMucHVzaCh0aGlzLmZsb3dQYXJzZUludGVyZmFjZUV4dGVuZHMoKSk7CiAgICAgICAgICAgICAgfSB3aGlsZSAodGhpcy5lYXQoMTIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0My5ib2R5ID0gdGhpcy5mbG93UGFyc2VPYmplY3RUeXBlKHsgYWxsb3dTdGF0aWM6IGUyLCBhbGxvd0V4YWN0OiBmYWxzZSwgYWxsb3dTcHJlYWQ6IGZhbHNlLCBhbGxvd1Byb3RvOiBlMiwgYWxsb3dJbmV4YWN0OiBmYWxzZSB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZUludGVyZmFjZUV4dGVuZHMoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHQzLmlkID0gdGhpcy5mbG93UGFyc2VRdWFsaWZpZWRUeXBlSWRlbnRpZmllcigpLCB0aGlzLm1hdGNoKDQzKSA/IHQzLnR5cGVQYXJhbWV0ZXJzID0gdGhpcy5mbG93UGFyc2VUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbigpIDogdDMudHlwZVBhcmFtZXRlcnMgPSBudWxsLCB0aGlzLmZpbmlzaE5vZGUodDMsICJJbnRlcmZhY2VFeHRlbmRzIik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VJbnRlcmZhY2UodDMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmxvd1BhcnNlSW50ZXJmYWNlaXNoKHQzKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiSW50ZXJmYWNlRGVjbGFyYXRpb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIGNoZWNrTm90VW5kZXJzY29yZSh0MykgewogICAgICAgICAgICB0MyA9PT0gIl8iICYmIHRoaXMucmFpc2UodGhpcy5zdGF0ZS5zdGFydCwgVmwuVW5leHBlY3RlZFJlc2VydmVkVW5kZXJzY29yZSk7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja1Jlc2VydmVkVHlwZSh0MywgZTIsIHMyKSB7CiAgICAgICAgICAgIEhsLmhhcyh0MykgJiYgdGhpcy5yYWlzZShlMiwgczIgPyBWbC5Bc3NpZ25SZXNlcnZlZFR5cGUgOiBWbC5VbmV4cGVjdGVkUmVzZXJ2ZWRUeXBlLCB0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VSZXN0cmljdGVkSWRlbnRpZmllcih0MywgZTIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tSZXNlcnZlZFR5cGUodGhpcy5zdGF0ZS52YWx1ZSwgdGhpcy5zdGF0ZS5zdGFydCwgZTIpLCB0aGlzLnBhcnNlSWRlbnRpZmllcih0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VUeXBlQWxpYXModDMpIHsKICAgICAgICAgICAgcmV0dXJuIHQzLmlkID0gdGhpcy5mbG93UGFyc2VSZXN0cmljdGVkSWRlbnRpZmllcihmYWxzZSwgdHJ1ZSksIHRoaXMuc2NvcGUuZGVjbGFyZU5hbWUodDMuaWQubmFtZSwgOSwgdDMuaWQuc3RhcnQpLCB0aGlzLm1hdGNoKDQzKSA/IHQzLnR5cGVQYXJhbWV0ZXJzID0gdGhpcy5mbG93UGFyc2VUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24oKSA6IHQzLnR5cGVQYXJhbWV0ZXJzID0gbnVsbCwgdDMucmlnaHQgPSB0aGlzLmZsb3dQYXJzZVR5cGVJbml0aWFsaXNlcigyNyksIHRoaXMuc2VtaWNvbG9uKCksIHRoaXMuZmluaXNoTm9kZSh0MywgIlR5cGVBbGlhcyIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlT3BhcXVlVHlwZSh0MywgZTIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwZWN0Q29udGV4dHVhbCgxMjApLCB0My5pZCA9IHRoaXMuZmxvd1BhcnNlUmVzdHJpY3RlZElkZW50aWZpZXIodHJ1ZSwgdHJ1ZSksIHRoaXMuc2NvcGUuZGVjbGFyZU5hbWUodDMuaWQubmFtZSwgOSwgdDMuaWQuc3RhcnQpLCB0aGlzLm1hdGNoKDQzKSA/IHQzLnR5cGVQYXJhbWV0ZXJzID0gdGhpcy5mbG93UGFyc2VUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24oKSA6IHQzLnR5cGVQYXJhbWV0ZXJzID0gbnVsbCwgdDMuc3VwZXJ0eXBlID0gbnVsbCwgdGhpcy5tYXRjaCgxNCkgJiYgKHQzLnN1cGVydHlwZSA9IHRoaXMuZmxvd1BhcnNlVHlwZUluaXRpYWxpc2VyKDE0KSksIHQzLmltcGx0eXBlID0gbnVsbCwgZTIgfHwgKHQzLmltcGx0eXBlID0gdGhpcy5mbG93UGFyc2VUeXBlSW5pdGlhbGlzZXIoMjcpKSwgdGhpcy5zZW1pY29sb24oKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiT3BhcXVlVHlwZSIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlVHlwZVBhcmFtZXRlcigpIHsKICAgICAgICAgICAgbGV0IHQzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB2b2lkIDAgJiYgYXJndW1lbnRzWzBdOwogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhdGUuc3RhcnQsIHMyID0gdGhpcy5zdGFydE5vZGUoKSwgcjIgPSB0aGlzLmZsb3dQYXJzZVZhcmlhbmNlKCksIGkyID0gdGhpcy5mbG93UGFyc2VUeXBlQW5ub3RhdGFibGVJZGVudGlmaWVyKCk7CiAgICAgICAgICAgIHJldHVybiBzMi5uYW1lID0gaTIubmFtZSwgczIudmFyaWFuY2UgPSByMiwgczIuYm91bmQgPSBpMi50eXBlQW5ub3RhdGlvbiwgdGhpcy5tYXRjaCgyNykgPyAodGhpcy5lYXQoMjcpLCBzMi5kZWZhdWx0ID0gdGhpcy5mbG93UGFyc2VUeXBlKCkpIDogdDMgJiYgdGhpcy5yYWlzZShlMiwgVmwuTWlzc2luZ1R5cGVQYXJhbURlZmF1bHQpLCB0aGlzLmZpbmlzaE5vZGUoczIsICJUeXBlUGFyYW1ldGVyIik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24oKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGF0ZS5pblR5cGUsIGUyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgZTIucGFyYW1zID0gW10sIHRoaXMuc3RhdGUuaW5UeXBlID0gdHJ1ZSwgdGhpcy5tYXRjaCg0MykgfHwgdGhpcy5tYXRjaCgxMzIpID8gdGhpcy5uZXh0KCkgOiB0aGlzLnVuZXhwZWN0ZWQoKTsKICAgICAgICAgICAgbGV0IHMyID0gZmFsc2U7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBjb25zdCB0NCA9IHRoaXMuZmxvd1BhcnNlVHlwZVBhcmFtZXRlcihzMik7CiAgICAgICAgICAgICAgZTIucGFyYW1zLnB1c2godDQpLCB0NC5kZWZhdWx0ICYmIChzMiA9IHRydWUpLCB0aGlzLm1hdGNoKDQ0KSB8fCB0aGlzLmV4cGVjdCgxMik7CiAgICAgICAgICAgIH0gd2hpbGUgKCF0aGlzLm1hdGNoKDQ0KSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4cGVjdCg0NCksIHRoaXMuc3RhdGUuaW5UeXBlID0gdDMsIHRoaXMuZmluaXNoTm9kZShlMiwgIlR5cGVQYXJhbWV0ZXJEZWNsYXJhdGlvbiIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24oKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKSwgZTIgPSB0aGlzLnN0YXRlLmluVHlwZTsKICAgICAgICAgICAgdDMucGFyYW1zID0gW10sIHRoaXMuc3RhdGUuaW5UeXBlID0gdHJ1ZSwgdGhpcy5leHBlY3QoNDMpOwogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhdGUubm9Bbm9uRnVuY3Rpb25UeXBlOwogICAgICAgICAgICBmb3IgKHRoaXMuc3RhdGUubm9Bbm9uRnVuY3Rpb25UeXBlID0gZmFsc2U7ICF0aGlzLm1hdGNoKDQ0KTsgKQogICAgICAgICAgICAgIHQzLnBhcmFtcy5wdXNoKHRoaXMuZmxvd1BhcnNlVHlwZSgpKSwgdGhpcy5tYXRjaCg0NCkgfHwgdGhpcy5leHBlY3QoMTIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5ub0Fub25GdW5jdGlvblR5cGUgPSBzMiwgdGhpcy5leHBlY3QoNDQpLCB0aGlzLnN0YXRlLmluVHlwZSA9IGUyLCB0aGlzLmZpbmlzaE5vZGUodDMsICJUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbiIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb25DYWxsT3JOZXcoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKSwgZTIgPSB0aGlzLnN0YXRlLmluVHlwZTsKICAgICAgICAgICAgZm9yICh0My5wYXJhbXMgPSBbXSwgdGhpcy5zdGF0ZS5pblR5cGUgPSB0cnVlLCB0aGlzLmV4cGVjdCg0Myk7ICF0aGlzLm1hdGNoKDQ0KTsgKQogICAgICAgICAgICAgIHQzLnBhcmFtcy5wdXNoKHRoaXMuZmxvd1BhcnNlVHlwZU9ySW1wbGljaXRJbnN0YW50aWF0aW9uKCkpLCB0aGlzLm1hdGNoKDQ0KSB8fCB0aGlzLmV4cGVjdCgxMik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4cGVjdCg0NCksIHRoaXMuc3RhdGUuaW5UeXBlID0gZTIsIHRoaXMuZmluaXNoTm9kZSh0MywgIlR5cGVQYXJhbWV0ZXJJbnN0YW50aWF0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VJbnRlcmZhY2VUeXBlKCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIGlmICh0aGlzLmV4cGVjdENvbnRleHR1YWwoMTE5KSwgdDMuZXh0ZW5kcyA9IFtdLCB0aGlzLmVhdCg3NSkpCiAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgdDMuZXh0ZW5kcy5wdXNoKHRoaXMuZmxvd1BhcnNlSW50ZXJmYWNlRXh0ZW5kcygpKTsKICAgICAgICAgICAgICB9IHdoaWxlICh0aGlzLmVhdCgxMikpOwogICAgICAgICAgICByZXR1cm4gdDMuYm9keSA9IHRoaXMuZmxvd1BhcnNlT2JqZWN0VHlwZSh7IGFsbG93U3RhdGljOiBmYWxzZSwgYWxsb3dFeGFjdDogZmFsc2UsIGFsbG93U3ByZWFkOiBmYWxzZSwgYWxsb3dQcm90bzogZmFsc2UsIGFsbG93SW5leGFjdDogZmFsc2UgfSksIHRoaXMuZmluaXNoTm9kZSh0MywgIkludGVyZmFjZVR5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VPYmplY3RQcm9wZXJ0eUtleSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goMTI0KSB8fCB0aGlzLm1hdGNoKDEyMykgPyB0aGlzLnBhcnNlRXhwckF0b20oKSA6IHRoaXMucGFyc2VJZGVudGlmaWVyKHRydWUpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlT2JqZWN0VHlwZUluZGV4ZXIodDMsIGUyLCBzMikgewogICAgICAgICAgICByZXR1cm4gdDMuc3RhdGljID0gZTIsIHRoaXMubG9va2FoZWFkKCkudHlwZSA9PT0gMTQgPyAodDMuaWQgPSB0aGlzLmZsb3dQYXJzZU9iamVjdFByb3BlcnR5S2V5KCksIHQzLmtleSA9IHRoaXMuZmxvd1BhcnNlVHlwZUluaXRpYWxpc2VyKCkpIDogKHQzLmlkID0gbnVsbCwgdDMua2V5ID0gdGhpcy5mbG93UGFyc2VUeXBlKCkpLCB0aGlzLmV4cGVjdCgzKSwgdDMudmFsdWUgPSB0aGlzLmZsb3dQYXJzZVR5cGVJbml0aWFsaXNlcigpLCB0My52YXJpYW5jZSA9IHMyLCB0aGlzLmZpbmlzaE5vZGUodDMsICJPYmplY3RUeXBlSW5kZXhlciIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlT2JqZWN0VHlwZUludGVybmFsU2xvdCh0MywgZTIpIHsKICAgICAgICAgICAgcmV0dXJuIHQzLnN0YXRpYyA9IGUyLCB0My5pZCA9IHRoaXMuZmxvd1BhcnNlT2JqZWN0UHJvcGVydHlLZXkoKSwgdGhpcy5leHBlY3QoMyksIHRoaXMuZXhwZWN0KDMpLCB0aGlzLm1hdGNoKDQzKSB8fCB0aGlzLm1hdGNoKDEwKSA/ICh0My5tZXRob2QgPSB0cnVlLCB0My5vcHRpb25hbCA9IGZhbHNlLCB0My52YWx1ZSA9IHRoaXMuZmxvd1BhcnNlT2JqZWN0VHlwZU1ldGhvZGlzaCh0aGlzLnN0YXJ0Tm9kZUF0KHQzLnN0YXJ0LCB0My5sb2Muc3RhcnQpKSkgOiAodDMubWV0aG9kID0gZmFsc2UsIHRoaXMuZWF0KDE3KSAmJiAodDMub3B0aW9uYWwgPSB0cnVlKSwgdDMudmFsdWUgPSB0aGlzLmZsb3dQYXJzZVR5cGVJbml0aWFsaXNlcigpKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiT2JqZWN0VHlwZUludGVybmFsU2xvdCIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlT2JqZWN0VHlwZU1ldGhvZGlzaCh0MykgewogICAgICAgICAgICBmb3IgKHQzLnBhcmFtcyA9IFtdLCB0My5yZXN0ID0gbnVsbCwgdDMudHlwZVBhcmFtZXRlcnMgPSBudWxsLCB0My50aGlzID0gbnVsbCwgdGhpcy5tYXRjaCg0MykgJiYgKHQzLnR5cGVQYXJhbWV0ZXJzID0gdGhpcy5mbG93UGFyc2VUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24oKSksIHRoaXMuZXhwZWN0KDEwKSwgdGhpcy5tYXRjaCg3MikgJiYgKHQzLnRoaXMgPSB0aGlzLmZsb3dQYXJzZUZ1bmN0aW9uVHlwZVBhcmFtKHRydWUpLCB0My50aGlzLm5hbWUgPSBudWxsLCB0aGlzLm1hdGNoKDExKSB8fCB0aGlzLmV4cGVjdCgxMikpOyAhdGhpcy5tYXRjaCgxMSkgJiYgIXRoaXMubWF0Y2goMjEpOyApCiAgICAgICAgICAgICAgdDMucGFyYW1zLnB1c2godGhpcy5mbG93UGFyc2VGdW5jdGlvblR5cGVQYXJhbShmYWxzZSkpLCB0aGlzLm1hdGNoKDExKSB8fCB0aGlzLmV4cGVjdCgxMik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhdCgyMSkgJiYgKHQzLnJlc3QgPSB0aGlzLmZsb3dQYXJzZUZ1bmN0aW9uVHlwZVBhcmFtKGZhbHNlKSksIHRoaXMuZXhwZWN0KDExKSwgdDMucmV0dXJuVHlwZSA9IHRoaXMuZmxvd1BhcnNlVHlwZUluaXRpYWxpc2VyKCksIHRoaXMuZmluaXNoTm9kZSh0MywgIkZ1bmN0aW9uVHlwZUFubm90YXRpb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZU9iamVjdFR5cGVDYWxsUHJvcGVydHkodDMsIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHQzLnN0YXRpYyA9IGUyLCB0My52YWx1ZSA9IHRoaXMuZmxvd1BhcnNlT2JqZWN0VHlwZU1ldGhvZGlzaChzMiksIHRoaXMuZmluaXNoTm9kZSh0MywgIk9iamVjdFR5cGVDYWxsUHJvcGVydHkiKTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZU9iamVjdFR5cGUodDMpIHsKICAgICAgICAgICAgbGV0IHsgYWxsb3dTdGF0aWM6IGUyLCBhbGxvd0V4YWN0OiBzMiwgYWxsb3dTcHJlYWQ6IHIyLCBhbGxvd1Byb3RvOiBpMiwgYWxsb3dJbmV4YWN0OiBuMiB9ID0gdDM7CiAgICAgICAgICAgIGNvbnN0IGEyID0gdGhpcy5zdGF0ZS5pblR5cGU7CiAgICAgICAgICAgIHRoaXMuc3RhdGUuaW5UeXBlID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgbzIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICBsZXQgdTIsIGgyOwogICAgICAgICAgICBvMi5jYWxsUHJvcGVydGllcyA9IFtdLCBvMi5wcm9wZXJ0aWVzID0gW10sIG8yLmluZGV4ZXJzID0gW10sIG8yLmludGVybmFsU2xvdHMgPSBbXTsKICAgICAgICAgICAgbGV0IHAyID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAoczIgJiYgdGhpcy5tYXRjaCg2KSA/ICh0aGlzLmV4cGVjdCg2KSwgdTIgPSA5LCBoMiA9IHRydWUpIDogKHRoaXMuZXhwZWN0KDUpLCB1MiA9IDgsIGgyID0gZmFsc2UpLCBvMi5leGFjdCA9IGgyOyAhdGhpcy5tYXRjaCh1Mik7ICkgewogICAgICAgICAgICAgIGxldCB0NCA9IGZhbHNlLCBzMyA9IG51bGwsIGEzID0gbnVsbDsKICAgICAgICAgICAgICBjb25zdCB1MyA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgICAgaWYgKGkyICYmIHRoaXMuaXNDb250ZXh0dWFsKDEwOSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQ1ID0gdGhpcy5sb29rYWhlYWQoKTsKICAgICAgICAgICAgICAgIHQ1LnR5cGUgIT09IDE0ICYmIHQ1LnR5cGUgIT09IDE3ICYmICh0aGlzLm5leHQoKSwgczMgPSB0aGlzLnN0YXRlLnN0YXJ0LCBlMiA9IGZhbHNlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGUyICYmIHRoaXMuaXNDb250ZXh0dWFsKDk4KSkgewogICAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLmxvb2thaGVhZCgpOwogICAgICAgICAgICAgICAgZTMudHlwZSAhPT0gMTQgJiYgZTMudHlwZSAhPT0gMTcgJiYgKHRoaXMubmV4dCgpLCB0NCA9IHRydWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBjMyA9IHRoaXMuZmxvd1BhcnNlVmFyaWFuY2UoKTsKICAgICAgICAgICAgICBpZiAodGhpcy5lYXQoMCkpCiAgICAgICAgICAgICAgICBzMyAhPSBudWxsICYmIHRoaXMudW5leHBlY3RlZChzMyksIHRoaXMuZWF0KDApID8gKGMzICYmIHRoaXMudW5leHBlY3RlZChjMy5zdGFydCksIG8yLmludGVybmFsU2xvdHMucHVzaCh0aGlzLmZsb3dQYXJzZU9iamVjdFR5cGVJbnRlcm5hbFNsb3QodTMsIHQ0KSkpIDogbzIuaW5kZXhlcnMucHVzaCh0aGlzLmZsb3dQYXJzZU9iamVjdFR5cGVJbmRleGVyKHUzLCB0NCwgYzMpKTsKICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLm1hdGNoKDEwKSB8fCB0aGlzLm1hdGNoKDQzKSkKICAgICAgICAgICAgICAgIHMzICE9IG51bGwgJiYgdGhpcy51bmV4cGVjdGVkKHMzKSwgYzMgJiYgdGhpcy51bmV4cGVjdGVkKGMzLnN0YXJ0KSwgbzIuY2FsbFByb3BlcnRpZXMucHVzaCh0aGlzLmZsb3dQYXJzZU9iamVjdFR5cGVDYWxsUHJvcGVydHkodTMsIHQ0KSk7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBsZXQgZTMgPSAiaW5pdCI7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0NvbnRleHR1YWwoOTIpIHx8IHRoaXMuaXNDb250ZXh0dWFsKDk3KSkgewogICAgICAgICAgICAgICAgICB6Yyh0aGlzLmxvb2thaGVhZCgpLnR5cGUpICYmIChlMyA9IHRoaXMuc3RhdGUudmFsdWUsIHRoaXMubmV4dCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGkzID0gdGhpcy5mbG93UGFyc2VPYmplY3RUeXBlUHJvcGVydHkodTMsIHQ0LCBzMywgYzMsIGUzLCByMiwgbjIgIT0gbnVsbCA/IG4yIDogIWgyKTsKICAgICAgICAgICAgICAgIGkzID09PSBudWxsID8gKHAyID0gdHJ1ZSwgYTMgPSB0aGlzLnN0YXRlLmxhc3RUb2tTdGFydCkgOiBvMi5wcm9wZXJ0aWVzLnB1c2goaTMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLmZsb3dPYmplY3RUeXBlU2VtaWNvbG9uKCksICFhMyB8fCB0aGlzLm1hdGNoKDgpIHx8IHRoaXMubWF0Y2goOSkgfHwgdGhpcy5yYWlzZShhMywgVmwuVW5leHBlY3RlZEV4cGxpY2l0SW5leGFjdEluT2JqZWN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmV4cGVjdCh1MiksIHIyICYmIChvMi5pbmV4YWN0ID0gcDIpOwogICAgICAgICAgICBjb25zdCBjMiA9IHRoaXMuZmluaXNoTm9kZShvMiwgIk9iamVjdFR5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmluVHlwZSA9IGEyLCBjMjsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZU9iamVjdFR5cGVQcm9wZXJ0eSh0MywgZTIsIHMyLCByMiwgaTIsIG4yLCBhMikgewogICAgICAgICAgICBpZiAodGhpcy5lYXQoMjEpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goMTIpIHx8IHRoaXMubWF0Y2goMTMpIHx8IHRoaXMubWF0Y2goOCkgfHwgdGhpcy5tYXRjaCg5KSA/IChuMiA/IGEyIHx8IHRoaXMucmFpc2UodGhpcy5zdGF0ZS5sYXN0VG9rU3RhcnQsIFZsLkluZXhhY3RJbnNpZGVFeGFjdCkgOiB0aGlzLnJhaXNlKHRoaXMuc3RhdGUubGFzdFRva1N0YXJ0LCBWbC5JbmV4YWN0SW5zaWRlTm9uT2JqZWN0KSwgcjIgJiYgdGhpcy5yYWlzZShyMi5zdGFydCwgVmwuSW5leGFjdFZhcmlhbmNlKSwgbnVsbCkgOiAobjIgfHwgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLmxhc3RUb2tTdGFydCwgVmwuVW5leHBlY3RlZFNwcmVhZFR5cGUpLCBzMiAhPSBudWxsICYmIHRoaXMudW5leHBlY3RlZChzMiksIHIyICYmIHRoaXMucmFpc2UocjIuc3RhcnQsIFZsLlNwcmVhZFZhcmlhbmNlKSwgdDMuYXJndW1lbnQgPSB0aGlzLmZsb3dQYXJzZVR5cGUoKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiT2JqZWN0VHlwZVNwcmVhZFByb3BlcnR5IikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB0My5rZXkgPSB0aGlzLmZsb3dQYXJzZU9iamVjdFByb3BlcnR5S2V5KCksIHQzLnN0YXRpYyA9IGUyLCB0My5wcm90byA9IHMyICE9IG51bGwsIHQzLmtpbmQgPSBpMjsKICAgICAgICAgICAgICBsZXQgYTMgPSBmYWxzZTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaCg0MykgfHwgdGhpcy5tYXRjaCgxMCkgPyAodDMubWV0aG9kID0gdHJ1ZSwgczIgIT0gbnVsbCAmJiB0aGlzLnVuZXhwZWN0ZWQoczIpLCByMiAmJiB0aGlzLnVuZXhwZWN0ZWQocjIuc3RhcnQpLCB0My52YWx1ZSA9IHRoaXMuZmxvd1BhcnNlT2JqZWN0VHlwZU1ldGhvZGlzaCh0aGlzLnN0YXJ0Tm9kZUF0KHQzLnN0YXJ0LCB0My5sb2Muc3RhcnQpKSwgaTIgIT09ICJnZXQiICYmIGkyICE9PSAic2V0IiB8fCB0aGlzLmZsb3dDaGVja0dldHRlclNldHRlclBhcmFtcyh0MyksICFuMiAmJiB0My5rZXkubmFtZSA9PT0gImNvbnN0cnVjdG9yIiAmJiB0My52YWx1ZS50aGlzICYmIHRoaXMucmFpc2UodDMudmFsdWUudGhpcy5zdGFydCwgVmwuVGhpc1BhcmFtQmFubmVkSW5Db25zdHJ1Y3RvcikpIDogKGkyICE9PSAiaW5pdCIgJiYgdGhpcy51bmV4cGVjdGVkKCksIHQzLm1ldGhvZCA9IGZhbHNlLCB0aGlzLmVhdCgxNykgJiYgKGEzID0gdHJ1ZSksIHQzLnZhbHVlID0gdGhpcy5mbG93UGFyc2VUeXBlSW5pdGlhbGlzZXIoKSwgdDMudmFyaWFuY2UgPSByMiksIHQzLm9wdGlvbmFsID0gYTMsIHRoaXMuZmluaXNoTm9kZSh0MywgIk9iamVjdFR5cGVQcm9wZXJ0eSIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmbG93Q2hlY2tHZXR0ZXJTZXR0ZXJQYXJhbXModDMpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0My5raW5kID09PSAiZ2V0IiA/IDAgOiAxLCBzMiA9IHQzLnN0YXJ0LCByMiA9IHQzLnZhbHVlLnBhcmFtcy5sZW5ndGggKyAodDMudmFsdWUucmVzdCA/IDEgOiAwKTsKICAgICAgICAgICAgdDMudmFsdWUudGhpcyAmJiB0aGlzLnJhaXNlKHQzLnZhbHVlLnRoaXMuc3RhcnQsIHQzLmtpbmQgPT09ICJnZXQiID8gVmwuR2V0dGVyTWF5Tm90SGF2ZVRoaXNQYXJhbSA6IFZsLlNldHRlck1heU5vdEhhdmVUaGlzUGFyYW0pLCByMiAhPT0gZTIgJiYgKHQzLmtpbmQgPT09ICJnZXQiID8gdGhpcy5yYWlzZShzMiwgRGMuQmFkR2V0dGVyQXJpdHkpIDogdGhpcy5yYWlzZShzMiwgRGMuQmFkU2V0dGVyQXJpdHkpKSwgdDMua2luZCA9PT0gInNldCIgJiYgdDMudmFsdWUucmVzdCAmJiB0aGlzLnJhaXNlKHMyLCBEYy5CYWRTZXR0ZXJSZXN0UGFyYW1ldGVyKTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dPYmplY3RUeXBlU2VtaWNvbG9uKCkgewogICAgICAgICAgICB0aGlzLmVhdCgxMykgfHwgdGhpcy5lYXQoMTIpIHx8IHRoaXMubWF0Y2goOCkgfHwgdGhpcy5tYXRjaCg5KSB8fCB0aGlzLnVuZXhwZWN0ZWQoKTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZVF1YWxpZmllZFR5cGVJZGVudGlmaWVyKHQzLCBlMiwgczIpIHsKICAgICAgICAgICAgdDMgPSB0MyB8fCB0aGlzLnN0YXRlLnN0YXJ0LCBlMiA9IGUyIHx8IHRoaXMuc3RhdGUuc3RhcnRMb2M7CiAgICAgICAgICAgIGxldCByMiA9IHMyIHx8IHRoaXMuZmxvd1BhcnNlUmVzdHJpY3RlZElkZW50aWZpZXIodHJ1ZSk7CiAgICAgICAgICAgIGZvciAoOyB0aGlzLmVhdCgxNik7ICkgewogICAgICAgICAgICAgIGNvbnN0IHMzID0gdGhpcy5zdGFydE5vZGVBdCh0MywgZTIpOwogICAgICAgICAgICAgIHMzLnF1YWxpZmljYXRpb24gPSByMiwgczMuaWQgPSB0aGlzLmZsb3dQYXJzZVJlc3RyaWN0ZWRJZGVudGlmaWVyKHRydWUpLCByMiA9IHRoaXMuZmluaXNoTm9kZShzMywgIlF1YWxpZmllZFR5cGVJZGVudGlmaWVyIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlR2VuZXJpY1R5cGUodDMsIGUyLCBzMikgewogICAgICAgICAgICBjb25zdCByMiA9IHRoaXMuc3RhcnROb2RlQXQodDMsIGUyKTsKICAgICAgICAgICAgcmV0dXJuIHIyLnR5cGVQYXJhbWV0ZXJzID0gbnVsbCwgcjIuaWQgPSB0aGlzLmZsb3dQYXJzZVF1YWxpZmllZFR5cGVJZGVudGlmaWVyKHQzLCBlMiwgczIpLCB0aGlzLm1hdGNoKDQzKSAmJiAocjIudHlwZVBhcmFtZXRlcnMgPSB0aGlzLmZsb3dQYXJzZVR5cGVQYXJhbWV0ZXJJbnN0YW50aWF0aW9uKCkpLCB0aGlzLmZpbmlzaE5vZGUocjIsICJHZW5lcmljVHlwZUFubm90YXRpb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZVR5cGVvZlR5cGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwZWN0KDgxKSwgdDMuYXJndW1lbnQgPSB0aGlzLmZsb3dQYXJzZVByaW1hcnlUeXBlKCksIHRoaXMuZmluaXNoTm9kZSh0MywgIlR5cGVvZlR5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VUdXBsZVR5cGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgZm9yICh0My50eXBlcyA9IFtdLCB0aGlzLmV4cGVjdCgwKTsgdGhpcy5zdGF0ZS5wb3MgPCB0aGlzLmxlbmd0aCAmJiAhdGhpcy5tYXRjaCgzKSAmJiAodDMudHlwZXMucHVzaCh0aGlzLmZsb3dQYXJzZVR5cGUoKSksICF0aGlzLm1hdGNoKDMpKTsgKQogICAgICAgICAgICAgIHRoaXMuZXhwZWN0KDEyKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwZWN0KDMpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJUdXBsZVR5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VGdW5jdGlvblR5cGVQYXJhbSh0MykgewogICAgICAgICAgICBsZXQgZTIgPSBudWxsLCBzMiA9IGZhbHNlLCByMiA9IG51bGw7CiAgICAgICAgICAgIGNvbnN0IGkyID0gdGhpcy5zdGFydE5vZGUoKSwgbjIgPSB0aGlzLmxvb2thaGVhZCgpLCBhMiA9IHRoaXMuc3RhdGUudHlwZSA9PT0gNzI7CiAgICAgICAgICAgIHJldHVybiBuMi50eXBlID09PSAxNCB8fCBuMi50eXBlID09PSAxNyA/IChhMiAmJiAhdDMgJiYgdGhpcy5yYWlzZShpMi5zdGFydCwgVmwuVGhpc1BhcmFtTXVzdEJlRmlyc3QpLCBlMiA9IHRoaXMucGFyc2VJZGVudGlmaWVyKGEyKSwgdGhpcy5lYXQoMTcpICYmIChzMiA9IHRydWUsIGEyICYmIHRoaXMucmFpc2UoaTIuc3RhcnQsIFZsLlRoaXNQYXJhbU1heU5vdEJlT3B0aW9uYWwpKSwgcjIgPSB0aGlzLmZsb3dQYXJzZVR5cGVJbml0aWFsaXNlcigpKSA6IHIyID0gdGhpcy5mbG93UGFyc2VUeXBlKCksIGkyLm5hbWUgPSBlMiwgaTIub3B0aW9uYWwgPSBzMiwgaTIudHlwZUFubm90YXRpb24gPSByMiwgdGhpcy5maW5pc2hOb2RlKGkyLCAiRnVuY3Rpb25UeXBlUGFyYW0iKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlaW50ZXJwcmV0VHlwZUFzRnVuY3Rpb25UeXBlUGFyYW0odDMpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXJ0Tm9kZUF0KHQzLnN0YXJ0LCB0My5sb2Muc3RhcnQpOwogICAgICAgICAgICByZXR1cm4gZTIubmFtZSA9IG51bGwsIGUyLm9wdGlvbmFsID0gZmFsc2UsIGUyLnR5cGVBbm5vdGF0aW9uID0gdDMsIHRoaXMuZmluaXNoTm9kZShlMiwgIkZ1bmN0aW9uVHlwZVBhcmFtIik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VGdW5jdGlvblR5cGVQYXJhbXMoKSB7CiAgICAgICAgICAgIGxldCB0MyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzBdIDogW10sIGUyID0gbnVsbCwgczIgPSBudWxsOwogICAgICAgICAgICBmb3IgKHRoaXMubWF0Y2goNzIpICYmIChzMiA9IHRoaXMuZmxvd1BhcnNlRnVuY3Rpb25UeXBlUGFyYW0odHJ1ZSksIHMyLm5hbWUgPSBudWxsLCB0aGlzLm1hdGNoKDExKSB8fCB0aGlzLmV4cGVjdCgxMikpOyAhdGhpcy5tYXRjaCgxMSkgJiYgIXRoaXMubWF0Y2goMjEpOyApCiAgICAgICAgICAgICAgdDMucHVzaCh0aGlzLmZsb3dQYXJzZUZ1bmN0aW9uVHlwZVBhcmFtKGZhbHNlKSksIHRoaXMubWF0Y2goMTEpIHx8IHRoaXMuZXhwZWN0KDEyKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWF0KDIxKSAmJiAoZTIgPSB0aGlzLmZsb3dQYXJzZUZ1bmN0aW9uVHlwZVBhcmFtKGZhbHNlKSksIHsgcGFyYW1zOiB0MywgcmVzdDogZTIsIF90aGlzOiBzMiB9OwogICAgICAgICAgfQogICAgICAgICAgZmxvd0lkZW50VG9UeXBlQW5ub3RhdGlvbih0MywgZTIsIHMyLCByMikgewogICAgICAgICAgICBzd2l0Y2ggKHIyLm5hbWUpIHsKICAgICAgICAgICAgICBjYXNlICJhbnkiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShzMiwgIkFueVR5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICAgICAgY2FzZSAiYm9vbCI6CiAgICAgICAgICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKHMyLCAiQm9vbGVhblR5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICAgICAgY2FzZSAibWl4ZWQiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShzMiwgIk1peGVkVHlwZUFubm90YXRpb24iKTsKICAgICAgICAgICAgICBjYXNlICJlbXB0eSI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKHMyLCAiRW1wdHlUeXBlQW5ub3RhdGlvbiIpOwogICAgICAgICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKHMyLCAiTnVtYmVyVHlwZUFubm90YXRpb24iKTsKICAgICAgICAgICAgICBjYXNlICJzdHJpbmciOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShzMiwgIlN0cmluZ1R5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICAgICAgY2FzZSAic3ltYm9sIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbmlzaE5vZGUoczIsICJTeW1ib2xUeXBlQW5ub3RhdGlvbiIpOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGVja05vdFVuZGVyc2NvcmUocjIubmFtZSksIHRoaXMuZmxvd1BhcnNlR2VuZXJpY1R5cGUodDMsIGUyLCByMik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZVByaW1hcnlUeXBlKCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhdGUuc3RhcnQsIGUyID0gdGhpcy5zdGF0ZS5zdGFydExvYywgczIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICBsZXQgcjIsIGkyLCBuMiA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBhMiA9IHRoaXMuc3RhdGUubm9Bbm9uRnVuY3Rpb25UeXBlOwogICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc3RhdGUudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZsb3dQYXJzZU9iamVjdFR5cGUoeyBhbGxvd1N0YXRpYzogZmFsc2UsIGFsbG93RXhhY3Q6IGZhbHNlLCBhbGxvd1NwcmVhZDogdHJ1ZSwgYWxsb3dQcm90bzogZmFsc2UsIGFsbG93SW5leGFjdDogdHJ1ZSB9KTsKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mbG93UGFyc2VPYmplY3RUeXBlKHsgYWxsb3dTdGF0aWM6IGZhbHNlLCBhbGxvd0V4YWN0OiB0cnVlLCBhbGxvd1NwcmVhZDogdHJ1ZSwgYWxsb3dQcm90bzogZmFsc2UsIGFsbG93SW5leGFjdDogZmFsc2UgfSk7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUubm9Bbm9uRnVuY3Rpb25UeXBlID0gZmFsc2UsIGkyID0gdGhpcy5mbG93UGFyc2VUdXBsZVR5cGUoKSwgdGhpcy5zdGF0ZS5ub0Fub25GdW5jdGlvblR5cGUgPSBhMiwgaTI7CiAgICAgICAgICAgICAgY2FzZSA0MzoKICAgICAgICAgICAgICAgIHJldHVybiBzMi50eXBlUGFyYW1ldGVycyA9IHRoaXMuZmxvd1BhcnNlVHlwZVBhcmFtZXRlckRlY2xhcmF0aW9uKCksIHRoaXMuZXhwZWN0KDEwKSwgcjIgPSB0aGlzLmZsb3dQYXJzZUZ1bmN0aW9uVHlwZVBhcmFtcygpLCBzMi5wYXJhbXMgPSByMi5wYXJhbXMsIHMyLnJlc3QgPSByMi5yZXN0LCBzMi50aGlzID0gcjIuX3RoaXMsIHRoaXMuZXhwZWN0KDExKSwgdGhpcy5leHBlY3QoMTkpLCBzMi5yZXR1cm5UeXBlID0gdGhpcy5mbG93UGFyc2VUeXBlKCksIHRoaXMuZmluaXNoTm9kZShzMiwgIkZ1bmN0aW9uVHlwZUFubm90YXRpb24iKTsKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgaWYgKHRoaXMubmV4dCgpLCAhdGhpcy5tYXRjaCgxMSkgJiYgIXRoaXMubWF0Y2goMjEpKQogICAgICAgICAgICAgICAgICBpZiAoVWModGhpcy5zdGF0ZS50eXBlKSB8fCB0aGlzLm1hdGNoKDcyKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHQ0ID0gdGhpcy5sb29rYWhlYWQoKS50eXBlOwogICAgICAgICAgICAgICAgICAgIG4yID0gdDQgIT09IDE3ICYmIHQ0ICE9PSAxNDsKICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgbjIgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKG4yKSB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLm5vQW5vbkZ1bmN0aW9uVHlwZSA9IGZhbHNlLCBpMiA9IHRoaXMuZmxvd1BhcnNlVHlwZSgpLCB0aGlzLnN0YXRlLm5vQW5vbkZ1bmN0aW9uVHlwZSA9IGEyLCB0aGlzLnN0YXRlLm5vQW5vbkZ1bmN0aW9uVHlwZSB8fCAhKHRoaXMubWF0Y2goMTIpIHx8IHRoaXMubWF0Y2goMTEpICYmIHRoaXMubG9va2FoZWFkKCkudHlwZSA9PT0gMTkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmV4cGVjdCgxMSksIGkyOwogICAgICAgICAgICAgICAgICB0aGlzLmVhdCgxMik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcjIgPSBpMiA/IHRoaXMuZmxvd1BhcnNlRnVuY3Rpb25UeXBlUGFyYW1zKFt0aGlzLnJlaW50ZXJwcmV0VHlwZUFzRnVuY3Rpb25UeXBlUGFyYW0oaTIpXSkgOiB0aGlzLmZsb3dQYXJzZUZ1bmN0aW9uVHlwZVBhcmFtcygpLCBzMi5wYXJhbXMgPSByMi5wYXJhbXMsIHMyLnJlc3QgPSByMi5yZXN0LCBzMi50aGlzID0gcjIuX3RoaXMsIHRoaXMuZXhwZWN0KDExKSwgdGhpcy5leHBlY3QoMTkpLCBzMi5yZXR1cm5UeXBlID0gdGhpcy5mbG93UGFyc2VUeXBlKCksIHMyLnR5cGVQYXJhbWV0ZXJzID0gbnVsbCwgdGhpcy5maW5pc2hOb2RlKHMyLCAiRnVuY3Rpb25UeXBlQW5ub3RhdGlvbiIpOwogICAgICAgICAgICAgIGNhc2UgMTIzOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VMaXRlcmFsKHRoaXMuc3RhdGUudmFsdWUsICJTdHJpbmdMaXRlcmFsVHlwZUFubm90YXRpb24iKTsKICAgICAgICAgICAgICBjYXNlIDc5OgogICAgICAgICAgICAgIGNhc2UgODA6CiAgICAgICAgICAgICAgICByZXR1cm4gczIudmFsdWUgPSB0aGlzLm1hdGNoKDc5KSwgdGhpcy5uZXh0KCksIHRoaXMuZmluaXNoTm9kZShzMiwgIkJvb2xlYW5MaXRlcmFsVHlwZUFubm90YXRpb24iKTsKICAgICAgICAgICAgICBjYXNlIDQ3OgogICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUudmFsdWUgPT09ICItIikgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5uZXh0KCksIHRoaXMubWF0Y2goMTI0KSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUxpdGVyYWxBdE5vZGUoLXRoaXMuc3RhdGUudmFsdWUsICJOdW1iZXJMaXRlcmFsVHlwZUFubm90YXRpb24iLCBzMik7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDEyNSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VMaXRlcmFsQXROb2RlKC10aGlzLnN0YXRlLnZhbHVlLCAiQmlnSW50TGl0ZXJhbFR5cGVBbm5vdGF0aW9uIiwgczIpOwogICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIFZsLlVuZXhwZWN0ZWRTdWJ0cmFjdGlvbk9wZXJhbmQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhyb3cgdGhpcy51bmV4cGVjdGVkKCk7CiAgICAgICAgICAgICAgY2FzZSAxMjQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUxpdGVyYWwodGhpcy5zdGF0ZS52YWx1ZSwgIk51bWJlckxpdGVyYWxUeXBlQW5ub3RhdGlvbiIpOwogICAgICAgICAgICAgIGNhc2UgMTI1OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VMaXRlcmFsKHRoaXMuc3RhdGUudmFsdWUsICJCaWdJbnRMaXRlcmFsVHlwZUFubm90YXRpb24iKTsKICAgICAgICAgICAgICBjYXNlIDgyOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0aGlzLmZpbmlzaE5vZGUoczIsICJWb2lkVHlwZUFubm90YXRpb24iKTsKICAgICAgICAgICAgICBjYXNlIDc4OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0aGlzLmZpbmlzaE5vZGUoczIsICJOdWxsTGl0ZXJhbFR5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICAgICAgY2FzZSA3MjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5maW5pc2hOb2RlKHMyLCAiVGhpc1R5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICAgICAgY2FzZSA0OToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5maW5pc2hOb2RlKHMyLCAiRXhpc3RzVHlwZUFubm90YXRpb24iKTsKICAgICAgICAgICAgICBjYXNlIDgxOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmxvd1BhcnNlVHlwZW9mVHlwZSgpOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBpZiAocWModGhpcy5zdGF0ZS50eXBlKSkgewogICAgICAgICAgICAgICAgICBjb25zdCB0NCA9IFdjKHRoaXMuc3RhdGUudHlwZSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgc3VwZXIuY3JlYXRlSWRlbnRpZmllcihzMiwgdDQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKFVjKHRoaXMuc3RhdGUudHlwZSkpCiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlzQ29udGV4dHVhbCgxMTkpID8gdGhpcy5mbG93UGFyc2VJbnRlcmZhY2VUeXBlKCkgOiB0aGlzLmZsb3dJZGVudFRvVHlwZUFubm90YXRpb24odDMsIGUyLCBzMiwgdGhpcy5wYXJzZUlkZW50aWZpZXIoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgdGhpcy51bmV4cGVjdGVkKCk7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VQb3N0Zml4VHlwZSgpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXRlLnN0YXJ0LCBlMiA9IHRoaXMuc3RhdGUuc3RhcnRMb2M7CiAgICAgICAgICAgIGxldCBzMiA9IHRoaXMuZmxvd1BhcnNlUHJpbWFyeVR5cGUoKSwgcjIgPSBmYWxzZTsKICAgICAgICAgICAgZm9yICg7ICh0aGlzLm1hdGNoKDApIHx8IHRoaXMubWF0Y2goMTgpKSAmJiAhdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKTsgKSB7CiAgICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLnN0YXJ0Tm9kZUF0KHQzLCBlMiksIG4yID0gdGhpcy5lYXQoMTgpOwogICAgICAgICAgICAgIHIyID0gcjIgfHwgbjIsIHRoaXMuZXhwZWN0KDApLCAhbjIgJiYgdGhpcy5tYXRjaCgzKSA/IChpMi5lbGVtZW50VHlwZSA9IHMyLCB0aGlzLm5leHQoKSwgczIgPSB0aGlzLmZpbmlzaE5vZGUoaTIsICJBcnJheVR5cGVBbm5vdGF0aW9uIikpIDogKGkyLm9iamVjdFR5cGUgPSBzMiwgaTIuaW5kZXhUeXBlID0gdGhpcy5mbG93UGFyc2VUeXBlKCksIHRoaXMuZXhwZWN0KDMpLCByMiA/IChpMi5vcHRpb25hbCA9IG4yLCBzMiA9IHRoaXMuZmluaXNoTm9kZShpMiwgIk9wdGlvbmFsSW5kZXhlZEFjY2Vzc1R5cGUiKSkgOiBzMiA9IHRoaXMuZmluaXNoTm9kZShpMiwgIkluZGV4ZWRBY2Nlc3NUeXBlIikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzMjsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZVByZWZpeFR5cGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWF0KDE3KSA/ICh0My50eXBlQW5ub3RhdGlvbiA9IHRoaXMuZmxvd1BhcnNlUHJlZml4VHlwZSgpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJOdWxsYWJsZVR5cGVBbm5vdGF0aW9uIikpIDogdGhpcy5mbG93UGFyc2VQb3N0Zml4VHlwZSgpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlQW5vbkZ1bmN0aW9uV2l0aG91dFBhcmVucygpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLmZsb3dQYXJzZVByZWZpeFR5cGUoKTsKICAgICAgICAgICAgaWYgKCF0aGlzLnN0YXRlLm5vQW5vbkZ1bmN0aW9uVHlwZSAmJiB0aGlzLmVhdCgxOSkpIHsKICAgICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhcnROb2RlQXQodDMuc3RhcnQsIHQzLmxvYy5zdGFydCk7CiAgICAgICAgICAgICAgcmV0dXJuIGUyLnBhcmFtcyA9IFt0aGlzLnJlaW50ZXJwcmV0VHlwZUFzRnVuY3Rpb25UeXBlUGFyYW0odDMpXSwgZTIucmVzdCA9IG51bGwsIGUyLnRoaXMgPSBudWxsLCBlMi5yZXR1cm5UeXBlID0gdGhpcy5mbG93UGFyc2VUeXBlKCksIGUyLnR5cGVQYXJhbWV0ZXJzID0gbnVsbCwgdGhpcy5maW5pc2hOb2RlKGUyLCAiRnVuY3Rpb25UeXBlQW5ub3RhdGlvbiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0MzsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZUludGVyc2VjdGlvblR5cGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgdGhpcy5lYXQoNDEpOwogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuZmxvd1BhcnNlQW5vbkZ1bmN0aW9uV2l0aG91dFBhcmVucygpOwogICAgICAgICAgICBmb3IgKHQzLnR5cGVzID0gW2UyXTsgdGhpcy5lYXQoNDEpOyApCiAgICAgICAgICAgICAgdDMudHlwZXMucHVzaCh0aGlzLmZsb3dQYXJzZUFub25GdW5jdGlvbldpdGhvdXRQYXJlbnMoKSk7CiAgICAgICAgICAgIHJldHVybiB0My50eXBlcy5sZW5ndGggPT09IDEgPyBlMiA6IHRoaXMuZmluaXNoTm9kZSh0MywgIkludGVyc2VjdGlvblR5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VVbmlvblR5cGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgdGhpcy5lYXQoMzkpOwogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuZmxvd1BhcnNlSW50ZXJzZWN0aW9uVHlwZSgpOwogICAgICAgICAgICBmb3IgKHQzLnR5cGVzID0gW2UyXTsgdGhpcy5lYXQoMzkpOyApCiAgICAgICAgICAgICAgdDMudHlwZXMucHVzaCh0aGlzLmZsb3dQYXJzZUludGVyc2VjdGlvblR5cGUoKSk7CiAgICAgICAgICAgIHJldHVybiB0My50eXBlcy5sZW5ndGggPT09IDEgPyBlMiA6IHRoaXMuZmluaXNoTm9kZSh0MywgIlVuaW9uVHlwZUFubm90YXRpb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZVR5cGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGF0ZS5pblR5cGU7CiAgICAgICAgICAgIHRoaXMuc3RhdGUuaW5UeXBlID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLmZsb3dQYXJzZVVuaW9uVHlwZSgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5pblR5cGUgPSB0MywgZTI7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VUeXBlT3JJbXBsaWNpdEluc3RhbnRpYXRpb24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnR5cGUgPT09IDEyMiAmJiB0aGlzLnN0YXRlLnZhbHVlID09PSAiXyIpIHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhdGUuc3RhcnQsIGUyID0gdGhpcy5zdGF0ZS5zdGFydExvYywgczIgPSB0aGlzLnBhcnNlSWRlbnRpZmllcigpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLmZsb3dQYXJzZUdlbmVyaWNUeXBlKHQzLCBlMiwgczIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZsb3dQYXJzZVR5cGUoKTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZVR5cGVBbm5vdGF0aW9uKCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0My50eXBlQW5ub3RhdGlvbiA9IHRoaXMuZmxvd1BhcnNlVHlwZUluaXRpYWxpc2VyKCksIHRoaXMuZmluaXNoTm9kZSh0MywgIlR5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93UGFyc2VUeXBlQW5ub3RhdGFibGVJZGVudGlmaWVyKHQzKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdDMgPyB0aGlzLnBhcnNlSWRlbnRpZmllcigpIDogdGhpcy5mbG93UGFyc2VSZXN0cmljdGVkSWRlbnRpZmllcigpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaCgxNCkgJiYgKGUyLnR5cGVBbm5vdGF0aW9uID0gdGhpcy5mbG93UGFyc2VUeXBlQW5ub3RhdGlvbigpLCB0aGlzLnJlc2V0RW5kTG9jYXRpb24oZTIpKSwgZTI7CiAgICAgICAgICB9CiAgICAgICAgICB0eXBlQ2FzdFRvUGFyYW1ldGVyKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0My5leHByZXNzaW9uLnR5cGVBbm5vdGF0aW9uID0gdDMudHlwZUFubm90YXRpb24sIHRoaXMucmVzZXRFbmRMb2NhdGlvbih0My5leHByZXNzaW9uLCB0My50eXBlQW5ub3RhdGlvbi5lbmQsIHQzLnR5cGVBbm5vdGF0aW9uLmxvYy5lbmQpLCB0My5leHByZXNzaW9uOwogICAgICAgICAgfQogICAgICAgICAgZmxvd1BhcnNlVmFyaWFuY2UoKSB7CiAgICAgICAgICAgIGxldCB0MyA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDQ3KSAmJiAodDMgPSB0aGlzLnN0YXJ0Tm9kZSgpLCB0aGlzLnN0YXRlLnZhbHVlID09PSAiKyIgPyB0My5raW5kID0gInBsdXMiIDogdDMua2luZCA9ICJtaW51cyIsIHRoaXMubmV4dCgpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJWYXJpYW5jZSIpKSwgdDM7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUZ1bmN0aW9uQm9keSh0MywgZTIpIHsKICAgICAgICAgICAgbGV0IHMyID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgJiYgYXJndW1lbnRzWzJdOwogICAgICAgICAgICByZXR1cm4gZTIgPyB0aGlzLmZvcndhcmROb0Fycm93UGFyYW1zQ29udmVyc2lvbkF0KHQzLCAoKSA9PiBzdXBlci5wYXJzZUZ1bmN0aW9uQm9keSh0MywgdHJ1ZSwgczIpKSA6IHN1cGVyLnBhcnNlRnVuY3Rpb25Cb2R5KHQzLCBmYWxzZSwgczIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VGdW5jdGlvbkJvZHlBbmRGaW5pc2godDMsIGUyKSB7CiAgICAgICAgICAgIGxldCBzMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdm9pZCAwICYmIGFyZ3VtZW50c1syXTsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goMTQpKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgIFtlMy50eXBlQW5ub3RhdGlvbiwgdDMucHJlZGljYXRlXSA9IHRoaXMuZmxvd1BhcnNlVHlwZUFuZFByZWRpY2F0ZUluaXRpYWxpc2VyKCksIHQzLnJldHVyblR5cGUgPSBlMy50eXBlQW5ub3RhdGlvbiA/IHRoaXMuZmluaXNoTm9kZShlMywgIlR5cGVBbm5vdGF0aW9uIikgOiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1cGVyLnBhcnNlRnVuY3Rpb25Cb2R5QW5kRmluaXNoKHQzLCBlMiwgczIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VTdGF0ZW1lbnQodDMsIGUyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnN0cmljdCAmJiB0aGlzLmlzQ29udGV4dHVhbCgxMTkpKSB7CiAgICAgICAgICAgICAgaWYgKF9jKHRoaXMubG9va2FoZWFkKCkudHlwZSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQ0ID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5mbG93UGFyc2VJbnRlcmZhY2UodDQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNob3VsZFBhcnNlRW51bXMoKSAmJiB0aGlzLmlzQ29udGV4dHVhbCgxMTYpKSB7CiAgICAgICAgICAgICAgY29uc3QgdDQgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5mbG93UGFyc2VFbnVtRGVjbGFyYXRpb24odDQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHMyID0gc3VwZXIucGFyc2VTdGF0ZW1lbnQodDMsIGUyKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmxvd1ByYWdtYSAhPT0gdm9pZCAwIHx8IHRoaXMuaXNWYWxpZERpcmVjdGl2ZShzMikgfHwgKHRoaXMuZmxvd1ByYWdtYSA9IG51bGwpLCBzMjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRXhwcmVzc2lvblN0YXRlbWVudCh0MywgZTIpIHsKICAgICAgICAgICAgaWYgKGUyLnR5cGUgPT09ICJJZGVudGlmaWVyIikgewogICAgICAgICAgICAgIGlmIChlMi5uYW1lID09PSAiZGVjbGFyZSIpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDc0KSB8fCBVYyh0aGlzLnN0YXRlLnR5cGUpIHx8IHRoaXMubWF0Y2goNjIpIHx8IHRoaXMubWF0Y2goNjgpIHx8IHRoaXMubWF0Y2goNzYpKQogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mbG93UGFyc2VEZWNsYXJlKHQzKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKFVjKHRoaXMuc3RhdGUudHlwZSkpIHsKICAgICAgICAgICAgICAgIGlmIChlMi5uYW1lID09PSAiaW50ZXJmYWNlIikKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmxvd1BhcnNlSW50ZXJmYWNlKHQzKTsKICAgICAgICAgICAgICAgIGlmIChlMi5uYW1lID09PSAidHlwZSIpCiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZsb3dQYXJzZVR5cGVBbGlhcyh0Myk7CiAgICAgICAgICAgICAgICBpZiAoZTIubmFtZSA9PT0gIm9wYXF1ZSIpCiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZsb3dQYXJzZU9wYXF1ZVR5cGUodDMsIGZhbHNlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnBhcnNlRXhwcmVzc2lvblN0YXRlbWVudCh0MywgZTIpOwogICAgICAgICAgfQogICAgICAgICAgc2hvdWxkUGFyc2VFeHBvcnREZWNsYXJhdGlvbigpIHsKICAgICAgICAgICAgY29uc3QgeyB0eXBlOiB0MyB9ID0gdGhpcy5zdGF0ZTsKICAgICAgICAgICAgcmV0dXJuIFZjKHQzKSB8fCB0aGlzLnNob3VsZFBhcnNlRW51bXMoKSAmJiB0MyA9PT0gMTE2ID8gIXRoaXMuc3RhdGUuY29udGFpbnNFc2MgOiBzdXBlci5zaG91bGRQYXJzZUV4cG9ydERlY2xhcmF0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBpc0V4cG9ydERlZmF1bHRTcGVjaWZpZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHsgdHlwZTogdDMgfSA9IHRoaXMuc3RhdGU7CiAgICAgICAgICAgIHJldHVybiBWYyh0MykgfHwgdGhpcy5zaG91bGRQYXJzZUVudW1zKCkgJiYgdDMgPT09IDExNiA/IHRoaXMuc3RhdGUuY29udGFpbnNFc2MgOiBzdXBlci5pc0V4cG9ydERlZmF1bHRTcGVjaWZpZXIoKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRXhwb3J0RGVmYXVsdEV4cHJlc3Npb24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNob3VsZFBhcnNlRW51bXMoKSAmJiB0aGlzLmlzQ29udGV4dHVhbCgxMTYpKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5mbG93UGFyc2VFbnVtRGVjbGFyYXRpb24odDMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdXBlci5wYXJzZUV4cG9ydERlZmF1bHRFeHByZXNzaW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNvbmRpdGlvbmFsKHQzLCBlMiwgczIsIHIyKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5tYXRjaCgxNykpCiAgICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5tYXliZUluQXJyb3dQYXJhbWV0ZXJzKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLmxvb2thaGVhZENoYXJDb2RlKCk7CiAgICAgICAgICAgICAgaWYgKGUzID09PSA0NCB8fCBlMyA9PT0gNjEgfHwgZTMgPT09IDU4IHx8IGUzID09PSA0MSkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldE9wdGlvbmFsUGFyYW1ldGVyc0Vycm9yKHIyKSwgdDM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5leHBlY3QoMTcpOwogICAgICAgICAgICBjb25zdCBpMiA9IHRoaXMuc3RhdGUuY2xvbmUoKSwgbjIgPSB0aGlzLnN0YXRlLm5vQXJyb3dBdCwgYTIgPSB0aGlzLnN0YXJ0Tm9kZUF0KGUyLCBzMik7CiAgICAgICAgICAgIGxldCB7IGNvbnNlcXVlbnQ6IG8yLCBmYWlsZWQ6IHUyIH0gPSB0aGlzLnRyeVBhcnNlQ29uZGl0aW9uYWxDb25zZXF1ZW50KCksIFtoMiwgcDJdID0gdGhpcy5nZXRBcnJvd0xpa2VFeHByZXNzaW9ucyhvMik7CiAgICAgICAgICAgIGlmICh1MiB8fCBwMi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgY29uc3QgdDQgPSBbLi4ubjJdOwogICAgICAgICAgICAgIGlmIChwMi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID0gaTIsIHRoaXMuc3RhdGUubm9BcnJvd0F0ID0gdDQ7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBlMyA9IDA7IGUzIDwgcDIubGVuZ3RoOyBlMysrKQogICAgICAgICAgICAgICAgICB0NC5wdXNoKHAyW2UzXS5zdGFydCk7CiAgICAgICAgICAgICAgICAoeyBjb25zZXF1ZW50OiBvMiwgZmFpbGVkOiB1MiB9ID0gdGhpcy50cnlQYXJzZUNvbmRpdGlvbmFsQ29uc2VxdWVudCgpKSwgW2gyLCBwMl0gPSB0aGlzLmdldEFycm93TGlrZUV4cHJlc3Npb25zKG8yKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdTIgJiYgaDIubGVuZ3RoID4gMSAmJiB0aGlzLnJhaXNlKGkyLnN0YXJ0LCBWbC5BbWJpZ3VvdXNDb25kaXRpb25hbEFycm93KSwgdTIgJiYgaDIubGVuZ3RoID09PSAxICYmICh0aGlzLnN0YXRlID0gaTIsIHQ0LnB1c2goaDJbMF0uc3RhcnQpLCB0aGlzLnN0YXRlLm5vQXJyb3dBdCA9IHQ0LCB7IGNvbnNlcXVlbnQ6IG8yLCBmYWlsZWQ6IHUyIH0gPSB0aGlzLnRyeVBhcnNlQ29uZGl0aW9uYWxDb25zZXF1ZW50KCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEFycm93TGlrZUV4cHJlc3Npb25zKG8yLCB0cnVlKSwgdGhpcy5zdGF0ZS5ub0Fycm93QXQgPSBuMiwgdGhpcy5leHBlY3QoMTQpLCBhMi50ZXN0ID0gdDMsIGEyLmNvbnNlcXVlbnQgPSBvMiwgYTIuYWx0ZXJuYXRlID0gdGhpcy5mb3J3YXJkTm9BcnJvd1BhcmFtc0NvbnZlcnNpb25BdChhMiwgKCkgPT4gdGhpcy5wYXJzZU1heWJlQXNzaWduKHZvaWQgMCwgdm9pZCAwKSksIHRoaXMuZmluaXNoTm9kZShhMiwgIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiIpOwogICAgICAgICAgfQogICAgICAgICAgdHJ5UGFyc2VDb25kaXRpb25hbENvbnNlcXVlbnQoKSB7CiAgICAgICAgICAgIHRoaXMuc3RhdGUubm9BcnJvd1BhcmFtc0NvbnZlcnNpb25BdC5wdXNoKHRoaXMuc3RhdGUuc3RhcnQpOwogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMucGFyc2VNYXliZUFzc2lnbkFsbG93SW4oKSwgZTIgPSAhdGhpcy5tYXRjaCgxNCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLm5vQXJyb3dQYXJhbXNDb252ZXJzaW9uQXQucG9wKCksIHsgY29uc2VxdWVudDogdDMsIGZhaWxlZDogZTIgfTsKICAgICAgICAgIH0KICAgICAgICAgIGdldEFycm93TGlrZUV4cHJlc3Npb25zKHQzLCBlMikgewogICAgICAgICAgICBjb25zdCBzMiA9IFt0M10sIHIyID0gW107CiAgICAgICAgICAgIGZvciAoOyBzMi5sZW5ndGggIT09IDA7ICkgewogICAgICAgICAgICAgIGNvbnN0IHQ0ID0gczIucG9wKCk7CiAgICAgICAgICAgICAgdDQudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiA/ICh0NC50eXBlUGFyYW1ldGVycyB8fCAhdDQucmV0dXJuVHlwZSA/IHRoaXMuZmluaXNoQXJyb3dWYWxpZGF0aW9uKHQ0KSA6IHIyLnB1c2godDQpLCBzMi5wdXNoKHQ0LmJvZHkpKSA6IHQ0LnR5cGUgPT09ICJDb25kaXRpb25hbEV4cHJlc3Npb24iICYmIChzMi5wdXNoKHQ0LmNvbnNlcXVlbnQpLCBzMi5wdXNoKHQ0LmFsdGVybmF0ZSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlMiA/IChyMi5mb3JFYWNoKCh0NCkgPT4gdGhpcy5maW5pc2hBcnJvd1ZhbGlkYXRpb24odDQpKSwgW3IyLCBbXV0pIDogZnVuY3Rpb24odDQsIGUzKSB7CiAgICAgICAgICAgICAgY29uc3QgczMgPSBbXSwgcjMgPSBbXTsKICAgICAgICAgICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgdDQubGVuZ3RoOyBpMisrKQogICAgICAgICAgICAgICAgKGUzKHQ0W2kyXSwgaTIsIHQ0KSA/IHMzIDogcjMpLnB1c2godDRbaTJdKTsKICAgICAgICAgICAgICByZXR1cm4gW3MzLCByM107CiAgICAgICAgICAgIH0ocjIsICh0NCkgPT4gdDQucGFyYW1zLmV2ZXJ5KCh0NSkgPT4gdGhpcy5pc0Fzc2lnbmFibGUodDUsIHRydWUpKSk7CiAgICAgICAgICB9CiAgICAgICAgICBmaW5pc2hBcnJvd1ZhbGlkYXRpb24odDMpIHsKICAgICAgICAgICAgdmFyIGUyOwogICAgICAgICAgICB0aGlzLnRvQXNzaWduYWJsZUxpc3QodDMucGFyYW1zLCAoZTIgPSB0My5leHRyYSkgPT0gbnVsbCA/IHZvaWQgMCA6IGUyLnRyYWlsaW5nQ29tbWEsIGZhbHNlKSwgdGhpcy5zY29wZS5lbnRlcig2KSwgc3VwZXIuY2hlY2tQYXJhbXModDMsIGZhbHNlLCB0cnVlKSwgdGhpcy5zY29wZS5leGl0KCk7CiAgICAgICAgICB9CiAgICAgICAgICBmb3J3YXJkTm9BcnJvd1BhcmFtc0NvbnZlcnNpb25BdCh0MywgZTIpIHsKICAgICAgICAgICAgbGV0IHMyOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5ub0Fycm93UGFyYW1zQ29udmVyc2lvbkF0LmluZGV4T2YodDMuc3RhcnQpICE9PSAtMSA/ICh0aGlzLnN0YXRlLm5vQXJyb3dQYXJhbXNDb252ZXJzaW9uQXQucHVzaCh0aGlzLnN0YXRlLnN0YXJ0KSwgczIgPSBlMigpLCB0aGlzLnN0YXRlLm5vQXJyb3dQYXJhbXNDb252ZXJzaW9uQXQucG9wKCkpIDogczIgPSBlMigpLCBzMjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlUGFyZW5JdGVtKHQzLCBlMiwgczIpIHsKICAgICAgICAgICAgaWYgKHQzID0gc3VwZXIucGFyc2VQYXJlbkl0ZW0odDMsIGUyLCBzMiksIHRoaXMuZWF0KDE3KSAmJiAodDMub3B0aW9uYWwgPSB0cnVlLCB0aGlzLnJlc2V0RW5kTG9jYXRpb24odDMpKSwgdGhpcy5tYXRjaCgxNCkpIHsKICAgICAgICAgICAgICBjb25zdCByMiA9IHRoaXMuc3RhcnROb2RlQXQoZTIsIHMyKTsKICAgICAgICAgICAgICByZXR1cm4gcjIuZXhwcmVzc2lvbiA9IHQzLCByMi50eXBlQW5ub3RhdGlvbiA9IHRoaXMuZmxvd1BhcnNlVHlwZUFubm90YXRpb24oKSwgdGhpcy5maW5pc2hOb2RlKHIyLCAiVHlwZUNhc3RFeHByZXNzaW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfQogICAgICAgICAgYXNzZXJ0TW9kdWxlTm9kZUFsbG93ZWQodDMpIHsKICAgICAgICAgICAgdDMudHlwZSA9PT0gIkltcG9ydERlY2xhcmF0aW9uIiAmJiAodDMuaW1wb3J0S2luZCA9PT0gInR5cGUiIHx8IHQzLmltcG9ydEtpbmQgPT09ICJ0eXBlb2YiKSB8fCB0My50eXBlID09PSAiRXhwb3J0TmFtZWREZWNsYXJhdGlvbiIgJiYgdDMuZXhwb3J0S2luZCA9PT0gInR5cGUiIHx8IHQzLnR5cGUgPT09ICJFeHBvcnRBbGxEZWNsYXJhdGlvbiIgJiYgdDMuZXhwb3J0S2luZCA9PT0gInR5cGUiIHx8IHN1cGVyLmFzc2VydE1vZHVsZU5vZGVBbGxvd2VkKHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRXhwb3J0KHQzKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gc3VwZXIucGFyc2VFeHBvcnQodDMpOwogICAgICAgICAgICByZXR1cm4gZTIudHlwZSAhPT0gIkV4cG9ydE5hbWVkRGVjbGFyYXRpb24iICYmIGUyLnR5cGUgIT09ICJFeHBvcnRBbGxEZWNsYXJhdGlvbiIgfHwgKGUyLmV4cG9ydEtpbmQgPSBlMi5leHBvcnRLaW5kIHx8ICJ2YWx1ZSIpLCBlMjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRXhwb3J0RGVjbGFyYXRpb24odDMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuaXNDb250ZXh0dWFsKDEyMCkpIHsKICAgICAgICAgICAgICB0My5leHBvcnRLaW5kID0gInR5cGUiOwogICAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMubWF0Y2goNSkgPyAodDMuc3BlY2lmaWVycyA9IHRoaXMucGFyc2VFeHBvcnRTcGVjaWZpZXJzKHRydWUpLCB0aGlzLnBhcnNlRXhwb3J0RnJvbSh0MyksIG51bGwpIDogdGhpcy5mbG93UGFyc2VUeXBlQWxpYXMoZTIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmlzQ29udGV4dHVhbCgxMjEpKSB7CiAgICAgICAgICAgICAgdDMuZXhwb3J0S2luZCA9ICJ0eXBlIjsKICAgICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0aGlzLmZsb3dQYXJzZU9wYXF1ZVR5cGUoZTIsIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5pc0NvbnRleHR1YWwoMTE5KSkgewogICAgICAgICAgICAgIHQzLmV4cG9ydEtpbmQgPSAidHlwZSI7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5mbG93UGFyc2VJbnRlcmZhY2UoZTIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLnNob3VsZFBhcnNlRW51bXMoKSAmJiB0aGlzLmlzQ29udGV4dHVhbCgxMTYpKSB7CiAgICAgICAgICAgICAgdDMuZXhwb3J0S2luZCA9ICJ2YWx1ZSI7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5mbG93UGFyc2VFbnVtRGVjbGFyYXRpb24oZTIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdXBlci5wYXJzZUV4cG9ydERlY2xhcmF0aW9uKHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIGVhdEV4cG9ydFN0YXIodDMpIHsKICAgICAgICAgICAgcmV0dXJuICEhc3VwZXIuZWF0RXhwb3J0U3RhciguLi5hcmd1bWVudHMpIHx8ICEoIXRoaXMuaXNDb250ZXh0dWFsKDEyMCkgfHwgdGhpcy5sb29rYWhlYWQoKS50eXBlICE9PSA0OSkgJiYgKHQzLmV4cG9ydEtpbmQgPSAidHlwZSIsIHRoaXMubmV4dCgpLCB0aGlzLm5leHQoKSwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBtYXliZVBhcnNlRXhwb3J0TmFtZXNwYWNlU3BlY2lmaWVyKHQzKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGF0ZS5zdGFydCwgczIgPSBzdXBlci5tYXliZVBhcnNlRXhwb3J0TmFtZXNwYWNlU3BlY2lmaWVyKHQzKTsKICAgICAgICAgICAgcmV0dXJuIHMyICYmIHQzLmV4cG9ydEtpbmQgPT09ICJ0eXBlIiAmJiB0aGlzLnVuZXhwZWN0ZWQoZTIpLCBzMjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3NJZCh0MywgZTIsIHMyKSB7CiAgICAgICAgICAgIHN1cGVyLnBhcnNlQ2xhc3NJZCh0MywgZTIsIHMyKSwgdGhpcy5tYXRjaCg0MykgJiYgKHQzLnR5cGVQYXJhbWV0ZXJzID0gdGhpcy5mbG93UGFyc2VUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24oKSk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNsYXNzTWVtYmVyKHQzLCBlMiwgczIpIHsKICAgICAgICAgICAgY29uc3QgcjIgPSB0aGlzLnN0YXRlLnN0YXJ0OwogICAgICAgICAgICBpZiAodGhpcy5pc0NvbnRleHR1YWwoMTE1KSkgewogICAgICAgICAgICAgIGlmICh0aGlzLnBhcnNlQ2xhc3NNZW1iZXJGcm9tTW9kaWZpZXIodDMsIGUyKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICBlMi5kZWNsYXJlID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdXBlci5wYXJzZUNsYXNzTWVtYmVyKHQzLCBlMiwgczIpLCBlMi5kZWNsYXJlICYmIChlMi50eXBlICE9PSAiQ2xhc3NQcm9wZXJ0eSIgJiYgZTIudHlwZSAhPT0gIkNsYXNzUHJpdmF0ZVByb3BlcnR5IiAmJiBlMi50eXBlICE9PSAiUHJvcGVydHlEZWZpbml0aW9uIiA/IHRoaXMucmFpc2UocjIsIFZsLkRlY2xhcmVDbGFzc0VsZW1lbnQpIDogZTIudmFsdWUgJiYgdGhpcy5yYWlzZShlMi52YWx1ZS5zdGFydCwgVmwuRGVjbGFyZUNsYXNzRmllbGRJbml0aWFsaXplcikpOwogICAgICAgICAgfQogICAgICAgICAgaXNJdGVyYXRvcih0MykgewogICAgICAgICAgICByZXR1cm4gdDMgPT09ICJpdGVyYXRvciIgfHwgdDMgPT09ICJhc3luY0l0ZXJhdG9yIjsKICAgICAgICAgIH0KICAgICAgICAgIHJlYWRJdGVyYXRvcigpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBzdXBlci5yZWFkV29yZDEoKSwgZTIgPSAiQEAiICsgdDM7CiAgICAgICAgICAgIHRoaXMuaXNJdGVyYXRvcih0MykgJiYgdGhpcy5zdGF0ZS5pblR5cGUgfHwgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnBvcywgRGMuSW52YWxpZElkZW50aWZpZXIsIGUyKSwgdGhpcy5maW5pc2hUb2tlbigxMjIsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIGdldFRva2VuRnJvbUNvZGUodDMpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MgKyAxKTsKICAgICAgICAgICAgcmV0dXJuIHQzID09PSAxMjMgJiYgZTIgPT09IDEyNCA/IHRoaXMuZmluaXNoT3AoNiwgMikgOiAhdGhpcy5zdGF0ZS5pblR5cGUgfHwgdDMgIT09IDYyICYmIHQzICE9PSA2MCA/IHRoaXMuc3RhdGUuaW5UeXBlICYmIHQzID09PSA2MyA/IGUyID09PSA0NiA/IHRoaXMuZmluaXNoT3AoMTgsIDIpIDogdGhpcy5maW5pc2hPcCgxNywgMSkgOiBmdW5jdGlvbih0NCwgZTMpIHsKICAgICAgICAgICAgICByZXR1cm4gdDQgPT09IDY0ICYmIGUzID09PSA2NDsKICAgICAgICAgICAgfSh0MywgZTIpID8gKHRoaXMuc3RhdGUucG9zICs9IDIsIHRoaXMucmVhZEl0ZXJhdG9yKCkpIDogc3VwZXIuZ2V0VG9rZW5Gcm9tQ29kZSh0MykgOiB0aGlzLmZpbmlzaE9wKHQzID09PSA2MiA/IDQ0IDogNDMsIDEpOwogICAgICAgICAgfQogICAgICAgICAgaXNBc3NpZ25hYmxlKHQzLCBlMikgewogICAgICAgICAgICByZXR1cm4gdDMudHlwZSA9PT0gIlR5cGVDYXN0RXhwcmVzc2lvbiIgPyB0aGlzLmlzQXNzaWduYWJsZSh0My5leHByZXNzaW9uLCBlMikgOiBzdXBlci5pc0Fzc2lnbmFibGUodDMsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHRvQXNzaWduYWJsZSh0MykgewogICAgICAgICAgICBsZXQgZTIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCAmJiBhcmd1bWVudHNbMV07CiAgICAgICAgICAgIHJldHVybiB0My50eXBlID09PSAiVHlwZUNhc3RFeHByZXNzaW9uIiA/IHN1cGVyLnRvQXNzaWduYWJsZSh0aGlzLnR5cGVDYXN0VG9QYXJhbWV0ZXIodDMpLCBlMikgOiBzdXBlci50b0Fzc2lnbmFibGUodDMsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHRvQXNzaWduYWJsZUxpc3QodDMsIGUyLCBzMikgewogICAgICAgICAgICBmb3IgKGxldCBlMyA9IDA7IGUzIDwgdDMubGVuZ3RoOyBlMysrKSB7CiAgICAgICAgICAgICAgY29uc3QgczMgPSB0M1tlM107CiAgICAgICAgICAgICAgKHMzID09IG51bGwgPyB2b2lkIDAgOiBzMy50eXBlKSA9PT0gIlR5cGVDYXN0RXhwcmVzc2lvbiIgJiYgKHQzW2UzXSA9IHRoaXMudHlwZUNhc3RUb1BhcmFtZXRlcihzMykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdXBlci50b0Fzc2lnbmFibGVMaXN0KHQzLCBlMiwgczIpOwogICAgICAgICAgfQogICAgICAgICAgdG9SZWZlcmVuY2VkTGlzdCh0MywgZTIpIHsKICAgICAgICAgICAgZm9yIChsZXQgcjIgPSAwOyByMiA8IHQzLmxlbmd0aDsgcjIrKykgewogICAgICAgICAgICAgIHZhciBzMjsKICAgICAgICAgICAgICBjb25zdCBpMiA9IHQzW3IyXTsKICAgICAgICAgICAgICAhaTIgfHwgaTIudHlwZSAhPT0gIlR5cGVDYXN0RXhwcmVzc2lvbiIgfHwgKHMyID0gaTIuZXh0cmEpICE9IG51bGwgJiYgczIucGFyZW50aGVzaXplZCB8fCAhKHQzLmxlbmd0aCA+IDEpICYmIGUyIHx8IHRoaXMucmFpc2UoaTIudHlwZUFubm90YXRpb24uc3RhcnQsIFZsLlR5cGVDYXN0SW5QYXR0ZXJuKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUFycmF5TGlrZSh0MywgZTIsIHMyLCByMikgewogICAgICAgICAgICBjb25zdCBpMiA9IHN1cGVyLnBhcnNlQXJyYXlMaWtlKHQzLCBlMiwgczIsIHIyKTsKICAgICAgICAgICAgcmV0dXJuIGUyICYmICF0aGlzLnN0YXRlLm1heWJlSW5BcnJvd1BhcmFtZXRlcnMgJiYgdGhpcy50b1JlZmVyZW5jZWRMaXN0KGkyLmVsZW1lbnRzKSwgaTI7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0xWYWwodDMpIHsKICAgICAgICAgICAgaWYgKHQzLnR5cGUgIT09ICJUeXBlQ2FzdEV4cHJlc3Npb24iKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgZTIgPSBhcmd1bWVudHMubGVuZ3RoLCBzMiA9IG5ldyBBcnJheShlMiA+IDEgPyBlMiAtIDEgOiAwKSwgcjIgPSAxOyByMiA8IGUyOyByMisrKQogICAgICAgICAgICAgICAgczJbcjIgLSAxXSA9IGFyZ3VtZW50c1tyMl07CiAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmNoZWNrTFZhbCh0MywgLi4uczIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNsYXNzUHJvcGVydHkodDMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goMTQpICYmICh0My50eXBlQW5ub3RhdGlvbiA9IHRoaXMuZmxvd1BhcnNlVHlwZUFubm90YXRpb24oKSksIHN1cGVyLnBhcnNlQ2xhc3NQcm9wZXJ0eSh0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNsYXNzUHJpdmF0ZVByb3BlcnR5KHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDE0KSAmJiAodDMudHlwZUFubm90YXRpb24gPSB0aGlzLmZsb3dQYXJzZVR5cGVBbm5vdGF0aW9uKCkpLCBzdXBlci5wYXJzZUNsYXNzUHJpdmF0ZVByb3BlcnR5KHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIGlzQ2xhc3NNZXRob2QoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDQzKSB8fCBzdXBlci5pc0NsYXNzTWV0aG9kKCk7CiAgICAgICAgICB9CiAgICAgICAgICBpc0NsYXNzUHJvcGVydHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDE0KSB8fCBzdXBlci5pc0NsYXNzUHJvcGVydHkoKTsKICAgICAgICAgIH0KICAgICAgICAgIGlzTm9uc3RhdGljQ29uc3RydWN0b3IodDMpIHsKICAgICAgICAgICAgcmV0dXJuICF0aGlzLm1hdGNoKDE0KSAmJiBzdXBlci5pc05vbnN0YXRpY0NvbnN0cnVjdG9yKHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIHB1c2hDbGFzc01ldGhvZCh0MywgZTIsIHMyLCByMiwgaTIsIG4yKSB7CiAgICAgICAgICAgIGlmIChlMi52YXJpYW5jZSAmJiB0aGlzLnVuZXhwZWN0ZWQoZTIudmFyaWFuY2Uuc3RhcnQpLCBkZWxldGUgZTIudmFyaWFuY2UsIHRoaXMubWF0Y2goNDMpICYmIChlMi50eXBlUGFyYW1ldGVycyA9IHRoaXMuZmxvd1BhcnNlVHlwZVBhcmFtZXRlckRlY2xhcmF0aW9uKCkpLCBzdXBlci5wdXNoQ2xhc3NNZXRob2QodDMsIGUyLCBzMiwgcjIsIGkyLCBuMiksIGUyLnBhcmFtcyAmJiBpMikgewogICAgICAgICAgICAgIGNvbnN0IHQ0ID0gZTIucGFyYW1zOwogICAgICAgICAgICAgIHQ0Lmxlbmd0aCA+IDAgJiYgdGhpcy5pc1RoaXNQYXJhbSh0NFswXSkgJiYgdGhpcy5yYWlzZShlMi5zdGFydCwgVmwuVGhpc1BhcmFtQmFubmVkSW5Db25zdHJ1Y3Rvcik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZTIudHlwZSA9PT0gIk1ldGhvZERlZmluaXRpb24iICYmIGkyICYmIGUyLnZhbHVlLnBhcmFtcykgewogICAgICAgICAgICAgIGNvbnN0IHQ0ID0gZTIudmFsdWUucGFyYW1zOwogICAgICAgICAgICAgIHQ0Lmxlbmd0aCA+IDAgJiYgdGhpcy5pc1RoaXNQYXJhbSh0NFswXSkgJiYgdGhpcy5yYWlzZShlMi5zdGFydCwgVmwuVGhpc1BhcmFtQmFubmVkSW5Db25zdHJ1Y3Rvcik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHB1c2hDbGFzc1ByaXZhdGVNZXRob2QodDMsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgZTIudmFyaWFuY2UgJiYgdGhpcy51bmV4cGVjdGVkKGUyLnZhcmlhbmNlLnN0YXJ0KSwgZGVsZXRlIGUyLnZhcmlhbmNlLCB0aGlzLm1hdGNoKDQzKSAmJiAoZTIudHlwZVBhcmFtZXRlcnMgPSB0aGlzLmZsb3dQYXJzZVR5cGVQYXJhbWV0ZXJEZWNsYXJhdGlvbigpKSwgc3VwZXIucHVzaENsYXNzUHJpdmF0ZU1ldGhvZCh0MywgZTIsIHMyLCByMik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNsYXNzU3VwZXIodDMpIHsKICAgICAgICAgICAgaWYgKHN1cGVyLnBhcnNlQ2xhc3NTdXBlcih0MyksIHQzLnN1cGVyQ2xhc3MgJiYgdGhpcy5tYXRjaCg0MykgJiYgKHQzLnN1cGVyVHlwZVBhcmFtZXRlcnMgPSB0aGlzLmZsb3dQYXJzZVR5cGVQYXJhbWV0ZXJJbnN0YW50aWF0aW9uKCkpLCB0aGlzLmlzQ29udGV4dHVhbCgxMDQpKSB7CiAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSB0My5pbXBsZW1lbnRzID0gW107CiAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgY29uc3QgdDQgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgICAgdDQuaWQgPSB0aGlzLmZsb3dQYXJzZVJlc3RyaWN0ZWRJZGVudGlmaWVyKHRydWUpLCB0aGlzLm1hdGNoKDQzKSA/IHQ0LnR5cGVQYXJhbWV0ZXJzID0gdGhpcy5mbG93UGFyc2VUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbigpIDogdDQudHlwZVBhcmFtZXRlcnMgPSBudWxsLCBlMi5wdXNoKHRoaXMuZmluaXNoTm9kZSh0NCwgIkNsYXNzSW1wbGVtZW50cyIpKTsKICAgICAgICAgICAgICB9IHdoaWxlICh0aGlzLmVhdCgxMikpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0dldHRlclNldHRlclBhcmFtcyh0MykgewogICAgICAgICAgICBzdXBlci5jaGVja0dldHRlclNldHRlclBhcmFtcyh0Myk7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5nZXRPYmplY3RPckNsYXNzTWV0aG9kUGFyYW1zKHQzKTsKICAgICAgICAgICAgaWYgKGUyLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBjb25zdCBzMiA9IGUyWzBdOwogICAgICAgICAgICAgIHRoaXMuaXNUaGlzUGFyYW0oczIpICYmIHQzLmtpbmQgPT09ICJnZXQiID8gdGhpcy5yYWlzZShzMi5zdGFydCwgVmwuR2V0dGVyTWF5Tm90SGF2ZVRoaXNQYXJhbSkgOiB0aGlzLmlzVGhpc1BhcmFtKHMyKSAmJiB0aGlzLnJhaXNlKHMyLnN0YXJ0LCBWbC5TZXR0ZXJNYXlOb3RIYXZlVGhpc1BhcmFtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcGFyc2VQcm9wZXJ0eU5hbWVQcmVmaXhPcGVyYXRvcih0MykgewogICAgICAgICAgICB0My52YXJpYW5jZSA9IHRoaXMuZmxvd1BhcnNlVmFyaWFuY2UoKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlT2JqUHJvcFZhbHVlKHQzLCBlMiwgczIsIHIyLCBpMiwgbjIsIGEyLCBvMikgewogICAgICAgICAgICBsZXQgdTI7CiAgICAgICAgICAgIHQzLnZhcmlhbmNlICYmIHRoaXMudW5leHBlY3RlZCh0My52YXJpYW5jZS5zdGFydCksIGRlbGV0ZSB0My52YXJpYW5jZSwgdGhpcy5tYXRjaCg0MykgJiYgIWEyICYmICh1MiA9IHRoaXMuZmxvd1BhcnNlVHlwZVBhcmFtZXRlckRlY2xhcmF0aW9uKCksIHRoaXMubWF0Y2goMTApIHx8IHRoaXMudW5leHBlY3RlZCgpKSwgc3VwZXIucGFyc2VPYmpQcm9wVmFsdWUodDMsIGUyLCBzMiwgcjIsIGkyLCBuMiwgYTIsIG8yKSwgdTIgJiYgKCh0My52YWx1ZSB8fCB0MykudHlwZVBhcmFtZXRlcnMgPSB1Mik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUFzc2lnbmFibGVMaXN0SXRlbVR5cGVzKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhdCgxNykgJiYgKHQzLnR5cGUgIT09ICJJZGVudGlmaWVyIiAmJiB0aGlzLnJhaXNlKHQzLnN0YXJ0LCBWbC5QYXR0ZXJuSXNPcHRpb25hbCksIHRoaXMuaXNUaGlzUGFyYW0odDMpICYmIHRoaXMucmFpc2UodDMuc3RhcnQsIFZsLlRoaXNQYXJhbU1heU5vdEJlT3B0aW9uYWwpLCB0My5vcHRpb25hbCA9IHRydWUpLCB0aGlzLm1hdGNoKDE0KSA/IHQzLnR5cGVBbm5vdGF0aW9uID0gdGhpcy5mbG93UGFyc2VUeXBlQW5ub3RhdGlvbigpIDogdGhpcy5pc1RoaXNQYXJhbSh0MykgJiYgdGhpcy5yYWlzZSh0My5zdGFydCwgVmwuVGhpc1BhcmFtQW5ub3RhdGlvblJlcXVpcmVkKSwgdGhpcy5tYXRjaCgyNykgJiYgdGhpcy5pc1RoaXNQYXJhbSh0MykgJiYgdGhpcy5yYWlzZSh0My5zdGFydCwgVmwuVGhpc1BhcmFtTm9EZWZhdWx0KSwgdGhpcy5yZXNldEVuZExvY2F0aW9uKHQzKSwgdDM7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU1heWJlRGVmYXVsdCh0MywgZTIsIHMyKSB7CiAgICAgICAgICAgIGNvbnN0IHIyID0gc3VwZXIucGFyc2VNYXliZURlZmF1bHQodDMsIGUyLCBzMik7CiAgICAgICAgICAgIHJldHVybiByMi50eXBlID09PSAiQXNzaWdubWVudFBhdHRlcm4iICYmIHIyLnR5cGVBbm5vdGF0aW9uICYmIHIyLnJpZ2h0LnN0YXJ0IDwgcjIudHlwZUFubm90YXRpb24uc3RhcnQgJiYgdGhpcy5yYWlzZShyMi50eXBlQW5ub3RhdGlvbi5zdGFydCwgVmwuVHlwZUJlZm9yZUluaXRpYWxpemVyKSwgcjI7CiAgICAgICAgICB9CiAgICAgICAgICBzaG91bGRQYXJzZURlZmF1bHRJbXBvcnQodDMpIHsKICAgICAgICAgICAgcmV0dXJuIHFsKHQzKSA/IFdsKHRoaXMuc3RhdGUudHlwZSkgOiBzdXBlci5zaG91bGRQYXJzZURlZmF1bHRJbXBvcnQodDMpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VJbXBvcnRTcGVjaWZpZXJMb2NhbCh0MywgZTIsIHMyLCByMikgewogICAgICAgICAgICBlMi5sb2NhbCA9IHFsKHQzKSA/IHRoaXMuZmxvd1BhcnNlUmVzdHJpY3RlZElkZW50aWZpZXIodHJ1ZSwgdHJ1ZSkgOiB0aGlzLnBhcnNlSWRlbnRpZmllcigpLCB0aGlzLmNoZWNrTFZhbChlMi5sb2NhbCwgcjIsIDkpLCB0My5zcGVjaWZpZXJzLnB1c2godGhpcy5maW5pc2hOb2RlKGUyLCBzMikpOwogICAgICAgICAgfQogICAgICAgICAgbWF5YmVQYXJzZURlZmF1bHRJbXBvcnRTcGVjaWZpZXIodDMpIHsKICAgICAgICAgICAgdDMuaW1wb3J0S2luZCA9ICJ2YWx1ZSI7CiAgICAgICAgICAgIGxldCBlMiA9IG51bGw7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDgxKSA/IGUyID0gInR5cGVvZiIgOiB0aGlzLmlzQ29udGV4dHVhbCgxMjApICYmIChlMiA9ICJ0eXBlIiksIGUyKSB7CiAgICAgICAgICAgICAgY29uc3QgczIgPSB0aGlzLmxvb2thaGVhZCgpLCB7IHR5cGU6IHIyIH0gPSBzMjsKICAgICAgICAgICAgICBlMiA9PT0gInR5cGUiICYmIHIyID09PSA0OSAmJiB0aGlzLnVuZXhwZWN0ZWQoczIuc3RhcnQpLCAoV2wocjIpIHx8IHIyID09PSA1IHx8IHIyID09PSA0OSkgJiYgKHRoaXMubmV4dCgpLCB0My5pbXBvcnRLaW5kID0gZTIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdXBlci5tYXliZVBhcnNlRGVmYXVsdEltcG9ydFNwZWNpZmllcih0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUltcG9ydFNwZWNpZmllcih0MywgZTIsIHMyLCByMikgewogICAgICAgICAgICBjb25zdCBpMiA9IHQzLmltcG9ydGVkOwogICAgICAgICAgICBsZXQgbjIgPSBudWxsOwogICAgICAgICAgICBpMi50eXBlID09PSAiSWRlbnRpZmllciIgJiYgKGkyLm5hbWUgPT09ICJ0eXBlIiA/IG4yID0gInR5cGUiIDogaTIubmFtZSA9PT0gInR5cGVvZiIgJiYgKG4yID0gInR5cGVvZiIpKTsKICAgICAgICAgICAgbGV0IGEyID0gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLmlzQ29udGV4dHVhbCg4NykgJiYgIXRoaXMuaXNMb29rYWhlYWRDb250ZXh0dWFsKCJhcyIpKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLnBhcnNlSWRlbnRpZmllcih0cnVlKTsKICAgICAgICAgICAgICBuMiA9PT0gbnVsbCB8fCBfYyh0aGlzLnN0YXRlLnR5cGUpID8gKHQzLmltcG9ydGVkID0gaTIsIHQzLmltcG9ydEtpbmQgPSBudWxsLCB0My5sb2NhbCA9IHRoaXMucGFyc2VJZGVudGlmaWVyKCkpIDogKHQzLmltcG9ydGVkID0gZTMsIHQzLmltcG9ydEtpbmQgPSBuMiwgdDMubG9jYWwgPSBfbChlMykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmIChuMiAhPT0gbnVsbCAmJiBfYyh0aGlzLnN0YXRlLnR5cGUpKQogICAgICAgICAgICAgICAgdDMuaW1wb3J0ZWQgPSB0aGlzLnBhcnNlSWRlbnRpZmllcih0cnVlKSwgdDMuaW1wb3J0S2luZCA9IG4yOwogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGUyKQogICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHQzLnN0YXJ0LCBEYy5JbXBvcnRCaW5kaW5nSXNTdHJpbmcsIGkyLnZhbHVlKTsKICAgICAgICAgICAgICAgIHQzLmltcG9ydGVkID0gaTIsIHQzLmltcG9ydEtpbmQgPSBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLmVhdENvbnRleHR1YWwoODcpID8gdDMubG9jYWwgPSB0aGlzLnBhcnNlSWRlbnRpZmllcigpIDogKGEyID0gdHJ1ZSwgdDMubG9jYWwgPSBfbCh0My5pbXBvcnRlZCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG8yID0gcWwodDMpOwogICAgICAgICAgICByZXR1cm4gczIgJiYgbzIgJiYgdGhpcy5yYWlzZSh0My5zdGFydCwgVmwuSW1wb3J0VHlwZVNob3J0aGFuZE9ubHlJblB1cmVJbXBvcnQpLCAoczIgfHwgbzIpICYmIHRoaXMuY2hlY2tSZXNlcnZlZFR5cGUodDMubG9jYWwubmFtZSwgdDMubG9jYWwuc3RhcnQsIHRydWUpLCAhYTIgfHwgczIgfHwgbzIgfHwgdGhpcy5jaGVja1Jlc2VydmVkV29yZCh0My5sb2NhbC5uYW1lLCB0My5zdGFydCwgdHJ1ZSwgdHJ1ZSksIHRoaXMuY2hlY2tMVmFsKHQzLmxvY2FsLCAiaW1wb3J0IHNwZWNpZmllciIsIDkpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJJbXBvcnRTcGVjaWZpZXIiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQmluZGluZ0F0b20oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnR5cGUgPT09IDcyID8gdGhpcy5wYXJzZUlkZW50aWZpZXIodHJ1ZSkgOiBzdXBlci5wYXJzZUJpbmRpbmdBdG9tKCk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUZ1bmN0aW9uUGFyYW1zKHQzLCBlMikgewogICAgICAgICAgICBjb25zdCBzMiA9IHQzLmtpbmQ7CiAgICAgICAgICAgIHMyICE9PSAiZ2V0IiAmJiBzMiAhPT0gInNldCIgJiYgdGhpcy5tYXRjaCg0MykgJiYgKHQzLnR5cGVQYXJhbWV0ZXJzID0gdGhpcy5mbG93UGFyc2VUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24oKSksIHN1cGVyLnBhcnNlRnVuY3Rpb25QYXJhbXModDMsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlVmFySWQodDMsIGUyKSB7CiAgICAgICAgICAgIHN1cGVyLnBhcnNlVmFySWQodDMsIGUyKSwgdGhpcy5tYXRjaCgxNCkgJiYgKHQzLmlkLnR5cGVBbm5vdGF0aW9uID0gdGhpcy5mbG93UGFyc2VUeXBlQW5ub3RhdGlvbigpLCB0aGlzLnJlc2V0RW5kTG9jYXRpb24odDMuaWQpKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQXN5bmNBcnJvd0Zyb21DYWxsRXhwcmVzc2lvbih0MywgZTIpIHsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goMTQpKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLnN0YXRlLm5vQW5vbkZ1bmN0aW9uVHlwZTsKICAgICAgICAgICAgICB0aGlzLnN0YXRlLm5vQW5vbkZ1bmN0aW9uVHlwZSA9IHRydWUsIHQzLnJldHVyblR5cGUgPSB0aGlzLmZsb3dQYXJzZVR5cGVBbm5vdGF0aW9uKCksIHRoaXMuc3RhdGUubm9Bbm9uRnVuY3Rpb25UeXBlID0gZTM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnBhcnNlQXN5bmNBcnJvd0Zyb21DYWxsRXhwcmVzc2lvbih0MywgZTIpOwogICAgICAgICAgfQogICAgICAgICAgc2hvdWxkUGFyc2VBc3luY0Fycm93KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaCgxNCkgfHwgc3VwZXIuc2hvdWxkUGFyc2VBc3luY0Fycm93KCk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU1heWJlQXNzaWduKHQzLCBlMikgewogICAgICAgICAgICB2YXIgczI7CiAgICAgICAgICAgIGxldCByMiwgaTIgPSBudWxsOwogICAgICAgICAgICBpZiAodGhpcy5oYXNQbHVnaW4oImpzeCIpICYmICh0aGlzLm1hdGNoKDEzMikgfHwgdGhpcy5tYXRjaCg0MykpKSB7CiAgICAgICAgICAgICAgaWYgKGkyID0gdGhpcy5zdGF0ZS5jbG9uZSgpLCByMiA9IHRoaXMudHJ5UGFyc2UoKCkgPT4gc3VwZXIucGFyc2VNYXliZUFzc2lnbih0MywgZTIpLCBpMiksICFyMi5lcnJvcikKICAgICAgICAgICAgICAgIHJldHVybiByMi5ub2RlOwogICAgICAgICAgICAgIGNvbnN0IHsgY29udGV4dDogczMgfSA9IHRoaXMuc3RhdGUsIG4zID0gczNbczMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgbjMgPT09IEFjLmpfb1RhZyA/IHMzLmxlbmd0aCAtPSAyIDogbjMgPT09IEFjLmpfZXhwciAmJiAoczMubGVuZ3RoIC09IDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoczIgPSByMikgIT0gbnVsbCAmJiBzMi5lcnJvciB8fCB0aGlzLm1hdGNoKDQzKSkgewogICAgICAgICAgICAgIHZhciBuMiwgYTI7CiAgICAgICAgICAgICAgbGV0IHMzOwogICAgICAgICAgICAgIGkyID0gaTIgfHwgdGhpcy5zdGF0ZS5jbG9uZSgpOwogICAgICAgICAgICAgIGNvbnN0IG8yID0gdGhpcy50cnlQYXJzZSgocjMpID0+IHsKICAgICAgICAgICAgICAgIHZhciBpMzsKICAgICAgICAgICAgICAgIHMzID0gdGhpcy5mbG93UGFyc2VUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24oKTsKICAgICAgICAgICAgICAgIGNvbnN0IG4zID0gdGhpcy5mb3J3YXJkTm9BcnJvd1BhcmFtc0NvbnZlcnNpb25BdChzMywgKCkgPT4gewogICAgICAgICAgICAgICAgICBjb25zdCByNCA9IHN1cGVyLnBhcnNlTWF5YmVBc3NpZ24odDMsIGUyKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVzZXRTdGFydExvY2F0aW9uRnJvbU5vZGUocjQsIHMzKSwgcjQ7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIChpMyA9IG4zLmV4dHJhKSAhPSBudWxsICYmIGkzLnBhcmVudGhlc2l6ZWQgJiYgcjMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGEzID0gdGhpcy5tYXliZVVud3JhcFR5cGVDYXN0RXhwcmVzc2lvbihuMyk7CiAgICAgICAgICAgICAgICByZXR1cm4gYTMudHlwZSAhPT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiAmJiByMygpLCBhMy50eXBlUGFyYW1ldGVycyA9IHMzLCB0aGlzLnJlc2V0U3RhcnRMb2NhdGlvbkZyb21Ob2RlKGEzLCBzMyksIG4zOwogICAgICAgICAgICAgIH0sIGkyKTsKICAgICAgICAgICAgICBsZXQgdTIgPSBudWxsOwogICAgICAgICAgICAgIGlmIChvMi5ub2RlICYmIHRoaXMubWF5YmVVbndyYXBUeXBlQ2FzdEV4cHJlc3Npb24obzIubm9kZSkudHlwZSA9PT0gIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIikgewogICAgICAgICAgICAgICAgaWYgKCFvMi5lcnJvciAmJiAhbzIuYWJvcnRlZCkKICAgICAgICAgICAgICAgICAgcmV0dXJuIG8yLm5vZGUuYXN5bmMgJiYgdGhpcy5yYWlzZShzMy5zdGFydCwgVmwuVW5leHBlY3RlZFR5cGVQYXJhbWV0ZXJCZWZvcmVBc3luY0Fycm93RnVuY3Rpb24pLCBvMi5ub2RlOwogICAgICAgICAgICAgICAgdTIgPSBvMi5ub2RlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoKG4yID0gcjIpICE9IG51bGwgJiYgbjIubm9kZSkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlID0gcjIuZmFpbFN0YXRlLCByMi5ub2RlOwogICAgICAgICAgICAgIGlmICh1MikKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlID0gbzIuZmFpbFN0YXRlLCB1MjsKICAgICAgICAgICAgICBpZiAoKGEyID0gcjIpICE9IG51bGwgJiYgYTIudGhyb3duKQogICAgICAgICAgICAgICAgdGhyb3cgcjIuZXJyb3I7CiAgICAgICAgICAgICAgaWYgKG8yLnRocm93bikKICAgICAgICAgICAgICAgIHRocm93IG8yLmVycm9yOwogICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UoczMuc3RhcnQsIFZsLlVuZXhwZWN0ZWRUb2tlbkFmdGVyVHlwZVBhcmFtZXRlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnBhcnNlTWF5YmVBc3NpZ24odDMsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQXJyb3codDMpIHsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goMTQpKSB7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnRyeVBhcnNlKCgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5zdGF0ZS5ub0Fub25GdW5jdGlvblR5cGU7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLm5vQW5vbkZ1bmN0aW9uVHlwZSA9IHRydWU7CiAgICAgICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gW3MyLnR5cGVBbm5vdGF0aW9uLCB0My5wcmVkaWNhdGVdID0gdGhpcy5mbG93UGFyc2VUeXBlQW5kUHJlZGljYXRlSW5pdGlhbGlzZXIoKSwgdGhpcy5zdGF0ZS5ub0Fub25GdW5jdGlvblR5cGUgPSBlMywgdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKSAmJiB0aGlzLnVuZXhwZWN0ZWQoKSwgdGhpcy5tYXRjaCgxOSkgfHwgdGhpcy51bmV4cGVjdGVkKCksIHMyOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGlmIChlMi50aHJvd24pCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICBlMi5lcnJvciAmJiAodGhpcy5zdGF0ZSA9IGUyLmZhaWxTdGF0ZSksIHQzLnJldHVyblR5cGUgPSBlMi5ub2RlLnR5cGVBbm5vdGF0aW9uID8gdGhpcy5maW5pc2hOb2RlKGUyLm5vZGUsICJUeXBlQW5ub3RhdGlvbiIpIDogbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc3VwZXIucGFyc2VBcnJvdyh0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBzaG91bGRQYXJzZUFycm93KHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDE0KSB8fCBzdXBlci5zaG91bGRQYXJzZUFycm93KHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIHNldEFycm93RnVuY3Rpb25QYXJhbWV0ZXJzKHQzLCBlMikgewogICAgICAgICAgICB0aGlzLnN0YXRlLm5vQXJyb3dQYXJhbXNDb252ZXJzaW9uQXQuaW5kZXhPZih0My5zdGFydCkgIT09IC0xID8gdDMucGFyYW1zID0gZTIgOiBzdXBlci5zZXRBcnJvd0Z1bmN0aW9uUGFyYW1ldGVycyh0MywgZTIpOwogICAgICAgICAgfQogICAgICAgICAgY2hlY2tQYXJhbXModDMsIGUyLCBzMikgewogICAgICAgICAgICBpZiAoIXMyIHx8IHRoaXMuc3RhdGUubm9BcnJvd1BhcmFtc0NvbnZlcnNpb25BdC5pbmRleE9mKHQzLnN0YXJ0KSA9PT0gLTEpIHsKICAgICAgICAgICAgICBmb3IgKGxldCBlMyA9IDA7IGUzIDwgdDMucGFyYW1zLmxlbmd0aDsgZTMrKykKICAgICAgICAgICAgICAgIHRoaXMuaXNUaGlzUGFyYW0odDMucGFyYW1zW2UzXSkgJiYgZTMgPiAwICYmIHRoaXMucmFpc2UodDMucGFyYW1zW2UzXS5zdGFydCwgVmwuVGhpc1BhcmFtTXVzdEJlRmlyc3QpOwogICAgICAgICAgICAgIHJldHVybiBzdXBlci5jaGVja1BhcmFtcyguLi5hcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZVBhcmVuQW5kRGlzdGluZ3Vpc2hFeHByZXNzaW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5wYXJzZVBhcmVuQW5kRGlzdGluZ3Vpc2hFeHByZXNzaW9uKHQzICYmIHRoaXMuc3RhdGUubm9BcnJvd0F0LmluZGV4T2YodGhpcy5zdGF0ZS5zdGFydCkgPT09IC0xKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlU3Vic2NyaXB0cyh0MywgZTIsIHMyLCByMikgewogICAgICAgICAgICBpZiAodDMudHlwZSA9PT0gIklkZW50aWZpZXIiICYmIHQzLm5hbWUgPT09ICJhc3luYyIgJiYgdGhpcy5zdGF0ZS5ub0Fycm93QXQuaW5kZXhPZihlMikgIT09IC0xKSB7CiAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgY29uc3QgcjMgPSB0aGlzLnN0YXJ0Tm9kZUF0KGUyLCBzMik7CiAgICAgICAgICAgICAgcjMuY2FsbGVlID0gdDMsIHIzLmFyZ3VtZW50cyA9IHRoaXMucGFyc2VDYWxsRXhwcmVzc2lvbkFyZ3VtZW50cygxMSwgZmFsc2UpLCB0MyA9IHRoaXMuZmluaXNoTm9kZShyMywgIkNhbGxFeHByZXNzaW9uIik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodDMudHlwZSA9PT0gIklkZW50aWZpZXIiICYmIHQzLm5hbWUgPT09ICJhc3luYyIgJiYgdGhpcy5tYXRjaCg0MykpIHsKICAgICAgICAgICAgICBjb25zdCBpMiA9IHRoaXMuc3RhdGUuY2xvbmUoKSwgbjIgPSB0aGlzLnRyeVBhcnNlKCh0NCkgPT4gdGhpcy5wYXJzZUFzeW5jQXJyb3dXaXRoVHlwZVBhcmFtZXRlcnMoZTIsIHMyKSB8fCB0NCgpLCBpMik7CiAgICAgICAgICAgICAgaWYgKCFuMi5lcnJvciAmJiAhbjIuYWJvcnRlZCkKICAgICAgICAgICAgICAgIHJldHVybiBuMi5ub2RlOwogICAgICAgICAgICAgIGNvbnN0IGEyID0gdGhpcy50cnlQYXJzZSgoKSA9PiBzdXBlci5wYXJzZVN1YnNjcmlwdHModDMsIGUyLCBzMiwgcjIpLCBpMik7CiAgICAgICAgICAgICAgaWYgKGEyLm5vZGUgJiYgIWEyLmVycm9yKQogICAgICAgICAgICAgICAgcmV0dXJuIGEyLm5vZGU7CiAgICAgICAgICAgICAgaWYgKG4yLm5vZGUpCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZSA9IG4yLmZhaWxTdGF0ZSwgbjIubm9kZTsKICAgICAgICAgICAgICBpZiAoYTIubm9kZSkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlID0gYTIuZmFpbFN0YXRlLCBhMi5ub2RlOwogICAgICAgICAgICAgIHRocm93IG4yLmVycm9yIHx8IGEyLmVycm9yOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdXBlci5wYXJzZVN1YnNjcmlwdHModDMsIGUyLCBzMiwgcjIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VTdWJzY3JpcHQodDMsIGUyLCBzMiwgcjIsIGkyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDE4KSAmJiB0aGlzLmlzTG9va2FoZWFkVG9rZW5fbHQoKSkgewogICAgICAgICAgICAgIGlmIChpMi5vcHRpb25hbENoYWluTWVtYmVyID0gdHJ1ZSwgcjIpCiAgICAgICAgICAgICAgICByZXR1cm4gaTIuc3RvcCA9IHRydWUsIHQzOwogICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgIGNvbnN0IG4yID0gdGhpcy5zdGFydE5vZGVBdChlMiwgczIpOwogICAgICAgICAgICAgIHJldHVybiBuMi5jYWxsZWUgPSB0MywgbjIudHlwZUFyZ3VtZW50cyA9IHRoaXMuZmxvd1BhcnNlVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24oKSwgdGhpcy5leHBlY3QoMTApLCBuMi5hcmd1bWVudHMgPSB0aGlzLnBhcnNlQ2FsbEV4cHJlc3Npb25Bcmd1bWVudHMoMTEsIGZhbHNlKSwgbjIub3B0aW9uYWwgPSB0cnVlLCB0aGlzLmZpbmlzaENhbGxFeHByZXNzaW9uKG4yLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXIyICYmIHRoaXMuc2hvdWxkUGFyc2VUeXBlcygpICYmIHRoaXMubWF0Y2goNDMpKSB7CiAgICAgICAgICAgICAgY29uc3QgcjMgPSB0aGlzLnN0YXJ0Tm9kZUF0KGUyLCBzMik7CiAgICAgICAgICAgICAgcjMuY2FsbGVlID0gdDM7CiAgICAgICAgICAgICAgY29uc3QgbjIgPSB0aGlzLnRyeVBhcnNlKCgpID0+IChyMy50eXBlQXJndW1lbnRzID0gdGhpcy5mbG93UGFyc2VUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbkNhbGxPck5ldygpLCB0aGlzLmV4cGVjdCgxMCksIHIzLmFyZ3VtZW50cyA9IHRoaXMucGFyc2VDYWxsRXhwcmVzc2lvbkFyZ3VtZW50cygxMSwgZmFsc2UpLCBpMi5vcHRpb25hbENoYWluTWVtYmVyICYmIChyMy5vcHRpb25hbCA9IGZhbHNlKSwgdGhpcy5maW5pc2hDYWxsRXhwcmVzc2lvbihyMywgaTIub3B0aW9uYWxDaGFpbk1lbWJlcikpKTsKICAgICAgICAgICAgICBpZiAobjIubm9kZSkKICAgICAgICAgICAgICAgIHJldHVybiBuMi5lcnJvciAmJiAodGhpcy5zdGF0ZSA9IG4yLmZhaWxTdGF0ZSksIG4yLm5vZGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnBhcnNlU3Vic2NyaXB0KHQzLCBlMiwgczIsIHIyLCBpMik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU5ld0FyZ3VtZW50cyh0MykgewogICAgICAgICAgICBsZXQgZTIgPSBudWxsOwogICAgICAgICAgICB0aGlzLnNob3VsZFBhcnNlVHlwZXMoKSAmJiB0aGlzLm1hdGNoKDQzKSAmJiAoZTIgPSB0aGlzLnRyeVBhcnNlKCgpID0+IHRoaXMuZmxvd1BhcnNlVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb25DYWxsT3JOZXcoKSkubm9kZSksIHQzLnR5cGVBcmd1bWVudHMgPSBlMiwgc3VwZXIucGFyc2VOZXdBcmd1bWVudHModDMpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VBc3luY0Fycm93V2l0aFR5cGVQYXJhbWV0ZXJzKHQzLCBlMikgewogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhcnROb2RlQXQodDMsIGUyKTsKICAgICAgICAgICAgaWYgKHRoaXMucGFyc2VGdW5jdGlvblBhcmFtcyhzMiksIHRoaXMucGFyc2VBcnJvdyhzMikpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VBcnJvd0V4cHJlc3Npb24oczIsIHZvaWQgMCwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICByZWFkVG9rZW5fbXVsdF9tb2R1bG8odDMpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MgKyAxKTsKICAgICAgICAgICAgaWYgKHQzID09PSA0MiAmJiBlMiA9PT0gNDcgJiYgdGhpcy5zdGF0ZS5oYXNGbG93Q29tbWVudCkKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5oYXNGbG93Q29tbWVudCA9IGZhbHNlLCB0aGlzLnN0YXRlLnBvcyArPSAyLCB2b2lkIHRoaXMubmV4dFRva2VuKCk7CiAgICAgICAgICAgIHN1cGVyLnJlYWRUb2tlbl9tdWx0X21vZHVsbyh0Myk7CiAgICAgICAgICB9CiAgICAgICAgICByZWFkVG9rZW5fcGlwZV9hbXAodDMpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MgKyAxKTsKICAgICAgICAgICAgdDMgIT09IDEyNCB8fCBlMiAhPT0gMTI1ID8gc3VwZXIucmVhZFRva2VuX3BpcGVfYW1wKHQzKSA6IHRoaXMuZmluaXNoT3AoOSwgMik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZVRvcExldmVsKHQzLCBlMikgewogICAgICAgICAgICBjb25zdCBzMiA9IHN1cGVyLnBhcnNlVG9wTGV2ZWwodDMsIGUyKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuaGFzRmxvd0NvbW1lbnQgJiYgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnBvcywgVmwuVW50ZXJtaW5hdGVkRmxvd0NvbW1lbnQpLCBzMjsKICAgICAgICAgIH0KICAgICAgICAgIHNraXBCbG9ja0NvbW1lbnQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmhhc1BsdWdpbigiZmxvd0NvbW1lbnRzIikgJiYgdGhpcy5za2lwRmxvd0NvbW1lbnQoKSkKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5oYXNGbG93Q29tbWVudCAmJiB0aGlzLnVuZXhwZWN0ZWQobnVsbCwgVmwuTmVzdGVkRmxvd0NvbW1lbnQpLCB0aGlzLmhhc0Zsb3dDb21tZW50Q29tcGxldGlvbigpLCB0aGlzLnN0YXRlLnBvcyArPSB0aGlzLnNraXBGbG93Q29tbWVudCgpLCB2b2lkICh0aGlzLnN0YXRlLmhhc0Zsb3dDb21tZW50ID0gdHJ1ZSk7CiAgICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5oYXNGbG93Q29tbWVudCkKICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuc2tpcEJsb2NrQ29tbWVudCgpOwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLmlucHV0LmluZGV4T2YoIiotLyIsIHRoaXMuc3RhdGUucG9zICs9IDIpOwogICAgICAgICAgICAgIGlmICh0MyA9PT0gLTEpCiAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUucG9zIC0gMiwgRGMuVW50ZXJtaW5hdGVkQ29tbWVudCk7CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5wb3MgPSB0MyArIDM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHNraXBGbG93Q29tbWVudCgpIHsKICAgICAgICAgICAgY29uc3QgeyBwb3M6IHQzIH0gPSB0aGlzLnN0YXRlOwogICAgICAgICAgICBsZXQgZTIgPSAyOwogICAgICAgICAgICBmb3IgKDsgWzMyLCA5XS5pbmNsdWRlcyh0aGlzLmlucHV0LmNoYXJDb2RlQXQodDMgKyBlMikpOyApCiAgICAgICAgICAgICAgZTIrKzsKICAgICAgICAgICAgY29uc3QgczIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQoZTIgKyB0MyksIHIyID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KGUyICsgdDMgKyAxKTsKICAgICAgICAgICAgcmV0dXJuIHMyID09PSA1OCAmJiByMiA9PT0gNTggPyBlMiArIDIgOiB0aGlzLmlucHV0LnNsaWNlKGUyICsgdDMsIGUyICsgdDMgKyAxMikgPT09ICJmbG93LWluY2x1ZGUiID8gZTIgKyAxMiA6IHMyID09PSA1OCAmJiByMiAhPT0gNTggJiYgZTI7CiAgICAgICAgICB9CiAgICAgICAgICBoYXNGbG93Q29tbWVudENvbXBsZXRpb24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlucHV0LmluZGV4T2YoIiovIiwgdGhpcy5zdGF0ZS5wb3MpID09PSAtMSkKICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUucG9zLCBEYy5VbnRlcm1pbmF0ZWRDb21tZW50KTsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dFbnVtRXJyb3JCb29sZWFuTWVtYmVyTm90SW5pdGlhbGl6ZWQodDMsIGUyKSB7CiAgICAgICAgICAgIGxldCB7IGVudW1OYW1lOiBzMiwgbWVtYmVyTmFtZTogcjIgfSA9IGUyOwogICAgICAgICAgICB0aGlzLnJhaXNlKHQzLCBWbC5FbnVtQm9vbGVhbk1lbWJlck5vdEluaXRpYWxpemVkLCByMiwgczIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd0VudW1FcnJvckludmFsaWRNZW1iZXJOYW1lKHQzLCBlMikgewogICAgICAgICAgICBsZXQgeyBlbnVtTmFtZTogczIsIG1lbWJlck5hbWU6IHIyIH0gPSBlMjsKICAgICAgICAgICAgY29uc3QgaTIgPSByMlswXS50b1VwcGVyQ2FzZSgpICsgcjIuc2xpY2UoMSk7CiAgICAgICAgICAgIHRoaXMucmFpc2UodDMsIFZsLkVudW1JbnZhbGlkTWVtYmVyTmFtZSwgcjIsIGkyLCBzMik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93RW51bUVycm9yRHVwbGljYXRlTWVtYmVyTmFtZSh0MywgZTIpIHsKICAgICAgICAgICAgbGV0IHsgZW51bU5hbWU6IHMyLCBtZW1iZXJOYW1lOiByMiB9ID0gZTI7CiAgICAgICAgICAgIHRoaXMucmFpc2UodDMsIFZsLkVudW1EdXBsaWNhdGVNZW1iZXJOYW1lLCByMiwgczIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd0VudW1FcnJvckluY29uc2lzdGVudE1lbWJlclZhbHVlcyh0MywgZTIpIHsKICAgICAgICAgICAgbGV0IHsgZW51bU5hbWU6IHMyIH0gPSBlMjsKICAgICAgICAgICAgdGhpcy5yYWlzZSh0MywgVmwuRW51bUluY29uc2lzdGVudE1lbWJlclZhbHVlcywgczIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd0VudW1FcnJvckludmFsaWRFeHBsaWNpdFR5cGUodDMsIGUyKSB7CiAgICAgICAgICAgIGxldCB7IGVudW1OYW1lOiBzMiwgc3VwcGxpZWRUeXBlOiByMiB9ID0gZTI7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJhaXNlKHQzLCByMiA9PT0gbnVsbCA/IFZsLkVudW1JbnZhbGlkRXhwbGljaXRUeXBlVW5rbm93blN1cHBsaWVkIDogVmwuRW51bUludmFsaWRFeHBsaWNpdFR5cGUsIHMyLCByMik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93RW51bUVycm9ySW52YWxpZE1lbWJlckluaXRpYWxpemVyKHQzLCBlMikgewogICAgICAgICAgICBsZXQgeyBlbnVtTmFtZTogczIsIGV4cGxpY2l0VHlwZTogcjIsIG1lbWJlck5hbWU6IGkyIH0gPSBlMiwgbjIgPSBudWxsOwogICAgICAgICAgICBzd2l0Y2ggKHIyKSB7CiAgICAgICAgICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgICAgICAgY2FzZSAibnVtYmVyIjoKICAgICAgICAgICAgICBjYXNlICJzdHJpbmciOgogICAgICAgICAgICAgICAgbjIgPSBWbC5FbnVtSW52YWxpZE1lbWJlckluaXRpYWxpemVyUHJpbWFyeVR5cGU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJzeW1ib2wiOgogICAgICAgICAgICAgICAgbjIgPSBWbC5FbnVtSW52YWxpZE1lbWJlckluaXRpYWxpemVyU3ltYm9sVHlwZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBuMiA9IFZsLkVudW1JbnZhbGlkTWVtYmVySW5pdGlhbGl6ZXJVbmtub3duVHlwZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5yYWlzZSh0MywgbjIsIHMyLCBpMiwgcjIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd0VudW1FcnJvck51bWJlck1lbWJlck5vdEluaXRpYWxpemVkKHQzLCBlMikgewogICAgICAgICAgICBsZXQgeyBlbnVtTmFtZTogczIsIG1lbWJlck5hbWU6IHIyIH0gPSBlMjsKICAgICAgICAgICAgdGhpcy5yYWlzZSh0MywgVmwuRW51bU51bWJlck1lbWJlck5vdEluaXRpYWxpemVkLCBzMiwgcjIpOwogICAgICAgICAgfQogICAgICAgICAgZmxvd0VudW1FcnJvclN0cmluZ01lbWJlckluY29uc2lzdGVudGx5SW5pdGFpbGl6ZWQodDMsIGUyKSB7CiAgICAgICAgICAgIGxldCB7IGVudW1OYW1lOiBzMiB9ID0gZTI7CiAgICAgICAgICAgIHRoaXMucmFpc2UodDMsIFZsLkVudW1TdHJpbmdNZW1iZXJJbmNvbnNpc3RlbnRseUluaXRhaWxpemVkLCBzMik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93RW51bU1lbWJlckluaXQoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGF0ZS5zdGFydCwgZTIgPSAoKSA9PiB0aGlzLm1hdGNoKDEyKSB8fCB0aGlzLm1hdGNoKDgpOwogICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc3RhdGUudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgMTI0OiB7CiAgICAgICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMucGFyc2VOdW1lcmljTGl0ZXJhbCh0aGlzLnN0YXRlLnZhbHVlKTsKICAgICAgICAgICAgICAgIHJldHVybiBlMigpID8geyB0eXBlOiAibnVtYmVyIiwgcG9zOiBzMi5zdGFydCwgdmFsdWU6IHMyIH0gOiB7IHR5cGU6ICJpbnZhbGlkIiwgcG9zOiB0MyB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlIDEyMzogewogICAgICAgICAgICAgICAgY29uc3QgczIgPSB0aGlzLnBhcnNlU3RyaW5nTGl0ZXJhbCh0aGlzLnN0YXRlLnZhbHVlKTsKICAgICAgICAgICAgICAgIHJldHVybiBlMigpID8geyB0eXBlOiAic3RyaW5nIiwgcG9zOiBzMi5zdGFydCwgdmFsdWU6IHMyIH0gOiB7IHR5cGU6ICJpbnZhbGlkIiwgcG9zOiB0MyB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlIDc5OgogICAgICAgICAgICAgIGNhc2UgODA6IHsKICAgICAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5wYXJzZUJvb2xlYW5MaXRlcmFsKHRoaXMubWF0Y2goNzkpKTsKICAgICAgICAgICAgICAgIHJldHVybiBlMigpID8geyB0eXBlOiAiYm9vbGVhbiIsIHBvczogczIuc3RhcnQsIHZhbHVlOiBzMiB9IDogeyB0eXBlOiAiaW52YWxpZCIsIHBvczogdDMgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiB7IHR5cGU6ICJpbnZhbGlkIiwgcG9zOiB0MyB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmbG93RW51bU1lbWJlclJhdygpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXRlLnN0YXJ0OwogICAgICAgICAgICByZXR1cm4geyBpZDogdGhpcy5wYXJzZUlkZW50aWZpZXIodHJ1ZSksIGluaXQ6IHRoaXMuZWF0KDI3KSA/IHRoaXMuZmxvd0VudW1NZW1iZXJJbml0KCkgOiB7IHR5cGU6ICJub25lIiwgcG9zOiB0MyB9IH07CiAgICAgICAgICB9CiAgICAgICAgICBmbG93RW51bUNoZWNrRXhwbGljaXRUeXBlTWlzbWF0Y2godDMsIGUyLCBzMikgewogICAgICAgICAgICBjb25zdCB7IGV4cGxpY2l0VHlwZTogcjIgfSA9IGUyOwogICAgICAgICAgICByMiAhPT0gbnVsbCAmJiByMiAhPT0gczIgJiYgdGhpcy5mbG93RW51bUVycm9ySW52YWxpZE1lbWJlckluaXRpYWxpemVyKHQzLCBlMik7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93RW51bU1lbWJlcnModDMpIHsKICAgICAgICAgICAgbGV0IHsgZW51bU5hbWU6IGUyLCBleHBsaWNpdFR5cGU6IHMyIH0gPSB0MzsKICAgICAgICAgICAgY29uc3QgcjIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCBpMiA9IHsgYm9vbGVhbk1lbWJlcnM6IFtdLCBudW1iZXJNZW1iZXJzOiBbXSwgc3RyaW5nTWVtYmVyczogW10sIGRlZmF1bHRlZE1lbWJlcnM6IFtdIH07CiAgICAgICAgICAgIGxldCBuMiA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKDsgIXRoaXMubWF0Y2goOCk7ICkgewogICAgICAgICAgICAgIGlmICh0aGlzLmVhdCgyMSkpIHsKICAgICAgICAgICAgICAgIG4yID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCB0NCA9IHRoaXMuc3RhcnROb2RlKCksIHsgaWQ6IGEyLCBpbml0OiBvMiB9ID0gdGhpcy5mbG93RW51bU1lbWJlclJhdygpLCB1MiA9IGEyLm5hbWU7CiAgICAgICAgICAgICAgaWYgKHUyID09PSAiIikKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIC9eW2Etel0vLnRlc3QodTIpICYmIHRoaXMuZmxvd0VudW1FcnJvckludmFsaWRNZW1iZXJOYW1lKGEyLnN0YXJ0LCB7IGVudW1OYW1lOiBlMiwgbWVtYmVyTmFtZTogdTIgfSksIHIyLmhhcyh1MikgJiYgdGhpcy5mbG93RW51bUVycm9yRHVwbGljYXRlTWVtYmVyTmFtZShhMi5zdGFydCwgeyBlbnVtTmFtZTogZTIsIG1lbWJlck5hbWU6IHUyIH0pLCByMi5hZGQodTIpOwogICAgICAgICAgICAgIGNvbnN0IGgyID0geyBlbnVtTmFtZTogZTIsIGV4cGxpY2l0VHlwZTogczIsIG1lbWJlck5hbWU6IHUyIH07CiAgICAgICAgICAgICAgc3dpdGNoICh0NC5pZCA9IGEyLCBvMi50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJib29sZWFuIjoKICAgICAgICAgICAgICAgICAgdGhpcy5mbG93RW51bUNoZWNrRXhwbGljaXRUeXBlTWlzbWF0Y2gobzIucG9zLCBoMiwgImJvb2xlYW4iKSwgdDQuaW5pdCA9IG8yLnZhbHVlLCBpMi5ib29sZWFuTWVtYmVycy5wdXNoKHRoaXMuZmluaXNoTm9kZSh0NCwgIkVudW1Cb29sZWFuTWVtYmVyIikpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICAgICAgICAgIHRoaXMuZmxvd0VudW1DaGVja0V4cGxpY2l0VHlwZU1pc21hdGNoKG8yLnBvcywgaDIsICJudW1iZXIiKSwgdDQuaW5pdCA9IG8yLnZhbHVlLCBpMi5udW1iZXJNZW1iZXJzLnB1c2godGhpcy5maW5pc2hOb2RlKHQ0LCAiRW51bU51bWJlck1lbWJlciIpKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJzdHJpbmciOgogICAgICAgICAgICAgICAgICB0aGlzLmZsb3dFbnVtQ2hlY2tFeHBsaWNpdFR5cGVNaXNtYXRjaChvMi5wb3MsIGgyLCAic3RyaW5nIiksIHQ0LmluaXQgPSBvMi52YWx1ZSwgaTIuc3RyaW5nTWVtYmVycy5wdXNoKHRoaXMuZmluaXNoTm9kZSh0NCwgIkVudW1TdHJpbmdNZW1iZXIiKSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiaW52YWxpZCI6CiAgICAgICAgICAgICAgICAgIHRocm93IHRoaXMuZmxvd0VudW1FcnJvckludmFsaWRNZW1iZXJJbml0aWFsaXplcihvMi5wb3MsIGgyKTsKICAgICAgICAgICAgICAgIGNhc2UgIm5vbmUiOgogICAgICAgICAgICAgICAgICBzd2l0Y2ggKHMyKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZsb3dFbnVtRXJyb3JCb29sZWFuTWVtYmVyTm90SW5pdGlhbGl6ZWQobzIucG9zLCBoMik7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJudW1iZXIiOgogICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG93RW51bUVycm9yTnVtYmVyTWVtYmVyTm90SW5pdGlhbGl6ZWQobzIucG9zLCBoMik7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgaTIuZGVmYXVsdGVkTWVtYmVycy5wdXNoKHRoaXMuZmluaXNoTm9kZSh0NCwgIkVudW1EZWZhdWx0ZWRNZW1iZXIiKSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5tYXRjaCg4KSB8fCB0aGlzLmV4cGVjdCgxMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHsgbWVtYmVyczogaTIsIGhhc1Vua25vd25NZW1iZXJzOiBuMiB9OwogICAgICAgICAgfQogICAgICAgICAgZmxvd0VudW1TdHJpbmdNZW1iZXJzKHQzLCBlMiwgczIpIHsKICAgICAgICAgICAgbGV0IHsgZW51bU5hbWU6IHIyIH0gPSBzMjsKICAgICAgICAgICAgaWYgKHQzLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICAgIGlmIChlMi5sZW5ndGggPT09IDApCiAgICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgICBpZiAoZTIubGVuZ3RoID4gdDMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgZm9yIChjb25zdCBlMyBvZiB0MykKICAgICAgICAgICAgICAgIHRoaXMuZmxvd0VudW1FcnJvclN0cmluZ01lbWJlckluY29uc2lzdGVudGx5SW5pdGFpbGl6ZWQoZTMuc3RhcnQsIHsgZW51bU5hbWU6IHIyIH0pOwogICAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IHQ0IG9mIGUyKQogICAgICAgICAgICAgIHRoaXMuZmxvd0VudW1FcnJvclN0cmluZ01lbWJlckluY29uc2lzdGVudGx5SW5pdGFpbGl6ZWQodDQuc3RhcnQsIHsgZW51bU5hbWU6IHIyIH0pOwogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9CiAgICAgICAgICBmbG93RW51bVBhcnNlRXhwbGljaXRUeXBlKHQzKSB7CiAgICAgICAgICAgIGxldCB7IGVudW1OYW1lOiBlMiB9ID0gdDM7CiAgICAgICAgICAgIGlmICh0aGlzLmVhdENvbnRleHR1YWwoOTUpKSB7CiAgICAgICAgICAgICAgaWYgKCFVYyh0aGlzLnN0YXRlLnR5cGUpKQogICAgICAgICAgICAgICAgdGhyb3cgdGhpcy5mbG93RW51bUVycm9ySW52YWxpZEV4cGxpY2l0VHlwZSh0aGlzLnN0YXRlLnN0YXJ0LCB7IGVudW1OYW1lOiBlMiwgc3VwcGxpZWRUeXBlOiBudWxsIH0pOwogICAgICAgICAgICAgIGNvbnN0IHsgdmFsdWU6IHQ0IH0gPSB0aGlzLnN0YXRlOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdDQgIT09ICJib29sZWFuIiAmJiB0NCAhPT0gIm51bWJlciIgJiYgdDQgIT09ICJzdHJpbmciICYmIHQ0ICE9PSAic3ltYm9sIiAmJiB0aGlzLmZsb3dFbnVtRXJyb3JJbnZhbGlkRXhwbGljaXRUeXBlKHRoaXMuc3RhdGUuc3RhcnQsIHsgZW51bU5hbWU6IGUyLCBzdXBwbGllZFR5cGU6IHQ0IH0pLCB0NDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGZsb3dFbnVtQm9keSh0MywgZTIpIHsKICAgICAgICAgICAgbGV0IHsgZW51bU5hbWU6IHMyLCBuYW1lTG9jOiByMiB9ID0gZTI7CiAgICAgICAgICAgIGNvbnN0IGkyID0gdGhpcy5mbG93RW51bVBhcnNlRXhwbGljaXRUeXBlKHsgZW51bU5hbWU6IHMyIH0pOwogICAgICAgICAgICB0aGlzLmV4cGVjdCg1KTsKICAgICAgICAgICAgY29uc3QgeyBtZW1iZXJzOiBuMiwgaGFzVW5rbm93bk1lbWJlcnM6IGEyIH0gPSB0aGlzLmZsb3dFbnVtTWVtYmVycyh7IGVudW1OYW1lOiBzMiwgZXhwbGljaXRUeXBlOiBpMiB9KTsKICAgICAgICAgICAgc3dpdGNoICh0My5oYXNVbmtub3duTWVtYmVycyA9IGEyLCBpMikgewogICAgICAgICAgICAgIGNhc2UgImJvb2xlYW4iOgogICAgICAgICAgICAgICAgcmV0dXJuIHQzLmV4cGxpY2l0VHlwZSA9IHRydWUsIHQzLm1lbWJlcnMgPSBuMi5ib29sZWFuTWVtYmVycywgdGhpcy5leHBlY3QoOCksIHRoaXMuZmluaXNoTm9kZSh0MywgIkVudW1Cb29sZWFuQm9keSIpOwogICAgICAgICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICAgICAgICByZXR1cm4gdDMuZXhwbGljaXRUeXBlID0gdHJ1ZSwgdDMubWVtYmVycyA9IG4yLm51bWJlck1lbWJlcnMsIHRoaXMuZXhwZWN0KDgpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJFbnVtTnVtYmVyQm9keSIpOwogICAgICAgICAgICAgIGNhc2UgInN0cmluZyI6CiAgICAgICAgICAgICAgICByZXR1cm4gdDMuZXhwbGljaXRUeXBlID0gdHJ1ZSwgdDMubWVtYmVycyA9IHRoaXMuZmxvd0VudW1TdHJpbmdNZW1iZXJzKG4yLnN0cmluZ01lbWJlcnMsIG4yLmRlZmF1bHRlZE1lbWJlcnMsIHsgZW51bU5hbWU6IHMyIH0pLCB0aGlzLmV4cGVjdCg4KSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiRW51bVN0cmluZ0JvZHkiKTsKICAgICAgICAgICAgICBjYXNlICJzeW1ib2wiOgogICAgICAgICAgICAgICAgcmV0dXJuIHQzLm1lbWJlcnMgPSBuMi5kZWZhdWx0ZWRNZW1iZXJzLCB0aGlzLmV4cGVjdCg4KSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiRW51bVN5bWJvbEJvZHkiKTsKICAgICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICBjb25zdCBlMyA9ICgpID0+ICh0My5tZW1iZXJzID0gW10sIHRoaXMuZXhwZWN0KDgpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJFbnVtU3RyaW5nQm9keSIpKTsKICAgICAgICAgICAgICAgIHQzLmV4cGxpY2l0VHlwZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgY29uc3QgaTMgPSBuMi5ib29sZWFuTWVtYmVycy5sZW5ndGgsIGEzID0gbjIubnVtYmVyTWVtYmVycy5sZW5ndGgsIG8yID0gbjIuc3RyaW5nTWVtYmVycy5sZW5ndGgsIHUyID0gbjIuZGVmYXVsdGVkTWVtYmVycy5sZW5ndGg7CiAgICAgICAgICAgICAgICBpZiAoaTMgfHwgYTMgfHwgbzIgfHwgdTIpIHsKICAgICAgICAgICAgICAgICAgaWYgKGkzIHx8IGEzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFhMyAmJiAhbzIgJiYgaTMgPj0gdTIpIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdDQgb2YgbjIuZGVmYXVsdGVkTWVtYmVycykKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG93RW51bUVycm9yQm9vbGVhbk1lbWJlck5vdEluaXRpYWxpemVkKHQ0LnN0YXJ0LCB7IGVudW1OYW1lOiBzMiwgbWVtYmVyTmFtZTogdDQuaWQubmFtZSB9KTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0My5tZW1iZXJzID0gbjIuYm9vbGVhbk1lbWJlcnMsIHRoaXMuZXhwZWN0KDgpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJFbnVtQm9vbGVhbkJvZHkiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpMyAmJiAhbzIgJiYgYTMgPj0gdTIpIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdDQgb2YgbjIuZGVmYXVsdGVkTWVtYmVycykKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mbG93RW51bUVycm9yTnVtYmVyTWVtYmVyTm90SW5pdGlhbGl6ZWQodDQuc3RhcnQsIHsgZW51bU5hbWU6IHMyLCBtZW1iZXJOYW1lOiB0NC5pZC5uYW1lIH0pOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQzLm1lbWJlcnMgPSBuMi5udW1iZXJNZW1iZXJzLCB0aGlzLmV4cGVjdCg4KSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiRW51bU51bWJlckJvZHkiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmxvd0VudW1FcnJvckluY29uc2lzdGVudE1lbWJlclZhbHVlcyhyMiwgeyBlbnVtTmFtZTogczIgfSksIGUzKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIHQzLm1lbWJlcnMgPSB0aGlzLmZsb3dFbnVtU3RyaW5nTWVtYmVycyhuMi5zdHJpbmdNZW1iZXJzLCBuMi5kZWZhdWx0ZWRNZW1iZXJzLCB7IGVudW1OYW1lOiBzMiB9KSwgdGhpcy5leHBlY3QoOCksIHRoaXMuZmluaXNoTm9kZSh0MywgIkVudW1TdHJpbmdCb2R5Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZTMoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZsb3dQYXJzZUVudW1EZWNsYXJhdGlvbih0MykgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMucGFyc2VJZGVudGlmaWVyKCk7CiAgICAgICAgICAgIHJldHVybiB0My5pZCA9IGUyLCB0My5ib2R5ID0gdGhpcy5mbG93RW51bUJvZHkodGhpcy5zdGFydE5vZGUoKSwgeyBlbnVtTmFtZTogZTIubmFtZSwgbmFtZUxvYzogZTIuc3RhcnQgfSksIHRoaXMuZmluaXNoTm9kZSh0MywgIkVudW1EZWNsYXJhdGlvbiIpOwogICAgICAgICAgfQogICAgICAgICAgaXNMb29rYWhlYWRUb2tlbl9sdCgpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLm5leHRUb2tlblN0YXJ0KCk7CiAgICAgICAgICAgIGlmICh0aGlzLmlucHV0LmNoYXJDb2RlQXQodDMpID09PSA2MCkgewogICAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHQzICsgMSk7CiAgICAgICAgICAgICAgcmV0dXJuIGUyICE9PSA2MCAmJiBlMiAhPT0gNjE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgbWF5YmVVbndyYXBUeXBlQ2FzdEV4cHJlc3Npb24odDMpIHsKICAgICAgICAgICAgcmV0dXJuIHQzLnR5cGUgPT09ICJUeXBlQ2FzdEV4cHJlc3Npb24iID8gdDMuZXhwcmVzc2lvbiA6IHQzOwogICAgICAgICAgfQogICAgICAgIH0sIHR5cGVzY3JpcHQ6ICh0MikgPT4gY2xhc3MgZXh0ZW5kcyB0MiB7CiAgICAgICAgICBnZXRTY29wZUhhbmRsZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBlZDsKICAgICAgICAgIH0KICAgICAgICAgIHRzSXNJZGVudGlmaWVyKCkgewogICAgICAgICAgICByZXR1cm4gVWModGhpcy5zdGF0ZS50eXBlKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzVG9rZW5DYW5Gb2xsb3dNb2RpZmllcigpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLm1hdGNoKDApIHx8IHRoaXMubWF0Y2goNSkgfHwgdGhpcy5tYXRjaCg0OSkgfHwgdGhpcy5tYXRjaCgyMSkgfHwgdGhpcy5tYXRjaCgxMjgpIHx8IHRoaXMuaXNMaXRlcmFsUHJvcGVydHlOYW1lKCkpICYmICF0aGlzLmhhc1ByZWNlZGluZ0xpbmVCcmVhaygpOwogICAgICAgICAgfQogICAgICAgICAgdHNOZXh0VG9rZW5DYW5Gb2xsb3dNb2RpZmllcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0aGlzLnRzVG9rZW5DYW5Gb2xsb3dNb2RpZmllcigpOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZU1vZGlmaWVyKHQzLCBlMikgewogICAgICAgICAgICBpZiAoIVVjKHRoaXMuc3RhdGUudHlwZSkpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhdGUudmFsdWU7CiAgICAgICAgICAgIGlmICh0My5pbmRleE9mKHMyKSAhPT0gLTEpIHsKICAgICAgICAgICAgICBpZiAoZTIgJiYgdGhpcy50c0lzU3RhcnRPZlN0YXRpY0Jsb2NrcygpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIGlmICh0aGlzLnRzVHJ5UGFyc2UodGhpcy50c05leHRUb2tlbkNhbkZvbGxvd01vZGlmaWVyLmJpbmQodGhpcykpKQogICAgICAgICAgICAgICAgcmV0dXJuIHMyOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlTW9kaWZpZXJzKHQzLCBlMiwgczIsIHIyLCBpMikgewogICAgICAgICAgICBjb25zdCBuMiA9IChlMywgczMsIHIzLCBpMykgPT4gewogICAgICAgICAgICAgIHMzID09PSByMyAmJiB0M1tpM10gJiYgdGhpcy5yYWlzZShlMywgcmQuSW52YWxpZE1vZGlmaWVyc09yZGVyLCByMywgaTMpOwogICAgICAgICAgICB9LCBhMiA9IChlMywgczMsIHIzLCBpMykgPT4gewogICAgICAgICAgICAgICh0M1tyM10gJiYgczMgPT09IGkzIHx8IHQzW2kzXSAmJiBzMyA9PT0gcjMpICYmIHRoaXMucmFpc2UoZTMsIHJkLkluY29tcGF0aWJsZU1vZGlmaWVycywgcjMsIGkzKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgICAgICAgY29uc3QgbzIgPSB0aGlzLnN0YXRlLnN0YXJ0LCB1MiA9IHRoaXMudHNQYXJzZU1vZGlmaWVyKGUyLmNvbmNhdChzMiAhPSBudWxsID8gczIgOiBbXSksIGkyKTsKICAgICAgICAgICAgICBpZiAoIXUyKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgaWQodTIpID8gdDMuYWNjZXNzaWJpbGl0eSA/IHRoaXMucmFpc2UobzIsIHJkLkR1cGxpY2F0ZUFjY2Vzc2liaWxpdHlNb2RpZmllcikgOiAobjIobzIsIHUyLCB1MiwgIm92ZXJyaWRlIiksIG4yKG8yLCB1MiwgdTIsICJzdGF0aWMiKSwgbjIobzIsIHUyLCB1MiwgInJlYWRvbmx5IiksIHQzLmFjY2Vzc2liaWxpdHkgPSB1MikgOiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodDMsIHUyKSA/IHRoaXMucmFpc2UobzIsIHJkLkR1cGxpY2F0ZU1vZGlmaWVyLCB1MikgOiAobjIobzIsIHUyLCAic3RhdGljIiwgInJlYWRvbmx5IiksIG4yKG8yLCB1MiwgInN0YXRpYyIsICJvdmVycmlkZSIpLCBuMihvMiwgdTIsICJvdmVycmlkZSIsICJyZWFkb25seSIpLCBuMihvMiwgdTIsICJhYnN0cmFjdCIsICJvdmVycmlkZSIpLCBhMihvMiwgdTIsICJkZWNsYXJlIiwgIm92ZXJyaWRlIiksIGEyKG8yLCB1MiwgInN0YXRpYyIsICJhYnN0cmFjdCIpKSwgdDNbdTJdID0gdHJ1ZSksIHMyICE9IG51bGwgJiYgczIuaW5jbHVkZXModTIpICYmIHRoaXMucmFpc2UobzIsIHIyLCB1Mik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHRzSXNMaXN0VGVybWluYXRvcih0MykgewogICAgICAgICAgICBzd2l0Y2ggKHQzKSB7CiAgICAgICAgICAgICAgY2FzZSAiRW51bU1lbWJlcnMiOgogICAgICAgICAgICAgIGNhc2UgIlR5cGVNZW1iZXJzIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDgpOwogICAgICAgICAgICAgIGNhc2UgIkhlcml0YWdlQ2xhdXNlRWxlbWVudCI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaCg1KTsKICAgICAgICAgICAgICBjYXNlICJUdXBsZUVsZW1lbnRUeXBlcyI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaCgzKTsKICAgICAgICAgICAgICBjYXNlICJUeXBlUGFyYW1ldGVyc09yQXJndW1lbnRzIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDQ0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVucmVhY2hhYmxlIik7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlTGlzdCh0MywgZTIpIHsKICAgICAgICAgICAgY29uc3QgczIgPSBbXTsKICAgICAgICAgICAgZm9yICg7ICF0aGlzLnRzSXNMaXN0VGVybWluYXRvcih0Myk7ICkKICAgICAgICAgICAgICBzMi5wdXNoKGUyKCkpOwogICAgICAgICAgICByZXR1cm4gczI7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlRGVsaW1pdGVkTGlzdCh0MywgZTIsIHMyKSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0NCkgewogICAgICAgICAgICAgIGlmICh0NCA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkICIuY29uY2F0KHQ0LCAiIHZhbHVlLiIpKTsKICAgICAgICAgICAgICByZXR1cm4gdDQ7CiAgICAgICAgICAgIH0odGhpcy50c1BhcnNlRGVsaW1pdGVkTGlzdFdvcmtlcih0MywgZTIsIHRydWUsIHMyKSk7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlRGVsaW1pdGVkTGlzdFdvcmtlcih0MywgZTIsIHMyLCByMikgewogICAgICAgICAgICBjb25zdCBpMiA9IFtdOwogICAgICAgICAgICBsZXQgbjIgPSAtMTsKICAgICAgICAgICAgZm9yICg7ICF0aGlzLnRzSXNMaXN0VGVybWluYXRvcih0Myk7ICkgewogICAgICAgICAgICAgIG4yID0gLTE7CiAgICAgICAgICAgICAgY29uc3QgcjMgPSBlMigpOwogICAgICAgICAgICAgIGlmIChyMyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIGlmIChpMi5wdXNoKHIzKSwgIXRoaXMuZWF0KDEyKSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMudHNJc0xpc3RUZXJtaW5hdG9yKHQzKSkKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAoczIgJiYgdGhpcy5leHBlY3QoMTIpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbjIgPSB0aGlzLnN0YXRlLmxhc3RUb2tTdGFydDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcjIgJiYgKHIyLnZhbHVlID0gbjIpLCBpMjsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VCcmFja2V0ZWRMaXN0KHQzLCBlMiwgczIsIHIyLCBpMikgewogICAgICAgICAgICByMiB8fCAoczIgPyB0aGlzLmV4cGVjdCgwKSA6IHRoaXMuZXhwZWN0KDQzKSk7CiAgICAgICAgICAgIGNvbnN0IG4yID0gdGhpcy50c1BhcnNlRGVsaW1pdGVkTGlzdCh0MywgZTIsIGkyKTsKICAgICAgICAgICAgcmV0dXJuIHMyID8gdGhpcy5leHBlY3QoMykgOiB0aGlzLmV4cGVjdCg0NCksIG4yOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZUltcG9ydFR5cGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwZWN0KDc3KSwgdGhpcy5leHBlY3QoMTApLCB0aGlzLm1hdGNoKDEyMykgfHwgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0LCByZC5VbnN1cHBvcnRlZEltcG9ydFR5cGVBcmd1bWVudCksIHQzLmFyZ3VtZW50ID0gdGhpcy5wYXJzZUV4cHJBdG9tKCksIHRoaXMuZXhwZWN0KDExKSwgdGhpcy5lYXQoMTYpICYmICh0My5xdWFsaWZpZXIgPSB0aGlzLnRzUGFyc2VFbnRpdHlOYW1lKHRydWUpKSwgdGhpcy5tYXRjaCg0MykgJiYgKHQzLnR5cGVQYXJhbWV0ZXJzID0gdGhpcy50c1BhcnNlVHlwZUFyZ3VtZW50cygpKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiVFNJbXBvcnRUeXBlIik7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlRW50aXR5TmFtZSh0MykgewogICAgICAgICAgICBsZXQgZTIgPSB0aGlzLnBhcnNlSWRlbnRpZmllcigpOwogICAgICAgICAgICBmb3IgKDsgdGhpcy5lYXQoMTYpOyApIHsKICAgICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhcnROb2RlQXROb2RlKGUyKTsKICAgICAgICAgICAgICBzMi5sZWZ0ID0gZTIsIHMyLnJpZ2h0ID0gdGhpcy5wYXJzZUlkZW50aWZpZXIodDMpLCBlMiA9IHRoaXMuZmluaXNoTm9kZShzMiwgIlRTUXVhbGlmaWVkTmFtZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUeXBlUmVmZXJlbmNlKCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0My50eXBlTmFtZSA9IHRoaXMudHNQYXJzZUVudGl0eU5hbWUoZmFsc2UpLCAhdGhpcy5oYXNQcmVjZWRpbmdMaW5lQnJlYWsoKSAmJiB0aGlzLm1hdGNoKDQzKSAmJiAodDMudHlwZVBhcmFtZXRlcnMgPSB0aGlzLnRzUGFyc2VUeXBlQXJndW1lbnRzKCkpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJUU1R5cGVSZWZlcmVuY2UiKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUaGlzVHlwZVByZWRpY2F0ZSh0MykgewogICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXJ0Tm9kZUF0Tm9kZSh0Myk7CiAgICAgICAgICAgIHJldHVybiBlMi5wYXJhbWV0ZXJOYW1lID0gdDMsIGUyLnR5cGVBbm5vdGF0aW9uID0gdGhpcy50c1BhcnNlVHlwZUFubm90YXRpb24oZmFsc2UpLCBlMi5hc3NlcnRzID0gZmFsc2UsIHRoaXMuZmluaXNoTm9kZShlMiwgIlRTVHlwZVByZWRpY2F0ZSIpOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZVRoaXNUeXBlTm9kZSgpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMuZmluaXNoTm9kZSh0MywgIlRTVGhpc1R5cGUiKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUeXBlUXVlcnkoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwZWN0KDgxKSwgdGhpcy5tYXRjaCg3NykgPyB0My5leHByTmFtZSA9IHRoaXMudHNQYXJzZUltcG9ydFR5cGUoKSA6IHQzLmV4cHJOYW1lID0gdGhpcy50c1BhcnNlRW50aXR5TmFtZSh0cnVlKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiVFNUeXBlUXVlcnkiKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUeXBlUGFyYW1ldGVyKCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0My5uYW1lID0gdGhpcy50c1BhcnNlVHlwZVBhcmFtZXRlck5hbWUoKSwgdDMuY29uc3RyYWludCA9IHRoaXMudHNFYXRUaGVuUGFyc2VUeXBlKDc1KSwgdDMuZGVmYXVsdCA9IHRoaXMudHNFYXRUaGVuUGFyc2VUeXBlKDI3KSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiVFNUeXBlUGFyYW1ldGVyIik7CiAgICAgICAgICB9CiAgICAgICAgICB0c1RyeVBhcnNlVHlwZVBhcmFtZXRlcnMoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDQzKSkKICAgICAgICAgICAgICByZXR1cm4gdGhpcy50c1BhcnNlVHlwZVBhcmFtZXRlcnMoKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUeXBlUGFyYW1ldGVycygpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICB0aGlzLm1hdGNoKDQzKSB8fCB0aGlzLm1hdGNoKDEzMikgPyB0aGlzLm5leHQoKSA6IHRoaXMudW5leHBlY3RlZCgpOwogICAgICAgICAgICBjb25zdCBlMiA9IHsgdmFsdWU6IC0xIH07CiAgICAgICAgICAgIHJldHVybiB0My5wYXJhbXMgPSB0aGlzLnRzUGFyc2VCcmFja2V0ZWRMaXN0KCJUeXBlUGFyYW1ldGVyc09yQXJndW1lbnRzIiwgdGhpcy50c1BhcnNlVHlwZVBhcmFtZXRlci5iaW5kKHRoaXMpLCBmYWxzZSwgdHJ1ZSwgZTIpLCB0My5wYXJhbXMubGVuZ3RoID09PSAwICYmIHRoaXMucmFpc2UodDMuc3RhcnQsIHJkLkVtcHR5VHlwZVBhcmFtZXRlcnMpLCBlMi52YWx1ZSAhPT0gLTEgJiYgdGhpcy5hZGRFeHRyYSh0MywgInRyYWlsaW5nQ29tbWEiLCBlMi52YWx1ZSksIHRoaXMuZmluaXNoTm9kZSh0MywgIlRTVHlwZVBhcmFtZXRlckRlY2xhcmF0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICB0c1RyeU5leHRQYXJzZUNvbnN0YW50Q29udGV4dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9va2FoZWFkKCkudHlwZSA9PT0gNjkgPyAodGhpcy5uZXh0KCksIHRoaXMudHNQYXJzZVR5cGVSZWZlcmVuY2UoKSkgOiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgdHNGaWxsU2lnbmF0dXJlKHQzLCBlMikgewogICAgICAgICAgICBjb25zdCBzMiA9IHQzID09PSAxOTsKICAgICAgICAgICAgZTIudHlwZVBhcmFtZXRlcnMgPSB0aGlzLnRzVHJ5UGFyc2VUeXBlUGFyYW1ldGVycygpLCB0aGlzLmV4cGVjdCgxMCksIGUyLnBhcmFtZXRlcnMgPSB0aGlzLnRzUGFyc2VCaW5kaW5nTGlzdEZvclNpZ25hdHVyZSgpLCAoczIgfHwgdGhpcy5tYXRjaCh0MykpICYmIChlMi50eXBlQW5ub3RhdGlvbiA9IHRoaXMudHNQYXJzZVR5cGVPclR5cGVQcmVkaWNhdGVBbm5vdGF0aW9uKHQzKSk7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlQmluZGluZ0xpc3RGb3JTaWduYXR1cmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlQmluZGluZ0xpc3QoMTEsIDQxKS5tYXAoKHQzKSA9PiAodDMudHlwZSAhPT0gIklkZW50aWZpZXIiICYmIHQzLnR5cGUgIT09ICJSZXN0RWxlbWVudCIgJiYgdDMudHlwZSAhPT0gIk9iamVjdFBhdHRlcm4iICYmIHQzLnR5cGUgIT09ICJBcnJheVBhdHRlcm4iICYmIHRoaXMucmFpc2UodDMuc3RhcnQsIHJkLlVuc3VwcG9ydGVkU2lnbmF0dXJlUGFyYW1ldGVyS2luZCwgdDMudHlwZSksIHQzKSk7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlVHlwZU1lbWJlclNlbWljb2xvbigpIHsKICAgICAgICAgICAgdGhpcy5lYXQoMTIpIHx8IHRoaXMuaXNMaW5lVGVybWluYXRvcigpIHx8IHRoaXMuZXhwZWN0KDEzKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VTaWduYXR1cmVNZW1iZXIodDMsIGUyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRzRmlsbFNpZ25hdHVyZSgxNCwgZTIpLCB0aGlzLnRzUGFyc2VUeXBlTWVtYmVyU2VtaWNvbG9uKCksIHRoaXMuZmluaXNoTm9kZShlMiwgdDMpOwogICAgICAgICAgfQogICAgICAgICAgdHNJc1VuYW1iaWd1b3VzbHlJbmRleFNpZ25hdHVyZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCAhIVVjKHRoaXMuc3RhdGUudHlwZSkgJiYgKHRoaXMubmV4dCgpLCB0aGlzLm1hdGNoKDE0KSk7CiAgICAgICAgICB9CiAgICAgICAgICB0c1RyeVBhcnNlSW5kZXhTaWduYXR1cmUodDMpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm1hdGNoKDApIHx8ICF0aGlzLnRzTG9va0FoZWFkKHRoaXMudHNJc1VuYW1iaWd1b3VzbHlJbmRleFNpZ25hdHVyZS5iaW5kKHRoaXMpKSkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIHRoaXMuZXhwZWN0KDApOwogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMucGFyc2VJZGVudGlmaWVyKCk7CiAgICAgICAgICAgIGUyLnR5cGVBbm5vdGF0aW9uID0gdGhpcy50c1BhcnNlVHlwZUFubm90YXRpb24oKSwgdGhpcy5yZXNldEVuZExvY2F0aW9uKGUyKSwgdGhpcy5leHBlY3QoMyksIHQzLnBhcmFtZXRlcnMgPSBbZTJdOwogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMudHNUcnlQYXJzZVR5cGVBbm5vdGF0aW9uKCk7CiAgICAgICAgICAgIHJldHVybiBzMiAmJiAodDMudHlwZUFubm90YXRpb24gPSBzMiksIHRoaXMudHNQYXJzZVR5cGVNZW1iZXJTZW1pY29sb24oKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiVFNJbmRleFNpZ25hdHVyZSIpOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZVByb3BlcnR5T3JNZXRob2RTaWduYXR1cmUodDMsIGUyKSB7CiAgICAgICAgICAgIHRoaXMuZWF0KDE3KSAmJiAodDMub3B0aW9uYWwgPSB0cnVlKTsKICAgICAgICAgICAgY29uc3QgczIgPSB0MzsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goMTApIHx8IHRoaXMubWF0Y2goNDMpKSB7CiAgICAgICAgICAgICAgZTIgJiYgdGhpcy5yYWlzZSh0My5zdGFydCwgcmQuUmVhZG9ubHlGb3JNZXRob2RTaWduYXR1cmUpOwogICAgICAgICAgICAgIGNvbnN0IHIyID0gczI7CiAgICAgICAgICAgICAgaWYgKHIyLmtpbmQgJiYgdGhpcy5tYXRjaCg0MykgJiYgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnBvcywgcmQuQWNjZXNvckNhbm5vdEhhdmVUeXBlUGFyYW1ldGVycyksIHRoaXMudHNGaWxsU2lnbmF0dXJlKDE0LCByMiksIHRoaXMudHNQYXJzZVR5cGVNZW1iZXJTZW1pY29sb24oKSwgcjIua2luZCA9PT0gImdldCIpCiAgICAgICAgICAgICAgICByMi5wYXJhbWV0ZXJzLmxlbmd0aCA+IDAgJiYgKHRoaXMucmFpc2UodGhpcy5zdGF0ZS5wb3MsIERjLkJhZEdldHRlckFyaXR5KSwgdGhpcy5pc1RoaXNQYXJhbShyMi5wYXJhbWV0ZXJzWzBdKSAmJiB0aGlzLnJhaXNlKHRoaXMuc3RhdGUucG9zLCByZC5BY2Nlc29yQ2Fubm90RGVjbGFyZVRoaXNQYXJhbWV0ZXIpKTsKICAgICAgICAgICAgICBlbHNlIGlmIChyMi5raW5kID09PSAic2V0IikgewogICAgICAgICAgICAgICAgaWYgKHIyLnBhcmFtZXRlcnMubGVuZ3RoICE9PSAxKQogICAgICAgICAgICAgICAgICB0aGlzLnJhaXNlKHRoaXMuc3RhdGUucG9zLCBEYy5CYWRTZXR0ZXJBcml0eSk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdDQgPSByMi5wYXJhbWV0ZXJzWzBdOwogICAgICAgICAgICAgICAgICB0aGlzLmlzVGhpc1BhcmFtKHQ0KSAmJiB0aGlzLnJhaXNlKHRoaXMuc3RhdGUucG9zLCByZC5BY2Nlc29yQ2Fubm90RGVjbGFyZVRoaXNQYXJhbWV0ZXIpLCB0NC50eXBlID09PSAiSWRlbnRpZmllciIgJiYgdDQub3B0aW9uYWwgJiYgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnBvcywgcmQuU2V0QWNjZXNvckNhbm5vdEhhdmVPcHRpb25hbFBhcmFtZXRlciksIHQ0LnR5cGUgPT09ICJSZXN0RWxlbWVudCIgJiYgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnBvcywgcmQuU2V0QWNjZXNvckNhbm5vdEhhdmVSZXN0UGFyYW1ldGVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHIyLnR5cGVBbm5vdGF0aW9uICYmIHRoaXMucmFpc2UocjIudHlwZUFubm90YXRpb24uc3RhcnQsIHJkLlNldEFjY2Vzb3JDYW5ub3RIYXZlUmV0dXJuVHlwZSk7CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICByMi5raW5kID0gIm1ldGhvZCI7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZShyMiwgIlRTTWV0aG9kU2lnbmF0dXJlIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnN0IHQ0ID0gczI7CiAgICAgICAgICAgICAgZTIgJiYgKHQ0LnJlYWRvbmx5ID0gdHJ1ZSk7CiAgICAgICAgICAgICAgY29uc3QgcjIgPSB0aGlzLnRzVHJ5UGFyc2VUeXBlQW5ub3RhdGlvbigpOwogICAgICAgICAgICAgIHJldHVybiByMiAmJiAodDQudHlwZUFubm90YXRpb24gPSByMiksIHRoaXMudHNQYXJzZVR5cGVNZW1iZXJTZW1pY29sb24oKSwgdGhpcy5maW5pc2hOb2RlKHQ0LCAiVFNQcm9wZXJ0eVNpZ25hdHVyZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlVHlwZU1lbWJlcigpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCgxMCkgfHwgdGhpcy5tYXRjaCg0MykpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudHNQYXJzZVNpZ25hdHVyZU1lbWJlcigiVFNDYWxsU2lnbmF0dXJlRGVjbGFyYXRpb24iLCB0Myk7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDcxKSkgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMubWF0Y2goMTApIHx8IHRoaXMubWF0Y2goNDMpID8gdGhpcy50c1BhcnNlU2lnbmF0dXJlTWVtYmVyKCJUU0NvbnN0cnVjdFNpZ25hdHVyZURlY2xhcmF0aW9uIiwgdDMpIDogKHQzLmtleSA9IHRoaXMuY3JlYXRlSWRlbnRpZmllcihlMywgIm5ldyIpLCB0aGlzLnRzUGFyc2VQcm9wZXJ0eU9yTWV0aG9kU2lnbmF0dXJlKHQzLCBmYWxzZSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudHNQYXJzZU1vZGlmaWVycyh0MywgWyJyZWFkb25seSJdLCBbImRlY2xhcmUiLCAiYWJzdHJhY3QiLCAicHJpdmF0ZSIsICJwcm90ZWN0ZWQiLCAicHVibGljIiwgInN0YXRpYyIsICJvdmVycmlkZSJdLCByZC5JbnZhbGlkTW9kaWZpZXJPblR5cGVNZW1iZXIpOwogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMudHNUcnlQYXJzZUluZGV4U2lnbmF0dXJlKHQzKTsKICAgICAgICAgICAgcmV0dXJuIGUyIHx8ICh0aGlzLnBhcnNlUHJvcGVydHlOYW1lKHQzKSwgdDMuY29tcHV0ZWQgfHwgdDMua2V5LnR5cGUgIT09ICJJZGVudGlmaWVyIiB8fCB0My5rZXkubmFtZSAhPT0gImdldCIgJiYgdDMua2V5Lm5hbWUgIT09ICJzZXQiIHx8ICF0aGlzLnRzVG9rZW5DYW5Gb2xsb3dNb2RpZmllcigpIHx8ICh0My5raW5kID0gdDMua2V5Lm5hbWUsIHRoaXMucGFyc2VQcm9wZXJ0eU5hbWUodDMpKSwgdGhpcy50c1BhcnNlUHJvcGVydHlPck1ldGhvZFNpZ25hdHVyZSh0MywgISF0My5yZWFkb25seSkpOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZVR5cGVMaXRlcmFsKCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0My5tZW1iZXJzID0gdGhpcy50c1BhcnNlT2JqZWN0VHlwZU1lbWJlcnMoKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiVFNUeXBlTGl0ZXJhbCIpOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZU9iamVjdFR5cGVNZW1iZXJzKCkgewogICAgICAgICAgICB0aGlzLmV4cGVjdCg1KTsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnRzUGFyc2VMaXN0KCJUeXBlTWVtYmVycyIsIHRoaXMudHNQYXJzZVR5cGVNZW1iZXIuYmluZCh0aGlzKSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4cGVjdCg4KSwgdDM7CiAgICAgICAgICB9CiAgICAgICAgICB0c0lzU3RhcnRPZk1hcHBlZFR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5lYXQoNDcpID8gdGhpcy5pc0NvbnRleHR1YWwoMTEyKSA6ICh0aGlzLmlzQ29udGV4dHVhbCgxMTIpICYmIHRoaXMubmV4dCgpLCAhIXRoaXMubWF0Y2goMCkgJiYgKHRoaXMubmV4dCgpLCAhIXRoaXMudHNJc0lkZW50aWZpZXIoKSAmJiAodGhpcy5uZXh0KCksIHRoaXMubWF0Y2goNTIpKSkpOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZU1hcHBlZFR5cGVQYXJhbWV0ZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHQzLm5hbWUgPSB0aGlzLnRzUGFyc2VUeXBlUGFyYW1ldGVyTmFtZSgpLCB0My5jb25zdHJhaW50ID0gdGhpcy50c0V4cGVjdFRoZW5QYXJzZVR5cGUoNTIpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJUU1R5cGVQYXJhbWV0ZXIiKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VNYXBwZWRUeXBlKCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4cGVjdCg1KSwgdGhpcy5tYXRjaCg0NykgPyAodDMucmVhZG9ubHkgPSB0aGlzLnN0YXRlLnZhbHVlLCB0aGlzLm5leHQoKSwgdGhpcy5leHBlY3RDb250ZXh0dWFsKDExMikpIDogdGhpcy5lYXRDb250ZXh0dWFsKDExMikgJiYgKHQzLnJlYWRvbmx5ID0gdHJ1ZSksIHRoaXMuZXhwZWN0KDApLCB0My50eXBlUGFyYW1ldGVyID0gdGhpcy50c1BhcnNlTWFwcGVkVHlwZVBhcmFtZXRlcigpLCB0My5uYW1lVHlwZSA9IHRoaXMuZWF0Q29udGV4dHVhbCg4NykgPyB0aGlzLnRzUGFyc2VUeXBlKCkgOiBudWxsLCB0aGlzLmV4cGVjdCgzKSwgdGhpcy5tYXRjaCg0NykgPyAodDMub3B0aW9uYWwgPSB0aGlzLnN0YXRlLnZhbHVlLCB0aGlzLm5leHQoKSwgdGhpcy5leHBlY3QoMTcpKSA6IHRoaXMuZWF0KDE3KSAmJiAodDMub3B0aW9uYWwgPSB0cnVlKSwgdDMudHlwZUFubm90YXRpb24gPSB0aGlzLnRzVHJ5UGFyc2VUeXBlKCksIHRoaXMuc2VtaWNvbG9uKCksIHRoaXMuZXhwZWN0KDgpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJUU01hcHBlZFR5cGUiKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUdXBsZVR5cGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgdDMuZWxlbWVudFR5cGVzID0gdGhpcy50c1BhcnNlQnJhY2tldGVkTGlzdCgiVHVwbGVFbGVtZW50VHlwZXMiLCB0aGlzLnRzUGFyc2VUdXBsZUVsZW1lbnRUeXBlLmJpbmQodGhpcyksIHRydWUsIGZhbHNlKTsKICAgICAgICAgICAgbGV0IGUyID0gZmFsc2UsIHMyID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHQzLmVsZW1lbnRUeXBlcy5mb3JFYWNoKCh0NCkgPT4gewogICAgICAgICAgICAgIHZhciByMjsKICAgICAgICAgICAgICBsZXQgeyB0eXBlOiBpMiB9ID0gdDQ7CiAgICAgICAgICAgICAgIWUyIHx8IGkyID09PSAiVFNSZXN0VHlwZSIgfHwgaTIgPT09ICJUU09wdGlvbmFsVHlwZSIgfHwgaTIgPT09ICJUU05hbWVkVHVwbGVNZW1iZXIiICYmIHQ0Lm9wdGlvbmFsIHx8IHRoaXMucmFpc2UodDQuc3RhcnQsIHJkLk9wdGlvbmFsVHlwZUJlZm9yZVJlcXVpcmVkKSwgZTIgPSBlMiB8fCBpMiA9PT0gIlRTTmFtZWRUdXBsZU1lbWJlciIgJiYgdDQub3B0aW9uYWwgfHwgaTIgPT09ICJUU09wdGlvbmFsVHlwZSIsIGkyID09PSAiVFNSZXN0VHlwZSIgJiYgKGkyID0gKHQ0ID0gdDQudHlwZUFubm90YXRpb24pLnR5cGUpOwogICAgICAgICAgICAgIGNvbnN0IG4yID0gaTIgPT09ICJUU05hbWVkVHVwbGVNZW1iZXIiOwogICAgICAgICAgICAgIHMyID0gKHIyID0gczIpICE9IG51bGwgPyByMiA6IG4yLCBzMiAhPT0gbjIgJiYgdGhpcy5yYWlzZSh0NC5zdGFydCwgcmQuTWl4ZWRMYWJlbGVkQW5kVW5sYWJlbGVkRWxlbWVudHMpOwogICAgICAgICAgICB9KSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiVFNUdXBsZVR5cGUiKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUdXBsZUVsZW1lbnRUeXBlKCkgewogICAgICAgICAgICBjb25zdCB7IHN0YXJ0OiB0Mywgc3RhcnRMb2M6IGUyIH0gPSB0aGlzLnN0YXRlLCBzMiA9IHRoaXMuZWF0KDIxKTsKICAgICAgICAgICAgbGV0IHIyID0gdGhpcy50c1BhcnNlVHlwZSgpOwogICAgICAgICAgICBjb25zdCBpMiA9IHRoaXMuZWF0KDE3KTsKICAgICAgICAgICAgaWYgKHRoaXMuZWF0KDE0KSkgewogICAgICAgICAgICAgIGNvbnN0IHQ0ID0gdGhpcy5zdGFydE5vZGVBdE5vZGUocjIpOwogICAgICAgICAgICAgIHQ0Lm9wdGlvbmFsID0gaTIsIHIyLnR5cGUgIT09ICJUU1R5cGVSZWZlcmVuY2UiIHx8IHIyLnR5cGVQYXJhbWV0ZXJzIHx8IHIyLnR5cGVOYW1lLnR5cGUgIT09ICJJZGVudGlmaWVyIiA/ICh0aGlzLnJhaXNlKHIyLnN0YXJ0LCByZC5JbnZhbGlkVHVwbGVNZW1iZXJMYWJlbCksIHQ0LmxhYmVsID0gcjIpIDogdDQubGFiZWwgPSByMi50eXBlTmFtZSwgdDQuZWxlbWVudFR5cGUgPSB0aGlzLnRzUGFyc2VUeXBlKCksIHIyID0gdGhpcy5maW5pc2hOb2RlKHQ0LCAiVFNOYW1lZFR1cGxlTWVtYmVyIik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaTIpIHsKICAgICAgICAgICAgICBjb25zdCB0NCA9IHRoaXMuc3RhcnROb2RlQXROb2RlKHIyKTsKICAgICAgICAgICAgICB0NC50eXBlQW5ub3RhdGlvbiA9IHIyLCByMiA9IHRoaXMuZmluaXNoTm9kZSh0NCwgIlRTT3B0aW9uYWxUeXBlIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHMyKSB7CiAgICAgICAgICAgICAgY29uc3QgczMgPSB0aGlzLnN0YXJ0Tm9kZUF0KHQzLCBlMik7CiAgICAgICAgICAgICAgczMudHlwZUFubm90YXRpb24gPSByMiwgcjIgPSB0aGlzLmZpbmlzaE5vZGUoczMsICJUU1Jlc3RUeXBlIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZVBhcmVudGhlc2l6ZWRUeXBlKCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4cGVjdCgxMCksIHQzLnR5cGVBbm5vdGF0aW9uID0gdGhpcy50c1BhcnNlVHlwZSgpLCB0aGlzLmV4cGVjdCgxMSksIHRoaXMuZmluaXNoTm9kZSh0MywgIlRTUGFyZW50aGVzaXplZFR5cGUiKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VGdW5jdGlvbk9yQ29uc3RydWN0b3JUeXBlKHQzLCBlMikgewogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0MyA9PT0gIlRTQ29uc3RydWN0b3JUeXBlIiAmJiAoczIuYWJzdHJhY3QgPSAhIWUyLCBlMiAmJiB0aGlzLm5leHQoKSwgdGhpcy5uZXh0KCkpLCB0aGlzLnRzRmlsbFNpZ25hdHVyZSgxOSwgczIpLCB0aGlzLmZpbmlzaE5vZGUoczIsIHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VMaXRlcmFsVHlwZU5vZGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHQzLmxpdGVyYWwgPSAoKCkgPT4gewogICAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zdGF0ZS50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIDEyNDoKICAgICAgICAgICAgICAgIGNhc2UgMTI1OgogICAgICAgICAgICAgICAgY2FzZSAxMjM6CiAgICAgICAgICAgICAgICBjYXNlIDc5OgogICAgICAgICAgICAgICAgY2FzZSA4MDoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VFeHByQXRvbSgpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgdGhyb3cgdGhpcy51bmV4cGVjdGVkKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSgpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJUU0xpdGVyYWxUeXBlIik7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlVGVtcGxhdGVMaXRlcmFsVHlwZSgpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICByZXR1cm4gdDMubGl0ZXJhbCA9IHRoaXMucGFyc2VUZW1wbGF0ZShmYWxzZSksIHRoaXMuZmluaXNoTm9kZSh0MywgIlRTTGl0ZXJhbFR5cGUiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlVGVtcGxhdGVTdWJzdGl0dXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmluVHlwZSA/IHRoaXMudHNQYXJzZVR5cGUoKSA6IHN1cGVyLnBhcnNlVGVtcGxhdGVTdWJzdGl0dXRpb24oKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUaGlzVHlwZU9yVGhpc1R5cGVQcmVkaWNhdGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy50c1BhcnNlVGhpc1R5cGVOb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzQ29udGV4dHVhbCgxMDcpICYmICF0aGlzLmhhc1ByZWNlZGluZ0xpbmVCcmVhaygpID8gdGhpcy50c1BhcnNlVGhpc1R5cGVQcmVkaWNhdGUodDMpIDogdDM7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlTm9uQXJyYXlUeXBlKCkgewogICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc3RhdGUudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgMTIzOgogICAgICAgICAgICAgIGNhc2UgMTI0OgogICAgICAgICAgICAgIGNhc2UgMTI1OgogICAgICAgICAgICAgIGNhc2UgNzk6CiAgICAgICAgICAgICAgY2FzZSA4MDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRzUGFyc2VMaXRlcmFsVHlwZU5vZGUoKTsKICAgICAgICAgICAgICBjYXNlIDQ3OgogICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUudmFsdWUgPT09ICItIikgewogICAgICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhcnROb2RlKCksIGUyID0gdGhpcy5sb29rYWhlYWQoKTsKICAgICAgICAgICAgICAgICAgaWYgKGUyLnR5cGUgIT09IDEyNCAmJiBlMi50eXBlICE9PSAxMjUpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgdGhpcy51bmV4cGVjdGVkKCk7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0My5saXRlcmFsID0gdGhpcy5wYXJzZU1heWJlVW5hcnkoKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiVFNMaXRlcmFsVHlwZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSA3MjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRzUGFyc2VUaGlzVHlwZU9yVGhpc1R5cGVQcmVkaWNhdGUoKTsKICAgICAgICAgICAgICBjYXNlIDgxOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudHNQYXJzZVR5cGVRdWVyeSgpOwogICAgICAgICAgICAgIGNhc2UgNzc6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50c1BhcnNlSW1wb3J0VHlwZSgpOwogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRzTG9va0FoZWFkKHRoaXMudHNJc1N0YXJ0T2ZNYXBwZWRUeXBlLmJpbmQodGhpcykpID8gdGhpcy50c1BhcnNlTWFwcGVkVHlwZSgpIDogdGhpcy50c1BhcnNlVHlwZUxpdGVyYWwoKTsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50c1BhcnNlVHVwbGVUeXBlKCk7CiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRzUGFyc2VQYXJlbnRoZXNpemVkVHlwZSgpOwogICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50c1BhcnNlVGVtcGxhdGVMaXRlcmFsVHlwZSgpOwogICAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGNvbnN0IHsgdHlwZTogdDMgfSA9IHRoaXMuc3RhdGU7CiAgICAgICAgICAgICAgICBpZiAoVWModDMpIHx8IHQzID09PSA4MiB8fCB0MyA9PT0gNzgpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZTIgPSB0MyA9PT0gODIgPyAiVFNWb2lkS2V5d29yZCIgOiB0MyA9PT0gNzggPyAiVFNOdWxsS2V5d29yZCIgOiBmdW5jdGlvbih0NCkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodDQpIHsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImFueSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiVFNBbnlLZXl3b3JkIjsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJvb2xlYW4iOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlRTQm9vbGVhbktleXdvcmQiOwogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYmlnaW50IjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJUU0JpZ0ludEtleXdvcmQiOwogICAgICAgICAgICAgICAgICAgICAgY2FzZSAibmV2ZXIiOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlRTTmV2ZXJLZXl3b3JkIjsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiVFNOdW1iZXJLZXl3b3JkIjsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm9iamVjdCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiVFNPYmplY3RLZXl3b3JkIjsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInN0cmluZyI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiVFNTdHJpbmdLZXl3b3JkIjsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInN5bWJvbCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiVFNTeW1ib2xLZXl3b3JkIjsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInVuZGVmaW5lZCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiVFNVbmRlZmluZWRLZXl3b3JkIjsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInVua25vd24iOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlRTVW5rbm93bktleXdvcmQiOwogICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSh0aGlzLnN0YXRlLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgaWYgKGUyICE9PSB2b2lkIDAgJiYgdGhpcy5sb29rYWhlYWRDaGFyQ29kZSgpICE9PSA0NikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHQ0ID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMuZmluaXNoTm9kZSh0NCwgZTIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRzUGFyc2VUeXBlUmVmZXJlbmNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IHRoaXMudW5leHBlY3RlZCgpOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZUFycmF5VHlwZU9ySGlnaGVyKCkgewogICAgICAgICAgICBsZXQgdDMgPSB0aGlzLnRzUGFyc2VOb25BcnJheVR5cGUoKTsKICAgICAgICAgICAgZm9yICg7ICF0aGlzLmhhc1ByZWNlZGluZ0xpbmVCcmVhaygpICYmIHRoaXMuZWF0KDApOyApCiAgICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goMykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGFydE5vZGVBdE5vZGUodDMpOwogICAgICAgICAgICAgICAgZTIuZWxlbWVudFR5cGUgPSB0MywgdGhpcy5leHBlY3QoMyksIHQzID0gdGhpcy5maW5pc2hOb2RlKGUyLCAiVFNBcnJheVR5cGUiKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXJ0Tm9kZUF0Tm9kZSh0Myk7CiAgICAgICAgICAgICAgICBlMi5vYmplY3RUeXBlID0gdDMsIGUyLmluZGV4VHlwZSA9IHRoaXMudHNQYXJzZVR5cGUoKSwgdGhpcy5leHBlY3QoMyksIHQzID0gdGhpcy5maW5pc2hOb2RlKGUyLCAiVFNJbmRleGVkQWNjZXNzVHlwZSIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZVR5cGVPcGVyYXRvcigpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpLCBlMiA9IHRoaXMuc3RhdGUudmFsdWU7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdDMub3BlcmF0b3IgPSBlMiwgdDMudHlwZUFubm90YXRpb24gPSB0aGlzLnRzUGFyc2VUeXBlT3BlcmF0b3JPckhpZ2hlcigpLCBlMiA9PT0gInJlYWRvbmx5IiAmJiB0aGlzLnRzQ2hlY2tUeXBlQW5ub3RhdGlvbkZvclJlYWRPbmx5KHQzKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiVFNUeXBlT3BlcmF0b3IiKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzQ2hlY2tUeXBlQW5ub3RhdGlvbkZvclJlYWRPbmx5KHQzKSB7CiAgICAgICAgICAgIHN3aXRjaCAodDMudHlwZUFubm90YXRpb24udHlwZSkgewogICAgICAgICAgICAgIGNhc2UgIlRTVHVwbGVUeXBlIjoKICAgICAgICAgICAgICBjYXNlICJUU0FycmF5VHlwZSI6CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRoaXMucmFpc2UodDMuc3RhcnQsIHJkLlVuZXhwZWN0ZWRSZWFkb25seSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VJbmZlclR5cGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgdGhpcy5leHBlY3RDb250ZXh0dWFsKDEwNik7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIGUyLm5hbWUgPSB0aGlzLnRzUGFyc2VUeXBlUGFyYW1ldGVyTmFtZSgpLCB0My50eXBlUGFyYW1ldGVyID0gdGhpcy5maW5pc2hOb2RlKGUyLCAiVFNUeXBlUGFyYW1ldGVyIiksIHRoaXMuZmluaXNoTm9kZSh0MywgIlRTSW5mZXJUeXBlIik7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlVHlwZU9wZXJhdG9yT3JIaWdoZXIoKSB7CiAgICAgICAgICAgIHZhciB0MzsKICAgICAgICAgICAgcmV0dXJuICh0MyA9IHRoaXMuc3RhdGUudHlwZSkgPj0gMTExICYmIHQzIDw9IDExMyAmJiAhdGhpcy5zdGF0ZS5jb250YWluc0VzYyA/IHRoaXMudHNQYXJzZVR5cGVPcGVyYXRvcigpIDogdGhpcy5pc0NvbnRleHR1YWwoMTA2KSA/IHRoaXMudHNQYXJzZUluZmVyVHlwZSgpIDogdGhpcy50c1BhcnNlQXJyYXlUeXBlT3JIaWdoZXIoKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VVbmlvbk9ySW50ZXJzZWN0aW9uVHlwZSh0MywgZTIsIHMyKSB7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGFydE5vZGUoKSwgaTIgPSB0aGlzLmVhdChzMiksIG4yID0gW107CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBuMi5wdXNoKGUyKCkpOwogICAgICAgICAgICB9IHdoaWxlICh0aGlzLmVhdChzMikpOwogICAgICAgICAgICByZXR1cm4gbjIubGVuZ3RoICE9PSAxIHx8IGkyID8gKHIyLnR5cGVzID0gbjIsIHRoaXMuZmluaXNoTm9kZShyMiwgdDMpKSA6IG4yWzBdOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZUludGVyc2VjdGlvblR5cGVPckhpZ2hlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudHNQYXJzZVVuaW9uT3JJbnRlcnNlY3Rpb25UeXBlKCJUU0ludGVyc2VjdGlvblR5cGUiLCB0aGlzLnRzUGFyc2VUeXBlT3BlcmF0b3JPckhpZ2hlci5iaW5kKHRoaXMpLCA0MSk7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlVW5pb25UeXBlT3JIaWdoZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRzUGFyc2VVbmlvbk9ySW50ZXJzZWN0aW9uVHlwZSgiVFNVbmlvblR5cGUiLCB0aGlzLnRzUGFyc2VJbnRlcnNlY3Rpb25UeXBlT3JIaWdoZXIuYmluZCh0aGlzKSwgMzkpOwogICAgICAgICAgfQogICAgICAgICAgdHNJc1N0YXJ0T2ZGdW5jdGlvblR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiAhIXRoaXMubWF0Y2goNDMpIHx8IHRoaXMubWF0Y2goMTApICYmIHRoaXMudHNMb29rQWhlYWQodGhpcy50c0lzVW5hbWJpZ3VvdXNseVN0YXJ0T2ZGdW5jdGlvblR5cGUuYmluZCh0aGlzKSk7CiAgICAgICAgICB9CiAgICAgICAgICB0c1NraXBQYXJhbWV0ZXJTdGFydCgpIHsKICAgICAgICAgICAgaWYgKFVjKHRoaXMuc3RhdGUudHlwZSkgfHwgdGhpcy5tYXRjaCg3MikpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0cnVlOwogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCg1KSkgewogICAgICAgICAgICAgIGxldCB0MyA9IDE7CiAgICAgICAgICAgICAgZm9yICh0aGlzLm5leHQoKTsgdDMgPiAwOyApCiAgICAgICAgICAgICAgICB0aGlzLm1hdGNoKDUpID8gKyt0MyA6IHRoaXMubWF0Y2goOCkgJiYgLS10MywgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goMCkpIHsKICAgICAgICAgICAgICBsZXQgdDMgPSAxOwogICAgICAgICAgICAgIGZvciAodGhpcy5uZXh0KCk7IHQzID4gMDsgKQogICAgICAgICAgICAgICAgdGhpcy5tYXRjaCgwKSA/ICsrdDMgOiB0aGlzLm1hdGNoKDMpICYmIC0tdDMsIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHRzSXNVbmFtYmlndW91c2x5U3RhcnRPZkZ1bmN0aW9uVHlwZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMubmV4dCgpLCB0aGlzLm1hdGNoKDExKSB8fCB0aGlzLm1hdGNoKDIxKSkKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKHRoaXMudHNTa2lwUGFyYW1ldGVyU3RhcnQoKSkgewogICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDE0KSB8fCB0aGlzLm1hdGNoKDEyKSB8fCB0aGlzLm1hdGNoKDE3KSB8fCB0aGlzLm1hdGNoKDI3KSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDExKSAmJiAodGhpcy5uZXh0KCksIHRoaXMubWF0Y2goMTkpKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUeXBlT3JUeXBlUHJlZGljYXRlQW5ub3RhdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy50c0luVHlwZSgoKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgIHRoaXMuZXhwZWN0KHQzKTsKICAgICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhcnROb2RlKCksIHIyID0gISF0aGlzLnRzVHJ5UGFyc2UodGhpcy50c1BhcnNlVHlwZVByZWRpY2F0ZUFzc2VydHMuYmluZCh0aGlzKSk7CiAgICAgICAgICAgICAgaWYgKHIyICYmIHRoaXMubWF0Y2goNzIpKSB7CiAgICAgICAgICAgICAgICBsZXQgdDQgPSB0aGlzLnRzUGFyc2VUaGlzVHlwZU9yVGhpc1R5cGVQcmVkaWNhdGUoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0NC50eXBlID09PSAiVFNUaGlzVHlwZSIgPyAoczIucGFyYW1ldGVyTmFtZSA9IHQ0LCBzMi5hc3NlcnRzID0gdHJ1ZSwgczIudHlwZUFubm90YXRpb24gPSBudWxsLCB0NCA9IHRoaXMuZmluaXNoTm9kZShzMiwgIlRTVHlwZVByZWRpY2F0ZSIpKSA6ICh0aGlzLnJlc2V0U3RhcnRMb2NhdGlvbkZyb21Ob2RlKHQ0LCBzMiksIHQ0LmFzc2VydHMgPSB0cnVlKSwgZTIudHlwZUFubm90YXRpb24gPSB0NCwgdGhpcy5maW5pc2hOb2RlKGUyLCAiVFNUeXBlQW5ub3RhdGlvbiIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBpMiA9IHRoaXMudHNJc0lkZW50aWZpZXIoKSAmJiB0aGlzLnRzVHJ5UGFyc2UodGhpcy50c1BhcnNlVHlwZVByZWRpY2F0ZVByZWZpeC5iaW5kKHRoaXMpKTsKICAgICAgICAgICAgICBpZiAoIWkyKQogICAgICAgICAgICAgICAgcmV0dXJuIHIyID8gKHMyLnBhcmFtZXRlck5hbWUgPSB0aGlzLnBhcnNlSWRlbnRpZmllcigpLCBzMi5hc3NlcnRzID0gcjIsIHMyLnR5cGVBbm5vdGF0aW9uID0gbnVsbCwgZTIudHlwZUFubm90YXRpb24gPSB0aGlzLmZpbmlzaE5vZGUoczIsICJUU1R5cGVQcmVkaWNhdGUiKSwgdGhpcy5maW5pc2hOb2RlKGUyLCAiVFNUeXBlQW5ub3RhdGlvbiIpKSA6IHRoaXMudHNQYXJzZVR5cGVBbm5vdGF0aW9uKGZhbHNlLCBlMik7CiAgICAgICAgICAgICAgY29uc3QgbjIgPSB0aGlzLnRzUGFyc2VUeXBlQW5ub3RhdGlvbihmYWxzZSk7CiAgICAgICAgICAgICAgcmV0dXJuIHMyLnBhcmFtZXRlck5hbWUgPSBpMiwgczIudHlwZUFubm90YXRpb24gPSBuMiwgczIuYXNzZXJ0cyA9IHIyLCBlMi50eXBlQW5ub3RhdGlvbiA9IHRoaXMuZmluaXNoTm9kZShzMiwgIlRTVHlwZVByZWRpY2F0ZSIpLCB0aGlzLmZpbmlzaE5vZGUoZTIsICJUU1R5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgdHNUcnlQYXJzZVR5cGVPclR5cGVQcmVkaWNhdGVBbm5vdGF0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaCgxNCkgPyB0aGlzLnRzUGFyc2VUeXBlT3JUeXBlUHJlZGljYXRlQW5ub3RhdGlvbigxNCkgOiB2b2lkIDA7CiAgICAgICAgICB9CiAgICAgICAgICB0c1RyeVBhcnNlVHlwZUFubm90YXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDE0KSA/IHRoaXMudHNQYXJzZVR5cGVBbm5vdGF0aW9uKCkgOiB2b2lkIDA7CiAgICAgICAgICB9CiAgICAgICAgICB0c1RyeVBhcnNlVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudHNFYXRUaGVuUGFyc2VUeXBlKDE0KTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUeXBlUHJlZGljYXRlUHJlZml4KCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMucGFyc2VJZGVudGlmaWVyKCk7CiAgICAgICAgICAgIGlmICh0aGlzLmlzQ29udGV4dHVhbCgxMDcpICYmICF0aGlzLmhhc1ByZWNlZGluZ0xpbmVCcmVhaygpKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdDM7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlVHlwZVByZWRpY2F0ZUFzc2VydHMoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnR5cGUgIT09IDEwMCkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGF0ZS5jb250YWluc0VzYzsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCAhKCFVYyh0aGlzLnN0YXRlLnR5cGUpICYmICF0aGlzLm1hdGNoKDcyKSkgJiYgKHQzICYmIHRoaXMucmFpc2UodGhpcy5zdGF0ZS5sYXN0VG9rU3RhcnQsIERjLkludmFsaWRFc2NhcGVkUmVzZXJ2ZWRXb3JkLCAiYXNzZXJ0cyIpLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUeXBlQW5ub3RhdGlvbigpIHsKICAgICAgICAgICAgbGV0IHQzID0gIShhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHZvaWQgMCkgfHwgYXJndW1lbnRzWzBdLCBlMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDogdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudHNJblR5cGUoKCkgPT4gewogICAgICAgICAgICAgIHQzICYmIHRoaXMuZXhwZWN0KDE0KSwgZTIudHlwZUFubm90YXRpb24gPSB0aGlzLnRzUGFyc2VUeXBlKCk7CiAgICAgICAgICAgIH0pLCB0aGlzLmZpbmlzaE5vZGUoZTIsICJUU1R5cGVBbm5vdGF0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlVHlwZSgpIHsKICAgICAgICAgICAgc2QodGhpcy5zdGF0ZS5pblR5cGUpOwogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMudHNQYXJzZU5vbkNvbmRpdGlvbmFsVHlwZSgpOwogICAgICAgICAgICBpZiAodGhpcy5oYXNQcmVjZWRpbmdMaW5lQnJlYWsoKSB8fCAhdGhpcy5lYXQoNzUpKQogICAgICAgICAgICAgIHJldHVybiB0MzsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXJ0Tm9kZUF0Tm9kZSh0Myk7CiAgICAgICAgICAgIHJldHVybiBlMi5jaGVja1R5cGUgPSB0MywgZTIuZXh0ZW5kc1R5cGUgPSB0aGlzLnRzUGFyc2VOb25Db25kaXRpb25hbFR5cGUoKSwgdGhpcy5leHBlY3QoMTcpLCBlMi50cnVlVHlwZSA9IHRoaXMudHNQYXJzZVR5cGUoKSwgdGhpcy5leHBlY3QoMTQpLCBlMi5mYWxzZVR5cGUgPSB0aGlzLnRzUGFyc2VUeXBlKCksIHRoaXMuZmluaXNoTm9kZShlMiwgIlRTQ29uZGl0aW9uYWxUeXBlIik7CiAgICAgICAgICB9CiAgICAgICAgICBpc0Fic3RyYWN0Q29uc3RydWN0b3JTaWduYXR1cmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzQ29udGV4dHVhbCgxMTQpICYmIHRoaXMubG9va2FoZWFkKCkudHlwZSA9PT0gNzE7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlTm9uQ29uZGl0aW9uYWxUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy50c0lzU3RhcnRPZkZ1bmN0aW9uVHlwZSgpID8gdGhpcy50c1BhcnNlRnVuY3Rpb25PckNvbnN0cnVjdG9yVHlwZSgiVFNGdW5jdGlvblR5cGUiKSA6IHRoaXMubWF0Y2goNzEpID8gdGhpcy50c1BhcnNlRnVuY3Rpb25PckNvbnN0cnVjdG9yVHlwZSgiVFNDb25zdHJ1Y3RvclR5cGUiKSA6IHRoaXMuaXNBYnN0cmFjdENvbnN0cnVjdG9yU2lnbmF0dXJlKCkgPyB0aGlzLnRzUGFyc2VGdW5jdGlvbk9yQ29uc3RydWN0b3JUeXBlKCJUU0NvbnN0cnVjdG9yVHlwZSIsIHRydWUpIDogdGhpcy50c1BhcnNlVW5pb25UeXBlT3JIaWdoZXIoKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUeXBlQXNzZXJ0aW9uKCkgewogICAgICAgICAgICB0aGlzLmdldFBsdWdpbk9wdGlvbigidHlwZXNjcmlwdCIsICJkaXNhbGxvd0FtYmlndW91c0pTWExpa2UiKSAmJiB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIHJkLlJlc2VydmVkVHlwZUFzc2VydGlvbik7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKSwgZTIgPSB0aGlzLnRzVHJ5TmV4dFBhcnNlQ29uc3RhbnRDb250ZXh0KCk7CiAgICAgICAgICAgIHJldHVybiB0My50eXBlQW5ub3RhdGlvbiA9IGUyIHx8IHRoaXMudHNOZXh0VGhlblBhcnNlVHlwZSgpLCB0aGlzLmV4cGVjdCg0NCksIHQzLmV4cHJlc3Npb24gPSB0aGlzLnBhcnNlTWF5YmVVbmFyeSgpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJUU1R5cGVBc3NlcnRpb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VIZXJpdGFnZUNsYXVzZSh0MykgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhdGUuc3RhcnQsIHMyID0gdGhpcy50c1BhcnNlRGVsaW1pdGVkTGlzdCgiSGVyaXRhZ2VDbGF1c2VFbGVtZW50IiwgdGhpcy50c1BhcnNlRXhwcmVzc2lvbldpdGhUeXBlQXJndW1lbnRzLmJpbmQodGhpcykpOwogICAgICAgICAgICByZXR1cm4gczIubGVuZ3RoIHx8IHRoaXMucmFpc2UoZTIsIHJkLkVtcHR5SGVyaXRhZ2VDbGF1c2VUeXBlLCB0MyksIHMyOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZUV4cHJlc3Npb25XaXRoVHlwZUFyZ3VtZW50cygpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICByZXR1cm4gdDMuZXhwcmVzc2lvbiA9IHRoaXMudHNQYXJzZUVudGl0eU5hbWUoZmFsc2UpLCB0aGlzLm1hdGNoKDQzKSAmJiAodDMudHlwZVBhcmFtZXRlcnMgPSB0aGlzLnRzUGFyc2VUeXBlQXJndW1lbnRzKCkpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJUU0V4cHJlc3Npb25XaXRoVHlwZUFyZ3VtZW50cyIpOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZUludGVyZmFjZURlY2xhcmF0aW9uKHQzKSB7CiAgICAgICAgICAgIFVjKHRoaXMuc3RhdGUudHlwZSkgPyAodDMuaWQgPSB0aGlzLnBhcnNlSWRlbnRpZmllcigpLCB0aGlzLmNoZWNrTFZhbCh0My5pZCwgInR5cGVzY3JpcHQgaW50ZXJmYWNlIGRlY2xhcmF0aW9uIiwgMTMwKSkgOiAodDMuaWQgPSBudWxsLCB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIHJkLk1pc3NpbmdJbnRlcmZhY2VOYW1lKSksIHQzLnR5cGVQYXJhbWV0ZXJzID0gdGhpcy50c1RyeVBhcnNlVHlwZVBhcmFtZXRlcnMoKSwgdGhpcy5lYXQoNzUpICYmICh0My5leHRlbmRzID0gdGhpcy50c1BhcnNlSGVyaXRhZ2VDbGF1c2UoImV4dGVuZHMiKSk7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIGUyLmJvZHkgPSB0aGlzLnRzSW5UeXBlKHRoaXMudHNQYXJzZU9iamVjdFR5cGVNZW1iZXJzLmJpbmQodGhpcykpLCB0My5ib2R5ID0gdGhpcy5maW5pc2hOb2RlKGUyLCAiVFNJbnRlcmZhY2VCb2R5IiksIHRoaXMuZmluaXNoTm9kZSh0MywgIlRTSW50ZXJmYWNlRGVjbGFyYXRpb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUeXBlQWxpYXNEZWNsYXJhdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gdDMuaWQgPSB0aGlzLnBhcnNlSWRlbnRpZmllcigpLCB0aGlzLmNoZWNrTFZhbCh0My5pZCwgInR5cGVzY3JpcHQgdHlwZSBhbGlhcyIsIDIpLCB0My50eXBlUGFyYW1ldGVycyA9IHRoaXMudHNUcnlQYXJzZVR5cGVQYXJhbWV0ZXJzKCksIHQzLnR5cGVBbm5vdGF0aW9uID0gdGhpcy50c0luVHlwZSgoKSA9PiB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuZXhwZWN0KDI3KSwgdGhpcy5pc0NvbnRleHR1YWwoMTA1KSAmJiB0aGlzLmxvb2thaGVhZCgpLnR5cGUgIT09IDE2KSB7CiAgICAgICAgICAgICAgICBjb25zdCB0NCA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMuZmluaXNoTm9kZSh0NCwgIlRTSW50cmluc2ljS2V5d29yZCIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gdGhpcy50c1BhcnNlVHlwZSgpOwogICAgICAgICAgICB9KSwgdGhpcy5zZW1pY29sb24oKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiVFNUeXBlQWxpYXNEZWNsYXJhdGlvbiIpOwogICAgICAgICAgfQogICAgICAgICAgdHNJbk5vQ29udGV4dCh0MykgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhdGUuY29udGV4dDsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5jb250ZXh0ID0gW2UyWzBdXTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICByZXR1cm4gdDMoKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICB0aGlzLnN0YXRlLmNvbnRleHQgPSBlMjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdHNJblR5cGUodDMpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXRlLmluVHlwZTsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5pblR5cGUgPSB0cnVlOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiB0MygpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIHRoaXMuc3RhdGUuaW5UeXBlID0gZTI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHRzRWF0VGhlblBhcnNlVHlwZSh0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaCh0MykgPyB0aGlzLnRzTmV4dFRoZW5QYXJzZVR5cGUoKSA6IHZvaWQgMDsKICAgICAgICAgIH0KICAgICAgICAgIHRzRXhwZWN0VGhlblBhcnNlVHlwZSh0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy50c0RvVGhlblBhcnNlVHlwZSgoKSA9PiB0aGlzLmV4cGVjdCh0MykpOwogICAgICAgICAgfQogICAgICAgICAgdHNOZXh0VGhlblBhcnNlVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudHNEb1RoZW5QYXJzZVR5cGUoKCkgPT4gdGhpcy5uZXh0KCkpOwogICAgICAgICAgfQogICAgICAgICAgdHNEb1RoZW5QYXJzZVR5cGUodDMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudHNJblR5cGUoKCkgPT4gKHQzKCksIHRoaXMudHNQYXJzZVR5cGUoKSkpOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZUVudW1NZW1iZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHQzLmlkID0gdGhpcy5tYXRjaCgxMjMpID8gdGhpcy5wYXJzZUV4cHJBdG9tKCkgOiB0aGlzLnBhcnNlSWRlbnRpZmllcih0cnVlKSwgdGhpcy5lYXQoMjcpICYmICh0My5pbml0aWFsaXplciA9IHRoaXMucGFyc2VNYXliZUFzc2lnbkFsbG93SW4oKSksIHRoaXMuZmluaXNoTm9kZSh0MywgIlRTRW51bU1lbWJlciIpOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZUVudW1EZWNsYXJhdGlvbih0MywgZTIpIHsKICAgICAgICAgICAgcmV0dXJuIGUyICYmICh0My5jb25zdCA9IHRydWUpLCB0My5pZCA9IHRoaXMucGFyc2VJZGVudGlmaWVyKCksIHRoaXMuY2hlY2tMVmFsKHQzLmlkLCAidHlwZXNjcmlwdCBlbnVtIGRlY2xhcmF0aW9uIiwgZTIgPyA3NzkgOiAyNjcpLCB0aGlzLmV4cGVjdCg1KSwgdDMubWVtYmVycyA9IHRoaXMudHNQYXJzZURlbGltaXRlZExpc3QoIkVudW1NZW1iZXJzIiwgdGhpcy50c1BhcnNlRW51bU1lbWJlci5iaW5kKHRoaXMpKSwgdGhpcy5leHBlY3QoOCksIHRoaXMuZmluaXNoTm9kZSh0MywgIlRTRW51bURlY2xhcmF0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlTW9kdWxlQmxvY2soKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NvcGUuZW50ZXIoMCksIHRoaXMuZXhwZWN0KDUpLCB0aGlzLnBhcnNlQmxvY2tPck1vZHVsZUJsb2NrQm9keSh0My5ib2R5ID0gW10sIHZvaWQgMCwgdHJ1ZSwgOCksIHRoaXMuc2NvcGUuZXhpdCgpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJUU01vZHVsZUJsb2NrIik7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlTW9kdWxlT3JOYW1lc3BhY2VEZWNsYXJhdGlvbih0MykgewogICAgICAgICAgICBsZXQgZTIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCAmJiBhcmd1bWVudHNbMV07CiAgICAgICAgICAgIGlmICh0My5pZCA9IHRoaXMucGFyc2VJZGVudGlmaWVyKCksIGUyIHx8IHRoaXMuY2hlY2tMVmFsKHQzLmlkLCAibW9kdWxlIG9yIG5hbWVzcGFjZSBkZWNsYXJhdGlvbiIsIDEwMjQpLCB0aGlzLmVhdCgxNikpIHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgICAgdGhpcy50c1BhcnNlTW9kdWxlT3JOYW1lc3BhY2VEZWNsYXJhdGlvbihlMywgdHJ1ZSksIHQzLmJvZHkgPSBlMzsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgdGhpcy5zY29wZS5lbnRlcihEbCksIHRoaXMucHJvZFBhcmFtLmVudGVyKDApLCB0My5ib2R5ID0gdGhpcy50c1BhcnNlTW9kdWxlQmxvY2soKSwgdGhpcy5wcm9kUGFyYW0uZXhpdCgpLCB0aGlzLnNjb3BlLmV4aXQoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZSh0MywgIlRTTW9kdWxlRGVjbGFyYXRpb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VBbWJpZW50RXh0ZXJuYWxNb2R1bGVEZWNsYXJhdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5pc0NvbnRleHR1YWwoMTAzKSA/ICh0My5nbG9iYWwgPSB0cnVlLCB0My5pZCA9IHRoaXMucGFyc2VJZGVudGlmaWVyKCkpIDogdGhpcy5tYXRjaCgxMjMpID8gdDMuaWQgPSB0aGlzLnBhcnNlRXhwckF0b20oKSA6IHRoaXMudW5leHBlY3RlZCgpLCB0aGlzLm1hdGNoKDUpID8gKHRoaXMuc2NvcGUuZW50ZXIoRGwpLCB0aGlzLnByb2RQYXJhbS5lbnRlcigwKSwgdDMuYm9keSA9IHRoaXMudHNQYXJzZU1vZHVsZUJsb2NrKCksIHRoaXMucHJvZFBhcmFtLmV4aXQoKSwgdGhpcy5zY29wZS5leGl0KCkpIDogdGhpcy5zZW1pY29sb24oKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiVFNNb2R1bGVEZWNsYXJhdGlvbiIpOwogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZUltcG9ydEVxdWFsc0RlY2xhcmF0aW9uKHQzLCBlMikgewogICAgICAgICAgICB0My5pc0V4cG9ydCA9IGUyIHx8IGZhbHNlLCB0My5pZCA9IHRoaXMucGFyc2VJZGVudGlmaWVyKCksIHRoaXMuY2hlY2tMVmFsKHQzLmlkLCAiaW1wb3J0IGVxdWFscyBkZWNsYXJhdGlvbiIsIDkpLCB0aGlzLmV4cGVjdCgyNyk7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy50c1BhcnNlTW9kdWxlUmVmZXJlbmNlKCk7CiAgICAgICAgICAgIHJldHVybiB0My5pbXBvcnRLaW5kID09PSAidHlwZSIgJiYgczIudHlwZSAhPT0gIlRTRXh0ZXJuYWxNb2R1bGVSZWZlcmVuY2UiICYmIHRoaXMucmFpc2UoczIuc3RhcnQsIHJkLkltcG9ydEFsaWFzSGFzSW1wb3J0VHlwZSksIHQzLm1vZHVsZVJlZmVyZW5jZSA9IHMyLCB0aGlzLnNlbWljb2xvbigpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJUU0ltcG9ydEVxdWFsc0RlY2xhcmF0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICB0c0lzRXh0ZXJuYWxNb2R1bGVSZWZlcmVuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzQ29udGV4dHVhbCgxMTApICYmIHRoaXMubG9va2FoZWFkQ2hhckNvZGUoKSA9PT0gNDA7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlTW9kdWxlUmVmZXJlbmNlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy50c0lzRXh0ZXJuYWxNb2R1bGVSZWZlcmVuY2UoKSA/IHRoaXMudHNQYXJzZUV4dGVybmFsTW9kdWxlUmVmZXJlbmNlKCkgOiB0aGlzLnRzUGFyc2VFbnRpdHlOYW1lKGZhbHNlKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VFeHRlcm5hbE1vZHVsZVJlZmVyZW5jZSgpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICBpZiAodGhpcy5leHBlY3RDb250ZXh0dWFsKDExMCksIHRoaXMuZXhwZWN0KDEwKSwgIXRoaXMubWF0Y2goMTIzKSkKICAgICAgICAgICAgICB0aHJvdyB0aGlzLnVuZXhwZWN0ZWQoKTsKICAgICAgICAgICAgcmV0dXJuIHQzLmV4cHJlc3Npb24gPSB0aGlzLnBhcnNlRXhwckF0b20oKSwgdGhpcy5leHBlY3QoMTEpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJUU0V4dGVybmFsTW9kdWxlUmVmZXJlbmNlIik7CiAgICAgICAgICB9CiAgICAgICAgICB0c0xvb2tBaGVhZCh0MykgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhdGUuY2xvbmUoKSwgczIgPSB0MygpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZSA9IGUyLCBzMjsKICAgICAgICAgIH0KICAgICAgICAgIHRzVHJ5UGFyc2VBbmRDYXRjaCh0MykgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMudHJ5UGFyc2UoKGUzKSA9PiB0MygpIHx8IGUzKCkpOwogICAgICAgICAgICBpZiAoIWUyLmFib3J0ZWQgJiYgZTIubm9kZSkKICAgICAgICAgICAgICByZXR1cm4gZTIuZXJyb3IgJiYgKHRoaXMuc3RhdGUgPSBlMi5mYWlsU3RhdGUpLCBlMi5ub2RlOwogICAgICAgICAgfQogICAgICAgICAgdHNUcnlQYXJzZSh0MykgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhdGUuY2xvbmUoKSwgczIgPSB0MygpOwogICAgICAgICAgICByZXR1cm4gczIgIT09IHZvaWQgMCAmJiBzMiAhPT0gZmFsc2UgPyBzMiA6IHZvaWQgKHRoaXMuc3RhdGUgPSBlMik7CiAgICAgICAgICB9CiAgICAgICAgICB0c1RyeVBhcnNlRGVjbGFyZSh0MykgewogICAgICAgICAgICBpZiAodGhpcy5pc0xpbmVUZXJtaW5hdG9yKCkpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBsZXQgZTIsIHMyID0gdGhpcy5zdGF0ZS50eXBlOwogICAgICAgICAgICByZXR1cm4gdGhpcy5pc0NvbnRleHR1YWwoOTMpICYmIChzMiA9IDY4LCBlMiA9ICJsZXQiKSwgdGhpcy50c0luQW1iaWVudENvbnRleHQoKCkgPT4gewogICAgICAgICAgICAgIHN3aXRjaCAoczIpIHsKICAgICAgICAgICAgICAgIGNhc2UgNjI6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0My5kZWNsYXJlID0gdHJ1ZSwgdGhpcy5wYXJzZUZ1bmN0aW9uU3RhdGVtZW50KHQzLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBjYXNlIDc0OgogICAgICAgICAgICAgICAgICByZXR1cm4gdDMuZGVjbGFyZSA9IHRydWUsIHRoaXMucGFyc2VDbGFzcyh0MywgdHJ1ZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgY2FzZSA2OToKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goNjkpICYmIHRoaXMuaXNMb29rYWhlYWRDb250ZXh0dWFsKCJlbnVtIikpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwZWN0KDY5KSwgdGhpcy5leHBlY3RDb250ZXh0dWFsKDExNiksIHRoaXMudHNQYXJzZUVudW1EZWNsYXJhdGlvbih0MywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBjYXNlIDY4OgogICAgICAgICAgICAgICAgICByZXR1cm4gZTIgPSBlMiB8fCB0aGlzLnN0YXRlLnZhbHVlLCB0aGlzLnBhcnNlVmFyU3RhdGVtZW50KHQzLCBlMik7CiAgICAgICAgICAgICAgICBjYXNlIDEwMzoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudHNQYXJzZUFtYmllbnRFeHRlcm5hbE1vZHVsZURlY2xhcmF0aW9uKHQzKTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIGlmIChVYyhzMikpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudHNQYXJzZURlY2xhcmF0aW9uKHQzLCB0aGlzLnN0YXRlLnZhbHVlLCB0cnVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgdHNUcnlQYXJzZUV4cG9ydERlY2xhcmF0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy50c1BhcnNlRGVjbGFyYXRpb24odGhpcy5zdGFydE5vZGUoKSwgdGhpcy5zdGF0ZS52YWx1ZSwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlRXhwcmVzc2lvblN0YXRlbWVudCh0MywgZTIpIHsKICAgICAgICAgICAgc3dpdGNoIChlMi5uYW1lKSB7CiAgICAgICAgICAgICAgY2FzZSAiZGVjbGFyZSI6IHsKICAgICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy50c1RyeVBhcnNlRGVjbGFyZSh0Myk7CiAgICAgICAgICAgICAgICBpZiAoZTMpCiAgICAgICAgICAgICAgICAgIHJldHVybiBlMy5kZWNsYXJlID0gdHJ1ZSwgZTM7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY2FzZSAiZ2xvYmFsIjoKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDUpKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2NvcGUuZW50ZXIoRGwpLCB0aGlzLnByb2RQYXJhbS5lbnRlcigwKTsKICAgICAgICAgICAgICAgICAgY29uc3QgczIgPSB0MzsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHMyLmdsb2JhbCA9IHRydWUsIHMyLmlkID0gZTIsIHMyLmJvZHkgPSB0aGlzLnRzUGFyc2VNb2R1bGVCbG9jaygpLCB0aGlzLnNjb3BlLmV4aXQoKSwgdGhpcy5wcm9kUGFyYW0uZXhpdCgpLCB0aGlzLmZpbmlzaE5vZGUoczIsICJUU01vZHVsZURlY2xhcmF0aW9uIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudHNQYXJzZURlY2xhcmF0aW9uKHQzLCBlMi5uYW1lLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VEZWNsYXJhdGlvbih0MywgZTIsIHMyKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZTIpIHsKICAgICAgICAgICAgICBjYXNlICJhYnN0cmFjdCI6CiAgICAgICAgICAgICAgICBpZiAodGhpcy50c0NoZWNrTGluZVRlcm1pbmF0b3IoczIpICYmICh0aGlzLm1hdGNoKDc0KSB8fCBVYyh0aGlzLnN0YXRlLnR5cGUpKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudHNQYXJzZUFic3RyYWN0RGVjbGFyYXRpb24odDMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiZW51bSI6CiAgICAgICAgICAgICAgICBpZiAoczIgfHwgVWModGhpcy5zdGF0ZS50eXBlKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHMyICYmIHRoaXMubmV4dCgpLCB0aGlzLnRzUGFyc2VFbnVtRGVjbGFyYXRpb24odDMsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgImludGVyZmFjZSI6CiAgICAgICAgICAgICAgICBpZiAodGhpcy50c0NoZWNrTGluZVRlcm1pbmF0b3IoczIpICYmIFVjKHRoaXMuc3RhdGUudHlwZSkpCiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRzUGFyc2VJbnRlcmZhY2VEZWNsYXJhdGlvbih0Myk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJtb2R1bGUiOgogICAgICAgICAgICAgICAgaWYgKHRoaXMudHNDaGVja0xpbmVUZXJtaW5hdG9yKHMyKSkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXRjaCgxMjMpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRzUGFyc2VBbWJpZW50RXh0ZXJuYWxNb2R1bGVEZWNsYXJhdGlvbih0Myk7CiAgICAgICAgICAgICAgICAgIGlmIChVYyh0aGlzLnN0YXRlLnR5cGUpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRzUGFyc2VNb2R1bGVPck5hbWVzcGFjZURlY2xhcmF0aW9uKHQzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIm5hbWVzcGFjZSI6CiAgICAgICAgICAgICAgICBpZiAodGhpcy50c0NoZWNrTGluZVRlcm1pbmF0b3IoczIpICYmIFVjKHRoaXMuc3RhdGUudHlwZSkpCiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRzUGFyc2VNb2R1bGVPck5hbWVzcGFjZURlY2xhcmF0aW9uKHQzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInR5cGUiOgogICAgICAgICAgICAgICAgaWYgKHRoaXMudHNDaGVja0xpbmVUZXJtaW5hdG9yKHMyKSAmJiBVYyh0aGlzLnN0YXRlLnR5cGUpKQogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50c1BhcnNlVHlwZUFsaWFzRGVjbGFyYXRpb24odDMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0c0NoZWNrTGluZVRlcm1pbmF0b3IodDMpIHsKICAgICAgICAgICAgcmV0dXJuIHQzID8gIXRoaXMuaGFzRm9sbG93aW5nTGluZUJyZWFrKCkgJiYgKHRoaXMubmV4dCgpLCB0cnVlKSA6ICF0aGlzLmlzTGluZVRlcm1pbmF0b3IoKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzVHJ5UGFyc2VHZW5lcmljQXN5bmNBcnJvd0Z1bmN0aW9uKHQzLCBlMikgewogICAgICAgICAgICBpZiAoIXRoaXMubWF0Y2goNDMpKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgY29uc3QgczIgPSB0aGlzLnN0YXRlLm1heWJlSW5BcnJvd1BhcmFtZXRlcnM7CiAgICAgICAgICAgIHRoaXMuc3RhdGUubWF5YmVJbkFycm93UGFyYW1ldGVycyA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy50c1RyeVBhcnNlQW5kQ2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIGNvbnN0IHMzID0gdGhpcy5zdGFydE5vZGVBdCh0MywgZTIpOwogICAgICAgICAgICAgIHJldHVybiBzMy50eXBlUGFyYW1ldGVycyA9IHRoaXMudHNQYXJzZVR5cGVQYXJhbWV0ZXJzKCksIHN1cGVyLnBhcnNlRnVuY3Rpb25QYXJhbXMoczMpLCBzMy5yZXR1cm5UeXBlID0gdGhpcy50c1RyeVBhcnNlVHlwZU9yVHlwZVByZWRpY2F0ZUFubm90YXRpb24oKSwgdGhpcy5leHBlY3QoMTkpLCBzMzsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLm1heWJlSW5BcnJvd1BhcmFtZXRlcnMgPSBzMiwgcjIgPyB0aGlzLnBhcnNlQXJyb3dFeHByZXNzaW9uKHIyLCBudWxsLCB0cnVlKSA6IHZvaWQgMDsKICAgICAgICAgIH0KICAgICAgICAgIHRzUGFyc2VUeXBlQXJndW1lbnRzKCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0My5wYXJhbXMgPSB0aGlzLnRzSW5UeXBlKCgpID0+IHRoaXMudHNJbk5vQ29udGV4dCgoKSA9PiAodGhpcy5leHBlY3QoNDMpLCB0aGlzLnRzUGFyc2VEZWxpbWl0ZWRMaXN0KCJUeXBlUGFyYW1ldGVyc09yQXJndW1lbnRzIiwgdGhpcy50c1BhcnNlVHlwZS5iaW5kKHRoaXMpKSkpKSwgdDMucGFyYW1zLmxlbmd0aCA9PT0gMCAmJiB0aGlzLnJhaXNlKHQzLnN0YXJ0LCByZC5FbXB0eVR5cGVBcmd1bWVudHMpLCB0aGlzLmV4cGVjdCg0NCksIHRoaXMuZmluaXNoTm9kZSh0MywgIlRTVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzSXNEZWNsYXJhdGlvblN0YXJ0KCkgewogICAgICAgICAgICByZXR1cm4gKHQzID0gdGhpcy5zdGF0ZS50eXBlKSA+PSAxMTQgJiYgdDMgPD0gMTIwOwogICAgICAgICAgICB2YXIgdDM7CiAgICAgICAgICB9CiAgICAgICAgICBpc0V4cG9ydERlZmF1bHRTcGVjaWZpZXIoKSB7CiAgICAgICAgICAgIHJldHVybiAhdGhpcy50c0lzRGVjbGFyYXRpb25TdGFydCgpICYmIHN1cGVyLmlzRXhwb3J0RGVmYXVsdFNwZWNpZmllcigpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VBc3NpZ25hYmxlTGlzdEl0ZW0odDMsIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5zdGF0ZS5zdGFydCwgcjIgPSB0aGlzLnN0YXRlLnN0YXJ0TG9jOwogICAgICAgICAgICBsZXQgaTIsIG4yID0gZmFsc2UsIGEyID0gZmFsc2U7CiAgICAgICAgICAgIGlmICh0MyAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB7fTsKICAgICAgICAgICAgICB0aGlzLnRzUGFyc2VNb2RpZmllcnMoZTMsIFsicHVibGljIiwgInByaXZhdGUiLCAicHJvdGVjdGVkIiwgIm92ZXJyaWRlIiwgInJlYWRvbmx5Il0pLCBpMiA9IGUzLmFjY2Vzc2liaWxpdHksIGEyID0gZTMub3ZlcnJpZGUsIG4yID0gZTMucmVhZG9ubHksIHQzID09PSBmYWxzZSAmJiAoaTIgfHwgbjIgfHwgYTIpICYmIHRoaXMucmFpc2UoczIsIHJkLlVuZXhwZWN0ZWRQYXJhbWV0ZXJNb2RpZmllcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgbzIgPSB0aGlzLnBhcnNlTWF5YmVEZWZhdWx0KCk7CiAgICAgICAgICAgIHRoaXMucGFyc2VBc3NpZ25hYmxlTGlzdEl0ZW1UeXBlcyhvMik7CiAgICAgICAgICAgIGNvbnN0IHUyID0gdGhpcy5wYXJzZU1heWJlRGVmYXVsdChvMi5zdGFydCwgbzIubG9jLnN0YXJ0LCBvMik7CiAgICAgICAgICAgIGlmIChpMiB8fCBuMiB8fCBhMikgewogICAgICAgICAgICAgIGNvbnN0IHQ0ID0gdGhpcy5zdGFydE5vZGVBdChzMiwgcjIpOwogICAgICAgICAgICAgIHJldHVybiBlMi5sZW5ndGggJiYgKHQ0LmRlY29yYXRvcnMgPSBlMiksIGkyICYmICh0NC5hY2Nlc3NpYmlsaXR5ID0gaTIpLCBuMiAmJiAodDQucmVhZG9ubHkgPSBuMiksIGEyICYmICh0NC5vdmVycmlkZSA9IGEyKSwgdTIudHlwZSAhPT0gIklkZW50aWZpZXIiICYmIHUyLnR5cGUgIT09ICJBc3NpZ25tZW50UGF0dGVybiIgJiYgdGhpcy5yYWlzZSh0NC5zdGFydCwgcmQuVW5zdXBwb3J0ZWRQYXJhbWV0ZXJQcm9wZXJ0eUtpbmQpLCB0NC5wYXJhbWV0ZXIgPSB1MiwgdGhpcy5maW5pc2hOb2RlKHQ0LCAiVFNQYXJhbWV0ZXJQcm9wZXJ0eSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlMi5sZW5ndGggJiYgKG8yLmRlY29yYXRvcnMgPSBlMiksIHUyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VGdW5jdGlvbkJvZHlBbmRGaW5pc2godDMsIGUyKSB7CiAgICAgICAgICAgIGxldCBzMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdm9pZCAwICYmIGFyZ3VtZW50c1syXTsKICAgICAgICAgICAgdGhpcy5tYXRjaCgxNCkgJiYgKHQzLnJldHVyblR5cGUgPSB0aGlzLnRzUGFyc2VUeXBlT3JUeXBlUHJlZGljYXRlQW5ub3RhdGlvbigxNCkpOwogICAgICAgICAgICBjb25zdCByMiA9IGUyID09PSAiRnVuY3Rpb25EZWNsYXJhdGlvbiIgPyAiVFNEZWNsYXJlRnVuY3Rpb24iIDogZTIgPT09ICJDbGFzc01ldGhvZCIgfHwgZTIgPT09ICJDbGFzc1ByaXZhdGVNZXRob2QiID8gIlRTRGVjbGFyZU1ldGhvZCIgOiB2b2lkIDA7CiAgICAgICAgICAgIHIyICYmICF0aGlzLm1hdGNoKDUpICYmIHRoaXMuaXNMaW5lVGVybWluYXRvcigpID8gdGhpcy5maW5pc2hOb2RlKHQzLCByMikgOiByMiA9PT0gIlRTRGVjbGFyZUZ1bmN0aW9uIiAmJiB0aGlzLnN0YXRlLmlzQW1iaWVudENvbnRleHQgJiYgKHRoaXMucmFpc2UodDMuc3RhcnQsIHJkLkRlY2xhcmVGdW5jdGlvbkhhc0ltcGxlbWVudGF0aW9uKSwgdDMuZGVjbGFyZSkgPyBzdXBlci5wYXJzZUZ1bmN0aW9uQm9keUFuZEZpbmlzaCh0MywgcjIsIHMyKSA6IHN1cGVyLnBhcnNlRnVuY3Rpb25Cb2R5QW5kRmluaXNoKHQzLCBlMiwgczIpOwogICAgICAgICAgfQogICAgICAgICAgcmVnaXN0ZXJGdW5jdGlvblN0YXRlbWVudElkKHQzKSB7CiAgICAgICAgICAgICF0My5ib2R5ICYmIHQzLmlkID8gdGhpcy5jaGVja0xWYWwodDMuaWQsICJmdW5jdGlvbiBuYW1lIiwgMTAyNCkgOiBzdXBlci5yZWdpc3RlckZ1bmN0aW9uU3RhdGVtZW50SWQoLi4uYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHRzQ2hlY2tGb3JJbnZhbGlkVHlwZUNhc3RzKHQzKSB7CiAgICAgICAgICAgIHQzLmZvckVhY2goKHQ0KSA9PiB7CiAgICAgICAgICAgICAgKHQ0ID09IG51bGwgPyB2b2lkIDAgOiB0NC50eXBlKSA9PT0gIlRTVHlwZUNhc3RFeHByZXNzaW9uIiAmJiB0aGlzLnJhaXNlKHQ0LnR5cGVBbm5vdGF0aW9uLnN0YXJ0LCByZC5VbmV4cGVjdGVkVHlwZUFubm90YXRpb24pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHRvUmVmZXJlbmNlZExpc3QodDMsIGUyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRzQ2hlY2tGb3JJbnZhbGlkVHlwZUNhc3RzKHQzKSwgdDM7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUFycmF5TGlrZSgpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBzdXBlci5wYXJzZUFycmF5TGlrZSguLi5hcmd1bWVudHMpOwogICAgICAgICAgICByZXR1cm4gdDMudHlwZSA9PT0gIkFycmF5RXhwcmVzc2lvbiIgJiYgdGhpcy50c0NoZWNrRm9ySW52YWxpZFR5cGVDYXN0cyh0My5lbGVtZW50cyksIHQzOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VTdWJzY3JpcHQodDMsIGUyLCBzMiwgcjIsIGkyKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNQcmVjZWRpbmdMaW5lQnJlYWsoKSAmJiB0aGlzLm1hdGNoKDMzKSkgewogICAgICAgICAgICAgIHRoaXMuc3RhdGUuY2FuU3RhcnRKU1hFbGVtZW50ID0gZmFsc2UsIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgIGNvbnN0IHIzID0gdGhpcy5zdGFydE5vZGVBdChlMiwgczIpOwogICAgICAgICAgICAgIHJldHVybiByMy5leHByZXNzaW9uID0gdDMsIHRoaXMuZmluaXNoTm9kZShyMywgIlRTTm9uTnVsbEV4cHJlc3Npb24iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgbjIgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goMTgpICYmIHRoaXMubG9va2FoZWFkQ2hhckNvZGUoKSA9PT0gNjApIHsKICAgICAgICAgICAgICBpZiAocjIpCiAgICAgICAgICAgICAgICByZXR1cm4gaTIuc3RvcCA9IHRydWUsIHQzOwogICAgICAgICAgICAgIGkyLm9wdGlvbmFsQ2hhaW5NZW1iZXIgPSBuMiA9IHRydWUsIHRoaXMubmV4dCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDQzKSkgewogICAgICAgICAgICAgIGxldCBhMjsKICAgICAgICAgICAgICBjb25zdCBvMiA9IHRoaXMudHNUcnlQYXJzZUFuZENhdGNoKCgpID0+IHsKICAgICAgICAgICAgICAgIGlmICghcjIgJiYgdGhpcy5hdFBvc3NpYmxlQXN5bmNBcnJvdyh0MykpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdDQgPSB0aGlzLnRzVHJ5UGFyc2VHZW5lcmljQXN5bmNBcnJvd0Z1bmN0aW9uKGUyLCBzMik7CiAgICAgICAgICAgICAgICAgIGlmICh0NCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdDQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBvMyA9IHRoaXMuc3RhcnROb2RlQXQoZTIsIHMyKTsKICAgICAgICAgICAgICAgIG8zLmNhbGxlZSA9IHQzOwogICAgICAgICAgICAgICAgY29uc3QgdTIgPSB0aGlzLnRzUGFyc2VUeXBlQXJndW1lbnRzKCk7CiAgICAgICAgICAgICAgICBpZiAodTIpIHsKICAgICAgICAgICAgICAgICAgaWYgKG4yICYmICF0aGlzLm1hdGNoKDEwKSAmJiAoYTIgPSB0aGlzLnN0YXRlLnBvcywgdGhpcy51bmV4cGVjdGVkKCkpLCAhcjIgJiYgdGhpcy5lYXQoMTApKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvMy5hcmd1bWVudHMgPSB0aGlzLnBhcnNlQ2FsbEV4cHJlc3Npb25Bcmd1bWVudHMoMTEsIGZhbHNlKSwgdGhpcy50c0NoZWNrRm9ySW52YWxpZFR5cGVDYXN0cyhvMy5hcmd1bWVudHMpLCBvMy50eXBlUGFyYW1ldGVycyA9IHUyLCBpMi5vcHRpb25hbENoYWluTWVtYmVyICYmIChvMy5vcHRpb25hbCA9IG4yKSwgdGhpcy5maW5pc2hDYWxsRXhwcmVzc2lvbihvMywgaTIub3B0aW9uYWxDaGFpbk1lbWJlcik7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDIyKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHIzID0gdGhpcy5wYXJzZVRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbih0MywgZTIsIHMyLCBpMik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIzLnR5cGVQYXJhbWV0ZXJzID0gdTIsIHIzOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnVuZXhwZWN0ZWQoKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpZiAoYTIgJiYgdGhpcy51bmV4cGVjdGVkKGEyLCAxMCksIG8yKQogICAgICAgICAgICAgICAgcmV0dXJuIG8yOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdXBlci5wYXJzZVN1YnNjcmlwdCh0MywgZTIsIHMyLCByMiwgaTIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VOZXdBcmd1bWVudHModDMpIHsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goNDMpKSB7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnRzVHJ5UGFyc2VBbmRDYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0NCA9IHRoaXMudHNQYXJzZVR5cGVBcmd1bWVudHMoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDEwKSB8fCB0aGlzLnVuZXhwZWN0ZWQoKSwgdDQ7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgZTIgJiYgKHQzLnR5cGVQYXJhbWV0ZXJzID0gZTIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1cGVyLnBhcnNlTmV3QXJndW1lbnRzKHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRXhwck9wKHQzLCBlMiwgczIsIHIyKSB7CiAgICAgICAgICAgIGlmIChLYyg1MikgPiByMiAmJiAhdGhpcy5oYXNQcmVjZWRpbmdMaW5lQnJlYWsoKSAmJiB0aGlzLmlzQ29udGV4dHVhbCg4NykpIHsKICAgICAgICAgICAgICBjb25zdCBpMiA9IHRoaXMuc3RhcnROb2RlQXQoZTIsIHMyKTsKICAgICAgICAgICAgICBpMi5leHByZXNzaW9uID0gdDM7CiAgICAgICAgICAgICAgY29uc3QgbjIgPSB0aGlzLnRzVHJ5TmV4dFBhcnNlQ29uc3RhbnRDb250ZXh0KCk7CiAgICAgICAgICAgICAgcmV0dXJuIGkyLnR5cGVBbm5vdGF0aW9uID0gbjIgfHwgdGhpcy50c05leHRUaGVuUGFyc2VUeXBlKCksIHRoaXMuZmluaXNoTm9kZShpMiwgIlRTQXNFeHByZXNzaW9uIiksIHRoaXMucmVTY2FuX2x0X2d0KCksIHRoaXMucGFyc2VFeHByT3AoaTIsIGUyLCBzMiwgcjIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdXBlci5wYXJzZUV4cHJPcCh0MywgZTIsIHMyLCByMik7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja1Jlc2VydmVkV29yZCh0MywgZTIsIHMyLCByMikgewogICAgICAgICAgfQogICAgICAgICAgY2hlY2tEdXBsaWNhdGVFeHBvcnRzKCkgewogICAgICAgICAgfQogICAgICAgICAgcGFyc2VJbXBvcnQodDMpIHsKICAgICAgICAgICAgaWYgKHQzLmltcG9ydEtpbmQgPSAidmFsdWUiLCBVYyh0aGlzLnN0YXRlLnR5cGUpIHx8IHRoaXMubWF0Y2goNDkpIHx8IHRoaXMubWF0Y2goNSkpIHsKICAgICAgICAgICAgICBsZXQgZTMgPSB0aGlzLmxvb2thaGVhZCgpOwogICAgICAgICAgICAgIGlmICh0aGlzLmlzQ29udGV4dHVhbCgxMjApICYmIGUzLnR5cGUgIT09IDEyICYmIGUzLnR5cGUgIT09IDkxICYmIGUzLnR5cGUgIT09IDI3ICYmICh0My5pbXBvcnRLaW5kID0gInR5cGUiLCB0aGlzLm5leHQoKSwgZTMgPSB0aGlzLmxvb2thaGVhZCgpKSwgVWModGhpcy5zdGF0ZS50eXBlKSAmJiBlMy50eXBlID09PSAyNykKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRzUGFyc2VJbXBvcnRFcXVhbHNEZWNsYXJhdGlvbih0Myk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZTIgPSBzdXBlci5wYXJzZUltcG9ydCh0Myk7CiAgICAgICAgICAgIHJldHVybiBlMi5pbXBvcnRLaW5kID09PSAidHlwZSIgJiYgZTIuc3BlY2lmaWVycy5sZW5ndGggPiAxICYmIGUyLnNwZWNpZmllcnNbMF0udHlwZSA9PT0gIkltcG9ydERlZmF1bHRTcGVjaWZpZXIiICYmIHRoaXMucmFpc2UoZTIuc3RhcnQsIHJkLlR5cGVJbXBvcnRDYW5ub3RTcGVjaWZ5RGVmYXVsdEFuZE5hbWVkKSwgZTI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUV4cG9ydCh0MykgewogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCg3NykpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0aGlzLmlzQ29udGV4dHVhbCgxMjApICYmIHRoaXMubG9va2FoZWFkQ2hhckNvZGUoKSAhPT0gNjEgPyAodDMuaW1wb3J0S2luZCA9ICJ0eXBlIiwgdGhpcy5uZXh0KCkpIDogdDMuaW1wb3J0S2luZCA9ICJ2YWx1ZSIsIHRoaXMudHNQYXJzZUltcG9ydEVxdWFsc0RlY2xhcmF0aW9uKHQzLCB0cnVlKTsKICAgICAgICAgICAgaWYgKHRoaXMuZWF0KDI3KSkgewogICAgICAgICAgICAgIGNvbnN0IGUyID0gdDM7CiAgICAgICAgICAgICAgcmV0dXJuIGUyLmV4cHJlc3Npb24gPSB0aGlzLnBhcnNlRXhwcmVzc2lvbigpLCB0aGlzLnNlbWljb2xvbigpLCB0aGlzLmZpbmlzaE5vZGUoZTIsICJUU0V4cG9ydEFzc2lnbm1lbnQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5lYXRDb250ZXh0dWFsKDg3KSkgewogICAgICAgICAgICAgIGNvbnN0IGUyID0gdDM7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwZWN0Q29udGV4dHVhbCgxMTgpLCBlMi5pZCA9IHRoaXMucGFyc2VJZGVudGlmaWVyKCksIHRoaXMuc2VtaWNvbG9uKCksIHRoaXMuZmluaXNoTm9kZShlMiwgIlRTTmFtZXNwYWNlRXhwb3J0RGVjbGFyYXRpb24iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5pc0NvbnRleHR1YWwoMTIwKSAmJiB0aGlzLmxvb2thaGVhZCgpLnR5cGUgPT09IDUgPyAodGhpcy5uZXh0KCksIHQzLmV4cG9ydEtpbmQgPSAidHlwZSIpIDogdDMuZXhwb3J0S2luZCA9ICJ2YWx1ZSIsIHN1cGVyLnBhcnNlRXhwb3J0KHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIGlzQWJzdHJhY3RDbGFzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNDb250ZXh0dWFsKDExNCkgJiYgdGhpcy5sb29rYWhlYWQoKS50eXBlID09PSA3NDsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRXhwb3J0RGVmYXVsdEV4cHJlc3Npb24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzQWJzdHJhY3RDbGFzcygpKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdDMuYWJzdHJhY3QgPSB0cnVlLCB0aGlzLnBhcnNlQ2xhc3ModDMsIHRydWUsIHRydWUpLCB0MzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCgxMTkpKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy50c1BhcnNlSW50ZXJmYWNlRGVjbGFyYXRpb24odDMpOwogICAgICAgICAgICAgIGlmIChlMikKICAgICAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc3VwZXIucGFyc2VFeHBvcnREZWZhdWx0RXhwcmVzc2lvbigpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VTdGF0ZW1lbnRDb250ZW50KHQzLCBlMikgewogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS50eXBlID09PSA2OSkgewogICAgICAgICAgICAgIGlmICh0aGlzLmxvb2thaGVhZCgpLnR5cGUgPT09IDExNikgewogICAgICAgICAgICAgICAgY29uc3QgdDQgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0aGlzLmV4cGVjdENvbnRleHR1YWwoMTE2KSwgdGhpcy50c1BhcnNlRW51bURlY2xhcmF0aW9uKHQ0LCB0cnVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnBhcnNlU3RhdGVtZW50Q29udGVudCh0MywgZTIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VBY2Nlc3NNb2RpZmllcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudHNQYXJzZU1vZGlmaWVyKFsicHVibGljIiwgInByb3RlY3RlZCIsICJwcml2YXRlIl0pOwogICAgICAgICAgfQogICAgICAgICAgdHNIYXNTb21lTW9kaWZpZXJzKHQzLCBlMikgewogICAgICAgICAgICByZXR1cm4gZTIuc29tZSgoZTMpID0+IGlkKGUzKSA/IHQzLmFjY2Vzc2liaWxpdHkgPT09IGUzIDogISF0M1tlM10pOwogICAgICAgICAgfQogICAgICAgICAgdHNJc1N0YXJ0T2ZTdGF0aWNCbG9ja3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzQ29udGV4dHVhbCg5OCkgJiYgdGhpcy5sb29rYWhlYWRDaGFyQ29kZSgpID09PSAxMjM7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNsYXNzTWVtYmVyKHQzLCBlMiwgczIpIHsKICAgICAgICAgICAgY29uc3QgcjIgPSBbImRlY2xhcmUiLCAicHJpdmF0ZSIsICJwdWJsaWMiLCAicHJvdGVjdGVkIiwgIm92ZXJyaWRlIiwgImFic3RyYWN0IiwgInJlYWRvbmx5IiwgInN0YXRpYyJdOwogICAgICAgICAgICB0aGlzLnRzUGFyc2VNb2RpZmllcnMoZTIsIHIyLCB2b2lkIDAsIHZvaWQgMCwgdHJ1ZSk7CiAgICAgICAgICAgIGNvbnN0IGkyID0gKCkgPT4gewogICAgICAgICAgICAgIHRoaXMudHNJc1N0YXJ0T2ZTdGF0aWNCbG9ja3MoKSA/ICh0aGlzLm5leHQoKSwgdGhpcy5uZXh0KCksIHRoaXMudHNIYXNTb21lTW9kaWZpZXJzKGUyLCByMikgJiYgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnBvcywgcmQuU3RhdGljQmxvY2tDYW5ub3RIYXZlTW9kaWZpZXIpLCB0aGlzLnBhcnNlQ2xhc3NTdGF0aWNCbG9jayh0MywgZTIpKSA6IHRoaXMucGFyc2VDbGFzc01lbWJlcldpdGhJc1N0YXRpYyh0MywgZTIsIHMyLCAhIWUyLnN0YXRpYyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGUyLmRlY2xhcmUgPyB0aGlzLnRzSW5BbWJpZW50Q29udGV4dChpMikgOiBpMigpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VDbGFzc01lbWJlcldpdGhJc1N0YXRpYyh0MywgZTIsIHMyLCByMikgewogICAgICAgICAgICBjb25zdCBpMiA9IHRoaXMudHNUcnlQYXJzZUluZGV4U2lnbmF0dXJlKGUyKTsKICAgICAgICAgICAgaWYgKGkyKQogICAgICAgICAgICAgIHJldHVybiB0My5ib2R5LnB1c2goaTIpLCBlMi5hYnN0cmFjdCAmJiB0aGlzLnJhaXNlKGUyLnN0YXJ0LCByZC5JbmRleFNpZ25hdHVyZUhhc0Fic3RyYWN0KSwgZTIuYWNjZXNzaWJpbGl0eSAmJiB0aGlzLnJhaXNlKGUyLnN0YXJ0LCByZC5JbmRleFNpZ25hdHVyZUhhc0FjY2Vzc2liaWxpdHksIGUyLmFjY2Vzc2liaWxpdHkpLCBlMi5kZWNsYXJlICYmIHRoaXMucmFpc2UoZTIuc3RhcnQsIHJkLkluZGV4U2lnbmF0dXJlSGFzRGVjbGFyZSksIHZvaWQgKGUyLm92ZXJyaWRlICYmIHRoaXMucmFpc2UoZTIuc3RhcnQsIHJkLkluZGV4U2lnbmF0dXJlSGFzT3ZlcnJpZGUpKTsKICAgICAgICAgICAgIXRoaXMuc3RhdGUuaW5BYnN0cmFjdENsYXNzICYmIGUyLmFic3RyYWN0ICYmIHRoaXMucmFpc2UoZTIuc3RhcnQsIHJkLk5vbkFic3RyYWN0Q2xhc3NIYXNBYnN0cmFjdE1ldGhvZCksIGUyLm92ZXJyaWRlICYmIChzMi5oYWRTdXBlckNsYXNzIHx8IHRoaXMucmFpc2UoZTIuc3RhcnQsIHJkLk92ZXJyaWRlTm90SW5TdWJDbGFzcykpLCBzdXBlci5wYXJzZUNsYXNzTWVtYmVyV2l0aElzU3RhdGljKHQzLCBlMiwgczIsIHIyKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlUG9zdE1lbWJlck5hbWVNb2RpZmllcnModDMpIHsKICAgICAgICAgICAgdGhpcy5lYXQoMTcpICYmICh0My5vcHRpb25hbCA9IHRydWUpLCB0My5yZWFkb25seSAmJiB0aGlzLm1hdGNoKDEwKSAmJiB0aGlzLnJhaXNlKHQzLnN0YXJ0LCByZC5DbGFzc01ldGhvZEhhc1JlYWRvbmx5KSwgdDMuZGVjbGFyZSAmJiB0aGlzLm1hdGNoKDEwKSAmJiB0aGlzLnJhaXNlKHQzLnN0YXJ0LCByZC5DbGFzc01ldGhvZEhhc0RlY2xhcmUpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHByZXNzaW9uU3RhdGVtZW50KHQzLCBlMikgewogICAgICAgICAgICByZXR1cm4gKGUyLnR5cGUgPT09ICJJZGVudGlmaWVyIiA/IHRoaXMudHNQYXJzZUV4cHJlc3Npb25TdGF0ZW1lbnQodDMsIGUyKSA6IHZvaWQgMCkgfHwgc3VwZXIucGFyc2VFeHByZXNzaW9uU3RhdGVtZW50KHQzLCBlMik7CiAgICAgICAgICB9CiAgICAgICAgICBzaG91bGRQYXJzZUV4cG9ydERlY2xhcmF0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLnRzSXNEZWNsYXJhdGlvblN0YXJ0KCkgfHwgc3VwZXIuc2hvdWxkUGFyc2VFeHBvcnREZWNsYXJhdGlvbigpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VDb25kaXRpb25hbCh0MywgZTIsIHMyLCByMikgewogICAgICAgICAgICBpZiAoIXRoaXMuc3RhdGUubWF5YmVJbkFycm93UGFyYW1ldGVycyB8fCAhdGhpcy5tYXRjaCgxNykpCiAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnBhcnNlQ29uZGl0aW9uYWwodDMsIGUyLCBzMiwgcjIpOwogICAgICAgICAgICBjb25zdCBpMiA9IHRoaXMudHJ5UGFyc2UoKCkgPT4gc3VwZXIucGFyc2VDb25kaXRpb25hbCh0MywgZTIsIHMyKSk7CiAgICAgICAgICAgIHJldHVybiBpMi5ub2RlID8gKGkyLmVycm9yICYmICh0aGlzLnN0YXRlID0gaTIuZmFpbFN0YXRlKSwgaTIubm9kZSkgOiAoaTIuZXJyb3IgJiYgc3VwZXIuc2V0T3B0aW9uYWxQYXJhbWV0ZXJzRXJyb3IocjIsIGkyLmVycm9yKSwgdDMpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VQYXJlbkl0ZW0odDMsIGUyLCBzMikgewogICAgICAgICAgICBpZiAodDMgPSBzdXBlci5wYXJzZVBhcmVuSXRlbSh0MywgZTIsIHMyKSwgdGhpcy5lYXQoMTcpICYmICh0My5vcHRpb25hbCA9IHRydWUsIHRoaXMucmVzZXRFbmRMb2NhdGlvbih0MykpLCB0aGlzLm1hdGNoKDE0KSkgewogICAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGFydE5vZGVBdChlMiwgczIpOwogICAgICAgICAgICAgIHJldHVybiByMi5leHByZXNzaW9uID0gdDMsIHIyLnR5cGVBbm5vdGF0aW9uID0gdGhpcy50c1BhcnNlVHlwZUFubm90YXRpb24oKSwgdGhpcy5maW5pc2hOb2RlKHIyLCAiVFNUeXBlQ2FzdEV4cHJlc3Npb24iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUV4cG9ydERlY2xhcmF0aW9uKHQzKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGF0ZS5zdGFydCwgczIgPSB0aGlzLnN0YXRlLnN0YXJ0TG9jLCByMiA9IHRoaXMuZWF0Q29udGV4dHVhbCgxMTUpOwogICAgICAgICAgICBpZiAocjIgJiYgKHRoaXMuaXNDb250ZXh0dWFsKDExNSkgfHwgIXRoaXMuc2hvdWxkUGFyc2VFeHBvcnREZWNsYXJhdGlvbigpKSkKICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIHJkLkV4cGVjdGVkQW1iaWVudEFmdGVyRXhwb3J0RGVjbGFyZSk7CiAgICAgICAgICAgIGxldCBpMjsKICAgICAgICAgICAgcmV0dXJuIFVjKHRoaXMuc3RhdGUudHlwZSkgJiYgKGkyID0gdGhpcy50c1RyeVBhcnNlRXhwb3J0RGVjbGFyYXRpb24oKSksIGkyIHx8IChpMiA9IHN1cGVyLnBhcnNlRXhwb3J0RGVjbGFyYXRpb24odDMpKSwgaTIgJiYgKGkyLnR5cGUgPT09ICJUU0ludGVyZmFjZURlY2xhcmF0aW9uIiB8fCBpMi50eXBlID09PSAiVFNUeXBlQWxpYXNEZWNsYXJhdGlvbiIgfHwgcjIpICYmICh0My5leHBvcnRLaW5kID0gInR5cGUiKSwgaTIgJiYgcjIgJiYgKHRoaXMucmVzZXRTdGFydExvY2F0aW9uKGkyLCBlMiwgczIpLCBpMi5kZWNsYXJlID0gdHJ1ZSksIGkyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VDbGFzc0lkKHQzLCBlMiwgczIpIHsKICAgICAgICAgICAgaWYgKCghZTIgfHwgczIpICYmIHRoaXMuaXNDb250ZXh0dWFsKDEwNCkpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBzdXBlci5wYXJzZUNsYXNzSWQodDMsIGUyLCBzMiwgdDMuZGVjbGFyZSA/IDEwMjQgOiAxMzkpOwogICAgICAgICAgICBjb25zdCByMiA9IHRoaXMudHNUcnlQYXJzZVR5cGVQYXJhbWV0ZXJzKCk7CiAgICAgICAgICAgIHIyICYmICh0My50eXBlUGFyYW1ldGVycyA9IHIyKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3NQcm9wZXJ0eUFubm90YXRpb24odDMpIHsKICAgICAgICAgICAgIXQzLm9wdGlvbmFsICYmIHRoaXMuZWF0KDMzKSAmJiAodDMuZGVmaW5pdGUgPSB0cnVlKTsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnRzVHJ5UGFyc2VUeXBlQW5ub3RhdGlvbigpOwogICAgICAgICAgICBlMiAmJiAodDMudHlwZUFubm90YXRpb24gPSBlMik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNsYXNzUHJvcGVydHkodDMpIHsKICAgICAgICAgICAgaWYgKHRoaXMucGFyc2VDbGFzc1Byb3BlcnR5QW5ub3RhdGlvbih0MyksIHRoaXMuc3RhdGUuaXNBbWJpZW50Q29udGV4dCAmJiB0aGlzLm1hdGNoKDI3KSAmJiB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIHJkLkRlY2xhcmVDbGFzc0ZpZWxkSGFzSW5pdGlhbGl6ZXIpLCB0My5hYnN0cmFjdCAmJiB0aGlzLm1hdGNoKDI3KSkgewogICAgICAgICAgICAgIGNvbnN0IHsga2V5OiBlMiB9ID0gdDM7CiAgICAgICAgICAgICAgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0LCByZC5BYnN0cmFjdFByb3BlcnR5SGFzSW5pdGlhbGl6ZXIsIGUyLnR5cGUgIT09ICJJZGVudGlmaWVyIiB8fCB0My5jb21wdXRlZCA/ICJbIi5jb25jYXQodGhpcy5pbnB1dC5zbGljZShlMi5zdGFydCwgZTIuZW5kKSwgIl0iKSA6IGUyLm5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdXBlci5wYXJzZUNsYXNzUHJvcGVydHkodDMpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VDbGFzc1ByaXZhdGVQcm9wZXJ0eSh0MykgewogICAgICAgICAgICByZXR1cm4gdDMuYWJzdHJhY3QgJiYgdGhpcy5yYWlzZSh0My5zdGFydCwgcmQuUHJpdmF0ZUVsZW1lbnRIYXNBYnN0cmFjdCksIHQzLmFjY2Vzc2liaWxpdHkgJiYgdGhpcy5yYWlzZSh0My5zdGFydCwgcmQuUHJpdmF0ZUVsZW1lbnRIYXNBY2Nlc3NpYmlsaXR5LCB0My5hY2Nlc3NpYmlsaXR5KSwgdGhpcy5wYXJzZUNsYXNzUHJvcGVydHlBbm5vdGF0aW9uKHQzKSwgc3VwZXIucGFyc2VDbGFzc1ByaXZhdGVQcm9wZXJ0eSh0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBwdXNoQ2xhc3NNZXRob2QodDMsIGUyLCBzMiwgcjIsIGkyLCBuMikgewogICAgICAgICAgICBjb25zdCBhMiA9IHRoaXMudHNUcnlQYXJzZVR5cGVQYXJhbWV0ZXJzKCk7CiAgICAgICAgICAgIGEyICYmIGkyICYmIHRoaXMucmFpc2UoYTIuc3RhcnQsIHJkLkNvbnN0cnVjdG9ySGFzVHlwZVBhcmFtZXRlcnMpLCAhZTIuZGVjbGFyZSB8fCBlMi5raW5kICE9PSAiZ2V0IiAmJiBlMi5raW5kICE9PSAic2V0IiB8fCB0aGlzLnJhaXNlKGUyLnN0YXJ0LCByZC5EZWNsYXJlQWNjZXNzb3IsIGUyLmtpbmQpLCBhMiAmJiAoZTIudHlwZVBhcmFtZXRlcnMgPSBhMiksIHN1cGVyLnB1c2hDbGFzc01ldGhvZCh0MywgZTIsIHMyLCByMiwgaTIsIG4yKTsKICAgICAgICAgIH0KICAgICAgICAgIHB1c2hDbGFzc1ByaXZhdGVNZXRob2QodDMsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLnRzVHJ5UGFyc2VUeXBlUGFyYW1ldGVycygpOwogICAgICAgICAgICBpMiAmJiAoZTIudHlwZVBhcmFtZXRlcnMgPSBpMiksIHN1cGVyLnB1c2hDbGFzc1ByaXZhdGVNZXRob2QodDMsIGUyLCBzMiwgcjIpOwogICAgICAgICAgfQogICAgICAgICAgZGVjbGFyZUNsYXNzUHJpdmF0ZU1ldGhvZEluU2NvcGUodDMsIGUyKSB7CiAgICAgICAgICAgIHQzLnR5cGUgIT09ICJUU0RlY2xhcmVNZXRob2QiICYmICh0My50eXBlICE9PSAiTWV0aG9kRGVmaW5pdGlvbiIgfHwgdDMudmFsdWUuYm9keSkgJiYgc3VwZXIuZGVjbGFyZUNsYXNzUHJpdmF0ZU1ldGhvZEluU2NvcGUodDMsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3NTdXBlcih0MykgewogICAgICAgICAgICBzdXBlci5wYXJzZUNsYXNzU3VwZXIodDMpLCB0My5zdXBlckNsYXNzICYmIHRoaXMubWF0Y2goNDMpICYmICh0My5zdXBlclR5cGVQYXJhbWV0ZXJzID0gdGhpcy50c1BhcnNlVHlwZUFyZ3VtZW50cygpKSwgdGhpcy5lYXRDb250ZXh0dWFsKDEwNCkgJiYgKHQzLmltcGxlbWVudHMgPSB0aGlzLnRzUGFyc2VIZXJpdGFnZUNsYXVzZSgiaW1wbGVtZW50cyIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlT2JqUHJvcFZhbHVlKHQzKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy50c1RyeVBhcnNlVHlwZVBhcmFtZXRlcnMoKTsKICAgICAgICAgICAgZTIgJiYgKHQzLnR5cGVQYXJhbWV0ZXJzID0gZTIpOwogICAgICAgICAgICBmb3IgKHZhciBzMiA9IGFyZ3VtZW50cy5sZW5ndGgsIHIyID0gbmV3IEFycmF5KHMyID4gMSA/IHMyIC0gMSA6IDApLCBpMiA9IDE7IGkyIDwgczI7IGkyKyspCiAgICAgICAgICAgICAgcjJbaTIgLSAxXSA9IGFyZ3VtZW50c1tpMl07CiAgICAgICAgICAgIHN1cGVyLnBhcnNlT2JqUHJvcFZhbHVlKHQzLCAuLi5yMik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUZ1bmN0aW9uUGFyYW1zKHQzLCBlMikgewogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMudHNUcnlQYXJzZVR5cGVQYXJhbWV0ZXJzKCk7CiAgICAgICAgICAgIHMyICYmICh0My50eXBlUGFyYW1ldGVycyA9IHMyKSwgc3VwZXIucGFyc2VGdW5jdGlvblBhcmFtcyh0MywgZTIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VWYXJJZCh0MywgZTIpIHsKICAgICAgICAgICAgc3VwZXIucGFyc2VWYXJJZCh0MywgZTIpLCB0My5pZC50eXBlID09PSAiSWRlbnRpZmllciIgJiYgdGhpcy5lYXQoMzMpICYmICh0My5kZWZpbml0ZSA9IHRydWUpOwogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMudHNUcnlQYXJzZVR5cGVBbm5vdGF0aW9uKCk7CiAgICAgICAgICAgIHMyICYmICh0My5pZC50eXBlQW5ub3RhdGlvbiA9IHMyLCB0aGlzLnJlc2V0RW5kTG9jYXRpb24odDMuaWQpKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQXN5bmNBcnJvd0Zyb21DYWxsRXhwcmVzc2lvbih0MywgZTIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goMTQpICYmICh0My5yZXR1cm5UeXBlID0gdGhpcy50c1BhcnNlVHlwZUFubm90YXRpb24oKSksIHN1cGVyLnBhcnNlQXN5bmNBcnJvd0Zyb21DYWxsRXhwcmVzc2lvbih0MywgZTIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VNYXliZUFzc2lnbigpIHsKICAgICAgICAgICAgZm9yICh2YXIgdDMgPSBhcmd1bWVudHMubGVuZ3RoLCBlMiA9IG5ldyBBcnJheSh0MyksIHMyID0gMDsgczIgPCB0MzsgczIrKykKICAgICAgICAgICAgICBlMltzMl0gPSBhcmd1bWVudHNbczJdOwogICAgICAgICAgICB2YXIgcjIsIGkyLCBuMiwgYTIsIG8yLCB1MiwgaDI7CiAgICAgICAgICAgIGxldCBwMiwgYzIsIGwyLCBkMjsKICAgICAgICAgICAgaWYgKHRoaXMuaGFzUGx1Z2luKCJqc3giKSAmJiAodGhpcy5tYXRjaCgxMzIpIHx8IHRoaXMubWF0Y2goNDMpKSkgewogICAgICAgICAgICAgIGlmIChwMiA9IHRoaXMuc3RhdGUuY2xvbmUoKSwgYzIgPSB0aGlzLnRyeVBhcnNlKCgpID0+IHN1cGVyLnBhcnNlTWF5YmVBc3NpZ24oLi4uZTIpLCBwMiksICFjMi5lcnJvcikKICAgICAgICAgICAgICAgIHJldHVybiBjMi5ub2RlOwogICAgICAgICAgICAgIGNvbnN0IHsgY29udGV4dDogdDQgfSA9IHRoaXMuc3RhdGU7CiAgICAgICAgICAgICAgdDRbdDQubGVuZ3RoIC0gMV0gPT09IEFjLmpfb1RhZyA/IHQ0Lmxlbmd0aCAtPSAyIDogdDRbdDQubGVuZ3RoIC0gMV0gPT09IEFjLmpfZXhwciAmJiAodDQubGVuZ3RoIC09IDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghKChyMiA9IGMyKSAhPSBudWxsICYmIHIyLmVycm9yIHx8IHRoaXMubWF0Y2goNDMpKSkKICAgICAgICAgICAgICByZXR1cm4gc3VwZXIucGFyc2VNYXliZUFzc2lnbiguLi5lMik7CiAgICAgICAgICAgIHAyID0gcDIgfHwgdGhpcy5zdGF0ZS5jbG9uZSgpOwogICAgICAgICAgICBjb25zdCBEMiA9IHRoaXMudHJ5UGFyc2UoKHQ0KSA9PiB7CiAgICAgICAgICAgICAgdmFyIHMzLCByMzsKICAgICAgICAgICAgICBkMiA9IHRoaXMudHNQYXJzZVR5cGVQYXJhbWV0ZXJzKCk7CiAgICAgICAgICAgICAgY29uc3QgaTMgPSBzdXBlci5wYXJzZU1heWJlQXNzaWduKC4uLmUyKTsKICAgICAgICAgICAgICByZXR1cm4gKGkzLnR5cGUgIT09ICJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiIgfHwgKHMzID0gaTMuZXh0cmEpICE9IG51bGwgJiYgczMucGFyZW50aGVzaXplZCkgJiYgdDQoKSwgKChyMyA9IGQyKSA9PSBudWxsID8gdm9pZCAwIDogcjMucGFyYW1zLmxlbmd0aCkgIT09IDAgJiYgdGhpcy5yZXNldFN0YXJ0TG9jYXRpb25Gcm9tTm9kZShpMywgZDIpLCBpMy50eXBlUGFyYW1ldGVycyA9IGQyLCBpMzsKICAgICAgICAgICAgfSwgcDIpOwogICAgICAgICAgICBpZiAoIUQyLmVycm9yICYmICFEMi5hYm9ydGVkKQogICAgICAgICAgICAgIHJldHVybiBkMiAmJiB0aGlzLnJlcG9ydFJlc2VydmVkQXJyb3dUeXBlUGFyYW0oZDIpLCBEMi5ub2RlOwogICAgICAgICAgICBpZiAoIWMyICYmIChzZCghdGhpcy5oYXNQbHVnaW4oImpzeCIpKSwgbDIgPSB0aGlzLnRyeVBhcnNlKCgpID0+IHN1cGVyLnBhcnNlTWF5YmVBc3NpZ24oLi4uZTIpLCBwMiksICFsMi5lcnJvcikpCiAgICAgICAgICAgICAgcmV0dXJuIGwyLm5vZGU7CiAgICAgICAgICAgIGlmICgoaTIgPSBjMikgIT0gbnVsbCAmJiBpMi5ub2RlKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlID0gYzIuZmFpbFN0YXRlLCBjMi5ub2RlOwogICAgICAgICAgICBpZiAoRDIubm9kZSkKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZSA9IEQyLmZhaWxTdGF0ZSwgZDIgJiYgdGhpcy5yZXBvcnRSZXNlcnZlZEFycm93VHlwZVBhcmFtKGQyKSwgRDIubm9kZTsKICAgICAgICAgICAgaWYgKChuMiA9IGwyKSAhPSBudWxsICYmIG4yLm5vZGUpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUgPSBsMi5mYWlsU3RhdGUsIGwyLm5vZGU7CiAgICAgICAgICAgIGlmICgoYTIgPSBjMikgIT0gbnVsbCAmJiBhMi50aHJvd24pCiAgICAgICAgICAgICAgdGhyb3cgYzIuZXJyb3I7CiAgICAgICAgICAgIGlmIChEMi50aHJvd24pCiAgICAgICAgICAgICAgdGhyb3cgRDIuZXJyb3I7CiAgICAgICAgICAgIGlmICgobzIgPSBsMikgIT0gbnVsbCAmJiBvMi50aHJvd24pCiAgICAgICAgICAgICAgdGhyb3cgbDIuZXJyb3I7CiAgICAgICAgICAgIHRocm93ICgodTIgPSBjMikgPT0gbnVsbCA/IHZvaWQgMCA6IHUyLmVycm9yKSB8fCBEMi5lcnJvciB8fCAoKGgyID0gbDIpID09IG51bGwgPyB2b2lkIDAgOiBoMi5lcnJvcik7CiAgICAgICAgICB9CiAgICAgICAgICByZXBvcnRSZXNlcnZlZEFycm93VHlwZVBhcmFtKHQzKSB7CiAgICAgICAgICAgIHZhciBlMjsKICAgICAgICAgICAgdDMucGFyYW1zLmxlbmd0aCAhPT0gMSB8fCAoZTIgPSB0My5leHRyYSkgIT0gbnVsbCAmJiBlMi50cmFpbGluZ0NvbW1hIHx8ICF0aGlzLmdldFBsdWdpbk9wdGlvbigidHlwZXNjcmlwdCIsICJkaXNhbGxvd0FtYmlndW91c0pTWExpa2UiKSB8fCB0aGlzLnJhaXNlKHQzLnN0YXJ0LCByZC5SZXNlcnZlZEFycm93VHlwZVBhcmFtKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlTWF5YmVVbmFyeSh0MykgewogICAgICAgICAgICByZXR1cm4gIXRoaXMuaGFzUGx1Z2luKCJqc3giKSAmJiB0aGlzLm1hdGNoKDQzKSA/IHRoaXMudHNQYXJzZVR5cGVBc3NlcnRpb24oKSA6IHN1cGVyLnBhcnNlTWF5YmVVbmFyeSh0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUFycm93KHQzKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDE0KSkgewogICAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy50cnlQYXJzZSgodDQpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy50c1BhcnNlVHlwZU9yVHlwZVByZWRpY2F0ZUFubm90YXRpb24oMTQpOwogICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLmNhbkluc2VydFNlbWljb2xvbigpICYmIHRoaXMubWF0Y2goMTkpIHx8IHQ0KCksIGUzOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGlmIChlMi5hYm9ydGVkKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIGUyLnRocm93biB8fCAoZTIuZXJyb3IgJiYgKHRoaXMuc3RhdGUgPSBlMi5mYWlsU3RhdGUpLCB0My5yZXR1cm5UeXBlID0gZTIubm9kZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnBhcnNlQXJyb3codDMpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VBc3NpZ25hYmxlTGlzdEl0ZW1UeXBlcyh0MykgewogICAgICAgICAgICB0aGlzLmVhdCgxNykgJiYgKHQzLnR5cGUgPT09ICJJZGVudGlmaWVyIiB8fCB0aGlzLnN0YXRlLmlzQW1iaWVudENvbnRleHQgfHwgdGhpcy5zdGF0ZS5pblR5cGUgfHwgdGhpcy5yYWlzZSh0My5zdGFydCwgcmQuUGF0dGVybklzT3B0aW9uYWwpLCB0My5vcHRpb25hbCA9IHRydWUpOwogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMudHNUcnlQYXJzZVR5cGVBbm5vdGF0aW9uKCk7CiAgICAgICAgICAgIHJldHVybiBlMiAmJiAodDMudHlwZUFubm90YXRpb24gPSBlMiksIHRoaXMucmVzZXRFbmRMb2NhdGlvbih0MyksIHQzOwogICAgICAgICAgfQogICAgICAgICAgaXNBc3NpZ25hYmxlKHQzLCBlMikgewogICAgICAgICAgICBzd2l0Y2ggKHQzLnR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICJUU1R5cGVDYXN0RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc0Fzc2lnbmFibGUodDMuZXhwcmVzc2lvbiwgZTIpOwogICAgICAgICAgICAgIGNhc2UgIlRTUGFyYW1ldGVyUHJvcGVydHkiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5pc0Fzc2lnbmFibGUodDMsIGUyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdG9Bc3NpZ25hYmxlKHQzKSB7CiAgICAgICAgICAgIGxldCBlMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwICYmIGFyZ3VtZW50c1sxXTsKICAgICAgICAgICAgc3dpdGNoICh0My50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiVFNUeXBlQ2FzdEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnRvQXNzaWduYWJsZSh0aGlzLnR5cGVDYXN0VG9QYXJhbWV0ZXIodDMpLCBlMik7CiAgICAgICAgICAgICAgY2FzZSAiVFNQYXJhbWV0ZXJQcm9wZXJ0eSI6CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci50b0Fzc2lnbmFibGUodDMsIGUyKTsKICAgICAgICAgICAgICBjYXNlICJQYXJlbnRoZXNpemVkRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50b0Fzc2lnbmFibGVQYXJlbnRoZXNpemVkRXhwcmVzc2lvbih0MywgZTIpOwogICAgICAgICAgICAgIGNhc2UgIlRTQXNFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJUU05vbk51bGxFeHByZXNzaW9uIjoKICAgICAgICAgICAgICBjYXNlICJUU1R5cGVBc3NlcnRpb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIHQzLmV4cHJlc3Npb24gPSB0aGlzLnRvQXNzaWduYWJsZSh0My5leHByZXNzaW9uLCBlMiksIHQzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0b0Fzc2lnbmFibGVQYXJlbnRoZXNpemVkRXhwcmVzc2lvbih0MywgZTIpIHsKICAgICAgICAgICAgc3dpdGNoICh0My5leHByZXNzaW9uLnR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICJUU0FzRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiVFNOb25OdWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiVFNUeXBlQXNzZXJ0aW9uIjoKICAgICAgICAgICAgICBjYXNlICJQYXJlbnRoZXNpemVkRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdDMuZXhwcmVzc2lvbiA9IHRoaXMudG9Bc3NpZ25hYmxlKHQzLmV4cHJlc3Npb24sIGUyKSwgdDM7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci50b0Fzc2lnbmFibGUodDMsIGUyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY2hlY2tMVmFsKHQzLCBlMikgewogICAgICAgICAgICBmb3IgKHZhciBzMiwgcjIgPSBhcmd1bWVudHMubGVuZ3RoLCBpMiA9IG5ldyBBcnJheShyMiA+IDIgPyByMiAtIDIgOiAwKSwgbjIgPSAyOyBuMiA8IHIyOyBuMisrKQogICAgICAgICAgICAgIGkyW24yIC0gMl0gPSBhcmd1bWVudHNbbjJdOwogICAgICAgICAgICBzd2l0Y2ggKHQzLnR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICJUU1R5cGVDYXN0RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgY2FzZSAiVFNQYXJhbWV0ZXJQcm9wZXJ0eSI6CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB0aGlzLmNoZWNrTFZhbCh0My5wYXJhbWV0ZXIsICJwYXJhbWV0ZXIgcHJvcGVydHkiLCAuLi5pMik7CiAgICAgICAgICAgICAgY2FzZSAiVFNBc0V4cHJlc3Npb24iOgogICAgICAgICAgICAgIGNhc2UgIlRTVHlwZUFzc2VydGlvbiI6CiAgICAgICAgICAgICAgICBpZiAoIShpMlswXSB8fCBlMiA9PT0gInBhcmVudGhlc2l6ZWQgZXhwcmVzc2lvbiIgfHwgKHMyID0gdDMuZXh0cmEpICE9IG51bGwgJiYgczIucGFyZW50aGVzaXplZCkpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5yYWlzZSh0My5zdGFydCwgRGMuSW52YWxpZExocywgZTIpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMuY2hlY2tMVmFsKHQzLmV4cHJlc3Npb24sICJwYXJlbnRoZXNpemVkIGV4cHJlc3Npb24iLCAuLi5pMik7CiAgICAgICAgICAgICAgY2FzZSAiVFNOb25OdWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB0aGlzLmNoZWNrTFZhbCh0My5leHByZXNzaW9uLCBlMiwgLi4uaTIpOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCBzdXBlci5jaGVja0xWYWwodDMsIGUyLCAuLi5pMik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQmluZGluZ0F0b20oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnR5cGUgPT09IDcyID8gdGhpcy5wYXJzZUlkZW50aWZpZXIodHJ1ZSkgOiBzdXBlci5wYXJzZUJpbmRpbmdBdG9tKCk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU1heWJlRGVjb3JhdG9yQXJndW1lbnRzKHQzKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDQzKSkgewogICAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy50c1BhcnNlVHlwZUFyZ3VtZW50cygpOwogICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDEwKSkgewogICAgICAgICAgICAgICAgY29uc3QgczIgPSBzdXBlci5wYXJzZU1heWJlRGVjb3JhdG9yQXJndW1lbnRzKHQzKTsKICAgICAgICAgICAgICAgIHJldHVybiBzMi50eXBlUGFyYW1ldGVycyA9IGUyLCBzMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy51bmV4cGVjdGVkKHRoaXMuc3RhdGUuc3RhcnQsIDEwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc3VwZXIucGFyc2VNYXliZURlY29yYXRvckFyZ3VtZW50cyh0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0NvbW1hQWZ0ZXJSZXN0KHQzKSB7CiAgICAgICAgICAgIHRoaXMuc3RhdGUuaXNBbWJpZW50Q29udGV4dCAmJiB0aGlzLm1hdGNoKDEyKSAmJiB0aGlzLmxvb2thaGVhZENoYXJDb2RlKCkgPT09IHQzID8gdGhpcy5uZXh0KCkgOiBzdXBlci5jaGVja0NvbW1hQWZ0ZXJSZXN0KHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIGlzQ2xhc3NNZXRob2QoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDQzKSB8fCBzdXBlci5pc0NsYXNzTWV0aG9kKCk7CiAgICAgICAgICB9CiAgICAgICAgICBpc0NsYXNzUHJvcGVydHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDMzKSB8fCB0aGlzLm1hdGNoKDE0KSB8fCBzdXBlci5pc0NsYXNzUHJvcGVydHkoKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlTWF5YmVEZWZhdWx0KCkgewogICAgICAgICAgICBjb25zdCB0MyA9IHN1cGVyLnBhcnNlTWF5YmVEZWZhdWx0KC4uLmFyZ3VtZW50cyk7CiAgICAgICAgICAgIHJldHVybiB0My50eXBlID09PSAiQXNzaWdubWVudFBhdHRlcm4iICYmIHQzLnR5cGVBbm5vdGF0aW9uICYmIHQzLnJpZ2h0LnN0YXJ0IDwgdDMudHlwZUFubm90YXRpb24uc3RhcnQgJiYgdGhpcy5yYWlzZSh0My50eXBlQW5ub3RhdGlvbi5zdGFydCwgcmQuVHlwZUFubm90YXRpb25BZnRlckFzc2lnbiksIHQzOwogICAgICAgICAgfQogICAgICAgICAgZ2V0VG9rZW5Gcm9tQ29kZSh0MykgewogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5pblR5cGUpIHsKICAgICAgICAgICAgICBpZiAodDMgPT09IDYyKQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmluaXNoT3AoNDQsIDEpOwogICAgICAgICAgICAgIGlmICh0MyA9PT0gNjApCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maW5pc2hPcCg0MywgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFRva2VuRnJvbUNvZGUodDMpOwogICAgICAgICAgfQogICAgICAgICAgcmVTY2FuX2x0X2d0KCkgewogICAgICAgICAgICBjb25zdCB7IHR5cGU6IHQzIH0gPSB0aGlzLnN0YXRlOwogICAgICAgICAgICB0MyA9PT0gNDMgPyAodGhpcy5zdGF0ZS5wb3MgLT0gMSwgdGhpcy5yZWFkVG9rZW5fbHQoKSkgOiB0MyA9PT0gNDQgJiYgKHRoaXMuc3RhdGUucG9zIC09IDEsIHRoaXMucmVhZFRva2VuX2d0KCkpOwogICAgICAgICAgfQogICAgICAgICAgdG9Bc3NpZ25hYmxlTGlzdCh0MykgewogICAgICAgICAgICBmb3IgKGxldCBlMiA9IDA7IGUyIDwgdDMubGVuZ3RoOyBlMisrKSB7CiAgICAgICAgICAgICAgY29uc3QgczIgPSB0M1tlMl07CiAgICAgICAgICAgICAgaWYgKHMyKQogICAgICAgICAgICAgICAgc3dpdGNoIChzMi50eXBlKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgIlRTVHlwZUNhc3RFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgICB0M1tlMl0gPSB0aGlzLnR5cGVDYXN0VG9QYXJhbWV0ZXIoczIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlICJUU0FzRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIGNhc2UgIlRTVHlwZUFzc2VydGlvbiI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5tYXliZUluQXJyb3dQYXJhbWV0ZXJzID8gdGhpcy5yYWlzZShzMi5zdGFydCwgcmQuVW5leHBlY3RlZFR5cGVDYXN0SW5QYXJhbWV0ZXIpIDogdDNbZTJdID0gdGhpcy50eXBlQ2FzdFRvUGFyYW1ldGVyKHMyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc3VwZXIudG9Bc3NpZ25hYmxlTGlzdCguLi5hcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgdHlwZUNhc3RUb1BhcmFtZXRlcih0MykgewogICAgICAgICAgICByZXR1cm4gdDMuZXhwcmVzc2lvbi50eXBlQW5ub3RhdGlvbiA9IHQzLnR5cGVBbm5vdGF0aW9uLCB0aGlzLnJlc2V0RW5kTG9jYXRpb24odDMuZXhwcmVzc2lvbiwgdDMudHlwZUFubm90YXRpb24uZW5kLCB0My50eXBlQW5ub3RhdGlvbi5sb2MuZW5kKSwgdDMuZXhwcmVzc2lvbjsKICAgICAgICAgIH0KICAgICAgICAgIHNob3VsZFBhcnNlQXJyb3codDMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goMTQpID8gdDMuZXZlcnkoKHQ0KSA9PiB0aGlzLmlzQXNzaWduYWJsZSh0NCwgdHJ1ZSkpIDogc3VwZXIuc2hvdWxkUGFyc2VBcnJvdyh0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBzaG91bGRQYXJzZUFzeW5jQXJyb3coKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDE0KSB8fCBzdXBlci5zaG91bGRQYXJzZUFzeW5jQXJyb3coKTsKICAgICAgICAgIH0KICAgICAgICAgIGNhbkhhdmVMZWFkaW5nRGVjb3JhdG9yKCkgewogICAgICAgICAgICByZXR1cm4gc3VwZXIuY2FuSGF2ZUxlYWRpbmdEZWNvcmF0b3IoKSB8fCB0aGlzLmlzQWJzdHJhY3RDbGFzcygpOwogICAgICAgICAgfQogICAgICAgICAganN4UGFyc2VPcGVuaW5nRWxlbWVudEFmdGVyTmFtZSh0MykgewogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCg0MykpIHsKICAgICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMudHNUcnlQYXJzZUFuZENhdGNoKCgpID0+IHRoaXMudHNQYXJzZVR5cGVBcmd1bWVudHMoKSk7CiAgICAgICAgICAgICAgZTIgJiYgKHQzLnR5cGVQYXJhbWV0ZXJzID0gZTIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdXBlci5qc3hQYXJzZU9wZW5pbmdFbGVtZW50QWZ0ZXJOYW1lKHQzKTsKICAgICAgICAgIH0KICAgICAgICAgIGdldEdldHRlclNldHRlckV4cGVjdGVkUGFyYW1Db3VudCh0MykgewogICAgICAgICAgICBjb25zdCBlMiA9IHN1cGVyLmdldEdldHRlclNldHRlckV4cGVjdGVkUGFyYW1Db3VudCh0MyksIHMyID0gdGhpcy5nZXRPYmplY3RPckNsYXNzTWV0aG9kUGFyYW1zKHQzKVswXTsKICAgICAgICAgICAgcmV0dXJuIHMyICYmIHRoaXMuaXNUaGlzUGFyYW0oczIpID8gZTIgKyAxIDogZTI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNhdGNoQ2xhdXNlUGFyYW0oKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gc3VwZXIucGFyc2VDYXRjaENsYXVzZVBhcmFtKCksIGUyID0gdGhpcy50c1RyeVBhcnNlVHlwZUFubm90YXRpb24oKTsKICAgICAgICAgICAgcmV0dXJuIGUyICYmICh0My50eXBlQW5ub3RhdGlvbiA9IGUyLCB0aGlzLnJlc2V0RW5kTG9jYXRpb24odDMpKSwgdDM7CiAgICAgICAgICB9CiAgICAgICAgICB0c0luQW1iaWVudENvbnRleHQodDMpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXRlLmlzQW1iaWVudENvbnRleHQ7CiAgICAgICAgICAgIHRoaXMuc3RhdGUuaXNBbWJpZW50Q29udGV4dCA9IHRydWU7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQzKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5pc0FtYmllbnRDb250ZXh0ID0gZTI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3ModDMpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXRlLmluQWJzdHJhY3RDbGFzczsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5pbkFic3RyYWN0Q2xhc3MgPSAhIXQzLmFic3RyYWN0OwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAodmFyIHMyID0gYXJndW1lbnRzLmxlbmd0aCwgcjIgPSBuZXcgQXJyYXkoczIgPiAxID8gczIgLSAxIDogMCksIGkyID0gMTsgaTIgPCBzMjsgaTIrKykKICAgICAgICAgICAgICAgIHIyW2kyIC0gMV0gPSBhcmd1bWVudHNbaTJdOwogICAgICAgICAgICAgIHJldHVybiBzdXBlci5wYXJzZUNsYXNzKHQzLCAuLi5yMik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5pbkFic3RyYWN0Q2xhc3MgPSBlMjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdHNQYXJzZUFic3RyYWN0RGVjbGFyYXRpb24odDMpIHsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goNzQpKQogICAgICAgICAgICAgIHJldHVybiB0My5hYnN0cmFjdCA9IHRydWUsIHRoaXMucGFyc2VDbGFzcyh0MywgdHJ1ZSwgZmFsc2UpOwogICAgICAgICAgICBpZiAodGhpcy5pc0NvbnRleHR1YWwoMTE5KSkgewogICAgICAgICAgICAgIGlmICghdGhpcy5oYXNGb2xsb3dpbmdMaW5lQnJlYWsoKSkKICAgICAgICAgICAgICAgIHJldHVybiB0My5hYnN0cmFjdCA9IHRydWUsIHRoaXMucmFpc2UodDMuc3RhcnQsIHJkLk5vbkNsYXNzTWV0aG9kUHJvcGVydHlIYXNBYnN0cmFjdE1vZGlmZXIpLCB0aGlzLm5leHQoKSwgdGhpcy50c1BhcnNlSW50ZXJmYWNlRGVjbGFyYXRpb24odDMpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICB0aGlzLnVuZXhwZWN0ZWQobnVsbCwgNzQpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VNZXRob2QoKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gc3VwZXIucGFyc2VNZXRob2QoLi4uYXJndW1lbnRzKTsKICAgICAgICAgICAgaWYgKHQzLmFic3RyYWN0KSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzUGx1Z2luKCJlc3RyZWUiKSA/ICEhdDMudmFsdWUuYm9keSA6ICEhdDMuYm9keSkgewogICAgICAgICAgICAgICAgY29uc3QgeyBrZXk6IGUyIH0gPSB0MzsKICAgICAgICAgICAgICAgIHRoaXMucmFpc2UodDMuc3RhcnQsIHJkLkFic3RyYWN0TWV0aG9kSGFzSW1wbGVtZW50YXRpb24sIGUyLnR5cGUgIT09ICJJZGVudGlmaWVyIiB8fCB0My5jb21wdXRlZCA/ICJbIi5jb25jYXQodGhpcy5pbnB1dC5zbGljZShlMi5zdGFydCwgZTIuZW5kKSwgIl0iKSA6IGUyLm5hbWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9CiAgICAgICAgICB0c1BhcnNlVHlwZVBhcmFtZXRlck5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlSWRlbnRpZmllcigpLm5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICBzaG91bGRQYXJzZUFzQW1iaWVudENvbnRleHQoKSB7CiAgICAgICAgICAgIHJldHVybiAhIXRoaXMuZ2V0UGx1Z2luT3B0aW9uKCJ0eXBlc2NyaXB0IiwgImR0cyIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNob3VsZFBhcnNlQXNBbWJpZW50Q29udGV4dCgpICYmICh0aGlzLnN0YXRlLmlzQW1iaWVudENvbnRleHQgPSB0cnVlKSwgc3VwZXIucGFyc2UoKTsKICAgICAgICAgIH0KICAgICAgICAgIGdldEV4cHJlc3Npb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNob3VsZFBhcnNlQXNBbWJpZW50Q29udGV4dCgpICYmICh0aGlzLnN0YXRlLmlzQW1iaWVudENvbnRleHQgPSB0cnVlKSwgc3VwZXIuZ2V0RXhwcmVzc2lvbigpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHBvcnRTcGVjaWZpZXIodDMsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgcmV0dXJuICFlMiAmJiByMiA/ICh0aGlzLnBhcnNlVHlwZU9ubHlJbXBvcnRFeHBvcnRTcGVjaWZpZXIodDMsIGZhbHNlLCBzMiksIHRoaXMuZmluaXNoTm9kZSh0MywgIkV4cG9ydFNwZWNpZmllciIpKSA6ICh0My5leHBvcnRLaW5kID0gInZhbHVlIiwgc3VwZXIucGFyc2VFeHBvcnRTcGVjaWZpZXIodDMsIGUyLCBzMiwgcjIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlSW1wb3J0U3BlY2lmaWVyKHQzLCBlMiwgczIsIHIyKSB7CiAgICAgICAgICAgIHJldHVybiAhZTIgJiYgcjIgPyAodGhpcy5wYXJzZVR5cGVPbmx5SW1wb3J0RXhwb3J0U3BlY2lmaWVyKHQzLCB0cnVlLCBzMiksIHRoaXMuZmluaXNoTm9kZSh0MywgIkltcG9ydFNwZWNpZmllciIpKSA6ICh0My5pbXBvcnRLaW5kID0gInZhbHVlIiwgc3VwZXIucGFyc2VJbXBvcnRTcGVjaWZpZXIodDMsIGUyLCBzMiwgcjIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlVHlwZU9ubHlJbXBvcnRFeHBvcnRTcGVjaWZpZXIodDMsIGUyLCBzMikgewogICAgICAgICAgICBjb25zdCByMiA9IGUyID8gImltcG9ydGVkIiA6ICJsb2NhbCIsIGkyID0gZTIgPyAibG9jYWwiIDogImV4cG9ydGVkIjsKICAgICAgICAgICAgbGV0IG4yLCBhMiA9IHQzW3IyXSwgbzIgPSBmYWxzZSwgdTIgPSB0cnVlOwogICAgICAgICAgICBjb25zdCBoMiA9IGEyLnN0YXJ0OwogICAgICAgICAgICBpZiAodGhpcy5pc0NvbnRleHR1YWwoODcpKSB7CiAgICAgICAgICAgICAgY29uc3QgdDQgPSB0aGlzLnBhcnNlSWRlbnRpZmllcigpOwogICAgICAgICAgICAgIGlmICh0aGlzLmlzQ29udGV4dHVhbCg4NykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5wYXJzZUlkZW50aWZpZXIoKTsKICAgICAgICAgICAgICAgIF9jKHRoaXMuc3RhdGUudHlwZSkgPyAobzIgPSB0cnVlLCBhMiA9IHQ0LCBuMiA9IHRoaXMucGFyc2VJZGVudGlmaWVyKCksIHUyID0gZmFsc2UpIDogKG4yID0gZTMsIHUyID0gZmFsc2UpOwogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgX2ModGhpcy5zdGF0ZS50eXBlKSA/ICh1MiA9IGZhbHNlLCBuMiA9IHRoaXMucGFyc2VJZGVudGlmaWVyKCkpIDogKG8yID0gdHJ1ZSwgYTIgPSB0NCk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIF9jKHRoaXMuc3RhdGUudHlwZSkgJiYgKG8yID0gdHJ1ZSwgYTIgPSB0aGlzLnBhcnNlSWRlbnRpZmllcigpKTsKICAgICAgICAgICAgbzIgJiYgczIgJiYgdGhpcy5yYWlzZShoMiwgZTIgPyByZC5UeXBlTW9kaWZpZXJJc1VzZWRJblR5cGVJbXBvcnRzIDogcmQuVHlwZU1vZGlmaWVySXNVc2VkSW5UeXBlRXhwb3J0cyksIHQzW3IyXSA9IGEyLCB0M1tpMl0gPSBuMjsKICAgICAgICAgICAgdDNbZTIgPyAiaW1wb3J0S2luZCIgOiAiZXhwb3J0S2luZCJdID0gbzIgPyAidHlwZSIgOiAidmFsdWUiLCB1MiAmJiB0aGlzLmVhdENvbnRleHR1YWwoODcpICYmICh0M1tpMl0gPSBlMiA/IHRoaXMucGFyc2VJZGVudGlmaWVyKCkgOiB0aGlzLnBhcnNlTW9kdWxlRXhwb3J0TmFtZSgpKSwgdDNbaTJdIHx8ICh0M1tpMl0gPSBfbCh0M1tyMl0pKSwgZTIgJiYgdGhpcy5jaGVja0xWYWwodDNbaTJdLCAiaW1wb3J0IHNwZWNpZmllciIsIDkpOwogICAgICAgICAgfQogICAgICAgIH0sIHY4aW50cmluc2ljOiAodDIpID0+IGNsYXNzIGV4dGVuZHMgdDIgewogICAgICAgICAgcGFyc2VWOEludHJpbnNpYygpIHsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goNDgpKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXRlLnN0YXJ0LCBlMiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgICAgaWYgKHRoaXMubmV4dCgpLCBVYyh0aGlzLnN0YXRlLnR5cGUpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0NCA9IHRoaXMucGFyc2VJZGVudGlmaWVyTmFtZSh0aGlzLnN0YXRlLnN0YXJ0KSwgczIgPSB0aGlzLmNyZWF0ZUlkZW50aWZpZXIoZTIsIHQ0KTsKICAgICAgICAgICAgICAgIGlmIChzMi50eXBlID0gIlY4SW50cmluc2ljSWRlbnRpZmllciIsIHRoaXMubWF0Y2goMTApKQogICAgICAgICAgICAgICAgICByZXR1cm4gczI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMudW5leHBlY3RlZCh0Myk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRXhwckF0b20oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlVjhJbnRyaW5zaWMoKSB8fCBzdXBlci5wYXJzZUV4cHJBdG9tKC4uLmFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgfSwgcGxhY2Vob2xkZXJzOiAodDIpID0+IGNsYXNzIGV4dGVuZHMgdDIgewogICAgICAgICAgcGFyc2VQbGFjZWhvbGRlcih0MykgewogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCgxMzQpKSB7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5hc3NlcnROb1NwYWNlKCJVbmV4cGVjdGVkIHNwYWNlIGluIHBsYWNlaG9sZGVyLiIpLCBlMi5uYW1lID0gc3VwZXIucGFyc2VJZGVudGlmaWVyKHRydWUpLCB0aGlzLmFzc2VydE5vU3BhY2UoIlVuZXhwZWN0ZWQgc3BhY2UgaW4gcGxhY2Vob2xkZXIuIiksIHRoaXMuZXhwZWN0KDEzNCksIHRoaXMuZmluaXNoUGxhY2Vob2xkZXIoZTIsIHQzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZmluaXNoUGxhY2Vob2xkZXIodDMsIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gISghdDMuZXhwZWN0ZWROb2RlIHx8IHQzLnR5cGUgIT09ICJQbGFjZWhvbGRlciIpOwogICAgICAgICAgICByZXR1cm4gdDMuZXhwZWN0ZWROb2RlID0gZTIsIHMyID8gdDMgOiB0aGlzLmZpbmlzaE5vZGUodDMsICJQbGFjZWhvbGRlciIpOwogICAgICAgICAgfQogICAgICAgICAgZ2V0VG9rZW5Gcm9tQ29kZSh0MykgewogICAgICAgICAgICByZXR1cm4gdDMgPT09IDM3ICYmIHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyArIDEpID09PSAzNyA/IHRoaXMuZmluaXNoT3AoMTM0LCAyKSA6IHN1cGVyLmdldFRva2VuRnJvbUNvZGUoLi4uYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRXhwckF0b20oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlUGxhY2Vob2xkZXIoIkV4cHJlc3Npb24iKSB8fCBzdXBlci5wYXJzZUV4cHJBdG9tKC4uLmFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUlkZW50aWZpZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlUGxhY2Vob2xkZXIoIklkZW50aWZpZXIiKSB8fCBzdXBlci5wYXJzZUlkZW50aWZpZXIoLi4uYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIGNoZWNrUmVzZXJ2ZWRXb3JkKHQzKSB7CiAgICAgICAgICAgIHQzICE9PSB2b2lkIDAgJiYgc3VwZXIuY2hlY2tSZXNlcnZlZFdvcmQoLi4uYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQmluZGluZ0F0b20oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlUGxhY2Vob2xkZXIoIlBhdHRlcm4iKSB8fCBzdXBlci5wYXJzZUJpbmRpbmdBdG9tKC4uLmFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0xWYWwodDMpIHsKICAgICAgICAgICAgdDMudHlwZSAhPT0gIlBsYWNlaG9sZGVyIiAmJiBzdXBlci5jaGVja0xWYWwoLi4uYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHRvQXNzaWduYWJsZSh0MykgewogICAgICAgICAgICByZXR1cm4gdDMgJiYgdDMudHlwZSA9PT0gIlBsYWNlaG9sZGVyIiAmJiB0My5leHBlY3RlZE5vZGUgPT09ICJFeHByZXNzaW9uIiA/ICh0My5leHBlY3RlZE5vZGUgPSAiUGF0dGVybiIsIHQzKSA6IHN1cGVyLnRvQXNzaWduYWJsZSguLi5hcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgaXNMZXQodDMpIHsKICAgICAgICAgICAgaWYgKHN1cGVyLmlzTGV0KHQzKSkKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKCF0aGlzLmlzQ29udGV4dHVhbCg5MykpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAodDMpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdGhpcy5sb29rYWhlYWQoKS50eXBlID09PSAxMzQ7CiAgICAgICAgICB9CiAgICAgICAgICB2ZXJpZnlCcmVha0NvbnRpbnVlKHQzKSB7CiAgICAgICAgICAgIHQzLmxhYmVsICYmIHQzLmxhYmVsLnR5cGUgPT09ICJQbGFjZWhvbGRlciIgfHwgc3VwZXIudmVyaWZ5QnJlYWtDb250aW51ZSguLi5hcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHByZXNzaW9uU3RhdGVtZW50KHQzLCBlMikgewogICAgICAgICAgICBpZiAoZTIudHlwZSAhPT0gIlBsYWNlaG9sZGVyIiB8fCBlMi5leHRyYSAmJiBlMi5leHRyYS5wYXJlbnRoZXNpemVkKQogICAgICAgICAgICAgIHJldHVybiBzdXBlci5wYXJzZUV4cHJlc3Npb25TdGF0ZW1lbnQoLi4uYXJndW1lbnRzKTsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goMTQpKSB7CiAgICAgICAgICAgICAgY29uc3QgczIgPSB0MzsKICAgICAgICAgICAgICByZXR1cm4gczIubGFiZWwgPSB0aGlzLmZpbmlzaFBsYWNlaG9sZGVyKGUyLCAiSWRlbnRpZmllciIpLCB0aGlzLm5leHQoKSwgczIuYm9keSA9IHRoaXMucGFyc2VTdGF0ZW1lbnQoImxhYmVsIiksIHRoaXMuZmluaXNoTm9kZShzMiwgIkxhYmVsZWRTdGF0ZW1lbnQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5zZW1pY29sb24oKSwgdDMubmFtZSA9IGUyLm5hbWUsIHRoaXMuZmluaXNoUGxhY2Vob2xkZXIodDMsICJTdGF0ZW1lbnQiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQmxvY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlUGxhY2Vob2xkZXIoIkJsb2NrU3RhdGVtZW50IikgfHwgc3VwZXIucGFyc2VCbG9jayguLi5hcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VGdW5jdGlvbklkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZVBsYWNlaG9sZGVyKCJJZGVudGlmaWVyIikgfHwgc3VwZXIucGFyc2VGdW5jdGlvbklkKC4uLmFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNsYXNzKHQzLCBlMiwgczIpIHsKICAgICAgICAgICAgY29uc3QgcjIgPSBlMiA/ICJDbGFzc0RlY2xhcmF0aW9uIiA6ICJDbGFzc0V4cHJlc3Npb24iOwogICAgICAgICAgICB0aGlzLm5leHQoKSwgdGhpcy50YWtlRGVjb3JhdG9ycyh0Myk7CiAgICAgICAgICAgIGNvbnN0IGkyID0gdGhpcy5zdGF0ZS5zdHJpY3QsIG4yID0gdGhpcy5wYXJzZVBsYWNlaG9sZGVyKCJJZGVudGlmaWVyIik7CiAgICAgICAgICAgIGlmIChuMikKICAgICAgICAgICAgICBpZiAodGhpcy5tYXRjaCg3NSkgfHwgdGhpcy5tYXRjaCgxMzQpIHx8IHRoaXMubWF0Y2goNSkpCiAgICAgICAgICAgICAgICB0My5pZCA9IG4yOwogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHMyIHx8ICFlMikKICAgICAgICAgICAgICAgICAgcmV0dXJuIHQzLmlkID0gbnVsbCwgdDMuYm9keSA9IHRoaXMuZmluaXNoUGxhY2Vob2xkZXIobjIsICJDbGFzc0JvZHkiKSwgdGhpcy5maW5pc2hOb2RlKHQzLCByMik7CiAgICAgICAgICAgICAgICB0aGlzLnVuZXhwZWN0ZWQobnVsbCwgbmQuQ2xhc3NOYW1lSXNSZXF1aXJlZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgdGhpcy5wYXJzZUNsYXNzSWQodDMsIGUyLCBzMik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlQ2xhc3NTdXBlcih0MyksIHQzLmJvZHkgPSB0aGlzLnBhcnNlUGxhY2Vob2xkZXIoIkNsYXNzQm9keSIpIHx8IHRoaXMucGFyc2VDbGFzc0JvZHkoISF0My5zdXBlckNsYXNzLCBpMiksIHRoaXMuZmluaXNoTm9kZSh0MywgcjIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHBvcnQodDMpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnBhcnNlUGxhY2Vob2xkZXIoIklkZW50aWZpZXIiKTsKICAgICAgICAgICAgaWYgKCFlMikKICAgICAgICAgICAgICByZXR1cm4gc3VwZXIucGFyc2VFeHBvcnQoLi4uYXJndW1lbnRzKTsKICAgICAgICAgICAgaWYgKCF0aGlzLmlzQ29udGV4dHVhbCg5MSkgJiYgIXRoaXMubWF0Y2goMTIpKQogICAgICAgICAgICAgIHJldHVybiB0My5zcGVjaWZpZXJzID0gW10sIHQzLnNvdXJjZSA9IG51bGwsIHQzLmRlY2xhcmF0aW9uID0gdGhpcy5maW5pc2hQbGFjZWhvbGRlcihlMiwgIkRlY2xhcmF0aW9uIiksIHRoaXMuZmluaXNoTm9kZSh0MywgIkV4cG9ydE5hbWVkRGVjbGFyYXRpb24iKTsKICAgICAgICAgICAgdGhpcy5leHBlY3RQbHVnaW4oImV4cG9ydERlZmF1bHRGcm9tIik7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHMyLmV4cG9ydGVkID0gZTIsIHQzLnNwZWNpZmllcnMgPSBbdGhpcy5maW5pc2hOb2RlKHMyLCAiRXhwb3J0RGVmYXVsdFNwZWNpZmllciIpXSwgc3VwZXIucGFyc2VFeHBvcnQodDMpOwogICAgICAgICAgfQogICAgICAgICAgaXNFeHBvcnREZWZhdWx0U3BlY2lmaWVyKCkgewogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCg1OSkpIHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMubmV4dFRva2VuU3RhcnQoKTsKICAgICAgICAgICAgICBpZiAodGhpcy5pc1VucGFyc2VkQ29udGV4dHVhbCh0MywgImZyb20iKSAmJiB0aGlzLmlucHV0LnN0YXJ0c1dpdGgoV2MoMTM0KSwgdGhpcy5uZXh0VG9rZW5TdGFydFNpbmNlKHQzICsgNCkpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmlzRXhwb3J0RGVmYXVsdFNwZWNpZmllcigpOwogICAgICAgICAgfQogICAgICAgICAgbWF5YmVQYXJzZUV4cG9ydERlZmF1bHRTcGVjaWZpZXIodDMpIHsKICAgICAgICAgICAgcmV0dXJuICEhKHQzLnNwZWNpZmllcnMgJiYgdDMuc3BlY2lmaWVycy5sZW5ndGggPiAwKSB8fCBzdXBlci5tYXliZVBhcnNlRXhwb3J0RGVmYXVsdFNwZWNpZmllciguLi5hcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgY2hlY2tFeHBvcnQodDMpIHsKICAgICAgICAgICAgY29uc3QgeyBzcGVjaWZpZXJzOiBlMiB9ID0gdDM7CiAgICAgICAgICAgIGUyICE9IG51bGwgJiYgZTIubGVuZ3RoICYmICh0My5zcGVjaWZpZXJzID0gZTIuZmlsdGVyKCh0NCkgPT4gdDQuZXhwb3J0ZWQudHlwZSA9PT0gIlBsYWNlaG9sZGVyIikpLCBzdXBlci5jaGVja0V4cG9ydCh0MyksIHQzLnNwZWNpZmllcnMgPSBlMjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlSW1wb3J0KHQzKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5wYXJzZVBsYWNlaG9sZGVyKCJJZGVudGlmaWVyIik7CiAgICAgICAgICAgIGlmICghZTIpCiAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnBhcnNlSW1wb3J0KC4uLmFyZ3VtZW50cyk7CiAgICAgICAgICAgIGlmICh0My5zcGVjaWZpZXJzID0gW10sICF0aGlzLmlzQ29udGV4dHVhbCg5MSkgJiYgIXRoaXMubWF0Y2goMTIpKQogICAgICAgICAgICAgIHJldHVybiB0My5zb3VyY2UgPSB0aGlzLmZpbmlzaFBsYWNlaG9sZGVyKGUyLCAiU3RyaW5nTGl0ZXJhbCIpLCB0aGlzLnNlbWljb2xvbigpLCB0aGlzLmZpbmlzaE5vZGUodDMsICJJbXBvcnREZWNsYXJhdGlvbiIpOwogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhcnROb2RlQXROb2RlKGUyKTsKICAgICAgICAgICAgaWYgKHMyLmxvY2FsID0gZTIsIHRoaXMuZmluaXNoTm9kZShzMiwgIkltcG9ydERlZmF1bHRTcGVjaWZpZXIiKSwgdDMuc3BlY2lmaWVycy5wdXNoKHMyKSwgdGhpcy5lYXQoMTIpKSB7CiAgICAgICAgICAgICAgdGhpcy5tYXliZVBhcnNlU3RhckltcG9ydFNwZWNpZmllcih0MykgfHwgdGhpcy5wYXJzZU5hbWVkSW1wb3J0U3BlY2lmaWVycyh0Myk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwZWN0Q29udGV4dHVhbCg5MSksIHQzLnNvdXJjZSA9IHRoaXMucGFyc2VJbXBvcnRTb3VyY2UoKSwgdGhpcy5zZW1pY29sb24oKSwgdGhpcy5maW5pc2hOb2RlKHQzLCAiSW1wb3J0RGVjbGFyYXRpb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlSW1wb3J0U291cmNlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZVBsYWNlaG9sZGVyKCJTdHJpbmdMaXRlcmFsIikgfHwgc3VwZXIucGFyc2VJbXBvcnRTb3VyY2UoLi4uYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICB9IH0sIGxkID0gT2JqZWN0LmtleXMoY2QpLCBkZCA9IHsgc291cmNlVHlwZTogInNjcmlwdCIsIHNvdXJjZUZpbGVuYW1lOiB2b2lkIDAsIHN0YXJ0Q29sdW1uOiAwLCBzdGFydExpbmU6IDEsIGFsbG93QXdhaXRPdXRzaWRlRnVuY3Rpb246IGZhbHNlLCBhbGxvd1JldHVybk91dHNpZGVGdW5jdGlvbjogZmFsc2UsIGFsbG93SW1wb3J0RXhwb3J0RXZlcnl3aGVyZTogZmFsc2UsIGFsbG93U3VwZXJPdXRzaWRlTWV0aG9kOiBmYWxzZSwgYWxsb3dVbmRlY2xhcmVkRXhwb3J0czogZmFsc2UsIHBsdWdpbnM6IFtdLCBzdHJpY3RNb2RlOiBudWxsLCByYW5nZXM6IGZhbHNlLCB0b2tlbnM6IGZhbHNlLCBjcmVhdGVQYXJlbnRoZXNpemVkRXhwcmVzc2lvbnM6IGZhbHNlLCBlcnJvclJlY292ZXJ5OiBmYWxzZSwgYXR0YWNoQ29tbWVudDogdHJ1ZSB9OwogICAgICAgIGNvbnN0IERkID0gKHQyKSA9PiB0Mi50eXBlID09PSAiUGFyZW50aGVzaXplZEV4cHJlc3Npb24iID8gRGQodDIuZXhwcmVzc2lvbikgOiB0MjsKICAgICAgICBjb25zdCBtZCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKFtbIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIiwgImFycm93IGZ1bmN0aW9uIl0sIFsiQXNzaWdubWVudEV4cHJlc3Npb24iLCAiYXNzaWdubWVudCJdLCBbIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiIsICJjb25kaXRpb25hbCJdLCBbIllpZWxkRXhwcmVzc2lvbiIsICJ5aWVsZCJdXSk7CiAgICAgICAgY29uc3QgZmQgPSB7IGtpbmQ6ICJsb29wIiB9LCB5ZCA9IHsga2luZDogInN3aXRjaCIgfSwgRWQgPSAvW1x1RDgwMC1cdURGRkZdL3UsIEFkID0gL2luKD86c3RhbmNlb2YpPy95OwogICAgICAgIGNsYXNzIENkIGV4dGVuZHMgY2xhc3MgZXh0ZW5kcyBjbGFzcyBleHRlbmRzIGNsYXNzIGV4dGVuZHMgY2xhc3MgZXh0ZW5kcyBjbGFzcyBleHRlbmRzIGNsYXNzIGV4dGVuZHMgY2xhc3MgZXh0ZW5kcyBjbGFzcyBleHRlbmRzIGNsYXNzIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICB0aGlzLnNhd1VuYW1iaWd1b3VzRVNNID0gZmFsc2UsIHRoaXMuYW1iaWd1b3VzU2NyaXB0RGlmZmVyZW50QXN0ID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBoYXNQbHVnaW4odDIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucGx1Z2lucy5oYXModDIpOwogICAgICAgICAgfQogICAgICAgICAgZ2V0UGx1Z2luT3B0aW9uKHQyLCBlMikgewogICAgICAgICAgICBpZiAodGhpcy5oYXNQbHVnaW4odDIpKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLnBsdWdpbnMuZ2V0KHQyKVtlMl07CiAgICAgICAgICB9CiAgICAgICAgfSB7CiAgICAgICAgICBhZGRDb21tZW50KHQyKSB7CiAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUgJiYgKHQyLmxvYy5maWxlbmFtZSA9IHRoaXMuZmlsZW5hbWUpLCB0aGlzLnN0YXRlLmNvbW1lbnRzLnB1c2godDIpOwogICAgICAgICAgfQogICAgICAgICAgcHJvY2Vzc0NvbW1lbnQodDIpIHsKICAgICAgICAgICAgY29uc3QgeyBjb21tZW50U3RhY2s6IGUyIH0gPSB0aGlzLnN0YXRlLCBzMiA9IGUyLmxlbmd0aDsKICAgICAgICAgICAgaWYgKHMyID09PSAwKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgbGV0IHIyID0gczIgLSAxOwogICAgICAgICAgICBjb25zdCBpMiA9IGUyW3IyXTsKICAgICAgICAgICAgaTIuc3RhcnQgPT09IHQyLmVuZCAmJiAoaTIubGVhZGluZ05vZGUgPSB0MiwgcjItLSk7CiAgICAgICAgICAgIGNvbnN0IHsgc3RhcnQ6IG4yIH0gPSB0MjsKICAgICAgICAgICAgZm9yICg7IHIyID49IDA7IHIyLS0pIHsKICAgICAgICAgICAgICBjb25zdCBzMyA9IGUyW3IyXSwgaTMgPSBzMy5lbmQ7CiAgICAgICAgICAgICAgaWYgKCEoaTMgPiBuMikpIHsKICAgICAgICAgICAgICAgIGkzID09PSBuMiAmJiAoczMudHJhaWxpbmdOb2RlID0gdDIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHMzLmNvbnRhaW5pbmdOb2RlID0gdDIsIHRoaXMuZmluYWxpemVDb21tZW50KHMzKSwgZTIuc3BsaWNlKHIyLCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZmluYWxpemVDb21tZW50KHQyKSB7CiAgICAgICAgICAgIGNvbnN0IHsgY29tbWVudHM6IGUyIH0gPSB0MjsKICAgICAgICAgICAgaWYgKHQyLmxlYWRpbmdOb2RlICE9PSBudWxsIHx8IHQyLnRyYWlsaW5nTm9kZSAhPT0gbnVsbCkKICAgICAgICAgICAgICB0Mi5sZWFkaW5nTm9kZSAhPT0gbnVsbCAmJiBwYyh0Mi5sZWFkaW5nTm9kZSwgZTIpLCB0Mi50cmFpbGluZ05vZGUgIT09IG51bGwgJiYgZnVuY3Rpb24odDMsIGUzKSB7CiAgICAgICAgICAgICAgICB0My5sZWFkaW5nQ29tbWVudHMgPT09IHZvaWQgMCA/IHQzLmxlYWRpbmdDb21tZW50cyA9IGUzIDogdDMubGVhZGluZ0NvbW1lbnRzLnVuc2hpZnQoLi4uZTMpOwogICAgICAgICAgICAgIH0odDIudHJhaWxpbmdOb2RlLCBlMik7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGNvbnN0IHsgY29udGFpbmluZ05vZGU6IHMyLCBzdGFydDogcjIgfSA9IHQyOwogICAgICAgICAgICAgIGlmICh0aGlzLmlucHV0LmNoYXJDb2RlQXQocjIgLSAxKSA9PT0gNDQpCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHMyLnR5cGUpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIGNhc2UgIk9iamVjdFBhdHRlcm4iOgogICAgICAgICAgICAgICAgICBjYXNlICJSZWNvcmRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgICBsYyhzMiwgczIucHJvcGVydGllcywgdDIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlICJDYWxsRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIGNhc2UgIk9wdGlvbmFsQ2FsbEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICAgIGxjKHMyLCBzMi5hcmd1bWVudHMsIHQyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAiRnVuY3Rpb25EZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgICAgIGNhc2UgIkZ1bmN0aW9uRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICAgIGNhc2UgIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0TWV0aG9kIjoKICAgICAgICAgICAgICAgICAgY2FzZSAiQ2xhc3NNZXRob2QiOgogICAgICAgICAgICAgICAgICBjYXNlICJDbGFzc1ByaXZhdGVNZXRob2QiOgogICAgICAgICAgICAgICAgICAgIGxjKHMyLCBzMi5wYXJhbXMsIHQyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAiQXJyYXlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgY2FzZSAiQXJyYXlQYXR0ZXJuIjoKICAgICAgICAgICAgICAgICAgY2FzZSAiVHVwbGVFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgICBsYyhzMiwgczIuZWxlbWVudHMsIHQyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAiRXhwb3J0TmFtZWREZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgICAgIGNhc2UgIkltcG9ydERlY2xhcmF0aW9uIjoKICAgICAgICAgICAgICAgICAgICBsYyhzMiwgczIuc3BlY2lmaWVycywgdDIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGNjKHMyLCBlMik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY2MoczIsIGUyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZmluYWxpemVSZW1haW5pbmdDb21tZW50cygpIHsKICAgICAgICAgICAgY29uc3QgeyBjb21tZW50U3RhY2s6IHQyIH0gPSB0aGlzLnN0YXRlOwogICAgICAgICAgICBmb3IgKGxldCBlMiA9IHQyLmxlbmd0aCAtIDE7IGUyID49IDA7IGUyLS0pCiAgICAgICAgICAgICAgdGhpcy5maW5hbGl6ZUNvbW1lbnQodDJbZTJdKTsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5jb21tZW50U3RhY2sgPSBbXTsKICAgICAgICAgIH0KICAgICAgICAgIHJlc2V0UHJldmlvdXNOb2RlVHJhaWxpbmdDb21tZW50cyh0MikgewogICAgICAgICAgICBjb25zdCB7IGNvbW1lbnRTdGFjazogZTIgfSA9IHRoaXMuc3RhdGUsIHsgbGVuZ3RoOiBzMiB9ID0gZTI7CiAgICAgICAgICAgIGlmIChzMiA9PT0gMCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHIyID0gZTJbczIgLSAxXTsKICAgICAgICAgICAgcjIubGVhZGluZ05vZGUgPT09IHQyICYmIChyMi5sZWFkaW5nTm9kZSA9IG51bGwpOwogICAgICAgICAgfQogICAgICAgICAgdGFrZVN1cnJvdW5kaW5nQ29tbWVudHModDIsIGUyLCBzMikgewogICAgICAgICAgICBjb25zdCB7IGNvbW1lbnRTdGFjazogcjIgfSA9IHRoaXMuc3RhdGUsIGkyID0gcjIubGVuZ3RoOwogICAgICAgICAgICBpZiAoaTIgPT09IDApCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBsZXQgbjIgPSBpMiAtIDE7CiAgICAgICAgICAgIGZvciAoOyBuMiA+PSAwOyBuMi0tKSB7CiAgICAgICAgICAgICAgY29uc3QgaTMgPSByMltuMl0sIGEyID0gaTMuZW5kOwogICAgICAgICAgICAgIGlmIChpMy5zdGFydCA9PT0gczIpCiAgICAgICAgICAgICAgICBpMy5sZWFkaW5nTm9kZSA9IHQyOwogICAgICAgICAgICAgIGVsc2UgaWYgKGEyID09PSBlMikKICAgICAgICAgICAgICAgIGkzLnRyYWlsaW5nTm9kZSA9IHQyOwogICAgICAgICAgICAgIGVsc2UgaWYgKGEyIDwgZTIpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gewogICAgICAgICAgZ2V0TG9jYXRpb25Gb3JQb3NpdGlvbih0MikgewogICAgICAgICAgICBsZXQgZTI7CiAgICAgICAgICAgIHJldHVybiBlMiA9IHQyID09PSB0aGlzLnN0YXRlLnN0YXJ0ID8gdGhpcy5zdGF0ZS5zdGFydExvYyA6IHQyID09PSB0aGlzLnN0YXRlLmxhc3RUb2tTdGFydCA/IHRoaXMuc3RhdGUubGFzdFRva1N0YXJ0TG9jIDogdDIgPT09IHRoaXMuc3RhdGUuZW5kID8gdGhpcy5zdGF0ZS5lbmRMb2MgOiB0MiA9PT0gdGhpcy5zdGF0ZS5sYXN0VG9rRW5kID8gdGhpcy5zdGF0ZS5sYXN0VG9rRW5kTG9jIDogZnVuY3Rpb24odDMsIGUzKSB7CiAgICAgICAgICAgICAgbGV0IHMyLCByMiA9IDEsIGkyID0gMDsKICAgICAgICAgICAgICBmb3IgKHJjLmxhc3RJbmRleCA9IDA7IChzMiA9IHJjLmV4ZWModDMpKSAmJiBzMi5pbmRleCA8IGUzOyApCiAgICAgICAgICAgICAgICByMisrLCBpMiA9IHJjLmxhc3RJbmRleDsKICAgICAgICAgICAgICByZXR1cm4gbmV3IHVjKHIyLCBlMyAtIGkyKTsKICAgICAgICAgICAgfSh0aGlzLmlucHV0LCB0MiksIGUyOwogICAgICAgICAgfQogICAgICAgICAgcmFpc2UodDIsIGUyKSB7CiAgICAgICAgICAgIGxldCB7IGNvZGU6IHMyLCByZWFzb25Db2RlOiByMiwgdGVtcGxhdGU6IGkyIH0gPSBlMjsKICAgICAgICAgICAgZm9yICh2YXIgbjIgPSBhcmd1bWVudHMubGVuZ3RoLCBhMiA9IG5ldyBBcnJheShuMiA+IDIgPyBuMiAtIDIgOiAwKSwgbzIgPSAyOyBvMiA8IG4yOyBvMisrKQogICAgICAgICAgICAgIGEyW28yIC0gMl0gPSBhcmd1bWVudHNbbzJdOwogICAgICAgICAgICByZXR1cm4gdGhpcy5yYWlzZVdpdGhEYXRhKHQyLCB7IGNvZGU6IHMyLCByZWFzb25Db2RlOiByMiB9LCBpMiwgLi4uYTIpOwogICAgICAgICAgfQogICAgICAgICAgcmFpc2VPdmVyd3JpdGUodDIsIGUyKSB7CiAgICAgICAgICAgIGxldCB7IGNvZGU6IHMyLCB0ZW1wbGF0ZTogcjIgfSA9IGUyOwogICAgICAgICAgICBmb3IgKHZhciBpMiA9IGFyZ3VtZW50cy5sZW5ndGgsIG4yID0gbmV3IEFycmF5KGkyID4gMiA/IGkyIC0gMiA6IDApLCBhMiA9IDI7IGEyIDwgaTI7IGEyKyspCiAgICAgICAgICAgICAgbjJbYTIgLSAyXSA9IGFyZ3VtZW50c1thMl07CiAgICAgICAgICAgIGNvbnN0IG8yID0gdGhpcy5nZXRMb2NhdGlvbkZvclBvc2l0aW9uKHQyKSwgdTIgPSByMi5yZXBsYWNlKC8lKFxkKykvZywgKHQzLCBlMykgPT4gbjJbZTNdKSArICIgKCIuY29uY2F0KG8yLmxpbmUsICI6IikuY29uY2F0KG8yLmNvbHVtbiwgIikiKTsKICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5lcnJvclJlY292ZXJ5KSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLnN0YXRlLmVycm9yczsKICAgICAgICAgICAgICBmb3IgKGxldCBzMyA9IGUzLmxlbmd0aCAtIDE7IHMzID49IDA7IHMzLS0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHIzID0gZTNbczNdOwogICAgICAgICAgICAgICAgaWYgKHIzLnBvcyA9PT0gdDIpCiAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHIzLCB7IG1lc3NhZ2U6IHUyIH0pOwogICAgICAgICAgICAgICAgaWYgKHIzLnBvcyA8IHQyKQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JhaXNlKHsgY29kZTogczIsIGxvYzogbzIsIHBvczogdDIgfSwgdTIpOwogICAgICAgICAgfQogICAgICAgICAgcmFpc2VXaXRoRGF0YSh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIGZvciAodmFyIHIyID0gYXJndW1lbnRzLmxlbmd0aCwgaTIgPSBuZXcgQXJyYXkocjIgPiAzID8gcjIgLSAzIDogMCksIG4yID0gMzsgbjIgPCByMjsgbjIrKykKICAgICAgICAgICAgICBpMltuMiAtIDNdID0gYXJndW1lbnRzW24yXTsKICAgICAgICAgICAgY29uc3QgYTIgPSB0aGlzLmdldExvY2F0aW9uRm9yUG9zaXRpb24odDIpLCBvMiA9IHMyLnJlcGxhY2UoLyUoXGQrKS9nLCAodDMsIGUzKSA9PiBpMltlM10pICsgIiAoIi5jb25jYXQoYTIubGluZSwgIjoiKS5jb25jYXQoYTIuY29sdW1uLCAiKSIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmFpc2UoT2JqZWN0LmFzc2lnbih7IGxvYzogYTIsIHBvczogdDIgfSwgZTIpLCBvMik7CiAgICAgICAgICB9CiAgICAgICAgICBfcmFpc2UodDIsIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gbmV3IFN5bnRheEVycm9yKGUyKTsKICAgICAgICAgICAgaWYgKE9iamVjdC5hc3NpZ24oczIsIHQyKSwgdGhpcy5vcHRpb25zLmVycm9yUmVjb3ZlcnkpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNMb29rYWhlYWQgfHwgdGhpcy5zdGF0ZS5lcnJvcnMucHVzaChzMiksIHMyOwogICAgICAgICAgICB0aHJvdyBzMjsKICAgICAgICAgIH0KICAgICAgICB9IHsKICAgICAgICAgIGNvbnN0cnVjdG9yKHQyLCBlMikgewogICAgICAgICAgICBzdXBlcigpLCB0aGlzLmlzTG9va2FoZWFkID0gdm9pZCAwLCB0aGlzLnRva2VucyA9IFtdLCB0aGlzLnN0YXRlID0gbmV3IGdsKCksIHRoaXMuc3RhdGUuaW5pdCh0MiksIHRoaXMuaW5wdXQgPSBlMiwgdGhpcy5sZW5ndGggPSBlMi5sZW5ndGgsIHRoaXMuaXNMb29rYWhlYWQgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHB1c2hUb2tlbih0MikgewogICAgICAgICAgICB0aGlzLnRva2Vucy5sZW5ndGggPSB0aGlzLnN0YXRlLnRva2Vuc0xlbmd0aCwgdGhpcy50b2tlbnMucHVzaCh0MiksICsrdGhpcy5zdGF0ZS50b2tlbnNMZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgICBuZXh0KCkgewogICAgICAgICAgICB0aGlzLmNoZWNrS2V5d29yZEVzY2FwZXMoKSwgdGhpcy5vcHRpb25zLnRva2VucyAmJiB0aGlzLnB1c2hUb2tlbihuZXcgd2wodGhpcy5zdGF0ZSkpLCB0aGlzLnN0YXRlLmxhc3RUb2tFbmQgPSB0aGlzLnN0YXRlLmVuZCwgdGhpcy5zdGF0ZS5sYXN0VG9rU3RhcnQgPSB0aGlzLnN0YXRlLnN0YXJ0LCB0aGlzLnN0YXRlLmxhc3RUb2tFbmRMb2MgPSB0aGlzLnN0YXRlLmVuZExvYywgdGhpcy5zdGF0ZS5sYXN0VG9rU3RhcnRMb2MgPSB0aGlzLnN0YXRlLnN0YXJ0TG9jLCB0aGlzLm5leHRUb2tlbigpOwogICAgICAgICAgfQogICAgICAgICAgZWF0KHQyKSB7CiAgICAgICAgICAgIHJldHVybiAhIXRoaXMubWF0Y2godDIpICYmICh0aGlzLm5leHQoKSwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBtYXRjaCh0MikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS50eXBlID09PSB0MjsKICAgICAgICAgIH0KICAgICAgICAgIGNyZWF0ZUxvb2thaGVhZFN0YXRlKHQyKSB7CiAgICAgICAgICAgIHJldHVybiB7IHBvczogdDIucG9zLCB2YWx1ZTogbnVsbCwgdHlwZTogdDIudHlwZSwgc3RhcnQ6IHQyLnN0YXJ0LCBlbmQ6IHQyLmVuZCwgbGFzdFRva0VuZDogdDIuZW5kLCBjb250ZXh0OiBbdGhpcy5jdXJDb250ZXh0KCldLCBpblR5cGU6IHQyLmluVHlwZSB9OwogICAgICAgICAgfQogICAgICAgICAgbG9va2FoZWFkKCkgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuc3RhdGU7CiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSB0aGlzLmNyZWF0ZUxvb2thaGVhZFN0YXRlKHQyKSwgdGhpcy5pc0xvb2thaGVhZCA9IHRydWUsIHRoaXMubmV4dFRva2VuKCksIHRoaXMuaXNMb29rYWhlYWQgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXRlOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZSA9IHQyLCBlMjsKICAgICAgICAgIH0KICAgICAgICAgIG5leHRUb2tlblN0YXJ0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0VG9rZW5TdGFydFNpbmNlKHRoaXMuc3RhdGUucG9zKTsKICAgICAgICAgIH0KICAgICAgICAgIG5leHRUb2tlblN0YXJ0U2luY2UodDIpIHsKICAgICAgICAgICAgcmV0dXJuIG5jLmxhc3RJbmRleCA9IHQyLCBuYy50ZXN0KHRoaXMuaW5wdXQpID8gbmMubGFzdEluZGV4IDogdDI7CiAgICAgICAgICB9CiAgICAgICAgICBsb29rYWhlYWRDaGFyQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLm5leHRUb2tlblN0YXJ0KCkpOwogICAgICAgICAgfQogICAgICAgICAgY29kZVBvaW50QXRQb3ModDIpIHsKICAgICAgICAgICAgbGV0IGUyID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHQyKTsKICAgICAgICAgICAgaWYgKCg2NDUxMiAmIGUyKSA9PSA1NTI5NiAmJiArK3QyIDwgdGhpcy5pbnB1dC5sZW5ndGgpIHsKICAgICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0Mik7CiAgICAgICAgICAgICAgKDY0NTEyICYgczIpID09IDU2MzIwICYmIChlMiA9IDY1NTM2ICsgKCgxMDIzICYgZTIpIDw8IDEwKSArICgxMDIzICYgczIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICB9CiAgICAgICAgICBzZXRTdHJpY3QodDIpIHsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5zdHJpY3QgPSB0MiwgdDIgJiYgKHRoaXMuc3RhdGUuc3RyaWN0RXJyb3JzLmZvckVhY2goKHQzLCBlMikgPT4gdGhpcy5yYWlzZShlMiwgdDMpKSwgdGhpcy5zdGF0ZS5zdHJpY3RFcnJvcnMuY2xlYXIoKSk7CiAgICAgICAgICB9CiAgICAgICAgICBjdXJDb250ZXh0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5jb250ZXh0W3RoaXMuc3RhdGUuY29udGV4dC5sZW5ndGggLSAxXTsKICAgICAgICAgIH0KICAgICAgICAgIG5leHRUb2tlbigpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLmN1ckNvbnRleHQoKTsKICAgICAgICAgICAgdDIucHJlc2VydmVTcGFjZSB8fCB0aGlzLnNraXBTcGFjZSgpLCB0aGlzLnN0YXRlLnN0YXJ0ID0gdGhpcy5zdGF0ZS5wb3MsIHRoaXMuaXNMb29rYWhlYWQgfHwgKHRoaXMuc3RhdGUuc3RhcnRMb2MgPSB0aGlzLnN0YXRlLmN1clBvc2l0aW9uKCkpLCB0aGlzLnN0YXRlLnBvcyA+PSB0aGlzLmxlbmd0aCA/IHRoaXMuZmluaXNoVG9rZW4oMTI5KSA6IHQyID09PSBBYy50ZW1wbGF0ZSA/IHRoaXMucmVhZFRtcGxUb2tlbigpIDogdGhpcy5nZXRUb2tlbkZyb21Db2RlKHRoaXMuY29kZVBvaW50QXRQb3ModGhpcy5zdGF0ZS5wb3MpKTsKICAgICAgICAgIH0KICAgICAgICAgIHNraXBCbG9ja0NvbW1lbnQoKSB7CiAgICAgICAgICAgIGxldCB0MjsKICAgICAgICAgICAgdGhpcy5pc0xvb2thaGVhZCB8fCAodDIgPSB0aGlzLnN0YXRlLmN1clBvc2l0aW9uKCkpOwogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhdGUucG9zLCBzMiA9IHRoaXMuaW5wdXQuaW5kZXhPZigiKi8iLCBlMiArIDIpOwogICAgICAgICAgICBpZiAoczIgPT09IC0xKQogICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UoZTIsIERjLlVudGVybWluYXRlZENvbW1lbnQpOwogICAgICAgICAgICBmb3IgKHRoaXMuc3RhdGUucG9zID0gczIgKyAyLCByYy5sYXN0SW5kZXggPSBlMiArIDI7IHJjLnRlc3QodGhpcy5pbnB1dCkgJiYgcmMubGFzdEluZGV4IDw9IHMyOyApCiAgICAgICAgICAgICAgKyt0aGlzLnN0YXRlLmN1ckxpbmUsIHRoaXMuc3RhdGUubGluZVN0YXJ0ID0gcmMubGFzdEluZGV4OwogICAgICAgICAgICBpZiAodGhpcy5pc0xvb2thaGVhZCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHIyID0geyB0eXBlOiAiQ29tbWVudEJsb2NrIiwgdmFsdWU6IHRoaXMuaW5wdXQuc2xpY2UoZTIgKyAyLCBzMiksIHN0YXJ0OiBlMiwgZW5kOiBzMiArIDIsIGxvYzogbmV3IGhjKHQyLCB0aGlzLnN0YXRlLmN1clBvc2l0aW9uKCkpIH07CiAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMudG9rZW5zICYmIHRoaXMucHVzaFRva2VuKHIyKSwgcjI7CiAgICAgICAgICB9CiAgICAgICAgICBza2lwTGluZUNvbW1lbnQodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXRlLnBvczsKICAgICAgICAgICAgbGV0IHMyOwogICAgICAgICAgICB0aGlzLmlzTG9va2FoZWFkIHx8IChzMiA9IHRoaXMuc3RhdGUuY3VyUG9zaXRpb24oKSk7CiAgICAgICAgICAgIGxldCByMiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyArPSB0Mik7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnBvcyA8IHRoaXMubGVuZ3RoKQogICAgICAgICAgICAgIGZvciAoOyAhaWMocjIpICYmICsrdGhpcy5zdGF0ZS5wb3MgPCB0aGlzLmxlbmd0aDsgKQogICAgICAgICAgICAgICAgcjIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MpOwogICAgICAgICAgICBpZiAodGhpcy5pc0xvb2thaGVhZCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGkyID0gdGhpcy5zdGF0ZS5wb3MsIG4yID0geyB0eXBlOiAiQ29tbWVudExpbmUiLCB2YWx1ZTogdGhpcy5pbnB1dC5zbGljZShlMiArIHQyLCBpMiksIHN0YXJ0OiBlMiwgZW5kOiBpMiwgbG9jOiBuZXcgaGMoczIsIHRoaXMuc3RhdGUuY3VyUG9zaXRpb24oKSkgfTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy50b2tlbnMgJiYgdGhpcy5wdXNoVG9rZW4objIpLCBuMjsKICAgICAgICAgIH0KICAgICAgICAgIHNraXBTcGFjZSgpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLnN0YXRlLnBvcywgZTIgPSBbXTsKICAgICAgICAgICAgdDoKICAgICAgICAgICAgICBmb3IgKDsgdGhpcy5zdGF0ZS5wb3MgPCB0aGlzLmxlbmd0aDsgKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyk7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKHMyKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMzI6CiAgICAgICAgICAgICAgICAgIGNhc2UgMTYwOgogICAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgKyt0aGlzLnN0YXRlLnBvczsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MgKyAxKSA9PT0gMTAgJiYgKyt0aGlzLnN0YXRlLnBvczsKICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgY2FzZSA4MjMyOgogICAgICAgICAgICAgICAgICBjYXNlIDgyMzM6CiAgICAgICAgICAgICAgICAgICAgKyt0aGlzLnN0YXRlLnBvcywgKyt0aGlzLnN0YXRlLmN1ckxpbmUsIHRoaXMuc3RhdGUubGluZVN0YXJ0ID0gdGhpcy5zdGF0ZS5wb3M7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgNDc6CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MgKyAxKSkgewogICAgICAgICAgICAgICAgICAgICAgY2FzZSA0MjogewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc2tpcEJsb2NrQ29tbWVudCgpOwogICAgICAgICAgICAgICAgICAgICAgICB0MyAhPT0gdm9pZCAwICYmICh0aGlzLmFkZENvbW1lbnQodDMpLCB0aGlzLm9wdGlvbnMuYXR0YWNoQ29tbWVudCAmJiBlMi5wdXNoKHQzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgY2FzZSA0NzogewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc2tpcExpbmVDb21tZW50KDIpOwogICAgICAgICAgICAgICAgICAgICAgICB0MyAhPT0gdm9pZCAwICYmICh0aGlzLmFkZENvbW1lbnQodDMpLCB0aGlzLm9wdGlvbnMuYXR0YWNoQ29tbWVudCAmJiBlMi5wdXNoKHQzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgdDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKG9jKHMyKSkKICAgICAgICAgICAgICAgICAgICAgICsrdGhpcy5zdGF0ZS5wb3M7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoczIgIT09IDQ1IHx8IHRoaXMuaW5Nb2R1bGUpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChzMiAhPT0gNjAgfHwgdGhpcy5pbk1vZHVsZSkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgdDsKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXRlLnBvczsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0MyArIDEpICE9PSAzMyB8fCB0aGlzLmlucHV0LmNoYXJDb2RlQXQodDMgKyAyKSAhPT0gNDUgfHwgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHQzICsgMykgIT09IDQ1KQogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0NCA9IHRoaXMuc2tpcExpbmVDb21tZW50KDQpOwogICAgICAgICAgICAgICAgICAgICAgICAgIHQ0ICE9PSB2b2lkIDAgJiYgKHRoaXMuYWRkQ29tbWVudCh0NCksIHRoaXMub3B0aW9ucy5hdHRhY2hDb21tZW50ICYmIGUyLnB1c2godDQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzMyA9IHRoaXMuc3RhdGUucG9zOwogICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXQuY2hhckNvZGVBdChzMyArIDEpICE9PSA0NSB8fCB0aGlzLmlucHV0LmNoYXJDb2RlQXQoczMgKyAyKSAhPT0gNjIgfHwgISh0MiA9PT0gMCB8fCB0aGlzLnN0YXRlLmxpbmVTdGFydCA+IHQyKSkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgdDsKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnNraXBMaW5lQ29tbWVudCgzKTsKICAgICAgICAgICAgICAgICAgICAgICAgdDMgIT09IHZvaWQgMCAmJiAodGhpcy5hZGRDb21tZW50KHQzKSwgdGhpcy5vcHRpb25zLmF0dGFjaENvbW1lbnQgJiYgZTIucHVzaCh0MykpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlMi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgY29uc3QgczIgPSB7IHN0YXJ0OiB0MiwgZW5kOiB0aGlzLnN0YXRlLnBvcywgY29tbWVudHM6IGUyLCBsZWFkaW5nTm9kZTogbnVsbCwgdHJhaWxpbmdOb2RlOiBudWxsLCBjb250YWluaW5nTm9kZTogbnVsbCB9OwogICAgICAgICAgICAgIHRoaXMuc3RhdGUuY29tbWVudFN0YWNrLnB1c2goczIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmaW5pc2hUb2tlbih0MiwgZTIpIHsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5lbmQgPSB0aGlzLnN0YXRlLnBvczsKICAgICAgICAgICAgY29uc3QgczIgPSB0aGlzLnN0YXRlLnR5cGU7CiAgICAgICAgICAgIHRoaXMuc3RhdGUudHlwZSA9IHQyLCB0aGlzLnN0YXRlLnZhbHVlID0gZTIsIHRoaXMuaXNMb29rYWhlYWQgfHwgKHRoaXMuc3RhdGUuZW5kTG9jID0gdGhpcy5zdGF0ZS5jdXJQb3NpdGlvbigpLCB0aGlzLnVwZGF0ZUNvbnRleHQoczIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlcGxhY2VUb2tlbih0MikgewogICAgICAgICAgICB0aGlzLnN0YXRlLnR5cGUgPSB0MiwgdGhpcy51cGRhdGVDb250ZXh0KCk7CiAgICAgICAgICB9CiAgICAgICAgICByZWFkVG9rZW5fbnVtYmVyU2lnbigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUucG9zID09PSAwICYmIHRoaXMucmVhZFRva2VuX2ludGVycHJldGVyKCkpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuc3RhdGUucG9zICsgMSwgZTIgPSB0aGlzLmNvZGVQb2ludEF0UG9zKHQyKTsKICAgICAgICAgICAgaWYgKGUyID49IDQ4ICYmIGUyIDw9IDU3KQogICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UodGhpcy5zdGF0ZS5wb3MsIERjLlVuZXhwZWN0ZWREaWdpdEFmdGVySGFzaCk7CiAgICAgICAgICAgIGlmIChlMiA9PT0gMTIzIHx8IGUyID09PSA5MSAmJiB0aGlzLmhhc1BsdWdpbigicmVjb3JkQW5kVHVwbGUiKSkgewogICAgICAgICAgICAgIGlmICh0aGlzLmV4cGVjdFBsdWdpbigicmVjb3JkQW5kVHVwbGUiKSwgdGhpcy5nZXRQbHVnaW5PcHRpb24oInJlY29yZEFuZFR1cGxlIiwgInN5bnRheFR5cGUiKSAhPT0gImhhc2giKQogICAgICAgICAgICAgICAgdGhyb3cgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnBvcywgZTIgPT09IDEyMyA/IERjLlJlY29yZEV4cHJlc3Npb25IYXNoSW5jb3JyZWN0U3RhcnRTeW50YXhUeXBlIDogRGMuVHVwbGVFeHByZXNzaW9uSGFzaEluY29ycmVjdFN0YXJ0U3ludGF4VHlwZSk7CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5wb3MgKz0gMiwgZTIgPT09IDEyMyA/IHRoaXMuZmluaXNoVG9rZW4oNykgOiB0aGlzLmZpbmlzaFRva2VuKDEpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBlbChlMikgPyAoKyt0aGlzLnN0YXRlLnBvcywgdGhpcy5maW5pc2hUb2tlbigxMjgsIHRoaXMucmVhZFdvcmQxKGUyKSkpIDogZTIgPT09IDkyID8gKCsrdGhpcy5zdGF0ZS5wb3MsIHRoaXMuZmluaXNoVG9rZW4oMTI4LCB0aGlzLnJlYWRXb3JkMSgpKSkgOiB0aGlzLmZpbmlzaE9wKDI1LCAxKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlYWRUb2tlbl9kb3QoKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zICsgMSk7CiAgICAgICAgICAgIHQyID49IDQ4ICYmIHQyIDw9IDU3ID8gdGhpcy5yZWFkTnVtYmVyKHRydWUpIDogdDIgPT09IDQ2ICYmIHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyArIDIpID09PSA0NiA/ICh0aGlzLnN0YXRlLnBvcyArPSAzLCB0aGlzLmZpbmlzaFRva2VuKDIxKSkgOiAoKyt0aGlzLnN0YXRlLnBvcywgdGhpcy5maW5pc2hUb2tlbigxNikpOwogICAgICAgICAgfQogICAgICAgICAgcmVhZFRva2VuX3NsYXNoKCkgewogICAgICAgICAgICB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MgKyAxKSA9PT0gNjEgPyB0aGlzLmZpbmlzaE9wKDI5LCAyKSA6IHRoaXMuZmluaXNoT3AoNTAsIDEpOwogICAgICAgICAgfQogICAgICAgICAgcmVhZFRva2VuX2ludGVycHJldGVyKCkgewogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5wb3MgIT09IDAgfHwgdGhpcy5sZW5ndGggPCAyKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgbGV0IHQyID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zICsgMSk7CiAgICAgICAgICAgIGlmICh0MiAhPT0gMzMpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhdGUucG9zOwogICAgICAgICAgICBmb3IgKHRoaXMuc3RhdGUucG9zICs9IDE7ICFpYyh0MikgJiYgKyt0aGlzLnN0YXRlLnBvcyA8IHRoaXMubGVuZ3RoOyApCiAgICAgICAgICAgICAgdDIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MpOwogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuaW5wdXQuc2xpY2UoZTIgKyAyLCB0aGlzLnN0YXRlLnBvcyk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbmlzaFRva2VuKDI2LCBzMiksIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICByZWFkVG9rZW5fbXVsdF9tb2R1bG8odDIpIHsKICAgICAgICAgICAgbGV0IGUyID0gdDIgPT09IDQyID8gNDkgOiA0OCwgczIgPSAxLCByMiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyArIDEpOwogICAgICAgICAgICB0MiA9PT0gNDIgJiYgcjIgPT09IDQyICYmIChzMisrLCByMiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyArIDIpLCBlMiA9IDUxKSwgcjIgIT09IDYxIHx8IHRoaXMuc3RhdGUuaW5UeXBlIHx8IChzMisrLCBlMiA9IHQyID09PSAzNyA/IDMxIDogMjgpLCB0aGlzLmZpbmlzaE9wKGUyLCBzMik7CiAgICAgICAgICB9CiAgICAgICAgICByZWFkVG9rZW5fcGlwZV9hbXAodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MgKyAxKTsKICAgICAgICAgICAgaWYgKGUyICE9PSB0MikgewogICAgICAgICAgICAgIGlmICh0MiA9PT0gMTI0KSB7CiAgICAgICAgICAgICAgICBpZiAoZTIgPT09IDYyKQogICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB0aGlzLmZpbmlzaE9wKDM1LCAyKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1BsdWdpbigicmVjb3JkQW5kVHVwbGUiKSAmJiBlMiA9PT0gMTI1KSB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldFBsdWdpbk9wdGlvbigicmVjb3JkQW5kVHVwbGUiLCAic3ludGF4VHlwZSIpICE9PSAiYmFyIikKICAgICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUucG9zLCBEYy5SZWNvcmRFeHByZXNzaW9uQmFySW5jb3JyZWN0RW5kU3ludGF4VHlwZSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnBvcyArPSAyLCB2b2lkIHRoaXMuZmluaXNoVG9rZW4oOSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNQbHVnaW4oInJlY29yZEFuZFR1cGxlIikgJiYgZTIgPT09IDkzKSB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldFBsdWdpbk9wdGlvbigicmVjb3JkQW5kVHVwbGUiLCAic3ludGF4VHlwZSIpICE9PSAiYmFyIikKICAgICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUucG9zLCBEYy5UdXBsZUV4cHJlc3Npb25CYXJJbmNvcnJlY3RFbmRTeW50YXhUeXBlKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUucG9zICs9IDIsIHZvaWQgdGhpcy5maW5pc2hUb2tlbig0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZTIgIT09IDYxID8gdGhpcy5maW5pc2hPcCh0MiA9PT0gMTI0ID8gMzkgOiA0MSwgMSkgOiB0aGlzLmZpbmlzaE9wKDI4LCAyKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zICsgMikgPT09IDYxID8gdGhpcy5maW5pc2hPcCgyOCwgMykgOiB0aGlzLmZpbmlzaE9wKHQyID09PSAxMjQgPyAzNyA6IDM4LCAyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlYWRUb2tlbl9jYXJldCgpIHsKICAgICAgICAgICAgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zICsgMSkgIT09IDYxIHx8IHRoaXMuc3RhdGUuaW5UeXBlID8gdGhpcy5maW5pc2hPcCg0MCwgMSkgOiB0aGlzLmZpbmlzaE9wKDMwLCAyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlYWRUb2tlbl9wbHVzX21pbih0MikgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyArIDEpOwogICAgICAgICAgICBlMiAhPT0gdDIgPyBlMiA9PT0gNjEgPyB0aGlzLmZpbmlzaE9wKDI4LCAyKSA6IHRoaXMuZmluaXNoT3AoNDcsIDEpIDogdGhpcy5maW5pc2hPcCgzMiwgMik7CiAgICAgICAgICB9CiAgICAgICAgICByZWFkVG9rZW5fbHQoKSB7CiAgICAgICAgICAgIGNvbnN0IHsgcG9zOiB0MiB9ID0gdGhpcy5zdGF0ZSwgZTIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodDIgKyAxKTsKICAgICAgICAgICAgaWYgKGUyID09PSA2MCkKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHQyICsgMikgPT09IDYxID8gdm9pZCB0aGlzLmZpbmlzaE9wKDI4LCAzKSA6IHZvaWQgdGhpcy5maW5pc2hPcCg0NiwgMik7CiAgICAgICAgICAgIGUyICE9PSA2MSA/IHRoaXMuZmluaXNoT3AoNDMsIDEpIDogdGhpcy5maW5pc2hPcCg0NSwgMik7CiAgICAgICAgICB9CiAgICAgICAgICByZWFkVG9rZW5fZ3QoKSB7CiAgICAgICAgICAgIGNvbnN0IHsgcG9zOiB0MiB9ID0gdGhpcy5zdGF0ZSwgZTIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodDIgKyAxKTsKICAgICAgICAgICAgaWYgKGUyID09PSA2MikgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHQyICsgMikgPT09IDYyID8gMyA6IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0MiArIGUzKSA9PT0gNjEgPyB2b2lkIHRoaXMuZmluaXNoT3AoMjgsIGUzICsgMSkgOiB2b2lkIHRoaXMuZmluaXNoT3AoNDYsIGUzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlMiAhPT0gNjEgPyB0aGlzLmZpbmlzaE9wKDQ0LCAxKSA6IHRoaXMuZmluaXNoT3AoNDUsIDIpOwogICAgICAgICAgfQogICAgICAgICAgcmVhZFRva2VuX2VxX2V4Y2wodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MgKyAxKTsKICAgICAgICAgICAgaWYgKGUyICE9PSA2MSkKICAgICAgICAgICAgICByZXR1cm4gdDIgPT09IDYxICYmIGUyID09PSA2MiA/ICh0aGlzLnN0YXRlLnBvcyArPSAyLCB2b2lkIHRoaXMuZmluaXNoVG9rZW4oMTkpKSA6IHZvaWQgdGhpcy5maW5pc2hPcCh0MiA9PT0gNjEgPyAyNyA6IDMzLCAxKTsKICAgICAgICAgICAgdGhpcy5maW5pc2hPcCg0MiwgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zICsgMikgPT09IDYxID8gMyA6IDIpOwogICAgICAgICAgfQogICAgICAgICAgcmVhZFRva2VuX3F1ZXN0aW9uKCkgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyArIDEpLCBlMiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyArIDIpOwogICAgICAgICAgICB0MiA9PT0gNjMgPyBlMiA9PT0gNjEgPyB0aGlzLmZpbmlzaE9wKDI4LCAzKSA6IHRoaXMuZmluaXNoT3AoMzYsIDIpIDogdDIgIT09IDQ2IHx8IGUyID49IDQ4ICYmIGUyIDw9IDU3ID8gKCsrdGhpcy5zdGF0ZS5wb3MsIHRoaXMuZmluaXNoVG9rZW4oMTcpKSA6ICh0aGlzLnN0YXRlLnBvcyArPSAyLCB0aGlzLmZpbmlzaFRva2VuKDE4KSk7CiAgICAgICAgICB9CiAgICAgICAgICBnZXRUb2tlbkZyb21Db2RlKHQyKSB7CiAgICAgICAgICAgIHN3aXRjaCAodDIpIHsKICAgICAgICAgICAgICBjYXNlIDQ2OgogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5yZWFkVG9rZW5fZG90KCk7CiAgICAgICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgICAgIHJldHVybiArK3RoaXMuc3RhdGUucG9zLCB2b2lkIHRoaXMuZmluaXNoVG9rZW4oMTApOwogICAgICAgICAgICAgIGNhc2UgNDE6CiAgICAgICAgICAgICAgICByZXR1cm4gKyt0aGlzLnN0YXRlLnBvcywgdm9pZCB0aGlzLmZpbmlzaFRva2VuKDExKTsKICAgICAgICAgICAgICBjYXNlIDU5OgogICAgICAgICAgICAgICAgcmV0dXJuICsrdGhpcy5zdGF0ZS5wb3MsIHZvaWQgdGhpcy5maW5pc2hUb2tlbigxMyk7CiAgICAgICAgICAgICAgY2FzZSA0NDoKICAgICAgICAgICAgICAgIHJldHVybiArK3RoaXMuc3RhdGUucG9zLCB2b2lkIHRoaXMuZmluaXNoVG9rZW4oMTIpOwogICAgICAgICAgICAgIGNhc2UgOTE6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNQbHVnaW4oInJlY29yZEFuZFR1cGxlIikgJiYgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zICsgMSkgPT09IDEyNCkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXRQbHVnaW5PcHRpb24oInJlY29yZEFuZFR1cGxlIiwgInN5bnRheFR5cGUiKSAhPT0gImJhciIpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnBvcywgRGMuVHVwbGVFeHByZXNzaW9uQmFySW5jb3JyZWN0U3RhcnRTeW50YXhUeXBlKTsKICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5wb3MgKz0gMiwgdGhpcy5maW5pc2hUb2tlbigyKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICArK3RoaXMuc3RhdGUucG9zLCB0aGlzLmZpbmlzaFRva2VuKDApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIGNhc2UgOTM6CiAgICAgICAgICAgICAgICByZXR1cm4gKyt0aGlzLnN0YXRlLnBvcywgdm9pZCB0aGlzLmZpbmlzaFRva2VuKDMpOwogICAgICAgICAgICAgIGNhc2UgMTIzOgogICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzUGx1Z2luKCJyZWNvcmRBbmRUdXBsZSIpICYmIHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyArIDEpID09PSAxMjQpIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2V0UGx1Z2luT3B0aW9uKCJyZWNvcmRBbmRUdXBsZSIsICJzeW50YXhUeXBlIikgIT09ICJiYXIiKQogICAgICAgICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UodGhpcy5zdGF0ZS5wb3MsIERjLlJlY29yZEV4cHJlc3Npb25CYXJJbmNvcnJlY3RTdGFydFN5bnRheFR5cGUpOwogICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnBvcyArPSAyLCB0aGlzLmZpbmlzaFRva2VuKDYpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICsrdGhpcy5zdGF0ZS5wb3MsIHRoaXMuZmluaXNoVG9rZW4oNSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgY2FzZSAxMjU6CiAgICAgICAgICAgICAgICByZXR1cm4gKyt0aGlzLnN0YXRlLnBvcywgdm9pZCB0aGlzLmZpbmlzaFRva2VuKDgpOwogICAgICAgICAgICAgIGNhc2UgNTg6CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAodGhpcy5oYXNQbHVnaW4oImZ1bmN0aW9uQmluZCIpICYmIHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyArIDEpID09PSA1OCA/IHRoaXMuZmluaXNoT3AoMTUsIDIpIDogKCsrdGhpcy5zdGF0ZS5wb3MsIHRoaXMuZmluaXNoVG9rZW4oMTQpKSk7CiAgICAgICAgICAgICAgY2FzZSA2MzoKICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMucmVhZFRva2VuX3F1ZXN0aW9uKCk7CiAgICAgICAgICAgICAgY2FzZSA5NjoKICAgICAgICAgICAgICAgIHJldHVybiArK3RoaXMuc3RhdGUucG9zLCB2b2lkIHRoaXMuZmluaXNoVG9rZW4oMjIpOwogICAgICAgICAgICAgIGNhc2UgNDg6IHsKICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zICsgMSk7CiAgICAgICAgICAgICAgICBpZiAodDMgPT09IDEyMCB8fCB0MyA9PT0gODgpCiAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMucmVhZFJhZGl4TnVtYmVyKDE2KTsKICAgICAgICAgICAgICAgIGlmICh0MyA9PT0gMTExIHx8IHQzID09PSA3OSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5yZWFkUmFkaXhOdW1iZXIoOCk7CiAgICAgICAgICAgICAgICBpZiAodDMgPT09IDk4IHx8IHQzID09PSA2NikKICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5yZWFkUmFkaXhOdW1iZXIoMik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgNDk6CiAgICAgICAgICAgICAgY2FzZSA1MDoKICAgICAgICAgICAgICBjYXNlIDUxOgogICAgICAgICAgICAgIGNhc2UgNTI6CiAgICAgICAgICAgICAgY2FzZSA1MzoKICAgICAgICAgICAgICBjYXNlIDU0OgogICAgICAgICAgICAgIGNhc2UgNTU6CiAgICAgICAgICAgICAgY2FzZSA1NjoKICAgICAgICAgICAgICBjYXNlIDU3OgogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5yZWFkTnVtYmVyKGZhbHNlKTsKICAgICAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICAgIGNhc2UgMzk6CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB0aGlzLnJlYWRTdHJpbmcodDIpOwogICAgICAgICAgICAgIGNhc2UgNDc6CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB0aGlzLnJlYWRUb2tlbl9zbGFzaCgpOwogICAgICAgICAgICAgIGNhc2UgMzc6CiAgICAgICAgICAgICAgY2FzZSA0MjoKICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMucmVhZFRva2VuX211bHRfbW9kdWxvKHQyKTsKICAgICAgICAgICAgICBjYXNlIDEyNDoKICAgICAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5yZWFkVG9rZW5fcGlwZV9hbXAodDIpOwogICAgICAgICAgICAgIGNhc2UgOTQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB0aGlzLnJlYWRUb2tlbl9jYXJldCgpOwogICAgICAgICAgICAgIGNhc2UgNDM6CiAgICAgICAgICAgICAgY2FzZSA0NToKICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMucmVhZFRva2VuX3BsdXNfbWluKHQyKTsKICAgICAgICAgICAgICBjYXNlIDYwOgogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5yZWFkVG9rZW5fbHQoKTsKICAgICAgICAgICAgICBjYXNlIDYyOgogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5yZWFkVG9rZW5fZ3QoKTsKICAgICAgICAgICAgICBjYXNlIDYxOgogICAgICAgICAgICAgIGNhc2UgMzM6CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB0aGlzLnJlYWRUb2tlbl9lcV9leGNsKHQyKTsKICAgICAgICAgICAgICBjYXNlIDEyNjoKICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMuZmluaXNoT3AoMzQsIDEpOwogICAgICAgICAgICAgIGNhc2UgNjQ6CiAgICAgICAgICAgICAgICByZXR1cm4gKyt0aGlzLnN0YXRlLnBvcywgdm9pZCB0aGlzLmZpbmlzaFRva2VuKDI0KTsKICAgICAgICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5yZWFkVG9rZW5fbnVtYmVyU2lnbigpOwogICAgICAgICAgICAgIGNhc2UgOTI6CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB0aGlzLnJlYWRXb3JkKCk7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmIChlbCh0MikpCiAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMucmVhZFdvcmQodDIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UodGhpcy5zdGF0ZS5wb3MsIERjLkludmFsaWRPclVuZXhwZWN0ZWRUb2tlbiwgU3RyaW5nLmZyb21Db2RlUG9pbnQodDIpKTsKICAgICAgICAgIH0KICAgICAgICAgIGZpbmlzaE9wKHQyLCBlMikgewogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuaW5wdXQuc2xpY2UodGhpcy5zdGF0ZS5wb3MsIHRoaXMuc3RhdGUucG9zICsgZTIpOwogICAgICAgICAgICB0aGlzLnN0YXRlLnBvcyArPSBlMiwgdGhpcy5maW5pc2hUb2tlbih0MiwgczIpOwogICAgICAgICAgfQogICAgICAgICAgcmVhZFJlZ2V4cCgpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLnN0YXRlLnN0YXJ0ICsgMTsKICAgICAgICAgICAgbGV0IGUyLCBzMiwgeyBwb3M6IHIyIH0gPSB0aGlzLnN0YXRlOwogICAgICAgICAgICBmb3IgKDsgOyArK3IyKSB7CiAgICAgICAgICAgICAgaWYgKHIyID49IHRoaXMubGVuZ3RoKQogICAgICAgICAgICAgICAgdGhyb3cgdGhpcy5yYWlzZSh0MiwgRGMuVW50ZXJtaW5hdGVkUmVnRXhwKTsKICAgICAgICAgICAgICBjb25zdCBpMyA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdChyMik7CiAgICAgICAgICAgICAgaWYgKGljKGkzKSkKICAgICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UodDIsIERjLlVudGVybWluYXRlZFJlZ0V4cCk7CiAgICAgICAgICAgICAgaWYgKGUyKQogICAgICAgICAgICAgICAgZTIgPSBmYWxzZTsKICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChpMyA9PT0gOTEpCiAgICAgICAgICAgICAgICAgIHMyID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGkzID09PSA5MyAmJiBzMikKICAgICAgICAgICAgICAgICAgczIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGkzID09PSA0NyAmJiAhczIpCiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZTIgPSBpMyA9PT0gOTI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGkyID0gdGhpcy5pbnB1dC5zbGljZSh0MiwgcjIpOwogICAgICAgICAgICArK3IyOwogICAgICAgICAgICBsZXQgbjIgPSAiIjsKICAgICAgICAgICAgZm9yICg7IHIyIDwgdGhpcy5sZW5ndGg7ICkgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5jb2RlUG9pbnRBdFBvcyhyMiksIGUzID0gU3RyaW5nLmZyb21DaGFyQ29kZSh0Myk7CiAgICAgICAgICAgICAgaWYgKFRsLmhhcyh0MykpCiAgICAgICAgICAgICAgICBuMi5pbmNsdWRlcyhlMykgJiYgdGhpcy5yYWlzZShyMiArIDEsIERjLkR1cGxpY2F0ZVJlZ0V4cEZsYWdzKTsKICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICghc2wodDMpICYmIHQzICE9PSA5MikKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB0aGlzLnJhaXNlKHIyICsgMSwgRGMuTWFsZm9ybWVkUmVnRXhwRmxhZ3MpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICArK3IyLCBuMiArPSBlMzsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnN0YXRlLnBvcyA9IHIyLCB0aGlzLmZpbmlzaFRva2VuKDEyNywgeyBwYXR0ZXJuOiBpMiwgZmxhZ3M6IG4yIH0pOwogICAgICAgICAgfQogICAgICAgICAgcmVhZEludCh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIGxldCByMiA9ICEoYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB2b2lkIDApIHx8IGFyZ3VtZW50c1szXTsKICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLnN0YXRlLnBvcywgbjIgPSB0MiA9PT0gMTYgPyBibC5oZXggOiBibC5kZWNCaW5PY3QsIGEyID0gdDIgPT09IDE2ID8gU2wuaGV4IDogdDIgPT09IDEwID8gU2wuZGVjIDogdDIgPT09IDggPyBTbC5vY3QgOiBTbC5iaW47CiAgICAgICAgICAgIGxldCBvMiA9IGZhbHNlLCB1MiA9IDA7CiAgICAgICAgICAgIGZvciAobGV0IGkzID0gMCwgaDIgPSBlMiA9PSBudWxsID8gMSAvIDAgOiBlMjsgaTMgPCBoMjsgKytpMykgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zKTsKICAgICAgICAgICAgICBsZXQgaDM7CiAgICAgICAgICAgICAgaWYgKGUzICE9PSA5NSkgewogICAgICAgICAgICAgICAgaWYgKGgzID0gZTMgPj0gOTcgPyBlMyAtIDk3ICsgMTAgOiBlMyA+PSA2NSA/IGUzIC0gNjUgKyAxMCA6IFBsKGUzKSA/IGUzIC0gNDggOiAxIC8gMCwgaDMgPj0gdDIpCiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZXJyb3JSZWNvdmVyeSAmJiBoMyA8PSA5KQogICAgICAgICAgICAgICAgICAgIGgzID0gMCwgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0ICsgaTMgKyAyLCBEYy5JbnZhbGlkRGlnaXQsIHQyKTsKICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFzMikKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGgzID0gMCwgbzIgPSB0cnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICArK3RoaXMuc3RhdGUucG9zLCB1MiA9IHUyICogdDIgKyBoMzsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MgLSAxKSwgZTQgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MgKyAxKTsKICAgICAgICAgICAgICAgIChhMi5pbmRleE9mKGU0KSA9PT0gLTEgfHwgbjIuaW5kZXhPZih0MykgPiAtMSB8fCBuMi5pbmRleE9mKGU0KSA+IC0xIHx8IE51bWJlci5pc05hTihlNCkpICYmIHRoaXMucmFpc2UodGhpcy5zdGF0ZS5wb3MsIERjLlVuZXhwZWN0ZWROdW1lcmljU2VwYXJhdG9yKSwgcjIgfHwgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnBvcywgRGMuTnVtZXJpY1NlcGFyYXRvckluRXNjYXBlU2VxdWVuY2UpLCArK3RoaXMuc3RhdGUucG9zOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5wb3MgPT09IGkyIHx8IGUyICE9IG51bGwgJiYgdGhpcy5zdGF0ZS5wb3MgLSBpMiAhPT0gZTIgfHwgbzIgPyBudWxsIDogdTI7CiAgICAgICAgICB9CiAgICAgICAgICByZWFkUmFkaXhOdW1iZXIodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXRlLnBvczsKICAgICAgICAgICAgbGV0IHMyID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuc3RhdGUucG9zICs9IDI7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5yZWFkSW50KHQyKTsKICAgICAgICAgICAgcjIgPT0gbnVsbCAmJiB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQgKyAyLCBEYy5JbnZhbGlkRGlnaXQsIHQyKTsKICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MpOwogICAgICAgICAgICBpZiAoaTIgPT09IDExMCkKICAgICAgICAgICAgICArK3RoaXMuc3RhdGUucG9zLCBzMiA9IHRydWU7CiAgICAgICAgICAgIGVsc2UgaWYgKGkyID09PSAxMDkpCiAgICAgICAgICAgICAgdGhyb3cgdGhpcy5yYWlzZShlMiwgRGMuSW52YWxpZERlY2ltYWwpOwogICAgICAgICAgICBpZiAoZWwodGhpcy5jb2RlUG9pbnRBdFBvcyh0aGlzLnN0YXRlLnBvcykpKQogICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UodGhpcy5zdGF0ZS5wb3MsIERjLk51bWJlcklkZW50aWZpZXIpOwogICAgICAgICAgICBpZiAoczIpIHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuaW5wdXQuc2xpY2UoZTIsIHRoaXMuc3RhdGUucG9zKS5yZXBsYWNlKC9bX25dL2csICIiKTsKICAgICAgICAgICAgICB0aGlzLmZpbmlzaFRva2VuKDEyNSwgdDMpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICB0aGlzLmZpbmlzaFRva2VuKDEyNCwgcjIpOwogICAgICAgICAgfQogICAgICAgICAgcmVhZE51bWJlcih0MikgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhdGUucG9zOwogICAgICAgICAgICBsZXQgczIgPSBmYWxzZSwgcjIgPSBmYWxzZSwgaTIgPSBmYWxzZSwgbjIgPSBmYWxzZSwgYTIgPSBmYWxzZTsKICAgICAgICAgICAgdDIgfHwgdGhpcy5yZWFkSW50KDEwKSAhPT0gbnVsbCB8fCB0aGlzLnJhaXNlKGUyLCBEYy5JbnZhbGlkTnVtYmVyKTsKICAgICAgICAgICAgY29uc3QgbzIgPSB0aGlzLnN0YXRlLnBvcyAtIGUyID49IDIgJiYgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KGUyKSA9PT0gNDg7CiAgICAgICAgICAgIGlmIChvMikgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5pbnB1dC5zbGljZShlMiwgdGhpcy5zdGF0ZS5wb3MpOwogICAgICAgICAgICAgIGlmICh0aGlzLnJlY29yZFN0cmljdE1vZGVFcnJvcnMoZTIsIERjLlN0cmljdE9jdGFsTGl0ZXJhbCksICF0aGlzLnN0YXRlLnN0cmljdCkgewogICAgICAgICAgICAgICAgY29uc3QgczMgPSB0My5pbmRleE9mKCJfIik7CiAgICAgICAgICAgICAgICBzMyA+IDAgJiYgdGhpcy5yYWlzZShzMyArIGUyLCBEYy5aZXJvRGlnaXROdW1lcmljU2VwYXJhdG9yKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYTIgPSBvMiAmJiAhL1s4OV0vLnRlc3QodDMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCB1MiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyk7CiAgICAgICAgICAgIGlmICh1MiAhPT0gNDYgfHwgYTIgfHwgKCsrdGhpcy5zdGF0ZS5wb3MsIHRoaXMucmVhZEludCgxMCksIHMyID0gdHJ1ZSwgdTIgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5zdGF0ZS5wb3MpKSwgdTIgIT09IDY5ICYmIHUyICE9PSAxMDEgfHwgYTIgfHwgKHUyID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KCsrdGhpcy5zdGF0ZS5wb3MpLCB1MiAhPT0gNDMgJiYgdTIgIT09IDQ1IHx8ICsrdGhpcy5zdGF0ZS5wb3MsIHRoaXMucmVhZEludCgxMCkgPT09IG51bGwgJiYgdGhpcy5yYWlzZShlMiwgRGMuSW52YWxpZE9yTWlzc2luZ0V4cG9uZW50KSwgczIgPSB0cnVlLCBuMiA9IHRydWUsIHUyID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zKSksIHUyID09PSAxMTAgJiYgKChzMiB8fCBvMikgJiYgdGhpcy5yYWlzZShlMiwgRGMuSW52YWxpZEJpZ0ludExpdGVyYWwpLCArK3RoaXMuc3RhdGUucG9zLCByMiA9IHRydWUpLCB1MiA9PT0gMTA5ICYmICh0aGlzLmV4cGVjdFBsdWdpbigiZGVjaW1hbCIsIHRoaXMuc3RhdGUucG9zKSwgKG4yIHx8IG8yKSAmJiB0aGlzLnJhaXNlKGUyLCBEYy5JbnZhbGlkRGVjaW1hbCksICsrdGhpcy5zdGF0ZS5wb3MsIGkyID0gdHJ1ZSksIGVsKHRoaXMuY29kZVBvaW50QXRQb3ModGhpcy5zdGF0ZS5wb3MpKSkKICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUucG9zLCBEYy5OdW1iZXJJZGVudGlmaWVyKTsKICAgICAgICAgICAgY29uc3QgaDIgPSB0aGlzLmlucHV0LnNsaWNlKGUyLCB0aGlzLnN0YXRlLnBvcykucmVwbGFjZSgvW19tbl0vZywgIiIpOwogICAgICAgICAgICBpZiAocjIpCiAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5maW5pc2hUb2tlbigxMjUsIGgyKTsKICAgICAgICAgICAgaWYgKGkyKQogICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMuZmluaXNoVG9rZW4oMTI2LCBoMik7CiAgICAgICAgICAgIGNvbnN0IHAyID0gYTIgPyBwYXJzZUludChoMiwgOCkgOiBwYXJzZUZsb2F0KGgyKTsKICAgICAgICAgICAgdGhpcy5maW5pc2hUb2tlbigxMjQsIHAyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlYWRDb2RlUG9pbnQodDIpIHsKICAgICAgICAgICAgbGV0IGUyOwogICAgICAgICAgICBpZiAodGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zKSA9PT0gMTIzKSB7CiAgICAgICAgICAgICAgY29uc3QgczIgPSArK3RoaXMuc3RhdGUucG9zOwogICAgICAgICAgICAgIGlmIChlMiA9IHRoaXMucmVhZEhleENoYXIodGhpcy5pbnB1dC5pbmRleE9mKCJ9IiwgdGhpcy5zdGF0ZS5wb3MpIC0gdGhpcy5zdGF0ZS5wb3MsIHRydWUsIHQyKSwgKyt0aGlzLnN0YXRlLnBvcywgZTIgIT09IG51bGwgJiYgZTIgPiAxMTE0MTExKSB7CiAgICAgICAgICAgICAgICBpZiAoIXQyKQogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMucmFpc2UoczIsIERjLkludmFsaWRDb2RlUG9pbnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgZTIgPSB0aGlzLnJlYWRIZXhDaGFyKDQsIGZhbHNlLCB0Mik7CiAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICAgIH0KICAgICAgICAgIHJlYWRTdHJpbmcodDIpIHsKICAgICAgICAgICAgbGV0IGUyID0gIiIsIHMyID0gKyt0aGlzLnN0YXRlLnBvczsKICAgICAgICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUucG9zID49IHRoaXMubGVuZ3RoKQogICAgICAgICAgICAgICAgdGhyb3cgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0LCBEYy5VbnRlcm1pbmF0ZWRTdHJpbmcpOwogICAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zKTsKICAgICAgICAgICAgICBpZiAocjIgPT09IHQyKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgaWYgKHIyID09PSA5MikKICAgICAgICAgICAgICAgIGUyICs9IHRoaXMuaW5wdXQuc2xpY2UoczIsIHRoaXMuc3RhdGUucG9zKSwgZTIgKz0gdGhpcy5yZWFkRXNjYXBlZENoYXIoZmFsc2UpLCBzMiA9IHRoaXMuc3RhdGUucG9zOwogICAgICAgICAgICAgIGVsc2UgaWYgKHIyID09PSA4MjMyIHx8IHIyID09PSA4MjMzKQogICAgICAgICAgICAgICAgKyt0aGlzLnN0YXRlLnBvcywgKyt0aGlzLnN0YXRlLmN1ckxpbmUsIHRoaXMuc3RhdGUubGluZVN0YXJ0ID0gdGhpcy5zdGF0ZS5wb3M7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoaWMocjIpKQogICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIERjLlVudGVybWluYXRlZFN0cmluZyk7CiAgICAgICAgICAgICAgICArK3RoaXMuc3RhdGUucG9zOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlMiArPSB0aGlzLmlucHV0LnNsaWNlKHMyLCB0aGlzLnN0YXRlLnBvcysrKSwgdGhpcy5maW5pc2hUb2tlbigxMjMsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlYWRUbXBsVG9rZW4oKSB7CiAgICAgICAgICAgIGxldCB0MiA9ICIiLCBlMiA9IHRoaXMuc3RhdGUucG9zLCBzMiA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5wb3MgPj0gdGhpcy5sZW5ndGgpCiAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIERjLlVudGVybWluYXRlZFRlbXBsYXRlKTsKICAgICAgICAgICAgICBjb25zdCByMiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnN0YXRlLnBvcyk7CiAgICAgICAgICAgICAgaWYgKHIyID09PSA5NiB8fCByMiA9PT0gMzYgJiYgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zICsgMSkgPT09IDEyMykKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnBvcyA9PT0gdGhpcy5zdGF0ZS5zdGFydCAmJiB0aGlzLm1hdGNoKDIwKSA/IHIyID09PSAzNiA/ICh0aGlzLnN0YXRlLnBvcyArPSAyLCB2b2lkIHRoaXMuZmluaXNoVG9rZW4oMjMpKSA6ICgrK3RoaXMuc3RhdGUucG9zLCB2b2lkIHRoaXMuZmluaXNoVG9rZW4oMjIpKSA6ICh0MiArPSB0aGlzLmlucHV0LnNsaWNlKGUyLCB0aGlzLnN0YXRlLnBvcyksIHZvaWQgdGhpcy5maW5pc2hUb2tlbigyMCwgczIgPyBudWxsIDogdDIpKTsKICAgICAgICAgICAgICBpZiAocjIgPT09IDkyKSB7CiAgICAgICAgICAgICAgICB0MiArPSB0aGlzLmlucHV0LnNsaWNlKGUyLCB0aGlzLnN0YXRlLnBvcyk7CiAgICAgICAgICAgICAgICBjb25zdCByMyA9IHRoaXMucmVhZEVzY2FwZWRDaGFyKHRydWUpOwogICAgICAgICAgICAgICAgcjMgPT09IG51bGwgPyBzMiA9IHRydWUgOiB0MiArPSByMywgZTIgPSB0aGlzLnN0YXRlLnBvczsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGljKHIyKSkgewogICAgICAgICAgICAgICAgc3dpdGNoICh0MiArPSB0aGlzLmlucHV0LnNsaWNlKGUyLCB0aGlzLnN0YXRlLnBvcyksICsrdGhpcy5zdGF0ZS5wb3MsIHIyKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zKSA9PT0gMTAgJiYgKyt0aGlzLnN0YXRlLnBvczsKICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICB0MiArPSAiXG4iOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHQyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUocjIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKyt0aGlzLnN0YXRlLmN1ckxpbmUsIHRoaXMuc3RhdGUubGluZVN0YXJ0ID0gdGhpcy5zdGF0ZS5wb3MsIGUyID0gdGhpcy5zdGF0ZS5wb3M7CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICArK3RoaXMuc3RhdGUucG9zOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZWNvcmRTdHJpY3RNb2RlRXJyb3JzKHQyLCBlMikgewogICAgICAgICAgICB0aGlzLnN0YXRlLnN0cmljdCAmJiAhdGhpcy5zdGF0ZS5zdHJpY3RFcnJvcnMuaGFzKHQyKSA/IHRoaXMucmFpc2UodDIsIGUyKSA6IHRoaXMuc3RhdGUuc3RyaWN0RXJyb3JzLnNldCh0MiwgZTIpOwogICAgICAgICAgfQogICAgICAgICAgcmVhZEVzY2FwZWRDaGFyKHQyKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gIXQyLCBzMiA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdCgrK3RoaXMuc3RhdGUucG9zKTsKICAgICAgICAgICAgc3dpdGNoICgrK3RoaXMuc3RhdGUucG9zLCBzMikgewogICAgICAgICAgICAgIGNhc2UgMTEwOgogICAgICAgICAgICAgICAgcmV0dXJuICJcbiI7CiAgICAgICAgICAgICAgY2FzZSAxMTQ6CiAgICAgICAgICAgICAgICByZXR1cm4gIlxyIjsKICAgICAgICAgICAgICBjYXNlIDEyMDogewogICAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnJlYWRIZXhDaGFyKDIsIGZhbHNlLCBlMik7CiAgICAgICAgICAgICAgICByZXR1cm4gdDMgPT09IG51bGwgPyBudWxsIDogU3RyaW5nLmZyb21DaGFyQ29kZSh0Myk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgMTE3OiB7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMucmVhZENvZGVQb2ludChlMik7CiAgICAgICAgICAgICAgICByZXR1cm4gdDMgPT09IG51bGwgPyBudWxsIDogU3RyaW5nLmZyb21Db2RlUG9pbnQodDMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlIDExNjoKICAgICAgICAgICAgICAgIHJldHVybiAiCSI7CiAgICAgICAgICAgICAgY2FzZSA5ODoKICAgICAgICAgICAgICAgIHJldHVybiAiXGIiOwogICAgICAgICAgICAgIGNhc2UgMTE4OgogICAgICAgICAgICAgICAgcmV0dXJuICJcdiI7CiAgICAgICAgICAgICAgY2FzZSAxMDI6CiAgICAgICAgICAgICAgICByZXR1cm4gIlxmIjsKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zKSA9PT0gMTAgJiYgKyt0aGlzLnN0YXRlLnBvczsKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5saW5lU3RhcnQgPSB0aGlzLnN0YXRlLnBvcywgKyt0aGlzLnN0YXRlLmN1ckxpbmU7CiAgICAgICAgICAgICAgY2FzZSA4MjMyOgogICAgICAgICAgICAgIGNhc2UgODIzMzoKICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICBjYXNlIDU2OgogICAgICAgICAgICAgIGNhc2UgNTc6CiAgICAgICAgICAgICAgICBpZiAodDIpCiAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5yZWNvcmRTdHJpY3RNb2RlRXJyb3JzKHRoaXMuc3RhdGUucG9zIC0gMSwgRGMuU3RyaWN0TnVtZXJpY0VzY2FwZSk7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmIChzMiA+PSA0OCAmJiBzMiA8PSA1NSkgewogICAgICAgICAgICAgICAgICBjb25zdCBlMyA9IHRoaXMuc3RhdGUucG9zIC0gMTsKICAgICAgICAgICAgICAgICAgbGV0IHMzID0gdGhpcy5pbnB1dC5zdWJzdHIodGhpcy5zdGF0ZS5wb3MgLSAxLCAzKS5tYXRjaCgvXlswLTddKy8pWzBdLCByMiA9IHBhcnNlSW50KHMzLCA4KTsKICAgICAgICAgICAgICAgICAgcjIgPiAyNTUgJiYgKHMzID0gczMuc2xpY2UoMCwgLTEpLCByMiA9IHBhcnNlSW50KHMzLCA4KSksIHRoaXMuc3RhdGUucG9zICs9IHMzLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGkyID0gdGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMuc3RhdGUucG9zKTsKICAgICAgICAgICAgICAgICAgaWYgKHMzICE9PSAiMCIgfHwgaTIgPT09IDU2IHx8IGkyID09PSA1NykgewogICAgICAgICAgICAgICAgICAgIGlmICh0MikKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmVjb3JkU3RyaWN0TW9kZUVycm9ycyhlMywgRGMuU3RyaWN0TnVtZXJpY0VzY2FwZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUocjIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoczIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZWFkSGV4Q2hhcih0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGF0ZS5wb3MsIGkyID0gdGhpcy5yZWFkSW50KDE2LCB0MiwgZTIsIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIGkyID09PSBudWxsICYmIChzMiA/IHRoaXMucmFpc2UocjIsIERjLkludmFsaWRFc2NhcGVTZXF1ZW5jZSkgOiB0aGlzLnN0YXRlLnBvcyA9IHIyIC0gMSksIGkyOwogICAgICAgICAgfQogICAgICAgICAgcmVhZFdvcmQxKHQyKSB7CiAgICAgICAgICAgIHRoaXMuc3RhdGUuY29udGFpbnNFc2MgPSBmYWxzZTsKICAgICAgICAgICAgbGV0IGUyID0gIiI7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5zdGF0ZS5wb3M7CiAgICAgICAgICAgIGxldCByMiA9IHRoaXMuc3RhdGUucG9zOwogICAgICAgICAgICBmb3IgKHQyICE9PSB2b2lkIDAgJiYgKHRoaXMuc3RhdGUucG9zICs9IHQyIDw9IDY1NTM1ID8gMSA6IDIpOyB0aGlzLnN0YXRlLnBvcyA8IHRoaXMubGVuZ3RoOyApIHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuY29kZVBvaW50QXRQb3ModGhpcy5zdGF0ZS5wb3MpOwogICAgICAgICAgICAgIGlmIChzbCh0MykpCiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnBvcyArPSB0MyA8PSA2NTUzNSA/IDEgOiAyOwogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHQzICE9PSA5MikKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUuY29udGFpbnNFc2MgPSB0cnVlLCBlMiArPSB0aGlzLmlucHV0LnNsaWNlKHIyLCB0aGlzLnN0YXRlLnBvcyk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHQ0ID0gdGhpcy5zdGF0ZS5wb3MsIGkyID0gdGhpcy5zdGF0ZS5wb3MgPT09IHMyID8gZWwgOiBzbDsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXQuY2hhckNvZGVBdCgrK3RoaXMuc3RhdGUucG9zKSAhPT0gMTE3KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnBvcywgRGMuTWlzc2luZ1VuaWNvZGVFc2NhcGUpLCByMiA9IHRoaXMuc3RhdGUucG9zIC0gMTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICArK3RoaXMuc3RhdGUucG9zOwogICAgICAgICAgICAgICAgICBjb25zdCBuMiA9IHRoaXMucmVhZENvZGVQb2ludCh0cnVlKTsKICAgICAgICAgICAgICAgICAgbjIgIT09IG51bGwgJiYgKGkyKG4yKSB8fCB0aGlzLnJhaXNlKHQ0LCBEYy5Fc2NhcGVkQ2hhck5vdEFuSWRlbnRpZmllciksIGUyICs9IFN0cmluZy5mcm9tQ29kZVBvaW50KG4yKSksIHIyID0gdGhpcy5zdGF0ZS5wb3M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlMiArIHRoaXMuaW5wdXQuc2xpY2UocjIsIHRoaXMuc3RhdGUucG9zKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlYWRXb3JkKHQyKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5yZWFkV29yZDEodDIpLCBzMiA9IGJjLmdldChlMik7CiAgICAgICAgICAgIHMyICE9PSB2b2lkIDAgPyB0aGlzLmZpbmlzaFRva2VuKHMyLCBXYyhzMikpIDogdGhpcy5maW5pc2hUb2tlbigxMjIsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIGNoZWNrS2V5d29yZEVzY2FwZXMoKSB7CiAgICAgICAgICAgIGNvbnN0IHsgdHlwZTogdDIgfSA9IHRoaXMuc3RhdGU7CiAgICAgICAgICAgIHFjKHQyKSAmJiB0aGlzLnN0YXRlLmNvbnRhaW5zRXNjICYmIHRoaXMucmFpc2UodGhpcy5zdGF0ZS5zdGFydCwgRGMuSW52YWxpZEVzY2FwZWRSZXNlcnZlZFdvcmQsIFdjKHQyKSk7CiAgICAgICAgICB9CiAgICAgICAgICB1cGRhdGVDb250ZXh0KHQyKSB7CiAgICAgICAgICAgIGNvbnN0IHsgY29udGV4dDogZTIsIHR5cGU6IHMyIH0gPSB0aGlzLnN0YXRlOwogICAgICAgICAgICBzd2l0Y2ggKHMyKSB7CiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgZTIucG9wKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgICBlMi5wdXNoKEFjLmJyYWNlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICBlMltlMi5sZW5ndGggLSAxXSA9PT0gQWMudGVtcGxhdGUgPyBlMi5wb3AoKSA6IGUyLnB1c2goQWMudGVtcGxhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSB7CiAgICAgICAgICBhZGRFeHRyYSh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIGlmICghdDIpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAodDIuZXh0cmEgPSB0Mi5leHRyYSB8fCB7fSlbZTJdID0gczI7CiAgICAgICAgICB9CiAgICAgICAgICBpc0NvbnRleHR1YWwodDIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUudHlwZSA9PT0gdDIgJiYgIXRoaXMuc3RhdGUuY29udGFpbnNFc2M7CiAgICAgICAgICB9CiAgICAgICAgICBpc1VucGFyc2VkQ29udGV4dHVhbCh0MiwgZTIpIHsKICAgICAgICAgICAgY29uc3QgczIgPSB0MiArIGUyLmxlbmd0aDsKICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXQuc2xpY2UodDIsIHMyKSA9PT0gZTIpIHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuaW5wdXQuY2hhckNvZGVBdChzMik7CiAgICAgICAgICAgICAgcmV0dXJuICEoc2wodDMpIHx8ICg2NDUxMiAmIHQzKSA9PSA1NTI5Nik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgaXNMb29rYWhlYWRDb250ZXh0dWFsKHQyKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5uZXh0VG9rZW5TdGFydCgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5pc1VucGFyc2VkQ29udGV4dHVhbChlMiwgdDIpOwogICAgICAgICAgfQogICAgICAgICAgZWF0Q29udGV4dHVhbCh0MikgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLmlzQ29udGV4dHVhbCh0MikgJiYgKHRoaXMubmV4dCgpLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICAgIGV4cGVjdENvbnRleHR1YWwodDIsIGUyKSB7CiAgICAgICAgICAgIHRoaXMuZWF0Q29udGV4dHVhbCh0MikgfHwgdGhpcy51bmV4cGVjdGVkKG51bGwsIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIGNhbkluc2VydFNlbWljb2xvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goMTI5KSB8fCB0aGlzLm1hdGNoKDgpIHx8IHRoaXMuaGFzUHJlY2VkaW5nTGluZUJyZWFrKCk7CiAgICAgICAgICB9CiAgICAgICAgICBoYXNQcmVjZWRpbmdMaW5lQnJlYWsoKSB7CiAgICAgICAgICAgIHJldHVybiBzYy50ZXN0KHRoaXMuaW5wdXQuc2xpY2UodGhpcy5zdGF0ZS5sYXN0VG9rRW5kLCB0aGlzLnN0YXRlLnN0YXJ0KSk7CiAgICAgICAgICB9CiAgICAgICAgICBoYXNGb2xsb3dpbmdMaW5lQnJlYWsoKSB7CiAgICAgICAgICAgIHJldHVybiBhYy5sYXN0SW5kZXggPSB0aGlzLnN0YXRlLmVuZCwgYWMudGVzdCh0aGlzLmlucHV0KTsKICAgICAgICAgIH0KICAgICAgICAgIGlzTGluZVRlcm1pbmF0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhdCgxMykgfHwgdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKTsKICAgICAgICAgIH0KICAgICAgICAgIHNlbWljb2xvbigpIHsKICAgICAgICAgICAgKCEoYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB2b2lkIDApIHx8IGFyZ3VtZW50c1swXSA/IHRoaXMuaXNMaW5lVGVybWluYXRvcigpIDogdGhpcy5lYXQoMTMpKSB8fCB0aGlzLnJhaXNlKHRoaXMuc3RhdGUubGFzdFRva0VuZCwgRGMuTWlzc2luZ1NlbWljb2xvbik7CiAgICAgICAgICB9CiAgICAgICAgICBleHBlY3QodDIsIGUyKSB7CiAgICAgICAgICAgIHRoaXMuZWF0KHQyKSB8fCB0aGlzLnVuZXhwZWN0ZWQoZTIsIHQyKTsKICAgICAgICAgIH0KICAgICAgICAgIGFzc2VydE5vU3BhY2UoKSB7CiAgICAgICAgICAgIGxldCB0MiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzBdIDogIlVuZXhwZWN0ZWQgc3BhY2UuIjsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5zdGFydCA+IHRoaXMuc3RhdGUubGFzdFRva0VuZCAmJiB0aGlzLnJhaXNlKHRoaXMuc3RhdGUubGFzdFRva0VuZCwgeyBjb2RlOiBkYy5TeW50YXhFcnJvciwgcmVhc29uQ29kZTogIlVuZXhwZWN0ZWRTcGFjZSIsIHRlbXBsYXRlOiB0MiB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHVuZXhwZWN0ZWQodDIpIHsKICAgICAgICAgICAgbGV0IGUyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMV0gOiB7IGNvZGU6IGRjLlN5bnRheEVycm9yLCByZWFzb25Db2RlOiAiVW5leHBlY3RlZFRva2VuIiwgdGVtcGxhdGU6ICJVbmV4cGVjdGVkIHRva2VuIiB9OwogICAgICAgICAgICB0aHJvdyB0eXBlb2YgZTIgPT0gIm51bWJlciIgJiYgKGUyID0geyBjb2RlOiBkYy5TeW50YXhFcnJvciwgcmVhc29uQ29kZTogIlVuZXhwZWN0ZWRUb2tlbiIsIHRlbXBsYXRlOiAnVW5leHBlY3RlZCB0b2tlbiwgZXhwZWN0ZWQgIicuY29uY2F0KFdjKGUyKSwgJyInKSB9KSwgdGhpcy5yYWlzZSh0MiAhPSBudWxsID8gdDIgOiB0aGlzLnN0YXRlLnN0YXJ0LCBlMik7CiAgICAgICAgICB9CiAgICAgICAgICBleHBlY3RQbHVnaW4odDIsIGUyKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNQbHVnaW4odDIpKQogICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2VXaXRoRGF0YShlMiAhPSBudWxsID8gZTIgOiB0aGlzLnN0YXRlLnN0YXJ0LCB7IG1pc3NpbmdQbHVnaW46IFt0Ml0gfSwgIlRoaXMgZXhwZXJpbWVudGFsIHN5bnRheCByZXF1aXJlcyBlbmFibGluZyB0aGUgcGFyc2VyIHBsdWdpbjogJyIuY29uY2F0KHQyLCAiJyIpKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBleHBlY3RPbmVQbHVnaW4odDIsIGUyKSB7CiAgICAgICAgICAgIGlmICghdDIuc29tZSgodDMpID0+IHRoaXMuaGFzUGx1Z2luKHQzKSkpCiAgICAgICAgICAgICAgdGhyb3cgdGhpcy5yYWlzZVdpdGhEYXRhKGUyICE9IG51bGwgPyBlMiA6IHRoaXMuc3RhdGUuc3RhcnQsIHsgbWlzc2luZ1BsdWdpbjogdDIgfSwgIlRoaXMgZXhwZXJpbWVudGFsIHN5bnRheCByZXF1aXJlcyBlbmFibGluZyBvbmUgb2YgdGhlIGZvbGxvd2luZyBwYXJzZXIgcGx1Z2luKHMpOiAnIi5jb25jYXQodDIuam9pbigiLCAiKSwgIiciKSk7CiAgICAgICAgICB9CiAgICAgICAgICB0cnlQYXJzZSh0MikgewogICAgICAgICAgICBsZXQgZTIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IHRoaXMuc3RhdGUuY2xvbmUoKTsKICAgICAgICAgICAgY29uc3QgczIgPSB7IG5vZGU6IG51bGwgfTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBjb25zdCByMiA9IHQyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgbGV0IHQzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMF0gOiBudWxsOwogICAgICAgICAgICAgICAgdGhyb3cgczIubm9kZSA9IHQzLCBzMjsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5lcnJvcnMubGVuZ3RoID4gZTIuZXJyb3JzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXRlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUgPSBlMiwgdGhpcy5zdGF0ZS50b2tlbnNMZW5ndGggPSB0My50b2tlbnNMZW5ndGgsIHsgbm9kZTogcjIsIGVycm9yOiB0My5lcnJvcnNbZTIuZXJyb3JzLmxlbmd0aF0sIHRocm93bjogZmFsc2UsIGFib3J0ZWQ6IGZhbHNlLCBmYWlsU3RhdGU6IHQzIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB7IG5vZGU6IHIyLCBlcnJvcjogbnVsbCwgdGhyb3duOiBmYWxzZSwgYWJvcnRlZDogZmFsc2UsIGZhaWxTdGF0ZTogbnVsbCB9OwogICAgICAgICAgICB9IGNhdGNoICh0MykgewogICAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGF0ZTsKICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9IGUyLCB0MyBpbnN0YW5jZW9mIFN5bnRheEVycm9yKQogICAgICAgICAgICAgICAgcmV0dXJuIHsgbm9kZTogbnVsbCwgZXJyb3I6IHQzLCB0aHJvd246IHRydWUsIGFib3J0ZWQ6IGZhbHNlLCBmYWlsU3RhdGU6IHIyIH07CiAgICAgICAgICAgICAgaWYgKHQzID09PSBzMikKICAgICAgICAgICAgICAgIHJldHVybiB7IG5vZGU6IHMyLm5vZGUsIGVycm9yOiBudWxsLCB0aHJvd246IGZhbHNlLCBhYm9ydGVkOiB0cnVlLCBmYWlsU3RhdGU6IHIyIH07CiAgICAgICAgICAgICAgdGhyb3cgdDM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGNoZWNrRXhwcmVzc2lvbkVycm9ycyh0MiwgZTIpIHsKICAgICAgICAgICAgaWYgKCF0MikKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHsgc2hvcnRoYW5kQXNzaWduOiBzMiwgZG91YmxlUHJvdG86IHIyLCBvcHRpb25hbFBhcmFtZXRlcnM6IGkyIH0gPSB0MiwgbjIgPSBzMiArIHIyICsgaTIgPiAtMzsKICAgICAgICAgICAgaWYgKCFlMikKICAgICAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgICAgIG4yICYmIChzMiA+PSAwICYmIHRoaXMudW5leHBlY3RlZChzMiksIHIyID49IDAgJiYgdGhpcy5yYWlzZShyMiwgRGMuRHVwbGljYXRlUHJvdG8pLCBpMiA+PSAwICYmIHRoaXMudW5leHBlY3RlZChpMikpOwogICAgICAgICAgfQogICAgICAgICAgaXNMaXRlcmFsUHJvcGVydHlOYW1lKCkgewogICAgICAgICAgICByZXR1cm4gemModGhpcy5zdGF0ZS50eXBlKTsKICAgICAgICAgIH0KICAgICAgICAgIGlzUHJpdmF0ZU5hbWUodDIpIHsKICAgICAgICAgICAgcmV0dXJuIHQyLnR5cGUgPT09ICJQcml2YXRlTmFtZSI7CiAgICAgICAgICB9CiAgICAgICAgICBnZXRQcml2YXRlTmFtZVNWKHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0Mi5pZC5uYW1lOwogICAgICAgICAgfQogICAgICAgICAgaGFzUHJvcGVydHlBc1ByaXZhdGVOYW1lKHQyKSB7CiAgICAgICAgICAgIHJldHVybiAodDIudHlwZSA9PT0gIk1lbWJlckV4cHJlc3Npb24iIHx8IHQyLnR5cGUgPT09ICJPcHRpb25hbE1lbWJlckV4cHJlc3Npb24iKSAmJiB0aGlzLmlzUHJpdmF0ZU5hbWUodDIucHJvcGVydHkpOwogICAgICAgICAgfQogICAgICAgICAgaXNPcHRpb25hbENoYWluKHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0Mi50eXBlID09PSAiT3B0aW9uYWxNZW1iZXJFeHByZXNzaW9uIiB8fCB0Mi50eXBlID09PSAiT3B0aW9uYWxDYWxsRXhwcmVzc2lvbiI7CiAgICAgICAgICB9CiAgICAgICAgICBpc09iamVjdFByb3BlcnR5KHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0Mi50eXBlID09PSAiT2JqZWN0UHJvcGVydHkiOwogICAgICAgICAgfQogICAgICAgICAgaXNPYmplY3RNZXRob2QodDIpIHsKICAgICAgICAgICAgcmV0dXJuIHQyLnR5cGUgPT09ICJPYmplY3RNZXRob2QiOwogICAgICAgICAgfQogICAgICAgICAgaW5pdGlhbGl6ZVNjb3BlcygpIHsKICAgICAgICAgICAgbGV0IHQyID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMF0gOiB0aGlzLm9wdGlvbnMuc291cmNlVHlwZSA9PT0gIm1vZHVsZSI7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGF0ZS5sYWJlbHM7CiAgICAgICAgICAgIHRoaXMuc3RhdGUubGFiZWxzID0gW107CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5leHBvcnRlZElkZW50aWZpZXJzOwogICAgICAgICAgICB0aGlzLmV4cG9ydGVkSWRlbnRpZmllcnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpOwogICAgICAgICAgICBjb25zdCByMiA9IHRoaXMuaW5Nb2R1bGU7CiAgICAgICAgICAgIHRoaXMuaW5Nb2R1bGUgPSB0MjsKICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLnNjb3BlLCBuMiA9IHRoaXMuZ2V0U2NvcGVIYW5kbGVyKCk7CiAgICAgICAgICAgIHRoaXMuc2NvcGUgPSBuZXcgbjIodGhpcy5yYWlzZS5iaW5kKHRoaXMpLCB0aGlzLmluTW9kdWxlKTsKICAgICAgICAgICAgY29uc3QgYTIgPSB0aGlzLnByb2RQYXJhbTsKICAgICAgICAgICAgdGhpcy5wcm9kUGFyYW0gPSBuZXcgT2woKTsKICAgICAgICAgICAgY29uc3QgbzIgPSB0aGlzLmNsYXNzU2NvcGU7CiAgICAgICAgICAgIHRoaXMuY2xhc3NTY29wZSA9IG5ldyBObCh0aGlzLnJhaXNlLmJpbmQodGhpcykpOwogICAgICAgICAgICBjb25zdCB1MiA9IHRoaXMuZXhwcmVzc2lvblNjb3BlOwogICAgICAgICAgICByZXR1cm4gdGhpcy5leHByZXNzaW9uU2NvcGUgPSBuZXcga2wodGhpcy5yYWlzZS5iaW5kKHRoaXMpKSwgKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuc3RhdGUubGFiZWxzID0gZTIsIHRoaXMuZXhwb3J0ZWRJZGVudGlmaWVycyA9IHMyLCB0aGlzLmluTW9kdWxlID0gcjIsIHRoaXMuc2NvcGUgPSBpMiwgdGhpcy5wcm9kUGFyYW0gPSBhMiwgdGhpcy5jbGFzc1Njb3BlID0gbzIsIHRoaXMuZXhwcmVzc2lvblNjb3BlID0gdTI7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICBlbnRlckluaXRpYWxTY29wZXMoKSB7CiAgICAgICAgICAgIGxldCB0MiA9IDA7CiAgICAgICAgICAgIHRoaXMuaW5Nb2R1bGUgJiYgKHQyIHw9IDIpLCB0aGlzLnNjb3BlLmVudGVyKDEpLCB0aGlzLnByb2RQYXJhbS5lbnRlcih0Mik7CiAgICAgICAgICB9CiAgICAgICAgfSB7CiAgICAgICAgICBzdGFydE5vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgamwodGhpcywgdGhpcy5zdGF0ZS5zdGFydCwgdGhpcy5zdGF0ZS5zdGFydExvYyk7CiAgICAgICAgICB9CiAgICAgICAgICBzdGFydE5vZGVBdCh0MiwgZTIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBqbCh0aGlzLCB0MiwgZTIpOwogICAgICAgICAgfQogICAgICAgICAgc3RhcnROb2RlQXROb2RlKHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXJ0Tm9kZUF0KHQyLnN0YXJ0LCB0Mi5sb2Muc3RhcnQpOwogICAgICAgICAgfQogICAgICAgICAgZmluaXNoTm9kZSh0MiwgZTIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZUF0KHQyLCBlMiwgdGhpcy5zdGF0ZS5sYXN0VG9rRW5kLCB0aGlzLnN0YXRlLmxhc3RUb2tFbmRMb2MpOwogICAgICAgICAgfQogICAgICAgICAgZmluaXNoTm9kZUF0KHQyLCBlMiwgczIsIHIyKSB7CiAgICAgICAgICAgIHJldHVybiB0Mi50eXBlID0gZTIsIHQyLmVuZCA9IHMyLCB0Mi5sb2MuZW5kID0gcjIsIHRoaXMub3B0aW9ucy5yYW5nZXMgJiYgKHQyLnJhbmdlWzFdID0gczIpLCB0aGlzLm9wdGlvbnMuYXR0YWNoQ29tbWVudCAmJiB0aGlzLnByb2Nlc3NDb21tZW50KHQyKSwgdDI7CiAgICAgICAgICB9CiAgICAgICAgICByZXNldFN0YXJ0TG9jYXRpb24odDIsIGUyLCBzMikgewogICAgICAgICAgICB0Mi5zdGFydCA9IGUyLCB0Mi5sb2Muc3RhcnQgPSBzMiwgdGhpcy5vcHRpb25zLnJhbmdlcyAmJiAodDIucmFuZ2VbMF0gPSBlMik7CiAgICAgICAgICB9CiAgICAgICAgICByZXNldEVuZExvY2F0aW9uKHQyKSB7CiAgICAgICAgICAgIGxldCBlMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDogdGhpcy5zdGF0ZS5sYXN0VG9rRW5kLCBzMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzJdIDogdGhpcy5zdGF0ZS5sYXN0VG9rRW5kTG9jOwogICAgICAgICAgICB0Mi5lbmQgPSBlMiwgdDIubG9jLmVuZCA9IHMyLCB0aGlzLm9wdGlvbnMucmFuZ2VzICYmICh0Mi5yYW5nZVsxXSA9IGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlc2V0U3RhcnRMb2NhdGlvbkZyb21Ob2RlKHQyLCBlMikgewogICAgICAgICAgICB0aGlzLnJlc2V0U3RhcnRMb2NhdGlvbih0MiwgZTIuc3RhcnQsIGUyLmxvYy5zdGFydCk7CiAgICAgICAgICB9CiAgICAgICAgfSB7CiAgICAgICAgICB0b0Fzc2lnbmFibGUodDIpIHsKICAgICAgICAgICAgbGV0IGUyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgJiYgYXJndW1lbnRzWzFdOwogICAgICAgICAgICB2YXIgczIsIHIyOwogICAgICAgICAgICBsZXQgaTI7CiAgICAgICAgICAgIHN3aXRjaCAoKHQyLnR5cGUgPT09ICJQYXJlbnRoZXNpemVkRXhwcmVzc2lvbiIgfHwgKHMyID0gdDIuZXh0cmEpICE9IG51bGwgJiYgczIucGFyZW50aGVzaXplZCkgJiYgKGkyID0gRGQodDIpLCBlMiA/IGkyLnR5cGUgPT09ICJJZGVudGlmaWVyIiA/IHRoaXMuZXhwcmVzc2lvblNjb3BlLnJlY29yZFBhcmVudGhlc2l6ZWRJZGVudGlmaWVyRXJyb3IodDIuc3RhcnQsIERjLkludmFsaWRQYXJlbnRoZXNpemVkQXNzaWdubWVudCkgOiBpMi50eXBlICE9PSAiTWVtYmVyRXhwcmVzc2lvbiIgJiYgdGhpcy5yYWlzZSh0Mi5zdGFydCwgRGMuSW52YWxpZFBhcmVudGhlc2l6ZWRBc3NpZ25tZW50KSA6IHRoaXMucmFpc2UodDIuc3RhcnQsIERjLkludmFsaWRQYXJlbnRoZXNpemVkQXNzaWdubWVudCkpLCB0Mi50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiSWRlbnRpZmllciI6CiAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0UGF0dGVybiI6CiAgICAgICAgICAgICAgY2FzZSAiQXJyYXlQYXR0ZXJuIjoKICAgICAgICAgICAgICBjYXNlICJBc3NpZ25tZW50UGF0dGVybiI6CiAgICAgICAgICAgICAgY2FzZSAiUmVzdEVsZW1lbnQiOgogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICB0Mi50eXBlID0gIk9iamVjdFBhdHRlcm4iOwogICAgICAgICAgICAgICAgZm9yIChsZXQgczMgPSAwLCByMyA9IHQyLnByb3BlcnRpZXMubGVuZ3RoLCBpMyA9IHIzIC0gMTsgczMgPCByMzsgczMrKykgewogICAgICAgICAgICAgICAgICB2YXIgbjI7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHI0ID0gdDIucHJvcGVydGllc1tzM10sIGEyID0gczMgPT09IGkzOwogICAgICAgICAgICAgICAgICB0aGlzLnRvQXNzaWduYWJsZU9iamVjdEV4cHJlc3Npb25Qcm9wKHI0LCBhMiwgZTIpLCBhMiAmJiByNC50eXBlID09PSAiUmVzdEVsZW1lbnQiICYmIChuMiA9IHQyLmV4dHJhKSAhPSBudWxsICYmIG4yLnRyYWlsaW5nQ29tbWEgJiYgdGhpcy5yYWlzZVJlc3ROb3RMYXN0KHQyLmV4dHJhLnRyYWlsaW5nQ29tbWEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0UHJvcGVydHkiOgogICAgICAgICAgICAgICAgdGhpcy50b0Fzc2lnbmFibGUodDIudmFsdWUsIGUyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIlNwcmVhZEVsZW1lbnQiOiB7CiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrVG9SZXN0Q29udmVyc2lvbih0MiksIHQyLnR5cGUgPSAiUmVzdEVsZW1lbnQiOwogICAgICAgICAgICAgICAgY29uc3QgczMgPSB0Mi5hcmd1bWVudDsKICAgICAgICAgICAgICAgIHRoaXMudG9Bc3NpZ25hYmxlKHMzLCBlMik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY2FzZSAiQXJyYXlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHQyLnR5cGUgPSAiQXJyYXlQYXR0ZXJuIiwgdGhpcy50b0Fzc2lnbmFibGVMaXN0KHQyLmVsZW1lbnRzLCAocjIgPSB0Mi5leHRyYSkgPT0gbnVsbCA/IHZvaWQgMCA6IHIyLnRyYWlsaW5nQ29tbWEsIGUyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIkFzc2lnbm1lbnRFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHQyLm9wZXJhdG9yICE9PSAiPSIgJiYgdGhpcy5yYWlzZSh0Mi5sZWZ0LmVuZCwgRGMuTWlzc2luZ0VxSW5Bc3NpZ25tZW50KSwgdDIudHlwZSA9ICJBc3NpZ25tZW50UGF0dGVybiIsIGRlbGV0ZSB0Mi5vcGVyYXRvciwgdGhpcy50b0Fzc2lnbmFibGUodDIubGVmdCwgZTIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiUGFyZW50aGVzaXplZEV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgdGhpcy50b0Fzc2lnbmFibGUoaTIsIGUyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgICB9CiAgICAgICAgICB0b0Fzc2lnbmFibGVPYmplY3RFeHByZXNzaW9uUHJvcCh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIGlmICh0Mi50eXBlID09PSAiT2JqZWN0TWV0aG9kIikgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gdDIua2luZCA9PT0gImdldCIgfHwgdDIua2luZCA9PT0gInNldCIgPyBEYy5QYXR0ZXJuSGFzQWNjZXNzb3IgOiBEYy5QYXR0ZXJuSGFzTWV0aG9kOwogICAgICAgICAgICAgIHRoaXMucmFpc2UodDIua2V5LnN0YXJ0LCBlMyk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIHQyLnR5cGUgIT09ICJTcHJlYWRFbGVtZW50IiB8fCBlMiA/IHRoaXMudG9Bc3NpZ25hYmxlKHQyLCBzMikgOiB0aGlzLnJhaXNlUmVzdE5vdExhc3QodDIuc3RhcnQpOwogICAgICAgICAgfQogICAgICAgICAgdG9Bc3NpZ25hYmxlTGlzdCh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIGxldCByMiA9IHQyLmxlbmd0aDsKICAgICAgICAgICAgaWYgKHIyKSB7CiAgICAgICAgICAgICAgY29uc3QgaTIgPSB0MltyMiAtIDFdOwogICAgICAgICAgICAgIGlmICgoaTIgPT0gbnVsbCA/IHZvaWQgMCA6IGkyLnR5cGUpID09PSAiUmVzdEVsZW1lbnQiKQogICAgICAgICAgICAgICAgLS1yMjsKICAgICAgICAgICAgICBlbHNlIGlmICgoaTIgPT0gbnVsbCA/IHZvaWQgMCA6IGkyLnR5cGUpID09PSAiU3ByZWFkRWxlbWVudCIpIHsKICAgICAgICAgICAgICAgIGkyLnR5cGUgPSAiUmVzdEVsZW1lbnQiOwogICAgICAgICAgICAgICAgbGV0IHQzID0gaTIuYXJndW1lbnQ7CiAgICAgICAgICAgICAgICB0aGlzLnRvQXNzaWduYWJsZSh0MywgczIpLCB0MyA9IERkKHQzKSwgdDMudHlwZSAhPT0gIklkZW50aWZpZXIiICYmIHQzLnR5cGUgIT09ICJNZW1iZXJFeHByZXNzaW9uIiAmJiB0My50eXBlICE9PSAiQXJyYXlQYXR0ZXJuIiAmJiB0My50eXBlICE9PSAiT2JqZWN0UGF0dGVybiIgJiYgdGhpcy51bmV4cGVjdGVkKHQzLnN0YXJ0KSwgZTIgJiYgdGhpcy5yYWlzZVRyYWlsaW5nQ29tbWFBZnRlclJlc3QoZTIpLCAtLXIyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGxldCBlMyA9IDA7IGUzIDwgcjI7IGUzKyspIHsKICAgICAgICAgICAgICBjb25zdCByMyA9IHQyW2UzXTsKICAgICAgICAgICAgICByMyAmJiAodGhpcy50b0Fzc2lnbmFibGUocjMsIHMyKSwgcjMudHlwZSA9PT0gIlJlc3RFbGVtZW50IiAmJiB0aGlzLnJhaXNlUmVzdE5vdExhc3QocjMuc3RhcnQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgICB9CiAgICAgICAgICBpc0Fzc2lnbmFibGUodDIsIGUyKSB7CiAgICAgICAgICAgIHN3aXRjaCAodDIudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgIklkZW50aWZpZXIiOgogICAgICAgICAgICAgIGNhc2UgIk9iamVjdFBhdHRlcm4iOgogICAgICAgICAgICAgIGNhc2UgIkFycmF5UGF0dGVybiI6CiAgICAgICAgICAgICAgY2FzZSAiQXNzaWdubWVudFBhdHRlcm4iOgogICAgICAgICAgICAgIGNhc2UgIlJlc3RFbGVtZW50IjoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIGNhc2UgIk9iamVjdEV4cHJlc3Npb24iOiB7CiAgICAgICAgICAgICAgICBjb25zdCBlMyA9IHQyLnByb3BlcnRpZXMubGVuZ3RoIC0gMTsKICAgICAgICAgICAgICAgIHJldHVybiB0Mi5wcm9wZXJ0aWVzLmV2ZXJ5KCh0MywgczIpID0+IHQzLnR5cGUgIT09ICJPYmplY3RNZXRob2QiICYmIChzMiA9PT0gZTMgfHwgdDMudHlwZSAhPT0gIlNwcmVhZEVsZW1lbnQiKSAmJiB0aGlzLmlzQXNzaWduYWJsZSh0MykpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlICJPYmplY3RQcm9wZXJ0eSI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc0Fzc2lnbmFibGUodDIudmFsdWUpOwogICAgICAgICAgICAgIGNhc2UgIlNwcmVhZEVsZW1lbnQiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNBc3NpZ25hYmxlKHQyLmFyZ3VtZW50KTsKICAgICAgICAgICAgICBjYXNlICJBcnJheUV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgcmV0dXJuIHQyLmVsZW1lbnRzLmV2ZXJ5KCh0MykgPT4gdDMgPT09IG51bGwgfHwgdGhpcy5pc0Fzc2lnbmFibGUodDMpKTsKICAgICAgICAgICAgICBjYXNlICJBc3NpZ25tZW50RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdDIub3BlcmF0b3IgPT09ICI9IjsKICAgICAgICAgICAgICBjYXNlICJQYXJlbnRoZXNpemVkRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc0Fzc2lnbmFibGUodDIuZXhwcmVzc2lvbik7CiAgICAgICAgICAgICAgY2FzZSAiTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgY2FzZSAiT3B0aW9uYWxNZW1iZXJFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiAhZTI7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdG9SZWZlcmVuY2VkTGlzdCh0MiwgZTIpIHsKICAgICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgICAgfQogICAgICAgICAgdG9SZWZlcmVuY2VkTGlzdERlZXAodDIsIGUyKSB7CiAgICAgICAgICAgIHRoaXMudG9SZWZlcmVuY2VkTGlzdCh0MiwgZTIpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIHQyKQogICAgICAgICAgICAgIChlMyA9PSBudWxsID8gdm9pZCAwIDogZTMudHlwZSkgPT09ICJBcnJheUV4cHJlc3Npb24iICYmIHRoaXMudG9SZWZlcmVuY2VkTGlzdERlZXAoZTMuZWxlbWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VTcHJlYWQodDIsIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCBzMi5hcmd1bWVudCA9IHRoaXMucGFyc2VNYXliZUFzc2lnbkFsbG93SW4odDIsIHZvaWQgMCwgZTIpLCB0aGlzLmZpbmlzaE5vZGUoczIsICJTcHJlYWRFbGVtZW50Iik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZVJlc3RCaW5kaW5nKCkgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdDIuYXJndW1lbnQgPSB0aGlzLnBhcnNlQmluZGluZ0F0b20oKSwgdGhpcy5maW5pc2hOb2RlKHQyLCAiUmVzdEVsZW1lbnQiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQmluZGluZ0F0b20oKSB7CiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zdGF0ZS50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAwOiB7CiAgICAgICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHQyLmVsZW1lbnRzID0gdGhpcy5wYXJzZUJpbmRpbmdMaXN0KDMsIDkzLCB0cnVlKSwgdGhpcy5maW5pc2hOb2RlKHQyLCAiQXJyYXlQYXR0ZXJuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlT2JqZWN0TGlrZSg4LCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUlkZW50aWZpZXIoKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQmluZGluZ0xpc3QodDIsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgY29uc3QgaTIgPSBbXTsKICAgICAgICAgICAgbGV0IG4yID0gdHJ1ZTsKICAgICAgICAgICAgZm9yICg7ICF0aGlzLmVhdCh0Mik7ICkKICAgICAgICAgICAgICBpZiAobjIgPyBuMiA9IGZhbHNlIDogdGhpcy5leHBlY3QoMTIpLCBzMiAmJiB0aGlzLm1hdGNoKDEyKSkKICAgICAgICAgICAgICAgIGkyLnB1c2gobnVsbCk7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5lYXQodDIpKQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDIxKSkgewogICAgICAgICAgICAgICAgICBpMi5wdXNoKHRoaXMucGFyc2VBc3NpZ25hYmxlTGlzdEl0ZW1UeXBlcyh0aGlzLnBhcnNlUmVzdEJpbmRpbmcoKSkpLCB0aGlzLmNoZWNrQ29tbWFBZnRlclJlc3QoZTIpLCB0aGlzLmV4cGVjdCh0Mik7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjb25zdCB0MyA9IFtdOwogICAgICAgICAgICAgICAgICBmb3IgKHRoaXMubWF0Y2goMjQpICYmIHRoaXMuaGFzUGx1Z2luKCJkZWNvcmF0b3JzIikgJiYgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0LCBEYy5VbnN1cHBvcnRlZFBhcmFtZXRlckRlY29yYXRvcik7IHRoaXMubWF0Y2goMjQpOyApCiAgICAgICAgICAgICAgICAgICAgdDMucHVzaCh0aGlzLnBhcnNlRGVjb3JhdG9yKCkpOwogICAgICAgICAgICAgICAgICBpMi5wdXNoKHRoaXMucGFyc2VBc3NpZ25hYmxlTGlzdEl0ZW0ocjIsIHQzKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaTI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUJpbmRpbmdSZXN0UHJvcGVydHkodDIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0Mi5hcmd1bWVudCA9IHRoaXMucGFyc2VJZGVudGlmaWVyKCksIHRoaXMuY2hlY2tDb21tYUFmdGVyUmVzdCgxMjUpLCB0aGlzLmZpbmlzaE5vZGUodDIsICJSZXN0RWxlbWVudCIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VCaW5kaW5nUHJvcGVydHkoKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5zdGFydE5vZGUoKSwgeyB0eXBlOiBlMiwgc3RhcnQ6IHMyLCBzdGFydExvYzogcjIgfSA9IHRoaXMuc3RhdGU7CiAgICAgICAgICAgIHJldHVybiBlMiA9PT0gMjEgPyB0aGlzLnBhcnNlQmluZGluZ1Jlc3RQcm9wZXJ0eSh0MikgOiAodGhpcy5wYXJzZVByb3BlcnR5TmFtZSh0MiksIHQyLm1ldGhvZCA9IGZhbHNlLCB0aGlzLnBhcnNlT2JqUHJvcFZhbHVlKHQyLCBzMiwgcjIsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UpLCB0Mik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUFzc2lnbmFibGVMaXN0SXRlbSh0MiwgZTIpIHsKICAgICAgICAgICAgY29uc3QgczIgPSB0aGlzLnBhcnNlTWF5YmVEZWZhdWx0KCk7CiAgICAgICAgICAgIHRoaXMucGFyc2VBc3NpZ25hYmxlTGlzdEl0ZW1UeXBlcyhzMik7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5wYXJzZU1heWJlRGVmYXVsdChzMi5zdGFydCwgczIubG9jLnN0YXJ0LCBzMik7CiAgICAgICAgICAgIHJldHVybiBlMi5sZW5ndGggJiYgKHMyLmRlY29yYXRvcnMgPSBlMiksIHIyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VBc3NpZ25hYmxlTGlzdEl0ZW1UeXBlcyh0MikgewogICAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU1heWJlRGVmYXVsdCh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIHZhciByMiwgaTIsIG4yOwogICAgICAgICAgICBpZiAoZTIgPSAocjIgPSBlMikgIT0gbnVsbCA/IHIyIDogdGhpcy5zdGF0ZS5zdGFydExvYywgdDIgPSAoaTIgPSB0MikgIT0gbnVsbCA/IGkyIDogdGhpcy5zdGF0ZS5zdGFydCwgczIgPSAobjIgPSBzMikgIT0gbnVsbCA/IG4yIDogdGhpcy5wYXJzZUJpbmRpbmdBdG9tKCksICF0aGlzLmVhdCgyNykpCiAgICAgICAgICAgICAgcmV0dXJuIHMyOwogICAgICAgICAgICBjb25zdCBhMiA9IHRoaXMuc3RhcnROb2RlQXQodDIsIGUyKTsKICAgICAgICAgICAgcmV0dXJuIGEyLmxlZnQgPSBzMiwgYTIucmlnaHQgPSB0aGlzLnBhcnNlTWF5YmVBc3NpZ25BbGxvd0luKCksIHRoaXMuZmluaXNoTm9kZShhMiwgIkFzc2lnbm1lbnRQYXR0ZXJuIik7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0xWYWwodDIsIGUyKSB7CiAgICAgICAgICAgIGxldCBzMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzJdIDogNjQsIHIyID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgPyBhcmd1bWVudHNbM10gOiB2b2lkIDAsIGkyID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgPyBhcmd1bWVudHNbNF0gOiB2b2lkIDAsIG4yID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgJiYgYXJndW1lbnRzWzVdICE9PSB2b2lkIDAgJiYgYXJndW1lbnRzWzVdOwogICAgICAgICAgICBzd2l0Y2ggKHQyLnR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICJJZGVudGlmaWVyIjogewogICAgICAgICAgICAgICAgY29uc3QgeyBuYW1lOiBlMyB9ID0gdDI7CiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnN0cmljdCAmJiAobjIgPyBjbChlMywgdGhpcy5pbk1vZHVsZSkgOiBwbChlMykpICYmIHRoaXMucmFpc2UodDIuc3RhcnQsIHMyID09PSA2NCA/IERjLlN0cmljdEV2YWxBcmd1bWVudHMgOiBEYy5TdHJpY3RFdmFsQXJndW1lbnRzQmluZGluZywgZTMpLCByMiAmJiAocjIuaGFzKGUzKSA/IHRoaXMucmFpc2UodDIuc3RhcnQsIERjLlBhcmFtRHVwZSkgOiByMi5hZGQoZTMpKSwgaTIgJiYgZTMgPT09ICJsZXQiICYmIHRoaXMucmFpc2UodDIuc3RhcnQsIERjLkxldEluTGV4aWNhbEJpbmRpbmcpLCA2NCAmIHMyIHx8IHRoaXMuc2NvcGUuZGVjbGFyZU5hbWUoZTMsIHMyLCB0Mi5zdGFydCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY2FzZSAiTWVtYmVyRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICBzMiAhPT0gNjQgJiYgdGhpcy5yYWlzZSh0Mi5zdGFydCwgRGMuSW52YWxpZFByb3BlcnR5QmluZGluZ1BhdHRlcm4pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0UGF0dGVybiI6CiAgICAgICAgICAgICAgICBmb3IgKGxldCBlMyBvZiB0Mi5wcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzT2JqZWN0UHJvcGVydHkoZTMpKQogICAgICAgICAgICAgICAgICAgIGUzID0gZTMudmFsdWU7CiAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuaXNPYmplY3RNZXRob2QoZTMpKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrTFZhbChlMywgIm9iamVjdCBkZXN0cnVjdHVyaW5nIHBhdHRlcm4iLCBzMiwgcjIsIGkyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIkFycmF5UGF0dGVybiI6CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIHQyLmVsZW1lbnRzKQogICAgICAgICAgICAgICAgICBlMyAmJiB0aGlzLmNoZWNrTFZhbChlMywgImFycmF5IGRlc3RydWN0dXJpbmcgcGF0dGVybiIsIHMyLCByMiwgaTIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiQXNzaWdubWVudFBhdHRlcm4iOgogICAgICAgICAgICAgICAgdGhpcy5jaGVja0xWYWwodDIubGVmdCwgImFzc2lnbm1lbnQgcGF0dGVybiIsIHMyLCByMik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJSZXN0RWxlbWVudCI6CiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrTFZhbCh0Mi5hcmd1bWVudCwgInJlc3QgZWxlbWVudCIsIHMyLCByMik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJQYXJlbnRoZXNpemVkRXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrTFZhbCh0Mi5leHByZXNzaW9uLCAicGFyZW50aGVzaXplZCBleHByZXNzaW9uIiwgczIsIHIyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aGlzLnJhaXNlKHQyLnN0YXJ0LCBzMiA9PT0gNjQgPyBEYy5JbnZhbGlkTGhzIDogRGMuSW52YWxpZExoc0JpbmRpbmcsIGUyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY2hlY2tUb1Jlc3RDb252ZXJzaW9uKHQyKSB7CiAgICAgICAgICAgIHQyLmFyZ3VtZW50LnR5cGUgIT09ICJJZGVudGlmaWVyIiAmJiB0Mi5hcmd1bWVudC50eXBlICE9PSAiTWVtYmVyRXhwcmVzc2lvbiIgJiYgdGhpcy5yYWlzZSh0Mi5hcmd1bWVudC5zdGFydCwgRGMuSW52YWxpZFJlc3RBc3NpZ25tZW50UGF0dGVybik7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0NvbW1hQWZ0ZXJSZXN0KHQyKSB7CiAgICAgICAgICAgIHRoaXMubWF0Y2goMTIpICYmICh0aGlzLmxvb2thaGVhZENoYXJDb2RlKCkgPT09IHQyID8gdGhpcy5yYWlzZVRyYWlsaW5nQ29tbWFBZnRlclJlc3QodGhpcy5zdGF0ZS5zdGFydCkgOiB0aGlzLnJhaXNlUmVzdE5vdExhc3QodGhpcy5zdGF0ZS5zdGFydCkpOwogICAgICAgICAgfQogICAgICAgICAgcmFpc2VSZXN0Tm90TGFzdCh0MikgewogICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHQyLCBEYy5FbGVtZW50QWZ0ZXJSZXN0KTsKICAgICAgICAgIH0KICAgICAgICAgIHJhaXNlVHJhaWxpbmdDb21tYUFmdGVyUmVzdCh0MikgewogICAgICAgICAgICB0aGlzLnJhaXNlKHQyLCBEYy5SZXN0VHJhaWxpbmdDb21tYSk7CiAgICAgICAgICB9CiAgICAgICAgfSB7CiAgICAgICAgICBjaGVja1Byb3RvKHQyLCBlMiwgczIsIHIyKSB7CiAgICAgICAgICAgIGlmICh0Mi50eXBlID09PSAiU3ByZWFkRWxlbWVudCIgfHwgdGhpcy5pc09iamVjdE1ldGhvZCh0MikgfHwgdDIuY29tcHV0ZWQgfHwgdDIuc2hvcnRoYW5kKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgY29uc3QgaTIgPSB0Mi5rZXk7CiAgICAgICAgICAgIGlmICgoaTIudHlwZSA9PT0gIklkZW50aWZpZXIiID8gaTIubmFtZSA6IGkyLnZhbHVlKSA9PT0gIl9fcHJvdG9fXyIpIHsKICAgICAgICAgICAgICBpZiAoZTIpCiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB0aGlzLnJhaXNlKGkyLnN0YXJ0LCBEYy5SZWNvcmROb1Byb3RvKTsKICAgICAgICAgICAgICBzMi51c2VkICYmIChyMiA/IHIyLmRvdWJsZVByb3RvID09PSAtMSAmJiAocjIuZG91YmxlUHJvdG8gPSBpMi5zdGFydCkgOiB0aGlzLnJhaXNlKGkyLnN0YXJ0LCBEYy5EdXBsaWNhdGVQcm90bykpLCBzMi51c2VkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc2hvdWxkRXhpdERlc2NlbmRpbmcodDIsIGUyKSB7CiAgICAgICAgICAgIHJldHVybiB0Mi50eXBlID09PSAiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iICYmIHQyLnN0YXJ0ID09PSBlMjsKICAgICAgICAgIH0KICAgICAgICAgIGdldEV4cHJlc3Npb24oKSB7CiAgICAgICAgICAgIHRoaXMuZW50ZXJJbml0aWFsU2NvcGVzKCksIHRoaXMubmV4dFRva2VuKCk7CiAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5wYXJzZUV4cHJlc3Npb24oKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goMTI5KSB8fCB0aGlzLnVuZXhwZWN0ZWQoKSwgdGhpcy5maW5hbGl6ZVJlbWFpbmluZ0NvbW1lbnRzKCksIHQyLmNvbW1lbnRzID0gdGhpcy5zdGF0ZS5jb21tZW50cywgdDIuZXJyb3JzID0gdGhpcy5zdGF0ZS5lcnJvcnMsIHRoaXMub3B0aW9ucy50b2tlbnMgJiYgKHQyLnRva2VucyA9IHRoaXMudG9rZW5zKSwgdDI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUV4cHJlc3Npb24odDIsIGUyKSB7CiAgICAgICAgICAgIHJldHVybiB0MiA/IHRoaXMuZGlzYWxsb3dJbkFuZCgoKSA9PiB0aGlzLnBhcnNlRXhwcmVzc2lvbkJhc2UoZTIpKSA6IHRoaXMuYWxsb3dJbkFuZCgoKSA9PiB0aGlzLnBhcnNlRXhwcmVzc2lvbkJhc2UoZTIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRXhwcmVzc2lvbkJhc2UodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXRlLnN0YXJ0LCBzMiA9IHRoaXMuc3RhdGUuc3RhcnRMb2MsIHIyID0gdGhpcy5wYXJzZU1heWJlQXNzaWduKHQyKTsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goMTIpKSB7CiAgICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLnN0YXJ0Tm9kZUF0KGUyLCBzMik7CiAgICAgICAgICAgICAgZm9yIChpMi5leHByZXNzaW9ucyA9IFtyMl07IHRoaXMuZWF0KDEyKTsgKQogICAgICAgICAgICAgICAgaTIuZXhwcmVzc2lvbnMucHVzaCh0aGlzLnBhcnNlTWF5YmVBc3NpZ24odDIpKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy50b1JlZmVyZW5jZWRMaXN0KGkyLmV4cHJlc3Npb25zKSwgdGhpcy5maW5pc2hOb2RlKGkyLCAiU2VxdWVuY2VFeHByZXNzaW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VNYXliZUFzc2lnbkRpc2FsbG93SW4odDIsIGUyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpc2FsbG93SW5BbmQoKCkgPT4gdGhpcy5wYXJzZU1heWJlQXNzaWduKHQyLCBlMikpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VNYXliZUFzc2lnbkFsbG93SW4odDIsIGUyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmFsbG93SW5BbmQoKCkgPT4gdGhpcy5wYXJzZU1heWJlQXNzaWduKHQyLCBlMikpOwogICAgICAgICAgfQogICAgICAgICAgc2V0T3B0aW9uYWxQYXJhbWV0ZXJzRXJyb3IodDIsIGUyKSB7CiAgICAgICAgICAgIHZhciBzMjsKICAgICAgICAgICAgdDIub3B0aW9uYWxQYXJhbWV0ZXJzID0gKHMyID0gZTIgPT0gbnVsbCA/IHZvaWQgMCA6IGUyLnBvcykgIT0gbnVsbCA/IHMyIDogdGhpcy5zdGF0ZS5zdGFydDsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlTWF5YmVBc3NpZ24odDIsIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5zdGF0ZS5zdGFydCwgcjIgPSB0aGlzLnN0YXRlLnN0YXJ0TG9jOwogICAgICAgICAgICBpZiAodGhpcy5pc0NvbnRleHR1YWwoOTkpICYmIHRoaXMucHJvZFBhcmFtLmhhc1lpZWxkKSB7CiAgICAgICAgICAgICAgbGV0IHQzID0gdGhpcy5wYXJzZVlpZWxkKCk7CiAgICAgICAgICAgICAgcmV0dXJuIGUyICYmICh0MyA9IGUyLmNhbGwodGhpcywgdDMsIHMyLCByMikpLCB0MzsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgaTI7CiAgICAgICAgICAgIHQyID8gaTIgPSBmYWxzZSA6ICh0MiA9IG5ldyBSbCgpLCBpMiA9IHRydWUpOwogICAgICAgICAgICBjb25zdCB7IHR5cGU6IG4yIH0gPSB0aGlzLnN0YXRlOwogICAgICAgICAgICAobjIgPT09IDEwIHx8IFVjKG4yKSkgJiYgKHRoaXMuc3RhdGUucG90ZW50aWFsQXJyb3dBdCA9IHRoaXMuc3RhdGUuc3RhcnQpOwogICAgICAgICAgICBsZXQgYTIgPSB0aGlzLnBhcnNlTWF5YmVDb25kaXRpb25hbCh0Mik7CiAgICAgICAgICAgIGlmIChlMiAmJiAoYTIgPSBlMi5jYWxsKHRoaXMsIGEyLCBzMiwgcjIpKSwgKG8yID0gdGhpcy5zdGF0ZS50eXBlKSA+PSAyNyAmJiBvMiA8PSAzMSkgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5zdGFydE5vZGVBdChzMiwgcjIpLCBpMyA9IHRoaXMuc3RhdGUudmFsdWU7CiAgICAgICAgICAgICAgcmV0dXJuIGUzLm9wZXJhdG9yID0gaTMsIHRoaXMubWF0Y2goMjcpID8gKGUzLmxlZnQgPSB0aGlzLnRvQXNzaWduYWJsZShhMiwgdHJ1ZSksIHQyLmRvdWJsZVByb3RvID49IHMyICYmICh0Mi5kb3VibGVQcm90byA9IC0xKSwgdDIuc2hvcnRoYW5kQXNzaWduID49IHMyICYmICh0Mi5zaG9ydGhhbmRBc3NpZ24gPSAtMSkpIDogZTMubGVmdCA9IGEyLCB0aGlzLmNoZWNrTFZhbChhMiwgImFzc2lnbm1lbnQgZXhwcmVzc2lvbiIpLCB0aGlzLm5leHQoKSwgZTMucmlnaHQgPSB0aGlzLnBhcnNlTWF5YmVBc3NpZ24oKSwgdGhpcy5maW5pc2hOb2RlKGUzLCAiQXNzaWdubWVudEV4cHJlc3Npb24iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbzI7CiAgICAgICAgICAgIHJldHVybiBpMiAmJiB0aGlzLmNoZWNrRXhwcmVzc2lvbkVycm9ycyh0MiwgdHJ1ZSksIGEyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VNYXliZUNvbmRpdGlvbmFsKHQyKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGF0ZS5zdGFydCwgczIgPSB0aGlzLnN0YXRlLnN0YXJ0TG9jLCByMiA9IHRoaXMuc3RhdGUucG90ZW50aWFsQXJyb3dBdCwgaTIgPSB0aGlzLnBhcnNlRXhwck9wcyh0Mik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNob3VsZEV4aXREZXNjZW5kaW5nKGkyLCByMikgPyBpMiA6IHRoaXMucGFyc2VDb25kaXRpb25hbChpMiwgZTIsIHMyLCB0Mik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNvbmRpdGlvbmFsKHQyLCBlMiwgczIsIHIyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmVhdCgxNykpIHsKICAgICAgICAgICAgICBjb25zdCByMyA9IHRoaXMuc3RhcnROb2RlQXQoZTIsIHMyKTsKICAgICAgICAgICAgICByZXR1cm4gcjMudGVzdCA9IHQyLCByMy5jb25zZXF1ZW50ID0gdGhpcy5wYXJzZU1heWJlQXNzaWduQWxsb3dJbigpLCB0aGlzLmV4cGVjdCgxNCksIHIzLmFsdGVybmF0ZSA9IHRoaXMucGFyc2VNYXliZUFzc2lnbigpLCB0aGlzLmZpbmlzaE5vZGUocjMsICJDb25kaXRpb25hbEV4cHJlc3Npb24iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU1heWJlVW5hcnlPclByaXZhdGUodDIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goMTI4KSA/IHRoaXMucGFyc2VQcml2YXRlTmFtZSgpIDogdGhpcy5wYXJzZU1heWJlVW5hcnkodDIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHByT3BzKHQyKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGF0ZS5zdGFydCwgczIgPSB0aGlzLnN0YXRlLnN0YXJ0TG9jLCByMiA9IHRoaXMuc3RhdGUucG90ZW50aWFsQXJyb3dBdCwgaTIgPSB0aGlzLnBhcnNlTWF5YmVVbmFyeU9yUHJpdmF0ZSh0Mik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNob3VsZEV4aXREZXNjZW5kaW5nKGkyLCByMikgPyBpMiA6IHRoaXMucGFyc2VFeHByT3AoaTIsIGUyLCBzMiwgLTEpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHByT3AodDIsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgaWYgKHRoaXMuaXNQcml2YXRlTmFtZSh0MikpIHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IHRoaXMuZ2V0UHJpdmF0ZU5hbWVTVih0MiksIHsgc3RhcnQ6IHMzIH0gPSB0MjsKICAgICAgICAgICAgICAocjIgPj0gS2MoNTIpIHx8ICF0aGlzLnByb2RQYXJhbS5oYXNJbiB8fCAhdGhpcy5tYXRjaCg1MikpICYmIHRoaXMucmFpc2UoczMsIERjLlByaXZhdGVJbkV4cGVjdGVkSW4sIGUzKSwgdGhpcy5jbGFzc1Njb3BlLnVzZVByaXZhdGVOYW1lKGUzLCBzMyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLnN0YXRlLnR5cGU7CiAgICAgICAgICAgIGlmICgobjIgPSBpMikgPj0gMzUgJiYgbjIgPD0gNTMgJiYgKHRoaXMucHJvZFBhcmFtLmhhc0luIHx8ICF0aGlzLm1hdGNoKDUyKSkpIHsKICAgICAgICAgICAgICBsZXQgbjMgPSBLYyhpMik7CiAgICAgICAgICAgICAgaWYgKG4zID4gcjIpIHsKICAgICAgICAgICAgICAgIGlmIChpMiA9PT0gMzUpIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZXhwZWN0UGx1Z2luKCJwaXBlbGluZU9wZXJhdG9yIiksIHRoaXMuc3RhdGUuaW5GU2hhcnBQaXBlbGluZURpcmVjdEJvZHkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrUGlwZWxpbmVBdEluZml4T3BlcmF0b3IodDIsIGUyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGEyID0gdGhpcy5zdGFydE5vZGVBdChlMiwgczIpOwogICAgICAgICAgICAgICAgYTIubGVmdCA9IHQyLCBhMi5vcGVyYXRvciA9IHRoaXMuc3RhdGUudmFsdWU7CiAgICAgICAgICAgICAgICBjb25zdCBvMiA9IGkyID09PSAzNyB8fCBpMiA9PT0gMzgsIHUyID0gaTIgPT09IDM2OwogICAgICAgICAgICAgICAgaWYgKHUyICYmIChuMyA9IEtjKDM4KSksIHRoaXMubmV4dCgpLCBpMiA9PT0gMzUgJiYgdGhpcy5nZXRQbHVnaW5PcHRpb24oInBpcGVsaW5lT3BlcmF0b3IiLCAicHJvcG9zYWwiKSA9PT0gIm1pbmltYWwiICYmIHRoaXMuc3RhdGUudHlwZSA9PT0gOTAgJiYgdGhpcy5wcm9kUGFyYW0uaGFzQXdhaXQpCiAgICAgICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UodGhpcy5zdGF0ZS5zdGFydCwgRGMuVW5leHBlY3RlZEF3YWl0QWZ0ZXJQaXBlbGluZUJvZHkpOwogICAgICAgICAgICAgICAgYTIucmlnaHQgPSB0aGlzLnBhcnNlRXhwck9wUmlnaHRFeHByKGkyLCBuMyksIHRoaXMuZmluaXNoTm9kZShhMiwgbzIgfHwgdTIgPyAiTG9naWNhbEV4cHJlc3Npb24iIDogIkJpbmFyeUV4cHJlc3Npb24iKTsKICAgICAgICAgICAgICAgIGNvbnN0IGgyID0gdGhpcy5zdGF0ZS50eXBlOwogICAgICAgICAgICAgICAgaWYgKHUyICYmIChoMiA9PT0gMzcgfHwgaDIgPT09IDM4KSB8fCBvMiAmJiBoMiA9PT0gMzYpCiAgICAgICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UodGhpcy5zdGF0ZS5zdGFydCwgRGMuTWl4aW5nQ29hbGVzY2VXaXRoTG9naWNhbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUV4cHJPcChhMiwgZTIsIHMyLCByMik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBuMjsKICAgICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHByT3BSaWdodEV4cHIodDIsIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5zdGF0ZS5zdGFydCwgcjIgPSB0aGlzLnN0YXRlLnN0YXJ0TG9jOwogICAgICAgICAgICBpZiAodDIgPT09IDM1KQogICAgICAgICAgICAgIHN3aXRjaCAodGhpcy5nZXRQbHVnaW5PcHRpb24oInBpcGVsaW5lT3BlcmF0b3IiLCAicHJvcG9zYWwiKSkgewogICAgICAgICAgICAgICAgY2FzZSAiaGFjayI6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLndpdGhUb3BpY0JpbmRpbmdDb250ZXh0KCgpID0+IHRoaXMucGFyc2VIYWNrUGlwZUJvZHkoKSk7CiAgICAgICAgICAgICAgICBjYXNlICJzbWFydCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLndpdGhUb3BpY0JpbmRpbmdDb250ZXh0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9kUGFyYW0uaGFzWWllbGQgJiYgdGhpcy5pc0NvbnRleHR1YWwoOTkpKQogICAgICAgICAgICAgICAgICAgICAgdGhyb3cgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0LCBEYy5QaXBlQm9keUlzVGlnaHRlciwgdGhpcy5zdGF0ZS52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VTbWFydFBpcGVsaW5lQm9keUluU3R5bGUodGhpcy5wYXJzZUV4cHJPcEJhc2VSaWdodEV4cHIodDIsIGUyKSwgczIsIHIyKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjYXNlICJmc2hhcnAiOgogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy53aXRoU29sb0F3YWl0UGVybWl0dGluZ0NvbnRleHQoKCkgPT4gdGhpcy5wYXJzZUZTaGFycFBpcGVsaW5lQm9keShlMikpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VFeHByT3BCYXNlUmlnaHRFeHByKHQyLCBlMik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUV4cHJPcEJhc2VSaWdodEV4cHIodDIsIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5zdGF0ZS5zdGFydCwgcjIgPSB0aGlzLnN0YXRlLnN0YXJ0TG9jOwogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUV4cHJPcCh0aGlzLnBhcnNlTWF5YmVVbmFyeU9yUHJpdmF0ZSgpLCBzMiwgcjIsIHQyID09PSA1MSA/IGUyIC0gMSA6IGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlSGFja1BpcGVCb2R5KCkgewogICAgICAgICAgICB2YXIgdDI7CiAgICAgICAgICAgIGNvbnN0IHsgc3RhcnQ6IGUyIH0gPSB0aGlzLnN0YXRlLCBzMiA9IHRoaXMucGFyc2VNYXliZUFzc2lnbigpOwogICAgICAgICAgICByZXR1cm4gIW1kLmhhcyhzMi50eXBlKSB8fCAodDIgPSBzMi5leHRyYSkgIT0gbnVsbCAmJiB0Mi5wYXJlbnRoZXNpemVkIHx8IHRoaXMucmFpc2UoZTIsIERjLlBpcGVVbnBhcmVudGhlc2l6ZWRCb2R5LCBtZC5nZXQoczIudHlwZSkpLCB0aGlzLnRvcGljUmVmZXJlbmNlV2FzVXNlZEluQ3VycmVudENvbnRleHQoKSB8fCB0aGlzLnJhaXNlKGUyLCBEYy5QaXBlVG9waWNVbnVzZWQpLCBzMjsKICAgICAgICAgIH0KICAgICAgICAgIGNoZWNrRXhwb25lbnRpYWxBZnRlclVuYXJ5KHQyKSB7CiAgICAgICAgICAgIHRoaXMubWF0Y2goNTEpICYmIHRoaXMucmFpc2UodDIuYXJndW1lbnQuc3RhcnQsIERjLlVuZXhwZWN0ZWRUb2tlblVuYXJ5RXhwb25lbnRpYXRpb24pOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VNYXliZVVuYXJ5KHQyLCBlMikgewogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhdGUuc3RhcnQsIHIyID0gdGhpcy5zdGF0ZS5zdGFydExvYywgaTIgPSB0aGlzLmlzQ29udGV4dHVhbCg5MCk7CiAgICAgICAgICAgIGlmIChpMiAmJiB0aGlzLmlzQXdhaXRBbGxvd2VkKCkpIHsKICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMucGFyc2VBd2FpdChzMiwgcjIpOwogICAgICAgICAgICAgIHJldHVybiBlMiB8fCB0aGlzLmNoZWNrRXhwb25lbnRpYWxBZnRlclVuYXJ5KHQzKSwgdDM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgbjIgPSB0aGlzLm1hdGNoKDMyKSwgYTIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICBpZiAobzIgPSB0aGlzLnN0YXRlLnR5cGUsIE9jW28yXSkgewogICAgICAgICAgICAgIGEyLm9wZXJhdG9yID0gdGhpcy5zdGF0ZS52YWx1ZSwgYTIucHJlZml4ID0gdHJ1ZSwgdGhpcy5tYXRjaCg2NikgJiYgdGhpcy5leHBlY3RQbHVnaW4oInRocm93RXhwcmVzc2lvbnMiKTsKICAgICAgICAgICAgICBjb25zdCBzMyA9IHRoaXMubWF0Y2goODMpOwogICAgICAgICAgICAgIGlmICh0aGlzLm5leHQoKSwgYTIuYXJndW1lbnQgPSB0aGlzLnBhcnNlTWF5YmVVbmFyeShudWxsLCB0cnVlKSwgdGhpcy5jaGVja0V4cHJlc3Npb25FcnJvcnModDIsIHRydWUpLCB0aGlzLnN0YXRlLnN0cmljdCAmJiBzMykgewogICAgICAgICAgICAgICAgY29uc3QgdDMgPSBhMi5hcmd1bWVudDsKICAgICAgICAgICAgICAgIHQzLnR5cGUgPT09ICJJZGVudGlmaWVyIiA/IHRoaXMucmFpc2UoYTIuc3RhcnQsIERjLlN0cmljdERlbGV0ZSkgOiB0aGlzLmhhc1Byb3BlcnR5QXNQcml2YXRlTmFtZSh0MykgJiYgdGhpcy5yYWlzZShhMi5zdGFydCwgRGMuRGVsZXRlUHJpdmF0ZUZpZWxkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCFuMikKICAgICAgICAgICAgICAgIHJldHVybiBlMiB8fCB0aGlzLmNoZWNrRXhwb25lbnRpYWxBZnRlclVuYXJ5KGEyKSwgdGhpcy5maW5pc2hOb2RlKGEyLCAiVW5hcnlFeHByZXNzaW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG8yOwogICAgICAgICAgICBjb25zdCB1MiA9IHRoaXMucGFyc2VVcGRhdGUoYTIsIG4yLCB0Mik7CiAgICAgICAgICAgIGlmIChpMikgewogICAgICAgICAgICAgIGNvbnN0IHsgdHlwZTogdDMgfSA9IHRoaXMuc3RhdGU7CiAgICAgICAgICAgICAgaWYgKCh0aGlzLmhhc1BsdWdpbigidjhpbnRyaW5zaWMiKSA/IEhjKHQzKSA6IEhjKHQzKSAmJiAhdGhpcy5tYXRjaCg0OCkpICYmICF0aGlzLmlzQW1iaWd1b3VzQXdhaXQoKSkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJhaXNlT3ZlcndyaXRlKHMyLCBEYy5Bd2FpdE5vdEluQXN5bmNDb250ZXh0KSwgdGhpcy5wYXJzZUF3YWl0KHMyLCByMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHUyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VVcGRhdGUodDIsIGUyLCBzMikgewogICAgICAgICAgICBpZiAoZTIpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tMVmFsKHQyLmFyZ3VtZW50LCAicHJlZml4IG9wZXJhdGlvbiIpLCB0aGlzLmZpbmlzaE5vZGUodDIsICJVcGRhdGVFeHByZXNzaW9uIik7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGF0ZS5zdGFydCwgaTIgPSB0aGlzLnN0YXRlLnN0YXJ0TG9jOwogICAgICAgICAgICBsZXQgbjIgPSB0aGlzLnBhcnNlRXhwclN1YnNjcmlwdHMoczIpOwogICAgICAgICAgICBpZiAodGhpcy5jaGVja0V4cHJlc3Npb25FcnJvcnMoczIsIGZhbHNlKSkKICAgICAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgICAgIGZvciAoOyB0aGlzLnN0YXRlLnR5cGUgPT09IDMyICYmICF0aGlzLmNhbkluc2VydFNlbWljb2xvbigpOyApIHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhcnROb2RlQXQocjIsIGkyKTsKICAgICAgICAgICAgICB0My5vcGVyYXRvciA9IHRoaXMuc3RhdGUudmFsdWUsIHQzLnByZWZpeCA9IGZhbHNlLCB0My5hcmd1bWVudCA9IG4yLCB0aGlzLmNoZWNrTFZhbChuMiwgInBvc3RmaXggb3BlcmF0aW9uIiksIHRoaXMubmV4dCgpLCBuMiA9IHRoaXMuZmluaXNoTm9kZSh0MywgIlVwZGF0ZUV4cHJlc3Npb24iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUV4cHJTdWJzY3JpcHRzKHQyKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGF0ZS5zdGFydCwgczIgPSB0aGlzLnN0YXRlLnN0YXJ0TG9jLCByMiA9IHRoaXMuc3RhdGUucG90ZW50aWFsQXJyb3dBdCwgaTIgPSB0aGlzLnBhcnNlRXhwckF0b20odDIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zaG91bGRFeGl0RGVzY2VuZGluZyhpMiwgcjIpID8gaTIgOiB0aGlzLnBhcnNlU3Vic2NyaXB0cyhpMiwgZTIsIHMyKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlU3Vic2NyaXB0cyh0MiwgZTIsIHMyLCByMikgewogICAgICAgICAgICBjb25zdCBpMiA9IHsgb3B0aW9uYWxDaGFpbk1lbWJlcjogZmFsc2UsIG1heWJlQXN5bmNBcnJvdzogdGhpcy5hdFBvc3NpYmxlQXN5bmNBcnJvdyh0MiksIHN0b3A6IGZhbHNlIH07CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICB0MiA9IHRoaXMucGFyc2VTdWJzY3JpcHQodDIsIGUyLCBzMiwgcjIsIGkyKSwgaTIubWF5YmVBc3luY0Fycm93ID0gZmFsc2U7CiAgICAgICAgICAgIH0gd2hpbGUgKCFpMi5zdG9wKTsKICAgICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VTdWJzY3JpcHQodDIsIGUyLCBzMiwgcjIsIGkyKSB7CiAgICAgICAgICAgIGlmICghcjIgJiYgdGhpcy5lYXQoMTUpKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlQmluZCh0MiwgZTIsIHMyLCByMiwgaTIpOwogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCgyMikpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24odDIsIGUyLCBzMiwgaTIpOwogICAgICAgICAgICBsZXQgbjIgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goMTgpKSB7CiAgICAgICAgICAgICAgaWYgKHIyICYmIHRoaXMubG9va2FoZWFkQ2hhckNvZGUoKSA9PT0gNDApCiAgICAgICAgICAgICAgICByZXR1cm4gaTIuc3RvcCA9IHRydWUsIHQyOwogICAgICAgICAgICAgIGkyLm9wdGlvbmFsQ2hhaW5NZW1iZXIgPSBuMiA9IHRydWUsIHRoaXMubmV4dCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghcjIgJiYgdGhpcy5tYXRjaCgxMCkpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VDb3ZlckNhbGxBbmRBc3luY0Fycm93SGVhZCh0MiwgZTIsIHMyLCBpMiwgbjIpOwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc3QgcjMgPSB0aGlzLmVhdCgwKTsKICAgICAgICAgICAgICByZXR1cm4gcjMgfHwgbjIgfHwgdGhpcy5lYXQoMTYpID8gdGhpcy5wYXJzZU1lbWJlcih0MiwgZTIsIHMyLCBpMiwgcjMsIG4yKSA6IChpMi5zdG9wID0gdHJ1ZSwgdDIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU1lbWJlcih0MiwgZTIsIHMyLCByMiwgaTIsIG4yKSB7CiAgICAgICAgICAgIGNvbnN0IGEyID0gdGhpcy5zdGFydE5vZGVBdChlMiwgczIpOwogICAgICAgICAgICBhMi5vYmplY3QgPSB0MiwgYTIuY29tcHV0ZWQgPSBpMjsKICAgICAgICAgICAgY29uc3QgbzIgPSAhaTIgJiYgdGhpcy5tYXRjaCgxMjgpICYmIHRoaXMuc3RhdGUudmFsdWUsIHUyID0gaTIgPyB0aGlzLnBhcnNlRXhwcmVzc2lvbigpIDogbzIgPyB0aGlzLnBhcnNlUHJpdmF0ZU5hbWUoKSA6IHRoaXMucGFyc2VJZGVudGlmaWVyKHRydWUpOwogICAgICAgICAgICByZXR1cm4gbzIgIT09IGZhbHNlICYmIChhMi5vYmplY3QudHlwZSA9PT0gIlN1cGVyIiAmJiB0aGlzLnJhaXNlKGUyLCBEYy5TdXBlclByaXZhdGVGaWVsZCksIHRoaXMuY2xhc3NTY29wZS51c2VQcml2YXRlTmFtZShvMiwgdTIuc3RhcnQpKSwgYTIucHJvcGVydHkgPSB1MiwgaTIgJiYgdGhpcy5leHBlY3QoMyksIHIyLm9wdGlvbmFsQ2hhaW5NZW1iZXIgPyAoYTIub3B0aW9uYWwgPSBuMiwgdGhpcy5maW5pc2hOb2RlKGEyLCAiT3B0aW9uYWxNZW1iZXJFeHByZXNzaW9uIikpIDogdGhpcy5maW5pc2hOb2RlKGEyLCAiTWVtYmVyRXhwcmVzc2lvbiIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VCaW5kKHQyLCBlMiwgczIsIHIyLCBpMikgewogICAgICAgICAgICBjb25zdCBuMiA9IHRoaXMuc3RhcnROb2RlQXQoZTIsIHMyKTsKICAgICAgICAgICAgcmV0dXJuIG4yLm9iamVjdCA9IHQyLCBuMi5jYWxsZWUgPSB0aGlzLnBhcnNlTm9DYWxsRXhwcigpLCBpMi5zdG9wID0gdHJ1ZSwgdGhpcy5wYXJzZVN1YnNjcmlwdHModGhpcy5maW5pc2hOb2RlKG4yLCAiQmluZEV4cHJlc3Npb24iKSwgZTIsIHMyLCByMik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNvdmVyQ2FsbEFuZEFzeW5jQXJyb3dIZWFkKHQyLCBlMiwgczIsIHIyLCBpMikgewogICAgICAgICAgICBjb25zdCBuMiA9IHRoaXMuc3RhdGUubWF5YmVJbkFycm93UGFyYW1ldGVyczsKICAgICAgICAgICAgbGV0IGEyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5tYXliZUluQXJyb3dQYXJhbWV0ZXJzID0gdHJ1ZSwgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgIGxldCBvMiA9IHRoaXMuc3RhcnROb2RlQXQoZTIsIHMyKTsKICAgICAgICAgICAgcmV0dXJuIG8yLmNhbGxlZSA9IHQyLCByMi5tYXliZUFzeW5jQXJyb3cgJiYgKHRoaXMuZXhwcmVzc2lvblNjb3BlLmVudGVyKG5ldyB2bCgyKSksIGEyID0gbmV3IFJsKCkpLCByMi5vcHRpb25hbENoYWluTWVtYmVyICYmIChvMi5vcHRpb25hbCA9IGkyKSwgbzIuYXJndW1lbnRzID0gaTIgPyB0aGlzLnBhcnNlQ2FsbEV4cHJlc3Npb25Bcmd1bWVudHMoMTEpIDogdGhpcy5wYXJzZUNhbGxFeHByZXNzaW9uQXJndW1lbnRzKDExLCB0Mi50eXBlID09PSAiSW1wb3J0IiwgdDIudHlwZSAhPT0gIlN1cGVyIiwgbzIsIGEyKSwgdGhpcy5maW5pc2hDYWxsRXhwcmVzc2lvbihvMiwgcjIub3B0aW9uYWxDaGFpbk1lbWJlciksIHIyLm1heWJlQXN5bmNBcnJvdyAmJiB0aGlzLnNob3VsZFBhcnNlQXN5bmNBcnJvdygpICYmICFpMiA/IChyMi5zdG9wID0gdHJ1ZSwgdGhpcy5leHByZXNzaW9uU2NvcGUudmFsaWRhdGVBc1BhdHRlcm4oKSwgdGhpcy5leHByZXNzaW9uU2NvcGUuZXhpdCgpLCBvMiA9IHRoaXMucGFyc2VBc3luY0Fycm93RnJvbUNhbGxFeHByZXNzaW9uKHRoaXMuc3RhcnROb2RlQXQoZTIsIHMyKSwgbzIpKSA6IChyMi5tYXliZUFzeW5jQXJyb3cgJiYgKHRoaXMuY2hlY2tFeHByZXNzaW9uRXJyb3JzKGEyLCB0cnVlKSwgdGhpcy5leHByZXNzaW9uU2NvcGUuZXhpdCgpKSwgdGhpcy50b1JlZmVyZW5jZWRBcmd1bWVudHMobzIpKSwgdGhpcy5zdGF0ZS5tYXliZUluQXJyb3dQYXJhbWV0ZXJzID0gbjIsIG8yOwogICAgICAgICAgfQogICAgICAgICAgdG9SZWZlcmVuY2VkQXJndW1lbnRzKHQyLCBlMikgewogICAgICAgICAgICB0aGlzLnRvUmVmZXJlbmNlZExpc3REZWVwKHQyLmFyZ3VtZW50cywgZTIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24odDIsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLnN0YXJ0Tm9kZUF0KGUyLCBzMik7CiAgICAgICAgICAgIHJldHVybiBpMi50YWcgPSB0MiwgaTIucXVhc2kgPSB0aGlzLnBhcnNlVGVtcGxhdGUodHJ1ZSksIHIyLm9wdGlvbmFsQ2hhaW5NZW1iZXIgJiYgdGhpcy5yYWlzZShlMiwgRGMuT3B0aW9uYWxDaGFpbmluZ05vVGVtcGxhdGUpLCB0aGlzLmZpbmlzaE5vZGUoaTIsICJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIGF0UG9zc2libGVBc3luY0Fycm93KHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0Mi50eXBlID09PSAiSWRlbnRpZmllciIgJiYgdDIubmFtZSA9PT0gImFzeW5jIiAmJiB0aGlzLnN0YXRlLmxhc3RUb2tFbmQgPT09IHQyLmVuZCAmJiAhdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKSAmJiB0Mi5lbmQgLSB0Mi5zdGFydCA9PSA1ICYmIHQyLnN0YXJ0ID09PSB0aGlzLnN0YXRlLnBvdGVudGlhbEFycm93QXQ7CiAgICAgICAgICB9CiAgICAgICAgICBmaW5pc2hDYWxsRXhwcmVzc2lvbih0MiwgZTIpIHsKICAgICAgICAgICAgaWYgKHQyLmNhbGxlZS50eXBlID09PSAiSW1wb3J0IikKICAgICAgICAgICAgICBpZiAodDIuYXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJiAodGhpcy5oYXNQbHVnaW4oIm1vZHVsZUF0dHJpYnV0ZXMiKSB8fCB0aGlzLmV4cGVjdFBsdWdpbigiaW1wb3J0QXNzZXJ0aW9ucyIpKSwgdDIuYXJndW1lbnRzLmxlbmd0aCA9PT0gMCB8fCB0Mi5hcmd1bWVudHMubGVuZ3RoID4gMikKICAgICAgICAgICAgICAgIHRoaXMucmFpc2UodDIuc3RhcnQsIERjLkltcG9ydENhbGxBcml0eSwgdGhpcy5oYXNQbHVnaW4oImltcG9ydEFzc2VydGlvbnMiKSB8fCB0aGlzLmhhc1BsdWdpbigibW9kdWxlQXR0cmlidXRlcyIpID8gIm9uZSBvciB0d28gYXJndW1lbnRzIiA6ICJvbmUgYXJndW1lbnQiKTsKICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIHQyLmFyZ3VtZW50cykKICAgICAgICAgICAgICAgICAgZTMudHlwZSA9PT0gIlNwcmVhZEVsZW1lbnQiICYmIHRoaXMucmFpc2UoZTMuc3RhcnQsIERjLkltcG9ydENhbGxTcHJlYWRBcmd1bWVudCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbmlzaE5vZGUodDIsIGUyID8gIk9wdGlvbmFsQ2FsbEV4cHJlc3Npb24iIDogIkNhbGxFeHByZXNzaW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNhbGxFeHByZXNzaW9uQXJndW1lbnRzKHQyLCBlMiwgczIsIHIyLCBpMikgewogICAgICAgICAgICBjb25zdCBuMiA9IFtdOwogICAgICAgICAgICBsZXQgYTIgPSB0cnVlOwogICAgICAgICAgICBjb25zdCBvMiA9IHRoaXMuc3RhdGUuaW5GU2hhcnBQaXBlbGluZURpcmVjdEJvZHk7CiAgICAgICAgICAgIGZvciAodGhpcy5zdGF0ZS5pbkZTaGFycFBpcGVsaW5lRGlyZWN0Qm9keSA9IGZhbHNlOyAhdGhpcy5lYXQodDIpOyApIHsKICAgICAgICAgICAgICBpZiAoYTIpCiAgICAgICAgICAgICAgICBhMiA9IGZhbHNlOwogICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZXhwZWN0KDEyKSwgdGhpcy5tYXRjaCh0MikpIHsKICAgICAgICAgICAgICAgICFlMiB8fCB0aGlzLmhhc1BsdWdpbigiaW1wb3J0QXNzZXJ0aW9ucyIpIHx8IHRoaXMuaGFzUGx1Z2luKCJtb2R1bGVBdHRyaWJ1dGVzIikgfHwgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLmxhc3RUb2tTdGFydCwgRGMuSW1wb3J0Q2FsbEFyZ3VtZW50VHJhaWxpbmdDb21tYSksIHIyICYmIHRoaXMuYWRkRXh0cmEocjIsICJ0cmFpbGluZ0NvbW1hIiwgdGhpcy5zdGF0ZS5sYXN0VG9rU3RhcnQpLCB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBuMi5wdXNoKHRoaXMucGFyc2VFeHByTGlzdEl0ZW0oZmFsc2UsIGkyLCBzMikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmluRlNoYXJwUGlwZWxpbmVEaXJlY3RCb2R5ID0gbzIsIG4yOwogICAgICAgICAgfQogICAgICAgICAgc2hvdWxkUGFyc2VBc3luY0Fycm93KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaCgxOSkgJiYgIXRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUFzeW5jQXJyb3dGcm9tQ2FsbEV4cHJlc3Npb24odDIsIGUyKSB7CiAgICAgICAgICAgIHZhciBzMjsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVzZXRQcmV2aW91c05vZGVUcmFpbGluZ0NvbW1lbnRzKGUyKSwgdGhpcy5leHBlY3QoMTkpLCB0aGlzLnBhcnNlQXJyb3dFeHByZXNzaW9uKHQyLCBlMi5hcmd1bWVudHMsIHRydWUsIChzMiA9IGUyLmV4dHJhKSA9PSBudWxsID8gdm9pZCAwIDogczIudHJhaWxpbmdDb21tYSksIGUyLmlubmVyQ29tbWVudHMgJiYgY2ModDIsIGUyLmlubmVyQ29tbWVudHMpLCBlMi5jYWxsZWUudHJhaWxpbmdDb21tZW50cyAmJiBjYyh0MiwgZTIuY2FsbGVlLnRyYWlsaW5nQ29tbWVudHMpLCB0MjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlTm9DYWxsRXhwcigpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLnN0YXRlLnN0YXJ0LCBlMiA9IHRoaXMuc3RhdGUuc3RhcnRMb2M7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlU3Vic2NyaXB0cyh0aGlzLnBhcnNlRXhwckF0b20oKSwgdDIsIGUyLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRXhwckF0b20odDIpIHsKICAgICAgICAgICAgbGV0IGUyOwogICAgICAgICAgICBjb25zdCB7IHR5cGU6IHMyIH0gPSB0aGlzLnN0YXRlOwogICAgICAgICAgICBzd2l0Y2ggKHMyKSB7CiAgICAgICAgICAgICAgY2FzZSA3MzoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlU3VwZXIoKTsKICAgICAgICAgICAgICBjYXNlIDc3OgogICAgICAgICAgICAgICAgcmV0dXJuIGUyID0gdGhpcy5zdGFydE5vZGUoKSwgdGhpcy5uZXh0KCksIHRoaXMubWF0Y2goMTYpID8gdGhpcy5wYXJzZUltcG9ydE1ldGFQcm9wZXJ0eShlMikgOiAodGhpcy5tYXRjaCgxMCkgfHwgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLmxhc3RUb2tTdGFydCwgRGMuVW5zdXBwb3J0ZWRJbXBvcnQpLCB0aGlzLmZpbmlzaE5vZGUoZTIsICJJbXBvcnQiKSk7CiAgICAgICAgICAgICAgY2FzZSA3MjoKICAgICAgICAgICAgICAgIHJldHVybiBlMiA9IHRoaXMuc3RhcnROb2RlKCksIHRoaXMubmV4dCgpLCB0aGlzLmZpbmlzaE5vZGUoZTIsICJUaGlzRXhwcmVzc2lvbiIpOwogICAgICAgICAgICAgIGNhc2UgODQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZURvKHRoaXMuc3RhcnROb2RlKCksIGZhbHNlKTsKICAgICAgICAgICAgICBjYXNlIDUwOgogICAgICAgICAgICAgIGNhc2UgMjk6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZWFkUmVnZXhwKCksIHRoaXMucGFyc2VSZWdFeHBMaXRlcmFsKHRoaXMuc3RhdGUudmFsdWUpOwogICAgICAgICAgICAgIGNhc2UgMTI0OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VOdW1lcmljTGl0ZXJhbCh0aGlzLnN0YXRlLnZhbHVlKTsKICAgICAgICAgICAgICBjYXNlIDEyNToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlQmlnSW50TGl0ZXJhbCh0aGlzLnN0YXRlLnZhbHVlKTsKICAgICAgICAgICAgICBjYXNlIDEyNjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlRGVjaW1hbExpdGVyYWwodGhpcy5zdGF0ZS52YWx1ZSk7CiAgICAgICAgICAgICAgY2FzZSAxMjM6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZVN0cmluZ0xpdGVyYWwodGhpcy5zdGF0ZS52YWx1ZSk7CiAgICAgICAgICAgICAgY2FzZSA3ODoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlTnVsbExpdGVyYWwoKTsKICAgICAgICAgICAgICBjYXNlIDc5OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VCb29sZWFuTGl0ZXJhbCh0cnVlKTsKICAgICAgICAgICAgICBjYXNlIDgwOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VCb29sZWFuTGl0ZXJhbChmYWxzZSk7CiAgICAgICAgICAgICAgY2FzZSAxMDogewogICAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXRlLnBvdGVudGlhbEFycm93QXQgPT09IHRoaXMuc3RhdGUuc3RhcnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZVBhcmVuQW5kRGlzdGluZ3Vpc2hFeHByZXNzaW9uKHQzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlQXJyYXlMaWtlKHRoaXMuc3RhdGUudHlwZSA9PT0gMiA/IDQgOiAzLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VBcnJheUxpa2UoMywgdHJ1ZSwgZmFsc2UsIHQyKTsKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VPYmplY3RMaWtlKHRoaXMuc3RhdGUudHlwZSA9PT0gNiA/IDkgOiA4LCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VPYmplY3RMaWtlKDgsIGZhbHNlLCBmYWxzZSwgdDIpOwogICAgICAgICAgICAgIGNhc2UgNjI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUZ1bmN0aW9uT3JGdW5jdGlvblNlbnQoKTsKICAgICAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICAgICAgdGhpcy5wYXJzZURlY29yYXRvcnMoKTsKICAgICAgICAgICAgICBjYXNlIDc0OgogICAgICAgICAgICAgICAgcmV0dXJuIGUyID0gdGhpcy5zdGFydE5vZGUoKSwgdGhpcy50YWtlRGVjb3JhdG9ycyhlMiksIHRoaXMucGFyc2VDbGFzcyhlMiwgZmFsc2UpOwogICAgICAgICAgICAgIGNhc2UgNzE6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZU5ld09yTmV3VGFyZ2V0KCk7CiAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlVGVtcGxhdGUoZmFsc2UpOwogICAgICAgICAgICAgIGNhc2UgMTU6IHsKICAgICAgICAgICAgICAgIGUyID0gdGhpcy5zdGFydE5vZGUoKSwgdGhpcy5uZXh0KCksIGUyLm9iamVjdCA9IG51bGw7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IGUyLmNhbGxlZSA9IHRoaXMucGFyc2VOb0NhbGxFeHByKCk7CiAgICAgICAgICAgICAgICBpZiAodDMudHlwZSA9PT0gIk1lbWJlckV4cHJlc3Npb24iKQogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKGUyLCAiQmluZEV4cHJlc3Npb24iKTsKICAgICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UodDMuc3RhcnQsIERjLlVuc3VwcG9ydGVkQmluZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgMTI4OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmFpc2UodGhpcy5zdGF0ZS5zdGFydCwgRGMuUHJpdmF0ZUluRXhwZWN0ZWRJbiwgdGhpcy5zdGF0ZS52YWx1ZSksIHRoaXMucGFyc2VQcml2YXRlTmFtZSgpOwogICAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZVRvcGljUmVmZXJlbmNlVGhlbkVxdWFsc1NpZ24oNDgsICIlIik7CiAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlVG9waWNSZWZlcmVuY2VUaGVuRXF1YWxzU2lnbig0MCwgIl4iKTsKICAgICAgICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICAgIGNhc2UgNDg6CiAgICAgICAgICAgICAgY2FzZSAyNTogewogICAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLmdldFBsdWdpbk9wdGlvbigicGlwZWxpbmVPcGVyYXRvciIsICJwcm9wb3NhbCIpOwogICAgICAgICAgICAgICAgaWYgKHQzKQogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZVRvcGljUmVmZXJlbmNlKHQzKTsKICAgICAgICAgICAgICAgIHRocm93IHRoaXMudW5leHBlY3RlZCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlIDQzOiB7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuaW5wdXQuY29kZVBvaW50QXQodGhpcy5uZXh0VG9rZW5TdGFydCgpKTsKICAgICAgICAgICAgICAgIGlmIChlbCh0MykgfHwgdDMgPT09IDYyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuZXhwZWN0T25lUGx1Z2luKFsianN4IiwgImZsb3ciLCAidHlwZXNjcmlwdCJdKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnVuZXhwZWN0ZWQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmIChVYyhzMikpIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNDb250ZXh0dWFsKDExNykgJiYgdGhpcy5sb29rYWhlYWRDaGFyQ29kZSgpID09PSAxMjMgJiYgIXRoaXMuaGFzRm9sbG93aW5nTGluZUJyZWFrKCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VNb2R1bGVFeHByZXNzaW9uKCk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGF0ZS5wb3RlbnRpYWxBcnJvd0F0ID09PSB0aGlzLnN0YXRlLnN0YXJ0LCBlMyA9IHRoaXMuc3RhdGUuY29udGFpbnNFc2MsIHMzID0gdGhpcy5wYXJzZUlkZW50aWZpZXIoKTsKICAgICAgICAgICAgICAgICAgaWYgKCFlMyAmJiBzMy5uYW1lID09PSAiYXN5bmMiICYmICF0aGlzLmNhbkluc2VydFNlbWljb2xvbigpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyB0eXBlOiB0NCB9ID0gdGhpcy5zdGF0ZTsKICAgICAgICAgICAgICAgICAgICBpZiAodDQgPT09IDYyKQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVzZXRQcmV2aW91c05vZGVUcmFpbGluZ0NvbW1lbnRzKHMzKSwgdGhpcy5uZXh0KCksIHRoaXMucGFyc2VGdW5jdGlvbih0aGlzLnN0YXJ0Tm9kZUF0Tm9kZShzMyksIHZvaWQgMCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKFVjKHQ0KSkKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxvb2thaGVhZENoYXJDb2RlKCkgPT09IDYxID8gdGhpcy5wYXJzZUFzeW5jQXJyb3dVbmFyeUZ1bmN0aW9uKHRoaXMuc3RhcnROb2RlQXROb2RlKHMzKSkgOiBzMzsKICAgICAgICAgICAgICAgICAgICBpZiAodDQgPT09IDg0KQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVzZXRQcmV2aW91c05vZGVUcmFpbGluZ0NvbW1lbnRzKHMzKSwgdGhpcy5wYXJzZURvKHRoaXMuc3RhcnROb2RlQXROb2RlKHMzKSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIHQzICYmIHRoaXMubWF0Y2goMTkpICYmICF0aGlzLmNhbkluc2VydFNlbWljb2xvbigpID8gKHRoaXMubmV4dCgpLCB0aGlzLnBhcnNlQXJyb3dFeHByZXNzaW9uKHRoaXMuc3RhcnROb2RlQXROb2RlKHMzKSwgW3MzXSwgZmFsc2UpKSA6IHMzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhyb3cgdGhpcy51bmV4cGVjdGVkKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlVG9waWNSZWZlcmVuY2VUaGVuRXF1YWxzU2lnbih0MiwgZTIpIHsKICAgICAgICAgICAgY29uc3QgczIgPSB0aGlzLmdldFBsdWdpbk9wdGlvbigicGlwZWxpbmVPcGVyYXRvciIsICJwcm9wb3NhbCIpOwogICAgICAgICAgICBpZiAoczIpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUudHlwZSA9IHQyLCB0aGlzLnN0YXRlLnZhbHVlID0gZTIsIHRoaXMuc3RhdGUucG9zLS0sIHRoaXMuc3RhdGUuZW5kLS0sIHRoaXMuc3RhdGUuZW5kTG9jLmNvbHVtbi0tLCB0aGlzLnBhcnNlVG9waWNSZWZlcmVuY2UoczIpOwogICAgICAgICAgICB0aHJvdyB0aGlzLnVuZXhwZWN0ZWQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlVG9waWNSZWZlcmVuY2UodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXJ0Tm9kZSgpLCBzMiA9IHRoaXMuc3RhdGUuc3RhcnQsIHIyID0gdGhpcy5zdGF0ZS50eXBlOwogICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMuZmluaXNoVG9waWNSZWZlcmVuY2UoZTIsIHMyLCB0MiwgcjIpOwogICAgICAgICAgfQogICAgICAgICAgZmluaXNoVG9waWNSZWZlcmVuY2UodDIsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgaWYgKHRoaXMudGVzdFRvcGljUmVmZXJlbmNlQ29uZmlndXJhdGlvbihzMiwgZTIsIHIyKSkgewogICAgICAgICAgICAgIGxldCByMzsKICAgICAgICAgICAgICByZXR1cm4gcjMgPSBzMiA9PT0gInNtYXJ0IiA/ICJQaXBlbGluZVByaW1hcnlUb3BpY1JlZmVyZW5jZSIgOiAiVG9waWNSZWZlcmVuY2UiLCB0aGlzLnRvcGljUmVmZXJlbmNlSXNBbGxvd2VkSW5DdXJyZW50Q29udGV4dCgpIHx8IChzMiA9PT0gInNtYXJ0IiA/IHRoaXMucmFpc2UoZTIsIERjLlByaW1hcnlUb3BpY05vdEFsbG93ZWQpIDogdGhpcy5yYWlzZShlMiwgRGMuUGlwZVRvcGljVW5ib3VuZCkpLCB0aGlzLnJlZ2lzdGVyVG9waWNSZWZlcmVuY2UoKSwgdGhpcy5maW5pc2hOb2RlKHQyLCByMyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgdGhpcy5yYWlzZShlMiwgRGMuUGlwZVRvcGljVW5jb25maWd1cmVkVG9rZW4sIFdjKHIyKSk7CiAgICAgICAgICB9CiAgICAgICAgICB0ZXN0VG9waWNSZWZlcmVuY2VDb25maWd1cmF0aW9uKHQyLCBlMiwgczIpIHsKICAgICAgICAgICAgc3dpdGNoICh0MikgewogICAgICAgICAgICAgIGNhc2UgImhhY2siOiB7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuZ2V0UGx1Z2luT3B0aW9uKCJwaXBlbGluZU9wZXJhdG9yIiwgInRvcGljVG9rZW4iKTsKICAgICAgICAgICAgICAgIHJldHVybiBXYyhzMikgPT09IHQzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlICJzbWFydCI6CiAgICAgICAgICAgICAgICByZXR1cm4gczIgPT09IDI1OwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKGUyLCBEYy5QaXBlVG9waWNSZXF1aXJlc0hhY2tQaXBlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQXN5bmNBcnJvd1VuYXJ5RnVuY3Rpb24odDIpIHsKICAgICAgICAgICAgdGhpcy5wcm9kUGFyYW0uZW50ZXIoTWwodHJ1ZSwgdGhpcy5wcm9kUGFyYW0uaGFzWWllbGQpKTsKICAgICAgICAgICAgY29uc3QgZTIgPSBbdGhpcy5wYXJzZUlkZW50aWZpZXIoKV07CiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb2RQYXJhbS5leGl0KCksIHRoaXMuaGFzUHJlY2VkaW5nTGluZUJyZWFrKCkgJiYgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnBvcywgRGMuTGluZVRlcm1pbmF0b3JCZWZvcmVBcnJvdyksIHRoaXMuZXhwZWN0KDE5KSwgdGhpcy5wYXJzZUFycm93RXhwcmVzc2lvbih0MiwgZTIsIHRydWUpLCB0MjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRG8odDIsIGUyKSB7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0UGx1Z2luKCJkb0V4cHJlc3Npb25zIiksIGUyICYmIHRoaXMuZXhwZWN0UGx1Z2luKCJhc3luY0RvRXhwcmVzc2lvbnMiKSwgdDIuYXN5bmMgPSBlMiwgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5zdGF0ZS5sYWJlbHM7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmxhYmVscyA9IFtdLCBlMiA/ICh0aGlzLnByb2RQYXJhbS5lbnRlcigyKSwgdDIuYm9keSA9IHRoaXMucGFyc2VCbG9jaygpLCB0aGlzLnByb2RQYXJhbS5leGl0KCkpIDogdDIuYm9keSA9IHRoaXMucGFyc2VCbG9jaygpLCB0aGlzLnN0YXRlLmxhYmVscyA9IHMyLCB0aGlzLmZpbmlzaE5vZGUodDIsICJEb0V4cHJlc3Npb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlU3VwZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCAhdGhpcy5tYXRjaCgxMCkgfHwgdGhpcy5zY29wZS5hbGxvd0RpcmVjdFN1cGVyIHx8IHRoaXMub3B0aW9ucy5hbGxvd1N1cGVyT3V0c2lkZU1ldGhvZCA/IHRoaXMuc2NvcGUuYWxsb3dTdXBlciB8fCB0aGlzLm9wdGlvbnMuYWxsb3dTdXBlck91dHNpZGVNZXRob2QgfHwgdGhpcy5yYWlzZSh0Mi5zdGFydCwgRGMuVW5leHBlY3RlZFN1cGVyKSA6IHRoaXMucmFpc2UodDIuc3RhcnQsIERjLlN1cGVyTm90QWxsb3dlZCksIHRoaXMubWF0Y2goMTApIHx8IHRoaXMubWF0Y2goMCkgfHwgdGhpcy5tYXRjaCgxNikgfHwgdGhpcy5yYWlzZSh0Mi5zdGFydCwgRGMuVW5zdXBwb3J0ZWRTdXBlciksIHRoaXMuZmluaXNoTm9kZSh0MiwgIlN1cGVyIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZVByaXZhdGVOYW1lKCkgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuc3RhcnROb2RlKCksIGUyID0gdGhpcy5zdGFydE5vZGVBdCh0aGlzLnN0YXRlLnN0YXJ0ICsgMSwgbmV3IHVjKHRoaXMuc3RhdGUuY3VyTGluZSwgdGhpcy5zdGF0ZS5zdGFydCArIDEgLSB0aGlzLnN0YXRlLmxpbmVTdGFydCkpLCBzMiA9IHRoaXMuc3RhdGUudmFsdWU7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdDIuaWQgPSB0aGlzLmNyZWF0ZUlkZW50aWZpZXIoZTIsIHMyKSwgdGhpcy5maW5pc2hOb2RlKHQyLCAiUHJpdmF0ZU5hbWUiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRnVuY3Rpb25PckZ1bmN0aW9uU2VudCgpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICBpZiAodGhpcy5uZXh0KCksIHRoaXMucHJvZFBhcmFtLmhhc1lpZWxkICYmIHRoaXMubWF0Y2goMTYpKSB7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLmNyZWF0ZUlkZW50aWZpZXIodGhpcy5zdGFydE5vZGVBdE5vZGUodDIpLCAiZnVuY3Rpb24iKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMubWF0Y2goOTYpID8gdGhpcy5leHBlY3RQbHVnaW4oImZ1bmN0aW9uU2VudCIpIDogdGhpcy5oYXNQbHVnaW4oImZ1bmN0aW9uU2VudCIpIHx8IHRoaXMudW5leHBlY3RlZCgpLCB0aGlzLnBhcnNlTWV0YVByb3BlcnR5KHQyLCBlMiwgInNlbnQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUZ1bmN0aW9uKHQyKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlTWV0YVByb3BlcnR5KHQyLCBlMiwgczIpIHsKICAgICAgICAgICAgdDIubWV0YSA9IGUyOwogICAgICAgICAgICBjb25zdCByMiA9IHRoaXMuc3RhdGUuY29udGFpbnNFc2M7CiAgICAgICAgICAgIHJldHVybiB0Mi5wcm9wZXJ0eSA9IHRoaXMucGFyc2VJZGVudGlmaWVyKHRydWUpLCAodDIucHJvcGVydHkubmFtZSAhPT0gczIgfHwgcjIpICYmIHRoaXMucmFpc2UodDIucHJvcGVydHkuc3RhcnQsIERjLlVuc3VwcG9ydGVkTWV0YVByb3BlcnR5LCBlMi5uYW1lLCBzMiksIHRoaXMuZmluaXNoTm9kZSh0MiwgIk1ldGFQcm9wZXJ0eSIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VJbXBvcnRNZXRhUHJvcGVydHkodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLmNyZWF0ZUlkZW50aWZpZXIodGhpcy5zdGFydE5vZGVBdE5vZGUodDIpLCAiaW1wb3J0Iik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5pc0NvbnRleHR1YWwoOTQpICYmICh0aGlzLmluTW9kdWxlIHx8IHRoaXMucmFpc2UoZTIuc3RhcnQsIG1jLkltcG9ydE1ldGFPdXRzaWRlTW9kdWxlKSwgdGhpcy5zYXdVbmFtYmlndW91c0VTTSA9IHRydWUpLCB0aGlzLnBhcnNlTWV0YVByb3BlcnR5KHQyLCBlMiwgIm1ldGEiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlTGl0ZXJhbEF0Tm9kZSh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZEV4dHJhKHMyLCAicmF3VmFsdWUiLCB0MiksIHRoaXMuYWRkRXh0cmEoczIsICJyYXciLCB0aGlzLmlucHV0LnNsaWNlKHMyLnN0YXJ0LCB0aGlzLnN0YXRlLmVuZCkpLCBzMi52YWx1ZSA9IHQyLCB0aGlzLm5leHQoKSwgdGhpcy5maW5pc2hOb2RlKHMyLCBlMik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUxpdGVyYWwodDIsIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VMaXRlcmFsQXROb2RlKHQyLCBlMiwgczIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VTdHJpbmdMaXRlcmFsKHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlTGl0ZXJhbCh0MiwgIlN0cmluZ0xpdGVyYWwiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlTnVtZXJpY0xpdGVyYWwodDIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VMaXRlcmFsKHQyLCAiTnVtZXJpY0xpdGVyYWwiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQmlnSW50TGl0ZXJhbCh0MikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUxpdGVyYWwodDIsICJCaWdJbnRMaXRlcmFsIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZURlY2ltYWxMaXRlcmFsKHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlTGl0ZXJhbCh0MiwgIkRlY2ltYWxMaXRlcmFsIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZVJlZ0V4cExpdGVyYWwodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnBhcnNlTGl0ZXJhbCh0Mi52YWx1ZSwgIlJlZ0V4cExpdGVyYWwiKTsKICAgICAgICAgICAgcmV0dXJuIGUyLnBhdHRlcm4gPSB0Mi5wYXR0ZXJuLCBlMi5mbGFncyA9IHQyLmZsYWdzLCBlMjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQm9vbGVhbkxpdGVyYWwodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICByZXR1cm4gZTIudmFsdWUgPSB0MiwgdGhpcy5uZXh0KCksIHRoaXMuZmluaXNoTm9kZShlMiwgIkJvb2xlYW5MaXRlcmFsIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU51bGxMaXRlcmFsKCkgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5maW5pc2hOb2RlKHQyLCAiTnVsbExpdGVyYWwiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlUGFyZW5BbmREaXN0aW5ndWlzaEV4cHJlc3Npb24odDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXRlLnN0YXJ0LCBzMiA9IHRoaXMuc3RhdGUuc3RhcnRMb2M7CiAgICAgICAgICAgIGxldCByMjsKICAgICAgICAgICAgdGhpcy5uZXh0KCksIHRoaXMuZXhwcmVzc2lvblNjb3BlLmVudGVyKG5ldyB2bCgxKSk7CiAgICAgICAgICAgIGNvbnN0IGkyID0gdGhpcy5zdGF0ZS5tYXliZUluQXJyb3dQYXJhbWV0ZXJzLCBuMiA9IHRoaXMuc3RhdGUuaW5GU2hhcnBQaXBlbGluZURpcmVjdEJvZHk7CiAgICAgICAgICAgIHRoaXMuc3RhdGUubWF5YmVJbkFycm93UGFyYW1ldGVycyA9IHRydWUsIHRoaXMuc3RhdGUuaW5GU2hhcnBQaXBlbGluZURpcmVjdEJvZHkgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3QgYTIgPSB0aGlzLnN0YXRlLnN0YXJ0LCBvMiA9IHRoaXMuc3RhdGUuc3RhcnRMb2MsIHUyID0gW10sIGgyID0gbmV3IFJsKCk7CiAgICAgICAgICAgIGxldCBwMiwgYzIsIGwyID0gdHJ1ZTsKICAgICAgICAgICAgZm9yICg7ICF0aGlzLm1hdGNoKDExKTsgKSB7CiAgICAgICAgICAgICAgaWYgKGwyKQogICAgICAgICAgICAgICAgbDIgPSBmYWxzZTsKICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLmV4cGVjdCgxMiwgaDIub3B0aW9uYWxQYXJhbWV0ZXJzID09PSAtMSA/IG51bGwgOiBoMi5vcHRpb25hbFBhcmFtZXRlcnMpLCB0aGlzLm1hdGNoKDExKSkgewogICAgICAgICAgICAgICAgYzIgPSB0aGlzLnN0YXRlLnN0YXJ0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDIxKSkgewogICAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXRlLnN0YXJ0LCBlMyA9IHRoaXMuc3RhdGUuc3RhcnRMb2M7CiAgICAgICAgICAgICAgICBwMiA9IHRoaXMuc3RhdGUuc3RhcnQsIHUyLnB1c2godGhpcy5wYXJzZVBhcmVuSXRlbSh0aGlzLnBhcnNlUmVzdEJpbmRpbmcoKSwgdDMsIGUzKSksIHRoaXMuY2hlY2tDb21tYUFmdGVyUmVzdCg0MSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdTIucHVzaCh0aGlzLnBhcnNlTWF5YmVBc3NpZ25BbGxvd0luKGgyLCB0aGlzLnBhcnNlUGFyZW5JdGVtKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZDIgPSB0aGlzLnN0YXRlLmxhc3RUb2tFbmQsIEQyID0gdGhpcy5zdGF0ZS5sYXN0VG9rRW5kTG9jOwogICAgICAgICAgICB0aGlzLmV4cGVjdCgxMSksIHRoaXMuc3RhdGUubWF5YmVJbkFycm93UGFyYW1ldGVycyA9IGkyLCB0aGlzLnN0YXRlLmluRlNoYXJwUGlwZWxpbmVEaXJlY3RCb2R5ID0gbjI7CiAgICAgICAgICAgIGxldCBtMiA9IHRoaXMuc3RhcnROb2RlQXQoZTIsIHMyKTsKICAgICAgICAgICAgaWYgKHQyICYmIHRoaXMuc2hvdWxkUGFyc2VBcnJvdyh1MikgJiYgKG0yID0gdGhpcy5wYXJzZUFycm93KG0yKSkpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwcmVzc2lvblNjb3BlLnZhbGlkYXRlQXNQYXR0ZXJuKCksIHRoaXMuZXhwcmVzc2lvblNjb3BlLmV4aXQoKSwgdGhpcy5wYXJzZUFycm93RXhwcmVzc2lvbihtMiwgdTIsIGZhbHNlKSwgbTI7CiAgICAgICAgICAgIGlmICh0aGlzLmV4cHJlc3Npb25TY29wZS5leGl0KCksIHUyLmxlbmd0aCB8fCB0aGlzLnVuZXhwZWN0ZWQodGhpcy5zdGF0ZS5sYXN0VG9rU3RhcnQpLCBjMiAmJiB0aGlzLnVuZXhwZWN0ZWQoYzIpLCBwMiAmJiB0aGlzLnVuZXhwZWN0ZWQocDIpLCB0aGlzLmNoZWNrRXhwcmVzc2lvbkVycm9ycyhoMiwgdHJ1ZSksIHRoaXMudG9SZWZlcmVuY2VkTGlzdERlZXAodTIsIHRydWUpLCB1Mi5sZW5ndGggPiAxID8gKHIyID0gdGhpcy5zdGFydE5vZGVBdChhMiwgbzIpLCByMi5leHByZXNzaW9ucyA9IHUyLCB0aGlzLmZpbmlzaE5vZGUocjIsICJTZXF1ZW5jZUV4cHJlc3Npb24iKSwgdGhpcy5yZXNldEVuZExvY2F0aW9uKHIyLCBkMiwgRDIpKSA6IHIyID0gdTJbMF0sICF0aGlzLm9wdGlvbnMuY3JlYXRlUGFyZW50aGVzaXplZEV4cHJlc3Npb25zKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZEV4dHJhKHIyLCAicGFyZW50aGVzaXplZCIsIHRydWUpLCB0aGlzLmFkZEV4dHJhKHIyLCAicGFyZW5TdGFydCIsIGUyKSwgdGhpcy50YWtlU3Vycm91bmRpbmdDb21tZW50cyhyMiwgZTIsIHRoaXMuc3RhdGUubGFzdFRva0VuZCksIHIyOwogICAgICAgICAgICBjb25zdCBmMiA9IHRoaXMuc3RhcnROb2RlQXQoZTIsIHMyKTsKICAgICAgICAgICAgcmV0dXJuIGYyLmV4cHJlc3Npb24gPSByMiwgdGhpcy5maW5pc2hOb2RlKGYyLCAiUGFyZW50aGVzaXplZEV4cHJlc3Npb24iKSwgZjI7CiAgICAgICAgICB9CiAgICAgICAgICBzaG91bGRQYXJzZUFycm93KHQyKSB7CiAgICAgICAgICAgIHJldHVybiAhdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQXJyb3codDIpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZWF0KDE5KSkKICAgICAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZVBhcmVuSXRlbSh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlTmV3T3JOZXdUYXJnZXQoKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgaWYgKHRoaXMubmV4dCgpLCB0aGlzLm1hdGNoKDE2KSkgewogICAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5jcmVhdGVJZGVudGlmaWVyKHRoaXMuc3RhcnROb2RlQXROb2RlKHQyKSwgIm5ldyIpOwogICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5wYXJzZU1ldGFQcm9wZXJ0eSh0MiwgZTIsICJ0YXJnZXQiKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zY29wZS5pbk5vbkFycm93RnVuY3Rpb24gfHwgdGhpcy5zY29wZS5pbkNsYXNzIHx8IHRoaXMucmFpc2UoczIuc3RhcnQsIERjLlVuZXhwZWN0ZWROZXdUYXJnZXQpLCBzMjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZU5ldyh0Mik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU5ldyh0MikgewogICAgICAgICAgICByZXR1cm4gdDIuY2FsbGVlID0gdGhpcy5wYXJzZU5vQ2FsbEV4cHIoKSwgdDIuY2FsbGVlLnR5cGUgPT09ICJJbXBvcnQiID8gdGhpcy5yYWlzZSh0Mi5jYWxsZWUuc3RhcnQsIERjLkltcG9ydENhbGxOb3ROZXdFeHByZXNzaW9uKSA6IHRoaXMuaXNPcHRpb25hbENoYWluKHQyLmNhbGxlZSkgPyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUubGFzdFRva0VuZCwgRGMuT3B0aW9uYWxDaGFpbmluZ05vTmV3KSA6IHRoaXMuZWF0KDE4KSAmJiB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIERjLk9wdGlvbmFsQ2hhaW5pbmdOb05ldyksIHRoaXMucGFyc2VOZXdBcmd1bWVudHModDIpLCB0aGlzLmZpbmlzaE5vZGUodDIsICJOZXdFeHByZXNzaW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU5ld0FyZ3VtZW50cyh0MikgewogICAgICAgICAgICBpZiAodGhpcy5lYXQoMTApKSB7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnBhcnNlRXhwckxpc3QoMTEpOwogICAgICAgICAgICAgIHRoaXMudG9SZWZlcmVuY2VkTGlzdChlMiksIHQyLmFyZ3VtZW50cyA9IGUyOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICB0Mi5hcmd1bWVudHMgPSBbXTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlVGVtcGxhdGVFbGVtZW50KHQyKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUudmFsdWUgPT09IG51bGwgJiYgKHQyIHx8IHRoaXMucmFpc2UodGhpcy5zdGF0ZS5zdGFydCArIDEsIERjLkludmFsaWRFc2NhcGVTZXF1ZW5jZVRlbXBsYXRlKSksIGUyLnZhbHVlID0geyByYXc6IHRoaXMuaW5wdXQuc2xpY2UodGhpcy5zdGF0ZS5zdGFydCwgdGhpcy5zdGF0ZS5lbmQpLnJlcGxhY2UoL1xyXG4/L2csICJcbiIpLCBjb29rZWQ6IHRoaXMuc3RhdGUudmFsdWUgfSwgdGhpcy5uZXh0KCksIGUyLnRhaWwgPSB0aGlzLm1hdGNoKDIyKSwgdGhpcy5maW5pc2hOb2RlKGUyLCAiVGVtcGxhdGVFbGVtZW50Iik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZVRlbXBsYXRlKHQyKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgdGhpcy5uZXh0KCksIGUyLmV4cHJlc3Npb25zID0gW107CiAgICAgICAgICAgIGxldCBzMiA9IHRoaXMucGFyc2VUZW1wbGF0ZUVsZW1lbnQodDIpOwogICAgICAgICAgICBmb3IgKGUyLnF1YXNpcyA9IFtzMl07ICFzMi50YWlsOyApCiAgICAgICAgICAgICAgdGhpcy5leHBlY3QoMjMpLCBlMi5leHByZXNzaW9ucy5wdXNoKHRoaXMucGFyc2VUZW1wbGF0ZVN1YnN0aXR1dGlvbigpKSwgdGhpcy5leHBlY3QoOCksIGUyLnF1YXNpcy5wdXNoKHMyID0gdGhpcy5wYXJzZVRlbXBsYXRlRWxlbWVudCh0MikpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMuZmluaXNoTm9kZShlMiwgIlRlbXBsYXRlTGl0ZXJhbCIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VUZW1wbGF0ZVN1YnN0aXR1dGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VFeHByZXNzaW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU9iamVjdExpa2UodDIsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgczIgJiYgdGhpcy5leHBlY3RQbHVnaW4oInJlY29yZEFuZFR1cGxlIik7CiAgICAgICAgICAgIGNvbnN0IGkyID0gdGhpcy5zdGF0ZS5pbkZTaGFycFBpcGVsaW5lRGlyZWN0Qm9keTsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5pbkZTaGFycFBpcGVsaW5lRGlyZWN0Qm9keSA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBuMiA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgICBsZXQgYTIgPSB0cnVlOwogICAgICAgICAgICBjb25zdCBvMiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIGZvciAobzIucHJvcGVydGllcyA9IFtdLCB0aGlzLm5leHQoKTsgIXRoaXMubWF0Y2godDIpOyApIHsKICAgICAgICAgICAgICBpZiAoYTIpCiAgICAgICAgICAgICAgICBhMiA9IGZhbHNlOwogICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZXhwZWN0KDEyKSwgdGhpcy5tYXRjaCh0MikpIHsKICAgICAgICAgICAgICAgIHRoaXMuYWRkRXh0cmEobzIsICJ0cmFpbGluZ0NvbW1hIiwgdGhpcy5zdGF0ZS5sYXN0VG9rU3RhcnQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxldCBpMzsKICAgICAgICAgICAgICBlMiA/IGkzID0gdGhpcy5wYXJzZUJpbmRpbmdQcm9wZXJ0eSgpIDogKGkzID0gdGhpcy5wYXJzZVByb3BlcnR5RGVmaW5pdGlvbihyMiksIHRoaXMuY2hlY2tQcm90byhpMywgczIsIG4yLCByMikpLCBzMiAmJiAhdGhpcy5pc09iamVjdFByb3BlcnR5KGkzKSAmJiBpMy50eXBlICE9PSAiU3ByZWFkRWxlbWVudCIgJiYgdGhpcy5yYWlzZShpMy5zdGFydCwgRGMuSW52YWxpZFJlY29yZFByb3BlcnR5KSwgaTMuc2hvcnRoYW5kICYmIHRoaXMuYWRkRXh0cmEoaTMsICJzaG9ydGhhbmQiLCB0cnVlKSwgbzIucHJvcGVydGllcy5wdXNoKGkzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm5leHQoKSwgdGhpcy5zdGF0ZS5pbkZTaGFycFBpcGVsaW5lRGlyZWN0Qm9keSA9IGkyOwogICAgICAgICAgICBsZXQgdTIgPSAiT2JqZWN0RXhwcmVzc2lvbiI7CiAgICAgICAgICAgIHJldHVybiBlMiA/IHUyID0gIk9iamVjdFBhdHRlcm4iIDogczIgJiYgKHUyID0gIlJlY29yZEV4cHJlc3Npb24iKSwgdGhpcy5maW5pc2hOb2RlKG8yLCB1Mik7CiAgICAgICAgICB9CiAgICAgICAgICBtYXliZUFzeW5jT3JBY2Nlc3NvclByb3AodDIpIHsKICAgICAgICAgICAgcmV0dXJuICF0Mi5jb21wdXRlZCAmJiB0Mi5rZXkudHlwZSA9PT0gIklkZW50aWZpZXIiICYmICh0aGlzLmlzTGl0ZXJhbFByb3BlcnR5TmFtZSgpIHx8IHRoaXMubWF0Y2goMCkgfHwgdGhpcy5tYXRjaCg0OSkpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VQcm9wZXJ0eURlZmluaXRpb24odDIpIHsKICAgICAgICAgICAgbGV0IGUyID0gW107CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDI0KSkKICAgICAgICAgICAgICBmb3IgKHRoaXMuaGFzUGx1Z2luKCJkZWNvcmF0b3JzIikgJiYgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0LCBEYy5VbnN1cHBvcnRlZFByb3BlcnR5RGVjb3JhdG9yKTsgdGhpcy5tYXRjaCgyNCk7ICkKICAgICAgICAgICAgICAgIGUyLnB1c2godGhpcy5wYXJzZURlY29yYXRvcigpKTsKICAgICAgICAgICAgY29uc3QgczIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICBsZXQgcjIsIGkyLCBuMiA9IGZhbHNlLCBhMiA9IGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCgyMSkpCiAgICAgICAgICAgICAgcmV0dXJuIGUyLmxlbmd0aCAmJiB0aGlzLnVuZXhwZWN0ZWQoKSwgdGhpcy5wYXJzZVNwcmVhZCgpOwogICAgICAgICAgICBlMi5sZW5ndGggJiYgKHMyLmRlY29yYXRvcnMgPSBlMiwgZTIgPSBbXSksIHMyLm1ldGhvZCA9IGZhbHNlLCB0MiAmJiAocjIgPSB0aGlzLnN0YXRlLnN0YXJ0LCBpMiA9IHRoaXMuc3RhdGUuc3RhcnRMb2MpOwogICAgICAgICAgICBsZXQgbzIgPSB0aGlzLmVhdCg0OSk7CiAgICAgICAgICAgIHRoaXMucGFyc2VQcm9wZXJ0eU5hbWVQcmVmaXhPcGVyYXRvcihzMik7CiAgICAgICAgICAgIGNvbnN0IHUyID0gdGhpcy5zdGF0ZS5jb250YWluc0VzYywgaDIgPSB0aGlzLnBhcnNlUHJvcGVydHlOYW1lKHMyKTsKICAgICAgICAgICAgaWYgKCFvMiAmJiAhdTIgJiYgdGhpcy5tYXliZUFzeW5jT3JBY2Nlc3NvclByb3AoczIpKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSBoMi5uYW1lOwogICAgICAgICAgICAgIHQzICE9PSAiYXN5bmMiIHx8IHRoaXMuaGFzUHJlY2VkaW5nTGluZUJyZWFrKCkgfHwgKG4yID0gdHJ1ZSwgdGhpcy5yZXNldFByZXZpb3VzTm9kZVRyYWlsaW5nQ29tbWVudHMoaDIpLCBvMiA9IHRoaXMuZWF0KDQ5KSwgdGhpcy5wYXJzZVByb3BlcnR5TmFtZShzMikpLCB0MyAhPT0gImdldCIgJiYgdDMgIT09ICJzZXQiIHx8IChhMiA9IHRydWUsIHRoaXMucmVzZXRQcmV2aW91c05vZGVUcmFpbGluZ0NvbW1lbnRzKGgyKSwgczIua2luZCA9IHQzLCB0aGlzLm1hdGNoKDQ5KSAmJiAobzIgPSB0cnVlLCB0aGlzLnJhaXNlKHRoaXMuc3RhdGUucG9zLCBEYy5BY2Nlc3NvcklzR2VuZXJhdG9yLCB0MyksIHRoaXMubmV4dCgpKSwgdGhpcy5wYXJzZVByb3BlcnR5TmFtZShzMikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlT2JqUHJvcFZhbHVlKHMyLCByMiwgaTIsIG8yLCBuMiwgZmFsc2UsIGEyLCB0MiksIHMyOwogICAgICAgICAgfQogICAgICAgICAgZ2V0R2V0dGVyU2V0dGVyRXhwZWN0ZWRQYXJhbUNvdW50KHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0Mi5raW5kID09PSAiZ2V0IiA/IDAgOiAxOwogICAgICAgICAgfQogICAgICAgICAgZ2V0T2JqZWN0T3JDbGFzc01ldGhvZFBhcmFtcyh0MikgewogICAgICAgICAgICByZXR1cm4gdDIucGFyYW1zOwogICAgICAgICAgfQogICAgICAgICAgY2hlY2tHZXR0ZXJTZXR0ZXJQYXJhbXModDIpIHsKICAgICAgICAgICAgdmFyIGUyOwogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuZ2V0R2V0dGVyU2V0dGVyRXhwZWN0ZWRQYXJhbUNvdW50KHQyKSwgcjIgPSB0aGlzLmdldE9iamVjdE9yQ2xhc3NNZXRob2RQYXJhbXModDIpLCBpMiA9IHQyLnN0YXJ0OwogICAgICAgICAgICByMi5sZW5ndGggIT09IHMyICYmICh0Mi5raW5kID09PSAiZ2V0IiA/IHRoaXMucmFpc2UoaTIsIERjLkJhZEdldHRlckFyaXR5KSA6IHRoaXMucmFpc2UoaTIsIERjLkJhZFNldHRlckFyaXR5KSksIHQyLmtpbmQgPT09ICJzZXQiICYmICgoZTIgPSByMltyMi5sZW5ndGggLSAxXSkgPT0gbnVsbCA/IHZvaWQgMCA6IGUyLnR5cGUpID09PSAiUmVzdEVsZW1lbnQiICYmIHRoaXMucmFpc2UoaTIsIERjLkJhZFNldHRlclJlc3RQYXJhbWV0ZXIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VPYmplY3RNZXRob2QodDIsIGUyLCBzMiwgcjIsIGkyKSB7CiAgICAgICAgICAgIHJldHVybiBpMiA/ICh0aGlzLnBhcnNlTWV0aG9kKHQyLCBlMiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgIk9iamVjdE1ldGhvZCIpLCB0aGlzLmNoZWNrR2V0dGVyU2V0dGVyUGFyYW1zKHQyKSwgdDIpIDogczIgfHwgZTIgfHwgdGhpcy5tYXRjaCgxMCkgPyAocjIgJiYgdGhpcy51bmV4cGVjdGVkKCksIHQyLmtpbmQgPSAibWV0aG9kIiwgdDIubWV0aG9kID0gdHJ1ZSwgdGhpcy5wYXJzZU1ldGhvZCh0MiwgZTIsIHMyLCBmYWxzZSwgZmFsc2UsICJPYmplY3RNZXRob2QiKSkgOiB2b2lkIDA7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU9iamVjdFByb3BlcnR5KHQyLCBlMiwgczIsIHIyLCBpMikgewogICAgICAgICAgICByZXR1cm4gdDIuc2hvcnRoYW5kID0gZmFsc2UsIHRoaXMuZWF0KDE0KSA/ICh0Mi52YWx1ZSA9IHIyID8gdGhpcy5wYXJzZU1heWJlRGVmYXVsdCh0aGlzLnN0YXRlLnN0YXJ0LCB0aGlzLnN0YXRlLnN0YXJ0TG9jKSA6IHRoaXMucGFyc2VNYXliZUFzc2lnbkFsbG93SW4oaTIpLCB0aGlzLmZpbmlzaE5vZGUodDIsICJPYmplY3RQcm9wZXJ0eSIpKSA6IHQyLmNvbXB1dGVkIHx8IHQyLmtleS50eXBlICE9PSAiSWRlbnRpZmllciIgPyB2b2lkIDAgOiAodGhpcy5jaGVja1Jlc2VydmVkV29yZCh0Mi5rZXkubmFtZSwgdDIua2V5LnN0YXJ0LCB0cnVlLCBmYWxzZSksIHIyID8gdDIudmFsdWUgPSB0aGlzLnBhcnNlTWF5YmVEZWZhdWx0KGUyLCBzMiwgX2wodDIua2V5KSkgOiB0aGlzLm1hdGNoKDI3KSAmJiBpMiA/IChpMi5zaG9ydGhhbmRBc3NpZ24gPT09IC0xICYmIChpMi5zaG9ydGhhbmRBc3NpZ24gPSB0aGlzLnN0YXRlLnN0YXJ0KSwgdDIudmFsdWUgPSB0aGlzLnBhcnNlTWF5YmVEZWZhdWx0KGUyLCBzMiwgX2wodDIua2V5KSkpIDogdDIudmFsdWUgPSBfbCh0Mi5rZXkpLCB0Mi5zaG9ydGhhbmQgPSB0cnVlLCB0aGlzLmZpbmlzaE5vZGUodDIsICJPYmplY3RQcm9wZXJ0eSIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlT2JqUHJvcFZhbHVlKHQyLCBlMiwgczIsIHIyLCBpMiwgbjIsIGEyLCBvMikgewogICAgICAgICAgICBjb25zdCB1MiA9IHRoaXMucGFyc2VPYmplY3RNZXRob2QodDIsIHIyLCBpMiwgbjIsIGEyKSB8fCB0aGlzLnBhcnNlT2JqZWN0UHJvcGVydHkodDIsIGUyLCBzMiwgbjIsIG8yKTsKICAgICAgICAgICAgcmV0dXJuIHUyIHx8IHRoaXMudW5leHBlY3RlZCgpLCB1MjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlUHJvcGVydHlOYW1lKHQyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmVhdCgwKSkKICAgICAgICAgICAgICB0Mi5jb21wdXRlZCA9IHRydWUsIHQyLmtleSA9IHRoaXMucGFyc2VNYXliZUFzc2lnbkFsbG93SW4oKSwgdGhpcy5leHBlY3QoMyk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGNvbnN0IHsgdHlwZTogZTIsIHZhbHVlOiBzMiB9ID0gdGhpcy5zdGF0ZTsKICAgICAgICAgICAgICBsZXQgcjI7CiAgICAgICAgICAgICAgaWYgKF9jKGUyKSkKICAgICAgICAgICAgICAgIHIyID0gdGhpcy5wYXJzZUlkZW50aWZpZXIodHJ1ZSk7CiAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc3dpdGNoIChlMikgewogICAgICAgICAgICAgICAgICBjYXNlIDEyNDoKICAgICAgICAgICAgICAgICAgICByMiA9IHRoaXMucGFyc2VOdW1lcmljTGl0ZXJhbChzMik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTIzOgogICAgICAgICAgICAgICAgICAgIHIyID0gdGhpcy5wYXJzZVN0cmluZ0xpdGVyYWwoczIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlIDEyNToKICAgICAgICAgICAgICAgICAgICByMiA9IHRoaXMucGFyc2VCaWdJbnRMaXRlcmFsKHMyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAxMjY6CiAgICAgICAgICAgICAgICAgICAgcjIgPSB0aGlzLnBhcnNlRGVjaW1hbExpdGVyYWwoczIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlIDEyODogewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGF0ZS5zdGFydCArIDE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yYWlzZSh0MywgRGMuVW5leHBlY3RlZFByaXZhdGVGaWVsZCksIHIyID0gdGhpcy5wYXJzZVByaXZhdGVOYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnVuZXhwZWN0ZWQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0Mi5rZXkgPSByMiwgZTIgIT09IDEyOCAmJiAodDIuY29tcHV0ZWQgPSBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHQyLmtleTsKICAgICAgICAgIH0KICAgICAgICAgIGluaXRGdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgICAgdDIuaWQgPSBudWxsLCB0Mi5nZW5lcmF0b3IgPSBmYWxzZSwgdDIuYXN5bmMgPSAhIWUyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VNZXRob2QodDIsIGUyLCBzMiwgcjIsIGkyLCBuMikgewogICAgICAgICAgICBsZXQgYTIgPSBhcmd1bWVudHMubGVuZ3RoID4gNiAmJiBhcmd1bWVudHNbNl0gIT09IHZvaWQgMCAmJiBhcmd1bWVudHNbNl07CiAgICAgICAgICAgIHRoaXMuaW5pdEZ1bmN0aW9uKHQyLCBzMiksIHQyLmdlbmVyYXRvciA9ICEhZTI7CiAgICAgICAgICAgIGNvbnN0IG8yID0gcjI7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNjb3BlLmVudGVyKDE4IHwgKGEyID8gZGwgOiAwKSB8IChpMiA/IDMyIDogMCkpLCB0aGlzLnByb2RQYXJhbS5lbnRlcihNbChzMiwgdDIuZ2VuZXJhdG9yKSksIHRoaXMucGFyc2VGdW5jdGlvblBhcmFtcyh0MiwgbzIpLCB0aGlzLnBhcnNlRnVuY3Rpb25Cb2R5QW5kRmluaXNoKHQyLCBuMiwgdHJ1ZSksIHRoaXMucHJvZFBhcmFtLmV4aXQoKSwgdGhpcy5zY29wZS5leGl0KCksIHQyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VBcnJheUxpa2UodDIsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgczIgJiYgdGhpcy5leHBlY3RQbHVnaW4oInJlY29yZEFuZFR1cGxlIik7CiAgICAgICAgICAgIGNvbnN0IGkyID0gdGhpcy5zdGF0ZS5pbkZTaGFycFBpcGVsaW5lRGlyZWN0Qm9keTsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5pbkZTaGFycFBpcGVsaW5lRGlyZWN0Qm9keSA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBuMiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgbjIuZWxlbWVudHMgPSB0aGlzLnBhcnNlRXhwckxpc3QodDIsICFzMiwgcjIsIG4yKSwgdGhpcy5zdGF0ZS5pbkZTaGFycFBpcGVsaW5lRGlyZWN0Qm9keSA9IGkyLCB0aGlzLmZpbmlzaE5vZGUobjIsIHMyID8gIlR1cGxlRXhwcmVzc2lvbiIgOiAiQXJyYXlFeHByZXNzaW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUFycm93RXhwcmVzc2lvbih0MiwgZTIsIHMyLCByMikgewogICAgICAgICAgICB0aGlzLnNjb3BlLmVudGVyKDYpOwogICAgICAgICAgICBsZXQgaTIgPSBNbChzMiwgZmFsc2UpOwogICAgICAgICAgICAhdGhpcy5tYXRjaCgwKSAmJiB0aGlzLnByb2RQYXJhbS5oYXNJbiAmJiAoaTIgfD0gOCksIHRoaXMucHJvZFBhcmFtLmVudGVyKGkyKSwgdGhpcy5pbml0RnVuY3Rpb24odDIsIHMyKTsKICAgICAgICAgICAgY29uc3QgbjIgPSB0aGlzLnN0YXRlLm1heWJlSW5BcnJvd1BhcmFtZXRlcnM7CiAgICAgICAgICAgIHJldHVybiBlMiAmJiAodGhpcy5zdGF0ZS5tYXliZUluQXJyb3dQYXJhbWV0ZXJzID0gdHJ1ZSwgdGhpcy5zZXRBcnJvd0Z1bmN0aW9uUGFyYW1ldGVycyh0MiwgZTIsIHIyKSksIHRoaXMuc3RhdGUubWF5YmVJbkFycm93UGFyYW1ldGVycyA9IGZhbHNlLCB0aGlzLnBhcnNlRnVuY3Rpb25Cb2R5KHQyLCB0cnVlKSwgdGhpcy5wcm9kUGFyYW0uZXhpdCgpLCB0aGlzLnNjb3BlLmV4aXQoKSwgdGhpcy5zdGF0ZS5tYXliZUluQXJyb3dQYXJhbWV0ZXJzID0gbjIsIHRoaXMuZmluaXNoTm9kZSh0MiwgIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICBzZXRBcnJvd0Z1bmN0aW9uUGFyYW1ldGVycyh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIHQyLnBhcmFtcyA9IHRoaXMudG9Bc3NpZ25hYmxlTGlzdChlMiwgczIsIGZhbHNlKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRnVuY3Rpb25Cb2R5QW5kRmluaXNoKHQyLCBlMikgewogICAgICAgICAgICBsZXQgczIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCAmJiBhcmd1bWVudHNbMl07CiAgICAgICAgICAgIHRoaXMucGFyc2VGdW5jdGlvbkJvZHkodDIsIGZhbHNlLCBzMiksIHRoaXMuZmluaXNoTm9kZSh0MiwgZTIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VGdW5jdGlvbkJvZHkodDIsIGUyKSB7CiAgICAgICAgICAgIGxldCBzMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdm9pZCAwICYmIGFyZ3VtZW50c1syXTsKICAgICAgICAgICAgY29uc3QgcjIgPSBlMiAmJiAhdGhpcy5tYXRjaCg1KTsKICAgICAgICAgICAgaWYgKHRoaXMuZXhwcmVzc2lvblNjb3BlLmVudGVyKExsKCkpLCByMikKICAgICAgICAgICAgICB0Mi5ib2R5ID0gdGhpcy5wYXJzZU1heWJlQXNzaWduKCksIHRoaXMuY2hlY2tQYXJhbXModDIsIGZhbHNlLCBlMiwgZmFsc2UpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBjb25zdCByMyA9IHRoaXMuc3RhdGUuc3RyaWN0LCBpMiA9IHRoaXMuc3RhdGUubGFiZWxzOwogICAgICAgICAgICAgIHRoaXMuc3RhdGUubGFiZWxzID0gW10sIHRoaXMucHJvZFBhcmFtLmVudGVyKDQgfCB0aGlzLnByb2RQYXJhbS5jdXJyZW50RmxhZ3MoKSksIHQyLmJvZHkgPSB0aGlzLnBhcnNlQmxvY2sodHJ1ZSwgZmFsc2UsIChpMykgPT4gewogICAgICAgICAgICAgICAgY29uc3QgbjIgPSAhdGhpcy5pc1NpbXBsZVBhcmFtTGlzdCh0Mi5wYXJhbXMpOwogICAgICAgICAgICAgICAgaWYgKGkzICYmIG4yKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGUzID0gdDIua2luZCAhPT0gIm1ldGhvZCIgJiYgdDIua2luZCAhPT0gImNvbnN0cnVjdG9yIiB8fCAhdDIua2V5ID8gdDIuc3RhcnQgOiB0Mi5rZXkuZW5kOwogICAgICAgICAgICAgICAgICB0aGlzLnJhaXNlKGUzLCBEYy5JbGxlZ2FsTGFuZ3VhZ2VNb2RlRGlyZWN0aXZlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGEyID0gIXIzICYmIHRoaXMuc3RhdGUuc3RyaWN0OwogICAgICAgICAgICAgICAgdGhpcy5jaGVja1BhcmFtcyh0MiwgISh0aGlzLnN0YXRlLnN0cmljdCB8fCBlMiB8fCBzMiB8fCBuMiksIGUyLCBhMiksIHRoaXMuc3RhdGUuc3RyaWN0ICYmIHQyLmlkICYmIHRoaXMuY2hlY2tMVmFsKHQyLmlkLCAiZnVuY3Rpb24gbmFtZSIsIDY1LCB2b2lkIDAsIHZvaWQgMCwgYTIpOwogICAgICAgICAgICAgIH0pLCB0aGlzLnByb2RQYXJhbS5leGl0KCksIHRoaXMuc3RhdGUubGFiZWxzID0gaTI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5leHByZXNzaW9uU2NvcGUuZXhpdCgpOwogICAgICAgICAgfQogICAgICAgICAgaXNTaW1wbGVQYXJhbUxpc3QodDIpIHsKICAgICAgICAgICAgZm9yIChsZXQgZTIgPSAwLCBzMiA9IHQyLmxlbmd0aDsgZTIgPCBzMjsgZTIrKykKICAgICAgICAgICAgICBpZiAodDJbZTJdLnR5cGUgIT09ICJJZGVudGlmaWVyIikKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja1BhcmFtcyh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIGxldCByMiA9ICEoYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB2b2lkIDApIHx8IGFyZ3VtZW50c1szXTsKICAgICAgICAgICAgY29uc3QgaTIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHMzIG9mIHQyLnBhcmFtcykKICAgICAgICAgICAgICB0aGlzLmNoZWNrTFZhbChzMywgImZ1bmN0aW9uIHBhcmFtZXRlciBsaXN0IiwgNSwgZTIgPyBudWxsIDogaTIsIHZvaWQgMCwgcjIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHByTGlzdCh0MiwgZTIsIHMyLCByMikgewogICAgICAgICAgICBjb25zdCBpMiA9IFtdOwogICAgICAgICAgICBsZXQgbjIgPSB0cnVlOwogICAgICAgICAgICBmb3IgKDsgIXRoaXMuZWF0KHQyKTsgKSB7CiAgICAgICAgICAgICAgaWYgKG4yKQogICAgICAgICAgICAgICAgbjIgPSBmYWxzZTsKICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLmV4cGVjdCgxMiksIHRoaXMubWF0Y2godDIpKSB7CiAgICAgICAgICAgICAgICByMiAmJiB0aGlzLmFkZEV4dHJhKHIyLCAidHJhaWxpbmdDb21tYSIsIHRoaXMuc3RhdGUubGFzdFRva1N0YXJ0KSwgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaTIucHVzaCh0aGlzLnBhcnNlRXhwckxpc3RJdGVtKGUyLCBzMikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRXhwckxpc3RJdGVtKHQyLCBlMiwgczIpIHsKICAgICAgICAgICAgbGV0IHIyOwogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCgxMikpCiAgICAgICAgICAgICAgdDIgfHwgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnBvcywgRGMuVW5leHBlY3RlZFRva2VuLCAiLCIpLCByMiA9IG51bGw7CiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMubWF0Y2goMjEpKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXRlLnN0YXJ0LCBzMyA9IHRoaXMuc3RhdGUuc3RhcnRMb2M7CiAgICAgICAgICAgICAgcjIgPSB0aGlzLnBhcnNlUGFyZW5JdGVtKHRoaXMucGFyc2VTcHJlYWQoZTIpLCB0MywgczMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubWF0Y2goMTcpKSB7CiAgICAgICAgICAgICAgdGhpcy5leHBlY3RQbHVnaW4oInBhcnRpYWxBcHBsaWNhdGlvbiIpLCBzMiB8fCB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIERjLlVuZXhwZWN0ZWRBcmd1bWVudFBsYWNlaG9sZGVyKTsKICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgICAgdGhpcy5uZXh0KCksIHIyID0gdGhpcy5maW5pc2hOb2RlKHQzLCAiQXJndW1lbnRQbGFjZWhvbGRlciIpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICByMiA9IHRoaXMucGFyc2VNYXliZUFzc2lnbkFsbG93SW4oZTIsIHRoaXMucGFyc2VQYXJlbkl0ZW0pOwogICAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUlkZW50aWZpZXIodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXJ0Tm9kZSgpLCBzMiA9IHRoaXMucGFyc2VJZGVudGlmaWVyTmFtZShlMi5zdGFydCwgdDIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVJZGVudGlmaWVyKGUyLCBzMik7CiAgICAgICAgICB9CiAgICAgICAgICBjcmVhdGVJZGVudGlmaWVyKHQyLCBlMikgewogICAgICAgICAgICByZXR1cm4gdDIubmFtZSA9IGUyLCB0Mi5sb2MuaWRlbnRpZmllck5hbWUgPSBlMiwgdGhpcy5maW5pc2hOb2RlKHQyLCAiSWRlbnRpZmllciIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VJZGVudGlmaWVyTmFtZSh0MiwgZTIpIHsKICAgICAgICAgICAgbGV0IHMyOwogICAgICAgICAgICBjb25zdCB7IHN0YXJ0OiByMiwgdHlwZTogaTIgfSA9IHRoaXMuc3RhdGU7CiAgICAgICAgICAgIGlmICghX2MoaTIpKQogICAgICAgICAgICAgIHRocm93IHRoaXMudW5leHBlY3RlZCgpOwogICAgICAgICAgICBzMiA9IHRoaXMuc3RhdGUudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IG4yID0gaTIgPD0gODY7CiAgICAgICAgICAgIHJldHVybiBlMiA/IG4yICYmIHRoaXMucmVwbGFjZVRva2VuKDEyMikgOiB0aGlzLmNoZWNrUmVzZXJ2ZWRXb3JkKHMyLCByMiwgbjIsIGZhbHNlKSwgdGhpcy5uZXh0KCksIHMyOwogICAgICAgICAgfQogICAgICAgICAgY2hlY2tSZXNlcnZlZFdvcmQodDIsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgaWYgKHQyLmxlbmd0aCA+IDEwKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgaWYgKCFmdW5jdGlvbih0MykgewogICAgICAgICAgICAgIHJldHVybiBsbC5oYXModDMpOwogICAgICAgICAgICB9KHQyKSkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmICh0MiA9PT0gInlpZWxkIikgewogICAgICAgICAgICAgIGlmICh0aGlzLnByb2RQYXJhbS5oYXNZaWVsZCkKICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMucmFpc2UoZTIsIERjLllpZWxkQmluZGluZ0lkZW50aWZpZXIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHQyID09PSAiYXdhaXQiKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMucHJvZFBhcmFtLmhhc0F3YWl0KQogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5yYWlzZShlMiwgRGMuQXdhaXRCaW5kaW5nSWRlbnRpZmllcik7CiAgICAgICAgICAgICAgaWYgKHRoaXMuc2NvcGUuaW5TdGF0aWNCbG9jaykKICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMucmFpc2UoZTIsIERjLkF3YWl0QmluZGluZ0lkZW50aWZpZXJJblN0YXRpY0Jsb2NrKTsKICAgICAgICAgICAgICB0aGlzLmV4cHJlc3Npb25TY29wZS5yZWNvcmRBc3luY0Fycm93UGFyYW1ldGVyc0Vycm9yKGUyLCBEYy5Bd2FpdEJpbmRpbmdJZGVudGlmaWVyKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0MiA9PT0gImFyZ3VtZW50cyIgJiYgdGhpcy5zY29wZS5pbkNsYXNzQW5kTm90SW5Ob25BcnJvd0Z1bmN0aW9uKQogICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMucmFpc2UoZTIsIERjLkFyZ3VtZW50c0luQ2xhc3MpOwogICAgICAgICAgICBpZiAoczIgJiYgZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICByZXR1cm4gbmwuaGFzKHQzKTsKICAgICAgICAgICAgfSh0MikpCiAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5yYWlzZShlMiwgRGMuVW5leHBlY3RlZEtleXdvcmQsIHQyKTsKICAgICAgICAgICAgKHRoaXMuc3RhdGUuc3RyaWN0ID8gcjIgPyBjbCA6IGhsIDogdWwpKHQyLCB0aGlzLmluTW9kdWxlKSAmJiB0aGlzLnJhaXNlKGUyLCBEYy5VbmV4cGVjdGVkUmVzZXJ2ZWRXb3JkLCB0Mik7CiAgICAgICAgICB9CiAgICAgICAgICBpc0F3YWl0QWxsb3dlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5wcm9kUGFyYW0uaGFzQXdhaXQgfHwgISghdGhpcy5vcHRpb25zLmFsbG93QXdhaXRPdXRzaWRlRnVuY3Rpb24gfHwgdGhpcy5zY29wZS5pbkZ1bmN0aW9uKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQXdhaXQodDIsIGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHMyID0gdGhpcy5zdGFydE5vZGVBdCh0MiwgZTIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5leHByZXNzaW9uU2NvcGUucmVjb3JkUGFyYW1ldGVySW5pdGlhbGl6ZXJFcnJvcihzMi5zdGFydCwgRGMuQXdhaXRFeHByZXNzaW9uRm9ybWFsUGFyYW1ldGVyKSwgdGhpcy5lYXQoNDkpICYmIHRoaXMucmFpc2UoczIuc3RhcnQsIERjLk9ic29sZXRlQXdhaXRTdGFyKSwgdGhpcy5zY29wZS5pbkZ1bmN0aW9uIHx8IHRoaXMub3B0aW9ucy5hbGxvd0F3YWl0T3V0c2lkZUZ1bmN0aW9uIHx8ICh0aGlzLmlzQW1iaWd1b3VzQXdhaXQoKSA/IHRoaXMuYW1iaWd1b3VzU2NyaXB0RGlmZmVyZW50QXN0ID0gdHJ1ZSA6IHRoaXMuc2F3VW5hbWJpZ3VvdXNFU00gPSB0cnVlKSwgdGhpcy5zdGF0ZS5zb2xvQXdhaXQgfHwgKHMyLmFyZ3VtZW50ID0gdGhpcy5wYXJzZU1heWJlVW5hcnkobnVsbCwgdHJ1ZSkpLCB0aGlzLmZpbmlzaE5vZGUoczIsICJBd2FpdEV4cHJlc3Npb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIGlzQW1iaWd1b3VzQXdhaXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmhhc1ByZWNlZGluZ0xpbmVCcmVhaygpIHx8IHRoaXMubWF0Y2goNDcpIHx8IHRoaXMubWF0Y2goMTApIHx8IHRoaXMubWF0Y2goMCkgfHwgdGhpcy5tYXRjaCgyMikgfHwgdGhpcy5tYXRjaCgxMjcpIHx8IHRoaXMubWF0Y2goNTApIHx8IHRoaXMuaGFzUGx1Z2luKCJ2OGludHJpbnNpYyIpICYmIHRoaXMubWF0Y2goNDgpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VZaWVsZCgpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICB0aGlzLmV4cHJlc3Npb25TY29wZS5yZWNvcmRQYXJhbWV0ZXJJbml0aWFsaXplckVycm9yKHQyLnN0YXJ0LCBEYy5ZaWVsZEluUGFyYW1ldGVyKSwgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgIGxldCBlMiA9IGZhbHNlLCBzMiA9IG51bGw7CiAgICAgICAgICAgIGlmICghdGhpcy5oYXNQcmVjZWRpbmdMaW5lQnJlYWsoKSkKICAgICAgICAgICAgICBzd2l0Y2ggKGUyID0gdGhpcy5lYXQoNDkpLCB0aGlzLnN0YXRlLnR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICBjYXNlIDEyOToKICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgICAgaWYgKCFlMikKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHMyID0gdGhpcy5wYXJzZU1heWJlQXNzaWduKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDIuZGVsZWdhdGUgPSBlMiwgdDIuYXJndW1lbnQgPSBzMiwgdGhpcy5maW5pc2hOb2RlKHQyLCAiWWllbGRFeHByZXNzaW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja1BpcGVsaW5lQXRJbmZpeE9wZXJhdG9yKHQyLCBlMikgewogICAgICAgICAgICB0aGlzLmdldFBsdWdpbk9wdGlvbigicGlwZWxpbmVPcGVyYXRvciIsICJwcm9wb3NhbCIpID09PSAic21hcnQiICYmIHQyLnR5cGUgPT09ICJTZXF1ZW5jZUV4cHJlc3Npb24iICYmIHRoaXMucmFpc2UoZTIsIERjLlBpcGVsaW5lSGVhZFNlcXVlbmNlRXhwcmVzc2lvbik7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0hhY2tQaXBlQm9keUVhcmx5RXJyb3JzKHQyKSB7CiAgICAgICAgICAgIHRoaXMudG9waWNSZWZlcmVuY2VXYXNVc2VkSW5DdXJyZW50Q29udGV4dCgpIHx8IHRoaXMucmFpc2UodDIsIERjLlBpcGVUb3BpY1VudXNlZCk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZVNtYXJ0UGlwZWxpbmVCb2R5SW5TdHlsZSh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGFydE5vZGVBdChlMiwgczIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5pc1NpbXBsZVJlZmVyZW5jZSh0MikgPyAocjIuY2FsbGVlID0gdDIsIHRoaXMuZmluaXNoTm9kZShyMiwgIlBpcGVsaW5lQmFyZUZ1bmN0aW9uIikpIDogKHRoaXMuY2hlY2tTbWFydFBpcGVUb3BpY0JvZHlFYXJseUVycm9ycyhlMiksIHIyLmV4cHJlc3Npb24gPSB0MiwgdGhpcy5maW5pc2hOb2RlKHIyLCAiUGlwZWxpbmVUb3BpY0V4cHJlc3Npb24iKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpc1NpbXBsZVJlZmVyZW5jZSh0MikgewogICAgICAgICAgICBzd2l0Y2ggKHQyLnR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICJNZW1iZXJFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgIHJldHVybiAhdDIuY29tcHV0ZWQgJiYgdGhpcy5pc1NpbXBsZVJlZmVyZW5jZSh0Mi5vYmplY3QpOwogICAgICAgICAgICAgIGNhc2UgIklkZW50aWZpZXIiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY2hlY2tTbWFydFBpcGVUb3BpY0JvZHlFYXJseUVycm9ycyh0MikgewogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCgxOSkpCiAgICAgICAgICAgICAgdGhyb3cgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0LCBEYy5QaXBlbGluZUJvZHlOb0Fycm93KTsKICAgICAgICAgICAgdGhpcy50b3BpY1JlZmVyZW5jZVdhc1VzZWRJbkN1cnJlbnRDb250ZXh0KCkgfHwgdGhpcy5yYWlzZSh0MiwgRGMuUGlwZWxpbmVUb3BpY1VudXNlZCk7CiAgICAgICAgICB9CiAgICAgICAgICB3aXRoVG9waWNCaW5kaW5nQ29udGV4dCh0MikgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhdGUudG9waWNDb250ZXh0OwogICAgICAgICAgICB0aGlzLnN0YXRlLnRvcGljQ29udGV4dCA9IHsgbWF4TnVtT2ZSZXNvbHZhYmxlVG9waWNzOiAxLCBtYXhUb3BpY0luZGV4OiBudWxsIH07CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQyKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZS50b3BpY0NvbnRleHQgPSBlMjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgd2l0aFNtYXJ0TWl4VG9waWNGb3JiaWRkaW5nQ29udGV4dCh0MikgewogICAgICAgICAgICBpZiAodGhpcy5nZXRQbHVnaW5PcHRpb24oInBpcGVsaW5lT3BlcmF0b3IiLCAicHJvcG9zYWwiKSAhPT0gInNtYXJ0IikKICAgICAgICAgICAgICByZXR1cm4gdDIoKTsKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGF0ZS50b3BpY0NvbnRleHQ7CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZS50b3BpY0NvbnRleHQgPSB7IG1heE51bU9mUmVzb2x2YWJsZVRvcGljczogMCwgbWF4VG9waWNJbmRleDogbnVsbCB9OwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdDIoKTsKICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS50b3BpY0NvbnRleHQgPSBlMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHdpdGhTb2xvQXdhaXRQZXJtaXR0aW5nQ29udGV4dCh0MikgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhdGUuc29sb0F3YWl0OwogICAgICAgICAgICB0aGlzLnN0YXRlLnNvbG9Bd2FpdCA9IHRydWU7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQyKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5zb2xvQXdhaXQgPSBlMjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYWxsb3dJbkFuZCh0MikgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMucHJvZFBhcmFtLmN1cnJlbnRGbGFncygpOwogICAgICAgICAgICBpZiAoOCAmIH5lMikgewogICAgICAgICAgICAgIHRoaXMucHJvZFBhcmFtLmVudGVyKDggfCBlMik7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiB0MigpOwogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB0aGlzLnByb2RQYXJhbS5leGl0KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0MigpOwogICAgICAgICAgfQogICAgICAgICAgZGlzYWxsb3dJbkFuZCh0MikgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMucHJvZFBhcmFtLmN1cnJlbnRGbGFncygpOwogICAgICAgICAgICBpZiAoOCAmIGUyKSB7CiAgICAgICAgICAgICAgdGhpcy5wcm9kUGFyYW0uZW50ZXIoLTkgJiBlMik7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiB0MigpOwogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB0aGlzLnByb2RQYXJhbS5leGl0KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0MigpOwogICAgICAgICAgfQogICAgICAgICAgcmVnaXN0ZXJUb3BpY1JlZmVyZW5jZSgpIHsKICAgICAgICAgICAgdGhpcy5zdGF0ZS50b3BpY0NvbnRleHQubWF4VG9waWNJbmRleCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICB0b3BpY1JlZmVyZW5jZUlzQWxsb3dlZEluQ3VycmVudENvbnRleHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnRvcGljQ29udGV4dC5tYXhOdW1PZlJlc29sdmFibGVUb3BpY3MgPj0gMTsKICAgICAgICAgIH0KICAgICAgICAgIHRvcGljUmVmZXJlbmNlV2FzVXNlZEluQ3VycmVudENvbnRleHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnRvcGljQ29udGV4dC5tYXhUb3BpY0luZGV4ICE9IG51bGwgJiYgdGhpcy5zdGF0ZS50b3BpY0NvbnRleHQubWF4VG9waWNJbmRleCA+PSAwOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VGU2hhcnBQaXBlbGluZUJvZHkodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXRlLnN0YXJ0LCBzMiA9IHRoaXMuc3RhdGUuc3RhcnRMb2M7CiAgICAgICAgICAgIHRoaXMuc3RhdGUucG90ZW50aWFsQXJyb3dBdCA9IHRoaXMuc3RhdGUuc3RhcnQ7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGF0ZS5pbkZTaGFycFBpcGVsaW5lRGlyZWN0Qm9keTsKICAgICAgICAgICAgdGhpcy5zdGF0ZS5pbkZTaGFycFBpcGVsaW5lRGlyZWN0Qm9keSA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IGkyID0gdGhpcy5wYXJzZUV4cHJPcCh0aGlzLnBhcnNlTWF5YmVVbmFyeU9yUHJpdmF0ZSgpLCBlMiwgczIsIHQyKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuaW5GU2hhcnBQaXBlbGluZURpcmVjdEJvZHkgPSByMiwgaTI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU1vZHVsZUV4cHJlc3Npb24oKSB7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0UGx1Z2luKCJtb2R1bGVCbG9ja3MiKTsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICB0aGlzLm5leHQoKSwgdGhpcy5lYXQoNSk7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5pbml0aWFsaXplU2NvcGVzKHRydWUpOwogICAgICAgICAgICB0aGlzLmVudGVySW5pdGlhbFNjb3BlcygpOwogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdDIuYm9keSA9IHRoaXMucGFyc2VQcm9ncmFtKHMyLCA4LCAibW9kdWxlIik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgZTIoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5lYXQoOCksIHRoaXMuZmluaXNoTm9kZSh0MiwgIk1vZHVsZUV4cHJlc3Npb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlUHJvcGVydHlOYW1lUHJlZml4T3BlcmF0b3IodDIpIHsKICAgICAgICAgIH0KICAgICAgICB9IHsKICAgICAgICAgIHBhcnNlVG9wTGV2ZWwodDIsIGUyKSB7CiAgICAgICAgICAgIHJldHVybiB0Mi5wcm9ncmFtID0gdGhpcy5wYXJzZVByb2dyYW0oZTIpLCB0Mi5jb21tZW50cyA9IHRoaXMuc3RhdGUuY29tbWVudHMsIHRoaXMub3B0aW9ucy50b2tlbnMgJiYgKHQyLnRva2VucyA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgICAgZm9yIChsZXQgZTMgPSAwOyBlMyA8IHQzLmxlbmd0aDsgZTMrKykgewogICAgICAgICAgICAgICAgY29uc3QgczIgPSB0M1tlM10sIHsgdHlwZTogcjIgfSA9IHMyOwogICAgICAgICAgICAgICAgaWYgKHIyICE9PSAxMjgpCiAgICAgICAgICAgICAgICAgIHR5cGVvZiByMiA9PSAibnVtYmVyIiAmJiAoczIudHlwZSA9IEdjKHIyKSk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgY29uc3QgeyBsb2M6IHIzLCBzdGFydDogaTIsIHZhbHVlOiBuMiwgZW5kOiBhMiB9ID0gczIsIG8yID0gaTIgKyAxLCB1MiA9IG5ldyB1YyhyMy5zdGFydC5saW5lLCByMy5zdGFydC5jb2x1bW4gKyAxKTsKICAgICAgICAgICAgICAgICAgdDMuc3BsaWNlKGUzLCAxLCBuZXcgd2woeyB0eXBlOiBHYygyNSksIHZhbHVlOiAiIyIsIHN0YXJ0OiBpMiwgZW5kOiBvMiwgc3RhcnRMb2M6IHIzLnN0YXJ0LCBlbmRMb2M6IHUyIH0pLCBuZXcgd2woeyB0eXBlOiBHYygxMjIpLCB2YWx1ZTogbjIsIHN0YXJ0OiBvMiwgZW5kOiBhMiwgc3RhcnRMb2M6IHUyLCBlbmRMb2M6IHIzLmVuZCB9KSksIGUzKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB0MzsKICAgICAgICAgICAgfSh0aGlzLnRva2VucykpLCB0aGlzLmZpbmlzaE5vZGUodDIsICJGaWxlIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZVByb2dyYW0odDIpIHsKICAgICAgICAgICAgbGV0IGUyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMV0gOiAxMjksIHMyID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMl0gOiB0aGlzLm9wdGlvbnMuc291cmNlVHlwZTsKICAgICAgICAgICAgaWYgKHQyLnNvdXJjZVR5cGUgPSBzMiwgdDIuaW50ZXJwcmV0ZXIgPSB0aGlzLnBhcnNlSW50ZXJwcmV0ZXJEaXJlY3RpdmUoKSwgdGhpcy5wYXJzZUJsb2NrQm9keSh0MiwgdHJ1ZSwgdHJ1ZSwgZTIpLCB0aGlzLmluTW9kdWxlICYmICF0aGlzLm9wdGlvbnMuYWxsb3dVbmRlY2xhcmVkRXhwb3J0cyAmJiB0aGlzLnNjb3BlLnVuZGVmaW5lZEV4cG9ydHMuc2l6ZSA+IDApCiAgICAgICAgICAgICAgZm9yIChjb25zdCBbdDNdIG9mIEFycmF5LmZyb20odGhpcy5zY29wZS51bmRlZmluZWRFeHBvcnRzKSkgewogICAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLnNjb3BlLnVuZGVmaW5lZEV4cG9ydHMuZ2V0KHQzKTsKICAgICAgICAgICAgICAgIHRoaXMucmFpc2UoZTMsIERjLk1vZHVsZUV4cG9ydFVuZGVmaW5lZCwgdDMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmluaXNoTm9kZSh0MiwgIlByb2dyYW0iKTsKICAgICAgICAgIH0KICAgICAgICAgIHN0bXRUb0RpcmVjdGl2ZSh0MikgewogICAgICAgICAgICBjb25zdCBlMiA9IHQyOwogICAgICAgICAgICBlMi50eXBlID0gIkRpcmVjdGl2ZSIsIGUyLnZhbHVlID0gZTIuZXhwcmVzc2lvbiwgZGVsZXRlIGUyLmV4cHJlc3Npb247CiAgICAgICAgICAgIGNvbnN0IHMyID0gZTIudmFsdWUsIHIyID0gczIudmFsdWUsIGkyID0gdGhpcy5pbnB1dC5zbGljZShzMi5zdGFydCwgczIuZW5kKSwgbjIgPSBzMi52YWx1ZSA9IGkyLnNsaWNlKDEsIC0xKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkRXh0cmEoczIsICJyYXciLCBpMiksIHRoaXMuYWRkRXh0cmEoczIsICJyYXdWYWx1ZSIsIG4yKSwgdGhpcy5hZGRFeHRyYShzMiwgImV4cHJlc3Npb25WYWx1ZSIsIHIyKSwgczIudHlwZSA9ICJEaXJlY3RpdmVMaXRlcmFsIiwgZTI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUludGVycHJldGVyRGlyZWN0aXZlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMubWF0Y2goMjYpKQogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0Mi52YWx1ZSA9IHRoaXMuc3RhdGUudmFsdWUsIHRoaXMubmV4dCgpLCB0aGlzLmZpbmlzaE5vZGUodDIsICJJbnRlcnByZXRlckRpcmVjdGl2ZSIpOwogICAgICAgICAgfQogICAgICAgICAgaXNMZXQodDIpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5pc0NvbnRleHR1YWwoOTMpICYmIHRoaXMuaXNMZXRLZXl3b3JkKHQyKTsKICAgICAgICAgIH0KICAgICAgICAgIGlzTGV0S2V5d29yZCh0MikgewogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMubmV4dFRva2VuU3RhcnQoKSwgczIgPSB0aGlzLmNvZGVQb2ludEF0UG9zKGUyKTsKICAgICAgICAgICAgaWYgKHMyID09PSA5MiB8fCBzMiA9PT0gOTEpCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmICh0MikKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChzMiA9PT0gMTIzKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoZWwoczIpKSB7CiAgICAgICAgICAgICAgaWYgKEFkLmxhc3RJbmRleCA9IGUyLCBBZC50ZXN0KHRoaXMuaW5wdXQpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuY29kZVBvaW50QXRQb3MoQWQubGFzdEluZGV4KTsKICAgICAgICAgICAgICAgIGlmICghc2wodDMpICYmIHQzICE9PSA5MikKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZVN0YXRlbWVudCh0MiwgZTIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goMjQpICYmIHRoaXMucGFyc2VEZWNvcmF0b3JzKHRydWUpLCB0aGlzLnBhcnNlU3RhdGVtZW50Q29udGVudCh0MiwgZTIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VTdGF0ZW1lbnRDb250ZW50KHQyLCBlMikgewogICAgICAgICAgICBsZXQgczIgPSB0aGlzLnN0YXRlLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgbGV0IGkyOwogICAgICAgICAgICBzd2l0Y2ggKHRoaXMuaXNMZXQodDIpICYmIChzMiA9IDY4LCBpMiA9ICJsZXQiKSwgczIpIHsKICAgICAgICAgICAgICBjYXNlIDU0OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VCcmVha0NvbnRpbnVlU3RhdGVtZW50KHIyLCB0cnVlKTsKICAgICAgICAgICAgICBjYXNlIDU3OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VCcmVha0NvbnRpbnVlU3RhdGVtZW50KHIyLCBmYWxzZSk7CiAgICAgICAgICAgICAgY2FzZSA1ODoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlRGVidWdnZXJTdGF0ZW1lbnQocjIpOwogICAgICAgICAgICAgIGNhc2UgODQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZURvU3RhdGVtZW50KHIyKTsKICAgICAgICAgICAgICBjYXNlIDg1OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VGb3JTdGF0ZW1lbnQocjIpOwogICAgICAgICAgICAgIGNhc2UgNjI6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5sb29rYWhlYWRDaGFyQ29kZSgpID09PSA0NikKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICByZXR1cm4gdDIgJiYgKHRoaXMuc3RhdGUuc3RyaWN0ID8gdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0LCBEYy5TdHJpY3RGdW5jdGlvbikgOiB0MiAhPT0gImlmIiAmJiB0MiAhPT0gImxhYmVsIiAmJiB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIERjLlNsb3BweUZ1bmN0aW9uKSksIHRoaXMucGFyc2VGdW5jdGlvblN0YXRlbWVudChyMiwgZmFsc2UsICF0Mik7CiAgICAgICAgICAgICAgY2FzZSA3NDoKICAgICAgICAgICAgICAgIHJldHVybiB0MiAmJiB0aGlzLnVuZXhwZWN0ZWQoKSwgdGhpcy5wYXJzZUNsYXNzKHIyLCB0cnVlKTsKICAgICAgICAgICAgICBjYXNlIDYzOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VJZlN0YXRlbWVudChyMik7CiAgICAgICAgICAgICAgY2FzZSA2NDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlUmV0dXJuU3RhdGVtZW50KHIyKTsKICAgICAgICAgICAgICBjYXNlIDY1OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VTd2l0Y2hTdGF0ZW1lbnQocjIpOwogICAgICAgICAgICAgIGNhc2UgNjY6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZVRocm93U3RhdGVtZW50KHIyKTsKICAgICAgICAgICAgICBjYXNlIDY3OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VUcnlTdGF0ZW1lbnQocjIpOwogICAgICAgICAgICAgIGNhc2UgNjk6CiAgICAgICAgICAgICAgY2FzZSA2ODoKICAgICAgICAgICAgICAgIHJldHVybiBpMiA9IGkyIHx8IHRoaXMuc3RhdGUudmFsdWUsIHQyICYmIGkyICE9PSAidmFyIiAmJiB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIERjLlVuZXhwZWN0ZWRMZXhpY2FsRGVjbGFyYXRpb24pLCB0aGlzLnBhcnNlVmFyU3RhdGVtZW50KHIyLCBpMik7CiAgICAgICAgICAgICAgY2FzZSA4NjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlV2hpbGVTdGF0ZW1lbnQocjIpOwogICAgICAgICAgICAgIGNhc2UgNzA6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZVdpdGhTdGF0ZW1lbnQocjIpOwogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlQmxvY2soKTsKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VFbXB0eVN0YXRlbWVudChyMik7CiAgICAgICAgICAgICAgY2FzZSA3NzogewogICAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLmxvb2thaGVhZENoYXJDb2RlKCk7CiAgICAgICAgICAgICAgICBpZiAodDMgPT09IDQwIHx8IHQzID09PSA0NikKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgNzY6IHsKICAgICAgICAgICAgICAgIGxldCB0MzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuYWxsb3dJbXBvcnRFeHBvcnRFdmVyeXdoZXJlIHx8IGUyIHx8IHRoaXMucmFpc2UodGhpcy5zdGF0ZS5zdGFydCwgRGMuVW5leHBlY3RlZEltcG9ydEV4cG9ydCksIHRoaXMubmV4dCgpLCBzMiA9PT0gNzcgPyAodDMgPSB0aGlzLnBhcnNlSW1wb3J0KHIyKSwgdDMudHlwZSAhPT0gIkltcG9ydERlY2xhcmF0aW9uIiB8fCB0My5pbXBvcnRLaW5kICYmIHQzLmltcG9ydEtpbmQgIT09ICJ2YWx1ZSIgfHwgKHRoaXMuc2F3VW5hbWJpZ3VvdXNFU00gPSB0cnVlKSkgOiAodDMgPSB0aGlzLnBhcnNlRXhwb3J0KHIyKSwgKHQzLnR5cGUgIT09ICJFeHBvcnROYW1lZERlY2xhcmF0aW9uIiB8fCB0My5leHBvcnRLaW5kICYmIHQzLmV4cG9ydEtpbmQgIT09ICJ2YWx1ZSIpICYmICh0My50eXBlICE9PSAiRXhwb3J0QWxsRGVjbGFyYXRpb24iIHx8IHQzLmV4cG9ydEtpbmQgJiYgdDMuZXhwb3J0S2luZCAhPT0gInZhbHVlIikgJiYgdDMudHlwZSAhPT0gIkV4cG9ydERlZmF1bHREZWNsYXJhdGlvbiIgfHwgKHRoaXMuc2F3VW5hbWJpZ3VvdXNFU00gPSB0cnVlKSksIHRoaXMuYXNzZXJ0TW9kdWxlTm9kZUFsbG93ZWQocjIpLCB0MzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQXN5bmNGdW5jdGlvbigpKQogICAgICAgICAgICAgICAgICByZXR1cm4gdDIgJiYgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0LCBEYy5Bc3luY0Z1bmN0aW9uSW5TaW5nbGVTdGF0ZW1lbnRDb250ZXh0KSwgdGhpcy5uZXh0KCksIHRoaXMucGFyc2VGdW5jdGlvblN0YXRlbWVudChyMiwgdHJ1ZSwgIXQyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBuMiA9IHRoaXMuc3RhdGUudmFsdWUsIGEyID0gdGhpcy5wYXJzZUV4cHJlc3Npb24oKTsKICAgICAgICAgICAgcmV0dXJuIFVjKHMyKSAmJiBhMi50eXBlID09PSAiSWRlbnRpZmllciIgJiYgdGhpcy5lYXQoMTQpID8gdGhpcy5wYXJzZUxhYmVsZWRTdGF0ZW1lbnQocjIsIG4yLCBhMiwgdDIpIDogdGhpcy5wYXJzZUV4cHJlc3Npb25TdGF0ZW1lbnQocjIsIGEyKTsKICAgICAgICAgIH0KICAgICAgICAgIGFzc2VydE1vZHVsZU5vZGVBbGxvd2VkKHQyKSB7CiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hbGxvd0ltcG9ydEV4cG9ydEV2ZXJ5d2hlcmUgfHwgdGhpcy5pbk1vZHVsZSB8fCB0aGlzLnJhaXNlKHQyLnN0YXJ0LCBtYy5JbXBvcnRPdXRzaWRlTW9kdWxlKTsKICAgICAgICAgIH0KICAgICAgICAgIHRha2VEZWNvcmF0b3JzKHQyKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGF0ZS5kZWNvcmF0b3JTdGFja1t0aGlzLnN0YXRlLmRlY29yYXRvclN0YWNrLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBlMi5sZW5ndGggJiYgKHQyLmRlY29yYXRvcnMgPSBlMiwgdGhpcy5yZXNldFN0YXJ0TG9jYXRpb25Gcm9tTm9kZSh0MiwgZTJbMF0pLCB0aGlzLnN0YXRlLmRlY29yYXRvclN0YWNrW3RoaXMuc3RhdGUuZGVjb3JhdG9yU3RhY2subGVuZ3RoIC0gMV0gPSBbXSk7CiAgICAgICAgICB9CiAgICAgICAgICBjYW5IYXZlTGVhZGluZ0RlY29yYXRvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goNzQpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VEZWNvcmF0b3JzKHQyKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGF0ZS5kZWNvcmF0b3JTdGFja1t0aGlzLnN0YXRlLmRlY29yYXRvclN0YWNrLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBmb3IgKDsgdGhpcy5tYXRjaCgyNCk7ICkgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5wYXJzZURlY29yYXRvcigpOwogICAgICAgICAgICAgIGUyLnB1c2godDMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDc2KSkKICAgICAgICAgICAgICB0MiB8fCB0aGlzLnVuZXhwZWN0ZWQoKSwgdGhpcy5oYXNQbHVnaW4oImRlY29yYXRvcnMiKSAmJiAhdGhpcy5nZXRQbHVnaW5PcHRpb24oImRlY29yYXRvcnMiLCAiZGVjb3JhdG9yc0JlZm9yZUV4cG9ydCIpICYmIHRoaXMucmFpc2UodGhpcy5zdGF0ZS5zdGFydCwgRGMuRGVjb3JhdG9yRXhwb3J0Q2xhc3MpOwogICAgICAgICAgICBlbHNlIGlmICghdGhpcy5jYW5IYXZlTGVhZGluZ0RlY29yYXRvcigpKQogICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UodGhpcy5zdGF0ZS5zdGFydCwgRGMuVW5leHBlY3RlZExlYWRpbmdEZWNvcmF0b3IpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VEZWNvcmF0b3IoKSB7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0T25lUGx1Z2luKFsiZGVjb3JhdG9ycy1sZWdhY3kiLCAiZGVjb3JhdG9ycyJdKTsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICBpZiAodGhpcy5uZXh0KCksIHRoaXMuaGFzUGx1Z2luKCJkZWNvcmF0b3JzIikpIHsKICAgICAgICAgICAgICB0aGlzLnN0YXRlLmRlY29yYXRvclN0YWNrLnB1c2goW10pOwogICAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGF0ZS5zdGFydCwgczIgPSB0aGlzLnN0YXRlLnN0YXJ0TG9jOwogICAgICAgICAgICAgIGxldCByMjsKICAgICAgICAgICAgICBpZiAodGhpcy5lYXQoMTApKQogICAgICAgICAgICAgICAgcjIgPSB0aGlzLnBhcnNlRXhwcmVzc2lvbigpLCB0aGlzLmV4cGVjdCgxMSk7CiAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZm9yIChyMiA9IHRoaXMucGFyc2VJZGVudGlmaWVyKGZhbHNlKTsgdGhpcy5lYXQoMTYpOyApIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZUF0KGUyLCBzMik7CiAgICAgICAgICAgICAgICAgIHQzLm9iamVjdCA9IHIyLCB0My5wcm9wZXJ0eSA9IHRoaXMucGFyc2VJZGVudGlmaWVyKHRydWUpLCB0My5jb21wdXRlZCA9IGZhbHNlLCByMiA9IHRoaXMuZmluaXNoTm9kZSh0MywgIk1lbWJlckV4cHJlc3Npb24iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0Mi5leHByZXNzaW9uID0gdGhpcy5wYXJzZU1heWJlRGVjb3JhdG9yQXJndW1lbnRzKHIyKSwgdGhpcy5zdGF0ZS5kZWNvcmF0b3JTdGFjay5wb3AoKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgdDIuZXhwcmVzc2lvbiA9IHRoaXMucGFyc2VFeHByU3Vic2NyaXB0cygpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5maW5pc2hOb2RlKHQyLCAiRGVjb3JhdG9yIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU1heWJlRGVjb3JhdG9yQXJndW1lbnRzKHQyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmVhdCgxMCkpIHsKICAgICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhcnROb2RlQXROb2RlKHQyKTsKICAgICAgICAgICAgICByZXR1cm4gZTIuY2FsbGVlID0gdDIsIGUyLmFyZ3VtZW50cyA9IHRoaXMucGFyc2VDYWxsRXhwcmVzc2lvbkFyZ3VtZW50cygxMSwgZmFsc2UpLCB0aGlzLnRvUmVmZXJlbmNlZExpc3QoZTIuYXJndW1lbnRzKSwgdGhpcy5maW5pc2hOb2RlKGUyLCAiQ2FsbEV4cHJlc3Npb24iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUJyZWFrQ29udGludWVTdGF0ZW1lbnQodDIsIGUyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5pc0xpbmVUZXJtaW5hdG9yKCkgPyB0Mi5sYWJlbCA9IG51bGwgOiAodDIubGFiZWwgPSB0aGlzLnBhcnNlSWRlbnRpZmllcigpLCB0aGlzLnNlbWljb2xvbigpKSwgdGhpcy52ZXJpZnlCcmVha0NvbnRpbnVlKHQyLCBlMiksIHRoaXMuZmluaXNoTm9kZSh0MiwgZTIgPyAiQnJlYWtTdGF0ZW1lbnQiIDogIkNvbnRpbnVlU3RhdGVtZW50Iik7CiAgICAgICAgICB9CiAgICAgICAgICB2ZXJpZnlCcmVha0NvbnRpbnVlKHQyLCBlMikgewogICAgICAgICAgICBsZXQgczI7CiAgICAgICAgICAgIGZvciAoczIgPSAwOyBzMiA8IHRoaXMuc3RhdGUubGFiZWxzLmxlbmd0aDsgKytzMikgewogICAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGF0ZS5sYWJlbHNbczJdOwogICAgICAgICAgICAgIGlmICh0Mi5sYWJlbCA9PSBudWxsIHx8IHIyLm5hbWUgPT09IHQyLmxhYmVsLm5hbWUpIHsKICAgICAgICAgICAgICAgIGlmIChyMi5raW5kICE9IG51bGwgJiYgKGUyIHx8IHIyLmtpbmQgPT09ICJsb29wIikpCiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgaWYgKHQyLmxhYmVsICYmIGUyKQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgczIgPT09IHRoaXMuc3RhdGUubGFiZWxzLmxlbmd0aCAmJiB0aGlzLnJhaXNlKHQyLnN0YXJ0LCBEYy5JbGxlZ2FsQnJlYWtDb250aW51ZSwgZTIgPyAiYnJlYWsiIDogImNvbnRpbnVlIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZURlYnVnZ2VyU3RhdGVtZW50KHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5zZW1pY29sb24oKSwgdGhpcy5maW5pc2hOb2RlKHQyLCAiRGVidWdnZXJTdGF0ZW1lbnQiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlSGVhZGVyRXhwcmVzc2lvbigpIHsKICAgICAgICAgICAgdGhpcy5leHBlY3QoMTApOwogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMucGFyc2VFeHByZXNzaW9uKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4cGVjdCgxMSksIHQyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VEb1N0YXRlbWVudCh0MikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMuc3RhdGUubGFiZWxzLnB1c2goZmQpLCB0Mi5ib2R5ID0gdGhpcy53aXRoU21hcnRNaXhUb3BpY0ZvcmJpZGRpbmdDb250ZXh0KCgpID0+IHRoaXMucGFyc2VTdGF0ZW1lbnQoImRvIikpLCB0aGlzLnN0YXRlLmxhYmVscy5wb3AoKSwgdGhpcy5leHBlY3QoODYpLCB0Mi50ZXN0ID0gdGhpcy5wYXJzZUhlYWRlckV4cHJlc3Npb24oKSwgdGhpcy5lYXQoMTMpLCB0aGlzLmZpbmlzaE5vZGUodDIsICJEb1doaWxlU3RhdGVtZW50Iik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUZvclN0YXRlbWVudCh0MikgewogICAgICAgICAgICB0aGlzLm5leHQoKSwgdGhpcy5zdGF0ZS5sYWJlbHMucHVzaChmZCk7CiAgICAgICAgICAgIGxldCBlMiA9IC0xOwogICAgICAgICAgICBpZiAodGhpcy5pc0F3YWl0QWxsb3dlZCgpICYmIHRoaXMuZWF0Q29udGV4dHVhbCg5MCkgJiYgKGUyID0gdGhpcy5zdGF0ZS5sYXN0VG9rU3RhcnQpLCB0aGlzLnNjb3BlLmVudGVyKDApLCB0aGlzLmV4cGVjdCgxMCksIHRoaXMubWF0Y2goMTMpKQogICAgICAgICAgICAgIHJldHVybiBlMiA+IC0xICYmIHRoaXMudW5leHBlY3RlZChlMiksIHRoaXMucGFyc2VGb3IodDIsIG51bGwpOwogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuaXNDb250ZXh0dWFsKDkzKSwgcjIgPSBzMiAmJiB0aGlzLmlzTGV0S2V5d29yZCgpOwogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCg2OCkgfHwgdGhpcy5tYXRjaCg2OSkgfHwgcjIpIHsKICAgICAgICAgICAgICBjb25zdCBzMyA9IHRoaXMuc3RhcnROb2RlKCksIGkzID0gcjIgPyAibGV0IiA6IHRoaXMuc3RhdGUudmFsdWU7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0aGlzLnBhcnNlVmFyKHMzLCB0cnVlLCBpMyksIHRoaXMuZmluaXNoTm9kZShzMywgIlZhcmlhYmxlRGVjbGFyYXRpb24iKSwgKHRoaXMubWF0Y2goNTIpIHx8IHRoaXMuaXNDb250ZXh0dWFsKDk1KSkgJiYgczMuZGVjbGFyYXRpb25zLmxlbmd0aCA9PT0gMSA/IHRoaXMucGFyc2VGb3JJbih0MiwgczMsIGUyKSA6IChlMiA+IC0xICYmIHRoaXMudW5leHBlY3RlZChlMiksIHRoaXMucGFyc2VGb3IodDIsIHMzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLmlzQ29udGV4dHVhbCg4OSksIG4yID0gbmV3IFJsKCksIGEyID0gdGhpcy5wYXJzZUV4cHJlc3Npb24odHJ1ZSwgbjIpLCBvMiA9IHRoaXMuaXNDb250ZXh0dWFsKDk1KTsKICAgICAgICAgICAgaWYgKG8yICYmIChzMiA/IHRoaXMucmFpc2UoYTIuc3RhcnQsIERjLkZvck9mTGV0KSA6IGUyID09PSAtMSAmJiBpMiAmJiBhMi50eXBlID09PSAiSWRlbnRpZmllciIgJiYgdGhpcy5yYWlzZShhMi5zdGFydCwgRGMuRm9yT2ZBc3luYykpLCBvMiB8fCB0aGlzLm1hdGNoKDUyKSkgewogICAgICAgICAgICAgIHRoaXMudG9Bc3NpZ25hYmxlKGEyLCB0cnVlKTsKICAgICAgICAgICAgICBjb25zdCBzMyA9IG8yID8gImZvci1vZiBzdGF0ZW1lbnQiIDogImZvci1pbiBzdGF0ZW1lbnQiOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoZWNrTFZhbChhMiwgczMpLCB0aGlzLnBhcnNlRm9ySW4odDIsIGEyLCBlMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tFeHByZXNzaW9uRXJyb3JzKG4yLCB0cnVlKSwgZTIgPiAtMSAmJiB0aGlzLnVuZXhwZWN0ZWQoZTIpLCB0aGlzLnBhcnNlRm9yKHQyLCBhMik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUZ1bmN0aW9uU3RhdGVtZW50KHQyLCBlMiwgczIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0aGlzLnBhcnNlRnVuY3Rpb24odDIsIDEgfCAoczIgPyAwIDogMiksIGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlSWZTdGF0ZW1lbnQodDIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0Mi50ZXN0ID0gdGhpcy5wYXJzZUhlYWRlckV4cHJlc3Npb24oKSwgdDIuY29uc2VxdWVudCA9IHRoaXMucGFyc2VTdGF0ZW1lbnQoImlmIiksIHQyLmFsdGVybmF0ZSA9IHRoaXMuZWF0KDYwKSA/IHRoaXMucGFyc2VTdGF0ZW1lbnQoImlmIikgOiBudWxsLCB0aGlzLmZpbmlzaE5vZGUodDIsICJJZlN0YXRlbWVudCIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VSZXR1cm5TdGF0ZW1lbnQodDIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvZFBhcmFtLmhhc1JldHVybiB8fCB0aGlzLm9wdGlvbnMuYWxsb3dSZXR1cm5PdXRzaWRlRnVuY3Rpb24gfHwgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0LCBEYy5JbGxlZ2FsUmV0dXJuKSwgdGhpcy5uZXh0KCksIHRoaXMuaXNMaW5lVGVybWluYXRvcigpID8gdDIuYXJndW1lbnQgPSBudWxsIDogKHQyLmFyZ3VtZW50ID0gdGhpcy5wYXJzZUV4cHJlc3Npb24oKSwgdGhpcy5zZW1pY29sb24oKSksIHRoaXMuZmluaXNoTm9kZSh0MiwgIlJldHVyblN0YXRlbWVudCIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VTd2l0Y2hTdGF0ZW1lbnQodDIpIHsKICAgICAgICAgICAgdGhpcy5uZXh0KCksIHQyLmRpc2NyaW1pbmFudCA9IHRoaXMucGFyc2VIZWFkZXJFeHByZXNzaW9uKCk7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdDIuY2FzZXMgPSBbXTsKICAgICAgICAgICAgbGV0IHMyLCByMjsKICAgICAgICAgICAgZm9yICh0aGlzLmV4cGVjdCg1KSwgdGhpcy5zdGF0ZS5sYWJlbHMucHVzaCh5ZCksIHRoaXMuc2NvcGUuZW50ZXIoMCk7ICF0aGlzLm1hdGNoKDgpOyApCiAgICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goNTUpIHx8IHRoaXMubWF0Y2goNTkpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMubWF0Y2goNTUpOwogICAgICAgICAgICAgICAgczIgJiYgdGhpcy5maW5pc2hOb2RlKHMyLCAiU3dpdGNoQ2FzZSIpLCBlMi5wdXNoKHMyID0gdGhpcy5zdGFydE5vZGUoKSksIHMyLmNvbnNlcXVlbnQgPSBbXSwgdGhpcy5uZXh0KCksIHQzID8gczIudGVzdCA9IHRoaXMucGFyc2VFeHByZXNzaW9uKCkgOiAocjIgJiYgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLmxhc3RUb2tTdGFydCwgRGMuTXVsdGlwbGVEZWZhdWx0c0luU3dpdGNoKSwgcjIgPSB0cnVlLCBzMi50ZXN0ID0gbnVsbCksIHRoaXMuZXhwZWN0KDE0KTsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIHMyID8gczIuY29uc2VxdWVudC5wdXNoKHRoaXMucGFyc2VTdGF0ZW1lbnQobnVsbCkpIDogdGhpcy51bmV4cGVjdGVkKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNjb3BlLmV4aXQoKSwgczIgJiYgdGhpcy5maW5pc2hOb2RlKHMyLCAiU3dpdGNoQ2FzZSIpLCB0aGlzLm5leHQoKSwgdGhpcy5zdGF0ZS5sYWJlbHMucG9wKCksIHRoaXMuZmluaXNoTm9kZSh0MiwgIlN3aXRjaFN0YXRlbWVudCIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VUaHJvd1N0YXRlbWVudCh0MikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMuaGFzUHJlY2VkaW5nTGluZUJyZWFrKCkgJiYgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLmxhc3RUb2tFbmQsIERjLk5ld2xpbmVBZnRlclRocm93KSwgdDIuYXJndW1lbnQgPSB0aGlzLnBhcnNlRXhwcmVzc2lvbigpLCB0aGlzLnNlbWljb2xvbigpLCB0aGlzLmZpbmlzaE5vZGUodDIsICJUaHJvd1N0YXRlbWVudCIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VDYXRjaENsYXVzZVBhcmFtKCkgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMucGFyc2VCaW5kaW5nQXRvbSgpLCBlMiA9IHQyLnR5cGUgPT09ICJJZGVudGlmaWVyIjsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NvcGUuZW50ZXIoZTIgPyA4IDogMCksIHRoaXMuY2hlY2tMVmFsKHQyLCAiY2F0Y2ggY2xhdXNlIiwgOSksIHQyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VUcnlTdGF0ZW1lbnQodDIpIHsKICAgICAgICAgICAgaWYgKHRoaXMubmV4dCgpLCB0Mi5ibG9jayA9IHRoaXMucGFyc2VCbG9jaygpLCB0Mi5oYW5kbGVyID0gbnVsbCwgdGhpcy5tYXRjaCg1NikpIHsKICAgICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgICAgdGhpcy5uZXh0KCksIHRoaXMubWF0Y2goMTApID8gKHRoaXMuZXhwZWN0KDEwKSwgZTIucGFyYW0gPSB0aGlzLnBhcnNlQ2F0Y2hDbGF1c2VQYXJhbSgpLCB0aGlzLmV4cGVjdCgxMSkpIDogKGUyLnBhcmFtID0gbnVsbCwgdGhpcy5zY29wZS5lbnRlcigwKSksIGUyLmJvZHkgPSB0aGlzLndpdGhTbWFydE1peFRvcGljRm9yYmlkZGluZ0NvbnRleHQoKCkgPT4gdGhpcy5wYXJzZUJsb2NrKGZhbHNlLCBmYWxzZSkpLCB0aGlzLnNjb3BlLmV4aXQoKSwgdDIuaGFuZGxlciA9IHRoaXMuZmluaXNoTm9kZShlMiwgIkNhdGNoQ2xhdXNlIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHQyLmZpbmFsaXplciA9IHRoaXMuZWF0KDYxKSA/IHRoaXMucGFyc2VCbG9jaygpIDogbnVsbCwgdDIuaGFuZGxlciB8fCB0Mi5maW5hbGl6ZXIgfHwgdGhpcy5yYWlzZSh0Mi5zdGFydCwgRGMuTm9DYXRjaE9yRmluYWxseSksIHRoaXMuZmluaXNoTm9kZSh0MiwgIlRyeVN0YXRlbWVudCIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VWYXJTdGF0ZW1lbnQodDIsIGUyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5leHQoKSwgdGhpcy5wYXJzZVZhcih0MiwgZmFsc2UsIGUyKSwgdGhpcy5zZW1pY29sb24oKSwgdGhpcy5maW5pc2hOb2RlKHQyLCAiVmFyaWFibGVEZWNsYXJhdGlvbiIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VXaGlsZVN0YXRlbWVudCh0MikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHQyLnRlc3QgPSB0aGlzLnBhcnNlSGVhZGVyRXhwcmVzc2lvbigpLCB0aGlzLnN0YXRlLmxhYmVscy5wdXNoKGZkKSwgdDIuYm9keSA9IHRoaXMud2l0aFNtYXJ0TWl4VG9waWNGb3JiaWRkaW5nQ29udGV4dCgoKSA9PiB0aGlzLnBhcnNlU3RhdGVtZW50KCJ3aGlsZSIpKSwgdGhpcy5zdGF0ZS5sYWJlbHMucG9wKCksIHRoaXMuZmluaXNoTm9kZSh0MiwgIldoaWxlU3RhdGVtZW50Iik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZVdpdGhTdGF0ZW1lbnQodDIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuc3RyaWN0ICYmIHRoaXMucmFpc2UodGhpcy5zdGF0ZS5zdGFydCwgRGMuU3RyaWN0V2l0aCksIHRoaXMubmV4dCgpLCB0Mi5vYmplY3QgPSB0aGlzLnBhcnNlSGVhZGVyRXhwcmVzc2lvbigpLCB0Mi5ib2R5ID0gdGhpcy53aXRoU21hcnRNaXhUb3BpY0ZvcmJpZGRpbmdDb250ZXh0KCgpID0+IHRoaXMucGFyc2VTdGF0ZW1lbnQoIndpdGgiKSksIHRoaXMuZmluaXNoTm9kZSh0MiwgIldpdGhTdGF0ZW1lbnQiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRW1wdHlTdGF0ZW1lbnQodDIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCB0aGlzLmZpbmlzaE5vZGUodDIsICJFbXB0eVN0YXRlbWVudCIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VMYWJlbGVkU3RhdGVtZW50KHQyLCBlMiwgczIsIHIyKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgdDMgb2YgdGhpcy5zdGF0ZS5sYWJlbHMpCiAgICAgICAgICAgICAgdDMubmFtZSA9PT0gZTIgJiYgdGhpcy5yYWlzZShzMi5zdGFydCwgRGMuTGFiZWxSZWRlY2xhcmF0aW9uLCBlMik7CiAgICAgICAgICAgIGNvbnN0IGkyID0gKG4yID0gdGhpcy5zdGF0ZS50eXBlKSA+PSA4NCAmJiBuMiA8PSA4NiA/ICJsb29wIiA6IHRoaXMubWF0Y2goNjUpID8gInN3aXRjaCIgOiBudWxsOwogICAgICAgICAgICB2YXIgbjI7CiAgICAgICAgICAgIGZvciAobGV0IGUzID0gdGhpcy5zdGF0ZS5sYWJlbHMubGVuZ3RoIC0gMTsgZTMgPj0gMDsgZTMtLSkgewogICAgICAgICAgICAgIGNvbnN0IHMzID0gdGhpcy5zdGF0ZS5sYWJlbHNbZTNdOwogICAgICAgICAgICAgIGlmIChzMy5zdGF0ZW1lbnRTdGFydCAhPT0gdDIuc3RhcnQpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBzMy5zdGF0ZW1lbnRTdGFydCA9IHRoaXMuc3RhdGUuc3RhcnQsIHMzLmtpbmQgPSBpMjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5sYWJlbHMucHVzaCh7IG5hbWU6IGUyLCBraW5kOiBpMiwgc3RhdGVtZW50U3RhcnQ6IHRoaXMuc3RhdGUuc3RhcnQgfSksIHQyLmJvZHkgPSB0aGlzLnBhcnNlU3RhdGVtZW50KHIyID8gcjIuaW5kZXhPZigibGFiZWwiKSA9PT0gLTEgPyByMiArICJsYWJlbCIgOiByMiA6ICJsYWJlbCIpLCB0aGlzLnN0YXRlLmxhYmVscy5wb3AoKSwgdDIubGFiZWwgPSBzMiwgdGhpcy5maW5pc2hOb2RlKHQyLCAiTGFiZWxlZFN0YXRlbWVudCIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHByZXNzaW9uU3RhdGVtZW50KHQyLCBlMikgewogICAgICAgICAgICByZXR1cm4gdDIuZXhwcmVzc2lvbiA9IGUyLCB0aGlzLnNlbWljb2xvbigpLCB0aGlzLmZpbmlzaE5vZGUodDIsICJFeHByZXNzaW9uU3RhdGVtZW50Iik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUJsb2NrKCkgewogICAgICAgICAgICBsZXQgdDIgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHZvaWQgMCAmJiBhcmd1bWVudHNbMF0sIGUyID0gIShhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCkgfHwgYXJndW1lbnRzWzFdLCBzMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdm9pZCAwOwogICAgICAgICAgICBjb25zdCByMiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIHJldHVybiB0MiAmJiB0aGlzLnN0YXRlLnN0cmljdEVycm9ycy5jbGVhcigpLCB0aGlzLmV4cGVjdCg1KSwgZTIgJiYgdGhpcy5zY29wZS5lbnRlcigwKSwgdGhpcy5wYXJzZUJsb2NrQm9keShyMiwgdDIsIGZhbHNlLCA4LCBzMiksIGUyICYmIHRoaXMuc2NvcGUuZXhpdCgpLCB0aGlzLmZpbmlzaE5vZGUocjIsICJCbG9ja1N0YXRlbWVudCIpOwogICAgICAgICAgfQogICAgICAgICAgaXNWYWxpZERpcmVjdGl2ZSh0MikgewogICAgICAgICAgICByZXR1cm4gdDIudHlwZSA9PT0gIkV4cHJlc3Npb25TdGF0ZW1lbnQiICYmIHQyLmV4cHJlc3Npb24udHlwZSA9PT0gIlN0cmluZ0xpdGVyYWwiICYmICF0Mi5leHByZXNzaW9uLmV4dHJhLnBhcmVudGhlc2l6ZWQ7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUJsb2NrQm9keSh0MiwgZTIsIHMyLCByMiwgaTIpIHsKICAgICAgICAgICAgY29uc3QgbjIgPSB0Mi5ib2R5ID0gW10sIGEyID0gdDIuZGlyZWN0aXZlcyA9IFtdOwogICAgICAgICAgICB0aGlzLnBhcnNlQmxvY2tPck1vZHVsZUJsb2NrQm9keShuMiwgZTIgPyBhMiA6IHZvaWQgMCwgczIsIHIyLCBpMik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUJsb2NrT3JNb2R1bGVCbG9ja0JvZHkodDIsIGUyLCBzMiwgcjIsIGkyKSB7CiAgICAgICAgICAgIGNvbnN0IG4yID0gdGhpcy5zdGF0ZS5zdHJpY3Q7CiAgICAgICAgICAgIGxldCBhMiA9IGZhbHNlLCBvMiA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKDsgIXRoaXMubWF0Y2gocjIpOyApIHsKICAgICAgICAgICAgICBjb25zdCByMyA9IHRoaXMucGFyc2VTdGF0ZW1lbnQobnVsbCwgczIpOwogICAgICAgICAgICAgIGlmIChlMiAmJiAhbzIpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzVmFsaWREaXJlY3RpdmUocjMpKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdG10VG9EaXJlY3RpdmUocjMpOwogICAgICAgICAgICAgICAgICBlMi5wdXNoKHQzKSwgYTIgfHwgdDMudmFsdWUudmFsdWUgIT09ICJ1c2Ugc3RyaWN0IiB8fCAoYTIgPSB0cnVlLCB0aGlzLnNldFN0cmljdCh0cnVlKSk7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbzIgPSB0cnVlLCB0aGlzLnN0YXRlLnN0cmljdEVycm9ycy5jbGVhcigpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0Mi5wdXNoKHIzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpMiAmJiBpMi5jYWxsKHRoaXMsIGEyKSwgbjIgfHwgdGhpcy5zZXRTdHJpY3QoZmFsc2UpLCB0aGlzLm5leHQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRm9yKHQyLCBlMikgewogICAgICAgICAgICByZXR1cm4gdDIuaW5pdCA9IGUyLCB0aGlzLnNlbWljb2xvbihmYWxzZSksIHQyLnRlc3QgPSB0aGlzLm1hdGNoKDEzKSA/IG51bGwgOiB0aGlzLnBhcnNlRXhwcmVzc2lvbigpLCB0aGlzLnNlbWljb2xvbihmYWxzZSksIHQyLnVwZGF0ZSA9IHRoaXMubWF0Y2goMTEpID8gbnVsbCA6IHRoaXMucGFyc2VFeHByZXNzaW9uKCksIHRoaXMuZXhwZWN0KDExKSwgdDIuYm9keSA9IHRoaXMud2l0aFNtYXJ0TWl4VG9waWNGb3JiaWRkaW5nQ29udGV4dCgoKSA9PiB0aGlzLnBhcnNlU3RhdGVtZW50KCJmb3IiKSksIHRoaXMuc2NvcGUuZXhpdCgpLCB0aGlzLnN0YXRlLmxhYmVscy5wb3AoKSwgdGhpcy5maW5pc2hOb2RlKHQyLCAiRm9yU3RhdGVtZW50Iik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUZvckluKHQyLCBlMiwgczIpIHsKICAgICAgICAgICAgY29uc3QgcjIgPSB0aGlzLm1hdGNoKDUyKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCByMiA/IHMyID4gLTEgJiYgdGhpcy51bmV4cGVjdGVkKHMyKSA6IHQyLmF3YWl0ID0gczIgPiAtMSwgZTIudHlwZSAhPT0gIlZhcmlhYmxlRGVjbGFyYXRpb24iIHx8IGUyLmRlY2xhcmF0aW9uc1swXS5pbml0ID09IG51bGwgfHwgcjIgJiYgIXRoaXMuc3RhdGUuc3RyaWN0ICYmIGUyLmtpbmQgPT09ICJ2YXIiICYmIGUyLmRlY2xhcmF0aW9uc1swXS5pZC50eXBlID09PSAiSWRlbnRpZmllciIgPyBlMi50eXBlID09PSAiQXNzaWdubWVudFBhdHRlcm4iICYmIHRoaXMucmFpc2UoZTIuc3RhcnQsIERjLkludmFsaWRMaHMsICJmb3ItbG9vcCIpIDogdGhpcy5yYWlzZShlMi5zdGFydCwgRGMuRm9ySW5PZkxvb3BJbml0aWFsaXplciwgcjIgPyAiZm9yLWluIiA6ICJmb3Itb2YiKSwgdDIubGVmdCA9IGUyLCB0Mi5yaWdodCA9IHIyID8gdGhpcy5wYXJzZUV4cHJlc3Npb24oKSA6IHRoaXMucGFyc2VNYXliZUFzc2lnbkFsbG93SW4oKSwgdGhpcy5leHBlY3QoMTEpLCB0Mi5ib2R5ID0gdGhpcy53aXRoU21hcnRNaXhUb3BpY0ZvcmJpZGRpbmdDb250ZXh0KCgpID0+IHRoaXMucGFyc2VTdGF0ZW1lbnQoImZvciIpKSwgdGhpcy5zY29wZS5leGl0KCksIHRoaXMuc3RhdGUubGFiZWxzLnBvcCgpLCB0aGlzLmZpbmlzaE5vZGUodDIsIHIyID8gIkZvckluU3RhdGVtZW50IiA6ICJGb3JPZlN0YXRlbWVudCIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VWYXIodDIsIGUyLCBzMikgewogICAgICAgICAgICBjb25zdCByMiA9IHQyLmRlY2xhcmF0aW9ucyA9IFtdLCBpMiA9IHRoaXMuaGFzUGx1Z2luKCJ0eXBlc2NyaXB0Iik7CiAgICAgICAgICAgIGZvciAodDIua2luZCA9IHMyOyA7ICkgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgICBpZiAodGhpcy5wYXJzZVZhcklkKHQzLCBzMiksIHRoaXMuZWF0KDI3KSA/IHQzLmluaXQgPSBlMiA/IHRoaXMucGFyc2VNYXliZUFzc2lnbkRpc2FsbG93SW4oKSA6IHRoaXMucGFyc2VNYXliZUFzc2lnbkFsbG93SW4oKSA6IChzMiAhPT0gImNvbnN0IiB8fCB0aGlzLm1hdGNoKDUyKSB8fCB0aGlzLmlzQ29udGV4dHVhbCg5NSkgPyB0My5pZC50eXBlID09PSAiSWRlbnRpZmllciIgfHwgZTIgJiYgKHRoaXMubWF0Y2goNTIpIHx8IHRoaXMuaXNDb250ZXh0dWFsKDk1KSkgfHwgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLmxhc3RUb2tFbmQsIERjLkRlY2xhcmF0aW9uTWlzc2luZ0luaXRpYWxpemVyLCAiQ29tcGxleCBiaW5kaW5nIHBhdHRlcm5zIikgOiBpMiB8fCB0aGlzLnJhaXNlKHRoaXMuc3RhdGUubGFzdFRva0VuZCwgRGMuRGVjbGFyYXRpb25NaXNzaW5nSW5pdGlhbGl6ZXIsICJDb25zdCBkZWNsYXJhdGlvbnMiKSwgdDMuaW5pdCA9IG51bGwpLCByMi5wdXNoKHRoaXMuZmluaXNoTm9kZSh0MywgIlZhcmlhYmxlRGVjbGFyYXRvciIpKSwgIXRoaXMuZWF0KDEyKSkKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlVmFySWQodDIsIGUyKSB7CiAgICAgICAgICAgIHQyLmlkID0gdGhpcy5wYXJzZUJpbmRpbmdBdG9tKCksIHRoaXMuY2hlY2tMVmFsKHQyLmlkLCAidmFyaWFibGUgZGVjbGFyYXRpb24iLCBlMiA9PT0gInZhciIgPyA1IDogOSwgdm9pZCAwLCBlMiAhPT0gInZhciIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VGdW5jdGlvbih0MikgewogICAgICAgICAgICBsZXQgZTIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IDAsIHMyID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgJiYgYXJndW1lbnRzWzJdOwogICAgICAgICAgICBjb25zdCByMiA9IDEgJiBlMiwgaTIgPSAyICYgZTIsIG4yID0gISghcjIgfHwgNCAmIGUyKTsKICAgICAgICAgICAgdGhpcy5pbml0RnVuY3Rpb24odDIsIHMyKSwgdGhpcy5tYXRjaCg0OSkgJiYgaTIgJiYgdGhpcy5yYWlzZSh0aGlzLnN0YXRlLnN0YXJ0LCBEYy5HZW5lcmF0b3JJblNpbmdsZVN0YXRlbWVudENvbnRleHQpLCB0Mi5nZW5lcmF0b3IgPSB0aGlzLmVhdCg0OSksIHIyICYmICh0Mi5pZCA9IHRoaXMucGFyc2VGdW5jdGlvbklkKG4yKSk7CiAgICAgICAgICAgIGNvbnN0IGEyID0gdGhpcy5zdGF0ZS5tYXliZUluQXJyb3dQYXJhbWV0ZXJzOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5tYXliZUluQXJyb3dQYXJhbWV0ZXJzID0gZmFsc2UsIHRoaXMuc2NvcGUuZW50ZXIoMiksIHRoaXMucHJvZFBhcmFtLmVudGVyKE1sKHMyLCB0Mi5nZW5lcmF0b3IpKSwgcjIgfHwgKHQyLmlkID0gdGhpcy5wYXJzZUZ1bmN0aW9uSWQoKSksIHRoaXMucGFyc2VGdW5jdGlvblBhcmFtcyh0MiwgZmFsc2UpLCB0aGlzLndpdGhTbWFydE1peFRvcGljRm9yYmlkZGluZ0NvbnRleHQoKCkgPT4gewogICAgICAgICAgICAgIHRoaXMucGFyc2VGdW5jdGlvbkJvZHlBbmRGaW5pc2godDIsIHIyID8gIkZ1bmN0aW9uRGVjbGFyYXRpb24iIDogIkZ1bmN0aW9uRXhwcmVzc2lvbiIpOwogICAgICAgICAgICB9KSwgdGhpcy5wcm9kUGFyYW0uZXhpdCgpLCB0aGlzLnNjb3BlLmV4aXQoKSwgcjIgJiYgIWkyICYmIHRoaXMucmVnaXN0ZXJGdW5jdGlvblN0YXRlbWVudElkKHQyKSwgdGhpcy5zdGF0ZS5tYXliZUluQXJyb3dQYXJhbWV0ZXJzID0gYTIsIHQyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VGdW5jdGlvbklkKHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0MiB8fCBVYyh0aGlzLnN0YXRlLnR5cGUpID8gdGhpcy5wYXJzZUlkZW50aWZpZXIoKSA6IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUZ1bmN0aW9uUGFyYW1zKHQyLCBlMikgewogICAgICAgICAgICB0aGlzLmV4cGVjdCgxMCksIHRoaXMuZXhwcmVzc2lvblNjb3BlLmVudGVyKG5ldyBJbCgzKSksIHQyLnBhcmFtcyA9IHRoaXMucGFyc2VCaW5kaW5nTGlzdCgxMSwgNDEsIGZhbHNlLCBlMiksIHRoaXMuZXhwcmVzc2lvblNjb3BlLmV4aXQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlZ2lzdGVyRnVuY3Rpb25TdGF0ZW1lbnRJZCh0MikgewogICAgICAgICAgICB0Mi5pZCAmJiB0aGlzLnNjb3BlLmRlY2xhcmVOYW1lKHQyLmlkLm5hbWUsIHRoaXMuc3RhdGUuc3RyaWN0IHx8IHQyLmdlbmVyYXRvciB8fCB0Mi5hc3luYyA/IHRoaXMuc2NvcGUudHJlYXRGdW5jdGlvbnNBc1ZhciA/IDUgOiA5IDogMTcsIHQyLmlkLnN0YXJ0KTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3ModDIsIGUyLCBzMikgewogICAgICAgICAgICB0aGlzLm5leHQoKSwgdGhpcy50YWtlRGVjb3JhdG9ycyh0Mik7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGF0ZS5zdHJpY3Q7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnN0cmljdCA9IHRydWUsIHRoaXMucGFyc2VDbGFzc0lkKHQyLCBlMiwgczIpLCB0aGlzLnBhcnNlQ2xhc3NTdXBlcih0MiksIHQyLmJvZHkgPSB0aGlzLnBhcnNlQ2xhc3NCb2R5KCEhdDIuc3VwZXJDbGFzcywgcjIpLCB0aGlzLmZpbmlzaE5vZGUodDIsIGUyID8gIkNsYXNzRGVjbGFyYXRpb24iIDogIkNsYXNzRXhwcmVzc2lvbiIpOwogICAgICAgICAgfQogICAgICAgICAgaXNDbGFzc1Byb3BlcnR5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaCgyNykgfHwgdGhpcy5tYXRjaCgxMykgfHwgdGhpcy5tYXRjaCg4KTsKICAgICAgICAgIH0KICAgICAgICAgIGlzQ2xhc3NNZXRob2QoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hdGNoKDEwKTsKICAgICAgICAgIH0KICAgICAgICAgIGlzTm9uc3RhdGljQ29uc3RydWN0b3IodDIpIHsKICAgICAgICAgICAgcmV0dXJuICEodDIuY29tcHV0ZWQgfHwgdDIuc3RhdGljIHx8IHQyLmtleS5uYW1lICE9PSAiY29uc3RydWN0b3IiICYmIHQyLmtleS52YWx1ZSAhPT0gImNvbnN0cnVjdG9yIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUNsYXNzQm9keSh0MiwgZTIpIHsKICAgICAgICAgICAgdGhpcy5jbGFzc1Njb3BlLmVudGVyKCk7CiAgICAgICAgICAgIGNvbnN0IHMyID0geyBoYWRDb25zdHJ1Y3RvcjogZmFsc2UsIGhhZFN1cGVyQ2xhc3M6IHQyIH07CiAgICAgICAgICAgIGxldCByMiA9IFtdOwogICAgICAgICAgICBjb25zdCBpMiA9IHRoaXMuc3RhcnROb2RlKCk7CiAgICAgICAgICAgIGlmIChpMi5ib2R5ID0gW10sIHRoaXMuZXhwZWN0KDUpLCB0aGlzLndpdGhTbWFydE1peFRvcGljRm9yYmlkZGluZ0NvbnRleHQoKCkgPT4gewogICAgICAgICAgICAgIGZvciAoOyAhdGhpcy5tYXRjaCg4KTsgKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5lYXQoMTMpKSB7CiAgICAgICAgICAgICAgICAgIGlmIChyMi5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UodGhpcy5zdGF0ZS5sYXN0VG9rRW5kLCBEYy5EZWNvcmF0b3JTZW1pY29sb24pOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDI0KSkgewogICAgICAgICAgICAgICAgICByMi5wdXNoKHRoaXMucGFyc2VEZWNvcmF0b3IoKSk7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgICAgcjIubGVuZ3RoICYmICh0My5kZWNvcmF0b3JzID0gcjIsIHRoaXMucmVzZXRTdGFydExvY2F0aW9uRnJvbU5vZGUodDMsIHIyWzBdKSwgcjIgPSBbXSksIHRoaXMucGFyc2VDbGFzc01lbWJlcihpMiwgdDMsIHMyKSwgdDMua2luZCA9PT0gImNvbnN0cnVjdG9yIiAmJiB0My5kZWNvcmF0b3JzICYmIHQzLmRlY29yYXRvcnMubGVuZ3RoID4gMCAmJiB0aGlzLnJhaXNlKHQzLnN0YXJ0LCBEYy5EZWNvcmF0b3JDb25zdHJ1Y3Rvcik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwgdGhpcy5zdGF0ZS5zdHJpY3QgPSBlMiwgdGhpcy5uZXh0KCksIHIyLmxlbmd0aCkKICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIERjLlRyYWlsaW5nRGVjb3JhdG9yKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xhc3NTY29wZS5leGl0KCksIHRoaXMuZmluaXNoTm9kZShpMiwgIkNsYXNzQm9keSIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VDbGFzc01lbWJlckZyb21Nb2RpZmllcih0MiwgZTIpIHsKICAgICAgICAgICAgY29uc3QgczIgPSB0aGlzLnBhcnNlSWRlbnRpZmllcih0cnVlKTsKICAgICAgICAgICAgaWYgKHRoaXMuaXNDbGFzc01ldGhvZCgpKSB7CiAgICAgICAgICAgICAgY29uc3QgcjIgPSBlMjsKICAgICAgICAgICAgICByZXR1cm4gcjIua2luZCA9ICJtZXRob2QiLCByMi5jb21wdXRlZCA9IGZhbHNlLCByMi5rZXkgPSBzMiwgcjIuc3RhdGljID0gZmFsc2UsIHRoaXMucHVzaENsYXNzTWV0aG9kKHQyLCByMiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpLCB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2xhc3NQcm9wZXJ0eSgpKSB7CiAgICAgICAgICAgICAgY29uc3QgcjIgPSBlMjsKICAgICAgICAgICAgICByZXR1cm4gcjIuY29tcHV0ZWQgPSBmYWxzZSwgcjIua2V5ID0gczIsIHIyLnN0YXRpYyA9IGZhbHNlLCB0Mi5ib2R5LnB1c2godGhpcy5wYXJzZUNsYXNzUHJvcGVydHkocjIpKSwgdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5yZXNldFByZXZpb3VzTm9kZVRyYWlsaW5nQ29tbWVudHMoczIpLCBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3NNZW1iZXIodDIsIGUyLCBzMikgewogICAgICAgICAgICBjb25zdCByMiA9IHRoaXMuaXNDb250ZXh0dWFsKDk4KTsKICAgICAgICAgICAgaWYgKHIyKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMucGFyc2VDbGFzc01lbWJlckZyb21Nb2RpZmllcih0MiwgZTIpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIGlmICh0aGlzLmVhdCg1KSkKICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMucGFyc2VDbGFzc1N0YXRpY0Jsb2NrKHQyLCBlMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5wYXJzZUNsYXNzTWVtYmVyV2l0aElzU3RhdGljKHQyLCBlMiwgczIsIHIyKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3NNZW1iZXJXaXRoSXNTdGF0aWModDIsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgY29uc3QgaTIgPSBlMiwgbjIgPSBlMiwgYTIgPSBlMiwgbzIgPSBlMiwgdTIgPSBpMiwgaDIgPSBpMjsKICAgICAgICAgICAgaWYgKGUyLnN0YXRpYyA9IHIyLCB0aGlzLnBhcnNlUHJvcGVydHlOYW1lUHJlZml4T3BlcmF0b3IoZTIpLCB0aGlzLmVhdCg0OSkpIHsKICAgICAgICAgICAgICB1Mi5raW5kID0gIm1ldGhvZCI7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLm1hdGNoKDEyOCk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VDbGFzc0VsZW1lbnROYW1lKHUyKSwgZTMgPyB2b2lkIHRoaXMucHVzaENsYXNzUHJpdmF0ZU1ldGhvZCh0MiwgbjIsIHRydWUsIGZhbHNlKSA6ICh0aGlzLmlzTm9uc3RhdGljQ29uc3RydWN0b3IoaTIpICYmIHRoaXMucmFpc2UoaTIua2V5LnN0YXJ0LCBEYy5Db25zdHJ1Y3RvcklzR2VuZXJhdG9yKSwgdm9pZCB0aGlzLnB1c2hDbGFzc01ldGhvZCh0MiwgaTIsIHRydWUsIGZhbHNlLCBmYWxzZSwgZmFsc2UpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBwMiA9IFVjKHRoaXMuc3RhdGUudHlwZSkgJiYgIXRoaXMuc3RhdGUuY29udGFpbnNFc2MsIGMyID0gdGhpcy5tYXRjaCgxMjgpLCBsMiA9IHRoaXMucGFyc2VDbGFzc0VsZW1lbnROYW1lKGUyKSwgZDIgPSB0aGlzLnN0YXRlLnN0YXJ0OwogICAgICAgICAgICBpZiAodGhpcy5wYXJzZVBvc3RNZW1iZXJOYW1lTW9kaWZpZXJzKGgyKSwgdGhpcy5pc0NsYXNzTWV0aG9kKCkpIHsKICAgICAgICAgICAgICBpZiAodTIua2luZCA9ICJtZXRob2QiLCBjMikKICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMucHVzaENsYXNzUHJpdmF0ZU1ldGhvZCh0MiwgbjIsIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICAgICAgY29uc3QgcjMgPSB0aGlzLmlzTm9uc3RhdGljQ29uc3RydWN0b3IoaTIpOwogICAgICAgICAgICAgIGxldCBhMyA9IGZhbHNlOwogICAgICAgICAgICAgIHIzICYmIChpMi5raW5kID0gImNvbnN0cnVjdG9yIiwgczIuaGFkQ29uc3RydWN0b3IgJiYgIXRoaXMuaGFzUGx1Z2luKCJ0eXBlc2NyaXB0IikgJiYgdGhpcy5yYWlzZShsMi5zdGFydCwgRGMuRHVwbGljYXRlQ29uc3RydWN0b3IpLCByMyAmJiB0aGlzLmhhc1BsdWdpbigidHlwZXNjcmlwdCIpICYmIGUyLm92ZXJyaWRlICYmIHRoaXMucmFpc2UobDIuc3RhcnQsIERjLk92ZXJyaWRlT25Db25zdHJ1Y3RvciksIHMyLmhhZENvbnN0cnVjdG9yID0gdHJ1ZSwgYTMgPSBzMi5oYWRTdXBlckNsYXNzKSwgdGhpcy5wdXNoQ2xhc3NNZXRob2QodDIsIGkyLCBmYWxzZSwgZmFsc2UsIHIzLCBhMyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0NsYXNzUHJvcGVydHkoKSkKICAgICAgICAgICAgICBjMiA/IHRoaXMucHVzaENsYXNzUHJpdmF0ZVByb3BlcnR5KHQyLCBvMikgOiB0aGlzLnB1c2hDbGFzc1Byb3BlcnR5KHQyLCBhMik7CiAgICAgICAgICAgIGVsc2UgaWYgKHAyICYmIGwyLm5hbWUgPT09ICJhc3luYyIgJiYgIXRoaXMuaXNMaW5lVGVybWluYXRvcigpKSB7CiAgICAgICAgICAgICAgdGhpcy5yZXNldFByZXZpb3VzTm9kZVRyYWlsaW5nQ29tbWVudHMobDIpOwogICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5lYXQoNDkpOwogICAgICAgICAgICAgIGgyLm9wdGlvbmFsICYmIHRoaXMudW5leHBlY3RlZChkMiksIHUyLmtpbmQgPSAibWV0aG9kIjsKICAgICAgICAgICAgICBjb25zdCBzMyA9IHRoaXMubWF0Y2goMTI4KTsKICAgICAgICAgICAgICB0aGlzLnBhcnNlQ2xhc3NFbGVtZW50TmFtZSh1MiksIHRoaXMucGFyc2VQb3N0TWVtYmVyTmFtZU1vZGlmaWVycyhoMiksIHMzID8gdGhpcy5wdXNoQ2xhc3NQcml2YXRlTWV0aG9kKHQyLCBuMiwgZTMsIHRydWUpIDogKHRoaXMuaXNOb25zdGF0aWNDb25zdHJ1Y3RvcihpMikgJiYgdGhpcy5yYWlzZShpMi5rZXkuc3RhcnQsIERjLkNvbnN0cnVjdG9ySXNBc3luYyksIHRoaXMucHVzaENsYXNzTWV0aG9kKHQyLCBpMiwgZTMsIHRydWUsIGZhbHNlLCBmYWxzZSkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKCFwMiB8fCBsMi5uYW1lICE9PSAiZ2V0IiAmJiBsMi5uYW1lICE9PSAic2V0IiB8fCB0aGlzLm1hdGNoKDQ5KSAmJiB0aGlzLmlzTGluZVRlcm1pbmF0b3IoKSkKICAgICAgICAgICAgICB0aGlzLmlzTGluZVRlcm1pbmF0b3IoKSA/IGMyID8gdGhpcy5wdXNoQ2xhc3NQcml2YXRlUHJvcGVydHkodDIsIG8yKSA6IHRoaXMucHVzaENsYXNzUHJvcGVydHkodDIsIGEyKSA6IHRoaXMudW5leHBlY3RlZCgpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLnJlc2V0UHJldmlvdXNOb2RlVHJhaWxpbmdDb21tZW50cyhsMiksIHUyLmtpbmQgPSBsMi5uYW1lOwogICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5tYXRjaCgxMjgpOwogICAgICAgICAgICAgIHRoaXMucGFyc2VDbGFzc0VsZW1lbnROYW1lKGkyKSwgZTMgPyB0aGlzLnB1c2hDbGFzc1ByaXZhdGVNZXRob2QodDIsIG4yLCBmYWxzZSwgZmFsc2UpIDogKHRoaXMuaXNOb25zdGF0aWNDb25zdHJ1Y3RvcihpMikgJiYgdGhpcy5yYWlzZShpMi5rZXkuc3RhcnQsIERjLkNvbnN0cnVjdG9ySXNBY2Nlc3NvciksIHRoaXMucHVzaENsYXNzTWV0aG9kKHQyLCBpMiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpKSwgdGhpcy5jaGVja0dldHRlclNldHRlclBhcmFtcyhpMik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3NFbGVtZW50TmFtZSh0MikgewogICAgICAgICAgICBjb25zdCB7IHR5cGU6IGUyLCB2YWx1ZTogczIsIHN0YXJ0OiByMiB9ID0gdGhpcy5zdGF0ZTsKICAgICAgICAgICAgaWYgKGUyICE9PSAxMjIgJiYgZTIgIT09IDEyMyB8fCAhdDIuc3RhdGljIHx8IHMyICE9PSAicHJvdG90eXBlIiB8fCB0aGlzLnJhaXNlKHIyLCBEYy5TdGF0aWNQcm90b3R5cGUpLCBlMiA9PT0gMTI4KSB7CiAgICAgICAgICAgICAgczIgPT09ICJjb25zdHJ1Y3RvciIgJiYgdGhpcy5yYWlzZShyMiwgRGMuQ29uc3RydWN0b3JDbGFzc1ByaXZhdGVGaWVsZCk7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLnBhcnNlUHJpdmF0ZU5hbWUoKTsKICAgICAgICAgICAgICByZXR1cm4gdDIua2V5ID0gZTMsIGUzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlUHJvcGVydHlOYW1lKHQyKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3NTdGF0aWNCbG9jayh0MiwgZTIpIHsKICAgICAgICAgICAgdmFyIHMyOwogICAgICAgICAgICB0aGlzLnNjb3BlLmVudGVyKDIwOCk7CiAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5zdGF0ZS5sYWJlbHM7CiAgICAgICAgICAgIHRoaXMuc3RhdGUubGFiZWxzID0gW10sIHRoaXMucHJvZFBhcmFtLmVudGVyKDApOwogICAgICAgICAgICBjb25zdCBpMiA9IGUyLmJvZHkgPSBbXTsKICAgICAgICAgICAgdGhpcy5wYXJzZUJsb2NrT3JNb2R1bGVCbG9ja0JvZHkoaTIsIHZvaWQgMCwgZmFsc2UsIDgpLCB0aGlzLnByb2RQYXJhbS5leGl0KCksIHRoaXMuc2NvcGUuZXhpdCgpLCB0aGlzLnN0YXRlLmxhYmVscyA9IHIyLCB0Mi5ib2R5LnB1c2godGhpcy5maW5pc2hOb2RlKGUyLCAiU3RhdGljQmxvY2siKSksIChzMiA9IGUyLmRlY29yYXRvcnMpICE9IG51bGwgJiYgczIubGVuZ3RoICYmIHRoaXMucmFpc2UoZTIuc3RhcnQsIERjLkRlY29yYXRvclN0YXRpY0Jsb2NrKTsKICAgICAgICAgIH0KICAgICAgICAgIHB1c2hDbGFzc1Byb3BlcnR5KHQyLCBlMikgewogICAgICAgICAgICBlMi5jb21wdXRlZCB8fCBlMi5rZXkubmFtZSAhPT0gImNvbnN0cnVjdG9yIiAmJiBlMi5rZXkudmFsdWUgIT09ICJjb25zdHJ1Y3RvciIgfHwgdGhpcy5yYWlzZShlMi5rZXkuc3RhcnQsIERjLkNvbnN0cnVjdG9yQ2xhc3NGaWVsZCksIHQyLmJvZHkucHVzaCh0aGlzLnBhcnNlQ2xhc3NQcm9wZXJ0eShlMikpOwogICAgICAgICAgfQogICAgICAgICAgcHVzaENsYXNzUHJpdmF0ZVByb3BlcnR5KHQyLCBlMikgewogICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMucGFyc2VDbGFzc1ByaXZhdGVQcm9wZXJ0eShlMik7CiAgICAgICAgICAgIHQyLmJvZHkucHVzaChzMiksIHRoaXMuY2xhc3NTY29wZS5kZWNsYXJlUHJpdmF0ZU5hbWUodGhpcy5nZXRQcml2YXRlTmFtZVNWKHMyLmtleSksIDAsIHMyLmtleS5zdGFydCk7CiAgICAgICAgICB9CiAgICAgICAgICBwdXNoQ2xhc3NNZXRob2QodDIsIGUyLCBzMiwgcjIsIGkyLCBuMikgewogICAgICAgICAgICB0Mi5ib2R5LnB1c2godGhpcy5wYXJzZU1ldGhvZChlMiwgczIsIHIyLCBpMiwgbjIsICJDbGFzc01ldGhvZCIsIHRydWUpKTsKICAgICAgICAgIH0KICAgICAgICAgIHB1c2hDbGFzc1ByaXZhdGVNZXRob2QodDIsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLnBhcnNlTWV0aG9kKGUyLCBzMiwgcjIsIGZhbHNlLCBmYWxzZSwgIkNsYXNzUHJpdmF0ZU1ldGhvZCIsIHRydWUpOwogICAgICAgICAgICB0Mi5ib2R5LnB1c2goaTIpOwogICAgICAgICAgICBjb25zdCBuMiA9IGkyLmtpbmQgPT09ICJnZXQiID8gaTIuc3RhdGljID8gNiA6IDIgOiBpMi5raW5kID09PSAic2V0IiA/IGkyLnN0YXRpYyA/IDUgOiAxIDogMDsKICAgICAgICAgICAgdGhpcy5kZWNsYXJlQ2xhc3NQcml2YXRlTWV0aG9kSW5TY29wZShpMiwgbjIpOwogICAgICAgICAgfQogICAgICAgICAgZGVjbGFyZUNsYXNzUHJpdmF0ZU1ldGhvZEluU2NvcGUodDIsIGUyKSB7CiAgICAgICAgICAgIHRoaXMuY2xhc3NTY29wZS5kZWNsYXJlUHJpdmF0ZU5hbWUodGhpcy5nZXRQcml2YXRlTmFtZVNWKHQyLmtleSksIGUyLCB0Mi5rZXkuc3RhcnQpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VQb3N0TWVtYmVyTmFtZU1vZGlmaWVycyh0MikgewogICAgICAgICAgfQogICAgICAgICAgcGFyc2VDbGFzc1ByaXZhdGVQcm9wZXJ0eSh0MikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUluaXRpYWxpemVyKHQyKSwgdGhpcy5zZW1pY29sb24oKSwgdGhpcy5maW5pc2hOb2RlKHQyLCAiQ2xhc3NQcml2YXRlUHJvcGVydHkiKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3NQcm9wZXJ0eSh0MikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUluaXRpYWxpemVyKHQyKSwgdGhpcy5zZW1pY29sb24oKSwgdGhpcy5maW5pc2hOb2RlKHQyLCAiQ2xhc3NQcm9wZXJ0eSIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VJbml0aWFsaXplcih0MikgewogICAgICAgICAgICB0aGlzLnNjb3BlLmVudGVyKDgwKSwgdGhpcy5leHByZXNzaW9uU2NvcGUuZW50ZXIoTGwoKSksIHRoaXMucHJvZFBhcmFtLmVudGVyKDApLCB0Mi52YWx1ZSA9IHRoaXMuZWF0KDI3KSA/IHRoaXMucGFyc2VNYXliZUFzc2lnbkFsbG93SW4oKSA6IG51bGwsIHRoaXMuZXhwcmVzc2lvblNjb3BlLmV4aXQoKSwgdGhpcy5wcm9kUGFyYW0uZXhpdCgpLCB0aGlzLnNjb3BlLmV4aXQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3NJZCh0MiwgZTIsIHMyKSB7CiAgICAgICAgICAgIGxldCByMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzNdIDogMTM5OwogICAgICAgICAgICBVYyh0aGlzLnN0YXRlLnR5cGUpID8gKHQyLmlkID0gdGhpcy5wYXJzZUlkZW50aWZpZXIoKSwgZTIgJiYgdGhpcy5jaGVja0xWYWwodDIuaWQsICJjbGFzcyBuYW1lIiwgcjIpKSA6IHMyIHx8ICFlMiA/IHQyLmlkID0gbnVsbCA6IHRoaXMudW5leHBlY3RlZChudWxsLCBEYy5NaXNzaW5nQ2xhc3NOYW1lKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQ2xhc3NTdXBlcih0MikgewogICAgICAgICAgICB0Mi5zdXBlckNsYXNzID0gdGhpcy5lYXQoNzUpID8gdGhpcy5wYXJzZUV4cHJTdWJzY3JpcHRzKCkgOiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHBvcnQodDIpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLm1heWJlUGFyc2VFeHBvcnREZWZhdWx0U3BlY2lmaWVyKHQyKSwgczIgPSAhZTIgfHwgdGhpcy5lYXQoMTIpLCByMiA9IHMyICYmIHRoaXMuZWF0RXhwb3J0U3Rhcih0MiksIGkyID0gcjIgJiYgdGhpcy5tYXliZVBhcnNlRXhwb3J0TmFtZXNwYWNlU3BlY2lmaWVyKHQyKSwgbjIgPSBzMiAmJiAoIWkyIHx8IHRoaXMuZWF0KDEyKSksIGEyID0gZTIgfHwgcjI7CiAgICAgICAgICAgIGlmIChyMiAmJiAhaTIpCiAgICAgICAgICAgICAgcmV0dXJuIGUyICYmIHRoaXMudW5leHBlY3RlZCgpLCB0aGlzLnBhcnNlRXhwb3J0RnJvbSh0MiwgdHJ1ZSksIHRoaXMuZmluaXNoTm9kZSh0MiwgIkV4cG9ydEFsbERlY2xhcmF0aW9uIik7CiAgICAgICAgICAgIGNvbnN0IG8yID0gdGhpcy5tYXliZVBhcnNlRXhwb3J0TmFtZWRTcGVjaWZpZXJzKHQyKTsKICAgICAgICAgICAgaWYgKGUyICYmIHMyICYmICFyMiAmJiAhbzIgfHwgaTIgJiYgbjIgJiYgIW8yKQogICAgICAgICAgICAgIHRocm93IHRoaXMudW5leHBlY3RlZChudWxsLCA1KTsKICAgICAgICAgICAgbGV0IHUyOwogICAgICAgICAgICBpZiAoYTIgfHwgbzIgPyAodTIgPSBmYWxzZSwgdGhpcy5wYXJzZUV4cG9ydEZyb20odDIsIGEyKSkgOiB1MiA9IHRoaXMubWF5YmVQYXJzZUV4cG9ydERlY2xhcmF0aW9uKHQyKSwgYTIgfHwgbzIgfHwgdTIpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tFeHBvcnQodDIsIHRydWUsIGZhbHNlLCAhIXQyLnNvdXJjZSksIHRoaXMuZmluaXNoTm9kZSh0MiwgIkV4cG9ydE5hbWVkRGVjbGFyYXRpb24iKTsKICAgICAgICAgICAgaWYgKHRoaXMuZWF0KDU5KSkKICAgICAgICAgICAgICByZXR1cm4gdDIuZGVjbGFyYXRpb24gPSB0aGlzLnBhcnNlRXhwb3J0RGVmYXVsdEV4cHJlc3Npb24oKSwgdGhpcy5jaGVja0V4cG9ydCh0MiwgdHJ1ZSwgdHJ1ZSksIHRoaXMuZmluaXNoTm9kZSh0MiwgIkV4cG9ydERlZmF1bHREZWNsYXJhdGlvbiIpOwogICAgICAgICAgICB0aHJvdyB0aGlzLnVuZXhwZWN0ZWQobnVsbCwgNSk7CiAgICAgICAgICB9CiAgICAgICAgICBlYXRFeHBvcnRTdGFyKHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhdCg0OSk7CiAgICAgICAgICB9CiAgICAgICAgICBtYXliZVBhcnNlRXhwb3J0RGVmYXVsdFNwZWNpZmllcih0MikgewogICAgICAgICAgICBpZiAodGhpcy5pc0V4cG9ydERlZmF1bHRTcGVjaWZpZXIoKSkgewogICAgICAgICAgICAgIHRoaXMuZXhwZWN0UGx1Z2luKCJleHBvcnREZWZhdWx0RnJvbSIpOwogICAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgICByZXR1cm4gZTIuZXhwb3J0ZWQgPSB0aGlzLnBhcnNlSWRlbnRpZmllcih0cnVlKSwgdDIuc3BlY2lmaWVycyA9IFt0aGlzLmZpbmlzaE5vZGUoZTIsICJFeHBvcnREZWZhdWx0U3BlY2lmaWVyIildLCB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIG1heWJlUGFyc2VFeHBvcnROYW1lc3BhY2VTcGVjaWZpZXIodDIpIHsKICAgICAgICAgICAgaWYgKHRoaXMuaXNDb250ZXh0dWFsKDg3KSkgewogICAgICAgICAgICAgIHQyLnNwZWNpZmllcnMgfHwgKHQyLnNwZWNpZmllcnMgPSBbXSk7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLnN0YXJ0Tm9kZUF0KHRoaXMuc3RhdGUubGFzdFRva1N0YXJ0LCB0aGlzLnN0YXRlLmxhc3RUb2tTdGFydExvYyk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dCgpLCBlMi5leHBvcnRlZCA9IHRoaXMucGFyc2VNb2R1bGVFeHBvcnROYW1lKCksIHQyLnNwZWNpZmllcnMucHVzaCh0aGlzLmZpbmlzaE5vZGUoZTIsICJFeHBvcnROYW1lc3BhY2VTcGVjaWZpZXIiKSksIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgbWF5YmVQYXJzZUV4cG9ydE5hbWVkU3BlY2lmaWVycyh0MikgewogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCg1KSkgewogICAgICAgICAgICAgIHQyLnNwZWNpZmllcnMgfHwgKHQyLnNwZWNpZmllcnMgPSBbXSk7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSB0Mi5leHBvcnRLaW5kID09PSAidHlwZSI7CiAgICAgICAgICAgICAgcmV0dXJuIHQyLnNwZWNpZmllcnMucHVzaCguLi50aGlzLnBhcnNlRXhwb3J0U3BlY2lmaWVycyhlMikpLCB0Mi5zb3VyY2UgPSBudWxsLCB0Mi5kZWNsYXJhdGlvbiA9IG51bGwsIHRoaXMuaGFzUGx1Z2luKCJpbXBvcnRBc3NlcnRpb25zIikgJiYgKHQyLmFzc2VydGlvbnMgPSBbXSksIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgbWF5YmVQYXJzZUV4cG9ydERlY2xhcmF0aW9uKHQyKSB7CiAgICAgICAgICAgIHJldHVybiAhIXRoaXMuc2hvdWxkUGFyc2VFeHBvcnREZWNsYXJhdGlvbigpICYmICh0Mi5zcGVjaWZpZXJzID0gW10sIHQyLnNvdXJjZSA9IG51bGwsIHRoaXMuaGFzUGx1Z2luKCJpbXBvcnRBc3NlcnRpb25zIikgJiYgKHQyLmFzc2VydGlvbnMgPSBbXSksIHQyLmRlY2xhcmF0aW9uID0gdGhpcy5wYXJzZUV4cG9ydERlY2xhcmF0aW9uKHQyKSwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpc0FzeW5jRnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5pc0NvbnRleHR1YWwoODkpKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLm5leHRUb2tlblN0YXJ0KCk7CiAgICAgICAgICAgIHJldHVybiAhc2MudGVzdCh0aGlzLmlucHV0LnNsaWNlKHRoaXMuc3RhdGUucG9zLCB0MikpICYmIHRoaXMuaXNVbnBhcnNlZENvbnRleHR1YWwodDIsICJmdW5jdGlvbiIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHBvcnREZWZhdWx0RXhwcmVzc2lvbigpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLnN0YXJ0Tm9kZSgpLCBlMiA9IHRoaXMuaXNBc3luY0Z1bmN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDYyKSB8fCBlMikKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIGUyICYmIHRoaXMubmV4dCgpLCB0aGlzLnBhcnNlRnVuY3Rpb24odDIsIDUsIGUyKTsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goNzQpKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlQ2xhc3ModDIsIHRydWUsIHRydWUpOwogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCgyNCkpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFzUGx1Z2luKCJkZWNvcmF0b3JzIikgJiYgdGhpcy5nZXRQbHVnaW5PcHRpb24oImRlY29yYXRvcnMiLCAiZGVjb3JhdG9yc0JlZm9yZUV4cG9ydCIpICYmIHRoaXMucmFpc2UodGhpcy5zdGF0ZS5zdGFydCwgRGMuRGVjb3JhdG9yQmVmb3JlRXhwb3J0KSwgdGhpcy5wYXJzZURlY29yYXRvcnMoZmFsc2UpLCB0aGlzLnBhcnNlQ2xhc3ModDIsIHRydWUsIHRydWUpOwogICAgICAgICAgICBpZiAodGhpcy5tYXRjaCg2OSkgfHwgdGhpcy5tYXRjaCg2OCkgfHwgdGhpcy5pc0xldCgpKQogICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UodGhpcy5zdGF0ZS5zdGFydCwgRGMuVW5zdXBwb3J0ZWREZWZhdWx0RXhwb3J0KTsKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5wYXJzZU1heWJlQXNzaWduQWxsb3dJbigpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbWljb2xvbigpLCB0MzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHBvcnREZWNsYXJhdGlvbih0MikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZVN0YXRlbWVudChudWxsKTsKICAgICAgICAgIH0KICAgICAgICAgIGlzRXhwb3J0RGVmYXVsdFNwZWNpZmllcigpIHsKICAgICAgICAgICAgY29uc3QgeyB0eXBlOiB0MiB9ID0gdGhpcy5zdGF0ZTsKICAgICAgICAgICAgaWYgKFVjKHQyKSkgewogICAgICAgICAgICAgIGlmICh0MiA9PT0gODkgJiYgIXRoaXMuc3RhdGUuY29udGFpbnNFc2MgfHwgdDIgPT09IDkzKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIGlmICgodDIgPT09IDEyMCB8fCB0MiA9PT0gMTE5KSAmJiAhdGhpcy5zdGF0ZS5jb250YWluc0VzYykgewogICAgICAgICAgICAgICAgY29uc3QgeyB0eXBlOiB0MyB9ID0gdGhpcy5sb29rYWhlYWQoKTsKICAgICAgICAgICAgICAgIGlmIChVYyh0MykgJiYgdDMgIT09IDkxIHx8IHQzID09PSA1KQogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5leHBlY3RPbmVQbHVnaW4oWyJmbG93IiwgInR5cGVzY3JpcHQiXSksIGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5tYXRjaCg1OSkpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMubmV4dFRva2VuU3RhcnQoKSwgczIgPSB0aGlzLmlzVW5wYXJzZWRDb250ZXh0dWFsKGUyLCAiZnJvbSIpOwogICAgICAgICAgICBpZiAodGhpcy5pbnB1dC5jaGFyQ29kZUF0KGUyKSA9PT0gNDQgfHwgVWModGhpcy5zdGF0ZS50eXBlKSAmJiBzMikKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goNTkpICYmIHMyKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5uZXh0VG9rZW5TdGFydFNpbmNlKGUyICsgNCkpOwogICAgICAgICAgICAgIHJldHVybiB0MyA9PT0gMzQgfHwgdDMgPT09IDM5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlRXhwb3J0RnJvbSh0MiwgZTIpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZWF0Q29udGV4dHVhbCg5MSkpIHsKICAgICAgICAgICAgICB0Mi5zb3VyY2UgPSB0aGlzLnBhcnNlSW1wb3J0U291cmNlKCksIHRoaXMuY2hlY2tFeHBvcnQodDIpOwogICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5tYXliZVBhcnNlSW1wb3J0QXNzZXJ0aW9ucygpOwogICAgICAgICAgICAgIGUzICYmICh0Mi5hc3NlcnRpb25zID0gZTMpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBlMiAmJiB0aGlzLnVuZXhwZWN0ZWQoKTsKICAgICAgICAgICAgdGhpcy5zZW1pY29sb24oKTsKICAgICAgICAgIH0KICAgICAgICAgIHNob3VsZFBhcnNlRXhwb3J0RGVjbGFyYXRpb24oKSB7CiAgICAgICAgICAgIGNvbnN0IHsgdHlwZTogdDIgfSA9IHRoaXMuc3RhdGU7CiAgICAgICAgICAgIGlmICh0MiA9PT0gMjQgJiYgKHRoaXMuZXhwZWN0T25lUGx1Z2luKFsiZGVjb3JhdG9ycyIsICJkZWNvcmF0b3JzLWxlZ2FjeSJdKSwgdGhpcy5oYXNQbHVnaW4oImRlY29yYXRvcnMiKSkpIHsKICAgICAgICAgICAgICBpZiAoIXRoaXMuZ2V0UGx1Z2luT3B0aW9uKCJkZWNvcmF0b3JzIiwgImRlY29yYXRvcnNCZWZvcmVFeHBvcnQiKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIHRoaXMudW5leHBlY3RlZCh0aGlzLnN0YXRlLnN0YXJ0LCBEYy5EZWNvcmF0b3JCZWZvcmVFeHBvcnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0MiA9PT0gNjggfHwgdDIgPT09IDY5IHx8IHQyID09PSA2MiB8fCB0MiA9PT0gNzQgfHwgdGhpcy5pc0xldCgpIHx8IHRoaXMuaXNBc3luY0Z1bmN0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0V4cG9ydCh0MiwgZTIsIHMyLCByMikgewogICAgICAgICAgICBpZiAoZTIpIHsKICAgICAgICAgICAgICBpZiAoczIpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrRHVwbGljYXRlRXhwb3J0cyh0MiwgImRlZmF1bHQiKSwgdGhpcy5oYXNQbHVnaW4oImV4cG9ydERlZmF1bHRGcm9tIikpIHsKICAgICAgICAgICAgICAgICAgdmFyIGkyOwogICAgICAgICAgICAgICAgICBjb25zdCBlMyA9IHQyLmRlY2xhcmF0aW9uOwogICAgICAgICAgICAgICAgICBlMy50eXBlICE9PSAiSWRlbnRpZmllciIgfHwgZTMubmFtZSAhPT0gImZyb20iIHx8IGUzLmVuZCAtIGUzLnN0YXJ0ICE9IDQgfHwgKGkyID0gZTMuZXh0cmEpICE9IG51bGwgJiYgaTIucGFyZW50aGVzaXplZCB8fCB0aGlzLnJhaXNlKGUzLnN0YXJ0LCBEYy5FeHBvcnREZWZhdWx0RnJvbUFzSWRlbnRpZmllcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0Mi5zcGVjaWZpZXJzICYmIHQyLnNwZWNpZmllcnMubGVuZ3RoKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBlMyBvZiB0Mi5zcGVjaWZpZXJzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHsgZXhwb3J0ZWQ6IHQzIH0gPSBlMywgczMgPSB0My50eXBlID09PSAiSWRlbnRpZmllciIgPyB0My5uYW1lIDogdDMudmFsdWU7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrRHVwbGljYXRlRXhwb3J0cyhlMywgczMpLCAhcjIgJiYgZTMubG9jYWwpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGxvY2FsOiB0NCB9ID0gZTM7CiAgICAgICAgICAgICAgICAgICAgdDQudHlwZSAhPT0gIklkZW50aWZpZXIiID8gdGhpcy5yYWlzZShlMy5zdGFydCwgRGMuRXhwb3J0QmluZGluZ0lzU3RyaW5nLCB0NC52YWx1ZSwgczMpIDogKHRoaXMuY2hlY2tSZXNlcnZlZFdvcmQodDQubmFtZSwgdDQuc3RhcnQsIHRydWUsIGZhbHNlKSwgdGhpcy5zY29wZS5jaGVja0xvY2FsRXhwb3J0KHQ0KSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIGlmICh0Mi5kZWNsYXJhdGlvbikgewogICAgICAgICAgICAgICAgaWYgKHQyLmRlY2xhcmF0aW9uLnR5cGUgPT09ICJGdW5jdGlvbkRlY2xhcmF0aW9uIiB8fCB0Mi5kZWNsYXJhdGlvbi50eXBlID09PSAiQ2xhc3NEZWNsYXJhdGlvbiIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgZTMgPSB0Mi5kZWNsYXJhdGlvbi5pZDsKICAgICAgICAgICAgICAgICAgaWYgKCFlMykKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFzc2VydGlvbiBmYWlsdXJlIik7CiAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tEdXBsaWNhdGVFeHBvcnRzKHQyLCBlMy5uYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodDIuZGVjbGFyYXRpb24udHlwZSA9PT0gIlZhcmlhYmxlRGVjbGFyYXRpb24iKQogICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUzIG9mIHQyLmRlY2xhcmF0aW9uLmRlY2xhcmF0aW9ucykKICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrRGVjbGFyYXRpb24oZTMuaWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5kZWNvcmF0b3JTdGFja1t0aGlzLnN0YXRlLmRlY29yYXRvclN0YWNrLmxlbmd0aCAtIDFdLmxlbmd0aCkKICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHQyLnN0YXJ0LCBEYy5VbnN1cHBvcnRlZERlY29yYXRvckV4cG9ydCk7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0RlY2xhcmF0aW9uKHQyKSB7CiAgICAgICAgICAgIGlmICh0Mi50eXBlID09PSAiSWRlbnRpZmllciIpCiAgICAgICAgICAgICAgdGhpcy5jaGVja0R1cGxpY2F0ZUV4cG9ydHModDIsIHQyLm5hbWUpOwogICAgICAgICAgICBlbHNlIGlmICh0Mi50eXBlID09PSAiT2JqZWN0UGF0dGVybiIpCiAgICAgICAgICAgICAgZm9yIChjb25zdCBlMiBvZiB0Mi5wcm9wZXJ0aWVzKQogICAgICAgICAgICAgICAgdGhpcy5jaGVja0RlY2xhcmF0aW9uKGUyKTsKICAgICAgICAgICAgZWxzZSBpZiAodDIudHlwZSA9PT0gIkFycmF5UGF0dGVybiIpCiAgICAgICAgICAgICAgZm9yIChjb25zdCBlMiBvZiB0Mi5lbGVtZW50cykKICAgICAgICAgICAgICAgIGUyICYmIHRoaXMuY2hlY2tEZWNsYXJhdGlvbihlMik7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICB0Mi50eXBlID09PSAiT2JqZWN0UHJvcGVydHkiID8gdGhpcy5jaGVja0RlY2xhcmF0aW9uKHQyLnZhbHVlKSA6IHQyLnR5cGUgPT09ICJSZXN0RWxlbWVudCIgPyB0aGlzLmNoZWNrRGVjbGFyYXRpb24odDIuYXJndW1lbnQpIDogdDIudHlwZSA9PT0gIkFzc2lnbm1lbnRQYXR0ZXJuIiAmJiB0aGlzLmNoZWNrRGVjbGFyYXRpb24odDIubGVmdCk7CiAgICAgICAgICB9CiAgICAgICAgICBjaGVja0R1cGxpY2F0ZUV4cG9ydHModDIsIGUyKSB7CiAgICAgICAgICAgIHRoaXMuZXhwb3J0ZWRJZGVudGlmaWVycy5oYXMoZTIpICYmIHRoaXMucmFpc2UodDIuc3RhcnQsIGUyID09PSAiZGVmYXVsdCIgPyBEYy5EdXBsaWNhdGVEZWZhdWx0RXhwb3J0IDogRGMuRHVwbGljYXRlRXhwb3J0LCBlMiksIHRoaXMuZXhwb3J0ZWRJZGVudGlmaWVycy5hZGQoZTIpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHBvcnRTcGVjaWZpZXJzKHQyKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gW107CiAgICAgICAgICAgIGxldCBzMiA9IHRydWU7CiAgICAgICAgICAgIGZvciAodGhpcy5leHBlY3QoNSk7ICF0aGlzLmVhdCg4KTsgKSB7CiAgICAgICAgICAgICAgaWYgKHMyKQogICAgICAgICAgICAgICAgczIgPSBmYWxzZTsKICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLmV4cGVjdCgxMiksIHRoaXMuZWF0KDgpKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY29uc3QgcjIgPSB0aGlzLmlzQ29udGV4dHVhbCgxMjApLCBpMiA9IHRoaXMubWF0Y2goMTIzKSwgbjIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgIG4yLmxvY2FsID0gdGhpcy5wYXJzZU1vZHVsZUV4cG9ydE5hbWUoKSwgZTIucHVzaCh0aGlzLnBhcnNlRXhwb3J0U3BlY2lmaWVyKG4yLCBpMiwgdDIsIHIyKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VFeHBvcnRTcGVjaWZpZXIodDIsIGUyLCBzMiwgcjIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWF0Q29udGV4dHVhbCg4NykgPyB0Mi5leHBvcnRlZCA9IHRoaXMucGFyc2VNb2R1bGVFeHBvcnROYW1lKCkgOiBlMiA/IHQyLmV4cG9ydGVkID0gemwodDIubG9jYWwpIDogdDIuZXhwb3J0ZWQgfHwgKHQyLmV4cG9ydGVkID0gX2wodDIubG9jYWwpKSwgdGhpcy5maW5pc2hOb2RlKHQyLCAiRXhwb3J0U3BlY2lmaWVyIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU1vZHVsZUV4cG9ydE5hbWUoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDEyMykpIHsKICAgICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMucGFyc2VTdHJpbmdMaXRlcmFsKHRoaXMuc3RhdGUudmFsdWUpLCBlMiA9IHQyLnZhbHVlLm1hdGNoKEVkKTsKICAgICAgICAgICAgICByZXR1cm4gZTIgJiYgdGhpcy5yYWlzZSh0Mi5zdGFydCwgRGMuTW9kdWxlRXhwb3J0TmFtZUhhc0xvbmVTdXJyb2dhdGUsIGUyWzBdLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKSwgdDI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VJZGVudGlmaWVyKHRydWUpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VJbXBvcnQodDIpIHsKICAgICAgICAgICAgaWYgKHQyLnNwZWNpZmllcnMgPSBbXSwgIXRoaXMubWF0Y2goMTIzKSkgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gIXRoaXMubWF5YmVQYXJzZURlZmF1bHRJbXBvcnRTcGVjaWZpZXIodDIpIHx8IHRoaXMuZWF0KDEyKSwgczIgPSBlMyAmJiB0aGlzLm1heWJlUGFyc2VTdGFySW1wb3J0U3BlY2lmaWVyKHQyKTsKICAgICAgICAgICAgICBlMyAmJiAhczIgJiYgdGhpcy5wYXJzZU5hbWVkSW1wb3J0U3BlY2lmaWVycyh0MiksIHRoaXMuZXhwZWN0Q29udGV4dHVhbCg5MSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdDIuc291cmNlID0gdGhpcy5wYXJzZUltcG9ydFNvdXJjZSgpOwogICAgICAgICAgICBjb25zdCBlMiA9IHRoaXMubWF5YmVQYXJzZUltcG9ydEFzc2VydGlvbnMoKTsKICAgICAgICAgICAgaWYgKGUyKQogICAgICAgICAgICAgIHQyLmFzc2VydGlvbnMgPSBlMjsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLm1heWJlUGFyc2VNb2R1bGVBdHRyaWJ1dGVzKCk7CiAgICAgICAgICAgICAgZTMgJiYgKHQyLmF0dHJpYnV0ZXMgPSBlMyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VtaWNvbG9uKCksIHRoaXMuZmluaXNoTm9kZSh0MiwgIkltcG9ydERlY2xhcmF0aW9uIik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUltcG9ydFNvdXJjZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2goMTIzKSB8fCB0aGlzLnVuZXhwZWN0ZWQoKSwgdGhpcy5wYXJzZUV4cHJBdG9tKCk7CiAgICAgICAgICB9CiAgICAgICAgICBzaG91bGRQYXJzZURlZmF1bHRJbXBvcnQodDIpIHsKICAgICAgICAgICAgcmV0dXJuIFVjKHRoaXMuc3RhdGUudHlwZSk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZUltcG9ydFNwZWNpZmllckxvY2FsKHQyLCBlMiwgczIsIHIyKSB7CiAgICAgICAgICAgIGUyLmxvY2FsID0gdGhpcy5wYXJzZUlkZW50aWZpZXIoKSwgdGhpcy5jaGVja0xWYWwoZTIubG9jYWwsIHIyLCA5KSwgdDIuc3BlY2lmaWVycy5wdXNoKHRoaXMuZmluaXNoTm9kZShlMiwgczIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlQXNzZXJ0RW50cmllcygpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSBbXSwgZTIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2goOCkpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhcnROb2RlKCksIHIyID0gdGhpcy5zdGF0ZS52YWx1ZTsKICAgICAgICAgICAgICBpZiAoZTIuaGFzKHIyKSAmJiB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIERjLk1vZHVsZUF0dHJpYnV0ZXNXaXRoRHVwbGljYXRlS2V5cywgcjIpLCBlMi5hZGQocjIpLCB0aGlzLm1hdGNoKDEyMykgPyBzMi5rZXkgPSB0aGlzLnBhcnNlU3RyaW5nTGl0ZXJhbChyMikgOiBzMi5rZXkgPSB0aGlzLnBhcnNlSWRlbnRpZmllcih0cnVlKSwgdGhpcy5leHBlY3QoMTQpLCAhdGhpcy5tYXRjaCgxMjMpKQogICAgICAgICAgICAgICAgdGhyb3cgdGhpcy51bmV4cGVjdGVkKHRoaXMuc3RhdGUuc3RhcnQsIERjLk1vZHVsZUF0dHJpYnV0ZUludmFsaWRWYWx1ZSk7CiAgICAgICAgICAgICAgczIudmFsdWUgPSB0aGlzLnBhcnNlU3RyaW5nTGl0ZXJhbCh0aGlzLnN0YXRlLnZhbHVlKSwgdGhpcy5maW5pc2hOb2RlKHMyLCAiSW1wb3J0QXR0cmlidXRlIiksIHQyLnB1c2goczIpOwogICAgICAgICAgICB9IHdoaWxlICh0aGlzLmVhdCgxMikpOwogICAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgICB9CiAgICAgICAgICBtYXliZVBhcnNlTW9kdWxlQXR0cmlidXRlcygpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm1hdGNoKDcwKSB8fCB0aGlzLmhhc1ByZWNlZGluZ0xpbmVCcmVhaygpKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhc1BsdWdpbigibW9kdWxlQXR0cmlidXRlcyIpID8gW10gOiBudWxsOwogICAgICAgICAgICB0aGlzLmV4cGVjdFBsdWdpbigibW9kdWxlQXR0cmlidXRlcyIpLCB0aGlzLm5leHQoKTsKICAgICAgICAgICAgY29uc3QgdDIgPSBbXSwgZTIgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgY29uc3QgczIgPSB0aGlzLnN0YXJ0Tm9kZSgpOwogICAgICAgICAgICAgIGlmIChzMi5rZXkgPSB0aGlzLnBhcnNlSWRlbnRpZmllcih0cnVlKSwgczIua2V5Lm5hbWUgIT09ICJ0eXBlIiAmJiB0aGlzLnJhaXNlKHMyLmtleS5zdGFydCwgRGMuTW9kdWxlQXR0cmlidXRlRGlmZmVyZW50RnJvbVR5cGUsIHMyLmtleS5uYW1lKSwgZTIuaGFzKHMyLmtleS5uYW1lKSAmJiB0aGlzLnJhaXNlKHMyLmtleS5zdGFydCwgRGMuTW9kdWxlQXR0cmlidXRlc1dpdGhEdXBsaWNhdGVLZXlzLCBzMi5rZXkubmFtZSksIGUyLmFkZChzMi5rZXkubmFtZSksIHRoaXMuZXhwZWN0KDE0KSwgIXRoaXMubWF0Y2goMTIzKSkKICAgICAgICAgICAgICAgIHRocm93IHRoaXMudW5leHBlY3RlZCh0aGlzLnN0YXRlLnN0YXJ0LCBEYy5Nb2R1bGVBdHRyaWJ1dGVJbnZhbGlkVmFsdWUpOwogICAgICAgICAgICAgIHMyLnZhbHVlID0gdGhpcy5wYXJzZVN0cmluZ0xpdGVyYWwodGhpcy5zdGF0ZS52YWx1ZSksIHRoaXMuZmluaXNoTm9kZShzMiwgIkltcG9ydEF0dHJpYnV0ZSIpLCB0Mi5wdXNoKHMyKTsKICAgICAgICAgICAgfSB3aGlsZSAodGhpcy5lYXQoMTIpKTsKICAgICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgICAgfQogICAgICAgICAgbWF5YmVQYXJzZUltcG9ydEFzc2VydGlvbnMoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5pc0NvbnRleHR1YWwoODgpIHx8IHRoaXMuaGFzUHJlY2VkaW5nTGluZUJyZWFrKCkpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFzUGx1Z2luKCJpbXBvcnRBc3NlcnRpb25zIikgPyBbXSA6IG51bGw7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0UGx1Z2luKCJpbXBvcnRBc3NlcnRpb25zIiksIHRoaXMubmV4dCgpLCB0aGlzLmVhdCg1KTsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLnBhcnNlQXNzZXJ0RW50cmllcygpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5lYXQoOCksIHQyOwogICAgICAgICAgfQogICAgICAgICAgbWF5YmVQYXJzZURlZmF1bHRJbXBvcnRTcGVjaWZpZXIodDIpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5zaG91bGRQYXJzZURlZmF1bHRJbXBvcnQodDIpICYmICh0aGlzLnBhcnNlSW1wb3J0U3BlY2lmaWVyTG9jYWwodDIsIHRoaXMuc3RhcnROb2RlKCksICJJbXBvcnREZWZhdWx0U3BlY2lmaWVyIiwgImRlZmF1bHQgaW1wb3J0IHNwZWNpZmllciIpLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICAgIG1heWJlUGFyc2VTdGFySW1wb3J0U3BlY2lmaWVyKHQyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoKDQ5KSkgewogICAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0KCksIHRoaXMuZXhwZWN0Q29udGV4dHVhbCg4NyksIHRoaXMucGFyc2VJbXBvcnRTcGVjaWZpZXJMb2NhbCh0MiwgZTIsICJJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXIiLCAiaW1wb3J0IG5hbWVzcGFjZSBzcGVjaWZpZXIiKSwgdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZU5hbWVkSW1wb3J0U3BlY2lmaWVycyh0MikgewogICAgICAgICAgICBsZXQgZTIgPSB0cnVlOwogICAgICAgICAgICBmb3IgKHRoaXMuZXhwZWN0KDUpOyAhdGhpcy5lYXQoOCk7ICkgewogICAgICAgICAgICAgIGlmIChlMikKICAgICAgICAgICAgICAgIGUyID0gZmFsc2U7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5lYXQoMTQpKQogICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLnJhaXNlKHRoaXMuc3RhdGUuc3RhcnQsIERjLkRlc3RydWN0dXJlTmFtZWRJbXBvcnQpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZXhwZWN0KDEyKSwgdGhpcy5lYXQoOCkpCiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBzMiA9IHRoaXMuc3RhcnROb2RlKCksIHIyID0gdGhpcy5tYXRjaCgxMjMpLCBpMiA9IHRoaXMuaXNDb250ZXh0dWFsKDEyMCk7CiAgICAgICAgICAgICAgczIuaW1wb3J0ZWQgPSB0aGlzLnBhcnNlTW9kdWxlRXhwb3J0TmFtZSgpOwogICAgICAgICAgICAgIGNvbnN0IG4yID0gdGhpcy5wYXJzZUltcG9ydFNwZWNpZmllcihzMiwgcjIsIHQyLmltcG9ydEtpbmQgPT09ICJ0eXBlIiB8fCB0Mi5pbXBvcnRLaW5kID09PSAidHlwZW9mIiwgaTIpOwogICAgICAgICAgICAgIHQyLnNwZWNpZmllcnMucHVzaChuMik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlSW1wb3J0U3BlY2lmaWVyKHQyLCBlMiwgczIsIHIyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmVhdENvbnRleHR1YWwoODcpKQogICAgICAgICAgICAgIHQyLmxvY2FsID0gdGhpcy5wYXJzZUlkZW50aWZpZXIoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgY29uc3QgeyBpbXBvcnRlZDogczMgfSA9IHQyOwogICAgICAgICAgICAgIGlmIChlMikKICAgICAgICAgICAgICAgIHRocm93IHRoaXMucmFpc2UodDIuc3RhcnQsIERjLkltcG9ydEJpbmRpbmdJc1N0cmluZywgczMudmFsdWUpOwogICAgICAgICAgICAgIHRoaXMuY2hlY2tSZXNlcnZlZFdvcmQoczMubmFtZSwgdDIuc3RhcnQsIHRydWUsIHRydWUpLCB0Mi5sb2NhbCB8fCAodDIubG9jYWwgPSBfbChzMykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoZWNrTFZhbCh0Mi5sb2NhbCwgImltcG9ydCBzcGVjaWZpZXIiLCA5KSwgdGhpcy5maW5pc2hOb2RlKHQyLCAiSW1wb3J0U3BlY2lmaWVyIik7CiAgICAgICAgICB9CiAgICAgICAgICBpc1RoaXNQYXJhbSh0MikgewogICAgICAgICAgICByZXR1cm4gdDIudHlwZSA9PT0gIklkZW50aWZpZXIiICYmIHQyLm5hbWUgPT09ICJ0aGlzIjsKICAgICAgICAgIH0KICAgICAgICB9IHsKICAgICAgICAgIGNvbnN0cnVjdG9yKHQyLCBlMikgewogICAgICAgICAgICB0MiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB7fTsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IHMyIG9mIE9iamVjdC5rZXlzKGRkKSkKICAgICAgICAgICAgICAgIGUzW3MyXSA9IHQzICYmIHQzW3MyXSAhPSBudWxsID8gdDNbczJdIDogZGRbczJdOwogICAgICAgICAgICAgIHJldHVybiBlMzsKICAgICAgICAgICAgfSh0MiksIHN1cGVyKHQyLCBlMiksIHRoaXMub3B0aW9ucyA9IHQyLCB0aGlzLmluaXRpYWxpemVTY29wZXMoKSwgdGhpcy5wbHVnaW5zID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgZm9yIChjb25zdCBzMiBvZiB0MykgewogICAgICAgICAgICAgICAgY29uc3QgW3Q0LCByMl0gPSBBcnJheS5pc0FycmF5KHMyKSA/IHMyIDogW3MyLCB7fV07CiAgICAgICAgICAgICAgICBlMy5oYXModDQpIHx8IGUzLnNldCh0NCwgcjIgfHwge30pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gZTM7CiAgICAgICAgICAgIH0odGhpcy5vcHRpb25zLnBsdWdpbnMpLCB0aGlzLmZpbGVuYW1lID0gdDIuc291cmNlRmlsZW5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICBnZXRTY29wZUhhbmRsZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBDbDsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlKCkgewogICAgICAgICAgICB0aGlzLmVudGVySW5pdGlhbFNjb3BlcygpOwogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuc3RhcnROb2RlKCksIGUyID0gdGhpcy5zdGFydE5vZGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmV4dFRva2VuKCksIHQyLmVycm9ycyA9IG51bGwsIHRoaXMucGFyc2VUb3BMZXZlbCh0MiwgZTIpLCB0Mi5lcnJvcnMgPSB0aGlzLnN0YXRlLmVycm9ycywgdDI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IHhkID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIGNvbnN0IGUyID0ge307CiAgICAgICAgICBmb3IgKGNvbnN0IHMyIG9mIE9iamVjdC5rZXlzKHQyKSkKICAgICAgICAgICAgZTJbczJdID0gR2ModDJbczJdKTsKICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICB9KGpjKTsKICAgICAgICBmdW5jdGlvbiBGZCh0MiwgZTIpIHsKICAgICAgICAgIGxldCBzMiA9IENkOwogICAgICAgICAgcmV0dXJuIHQyICE9IG51bGwgJiYgdDIucGx1Z2lucyAmJiAoIWZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIGlmIChhZCh0MywgImRlY29yYXRvcnMiKSkgewogICAgICAgICAgICAgIGlmIChhZCh0MywgImRlY29yYXRvcnMtbGVnYWN5IikpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCB1c2UgdGhlIGRlY29yYXRvcnMgYW5kIGRlY29yYXRvcnMtbGVnYWN5IHBsdWdpbiB0b2dldGhlciIpOwogICAgICAgICAgICAgIGNvbnN0IGUzID0gb2QodDMsICJkZWNvcmF0b3JzIiwgImRlY29yYXRvcnNCZWZvcmVFeHBvcnQiKTsKICAgICAgICAgICAgICBpZiAoZTMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVGhlICdkZWNvcmF0b3JzJyBwbHVnaW4gcmVxdWlyZXMgYSAnZGVjb3JhdG9yc0JlZm9yZUV4cG9ydCcgb3B0aW9uLCB3aG9zZSB2YWx1ZSBtdXN0IGJlIGEgYm9vbGVhbi4gSWYgeW91IGFyZSBtaWdyYXRpbmcgZnJvbSBCYWJ5bG9uL0JhYmVsIDYgb3Igd2FudCB0byB1c2UgdGhlIG9sZCBkZWNvcmF0b3JzIHByb3Bvc2FsLCB5b3Ugc2hvdWxkIHVzZSB0aGUgJ2RlY29yYXRvcnMtbGVnYWN5JyBwbHVnaW4gaW5zdGVhZCBvZiAnZGVjb3JhdG9ycycuIik7CiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlMyAhPSAiYm9vbGVhbiIpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIidkZWNvcmF0b3JzQmVmb3JlRXhwb3J0JyBtdXN0IGJlIGEgYm9vbGVhbi4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWQodDMsICJmbG93IikgJiYgYWQodDMsICJ0eXBlc2NyaXB0IikpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgY29tYmluZSBmbG93IGFuZCB0eXBlc2NyaXB0IHBsdWdpbnMuIik7CiAgICAgICAgICAgIGlmIChhZCh0MywgInBsYWNlaG9sZGVycyIpICYmIGFkKHQzLCAidjhpbnRyaW5zaWMiKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBjb21iaW5lIHBsYWNlaG9sZGVycyBhbmQgdjhpbnRyaW5zaWMgcGx1Z2lucy4iKTsKICAgICAgICAgICAgaWYgKGFkKHQzLCAicGlwZWxpbmVPcGVyYXRvciIpKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSBvZCh0MywgInBpcGVsaW5lT3BlcmF0b3IiLCAicHJvcG9zYWwiKTsKICAgICAgICAgICAgICBpZiAoIXVkLmluY2x1ZGVzKGUzKSkgewogICAgICAgICAgICAgICAgY29uc3QgdDQgPSB1ZC5tYXAoKHQ1KSA9PiAnIicuY29uY2F0KHQ1LCAnIicpKS5qb2luKCIsICIpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCcicGlwZWxpbmVPcGVyYXRvciIgcmVxdWlyZXMgInByb3Bvc2FsIiBvcHRpb24gd2hvc2UgdmFsdWUgbXVzdCBiZSBvbmUgb2Y6ICcuY29uY2F0KHQ0LCAiLiIpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgczMgPSBhZCh0MywgInJlY29yZEFuZFR1cGxlIikgJiYgb2QodDMsICJyZWNvcmRBbmRUdXBsZSIsICJzeW50YXhUeXBlIikgPT09ICJoYXNoIjsKICAgICAgICAgICAgICBpZiAoZTMgPT09ICJoYWNrIikgewogICAgICAgICAgICAgICAgaWYgKGFkKHQzLCAicGxhY2Vob2xkZXJzIikpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGNvbWJpbmUgcGxhY2Vob2xkZXJzIHBsdWdpbiBhbmQgSGFjay1zdHlsZSBwaXBlcy4iKTsKICAgICAgICAgICAgICAgIGlmIChhZCh0MywgInY4aW50cmluc2ljIikpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGNvbWJpbmUgdjhpbnRyaW5zaWMgcGx1Z2luIGFuZCBIYWNrLXN0eWxlIHBpcGVzLiIpOwogICAgICAgICAgICAgICAgY29uc3QgZTQgPSBvZCh0MywgInBpcGVsaW5lT3BlcmF0b3IiLCAidG9waWNUb2tlbiIpOwogICAgICAgICAgICAgICAgaWYgKCFoZC5pbmNsdWRlcyhlNCkpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdDQgPSBoZC5tYXAoKHQ1KSA9PiAnIicuY29uY2F0KHQ1LCAnIicpKS5qb2luKCIsICIpOwogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJyJwaXBlbGluZU9wZXJhdG9yIiBpbiAicHJvcG9zYWwiOiAiaGFjayIgbW9kZSBhbHNvIHJlcXVpcmVzIGEgInRvcGljVG9rZW4iIG9wdGlvbiB3aG9zZSB2YWx1ZSBtdXN0IGJlIG9uZSBvZjogJy5jb25jYXQodDQsICIuIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGU0ID09PSAiIyIgJiYgczMpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUGx1Z2luIGNvbmZsaWN0IGJldHdlZW4gYFsicGlwZWxpbmVPcGVyYXRvciIsIHsgcHJvcG9zYWw6ICJoYWNrIiwgdG9waWNUb2tlbjogIiMiIH1dYCBhbmQgYFsicmVjb3JkQW5kdHVwbGUiLCB7IHN5bnRheFR5cGU6ICJoYXNoIn1dYC4nKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUzID09PSAic21hcnQiICYmIHMzKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQbHVnaW4gY29uZmxpY3QgYmV0d2VlbiBgWyJwaXBlbGluZU9wZXJhdG9yIiwgeyBwcm9wb3NhbDogInNtYXJ0IiB9XWAgYW5kIGBbInJlY29yZEFuZHR1cGxlIiwgeyBzeW50YXhUeXBlOiAiaGFzaCJ9XWAuJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFkKHQzLCAibW9kdWxlQXR0cmlidXRlcyIpKSB7CiAgICAgICAgICAgICAgaWYgKGFkKHQzLCAiaW1wb3J0QXNzZXJ0aW9ucyIpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgY29tYmluZSBpbXBvcnRBc3NlcnRpb25zIGFuZCBtb2R1bGVBdHRyaWJ1dGVzIHBsdWdpbnMuIik7CiAgICAgICAgICAgICAgaWYgKG9kKHQzLCAibW9kdWxlQXR0cmlidXRlcyIsICJ2ZXJzaW9uIikgIT09ICJtYXktMjAyMCIpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSAnbW9kdWxlQXR0cmlidXRlcycgcGx1Z2luIHJlcXVpcmVzIGEgJ3ZlcnNpb24nIG9wdGlvbiwgcmVwcmVzZW50aW5nIHRoZSBsYXN0IHByb3Bvc2FsIHVwZGF0ZS4gQ3VycmVudGx5LCB0aGUgb25seSBzdXBwb3J0ZWQgdmFsdWUgaXMgJ21heS0yMDIwJy4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWQodDMsICJyZWNvcmRBbmRUdXBsZSIpICYmICFwZC5pbmNsdWRlcyhvZCh0MywgInJlY29yZEFuZFR1cGxlIiwgInN5bnRheFR5cGUiKSkpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIncmVjb3JkQW5kVHVwbGUnIHJlcXVpcmVzICdzeW50YXhUeXBlJyBvcHRpb24gd2hvc2UgdmFsdWUgc2hvdWxkIGJlIG9uZSBvZjogIiArIHBkLm1hcCgodDQpID0+ICInIi5jb25jYXQodDQsICInIikpLmpvaW4oIiwgIikpOwogICAgICAgICAgICBpZiAoYWQodDMsICJhc3luY0RvRXhwcmVzc2lvbnMiKSAmJiAhYWQodDMsICJkb0V4cHJlc3Npb25zIikpIHsKICAgICAgICAgICAgICBjb25zdCB0NCA9IG5ldyBFcnJvcigiJ2FzeW5jRG9FeHByZXNzaW9ucycgcmVxdWlyZXMgJ2RvRXhwcmVzc2lvbnMnLCBwbGVhc2UgYWRkICdkb0V4cHJlc3Npb25zJyB0byBwYXJzZXIgcGx1Z2lucy4iKTsKICAgICAgICAgICAgICB0aHJvdyB0NC5taXNzaW5nUGx1Z2lucyA9ICJkb0V4cHJlc3Npb25zIiwgdDQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0odDIucGx1Z2lucyksIHMyID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSBsZC5maWx0ZXIoKGU0KSA9PiBhZCh0MywgZTQpKSwgczMgPSBlMy5qb2luKCIvIik7CiAgICAgICAgICAgIGxldCByMiA9IGdkW3MzXTsKICAgICAgICAgICAgaWYgKCFyMikgewogICAgICAgICAgICAgIHIyID0gQ2Q7CiAgICAgICAgICAgICAgZm9yIChjb25zdCB0NCBvZiBlMykKICAgICAgICAgICAgICAgIHIyID0gY2RbdDRdKHIyKTsKICAgICAgICAgICAgICBnZFtzM10gPSByMjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgICB9KHQyLnBsdWdpbnMpKSwgbmV3IHMyKHQyLCBlMik7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGdkID0ge307CiAgICAgICAgZWMucGFyc2UgPSBmdW5jdGlvbih0MiwgZTIpIHsKICAgICAgICAgIHZhciBzMjsKICAgICAgICAgIGlmICgoKHMyID0gZTIpID09IG51bGwgPyB2b2lkIDAgOiBzMi5zb3VyY2VUeXBlKSAhPT0gInVuYW1iaWd1b3VzIikKICAgICAgICAgICAgcmV0dXJuIEZkKGUyLCB0MikucGFyc2UoKTsKICAgICAgICAgIGUyID0gT2JqZWN0LmFzc2lnbih7fSwgZTIpOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZTIuc291cmNlVHlwZSA9ICJtb2R1bGUiOwogICAgICAgICAgICBjb25zdCBzMyA9IEZkKGUyLCB0MiksIHIyID0gczMucGFyc2UoKTsKICAgICAgICAgICAgaWYgKHMzLnNhd1VuYW1iaWd1b3VzRVNNKQogICAgICAgICAgICAgIHJldHVybiByMjsKICAgICAgICAgICAgaWYgKHMzLmFtYmlndW91c1NjcmlwdERpZmZlcmVudEFzdCkKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIGUyLnNvdXJjZVR5cGUgPSAic2NyaXB0IiwgRmQoZTIsIHQyKS5wYXJzZSgpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKHQzKSB7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgcjIucHJvZ3JhbS5zb3VyY2VUeXBlID0gInNjcmlwdCI7CiAgICAgICAgICAgIHJldHVybiByMjsKICAgICAgICAgIH0gY2F0Y2ggKHMzKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUyLnNvdXJjZVR5cGUgPSAic2NyaXB0IiwgRmQoZTIsIHQyKS5wYXJzZSgpOwogICAgICAgICAgICB9IGNhdGNoICh0MykgewogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IHMzOwogICAgICAgICAgfQogICAgICAgIH0sIGVjLnBhcnNlRXhwcmVzc2lvbiA9IGZ1bmN0aW9uKHQyLCBlMikgewogICAgICAgICAgY29uc3QgczIgPSBGZChlMiwgdDIpOwogICAgICAgICAgcmV0dXJuIHMyLm9wdGlvbnMuc3RyaWN0TW9kZSAmJiAoczIuc3RhdGUuc3RyaWN0ID0gdHJ1ZSksIHMyLmdldEV4cHJlc3Npb24oKTsKICAgICAgICB9LCBlYy50b2tUeXBlcyA9IHhkOwogICAgICAgIGNvbnN0IHsgaXNOb25FbXB0eUFycmF5OiBQZCB9ID0gT28sIFRkID0ga3UsIGJkID0gdnUsIFNkID0gT3U7CiAgICAgICAgZnVuY3Rpb24gd2QoKSB7CiAgICAgICAgICBsZXQgdDIgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICAgICAgY29uc3QgeyBhbGxvd0NvbW1lbnRzOiBlMiA9IHRydWUgfSA9IHQyOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIGNvbnN0IHsgcGFyc2VFeHByZXNzaW9uOiBzMiB9ID0gZWM7CiAgICAgICAgICAgIGxldCByMjsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICByMiA9IHMyKHQzLCB7IHRva2VuczogdHJ1ZSwgcmFuZ2VzOiB0cnVlIH0pOwogICAgICAgICAgICB9IGNhdGNoICh0NCkgewogICAgICAgICAgICAgIHRocm93IFNkKHQ0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWUyICYmIFBkKHIyLmNvbW1lbnRzKSkKICAgICAgICAgICAgICB0aHJvdyBCZChyMi5jb21tZW50c1swXSwgIkNvbW1lbnQiKTsKICAgICAgICAgICAgcmV0dXJuIE5kKHIyKSwgcjI7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBCZCh0MiwgZTIpIHsKICAgICAgICAgIGNvbnN0IFtzMiwgcjJdID0gW3QyLmxvYy5zdGFydCwgdDIubG9jLmVuZF0ubWFwKCh0MykgPT4gewogICAgICAgICAgICBsZXQgeyBsaW5lOiBlMywgY29sdW1uOiBzMyB9ID0gdDM7CiAgICAgICAgICAgIHJldHVybiB7IGxpbmU6IGUzLCBjb2x1bW46IHMzICsgMSB9OwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gVGQoIiIuY29uY2F0KGUyLCAiIGlzIG5vdCBhbGxvd2VkIGluIEpTT04uIiksIHsgc3RhcnQ6IHMyLCBlbmQ6IHIyIH0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBOZCh0MikgewogICAgICAgICAgc3dpdGNoICh0Mi50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgIkFycmF5RXhwcmVzc2lvbiI6CiAgICAgICAgICAgICAgZm9yIChjb25zdCBlMiBvZiB0Mi5lbGVtZW50cykKICAgICAgICAgICAgICAgIGUyICE9PSBudWxsICYmIE5kKGUyKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGNhc2UgIk9iamVjdEV4cHJlc3Npb24iOgogICAgICAgICAgICAgIGZvciAoY29uc3QgZTIgb2YgdDIucHJvcGVydGllcykKICAgICAgICAgICAgICAgIE5kKGUyKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGNhc2UgIk9iamVjdFByb3BlcnR5IjoKICAgICAgICAgICAgICBpZiAodDIuY29tcHV0ZWQpCiAgICAgICAgICAgICAgICB0aHJvdyBCZCh0Mi5rZXksICJDb21wdXRlZCBrZXkiKTsKICAgICAgICAgICAgICBpZiAodDIuc2hvcnRoYW5kKQogICAgICAgICAgICAgICAgdGhyb3cgQmQodDIua2V5LCAiU2hvcnRoYW5kIHByb3BlcnR5Iik7CiAgICAgICAgICAgICAgcmV0dXJuIHQyLmtleS50eXBlICE9PSAiSWRlbnRpZmllciIgJiYgTmQodDIua2V5KSwgdm9pZCBOZCh0Mi52YWx1ZSk7CiAgICAgICAgICAgIGNhc2UgIlVuYXJ5RXhwcmVzc2lvbiI6IHsKICAgICAgICAgICAgICBjb25zdCB7IG9wZXJhdG9yOiBlMiwgYXJndW1lbnQ6IHMyIH0gPSB0MjsKICAgICAgICAgICAgICBpZiAoZTIgIT09ICIrIiAmJiBlMiAhPT0gIi0iKQogICAgICAgICAgICAgICAgdGhyb3cgQmQodDIsICJPcGVyYXRvciAnIi5jb25jYXQodDIub3BlcmF0b3IsICInIikpOwogICAgICAgICAgICAgIGlmIChzMi50eXBlID09PSAiTnVtZXJpY0xpdGVyYWwiIHx8IHMyLnR5cGUgPT09ICJJZGVudGlmaWVyIiAmJiAoczIubmFtZSA9PT0gIkluZmluaXR5IiB8fCBzMi5uYW1lID09PSAiTmFOIikpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgdGhyb3cgQmQoczIsICJPcGVyYXRvciAnIi5jb25jYXQoZTIsICInIGJlZm9yZSAnIikuY29uY2F0KHMyLnR5cGUsICInIikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgIklkZW50aWZpZXIiOgogICAgICAgICAgICAgIGlmICh0Mi5uYW1lICE9PSAiSW5maW5pdHkiICYmIHQyLm5hbWUgIT09ICJOYU4iICYmIHQyLm5hbWUgIT09ICJ1bmRlZmluZWQiKQogICAgICAgICAgICAgICAgdGhyb3cgQmQodDIsICJJZGVudGlmaWVyICciLmNvbmNhdCh0Mi5uYW1lLCAiJyIpKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGNhc2UgIlRlbXBsYXRlTGl0ZXJhbCI6CiAgICAgICAgICAgICAgaWYgKFBkKHQyLmV4cHJlc3Npb25zKSkKICAgICAgICAgICAgICAgIHRocm93IEJkKHQyLmV4cHJlc3Npb25zWzBdLCAiJ1RlbXBsYXRlTGl0ZXJhbCcgd2l0aCBleHByZXNzaW9uIik7CiAgICAgICAgICAgICAgZm9yIChjb25zdCBlMiBvZiB0Mi5xdWFzaXMpCiAgICAgICAgICAgICAgICBOZChlMik7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBjYXNlICJOdWxsTGl0ZXJhbCI6CiAgICAgICAgICAgIGNhc2UgIkJvb2xlYW5MaXRlcmFsIjoKICAgICAgICAgICAgY2FzZSAiTnVtZXJpY0xpdGVyYWwiOgogICAgICAgICAgICBjYXNlICJTdHJpbmdMaXRlcmFsIjoKICAgICAgICAgICAgY2FzZSAiVGVtcGxhdGVFbGVtZW50IjoKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdGhyb3cgQmQodDIsICInIi5jb25jYXQodDIudHlwZSwgIiciKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IElkID0gd2QoKTsKICAgICAgICB2YXIgdmQgPSB7IGpzb246IGJkKHsgcGFyc2U6IElkLCBoYXNQcmFnbWE6ICgpID0+IHRydWUgfSksIGpzb241OiBiZChJZCksICJqc29uLXN0cmluZ2lmeSI6IGJkKHsgcGFyc2U6IHdkKHsgYWxsb3dDb21tZW50czogZmFsc2UgfSksIGFzdEZvcm1hdDogImVzdHJlZS1qc29uIiB9KSB9OwogICAgICAgIGNvbnN0IGtkID0geGksIHsgZ2V0TmV4dE5vblNwYWNlTm9uQ29tbWVudENoYXJhY3RlckluZGV4V2l0aFN0YXJ0SW5kZXg6IExkLCBnZXRTaGViYW5nOiBPZCB9ID0gT28sIE1kID0gdnUsIFJkID0gT3UsIGpkID0gdGMsIFVkID0gdmQsIF9kID0geyBzb3VyY2VUeXBlOiAibW9kdWxlIiwgYWxsb3dJbXBvcnRFeHBvcnRFdmVyeXdoZXJlOiB0cnVlLCBhbGxvd1JldHVybk91dHNpZGVGdW5jdGlvbjogdHJ1ZSwgYWxsb3dTdXBlck91dHNpZGVNZXRob2Q6IHRydWUsIGFsbG93VW5kZWNsYXJlZEV4cG9ydHM6IHRydWUsIGVycm9yUmVjb3Zlcnk6IHRydWUsIGNyZWF0ZVBhcmVudGhlc2l6ZWRFeHByZXNzaW9uczogdHJ1ZSwgcGx1Z2luczogWyJkb0V4cHJlc3Npb25zIiwgImV4cG9ydERlZmF1bHRGcm9tIiwgImZ1bmN0aW9uQmluZCIsICJmdW5jdGlvblNlbnQiLCAidGhyb3dFeHByZXNzaW9ucyIsICJwYXJ0aWFsQXBwbGljYXRpb24iLCBbImRlY29yYXRvcnMiLCB7IGRlY29yYXRvcnNCZWZvcmVFeHBvcnQ6IGZhbHNlIH1dLCAiaW1wb3J0QXNzZXJ0aW9ucyIsICJkZWNpbWFsIiwgIm1vZHVsZUJsb2NrcyIsICJhc3luY0RvRXhwcmVzc2lvbnMiXSwgdG9rZW5zOiB0cnVlLCByYW5nZXM6IHRydWUgfSwgemQgPSBbInJlY29yZEFuZFR1cGxlIiwgeyBzeW50YXhUeXBlOiAiaGFzaCIgfV0sIEhkID0gInY4aW50cmluc2ljIiwgVmQgPSBbWyJwaXBlbGluZU9wZXJhdG9yIiwgeyBwcm9wb3NhbDogImhhY2siLCB0b3BpY1Rva2VuOiAiJSIgfV0sIFsicGlwZWxpbmVPcGVyYXRvciIsIHsgcHJvcG9zYWw6ICJtaW5pbWFsIiB9XSwgWyJwaXBlbGluZU9wZXJhdG9yIiwgeyBwcm9wb3NhbDogImZzaGFycCIgfV1dLCBxZCA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgICBsZXQgZTIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IF9kOwogICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZTIpLCB7fSwgeyBwbHVnaW5zOiBbLi4uZTIucGx1Z2lucywgLi4udDJdIH0pOwogICAgICAgIH0sIFdkID0gL0AoPzpubyk/Zmxvd1xiLzsKICAgICAgICBmdW5jdGlvbiBLZCh0MiwgZTIpIHsKICAgICAgICAgIGlmIChlMi5maWxlcGF0aCAmJiBlMi5maWxlcGF0aC5lbmRzV2l0aCgiLmpzLmZsb3ciKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICBjb25zdCBzMiA9IE9kKHQyKTsKICAgICAgICAgIHMyICYmICh0MiA9IHQyLnNsaWNlKHMyLmxlbmd0aCkpOwogICAgICAgICAgY29uc3QgcjIgPSBMZCh0MiwgMCk7CiAgICAgICAgICByZXR1cm4gcjIgIT09IGZhbHNlICYmICh0MiA9IHQyLnNsaWNlKDAsIHIyKSksIFdkLnRlc3QodDIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBHZCh0MiwgZTIsIHMyKSB7CiAgICAgICAgICBjb25zdCByMiA9ICgwLCBlY1t0Ml0pKGUyLCBzMiksIGkyID0gcjIuZXJyb3JzLmZpbmQoKHQzKSA9PiAhdEQuaGFzKHQzLnJlYXNvbkNvZGUpKTsKICAgICAgICAgIGlmIChpMikKICAgICAgICAgICAgdGhyb3cgaTI7CiAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFhkKHQyKSB7CiAgICAgICAgICBmb3IgKHZhciBlMiA9IGFyZ3VtZW50cy5sZW5ndGgsIHMyID0gbmV3IEFycmF5KGUyID4gMSA/IGUyIC0gMSA6IDApLCByMiA9IDE7IHIyIDwgZTI7IHIyKyspCiAgICAgICAgICAgIHMyW3IyIC0gMV0gPSBhcmd1bWVudHNbcjJdOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUzLCByMykgewogICAgICAgICAgICBsZXQgaTIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICAgICAgICBpZiAoKGkyLnBhcnNlciA9PT0gImJhYmVsIiB8fCBpMi5wYXJzZXIgPT09ICJfX2JhYmVsX2VzdHJlZSIpICYmIEtkKGUzLCBpMikpCiAgICAgICAgICAgICAgcmV0dXJuIGkyLnBhcnNlciA9ICJiYWJlbC1mbG93IiwgJGQoZTMsIHIzLCBpMik7CiAgICAgICAgICAgIGxldCBuMiA9IHMyOwogICAgICAgICAgICBpMi5fX2JhYmVsU291cmNlVHlwZSA9PT0gInNjcmlwdCIgJiYgKG4yID0gbjIubWFwKCh0MykgPT4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0MyksIHt9LCB7IHNvdXJjZVR5cGU6ICJzY3JpcHQiIH0pKSksIC8jW1t7XS8udGVzdChlMykgJiYgKG4yID0gbjIubWFwKCh0MykgPT4gcWQoW3pkXSwgdDMpKSk7CiAgICAgICAgICAgIGNvbnN0IGEyID0gLyVbQS1aXS8udGVzdChlMyk7CiAgICAgICAgICAgIGlmIChlMy5pbmNsdWRlcygifD4iKSkgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gYTIgPyBbLi4uVmQsIEhkXSA6IFZkOwogICAgICAgICAgICAgIG4yID0gdDMuZmxhdE1hcCgodDQpID0+IG4yLm1hcCgoZTQpID0+IHFkKFt0NF0sIGU0KSkpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBhMiAmJiAobjIgPSBuMi5tYXAoKHQzKSA9PiBxZChbSGRdLCB0MykpKTsKICAgICAgICAgICAgY29uc3QgeyByZXN1bHQ6IG8yLCBlcnJvcjogdTIgfSA9IGtkKC4uLm4yLm1hcCgoczMpID0+ICgpID0+IEdkKHQyLCBlMywgczMpKSk7CiAgICAgICAgICAgIGlmICghbzIpCiAgICAgICAgICAgICAgdGhyb3cgUmQodTIpOwogICAgICAgICAgICByZXR1cm4gaTIub3JpZ2luYWxUZXh0ID0gZTMsIGpkKG8yLCBpMik7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBjb25zdCBKZCA9IFhkKCJwYXJzZSIsIHFkKFsianN4IiwgImZsb3ciXSkpLCAkZCA9IFhkKCJwYXJzZSIsIHFkKFsianN4IiwgWyJmbG93IiwgeyBhbGw6IHRydWUsIGVudW1zOiB0cnVlIH1dXSkpLCBZZCA9IFhkKCJwYXJzZSIsIHFkKFsianN4IiwgInR5cGVzY3JpcHQiXSksIHFkKFsidHlwZXNjcmlwdCJdKSksIFFkID0gWGQoInBhcnNlIiwgcWQoWyJqc3giLCAiZmxvdyIsICJlc3RyZWUiXSkpLCBaZCA9IFhkKCJwYXJzZUV4cHJlc3Npb24iLCBxZChbImpzeCJdKSksIHREID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoWyJTdHJpY3ROdW1lcmljRXNjYXBlIiwgIlN0cmljdFdpdGgiLCAiU3RyaWN0T2N0YWxMaXRlcmFsIiwgIlN0cmljdERlbGV0ZSIsICJTdHJpY3RFdmFsQXJndW1lbnRzIiwgIlN0cmljdEV2YWxBcmd1bWVudHNCaW5kaW5nIiwgIlN0cmljdEZ1bmN0aW9uIiwgIkVtcHR5VHlwZUFyZ3VtZW50cyIsICJFbXB0eVR5cGVQYXJhbWV0ZXJzIiwgIkNvbnN0cnVjdG9ySGFzVHlwZVBhcmFtZXRlcnMiLCAiVW5zdXBwb3J0ZWRQYXJhbWV0ZXJQcm9wZXJ0eUtpbmQiLCAiVW5leHBlY3RlZFBhcmFtZXRlck1vZGlmaWVyIiwgIk1peGVkTGFiZWxlZEFuZFVubGFiZWxlZEVsZW1lbnRzIiwgIkludmFsaWRUdXBsZU1lbWJlckxhYmVsIiwgIk5vbkNsYXNzTWV0aG9kUHJvcGVydHlIYXNBYnN0cmFjdE1vZGlmZXIiLCAiUmVhZG9ubHlGb3JNZXRob2RTaWduYXR1cmUiLCAiQ2xhc3NNZXRob2RIYXNEZWNsYXJlIiwgIkNsYXNzTWV0aG9kSGFzUmVhZG9ubHkiLCAiSW52YWxpZE1vZGlmaWVyT25UeXBlTWVtYmVyIiwgIkR1cGxpY2F0ZUFjY2Vzc2liaWxpdHlNb2RpZmllciIsICJJbmRleFNpZ25hdHVyZUhhc0RlY2xhcmUiLCAiRGVjb3JhdG9yRXhwb3J0Q2xhc3MiLCAiUGFyYW1EdXBlIiwgIkludmFsaWREZWNpbWFsIiwgIlJlc3RUcmFpbGluZ0NvbW1hIiwgIlVuc3VwcG9ydGVkUGFyYW1ldGVyRGVjb3JhdG9yIiwgIlVudGVybWluYXRlZEpzeENvbnRlbnQiLCAiVW5leHBlY3RlZFJlc2VydmVkV29yZCIsICJNb2R1bGVBdHRyaWJ1dGVzV2l0aER1cGxpY2F0ZUtleXMiLCAiTGluZVRlcm1pbmF0b3JCZWZvcmVBcnJvdyIsICJJbnZhbGlkRXNjYXBlU2VxdWVuY2VUZW1wbGF0ZSIsICJOb25BYnN0cmFjdENsYXNzSGFzQWJzdHJhY3RNZXRob2QiLCAiVW5zdXBwb3J0ZWRQcm9wZXJ0eURlY29yYXRvciIsICJPcHRpb25hbFR5cGVCZWZvcmVSZXF1aXJlZCIsICJQYXR0ZXJuSXNPcHRpb25hbCIsICJPcHRpb25hbEJpbmRpbmdQYXR0ZXJuIiwgIkRlY2xhcmVDbGFzc0ZpZWxkSGFzSW5pdGlhbGl6ZXIiLCAiVHlwZUltcG9ydENhbm5vdFNwZWNpZnlEZWZhdWx0QW5kTmFtZWQiLCAiRGVjbGFyZUZ1bmN0aW9uSGFzSW1wbGVtZW50YXRpb24iLCAiQ29uc3RydWN0b3JDbGFzc0ZpZWxkIiwgIlZhclJlZGVjbGFyYXRpb24iLCAiSW52YWxpZFByaXZhdGVGaWVsZFJlc29sdXRpb24iLCAiRHVwbGljYXRlRXhwb3J0Il0pLCBlRCA9IE1kKEpkKSwgc0QgPSBNZChaZCk7CiAgICAgICAgcmV0dXJuIHsgcGFyc2VyczogT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHsgYmFiZWw6IGVELCAiYmFiZWwtZmxvdyI6IE1kKCRkKSwgImJhYmVsLXRzIjogTWQoWWQpIH0sIFVkKSwge30sIHsgX19qc19leHByZXNzaW9uOiBzRCwgX192dWVfZXhwcmVzc2lvbjogc0QsIF9fdnVlX2V2ZW50X2JpbmRpbmc6IGVELCBfX2JhYmVsX2VzdHJlZTogTWQoUWQpIH0pIH07CiAgICAgIH0pOwogICAgfQogIH0pOwoKICAvLyAuLi8uLi9ub2RlX21vZHVsZXMvcHJldHRpZXIvcGFyc2VyLWh0bWwuanMKICB2YXIgcmVxdWlyZV9wYXJzZXJfaHRtbCA9IF9fY29tbW9uSlMoewogICAgIi4uLy4uL25vZGVfbW9kdWxlcy9wcmV0dGllci9wYXJzZXItaHRtbC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgICFmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgdHlwZW9mIGV4cG9ydHMgPT0gIm9iamVjdCIgJiYgdHlwZW9mIG1vZHVsZSAhPSAidW5kZWZpbmVkIiA/IG1vZHVsZS5leHBvcnRzID0gdCgpIDogdHlwZW9mIGRlZmluZSA9PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQgPyBkZWZpbmUodCkgOiAoKGUgPSB0eXBlb2YgZ2xvYmFsVGhpcyAhPSAidW5kZWZpbmVkIiA/IGdsb2JhbFRoaXMgOiBlIHx8IHNlbGYpLnByZXR0aWVyUGx1Z2lucyA9IGUucHJldHRpZXJQbHVnaW5zIHx8IHt9LCBlLnByZXR0aWVyUGx1Z2lucy5odG1sID0gdCgpKTsKICAgICAgfShleHBvcnRzLCBmdW5jdGlvbigpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIGUgPSB0eXBlb2YgZ2xvYmFsVGhpcyAhPSAidW5kZWZpbmVkIiA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9ICJ1bmRlZmluZWQiID8gd2luZG93IDogdHlwZW9mIGdsb2JhbCAhPSAidW5kZWZpbmVkIiA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9ICJ1bmRlZmluZWQiID8gc2VsZiA6IHt9LCB0ID0ge30sIHIgPSB7fTsKICAgICAgICAhZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGZ1bmN0aW9uIHQyKHQzKSB7CiAgICAgICAgICAgIHJldHVybiBlMi4kMCA8PSB0MyAmJiB0MyA8PSBlMi4kOTsKICAgICAgICAgIH0KICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCBlMi4kRU9GID0gMCwgZTIuJEJTUEFDRSA9IDgsIGUyLiRUQUIgPSA5LCBlMi4kTEYgPSAxMCwgZTIuJFZUQUIgPSAxMSwgZTIuJEZGID0gMTIsIGUyLiRDUiA9IDEzLCBlMi4kU1BBQ0UgPSAzMiwgZTIuJEJBTkcgPSAzMywgZTIuJERRID0gMzQsIGUyLiRIQVNIID0gMzUsIGUyLiQkID0gMzYsIGUyLiRQRVJDRU5UID0gMzcsIGUyLiRBTVBFUlNBTkQgPSAzOCwgZTIuJFNRID0gMzksIGUyLiRMUEFSRU4gPSA0MCwgZTIuJFJQQVJFTiA9IDQxLCBlMi4kU1RBUiA9IDQyLCBlMi4kUExVUyA9IDQzLCBlMi4kQ09NTUEgPSA0NCwgZTIuJE1JTlVTID0gNDUsIGUyLiRQRVJJT0QgPSA0NiwgZTIuJFNMQVNIID0gNDcsIGUyLiRDT0xPTiA9IDU4LCBlMi4kU0VNSUNPTE9OID0gNTksIGUyLiRMVCA9IDYwLCBlMi4kRVEgPSA2MSwgZTIuJEdUID0gNjIsIGUyLiRRVUVTVElPTiA9IDYzLCBlMi4kMCA9IDQ4LCBlMi4kNyA9IDU1LCBlMi4kOSA9IDU3LCBlMi4kQSA9IDY1LCBlMi4kRSA9IDY5LCBlMi4kRiA9IDcwLCBlMi4kWCA9IDg4LCBlMi4kWiA9IDkwLCBlMi4kTEJSQUNLRVQgPSA5MSwgZTIuJEJBQ0tTTEFTSCA9IDkyLCBlMi4kUkJSQUNLRVQgPSA5MywgZTIuJENBUkVUID0gOTQsIGUyLiRfID0gOTUsIGUyLiRhID0gOTcsIGUyLiRiID0gOTgsIGUyLiRlID0gMTAxLCBlMi4kZiA9IDEwMiwgZTIuJG4gPSAxMTAsIGUyLiRyID0gMTE0LCBlMi4kdCA9IDExNiwgZTIuJHUgPSAxMTcsIGUyLiR2ID0gMTE4LCBlMi4keCA9IDEyMCwgZTIuJHogPSAxMjIsIGUyLiRMQlJBQ0UgPSAxMjMsIGUyLiRCQVIgPSAxMjQsIGUyLiRSQlJBQ0UgPSAxMjUsIGUyLiROQlNQID0gMTYwLCBlMi4kUElQRSA9IDEyNCwgZTIuJFRJTERBID0gMTI2LCBlMi4kQVQgPSA2NCwgZTIuJEJUID0gOTYsIGUyLmlzV2hpdGVzcGFjZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0MyA+PSBlMi4kVEFCICYmIHQzIDw9IGUyLiRTUEFDRSB8fCB0MyA9PSBlMi4kTkJTUDsKICAgICAgICAgIH0sIGUyLmlzRGlnaXQgPSB0MiwgZTIuaXNBc2NpaUxldHRlciA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiB0MyA+PSBlMi4kYSAmJiB0MyA8PSBlMi4keiB8fCB0MyA+PSBlMi4kQSAmJiB0MyA8PSBlMi4kWjsKICAgICAgICAgIH0sIGUyLmlzQXNjaWlIZXhEaWdpdCA9IGZ1bmN0aW9uKHIyKSB7CiAgICAgICAgICAgIHJldHVybiByMiA+PSBlMi4kYSAmJiByMiA8PSBlMi4kZiB8fCByMiA+PSBlMi4kQSAmJiByMiA8PSBlMi4kRiB8fCB0MihyMik7CiAgICAgICAgICB9LCBlMi5pc05ld0xpbmUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gdDMgPT09IGUyLiRMRiB8fCB0MyA9PT0gZTIuJENSOwogICAgICAgICAgfSwgZTIuaXNPY3RhbERpZ2l0ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgcmV0dXJuIGUyLiQwIDw9IHQzICYmIHQzIDw9IGUyLiQ3OwogICAgICAgICAgfTsKICAgICAgICB9KHIpOwogICAgICAgIHZhciBuID0ge30sIGkgPSB7fTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgIGNsYXNzIHMgewogICAgICAgICAgY29uc3RydWN0b3IoZTIsIHQyLCByMikgewogICAgICAgICAgICB0aGlzLmZpbGVQYXRoID0gZTIsIHRoaXMubmFtZSA9IHQyLCB0aGlzLm1lbWJlcnMgPSByMjsKICAgICAgICAgIH0KICAgICAgICAgIGFzc2VydE5vTWVtYmVycygpIHsKICAgICAgICAgICAgaWYgKHRoaXMubWVtYmVycy5sZW5ndGgpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbGxlZ2FsIHN0YXRlOiBzeW1ib2wgd2l0aG91dCBtZW1iZXJzIGV4cGVjdGVkLCBidXQgZ290ICIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHRoaXMpLCAiLiIpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaS5TdGF0aWNTeW1ib2wgPSBzOwogICAgICAgIGkuU3RhdGljU3ltYm9sQ2FjaGUgPSBjbGFzcyB7CiAgICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgdGhpcy5jYWNoZSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgICAgICAgICB9CiAgICAgICAgICBnZXQoZTIsIHQyLCByMikgewogICAgICAgICAgICBjb25zdCBuMiA9IChyMiA9IHIyIHx8IFtdKS5sZW5ndGggPyAiLiIuY29uY2F0KHIyLmpvaW4oIi4iKSkgOiAiIiwgaTIgPSAnIicuY29uY2F0KGUyLCAnIi4nKS5jb25jYXQodDIpLmNvbmNhdChuMik7CiAgICAgICAgICAgIGxldCBvMiA9IHRoaXMuY2FjaGUuZ2V0KGkyKTsKICAgICAgICAgICAgcmV0dXJuIG8yIHx8IChvMiA9IG5ldyBzKGUyLCB0MiwgcjIpLCB0aGlzLmNhY2hlLnNldChpMiwgbzIpKSwgbzI7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB2YXIgbyA9IHt9OwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgY29uc3QgYSA9IC8tKyhbYS16MC05XSkvZzsKICAgICAgICBmdW5jdGlvbiB1KGUyLCB0MiwgcjIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gZTIuaW5kZXhPZih0Mik7CiAgICAgICAgICByZXR1cm4gbjIgPT0gLTEgPyByMiA6IFtlMi5zbGljZSgwLCBuMikudHJpbSgpLCBlMi5zbGljZShuMiArIDEpLnRyaW0oKV07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGMoZTIsIHQyLCByMikgewogICAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoZTIpID8gdDIudmlzaXRBcnJheShlMiwgcjIpIDogdHlwZW9mIChuMiA9IGUyKSA9PSAib2JqZWN0IiAmJiBuMiAhPT0gbnVsbCAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YobjIpID09PSBoID8gdDIudmlzaXRTdHJpbmdNYXAoZTIsIHIyKSA6IGUyID09IG51bGwgfHwgdHlwZW9mIGUyID09ICJzdHJpbmciIHx8IHR5cGVvZiBlMiA9PSAibnVtYmVyIiB8fCB0eXBlb2YgZTIgPT0gImJvb2xlYW4iID8gdDIudmlzaXRQcmltaXRpdmUoZTIsIHIyKSA6IHQyLnZpc2l0T3RoZXIoZTIsIHIyKTsKICAgICAgICAgIHZhciBuMjsKICAgICAgICB9CiAgICAgICAgby5kYXNoQ2FzZVRvQ2FtZWxDYXNlID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5yZXBsYWNlKGEsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBmb3IgKHZhciBlMyA9IGFyZ3VtZW50cy5sZW5ndGgsIHQyID0gbmV3IEFycmF5KGUzKSwgcjIgPSAwOyByMiA8IGUzOyByMisrKQogICAgICAgICAgICAgIHQyW3IyXSA9IGFyZ3VtZW50c1tyMl07CiAgICAgICAgICAgIHJldHVybiB0MlsxXS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwgby5zcGxpdEF0Q29sb24gPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB1KGUyLCAiOiIsIHQyKTsKICAgICAgICB9LCBvLnNwbGl0QXRQZXJpb2QgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB1KGUyLCAiLiIsIHQyKTsKICAgICAgICB9LCBvLnZpc2l0VmFsdWUgPSBjLCBvLmlzRGVmaW5lZCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgIT0gbnVsbDsKICAgICAgICB9LCBvLm5vVW5kZWZpbmVkID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMiA9PT0gdm9pZCAwID8gbnVsbCA6IGUyOwogICAgICAgIH07CiAgICAgICAgby5WYWx1ZVRyYW5zZm9ybWVyID0gY2xhc3MgewogICAgICAgICAgdmlzaXRBcnJheShlMiwgdDIpIHsKICAgICAgICAgICAgcmV0dXJuIGUyLm1hcCgoZTMpID0+IGMoZTMsIHRoaXMsIHQyKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2aXNpdFN0cmluZ01hcChlMiwgdDIpIHsKICAgICAgICAgICAgY29uc3QgcjIgPSB7fTsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKGUyKS5mb3JFYWNoKChuMikgPT4gewogICAgICAgICAgICAgIHIyW24yXSA9IGMoZTJbbjJdLCB0aGlzLCB0Mik7CiAgICAgICAgICAgIH0pLCByMjsKICAgICAgICAgIH0KICAgICAgICAgIHZpc2l0UHJpbWl0aXZlKGUyLCB0MikgewogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICB9CiAgICAgICAgICB2aXNpdE90aGVyKGUyLCB0MikgewogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICB9CiAgICAgICAgfSwgby5TeW5jQXN5bmMgPSB7IGFzc2VydFN5bmM6IChlMikgPT4gewogICAgICAgICAgaWYgKEQoZTIpKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIklsbGVnYWwgc3RhdGU6IHZhbHVlIGNhbm5vdCBiZSBhIHByb21pc2UiKTsKICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICB9LCB0aGVuOiAoZTIsIHQyKSA9PiBEKGUyKSA/IGUyLnRoZW4odDIpIDogdDIoZTIpLCBhbGw6IChlMikgPT4gZTIuc29tZShEKSA/IFByb21pc2UuYWxsKGUyKSA6IGUyIH0sIG8uZXJyb3IgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnRlcm5hbCBFcnJvcjogIi5jb25jYXQoZTIpKTsKICAgICAgICB9LCBvLnN5bnRheEVycm9yID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCByMiA9IEVycm9yKGUyKTsKICAgICAgICAgIHJldHVybiByMltsXSA9IHRydWUsIHQyICYmIChyMltwXSA9IHQyKSwgcjI7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBsID0gIm5nU3ludGF4RXJyb3IiLCBwID0gIm5nUGFyc2VFcnJvcnMiOwogICAgICAgIG8uaXNTeW50YXhFcnJvciA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTJbbF07CiAgICAgICAgfSwgby5nZXRQYXJzZUVycm9ycyA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTJbcF0gfHwgW107CiAgICAgICAgfSwgby5lc2NhcGVSZWdFeHAgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnJlcGxhY2UoLyhbLiorP149IToke30oKXxbXF1cL1xcXSkvZywgIlxcJDEiKTsKICAgICAgICB9OwogICAgICAgIGNvbnN0IGggPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yoe30pOwogICAgICAgIGZ1bmN0aW9uIEQoZTIpIHsKICAgICAgICAgIHJldHVybiAhIWUyICYmIHR5cGVvZiBlMi50aGVuID09ICJmdW5jdGlvbiI7CiAgICAgICAgfQogICAgICAgIG8udXRmOEVuY29kZSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSAiIjsKICAgICAgICAgIGZvciAobGV0IHIyID0gMDsgcjIgPCBlMi5sZW5ndGg7IHIyKyspIHsKICAgICAgICAgICAgbGV0IG4yID0gZTIuY2hhckNvZGVBdChyMik7CiAgICAgICAgICAgIGlmIChuMiA+PSA1NTI5NiAmJiBuMiA8PSA1NjMxOSAmJiBlMi5sZW5ndGggPiByMiArIDEpIHsKICAgICAgICAgICAgICBjb25zdCB0MyA9IGUyLmNoYXJDb2RlQXQocjIgKyAxKTsKICAgICAgICAgICAgICB0MyA+PSA1NjMyMCAmJiB0MyA8PSA1NzM0MyAmJiAocjIrKywgbjIgPSAobjIgLSA1NTI5NiA8PCAxMCkgKyB0MyAtIDU2MzIwICsgNjU1MzYpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG4yIDw9IDEyNyA/IHQyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUobjIpIDogbjIgPD0gMjA0NyA/IHQyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUobjIgPj4gNiAmIDMxIHwgMTkyLCA2MyAmIG4yIHwgMTI4KSA6IG4yIDw9IDY1NTM1ID8gdDIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShuMiA+PiAxMiB8IDIyNCwgbjIgPj4gNiAmIDYzIHwgMTI4LCA2MyAmIG4yIHwgMTI4KSA6IG4yIDw9IDIwOTcxNTEgJiYgKHQyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUobjIgPj4gMTggJiA3IHwgMjQwLCBuMiA+PiAxMiAmIDYzIHwgMTI4LCBuMiA+PiA2ICYgNjMgfCAxMjgsIDYzICYgbjIgfCAxMjgpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9LCBvLnN0cmluZ2lmeSA9IGZ1bmN0aW9uIGUyKHQyKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHQyID09ICJzdHJpbmciKQogICAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgICBpZiAodDIgaW5zdGFuY2VvZiBBcnJheSkKICAgICAgICAgICAgcmV0dXJuICJbIiArIHQyLm1hcChlMikuam9pbigiLCAiKSArICJdIjsKICAgICAgICAgIGlmICh0MiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gIiIgKyB0MjsKICAgICAgICAgIGlmICh0Mi5vdmVycmlkZGVuTmFtZSkKICAgICAgICAgICAgcmV0dXJuICIiLmNvbmNhdCh0Mi5vdmVycmlkZGVuTmFtZSk7CiAgICAgICAgICBpZiAodDIubmFtZSkKICAgICAgICAgICAgcmV0dXJuICIiLmNvbmNhdCh0Mi5uYW1lKTsKICAgICAgICAgIGlmICghdDIudG9TdHJpbmcpCiAgICAgICAgICAgIHJldHVybiAib2JqZWN0IjsKICAgICAgICAgIGNvbnN0IHIyID0gdDIudG9TdHJpbmcoKTsKICAgICAgICAgIGlmIChyMiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gIiIgKyByMjsKICAgICAgICAgIGNvbnN0IG4yID0gcjIuaW5kZXhPZigiXG4iKTsKICAgICAgICAgIHJldHVybiBuMiA9PT0gLTEgPyByMiA6IHIyLnN1YnN0cmluZygwLCBuMik7CiAgICAgICAgfSwgby5yZXNvbHZlRm9yd2FyZFJlZiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGUyID09ICJmdW5jdGlvbiIgJiYgZTIuaGFzT3duUHJvcGVydHkoIl9fZm9yd2FyZF9yZWZfXyIpID8gZTIoKSA6IGUyOwogICAgICAgIH0sIG8uaXNQcm9taXNlID0gRDsKICAgICAgICBvLlZlcnNpb24gPSBjbGFzcyB7CiAgICAgICAgICBjb25zdHJ1Y3RvcihlMikgewogICAgICAgICAgICB0aGlzLmZ1bGwgPSBlMjsKICAgICAgICAgICAgY29uc3QgdDIgPSBlMi5zcGxpdCgiLiIpOwogICAgICAgICAgICB0aGlzLm1ham9yID0gdDJbMF0sIHRoaXMubWlub3IgPSB0MlsxXSwgdGhpcy5wYXRjaCA9IHQyLnNsaWNlKDIpLmpvaW4oIi4iKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNvbnN0IGYgPSB0eXBlb2Ygd2luZG93ICE9ICJ1bmRlZmluZWQiICYmIHdpbmRvdywgZCA9IHR5cGVvZiBzZWxmICE9ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBXb3JrZXJHbG9iYWxTY29wZSAhPSAidW5kZWZpbmVkIiAmJiBzZWxmIGluc3RhbmNlb2YgV29ya2VyR2xvYmFsU2NvcGUgJiYgc2VsZiwgZyA9IGUgIT09IHZvaWQgMCAmJiBlIHx8IGYgfHwgZDsKICAgICAgICBvLmdsb2JhbCA9IGcsIGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgICAgIGNvbnN0IHQyID0gaSwgcjIgPSBvLCBuMiA9IC9eKD86KD86XFsoW15cXV0rKVxdKXwoPzpcKChbXlwpXSspXCkpKXwoXEBbLVx3XSspJC87CiAgICAgICAgICBmdW5jdGlvbiBzMihlMykgewogICAgICAgICAgICByZXR1cm4gZTMucmVwbGFjZSgvXFcvZywgIl8iKTsKICAgICAgICAgIH0KICAgICAgICAgIGUyLnNhbml0aXplSWRlbnRpZmllciA9IHMyOwogICAgICAgICAgbGV0IGEyID0gMDsKICAgICAgICAgIGZ1bmN0aW9uIHUyKGUzKSB7CiAgICAgICAgICAgIGlmICghZTMgfHwgIWUzLnJlZmVyZW5jZSkKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgY29uc3QgbjMgPSBlMy5yZWZlcmVuY2U7CiAgICAgICAgICAgIGlmIChuMyBpbnN0YW5jZW9mIHQyLlN0YXRpY1N5bWJvbCkKICAgICAgICAgICAgICByZXR1cm4gbjMubmFtZTsKICAgICAgICAgICAgaWYgKG4zLl9fYW5vbnltb3VzVHlwZSkKICAgICAgICAgICAgICByZXR1cm4gbjMuX19hbm9ueW1vdXNUeXBlOwogICAgICAgICAgICBsZXQgaTIgPSByMi5zdHJpbmdpZnkobjMpOwogICAgICAgICAgICByZXR1cm4gaTIuaW5kZXhPZigiKCIpID49IDAgPyAoaTIgPSAiYW5vbnltb3VzXyIuY29uY2F0KGEyKyspLCBuMy5fX2Fub255bW91c1R5cGUgPSBpMikgOiBpMiA9IHMyKGkyKSwgaTI7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgYzI7CiAgICAgICAgICBlMi5pZGVudGlmaWVyTmFtZSA9IHUyLCBlMi5pZGVudGlmaWVyTW9kdWxlVXJsID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgY29uc3QgbjMgPSBlMy5yZWZlcmVuY2U7CiAgICAgICAgICAgIHJldHVybiBuMyBpbnN0YW5jZW9mIHQyLlN0YXRpY1N5bWJvbCA/IG4zLmZpbGVQYXRoIDogIi4vIi5jb25jYXQocjIuc3RyaW5naWZ5KG4zKSk7CiAgICAgICAgICB9LCBlMi52aWV3Q2xhc3NOYW1lID0gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIHJldHVybiAiVmlld18iLmNvbmNhdCh1Mih7IHJlZmVyZW5jZTogZTMgfSksICJfIikuY29uY2F0KHQzKTsKICAgICAgICAgIH0sIGUyLnJlbmRlcmVyVHlwZU5hbWUgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gIlJlbmRlclR5cGVfIi5jb25jYXQodTIoeyByZWZlcmVuY2U6IGUzIH0pKTsKICAgICAgICAgIH0sIGUyLmhvc3RWaWV3Q2xhc3NOYW1lID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuICJIb3N0Vmlld18iLmNvbmNhdCh1Mih7IHJlZmVyZW5jZTogZTMgfSkpOwogICAgICAgICAgfSwgZTIuY29tcG9uZW50RmFjdG9yeU5hbWUgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gIiIuY29uY2F0KHUyKHsgcmVmZXJlbmNlOiBlMyB9KSwgIk5nRmFjdG9yeSIpOwogICAgICAgICAgfSwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgZTNbZTMuUGlwZSA9IDBdID0gIlBpcGUiLCBlM1tlMy5EaXJlY3RpdmUgPSAxXSA9ICJEaXJlY3RpdmUiLCBlM1tlMy5OZ01vZHVsZSA9IDJdID0gIk5nTW9kdWxlIiwgZTNbZTMuSW5qZWN0YWJsZSA9IDNdID0gIkluamVjdGFibGUiOwogICAgICAgICAgfShjMiA9IGUyLkNvbXBpbGVTdW1tYXJ5S2luZCB8fCAoZTIuQ29tcGlsZVN1bW1hcnlLaW5kID0ge30pKSwgZTIudG9rZW5OYW1lID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzLnZhbHVlICE9IG51bGwgPyBzMihlMy52YWx1ZSkgOiB1MihlMy5pZGVudGlmaWVyKTsKICAgICAgICAgIH0sIGUyLnRva2VuUmVmZXJlbmNlID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzLmlkZW50aWZpZXIgIT0gbnVsbCA/IGUzLmlkZW50aWZpZXIucmVmZXJlbmNlIDogZTMudmFsdWU7CiAgICAgICAgICB9OwogICAgICAgICAgZTIuQ29tcGlsZVN0eWxlc2hlZXRNZXRhZGF0YSA9IGNsYXNzIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgICAgbGV0IHsgbW9kdWxlVXJsOiBlMywgc3R5bGVzOiB0Mywgc3R5bGVVcmxzOiByMyB9ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgICAgICAgICB0aGlzLm1vZHVsZVVybCA9IGUzIHx8IG51bGwsIHRoaXMuc3R5bGVzID0gcDIodDMpLCB0aGlzLnN0eWxlVXJscyA9IHAyKHIzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIGUyLkNvbXBpbGVUZW1wbGF0ZU1ldGFkYXRhID0gY2xhc3MgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihlMykgewogICAgICAgICAgICAgIGxldCB7IGVuY2Fwc3VsYXRpb246IHQzLCB0ZW1wbGF0ZTogcjMsIHRlbXBsYXRlVXJsOiBuMywgaHRtbEFzdDogaTIsIHN0eWxlczogczMsIHN0eWxlVXJsczogbzIsIGV4dGVybmFsU3R5bGVzaGVldHM6IGEzLCBhbmltYXRpb25zOiB1MywgbmdDb250ZW50U2VsZWN0b3JzOiBjMywgaW50ZXJwb2xhdGlvbjogbDMsIGlzSW5saW5lOiBEMywgcHJlc2VydmVXaGl0ZXNwYWNlczogZjIgfSA9IGUzOwogICAgICAgICAgICAgIGlmICh0aGlzLmVuY2Fwc3VsYXRpb24gPSB0MywgdGhpcy50ZW1wbGF0ZSA9IHIzLCB0aGlzLnRlbXBsYXRlVXJsID0gbjMsIHRoaXMuaHRtbEFzdCA9IGkyLCB0aGlzLnN0eWxlcyA9IHAyKHMzKSwgdGhpcy5zdHlsZVVybHMgPSBwMihvMiksIHRoaXMuZXh0ZXJuYWxTdHlsZXNoZWV0cyA9IHAyKGEzKSwgdGhpcy5hbmltYXRpb25zID0gdTMgPyBoMih1MykgOiBbXSwgdGhpcy5uZ0NvbnRlbnRTZWxlY3RvcnMgPSBjMyB8fCBbXSwgbDMgJiYgbDMubGVuZ3RoICE9IDIpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIidpbnRlcnBvbGF0aW9uJyBzaG91bGQgaGF2ZSBhIHN0YXJ0IGFuZCBhbiBlbmQgc3ltYm9sLiIpOwogICAgICAgICAgICAgIHRoaXMuaW50ZXJwb2xhdGlvbiA9IGwzLCB0aGlzLmlzSW5saW5lID0gRDMsIHRoaXMucHJlc2VydmVXaGl0ZXNwYWNlcyA9IGYyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvU3VtbWFyeSgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBuZ0NvbnRlbnRTZWxlY3RvcnM6IHRoaXMubmdDb250ZW50U2VsZWN0b3JzLCBlbmNhcHN1bGF0aW9uOiB0aGlzLmVuY2Fwc3VsYXRpb24sIHN0eWxlczogdGhpcy5zdHlsZXMsIGFuaW1hdGlvbnM6IHRoaXMuYW5pbWF0aW9ucyB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgY2xhc3MgbDIgewogICAgICAgICAgICBzdGF0aWMgY3JlYXRlKGUzKSB7CiAgICAgICAgICAgICAgbGV0IHsgaXNIb3N0OiB0MywgdHlwZTogaTIsIGlzQ29tcG9uZW50OiBzMywgc2VsZWN0b3I6IG8yLCBleHBvcnRBczogYTMsIGNoYW5nZURldGVjdGlvbjogdTMsIGlucHV0czogYzMsIG91dHB1dHM6IHAzLCBob3N0OiBoMywgcHJvdmlkZXJzOiBEMywgdmlld1Byb3ZpZGVyczogZjIsIHF1ZXJpZXM6IGQyLCBndWFyZHM6IGcyLCB2aWV3UXVlcmllczogbTIsIGVudHJ5Q29tcG9uZW50czogRTIsIHRlbXBsYXRlOiBDMiwgY29tcG9uZW50Vmlld1R5cGU6IHkyLCByZW5kZXJlclR5cGU6IGIyLCBjb21wb25lbnRGYWN0b3J5OiBTMiB9ID0gZTM7CiAgICAgICAgICAgICAgY29uc3QgVDIgPSB7fSwgXzIgPSB7fSwgdjIgPSB7fTsKICAgICAgICAgICAgICBoMyAhPSBudWxsICYmIE9iamVjdC5rZXlzKGgzKS5mb3JFYWNoKChlNCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdDQgPSBoM1tlNF0sIHIzID0gZTQubWF0Y2gobjIpOwogICAgICAgICAgICAgICAgcjMgPT09IG51bGwgPyB2MltlNF0gPSB0NCA6IHIzWzFdICE9IG51bGwgPyBfMltyM1sxXV0gPSB0NCA6IHIzWzJdICE9IG51bGwgJiYgKFQyW3IzWzJdXSA9IHQ0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBjb25zdCBBMiA9IHt9OwogICAgICAgICAgICAgIGMzICE9IG51bGwgJiYgYzMuZm9yRWFjaCgoZTQpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHQ0ID0gcjIuc3BsaXRBdENvbG9uKGU0LCBbZTQsIGU0XSk7CiAgICAgICAgICAgICAgICBBMlt0NFswXV0gPSB0NFsxXTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBjb25zdCBGMiA9IHt9OwogICAgICAgICAgICAgIHJldHVybiBwMyAhPSBudWxsICYmIHAzLmZvckVhY2goKGU0KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0NCA9IHIyLnNwbGl0QXRDb2xvbihlNCwgW2U0LCBlNF0pOwogICAgICAgICAgICAgICAgRjJbdDRbMF1dID0gdDRbMV07CiAgICAgICAgICAgICAgfSksIG5ldyBsMih7IGlzSG9zdDogdDMsIHR5cGU6IGkyLCBpc0NvbXBvbmVudDogISFzMywgc2VsZWN0b3I6IG8yLCBleHBvcnRBczogYTMsIGNoYW5nZURldGVjdGlvbjogdTMsIGlucHV0czogQTIsIG91dHB1dHM6IEYyLCBob3N0TGlzdGVuZXJzOiBUMiwgaG9zdFByb3BlcnRpZXM6IF8yLCBob3N0QXR0cmlidXRlczogdjIsIHByb3ZpZGVyczogRDMsIHZpZXdQcm92aWRlcnM6IGYyLCBxdWVyaWVzOiBkMiwgZ3VhcmRzOiBnMiwgdmlld1F1ZXJpZXM6IG0yLCBlbnRyeUNvbXBvbmVudHM6IEUyLCB0ZW1wbGF0ZTogQzIsIGNvbXBvbmVudFZpZXdUeXBlOiB5MiwgcmVuZGVyZXJUeXBlOiBiMiwgY29tcG9uZW50RmFjdG9yeTogUzIgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3RydWN0b3IoZTMpIHsKICAgICAgICAgICAgICBsZXQgeyBpc0hvc3Q6IHQzLCB0eXBlOiByMywgaXNDb21wb25lbnQ6IG4zLCBzZWxlY3RvcjogaTIsIGV4cG9ydEFzOiBzMywgY2hhbmdlRGV0ZWN0aW9uOiBvMiwgaW5wdXRzOiBhMywgb3V0cHV0czogdTMsIGhvc3RMaXN0ZW5lcnM6IGMzLCBob3N0UHJvcGVydGllczogbDMsIGhvc3RBdHRyaWJ1dGVzOiBoMywgcHJvdmlkZXJzOiBEMywgdmlld1Byb3ZpZGVyczogZjIsIHF1ZXJpZXM6IGQyLCBndWFyZHM6IGcyLCB2aWV3UXVlcmllczogbTIsIGVudHJ5Q29tcG9uZW50czogRTIsIHRlbXBsYXRlOiBDMiwgY29tcG9uZW50Vmlld1R5cGU6IHkyLCByZW5kZXJlclR5cGU6IGIyLCBjb21wb25lbnRGYWN0b3J5OiBTMiB9ID0gZTM7CiAgICAgICAgICAgICAgdGhpcy5pc0hvc3QgPSAhIXQzLCB0aGlzLnR5cGUgPSByMywgdGhpcy5pc0NvbXBvbmVudCA9IG4zLCB0aGlzLnNlbGVjdG9yID0gaTIsIHRoaXMuZXhwb3J0QXMgPSBzMywgdGhpcy5jaGFuZ2VEZXRlY3Rpb24gPSBvMiwgdGhpcy5pbnB1dHMgPSBhMywgdGhpcy5vdXRwdXRzID0gdTMsIHRoaXMuaG9zdExpc3RlbmVycyA9IGMzLCB0aGlzLmhvc3RQcm9wZXJ0aWVzID0gbDMsIHRoaXMuaG9zdEF0dHJpYnV0ZXMgPSBoMywgdGhpcy5wcm92aWRlcnMgPSBwMihEMyksIHRoaXMudmlld1Byb3ZpZGVycyA9IHAyKGYyKSwgdGhpcy5xdWVyaWVzID0gcDIoZDIpLCB0aGlzLmd1YXJkcyA9IGcyLCB0aGlzLnZpZXdRdWVyaWVzID0gcDIobTIpLCB0aGlzLmVudHJ5Q29tcG9uZW50cyA9IHAyKEUyKSwgdGhpcy50ZW1wbGF0ZSA9IEMyLCB0aGlzLmNvbXBvbmVudFZpZXdUeXBlID0geTIsIHRoaXMucmVuZGVyZXJUeXBlID0gYjIsIHRoaXMuY29tcG9uZW50RmFjdG9yeSA9IFMyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvU3VtbWFyeSgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBzdW1tYXJ5S2luZDogYzIuRGlyZWN0aXZlLCB0eXBlOiB0aGlzLnR5cGUsIGlzQ29tcG9uZW50OiB0aGlzLmlzQ29tcG9uZW50LCBzZWxlY3RvcjogdGhpcy5zZWxlY3RvciwgZXhwb3J0QXM6IHRoaXMuZXhwb3J0QXMsIGlucHV0czogdGhpcy5pbnB1dHMsIG91dHB1dHM6IHRoaXMub3V0cHV0cywgaG9zdExpc3RlbmVyczogdGhpcy5ob3N0TGlzdGVuZXJzLCBob3N0UHJvcGVydGllczogdGhpcy5ob3N0UHJvcGVydGllcywgaG9zdEF0dHJpYnV0ZXM6IHRoaXMuaG9zdEF0dHJpYnV0ZXMsIHByb3ZpZGVyczogdGhpcy5wcm92aWRlcnMsIHZpZXdQcm92aWRlcnM6IHRoaXMudmlld1Byb3ZpZGVycywgcXVlcmllczogdGhpcy5xdWVyaWVzLCBndWFyZHM6IHRoaXMuZ3VhcmRzLCB2aWV3UXVlcmllczogdGhpcy52aWV3UXVlcmllcywgZW50cnlDb21wb25lbnRzOiB0aGlzLmVudHJ5Q29tcG9uZW50cywgY2hhbmdlRGV0ZWN0aW9uOiB0aGlzLmNoYW5nZURldGVjdGlvbiwgdGVtcGxhdGU6IHRoaXMudGVtcGxhdGUgJiYgdGhpcy50ZW1wbGF0ZS50b1N1bW1hcnkoKSwgY29tcG9uZW50Vmlld1R5cGU6IHRoaXMuY29tcG9uZW50Vmlld1R5cGUsIHJlbmRlcmVyVHlwZTogdGhpcy5yZW5kZXJlclR5cGUsIGNvbXBvbmVudEZhY3Rvcnk6IHRoaXMuY29tcG9uZW50RmFjdG9yeSB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBlMi5Db21waWxlRGlyZWN0aXZlTWV0YWRhdGEgPSBsMjsKICAgICAgICAgIGUyLkNvbXBpbGVQaXBlTWV0YWRhdGEgPSBjbGFzcyB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGUzKSB7CiAgICAgICAgICAgICAgbGV0IHsgdHlwZTogdDMsIG5hbWU6IHIzLCBwdXJlOiBuMyB9ID0gZTM7CiAgICAgICAgICAgICAgdGhpcy50eXBlID0gdDMsIHRoaXMubmFtZSA9IHIzLCB0aGlzLnB1cmUgPSAhIW4zOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvU3VtbWFyeSgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBzdW1tYXJ5S2luZDogYzIuUGlwZSwgdHlwZTogdGhpcy50eXBlLCBuYW1lOiB0aGlzLm5hbWUsIHB1cmU6IHRoaXMucHVyZSB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgZTIuQ29tcGlsZVNoYWxsb3dNb2R1bGVNZXRhZGF0YSA9IGNsYXNzIHsKICAgICAgICAgIH07CiAgICAgICAgICBlMi5Db21waWxlTmdNb2R1bGVNZXRhZGF0YSA9IGNsYXNzIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoZTMpIHsKICAgICAgICAgICAgICBsZXQgeyB0eXBlOiB0MywgcHJvdmlkZXJzOiByMywgZGVjbGFyZWREaXJlY3RpdmVzOiBuMywgZXhwb3J0ZWREaXJlY3RpdmVzOiBpMiwgZGVjbGFyZWRQaXBlczogczMsIGV4cG9ydGVkUGlwZXM6IG8yLCBlbnRyeUNvbXBvbmVudHM6IGEzLCBib290c3RyYXBDb21wb25lbnRzOiB1MywgaW1wb3J0ZWRNb2R1bGVzOiBjMywgZXhwb3J0ZWRNb2R1bGVzOiBsMywgc2NoZW1hczogaDMsIHRyYW5zaXRpdmVNb2R1bGU6IEQzLCBpZDogZjIgfSA9IGUzOwogICAgICAgICAgICAgIHRoaXMudHlwZSA9IHQzIHx8IG51bGwsIHRoaXMuZGVjbGFyZWREaXJlY3RpdmVzID0gcDIobjMpLCB0aGlzLmV4cG9ydGVkRGlyZWN0aXZlcyA9IHAyKGkyKSwgdGhpcy5kZWNsYXJlZFBpcGVzID0gcDIoczMpLCB0aGlzLmV4cG9ydGVkUGlwZXMgPSBwMihvMiksIHRoaXMucHJvdmlkZXJzID0gcDIocjMpLCB0aGlzLmVudHJ5Q29tcG9uZW50cyA9IHAyKGEzKSwgdGhpcy5ib290c3RyYXBDb21wb25lbnRzID0gcDIodTMpLCB0aGlzLmltcG9ydGVkTW9kdWxlcyA9IHAyKGMzKSwgdGhpcy5leHBvcnRlZE1vZHVsZXMgPSBwMihsMyksIHRoaXMuc2NoZW1hcyA9IHAyKGgzKSwgdGhpcy5pZCA9IGYyIHx8IG51bGwsIHRoaXMudHJhbnNpdGl2ZU1vZHVsZSA9IEQzIHx8IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG9TdW1tYXJ5KCkgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy50cmFuc2l0aXZlTW9kdWxlOwogICAgICAgICAgICAgIHJldHVybiB7IHN1bW1hcnlLaW5kOiBjMi5OZ01vZHVsZSwgdHlwZTogdGhpcy50eXBlLCBlbnRyeUNvbXBvbmVudHM6IGUzLmVudHJ5Q29tcG9uZW50cywgcHJvdmlkZXJzOiBlMy5wcm92aWRlcnMsIG1vZHVsZXM6IGUzLm1vZHVsZXMsIGV4cG9ydGVkRGlyZWN0aXZlczogZTMuZXhwb3J0ZWREaXJlY3RpdmVzLCBleHBvcnRlZFBpcGVzOiBlMy5leHBvcnRlZFBpcGVzIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgICBmdW5jdGlvbiBwMihlMykgewogICAgICAgICAgICByZXR1cm4gZTMgfHwgW107CiAgICAgICAgICB9CiAgICAgICAgICBlMi5UcmFuc2l0aXZlQ29tcGlsZU5nTW9kdWxlTWV0YWRhdGEgPSBjbGFzcyB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICAgIHRoaXMuZGlyZWN0aXZlc1NldCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCksIHRoaXMuZGlyZWN0aXZlcyA9IFtdLCB0aGlzLmV4cG9ydGVkRGlyZWN0aXZlc1NldCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCksIHRoaXMuZXhwb3J0ZWREaXJlY3RpdmVzID0gW10sIHRoaXMucGlwZXNTZXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCB0aGlzLnBpcGVzID0gW10sIHRoaXMuZXhwb3J0ZWRQaXBlc1NldCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCksIHRoaXMuZXhwb3J0ZWRQaXBlcyA9IFtdLCB0aGlzLm1vZHVsZXNTZXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCB0aGlzLm1vZHVsZXMgPSBbXSwgdGhpcy5lbnRyeUNvbXBvbmVudHNTZXQgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpLCB0aGlzLmVudHJ5Q29tcG9uZW50cyA9IFtdLCB0aGlzLnByb3ZpZGVycyA9IFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFkZFByb3ZpZGVyKGUzLCB0MykgewogICAgICAgICAgICAgIHRoaXMucHJvdmlkZXJzLnB1c2goeyBwcm92aWRlcjogZTMsIG1vZHVsZTogdDMgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkRGlyZWN0aXZlKGUzKSB7CiAgICAgICAgICAgICAgdGhpcy5kaXJlY3RpdmVzU2V0LmhhcyhlMy5yZWZlcmVuY2UpIHx8ICh0aGlzLmRpcmVjdGl2ZXNTZXQuYWRkKGUzLnJlZmVyZW5jZSksIHRoaXMuZGlyZWN0aXZlcy5wdXNoKGUzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkRXhwb3J0ZWREaXJlY3RpdmUoZTMpIHsKICAgICAgICAgICAgICB0aGlzLmV4cG9ydGVkRGlyZWN0aXZlc1NldC5oYXMoZTMucmVmZXJlbmNlKSB8fCAodGhpcy5leHBvcnRlZERpcmVjdGl2ZXNTZXQuYWRkKGUzLnJlZmVyZW5jZSksIHRoaXMuZXhwb3J0ZWREaXJlY3RpdmVzLnB1c2goZTMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZGRQaXBlKGUzKSB7CiAgICAgICAgICAgICAgdGhpcy5waXBlc1NldC5oYXMoZTMucmVmZXJlbmNlKSB8fCAodGhpcy5waXBlc1NldC5hZGQoZTMucmVmZXJlbmNlKSwgdGhpcy5waXBlcy5wdXNoKGUzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkRXhwb3J0ZWRQaXBlKGUzKSB7CiAgICAgICAgICAgICAgdGhpcy5leHBvcnRlZFBpcGVzU2V0LmhhcyhlMy5yZWZlcmVuY2UpIHx8ICh0aGlzLmV4cG9ydGVkUGlwZXNTZXQuYWRkKGUzLnJlZmVyZW5jZSksIHRoaXMuZXhwb3J0ZWRQaXBlcy5wdXNoKGUzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkTW9kdWxlKGUzKSB7CiAgICAgICAgICAgICAgdGhpcy5tb2R1bGVzU2V0LmhhcyhlMy5yZWZlcmVuY2UpIHx8ICh0aGlzLm1vZHVsZXNTZXQuYWRkKGUzLnJlZmVyZW5jZSksIHRoaXMubW9kdWxlcy5wdXNoKGUzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkRW50cnlDb21wb25lbnQoZTMpIHsKICAgICAgICAgICAgICB0aGlzLmVudHJ5Q29tcG9uZW50c1NldC5oYXMoZTMuY29tcG9uZW50VHlwZSkgfHwgKHRoaXMuZW50cnlDb21wb25lbnRzU2V0LmFkZChlMy5jb21wb25lbnRUeXBlKSwgdGhpcy5lbnRyeUNvbXBvbmVudHMucHVzaChlMykpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgZnVuY3Rpb24gaDIoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzLnJlZHVjZSgoZTQsIHQzKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgcjMgPSBBcnJheS5pc0FycmF5KHQzKSA/IGgyKHQzKSA6IHQzOwogICAgICAgICAgICAgIHJldHVybiBlNC5jb25jYXQocjMpOwogICAgICAgICAgICB9LCBbXSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBEMihlMykgewogICAgICAgICAgICByZXR1cm4gZTMucmVwbGFjZSgvKFx3KzpcL1wvW1x3Oi1dKyk/KFwvKyk/LywgIm5nOi8vLyIpOwogICAgICAgICAgfQogICAgICAgICAgZTIuUHJvdmlkZXJNZXRhID0gY2xhc3MgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihlMywgdDMpIHsKICAgICAgICAgICAgICBsZXQgeyB1c2VDbGFzczogcjMsIHVzZVZhbHVlOiBuMywgdXNlRXhpc3Rpbmc6IGkyLCB1c2VGYWN0b3J5OiBzMywgZGVwczogbzIsIG11bHRpOiBhMyB9ID0gdDM7CiAgICAgICAgICAgICAgdGhpcy50b2tlbiA9IGUzLCB0aGlzLnVzZUNsYXNzID0gcjMgfHwgbnVsbCwgdGhpcy51c2VWYWx1ZSA9IG4zLCB0aGlzLnVzZUV4aXN0aW5nID0gaTIsIHRoaXMudXNlRmFjdG9yeSA9IHMzIHx8IG51bGwsIHRoaXMuZGVwZW5kZW5jaWVzID0gbzIgfHwgbnVsbCwgdGhpcy5tdWx0aSA9ICEhYTM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIGUyLmZsYXR0ZW4gPSBoMiwgZTIudGVtcGxhdGVTb3VyY2VVcmwgPSBmdW5jdGlvbihlMywgcjMsIG4zKSB7CiAgICAgICAgICAgIGxldCBpMjsKICAgICAgICAgICAgcmV0dXJuIGkyID0gbjMuaXNJbmxpbmUgPyByMy50eXBlLnJlZmVyZW5jZSBpbnN0YW5jZW9mIHQyLlN0YXRpY1N5bWJvbCA/ICIiLmNvbmNhdChyMy50eXBlLnJlZmVyZW5jZS5maWxlUGF0aCwgIi4iKS5jb25jYXQocjMudHlwZS5yZWZlcmVuY2UubmFtZSwgIi5odG1sIikgOiAiIi5jb25jYXQodTIoZTMpLCAiLyIpLmNvbmNhdCh1MihyMy50eXBlKSwgIi5odG1sIikgOiBuMy50ZW1wbGF0ZVVybCwgcjMudHlwZS5yZWZlcmVuY2UgaW5zdGFuY2VvZiB0Mi5TdGF0aWNTeW1ib2wgPyBpMiA6IEQyKGkyKTsKICAgICAgICAgIH0sIGUyLnNoYXJlZFN0eWxlc2hlZXRKaXRVcmwgPSBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgY29uc3QgcjMgPSBlMy5tb2R1bGVVcmwuc3BsaXQoL1wvXFwvZyksIG4zID0gcjNbcjMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIHJldHVybiBEMigiY3NzLyIuY29uY2F0KHQzKS5jb25jYXQobjMsICIubmdzdHlsZS5qcyIpKTsKICAgICAgICAgIH0sIGUyLm5nTW9kdWxlSml0VXJsID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIEQyKCIiLmNvbmNhdCh1MihlMy50eXBlKSwgIi9tb2R1bGUubmdmYWN0b3J5LmpzIikpOwogICAgICAgICAgfSwgZTIudGVtcGxhdGVKaXRVcmwgPSBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgcmV0dXJuIEQyKCIiLmNvbmNhdCh1MihlMyksICIvIikuY29uY2F0KHUyKHQzLnR5cGUpLCAiLm5nZmFjdG9yeS5qcyIpKTsKICAgICAgICAgIH07CiAgICAgICAgfShuKSwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgICAgY29uc3QgdDIgPSByLCBpMiA9IG47CiAgICAgICAgICBjbGFzcyBzMiB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGUzLCB0MywgcjIsIG4yKSB7CiAgICAgICAgICAgICAgdGhpcy5maWxlID0gZTMsIHRoaXMub2Zmc2V0ID0gdDMsIHRoaXMubGluZSA9IHIyLCB0aGlzLmNvbCA9IG4yOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvU3RyaW5nKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLm9mZnNldCAhPSBudWxsID8gIiIuY29uY2F0KHRoaXMuZmlsZS51cmwsICJAIikuY29uY2F0KHRoaXMubGluZSwgIjoiKS5jb25jYXQodGhpcy5jb2wpIDogdGhpcy5maWxlLnVybDsKICAgICAgICAgICAgfQogICAgICAgICAgICBtb3ZlQnkoZTMpIHsKICAgICAgICAgICAgICBjb25zdCByMiA9IHRoaXMuZmlsZS5jb250ZW50LCBuMiA9IHIyLmxlbmd0aDsKICAgICAgICAgICAgICBsZXQgaTMgPSB0aGlzLm9mZnNldCwgbzMgPSB0aGlzLmxpbmUsIGEzID0gdGhpcy5jb2w7CiAgICAgICAgICAgICAgZm9yICg7IGkzID4gMCAmJiBlMyA8IDA7ICkgewogICAgICAgICAgICAgICAgaTMtLSwgZTMrKzsKICAgICAgICAgICAgICAgIGlmIChyMi5jaGFyQ29kZUF0KGkzKSA9PSB0Mi4kTEYpIHsKICAgICAgICAgICAgICAgICAgbzMtLTsKICAgICAgICAgICAgICAgICAgY29uc3QgZTQgPSByMi5zdWJzdHIoMCwgaTMgLSAxKS5sYXN0SW5kZXhPZihTdHJpbmcuZnJvbUNoYXJDb2RlKHQyLiRMRikpOwogICAgICAgICAgICAgICAgICBhMyA9IGU0ID4gMCA/IGkzIC0gZTQgOiBpMzsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICBhMy0tOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmb3IgKDsgaTMgPCBuMiAmJiBlMyA+IDA7ICkgewogICAgICAgICAgICAgICAgY29uc3QgbjMgPSByMi5jaGFyQ29kZUF0KGkzKTsKICAgICAgICAgICAgICAgIGkzKyssIGUzLS0sIG4zID09IHQyLiRMRiA/IChvMysrLCBhMyA9IDApIDogYTMrKzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBzMih0aGlzLmZpbGUsIGkzLCBvMywgYTMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldENvbnRleHQoZTMsIHQzKSB7CiAgICAgICAgICAgICAgY29uc3QgcjIgPSB0aGlzLmZpbGUuY29udGVudDsKICAgICAgICAgICAgICBsZXQgbjIgPSB0aGlzLm9mZnNldDsKICAgICAgICAgICAgICBpZiAobjIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgbjIgPiByMi5sZW5ndGggLSAxICYmIChuMiA9IHIyLmxlbmd0aCAtIDEpOwogICAgICAgICAgICAgICAgbGV0IGkzID0gbjIsIHMzID0gMCwgbzMgPSAwOwogICAgICAgICAgICAgICAgZm9yICg7IHMzIDwgZTMgJiYgbjIgPiAwICYmIChuMi0tLCBzMysrLCByMltuMl0gIT0gIlxuIiB8fCArK28zICE9IHQzKTsgKQogICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICBmb3IgKHMzID0gMCwgbzMgPSAwOyBzMyA8IGUzICYmIGkzIDwgcjIubGVuZ3RoIC0gMSAmJiAoaTMrKywgczMrKywgcjJbaTNdICE9ICJcbiIgfHwgKytvMyAhPSB0Myk7ICkKICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgcmV0dXJuIHsgYmVmb3JlOiByMi5zdWJzdHJpbmcobjIsIHRoaXMub2Zmc2V0KSwgYWZ0ZXI6IHIyLnN1YnN0cmluZyh0aGlzLm9mZnNldCwgaTMgKyAxKSB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZTIuUGFyc2VMb2NhdGlvbiA9IHMyOwogICAgICAgICAgY2xhc3MgbzIgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihlMywgdDMpIHsKICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSBlMywgdGhpcy51cmwgPSB0MzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZTIuUGFyc2VTb3VyY2VGaWxlID0gbzI7CiAgICAgICAgICBjbGFzcyBhMiB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGUzLCB0MykgewogICAgICAgICAgICAgIGxldCByMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzJdIDogbnVsbDsKICAgICAgICAgICAgICB0aGlzLnN0YXJ0ID0gZTMsIHRoaXMuZW5kID0gdDMsIHRoaXMuZGV0YWlscyA9IHIyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvU3RyaW5nKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXJ0LmZpbGUuY29udGVudC5zdWJzdHJpbmcodGhpcy5zdGFydC5vZmZzZXQsIHRoaXMuZW5kLm9mZnNldCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHZhciB1MjsKICAgICAgICAgIGUyLlBhcnNlU291cmNlU3BhbiA9IGEyLCBlMi5FTVBUWV9QQVJTRV9MT0NBVElPTiA9IG5ldyBzMihuZXcgbzIoIiIsICIiKSwgMCwgMCwgMCksIGUyLkVNUFRZX1NPVVJDRV9TUEFOID0gbmV3IGEyKGUyLkVNUFRZX1BBUlNFX0xPQ0FUSU9OLCBlMi5FTVBUWV9QQVJTRV9MT0NBVElPTiksIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGUzW2UzLldBUk5JTkcgPSAwXSA9ICJXQVJOSU5HIiwgZTNbZTMuRVJST1IgPSAxXSA9ICJFUlJPUiI7CiAgICAgICAgICB9KHUyID0gZTIuUGFyc2VFcnJvckxldmVsIHx8IChlMi5QYXJzZUVycm9yTGV2ZWwgPSB7fSkpOwogICAgICAgICAgZTIuUGFyc2VFcnJvciA9IGNsYXNzIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoZTMsIHQzKSB7CiAgICAgICAgICAgICAgbGV0IHIyID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMl0gOiB1Mi5FUlJPUjsKICAgICAgICAgICAgICB0aGlzLnNwYW4gPSBlMywgdGhpcy5tc2cgPSB0MywgdGhpcy5sZXZlbCA9IHIyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRleHR1YWxNZXNzYWdlKCkgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5zcGFuLnN0YXJ0LmdldENvbnRleHQoMTAwLCAzKTsKICAgICAgICAgICAgICByZXR1cm4gZTMgPyAiIi5jb25jYXQodGhpcy5tc2csICcgKCInKS5jb25jYXQoZTMuYmVmb3JlLCAiWyIpLmNvbmNhdCh1Mlt0aGlzLmxldmVsXSwgIiAtPl0iKS5jb25jYXQoZTMuYWZ0ZXIsICciKScpIDogdGhpcy5tc2c7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLnNwYW4uZGV0YWlscyA/ICIsICIuY29uY2F0KHRoaXMuc3Bhbi5kZXRhaWxzKSA6ICIiOwogICAgICAgICAgICAgIHJldHVybiAiIi5jb25jYXQodGhpcy5jb250ZXh0dWFsTWVzc2FnZSgpLCAiOiAiKS5jb25jYXQodGhpcy5zcGFuLnN0YXJ0KS5jb25jYXQoZTMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCBlMi50eXBlU291cmNlU3BhbiA9IGZ1bmN0aW9uKGUzLCB0MykgewogICAgICAgICAgICBjb25zdCByMiA9IGkyLmlkZW50aWZpZXJNb2R1bGVVcmwodDMpLCBuMiA9IHIyICE9IG51bGwgPyAiaW4gIi5jb25jYXQoZTMsICIgIikuY29uY2F0KGkyLmlkZW50aWZpZXJOYW1lKHQzKSwgIiBpbiAiKS5jb25jYXQocjIpIDogImluICIuY29uY2F0KGUzLCAiICIpLmNvbmNhdChpMi5pZGVudGlmaWVyTmFtZSh0MykpLCB1MyA9IG5ldyBvMigiIiwgbjIpOwogICAgICAgICAgICByZXR1cm4gbmV3IGEyKG5ldyBzMih1MywgLTEsIC0xLCAtMSksIG5ldyBzMih1MywgLTEsIC0xLCAtMSkpOwogICAgICAgICAgfSwgZTIucjNKaXRUeXBlU291cmNlU3BhbiA9IGZ1bmN0aW9uKGUzLCB0MywgcjIpIHsKICAgICAgICAgICAgY29uc3QgbjIgPSAiaW4gIi5jb25jYXQoZTMsICIgIikuY29uY2F0KHQzLCAiIGluICIpLmNvbmNhdChyMiksIGkzID0gbmV3IG8yKCIiLCBuMik7CiAgICAgICAgICAgIHJldHVybiBuZXcgYTIobmV3IHMyKGkzLCAtMSwgLTEsIC0xKSwgbmV3IHMyKGkzLCAtMSwgLTEsIC0xKSk7CiAgICAgICAgICB9OwogICAgICAgIH0odCk7CiAgICAgICAgY29uc3QgbSA9IG5ldyBSZWdFeHAoIl4oPzxzdGFydERlbGltaXRlcj4tezN9fFxcK3szfSkoPzxsYW5ndWFnZT5bXlxcbl0qKVxcbig/OnwoPzx2YWx1ZT4uKj8pXFxuKSg/PGVuZERlbGltaXRlcj5cXGs8c3RhcnREZWxpbWl0ZXI+fFxcLnszfSlbXlxcU1xcbl0qKD86XFxufCQpIiwgInMiKTsKICAgICAgICB2YXIgRSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyLm1hdGNoKG0pOwogICAgICAgICAgaWYgKCF0MikKICAgICAgICAgICAgcmV0dXJuIHsgY29udGVudDogZTIgfTsKICAgICAgICAgIGNvbnN0IHsgc3RhcnREZWxpbWl0ZXI6IHIyLCBsYW5ndWFnZTogbjIsIHZhbHVlOiBpMiA9ICIiLCBlbmREZWxpbWl0ZXI6IHMyIH0gPSB0Mi5ncm91cHM7CiAgICAgICAgICBsZXQgbzIgPSBuMi50cmltKCkgfHwgInlhbWwiOwogICAgICAgICAgaWYgKHIyID09PSAiKysrIiAmJiAobzIgPSAidG9tbCIpLCBvMiAhPT0gInlhbWwiICYmIHIyICE9PSBzMikKICAgICAgICAgICAgcmV0dXJuIHsgY29udGVudDogZTIgfTsKICAgICAgICAgIGNvbnN0IFthMl0gPSB0MjsKICAgICAgICAgIHJldHVybiB7IGZyb250TWF0dGVyOiB7IHR5cGU6ICJmcm9udC1tYXR0ZXIiLCBsYW5nOiBvMiwgdmFsdWU6IGkyLCBzdGFydERlbGltaXRlcjogcjIsIGVuZERlbGltaXRlcjogczIsIHJhdzogYTIucmVwbGFjZSgvXG4kLywgIiIpIH0sIGNvbnRlbnQ6IGEyLnJlcGxhY2UoL1teXG5dL2csICIgIikgKyBlMi5zbGljZShhMi5sZW5ndGgpIH07CiAgICAgICAgfTsKICAgICAgICB2YXIgQyA9IChlMikgPT4gZTJbZTIubGVuZ3RoIC0gMV07CiAgICAgICAgdmFyIHkgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gbmV3IFN5bnRheEVycm9yKGUyICsgIiAoIiArIHQyLnN0YXJ0LmxpbmUgKyAiOiIgKyB0Mi5zdGFydC5jb2x1bW4gKyAiKSIpOwogICAgICAgICAgcmV0dXJuIHIyLmxvYyA9IHQyLCByMjsKICAgICAgICB9LCBiID0geyBleHBvcnRzOiB7fSB9OwogICAgICAgIGNvbnN0IFMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGxldCB7IG9ubHlGaXJzdDogZTIgPSBmYWxzZSB9ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgICAgIGNvbnN0IHQyID0gWyJbXFx1MDAxQlxcdTAwOUJdW1tcXF0oKSM7P10qKD86KD86KD86KD86O1stYS16QS1aXFxkXFwvIyYuOj0/JUB+X10rKSp8W2EtekEtWlxcZF0rKD86O1stYS16QS1aXFxkXFwvIyYuOj0/JUB+X10qKSopP1xcdTAwMDcpIiwgIig/Oig/OlxcZHsxLDR9KD86O1xcZHswLDR9KSopP1tcXGRBLVBSLVRaY2YtbnRxcnk9Pjx+XSkpIl0uam9pbigifCIpOwogICAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAodDIsIGUyID8gdm9pZCAwIDogImciKTsKICAgICAgICB9OwogICAgICAgIHZhciBUID0geyBleHBvcnRzOiB7fSB9OwogICAgICAgIGNvbnN0IF8gPSAoZTIpID0+ICFOdW1iZXIuaXNOYU4oZTIpICYmIChlMiA+PSA0MzUyICYmIChlMiA8PSA0NDQ3IHx8IGUyID09PSA5MDAxIHx8IGUyID09PSA5MDAyIHx8IDExOTA0IDw9IGUyICYmIGUyIDw9IDEyODcxICYmIGUyICE9PSAxMjM1MSB8fCAxMjg4MCA8PSBlMiAmJiBlMiA8PSAxOTkwMyB8fCAxOTk2OCA8PSBlMiAmJiBlMiA8PSA0MjE4MiB8fCA0MzM2MCA8PSBlMiAmJiBlMiA8PSA0MzM4OCB8fCA0NDAzMiA8PSBlMiAmJiBlMiA8PSA1NTIwMyB8fCA2Mzc0NCA8PSBlMiAmJiBlMiA8PSA2NDI1NSB8fCA2NTA0MCA8PSBlMiAmJiBlMiA8PSA2NTA0OSB8fCA2NTA3MiA8PSBlMiAmJiBlMiA8PSA2NTEzMSB8fCA2NTI4MSA8PSBlMiAmJiBlMiA8PSA2NTM3NiB8fCA2NTUwNCA8PSBlMiAmJiBlMiA8PSA2NTUxMCB8fCAxMTA1OTIgPD0gZTIgJiYgZTIgPD0gMTEwNTkzIHx8IDEyNzQ4OCA8PSBlMiAmJiBlMiA8PSAxMjc1NjkgfHwgMTMxMDcyIDw9IGUyICYmIGUyIDw9IDI2MjE0MSkpOwogICAgICAgIFQuZXhwb3J0cyA9IF8sIFQuZXhwb3J0cy5kZWZhdWx0ID0gXzsKICAgICAgICBjb25zdCB2ID0gKGUyKSA9PiB0eXBlb2YgZTIgPT0gInN0cmluZyIgPyBlMi5yZXBsYWNlKFMoKSwgIiIpIDogZTIsIEEgPSBULmV4cG9ydHMsIEYgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAvXHVEODNDXHVERkY0XHVEQjQwXHVEQzY3XHVEQjQwXHVEQzYyKD86XHVEQjQwXHVEQzY1XHVEQjQwXHVEQzZFXHVEQjQwXHVEQzY3fFx1REI0MFx1REM3M1x1REI0MFx1REM2M1x1REI0MFx1REM3NHxcdURCNDBcdURDNzdcdURCNDBcdURDNkNcdURCNDBcdURDNzMpXHVEQjQwXHVEQzdGfFx1RDgzRFx1REM2OCg/Olx1RDgzQ1x1REZGQ1x1MjAwRCg/Olx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRFx1REM2OFx1RDgzQ1x1REZGQnxcdUQ4M0NbXHVERjNFXHVERjczXHVERjkzXHVERkE0XHVERkE4XHVERkVCXHVERkVEXXxcdUQ4M0RbXHVEQ0JCXHVEQ0JDXHVERDI3XHVERDJDXHVERTgwXHVERTkyXXxcdUQ4M0VbXHVEREFGLVx1RERCM1x1RERCQ1x1RERCRF0pfFx1RDgzQ1x1REZGRlx1MjAwRCg/Olx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRFx1REM2OCg/Olx1RDgzQ1tcdURGRkItXHVERkZFXSl8XHVEODNDW1x1REYzRVx1REY3M1x1REY5M1x1REZBNFx1REZBOFx1REZFQlx1REZFRF18XHVEODNEW1x1RENCQlx1RENCQ1x1REQyN1x1REQyQ1x1REU4MFx1REU5Ml18XHVEODNFW1x1RERBRi1cdUREQjNcdUREQkNcdUREQkRdKXxcdUQ4M0NcdURGRkVcdTIwMEQoPzpcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0RcdURDNjgoPzpcdUQ4M0NbXHVERkZCLVx1REZGRF0pfFx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSl8XHVEODNDXHVERkZEXHUyMDBEKD86XHVEODNFXHVERDFEXHUyMDBEXHVEODNEXHVEQzY4KD86XHVEODNDW1x1REZGQlx1REZGQ10pfFx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSl8XHUyMDBEKD86XHUyNzY0XHVGRTBGXHUyMDBEKD86XHVEODNEXHVEQzhCXHUyMDBEKT9cdUQ4M0RcdURDNjh8KD86XHVEODNEW1x1REM2OFx1REM2OV0pXHUyMDBEKD86XHVEODNEXHVEQzY2XHUyMDBEXHVEODNEXHVEQzY2fFx1RDgzRFx1REM2N1x1MjAwRCg/Olx1RDgzRFtcdURDNjZcdURDNjddKSl8XHVEODNEXHVEQzY2XHUyMDBEXHVEODNEXHVEQzY2fFx1RDgzRFx1REM2N1x1MjAwRCg/Olx1RDgzRFtcdURDNjZcdURDNjddKXwoPzpcdUQ4M0RbXHVEQzY4XHVEQzY5XSlcdTIwMEQoPzpcdUQ4M0RbXHVEQzY2XHVEQzY3XSl8W1x1MjY5NVx1MjY5Nlx1MjcwOF1cdUZFMEZ8XHVEODNEW1x1REM2Nlx1REM2N118XHVEODNDW1x1REYzRVx1REY3M1x1REY5M1x1REZBNFx1REZBOFx1REZFQlx1REZFRF18XHVEODNEW1x1RENCQlx1RENCQ1x1REQyN1x1REQyQ1x1REU4MFx1REU5Ml18XHVEODNFW1x1RERBRi1cdUREQjNcdUREQkNcdUREQkRdKXwoPzpcdUQ4M0NcdURGRkJcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkZcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkVcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkRcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkNcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XSlcdUZFMEZ8XHVEODNDXHVERkZCXHUyMDBEKD86XHVEODNDW1x1REYzRVx1REY3M1x1REY5M1x1REZBNFx1REZBOFx1REZFQlx1REZFRF18XHVEODNEW1x1RENCQlx1RENCQ1x1REQyN1x1REQyQ1x1REU4MFx1REU5Ml18XHVEODNFW1x1RERBRi1cdUREQjNcdUREQkNcdUREQkRdKXxcdUQ4M0NbXHVERkZCLVx1REZGRl0pfCg/Olx1RDgzRVx1REREMVx1RDgzQ1x1REZGQlx1MjAwRFx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRVx1REREMXxcdUQ4M0RcdURDNjlcdUQ4M0NcdURGRkNcdTIwMERcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0RcdURDNjkpXHVEODNDXHVERkZCfFx1RDgzRVx1REREMSg/Olx1RDgzQ1x1REZGRlx1MjAwRFx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRVx1REREMSg/Olx1RDgzQ1tcdURGRkItXHVERkZGXSl8XHUyMDBEXHVEODNFXHVERDFEXHUyMDBEXHVEODNFXHVEREQxKXwoPzpcdUQ4M0VcdURERDFcdUQ4M0NcdURGRkVcdTIwMERcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0VcdURERDF8XHVEODNEXHVEQzY5XHVEODNDXHVERkZGXHUyMDBEXHVEODNFXHVERDFEXHUyMDBEKD86XHVEODNEW1x1REM2OFx1REM2OV0pKSg/Olx1RDgzQ1tcdURGRkItXHVERkZFXSl8KD86XHVEODNFXHVEREQxXHVEODNDXHVERkZDXHUyMDBEXHVEODNFXHVERDFEXHUyMDBEXHVEODNFXHVEREQxfFx1RDgzRFx1REM2OVx1RDgzQ1x1REZGRFx1MjAwRFx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRFx1REM2OSkoPzpcdUQ4M0NbXHVERkZCXHVERkZDXSl8XHVEODNEXHVEQzY5KD86XHVEODNDXHVERkZFXHUyMDBEKD86XHVEODNFXHVERDFEXHUyMDBEXHVEODNEXHVEQzY4KD86XHVEODNDW1x1REZGQi1cdURGRkRcdURGRkZdKXxcdUQ4M0NbXHVERjNFXHVERjczXHVERjkzXHVERkE0XHVERkE4XHVERkVCXHVERkVEXXxcdUQ4M0RbXHVEQ0JCXHVEQ0JDXHVERDI3XHVERDJDXHVERTgwXHVERTkyXXxcdUQ4M0VbXHVEREFGLVx1RERCM1x1RERCQ1x1RERCRF0pfFx1RDgzQ1x1REZGQ1x1MjAwRCg/Olx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRFx1REM2OCg/Olx1RDgzQ1tcdURGRkJcdURGRkQtXHVERkZGXSl8XHVEODNDW1x1REYzRVx1REY3M1x1REY5M1x1REZBNFx1REZBOFx1REZFQlx1REZFRF18XHVEODNEW1x1RENCQlx1RENCQ1x1REQyN1x1REQyQ1x1REU4MFx1REU5Ml18XHVEODNFW1x1RERBRi1cdUREQjNcdUREQkNcdUREQkRdKXxcdUQ4M0NcdURGRkJcdTIwMEQoPzpcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0RcdURDNjgoPzpcdUQ4M0NbXHVERkZDLVx1REZGRl0pfFx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSl8XHVEODNDXHVERkZEXHUyMDBEKD86XHVEODNFXHVERDFEXHUyMDBEXHVEODNEXHVEQzY4KD86XHVEODNDW1x1REZGQlx1REZGQ1x1REZGRVx1REZGRl0pfFx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSl8XHUyMDBEKD86XHUyNzY0XHVGRTBGXHUyMDBEKD86XHVEODNEXHVEQzhCXHUyMDBEKD86XHVEODNEW1x1REM2OFx1REM2OV0pfFx1RDgzRFtcdURDNjhcdURDNjldKXxcdUQ4M0NbXHVERjNFXHVERjczXHVERjkzXHVERkE0XHVERkE4XHVERkVCXHVERkVEXXxcdUQ4M0RbXHVEQ0JCXHVEQ0JDXHVERDI3XHVERDJDXHVERTgwXHVERTkyXXxcdUQ4M0VbXHVEREFGLVx1RERCM1x1RERCQ1x1RERCRF0pfFx1RDgzQ1x1REZGRlx1MjAwRCg/Olx1RDgzQ1tcdURGM0VcdURGNzNcdURGOTNcdURGQTRcdURGQThcdURGRUJcdURGRURdfFx1RDgzRFtcdURDQkJcdURDQkNcdUREMjdcdUREMkNcdURFODBcdURFOTJdfFx1RDgzRVtcdUREQUYtXHVEREIzXHVEREJDXHVEREJEXSkpfFx1RDgzRFx1REM2OVx1MjAwRFx1RDgzRFx1REM2OVx1MjAwRCg/Olx1RDgzRFx1REM2Nlx1MjAwRFx1RDgzRFx1REM2NnxcdUQ4M0RcdURDNjdcdTIwMEQoPzpcdUQ4M0RbXHVEQzY2XHVEQzY3XSkpfCg/Olx1RDgzRVx1REREMVx1RDgzQ1x1REZGRFx1MjAwRFx1RDgzRVx1REQxRFx1MjAwRFx1RDgzRVx1REREMXxcdUQ4M0RcdURDNjlcdUQ4M0NcdURGRkVcdTIwMERcdUQ4M0VcdUREMURcdTIwMERcdUQ4M0RcdURDNjkpKD86XHVEODNDW1x1REZGQi1cdURGRkRdKXxcdUQ4M0RcdURDNjlcdTIwMERcdUQ4M0RcdURDNjZcdTIwMERcdUQ4M0RcdURDNjZ8XHVEODNEXHVEQzY5XHUyMDBEXHVEODNEXHVEQzY5XHUyMDBEKD86XHVEODNEW1x1REM2Nlx1REM2N10pfCg/Olx1RDgzRFx1REM0MVx1RkUwRlx1MjAwRFx1RDgzRFx1RERFOHxcdUQ4M0RcdURDNjkoPzpcdUQ4M0NcdURGRkZcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkVcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkNcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkJcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdUQ4M0NcdURGRkRcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XXxcdTIwMERbXHUyNjk1XHUyNjk2XHUyNzA4XSl8KD86KD86XHUyNkY5fFx1RDgzQ1tcdURGQ0JcdURGQ0NdfFx1RDgzRFx1REQ3NSlcdUZFMEZ8XHVEODNEXHVEQzZGfFx1RDgzRVtcdUREM0NcdUREREVcdUREREZdKVx1MjAwRFtcdTI2NDBcdTI2NDJdfCg/Olx1MjZGOXxcdUQ4M0NbXHVERkNCXHVERkNDXXxcdUQ4M0RcdURENzUpKD86XHVEODNDW1x1REZGQi1cdURGRkZdKVx1MjAwRFtcdTI2NDBcdTI2NDJdfCg/Olx1RDgzQ1tcdURGQzNcdURGQzRcdURGQ0FdfFx1RDgzRFtcdURDNkVcdURDNzFcdURDNzNcdURDNzdcdURDODFcdURDODJcdURDODZcdURDODdcdURFNDUtXHVERTQ3XHVERTRCXHVERTREXHVERTRFXHVERUEzXHVERUI0LVx1REVCNl18XHVEODNFW1x1REQyNlx1REQzNy1cdUREMzlcdUREM0RcdUREM0VcdUREQjhcdUREQjlcdUREQ0QtXHVERENGXHVEREQ2LVx1RERERF0pKD86KD86XHVEODNDW1x1REZGQi1cdURGRkZdKVx1MjAwRFtcdTI2NDBcdTI2NDJdfFx1MjAwRFtcdTI2NDBcdTI2NDJdKXxcdUQ4M0NcdURGRjRcdTIwMERcdTI2MjApXHVGRTBGfFx1RDgzRFx1REM2OVx1MjAwRFx1RDgzRFx1REM2N1x1MjAwRCg/Olx1RDgzRFtcdURDNjZcdURDNjddKXxcdUQ4M0NcdURGRjNcdUZFMEZcdTIwMERcdUQ4M0NcdURGMDh8XHVEODNEXHVEQzE1XHUyMDBEXHVEODNFXHVEREJBfFx1RDgzRFx1REM2OVx1MjAwRFx1RDgzRFx1REM2NnxcdUQ4M0RcdURDNjlcdTIwMERcdUQ4M0RcdURDNjd8XHVEODNDXHVEREZEXHVEODNDXHVEREYwfFx1RDgzQ1x1RERGNFx1RDgzQ1x1RERGMnxcdUQ4M0NcdURERjZcdUQ4M0NcdURERTZ8WyNcKjAtOV1cdUZFMEZcdTIwRTN8XHVEODNDXHVEREU3KD86XHVEODNDW1x1RERFNlx1RERFN1x1RERFOS1cdURERUZcdURERjEtXHVEREY0XHVEREY2LVx1RERGOVx1RERGQlx1RERGQ1x1RERGRVx1RERGRl0pfFx1RDgzQ1x1RERGOSg/Olx1RDgzQ1tcdURERTZcdURERThcdURERTlcdURERUItXHVEREVEXHVEREVGLVx1RERGNFx1RERGN1x1RERGOVx1RERGQlx1RERGQ1x1RERGRl0pfFx1RDgzQ1x1RERFQSg/Olx1RDgzQ1tcdURERTZcdURERThcdURERUFcdURERUNcdURERURcdURERjctXHVEREZBXSl8XHVEODNFXHVEREQxKD86XHVEODNDW1x1REZGQi1cdURGRkZdKXxcdUQ4M0NcdURERjcoPzpcdUQ4M0NbXHVEREVBXHVEREY0XHVEREY4XHVEREZBXHVEREZDXSl8XHVEODNEXHVEQzY5KD86XHVEODNDW1x1REZGQi1cdURGRkZdKXxcdUQ4M0NcdURERjIoPzpcdUQ4M0NbXHVEREU2XHVEREU4LVx1RERFRFx1RERGMC1cdURERkZdKXxcdUQ4M0NcdURERTYoPzpcdUQ4M0NbXHVEREU4LVx1RERFQ1x1RERFRVx1RERGMVx1RERGMlx1RERGNFx1RERGNi1cdURERkFcdURERkNcdURERkRcdURERkZdKXxcdUQ4M0NcdURERjAoPzpcdUQ4M0NbXHVEREVBXHVEREVDLVx1RERFRVx1RERGMlx1RERGM1x1RERGNVx1RERGN1x1RERGQ1x1RERGRVx1RERGRl0pfFx1RDgzQ1x1RERFRCg/Olx1RDgzQ1tcdURERjBcdURERjJcdURERjNcdURERjdcdURERjlcdURERkFdKXxcdUQ4M0NcdURERTkoPzpcdUQ4M0NbXHVEREVBXHVEREVDXHVEREVGXHVEREYwXHVEREYyXHVEREY0XHVEREZGXSl8XHVEODNDXHVEREZFKD86XHVEODNDW1x1RERFQVx1RERGOV0pfFx1RDgzQ1x1RERFQyg/Olx1RDgzQ1tcdURERTZcdURERTdcdURERTktXHVEREVFXHVEREYxLVx1RERGM1x1RERGNS1cdURERkFcdURERkNcdURERkVdKXxcdUQ4M0NcdURERjgoPzpcdUQ4M0NbXHVEREU2LVx1RERFQVx1RERFQy1cdURERjRcdURERjctXHVEREY5XHVEREZCXHVEREZELVx1RERGRl0pfFx1RDgzQ1x1RERFQig/Olx1RDgzQ1tcdURERUUtXHVEREYwXHVEREYyXHVEREY0XHVEREY3XSl8XHVEODNDXHVEREY1KD86XHVEODNDW1x1RERFNlx1RERFQS1cdURERURcdURERjAtXHVEREYzXHVEREY3LVx1RERGOVx1RERGQ1x1RERGRV0pfFx1RDgzQ1x1RERGQig/Olx1RDgzQ1tcdURERTZcdURERThcdURERUFcdURERUNcdURERUVcdURERjNcdURERkFdKXxcdUQ4M0NcdURERjMoPzpcdUQ4M0NbXHVEREU2XHVEREU4XHVEREVBLVx1RERFQ1x1RERFRVx1RERGMVx1RERGNFx1RERGNVx1RERGN1x1RERGQVx1RERGRl0pfFx1RDgzQ1x1RERFOCg/Olx1RDgzQ1tcdURERTZcdURERThcdURERTlcdURERUItXHVEREVFXHVEREYwLVx1RERGNVx1RERGN1x1RERGQS1cdURERkZdKXxcdUQ4M0NcdURERjEoPzpcdUQ4M0NbXHVEREU2LVx1RERFOFx1RERFRVx1RERGMFx1RERGNy1cdURERkJcdURERkVdKXxcdUQ4M0NcdURERkYoPzpcdUQ4M0NbXHVEREU2XHVEREYyXHVEREZDXSl8XHVEODNDXHVEREZDKD86XHVEODNDW1x1RERFQlx1RERGOF0pfFx1RDgzQ1x1RERGQSg/Olx1RDgzQ1tcdURERTZcdURERUNcdURERjJcdURERjNcdURERjhcdURERkVcdURERkZdKXxcdUQ4M0NcdURERUUoPzpcdUQ4M0NbXHVEREU4LVx1RERFQVx1RERGMS1cdURERjRcdURERjYtXHVEREY5XSl8XHVEODNDXHVEREVGKD86XHVEODNDW1x1RERFQVx1RERGMlx1RERGNFx1RERGNV0pfCg/Olx1RDgzQ1tcdURGQzNcdURGQzRcdURGQ0FdfFx1RDgzRFtcdURDNkVcdURDNzFcdURDNzNcdURDNzdcdURDODFcdURDODJcdURDODZcdURDODdcdURFNDUtXHVERTQ3XHVERTRCXHVERTREXHVERTRFXHVERUEzXHVERUI0LVx1REVCNl18XHVEODNFW1x1REQyNlx1REQzNy1cdUREMzlcdUREM0RcdUREM0VcdUREQjhcdUREQjlcdUREQ0QtXHVERENGXHVEREQ2LVx1RERERF0pKD86XHVEODNDW1x1REZGQi1cdURGRkZdKXwoPzpcdTI2Rjl8XHVEODNDW1x1REZDQlx1REZDQ118XHVEODNEXHVERDc1KSg/Olx1RDgzQ1tcdURGRkItXHVERkZGXSl8KD86W1x1MjYxRFx1MjcwQS1cdTI3MERdfFx1RDgzQ1tcdURGODVcdURGQzJcdURGQzddfFx1RDgzRFtcdURDNDJcdURDNDNcdURDNDYtXHVEQzUwXHVEQzY2XHVEQzY3XHVEQzZCLVx1REM2RFx1REM3MFx1REM3Mlx1REM3NC1cdURDNzZcdURDNzhcdURDN0NcdURDODNcdURDODVcdURDQUFcdURENzRcdUREN0FcdUREOTBcdUREOTVcdUREOTZcdURFNENcdURFNEZcdURFQzBcdURFQ0NdfFx1RDgzRVtcdUREMEZcdUREMTgtXHVERDFDXHVERDFFXHVERDFGXHVERDMwLVx1REQzNlx1RERCNVx1RERCNlx1RERCQlx1REREMi1cdURERDVdKSg/Olx1RDgzQ1tcdURGRkItXHVERkZGXSl8KD86W1x1MjMxQVx1MjMxQlx1MjNFOS1cdTIzRUNcdTIzRjBcdTIzRjNcdTI1RkRcdTI1RkVcdTI2MTRcdTI2MTVcdTI2NDgtXHUyNjUzXHUyNjdGXHUyNjkzXHUyNkExXHUyNkFBXHUyNkFCXHUyNkJEXHUyNkJFXHUyNkM0XHUyNkM1XHUyNkNFXHUyNkQ0XHUyNkVBXHUyNkYyXHUyNkYzXHUyNkY1XHUyNkZBXHUyNkZEXHUyNzA1XHUyNzBBXHUyNzBCXHUyNzI4XHUyNzRDXHUyNzRFXHUyNzUzLVx1Mjc1NVx1Mjc1N1x1Mjc5NS1cdTI3OTdcdTI3QjBcdTI3QkZcdTJCMUJcdTJCMUNcdTJCNTBcdTJCNTVdfFx1RDgzQ1tcdURDMDRcdURDQ0ZcdUREOEVcdUREOTEtXHVERDlBXHVEREU2LVx1RERGRlx1REUwMVx1REUxQVx1REUyRlx1REUzMi1cdURFMzZcdURFMzgtXHVERTNBXHVERTUwXHVERTUxXHVERjAwLVx1REYyMFx1REYyRC1cdURGMzVcdURGMzctXHVERjdDXHVERjdFLVx1REY5M1x1REZBMC1cdURGQ0FcdURGQ0YtXHVERkQzXHVERkUwLVx1REZGMFx1REZGNFx1REZGOC1cdURGRkZdfFx1RDgzRFtcdURDMDAtXHVEQzNFXHVEQzQwXHVEQzQyLVx1RENGQ1x1RENGRi1cdUREM0RcdURENEItXHVERDRFXHVERDUwLVx1REQ2N1x1REQ3QVx1REQ5NVx1REQ5Nlx1RERBNFx1RERGQi1cdURFNEZcdURFODAtXHVERUM1XHVERUNDXHVERUQwLVx1REVEMlx1REVENVx1REVFQlx1REVFQ1x1REVGNC1cdURFRkFcdURGRTAtXHVERkVCXXxcdUQ4M0VbXHVERDBELVx1REQzQVx1REQzQy1cdURENDVcdURENDctXHVERDcxXHVERDczLVx1REQ3Nlx1REQ3QS1cdUREQTJcdUREQTUtXHVEREFBXHVEREFFLVx1RERDQVx1RERDRC1cdURERkZcdURFNzAtXHVERTczXHVERTc4LVx1REU3QVx1REU4MC1cdURFODJcdURFOTAtXHVERTk1XSl8KD86WyNcKjAtOVx4QTlceEFFXHUyMDNDXHUyMDQ5XHUyMTIyXHUyMTM5XHUyMTk0LVx1MjE5OVx1MjFBOVx1MjFBQVx1MjMxQVx1MjMxQlx1MjMyOFx1MjNDRlx1MjNFOS1cdTIzRjNcdTIzRjgtXHUyM0ZBXHUyNEMyXHUyNUFBXHUyNUFCXHUyNUI2XHUyNUMwXHUyNUZCLVx1MjVGRVx1MjYwMC1cdTI2MDRcdTI2MEVcdTI2MTFcdTI2MTRcdTI2MTVcdTI2MThcdTI2MURcdTI2MjBcdTI2MjJcdTI2MjNcdTI2MjZcdTI2MkFcdTI2MkVcdTI2MkZcdTI2MzgtXHUyNjNBXHUyNjQwXHUyNjQyXHUyNjQ4LVx1MjY1M1x1MjY1Rlx1MjY2MFx1MjY2M1x1MjY2NVx1MjY2Nlx1MjY2OFx1MjY3Qlx1MjY3RVx1MjY3Rlx1MjY5Mi1cdTI2OTdcdTI2OTlcdTI2OUJcdTI2OUNcdTI2QTBcdTI2QTFcdTI2QUFcdTI2QUJcdTI2QjBcdTI2QjFcdTI2QkRcdTI2QkVcdTI2QzRcdTI2QzVcdTI2QzhcdTI2Q0VcdTI2Q0ZcdTI2RDFcdTI2RDNcdTI2RDRcdTI2RTlcdTI2RUFcdTI2RjAtXHUyNkY1XHUyNkY3LVx1MjZGQVx1MjZGRFx1MjcwMlx1MjcwNVx1MjcwOC1cdTI3MERcdTI3MEZcdTI3MTJcdTI3MTRcdTI3MTZcdTI3MURcdTI3MjFcdTI3MjhcdTI3MzNcdTI3MzRcdTI3NDRcdTI3NDdcdTI3NENcdTI3NEVcdTI3NTMtXHUyNzU1XHUyNzU3XHUyNzYzXHUyNzY0XHUyNzk1LVx1Mjc5N1x1MjdBMVx1MjdCMFx1MjdCRlx1MjkzNFx1MjkzNVx1MkIwNS1cdTJCMDdcdTJCMUJcdTJCMUNcdTJCNTBcdTJCNTVcdTMwMzBcdTMwM0RcdTMyOTdcdTMyOTldfFx1RDgzQ1tcdURDMDRcdURDQ0ZcdURENzBcdURENzFcdUREN0VcdUREN0ZcdUREOEVcdUREOTEtXHVERDlBXHVEREU2LVx1RERGRlx1REUwMVx1REUwMlx1REUxQVx1REUyRlx1REUzMi1cdURFM0FcdURFNTBcdURFNTFcdURGMDAtXHVERjIxXHVERjI0LVx1REY5M1x1REY5Nlx1REY5N1x1REY5OS1cdURGOUJcdURGOUUtXHVERkYwXHVERkYzLVx1REZGNVx1REZGNy1cdURGRkZdfFx1RDgzRFtcdURDMDAtXHVEQ0ZEXHVEQ0ZGLVx1REQzRFx1REQ0OS1cdURENEVcdURENTAtXHVERDY3XHVERDZGXHVERDcwXHVERDczLVx1REQ3QVx1REQ4N1x1REQ4QS1cdUREOERcdUREOTBcdUREOTVcdUREOTZcdUREQTRcdUREQTVcdUREQThcdUREQjFcdUREQjJcdUREQkNcdUREQzItXHVEREM0XHVEREQxLVx1REREM1x1REREQy1cdUREREVcdURERTFcdURERTNcdURERThcdURERUZcdURERjNcdURERkEtXHVERTRGXHVERTgwLVx1REVDNVx1REVDQi1cdURFRDJcdURFRDVcdURFRTAtXHVERUU1XHVERUU5XHVERUVCXHVERUVDXHVERUYwXHVERUYzLVx1REVGQVx1REZFMC1cdURGRUJdfFx1RDgzRVtcdUREMEQtXHVERDNBXHVERDNDLVx1REQ0NVx1REQ0Ny1cdURENzFcdURENzMtXHVERDc2XHVERDdBLVx1RERBMlx1RERBNS1cdUREQUFcdUREQUUtXHVERENBXHVERENELVx1RERGRlx1REU3MC1cdURFNzNcdURFNzgtXHVERTdBXHVERTgwLVx1REU4Mlx1REU5MC1cdURFOTVdKVx1RkUwRnwoPzpbXHUyNjFEXHUyNkY5XHUyNzBBLVx1MjcwRF18XHVEODNDW1x1REY4NVx1REZDMi1cdURGQzRcdURGQzdcdURGQ0EtXHVERkNDXXxcdUQ4M0RbXHVEQzQyXHVEQzQzXHVEQzQ2LVx1REM1MFx1REM2Ni1cdURDNzhcdURDN0NcdURDODEtXHVEQzgzXHVEQzg1LVx1REM4N1x1REM4Rlx1REM5MVx1RENBQVx1REQ3NFx1REQ3NVx1REQ3QVx1REQ5MFx1REQ5NVx1REQ5Nlx1REU0NS1cdURFNDdcdURFNEItXHVERTRGXHVERUEzXHVERUI0LVx1REVCNlx1REVDMFx1REVDQ118XHVEODNFW1x1REQwRlx1REQxOC1cdUREMUZcdUREMjZcdUREMzAtXHVERDM5XHVERDNDLVx1REQzRVx1RERCNVx1RERCNlx1RERCOFx1RERCOVx1RERCQlx1RERDRC1cdUREQ0ZcdURERDEtXHVEREREXSkvZzsKICAgICAgICB9LCB3ID0gKGUyKSA9PiB7CiAgICAgICAgICBpZiAodHlwZW9mIGUyICE9ICJzdHJpbmciIHx8IGUyLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICBpZiAoKGUyID0gdihlMikpLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICBlMiA9IGUyLnJlcGxhY2UoRigpLCAiICAiKTsKICAgICAgICAgIGxldCB0MiA9IDA7CiAgICAgICAgICBmb3IgKGxldCByMiA9IDA7IHIyIDwgZTIubGVuZ3RoOyByMisrKSB7CiAgICAgICAgICAgIGNvbnN0IG4yID0gZTIuY29kZVBvaW50QXQocjIpOwogICAgICAgICAgICBuMiA8PSAzMSB8fCBuMiA+PSAxMjcgJiYgbjIgPD0gMTU5IHx8IChuMiA+PSA3NjggJiYgbjIgPD0gODc5IHx8IChuMiA+IDY1NTM1ICYmIHIyKyssIHQyICs9IEEobjIpID8gMiA6IDEpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9OwogICAgICAgIGIuZXhwb3J0cyA9IHcsIGIuZXhwb3J0cy5kZWZhdWx0ID0gdzsKICAgICAgICBmdW5jdGlvbiBrKGUyLCB0MikgewogICAgICAgICAgaWYgKGUyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICAgIHZhciByMiwgbjIsIGkyID0gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIGlmIChlMyA9PSBudWxsKQogICAgICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICAgICAgdmFyIHIzLCBuMywgaTMgPSB7fSwgczMgPSBPYmplY3Qua2V5cyhlMyk7CiAgICAgICAgICAgIGZvciAobjMgPSAwOyBuMyA8IHMzLmxlbmd0aDsgbjMrKykKICAgICAgICAgICAgICByMyA9IHMzW24zXSwgdDMuaW5kZXhPZihyMykgPj0gMCB8fCAoaTNbcjNdID0gZTNbcjNdKTsKICAgICAgICAgICAgcmV0dXJuIGkzOwogICAgICAgICAgfShlMiwgdDIpOwogICAgICAgICAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgICAgICAgICAgdmFyIHMyID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlMik7CiAgICAgICAgICAgIGZvciAobjIgPSAwOyBuMiA8IHMyLmxlbmd0aDsgbjIrKykKICAgICAgICAgICAgICByMiA9IHMyW24yXSwgdDIuaW5kZXhPZihyMikgPj0gMCB8fCBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoZTIsIHIyKSAmJiAoaTJbcjJdID0gZTJbcjJdKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gTihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB0MiB8fCAodDIgPSBlMi5zbGljZSgwKSksIE9iamVjdC5mcmVlemUoT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZTIsIHsgcmF3OiB7IHZhbHVlOiBPYmplY3QuZnJlZXplKHQyKSB9IH0pKTsKICAgICAgICB9CiAgICAgICAgdmFyIE8gPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyICYmIGUyLk1hdGggPT0gTWF0aCAmJiBlMjsKICAgICAgICB9LCB4ID0gTyh0eXBlb2YgZ2xvYmFsVGhpcyA9PSAib2JqZWN0IiAmJiBnbG9iYWxUaGlzKSB8fCBPKHR5cGVvZiB3aW5kb3cgPT0gIm9iamVjdCIgJiYgd2luZG93KSB8fCBPKHR5cGVvZiBzZWxmID09ICJvYmplY3QiICYmIHNlbGYpIHx8IE8odHlwZW9mIGUgPT0gIm9iamVjdCIgJiYgZSkgfHwgZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9KCkgfHwgRnVuY3Rpb24oInJldHVybiB0aGlzIikoKSwgSSA9IHt9LCBQID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAhIWUyKCk7CiAgICAgICAgICB9IGNhdGNoIChlMykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9LCBSID0gIVAoZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAxLCB7IGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiA3OwogICAgICAgICAgfSB9KVsxXSAhPSA3OwogICAgICAgIH0pLCBMID0gRnVuY3Rpb24ucHJvdG90eXBlLmNhbGwsIEIgPSBMLmJpbmQgPyBMLmJpbmQoTCkgOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBMLmFwcGx5KEwsIGFyZ3VtZW50cyk7CiAgICAgICAgfSwgcSA9IHt9LCAkID0ge30ucHJvcGVydHlJc0VudW1lcmFibGUsIE0gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLCBqID0gTSAmJiAhJC5jYWxsKHsgMTogMiB9LCAxKTsKICAgICAgICBxLmYgPSBqID8gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IE0odGhpcywgZTIpOwogICAgICAgICAgcmV0dXJuICEhdDIgJiYgdDIuZW51bWVyYWJsZTsKICAgICAgICB9IDogJDsKICAgICAgICB2YXIgVSwgRywgViA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHsgZW51bWVyYWJsZTogISgxICYgZTIpLCBjb25maWd1cmFibGU6ICEoMiAmIGUyKSwgd3JpdGFibGU6ICEoNCAmIGUyKSwgdmFsdWU6IHQyIH07CiAgICAgICAgfSwgWCA9IEZ1bmN0aW9uLnByb3RvdHlwZSwgSCA9IFguYmluZCwgeiA9IFguY2FsbCwgVyA9IEggJiYgSC5iaW5kKHopLCBZID0gSCA/IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgVyh6LCBlMik7CiAgICAgICAgfSA6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgJiYgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB6LmFwcGx5KGUyLCBhcmd1bWVudHMpOwogICAgICAgICAgfTsKICAgICAgICB9LCBRID0gWSwgSiA9IFEoe30udG9TdHJpbmcpLCBaID0gUSgiIi5zbGljZSksIEsgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFooSihlMiksIDgsIC0xKTsKICAgICAgICB9LCBlZSA9IFksIHRlID0gUCwgcmUgPSBLLCBuZSA9IHguT2JqZWN0LCBpZSA9IGVlKCIiLnNwbGl0KSwgc2UgPSB0ZShmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAhbmUoInoiKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKTsKICAgICAgICB9KSA/IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gcmUoZTIpID09ICJTdHJpbmciID8gaWUoZTIsICIiKSA6IG5lKGUyKTsKICAgICAgICB9IDogbmUsIG9lID0geC5UeXBlRXJyb3IsIGFlID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGlmIChlMiA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBvZSgiQ2FuJ3QgY2FsbCBtZXRob2Qgb24gIiArIGUyKTsKICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICB9LCB1ZSA9IHNlLCBjZSA9IGFlLCBsZSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gdWUoY2UoZTIpKTsKICAgICAgICB9LCBwZSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGUyID09ICJmdW5jdGlvbiI7CiAgICAgICAgfSwgaGUgPSBwZSwgRGUgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiBlMiA9PSAib2JqZWN0IiA/IGUyICE9PSBudWxsIDogaGUoZTIpOwogICAgICAgIH0sIGZlID0geCwgZGUgPSBwZSwgZ2UgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGRlKGUyKSA/IGUyIDogdm9pZCAwOwogICAgICAgIH0sIG1lID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA8IDIgPyBnZShmZVtlMl0pIDogZmVbZTJdICYmIGZlW2UyXVt0Ml07CiAgICAgICAgfSwgRWUgPSBZKHt9LmlzUHJvdG90eXBlT2YpLCBDZSA9IG1lKCJuYXZpZ2F0b3IiLCAidXNlckFnZW50IikgfHwgIiIsIHllID0geCwgYmUgPSBDZSwgU2UgPSB5ZS5wcm9jZXNzLCBUZSA9IHllLkRlbm8sIF9lID0gU2UgJiYgU2UudmVyc2lvbnMgfHwgVGUgJiYgVGUudmVyc2lvbiwgdmUgPSBfZSAmJiBfZS52ODsKICAgICAgICB2ZSAmJiAoRyA9IChVID0gdmUuc3BsaXQoIi4iKSlbMF0gPiAwICYmIFVbMF0gPCA0ID8gMSA6ICsoVVswXSArIFVbMV0pKSwgIUcgJiYgYmUgJiYgKCEoVSA9IGJlLm1hdGNoKC9FZGdlXC8oXGQrKS8pKSB8fCBVWzFdID49IDc0KSAmJiAoVSA9IGJlLm1hdGNoKC9DaHJvbWVcLyhcZCspLykpICYmIChHID0gK1VbMV0pOwogICAgICAgIHZhciBBZSA9IEcsIEZlID0gQWUsIHdlID0gUCwga2UgPSAhIU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgJiYgIXdlKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGUyID0gU3ltYm9sKCk7CiAgICAgICAgICByZXR1cm4gIVN0cmluZyhlMikgfHwgIShPYmplY3QoZTIpIGluc3RhbmNlb2YgU3ltYm9sKSB8fCAhU3ltYm9sLnNoYW0gJiYgRmUgJiYgRmUgPCA0MTsKICAgICAgICB9KSwgTmUgPSBrZSAmJiAhU3ltYm9sLnNoYW0gJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PSAic3ltYm9sIiwgT2UgPSBtZSwgeGUgPSBwZSwgSWUgPSBFZSwgUGUgPSBOZSwgUmUgPSB4Lk9iamVjdCwgTGUgPSBQZSA/IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGUyID09ICJzeW1ib2wiOwogICAgICAgIH0gOiBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gT2UoIlN5bWJvbCIpOwogICAgICAgICAgcmV0dXJuIHhlKHQyKSAmJiBJZSh0Mi5wcm90b3R5cGUsIFJlKGUyKSk7CiAgICAgICAgfSwgQmUgPSB4LlN0cmluZywgcWUgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIEJlKGUyKTsKICAgICAgICAgIH0gY2F0Y2ggKGUzKSB7CiAgICAgICAgICAgIHJldHVybiAiT2JqZWN0IjsKICAgICAgICAgIH0KICAgICAgICB9LCAkZSA9IHBlLCBNZSA9IHFlLCBqZSA9IHguVHlwZUVycm9yLCBVZSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBpZiAoJGUoZTIpKQogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICB0aHJvdyBqZShNZShlMikgKyAiIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgfSwgR2UgPSBVZSwgVmUgPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHZhciByMiA9IGUyW3QyXTsKICAgICAgICAgIHJldHVybiByMiA9PSBudWxsID8gdm9pZCAwIDogR2UocjIpOwogICAgICAgIH0sIFhlID0gQiwgSGUgPSBwZSwgemUgPSBEZSwgV2UgPSB4LlR5cGVFcnJvciwgWWUgPSB7IGV4cG9ydHM6IHt9IH0sIFFlID0geCwgSmUgPSBPYmplY3QuZGVmaW5lUHJvcGVydHksIFplID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBKZShRZSwgZTIsIHsgdmFsdWU6IHQyLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOwogICAgICAgICAgfSBjYXRjaCAocjIpIHsKICAgICAgICAgICAgUWVbZTJdID0gdDI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfSwgS2UgPSBaZSwgZXQgPSAiX19jb3JlLWpzX3NoYXJlZF9fIiwgdHQgPSB4W2V0XSB8fCBLZShldCwge30pLCBydCA9IHR0OwogICAgICAgIChZZS5leHBvcnRzID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gcnRbZTJdIHx8IChydFtlMl0gPSB0MiAhPT0gdm9pZCAwID8gdDIgOiB7fSk7CiAgICAgICAgfSkoInZlcnNpb25zIiwgW10pLnB1c2goeyB2ZXJzaW9uOiAiMy4xOS4xIiwgbW9kZTogImdsb2JhbCIsIGNvcHlyaWdodDogIlx4QTkgMjAyMSBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KSIgfSk7CiAgICAgICAgdmFyIG50ID0gYWUsIGl0ID0geC5PYmplY3QsIHN0ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBpdChudChlMikpOwogICAgICAgIH0sIG90ID0gc3QsIGF0ID0gWSh7fS5oYXNPd25Qcm9wZXJ0eSksIHV0ID0gT2JqZWN0Lmhhc093biB8fCBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiBhdChvdChlMiksIHQyKTsKICAgICAgICB9LCBjdCA9IFksIGx0ID0gMCwgcHQgPSBNYXRoLnJhbmRvbSgpLCBodCA9IGN0KDEgLnRvU3RyaW5nKSwgRHQgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuICJTeW1ib2woIiArIChlMiA9PT0gdm9pZCAwID8gIiIgOiBlMikgKyAiKV8iICsgaHQoKytsdCArIHB0LCAzNik7CiAgICAgICAgfSwgZnQgPSB4LCBkdCA9IFllLmV4cG9ydHMsIGd0ID0gdXQsIG10ID0gRHQsIEV0ID0ga2UsIEN0ID0gTmUsIHl0ID0gZHQoIndrcyIpLCBidCA9IGZ0LlN5bWJvbCwgU3QgPSBidCAmJiBidC5mb3IsIFR0ID0gQ3QgPyBidCA6IGJ0ICYmIGJ0LndpdGhvdXRTZXR0ZXIgfHwgbXQsIF90ID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGlmICghZ3QoeXQsIGUyKSB8fCAhRXQgJiYgdHlwZW9mIHl0W2UyXSAhPSAic3RyaW5nIikgewogICAgICAgICAgICB2YXIgdDIgPSAiU3ltYm9sLiIgKyBlMjsKICAgICAgICAgICAgRXQgJiYgZ3QoYnQsIGUyKSA/IHl0W2UyXSA9IGJ0W2UyXSA6IHl0W2UyXSA9IEN0ICYmIFN0ID8gU3QodDIpIDogVHQodDIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHl0W2UyXTsKICAgICAgICB9LCB2dCA9IEIsIEF0ID0gRGUsIEZ0ID0gTGUsIHd0ID0gVmUsIGt0ID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICB2YXIgcjIsIG4yOwogICAgICAgICAgaWYgKHQyID09PSAic3RyaW5nIiAmJiBIZShyMiA9IGUyLnRvU3RyaW5nKSAmJiAhemUobjIgPSBYZShyMiwgZTIpKSkKICAgICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgICAgaWYgKEhlKHIyID0gZTIudmFsdWVPZikgJiYgIXplKG4yID0gWGUocjIsIGUyKSkpCiAgICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICAgIGlmICh0MiAhPT0gInN0cmluZyIgJiYgSGUocjIgPSBlMi50b1N0cmluZykgJiYgIXplKG4yID0gWGUocjIsIGUyKSkpCiAgICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICAgIHRocm93IFdlKCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKTsKICAgICAgICB9LCBOdCA9IF90LCBPdCA9IHguVHlwZUVycm9yLCB4dCA9IE50KCJ0b1ByaW1pdGl2ZSIpLCBJdCA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgaWYgKCFBdChlMikgfHwgRnQoZTIpKQogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICB2YXIgcjIsIG4yID0gd3QoZTIsIHh0KTsKICAgICAgICAgIGlmIChuMikgewogICAgICAgICAgICBpZiAodDIgPT09IHZvaWQgMCAmJiAodDIgPSAiZGVmYXVsdCIpLCByMiA9IHZ0KG4yLCBlMiwgdDIpLCAhQXQocjIpIHx8IEZ0KHIyKSkKICAgICAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgICAgIHRocm93IE90KCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0MiA9PT0gdm9pZCAwICYmICh0MiA9ICJudW1iZXIiKSwga3QoZTIsIHQyKTsKICAgICAgICB9LCBQdCA9IExlLCBSdCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSBJdChlMiwgInN0cmluZyIpOwogICAgICAgICAgcmV0dXJuIFB0KHQyKSA/IHQyIDogdDIgKyAiIjsKICAgICAgICB9LCBMdCA9IERlLCBCdCA9IHguZG9jdW1lbnQsIHF0ID0gTHQoQnQpICYmIEx0KEJ0LmNyZWF0ZUVsZW1lbnQpLCAkdCA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gcXQgPyBCdC5jcmVhdGVFbGVtZW50KGUyKSA6IHt9OwogICAgICAgIH0sIE10ID0gIVIgJiYgIVAoZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KCR0KCJkaXYiKSwgImEiLCB7IGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiA3OwogICAgICAgICAgfSB9KS5hICE9IDc7CiAgICAgICAgfSksIGp0ID0gUiwgVXQgPSBCLCBHdCA9IHEsIFZ0ID0gViwgWHQgPSBsZSwgSHQgPSBSdCwgenQgPSB1dCwgV3QgPSBNdCwgWXQgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwogICAgICAgIEkuZiA9IGp0ID8gWXQgOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGlmIChlMiA9IFh0KGUyKSwgdDIgPSBIdCh0MiksIFd0KQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBZdChlMiwgdDIpOwogICAgICAgICAgICB9IGNhdGNoIChlMykgewogICAgICAgICAgICB9CiAgICAgICAgICBpZiAoenQoZTIsIHQyKSkKICAgICAgICAgICAgcmV0dXJuIFZ0KCFVdChHdC5mLCBlMiwgdDIpLCBlMlt0Ml0pOwogICAgICAgIH07CiAgICAgICAgdmFyIFF0ID0ge30sIEp0ID0geCwgWnQgPSBEZSwgS3QgPSBKdC5TdHJpbmcsIGVyID0gSnQuVHlwZUVycm9yLCB0ciA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBpZiAoWnQoZTIpKQogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgICB0aHJvdyBlcihLdChlMikgKyAiIGlzIG5vdCBhbiBvYmplY3QiKTsKICAgICAgICB9LCByciA9IFIsIG5yID0gTXQsIGlyID0gdHIsIHNyID0gUnQsIG9yID0geC5UeXBlRXJyb3IsIGFyID0gT2JqZWN0LmRlZmluZVByb3BlcnR5OwogICAgICAgIFF0LmYgPSByciA/IGFyIDogZnVuY3Rpb24oZTIsIHQyLCByMikgewogICAgICAgICAgaWYgKGlyKGUyKSwgdDIgPSBzcih0MiksIGlyKHIyKSwgbnIpCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIGFyKGUyLCB0MiwgcjIpOwogICAgICAgICAgICB9IGNhdGNoIChlMykgewogICAgICAgICAgICB9CiAgICAgICAgICBpZiAoImdldCIgaW4gcjIgfHwgInNldCIgaW4gcjIpCiAgICAgICAgICAgIHRocm93IG9yKCJBY2Nlc3NvcnMgbm90IHN1cHBvcnRlZCIpOwogICAgICAgICAgcmV0dXJuICJ2YWx1ZSIgaW4gcjIgJiYgKGUyW3QyXSA9IHIyLnZhbHVlKSwgZTI7CiAgICAgICAgfTsKICAgICAgICB2YXIgdXIgPSBRdCwgY3IgPSBWLCBsciA9IFIgPyBmdW5jdGlvbihlMiwgdDIsIHIyKSB7CiAgICAgICAgICByZXR1cm4gdXIuZihlMiwgdDIsIGNyKDEsIHIyKSk7CiAgICAgICAgfSA6IGZ1bmN0aW9uKGUyLCB0MiwgcjIpIHsKICAgICAgICAgIHJldHVybiBlMlt0Ml0gPSByMiwgZTI7CiAgICAgICAgfSwgcHIgPSB7IGV4cG9ydHM6IHt9IH0sIGhyID0gcGUsIERyID0gdHQsIGZyID0gWShGdW5jdGlvbi50b1N0cmluZyk7CiAgICAgICAgaHIoRHIuaW5zcGVjdFNvdXJjZSkgfHwgKERyLmluc3BlY3RTb3VyY2UgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGZyKGUyKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgZHIsIGdyLCBtciwgRXIgPSBEci5pbnNwZWN0U291cmNlLCBDciA9IHBlLCB5ciA9IEVyLCBiciA9IHguV2Vha01hcCwgU3IgPSBDcihicikgJiYgL25hdGl2ZSBjb2RlLy50ZXN0KHlyKGJyKSksIFRyID0gWWUuZXhwb3J0cywgX3IgPSBEdCwgdnIgPSBUcigia2V5cyIpLCBBciA9IHt9LCBGciA9IFNyLCB3ciA9IHgsIGtyID0gWSwgTnIgPSBEZSwgT3IgPSBsciwgeHIgPSB1dCwgSXIgPSB0dCwgUHIgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIHZyW2UyXSB8fCAodnJbZTJdID0gX3IoZTIpKTsKICAgICAgICB9LCBSciA9IEFyLCBMciA9ICJPYmplY3QgYWxyZWFkeSBpbml0aWFsaXplZCIsIEJyID0gd3IuVHlwZUVycm9yLCBxciA9IHdyLldlYWtNYXA7CiAgICAgICAgaWYgKEZyIHx8IElyLnN0YXRlKSB7CiAgICAgICAgICB2YXIgJHIgPSBJci5zdGF0ZSB8fCAoSXIuc3RhdGUgPSBuZXcgcXIoKSksIE1yID0ga3IoJHIuZ2V0KSwganIgPSBrcigkci5oYXMpLCBVciA9IGtyKCRyLnNldCk7CiAgICAgICAgICBkciA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgICBpZiAoanIoJHIsIGUyKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgQnIoTHIpOwogICAgICAgICAgICByZXR1cm4gdDIuZmFjYWRlID0gZTIsIFVyKCRyLCBlMiwgdDIpLCB0MjsKICAgICAgICAgIH0sIGdyID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgICAgcmV0dXJuIE1yKCRyLCBlMikgfHwge307CiAgICAgICAgICB9LCBtciA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICAgIHJldHVybiBqcigkciwgZTIpOwogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIEdyID0gUHIoInN0YXRlIik7CiAgICAgICAgICBScltHcl0gPSB0cnVlLCBkciA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgICBpZiAoeHIoZTIsIEdyKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgQnIoTHIpOwogICAgICAgICAgICByZXR1cm4gdDIuZmFjYWRlID0gZTIsIE9yKGUyLCBHciwgdDIpLCB0MjsKICAgICAgICAgIH0sIGdyID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgICAgcmV0dXJuIHhyKGUyLCBHcikgPyBlMltHcl0gOiB7fTsKICAgICAgICAgIH0sIG1yID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgICAgcmV0dXJuIHhyKGUyLCBHcik7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICB2YXIgVnIgPSB7IHNldDogZHIsIGdldDogZ3IsIGhhczogbXIsIGVuZm9yY2U6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gbXIoZTIpID8gZ3IoZTIpIDogZHIoZTIsIHt9KTsKICAgICAgICB9LCBnZXR0ZXJGb3I6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odDIpIHsKICAgICAgICAgICAgdmFyIHIyOwogICAgICAgICAgICBpZiAoIU5yKHQyKSB8fCAocjIgPSBncih0MikpLnR5cGUgIT09IGUyKQogICAgICAgICAgICAgIHRocm93IEJyKCJJbmNvbXBhdGlibGUgcmVjZWl2ZXIsICIgKyBlMiArICIgcmVxdWlyZWQiKTsKICAgICAgICAgICAgcmV0dXJuIHIyOwogICAgICAgICAgfTsKICAgICAgICB9IH0sIFhyID0gUiwgSHIgPSB1dCwgenIgPSBGdW5jdGlvbi5wcm90b3R5cGUsIFdyID0gWHIgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciwgWXIgPSBIcih6ciwgIm5hbWUiKSwgUXIgPSBZciAmJiBmdW5jdGlvbigpIHsKICAgICAgICB9Lm5hbWUgPT09ICJzb21ldGhpbmciLCBKciA9IFlyICYmICghWHIgfHwgWHIgJiYgV3IoenIsICJuYW1lIikuY29uZmlndXJhYmxlKSwgWnIgPSB4LCBLciA9IHBlLCBlbiA9IHV0LCB0biA9IGxyLCBybiA9IFplLCBubiA9IEVyLCBzbiA9IHsgRVhJU1RTOiBZciwgUFJPUEVSOiBRciwgQ09ORklHVVJBQkxFOiBKciB9LkNPTkZJR1VSQUJMRSwgb24gPSBWci5nZXQsIGFuID0gVnIuZW5mb3JjZSwgdW4gPSBTdHJpbmcoU3RyaW5nKS5zcGxpdCgiU3RyaW5nIik7CiAgICAgICAgKHByLmV4cG9ydHMgPSBmdW5jdGlvbihlMiwgdDIsIHIyLCBuMikgewogICAgICAgICAgdmFyIGkyLCBzMiA9ICEhbjIgJiYgISFuMi51bnNhZmUsIG8yID0gISFuMiAmJiAhIW4yLmVudW1lcmFibGUsIGEyID0gISFuMiAmJiAhIW4yLm5vVGFyZ2V0R2V0LCB1MiA9IG4yICYmIG4yLm5hbWUgIT09IHZvaWQgMCA/IG4yLm5hbWUgOiB0MjsKICAgICAgICAgIEtyKHIyKSAmJiAoU3RyaW5nKHUyKS5zbGljZSgwLCA3KSA9PT0gIlN5bWJvbCgiICYmICh1MiA9ICJbIiArIFN0cmluZyh1MikucmVwbGFjZSgvXlN5bWJvbFwoKFteKV0qKVwpLywgIiQxIikgKyAiXSIpLCAoIWVuKHIyLCAibmFtZSIpIHx8IHNuICYmIHIyLm5hbWUgIT09IHUyKSAmJiB0bihyMiwgIm5hbWUiLCB1MiksIChpMiA9IGFuKHIyKSkuc291cmNlIHx8IChpMi5zb3VyY2UgPSB1bi5qb2luKHR5cGVvZiB1MiA9PSAic3RyaW5nIiA/IHUyIDogIiIpKSksIGUyICE9PSBaciA/IChzMiA/ICFhMiAmJiBlMlt0Ml0gJiYgKG8yID0gdHJ1ZSkgOiBkZWxldGUgZTJbdDJdLCBvMiA/IGUyW3QyXSA9IHIyIDogdG4oZTIsIHQyLCByMikpIDogbzIgPyBlMlt0Ml0gPSByMiA6IHJuKHQyLCByMik7CiAgICAgICAgfSkoRnVuY3Rpb24ucHJvdG90eXBlLCAidG9TdHJpbmciLCBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBLcih0aGlzKSAmJiBvbih0aGlzKS5zb3VyY2UgfHwgbm4odGhpcyk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGNuID0ge30sIGxuID0gTWF0aC5jZWlsLCBwbiA9IE1hdGguZmxvb3IsIGhuID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9ICtlMjsKICAgICAgICAgIHJldHVybiB0MiAhPSB0MiB8fCB0MiA9PT0gMCA/IDAgOiAodDIgPiAwID8gcG4gOiBsbikodDIpOwogICAgICAgIH0sIERuID0gaG4sIGZuID0gTWF0aC5tYXgsIGRuID0gTWF0aC5taW4sIGduID0gaG4sIG1uID0gTWF0aC5taW4sIEVuID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMiA+IDAgPyBtbihnbihlMiksIDkwMDcxOTkyNTQ3NDA5OTEpIDogMDsKICAgICAgICB9LCBDbiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gRW4oZTIubGVuZ3RoKTsKICAgICAgICB9LCB5biA9IGxlLCBibiA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgdmFyIHIyID0gRG4oZTIpOwogICAgICAgICAgcmV0dXJuIHIyIDwgMCA/IGZuKHIyICsgdDIsIDApIDogZG4ocjIsIHQyKTsKICAgICAgICB9LCBTbiA9IENuLCBUbiA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odDIsIHIyLCBuMikgewogICAgICAgICAgICB2YXIgaTIsIHMyID0geW4odDIpLCBvMiA9IFNuKHMyKSwgYTIgPSBibihuMiwgbzIpOwogICAgICAgICAgICBpZiAoZTIgJiYgcjIgIT0gcjIpIHsKICAgICAgICAgICAgICBmb3IgKDsgbzIgPiBhMjsgKQogICAgICAgICAgICAgICAgaWYgKChpMiA9IHMyW2EyKytdKSAhPSBpMikKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIGZvciAoOyBvMiA+IGEyOyBhMisrKQogICAgICAgICAgICAgICAgaWYgKChlMiB8fCBhMiBpbiBzMikgJiYgczJbYTJdID09PSByMikKICAgICAgICAgICAgICAgICAgcmV0dXJuIGUyIHx8IGEyIHx8IDA7CiAgICAgICAgICAgIHJldHVybiAhZTIgJiYgLTE7CiAgICAgICAgICB9OwogICAgICAgIH0sIF9uID0geyBpbmNsdWRlczogVG4odHJ1ZSksIGluZGV4T2Y6IFRuKGZhbHNlKSB9LCB2biA9IHV0LCBBbiA9IGxlLCBGbiA9IF9uLmluZGV4T2YsIHduID0gQXIsIGtuID0gWShbXS5wdXNoKSwgTm4gPSBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHZhciByMiwgbjIgPSBBbihlMiksIGkyID0gMCwgczIgPSBbXTsKICAgICAgICAgIGZvciAocjIgaW4gbjIpCiAgICAgICAgICAgICF2bih3biwgcjIpICYmIHZuKG4yLCByMikgJiYga24oczIsIHIyKTsKICAgICAgICAgIGZvciAoOyB0Mi5sZW5ndGggPiBpMjsgKQogICAgICAgICAgICB2bihuMiwgcjIgPSB0MltpMisrXSkgJiYgKH5GbihzMiwgcjIpIHx8IGtuKHMyLCByMikpOwogICAgICAgICAgcmV0dXJuIHMyOwogICAgICAgIH0sIE9uID0gWyJjb25zdHJ1Y3RvciIsICJoYXNPd25Qcm9wZXJ0eSIsICJpc1Byb3RvdHlwZU9mIiwgInByb3BlcnR5SXNFbnVtZXJhYmxlIiwgInRvTG9jYWxlU3RyaW5nIiwgInRvU3RyaW5nIiwgInZhbHVlT2YiXS5jb25jYXQoImxlbmd0aCIsICJwcm90b3R5cGUiKTsKICAgICAgICBjbi5mID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgfHwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBObihlMiwgT24pOwogICAgICAgIH07CiAgICAgICAgdmFyIHhuID0ge307CiAgICAgICAgeG4uZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CiAgICAgICAgdmFyIEluID0gbWUsIFBuID0gY24sIFJuID0geG4sIExuID0gdHIsIEJuID0gWShbXS5jb25jYXQpLCBxbiA9IEluKCJSZWZsZWN0IiwgIm93bktleXMiKSB8fCBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gUG4uZihMbihlMikpLCByMiA9IFJuLmY7CiAgICAgICAgICByZXR1cm4gcjIgPyBCbih0MiwgcjIoZTIpKSA6IHQyOwogICAgICAgIH0sICRuID0gdXQsIE1uID0gcW4sIGpuID0gSSwgVW4gPSBRdCwgR24gPSBQLCBWbiA9IHBlLCBYbiA9IC8jfFwucHJvdG90eXBlXC4vLCBIbiA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgdmFyIHIyID0gV25bem4oZTIpXTsKICAgICAgICAgIHJldHVybiByMiA9PSBRbiB8fCByMiAhPSBZbiAmJiAoVm4odDIpID8gR24odDIpIDogISF0Mik7CiAgICAgICAgfSwgem4gPSBIbi5ub3JtYWxpemUgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFN0cmluZyhlMikucmVwbGFjZShYbiwgIi4iKS50b0xvd2VyQ2FzZSgpOwogICAgICAgIH0sIFduID0gSG4uZGF0YSA9IHt9LCBZbiA9IEhuLk5BVElWRSA9ICJOIiwgUW4gPSBIbi5QT0xZRklMTCA9ICJQIiwgSm4gPSBIbiwgWm4gPSB4LCBLbiA9IEkuZiwgZWkgPSBsciwgdGkgPSBwci5leHBvcnRzLCByaSA9IFplLCBuaSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgZm9yICh2YXIgcjIgPSBNbih0MiksIG4yID0gVW4uZiwgaTIgPSBqbi5mLCBzMiA9IDA7IHMyIDwgcjIubGVuZ3RoOyBzMisrKSB7CiAgICAgICAgICAgIHZhciBvMiA9IHIyW3MyXTsKICAgICAgICAgICAgJG4oZTIsIG8yKSB8fCBuMihlMiwgbzIsIGkyKHQyLCBvMikpOwogICAgICAgICAgfQogICAgICAgIH0sIGlpID0gSm4sIHNpID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICB2YXIgcjIsIG4yLCBpMiwgczIsIG8yLCBhMiA9IGUyLnRhcmdldCwgdTIgPSBlMi5nbG9iYWwsIGMyID0gZTIuc3RhdDsKICAgICAgICAgIGlmIChyMiA9IHUyID8gWm4gOiBjMiA/IFpuW2EyXSB8fCByaShhMiwge30pIDogKFpuW2EyXSB8fCB7fSkucHJvdG90eXBlKQogICAgICAgICAgICBmb3IgKG4yIGluIHQyKSB7CiAgICAgICAgICAgICAgaWYgKHMyID0gdDJbbjJdLCBpMiA9IGUyLm5vVGFyZ2V0R2V0ID8gKG8yID0gS24ocjIsIG4yKSkgJiYgbzIudmFsdWUgOiByMltuMl0sICFpaSh1MiA/IG4yIDogYTIgKyAoYzIgPyAiLiIgOiAiIyIpICsgbjIsIGUyLmZvcmNlZCkgJiYgaTIgIT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzMiA9PSB0eXBlb2YgaTIpCiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgbmkoczIsIGkyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKGUyLnNoYW0gfHwgaTIgJiYgaTIuc2hhbSkgJiYgZWkoczIsICJzaGFtIiwgdHJ1ZSksIHRpKHIyLCBuMiwgczIsIGUyKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIG9pID0gSywgYWkgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gb2koZTIpID09ICJBcnJheSI7CiAgICAgICAgfSwgdWkgPSBVZSwgY2kgPSBZKFkuYmluZCksIGxpID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gdWkoZTIpLCB0MiA9PT0gdm9pZCAwID8gZTIgOiBjaSA/IGNpKGUyLCB0MikgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGUyLmFwcGx5KHQyLCBhcmd1bWVudHMpOwogICAgICAgICAgfTsKICAgICAgICB9LCBwaSA9IGFpLCBoaSA9IENuLCBEaSA9IGxpLCBmaSA9IHguVHlwZUVycm9yLCBkaSA9IGZ1bmN0aW9uKGUyLCB0MiwgcjIsIG4yLCBpMiwgczIsIG8yLCBhMikgewogICAgICAgICAgZm9yICh2YXIgdTIsIGMyLCBsMiA9IGkyLCBwMiA9IDAsIGgyID0gISFvMiAmJiBEaShvMiwgYTIpOyBwMiA8IG4yOyApIHsKICAgICAgICAgICAgaWYgKHAyIGluIHIyKSB7CiAgICAgICAgICAgICAgaWYgKHUyID0gaDIgPyBoMihyMltwMl0sIHAyLCB0MikgOiByMltwMl0sIHMyID4gMCAmJiBwaSh1MikpCiAgICAgICAgICAgICAgICBjMiA9IGhpKHUyKSwgbDIgPSBkaShlMiwgdDIsIHUyLCBjMiwgbDIsIHMyIC0gMSkgLSAxOwogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGwyID49IDkwMDcxOTkyNTQ3NDA5OTEpCiAgICAgICAgICAgICAgICAgIHRocm93IGZpKCJFeGNlZWQgdGhlIGFjY2VwdGFibGUgYXJyYXkgbGVuZ3RoIik7CiAgICAgICAgICAgICAgICBlMltsMl0gPSB1MjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbDIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBwMisrOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGwyOwogICAgICAgIH0sIGdpID0gZGksIG1pID0ge307CiAgICAgICAgbWlbX3QoInRvU3RyaW5nVGFnIildID0gInoiOwogICAgICAgIHZhciBFaSA9IHgsIENpID0gU3RyaW5nKG1pKSA9PT0gIltvYmplY3Qgel0iLCB5aSA9IHBlLCBiaSA9IEssIFNpID0gX3QoInRvU3RyaW5nVGFnIiksIFRpID0gRWkuT2JqZWN0LCBfaSA9IGJpKGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50czsKICAgICAgICB9KCkpID09ICJBcmd1bWVudHMiLCB2aSA9IENpID8gYmkgOiBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyLCByMiwgbjI7CiAgICAgICAgICByZXR1cm4gZTIgPT09IHZvaWQgMCA/ICJVbmRlZmluZWQiIDogZTIgPT09IG51bGwgPyAiTnVsbCIgOiB0eXBlb2YgKHIyID0gZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUzW3QzXTsKICAgICAgICAgICAgfSBjYXRjaCAoZTQpIHsKICAgICAgICAgICAgfQogICAgICAgICAgfSh0MiA9IFRpKGUyKSwgU2kpKSA9PSAic3RyaW5nIiA/IHIyIDogX2kgPyBiaSh0MikgOiAobjIgPSBiaSh0MikpID09ICJPYmplY3QiICYmIHlpKHQyLmNhbGxlZSkgPyAiQXJndW1lbnRzIiA6IG4yOwogICAgICAgIH0sIEFpID0gWSwgRmkgPSBQLCB3aSA9IHBlLCBraSA9IHZpLCBOaSA9IEVyLCBPaSA9IGZ1bmN0aW9uKCkgewogICAgICAgIH0sIHhpID0gW10sIElpID0gbWUoIlJlZmxlY3QiLCAiY29uc3RydWN0IiksIFBpID0gL15ccyooPzpjbGFzc3xmdW5jdGlvbilcYi8sIFJpID0gQWkoUGkuZXhlYyksIExpID0gIVBpLmV4ZWMoT2kpLCBCaSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBpZiAoIXdpKGUyKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIElpKE9pLCB4aSwgZTIpLCB0cnVlOwogICAgICAgICAgfSBjYXRjaCAoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0sIHFpID0gIUlpIHx8IEZpKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGUyOwogICAgICAgICAgcmV0dXJuIEJpKEJpLmNhbGwpIHx8ICFCaShPYmplY3QpIHx8ICFCaShmdW5jdGlvbigpIHsKICAgICAgICAgICAgZTIgPSB0cnVlOwogICAgICAgICAgfSkgfHwgZTI7CiAgICAgICAgfSkgPyBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKCF3aShlMikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIHN3aXRjaCAoa2koZTIpKSB7CiAgICAgICAgICAgIGNhc2UgIkFzeW5jRnVuY3Rpb24iOgogICAgICAgICAgICBjYXNlICJHZW5lcmF0b3JGdW5jdGlvbiI6CiAgICAgICAgICAgIGNhc2UgIkFzeW5jR2VuZXJhdG9yRnVuY3Rpb24iOgogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBMaSB8fCAhIVJpKFBpLCBOaShlMikpOwogICAgICAgIH0gOiBCaSwgJGkgPSB4LCBNaSA9IGFpLCBqaSA9IHFpLCBVaSA9IERlLCBHaSA9IF90KCJzcGVjaWVzIiksIFZpID0gJGkuQXJyYXksIFhpID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MjsKICAgICAgICAgIHJldHVybiBNaShlMikgJiYgKHQyID0gZTIuY29uc3RydWN0b3IsIChqaSh0MikgJiYgKHQyID09PSBWaSB8fCBNaSh0Mi5wcm90b3R5cGUpKSB8fCBVaSh0MikgJiYgKHQyID0gdDJbR2ldKSA9PT0gbnVsbCkgJiYgKHQyID0gdm9pZCAwKSksIHQyID09PSB2b2lkIDAgPyBWaSA6IHQyOwogICAgICAgIH0sIEhpID0gZ2ksIHppID0gVWUsIFdpID0gc3QsIFlpID0gQ24sIFFpID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gbmV3IChYaShlMikpKHQyID09PSAwID8gMCA6IHQyKTsKICAgICAgICB9OwogICAgICAgIHNpKHsgdGFyZ2V0OiAiQXJyYXkiLCBwcm90bzogdHJ1ZSB9LCB7IGZsYXRNYXA6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIsIHIyID0gV2kodGhpcyksIG4yID0gWWkocjIpOwogICAgICAgICAgcmV0dXJuIHppKGUyKSwgKHQyID0gUWkocjIsIDApKS5sZW5ndGggPSBIaSh0MiwgcjIsIHIyLCBuMiwgMCwgMSwgZTIsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdm9pZCAwKSwgdDI7CiAgICAgICAgfSB9KTsKICAgICAgICB2YXIgSmkgPSB2aSwgWmkgPSB4LlN0cmluZywgS2kgPSBZKFtdLnNsaWNlKSwgZXMgPSBNYXRoLmZsb29yLCB0cyA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgdmFyIHIyID0gZTIubGVuZ3RoLCBuMiA9IGVzKHIyIC8gMik7CiAgICAgICAgICByZXR1cm4gcjIgPCA4ID8gcnMoZTIsIHQyKSA6IG5zKGUyLCB0cyhLaShlMiwgMCwgbjIpLCB0MiksIHRzKEtpKGUyLCBuMiksIHQyKSwgdDIpOwogICAgICAgIH0sIHJzID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBmb3IgKHZhciByMiwgbjIsIGkyID0gZTIubGVuZ3RoLCBzMiA9IDE7IHMyIDwgaTI7ICkgewogICAgICAgICAgICBmb3IgKG4yID0gczIsIHIyID0gZTJbczJdOyBuMiAmJiB0MihlMltuMiAtIDFdLCByMikgPiAwOyApCiAgICAgICAgICAgICAgZTJbbjJdID0gZTJbLS1uMl07CiAgICAgICAgICAgIG4yICE9PSBzMisrICYmIChlMltuMl0gPSByMik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgfSwgbnMgPSBmdW5jdGlvbihlMiwgdDIsIHIyLCBuMikgewogICAgICAgICAgZm9yICh2YXIgaTIgPSB0Mi5sZW5ndGgsIHMyID0gcjIubGVuZ3RoLCBvMiA9IDAsIGEyID0gMDsgbzIgPCBpMiB8fCBhMiA8IHMyOyApCiAgICAgICAgICAgIGUyW28yICsgYTJdID0gbzIgPCBpMiAmJiBhMiA8IHMyID8gbjIodDJbbzJdLCByMlthMl0pIDw9IDAgPyB0MltvMisrXSA6IHIyW2EyKytdIDogbzIgPCBpMiA/IHQyW28yKytdIDogcjJbYTIrK107CiAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgfSwgaXMgPSB0cywgc3MgPSBQLCBvcyA9IENlLm1hdGNoKC9maXJlZm94XC8oXGQrKS9pKSwgYXMgPSAhIW9zICYmICtvc1sxXSwgdXMgPSAvTVNJRXxUcmlkZW50Ly50ZXN0KENlKSwgY3MgPSBDZS5tYXRjaCgvQXBwbGVXZWJLaXRcLyhcZCspXC4vKSwgbHMgPSAhIWNzICYmICtjc1sxXSwgcHMgPSBzaSwgaHMgPSBZLCBEcyA9IFVlLCBmcyA9IHN0LCBkcyA9IENuLCBncyA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBpZiAoSmkoZTIpID09PSAiU3ltYm9sIikKICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgY29udmVydCBhIFN5bWJvbCB2YWx1ZSB0byBhIHN0cmluZyIpOwogICAgICAgICAgcmV0dXJuIFppKGUyKTsKICAgICAgICB9LCBtcyA9IFAsIEVzID0gaXMsIENzID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICB2YXIgcjIgPSBbXVtlMl07CiAgICAgICAgICByZXR1cm4gISFyMiAmJiBzcyhmdW5jdGlvbigpIHsKICAgICAgICAgICAgcjIuY2FsbChudWxsLCB0MiB8fCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aHJvdyAxOwogICAgICAgICAgICB9LCAxKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sIHlzID0gYXMsIGJzID0gdXMsIFNzID0gQWUsIFRzID0gbHMsIF9zID0gW10sIHZzID0gaHMoX3Muc29ydCksIEFzID0gaHMoX3MucHVzaCksIEZzID0gbXMoZnVuY3Rpb24oKSB7CiAgICAgICAgICBfcy5zb3J0KHZvaWQgMCk7CiAgICAgICAgfSksIHdzID0gbXMoZnVuY3Rpb24oKSB7CiAgICAgICAgICBfcy5zb3J0KG51bGwpOwogICAgICAgIH0pLCBrcyA9IENzKCJzb3J0IiksIE5zID0gIW1zKGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKFNzKQogICAgICAgICAgICByZXR1cm4gU3MgPCA3MDsKICAgICAgICAgIGlmICghKHlzICYmIHlzID4gMykpIHsKICAgICAgICAgICAgaWYgKGJzKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoVHMpCiAgICAgICAgICAgICAgcmV0dXJuIFRzIDwgNjAzOwogICAgICAgICAgICB2YXIgZTIsIHQyLCByMiwgbjIsIGkyID0gIiI7CiAgICAgICAgICAgIGZvciAoZTIgPSA2NTsgZTIgPCA3NjsgZTIrKykgewogICAgICAgICAgICAgIHN3aXRjaCAodDIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGUyKSwgZTIpIHsKICAgICAgICAgICAgICAgIGNhc2UgNjY6CiAgICAgICAgICAgICAgICBjYXNlIDY5OgogICAgICAgICAgICAgICAgY2FzZSA3MDoKICAgICAgICAgICAgICAgIGNhc2UgNzI6CiAgICAgICAgICAgICAgICAgIHIyID0gMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDY4OgogICAgICAgICAgICAgICAgY2FzZSA3MToKICAgICAgICAgICAgICAgICAgcjIgPSA0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHIyID0gMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZm9yIChuMiA9IDA7IG4yIDwgNDc7IG4yKyspCiAgICAgICAgICAgICAgICBfcy5wdXNoKHsgazogdDIgKyBuMiwgdjogcjIgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChfcy5zb3J0KGZ1bmN0aW9uKGUzLCB0MykgewogICAgICAgICAgICAgIHJldHVybiB0My52IC0gZTMudjsKICAgICAgICAgICAgfSksIG4yID0gMDsgbjIgPCBfcy5sZW5ndGg7IG4yKyspCiAgICAgICAgICAgICAgdDIgPSBfc1tuMl0uay5jaGFyQXQoMCksIGkyLmNoYXJBdChpMi5sZW5ndGggLSAxKSAhPT0gdDIgJiYgKGkyICs9IHQyKTsKICAgICAgICAgICAgcmV0dXJuIGkyICE9PSAiREdCRUZIQUNJSksiOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHBzKHsgdGFyZ2V0OiAiQXJyYXkiLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiBGcyB8fCAhd3MgfHwgIWtzIHx8ICFOcyB9LCB7IHNvcnQ6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBlMiAhPT0gdm9pZCAwICYmIERzKGUyKTsKICAgICAgICAgIHZhciB0MiA9IGZzKHRoaXMpOwogICAgICAgICAgaWYgKE5zKQogICAgICAgICAgICByZXR1cm4gZTIgPT09IHZvaWQgMCA/IHZzKHQyKSA6IHZzKHQyLCBlMik7CiAgICAgICAgICB2YXIgcjIsIG4yLCBpMiA9IFtdLCBzMiA9IGRzKHQyKTsKICAgICAgICAgIGZvciAobjIgPSAwOyBuMiA8IHMyOyBuMisrKQogICAgICAgICAgICBuMiBpbiB0MiAmJiBBcyhpMiwgdDJbbjJdKTsKICAgICAgICAgIGZvciAoRXMoaTIsIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0MywgcjMpIHsKICAgICAgICAgICAgICByZXR1cm4gcjMgPT09IHZvaWQgMCA/IC0xIDogdDMgPT09IHZvaWQgMCA/IDEgOiBlMyAhPT0gdm9pZCAwID8gK2UzKHQzLCByMykgfHwgMCA6IGdzKHQzKSA+IGdzKHIzKSA/IDEgOiAtMTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0oZTIpKSwgcjIgPSBpMi5sZW5ndGgsIG4yID0gMDsgbjIgPCByMjsgKQogICAgICAgICAgICB0MltuMl0gPSBpMltuMisrXTsKICAgICAgICAgIGZvciAoOyBuMiA8IHMyOyApCiAgICAgICAgICAgIGRlbGV0ZSB0MltuMisrXTsKICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9IH0pOwogICAgICAgIHZhciBPcyA9IHt9LCB4cyA9IE9zLCBJcyA9IF90KCJpdGVyYXRvciIpLCBQcyA9IEFycmF5LnByb3RvdHlwZSwgUnMgPSB2aSwgTHMgPSBWZSwgQnMgPSBPcywgcXMgPSBfdCgiaXRlcmF0b3IiKSwgJHMgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKGUyICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBMcyhlMiwgcXMpIHx8IExzKGUyLCAiQEBpdGVyYXRvciIpIHx8IEJzW1JzKGUyKV07CiAgICAgICAgfSwgTXMgPSBCLCBqcyA9IFVlLCBVcyA9IHRyLCBHcyA9IHFlLCBWcyA9ICRzLCBYcyA9IHguVHlwZUVycm9yLCBIcyA9IEIsIHpzID0gdHIsIFdzID0gVmUsIFlzID0gbGksIFFzID0gQiwgSnMgPSB0ciwgWnMgPSBxZSwgS3MgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyICE9PSB2b2lkIDAgJiYgKHhzLkFycmF5ID09PSBlMiB8fCBQc1tJc10gPT09IGUyKTsKICAgICAgICB9LCBlbyA9IENuLCB0byA9IEVlLCBybyA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgdmFyIHIyID0gYXJndW1lbnRzLmxlbmd0aCA8IDIgPyBWcyhlMikgOiB0MjsKICAgICAgICAgIGlmIChqcyhyMikpCiAgICAgICAgICAgIHJldHVybiBVcyhNcyhyMiwgZTIpKTsKICAgICAgICAgIHRocm93IFhzKEdzKGUyKSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgICAgICAgfSwgbm8gPSAkcywgaW8gPSBmdW5jdGlvbihlMiwgdDIsIHIyKSB7CiAgICAgICAgICB2YXIgbjIsIGkyOwogICAgICAgICAgenMoZTIpOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCEobjIgPSBXcyhlMiwgInJldHVybiIpKSkgewogICAgICAgICAgICAgIGlmICh0MiA9PT0gInRocm93IikKICAgICAgICAgICAgICAgIHRocm93IHIyOwogICAgICAgICAgICAgIHJldHVybiByMjsKICAgICAgICAgICAgfQogICAgICAgICAgICBuMiA9IEhzKG4yLCBlMik7CiAgICAgICAgICB9IGNhdGNoIChlMykgewogICAgICAgICAgICBpMiA9IHRydWUsIG4yID0gZTM7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodDIgPT09ICJ0aHJvdyIpCiAgICAgICAgICAgIHRocm93IHIyOwogICAgICAgICAgaWYgKGkyKQogICAgICAgICAgICB0aHJvdyBuMjsKICAgICAgICAgIHJldHVybiB6cyhuMiksIHIyOwogICAgICAgIH0sIHNvID0geC5UeXBlRXJyb3IsIG9vID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICB0aGlzLnN0b3BwZWQgPSBlMiwgdGhpcy5yZXN1bHQgPSB0MjsKICAgICAgICB9LCBhbyA9IG9vLnByb3RvdHlwZSwgdW8gPSBSdCwgY28gPSBRdCwgbG8gPSBWLCBwbyA9IGZ1bmN0aW9uKGUyLCB0MiwgcjIpIHsKICAgICAgICAgIHZhciBuMiwgaTIsIHMyLCBvMiwgYTIsIHUyLCBjMiwgbDIgPSByMiAmJiByMi50aGF0LCBwMiA9ICEoIXIyIHx8ICFyMi5BU19FTlRSSUVTKSwgaDIgPSAhKCFyMiB8fCAhcjIuSVNfSVRFUkFUT1IpLCBEMiA9ICEoIXIyIHx8ICFyMi5JTlRFUlJVUFRFRCksIGYyID0gWXModDIsIGwyKSwgZDIgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gbjIgJiYgaW8objIsICJub3JtYWwiLCBlMyksIG5ldyBvbyh0cnVlLCBlMyk7CiAgICAgICAgICB9LCBnMiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBwMiA/IChKcyhlMyksIEQyID8gZjIoZTNbMF0sIGUzWzFdLCBkMikgOiBmMihlM1swXSwgZTNbMV0pKSA6IEQyID8gZjIoZTMsIGQyKSA6IGYyKGUzKTsKICAgICAgICAgIH07CiAgICAgICAgICBpZiAoaDIpCiAgICAgICAgICAgIG4yID0gZTI7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKCEoaTIgPSBubyhlMikpKQogICAgICAgICAgICAgIHRocm93IHNvKFpzKGUyKSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgICAgICAgICAgIGlmIChLcyhpMikpIHsKICAgICAgICAgICAgICBmb3IgKHMyID0gMCwgbzIgPSBlbyhlMik7IG8yID4gczI7IHMyKyspCiAgICAgICAgICAgICAgICBpZiAoKGEyID0gZzIoZTJbczJdKSkgJiYgdG8oYW8sIGEyKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIGEyOwogICAgICAgICAgICAgIHJldHVybiBuZXcgb28oZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG4yID0gcm8oZTIsIGkyKTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAodTIgPSBuMi5uZXh0OyAhKGMyID0gUXModTIsIG4yKSkuZG9uZTsgKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgYTIgPSBnMihjMi52YWx1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUzKSB7CiAgICAgICAgICAgICAgaW8objIsICJ0aHJvdyIsIGUzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZW9mIGEyID09ICJvYmplY3QiICYmIGEyICYmIHRvKGFvLCBhMikpCiAgICAgICAgICAgICAgcmV0dXJuIGEyOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5ldyBvbyhmYWxzZSk7CiAgICAgICAgfSwgaG8gPSBmdW5jdGlvbihlMiwgdDIsIHIyKSB7CiAgICAgICAgICB2YXIgbjIgPSB1byh0Mik7CiAgICAgICAgICBuMiBpbiBlMiA/IGNvLmYoZTIsIG4yLCBsbygwLCByMikpIDogZTJbbjJdID0gcjI7CiAgICAgICAgfTsKICAgICAgICBzaSh7IHRhcmdldDogIk9iamVjdCIsIHN0YXQ6IHRydWUgfSwgeyBmcm9tRW50cmllczogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciB0MiA9IHt9OwogICAgICAgICAgcmV0dXJuIHBvKGUyLCBmdW5jdGlvbihlMywgcjIpIHsKICAgICAgICAgICAgaG8odDIsIGUzLCByMik7CiAgICAgICAgICB9LCB7IEFTX0VOVFJJRVM6IHRydWUgfSksIHQyOwogICAgICAgIH0gfSk7CiAgICAgICAgdmFyIERvID0gRG8gIT09IHZvaWQgMCA/IERvIDogdHlwZW9mIHNlbGYgIT0gInVuZGVmaW5lZCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHt9OwogICAgICAgIGZ1bmN0aW9uIGZvKCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJzZXRUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdvKCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQiKTsKICAgICAgICB9CiAgICAgICAgdmFyIG1vID0gZm8sIEVvID0gZ287CiAgICAgICAgZnVuY3Rpb24gQ28oZTIpIHsKICAgICAgICAgIGlmIChtbyA9PT0gc2V0VGltZW91dCkKICAgICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZTIsIDApOwogICAgICAgICAgaWYgKChtbyA9PT0gZm8gfHwgIW1vKSAmJiBzZXRUaW1lb3V0KQogICAgICAgICAgICByZXR1cm4gbW8gPSBzZXRUaW1lb3V0LCBzZXRUaW1lb3V0KGUyLCAwKTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBtbyhlMiwgMCk7CiAgICAgICAgICB9IGNhdGNoICh0MikgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBtby5jYWxsKG51bGwsIGUyLCAwKTsKICAgICAgICAgICAgfSBjYXRjaCAodDMpIHsKICAgICAgICAgICAgICByZXR1cm4gbW8uY2FsbCh0aGlzLCBlMiwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdHlwZW9mIERvLnNldFRpbWVvdXQgPT0gImZ1bmN0aW9uIiAmJiAobW8gPSBzZXRUaW1lb3V0KSwgdHlwZW9mIERvLmNsZWFyVGltZW91dCA9PSAiZnVuY3Rpb24iICYmIChFbyA9IGNsZWFyVGltZW91dCk7CiAgICAgICAgdmFyIHlvLCBibyA9IFtdLCBTbyA9IGZhbHNlLCBUbyA9IC0xOwogICAgICAgIGZ1bmN0aW9uIF9vKCkgewogICAgICAgICAgU28gJiYgeW8gJiYgKFNvID0gZmFsc2UsIHlvLmxlbmd0aCA/IGJvID0geW8uY29uY2F0KGJvKSA6IFRvID0gLTEsIGJvLmxlbmd0aCAmJiB2bygpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdm8oKSB7CiAgICAgICAgICBpZiAoIVNvKSB7CiAgICAgICAgICAgIHZhciBlMiA9IENvKF9vKTsKICAgICAgICAgICAgU28gPSB0cnVlOwogICAgICAgICAgICBmb3IgKHZhciB0MiA9IGJvLmxlbmd0aDsgdDI7ICkgewogICAgICAgICAgICAgIGZvciAoeW8gPSBibywgYm8gPSBbXTsgKytUbyA8IHQyOyApCiAgICAgICAgICAgICAgICB5byAmJiB5b1tUb10ucnVuKCk7CiAgICAgICAgICAgICAgVG8gPSAtMSwgdDIgPSBiby5sZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgeW8gPSBudWxsLCBTbyA9IGZhbHNlLCBmdW5jdGlvbihlMykgewogICAgICAgICAgICAgIGlmIChFbyA9PT0gY2xlYXJUaW1lb3V0KQogICAgICAgICAgICAgICAgcmV0dXJuIGNsZWFyVGltZW91dChlMyk7CiAgICAgICAgICAgICAgaWYgKChFbyA9PT0gZ28gfHwgIUVvKSAmJiBjbGVhclRpbWVvdXQpCiAgICAgICAgICAgICAgICByZXR1cm4gRW8gPSBjbGVhclRpbWVvdXQsIGNsZWFyVGltZW91dChlMyk7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIEVvKGUzKTsKICAgICAgICAgICAgICB9IGNhdGNoICh0MykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIEVvLmNhbGwobnVsbCwgZTMpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAodDQpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIEVvLmNhbGwodGhpcywgZTMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfShlMik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEFvKGUyLCB0MikgewogICAgICAgICAgdGhpcy5mdW4gPSBlMiwgdGhpcy5hcnJheSA9IHQyOwogICAgICAgIH0KICAgICAgICBBby5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB0aGlzLmZ1bi5hcHBseShudWxsLCB0aGlzLmFycmF5KTsKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIEZvKCkgewogICAgICAgIH0KICAgICAgICB2YXIgd28gPSBGbywga28gPSBGbywgTm8gPSBGbywgT28gPSBGbywgeG8gPSBGbywgSW8gPSBGbywgUG8gPSBGbzsKICAgICAgICB2YXIgUm8gPSBEby5wZXJmb3JtYW5jZSB8fCB7fSwgTG8gPSBSby5ub3cgfHwgUm8ubW96Tm93IHx8IFJvLm1zTm93IHx8IFJvLm9Ob3cgfHwgUm8ud2Via2l0Tm93IHx8IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIH07CiAgICAgICAgdmFyIEJvID0gbmV3IERhdGUoKTsKICAgICAgICB2YXIgcW8gPSB7IG5leHRUaWNrOiBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHQyID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGggLSAxKTsKICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkKICAgICAgICAgICAgZm9yICh2YXIgcjIgPSAxOyByMiA8IGFyZ3VtZW50cy5sZW5ndGg7IHIyKyspCiAgICAgICAgICAgICAgdDJbcjIgLSAxXSA9IGFyZ3VtZW50c1tyMl07CiAgICAgICAgICBiby5wdXNoKG5ldyBBbyhlMiwgdDIpKSwgYm8ubGVuZ3RoICE9PSAxIHx8IFNvIHx8IENvKHZvKTsKICAgICAgICB9LCB0aXRsZTogImJyb3dzZXIiLCBicm93c2VyOiB0cnVlLCBlbnY6IHt9LCBhcmd2OiBbXSwgdmVyc2lvbjogIiIsIHZlcnNpb25zOiB7fSwgb246IHdvLCBhZGRMaXN0ZW5lcjoga28sIG9uY2U6IE5vLCBvZmY6IE9vLCByZW1vdmVMaXN0ZW5lcjogeG8sIHJlbW92ZUFsbExpc3RlbmVyczogSW8sIGVtaXQ6IFBvLCBiaW5kaW5nOiBmdW5jdGlvbihlMikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCIpOwogICAgICAgIH0sIGN3ZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gIi8iOwogICAgICAgIH0sIGNoZGlyOiBmdW5jdGlvbihlMikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICB9LCB1bWFzazogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9LCBocnRpbWU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDIgPSAxZS0zICogTG8uY2FsbChSbyksIHIyID0gTWF0aC5mbG9vcih0MiksIG4yID0gTWF0aC5mbG9vcih0MiAlIDEgKiAxZTkpOwogICAgICAgICAgcmV0dXJuIGUyICYmIChyMiAtPSBlMlswXSwgKG4yIC09IGUyWzFdKSA8IDAgJiYgKHIyLS0sIG4yICs9IDFlOSkpLCBbcjIsIG4yXTsKICAgICAgICB9LCBwbGF0Zm9ybTogImJyb3dzZXIiLCByZWxlYXNlOiB7fSwgY29uZmlnOiB7fSwgdXB0aW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAobmV3IERhdGUoKSAtIEJvKSAvIDFlMzsKICAgICAgICB9IH0sICRvID0gcW87CiAgICAgICAgY29uc3QgTW8gPSB0eXBlb2YgJG8gPT0gIm9iamVjdCIgJiYgJG8uZW52ICYmICRvLmVudi5OT0RFX0RFQlVHICYmIC9cYnNlbXZlclxiL2kudGVzdCgkby5lbnYuTk9ERV9ERUJVRykgPyBmdW5jdGlvbigpIHsKICAgICAgICAgIGZvciAodmFyIGUyID0gYXJndW1lbnRzLmxlbmd0aCwgdDIgPSBuZXcgQXJyYXkoZTIpLCByMiA9IDA7IHIyIDwgZTI7IHIyKyspCiAgICAgICAgICAgIHQyW3IyXSA9IGFyZ3VtZW50c1tyMl07CiAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcigiU0VNVkVSIiwgLi4udDIpOwogICAgICAgIH0gOiAoKSA9PiB7CiAgICAgICAgfTsKICAgICAgICB2YXIgam8gPSBNbzsKICAgICAgICB2YXIgVW8gPSB7IFNFTVZFUl9TUEVDX1ZFUlNJT046ICIyLjAuMCIsIE1BWF9MRU5HVEg6IDI1NiwgTUFYX1NBRkVfSU5URUdFUjogTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgfHwgOTAwNzE5OTI1NDc0MDk5MSwgTUFYX1NBRkVfQ09NUE9ORU5UX0xFTkdUSDogMTYgfSwgR28gPSB7IGV4cG9ydHM6IHt9IH07CiAgICAgICAgIWZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgeyBNQVhfU0FGRV9DT01QT05FTlRfTEVOR1RIOiByMiB9ID0gVW8sIG4yID0gam8sIGkyID0gKHQyID0gZTIuZXhwb3J0cyA9IHt9KS5yZSA9IFtdLCBzMiA9IHQyLnNyYyA9IFtdLCBvMiA9IHQyLnQgPSB7fTsKICAgICAgICAgIGxldCBhMiA9IDA7CiAgICAgICAgICBjb25zdCB1MiA9IChlMywgdDMsIHIzKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHUzID0gYTIrKzsKICAgICAgICAgICAgbjIodTMsIHQzKSwgbzJbZTNdID0gdTMsIHMyW3UzXSA9IHQzLCBpMlt1M10gPSBuZXcgUmVnRXhwKHQzLCByMyA/ICJnIiA6IHZvaWQgMCk7CiAgICAgICAgICB9OwogICAgICAgICAgdTIoIk5VTUVSSUNJREVOVElGSUVSIiwgIjB8WzEtOV1cXGQqIiksIHUyKCJOVU1FUklDSURFTlRJRklFUkxPT1NFIiwgIlswLTldKyIpLCB1MigiTk9OTlVNRVJJQ0lERU5USUZJRVIiLCAiXFxkKlthLXpBLVotXVthLXpBLVowLTktXSoiKSwgdTIoIk1BSU5WRVJTSU9OIiwgIigiLmNvbmNhdChzMltvMi5OVU1FUklDSURFTlRJRklFUl0sICIpXFwuIikgKyAiKCIuY29uY2F0KHMyW28yLk5VTUVSSUNJREVOVElGSUVSXSwgIilcXC4iKSArICIoIi5jb25jYXQoczJbbzIuTlVNRVJJQ0lERU5USUZJRVJdLCAiKSIpKSwgdTIoIk1BSU5WRVJTSU9OTE9PU0UiLCAiKCIuY29uY2F0KHMyW28yLk5VTUVSSUNJREVOVElGSUVSTE9PU0VdLCAiKVxcLiIpICsgIigiLmNvbmNhdChzMltvMi5OVU1FUklDSURFTlRJRklFUkxPT1NFXSwgIilcXC4iKSArICIoIi5jb25jYXQoczJbbzIuTlVNRVJJQ0lERU5USUZJRVJMT09TRV0sICIpIikpLCB1MigiUFJFUkVMRUFTRUlERU5USUZJRVIiLCAiKD86Ii5jb25jYXQoczJbbzIuTlVNRVJJQ0lERU5USUZJRVJdLCAifCIpLmNvbmNhdChzMltvMi5OT05OVU1FUklDSURFTlRJRklFUl0sICIpIikpLCB1MigiUFJFUkVMRUFTRUlERU5USUZJRVJMT09TRSIsICIoPzoiLmNvbmNhdChzMltvMi5OVU1FUklDSURFTlRJRklFUkxPT1NFXSwgInwiKS5jb25jYXQoczJbbzIuTk9OTlVNRVJJQ0lERU5USUZJRVJdLCAiKSIpKSwgdTIoIlBSRVJFTEVBU0UiLCAiKD86LSgiLmNvbmNhdChzMltvMi5QUkVSRUxFQVNFSURFTlRJRklFUl0sICIoPzpcXC4iKS5jb25jYXQoczJbbzIuUFJFUkVMRUFTRUlERU5USUZJRVJdLCAiKSopKSIpKSwgdTIoIlBSRVJFTEVBU0VMT09TRSIsICIoPzotPygiLmNvbmNhdChzMltvMi5QUkVSRUxFQVNFSURFTlRJRklFUkxPT1NFXSwgIig/OlxcLiIpLmNvbmNhdChzMltvMi5QUkVSRUxFQVNFSURFTlRJRklFUkxPT1NFXSwgIikqKSkiKSksIHUyKCJCVUlMRElERU5USUZJRVIiLCAiWzAtOUEtWmEtei1dKyIpLCB1MigiQlVJTEQiLCAiKD86XFwrKCIuY29uY2F0KHMyW28yLkJVSUxESURFTlRJRklFUl0sICIoPzpcXC4iKS5jb25jYXQoczJbbzIuQlVJTERJREVOVElGSUVSXSwgIikqKSkiKSksIHUyKCJGVUxMUExBSU4iLCAidj8iLmNvbmNhdChzMltvMi5NQUlOVkVSU0lPTl0pLmNvbmNhdChzMltvMi5QUkVSRUxFQVNFXSwgIj8iKS5jb25jYXQoczJbbzIuQlVJTERdLCAiPyIpKSwgdTIoIkZVTEwiLCAiXiIuY29uY2F0KHMyW28yLkZVTExQTEFJTl0sICIkIikpLCB1MigiTE9PU0VQTEFJTiIsICJbdj1cXHNdKiIuY29uY2F0KHMyW28yLk1BSU5WRVJTSU9OTE9PU0VdKS5jb25jYXQoczJbbzIuUFJFUkVMRUFTRUxPT1NFXSwgIj8iKS5jb25jYXQoczJbbzIuQlVJTERdLCAiPyIpKSwgdTIoIkxPT1NFIiwgIl4iLmNvbmNhdChzMltvMi5MT09TRVBMQUlOXSwgIiQiKSksIHUyKCJHVExUIiwgIigoPzo8fD4pPz0/KSIpLCB1MigiWFJBTkdFSURFTlRJRklFUkxPT1NFIiwgIiIuY29uY2F0KHMyW28yLk5VTUVSSUNJREVOVElGSUVSTE9PU0VdLCAifHh8WHxcXCoiKSksIHUyKCJYUkFOR0VJREVOVElGSUVSIiwgIiIuY29uY2F0KHMyW28yLk5VTUVSSUNJREVOVElGSUVSXSwgInx4fFh8XFwqIikpLCB1MigiWFJBTkdFUExBSU4iLCAiW3Y9XFxzXSooIi5jb25jYXQoczJbbzIuWFJBTkdFSURFTlRJRklFUl0sICIpIikgKyAiKD86XFwuKCIuY29uY2F0KHMyW28yLlhSQU5HRUlERU5USUZJRVJdLCAiKSIpICsgIig/OlxcLigiLmNvbmNhdChzMltvMi5YUkFOR0VJREVOVElGSUVSXSwgIikiKSArICIoPzoiLmNvbmNhdChzMltvMi5QUkVSRUxFQVNFXSwgIik/IikuY29uY2F0KHMyW28yLkJVSUxEXSwgIj8iKSArICIpPyk/IiksIHUyKCJYUkFOR0VQTEFJTkxPT1NFIiwgIlt2PVxcc10qKCIuY29uY2F0KHMyW28yLlhSQU5HRUlERU5USUZJRVJMT09TRV0sICIpIikgKyAiKD86XFwuKCIuY29uY2F0KHMyW28yLlhSQU5HRUlERU5USUZJRVJMT09TRV0sICIpIikgKyAiKD86XFwuKCIuY29uY2F0KHMyW28yLlhSQU5HRUlERU5USUZJRVJMT09TRV0sICIpIikgKyAiKD86Ii5jb25jYXQoczJbbzIuUFJFUkVMRUFTRUxPT1NFXSwgIik/IikuY29uY2F0KHMyW28yLkJVSUxEXSwgIj8iKSArICIpPyk/IiksIHUyKCJYUkFOR0UiLCAiXiIuY29uY2F0KHMyW28yLkdUTFRdLCAiXFxzKiIpLmNvbmNhdChzMltvMi5YUkFOR0VQTEFJTl0sICIkIikpLCB1MigiWFJBTkdFTE9PU0UiLCAiXiIuY29uY2F0KHMyW28yLkdUTFRdLCAiXFxzKiIpLmNvbmNhdChzMltvMi5YUkFOR0VQTEFJTkxPT1NFXSwgIiQiKSksIHUyKCJDT0VSQ0UiLCAiIi5jb25jYXQoIihefFteXFxkXSkoXFxkezEsIikuY29uY2F0KHIyLCAifSkiKSArICIoPzpcXC4oXFxkezEsIi5jb25jYXQocjIsICJ9KSk/IikgKyAiKD86XFwuKFxcZHsxLCIuY29uY2F0KHIyLCAifSkpPyIpICsgIig/OiR8W15cXGRdKSIpLCB1MigiQ09FUkNFUlRMIiwgczJbbzIuQ09FUkNFXSwgdHJ1ZSksIHUyKCJMT05FVElMREUiLCAiKD86fj4/KSIpLCB1MigiVElMREVUUklNIiwgIihcXHMqKSIuY29uY2F0KHMyW28yLkxPTkVUSUxERV0sICJcXHMrIiksIHRydWUpLCB0Mi50aWxkZVRyaW1SZXBsYWNlID0gIiQxfiIsIHUyKCJUSUxERSIsICJeIi5jb25jYXQoczJbbzIuTE9ORVRJTERFXSkuY29uY2F0KHMyW28yLlhSQU5HRVBMQUlOXSwgIiQiKSksIHUyKCJUSUxERUxPT1NFIiwgIl4iLmNvbmNhdChzMltvMi5MT05FVElMREVdKS5jb25jYXQoczJbbzIuWFJBTkdFUExBSU5MT09TRV0sICIkIikpLCB1MigiTE9ORUNBUkVUIiwgIig/OlxcXikiKSwgdTIoIkNBUkVUVFJJTSIsICIoXFxzKikiLmNvbmNhdChzMltvMi5MT05FQ0FSRVRdLCAiXFxzKyIpLCB0cnVlKSwgdDIuY2FyZXRUcmltUmVwbGFjZSA9ICIkMV4iLCB1MigiQ0FSRVQiLCAiXiIuY29uY2F0KHMyW28yLkxPTkVDQVJFVF0pLmNvbmNhdChzMltvMi5YUkFOR0VQTEFJTl0sICIkIikpLCB1MigiQ0FSRVRMT09TRSIsICJeIi5jb25jYXQoczJbbzIuTE9ORUNBUkVUXSkuY29uY2F0KHMyW28yLlhSQU5HRVBMQUlOTE9PU0VdLCAiJCIpKSwgdTIoIkNPTVBBUkFUT1JMT09TRSIsICJeIi5jb25jYXQoczJbbzIuR1RMVF0sICJcXHMqKCIpLmNvbmNhdChzMltvMi5MT09TRVBMQUlOXSwgIikkfF4kIikpLCB1MigiQ09NUEFSQVRPUiIsICJeIi5jb25jYXQoczJbbzIuR1RMVF0sICJcXHMqKCIpLmNvbmNhdChzMltvMi5GVUxMUExBSU5dLCAiKSR8XiQiKSksIHUyKCJDT01QQVJBVE9SVFJJTSIsICIoXFxzKikiLmNvbmNhdChzMltvMi5HVExUXSwgIlxccyooIikuY29uY2F0KHMyW28yLkxPT1NFUExBSU5dLCAifCIpLmNvbmNhdChzMltvMi5YUkFOR0VQTEFJTl0sICIpIiksIHRydWUpLCB0Mi5jb21wYXJhdG9yVHJpbVJlcGxhY2UgPSAiJDEkMiQzIiwgdTIoIkhZUEhFTlJBTkdFIiwgIl5cXHMqKCIuY29uY2F0KHMyW28yLlhSQU5HRVBMQUlOXSwgIikiKSArICJcXHMrLVxccysiICsgIigiLmNvbmNhdChzMltvMi5YUkFOR0VQTEFJTl0sICIpIikgKyAiXFxzKiQiKSwgdTIoIkhZUEhFTlJBTkdFTE9PU0UiLCAiXlxccyooIi5jb25jYXQoczJbbzIuWFJBTkdFUExBSU5MT09TRV0sICIpIikgKyAiXFxzKy1cXHMrIiArICIoIi5jb25jYXQoczJbbzIuWFJBTkdFUExBSU5MT09TRV0sICIpIikgKyAiXFxzKiQiKSwgdTIoIlNUQVIiLCAiKDx8Pik/PT9cXHMqXFwqIiksIHUyKCJHVEUwIiwgIl5cXHMqPj1cXHMqMC4wLjBcXHMqJCIpLCB1MigiR1RFMFBSRSIsICJeXFxzKj49XFxzKjAuMC4wLTBcXHMqJCIpOwogICAgICAgIH0oR28sIEdvLmV4cG9ydHMpOwogICAgICAgIGNvbnN0IFZvID0gWyJpbmNsdWRlUHJlcmVsZWFzZSIsICJsb29zZSIsICJydGwiXTsKICAgICAgICB2YXIgWG8gPSAoZTIpID0+IGUyID8gdHlwZW9mIGUyICE9ICJvYmplY3QiID8geyBsb29zZTogdHJ1ZSB9IDogVm8uZmlsdGVyKCh0MikgPT4gZTJbdDJdKS5yZWR1Y2UoKGUzLCB0MikgPT4gKGUzW3QyXSA9IHRydWUsIGUzKSwge30pIDoge307CiAgICAgICAgY29uc3QgSG8gPSAvXlswLTldKyQvLCB6byA9IChlMiwgdDIpID0+IHsKICAgICAgICAgIGNvbnN0IHIyID0gSG8udGVzdChlMiksIG4yID0gSG8udGVzdCh0Mik7CiAgICAgICAgICByZXR1cm4gcjIgJiYgbjIgJiYgKGUyID0gK2UyLCB0MiA9ICt0MiksIGUyID09PSB0MiA/IDAgOiByMiAmJiAhbjIgPyAtMSA6IG4yICYmICFyMiA/IDEgOiBlMiA8IHQyID8gLTEgOiAxOwogICAgICAgIH07CiAgICAgICAgdmFyIFdvID0geyBjb21wYXJlSWRlbnRpZmllcnM6IHpvLCByY29tcGFyZUlkZW50aWZpZXJzOiAoZTIsIHQyKSA9PiB6byh0MiwgZTIpIH07CiAgICAgICAgY29uc3QgWW8gPSBqbywgeyBNQVhfTEVOR1RIOiBRbywgTUFYX1NBRkVfSU5URUdFUjogSm8gfSA9IFVvLCB7IHJlOiBabywgdDogS28gfSA9IEdvLmV4cG9ydHMsIGVhID0gWG8sIHsgY29tcGFyZUlkZW50aWZpZXJzOiB0YSB9ID0gV287CiAgICAgICAgY2xhc3MgcmEgewogICAgICAgICAgY29uc3RydWN0b3IoZTIsIHQyKSB7CiAgICAgICAgICAgIGlmICh0MiA9IGVhKHQyKSwgZTIgaW5zdGFuY2VvZiByYSkgewogICAgICAgICAgICAgIGlmIChlMi5sb29zZSA9PT0gISF0Mi5sb29zZSAmJiBlMi5pbmNsdWRlUHJlcmVsZWFzZSA9PT0gISF0Mi5pbmNsdWRlUHJlcmVsZWFzZSkKICAgICAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICAgICAgICBlMiA9IGUyLnZlcnNpb247CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGUyICE9ICJzdHJpbmciKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgVmVyc2lvbjogIi5jb25jYXQoZTIpKTsKICAgICAgICAgICAgaWYgKGUyLmxlbmd0aCA+IFFvKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoInZlcnNpb24gaXMgbG9uZ2VyIHRoYW4gIi5jb25jYXQoUW8sICIgY2hhcmFjdGVycyIpKTsKICAgICAgICAgICAgWW8oIlNlbVZlciIsIGUyLCB0MiksIHRoaXMub3B0aW9ucyA9IHQyLCB0aGlzLmxvb3NlID0gISF0Mi5sb29zZSwgdGhpcy5pbmNsdWRlUHJlcmVsZWFzZSA9ICEhdDIuaW5jbHVkZVByZXJlbGVhc2U7CiAgICAgICAgICAgIGNvbnN0IHIyID0gZTIudHJpbSgpLm1hdGNoKHQyLmxvb3NlID8gWm9bS28uTE9PU0VdIDogWm9bS28uRlVMTF0pOwogICAgICAgICAgICBpZiAoIXIyKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgVmVyc2lvbjogIi5jb25jYXQoZTIpKTsKICAgICAgICAgICAgaWYgKHRoaXMucmF3ID0gZTIsIHRoaXMubWFqb3IgPSArcjJbMV0sIHRoaXMubWlub3IgPSArcjJbMl0sIHRoaXMucGF0Y2ggPSArcjJbM10sIHRoaXMubWFqb3IgPiBKbyB8fCB0aGlzLm1ham9yIDwgMCkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIG1ham9yIHZlcnNpb24iKTsKICAgICAgICAgICAgaWYgKHRoaXMubWlub3IgPiBKbyB8fCB0aGlzLm1pbm9yIDwgMCkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIG1pbm9yIHZlcnNpb24iKTsKICAgICAgICAgICAgaWYgKHRoaXMucGF0Y2ggPiBKbyB8fCB0aGlzLnBhdGNoIDwgMCkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIHBhdGNoIHZlcnNpb24iKTsKICAgICAgICAgICAgcjJbNF0gPyB0aGlzLnByZXJlbGVhc2UgPSByMls0XS5zcGxpdCgiLiIpLm1hcCgoZTMpID0+IHsKICAgICAgICAgICAgICBpZiAoL15bMC05XSskLy50ZXN0KGUzKSkgewogICAgICAgICAgICAgICAgY29uc3QgdDMgPSArZTM7CiAgICAgICAgICAgICAgICBpZiAodDMgPj0gMCAmJiB0MyA8IEpvKQogICAgICAgICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBlMzsKICAgICAgICAgICAgfSkgOiB0aGlzLnByZXJlbGVhc2UgPSBbXSwgdGhpcy5idWlsZCA9IHIyWzVdID8gcjJbNV0uc3BsaXQoIi4iKSA6IFtdLCB0aGlzLmZvcm1hdCgpOwogICAgICAgICAgfQogICAgICAgICAgZm9ybWF0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uID0gIiIuY29uY2F0KHRoaXMubWFqb3IsICIuIikuY29uY2F0KHRoaXMubWlub3IsICIuIikuY29uY2F0KHRoaXMucGF0Y2gpLCB0aGlzLnByZXJlbGVhc2UubGVuZ3RoICYmICh0aGlzLnZlcnNpb24gKz0gIi0iLmNvbmNhdCh0aGlzLnByZXJlbGVhc2Uuam9pbigiLiIpKSksIHRoaXMudmVyc2lvbjsKICAgICAgICAgIH0KICAgICAgICAgIHRvU3RyaW5nKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uOwogICAgICAgICAgfQogICAgICAgICAgY29tcGFyZShlMikgewogICAgICAgICAgICBpZiAoWW8oIlNlbVZlci5jb21wYXJlIiwgdGhpcy52ZXJzaW9uLCB0aGlzLm9wdGlvbnMsIGUyKSwgIShlMiBpbnN0YW5jZW9mIHJhKSkgewogICAgICAgICAgICAgIGlmICh0eXBlb2YgZTIgPT0gInN0cmluZyIgJiYgZTIgPT09IHRoaXMudmVyc2lvbikKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgIGUyID0gbmV3IHJhKGUyLCB0aGlzLm9wdGlvbnMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlMi52ZXJzaW9uID09PSB0aGlzLnZlcnNpb24gPyAwIDogdGhpcy5jb21wYXJlTWFpbihlMikgfHwgdGhpcy5jb21wYXJlUHJlKGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbXBhcmVNYWluKGUyKSB7CiAgICAgICAgICAgIHJldHVybiBlMiBpbnN0YW5jZW9mIHJhIHx8IChlMiA9IG5ldyByYShlMiwgdGhpcy5vcHRpb25zKSksIHRhKHRoaXMubWFqb3IsIGUyLm1ham9yKSB8fCB0YSh0aGlzLm1pbm9yLCBlMi5taW5vcikgfHwgdGEodGhpcy5wYXRjaCwgZTIucGF0Y2gpOwogICAgICAgICAgfQogICAgICAgICAgY29tcGFyZVByZShlMikgewogICAgICAgICAgICBpZiAoZTIgaW5zdGFuY2VvZiByYSB8fCAoZTIgPSBuZXcgcmEoZTIsIHRoaXMub3B0aW9ucykpLCB0aGlzLnByZXJlbGVhc2UubGVuZ3RoICYmICFlMi5wcmVyZWxlYXNlLmxlbmd0aCkKICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIGlmICghdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCAmJiBlMi5wcmVyZWxlYXNlLmxlbmd0aCkKICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgaWYgKCF0aGlzLnByZXJlbGVhc2UubGVuZ3RoICYmICFlMi5wcmVyZWxlYXNlLmxlbmd0aCkKICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgbGV0IHQyID0gMDsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5wcmVyZWxlYXNlW3QyXSwgbjIgPSBlMi5wcmVyZWxlYXNlW3QyXTsKICAgICAgICAgICAgICBpZiAoWW8oInByZXJlbGVhc2UgY29tcGFyZSIsIHQyLCByMiwgbjIpLCByMiA9PT0gdm9pZCAwICYmIG4yID09PSB2b2lkIDApCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICBpZiAobjIgPT09IHZvaWQgMCkKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICAgIGlmIChyMiA9PT0gdm9pZCAwKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICAgIGlmIChyMiAhPT0gbjIpCiAgICAgICAgICAgICAgICByZXR1cm4gdGEocjIsIG4yKTsKICAgICAgICAgICAgfSB3aGlsZSAoKyt0Mik7CiAgICAgICAgICB9CiAgICAgICAgICBjb21wYXJlQnVpbGQoZTIpIHsKICAgICAgICAgICAgZTIgaW5zdGFuY2VvZiByYSB8fCAoZTIgPSBuZXcgcmEoZTIsIHRoaXMub3B0aW9ucykpOwogICAgICAgICAgICBsZXQgdDIgPSAwOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgY29uc3QgcjIgPSB0aGlzLmJ1aWxkW3QyXSwgbjIgPSBlMi5idWlsZFt0Ml07CiAgICAgICAgICAgICAgaWYgKFlvKCJwcmVyZWxlYXNlIGNvbXBhcmUiLCB0MiwgcjIsIG4yKSwgcjIgPT09IHZvaWQgMCAmJiBuMiA9PT0gdm9pZCAwKQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgaWYgKG4yID09PSB2b2lkIDApCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICBpZiAocjIgPT09IHZvaWQgMCkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgICBpZiAocjIgIT09IG4yKQogICAgICAgICAgICAgICAgcmV0dXJuIHRhKHIyLCBuMik7CiAgICAgICAgICAgIH0gd2hpbGUgKCsrdDIpOwogICAgICAgICAgfQogICAgICAgICAgaW5jKGUyLCB0MikgewogICAgICAgICAgICBzd2l0Y2ggKGUyKSB7CiAgICAgICAgICAgICAgY2FzZSAicHJlbWFqb3IiOgogICAgICAgICAgICAgICAgdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCA9IDAsIHRoaXMucGF0Y2ggPSAwLCB0aGlzLm1pbm9yID0gMCwgdGhpcy5tYWpvcisrLCB0aGlzLmluYygicHJlIiwgdDIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAicHJlbWlub3IiOgogICAgICAgICAgICAgICAgdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCA9IDAsIHRoaXMucGF0Y2ggPSAwLCB0aGlzLm1pbm9yKyssIHRoaXMuaW5jKCJwcmUiLCB0Mik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJwcmVwYXRjaCI6CiAgICAgICAgICAgICAgICB0aGlzLnByZXJlbGVhc2UubGVuZ3RoID0gMCwgdGhpcy5pbmMoInBhdGNoIiwgdDIpLCB0aGlzLmluYygicHJlIiwgdDIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAicHJlcmVsZWFzZSI6CiAgICAgICAgICAgICAgICB0aGlzLnByZXJlbGVhc2UubGVuZ3RoID09PSAwICYmIHRoaXMuaW5jKCJwYXRjaCIsIHQyKSwgdGhpcy5pbmMoInByZSIsIHQyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIm1ham9yIjoKICAgICAgICAgICAgICAgIHRoaXMubWlub3IgPT09IDAgJiYgdGhpcy5wYXRjaCA9PT0gMCAmJiB0aGlzLnByZXJlbGVhc2UubGVuZ3RoICE9PSAwIHx8IHRoaXMubWFqb3IrKywgdGhpcy5taW5vciA9IDAsIHRoaXMucGF0Y2ggPSAwLCB0aGlzLnByZXJlbGVhc2UgPSBbXTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIm1pbm9yIjoKICAgICAgICAgICAgICAgIHRoaXMucGF0Y2ggPT09IDAgJiYgdGhpcy5wcmVyZWxlYXNlLmxlbmd0aCAhPT0gMCB8fCB0aGlzLm1pbm9yKyssIHRoaXMucGF0Y2ggPSAwLCB0aGlzLnByZXJlbGVhc2UgPSBbXTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInBhdGNoIjoKICAgICAgICAgICAgICAgIHRoaXMucHJlcmVsZWFzZS5sZW5ndGggPT09IDAgJiYgdGhpcy5wYXRjaCsrLCB0aGlzLnByZXJlbGVhc2UgPSBbXTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInByZSI6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmVyZWxlYXNlLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgICAgICAgdGhpcy5wcmVyZWxlYXNlID0gWzBdOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIGxldCBlMyA9IHRoaXMucHJlcmVsZWFzZS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgIGZvciAoOyAtLWUzID49IDA7ICkKICAgICAgICAgICAgICAgICAgICB0eXBlb2YgdGhpcy5wcmVyZWxlYXNlW2UzXSA9PSAibnVtYmVyIiAmJiAodGhpcy5wcmVyZWxlYXNlW2UzXSsrLCBlMyA9IC0yKTsKICAgICAgICAgICAgICAgICAgZTMgPT09IC0xICYmIHRoaXMucHJlcmVsZWFzZS5wdXNoKDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdDIgJiYgKHRoaXMucHJlcmVsZWFzZVswXSA9PT0gdDIgPyBpc05hTih0aGlzLnByZXJlbGVhc2VbMV0pICYmICh0aGlzLnByZXJlbGVhc2UgPSBbdDIsIDBdKSA6IHRoaXMucHJlcmVsZWFzZSA9IFt0MiwgMF0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBpbmNyZW1lbnQgYXJndW1lbnQ6ICIuY29uY2F0KGUyKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0KCksIHRoaXMucmF3ID0gdGhpcy52ZXJzaW9uLCB0aGlzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBuYSA9IHJhOwogICAgICAgIHZhciBpYSA9IChlMiwgdDIsIHIyKSA9PiBuZXcgbmEoZTIsIHIyKS5jb21wYXJlKG5ldyBuYSh0MiwgcjIpKTsKICAgICAgICBjb25zdCBzYSA9IGlhOwogICAgICAgIHZhciBvYSA9IChlMiwgdDIsIHIyKSA9PiBzYShlMiwgdDIsIHIyKSA8IDA7CiAgICAgICAgY29uc3QgYWEgPSBpYTsKICAgICAgICB2YXIgdWEsIGNhLCBsYSwgcGEsIGhhLCBEYSwgZmEgPSAoZTIsIHQyLCByMikgPT4gYWEoZTIsIHQyLCByMikgPj0gMCwgZGEgPSB7IGV4cG9ydHM6IHt9IH07CiAgICAgICAgIWZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgZnVuY3Rpb24gcjIoKSB7CiAgICAgICAgICAgIGZvciAodmFyIGUzID0gW10sIHQzID0gMDsgdDMgPCBhcmd1bWVudHMubGVuZ3RoOyB0MysrKQogICAgICAgICAgICAgIGUzW3QzXSA9IGFyZ3VtZW50c1t0M107CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBuMigpIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBXZWFrTWFwICE9ICJ1bmRlZmluZWQiID8gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCkgOiB7IGFkZDogcjIsIGRlbGV0ZTogcjIsIGdldDogcjIsIHNldDogcjIsIGhhczogZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0gfTsKICAgICAgICAgIH0KICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0MiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCB0Mi5vdXRkZW50ID0gdm9pZCAwOwogICAgICAgICAgdmFyIGkyID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSwgczIgPSBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgcmV0dXJuIGkyLmNhbGwoZTMsIHQzKTsKICAgICAgICAgIH07CiAgICAgICAgICBmdW5jdGlvbiBvMihlMywgdDMpIHsKICAgICAgICAgICAgZm9yICh2YXIgcjMgaW4gdDMpCiAgICAgICAgICAgICAgczIodDMsIHIzKSAmJiAoZTNbcjNdID0gdDNbcjNdKTsKICAgICAgICAgICAgcmV0dXJuIGUzOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGEyID0gL15bIFx0XSooPzpcclxufFxyfFxuKS8sIHUyID0gLyg/OlxyXG58XHJ8XG4pWyBcdF0qJC8sIGMyID0gL14oPzpbXHJcbl18JCkvLCBsMiA9IC8oPzpcclxufFxyfFxuKShbIFx0XSopKD86W14gXHRcclxuXXwkKS8sIHAyID0gL15bIFx0XSpbXHJcbl1bIFx0XHJcbl0qJC87CiAgICAgICAgICBmdW5jdGlvbiBoMihlMywgdDMsIHIzKSB7CiAgICAgICAgICAgIHZhciBuMyA9IDAsIGkzID0gZTNbMF0ubWF0Y2gobDIpOwogICAgICAgICAgICBpMyAmJiAobjMgPSBpM1sxXS5sZW5ndGgpOwogICAgICAgICAgICB2YXIgczMgPSBuZXcgUmVnRXhwKCIoXFxyXFxufFxccnxcXG4pLnswLCIgKyBuMyArICJ9IiwgImciKTsKICAgICAgICAgICAgdDMgJiYgKGUzID0gZTMuc2xpY2UoMSkpOwogICAgICAgICAgICB2YXIgbzMgPSByMy5uZXdsaW5lLCBjMyA9IHIzLnRyaW1MZWFkaW5nTmV3bGluZSwgcDMgPSByMy50cmltVHJhaWxpbmdOZXdsaW5lLCBoMyA9IHR5cGVvZiBvMyA9PSAic3RyaW5nIiwgRDMgPSBlMy5sZW5ndGg7CiAgICAgICAgICAgIHJldHVybiBlMy5tYXAoZnVuY3Rpb24oZTQsIHQ0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGU0ID0gZTQucmVwbGFjZShzMywgIiQxIiksIHQ0ID09PSAwICYmIGMzICYmIChlNCA9IGU0LnJlcGxhY2UoYTIsICIiKSksIHQ0ID09PSBEMyAtIDEgJiYgcDMgJiYgKGU0ID0gZTQucmVwbGFjZSh1MiwgIiIpKSwgaDMgJiYgKGU0ID0gZTQucmVwbGFjZSgvXHJcbnxcbnxcci9nLCBmdW5jdGlvbihlNSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG8zOwogICAgICAgICAgICAgIH0pKSwgZTQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gRDIoZTMsIHQzKSB7CiAgICAgICAgICAgIGZvciAodmFyIHIzID0gIiIsIG4zID0gMCwgaTMgPSBlMy5sZW5ndGg7IG4zIDwgaTM7IG4zKyspCiAgICAgICAgICAgICAgcjMgKz0gZTNbbjNdLCBuMyA8IGkzIC0gMSAmJiAocjMgKz0gdDNbbjNdKTsKICAgICAgICAgICAgcmV0dXJuIHIzOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gZjIoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIHMyKGUzLCAicmF3IikgJiYgczIoZTMsICJsZW5ndGgiKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBkMiA9IGZ1bmN0aW9uIGUzKHQzKSB7CiAgICAgICAgICAgIHZhciByMyA9IG4yKCksIGkzID0gbjIoKSwgczMgPSBvMihmdW5jdGlvbiBuMyhzNCkgewogICAgICAgICAgICAgIGZvciAodmFyIGEzID0gW10sIHUzID0gMTsgdTMgPCBhcmd1bWVudHMubGVuZ3RoOyB1MysrKQogICAgICAgICAgICAgICAgYTNbdTMgLSAxXSA9IGFyZ3VtZW50c1t1M107CiAgICAgICAgICAgICAgaWYgKGYyKHM0KSkgewogICAgICAgICAgICAgICAgdmFyIGwzID0gczQsIGcyID0gKGEzWzBdID09PSBuMyB8fCBhM1swXSA9PT0gZDIpICYmIHAyLnRlc3QobDNbMF0pICYmIGMyLnRlc3QobDNbMV0pLCBtMiA9IGcyID8gaTMgOiByMywgRTIgPSBtMi5nZXQobDMpOwogICAgICAgICAgICAgICAgaWYgKEUyIHx8IChFMiA9IGgyKGwzLCBnMiwgdDMpLCBtMi5zZXQobDMsIEUyKSksIGEzLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgICAgICAgcmV0dXJuIEUyWzBdOwogICAgICAgICAgICAgICAgdmFyIEMyID0gRDIoRTIsIGcyID8gYTMuc2xpY2UoMSkgOiBhMyk7CiAgICAgICAgICAgICAgICByZXR1cm4gQzI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBlMyhvMihvMih7fSwgdDMpLCBzNCB8fCB7fSkpOwogICAgICAgICAgICB9LCB7IHN0cmluZzogZnVuY3Rpb24oZTQpIHsKICAgICAgICAgICAgICByZXR1cm4gaDIoW2U0XSwgZmFsc2UsIHQzKVswXTsKICAgICAgICAgICAgfSB9KTsKICAgICAgICAgICAgcmV0dXJuIHMzOwogICAgICAgICAgfSh7IHRyaW1MZWFkaW5nTmV3bGluZTogdHJ1ZSwgdHJpbVRyYWlsaW5nTmV3bGluZTogdHJ1ZSB9KTsKICAgICAgICAgIHQyLm91dGRlbnQgPSBkMiwgdDIuZGVmYXVsdCA9IGQyOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZTIuZXhwb3J0cyA9IGQyLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZDIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KSwgZDIuZGVmYXVsdCA9IGQyLCBkMi5vdXRkZW50ID0gZDI7CiAgICAgICAgICB9IGNhdGNoIChlMykgewogICAgICAgICAgfQogICAgICAgIH0oZGEsIGRhLmV4cG9ydHMpOwogICAgICAgIGNvbnN0IHsgb3V0ZGVudDogZ2EgfSA9IGRhLmV4cG9ydHMsIG1hID0gIkNvbmZpZyIsIEVhID0gIkVkaXRvciIsIENhID0gIk90aGVyIiwgeWEgPSAiR2xvYmFsIiwgYmEgPSAiU3BlY2lhbCIsIFNhID0geyBjdXJzb3JPZmZzZXQ6IHsgc2luY2U6ICIxLjQuMCIsIGNhdGVnb3J5OiBiYSwgdHlwZTogImludCIsIGRlZmF1bHQ6IC0xLCByYW5nZTogeyBzdGFydDogLTEsIGVuZDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBzdGVwOiAxIH0sIGRlc2NyaXB0aW9uOiBnYSh1YSB8fCAodWEgPSBOKFsiXG4gICAgICBQcmludCAodG8gc3RkZXJyKSB3aGVyZSBhIGN1cnNvciBhdCB0aGUgZ2l2ZW4gcG9zaXRpb24gd291bGQgbW92ZSB0byBhZnRlciBmb3JtYXR0aW5nLlxuICAgICAgVGhpcyBvcHRpb24gY2Fubm90IGJlIHVzZWQgd2l0aCAtLXJhbmdlLXN0YXJ0IGFuZCAtLXJhbmdlLWVuZC5cbiAgICAiXSkpKSwgY2xpQ2F0ZWdvcnk6IEVhIH0sIGVuZE9mTGluZTogeyBzaW5jZTogIjEuMTUuMCIsIGNhdGVnb3J5OiB5YSwgdHlwZTogImNob2ljZSIsIGRlZmF1bHQ6IFt7IHNpbmNlOiAiMS4xNS4wIiwgdmFsdWU6ICJhdXRvIiB9LCB7IHNpbmNlOiAiMi4wLjAiLCB2YWx1ZTogImxmIiB9XSwgZGVzY3JpcHRpb246ICJXaGljaCBlbmQgb2YgbGluZSBjaGFyYWN0ZXJzIHRvIGFwcGx5LiIsIGNob2ljZXM6IFt7IHZhbHVlOiAibGYiLCBkZXNjcmlwdGlvbjogIkxpbmUgRmVlZCBvbmx5IChcXG4pLCBjb21tb24gb24gTGludXggYW5kIG1hY09TIGFzIHdlbGwgYXMgaW5zaWRlIGdpdCByZXBvcyIgfSwgeyB2YWx1ZTogImNybGYiLCBkZXNjcmlwdGlvbjogIkNhcnJpYWdlIFJldHVybiArIExpbmUgRmVlZCBjaGFyYWN0ZXJzIChcXHJcXG4pLCBjb21tb24gb24gV2luZG93cyIgfSwgeyB2YWx1ZTogImNyIiwgZGVzY3JpcHRpb246ICJDYXJyaWFnZSBSZXR1cm4gY2hhcmFjdGVyIG9ubHkgKFxcciksIHVzZWQgdmVyeSByYXJlbHkiIH0sIHsgdmFsdWU6ICJhdXRvIiwgZGVzY3JpcHRpb246IGdhKGNhIHx8IChjYSA9IE4oWyJcbiAgICAgICAgICBNYWludGFpbiBleGlzdGluZ1xuICAgICAgICAgIChtaXhlZCB2YWx1ZXMgd2l0aGluIG9uZSBmaWxlIGFyZSBub3JtYWxpc2VkIGJ5IGxvb2tpbmcgYXQgd2hhdCdzIHVzZWQgYWZ0ZXIgdGhlIGZpcnN0IGxpbmUpXG4gICAgICAgICJdKSkpIH1dIH0sIGZpbGVwYXRoOiB7IHNpbmNlOiAiMS40LjAiLCBjYXRlZ29yeTogYmEsIHR5cGU6ICJwYXRoIiwgZGVzY3JpcHRpb246ICJTcGVjaWZ5IHRoZSBpbnB1dCBmaWxlcGF0aC4gVGhpcyB3aWxsIGJlIHVzZWQgdG8gZG8gcGFyc2VyIGluZmVyZW5jZS4iLCBjbGlOYW1lOiAic3RkaW4tZmlsZXBhdGgiLCBjbGlDYXRlZ29yeTogQ2EsIGNsaURlc2NyaXB0aW9uOiAiUGF0aCB0byB0aGUgZmlsZSB0byBwcmV0ZW5kIHRoYXQgc3RkaW4gY29tZXMgZnJvbS4iIH0sIGluc2VydFByYWdtYTogeyBzaW5jZTogIjEuOC4wIiwgY2F0ZWdvcnk6IGJhLCB0eXBlOiAiYm9vbGVhbiIsIGRlZmF1bHQ6IGZhbHNlLCBkZXNjcmlwdGlvbjogIkluc2VydCBAZm9ybWF0IHByYWdtYSBpbnRvIGZpbGUncyBmaXJzdCBkb2NibG9jayBjb21tZW50LiIsIGNsaUNhdGVnb3J5OiBDYSB9LCBwYXJzZXI6IHsgc2luY2U6ICIwLjAuMTAiLCBjYXRlZ29yeTogeWEsIHR5cGU6ICJjaG9pY2UiLCBkZWZhdWx0OiBbeyBzaW5jZTogIjAuMC4xMCIsIHZhbHVlOiAiYmFieWxvbiIgfSwgeyBzaW5jZTogIjEuMTMuMCIsIHZhbHVlOiB2b2lkIDAgfV0sIGRlc2NyaXB0aW9uOiAiV2hpY2ggcGFyc2VyIHRvIHVzZS4iLCBleGNlcHRpb246IChlMikgPT4gdHlwZW9mIGUyID09ICJzdHJpbmciIHx8IHR5cGVvZiBlMiA9PSAiZnVuY3Rpb24iLCBjaG9pY2VzOiBbeyB2YWx1ZTogImZsb3ciLCBkZXNjcmlwdGlvbjogIkZsb3ciIH0sIHsgdmFsdWU6ICJiYWJlbCIsIHNpbmNlOiAiMS4xNi4wIiwgZGVzY3JpcHRpb246ICJKYXZhU2NyaXB0IiB9LCB7IHZhbHVlOiAiYmFiZWwtZmxvdyIsIHNpbmNlOiAiMS4xNi4wIiwgZGVzY3JpcHRpb246ICJGbG93IiB9LCB7IHZhbHVlOiAiYmFiZWwtdHMiLCBzaW5jZTogIjIuMC4wIiwgZGVzY3JpcHRpb246ICJUeXBlU2NyaXB0IiB9LCB7IHZhbHVlOiAidHlwZXNjcmlwdCIsIHNpbmNlOiAiMS40LjAiLCBkZXNjcmlwdGlvbjogIlR5cGVTY3JpcHQiIH0sIHsgdmFsdWU6ICJlc3ByZWUiLCBzaW5jZTogIjIuMi4wIiwgZGVzY3JpcHRpb246ICJKYXZhU2NyaXB0IiB9LCB7IHZhbHVlOiAibWVyaXlhaCIsIHNpbmNlOiAiMi4yLjAiLCBkZXNjcmlwdGlvbjogIkphdmFTY3JpcHQiIH0sIHsgdmFsdWU6ICJjc3MiLCBzaW5jZTogIjEuNy4xIiwgZGVzY3JpcHRpb246ICJDU1MiIH0sIHsgdmFsdWU6ICJsZXNzIiwgc2luY2U6ICIxLjcuMSIsIGRlc2NyaXB0aW9uOiAiTGVzcyIgfSwgeyB2YWx1ZTogInNjc3MiLCBzaW5jZTogIjEuNy4xIiwgZGVzY3JpcHRpb246ICJTQ1NTIiB9LCB7IHZhbHVlOiAianNvbiIsIHNpbmNlOiAiMS41LjAiLCBkZXNjcmlwdGlvbjogIkpTT04iIH0sIHsgdmFsdWU6ICJqc29uNSIsIHNpbmNlOiAiMS4xMy4wIiwgZGVzY3JpcHRpb246ICJKU09ONSIgfSwgeyB2YWx1ZTogImpzb24tc3RyaW5naWZ5Iiwgc2luY2U6ICIxLjEzLjAiLCBkZXNjcmlwdGlvbjogIkpTT04uc3RyaW5naWZ5IiB9LCB7IHZhbHVlOiAiZ3JhcGhxbCIsIHNpbmNlOiAiMS41LjAiLCBkZXNjcmlwdGlvbjogIkdyYXBoUUwiIH0sIHsgdmFsdWU6ICJtYXJrZG93biIsIHNpbmNlOiAiMS44LjAiLCBkZXNjcmlwdGlvbjogIk1hcmtkb3duIiB9LCB7IHZhbHVlOiAibWR4Iiwgc2luY2U6ICIxLjE1LjAiLCBkZXNjcmlwdGlvbjogIk1EWCIgfSwgeyB2YWx1ZTogInZ1ZSIsIHNpbmNlOiAiMS4xMC4wIiwgZGVzY3JpcHRpb246ICJWdWUiIH0sIHsgdmFsdWU6ICJ5YW1sIiwgc2luY2U6ICIxLjE0LjAiLCBkZXNjcmlwdGlvbjogIllBTUwiIH0sIHsgdmFsdWU6ICJnbGltbWVyIiwgc2luY2U6ICIyLjMuMCIsIGRlc2NyaXB0aW9uOiAiRW1iZXIgLyBIYW5kbGViYXJzIiB9LCB7IHZhbHVlOiAiaHRtbCIsIHNpbmNlOiAiMS4xNS4wIiwgZGVzY3JpcHRpb246ICJIVE1MIiB9LCB7IHZhbHVlOiAiYW5ndWxhciIsIHNpbmNlOiAiMS4xNS4wIiwgZGVzY3JpcHRpb246ICJBbmd1bGFyIiB9LCB7IHZhbHVlOiAibHdjIiwgc2luY2U6ICIxLjE3LjAiLCBkZXNjcmlwdGlvbjogIkxpZ2h0bmluZyBXZWIgQ29tcG9uZW50cyIgfV0gfSwgcGx1Z2luczogeyBzaW5jZTogIjEuMTAuMCIsIHR5cGU6ICJwYXRoIiwgYXJyYXk6IHRydWUsIGRlZmF1bHQ6IFt7IHZhbHVlOiBbXSB9XSwgY2F0ZWdvcnk6IHlhLCBkZXNjcmlwdGlvbjogIkFkZCBhIHBsdWdpbi4gTXVsdGlwbGUgcGx1Z2lucyBjYW4gYmUgcGFzc2VkIGFzIHNlcGFyYXRlIGAtLXBsdWdpbmBzLiIsIGV4Y2VwdGlvbjogKGUyKSA9PiB0eXBlb2YgZTIgPT0gInN0cmluZyIgfHwgdHlwZW9mIGUyID09ICJvYmplY3QiLCBjbGlOYW1lOiAicGx1Z2luIiwgY2xpQ2F0ZWdvcnk6IG1hIH0sIHBsdWdpblNlYXJjaERpcnM6IHsgc2luY2U6ICIxLjEzLjAiLCB0eXBlOiAicGF0aCIsIGFycmF5OiB0cnVlLCBkZWZhdWx0OiBbeyB2YWx1ZTogW10gfV0sIGNhdGVnb3J5OiB5YSwgZGVzY3JpcHRpb246IGdhKGxhIHx8IChsYSA9IE4oWyJcbiAgICAgIEN1c3RvbSBkaXJlY3RvcnkgdGhhdCBjb250YWlucyBwcmV0dGllciBwbHVnaW5zIGluIG5vZGVfbW9kdWxlcyBzdWJkaXJlY3RvcnkuXG4gICAgICBPdmVycmlkZXMgZGVmYXVsdCBiZWhhdmlvciB3aGVuIHBsdWdpbnMgYXJlIHNlYXJjaGVkIHJlbGF0aXZlbHkgdG8gdGhlIGxvY2F0aW9uIG9mIFByZXR0aWVyLlxuICAgICAgTXVsdGlwbGUgdmFsdWVzIGFyZSBhY2NlcHRlZC5cbiAgICAiXSkpKSwgZXhjZXB0aW9uOiAoZTIpID0+IHR5cGVvZiBlMiA9PSAic3RyaW5nIiB8fCB0eXBlb2YgZTIgPT0gIm9iamVjdCIsIGNsaU5hbWU6ICJwbHVnaW4tc2VhcmNoLWRpciIsIGNsaUNhdGVnb3J5OiBtYSB9LCBwcmludFdpZHRoOiB7IHNpbmNlOiAiMC4wLjAiLCBjYXRlZ29yeTogeWEsIHR5cGU6ICJpbnQiLCBkZWZhdWx0OiA4MCwgZGVzY3JpcHRpb246ICJUaGUgbGluZSBsZW5ndGggd2hlcmUgUHJldHRpZXIgd2lsbCB0cnkgd3JhcC4iLCByYW5nZTogeyBzdGFydDogMCwgZW5kOiBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIHN0ZXA6IDEgfSB9LCByYW5nZUVuZDogeyBzaW5jZTogIjEuNC4wIiwgY2F0ZWdvcnk6IGJhLCB0eXBlOiAiaW50IiwgZGVmYXVsdDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCByYW5nZTogeyBzdGFydDogMCwgZW5kOiBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIHN0ZXA6IDEgfSwgZGVzY3JpcHRpb246IGdhKHBhIHx8IChwYSA9IE4oWyJcbiAgICAgIEZvcm1hdCBjb2RlIGVuZGluZyBhdCBhIGdpdmVuIGNoYXJhY3RlciBvZmZzZXQgKGV4Y2x1c2l2ZSkuXG4gICAgICBUaGUgcmFuZ2Ugd2lsbCBleHRlbmQgZm9yd2FyZHMgdG8gdGhlIGVuZCBvZiB0aGUgc2VsZWN0ZWQgc3RhdGVtZW50LlxuICAgICAgVGhpcyBvcHRpb24gY2Fubm90IGJlIHVzZWQgd2l0aCAtLWN1cnNvci1vZmZzZXQuXG4gICAgIl0pKSksIGNsaUNhdGVnb3J5OiBFYSB9LCByYW5nZVN0YXJ0OiB7IHNpbmNlOiAiMS40LjAiLCBjYXRlZ29yeTogYmEsIHR5cGU6ICJpbnQiLCBkZWZhdWx0OiAwLCByYW5nZTogeyBzdGFydDogMCwgZW5kOiBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIHN0ZXA6IDEgfSwgZGVzY3JpcHRpb246IGdhKGhhIHx8IChoYSA9IE4oWyJcbiAgICAgIEZvcm1hdCBjb2RlIHN0YXJ0aW5nIGF0IGEgZ2l2ZW4gY2hhcmFjdGVyIG9mZnNldC5cbiAgICAgIFRoZSByYW5nZSB3aWxsIGV4dGVuZCBiYWNrd2FyZHMgdG8gdGhlIHN0YXJ0IG9mIHRoZSBmaXJzdCBsaW5lIGNvbnRhaW5pbmcgdGhlIHNlbGVjdGVkIHN0YXRlbWVudC5cbiAgICAgIFRoaXMgb3B0aW9uIGNhbm5vdCBiZSB1c2VkIHdpdGggLS1jdXJzb3Itb2Zmc2V0LlxuICAgICJdKSkpLCBjbGlDYXRlZ29yeTogRWEgfSwgcmVxdWlyZVByYWdtYTogeyBzaW5jZTogIjEuNy4wIiwgY2F0ZWdvcnk6IGJhLCB0eXBlOiAiYm9vbGVhbiIsIGRlZmF1bHQ6IGZhbHNlLCBkZXNjcmlwdGlvbjogZ2EoRGEgfHwgKERhID0gTihbIlxuICAgICAgUmVxdWlyZSBlaXRoZXIgJ0BwcmV0dGllcicgb3IgJ0Bmb3JtYXQnIHRvIGJlIHByZXNlbnQgaW4gdGhlIGZpbGUncyBmaXJzdCBkb2NibG9jayBjb21tZW50XG4gICAgICBpbiBvcmRlciBmb3IgaXQgdG8gYmUgZm9ybWF0dGVkLlxuICAgICJdKSkpLCBjbGlDYXRlZ29yeTogQ2EgfSwgdGFiV2lkdGg6IHsgdHlwZTogImludCIsIGNhdGVnb3J5OiB5YSwgZGVmYXVsdDogMiwgZGVzY3JpcHRpb246ICJOdW1iZXIgb2Ygc3BhY2VzIHBlciBpbmRlbnRhdGlvbiBsZXZlbC4iLCByYW5nZTogeyBzdGFydDogMCwgZW5kOiBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIHN0ZXA6IDEgfSB9LCB1c2VUYWJzOiB7IHNpbmNlOiAiMS4wLjAiLCBjYXRlZ29yeTogeWEsIHR5cGU6ICJib29sZWFuIiwgZGVmYXVsdDogZmFsc2UsIGRlc2NyaXB0aW9uOiAiSW5kZW50IHdpdGggdGFicyBpbnN0ZWFkIG9mIHNwYWNlcy4iIH0sIGVtYmVkZGVkTGFuZ3VhZ2VGb3JtYXR0aW5nOiB7IHNpbmNlOiAiMi4xLjAiLCBjYXRlZ29yeTogeWEsIHR5cGU6ICJjaG9pY2UiLCBkZWZhdWx0OiBbeyBzaW5jZTogIjIuMS4wIiwgdmFsdWU6ICJhdXRvIiB9XSwgZGVzY3JpcHRpb246ICJDb250cm9sIGhvdyBQcmV0dGllciBmb3JtYXRzIHF1b3RlZCBjb2RlIGVtYmVkZGVkIGluIHRoZSBmaWxlLiIsIGNob2ljZXM6IFt7IHZhbHVlOiAiYXV0byIsIGRlc2NyaXB0aW9uOiAiRm9ybWF0IGVtYmVkZGVkIGNvZGUgaWYgUHJldHRpZXIgY2FuIGF1dG9tYXRpY2FsbHkgaWRlbnRpZnkgaXQuIiB9LCB7IHZhbHVlOiAib2ZmIiwgZGVzY3JpcHRpb246ICJOZXZlciBhdXRvbWF0aWNhbGx5IGZvcm1hdCBlbWJlZGRlZCBjb2RlLiIgfV0gfSB9OwogICAgICAgIGNvbnN0IFRhID0gWyJjbGlOYW1lIiwgImNsaUNhdGVnb3J5IiwgImNsaURlc2NyaXB0aW9uIl0sIF9hID0geyBjb21wYXJlOiBpYSwgbHQ6IG9hLCBndGU6IGZhIH0sIHZhID0gKGUyLCB0MikgPT4gT2JqZWN0LmVudHJpZXMoZTIpLm1hcCgoZTMpID0+IHsKICAgICAgICAgIGxldCBbcjIsIG4yXSA9IGUzOwogICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oeyBbdDJdOiByMiB9LCBuMik7CiAgICAgICAgfSksIEFhID0gIjIuNS4xIiwgRmEgPSB7IENBVEVHT1JZX0NPTkZJRzogbWEsIENBVEVHT1JZX0VESVRPUjogRWEsIENBVEVHT1JZX0ZPUk1BVDogIkZvcm1hdCIsIENBVEVHT1JZX09USEVSOiBDYSwgQ0FURUdPUllfT1VUUFVUOiAiT3V0cHV0IiwgQ0FURUdPUllfR0xPQkFMOiB5YSwgQ0FURUdPUllfU1BFQ0lBTDogYmEsIG9wdGlvbnM6IFNhIH0ub3B0aW9uczsKICAgICAgICBmdW5jdGlvbiB3YShlMiwgdDIsIHIyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IG5ldyBTZXQoZTIuY2hvaWNlcy5tYXAoKGUzKSA9PiBlMy52YWx1ZSkpOwogICAgICAgICAgZm9yIChjb25zdCBpMiBvZiB0MikKICAgICAgICAgICAgaWYgKGkyLnBhcnNlcnMpIHsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQzIG9mIGkyLnBhcnNlcnMpCiAgICAgICAgICAgICAgICBpZiAoIW4yLmhhcyh0MykpIHsKICAgICAgICAgICAgICAgICAgbjIuYWRkKHQzKTsKICAgICAgICAgICAgICAgICAgY29uc3QgczIgPSByMi5maW5kKChlMykgPT4gZTMucGFyc2VycyAmJiBlMy5wYXJzZXJzW3QzXSk7CiAgICAgICAgICAgICAgICAgIGxldCBvMiA9IGkyLm5hbWU7CiAgICAgICAgICAgICAgICAgIHMyICYmIHMyLm5hbWUgJiYgKG8yICs9ICIgKHBsdWdpbjogIi5jb25jYXQoczIubmFtZSwgIikiKSksIGUyLmNob2ljZXMucHVzaCh7IHZhbHVlOiB0MywgZGVzY3JpcHRpb246IG8yIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBrYSA9IHsgZ2V0U3VwcG9ydEluZm86IGZ1bmN0aW9uKCkgewogICAgICAgICAgbGV0IHsgcGx1Z2luczogZTIgPSBbXSwgc2hvd1VucmVsZWFzZWQ6IHQyID0gZmFsc2UsIHNob3dEZXByZWNhdGVkOiByMiA9IGZhbHNlLCBzaG93SW50ZXJuYWw6IG4yID0gZmFsc2UgfSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgICAgICBjb25zdCBpMiA9IEFhLnNwbGl0KCItIiwgMSlbMF0sIHMyID0gZTIuZmxhdE1hcCgoZTMpID0+IGUzLmxhbmd1YWdlcyB8fCBbXSkuZmlsdGVyKGEyKSwgbzIgPSB2YShPYmplY3QuYXNzaWduKHt9LCAuLi5lMi5tYXAoKGUzKSA9PiB7CiAgICAgICAgICAgIGxldCB7IG9wdGlvbnM6IHQzIH0gPSBlMzsKICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfSksIEZhKSwgIm5hbWUiKS5maWx0ZXIoKGUzKSA9PiBhMihlMykgJiYgdTIoZTMpKS5zb3J0KChlMywgdDMpID0+IGUzLm5hbWUgPT09IHQzLm5hbWUgPyAwIDogZTMubmFtZSA8IHQzLm5hbWUgPyAtMSA6IDEpLm1hcChjMikubWFwKCh0MykgPT4gewogICAgICAgICAgICB0MyA9IE9iamVjdC5hc3NpZ24oe30sIHQzKSwgQXJyYXkuaXNBcnJheSh0My5kZWZhdWx0KSAmJiAodDMuZGVmYXVsdCA9IHQzLmRlZmF1bHQubGVuZ3RoID09PSAxID8gdDMuZGVmYXVsdFswXS52YWx1ZSA6IHQzLmRlZmF1bHQuZmlsdGVyKGEyKS5zb3J0KChlMywgdDQpID0+IF9hLmNvbXBhcmUodDQuc2luY2UsIGUzLnNpbmNlKSlbMF0udmFsdWUpLCBBcnJheS5pc0FycmF5KHQzLmNob2ljZXMpICYmICh0My5jaG9pY2VzID0gdDMuY2hvaWNlcy5maWx0ZXIoKGUzKSA9PiBhMihlMykgJiYgdTIoZTMpKSwgdDMubmFtZSA9PT0gInBhcnNlciIgJiYgd2EodDMsIHMyLCBlMikpOwogICAgICAgICAgICBjb25zdCByMyA9IE9iamVjdC5mcm9tRW50cmllcyhlMi5maWx0ZXIoKGUzKSA9PiBlMy5kZWZhdWx0T3B0aW9ucyAmJiBlMy5kZWZhdWx0T3B0aW9uc1t0My5uYW1lXSAhPT0gdm9pZCAwKS5tYXAoKGUzKSA9PiBbZTMubmFtZSwgZTMuZGVmYXVsdE9wdGlvbnNbdDMubmFtZV1dKSk7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHQzKSwge30sIHsgcGx1Z2luRGVmYXVsdHM6IHIzIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4geyBsYW5ndWFnZXM6IHMyLCBvcHRpb25zOiBvMiB9OwogICAgICAgICAgZnVuY3Rpb24gYTIoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIHQyIHx8ICEoInNpbmNlIiBpbiBlMykgfHwgZTMuc2luY2UgJiYgX2EuZ3RlKGkyLCBlMy5zaW5jZSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiB1MihlMykgewogICAgICAgICAgICByZXR1cm4gcjIgfHwgISgiZGVwcmVjYXRlZCIgaW4gZTMpIHx8IGUzLmRlcHJlY2F0ZWQgJiYgX2EubHQoaTIsIGUzLmRlcHJlY2F0ZWQpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gYzIoZTMpIHsKICAgICAgICAgICAgaWYgKG4yKQogICAgICAgICAgICAgIHJldHVybiBlMzsKICAgICAgICAgICAgcmV0dXJuIGsoZTMsIFRhKTsKICAgICAgICAgIH0KICAgICAgICB9IH07CiAgICAgICAgY29uc3QgTmEgPSBiLmV4cG9ydHMsIE9hID0gKGUyKSA9PiB7CiAgICAgICAgICBpZiAodHlwZW9mIGUyICE9ICJzdHJpbmciKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJFeHBlY3RlZCBhIHN0cmluZyIpOwogICAgICAgICAgcmV0dXJuIGUyLnJlcGxhY2UoL1t8XFx7fSgpW1xdXiQrKj8uXS9nLCAiXFwkJiIpLnJlcGxhY2UoLy0vZywgIlxceDJkIik7CiAgICAgICAgfSwgeGEgPSBDLCB7IGdldFN1cHBvcnRJbmZvOiBJYSB9ID0ga2EsIFBhID0gL1teXHgyMC1ceDdGXS87CiAgICAgICAgZnVuY3Rpb24gUmEoZTIpIHsKICAgICAgICAgIHJldHVybiAodDIsIHIyLCBuMikgPT4gewogICAgICAgICAgICBjb25zdCBpMiA9IG4yICYmIG4yLmJhY2t3YXJkczsKICAgICAgICAgICAgaWYgKHIyID09PSBmYWxzZSkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHsgbGVuZ3RoOiBzMiB9ID0gdDI7CiAgICAgICAgICAgIGxldCBvMiA9IHIyOwogICAgICAgICAgICBmb3IgKDsgbzIgPj0gMCAmJiBvMiA8IHMyOyApIHsKICAgICAgICAgICAgICBjb25zdCByMyA9IHQyLmNoYXJBdChvMik7CiAgICAgICAgICAgICAgaWYgKGUyIGluc3RhbmNlb2YgUmVnRXhwKSB7CiAgICAgICAgICAgICAgICBpZiAoIWUyLnRlc3QocjMpKQogICAgICAgICAgICAgICAgICByZXR1cm4gbzI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICghZTIuaW5jbHVkZXMocjMpKQogICAgICAgICAgICAgICAgcmV0dXJuIG8yOwogICAgICAgICAgICAgIGkyID8gbzItLSA6IG8yKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChvMiA9PT0gLTEgfHwgbzIgPT09IHMyKSAmJiBvMjsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGNvbnN0IExhID0gUmEoL1xzLyksIEJhID0gUmEoIiAJIiksIHFhID0gUmEoIiw7IAkiKSwgJGEgPSBSYSgvW15cblxyXS8pOwogICAgICAgIGZ1bmN0aW9uIE1hKGUyLCB0MikgewogICAgICAgICAgaWYgKHQyID09PSBmYWxzZSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgaWYgKGUyLmNoYXJBdCh0MikgPT09ICIvIiAmJiBlMi5jaGFyQXQodDIgKyAxKSA9PT0gIioiKSB7CiAgICAgICAgICAgIGZvciAobGV0IHIyID0gdDIgKyAyOyByMiA8IGUyLmxlbmd0aDsgKytyMikKICAgICAgICAgICAgICBpZiAoZTIuY2hhckF0KHIyKSA9PT0gIioiICYmIGUyLmNoYXJBdChyMiArIDEpID09PSAiLyIpCiAgICAgICAgICAgICAgICByZXR1cm4gcjIgKyAyOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBqYShlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB0MiAhPT0gZmFsc2UgJiYgKGUyLmNoYXJBdCh0MikgPT09ICIvIiAmJiBlMi5jaGFyQXQodDIgKyAxKSA9PT0gIi8iID8gJGEoZTIsIHQyKSA6IHQyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVWEoZTIsIHQyLCByMikgewogICAgICAgICAgY29uc3QgbjIgPSByMiAmJiByMi5iYWNrd2FyZHM7CiAgICAgICAgICBpZiAodDIgPT09IGZhbHNlKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBjb25zdCBpMiA9IGUyLmNoYXJBdCh0Mik7CiAgICAgICAgICBpZiAobjIpIHsKICAgICAgICAgICAgaWYgKGUyLmNoYXJBdCh0MiAtIDEpID09PSAiXHIiICYmIGkyID09PSAiXG4iKQogICAgICAgICAgICAgIHJldHVybiB0MiAtIDI7CiAgICAgICAgICAgIGlmIChpMiA9PT0gIlxuIiB8fCBpMiA9PT0gIlxyIiB8fCBpMiA9PT0gIlx1MjAyOCIgfHwgaTIgPT09ICJcdTIwMjkiKQogICAgICAgICAgICAgIHJldHVybiB0MiAtIDE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoaTIgPT09ICJcciIgJiYgZTIuY2hhckF0KHQyICsgMSkgPT09ICJcbiIpCiAgICAgICAgICAgICAgcmV0dXJuIHQyICsgMjsKICAgICAgICAgICAgaWYgKGkyID09PSAiXG4iIHx8IGkyID09PSAiXHIiIHx8IGkyID09PSAiXHUyMDI4IiB8fCBpMiA9PT0gIlx1MjAyOSIpCiAgICAgICAgICAgICAgcmV0dXJuIHQyICsgMTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gR2EoZTIsIHQyKSB7CiAgICAgICAgICBsZXQgcjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICAgICAgY29uc3QgbjIgPSBCYShlMiwgcjIuYmFja3dhcmRzID8gdDIgLSAxIDogdDIsIHIyKSwgaTIgPSBVYShlMiwgbjIsIHIyKTsKICAgICAgICAgIHJldHVybiBuMiAhPT0gaTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFZhKGUyLCB0MikgewogICAgICAgICAgbGV0IHIyID0gbnVsbCwgbjIgPSB0MjsKICAgICAgICAgIGZvciAoOyBuMiAhPT0gcjI7ICkKICAgICAgICAgICAgcjIgPSBuMiwgbjIgPSBxYShlMiwgbjIpLCBuMiA9IE1hKGUyLCBuMiksIG4yID0gQmEoZTIsIG4yKTsKICAgICAgICAgIHJldHVybiBuMiA9IGphKGUyLCBuMiksIG4yID0gVWEoZTIsIG4yKSwgbjIgIT09IGZhbHNlICYmIEdhKGUyLCBuMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFhhKGUyLCB0MikgewogICAgICAgICAgbGV0IHIyID0gbnVsbCwgbjIgPSB0MjsKICAgICAgICAgIGZvciAoOyBuMiAhPT0gcjI7ICkKICAgICAgICAgICAgcjIgPSBuMiwgbjIgPSBCYShlMiwgbjIpLCBuMiA9IE1hKGUyLCBuMiksIG4yID0gamEoZTIsIG4yKSwgbjIgPSBVYShlMiwgbjIpOwogICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBIYShlMiwgdDIsIHIyKSB7CiAgICAgICAgICByZXR1cm4gWGEoZTIsIHIyKHQyKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHphKGUyLCB0MikgewogICAgICAgICAgbGV0IHIyID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMl0gOiAwLCBuMiA9IDA7CiAgICAgICAgICBmb3IgKGxldCBpMiA9IHIyOyBpMiA8IGUyLmxlbmd0aDsgKytpMikKICAgICAgICAgICAgZTJbaTJdID09PSAiCSIgPyBuMiA9IG4yICsgdDIgLSBuMiAlIHQyIDogbjIrKzsKICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gV2EoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCByMiA9IHsgcXVvdGU6ICciJywgcmVnZXg6IC8iL2csIGVzY2FwZWQ6ICImcXVvdDsiIH0sIG4yID0geyBxdW90ZTogIiciLCByZWdleDogLycvZywgZXNjYXBlZDogIiZhcG9zOyIgfSwgaTIgPSB0MiA9PT0gIiciID8gbjIgOiByMiwgczIgPSBpMiA9PT0gbjIgPyByMiA6IG4yOwogICAgICAgICAgbGV0IG8yID0gaTI7CiAgICAgICAgICBpZiAoZTIuaW5jbHVkZXMoaTIucXVvdGUpIHx8IGUyLmluY2x1ZGVzKHMyLnF1b3RlKSkgewogICAgICAgICAgICBvMiA9IChlMi5tYXRjaChpMi5yZWdleCkgfHwgW10pLmxlbmd0aCA+IChlMi5tYXRjaChzMi5yZWdleCkgfHwgW10pLmxlbmd0aCA/IHMyIDogaTI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbzI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFlhKGUyLCB0MiwgcjIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gdDIgPT09ICciJyA/ICInIiA6ICciJywgaTIgPSBlMi5yZXBsYWNlKC9cXCguKXwoWyInXSkvZ3MsIChlMywgaTMsIHMyKSA9PiBpMyA9PT0gbjIgPyBpMyA6IHMyID09PSB0MiA/ICJcXCIgKyBzMiA6IHMyIHx8IChyMiAmJiAvXlteXG5cciInMC03XFxiZm5ydC12eFx1MjAyOFx1MjAyOV0kLy50ZXN0KGkzKSA/IGkzIDogIlxcIiArIGkzKSk7CiAgICAgICAgICByZXR1cm4gdDIgKyBpMiArIHQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBRYShlMiwgdDIpIHsKICAgICAgICAgIChlMi5jb21tZW50cyB8fCAoZTIuY29tbWVudHMgPSBbXSkpLnB1c2godDIpLCB0Mi5wcmludGVkID0gZmFsc2UsIHQyLm5vZGVEZXNjcmlwdGlvbiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gZTMudHlwZSB8fCBlMy5raW5kIHx8ICIodW5rbm93biB0eXBlKSI7CiAgICAgICAgICAgIGxldCByMiA9IFN0cmluZyhlMy5uYW1lIHx8IGUzLmlkICYmICh0eXBlb2YgZTMuaWQgPT0gIm9iamVjdCIgPyBlMy5pZC5uYW1lIDogZTMuaWQpIHx8IGUzLmtleSAmJiAodHlwZW9mIGUzLmtleSA9PSAib2JqZWN0IiA/IGUzLmtleS5uYW1lIDogZTMua2V5KSB8fCBlMy52YWx1ZSAmJiAodHlwZW9mIGUzLnZhbHVlID09ICJvYmplY3QiID8gIiIgOiBTdHJpbmcoZTMudmFsdWUpKSB8fCBlMy5vcGVyYXRvciB8fCAiIik7CiAgICAgICAgICAgIHIyLmxlbmd0aCA+IDIwICYmIChyMiA9IHIyLnNsaWNlKDAsIDE5KSArICJcdTIwMjYiKTsKICAgICAgICAgICAgcmV0dXJuIHQzICsgKHIyID8gIiAiICsgcjIgOiAiIik7CiAgICAgICAgICB9KGUyKTsKICAgICAgICB9CiAgICAgICAgdmFyIEphID0geyBpbmZlclBhcnNlckJ5TGFuZ3VhZ2U6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgeyBsYW5ndWFnZXM6IHIyIH0gPSBJYSh7IHBsdWdpbnM6IHQyLnBsdWdpbnMgfSksIG4yID0gcjIuZmluZCgodDMpID0+IHsKICAgICAgICAgICAgbGV0IHsgbmFtZTogcjMgfSA9IHQzOwogICAgICAgICAgICByZXR1cm4gcjMudG9Mb3dlckNhc2UoKSA9PT0gZTI7CiAgICAgICAgICB9KSB8fCByMi5maW5kKCh0MykgPT4gewogICAgICAgICAgICBsZXQgeyBhbGlhc2VzOiByMyB9ID0gdDM7CiAgICAgICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHIzKSAmJiByMy5pbmNsdWRlcyhlMik7CiAgICAgICAgICB9KSB8fCByMi5maW5kKCh0MykgPT4gewogICAgICAgICAgICBsZXQgeyBleHRlbnNpb25zOiByMyB9ID0gdDM7CiAgICAgICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHIzKSAmJiByMy5pbmNsdWRlcygiLiIuY29uY2F0KGUyKSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBuMiAmJiBuMi5wYXJzZXJzWzBdOwogICAgICAgIH0sIGdldFN0cmluZ1dpZHRoOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyID8gUGEudGVzdChlMikgPyBOYShlMikgOiBlMi5sZW5ndGggOiAwOwogICAgICAgIH0sIGdldE1heENvbnRpbnVvdXNDb3VudDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLm1hdGNoKG5ldyBSZWdFeHAoIigiLmNvbmNhdChPYSh0MiksICIpKyIpLCAiZyIpKTsKICAgICAgICAgIHJldHVybiByMiA9PT0gbnVsbCA/IDAgOiByMi5yZWR1Y2UoKGUzLCByMykgPT4gTWF0aC5tYXgoZTMsIHIzLmxlbmd0aCAvIHQyLmxlbmd0aCksIDApOwogICAgICAgIH0sIGdldE1pbk5vdFByZXNlbnRDb250aW51b3VzQ291bnQ6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5tYXRjaChuZXcgUmVnRXhwKCIoIi5jb25jYXQoT2EodDIpLCAiKSsiKSwgImciKSk7CiAgICAgICAgICBpZiAocjIgPT09IG51bGwpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgY29uc3QgbjIgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwogICAgICAgICAgbGV0IGkyID0gMDsKICAgICAgICAgIGZvciAoY29uc3QgZTMgb2YgcjIpIHsKICAgICAgICAgICAgY29uc3QgcjMgPSBlMy5sZW5ndGggLyB0Mi5sZW5ndGg7CiAgICAgICAgICAgIG4yLnNldChyMywgdHJ1ZSksIHIzID4gaTIgJiYgKGkyID0gcjMpOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChsZXQgZTMgPSAxOyBlMyA8IGkyOyBlMysrKQogICAgICAgICAgICBpZiAoIW4yLmdldChlMykpCiAgICAgICAgICAgICAgcmV0dXJuIGUzOwogICAgICAgICAgcmV0dXJuIGkyICsgMTsKICAgICAgICB9LCBnZXRQZW51bHRpbWF0ZTogKGUyKSA9PiBlMltlMi5sZW5ndGggLSAyXSwgZ2V0TGFzdDogeGEsIGdldE5leHROb25TcGFjZU5vbkNvbW1lbnRDaGFyYWN0ZXJJbmRleFdpdGhTdGFydEluZGV4OiBYYSwgZ2V0TmV4dE5vblNwYWNlTm9uQ29tbWVudENoYXJhY3RlckluZGV4OiBIYSwgZ2V0TmV4dE5vblNwYWNlTm9uQ29tbWVudENoYXJhY3RlcjogZnVuY3Rpb24oZTIsIHQyLCByMikgewogICAgICAgICAgcmV0dXJuIGUyLmNoYXJBdChIYShlMiwgdDIsIHIyKSk7CiAgICAgICAgfSwgc2tpcDogUmEsIHNraXBXaGl0ZXNwYWNlOiBMYSwgc2tpcFNwYWNlczogQmEsIHNraXBUb0xpbmVFbmQ6IHFhLCBza2lwRXZlcnl0aGluZ0J1dE5ld0xpbmU6ICRhLCBza2lwSW5saW5lQ29tbWVudDogTWEsIHNraXBUcmFpbGluZ0NvbW1lbnQ6IGphLCBza2lwTmV3bGluZTogVWEsIGlzTmV4dExpbmVFbXB0eUFmdGVySW5kZXg6IFZhLCBpc05leHRMaW5lRW1wdHk6IGZ1bmN0aW9uKGUyLCB0MiwgcjIpIHsKICAgICAgICAgIHJldHVybiBWYShlMiwgcjIodDIpKTsKICAgICAgICB9LCBpc1ByZXZpb3VzTGluZUVtcHR5OiBmdW5jdGlvbihlMiwgdDIsIHIyKSB7CiAgICAgICAgICBsZXQgbjIgPSByMih0MikgLSAxOwogICAgICAgICAgcmV0dXJuIG4yID0gQmEoZTIsIG4yLCB7IGJhY2t3YXJkczogdHJ1ZSB9KSwgbjIgPSBVYShlMiwgbjIsIHsgYmFja3dhcmRzOiB0cnVlIH0pLCBuMiA9IEJhKGUyLCBuMiwgeyBiYWNrd2FyZHM6IHRydWUgfSksIG4yICE9PSBVYShlMiwgbjIsIHsgYmFja3dhcmRzOiB0cnVlIH0pOwogICAgICAgIH0sIGhhc05ld2xpbmU6IEdhLCBoYXNOZXdsaW5lSW5SYW5nZTogZnVuY3Rpb24oZTIsIHQyLCByMikgewogICAgICAgICAgZm9yIChsZXQgbjIgPSB0MjsgbjIgPCByMjsgKytuMikKICAgICAgICAgICAgaWYgKGUyLmNoYXJBdChuMikgPT09ICJcbiIpCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSwgaGFzU3BhY2VzOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGxldCByMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzJdIDoge307CiAgICAgICAgICBjb25zdCBuMiA9IEJhKGUyLCByMi5iYWNrd2FyZHMgPyB0MiAtIDEgOiB0MiwgcjIpOwogICAgICAgICAgcmV0dXJuIG4yICE9PSB0MjsKICAgICAgICB9LCBnZXRBbGlnbm1lbnRTaXplOiB6YSwgZ2V0SW5kZW50U2l6ZTogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCByMiA9IGUyLmxhc3RJbmRleE9mKCJcbiIpOwogICAgICAgICAgcmV0dXJuIHIyID09PSAtMSA/IDAgOiB6YShlMi5zbGljZShyMiArIDEpLm1hdGNoKC9eW1x0IF0qLylbMF0sIHQyKTsKICAgICAgICB9LCBnZXRQcmVmZXJyZWRRdW90ZTogV2EsIHByaW50U3RyaW5nOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZTIuc2xpY2UoMSwgLTEpOwogICAgICAgICAgcmV0dXJuIFlhKHIyLCB0Mi5wYXJzZXIgPT09ICJqc29uIiB8fCB0Mi5wYXJzZXIgPT09ICJqc29uNSIgJiYgdDIucXVvdGVQcm9wcyA9PT0gInByZXNlcnZlIiAmJiAhdDIuc2luZ2xlUXVvdGUgPyAnIicgOiB0Mi5fX2lzSW5IdG1sQXR0cmlidXRlID8gIiciIDogV2EocjIsIHQyLnNpbmdsZVF1b3RlID8gIiciIDogJyInKS5xdW90ZSwgISh0Mi5wYXJzZXIgPT09ICJjc3MiIHx8IHQyLnBhcnNlciA9PT0gImxlc3MiIHx8IHQyLnBhcnNlciA9PT0gInNjc3MiIHx8IHQyLl9fZW1iZWRkZWRJbkh0bWwpKTsKICAgICAgICB9LCBwcmludE51bWJlcjogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL14oWystXT9bXGQuXStlKSg/OlwrfCgtKSk/MCooXGQpLywgIiQxJDIkMyIpLnJlcGxhY2UoL14oWystXT9bXGQuXSspZVsrLV0/MCskLywgIiQxIikucmVwbGFjZSgvXihbKy1dKT9cLi8sICIkMTAuIikucmVwbGFjZSgvKFwuXGQrPykwKyg/PWV8JCkvLCAiJDEiKS5yZXBsYWNlKC9cLig/PWV8JCkvLCAiIik7CiAgICAgICAgfSwgbWFrZVN0cmluZzogWWEsIGFkZExlYWRpbmdDb21tZW50OiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHQyLmxlYWRpbmcgPSB0cnVlLCB0Mi50cmFpbGluZyA9IGZhbHNlLCBRYShlMiwgdDIpOwogICAgICAgIH0sIGFkZERhbmdsaW5nQ29tbWVudDogZnVuY3Rpb24oZTIsIHQyLCByMikgewogICAgICAgICAgdDIubGVhZGluZyA9IGZhbHNlLCB0Mi50cmFpbGluZyA9IGZhbHNlLCByMiAmJiAodDIubWFya2VyID0gcjIpLCBRYShlMiwgdDIpOwogICAgICAgIH0sIGFkZFRyYWlsaW5nQ29tbWVudDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICB0Mi5sZWFkaW5nID0gZmFsc2UsIHQyLnRyYWlsaW5nID0gdHJ1ZSwgUWEoZTIsIHQyKTsKICAgICAgICB9LCBpc0Zyb250TWF0dGVyTm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMiAmJiBlMi50eXBlID09PSAiZnJvbnQtbWF0dGVyIjsKICAgICAgICB9LCBnZXRTaGViYW5nOiBmdW5jdGlvbihlMikgewogICAgICAgICAgaWYgKCFlMi5zdGFydHNXaXRoKCIjISIpKQogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICBjb25zdCB0MiA9IGUyLmluZGV4T2YoIlxuIik7CiAgICAgICAgICByZXR1cm4gdDIgPT09IC0xID8gZTIgOiBlMi5zbGljZSgwLCB0Mik7CiAgICAgICAgfSwgaXNOb25FbXB0eUFycmF5OiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoZTIpICYmIGUyLmxlbmd0aCA+IDA7CiAgICAgICAgfSwgY3JlYXRlR3JvdXBJZE1hcHBlcjogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24ocjIpIHsKICAgICAgICAgICAgcmV0dXJuIHQyLmhhcyhyMikgfHwgdDIuc2V0KHIyLCBTeW1ib2woZTIpKSwgdDIuZ2V0KHIyKTsKICAgICAgICAgIH07CiAgICAgICAgfSB9LCBaYSA9IHsgIioiOiBbImFjY2Vzc2tleSIsICJhdXRvY2FwaXRhbGl6ZSIsICJhdXRvZm9jdXMiLCAiY2xhc3MiLCAiY29udGVudGVkaXRhYmxlIiwgImRpciIsICJkcmFnZ2FibGUiLCAiZW50ZXJrZXloaW50IiwgImhpZGRlbiIsICJpZCIsICJpbnB1dG1vZGUiLCAiaXMiLCAiaXRlbWlkIiwgIml0ZW1wcm9wIiwgIml0ZW1yZWYiLCAiaXRlbXNjb3BlIiwgIml0ZW10eXBlIiwgImxhbmciLCAibm9uY2UiLCAic2xvdCIsICJzcGVsbGNoZWNrIiwgInN0eWxlIiwgInRhYmluZGV4IiwgInRpdGxlIiwgInRyYW5zbGF0ZSJdLCBhOiBbImFjY2Vzc2tleSIsICJjaGFyc2V0IiwgImNvb3JkcyIsICJkb3dubG9hZCIsICJocmVmIiwgImhyZWZsYW5nIiwgIm5hbWUiLCAicGluZyIsICJyZWZlcnJlcnBvbGljeSIsICJyZWwiLCAicmV2IiwgInNoYXBlIiwgInRhYmluZGV4IiwgInRhcmdldCIsICJ0eXBlIl0sIGFiYnI6IFsidGl0bGUiXSwgYXBwbGV0OiBbImFsaWduIiwgImFsdCIsICJhcmNoaXZlIiwgImNvZGUiLCAiY29kZWJhc2UiLCAiaGVpZ2h0IiwgImhzcGFjZSIsICJuYW1lIiwgIm9iamVjdCIsICJ2c3BhY2UiLCAid2lkdGgiXSwgYXJlYTogWyJhY2Nlc3NrZXkiLCAiYWx0IiwgImNvb3JkcyIsICJkb3dubG9hZCIsICJocmVmIiwgImhyZWZsYW5nIiwgIm5vaHJlZiIsICJwaW5nIiwgInJlZmVycmVycG9saWN5IiwgInJlbCIsICJzaGFwZSIsICJ0YWJpbmRleCIsICJ0YXJnZXQiLCAidHlwZSJdLCBhdWRpbzogWyJhdXRvcGxheSIsICJjb250cm9scyIsICJjcm9zc29yaWdpbiIsICJsb29wIiwgIm11dGVkIiwgInByZWxvYWQiLCAic3JjIl0sIGJhc2U6IFsiaHJlZiIsICJ0YXJnZXQiXSwgYmFzZWZvbnQ6IFsiY29sb3IiLCAiZmFjZSIsICJzaXplIl0sIGJkbzogWyJkaXIiXSwgYmxvY2txdW90ZTogWyJjaXRlIl0sIGJvZHk6IFsiYWxpbmsiLCAiYmFja2dyb3VuZCIsICJiZ2NvbG9yIiwgImxpbmsiLCAidGV4dCIsICJ2bGluayJdLCBicjogWyJjbGVhciJdLCBidXR0b246IFsiYWNjZXNza2V5IiwgImF1dG9mb2N1cyIsICJkaXNhYmxlZCIsICJmb3JtIiwgImZvcm1hY3Rpb24iLCAiZm9ybWVuY3R5cGUiLCAiZm9ybW1ldGhvZCIsICJmb3Jtbm92YWxpZGF0ZSIsICJmb3JtdGFyZ2V0IiwgIm5hbWUiLCAidGFiaW5kZXgiLCAidHlwZSIsICJ2YWx1ZSJdLCBjYW52YXM6IFsiaGVpZ2h0IiwgIndpZHRoIl0sIGNhcHRpb246IFsiYWxpZ24iXSwgY29sOiBbImFsaWduIiwgImNoYXIiLCAiY2hhcm9mZiIsICJzcGFuIiwgInZhbGlnbiIsICJ3aWR0aCJdLCBjb2xncm91cDogWyJhbGlnbiIsICJjaGFyIiwgImNoYXJvZmYiLCAic3BhbiIsICJ2YWxpZ24iLCAid2lkdGgiXSwgZGF0YTogWyJ2YWx1ZSJdLCBkZWw6IFsiY2l0ZSIsICJkYXRldGltZSJdLCBkZXRhaWxzOiBbIm9wZW4iXSwgZGZuOiBbInRpdGxlIl0sIGRpYWxvZzogWyJvcGVuIl0sIGRpcjogWyJjb21wYWN0Il0sIGRpdjogWyJhbGlnbiJdLCBkbDogWyJjb21wYWN0Il0sIGVtYmVkOiBbImhlaWdodCIsICJzcmMiLCAidHlwZSIsICJ3aWR0aCJdLCBmaWVsZHNldDogWyJkaXNhYmxlZCIsICJmb3JtIiwgIm5hbWUiXSwgZm9udDogWyJjb2xvciIsICJmYWNlIiwgInNpemUiXSwgZm9ybTogWyJhY2NlcHQiLCAiYWNjZXB0LWNoYXJzZXQiLCAiYWN0aW9uIiwgImF1dG9jb21wbGV0ZSIsICJlbmN0eXBlIiwgIm1ldGhvZCIsICJuYW1lIiwgIm5vdmFsaWRhdGUiLCAidGFyZ2V0Il0sIGZyYW1lOiBbImZyYW1lYm9yZGVyIiwgImxvbmdkZXNjIiwgIm1hcmdpbmhlaWdodCIsICJtYXJnaW53aWR0aCIsICJuYW1lIiwgIm5vcmVzaXplIiwgInNjcm9sbGluZyIsICJzcmMiXSwgZnJhbWVzZXQ6IFsiY29scyIsICJyb3dzIl0sIGgxOiBbImFsaWduIl0sIGgyOiBbImFsaWduIl0sIGgzOiBbImFsaWduIl0sIGg0OiBbImFsaWduIl0sIGg1OiBbImFsaWduIl0sIGg2OiBbImFsaWduIl0sIGhlYWQ6IFsicHJvZmlsZSJdLCBocjogWyJhbGlnbiIsICJub3NoYWRlIiwgInNpemUiLCAid2lkdGgiXSwgaHRtbDogWyJtYW5pZmVzdCIsICJ2ZXJzaW9uIl0sIGlmcmFtZTogWyJhbGlnbiIsICJhbGxvdyIsICJhbGxvd2Z1bGxzY3JlZW4iLCAiYWxsb3dwYXltZW50cmVxdWVzdCIsICJhbGxvd3VzZXJtZWRpYSIsICJmcmFtZWJvcmRlciIsICJoZWlnaHQiLCAibG9hZGluZyIsICJsb25nZGVzYyIsICJtYXJnaW5oZWlnaHQiLCAibWFyZ2lud2lkdGgiLCAibmFtZSIsICJyZWZlcnJlcnBvbGljeSIsICJzYW5kYm94IiwgInNjcm9sbGluZyIsICJzcmMiLCAic3JjZG9jIiwgIndpZHRoIl0sIGltZzogWyJhbGlnbiIsICJhbHQiLCAiYm9yZGVyIiwgImNyb3Nzb3JpZ2luIiwgImRlY29kaW5nIiwgImhlaWdodCIsICJoc3BhY2UiLCAiaXNtYXAiLCAibG9hZGluZyIsICJsb25nZGVzYyIsICJuYW1lIiwgInJlZmVycmVycG9saWN5IiwgInNpemVzIiwgInNyYyIsICJzcmNzZXQiLCAidXNlbWFwIiwgInZzcGFjZSIsICJ3aWR0aCJdLCBpbnB1dDogWyJhY2NlcHQiLCAiYWNjZXNza2V5IiwgImFsaWduIiwgImFsdCIsICJhdXRvY29tcGxldGUiLCAiYXV0b2ZvY3VzIiwgImNoZWNrZWQiLCAiZGlybmFtZSIsICJkaXNhYmxlZCIsICJmb3JtIiwgImZvcm1hY3Rpb24iLCAiZm9ybWVuY3R5cGUiLCAiZm9ybW1ldGhvZCIsICJmb3Jtbm92YWxpZGF0ZSIsICJmb3JtdGFyZ2V0IiwgImhlaWdodCIsICJpc21hcCIsICJsaXN0IiwgIm1heCIsICJtYXhsZW5ndGgiLCAibWluIiwgIm1pbmxlbmd0aCIsICJtdWx0aXBsZSIsICJuYW1lIiwgInBhdHRlcm4iLCAicGxhY2Vob2xkZXIiLCAicmVhZG9ubHkiLCAicmVxdWlyZWQiLCAic2l6ZSIsICJzcmMiLCAic3RlcCIsICJ0YWJpbmRleCIsICJ0aXRsZSIsICJ0eXBlIiwgInVzZW1hcCIsICJ2YWx1ZSIsICJ3aWR0aCJdLCBpbnM6IFsiY2l0ZSIsICJkYXRldGltZSJdLCBpc2luZGV4OiBbInByb21wdCJdLCBsYWJlbDogWyJhY2Nlc3NrZXkiLCAiZm9yIiwgImZvcm0iXSwgbGVnZW5kOiBbImFjY2Vzc2tleSIsICJhbGlnbiJdLCBsaTogWyJ0eXBlIiwgInZhbHVlIl0sIGxpbms6IFsiYXMiLCAiY2hhcnNldCIsICJjb2xvciIsICJjcm9zc29yaWdpbiIsICJkaXNhYmxlZCIsICJocmVmIiwgImhyZWZsYW5nIiwgImltYWdlc2l6ZXMiLCAiaW1hZ2VzcmNzZXQiLCAiaW50ZWdyaXR5IiwgIm1lZGlhIiwgIm5vbmNlIiwgInJlZmVycmVycG9saWN5IiwgInJlbCIsICJyZXYiLCAic2l6ZXMiLCAidGFyZ2V0IiwgInRpdGxlIiwgInR5cGUiXSwgbWFwOiBbIm5hbWUiXSwgbWVudTogWyJjb21wYWN0Il0sIG1ldGE6IFsiY2hhcnNldCIsICJjb250ZW50IiwgImh0dHAtZXF1aXYiLCAibmFtZSIsICJzY2hlbWUiXSwgbWV0ZXI6IFsiaGlnaCIsICJsb3ciLCAibWF4IiwgIm1pbiIsICJvcHRpbXVtIiwgInZhbHVlIl0sIG9iamVjdDogWyJhbGlnbiIsICJhcmNoaXZlIiwgImJvcmRlciIsICJjbGFzc2lkIiwgImNvZGViYXNlIiwgImNvZGV0eXBlIiwgImRhdGEiLCAiZGVjbGFyZSIsICJmb3JtIiwgImhlaWdodCIsICJoc3BhY2UiLCAibmFtZSIsICJzdGFuZGJ5IiwgInRhYmluZGV4IiwgInR5cGUiLCAidHlwZW11c3RtYXRjaCIsICJ1c2VtYXAiLCAidnNwYWNlIiwgIndpZHRoIl0sIG9sOiBbImNvbXBhY3QiLCAicmV2ZXJzZWQiLCAic3RhcnQiLCAidHlwZSJdLCBvcHRncm91cDogWyJkaXNhYmxlZCIsICJsYWJlbCJdLCBvcHRpb246IFsiZGlzYWJsZWQiLCAibGFiZWwiLCAic2VsZWN0ZWQiLCAidmFsdWUiXSwgb3V0cHV0OiBbImZvciIsICJmb3JtIiwgIm5hbWUiXSwgcDogWyJhbGlnbiJdLCBwYXJhbTogWyJuYW1lIiwgInR5cGUiLCAidmFsdWUiLCAidmFsdWV0eXBlIl0sIHByZTogWyJ3aWR0aCJdLCBwcm9ncmVzczogWyJtYXgiLCAidmFsdWUiXSwgcTogWyJjaXRlIl0sIHNjcmlwdDogWyJhc3luYyIsICJjaGFyc2V0IiwgImNyb3Nzb3JpZ2luIiwgImRlZmVyIiwgImludGVncml0eSIsICJsYW5ndWFnZSIsICJub21vZHVsZSIsICJub25jZSIsICJyZWZlcnJlcnBvbGljeSIsICJzcmMiLCAidHlwZSJdLCBzZWxlY3Q6IFsiYXV0b2NvbXBsZXRlIiwgImF1dG9mb2N1cyIsICJkaXNhYmxlZCIsICJmb3JtIiwgIm11bHRpcGxlIiwgIm5hbWUiLCAicmVxdWlyZWQiLCAic2l6ZSIsICJ0YWJpbmRleCJdLCBzbG90OiBbIm5hbWUiXSwgc291cmNlOiBbIm1lZGlhIiwgInNpemVzIiwgInNyYyIsICJzcmNzZXQiLCAidHlwZSJdLCBzdHlsZTogWyJtZWRpYSIsICJub25jZSIsICJ0aXRsZSIsICJ0eXBlIl0sIHRhYmxlOiBbImFsaWduIiwgImJnY29sb3IiLCAiYm9yZGVyIiwgImNlbGxwYWRkaW5nIiwgImNlbGxzcGFjaW5nIiwgImZyYW1lIiwgInJ1bGVzIiwgInN1bW1hcnkiLCAid2lkdGgiXSwgdGJvZHk6IFsiYWxpZ24iLCAiY2hhciIsICJjaGFyb2ZmIiwgInZhbGlnbiJdLCB0ZDogWyJhYmJyIiwgImFsaWduIiwgImF4aXMiLCAiYmdjb2xvciIsICJjaGFyIiwgImNoYXJvZmYiLCAiY29sc3BhbiIsICJoZWFkZXJzIiwgImhlaWdodCIsICJub3dyYXAiLCAicm93c3BhbiIsICJzY29wZSIsICJ2YWxpZ24iLCAid2lkdGgiXSwgdGV4dGFyZWE6IFsiYWNjZXNza2V5IiwgImF1dG9jb21wbGV0ZSIsICJhdXRvZm9jdXMiLCAiY29scyIsICJkaXJuYW1lIiwgImRpc2FibGVkIiwgImZvcm0iLCAibWF4bGVuZ3RoIiwgIm1pbmxlbmd0aCIsICJuYW1lIiwgInBsYWNlaG9sZGVyIiwgInJlYWRvbmx5IiwgInJlcXVpcmVkIiwgInJvd3MiLCAidGFiaW5kZXgiLCAid3JhcCJdLCB0Zm9vdDogWyJhbGlnbiIsICJjaGFyIiwgImNoYXJvZmYiLCAidmFsaWduIl0sIHRoOiBbImFiYnIiLCAiYWxpZ24iLCAiYXhpcyIsICJiZ2NvbG9yIiwgImNoYXIiLCAiY2hhcm9mZiIsICJjb2xzcGFuIiwgImhlYWRlcnMiLCAiaGVpZ2h0IiwgIm5vd3JhcCIsICJyb3dzcGFuIiwgInNjb3BlIiwgInZhbGlnbiIsICJ3aWR0aCJdLCB0aGVhZDogWyJhbGlnbiIsICJjaGFyIiwgImNoYXJvZmYiLCAidmFsaWduIl0sIHRpbWU6IFsiZGF0ZXRpbWUiXSwgdHI6IFsiYWxpZ24iLCAiYmdjb2xvciIsICJjaGFyIiwgImNoYXJvZmYiLCAidmFsaWduIl0sIHRyYWNrOiBbImRlZmF1bHQiLCAia2luZCIsICJsYWJlbCIsICJzcmMiLCAic3JjbGFuZyJdLCB1bDogWyJjb21wYWN0IiwgInR5cGUiXSwgdmlkZW86IFsiYXV0b3BsYXkiLCAiY29udHJvbHMiLCAiY3Jvc3NvcmlnaW4iLCAiaGVpZ2h0IiwgImxvb3AiLCAibXV0ZWQiLCAicGxheXNpbmxpbmUiLCAicG9zdGVyIiwgInByZWxvYWQiLCAic3JjIiwgIndpZHRoIl0gfTsKICAgICAgICBmdW5jdGlvbiBLYShlMikgewogICAgICAgICAgcmV0dXJuIHsgdHlwZTogImNvbmNhdCIsIHBhcnRzOiBlMiB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBldShlMikgewogICAgICAgICAgcmV0dXJuIHsgdHlwZTogImluZGVudCIsIGNvbnRlbnRzOiBlMiB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0dShlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB7IHR5cGU6ICJhbGlnbiIsIGNvbnRlbnRzOiB0MiwgbjogZTIgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcnUoZTIpIHsKICAgICAgICAgIGxldCB0MiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgICAgICByZXR1cm4geyB0eXBlOiAiZ3JvdXAiLCBpZDogdDIuaWQsIGNvbnRlbnRzOiBlMiwgYnJlYWs6IEJvb2xlYW4odDIuc2hvdWxkQnJlYWspLCBleHBhbmRlZFN0YXRlczogdDIuZXhwYW5kZWRTdGF0ZXMgfTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbnUgPSB7IHR5cGU6ICJicmVhay1wYXJlbnQiIH0sIGl1ID0geyB0eXBlOiAibGluZSIsIGhhcmQ6IHRydWUgfSwgc3UgPSB7IHR5cGU6ICJsaW5lIiwgaGFyZDogdHJ1ZSwgbGl0ZXJhbDogdHJ1ZSB9LCBvdSA9IEthKFtpdSwgbnVdKSwgYXUgPSBLYShbc3UsIG51XSk7CiAgICAgICAgdmFyIHV1ID0geyBjb25jYXQ6IEthLCBqb2luOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gW107CiAgICAgICAgICBmb3IgKGxldCBuMiA9IDA7IG4yIDwgdDIubGVuZ3RoOyBuMisrKQogICAgICAgICAgICBuMiAhPT0gMCAmJiByMi5wdXNoKGUyKSwgcjIucHVzaCh0MltuMl0pOwogICAgICAgICAgcmV0dXJuIEthKHIyKTsKICAgICAgICB9LCBsaW5lOiB7IHR5cGU6ICJsaW5lIiB9LCBzb2Z0bGluZTogeyB0eXBlOiAibGluZSIsIHNvZnQ6IHRydWUgfSwgaGFyZGxpbmU6IG91LCBsaXRlcmFsbGluZTogYXUsIGdyb3VwOiBydSwgY29uZGl0aW9uYWxHcm91cDogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gcnUoZTJbMF0sIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdDIpLCB7fSwgeyBleHBhbmRlZFN0YXRlczogZTIgfSkpOwogICAgICAgIH0sIGZpbGw6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4geyB0eXBlOiAiZmlsbCIsIHBhcnRzOiBlMiB9OwogICAgICAgIH0sIGxpbmVTdWZmaXg6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4geyB0eXBlOiAibGluZS1zdWZmaXgiLCBjb250ZW50czogZTIgfTsKICAgICAgICB9LCBsaW5lU3VmZml4Qm91bmRhcnk6IHsgdHlwZTogImxpbmUtc3VmZml4LWJvdW5kYXJ5IiB9LCBjdXJzb3I6IHsgdHlwZTogImN1cnNvciIsIHBsYWNlaG9sZGVyOiBTeW1ib2woImN1cnNvciIpIH0sIGJyZWFrUGFyZW50OiBudSwgaWZCcmVhazogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBsZXQgcjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICAgICAgcmV0dXJuIHsgdHlwZTogImlmLWJyZWFrIiwgYnJlYWtDb250ZW50czogZTIsIGZsYXRDb250ZW50czogdDIsIGdyb3VwSWQ6IHIyLmdyb3VwSWQgfTsKICAgICAgICB9LCB0cmltOiB7IHR5cGU6ICJ0cmltIiB9LCBpbmRlbnQ6IGV1LCBpbmRlbnRJZkJyZWFrOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB7IHR5cGU6ICJpbmRlbnQtaWYtYnJlYWsiLCBjb250ZW50czogZTIsIGdyb3VwSWQ6IHQyLmdyb3VwSWQsIG5lZ2F0ZTogdDIubmVnYXRlIH07CiAgICAgICAgfSwgYWxpZ246IHR1LCBhZGRBbGlnbm1lbnRUb0RvYzogZnVuY3Rpb24oZTIsIHQyLCByMikgewogICAgICAgICAgbGV0IG4yID0gZTI7CiAgICAgICAgICBpZiAodDIgPiAwKSB7CiAgICAgICAgICAgIGZvciAobGV0IGUzID0gMDsgZTMgPCBNYXRoLmZsb29yKHQyIC8gcjIpOyArK2UzKQogICAgICAgICAgICAgIG4yID0gZXUobjIpOwogICAgICAgICAgICBuMiA9IHR1KHQyICUgcjIsIG4yKSwgbjIgPSB0dShOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksIG4yKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICB9LCBtYXJrQXNSb290OiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIHR1KHsgdHlwZTogInJvb3QiIH0sIGUyKTsKICAgICAgICB9LCBkZWRlbnRUb1Jvb3Q6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gdHUoTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLCBlMik7CiAgICAgICAgfSwgZGVkZW50OiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIHR1KC0xLCBlMik7CiAgICAgICAgfSwgaGFyZGxpbmVXaXRob3V0QnJlYWtQYXJlbnQ6IGl1LCBsaXRlcmFsbGluZVdpdGhvdXRCcmVha1BhcmVudDogc3UsIGxhYmVsOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB7IHR5cGU6ICJsYWJlbCIsIGxhYmVsOiBlMiwgY29udGVudHM6IHQyIH07CiAgICAgICAgfSB9OwogICAgICAgIHZhciBjdSA9IHsgZ3Vlc3NFbmRPZkxpbmU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IGUyLmluZGV4T2YoIlxyIik7CiAgICAgICAgICByZXR1cm4gdDIgPj0gMCA/IGUyLmNoYXJBdCh0MiArIDEpID09PSAiXG4iID8gImNybGYiIDogImNyIiA6ICJsZiI7CiAgICAgICAgfSwgY29udmVydEVuZE9mTGluZVRvQ2hhcnM6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBzd2l0Y2ggKGUyKSB7CiAgICAgICAgICAgIGNhc2UgImNyIjoKICAgICAgICAgICAgICByZXR1cm4gIlxyIjsKICAgICAgICAgICAgY2FzZSAiY3JsZiI6CiAgICAgICAgICAgICAgcmV0dXJuICJcclxuIjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXR1cm4gIlxuIjsKICAgICAgICAgIH0KICAgICAgICB9LCBjb3VudEVuZE9mTGluZUNoYXJzOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGxldCByMjsKICAgICAgICAgIGlmICh0MiA9PT0gIlxuIikKICAgICAgICAgICAgcjIgPSAvXG4vZzsKICAgICAgICAgIGVsc2UgaWYgKHQyID09PSAiXHIiKQogICAgICAgICAgICByMiA9IC9cci9nOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmICh0MiAhPT0gIlxyXG4iKQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCAiZW9sIiAnLmNvbmNhdChKU09OLnN0cmluZ2lmeSh0MiksICIuIikpOwogICAgICAgICAgICByMiA9IC9cclxuL2c7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBuMiA9IGUyLm1hdGNoKHIyKTsKICAgICAgICAgIHJldHVybiBuMiA/IG4yLmxlbmd0aCA6IDA7CiAgICAgICAgfSwgbm9ybWFsaXplRW5kT2ZMaW5lOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnJlcGxhY2UoL1xyXG4/L2csICJcbiIpOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCBsdSA9IEMsIHsgbGl0ZXJhbGxpbmU6IHB1LCBqb2luOiBodSB9ID0gdXUsIER1ID0gKGUyKSA9PiBBcnJheS5pc0FycmF5KGUyKSB8fCBlMiAmJiBlMi50eXBlID09PSAiY29uY2F0IiwgZnUgPSAoZTIpID0+IHsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGUyKSkKICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgaWYgKGUyLnR5cGUgIT09ICJjb25jYXQiICYmIGUyLnR5cGUgIT09ICJmaWxsIikKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFeHBlY3QgZG9jIHR5cGUgdG8gYmUgYGNvbmNhdGAgb3IgYGZpbGxgLiIpOwogICAgICAgICAgcmV0dXJuIGUyLnBhcnRzOwogICAgICAgIH0sIGR1ID0ge307CiAgICAgICAgZnVuY3Rpb24gZ3UoZTIsIHQyLCByMiwgbjIpIHsKICAgICAgICAgIGNvbnN0IGkyID0gW2UyXTsKICAgICAgICAgIGZvciAoOyBpMi5sZW5ndGggPiAwOyApIHsKICAgICAgICAgICAgY29uc3QgZTMgPSBpMi5wb3AoKTsKICAgICAgICAgICAgaWYgKGUzICE9PSBkdSkgewogICAgICAgICAgICAgIGlmIChyMiAmJiBpMi5wdXNoKGUzLCBkdSksICF0MiB8fCB0MihlMykgIT09IGZhbHNlKQogICAgICAgICAgICAgICAgaWYgKER1KGUzKSB8fCBlMy50eXBlID09PSAiZmlsbCIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdDMgPSBmdShlMyk7CiAgICAgICAgICAgICAgICAgIGZvciAobGV0IGU0ID0gdDMubGVuZ3RoIC0gMTsgZTQgPj0gMDsgLS1lNCkKICAgICAgICAgICAgICAgICAgICBpMi5wdXNoKHQzW2U0XSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUzLnR5cGUgPT09ICJpZi1icmVhayIpCiAgICAgICAgICAgICAgICAgIGUzLmZsYXRDb250ZW50cyAmJiBpMi5wdXNoKGUzLmZsYXRDb250ZW50cyksIGUzLmJyZWFrQ29udGVudHMgJiYgaTIucHVzaChlMy5icmVha0NvbnRlbnRzKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGUzLnR5cGUgPT09ICJncm91cCIgJiYgZTMuZXhwYW5kZWRTdGF0ZXMpCiAgICAgICAgICAgICAgICAgIGlmIChuMikKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB0MyA9IGUzLmV4cGFuZGVkU3RhdGVzLmxlbmd0aCAtIDE7IHQzID49IDA7IC0tdDMpCiAgICAgICAgICAgICAgICAgICAgICBpMi5wdXNoKGUzLmV4cGFuZGVkU3RhdGVzW3QzXSk7CiAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBpMi5wdXNoKGUzLmNvbnRlbnRzKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgZTMuY29udGVudHMgJiYgaTIucHVzaChlMy5jb250ZW50cyk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIHIyKGkyLnBvcCgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbXUoZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCByMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgICAgICAgICByZXR1cm4gbjIoZTIpOwogICAgICAgICAgZnVuY3Rpb24gbjIoZTMpIHsKICAgICAgICAgICAgaWYgKHIyLmhhcyhlMykpCiAgICAgICAgICAgICAgcmV0dXJuIHIyLmdldChlMyk7CiAgICAgICAgICAgIGNvbnN0IGkyID0gZnVuY3Rpb24oZTQpIHsKICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShlNCkpCiAgICAgICAgICAgICAgICByZXR1cm4gdDIoZTQubWFwKG4yKSk7CiAgICAgICAgICAgICAgaWYgKGU0LnR5cGUgPT09ICJjb25jYXQiIHx8IGU0LnR5cGUgPT09ICJmaWxsIikgewogICAgICAgICAgICAgICAgY29uc3QgcjMgPSBlNC5wYXJ0cy5tYXAobjIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHQyKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZTQpLCB7fSwgeyBwYXJ0czogcjMgfSkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoZTQudHlwZSA9PT0gImlmLWJyZWFrIikgewogICAgICAgICAgICAgICAgY29uc3QgcjMgPSBlNC5icmVha0NvbnRlbnRzICYmIG4yKGU0LmJyZWFrQ29udGVudHMpLCBpMyA9IGU0LmZsYXRDb250ZW50cyAmJiBuMihlNC5mbGF0Q29udGVudHMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHQyKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZTQpLCB7fSwgeyBicmVha0NvbnRlbnRzOiByMywgZmxhdENvbnRlbnRzOiBpMyB9KSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChlNC50eXBlID09PSAiZ3JvdXAiICYmIGU0LmV4cGFuZGVkU3RhdGVzKSB7CiAgICAgICAgICAgICAgICBjb25zdCByMyA9IGU0LmV4cGFuZGVkU3RhdGVzLm1hcChuMiksIGkzID0gcjNbMF07CiAgICAgICAgICAgICAgICByZXR1cm4gdDIoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlNCksIHt9LCB7IGNvbnRlbnRzOiBpMywgZXhwYW5kZWRTdGF0ZXM6IHIzIH0pKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGU0LmNvbnRlbnRzKSB7CiAgICAgICAgICAgICAgICBjb25zdCByMyA9IG4yKGU0LmNvbnRlbnRzKTsKICAgICAgICAgICAgICAgIHJldHVybiB0MihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGU0KSwge30sIHsgY29udGVudHM6IHIzIH0pKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHQyKGU0KTsKICAgICAgICAgICAgfShlMyk7CiAgICAgICAgICAgIHJldHVybiByMi5zZXQoZTMsIGkyKSwgaTI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEV1KGUyLCB0MiwgcjIpIHsKICAgICAgICAgIGxldCBuMiA9IHIyLCBpMiA9IGZhbHNlOwogICAgICAgICAgcmV0dXJuIGd1KGUyLCBmdW5jdGlvbihlMykgewogICAgICAgICAgICBjb25zdCByMyA9IHQyKGUzKTsKICAgICAgICAgICAgaWYgKHIzICE9PSB2b2lkIDAgJiYgKGkyID0gdHJ1ZSwgbjIgPSByMyksIGkyKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0pLCBuMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQ3UoZTIpIHsKICAgICAgICAgIHJldHVybiAhKGUyLnR5cGUgIT09ICJncm91cCIgfHwgIWUyLmJyZWFrKSB8fCAoIShlMi50eXBlICE9PSAibGluZSIgfHwgIWUyLmhhcmQpIHx8IChlMi50eXBlID09PSAiYnJlYWstcGFyZW50IiB8fCB2b2lkIDApKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24geXUoZTIpIHsKICAgICAgICAgIGlmIChlMi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gbHUoZTIpOwogICAgICAgICAgICB0Mi5leHBhbmRlZFN0YXRlcyB8fCB0Mi5icmVhayB8fCAodDIuYnJlYWsgPSAicHJvcGFnYXRlZCIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJ1KGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSAhPT0gImxpbmUiIHx8IGUyLmhhcmQgPyBlMi50eXBlID09PSAiaWYtYnJlYWsiID8gZTIuZmxhdENvbnRlbnRzIHx8ICIiIDogZTIgOiBlMi5zb2Z0ID8gIiIgOiAiICI7CiAgICAgICAgfQogICAgICAgIGNvbnN0IFN1ID0gKGUyLCB0MikgPT4gZTIgJiYgZTIudHlwZSA9PT0gImxpbmUiICYmIGUyLmhhcmQgJiYgdDIgJiYgdDIudHlwZSA9PT0gImJyZWFrLXBhcmVudCI7CiAgICAgICAgZnVuY3Rpb24gVHUoZTIpIHsKICAgICAgICAgIGlmICghZTIpCiAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICAgIGlmIChEdShlMikgfHwgZTIudHlwZSA9PT0gImZpbGwiKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gZnUoZTIpOwogICAgICAgICAgICBmb3IgKDsgdDIubGVuZ3RoID4gMSAmJiBTdSguLi50Mi5zbGljZSgtMikpOyApCiAgICAgICAgICAgICAgdDIubGVuZ3RoIC09IDI7CiAgICAgICAgICAgIGlmICh0Mi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSBUdShsdSh0MikpOwogICAgICAgICAgICAgIHQyW3QyLmxlbmd0aCAtIDFdID0gZTM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoZTIpID8gdDIgOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGUyKSwge30sIHsgcGFydHM6IHQyIH0pOwogICAgICAgICAgfQogICAgICAgICAgc3dpdGNoIChlMi50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgImFsaWduIjoKICAgICAgICAgICAgY2FzZSAiaW5kZW50IjoKICAgICAgICAgICAgY2FzZSAiaW5kZW50LWlmLWJyZWFrIjoKICAgICAgICAgICAgY2FzZSAiZ3JvdXAiOgogICAgICAgICAgICBjYXNlICJsaW5lLXN1ZmZpeCI6CiAgICAgICAgICAgIGNhc2UgImxhYmVsIjogewogICAgICAgICAgICAgIGNvbnN0IHQyID0gVHUoZTIuY29udGVudHMpOwogICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGUyKSwge30sIHsgY29udGVudHM6IHQyIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImlmLWJyZWFrIjogewogICAgICAgICAgICAgIGNvbnN0IHQyID0gVHUoZTIuYnJlYWtDb250ZW50cyksIHIyID0gVHUoZTIuZmxhdENvbnRlbnRzKTsKICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlMiksIHt9LCB7IGJyZWFrQ29udGVudHM6IHQyLCBmbGF0Q29udGVudHM6IHIyIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIF91KGUyKSB7CiAgICAgICAgICByZXR1cm4gbXUoZTIsIChlMykgPT4gZnVuY3Rpb24oZTQpIHsKICAgICAgICAgICAgc3dpdGNoIChlNC50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAiZmlsbCI6CiAgICAgICAgICAgICAgICBpZiAoZTQucGFydHMuZXZlcnkoKGU1KSA9PiBlNSA9PT0gIiIpKQogICAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJncm91cCI6CiAgICAgICAgICAgICAgICBpZiAoIShlNC5jb250ZW50cyB8fCBlNC5pZCB8fCBlNC5icmVhayB8fCBlNC5leHBhbmRlZFN0YXRlcykpCiAgICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICAgIGlmIChlNC5jb250ZW50cy50eXBlID09PSAiZ3JvdXAiICYmIGU0LmNvbnRlbnRzLmlkID09PSBlNC5pZCAmJiBlNC5jb250ZW50cy5icmVhayA9PT0gZTQuYnJlYWsgJiYgZTQuY29udGVudHMuZXhwYW5kZWRTdGF0ZXMgPT09IGU0LmV4cGFuZGVkU3RhdGVzKQogICAgICAgICAgICAgICAgICByZXR1cm4gZTQuY29udGVudHM7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJhbGlnbiI6CiAgICAgICAgICAgICAgY2FzZSAiaW5kZW50IjoKICAgICAgICAgICAgICBjYXNlICJpbmRlbnQtaWYtYnJlYWsiOgogICAgICAgICAgICAgIGNhc2UgImxpbmUtc3VmZml4IjoKICAgICAgICAgICAgICAgIGlmICghZTQuY29udGVudHMpCiAgICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgImlmLWJyZWFrIjoKICAgICAgICAgICAgICAgIGlmICghZTQuZmxhdENvbnRlbnRzICYmICFlNC5icmVha0NvbnRlbnRzKQogICAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFEdShlNCkpCiAgICAgICAgICAgICAgcmV0dXJuIGU0OwogICAgICAgICAgICBjb25zdCB0MiA9IFtdOwogICAgICAgICAgICBmb3IgKGNvbnN0IHIyIG9mIGZ1KGU0KSkgewogICAgICAgICAgICAgIGlmICghcjIpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICBjb25zdCBbZTUsIC4uLm4yXSA9IER1KHIyKSA/IGZ1KHIyKSA6IFtyMl07CiAgICAgICAgICAgICAgdHlwZW9mIGU1ID09ICJzdHJpbmciICYmIHR5cGVvZiBsdSh0MikgPT0gInN0cmluZyIgPyB0Mlt0Mi5sZW5ndGggLSAxXSArPSBlNSA6IHQyLnB1c2goZTUpLCB0Mi5wdXNoKC4uLm4yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdDIubGVuZ3RoID09PSAwID8gIiIgOiB0Mi5sZW5ndGggPT09IDEgPyB0MlswXSA6IEFycmF5LmlzQXJyYXkoZTQpID8gdDIgOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGU0KSwge30sIHsgcGFydHM6IHQyIH0pOwogICAgICAgICAgfShlMykpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB2dShlMikgewogICAgICAgICAgY29uc3QgdDIgPSBbXSwgcjIgPSBlMi5maWx0ZXIoQm9vbGVhbik7CiAgICAgICAgICBmb3IgKDsgcjIubGVuZ3RoID4gMDsgKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gcjIuc2hpZnQoKTsKICAgICAgICAgICAgZTMgJiYgKER1KGUzKSA/IHIyLnVuc2hpZnQoLi4uZnUoZTMpKSA6IHQyLmxlbmd0aCA+IDAgJiYgdHlwZW9mIGx1KHQyKSA9PSAic3RyaW5nIiAmJiB0eXBlb2YgZTMgPT0gInN0cmluZyIgPyB0Mlt0Mi5sZW5ndGggLSAxXSArPSBlMyA6IHQyLnB1c2goZTMpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQXUoZTIpIHsKICAgICAgICAgIGxldCB0MiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDogcHU7CiAgICAgICAgICByZXR1cm4gaHUodDIsIGUyLnNwbGl0KCJcbiIpKS5wYXJ0czsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gRnUoZTIpIHsKICAgICAgICAgIGlmIChlMi50eXBlID09PSAibGluZSIpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICB2YXIgd3UgPSB7IGlzQ29uY2F0OiBEdSwgZ2V0RG9jUGFydHM6IGZ1LCB3aWxsQnJlYWs6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gRXUoZTIsIEN1LCBmYWxzZSk7CiAgICAgICAgfSwgdHJhdmVyc2VEb2M6IGd1LCBmaW5kSW5Eb2M6IEV1LCBtYXBEb2M6IG11LCBwcm9wYWdhdGVCcmVha3M6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCksIHIyID0gW107CiAgICAgICAgICBndShlMiwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgaWYgKGUzLnR5cGUgPT09ICJicmVhay1wYXJlbnQiICYmIHl1KHIyKSwgZTMudHlwZSA9PT0gImdyb3VwIikgewogICAgICAgICAgICAgIGlmIChyMi5wdXNoKGUzKSwgdDIuaGFzKGUzKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB0Mi5hZGQoZTMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCBmdW5jdGlvbihlMykgewogICAgICAgICAgICBpZiAoZTMudHlwZSA9PT0gImdyb3VwIikgewogICAgICAgICAgICAgIHIyLnBvcCgpLmJyZWFrICYmIHl1KHIyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgdHJ1ZSk7CiAgICAgICAgfSwgcmVtb3ZlTGluZXM6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gbXUoZTIsIGJ1KTsKICAgICAgICB9LCBzdHJpcFRyYWlsaW5nSGFyZGxpbmU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gVHUoX3UoZTIpKTsKICAgICAgICB9LCBub3JtYWxpemVQYXJ0czogdnUsIG5vcm1hbGl6ZURvYzogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBtdShlMiwgKGUzKSA9PiBBcnJheS5pc0FycmF5KGUzKSA/IHZ1KGUzKSA6IGUzLnBhcnRzID8gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlMyksIHt9LCB7IHBhcnRzOiB2dShlMy5wYXJ0cykgfSkgOiBlMyk7CiAgICAgICAgfSwgY2xlYW5Eb2M6IF91LCByZXBsYWNlVGV4dEVuZE9mTGluZTogQXUsIHJlcGxhY2VFbmRPZkxpbmU6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gbXUoZTIsIChlMykgPT4gdHlwZW9mIGUzID09ICJzdHJpbmciICYmIGUzLmluY2x1ZGVzKCJcbiIpID8gQXUoZTMpIDogZTMpOwogICAgICAgIH0sIGNhbkJyZWFrOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIEV1KGUyLCBGdSwgZmFsc2UpOwogICAgICAgIH0gfTsKICAgICAgICBjb25zdCB7IGdldFN0cmluZ1dpZHRoOiBrdSwgZ2V0TGFzdDogTnUgfSA9IEphLCB7IGNvbnZlcnRFbmRPZkxpbmVUb0NoYXJzOiBPdSB9ID0gY3UsIHsgZmlsbDogeHUsIGN1cnNvcjogSXUsIGluZGVudDogUHUgfSA9IHV1LCB7IGlzQ29uY2F0OiBSdSwgZ2V0RG9jUGFydHM6IEx1IH0gPSB3dTsKICAgICAgICBsZXQgQnU7CiAgICAgICAgZnVuY3Rpb24gcXUoZTIsIHQyKSB7CiAgICAgICAgICByZXR1cm4gTXUoZTIsIHsgdHlwZTogImluZGVudCIgfSwgdDIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiAkdShlMiwgdDIsIHIyKSB7CiAgICAgICAgICBpZiAodDIgPT09IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSkKICAgICAgICAgICAgcmV0dXJuIGUyLnJvb3QgfHwgeyB2YWx1ZTogIiIsIGxlbmd0aDogMCwgcXVldWU6IFtdIH07CiAgICAgICAgICBpZiAodDIgPCAwKQogICAgICAgICAgICByZXR1cm4gTXUoZTIsIHsgdHlwZTogImRlZGVudCIgfSwgcjIpOwogICAgICAgICAgaWYgKCF0MikKICAgICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgICAgaWYgKHQyLnR5cGUgPT09ICJyb290IikKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgZTIpLCB7fSwgeyByb290OiBlMiB9KTsKICAgICAgICAgIHJldHVybiBNdShlMiwgeyB0eXBlOiB0eXBlb2YgdDIgPT0gInN0cmluZyIgPyAic3RyaW5nQWxpZ24iIDogIm51bWJlckFsaWduIiwgbjogdDIgfSwgcjIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBNdShlMiwgdDIsIHIyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IHQyLnR5cGUgPT09ICJkZWRlbnQiID8gZTIucXVldWUuc2xpY2UoMCwgLTEpIDogWy4uLmUyLnF1ZXVlLCB0Ml07CiAgICAgICAgICBsZXQgaTIgPSAiIiwgczIgPSAwLCBvMiA9IDAsIGEyID0gMDsKICAgICAgICAgIGZvciAoY29uc3QgZTMgb2YgbjIpCiAgICAgICAgICAgIHN3aXRjaCAoZTMudHlwZSkgewogICAgICAgICAgICAgIGNhc2UgImluZGVudCI6CiAgICAgICAgICAgICAgICBsMigpLCByMi51c2VUYWJzID8gdTIoMSkgOiBjMihyMi50YWJXaWR0aCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJzdHJpbmdBbGlnbiI6CiAgICAgICAgICAgICAgICBsMigpLCBpMiArPSBlMy5uLCBzMiArPSBlMy5uLmxlbmd0aDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIm51bWJlckFsaWduIjoKICAgICAgICAgICAgICAgIG8yICs9IDEsIGEyICs9IGUzLm47CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkIHR5cGUgJyIuY29uY2F0KGUzLnR5cGUsICInIikpOwogICAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcDIoKSwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlMiksIHt9LCB7IHZhbHVlOiBpMiwgbGVuZ3RoOiBzMiwgcXVldWU6IG4yIH0pOwogICAgICAgICAgZnVuY3Rpb24gdTIoZTMpIHsKICAgICAgICAgICAgaTIgKz0gIgkiLnJlcGVhdChlMyksIHMyICs9IHIyLnRhYldpZHRoICogZTM7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjMihlMykgewogICAgICAgICAgICBpMiArPSAiICIucmVwZWF0KGUzKSwgczIgKz0gZTM7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBsMigpIHsKICAgICAgICAgICAgcjIudXNlVGFicyA/IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIG8yID4gMCAmJiB1MihvMik7CiAgICAgICAgICAgICAgaDIoKTsKICAgICAgICAgICAgfSgpIDogcDIoKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHAyKCkgewogICAgICAgICAgICBhMiA+IDAgJiYgYzIoYTIpLCBoMigpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gaDIoKSB7CiAgICAgICAgICAgIG8yID0gMCwgYTIgPSAwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBqdShlMikgewogICAgICAgICAgaWYgKGUyLmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICBsZXQgdDIgPSAwOwogICAgICAgICAgZm9yICg7IGUyLmxlbmd0aCA+IDAgJiYgdHlwZW9mIE51KGUyKSA9PSAic3RyaW5nIiAmJiAvXltcdCBdKiQvLnRlc3QoTnUoZTIpKTsgKQogICAgICAgICAgICB0MiArPSBlMi5wb3AoKS5sZW5ndGg7CiAgICAgICAgICBpZiAoZTIubGVuZ3RoID4gMCAmJiB0eXBlb2YgTnUoZTIpID09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGNvbnN0IHIyID0gTnUoZTIpLnJlcGxhY2UoL1tcdCBdKiQvLCAiIik7CiAgICAgICAgICAgIHQyICs9IE51KGUyKS5sZW5ndGggLSByMi5sZW5ndGgsIGUyW2UyLmxlbmd0aCAtIDFdID0gcjI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFV1KGUyLCB0MiwgcjIsIG4yLCBpMiwgczIpIHsKICAgICAgICAgIGxldCBvMiA9IHQyLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IGEyID0gW2UyXSwgdTIgPSBbXTsKICAgICAgICAgIGZvciAoOyByMiA+PSAwOyApIHsKICAgICAgICAgICAgaWYgKGEyLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIGlmIChvMiA9PT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIGEyLnB1c2godDJbbzIgLSAxXSksIG8yLS07CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgW2UzLCBjMiwgbDJdID0gYTIucG9wKCk7CiAgICAgICAgICAgIGlmICh0eXBlb2YgbDIgPT0gInN0cmluZyIpCiAgICAgICAgICAgICAgdTIucHVzaChsMiksIHIyIC09IGt1KGwyKTsKICAgICAgICAgICAgZWxzZSBpZiAoUnUobDIpKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSBMdShsMik7CiAgICAgICAgICAgICAgZm9yIChsZXQgcjMgPSB0My5sZW5ndGggLSAxOyByMyA+PSAwOyByMy0tKQogICAgICAgICAgICAgICAgYTIucHVzaChbZTMsIGMyLCB0M1tyM11dKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgc3dpdGNoIChsMi50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJpbmRlbnQiOgogICAgICAgICAgICAgICAgICBhMi5wdXNoKFtxdShlMywgbjIpLCBjMiwgbDIuY29udGVudHNdKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJhbGlnbiI6CiAgICAgICAgICAgICAgICAgIGEyLnB1c2goWyR1KGUzLCBsMi5uLCBuMiksIGMyLCBsMi5jb250ZW50c10pOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInRyaW0iOgogICAgICAgICAgICAgICAgICByMiArPSBqdSh1Mik7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiZ3JvdXAiOiB7CiAgICAgICAgICAgICAgICAgIGlmIChzMiAmJiBsMi5icmVhaykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gbDIuYnJlYWsgPyAxIDogYzI7CiAgICAgICAgICAgICAgICAgIGEyLnB1c2goW2UzLCB0MywgbDIuZXhwYW5kZWRTdGF0ZXMgJiYgdDMgPT09IDEgPyBOdShsMi5leHBhbmRlZFN0YXRlcykgOiBsMi5jb250ZW50c10pLCBsMi5pZCAmJiAoQnVbbDIuaWRdID0gdDMpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgImZpbGwiOgogICAgICAgICAgICAgICAgICBmb3IgKGxldCB0MyA9IGwyLnBhcnRzLmxlbmd0aCAtIDE7IHQzID49IDA7IHQzLS0pCiAgICAgICAgICAgICAgICAgICAgYTIucHVzaChbZTMsIGMyLCBsMi5wYXJ0c1t0M11dKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJpZi1icmVhayI6CiAgICAgICAgICAgICAgICBjYXNlICJpbmRlbnQtaWYtYnJlYWsiOiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gbDIuZ3JvdXBJZCA/IEJ1W2wyLmdyb3VwSWRdIDogYzI7CiAgICAgICAgICAgICAgICAgIGlmICh0MyA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHQ0ID0gbDIudHlwZSA9PT0gImlmLWJyZWFrIiA/IGwyLmJyZWFrQ29udGVudHMgOiBsMi5uZWdhdGUgPyBsMi5jb250ZW50cyA6IFB1KGwyLmNvbnRlbnRzKTsKICAgICAgICAgICAgICAgICAgICB0NCAmJiBhMi5wdXNoKFtlMywgYzIsIHQ0XSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKHQzID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdDQgPSBsMi50eXBlID09PSAiaWYtYnJlYWsiID8gbDIuZmxhdENvbnRlbnRzIDogbDIubmVnYXRlID8gUHUobDIuY29udGVudHMpIDogbDIuY29udGVudHM7CiAgICAgICAgICAgICAgICAgICAgdDQgJiYgYTIucHVzaChbZTMsIGMyLCB0NF0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAibGluZSI6CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYzIpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWwyLmhhcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbDIuc29mdCB8fCAodTIucHVzaCgiICIpLCByMiAtPSAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImxpbmUtc3VmZml4IjoKICAgICAgICAgICAgICAgICAgaTIgPSB0cnVlOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImxpbmUtc3VmZml4LWJvdW5kYXJ5IjoKICAgICAgICAgICAgICAgICAgaWYgKGkyKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJsYWJlbCI6CiAgICAgICAgICAgICAgICAgIGEyLnB1c2goW2UzLCBjMiwgbDIuY29udGVudHNdKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciBHdSA9IHsgcHJpbnREb2NUb1N0cmluZzogZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBCdSA9IHt9OwogICAgICAgICAgY29uc3QgcjIgPSB0Mi5wcmludFdpZHRoLCBuMiA9IE91KHQyLmVuZE9mTGluZSk7CiAgICAgICAgICBsZXQgaTIgPSAwOwogICAgICAgICAgY29uc3QgczIgPSBbW3sgdmFsdWU6ICIiLCBsZW5ndGg6IDAsIHF1ZXVlOiBbXSB9LCAxLCBlMl1dLCBvMiA9IFtdOwogICAgICAgICAgbGV0IGEyID0gZmFsc2UsIHUyID0gW107CiAgICAgICAgICBmb3IgKDsgczIubGVuZ3RoID4gMDsgKSB7CiAgICAgICAgICAgIGNvbnN0IFtlMywgYzMsIGwyXSA9IHMyLnBvcCgpOwogICAgICAgICAgICBpZiAodHlwZW9mIGwyID09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgY29uc3QgZTQgPSBuMiAhPT0gIlxuIiA/IGwyLnJlcGxhY2UoL1xuL2csIG4yKSA6IGwyOwogICAgICAgICAgICAgIG8yLnB1c2goZTQpLCBpMiArPSBrdShlNCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoUnUobDIpKSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSBMdShsMik7CiAgICAgICAgICAgICAgZm9yIChsZXQgcjMgPSB0My5sZW5ndGggLSAxOyByMyA+PSAwOyByMy0tKQogICAgICAgICAgICAgICAgczIucHVzaChbZTMsIGMzLCB0M1tyM11dKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgc3dpdGNoIChsMi50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJjdXJzb3IiOgogICAgICAgICAgICAgICAgICBvMi5wdXNoKEl1LnBsYWNlaG9sZGVyKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJpbmRlbnQiOgogICAgICAgICAgICAgICAgICBzMi5wdXNoKFtxdShlMywgdDIpLCBjMywgbDIuY29udGVudHNdKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJhbGlnbiI6CiAgICAgICAgICAgICAgICAgIHMyLnB1c2goWyR1KGUzLCBsMi5uLCB0MiksIGMzLCBsMi5jb250ZW50c10pOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInRyaW0iOgogICAgICAgICAgICAgICAgICBpMiAtPSBqdShvMik7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiZ3JvdXAiOgogICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMzKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgaWYgKCFhMikgewogICAgICAgICAgICAgICAgICAgICAgICBzMi5wdXNoKFtlMywgbDIuYnJlYWsgPyAxIDogMiwgbDIuY29udGVudHNdKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOiB7CiAgICAgICAgICAgICAgICAgICAgICBhMiA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgY29uc3QgbjMgPSBbZTMsIDIsIGwyLmNvbnRlbnRzXSwgbzMgPSByMiAtIGkyLCBjNCA9IHUyLmxlbmd0aCA+IDA7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWwyLmJyZWFrICYmIFV1KG4zLCBzMiwgbzMsIHQyLCBjNCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHMyLnB1c2gobjMpOwogICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobDIuZXhwYW5kZWRTdGF0ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcjMgPSBOdShsMi5leHBhbmRlZFN0YXRlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsMi5icmVhaykgewogICAgICAgICAgICAgICAgICAgICAgICAgIHMyLnB1c2goW2UzLCAxLCByM10pOwogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG40ID0gMTsgbjQgPCBsMi5leHBhbmRlZFN0YXRlcy5sZW5ndGggKyAxOyBuNCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG40ID49IGwyLmV4cGFuZGVkU3RhdGVzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgczIucHVzaChbZTMsIDEsIHIzXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcjQgPSBbZTMsIDIsIGwyLmV4cGFuZGVkU3RhdGVzW240XV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoVXUocjQsIHMyLCBvMywgdDIsIGM0KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzMi5wdXNoKHI0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgczIucHVzaChbZTMsIDEsIGwyLmNvbnRlbnRzXSk7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgbDIuaWQgJiYgKEJ1W2wyLmlkXSA9IE51KHMyKVsxXSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiZmlsbCI6IHsKICAgICAgICAgICAgICAgICAgY29uc3QgbjMgPSByMiAtIGkyLCB7IHBhcnRzOiBvMyB9ID0gbDI7CiAgICAgICAgICAgICAgICAgIGlmIChvMy5sZW5ndGggPT09IDApCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNvbnN0IFthMywgcDJdID0gbzMsIGgyID0gW2UzLCAyLCBhM10sIEQyID0gW2UzLCAxLCBhM10sIGYyID0gVXUoaDIsIFtdLCBuMywgdDIsIHUyLmxlbmd0aCA+IDAsIHRydWUpOwogICAgICAgICAgICAgICAgICBpZiAobzMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgZjIgPyBzMi5wdXNoKGgyKSA6IHMyLnB1c2goRDIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGNvbnN0IGQyID0gW2UzLCAyLCBwMl0sIGcyID0gW2UzLCAxLCBwMl07CiAgICAgICAgICAgICAgICAgIGlmIChvMy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICBmMiA/IHMyLnB1c2goZDIsIGgyKSA6IHMyLnB1c2goZzIsIEQyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBvMy5zcGxpY2UoMCwgMik7CiAgICAgICAgICAgICAgICAgIGNvbnN0IG0yID0gW2UzLCBjMywgeHUobzMpXTsKICAgICAgICAgICAgICAgICAgVXUoW2UzLCAyLCBbYTMsIHAyLCBvM1swXV1dLCBbXSwgbjMsIHQyLCB1Mi5sZW5ndGggPiAwLCB0cnVlKSA/IHMyLnB1c2gobTIsIGQyLCBoMikgOiBmMiA/IHMyLnB1c2gobTIsIGcyLCBoMikgOiBzMi5wdXNoKG0yLCBnMiwgRDIpOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgImlmLWJyZWFrIjoKICAgICAgICAgICAgICAgIGNhc2UgImluZGVudC1pZi1icmVhayI6IHsKICAgICAgICAgICAgICAgICAgY29uc3QgdDMgPSBsMi5ncm91cElkID8gQnVbbDIuZ3JvdXBJZF0gOiBjMzsKICAgICAgICAgICAgICAgICAgaWYgKHQzID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdDQgPSBsMi50eXBlID09PSAiaWYtYnJlYWsiID8gbDIuYnJlYWtDb250ZW50cyA6IGwyLm5lZ2F0ZSA/IGwyLmNvbnRlbnRzIDogUHUobDIuY29udGVudHMpOwogICAgICAgICAgICAgICAgICAgIHQ0ICYmIHMyLnB1c2goW2UzLCBjMywgdDRdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAodDMgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0NCA9IGwyLnR5cGUgPT09ICJpZi1icmVhayIgPyBsMi5mbGF0Q29udGVudHMgOiBsMi5uZWdhdGUgPyBQdShsMi5jb250ZW50cykgOiBsMi5jb250ZW50czsKICAgICAgICAgICAgICAgICAgICB0NCAmJiBzMi5wdXNoKFtlMywgYzMsIHQ0XSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXNlICJsaW5lLXN1ZmZpeCI6CiAgICAgICAgICAgICAgICAgIHUyLnB1c2goW2UzLCBjMywgbDIuY29udGVudHNdKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJsaW5lLXN1ZmZpeC1ib3VuZGFyeSI6CiAgICAgICAgICAgICAgICAgIHUyLmxlbmd0aCA+IDAgJiYgczIucHVzaChbZTMsIGMzLCB7IHR5cGU6ICJsaW5lIiwgaGFyZDogdHJ1ZSB9XSk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAibGluZSI6CiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYzMpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWwyLmhhcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbDIuc29mdCB8fCAobzIucHVzaCgiICIpLCBpMiArPSAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBhMiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgaWYgKHUyLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgczIucHVzaChbZTMsIGMzLCBsMl0sIC4uLnUyLnJldmVyc2UoKSksIHUyID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgbDIubGl0ZXJhbCA/IGUzLnJvb3QgPyAobzIucHVzaChuMiwgZTMucm9vdC52YWx1ZSksIGkyID0gZTMucm9vdC5sZW5ndGgpIDogKG8yLnB1c2gobjIpLCBpMiA9IDApIDogKGkyIC09IGp1KG8yKSwgbzIucHVzaChuMiArIGUzLnZhbHVlKSwgaTIgPSBlMy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAibGFiZWwiOgogICAgICAgICAgICAgICAgICBzMi5wdXNoKFtlMywgYzMsIGwyLmNvbnRlbnRzXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICBzMi5sZW5ndGggPT09IDAgJiYgdTIubGVuZ3RoID4gMCAmJiAoczIucHVzaCguLi51Mi5yZXZlcnNlKCkpLCB1MiA9IFtdKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGMyID0gbzIuaW5kZXhPZihJdS5wbGFjZWhvbGRlcik7CiAgICAgICAgICBpZiAoYzIgIT09IC0xKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gbzIuaW5kZXhPZihJdS5wbGFjZWhvbGRlciwgYzIgKyAxKSwgdDMgPSBvMi5zbGljZSgwLCBjMikuam9pbigiIiksIHIzID0gbzIuc2xpY2UoYzIgKyAxLCBlMykuam9pbigiIik7CiAgICAgICAgICAgIHJldHVybiB7IGZvcm1hdHRlZDogdDMgKyByMyArIG8yLnNsaWNlKGUzICsgMSkuam9pbigiIiksIGN1cnNvck5vZGVTdGFydDogdDMubGVuZ3RoLCBjdXJzb3JOb2RlVGV4dDogcjMgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB7IGZvcm1hdHRlZDogbzIuam9pbigiIikgfTsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgeyBpc0NvbmNhdDogVnUsIGdldERvY1BhcnRzOiBYdSB9ID0gd3U7CiAgICAgICAgZnVuY3Rpb24gSHUoZTIpIHsKICAgICAgICAgIGlmICghZTIpCiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgIGlmIChWdShlMikpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSBbXTsKICAgICAgICAgICAgZm9yIChjb25zdCByMiBvZiBYdShlMikpCiAgICAgICAgICAgICAgaWYgKFZ1KHIyKSkKICAgICAgICAgICAgICAgIHQyLnB1c2goLi4uSHUocjIpLnBhcnRzKTsKICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IGUzID0gSHUocjIpOwogICAgICAgICAgICAgICAgZTMgIT09ICIiICYmIHQyLnB1c2goZTMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHsgdHlwZTogImNvbmNhdCIsIHBhcnRzOiB0MiB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJpZi1icmVhayIgPyBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGUyKSwge30sIHsgYnJlYWtDb250ZW50czogSHUoZTIuYnJlYWtDb250ZW50cyksIGZsYXRDb250ZW50czogSHUoZTIuZmxhdENvbnRlbnRzKSB9KSA6IGUyLnR5cGUgPT09ICJncm91cCIgPyBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGUyKSwge30sIHsgY29udGVudHM6IEh1KGUyLmNvbnRlbnRzKSwgZXhwYW5kZWRTdGF0ZXM6IGUyLmV4cGFuZGVkU3RhdGVzICYmIGUyLmV4cGFuZGVkU3RhdGVzLm1hcChIdSkgfSkgOiBlMi50eXBlID09PSAiZmlsbCIgPyB7IHR5cGU6ICJmaWxsIiwgcGFydHM6IGUyLnBhcnRzLm1hcChIdSkgfSA6IGUyLmNvbnRlbnRzID8gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBlMiksIHt9LCB7IGNvbnRlbnRzOiBIdShlMi5jb250ZW50cykgfSkgOiBlMjsKICAgICAgICB9CiAgICAgICAgdmFyIHp1ID0geyBwcmludERvY1RvRGVidWc6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBjb25zdCB0MiA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpLCByMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gZTModDMsIHIzLCBpMikgewogICAgICAgICAgICBpZiAodHlwZW9mIHQzID09ICJzdHJpbmciKQogICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0Myk7CiAgICAgICAgICAgIGlmIChWdSh0MykpIHsKICAgICAgICAgICAgICBjb25zdCByNCA9IFh1KHQzKS5tYXAoZTMpLmZpbHRlcihCb29sZWFuKTsKICAgICAgICAgICAgICByZXR1cm4gcjQubGVuZ3RoID09PSAxID8gcjRbMF0gOiAiWyIuY29uY2F0KHI0LmpvaW4oIiwgIiksICJdIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJsaW5lIikgewogICAgICAgICAgICAgIGNvbnN0IGU0ID0gQXJyYXkuaXNBcnJheShpMikgJiYgaTJbcjMgKyAxXSAmJiBpMltyMyArIDFdLnR5cGUgPT09ICJicmVhay1wYXJlbnQiOwogICAgICAgICAgICAgIHJldHVybiB0My5saXRlcmFsID8gZTQgPyAibGl0ZXJhbGxpbmUiIDogImxpdGVyYWxsaW5lV2l0aG91dEJyZWFrUGFyZW50IiA6IHQzLmhhcmQgPyBlNCA/ICJoYXJkbGluZSIgOiAiaGFyZGxpbmVXaXRob3V0QnJlYWtQYXJlbnQiIDogdDMuc29mdCA/ICJzb2Z0bGluZSIgOiAibGluZSI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJicmVhay1wYXJlbnQiKSB7CiAgICAgICAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoaTIpICYmIGkyW3IzIC0gMV0gJiYgaTJbcjMgLSAxXS50eXBlID09PSAibGluZSIgJiYgaTJbcjMgLSAxXS5oYXJkID8gdm9pZCAwIDogImJyZWFrUGFyZW50IjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodDMudHlwZSA9PT0gInRyaW0iKQogICAgICAgICAgICAgIHJldHVybiAidHJpbSI7CiAgICAgICAgICAgIGlmICh0My50eXBlID09PSAiaW5kZW50IikKICAgICAgICAgICAgICByZXR1cm4gImluZGVudCgiICsgZTModDMuY29udGVudHMpICsgIikiOwogICAgICAgICAgICBpZiAodDMudHlwZSA9PT0gImFsaWduIikKICAgICAgICAgICAgICByZXR1cm4gdDMubiA9PT0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZID8gImRlZGVudFRvUm9vdCgiICsgZTModDMuY29udGVudHMpICsgIikiIDogdDMubiA8IDAgPyAiZGVkZW50KCIgKyBlMyh0My5jb250ZW50cykgKyAiKSIgOiB0My5uLnR5cGUgPT09ICJyb290IiA/ICJtYXJrQXNSb290KCIgKyBlMyh0My5jb250ZW50cykgKyAiKSIgOiAiYWxpZ24oIiArIEpTT04uc3RyaW5naWZ5KHQzLm4pICsgIiwgIiArIGUzKHQzLmNvbnRlbnRzKSArICIpIjsKICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJpZi1icmVhayIpCiAgICAgICAgICAgICAgcmV0dXJuICJpZkJyZWFrKCIgKyBlMyh0My5icmVha0NvbnRlbnRzKSArICh0My5mbGF0Q29udGVudHMgPyAiLCAiICsgZTModDMuZmxhdENvbnRlbnRzKSA6ICIiKSArICh0My5ncm91cElkID8gKHQzLmZsYXRDb250ZW50cyA/ICIiIDogJywgIiInKSArICIsIHsgZ3JvdXBJZDogIi5jb25jYXQobjIodDMuZ3JvdXBJZCksICIgfSIpIDogIiIpICsgIikiOwogICAgICAgICAgICBpZiAodDMudHlwZSA9PT0gImluZGVudC1pZi1icmVhayIpIHsKICAgICAgICAgICAgICBjb25zdCByNCA9IFtdOwogICAgICAgICAgICAgIHQzLm5lZ2F0ZSAmJiByNC5wdXNoKCJuZWdhdGU6IHRydWUiKSwgdDMuZ3JvdXBJZCAmJiByNC5wdXNoKCJncm91cElkOiAiLmNvbmNhdChuMih0My5ncm91cElkKSkpOwogICAgICAgICAgICAgIGNvbnN0IGkzID0gcjQubGVuZ3RoID4gMCA/ICIsIHsgIi5jb25jYXQocjQuam9pbigiLCAiKSwgIiB9IikgOiAiIjsKICAgICAgICAgICAgICByZXR1cm4gImluZGVudElmQnJlYWsoIi5jb25jYXQoZTModDMuY29udGVudHMpKS5jb25jYXQoaTMsICIpIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJncm91cCIpIHsKICAgICAgICAgICAgICBjb25zdCByNCA9IFtdOwogICAgICAgICAgICAgIHQzLmJyZWFrICYmIHQzLmJyZWFrICE9PSAicHJvcGFnYXRlZCIgJiYgcjQucHVzaCgic2hvdWxkQnJlYWs6IHRydWUiKSwgdDMuaWQgJiYgcjQucHVzaCgiaWQ6ICIuY29uY2F0KG4yKHQzLmlkKSkpOwogICAgICAgICAgICAgIGNvbnN0IGkzID0gcjQubGVuZ3RoID4gMCA/ICIsIHsgIi5jb25jYXQocjQuam9pbigiLCAiKSwgIiB9IikgOiAiIjsKICAgICAgICAgICAgICByZXR1cm4gdDMuZXhwYW5kZWRTdGF0ZXMgPyAiY29uZGl0aW9uYWxHcm91cChbIi5jb25jYXQodDMuZXhwYW5kZWRTdGF0ZXMubWFwKCh0NCkgPT4gZTModDQpKS5qb2luKCIsIiksICJdIikuY29uY2F0KGkzLCAiKSIpIDogImdyb3VwKCIuY29uY2F0KGUzKHQzLmNvbnRlbnRzKSkuY29uY2F0KGkzLCAiKSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0My50eXBlID09PSAiZmlsbCIpCiAgICAgICAgICAgICAgcmV0dXJuICJmaWxsKFsiLmNvbmNhdCh0My5wYXJ0cy5tYXAoKHQ0KSA9PiBlMyh0NCkpLmpvaW4oIiwgIiksICJdKSIpOwogICAgICAgICAgICBpZiAodDMudHlwZSA9PT0gImxpbmUtc3VmZml4IikKICAgICAgICAgICAgICByZXR1cm4gImxpbmVTdWZmaXgoIiArIGUzKHQzLmNvbnRlbnRzKSArICIpIjsKICAgICAgICAgICAgaWYgKHQzLnR5cGUgPT09ICJsaW5lLXN1ZmZpeC1ib3VuZGFyeSIpCiAgICAgICAgICAgICAgcmV0dXJuICJsaW5lU3VmZml4Qm91bmRhcnkiOwogICAgICAgICAgICBpZiAodDMudHlwZSA9PT0gImxhYmVsIikKICAgICAgICAgICAgICByZXR1cm4gImxhYmVsKCIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHQzLmxhYmVsKSwgIiwgIikuY29uY2F0KGUzKHQzLmNvbnRlbnRzKSwgIikiKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIGRvYyB0eXBlICIgKyB0My50eXBlKTsKICAgICAgICAgIH0oSHUoZTIpKTsKICAgICAgICAgIGZ1bmN0aW9uIG4yKGUzKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZTMgIT0gInN5bWJvbCIpCiAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KFN0cmluZyhlMykpOwogICAgICAgICAgICBpZiAoZTMgaW4gdDIpCiAgICAgICAgICAgICAgcmV0dXJuIHQyW2UzXTsKICAgICAgICAgICAgY29uc3QgbjMgPSBTdHJpbmcoZTMpLnNsaWNlKDcsIC0xKSB8fCAic3ltYm9sIjsKICAgICAgICAgICAgZm9yIChsZXQgaTIgPSAwOyA7IGkyKyspIHsKICAgICAgICAgICAgICBjb25zdCBzMiA9IG4zICsgKGkyID4gMCA/ICIgIyIuY29uY2F0KGkyKSA6ICIiKTsKICAgICAgICAgICAgICBpZiAoIXIyLmhhcyhzMikpCiAgICAgICAgICAgICAgICByZXR1cm4gcjIuYWRkKHMyKSwgdDJbZTNdID0gIlN5bWJvbC5mb3IoIi5jb25jYXQoSlNPTi5zdHJpbmdpZnkoczIpLCAiKSIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSB9LCBXdSA9IHsgYnVpbGRlcnM6IHV1LCBwcmludGVyOiBHdSwgdXRpbHM6IHd1LCBkZWJ1ZzogenUgfTsKICAgICAgICBjb25zdCBZdSA9IFsiYSIsICJhYmJyIiwgImFjcm9ueW0iLCAiYWRkcmVzcyIsICJhcHBsZXQiLCAiYXJlYSIsICJhcnRpY2xlIiwgImFzaWRlIiwgImF1ZGlvIiwgImIiLCAiYmFzZSIsICJiYXNlZm9udCIsICJiZGkiLCAiYmRvIiwgImJnc291bmQiLCAiYmlnIiwgImJsaW5rIiwgImJsb2NrcXVvdGUiLCAiYm9keSIsICJiciIsICJidXR0b24iLCAiY2FudmFzIiwgImNhcHRpb24iLCAiY2VudGVyIiwgImNpdGUiLCAiY29kZSIsICJjb2wiLCAiY29sZ3JvdXAiLCAiY29tbWFuZCIsICJjb250ZW50IiwgImRhdGEiLCAiZGF0YWxpc3QiLCAiZGQiLCAiZGVsIiwgImRldGFpbHMiLCAiZGZuIiwgImRpYWxvZyIsICJkaXIiLCAiZGl2IiwgImRsIiwgImR0IiwgImVsZW1lbnQiLCAiZW0iLCAiZW1iZWQiLCAiZmllbGRzZXQiLCAiZmlnY2FwdGlvbiIsICJmaWd1cmUiLCAiZm9udCIsICJmb290ZXIiLCAiZm9ybSIsICJmcmFtZSIsICJmcmFtZXNldCIsICJoMSIsICJoMiIsICJoMyIsICJoNCIsICJoNSIsICJoNiIsICJoZWFkIiwgImhlYWRlciIsICJoZ3JvdXAiLCAiaHIiLCAiaHRtbCIsICJpIiwgImlmcmFtZSIsICJpbWFnZSIsICJpbWciLCAiaW5wdXQiLCAiaW5zIiwgImlzaW5kZXgiLCAia2JkIiwgImtleWdlbiIsICJsYWJlbCIsICJsZWdlbmQiLCAibGkiLCAibGluayIsICJsaXN0aW5nIiwgIm1haW4iLCAibWFwIiwgIm1hcmsiLCAibWFycXVlZSIsICJtYXRoIiwgIm1lbnUiLCAibWVudWl0ZW0iLCAibWV0YSIsICJtZXRlciIsICJtdWx0aWNvbCIsICJuYXYiLCAibmV4dGlkIiwgIm5vYnIiLCAibm9lbWJlZCIsICJub2ZyYW1lcyIsICJub3NjcmlwdCIsICJvYmplY3QiLCAib2wiLCAib3B0Z3JvdXAiLCAib3B0aW9uIiwgIm91dHB1dCIsICJwIiwgInBhcmFtIiwgInBpY3R1cmUiLCAicGxhaW50ZXh0IiwgInByZSIsICJwcm9ncmVzcyIsICJxIiwgInJiIiwgInJiYyIsICJycCIsICJydCIsICJydGMiLCAicnVieSIsICJzIiwgInNhbXAiLCAic2NyaXB0IiwgInNlY3Rpb24iLCAic2VsZWN0IiwgInNoYWRvdyIsICJzbG90IiwgInNtYWxsIiwgInNvdXJjZSIsICJzcGFjZXIiLCAic3BhbiIsICJzdHJpa2UiLCAic3Ryb25nIiwgInN0eWxlIiwgInN1YiIsICJzdW1tYXJ5IiwgInN1cCIsICJzdmciLCAidGFibGUiLCAidGJvZHkiLCAidGQiLCAidGVtcGxhdGUiLCAidGV4dGFyZWEiLCAidGZvb3QiLCAidGgiLCAidGhlYWQiLCAidGltZSIsICJ0aXRsZSIsICJ0ciIsICJ0cmFjayIsICJ0dCIsICJ1IiwgInVsIiwgInZhciIsICJ2aWRlbyIsICJ3YnIiLCAieG1wIl0sIFF1ID0gWmEsIHsgaW5mZXJQYXJzZXJCeUxhbmd1YWdlOiBKdSwgaXNGcm9udE1hdHRlck5vZGU6IFp1IH0gPSBKYSwgeyBidWlsZGVyczogeyBsaW5lOiBLdSwgaGFyZGxpbmU6IGVjLCBqb2luOiB0YyB9LCB1dGlsczogeyBnZXREb2NQYXJ0czogcmMsIHJlcGxhY2VUZXh0RW5kT2ZMaW5lOiBuYyB9IH0gPSBXdSwgeyBDU1NfRElTUExBWV9UQUdTOiBpYywgQ1NTX0RJU1BMQVlfREVGQVVMVDogc2MsIENTU19XSElURV9TUEFDRV9UQUdTOiBvYywgQ1NTX1dISVRFX1NQQUNFX0RFRkFVTFQ6IGFjIH0gPSB7IENTU19ESVNQTEFZX1RBR1M6IHsgYXJlYTogIm5vbmUiLCBiYXNlOiAibm9uZSIsIGJhc2Vmb250OiAibm9uZSIsIGRhdGFsaXN0OiAibm9uZSIsIGhlYWQ6ICJub25lIiwgbGluazogIm5vbmUiLCBtZXRhOiAibm9uZSIsIG5vZW1iZWQ6ICJub25lIiwgbm9mcmFtZXM6ICJub25lIiwgcGFyYW06ICJibG9jayIsIHJwOiAibm9uZSIsIHNjcmlwdDogImJsb2NrIiwgc291cmNlOiAiYmxvY2siLCBzdHlsZTogIm5vbmUiLCB0ZW1wbGF0ZTogImlubGluZSIsIHRyYWNrOiAiYmxvY2siLCB0aXRsZTogIm5vbmUiLCBodG1sOiAiYmxvY2siLCBib2R5OiAiYmxvY2siLCBhZGRyZXNzOiAiYmxvY2siLCBibG9ja3F1b3RlOiAiYmxvY2siLCBjZW50ZXI6ICJibG9jayIsIGRpdjogImJsb2NrIiwgZmlndXJlOiAiYmxvY2siLCBmaWdjYXB0aW9uOiAiYmxvY2siLCBmb290ZXI6ICJibG9jayIsIGZvcm06ICJibG9jayIsIGhlYWRlcjogImJsb2NrIiwgaHI6ICJibG9jayIsIGxlZ2VuZDogImJsb2NrIiwgbGlzdGluZzogImJsb2NrIiwgbWFpbjogImJsb2NrIiwgcDogImJsb2NrIiwgcGxhaW50ZXh0OiAiYmxvY2siLCBwcmU6ICJibG9jayIsIHhtcDogImJsb2NrIiwgc2xvdDogImNvbnRlbnRzIiwgcnVieTogInJ1YnkiLCBydDogInJ1YnktdGV4dCIsIGFydGljbGU6ICJibG9jayIsIGFzaWRlOiAiYmxvY2siLCBoMTogImJsb2NrIiwgaDI6ICJibG9jayIsIGgzOiAiYmxvY2siLCBoNDogImJsb2NrIiwgaDU6ICJibG9jayIsIGg2OiAiYmxvY2siLCBoZ3JvdXA6ICJibG9jayIsIG5hdjogImJsb2NrIiwgc2VjdGlvbjogImJsb2NrIiwgZGlyOiAiYmxvY2siLCBkZDogImJsb2NrIiwgZGw6ICJibG9jayIsIGR0OiAiYmxvY2siLCBvbDogImJsb2NrIiwgdWw6ICJibG9jayIsIGxpOiAibGlzdC1pdGVtIiwgdGFibGU6ICJ0YWJsZSIsIGNhcHRpb246ICJ0YWJsZS1jYXB0aW9uIiwgY29sZ3JvdXA6ICJ0YWJsZS1jb2x1bW4tZ3JvdXAiLCBjb2w6ICJ0YWJsZS1jb2x1bW4iLCB0aGVhZDogInRhYmxlLWhlYWRlci1ncm91cCIsIHRib2R5OiAidGFibGUtcm93LWdyb3VwIiwgdGZvb3Q6ICJ0YWJsZS1mb290ZXItZ3JvdXAiLCB0cjogInRhYmxlLXJvdyIsIHRkOiAidGFibGUtY2VsbCIsIHRoOiAidGFibGUtY2VsbCIsIGZpZWxkc2V0OiAiYmxvY2siLCBidXR0b246ICJpbmxpbmUtYmxvY2siLCBkZXRhaWxzOiAiYmxvY2siLCBzdW1tYXJ5OiAiYmxvY2siLCBkaWFsb2c6ICJibG9jayIsIG1ldGVyOiAiaW5saW5lLWJsb2NrIiwgcHJvZ3Jlc3M6ICJpbmxpbmUtYmxvY2siLCBvYmplY3Q6ICJpbmxpbmUtYmxvY2siLCB2aWRlbzogImlubGluZS1ibG9jayIsIGF1ZGlvOiAiaW5saW5lLWJsb2NrIiwgc2VsZWN0OiAiaW5saW5lLWJsb2NrIiwgb3B0aW9uOiAiYmxvY2siLCBvcHRncm91cDogImJsb2NrIiB9LCBDU1NfRElTUExBWV9ERUZBVUxUOiAiaW5saW5lIiwgQ1NTX1dISVRFX1NQQUNFX1RBR1M6IHsgbGlzdGluZzogInByZSIsIHBsYWludGV4dDogInByZSIsIHByZTogInByZSIsIHhtcDogInByZSIsIG5vYnI6ICJub3dyYXAiLCB0YWJsZTogImluaXRpYWwiLCB0ZXh0YXJlYTogInByZS13cmFwIiB9LCBDU1NfV0hJVEVfU1BBQ0VfREVGQVVMVDogIm5vcm1hbCIgfSwgdWMgPSBmYyhZdSksIGNjID0gZnVuY3Rpb24oZTIsIHQyKSB7CiAgICAgICAgICBjb25zdCByMiA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgZm9yIChjb25zdCBbbjIsIGkyXSBvZiBPYmplY3QuZW50cmllcyhlMikpCiAgICAgICAgICAgIHIyW24yXSA9IHQyKGkyLCBuMik7CiAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgfShRdSwgZmMpLCBsYyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KFsiCSIsICJcbiIsICJcZiIsICJcciIsICIgIl0pLCBwYyA9IChlMikgPT4gZTIucmVwbGFjZSgvW1x0XG5cZlxyIF0rJC8sICIiKSwgaGMgPSAoZTIpID0+ICgoZTMpID0+IGUzLnJlcGxhY2UoL15bXHRcZlxyIF0qP1xuL2csICIiKSkocGMoZTIpKSwgRGMgPSAoZTIpID0+IGUyLnNwbGl0KC9bXHRcblxmXHIgXSsvKTsKICAgICAgICBmdW5jdGlvbiBmYyhlMikgewogICAgICAgICAgY29uc3QgdDIgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIGZvciAoY29uc3QgcjIgb2YgZTIpCiAgICAgICAgICAgIHQyW3IyXSA9IHRydWU7CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGRjKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIudHlwZSA9PT0gImVsZW1lbnQiICYmIChlMi5mdWxsTmFtZSA9PT0gInNjcmlwdCIgfHwgZTIuZnVsbE5hbWUgPT09ICJzdHlsZSIgfHwgZTIuZnVsbE5hbWUgPT09ICJzdmc6c3R5bGUiIHx8IEFjKGUyKSAmJiAoZTIubmFtZSA9PT0gInNjcmlwdCIgfHwgZTIubmFtZSA9PT0gInN0eWxlIikpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnYyhlMikgewogICAgICAgICAgcmV0dXJuIEZjKGUyKS5zdGFydHNXaXRoKCJwcmUiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbWMoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAiZWxlbWVudCIgJiYgZTIuY2hpbGRyZW4ubGVuZ3RoID4gMCAmJiAoWyJodG1sIiwgImhlYWQiLCAidWwiLCAib2wiLCAic2VsZWN0Il0uaW5jbHVkZXMoZTIubmFtZSkgfHwgZTIuY3NzRGlzcGxheS5zdGFydHNXaXRoKCJ0YWJsZSIpICYmIGUyLmNzc0Rpc3BsYXkgIT09ICJ0YWJsZS1jZWxsIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEVjKGUyKSB7CiAgICAgICAgICByZXR1cm4gU2MoZTIpIHx8IGUyLnR5cGUgPT09ICJlbGVtZW50IiAmJiBlMi5mdWxsTmFtZSA9PT0gImJyIiB8fCBDYyhlMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIENjKGUyKSB7CiAgICAgICAgICByZXR1cm4geWMoZTIpICYmIGJjKGUyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24geWMoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5oYXNMZWFkaW5nU3BhY2VzICYmIChlMi5wcmV2ID8gZTIucHJldi5zb3VyY2VTcGFuLmVuZC5saW5lIDwgZTIuc291cmNlU3Bhbi5zdGFydC5saW5lIDogZTIucGFyZW50LnR5cGUgPT09ICJyb290IiB8fCBlMi5wYXJlbnQuc3RhcnRTb3VyY2VTcGFuLmVuZC5saW5lIDwgZTIuc291cmNlU3Bhbi5zdGFydC5saW5lKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmMoZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5oYXNUcmFpbGluZ1NwYWNlcyAmJiAoZTIubmV4dCA/IGUyLm5leHQuc291cmNlU3Bhbi5zdGFydC5saW5lID4gZTIuc291cmNlU3Bhbi5lbmQubGluZSA6IGUyLnBhcmVudC50eXBlID09PSAicm9vdCIgfHwgZTIucGFyZW50LmVuZFNvdXJjZVNwYW4gJiYgZTIucGFyZW50LmVuZFNvdXJjZVNwYW4uc3RhcnQubGluZSA+IGUyLnNvdXJjZVNwYW4uZW5kLmxpbmUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBTYyhlMikgewogICAgICAgICAgc3dpdGNoIChlMi50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgImllQ29uZGl0aW9uYWxDb21tZW50IjoKICAgICAgICAgICAgY2FzZSAiY29tbWVudCI6CiAgICAgICAgICAgIGNhc2UgImRpcmVjdGl2ZSI6CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGNhc2UgImVsZW1lbnQiOgogICAgICAgICAgICAgIHJldHVybiBbInNjcmlwdCIsICJzZWxlY3QiXS5pbmNsdWRlcyhlMi5uYW1lKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVGMoZTIpIHsKICAgICAgICAgIGNvbnN0IHsgdHlwZTogdDIsIGxhbmc6IHIyIH0gPSBlMi5hdHRyTWFwOwogICAgICAgICAgcmV0dXJuIHQyID09PSAibW9kdWxlIiB8fCB0MiA9PT0gInRleHQvamF2YXNjcmlwdCIgfHwgdDIgPT09ICJ0ZXh0L2JhYmVsIiB8fCB0MiA9PT0gImFwcGxpY2F0aW9uL2phdmFzY3JpcHQiIHx8IHIyID09PSAianN4IiA/ICJiYWJlbCIgOiB0MiA9PT0gImFwcGxpY2F0aW9uL3gtdHlwZXNjcmlwdCIgfHwgcjIgPT09ICJ0cyIgfHwgcjIgPT09ICJ0c3giID8gInR5cGVzY3JpcHQiIDogdDIgPT09ICJ0ZXh0L21hcmtkb3duIiA/ICJtYXJrZG93biIgOiB0MiA9PT0gInRleHQvaHRtbCIgPyAiaHRtbCIgOiB0MiAmJiAodDIuZW5kc1dpdGgoImpzb24iKSB8fCB0Mi5lbmRzV2l0aCgiaW1wb3J0bWFwIikpID8gImpzb24iIDogdDIgPT09ICJ0ZXh0L3gtaGFuZGxlYmFycy10ZW1wbGF0ZSIgPyAiZ2xpbW1lciIgOiB2b2lkIDA7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIF9jKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgPT09ICJibG9jayIgfHwgZTIgPT09ICJsaXN0LWl0ZW0iIHx8IGUyLnN0YXJ0c1dpdGgoInRhYmxlIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHZjKGUyKSB7CiAgICAgICAgICByZXR1cm4gRmMoZTIpLnN0YXJ0c1dpdGgoInByZSIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBBYyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJlbGVtZW50IiAmJiAhZTIuaGFzRXhwbGljaXROYW1lc3BhY2UgJiYgIVsiaHRtbCIsICJzdmciXS5pbmNsdWRlcyhlMi5uYW1lc3BhY2UpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBGYyhlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgPT09ICJlbGVtZW50IiAmJiAoIWUyLm5hbWVzcGFjZSB8fCBBYyhlMikpICYmIG9jW2UyLm5hbWVdIHx8IGFjOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB3YyhlMikgewogICAgICAgICAgbGV0IHQyID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZOwogICAgICAgICAgZm9yIChjb25zdCBuMiBvZiBlMi5zcGxpdCgiXG4iKSkgewogICAgICAgICAgICBpZiAobjIubGVuZ3RoID09PSAwKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoIWxjLmhhcyhuMlswXSkpCiAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIGNvbnN0IGUzID0gKHIyID0gbjIsIHIyLm1hdGNoKC9eW1x0XG5cZlxyIF0qLylbMF0pLmxlbmd0aDsKICAgICAgICAgICAgbjIubGVuZ3RoICE9PSBlMyAmJiAoZTMgPCB0MiAmJiAodDIgPSBlMykpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHIyOwogICAgICAgICAgcmV0dXJuIHQyID09PSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgPyAwIDogdDI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGtjKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IHdjKGUyKTsKICAgICAgICAgIHJldHVybiB0MiA9PT0gMCA/IGUyIDogZTIuc3BsaXQoIlxuIikubWFwKChlMykgPT4gZTMuc2xpY2UodDIpKS5qb2luKCJcbiIpOwogICAgICAgIH0KICAgICAgICBjb25zdCBOYyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KFsidGVtcGxhdGUiLCAic3R5bGUiLCAic2NyaXB0Il0pOwogICAgICAgIGZ1bmN0aW9uIE9jKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHhjKGUyLCB0MikgJiYgIU5jLmhhcyhlMi5mdWxsTmFtZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHhjKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIHQyLnBhcnNlciA9PT0gInZ1ZSIgJiYgZTIudHlwZSA9PT0gImVsZW1lbnQiICYmIGUyLnBhcmVudC50eXBlID09PSAicm9vdCIgJiYgZTIuZnVsbE5hbWUudG9Mb3dlckNhc2UoKSAhPT0gImh0bWwiOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBJYyhlMiwgdDIpIHsKICAgICAgICAgIHJldHVybiB4YyhlMiwgdDIpICYmIChPYyhlMiwgdDIpIHx8IGUyLmF0dHJNYXAubGFuZyAmJiBlMi5hdHRyTWFwLmxhbmcgIT09ICJodG1sIik7CiAgICAgICAgfQogICAgICAgIHZhciBQYyA9IHsgSFRNTF9FTEVNRU5UX0FUVFJJQlVURVM6IGNjLCBIVE1MX1RBR1M6IHVjLCBodG1sVHJpbTogKGUyKSA9PiAoKGUzKSA9PiBlMy5yZXBsYWNlKC9eW1x0XG5cZlxyIF0rLywgIiIpKShwYyhlMikpLCBodG1sVHJpbVByZXNlcnZlSW5kZW50YXRpb246IGhjLCBoYXNIdG1sV2hpdGVzcGFjZTogKGUyKSA9PiAvW1x0XG5cZlxyIF0vLnRlc3QoZTIpLCBnZXRMZWFkaW5nQW5kVHJhaWxpbmdIdG1sV2hpdGVzcGFjZTogKGUyKSA9PiB7CiAgICAgICAgICBjb25zdCBbLCB0MiwgcjIsIG4yXSA9IGUyLm1hdGNoKC9eKFtcdFxuXGZcciBdKikoLio/KShbXHRcblxmXHIgXSopJC9zKTsKICAgICAgICAgIHJldHVybiB7IGxlYWRpbmdXaGl0ZXNwYWNlOiB0MiwgdHJhaWxpbmdXaGl0ZXNwYWNlOiBuMiwgdGV4dDogcjIgfTsKICAgICAgICB9LCBjYW5IYXZlSW50ZXJwb2xhdGlvbjogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi5jaGlsZHJlbiAmJiAhZGMoZTIpOwogICAgICAgIH0sIGNvdW50Q2hhcnM6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgbGV0IHIyID0gMDsKICAgICAgICAgIGZvciAobGV0IG4yID0gMDsgbjIgPCBlMi5sZW5ndGg7IG4yKyspCiAgICAgICAgICAgIGUyW24yXSA9PT0gdDIgJiYgcjIrKzsKICAgICAgICAgIHJldHVybiByMjsKICAgICAgICB9LCBjb3VudFBhcmVudHM6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgbGV0IHIyID0gMDsKICAgICAgICAgIGZvciAobGV0IG4yID0gZTIuc3RhY2subGVuZ3RoIC0gMTsgbjIgPj0gMDsgbjItLSkgewogICAgICAgICAgICBjb25zdCBpMiA9IGUyLnN0YWNrW24yXTsKICAgICAgICAgICAgaTIgJiYgdHlwZW9mIGkyID09ICJvYmplY3QiICYmICFBcnJheS5pc0FycmF5KGkyKSAmJiB0MihpMikgJiYgcjIrKzsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByMjsKICAgICAgICB9LCBkZWRlbnRTdHJpbmc6IGtjLCBmb3JjZUJyZWFrQ2hpbGRyZW46IG1jLCBmb3JjZUJyZWFrQ29udGVudDogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBtYyhlMikgfHwgZTIudHlwZSA9PT0gImVsZW1lbnQiICYmIGUyLmNoaWxkcmVuLmxlbmd0aCA+IDAgJiYgKFsiYm9keSIsICJzY3JpcHQiLCAic3R5bGUiXS5pbmNsdWRlcyhlMi5uYW1lKSB8fCBlMi5jaGlsZHJlbi5zb21lKChlMykgPT4gZnVuY3Rpb24oZTQpIHsKICAgICAgICAgICAgcmV0dXJuIGU0LmNoaWxkcmVuICYmIGU0LmNoaWxkcmVuLnNvbWUoKGU1KSA9PiBlNS50eXBlICE9PSAidGV4dCIpOwogICAgICAgICAgfShlMykpKSB8fCBlMi5maXJzdENoaWxkICYmIGUyLmZpcnN0Q2hpbGQgPT09IGUyLmxhc3RDaGlsZCAmJiBlMi5maXJzdENoaWxkLnR5cGUgIT09ICJ0ZXh0IiAmJiB5YyhlMi5maXJzdENoaWxkKSAmJiAoIWUyLmxhc3RDaGlsZC5pc1RyYWlsaW5nU3BhY2VTZW5zaXRpdmUgfHwgYmMoZTIubGFzdENoaWxkKSk7CiAgICAgICAgfSwgZm9yY2VOZXh0RW1wdHlMaW5lOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFp1KGUyKSB8fCBlMi5uZXh0ICYmIGUyLnNvdXJjZVNwYW4uZW5kICYmIGUyLnNvdXJjZVNwYW4uZW5kLmxpbmUgKyAxIDwgZTIubmV4dC5zb3VyY2VTcGFuLnN0YXJ0LmxpbmU7CiAgICAgICAgfSwgZ2V0TGFzdERlc2NlbmRhbnQ6IGZ1bmN0aW9uIGUyKHQyKSB7CiAgICAgICAgICByZXR1cm4gdDIubGFzdENoaWxkID8gZTIodDIubGFzdENoaWxkKSA6IHQyOwogICAgICAgIH0sIGdldE5vZGVDc3NTdHlsZURpc3BsYXk6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgaWYgKGUyLnByZXYgJiYgZTIucHJldi50eXBlID09PSAiY29tbWVudCIpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBlMi5wcmV2LnZhbHVlLm1hdGNoKC9eXHMqZGlzcGxheTpccyooW2Etel0rKVxzKiQvKTsKICAgICAgICAgICAgaWYgKHQzKQogICAgICAgICAgICAgIHJldHVybiB0M1sxXTsKICAgICAgICAgIH0KICAgICAgICAgIGxldCByMiA9IGZhbHNlOwogICAgICAgICAgaWYgKGUyLnR5cGUgPT09ICJlbGVtZW50IiAmJiBlMi5uYW1lc3BhY2UgPT09ICJzdmciKSB7CiAgICAgICAgICAgIGlmICghZnVuY3Rpb24oZTMsIHQzKSB7CiAgICAgICAgICAgICAgbGV0IHIzID0gZTM7CiAgICAgICAgICAgICAgZm9yICg7IHIzOyApIHsKICAgICAgICAgICAgICAgIGlmICh0MyhyMykpCiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgcjMgPSByMy5wYXJlbnQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfShlMiwgKGUzKSA9PiBlMy5mdWxsTmFtZSA9PT0gInN2Zzpmb3JlaWduT2JqZWN0IikpCiAgICAgICAgICAgICAgcmV0dXJuIGUyLm5hbWUgPT09ICJzdmciID8gImlubGluZS1ibG9jayIgOiAiYmxvY2siOwogICAgICAgICAgICByMiA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBzd2l0Y2ggKHQyLmh0bWxXaGl0ZXNwYWNlU2Vuc2l0aXZpdHkpIHsKICAgICAgICAgICAgY2FzZSAic3RyaWN0IjoKICAgICAgICAgICAgICByZXR1cm4gImlubGluZSI7CiAgICAgICAgICAgIGNhc2UgImlnbm9yZSI6CiAgICAgICAgICAgICAgcmV0dXJuICJibG9jayI7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgcmV0dXJuIHQyLnBhcnNlciA9PT0gInZ1ZSIgJiYgZTIucGFyZW50ICYmIGUyLnBhcmVudC50eXBlID09PSAicm9vdCIgPyAiYmxvY2siIDogZTIudHlwZSA9PT0gImVsZW1lbnQiICYmICghZTIubmFtZXNwYWNlIHx8IHIyIHx8IEFjKGUyKSkgJiYgaWNbZTIubmFtZV0gfHwgc2M7CiAgICAgICAgICB9CiAgICAgICAgfSwgZ2V0Tm9kZUNzc1N0eWxlV2hpdGVTcGFjZTogRmMsIGhhc1ByZXR0aWVySWdub3JlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnR5cGUgIT09ICJhdHRyaWJ1dGUiICYmICghIWUyLnBhcmVudCAmJiAodHlwZW9mIGUyLmluZGV4ID09ICJudW1iZXIiICYmIGUyLmluZGV4ICE9PSAwICYmIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMy50eXBlID09PSAiY29tbWVudCIgJiYgZTMudmFsdWUudHJpbSgpID09PSAicHJldHRpZXItaWdub3JlIjsKICAgICAgICAgIH0oZTIucGFyZW50LmNoaWxkcmVuW2UyLmluZGV4IC0gMV0pKSk7CiAgICAgICAgfSwgaW5mZXJTY3JpcHRQYXJzZXI6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGUyLm5hbWUgIT09ICJzY3JpcHQiIHx8IGUyLmF0dHJNYXAuc3JjID8gZTIubmFtZSA9PT0gInN0eWxlIiA/IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIGNvbnN0IHsgbGFuZzogdDMgfSA9IGUzLmF0dHJNYXA7CiAgICAgICAgICAgIHJldHVybiB0MyAmJiB0MyAhPT0gInBvc3Rjc3MiICYmIHQzICE9PSAiY3NzIiA/IHQzID09PSAic2NzcyIgPyAic2NzcyIgOiB0MyA9PT0gImxlc3MiID8gImxlc3MiIDogdm9pZCAwIDogImNzcyI7CiAgICAgICAgICB9KGUyKSA6IHQyICYmIEljKGUyLCB0MikgPyBUYyhlMikgfHwgISgic3JjIiBpbiBlMi5hdHRyTWFwKSAmJiBKdShlMi5hdHRyTWFwLmxhbmcsIHQyKSA6IHZvaWQgMCA6IGUyLmF0dHJNYXAubGFuZyB8fCBlMi5hdHRyTWFwLnR5cGUgPyBUYyhlMikgOiAiYmFiZWwiOwogICAgICAgIH0sIGlzVnVlQ3VzdG9tQmxvY2s6IE9jLCBpc1Z1ZU5vbkh0bWxCbG9jazogSWMsIGlzVnVlU2xvdEF0dHJpYnV0ZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTIuZnVsbE5hbWU7CiAgICAgICAgICByZXR1cm4gdDIuY2hhckF0KDApID09PSAiIyIgfHwgdDIgPT09ICJzbG90LXNjb3BlIiB8fCB0MiA9PT0gInYtc2xvdCIgfHwgdDIuc3RhcnRzV2l0aCgidi1zbG90OiIpOwogICAgICAgIH0sIGlzVnVlU2ZjQmluZGluZ3NBdHRyaWJ1dGU6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5wYXJlbnQ7CiAgICAgICAgICBpZiAoIXhjKHIyLCB0MikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIGNvbnN0IG4yID0gcjIuZnVsbE5hbWUsIGkyID0gZTIuZnVsbE5hbWU7CiAgICAgICAgICByZXR1cm4gbjIgPT09ICJzY3JpcHQiICYmIGkyID09PSAic2V0dXAiIHx8IG4yID09PSAic3R5bGUiICYmIGkyID09PSAidmFycyI7CiAgICAgICAgfSwgaXNEYW5nbGluZ1NwYWNlU2Vuc2l0aXZlTm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiAhKHQyID0gZTIuY3NzRGlzcGxheSwgX2ModDIpIHx8IHQyID09PSAiaW5saW5lLWJsb2NrIiB8fCBkYyhlMikpOwogICAgICAgICAgdmFyIHQyOwogICAgICAgIH0sIGlzSW5kZW50YXRpb25TZW5zaXRpdmVOb2RlOiBnYywgaXNMZWFkaW5nU3BhY2VTZW5zaXRpdmVOb2RlOiBmdW5jdGlvbihlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmIChadShlMikpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoKGUyLnR5cGUgPT09ICJ0ZXh0IiB8fCBlMi50eXBlID09PSAiaW50ZXJwb2xhdGlvbiIpICYmIGUyLnByZXYgJiYgKGUyLnByZXYudHlwZSA9PT0gInRleHQiIHx8IGUyLnByZXYudHlwZSA9PT0gImludGVycG9sYXRpb24iKSkKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKCFlMi5wYXJlbnQgfHwgZTIucGFyZW50LmNzc0Rpc3BsYXkgPT09ICJub25lIikKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICh2YyhlMi5wYXJlbnQpKQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoIWUyLnByZXYgJiYgKGUyLnBhcmVudC50eXBlID09PSAicm9vdCIgfHwgdmMoZTIpICYmIGUyLnBhcmVudCB8fCBkYyhlMi5wYXJlbnQpIHx8IE9jKGUyLnBhcmVudCwgdDIpIHx8IChyMyA9IGUyLnBhcmVudC5jc3NEaXNwbGF5LCBfYyhyMykgfHwgcjMgPT09ICJpbmxpbmUtYmxvY2siKSkpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB2YXIgcjM7CiAgICAgICAgICAgIGlmIChlMi5wcmV2ICYmICFmdW5jdGlvbihlMykgewogICAgICAgICAgICAgIHJldHVybiAhX2MoZTMpOwogICAgICAgICAgICB9KGUyLnByZXYuY3NzRGlzcGxheSkpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0oKTsKICAgICAgICAgIHJldHVybiByMiAmJiAhZTIucHJldiAmJiBlMi5wYXJlbnQgJiYgZTIucGFyZW50LnRhZ0RlZmluaXRpb24gJiYgZTIucGFyZW50LnRhZ0RlZmluaXRpb24uaWdub3JlRmlyc3RMZiA/IGUyLnR5cGUgPT09ICJpbnRlcnBvbGF0aW9uIiA6IHIyOwogICAgICAgIH0sIGlzUHJlTGlrZU5vZGU6IHZjLCBpc1NjcmlwdExpa2VUYWc6IGRjLCBpc1RleHRMaWtlTm9kZTogZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlMi50eXBlID09PSAidGV4dCIgfHwgZTIudHlwZSA9PT0gImNvbW1lbnQiOwogICAgICAgIH0sIGlzVHJhaWxpbmdTcGFjZVNlbnNpdGl2ZU5vZGU6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuICFadShlMikgJiYgKCEoZTIudHlwZSAhPT0gInRleHQiICYmIGUyLnR5cGUgIT09ICJpbnRlcnBvbGF0aW9uIiB8fCAhZTIubmV4dCB8fCBlMi5uZXh0LnR5cGUgIT09ICJ0ZXh0IiAmJiBlMi5uZXh0LnR5cGUgIT09ICJpbnRlcnBvbGF0aW9uIikgfHwgISghZTIucGFyZW50IHx8IGUyLnBhcmVudC5jc3NEaXNwbGF5ID09PSAibm9uZSIpICYmICghIXZjKGUyLnBhcmVudCkgfHwgISghZTIubmV4dCAmJiAoZTIucGFyZW50LnR5cGUgPT09ICJyb290IiB8fCB2YyhlMikgJiYgZTIucGFyZW50IHx8IGRjKGUyLnBhcmVudCkgfHwgT2MoZTIucGFyZW50LCB0MikgfHwgKHIyID0gZTIucGFyZW50LmNzc0Rpc3BsYXksIF9jKHIyKSB8fCByMiA9PT0gImlubGluZS1ibG9jayIpKSkgJiYgIShlMi5uZXh0ICYmICFmdW5jdGlvbihlMykgewogICAgICAgICAgICByZXR1cm4gIV9jKGUzKTsKICAgICAgICAgIH0oZTIubmV4dC5jc3NEaXNwbGF5KSkpKTsKICAgICAgICAgIHZhciByMjsKICAgICAgICB9LCBpc1doaXRlc3BhY2VTZW5zaXRpdmVOb2RlOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGRjKGUyKSB8fCBlMi50eXBlID09PSAiaW50ZXJwb2xhdGlvbiIgfHwgZ2MoZTIpOwogICAgICAgIH0sIGlzVW5rbm93bk5hbWVzcGFjZTogQWMsIHByZWZlckhhcmRsaW5lQXNMZWFkaW5nU3BhY2VzOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIFNjKGUyKSB8fCBlMi5wcmV2ICYmIEVjKGUyLnByZXYpIHx8IENjKGUyKTsKICAgICAgICB9LCBwcmVmZXJIYXJkbGluZUFzVHJhaWxpbmdTcGFjZXM6IEVjLCBzaG91bGRQcmVzZXJ2ZUNvbnRlbnQ6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuICEoZTIudHlwZSAhPT0gImllQ29uZGl0aW9uYWxDb21tZW50IiB8fCAhZTIubGFzdENoaWxkIHx8IGUyLmxhc3RDaGlsZC5pc1NlbGZDbG9zaW5nIHx8IGUyLmxhc3RDaGlsZC5lbmRTb3VyY2VTcGFuKSB8fCAoZTIudHlwZSA9PT0gImllQ29uZGl0aW9uYWxDb21tZW50IiAmJiAhZTIuY29tcGxldGUgfHwgKCEoIXZjKGUyKSB8fCAhZTIuY2hpbGRyZW4uc29tZSgoZTMpID0+IGUzLnR5cGUgIT09ICJ0ZXh0IiAmJiBlMy50eXBlICE9PSAiaW50ZXJwb2xhdGlvbiIpKSB8fCAhKCFJYyhlMiwgdDIpIHx8IGRjKGUyKSB8fCBlMi50eXBlID09PSAiaW50ZXJwb2xhdGlvbiIpKSk7CiAgICAgICAgfSwgdW5lc2NhcGVRdW90ZUVudGl0aWVzOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnJlcGxhY2UoLyZhcG9zOy9nLCAiJyIpLnJlcGxhY2UoLyZxdW90Oy9nLCAnIicpOwogICAgICAgIH0sIGdldFRleHRWYWx1ZVBhcnRzOiBmdW5jdGlvbihlMikgewogICAgICAgICAgbGV0IHQyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMV0gOiBlMi52YWx1ZTsKICAgICAgICAgIHJldHVybiBlMi5wYXJlbnQuaXNXaGl0ZXNwYWNlU2Vuc2l0aXZlID8gZTIucGFyZW50LmlzSW5kZW50YXRpb25TZW5zaXRpdmUgPyBuYyh0MikgOiBuYyhrYyhoYyh0MikpLCBlYykgOiByYyh0YyhLdSwgRGModDIpKSk7CiAgICAgICAgfSB9OwogICAgICAgIHZhciBSYyA9IHsgaGFzUHJhZ21hOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIC9eXHMqPCEtLVxzKkAoPzpmb3JtYXR8cHJldHRpZXIpXHMqLS0+Ly50ZXN0KGUyKTsKICAgICAgICB9LCBpbnNlcnRQcmFnbWE6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gIjwhLS0gQGZvcm1hdCAtLT5cblxuIiArIGUyLnJlcGxhY2UoL15ccypcbi8sICIiKTsKICAgICAgICB9IH07CiAgICAgICAgY29uc3QgeyBpc05vbkVtcHR5QXJyYXk6IExjIH0gPSBKYSwgQmMgPSBDLCBxYyA9IHsgYXR0cnM6IHRydWUsIGNoaWxkcmVuOiB0cnVlIH07CiAgICAgICAgY2xhc3MgJGMgewogICAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIGxldCBlMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgICAgICAgIGZvciAoY29uc3QgW3QyLCByMl0gb2YgT2JqZWN0LmVudHJpZXMoZTIpKQogICAgICAgICAgICAgIHQyIGluIHFjID8gdGhpcy5fc2V0Tm9kZXModDIsIHIyKSA6IHRoaXNbdDJdID0gcjI7CiAgICAgICAgICB9CiAgICAgICAgICBfc2V0Tm9kZXMoZTIsIHQyKSB7CiAgICAgICAgICAgIHQyICE9PSB0aGlzW2UyXSAmJiAodGhpc1tlMl0gPSBmdW5jdGlvbihlMywgdDMpIHsKICAgICAgICAgICAgICBjb25zdCByMiA9IGUzLm1hcCgoZTQpID0+IGU0IGluc3RhbmNlb2YgJGMgPyBlNC5jbG9uZSgpIDogbmV3ICRjKGU0KSk7CiAgICAgICAgICAgICAgbGV0IG4yID0gbnVsbCwgaTIgPSByMlswXSwgczIgPSByMlsxXSB8fCBudWxsOwogICAgICAgICAgICAgIGZvciAobGV0IGU0ID0gMDsgZTQgPCByMi5sZW5ndGg7IGU0KyspCiAgICAgICAgICAgICAgICBqYyhpMiwgeyBpbmRleDogZTQsIHNpYmxpbmdzOiByMiwgcHJldjogbjIsIG5leHQ6IHMyLCBwYXJlbnQ6IHQzIH0pLCBuMiA9IGkyLCBpMiA9IHMyLCBzMiA9IHIyW2U0ICsgMl0gfHwgbnVsbDsKICAgICAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgICAgIH0odDIsIHRoaXMpLCBlMiA9PT0gImF0dHJzIiAmJiBqYyh0aGlzLCB7IGF0dHJNYXA6IE9iamVjdC5mcm9tRW50cmllcyh0aGlzW2UyXS5tYXAoKGUzKSA9PiBbZTMuZnVsbE5hbWUsIGUzLnZhbHVlXSkpIH0pKTsKICAgICAgICAgIH0KICAgICAgICAgIG1hcChlMikgewogICAgICAgICAgICBsZXQgdDIgPSBudWxsOwogICAgICAgICAgICBmb3IgKGNvbnN0IHIyIGluIHFjKSB7CiAgICAgICAgICAgICAgY29uc3QgbjIgPSB0aGlzW3IyXTsKICAgICAgICAgICAgICBpZiAobjIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkyID0gTWMobjIsICh0MykgPT4gdDMubWFwKGUyKSk7CiAgICAgICAgICAgICAgICB0MiAhPT0gbjIgJiYgKHQyIHx8ICh0MiA9IG5ldyAkYygpKSwgdDIuX3NldE5vZGVzKHIyLCBpMikpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodDIpIHsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IGU0IGluIHRoaXMpCiAgICAgICAgICAgICAgICBlNCBpbiBxYyB8fCAodDJbZTRdID0gdGhpc1tlNF0pOwogICAgICAgICAgICAgIGNvbnN0IHsgaW5kZXg6IGUzLCBzaWJsaW5nczogcjIsIHByZXY6IG4yLCBuZXh0OiBpMiwgcGFyZW50OiBzMiB9ID0gdGhpczsKICAgICAgICAgICAgICBqYyh0MiwgeyBpbmRleDogZTMsIHNpYmxpbmdzOiByMiwgcHJldjogbjIsIG5leHQ6IGkyLCBwYXJlbnQ6IHMyIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBlMih0MiB8fCB0aGlzKTsKICAgICAgICAgIH0KICAgICAgICAgIHdhbGsoZTIpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0MiBpbiBxYykgewogICAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpc1t0Ml07CiAgICAgICAgICAgICAgaWYgKHIyKQogICAgICAgICAgICAgICAgZm9yIChsZXQgdDMgPSAwOyB0MyA8IHIyLmxlbmd0aDsgdDMrKykKICAgICAgICAgICAgICAgICAgcjJbdDNdLndhbGsoZTIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGUyKHRoaXMpOwogICAgICAgICAgfQogICAgICAgICAgY2xvbmUoZTIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyAkYyhlMiA/IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcyksIGUyKSA6IHRoaXMpOwogICAgICAgICAgfQogICAgICAgICAgc2V0Q2hpbGRyZW4oZTIpIHsKICAgICAgICAgICAgdGhpcy5fc2V0Tm9kZXMoImNoaWxkcmVuIiwgZTIpOwogICAgICAgICAgfQogICAgICAgICAgZ2V0IGZpcnN0Q2hpbGQoKSB7CiAgICAgICAgICAgIHJldHVybiBMYyh0aGlzLmNoaWxkcmVuKSA/IHRoaXMuY2hpbGRyZW5bMF0gOiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgZ2V0IGxhc3RDaGlsZCgpIHsKICAgICAgICAgICAgcmV0dXJuIExjKHRoaXMuY2hpbGRyZW4pID8gQmModGhpcy5jaGlsZHJlbikgOiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgZ2V0IHJhd05hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmhhc0V4cGxpY2l0TmFtZXNwYWNlID8gdGhpcy5mdWxsTmFtZSA6IHRoaXMubmFtZTsKICAgICAgICAgIH0KICAgICAgICAgIGdldCBmdWxsTmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubmFtZXNwYWNlID8gdGhpcy5uYW1lc3BhY2UgKyAiOiIgKyB0aGlzLm5hbWUgOiB0aGlzLm5hbWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE1jKGUyLCB0MikgewogICAgICAgICAgY29uc3QgcjIgPSBlMi5tYXAodDIpOwogICAgICAgICAgcmV0dXJuIHIyLnNvbWUoKHQzLCByMykgPT4gdDMgIT09IGUyW3IzXSkgPyByMiA6IGUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBqYyhlMiwgdDIpIHsKICAgICAgICAgIGNvbnN0IHIyID0gT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKHQyKS5tYXAoKGUzKSA9PiB7CiAgICAgICAgICAgIGxldCBbdDMsIHIzXSA9IGUzOwogICAgICAgICAgICByZXR1cm4gW3QzLCB7IHZhbHVlOiByMywgZW51bWVyYWJsZTogZmFsc2UgfV07CiAgICAgICAgICB9KSk7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhlMiwgcjIpOwogICAgICAgIH0KICAgICAgICB2YXIgVWMgPSB7IE5vZGU6ICRjIH07CiAgICAgICAgY29uc3QgeyBQYXJzZVNvdXJjZVNwYW46IEdjIH0gPSB0LCBWYyA9IFt7IHJlZ2V4OiAvXihcW2lmKFteXF1dKj8pXT4pKC4qPyk8IVxzKlxbZW5kaWZdJC9zLCBwYXJzZTogZnVuY3Rpb24oZTIsIHQyLCByMikgewogICAgICAgICAgY29uc3QgWywgbjIsIGkyLCBzMl0gPSByMiwgbzIgPSAiPCEtLSIubGVuZ3RoICsgbjIubGVuZ3RoLCBhMiA9IGUyLnNvdXJjZVNwYW4uc3RhcnQubW92ZUJ5KG8yKSwgdTIgPSBhMi5tb3ZlQnkoczIubGVuZ3RoKSwgW2MyLCBsMl0gPSAoKCkgPT4gewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBbdHJ1ZSwgdDIoczIsIGEyKS5jaGlsZHJlbl07CiAgICAgICAgICAgIH0gY2F0Y2ggKGUzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFtmYWxzZSwgW3sgdHlwZTogInRleHQiLCB2YWx1ZTogczIsIHNvdXJjZVNwYW46IG5ldyBHYyhhMiwgdTIpIH1dXTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkoKTsKICAgICAgICAgIHJldHVybiB7IHR5cGU6ICJpZUNvbmRpdGlvbmFsQ29tbWVudCIsIGNvbXBsZXRlOiBjMiwgY2hpbGRyZW46IGwyLCBjb25kaXRpb246IGkyLnRyaW0oKS5yZXBsYWNlKC9ccysvZywgIiAiKSwgc291cmNlU3BhbjogZTIuc291cmNlU3Bhbiwgc3RhcnRTb3VyY2VTcGFuOiBuZXcgR2MoZTIuc291cmNlU3Bhbi5zdGFydCwgYTIpLCBlbmRTb3VyY2VTcGFuOiBuZXcgR2ModTIsIGUyLnNvdXJjZVNwYW4uZW5kKSB9OwogICAgICAgIH0gfSwgeyByZWdleDogL15cW2lmKFteXF1dKj8pXT48ISQvLCBwYXJzZTogZnVuY3Rpb24oZTIsIHQyLCByMikgewogICAgICAgICAgY29uc3QgWywgbjJdID0gcjI7CiAgICAgICAgICByZXR1cm4geyB0eXBlOiAiaWVDb25kaXRpb25hbFN0YXJ0Q29tbWVudCIsIGNvbmRpdGlvbjogbjIudHJpbSgpLnJlcGxhY2UoL1xzKy9nLCAiICIpLCBzb3VyY2VTcGFuOiBlMi5zb3VyY2VTcGFuIH07CiAgICAgICAgfSB9LCB7IHJlZ2V4OiAvXjwhXHMqXFtlbmRpZl0kLywgcGFyc2U6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4geyB0eXBlOiAiaWVDb25kaXRpb25hbEVuZENvbW1lbnQiLCBzb3VyY2VTcGFuOiBlMi5zb3VyY2VTcGFuIH07CiAgICAgICAgfSB9XTsKICAgICAgICB2YXIgWGMgPSB7IHBhcnNlSWVDb25kaXRpb25hbENvbW1lbnQ6IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgaWYgKGUyLnZhbHVlKQogICAgICAgICAgICBmb3IgKGNvbnN0IHsgcmVnZXg6IHIyLCBwYXJzZTogbjIgfSBvZiBWYykgewogICAgICAgICAgICAgIGNvbnN0IGkyID0gZTIudmFsdWUubWF0Y2gocjIpOwogICAgICAgICAgICAgIGlmIChpMikKICAgICAgICAgICAgICAgIHJldHVybiBuMihlMiwgdDIsIGkyKTsKICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSB9OwogICAgICAgIHZhciBIYyA9IHsgbG9jU3RhcnQ6IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIuc291cmNlU3Bhbi5zdGFydC5vZmZzZXQ7CiAgICAgICAgfSwgbG9jRW5kOiBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIGUyLnNvdXJjZVNwYW4uZW5kLm9mZnNldDsKICAgICAgICB9IH0sIHpjID0ge30sIFdjID0ge30sIFljID0ge30sIFFjID0ge307CiAgICAgICAgIWZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICB2YXIgdDI7CiAgICAgICAgICBmdW5jdGlvbiByMihlMykgewogICAgICAgICAgICBpZiAoZTNbMF0gIT0gIjoiKQogICAgICAgICAgICAgIHJldHVybiBbbnVsbCwgZTNdOwogICAgICAgICAgICBjb25zdCB0MyA9IGUzLmluZGV4T2YoIjoiLCAxKTsKICAgICAgICAgICAgaWYgKHQzID09IC0xKQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5zdXBwb3J0ZWQgZm9ybWF0ICInLmNvbmNhdChlMywgJyIgZXhwZWN0aW5nICI6bmFtZXNwYWNlOm5hbWUiJykpOwogICAgICAgICAgICByZXR1cm4gW2UzLnNsaWNlKDEsIHQzKSwgZTMuc2xpY2UodDMgKyAxKV07CiAgICAgICAgICB9CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZTIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KSwgKHQyID0gZTIuVGFnQ29udGVudFR5cGUgfHwgKGUyLlRhZ0NvbnRlbnRUeXBlID0ge30pKVt0Mi5SQVdfVEVYVCA9IDBdID0gIlJBV19URVhUIiwgdDJbdDIuRVNDQVBBQkxFX1JBV19URVhUID0gMV0gPSAiRVNDQVBBQkxFX1JBV19URVhUIiwgdDJbdDIuUEFSU0FCTEVfREFUQSA9IDJdID0gIlBBUlNBQkxFX0RBVEEiLCBlMi5zcGxpdE5zTmFtZSA9IHIyLCBlMi5pc05nQ29udGFpbmVyID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgcmV0dXJuIHIyKGUzKVsxXSA9PT0gIm5nLWNvbnRhaW5lciI7CiAgICAgICAgICB9LCBlMi5pc05nQ29udGVudCA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiByMihlMylbMV0gPT09ICJuZy1jb250ZW50IjsKICAgICAgICAgIH0sIGUyLmlzTmdUZW1wbGF0ZSA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiByMihlMylbMV0gPT09ICJuZy10ZW1wbGF0ZSI7CiAgICAgICAgICB9LCBlMi5nZXROc1ByZWZpeCA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMyA9PT0gbnVsbCA/IG51bGwgOiByMihlMylbMF07CiAgICAgICAgICB9LCBlMi5tZXJnZU5zQW5kTmFtZSA9IGZ1bmN0aW9uKGUzLCB0MykgewogICAgICAgICAgICByZXR1cm4gZTMgPyAiOiIuY29uY2F0KGUzLCAiOiIpLmNvbmNhdCh0MykgOiB0MzsKICAgICAgICAgIH0sIGUyLk5BTUVEX0VOVElUSUVTID0geyBBYWN1dGU6ICJceEMxIiwgYWFjdXRlOiAiXHhFMSIsIEFicmV2ZTogIlx1MDEwMiIsIGFicmV2ZTogIlx1MDEwMyIsIGFjOiAiXHUyMjNFIiwgYWNkOiAiXHUyMjNGIiwgYWNFOiAiXHUyMjNFXHUwMzMzIiwgQWNpcmM6ICJceEMyIiwgYWNpcmM6ICJceEUyIiwgYWN1dGU6ICJceEI0IiwgQWN5OiAiXHUwNDEwIiwgYWN5OiAiXHUwNDMwIiwgQUVsaWc6ICJceEM2IiwgYWVsaWc6ICJceEU2IiwgYWY6ICJcdTIwNjEiLCBBZnI6ICJcdXsxRDUwNH0iLCBhZnI6ICJcdXsxRDUxRX0iLCBBZ3JhdmU6ICJceEMwIiwgYWdyYXZlOiAiXHhFMCIsIGFsZWZzeW06ICJcdTIxMzUiLCBhbGVwaDogIlx1MjEzNSIsIEFscGhhOiAiXHUwMzkxIiwgYWxwaGE6ICJcdTAzQjEiLCBBbWFjcjogIlx1MDEwMCIsIGFtYWNyOiAiXHUwMTAxIiwgYW1hbGc6ICJcdTJBM0YiLCBBTVA6ICImIiwgYW1wOiAiJiIsIEFuZDogIlx1MkE1MyIsIGFuZDogIlx1MjIyNyIsIGFuZGFuZDogIlx1MkE1NSIsIGFuZGQ6ICJcdTJBNUMiLCBhbmRzbG9wZTogIlx1MkE1OCIsIGFuZHY6ICJcdTJBNUEiLCBhbmc6ICJcdTIyMjAiLCBhbmdlOiAiXHUyOUE0IiwgYW5nbGU6ICJcdTIyMjAiLCBhbmdtc2Q6ICJcdTIyMjEiLCBhbmdtc2RhYTogIlx1MjlBOCIsIGFuZ21zZGFiOiAiXHUyOUE5IiwgYW5nbXNkYWM6ICJcdTI5QUEiLCBhbmdtc2RhZDogIlx1MjlBQiIsIGFuZ21zZGFlOiAiXHUyOUFDIiwgYW5nbXNkYWY6ICJcdTI5QUQiLCBhbmdtc2RhZzogIlx1MjlBRSIsIGFuZ21zZGFoOiAiXHUyOUFGIiwgYW5ncnQ6ICJcdTIyMUYiLCBhbmdydHZiOiAiXHUyMkJFIiwgYW5ncnR2YmQ6ICJcdTI5OUQiLCBhbmdzcGg6ICJcdTIyMjIiLCBhbmdzdDogIlx4QzUiLCBhbmd6YXJyOiAiXHUyMzdDIiwgQW9nb246ICJcdTAxMDQiLCBhb2dvbjogIlx1MDEwNSIsIEFvcGY6ICJcdXsxRDUzOH0iLCBhb3BmOiAiXHV7MUQ1NTJ9IiwgYXA6ICJcdTIyNDgiLCBhcGFjaXI6ICJcdTJBNkYiLCBhcEU6ICJcdTJBNzAiLCBhcGU6ICJcdTIyNEEiLCBhcGlkOiAiXHUyMjRCIiwgYXBvczogIiciLCBBcHBseUZ1bmN0aW9uOiAiXHUyMDYxIiwgYXBwcm94OiAiXHUyMjQ4IiwgYXBwcm94ZXE6ICJcdTIyNEEiLCBBcmluZzogIlx4QzUiLCBhcmluZzogIlx4RTUiLCBBc2NyOiAiXHV7MUQ0OUN9IiwgYXNjcjogIlx1ezFENEI2fSIsIEFzc2lnbjogIlx1MjI1NCIsIGFzdDogIioiLCBhc3ltcDogIlx1MjI0OCIsIGFzeW1wZXE6ICJcdTIyNEQiLCBBdGlsZGU6ICJceEMzIiwgYXRpbGRlOiAiXHhFMyIsIEF1bWw6ICJceEM0IiwgYXVtbDogIlx4RTQiLCBhd2NvbmludDogIlx1MjIzMyIsIGF3aW50OiAiXHUyQTExIiwgYmFja2Nvbmc6ICJcdTIyNEMiLCBiYWNrZXBzaWxvbjogIlx1MDNGNiIsIGJhY2twcmltZTogIlx1MjAzNSIsIGJhY2tzaW06ICJcdTIyM0QiLCBiYWNrc2ltZXE6ICJcdTIyQ0QiLCBCYWNrc2xhc2g6ICJcdTIyMTYiLCBCYXJ2OiAiXHUyQUU3IiwgYmFydmVlOiAiXHUyMkJEIiwgQmFyd2VkOiAiXHUyMzA2IiwgYmFyd2VkOiAiXHUyMzA1IiwgYmFyd2VkZ2U6ICJcdTIzMDUiLCBiYnJrOiAiXHUyM0I1IiwgYmJya3Ricms6ICJcdTIzQjYiLCBiY29uZzogIlx1MjI0QyIsIEJjeTogIlx1MDQxMSIsIGJjeTogIlx1MDQzMSIsIGJkcXVvOiAiXHUyMDFFIiwgYmVjYXVzOiAiXHUyMjM1IiwgQmVjYXVzZTogIlx1MjIzNSIsIGJlY2F1c2U6ICJcdTIyMzUiLCBiZW1wdHl2OiAiXHUyOUIwIiwgYmVwc2k6ICJcdTAzRjYiLCBiZXJub3U6ICJcdTIxMkMiLCBCZXJub3VsbGlzOiAiXHUyMTJDIiwgQmV0YTogIlx1MDM5MiIsIGJldGE6ICJcdTAzQjIiLCBiZXRoOiAiXHUyMTM2IiwgYmV0d2VlbjogIlx1MjI2QyIsIEJmcjogIlx1ezFENTA1fSIsIGJmcjogIlx1ezFENTFGfSIsIGJpZ2NhcDogIlx1MjJDMiIsIGJpZ2NpcmM6ICJcdTI1RUYiLCBiaWdjdXA6ICJcdTIyQzMiLCBiaWdvZG90OiAiXHUyQTAwIiwgYmlnb3BsdXM6ICJcdTJBMDEiLCBiaWdvdGltZXM6ICJcdTJBMDIiLCBiaWdzcWN1cDogIlx1MkEwNiIsIGJpZ3N0YXI6ICJcdTI2MDUiLCBiaWd0cmlhbmdsZWRvd246ICJcdTI1QkQiLCBiaWd0cmlhbmdsZXVwOiAiXHUyNUIzIiwgYmlndXBsdXM6ICJcdTJBMDQiLCBiaWd2ZWU6ICJcdTIyQzEiLCBiaWd3ZWRnZTogIlx1MjJDMCIsIGJrYXJvdzogIlx1MjkwRCIsIGJsYWNrbG96ZW5nZTogIlx1MjlFQiIsIGJsYWNrc3F1YXJlOiAiXHUyNUFBIiwgYmxhY2t0cmlhbmdsZTogIlx1MjVCNCIsIGJsYWNrdHJpYW5nbGVkb3duOiAiXHUyNUJFIiwgYmxhY2t0cmlhbmdsZWxlZnQ6ICJcdTI1QzIiLCBibGFja3RyaWFuZ2xlcmlnaHQ6ICJcdTI1QjgiLCBibGFuazogIlx1MjQyMyIsIGJsazEyOiAiXHUyNTkyIiwgYmxrMTQ6ICJcdTI1OTEiLCBibGszNDogIlx1MjU5MyIsIGJsb2NrOiAiXHUyNTg4IiwgYm5lOiAiPVx1MjBFNSIsIGJuZXF1aXY6ICJcdTIyNjFcdTIwRTUiLCBiTm90OiAiXHUyQUVEIiwgYm5vdDogIlx1MjMxMCIsIEJvcGY6ICJcdXsxRDUzOX0iLCBib3BmOiAiXHV7MUQ1NTN9IiwgYm90OiAiXHUyMkE1IiwgYm90dG9tOiAiXHUyMkE1IiwgYm93dGllOiAiXHUyMkM4IiwgYm94Ym94OiAiXHUyOUM5IiwgYm94REw6ICJcdTI1NTciLCBib3hEbDogIlx1MjU1NiIsIGJveGRMOiAiXHUyNTU1IiwgYm94ZGw6ICJcdTI1MTAiLCBib3hEUjogIlx1MjU1NCIsIGJveERyOiAiXHUyNTUzIiwgYm94ZFI6ICJcdTI1NTIiLCBib3hkcjogIlx1MjUwQyIsIGJveEg6ICJcdTI1NTAiLCBib3hoOiAiXHUyNTAwIiwgYm94SEQ6ICJcdTI1NjYiLCBib3hIZDogIlx1MjU2NCIsIGJveGhEOiAiXHUyNTY1IiwgYm94aGQ6ICJcdTI1MkMiLCBib3hIVTogIlx1MjU2OSIsIGJveEh1OiAiXHUyNTY3IiwgYm94aFU6ICJcdTI1NjgiLCBib3hodTogIlx1MjUzNCIsIGJveG1pbnVzOiAiXHUyMjlGIiwgYm94cGx1czogIlx1MjI5RSIsIGJveHRpbWVzOiAiXHUyMkEwIiwgYm94VUw6ICJcdTI1NUQiLCBib3hVbDogIlx1MjU1QyIsIGJveHVMOiAiXHUyNTVCIiwgYm94dWw6ICJcdTI1MTgiLCBib3hVUjogIlx1MjU1QSIsIGJveFVyOiAiXHUyNTU5IiwgYm94dVI6ICJcdTI1NTgiLCBib3h1cjogIlx1MjUxNCIsIGJveFY6ICJcdTI1NTEiLCBib3h2OiAiXHUyNTAyIiwgYm94Vkg6ICJcdTI1NkMiLCBib3hWaDogIlx1MjU2QiIsIGJveHZIOiAiXHUyNTZBIiwgYm94dmg6ICJcdTI1M0MiLCBib3hWTDogIlx1MjU2MyIsIGJveFZsOiAiXHUyNTYyIiwgYm94dkw6ICJcdTI1NjEiLCBib3h2bDogIlx1MjUyNCIsIGJveFZSOiAiXHUyNTYwIiwgYm94VnI6ICJcdTI1NUYiLCBib3h2UjogIlx1MjU1RSIsIGJveHZyOiAiXHUyNTFDIiwgYnByaW1lOiAiXHUyMDM1IiwgQnJldmU6ICJcdTAyRDgiLCBicmV2ZTogIlx1MDJEOCIsIGJydmJhcjogIlx4QTYiLCBCc2NyOiAiXHUyMTJDIiwgYnNjcjogIlx1ezFENEI3fSIsIGJzZW1pOiAiXHUyMDRGIiwgYnNpbTogIlx1MjIzRCIsIGJzaW1lOiAiXHUyMkNEIiwgYnNvbDogIlxcIiwgYnNvbGI6ICJcdTI5QzUiLCBic29saHN1YjogIlx1MjdDOCIsIGJ1bGw6ICJcdTIwMjIiLCBidWxsZXQ6ICJcdTIwMjIiLCBidW1wOiAiXHUyMjRFIiwgYnVtcEU6ICJcdTJBQUUiLCBidW1wZTogIlx1MjI0RiIsIEJ1bXBlcTogIlx1MjI0RSIsIGJ1bXBlcTogIlx1MjI0RiIsIENhY3V0ZTogIlx1MDEwNiIsIGNhY3V0ZTogIlx1MDEwNyIsIENhcDogIlx1MjJEMiIsIGNhcDogIlx1MjIyOSIsIGNhcGFuZDogIlx1MkE0NCIsIGNhcGJyY3VwOiAiXHUyQTQ5IiwgY2FwY2FwOiAiXHUyQTRCIiwgY2FwY3VwOiAiXHUyQTQ3IiwgY2FwZG90OiAiXHUyQTQwIiwgQ2FwaXRhbERpZmZlcmVudGlhbEQ6ICJcdTIxNDUiLCBjYXBzOiAiXHUyMjI5XHVGRTAwIiwgY2FyZXQ6ICJcdTIwNDEiLCBjYXJvbjogIlx1MDJDNyIsIENheWxleXM6ICJcdTIxMkQiLCBjY2FwczogIlx1MkE0RCIsIENjYXJvbjogIlx1MDEwQyIsIGNjYXJvbjogIlx1MDEwRCIsIENjZWRpbDogIlx4QzciLCBjY2VkaWw6ICJceEU3IiwgQ2NpcmM6ICJcdTAxMDgiLCBjY2lyYzogIlx1MDEwOSIsIENjb25pbnQ6ICJcdTIyMzAiLCBjY3VwczogIlx1MkE0QyIsIGNjdXBzc206ICJcdTJBNTAiLCBDZG90OiAiXHUwMTBBIiwgY2RvdDogIlx1MDEwQiIsIGNlZGlsOiAiXHhCOCIsIENlZGlsbGE6ICJceEI4IiwgY2VtcHR5djogIlx1MjlCMiIsIGNlbnQ6ICJceEEyIiwgQ2VudGVyRG90OiAiXHhCNyIsIGNlbnRlcmRvdDogIlx4QjciLCBDZnI6ICJcdTIxMkQiLCBjZnI6ICJcdXsxRDUyMH0iLCBDSGN5OiAiXHUwNDI3IiwgY2hjeTogIlx1MDQ0NyIsIGNoZWNrOiAiXHUyNzEzIiwgY2hlY2ttYXJrOiAiXHUyNzEzIiwgQ2hpOiAiXHUwM0E3IiwgY2hpOiAiXHUwM0M3IiwgY2lyOiAiXHUyNUNCIiwgY2lyYzogIlx1MDJDNiIsIGNpcmNlcTogIlx1MjI1NyIsIGNpcmNsZWFycm93bGVmdDogIlx1MjFCQSIsIGNpcmNsZWFycm93cmlnaHQ6ICJcdTIxQkIiLCBjaXJjbGVkYXN0OiAiXHUyMjlCIiwgY2lyY2xlZGNpcmM6ICJcdTIyOUEiLCBjaXJjbGVkZGFzaDogIlx1MjI5RCIsIENpcmNsZURvdDogIlx1MjI5OSIsIGNpcmNsZWRSOiAiXHhBRSIsIGNpcmNsZWRTOiAiXHUyNEM4IiwgQ2lyY2xlTWludXM6ICJcdTIyOTYiLCBDaXJjbGVQbHVzOiAiXHUyMjk1IiwgQ2lyY2xlVGltZXM6ICJcdTIyOTciLCBjaXJFOiAiXHUyOUMzIiwgY2lyZTogIlx1MjI1NyIsIGNpcmZuaW50OiAiXHUyQTEwIiwgY2lybWlkOiAiXHUyQUVGIiwgY2lyc2NpcjogIlx1MjlDMiIsIENsb2Nrd2lzZUNvbnRvdXJJbnRlZ3JhbDogIlx1MjIzMiIsIENsb3NlQ3VybHlEb3VibGVRdW90ZTogIlx1MjAxRCIsIENsb3NlQ3VybHlRdW90ZTogIlx1MjAxOSIsIGNsdWJzOiAiXHUyNjYzIiwgY2x1YnN1aXQ6ICJcdTI2NjMiLCBDb2xvbjogIlx1MjIzNyIsIGNvbG9uOiAiOiIsIENvbG9uZTogIlx1MkE3NCIsIGNvbG9uZTogIlx1MjI1NCIsIGNvbG9uZXE6ICJcdTIyNTQiLCBjb21tYTogIiwiLCBjb21tYXQ6ICJAIiwgY29tcDogIlx1MjIwMSIsIGNvbXBmbjogIlx1MjIxOCIsIGNvbXBsZW1lbnQ6ICJcdTIyMDEiLCBjb21wbGV4ZXM6ICJcdTIxMDIiLCBjb25nOiAiXHUyMjQ1IiwgY29uZ2RvdDogIlx1MkE2RCIsIENvbmdydWVudDogIlx1MjI2MSIsIENvbmludDogIlx1MjIyRiIsIGNvbmludDogIlx1MjIyRSIsIENvbnRvdXJJbnRlZ3JhbDogIlx1MjIyRSIsIENvcGY6ICJcdTIxMDIiLCBjb3BmOiAiXHV7MUQ1NTR9IiwgY29wcm9kOiAiXHUyMjEwIiwgQ29wcm9kdWN0OiAiXHUyMjEwIiwgQ09QWTogIlx4QTkiLCBjb3B5OiAiXHhBOSIsIGNvcHlzcjogIlx1MjExNyIsIENvdW50ZXJDbG9ja3dpc2VDb250b3VySW50ZWdyYWw6ICJcdTIyMzMiLCBjcmFycjogIlx1MjFCNSIsIENyb3NzOiAiXHUyQTJGIiwgY3Jvc3M6ICJcdTI3MTciLCBDc2NyOiAiXHV7MUQ0OUV9IiwgY3NjcjogIlx1ezFENEI4fSIsIGNzdWI6ICJcdTJBQ0YiLCBjc3ViZTogIlx1MkFEMSIsIGNzdXA6ICJcdTJBRDAiLCBjc3VwZTogIlx1MkFEMiIsIGN0ZG90OiAiXHUyMkVGIiwgY3VkYXJybDogIlx1MjkzOCIsIGN1ZGFycnI6ICJcdTI5MzUiLCBjdWVwcjogIlx1MjJERSIsIGN1ZXNjOiAiXHUyMkRGIiwgY3VsYXJyOiAiXHUyMUI2IiwgY3VsYXJycDogIlx1MjkzRCIsIEN1cDogIlx1MjJEMyIsIGN1cDogIlx1MjIyQSIsIGN1cGJyY2FwOiAiXHUyQTQ4IiwgQ3VwQ2FwOiAiXHUyMjREIiwgY3VwY2FwOiAiXHUyQTQ2IiwgY3VwY3VwOiAiXHUyQTRBIiwgY3VwZG90OiAiXHUyMjhEIiwgY3Vwb3I6ICJcdTJBNDUiLCBjdXBzOiAiXHUyMjJBXHVGRTAwIiwgY3VyYXJyOiAiXHUyMUI3IiwgY3VyYXJybTogIlx1MjkzQyIsIGN1cmx5ZXFwcmVjOiAiXHUyMkRFIiwgY3VybHllcXN1Y2M6ICJcdTIyREYiLCBjdXJseXZlZTogIlx1MjJDRSIsIGN1cmx5d2VkZ2U6ICJcdTIyQ0YiLCBjdXJyZW46ICJceEE0IiwgY3VydmVhcnJvd2xlZnQ6ICJcdTIxQjYiLCBjdXJ2ZWFycm93cmlnaHQ6ICJcdTIxQjciLCBjdXZlZTogIlx1MjJDRSIsIGN1d2VkOiAiXHUyMkNGIiwgY3djb25pbnQ6ICJcdTIyMzIiLCBjd2ludDogIlx1MjIzMSIsIGN5bGN0eTogIlx1MjMyRCIsIERhZ2dlcjogIlx1MjAyMSIsIGRhZ2dlcjogIlx1MjAyMCIsIGRhbGV0aDogIlx1MjEzOCIsIERhcnI6ICJcdTIxQTEiLCBkQXJyOiAiXHUyMUQzIiwgZGFycjogIlx1MjE5MyIsIGRhc2g6ICJcdTIwMTAiLCBEYXNodjogIlx1MkFFNCIsIGRhc2h2OiAiXHUyMkEzIiwgZGJrYXJvdzogIlx1MjkwRiIsIGRibGFjOiAiXHUwMkREIiwgRGNhcm9uOiAiXHUwMTBFIiwgZGNhcm9uOiAiXHUwMTBGIiwgRGN5OiAiXHUwNDE0IiwgZGN5OiAiXHUwNDM0IiwgREQ6ICJcdTIxNDUiLCBkZDogIlx1MjE0NiIsIGRkYWdnZXI6ICJcdTIwMjEiLCBkZGFycjogIlx1MjFDQSIsIEREb3RyYWhkOiAiXHUyOTExIiwgZGRvdHNlcTogIlx1MkE3NyIsIGRlZzogIlx4QjAiLCBEZWw6ICJcdTIyMDciLCBEZWx0YTogIlx1MDM5NCIsIGRlbHRhOiAiXHUwM0I0IiwgZGVtcHR5djogIlx1MjlCMSIsIGRmaXNodDogIlx1Mjk3RiIsIERmcjogIlx1ezFENTA3fSIsIGRmcjogIlx1ezFENTIxfSIsIGRIYXI6ICJcdTI5NjUiLCBkaGFybDogIlx1MjFDMyIsIGRoYXJyOiAiXHUyMUMyIiwgRGlhY3JpdGljYWxBY3V0ZTogIlx4QjQiLCBEaWFjcml0aWNhbERvdDogIlx1MDJEOSIsIERpYWNyaXRpY2FsRG91YmxlQWN1dGU6ICJcdTAyREQiLCBEaWFjcml0aWNhbEdyYXZlOiAiYCIsIERpYWNyaXRpY2FsVGlsZGU6ICJcdTAyREMiLCBkaWFtOiAiXHUyMkM0IiwgRGlhbW9uZDogIlx1MjJDNCIsIGRpYW1vbmQ6ICJcdTIyQzQiLCBkaWFtb25kc3VpdDogIlx1MjY2NiIsIGRpYW1zOiAiXHUyNjY2IiwgZGllOiAiXHhBOCIsIERpZmZlcmVudGlhbEQ6ICJcdTIxNDYiLCBkaWdhbW1hOiAiXHUwM0REIiwgZGlzaW46ICJcdTIyRjIiLCBkaXY6ICJceEY3IiwgZGl2aWRlOiAiXHhGNyIsIGRpdmlkZW9udGltZXM6ICJcdTIyQzciLCBkaXZvbng6ICJcdTIyQzciLCBESmN5OiAiXHUwNDAyIiwgZGpjeTogIlx1MDQ1MiIsIGRsY29ybjogIlx1MjMxRSIsIGRsY3JvcDogIlx1MjMwRCIsIGRvbGxhcjogIiQiLCBEb3BmOiAiXHV7MUQ1M0J9IiwgZG9wZjogIlx1ezFENTU1fSIsIERvdDogIlx4QTgiLCBkb3Q6ICJcdTAyRDkiLCBEb3REb3Q6ICJcdTIwREMiLCBkb3RlcTogIlx1MjI1MCIsIGRvdGVxZG90OiAiXHUyMjUxIiwgRG90RXF1YWw6ICJcdTIyNTAiLCBkb3RtaW51czogIlx1MjIzOCIsIGRvdHBsdXM6ICJcdTIyMTQiLCBkb3RzcXVhcmU6ICJcdTIyQTEiLCBkb3VibGViYXJ3ZWRnZTogIlx1MjMwNiIsIERvdWJsZUNvbnRvdXJJbnRlZ3JhbDogIlx1MjIyRiIsIERvdWJsZURvdDogIlx4QTgiLCBEb3VibGVEb3duQXJyb3c6ICJcdTIxRDMiLCBEb3VibGVMZWZ0QXJyb3c6ICJcdTIxRDAiLCBEb3VibGVMZWZ0UmlnaHRBcnJvdzogIlx1MjFENCIsIERvdWJsZUxlZnRUZWU6ICJcdTJBRTQiLCBEb3VibGVMb25nTGVmdEFycm93OiAiXHUyN0Y4IiwgRG91YmxlTG9uZ0xlZnRSaWdodEFycm93OiAiXHUyN0ZBIiwgRG91YmxlTG9uZ1JpZ2h0QXJyb3c6ICJcdTI3RjkiLCBEb3VibGVSaWdodEFycm93OiAiXHUyMUQyIiwgRG91YmxlUmlnaHRUZWU6ICJcdTIyQTgiLCBEb3VibGVVcEFycm93OiAiXHUyMUQxIiwgRG91YmxlVXBEb3duQXJyb3c6ICJcdTIxRDUiLCBEb3VibGVWZXJ0aWNhbEJhcjogIlx1MjIyNSIsIERvd25BcnJvdzogIlx1MjE5MyIsIERvd25hcnJvdzogIlx1MjFEMyIsIGRvd25hcnJvdzogIlx1MjE5MyIsIERvd25BcnJvd0JhcjogIlx1MjkxMyIsIERvd25BcnJvd1VwQXJyb3c6ICJcdTIxRjUiLCBEb3duQnJldmU6ICJcdTAzMTEiLCBkb3duZG93bmFycm93czogIlx1MjFDQSIsIGRvd25oYXJwb29ubGVmdDogIlx1MjFDMyIsIGRvd25oYXJwb29ucmlnaHQ6ICJcdTIxQzIiLCBEb3duTGVmdFJpZ2h0VmVjdG9yOiAiXHUyOTUwIiwgRG93bkxlZnRUZWVWZWN0b3I6ICJcdTI5NUUiLCBEb3duTGVmdFZlY3RvcjogIlx1MjFCRCIsIERvd25MZWZ0VmVjdG9yQmFyOiAiXHUyOTU2IiwgRG93blJpZ2h0VGVlVmVjdG9yOiAiXHUyOTVGIiwgRG93blJpZ2h0VmVjdG9yOiAiXHUyMUMxIiwgRG93blJpZ2h0VmVjdG9yQmFyOiAiXHUyOTU3IiwgRG93blRlZTogIlx1MjJBNCIsIERvd25UZWVBcnJvdzogIlx1MjFBNyIsIGRyYmthcm93OiAiXHUyOTEwIiwgZHJjb3JuOiAiXHUyMzFGIiwgZHJjcm9wOiAiXHUyMzBDIiwgRHNjcjogIlx1ezFENDlGfSIsIGRzY3I6ICJcdXsxRDRCOX0iLCBEU2N5OiAiXHUwNDA1IiwgZHNjeTogIlx1MDQ1NSIsIGRzb2w6ICJcdTI5RjYiLCBEc3Ryb2s6ICJcdTAxMTAiLCBkc3Ryb2s6ICJcdTAxMTEiLCBkdGRvdDogIlx1MjJGMSIsIGR0cmk6ICJcdTI1QkYiLCBkdHJpZjogIlx1MjVCRSIsIGR1YXJyOiAiXHUyMUY1IiwgZHVoYXI6ICJcdTI5NkYiLCBkd2FuZ2xlOiAiXHUyOUE2IiwgRFpjeTogIlx1MDQwRiIsIGR6Y3k6ICJcdTA0NUYiLCBkemlncmFycjogIlx1MjdGRiIsIEVhY3V0ZTogIlx4QzkiLCBlYWN1dGU6ICJceEU5IiwgZWFzdGVyOiAiXHUyQTZFIiwgRWNhcm9uOiAiXHUwMTFBIiwgZWNhcm9uOiAiXHUwMTFCIiwgZWNpcjogIlx1MjI1NiIsIEVjaXJjOiAiXHhDQSIsIGVjaXJjOiAiXHhFQSIsIGVjb2xvbjogIlx1MjI1NSIsIEVjeTogIlx1MDQyRCIsIGVjeTogIlx1MDQ0RCIsIGVERG90OiAiXHUyQTc3IiwgRWRvdDogIlx1MDExNiIsIGVEb3Q6ICJcdTIyNTEiLCBlZG90OiAiXHUwMTE3IiwgZWU6ICJcdTIxNDciLCBlZkRvdDogIlx1MjI1MiIsIEVmcjogIlx1ezFENTA4fSIsIGVmcjogIlx1ezFENTIyfSIsIGVnOiAiXHUyQTlBIiwgRWdyYXZlOiAiXHhDOCIsIGVncmF2ZTogIlx4RTgiLCBlZ3M6ICJcdTJBOTYiLCBlZ3Nkb3Q6ICJcdTJBOTgiLCBlbDogIlx1MkE5OSIsIEVsZW1lbnQ6ICJcdTIyMDgiLCBlbGludGVyczogIlx1MjNFNyIsIGVsbDogIlx1MjExMyIsIGVsczogIlx1MkE5NSIsIGVsc2RvdDogIlx1MkE5NyIsIEVtYWNyOiAiXHUwMTEyIiwgZW1hY3I6ICJcdTAxMTMiLCBlbXB0eTogIlx1MjIwNSIsIGVtcHR5c2V0OiAiXHUyMjA1IiwgRW1wdHlTbWFsbFNxdWFyZTogIlx1MjVGQiIsIGVtcHR5djogIlx1MjIwNSIsIEVtcHR5VmVyeVNtYWxsU3F1YXJlOiAiXHUyNUFCIiwgZW1zcDogIlx1MjAwMyIsIGVtc3AxMzogIlx1MjAwNCIsIGVtc3AxNDogIlx1MjAwNSIsIEVORzogIlx1MDE0QSIsIGVuZzogIlx1MDE0QiIsIGVuc3A6ICJcdTIwMDIiLCBFb2dvbjogIlx1MDExOCIsIGVvZ29uOiAiXHUwMTE5IiwgRW9wZjogIlx1ezFENTNDfSIsIGVvcGY6ICJcdXsxRDU1Nn0iLCBlcGFyOiAiXHUyMkQ1IiwgZXBhcnNsOiAiXHUyOUUzIiwgZXBsdXM6ICJcdTJBNzEiLCBlcHNpOiAiXHUwM0I1IiwgRXBzaWxvbjogIlx1MDM5NSIsIGVwc2lsb246ICJcdTAzQjUiLCBlcHNpdjogIlx1MDNGNSIsIGVxY2lyYzogIlx1MjI1NiIsIGVxY29sb246ICJcdTIyNTUiLCBlcXNpbTogIlx1MjI0MiIsIGVxc2xhbnRndHI6ICJcdTJBOTYiLCBlcXNsYW50bGVzczogIlx1MkE5NSIsIEVxdWFsOiAiXHUyQTc1IiwgZXF1YWxzOiAiPSIsIEVxdWFsVGlsZGU6ICJcdTIyNDIiLCBlcXVlc3Q6ICJcdTIyNUYiLCBFcXVpbGlicml1bTogIlx1MjFDQyIsIGVxdWl2OiAiXHUyMjYxIiwgZXF1aXZERDogIlx1MkE3OCIsIGVxdnBhcnNsOiAiXHUyOUU1IiwgZXJhcnI6ICJcdTI5NzEiLCBlckRvdDogIlx1MjI1MyIsIEVzY3I6ICJcdTIxMzAiLCBlc2NyOiAiXHUyMTJGIiwgZXNkb3Q6ICJcdTIyNTAiLCBFc2ltOiAiXHUyQTczIiwgZXNpbTogIlx1MjI0MiIsIEV0YTogIlx1MDM5NyIsIGV0YTogIlx1MDNCNyIsIEVUSDogIlx4RDAiLCBldGg6ICJceEYwIiwgRXVtbDogIlx4Q0IiLCBldW1sOiAiXHhFQiIsIGV1cm86ICJcdTIwQUMiLCBleGNsOiAiISIsIGV4aXN0OiAiXHUyMjAzIiwgRXhpc3RzOiAiXHUyMjAzIiwgZXhwZWN0YXRpb246ICJcdTIxMzAiLCBFeHBvbmVudGlhbEU6ICJcdTIxNDciLCBleHBvbmVudGlhbGU6ICJcdTIxNDciLCBmYWxsaW5nZG90c2VxOiAiXHUyMjUyIiwgRmN5OiAiXHUwNDI0IiwgZmN5OiAiXHUwNDQ0IiwgZmVtYWxlOiAiXHUyNjQwIiwgZmZpbGlnOiAiXHVGQjAzIiwgZmZsaWc6ICJcdUZCMDAiLCBmZmxsaWc6ICJcdUZCMDQiLCBGZnI6ICJcdXsxRDUwOX0iLCBmZnI6ICJcdXsxRDUyM30iLCBmaWxpZzogIlx1RkIwMSIsIEZpbGxlZFNtYWxsU3F1YXJlOiAiXHUyNUZDIiwgRmlsbGVkVmVyeVNtYWxsU3F1YXJlOiAiXHUyNUFBIiwgZmpsaWc6ICJmaiIsIGZsYXQ6ICJcdTI2NkQiLCBmbGxpZzogIlx1RkIwMiIsIGZsdG5zOiAiXHUyNUIxIiwgZm5vZjogIlx1MDE5MiIsIEZvcGY6ICJcdXsxRDUzRH0iLCBmb3BmOiAiXHV7MUQ1NTd9IiwgRm9yQWxsOiAiXHUyMjAwIiwgZm9yYWxsOiAiXHUyMjAwIiwgZm9yazogIlx1MjJENCIsIGZvcmt2OiAiXHUyQUQ5IiwgRm91cmllcnRyZjogIlx1MjEzMSIsIGZwYXJ0aW50OiAiXHUyQTBEIiwgZnJhYzEyOiAiXHhCRCIsIGZyYWMxMzogIlx1MjE1MyIsIGZyYWMxNDogIlx4QkMiLCBmcmFjMTU6ICJcdTIxNTUiLCBmcmFjMTY6ICJcdTIxNTkiLCBmcmFjMTg6ICJcdTIxNUIiLCBmcmFjMjM6ICJcdTIxNTQiLCBmcmFjMjU6ICJcdTIxNTYiLCBmcmFjMzQ6ICJceEJFIiwgZnJhYzM1OiAiXHUyMTU3IiwgZnJhYzM4OiAiXHUyMTVDIiwgZnJhYzQ1OiAiXHUyMTU4IiwgZnJhYzU2OiAiXHUyMTVBIiwgZnJhYzU4OiAiXHUyMTVEIiwgZnJhYzc4OiAiXHUyMTVFIiwgZnJhc2w6ICJcdTIwNDQiLCBmcm93bjogIlx1MjMyMiIsIEZzY3I6ICJcdTIxMzEiLCBmc2NyOiAiXHV7MUQ0QkJ9IiwgZ2FjdXRlOiAiXHUwMUY1IiwgR2FtbWE6ICJcdTAzOTMiLCBnYW1tYTogIlx1MDNCMyIsIEdhbW1hZDogIlx1MDNEQyIsIGdhbW1hZDogIlx1MDNERCIsIGdhcDogIlx1MkE4NiIsIEdicmV2ZTogIlx1MDExRSIsIGdicmV2ZTogIlx1MDExRiIsIEdjZWRpbDogIlx1MDEyMiIsIEdjaXJjOiAiXHUwMTFDIiwgZ2NpcmM6ICJcdTAxMUQiLCBHY3k6ICJcdTA0MTMiLCBnY3k6ICJcdTA0MzMiLCBHZG90OiAiXHUwMTIwIiwgZ2RvdDogIlx1MDEyMSIsIGdFOiAiXHUyMjY3IiwgZ2U6ICJcdTIyNjUiLCBnRWw6ICJcdTJBOEMiLCBnZWw6ICJcdTIyREIiLCBnZXE6ICJcdTIyNjUiLCBnZXFxOiAiXHUyMjY3IiwgZ2Vxc2xhbnQ6ICJcdTJBN0UiLCBnZXM6ICJcdTJBN0UiLCBnZXNjYzogIlx1MkFBOSIsIGdlc2RvdDogIlx1MkE4MCIsIGdlc2RvdG86ICJcdTJBODIiLCBnZXNkb3RvbDogIlx1MkE4NCIsIGdlc2w6ICJcdTIyREJcdUZFMDAiLCBnZXNsZXM6ICJcdTJBOTQiLCBHZnI6ICJcdXsxRDUwQX0iLCBnZnI6ICJcdXsxRDUyNH0iLCBHZzogIlx1MjJEOSIsIGdnOiAiXHUyMjZCIiwgZ2dnOiAiXHUyMkQ5IiwgZ2ltZWw6ICJcdTIxMzciLCBHSmN5OiAiXHUwNDAzIiwgZ2pjeTogIlx1MDQ1MyIsIGdsOiAiXHUyMjc3IiwgZ2xhOiAiXHUyQUE1IiwgZ2xFOiAiXHUyQTkyIiwgZ2xqOiAiXHUyQUE0IiwgZ25hcDogIlx1MkE4QSIsIGduYXBwcm94OiAiXHUyQThBIiwgZ25FOiAiXHUyMjY5IiwgZ25lOiAiXHUyQTg4IiwgZ25lcTogIlx1MkE4OCIsIGduZXFxOiAiXHUyMjY5IiwgZ25zaW06ICJcdTIyRTciLCBHb3BmOiAiXHV7MUQ1M0V9IiwgZ29wZjogIlx1ezFENTU4fSIsIGdyYXZlOiAiYCIsIEdyZWF0ZXJFcXVhbDogIlx1MjI2NSIsIEdyZWF0ZXJFcXVhbExlc3M6ICJcdTIyREIiLCBHcmVhdGVyRnVsbEVxdWFsOiAiXHUyMjY3IiwgR3JlYXRlckdyZWF0ZXI6ICJcdTJBQTIiLCBHcmVhdGVyTGVzczogIlx1MjI3NyIsIEdyZWF0ZXJTbGFudEVxdWFsOiAiXHUyQTdFIiwgR3JlYXRlclRpbGRlOiAiXHUyMjczIiwgR3NjcjogIlx1ezFENEEyfSIsIGdzY3I6ICJcdTIxMEEiLCBnc2ltOiAiXHUyMjczIiwgZ3NpbWU6ICJcdTJBOEUiLCBnc2ltbDogIlx1MkE5MCIsIEdUOiAiPiIsIEd0OiAiXHUyMjZCIiwgZ3Q6ICI+IiwgZ3RjYzogIlx1MkFBNyIsIGd0Y2lyOiAiXHUyQTdBIiwgZ3Rkb3Q6ICJcdTIyRDciLCBndGxQYXI6ICJcdTI5OTUiLCBndHF1ZXN0OiAiXHUyQTdDIiwgZ3RyYXBwcm94OiAiXHUyQTg2IiwgZ3RyYXJyOiAiXHUyOTc4IiwgZ3RyZG90OiAiXHUyMkQ3IiwgZ3RyZXFsZXNzOiAiXHUyMkRCIiwgZ3RyZXFxbGVzczogIlx1MkE4QyIsIGd0cmxlc3M6ICJcdTIyNzciLCBndHJzaW06ICJcdTIyNzMiLCBndmVydG5lcXE6ICJcdTIyNjlcdUZFMDAiLCBndm5FOiAiXHUyMjY5XHVGRTAwIiwgSGFjZWs6ICJcdTAyQzciLCBoYWlyc3A6ICJcdTIwMEEiLCBoYWxmOiAiXHhCRCIsIGhhbWlsdDogIlx1MjEwQiIsIEhBUkRjeTogIlx1MDQyQSIsIGhhcmRjeTogIlx1MDQ0QSIsIGhBcnI6ICJcdTIxRDQiLCBoYXJyOiAiXHUyMTk0IiwgaGFycmNpcjogIlx1Mjk0OCIsIGhhcnJ3OiAiXHUyMUFEIiwgSGF0OiAiXiIsIGhiYXI6ICJcdTIxMEYiLCBIY2lyYzogIlx1MDEyNCIsIGhjaXJjOiAiXHUwMTI1IiwgaGVhcnRzOiAiXHUyNjY1IiwgaGVhcnRzdWl0OiAiXHUyNjY1IiwgaGVsbGlwOiAiXHUyMDI2IiwgaGVyY29uOiAiXHUyMkI5IiwgSGZyOiAiXHUyMTBDIiwgaGZyOiAiXHV7MUQ1MjV9IiwgSGlsYmVydFNwYWNlOiAiXHUyMTBCIiwgaGtzZWFyb3c6ICJcdTI5MjUiLCBoa3N3YXJvdzogIlx1MjkyNiIsIGhvYXJyOiAiXHUyMUZGIiwgaG9tdGh0OiAiXHUyMjNCIiwgaG9va2xlZnRhcnJvdzogIlx1MjFBOSIsIGhvb2tyaWdodGFycm93OiAiXHUyMUFBIiwgSG9wZjogIlx1MjEwRCIsIGhvcGY6ICJcdXsxRDU1OX0iLCBob3JiYXI6ICJcdTIwMTUiLCBIb3Jpem9udGFsTGluZTogIlx1MjUwMCIsIEhzY3I6ICJcdTIxMEIiLCBoc2NyOiAiXHV7MUQ0QkR9IiwgaHNsYXNoOiAiXHUyMTBGIiwgSHN0cm9rOiAiXHUwMTI2IiwgaHN0cm9rOiAiXHUwMTI3IiwgSHVtcERvd25IdW1wOiAiXHUyMjRFIiwgSHVtcEVxdWFsOiAiXHUyMjRGIiwgaHlidWxsOiAiXHUyMDQzIiwgaHlwaGVuOiAiXHUyMDEwIiwgSWFjdXRlOiAiXHhDRCIsIGlhY3V0ZTogIlx4RUQiLCBpYzogIlx1MjA2MyIsIEljaXJjOiAiXHhDRSIsIGljaXJjOiAiXHhFRSIsIEljeTogIlx1MDQxOCIsIGljeTogIlx1MDQzOCIsIElkb3Q6ICJcdTAxMzAiLCBJRWN5OiAiXHUwNDE1IiwgaWVjeTogIlx1MDQzNSIsIGlleGNsOiAiXHhBMSIsIGlmZjogIlx1MjFENCIsIElmcjogIlx1MjExMSIsIGlmcjogIlx1ezFENTI2fSIsIElncmF2ZTogIlx4Q0MiLCBpZ3JhdmU6ICJceEVDIiwgaWk6ICJcdTIxNDgiLCBpaWlpbnQ6ICJcdTJBMEMiLCBpaWludDogIlx1MjIyRCIsIGlpbmZpbjogIlx1MjlEQyIsIGlpb3RhOiAiXHUyMTI5IiwgSUpsaWc6ICJcdTAxMzIiLCBpamxpZzogIlx1MDEzMyIsIEltOiAiXHUyMTExIiwgSW1hY3I6ICJcdTAxMkEiLCBpbWFjcjogIlx1MDEyQiIsIGltYWdlOiAiXHUyMTExIiwgSW1hZ2luYXJ5STogIlx1MjE0OCIsIGltYWdsaW5lOiAiXHUyMTEwIiwgaW1hZ3BhcnQ6ICJcdTIxMTEiLCBpbWF0aDogIlx1MDEzMSIsIGltb2Y6ICJcdTIyQjciLCBpbXBlZDogIlx1MDFCNSIsIEltcGxpZXM6ICJcdTIxRDIiLCBpbjogIlx1MjIwOCIsIGluY2FyZTogIlx1MjEwNSIsIGluZmluOiAiXHUyMjFFIiwgaW5maW50aWU6ICJcdTI5REQiLCBpbm9kb3Q6ICJcdTAxMzEiLCBJbnQ6ICJcdTIyMkMiLCBpbnQ6ICJcdTIyMkIiLCBpbnRjYWw6ICJcdTIyQkEiLCBpbnRlZ2VyczogIlx1MjEyNCIsIEludGVncmFsOiAiXHUyMjJCIiwgaW50ZXJjYWw6ICJcdTIyQkEiLCBJbnRlcnNlY3Rpb246ICJcdTIyQzIiLCBpbnRsYXJoazogIlx1MkExNyIsIGludHByb2Q6ICJcdTJBM0MiLCBJbnZpc2libGVDb21tYTogIlx1MjA2MyIsIEludmlzaWJsZVRpbWVzOiAiXHUyMDYyIiwgSU9jeTogIlx1MDQwMSIsIGlvY3k6ICJcdTA0NTEiLCBJb2dvbjogIlx1MDEyRSIsIGlvZ29uOiAiXHUwMTJGIiwgSW9wZjogIlx1ezFENTQwfSIsIGlvcGY6ICJcdXsxRDU1QX0iLCBJb3RhOiAiXHUwMzk5IiwgaW90YTogIlx1MDNCOSIsIGlwcm9kOiAiXHUyQTNDIiwgaXF1ZXN0OiAiXHhCRiIsIElzY3I6ICJcdTIxMTAiLCBpc2NyOiAiXHV7MUQ0QkV9IiwgaXNpbjogIlx1MjIwOCIsIGlzaW5kb3Q6ICJcdTIyRjUiLCBpc2luRTogIlx1MjJGOSIsIGlzaW5zOiAiXHUyMkY0IiwgaXNpbnN2OiAiXHUyMkYzIiwgaXNpbnY6ICJcdTIyMDgiLCBpdDogIlx1MjA2MiIsIEl0aWxkZTogIlx1MDEyOCIsIGl0aWxkZTogIlx1MDEyOSIsIEl1a2N5OiAiXHUwNDA2IiwgaXVrY3k6ICJcdTA0NTYiLCBJdW1sOiAiXHhDRiIsIGl1bWw6ICJceEVGIiwgSmNpcmM6ICJcdTAxMzQiLCBqY2lyYzogIlx1MDEzNSIsIEpjeTogIlx1MDQxOSIsIGpjeTogIlx1MDQzOSIsIEpmcjogIlx1ezFENTBEfSIsIGpmcjogIlx1ezFENTI3fSIsIGptYXRoOiAiXHUwMjM3IiwgSm9wZjogIlx1ezFENTQxfSIsIGpvcGY6ICJcdXsxRDU1Qn0iLCBKc2NyOiAiXHV7MUQ0QTV9IiwganNjcjogIlx1ezFENEJGfSIsIEpzZXJjeTogIlx1MDQwOCIsIGpzZXJjeTogIlx1MDQ1OCIsIEp1a2N5OiAiXHUwNDA0IiwganVrY3k6ICJcdTA0NTQiLCBLYXBwYTogIlx1MDM5QSIsIGthcHBhOiAiXHUwM0JBIiwga2FwcGF2OiAiXHUwM0YwIiwgS2NlZGlsOiAiXHUwMTM2Iiwga2NlZGlsOiAiXHUwMTM3IiwgS2N5OiAiXHUwNDFBIiwga2N5OiAiXHUwNDNBIiwgS2ZyOiAiXHV7MUQ1MEV9Iiwga2ZyOiAiXHV7MUQ1Mjh9Iiwga2dyZWVuOiAiXHUwMTM4IiwgS0hjeTogIlx1MDQyNSIsIGtoY3k6ICJcdTA0NDUiLCBLSmN5OiAiXHUwNDBDIiwga2pjeTogIlx1MDQ1QyIsIEtvcGY6ICJcdXsxRDU0Mn0iLCBrb3BmOiAiXHV7MUQ1NUN9IiwgS3NjcjogIlx1ezFENEE2fSIsIGtzY3I6ICJcdXsxRDRDMH0iLCBsQWFycjogIlx1MjFEQSIsIExhY3V0ZTogIlx1MDEzOSIsIGxhY3V0ZTogIlx1MDEzQSIsIGxhZW1wdHl2OiAiXHUyOUI0IiwgbGFncmFuOiAiXHUyMTEyIiwgTGFtYmRhOiAiXHUwMzlCIiwgbGFtYmRhOiAiXHUwM0JCIiwgTGFuZzogIlx1MjdFQSIsIGxhbmc6ICJcdTI3RTgiLCBsYW5nZDogIlx1Mjk5MSIsIGxhbmdsZTogIlx1MjdFOCIsIGxhcDogIlx1MkE4NSIsIExhcGxhY2V0cmY6ICJcdTIxMTIiLCBsYXF1bzogIlx4QUIiLCBMYXJyOiAiXHUyMTlFIiwgbEFycjogIlx1MjFEMCIsIGxhcnI6ICJcdTIxOTAiLCBsYXJyYjogIlx1MjFFNCIsIGxhcnJiZnM6ICJcdTI5MUYiLCBsYXJyZnM6ICJcdTI5MUQiLCBsYXJyaGs6ICJcdTIxQTkiLCBsYXJybHA6ICJcdTIxQUIiLCBsYXJycGw6ICJcdTI5MzkiLCBsYXJyc2ltOiAiXHUyOTczIiwgbGFycnRsOiAiXHUyMUEyIiwgbGF0OiAiXHUyQUFCIiwgbEF0YWlsOiAiXHUyOTFCIiwgbGF0YWlsOiAiXHUyOTE5IiwgbGF0ZTogIlx1MkFBRCIsIGxhdGVzOiAiXHUyQUFEXHVGRTAwIiwgbEJhcnI6ICJcdTI5MEUiLCBsYmFycjogIlx1MjkwQyIsIGxiYnJrOiAiXHUyNzcyIiwgbGJyYWNlOiAieyIsIGxicmFjazogIlsiLCBsYnJrZTogIlx1Mjk4QiIsIGxicmtzbGQ6ICJcdTI5OEYiLCBsYnJrc2x1OiAiXHUyOThEIiwgTGNhcm9uOiAiXHUwMTNEIiwgbGNhcm9uOiAiXHUwMTNFIiwgTGNlZGlsOiAiXHUwMTNCIiwgbGNlZGlsOiAiXHUwMTNDIiwgbGNlaWw6ICJcdTIzMDgiLCBsY3ViOiAieyIsIExjeTogIlx1MDQxQiIsIGxjeTogIlx1MDQzQiIsIGxkY2E6ICJcdTI5MzYiLCBsZHF1bzogIlx1MjAxQyIsIGxkcXVvcjogIlx1MjAxRSIsIGxkcmRoYXI6ICJcdTI5NjciLCBsZHJ1c2hhcjogIlx1Mjk0QiIsIGxkc2g6ICJcdTIxQjIiLCBsRTogIlx1MjI2NiIsIGxlOiAiXHUyMjY0IiwgTGVmdEFuZ2xlQnJhY2tldDogIlx1MjdFOCIsIExlZnRBcnJvdzogIlx1MjE5MCIsIExlZnRhcnJvdzogIlx1MjFEMCIsIGxlZnRhcnJvdzogIlx1MjE5MCIsIExlZnRBcnJvd0JhcjogIlx1MjFFNCIsIExlZnRBcnJvd1JpZ2h0QXJyb3c6ICJcdTIxQzYiLCBsZWZ0YXJyb3d0YWlsOiAiXHUyMUEyIiwgTGVmdENlaWxpbmc6ICJcdTIzMDgiLCBMZWZ0RG91YmxlQnJhY2tldDogIlx1MjdFNiIsIExlZnREb3duVGVlVmVjdG9yOiAiXHUyOTYxIiwgTGVmdERvd25WZWN0b3I6ICJcdTIxQzMiLCBMZWZ0RG93blZlY3RvckJhcjogIlx1Mjk1OSIsIExlZnRGbG9vcjogIlx1MjMwQSIsIGxlZnRoYXJwb29uZG93bjogIlx1MjFCRCIsIGxlZnRoYXJwb29udXA6ICJcdTIxQkMiLCBsZWZ0bGVmdGFycm93czogIlx1MjFDNyIsIExlZnRSaWdodEFycm93OiAiXHUyMTk0IiwgTGVmdHJpZ2h0YXJyb3c6ICJcdTIxRDQiLCBsZWZ0cmlnaHRhcnJvdzogIlx1MjE5NCIsIGxlZnRyaWdodGFycm93czogIlx1MjFDNiIsIGxlZnRyaWdodGhhcnBvb25zOiAiXHUyMUNCIiwgbGVmdHJpZ2h0c3F1aWdhcnJvdzogIlx1MjFBRCIsIExlZnRSaWdodFZlY3RvcjogIlx1Mjk0RSIsIExlZnRUZWU6ICJcdTIyQTMiLCBMZWZ0VGVlQXJyb3c6ICJcdTIxQTQiLCBMZWZ0VGVlVmVjdG9yOiAiXHUyOTVBIiwgbGVmdHRocmVldGltZXM6ICJcdTIyQ0IiLCBMZWZ0VHJpYW5nbGU6ICJcdTIyQjIiLCBMZWZ0VHJpYW5nbGVCYXI6ICJcdTI5Q0YiLCBMZWZ0VHJpYW5nbGVFcXVhbDogIlx1MjJCNCIsIExlZnRVcERvd25WZWN0b3I6ICJcdTI5NTEiLCBMZWZ0VXBUZWVWZWN0b3I6ICJcdTI5NjAiLCBMZWZ0VXBWZWN0b3I6ICJcdTIxQkYiLCBMZWZ0VXBWZWN0b3JCYXI6ICJcdTI5NTgiLCBMZWZ0VmVjdG9yOiAiXHUyMUJDIiwgTGVmdFZlY3RvckJhcjogIlx1Mjk1MiIsIGxFZzogIlx1MkE4QiIsIGxlZzogIlx1MjJEQSIsIGxlcTogIlx1MjI2NCIsIGxlcXE6ICJcdTIyNjYiLCBsZXFzbGFudDogIlx1MkE3RCIsIGxlczogIlx1MkE3RCIsIGxlc2NjOiAiXHUyQUE4IiwgbGVzZG90OiAiXHUyQTdGIiwgbGVzZG90bzogIlx1MkE4MSIsIGxlc2RvdG9yOiAiXHUyQTgzIiwgbGVzZzogIlx1MjJEQVx1RkUwMCIsIGxlc2dlczogIlx1MkE5MyIsIGxlc3NhcHByb3g6ICJcdTJBODUiLCBsZXNzZG90OiAiXHUyMkQ2IiwgbGVzc2VxZ3RyOiAiXHUyMkRBIiwgbGVzc2VxcWd0cjogIlx1MkE4QiIsIExlc3NFcXVhbEdyZWF0ZXI6ICJcdTIyREEiLCBMZXNzRnVsbEVxdWFsOiAiXHUyMjY2IiwgTGVzc0dyZWF0ZXI6ICJcdTIyNzYiLCBsZXNzZ3RyOiAiXHUyMjc2IiwgTGVzc0xlc3M6ICJcdTJBQTEiLCBsZXNzc2ltOiAiXHUyMjcyIiwgTGVzc1NsYW50RXF1YWw6ICJcdTJBN0QiLCBMZXNzVGlsZGU6ICJcdTIyNzIiLCBsZmlzaHQ6ICJcdTI5N0MiLCBsZmxvb3I6ICJcdTIzMEEiLCBMZnI6ICJcdXsxRDUwRn0iLCBsZnI6ICJcdXsxRDUyOX0iLCBsZzogIlx1MjI3NiIsIGxnRTogIlx1MkE5MSIsIGxIYXI6ICJcdTI5NjIiLCBsaGFyZDogIlx1MjFCRCIsIGxoYXJ1OiAiXHUyMUJDIiwgbGhhcnVsOiAiXHUyOTZBIiwgbGhibGs6ICJcdTI1ODQiLCBMSmN5OiAiXHUwNDA5IiwgbGpjeTogIlx1MDQ1OSIsIExsOiAiXHUyMkQ4IiwgbGw6ICJcdTIyNkEiLCBsbGFycjogIlx1MjFDNyIsIGxsY29ybmVyOiAiXHUyMzFFIiwgTGxlZnRhcnJvdzogIlx1MjFEQSIsIGxsaGFyZDogIlx1Mjk2QiIsIGxsdHJpOiAiXHUyNUZBIiwgTG1pZG90OiAiXHUwMTNGIiwgbG1pZG90OiAiXHUwMTQwIiwgbG1vdXN0OiAiXHUyM0IwIiwgbG1vdXN0YWNoZTogIlx1MjNCMCIsIGxuYXA6ICJcdTJBODkiLCBsbmFwcHJveDogIlx1MkE4OSIsIGxuRTogIlx1MjI2OCIsIGxuZTogIlx1MkE4NyIsIGxuZXE6ICJcdTJBODciLCBsbmVxcTogIlx1MjI2OCIsIGxuc2ltOiAiXHUyMkU2IiwgbG9hbmc6ICJcdTI3RUMiLCBsb2FycjogIlx1MjFGRCIsIGxvYnJrOiAiXHUyN0U2IiwgTG9uZ0xlZnRBcnJvdzogIlx1MjdGNSIsIExvbmdsZWZ0YXJyb3c6ICJcdTI3RjgiLCBsb25nbGVmdGFycm93OiAiXHUyN0Y1IiwgTG9uZ0xlZnRSaWdodEFycm93OiAiXHUyN0Y3IiwgTG9uZ2xlZnRyaWdodGFycm93OiAiXHUyN0ZBIiwgbG9uZ2xlZnRyaWdodGFycm93OiAiXHUyN0Y3IiwgbG9uZ21hcHN0bzogIlx1MjdGQyIsIExvbmdSaWdodEFycm93OiAiXHUyN0Y2IiwgTG9uZ3JpZ2h0YXJyb3c6ICJcdTI3RjkiLCBsb25ncmlnaHRhcnJvdzogIlx1MjdGNiIsIGxvb3BhcnJvd2xlZnQ6ICJcdTIxQUIiLCBsb29wYXJyb3dyaWdodDogIlx1MjFBQyIsIGxvcGFyOiAiXHUyOTg1IiwgTG9wZjogIlx1ezFENTQzfSIsIGxvcGY6ICJcdXsxRDU1RH0iLCBsb3BsdXM6ICJcdTJBMkQiLCBsb3RpbWVzOiAiXHUyQTM0IiwgbG93YXN0OiAiXHUyMjE3IiwgbG93YmFyOiAiXyIsIExvd2VyTGVmdEFycm93OiAiXHUyMTk5IiwgTG93ZXJSaWdodEFycm93OiAiXHUyMTk4IiwgbG96OiAiXHUyNUNBIiwgbG96ZW5nZTogIlx1MjVDQSIsIGxvemY6ICJcdTI5RUIiLCBscGFyOiAiKCIsIGxwYXJsdDogIlx1Mjk5MyIsIGxyYXJyOiAiXHUyMUM2IiwgbHJjb3JuZXI6ICJcdTIzMUYiLCBscmhhcjogIlx1MjFDQiIsIGxyaGFyZDogIlx1Mjk2RCIsIGxybTogIlx1MjAwRSIsIGxydHJpOiAiXHUyMkJGIiwgbHNhcXVvOiAiXHUyMDM5IiwgTHNjcjogIlx1MjExMiIsIGxzY3I6ICJcdXsxRDRDMX0iLCBMc2g6ICJcdTIxQjAiLCBsc2g6ICJcdTIxQjAiLCBsc2ltOiAiXHUyMjcyIiwgbHNpbWU6ICJcdTJBOEQiLCBsc2ltZzogIlx1MkE4RiIsIGxzcWI6ICJbIiwgbHNxdW86ICJcdTIwMTgiLCBsc3F1b3I6ICJcdTIwMUEiLCBMc3Ryb2s6ICJcdTAxNDEiLCBsc3Ryb2s6ICJcdTAxNDIiLCBMVDogIjwiLCBMdDogIlx1MjI2QSIsIGx0OiAiPCIsIGx0Y2M6ICJcdTJBQTYiLCBsdGNpcjogIlx1MkE3OSIsIGx0ZG90OiAiXHUyMkQ2IiwgbHRocmVlOiAiXHUyMkNCIiwgbHRpbWVzOiAiXHUyMkM5IiwgbHRsYXJyOiAiXHUyOTc2IiwgbHRxdWVzdDogIlx1MkE3QiIsIGx0cmk6ICJcdTI1QzMiLCBsdHJpZTogIlx1MjJCNCIsIGx0cmlmOiAiXHUyNUMyIiwgbHRyUGFyOiAiXHUyOTk2IiwgbHVyZHNoYXI6ICJcdTI5NEEiLCBsdXJ1aGFyOiAiXHUyOTY2IiwgbHZlcnRuZXFxOiAiXHUyMjY4XHVGRTAwIiwgbHZuRTogIlx1MjI2OFx1RkUwMCIsIG1hY3I6ICJceEFGIiwgbWFsZTogIlx1MjY0MiIsIG1hbHQ6ICJcdTI3MjAiLCBtYWx0ZXNlOiAiXHUyNzIwIiwgTWFwOiAiXHUyOTA1IiwgbWFwOiAiXHUyMUE2IiwgbWFwc3RvOiAiXHUyMUE2IiwgbWFwc3RvZG93bjogIlx1MjFBNyIsIG1hcHN0b2xlZnQ6ICJcdTIxQTQiLCBtYXBzdG91cDogIlx1MjFBNSIsIG1hcmtlcjogIlx1MjVBRSIsIG1jb21tYTogIlx1MkEyOSIsIE1jeTogIlx1MDQxQyIsIG1jeTogIlx1MDQzQyIsIG1kYXNoOiAiXHUyMDE0IiwgbUREb3Q6ICJcdTIyM0EiLCBtZWFzdXJlZGFuZ2xlOiAiXHUyMjIxIiwgTWVkaXVtU3BhY2U6ICJcdTIwNUYiLCBNZWxsaW50cmY6ICJcdTIxMzMiLCBNZnI6ICJcdXsxRDUxMH0iLCBtZnI6ICJcdXsxRDUyQX0iLCBtaG86ICJcdTIxMjciLCBtaWNybzogIlx4QjUiLCBtaWQ6ICJcdTIyMjMiLCBtaWRhc3Q6ICIqIiwgbWlkY2lyOiAiXHUyQUYwIiwgbWlkZG90OiAiXHhCNyIsIG1pbnVzOiAiXHUyMjEyIiwgbWludXNiOiAiXHUyMjlGIiwgbWludXNkOiAiXHUyMjM4IiwgbWludXNkdTogIlx1MkEyQSIsIE1pbnVzUGx1czogIlx1MjIxMyIsIG1sY3A6ICJcdTJBREIiLCBtbGRyOiAiXHUyMDI2IiwgbW5wbHVzOiAiXHUyMjEzIiwgbW9kZWxzOiAiXHUyMkE3IiwgTW9wZjogIlx1ezFENTQ0fSIsIG1vcGY6ICJcdXsxRDU1RX0iLCBtcDogIlx1MjIxMyIsIE1zY3I6ICJcdTIxMzMiLCBtc2NyOiAiXHV7MUQ0QzJ9IiwgbXN0cG9zOiAiXHUyMjNFIiwgTXU6ICJcdTAzOUMiLCBtdTogIlx1MDNCQyIsIG11bHRpbWFwOiAiXHUyMkI4IiwgbXVtYXA6ICJcdTIyQjgiLCBuYWJsYTogIlx1MjIwNyIsIE5hY3V0ZTogIlx1MDE0MyIsIG5hY3V0ZTogIlx1MDE0NCIsIG5hbmc6ICJcdTIyMjBcdTIwRDIiLCBuYXA6ICJcdTIyNDkiLCBuYXBFOiAiXHUyQTcwXHUwMzM4IiwgbmFwaWQ6ICJcdTIyNEJcdTAzMzgiLCBuYXBvczogIlx1MDE0OSIsIG5hcHByb3g6ICJcdTIyNDkiLCBuYXR1cjogIlx1MjY2RSIsIG5hdHVyYWw6ICJcdTI2NkUiLCBuYXR1cmFsczogIlx1MjExNSIsIG5ic3A6ICJceEEwIiwgbmJ1bXA6ICJcdTIyNEVcdTAzMzgiLCBuYnVtcGU6ICJcdTIyNEZcdTAzMzgiLCBuY2FwOiAiXHUyQTQzIiwgTmNhcm9uOiAiXHUwMTQ3IiwgbmNhcm9uOiAiXHUwMTQ4IiwgTmNlZGlsOiAiXHUwMTQ1IiwgbmNlZGlsOiAiXHUwMTQ2IiwgbmNvbmc6ICJcdTIyNDciLCBuY29uZ2RvdDogIlx1MkE2RFx1MDMzOCIsIG5jdXA6ICJcdTJBNDIiLCBOY3k6ICJcdTA0MUQiLCBuY3k6ICJcdTA0M0QiLCBuZGFzaDogIlx1MjAxMyIsIG5lOiAiXHUyMjYwIiwgbmVhcmhrOiAiXHUyOTI0IiwgbmVBcnI6ICJcdTIxRDciLCBuZWFycjogIlx1MjE5NyIsIG5lYXJyb3c6ICJcdTIxOTciLCBuZWRvdDogIlx1MjI1MFx1MDMzOCIsIE5lZ2F0aXZlTWVkaXVtU3BhY2U6ICJcdTIwMEIiLCBOZWdhdGl2ZVRoaWNrU3BhY2U6ICJcdTIwMEIiLCBOZWdhdGl2ZVRoaW5TcGFjZTogIlx1MjAwQiIsIE5lZ2F0aXZlVmVyeVRoaW5TcGFjZTogIlx1MjAwQiIsIG5lcXVpdjogIlx1MjI2MiIsIG5lc2VhcjogIlx1MjkyOCIsIG5lc2ltOiAiXHUyMjQyXHUwMzM4IiwgTmVzdGVkR3JlYXRlckdyZWF0ZXI6ICJcdTIyNkIiLCBOZXN0ZWRMZXNzTGVzczogIlx1MjI2QSIsIE5ld0xpbmU6ICJcbiIsIG5leGlzdDogIlx1MjIwNCIsIG5leGlzdHM6ICJcdTIyMDQiLCBOZnI6ICJcdXsxRDUxMX0iLCBuZnI6ICJcdXsxRDUyQn0iLCBuZ0U6ICJcdTIyNjdcdTAzMzgiLCBuZ2U6ICJcdTIyNzEiLCBuZ2VxOiAiXHUyMjcxIiwgbmdlcXE6ICJcdTIyNjdcdTAzMzgiLCBuZ2Vxc2xhbnQ6ICJcdTJBN0VcdTAzMzgiLCBuZ2VzOiAiXHUyQTdFXHUwMzM4IiwgbkdnOiAiXHUyMkQ5XHUwMzM4IiwgbmdzaW06ICJcdTIyNzUiLCBuR3Q6ICJcdTIyNkJcdTIwRDIiLCBuZ3Q6ICJcdTIyNkYiLCBuZ3RyOiAiXHUyMjZGIiwgbkd0djogIlx1MjI2Qlx1MDMzOCIsIG5oQXJyOiAiXHUyMUNFIiwgbmhhcnI6ICJcdTIxQUUiLCBuaHBhcjogIlx1MkFGMiIsIG5pOiAiXHUyMjBCIiwgbmlzOiAiXHUyMkZDIiwgbmlzZDogIlx1MjJGQSIsIG5pdjogIlx1MjIwQiIsIE5KY3k6ICJcdTA0MEEiLCBuamN5OiAiXHUwNDVBIiwgbmxBcnI6ICJcdTIxQ0QiLCBubGFycjogIlx1MjE5QSIsIG5sZHI6ICJcdTIwMjUiLCBubEU6ICJcdTIyNjZcdTAzMzgiLCBubGU6ICJcdTIyNzAiLCBuTGVmdGFycm93OiAiXHUyMUNEIiwgbmxlZnRhcnJvdzogIlx1MjE5QSIsIG5MZWZ0cmlnaHRhcnJvdzogIlx1MjFDRSIsIG5sZWZ0cmlnaHRhcnJvdzogIlx1MjFBRSIsIG5sZXE6ICJcdTIyNzAiLCBubGVxcTogIlx1MjI2Nlx1MDMzOCIsIG5sZXFzbGFudDogIlx1MkE3RFx1MDMzOCIsIG5sZXM6ICJcdTJBN0RcdTAzMzgiLCBubGVzczogIlx1MjI2RSIsIG5MbDogIlx1MjJEOFx1MDMzOCIsIG5sc2ltOiAiXHUyMjc0Iiwgbkx0OiAiXHUyMjZBXHUyMEQyIiwgbmx0OiAiXHUyMjZFIiwgbmx0cmk6ICJcdTIyRUEiLCBubHRyaWU6ICJcdTIyRUMiLCBuTHR2OiAiXHUyMjZBXHUwMzM4Iiwgbm1pZDogIlx1MjIyNCIsIE5vQnJlYWs6ICJcdTIwNjAiLCBOb25CcmVha2luZ1NwYWNlOiAiXHhBMCIsIE5vcGY6ICJcdTIxMTUiLCBub3BmOiAiXHV7MUQ1NUZ9IiwgTm90OiAiXHUyQUVDIiwgbm90OiAiXHhBQyIsIE5vdENvbmdydWVudDogIlx1MjI2MiIsIE5vdEN1cENhcDogIlx1MjI2RCIsIE5vdERvdWJsZVZlcnRpY2FsQmFyOiAiXHUyMjI2IiwgTm90RWxlbWVudDogIlx1MjIwOSIsIE5vdEVxdWFsOiAiXHUyMjYwIiwgTm90RXF1YWxUaWxkZTogIlx1MjI0Mlx1MDMzOCIsIE5vdEV4aXN0czogIlx1MjIwNCIsIE5vdEdyZWF0ZXI6ICJcdTIyNkYiLCBOb3RHcmVhdGVyRXF1YWw6ICJcdTIyNzEiLCBOb3RHcmVhdGVyRnVsbEVxdWFsOiAiXHUyMjY3XHUwMzM4IiwgTm90R3JlYXRlckdyZWF0ZXI6ICJcdTIyNkJcdTAzMzgiLCBOb3RHcmVhdGVyTGVzczogIlx1MjI3OSIsIE5vdEdyZWF0ZXJTbGFudEVxdWFsOiAiXHUyQTdFXHUwMzM4IiwgTm90R3JlYXRlclRpbGRlOiAiXHUyMjc1IiwgTm90SHVtcERvd25IdW1wOiAiXHUyMjRFXHUwMzM4IiwgTm90SHVtcEVxdWFsOiAiXHUyMjRGXHUwMzM4Iiwgbm90aW46ICJcdTIyMDkiLCBub3RpbmRvdDogIlx1MjJGNVx1MDMzOCIsIG5vdGluRTogIlx1MjJGOVx1MDMzOCIsIG5vdGludmE6ICJcdTIyMDkiLCBub3RpbnZiOiAiXHUyMkY3Iiwgbm90aW52YzogIlx1MjJGNiIsIE5vdExlZnRUcmlhbmdsZTogIlx1MjJFQSIsIE5vdExlZnRUcmlhbmdsZUJhcjogIlx1MjlDRlx1MDMzOCIsIE5vdExlZnRUcmlhbmdsZUVxdWFsOiAiXHUyMkVDIiwgTm90TGVzczogIlx1MjI2RSIsIE5vdExlc3NFcXVhbDogIlx1MjI3MCIsIE5vdExlc3NHcmVhdGVyOiAiXHUyMjc4IiwgTm90TGVzc0xlc3M6ICJcdTIyNkFcdTAzMzgiLCBOb3RMZXNzU2xhbnRFcXVhbDogIlx1MkE3RFx1MDMzOCIsIE5vdExlc3NUaWxkZTogIlx1MjI3NCIsIE5vdE5lc3RlZEdyZWF0ZXJHcmVhdGVyOiAiXHUyQUEyXHUwMzM4IiwgTm90TmVzdGVkTGVzc0xlc3M6ICJcdTJBQTFcdTAzMzgiLCBub3RuaTogIlx1MjIwQyIsIG5vdG5pdmE6ICJcdTIyMEMiLCBub3RuaXZiOiAiXHUyMkZFIiwgbm90bml2YzogIlx1MjJGRCIsIE5vdFByZWNlZGVzOiAiXHUyMjgwIiwgTm90UHJlY2VkZXNFcXVhbDogIlx1MkFBRlx1MDMzOCIsIE5vdFByZWNlZGVzU2xhbnRFcXVhbDogIlx1MjJFMCIsIE5vdFJldmVyc2VFbGVtZW50OiAiXHUyMjBDIiwgTm90UmlnaHRUcmlhbmdsZTogIlx1MjJFQiIsIE5vdFJpZ2h0VHJpYW5nbGVCYXI6ICJcdTI5RDBcdTAzMzgiLCBOb3RSaWdodFRyaWFuZ2xlRXF1YWw6ICJcdTIyRUQiLCBOb3RTcXVhcmVTdWJzZXQ6ICJcdTIyOEZcdTAzMzgiLCBOb3RTcXVhcmVTdWJzZXRFcXVhbDogIlx1MjJFMiIsIE5vdFNxdWFyZVN1cGVyc2V0OiAiXHUyMjkwXHUwMzM4IiwgTm90U3F1YXJlU3VwZXJzZXRFcXVhbDogIlx1MjJFMyIsIE5vdFN1YnNldDogIlx1MjI4Mlx1MjBEMiIsIE5vdFN1YnNldEVxdWFsOiAiXHUyMjg4IiwgTm90U3VjY2VlZHM6ICJcdTIyODEiLCBOb3RTdWNjZWVkc0VxdWFsOiAiXHUyQUIwXHUwMzM4IiwgTm90U3VjY2VlZHNTbGFudEVxdWFsOiAiXHUyMkUxIiwgTm90U3VjY2VlZHNUaWxkZTogIlx1MjI3Rlx1MDMzOCIsIE5vdFN1cGVyc2V0OiAiXHUyMjgzXHUyMEQyIiwgTm90U3VwZXJzZXRFcXVhbDogIlx1MjI4OSIsIE5vdFRpbGRlOiAiXHUyMjQxIiwgTm90VGlsZGVFcXVhbDogIlx1MjI0NCIsIE5vdFRpbGRlRnVsbEVxdWFsOiAiXHUyMjQ3IiwgTm90VGlsZGVUaWxkZTogIlx1MjI0OSIsIE5vdFZlcnRpY2FsQmFyOiAiXHUyMjI0IiwgbnBhcjogIlx1MjIyNiIsIG5wYXJhbGxlbDogIlx1MjIyNiIsIG5wYXJzbDogIlx1MkFGRFx1MjBFNSIsIG5wYXJ0OiAiXHUyMjAyXHUwMzM4IiwgbnBvbGludDogIlx1MkExNCIsIG5wcjogIlx1MjI4MCIsIG5wcmN1ZTogIlx1MjJFMCIsIG5wcmU6ICJcdTJBQUZcdTAzMzgiLCBucHJlYzogIlx1MjI4MCIsIG5wcmVjZXE6ICJcdTJBQUZcdTAzMzgiLCBuckFycjogIlx1MjFDRiIsIG5yYXJyOiAiXHUyMTlCIiwgbnJhcnJjOiAiXHUyOTMzXHUwMzM4IiwgbnJhcnJ3OiAiXHUyMTlEXHUwMzM4IiwgblJpZ2h0YXJyb3c6ICJcdTIxQ0YiLCBucmlnaHRhcnJvdzogIlx1MjE5QiIsIG5ydHJpOiAiXHUyMkVCIiwgbnJ0cmllOiAiXHUyMkVEIiwgbnNjOiAiXHUyMjgxIiwgbnNjY3VlOiAiXHUyMkUxIiwgbnNjZTogIlx1MkFCMFx1MDMzOCIsIE5zY3I6ICJcdXsxRDRBOX0iLCBuc2NyOiAiXHV7MUQ0QzN9IiwgbnNob3J0bWlkOiAiXHUyMjI0IiwgbnNob3J0cGFyYWxsZWw6ICJcdTIyMjYiLCBuc2ltOiAiXHUyMjQxIiwgbnNpbWU6ICJcdTIyNDQiLCBuc2ltZXE6ICJcdTIyNDQiLCBuc21pZDogIlx1MjIyNCIsIG5zcGFyOiAiXHUyMjI2IiwgbnNxc3ViZTogIlx1MjJFMiIsIG5zcXN1cGU6ICJcdTIyRTMiLCBuc3ViOiAiXHUyMjg0IiwgbnN1YkU6ICJcdTJBQzVcdTAzMzgiLCBuc3ViZTogIlx1MjI4OCIsIG5zdWJzZXQ6ICJcdTIyODJcdTIwRDIiLCBuc3Vic2V0ZXE6ICJcdTIyODgiLCBuc3Vic2V0ZXFxOiAiXHUyQUM1XHUwMzM4IiwgbnN1Y2M6ICJcdTIyODEiLCBuc3VjY2VxOiAiXHUyQUIwXHUwMzM4IiwgbnN1cDogIlx1MjI4NSIsIG5zdXBFOiAiXHUyQUM2XHUwMzM4IiwgbnN1cGU6ICJcdTIyODkiLCBuc3Vwc2V0OiAiXHUyMjgzXHUyMEQyIiwgbnN1cHNldGVxOiAiXHUyMjg5IiwgbnN1cHNldGVxcTogIlx1MkFDNlx1MDMzOCIsIG50Z2w6ICJcdTIyNzkiLCBOdGlsZGU6ICJceEQxIiwgbnRpbGRlOiAiXHhGMSIsIG50bGc6ICJcdTIyNzgiLCBudHJpYW5nbGVsZWZ0OiAiXHUyMkVBIiwgbnRyaWFuZ2xlbGVmdGVxOiAiXHUyMkVDIiwgbnRyaWFuZ2xlcmlnaHQ6ICJcdTIyRUIiLCBudHJpYW5nbGVyaWdodGVxOiAiXHUyMkVEIiwgTnU6ICJcdTAzOUQiLCBudTogIlx1MDNCRCIsIG51bTogIiMiLCBudW1lcm86ICJcdTIxMTYiLCBudW1zcDogIlx1MjAwNyIsIG52YXA6ICJcdTIyNERcdTIwRDIiLCBuVkRhc2g6ICJcdTIyQUYiLCBuVmRhc2g6ICJcdTIyQUUiLCBudkRhc2g6ICJcdTIyQUQiLCBudmRhc2g6ICJcdTIyQUMiLCBudmdlOiAiXHUyMjY1XHUyMEQyIiwgbnZndDogIj5cdTIwRDIiLCBudkhhcnI6ICJcdTI5MDQiLCBudmluZmluOiAiXHUyOURFIiwgbnZsQXJyOiAiXHUyOTAyIiwgbnZsZTogIlx1MjI2NFx1MjBEMiIsIG52bHQ6ICI8XHUyMEQyIiwgbnZsdHJpZTogIlx1MjJCNFx1MjBEMiIsIG52ckFycjogIlx1MjkwMyIsIG52cnRyaWU6ICJcdTIyQjVcdTIwRDIiLCBudnNpbTogIlx1MjIzQ1x1MjBEMiIsIG53YXJoazogIlx1MjkyMyIsIG53QXJyOiAiXHUyMUQ2IiwgbndhcnI6ICJcdTIxOTYiLCBud2Fycm93OiAiXHUyMTk2IiwgbnduZWFyOiAiXHUyOTI3IiwgT2FjdXRlOiAiXHhEMyIsIG9hY3V0ZTogIlx4RjMiLCBvYXN0OiAiXHUyMjlCIiwgb2NpcjogIlx1MjI5QSIsIE9jaXJjOiAiXHhENCIsIG9jaXJjOiAiXHhGNCIsIE9jeTogIlx1MDQxRSIsIG9jeTogIlx1MDQzRSIsIG9kYXNoOiAiXHUyMjlEIiwgT2RibGFjOiAiXHUwMTUwIiwgb2RibGFjOiAiXHUwMTUxIiwgb2RpdjogIlx1MkEzOCIsIG9kb3Q6ICJcdTIyOTkiLCBvZHNvbGQ6ICJcdTI5QkMiLCBPRWxpZzogIlx1MDE1MiIsIG9lbGlnOiAiXHUwMTUzIiwgb2ZjaXI6ICJcdTI5QkYiLCBPZnI6ICJcdXsxRDUxMn0iLCBvZnI6ICJcdXsxRDUyQ30iLCBvZ29uOiAiXHUwMkRCIiwgT2dyYXZlOiAiXHhEMiIsIG9ncmF2ZTogIlx4RjIiLCBvZ3Q6ICJcdTI5QzEiLCBvaGJhcjogIlx1MjlCNSIsIG9obTogIlx1MDNBOSIsIG9pbnQ6ICJcdTIyMkUiLCBvbGFycjogIlx1MjFCQSIsIG9sY2lyOiAiXHUyOUJFIiwgb2xjcm9zczogIlx1MjlCQiIsIG9saW5lOiAiXHUyMDNFIiwgb2x0OiAiXHUyOUMwIiwgT21hY3I6ICJcdTAxNEMiLCBvbWFjcjogIlx1MDE0RCIsIE9tZWdhOiAiXHUwM0E5Iiwgb21lZ2E6ICJcdTAzQzkiLCBPbWljcm9uOiAiXHUwMzlGIiwgb21pY3JvbjogIlx1MDNCRiIsIG9taWQ6ICJcdTI5QjYiLCBvbWludXM6ICJcdTIyOTYiLCBPb3BmOiAiXHV7MUQ1NDZ9Iiwgb29wZjogIlx1ezFENTYwfSIsIG9wYXI6ICJcdTI5QjciLCBPcGVuQ3VybHlEb3VibGVRdW90ZTogIlx1MjAxQyIsIE9wZW5DdXJseVF1b3RlOiAiXHUyMDE4Iiwgb3BlcnA6ICJcdTI5QjkiLCBvcGx1czogIlx1MjI5NSIsIE9yOiAiXHUyQTU0Iiwgb3I6ICJcdTIyMjgiLCBvcmFycjogIlx1MjFCQiIsIG9yZDogIlx1MkE1RCIsIG9yZGVyOiAiXHUyMTM0Iiwgb3JkZXJvZjogIlx1MjEzNCIsIG9yZGY6ICJceEFBIiwgb3JkbTogIlx4QkEiLCBvcmlnb2Y6ICJcdTIyQjYiLCBvcm9yOiAiXHUyQTU2Iiwgb3JzbG9wZTogIlx1MkE1NyIsIG9ydjogIlx1MkE1QiIsIG9TOiAiXHUyNEM4IiwgT3NjcjogIlx1ezFENEFBfSIsIG9zY3I6ICJcdTIxMzQiLCBPc2xhc2g6ICJceEQ4Iiwgb3NsYXNoOiAiXHhGOCIsIG9zb2w6ICJcdTIyOTgiLCBPdGlsZGU6ICJceEQ1Iiwgb3RpbGRlOiAiXHhGNSIsIE90aW1lczogIlx1MkEzNyIsIG90aW1lczogIlx1MjI5NyIsIG90aW1lc2FzOiAiXHUyQTM2IiwgT3VtbDogIlx4RDYiLCBvdW1sOiAiXHhGNiIsIG92YmFyOiAiXHUyMzNEIiwgT3ZlckJhcjogIlx1MjAzRSIsIE92ZXJCcmFjZTogIlx1MjNERSIsIE92ZXJCcmFja2V0OiAiXHUyM0I0IiwgT3ZlclBhcmVudGhlc2lzOiAiXHUyM0RDIiwgcGFyOiAiXHUyMjI1IiwgcGFyYTogIlx4QjYiLCBwYXJhbGxlbDogIlx1MjIyNSIsIHBhcnNpbTogIlx1MkFGMyIsIHBhcnNsOiAiXHUyQUZEIiwgcGFydDogIlx1MjIwMiIsIFBhcnRpYWxEOiAiXHUyMjAyIiwgUGN5OiAiXHUwNDFGIiwgcGN5OiAiXHUwNDNGIiwgcGVyY250OiAiJSIsIHBlcmlvZDogIi4iLCBwZXJtaWw6ICJcdTIwMzAiLCBwZXJwOiAiXHUyMkE1IiwgcGVydGVuazogIlx1MjAzMSIsIFBmcjogIlx1ezFENTEzfSIsIHBmcjogIlx1ezFENTJEfSIsIFBoaTogIlx1MDNBNiIsIHBoaTogIlx1MDNDNiIsIHBoaXY6ICJcdTAzRDUiLCBwaG1tYXQ6ICJcdTIxMzMiLCBwaG9uZTogIlx1MjYwRSIsIFBpOiAiXHUwM0EwIiwgcGk6ICJcdTAzQzAiLCBwaXRjaGZvcms6ICJcdTIyRDQiLCBwaXY6ICJcdTAzRDYiLCBwbGFuY2s6ICJcdTIxMEYiLCBwbGFuY2toOiAiXHUyMTBFIiwgcGxhbmt2OiAiXHUyMTBGIiwgcGx1czogIisiLCBwbHVzYWNpcjogIlx1MkEyMyIsIHBsdXNiOiAiXHUyMjlFIiwgcGx1c2NpcjogIlx1MkEyMiIsIHBsdXNkbzogIlx1MjIxNCIsIHBsdXNkdTogIlx1MkEyNSIsIHBsdXNlOiAiXHUyQTcyIiwgUGx1c01pbnVzOiAiXHhCMSIsIHBsdXNtbjogIlx4QjEiLCBwbHVzc2ltOiAiXHUyQTI2IiwgcGx1c3R3bzogIlx1MkEyNyIsIHBtOiAiXHhCMSIsIFBvaW5jYXJlcGxhbmU6ICJcdTIxMEMiLCBwb2ludGludDogIlx1MkExNSIsIFBvcGY6ICJcdTIxMTkiLCBwb3BmOiAiXHV7MUQ1NjF9IiwgcG91bmQ6ICJceEEzIiwgUHI6ICJcdTJBQkIiLCBwcjogIlx1MjI3QSIsIHByYXA6ICJcdTJBQjciLCBwcmN1ZTogIlx1MjI3QyIsIHByRTogIlx1MkFCMyIsIHByZTogIlx1MkFBRiIsIHByZWM6ICJcdTIyN0EiLCBwcmVjYXBwcm94OiAiXHUyQUI3IiwgcHJlY2N1cmx5ZXE6ICJcdTIyN0MiLCBQcmVjZWRlczogIlx1MjI3QSIsIFByZWNlZGVzRXF1YWw6ICJcdTJBQUYiLCBQcmVjZWRlc1NsYW50RXF1YWw6ICJcdTIyN0MiLCBQcmVjZWRlc1RpbGRlOiAiXHUyMjdFIiwgcHJlY2VxOiAiXHUyQUFGIiwgcHJlY25hcHByb3g6ICJcdTJBQjkiLCBwcmVjbmVxcTogIlx1MkFCNSIsIHByZWNuc2ltOiAiXHUyMkU4IiwgcHJlY3NpbTogIlx1MjI3RSIsIFByaW1lOiAiXHUyMDMzIiwgcHJpbWU6ICJcdTIwMzIiLCBwcmltZXM6ICJcdTIxMTkiLCBwcm5hcDogIlx1MkFCOSIsIHBybkU6ICJcdTJBQjUiLCBwcm5zaW06ICJcdTIyRTgiLCBwcm9kOiAiXHUyMjBGIiwgUHJvZHVjdDogIlx1MjIwRiIsIHByb2ZhbGFyOiAiXHUyMzJFIiwgcHJvZmxpbmU6ICJcdTIzMTIiLCBwcm9mc3VyZjogIlx1MjMxMyIsIHByb3A6ICJcdTIyMUQiLCBQcm9wb3J0aW9uOiAiXHUyMjM3IiwgUHJvcG9ydGlvbmFsOiAiXHUyMjFEIiwgcHJvcHRvOiAiXHUyMjFEIiwgcHJzaW06ICJcdTIyN0UiLCBwcnVyZWw6ICJcdTIyQjAiLCBQc2NyOiAiXHV7MUQ0QUJ9IiwgcHNjcjogIlx1ezFENEM1fSIsIFBzaTogIlx1MDNBOCIsIHBzaTogIlx1MDNDOCIsIHB1bmNzcDogIlx1MjAwOCIsIFFmcjogIlx1ezFENTE0fSIsIHFmcjogIlx1ezFENTJFfSIsIHFpbnQ6ICJcdTJBMEMiLCBRb3BmOiAiXHUyMTFBIiwgcW9wZjogIlx1ezFENTYyfSIsIHFwcmltZTogIlx1MjA1NyIsIFFzY3I6ICJcdXsxRDRBQ30iLCBxc2NyOiAiXHV7MUQ0QzZ9IiwgcXVhdGVybmlvbnM6ICJcdTIxMEQiLCBxdWF0aW50OiAiXHUyQTE2IiwgcXVlc3Q6ICI/IiwgcXVlc3RlcTogIlx1MjI1RiIsIFFVT1Q6ICciJywgcXVvdDogJyInLCByQWFycjogIlx1MjFEQiIsIHJhY2U6ICJcdTIyM0RcdTAzMzEiLCBSYWN1dGU6ICJcdTAxNTQiLCByYWN1dGU6ICJcdTAxNTUiLCByYWRpYzogIlx1MjIxQSIsIHJhZW1wdHl2OiAiXHUyOUIzIiwgUmFuZzogIlx1MjdFQiIsIHJhbmc6ICJcdTI3RTkiLCByYW5nZDogIlx1Mjk5MiIsIHJhbmdlOiAiXHUyOUE1IiwgcmFuZ2xlOiAiXHUyN0U5IiwgcmFxdW86ICJceEJCIiwgUmFycjogIlx1MjFBMCIsIHJBcnI6ICJcdTIxRDIiLCByYXJyOiAiXHUyMTkyIiwgcmFycmFwOiAiXHUyOTc1IiwgcmFycmI6ICJcdTIxRTUiLCByYXJyYmZzOiAiXHUyOTIwIiwgcmFycmM6ICJcdTI5MzMiLCByYXJyZnM6ICJcdTI5MUUiLCByYXJyaGs6ICJcdTIxQUEiLCByYXJybHA6ICJcdTIxQUMiLCByYXJycGw6ICJcdTI5NDUiLCByYXJyc2ltOiAiXHUyOTc0IiwgUmFycnRsOiAiXHUyOTE2IiwgcmFycnRsOiAiXHUyMUEzIiwgcmFycnc6ICJcdTIxOUQiLCByQXRhaWw6ICJcdTI5MUMiLCByYXRhaWw6ICJcdTI5MUEiLCByYXRpbzogIlx1MjIzNiIsIHJhdGlvbmFsczogIlx1MjExQSIsIFJCYXJyOiAiXHUyOTEwIiwgckJhcnI6ICJcdTI5MEYiLCByYmFycjogIlx1MjkwRCIsIHJiYnJrOiAiXHUyNzczIiwgcmJyYWNlOiAifSIsIHJicmFjazogIl0iLCByYnJrZTogIlx1Mjk4QyIsIHJicmtzbGQ6ICJcdTI5OEUiLCByYnJrc2x1OiAiXHUyOTkwIiwgUmNhcm9uOiAiXHUwMTU4IiwgcmNhcm9uOiAiXHUwMTU5IiwgUmNlZGlsOiAiXHUwMTU2IiwgcmNlZGlsOiAiXHUwMTU3IiwgcmNlaWw6ICJcdTIzMDkiLCByY3ViOiAifSIsIFJjeTogIlx1MDQyMCIsIHJjeTogIlx1MDQ0MCIsIHJkY2E6ICJcdTI5MzciLCByZGxkaGFyOiAiXHUyOTY5IiwgcmRxdW86ICJcdTIwMUQiLCByZHF1b3I6ICJcdTIwMUQiLCByZHNoOiAiXHUyMUIzIiwgUmU6ICJcdTIxMUMiLCByZWFsOiAiXHUyMTFDIiwgcmVhbGluZTogIlx1MjExQiIsIHJlYWxwYXJ0OiAiXHUyMTFDIiwgcmVhbHM6ICJcdTIxMUQiLCByZWN0OiAiXHUyNUFEIiwgUkVHOiAiXHhBRSIsIHJlZzogIlx4QUUiLCBSZXZlcnNlRWxlbWVudDogIlx1MjIwQiIsIFJldmVyc2VFcXVpbGlicml1bTogIlx1MjFDQiIsIFJldmVyc2VVcEVxdWlsaWJyaXVtOiAiXHUyOTZGIiwgcmZpc2h0OiAiXHUyOTdEIiwgcmZsb29yOiAiXHUyMzBCIiwgUmZyOiAiXHUyMTFDIiwgcmZyOiAiXHV7MUQ1MkZ9IiwgckhhcjogIlx1Mjk2NCIsIHJoYXJkOiAiXHUyMUMxIiwgcmhhcnU6ICJcdTIxQzAiLCByaGFydWw6ICJcdTI5NkMiLCBSaG86ICJcdTAzQTEiLCByaG86ICJcdTAzQzEiLCByaG92OiAiXHUwM0YxIiwgUmlnaHRBbmdsZUJyYWNrZXQ6ICJcdTI3RTkiLCBSaWdodEFycm93OiAiXHUyMTkyIiwgUmlnaHRhcnJvdzogIlx1MjFEMiIsIHJpZ2h0YXJyb3c6ICJcdTIxOTIiLCBSaWdodEFycm93QmFyOiAiXHUyMUU1IiwgUmlnaHRBcnJvd0xlZnRBcnJvdzogIlx1MjFDNCIsIHJpZ2h0YXJyb3d0YWlsOiAiXHUyMUEzIiwgUmlnaHRDZWlsaW5nOiAiXHUyMzA5IiwgUmlnaHREb3VibGVCcmFja2V0OiAiXHUyN0U3IiwgUmlnaHREb3duVGVlVmVjdG9yOiAiXHUyOTVEIiwgUmlnaHREb3duVmVjdG9yOiAiXHUyMUMyIiwgUmlnaHREb3duVmVjdG9yQmFyOiAiXHUyOTU1IiwgUmlnaHRGbG9vcjogIlx1MjMwQiIsIHJpZ2h0aGFycG9vbmRvd246ICJcdTIxQzEiLCByaWdodGhhcnBvb251cDogIlx1MjFDMCIsIHJpZ2h0bGVmdGFycm93czogIlx1MjFDNCIsIHJpZ2h0bGVmdGhhcnBvb25zOiAiXHUyMUNDIiwgcmlnaHRyaWdodGFycm93czogIlx1MjFDOSIsIHJpZ2h0c3F1aWdhcnJvdzogIlx1MjE5RCIsIFJpZ2h0VGVlOiAiXHUyMkEyIiwgUmlnaHRUZWVBcnJvdzogIlx1MjFBNiIsIFJpZ2h0VGVlVmVjdG9yOiAiXHUyOTVCIiwgcmlnaHR0aHJlZXRpbWVzOiAiXHUyMkNDIiwgUmlnaHRUcmlhbmdsZTogIlx1MjJCMyIsIFJpZ2h0VHJpYW5nbGVCYXI6ICJcdTI5RDAiLCBSaWdodFRyaWFuZ2xlRXF1YWw6ICJcdTIyQjUiLCBSaWdodFVwRG93blZlY3RvcjogIlx1Mjk0RiIsIFJpZ2h0VXBUZWVWZWN0b3I6ICJcdTI5NUMiLCBSaWdodFVwVmVjdG9yOiAiXHUyMUJFIiwgUmlnaHRVcFZlY3RvckJhcjogIlx1Mjk1NCIsIFJpZ2h0VmVjdG9yOiAiXHUyMUMwIiwgUmlnaHRWZWN0b3JCYXI6ICJcdTI5NTMiLCByaW5nOiAiXHUwMkRBIiwgcmlzaW5nZG90c2VxOiAiXHUyMjUzIiwgcmxhcnI6ICJcdTIxQzQiLCBybGhhcjogIlx1MjFDQyIsIHJsbTogIlx1MjAwRiIsIHJtb3VzdDogIlx1MjNCMSIsIHJtb3VzdGFjaGU6ICJcdTIzQjEiLCBybm1pZDogIlx1MkFFRSIsIHJvYW5nOiAiXHUyN0VEIiwgcm9hcnI6ICJcdTIxRkUiLCByb2JyazogIlx1MjdFNyIsIHJvcGFyOiAiXHUyOTg2IiwgUm9wZjogIlx1MjExRCIsIHJvcGY6ICJcdXsxRDU2M30iLCByb3BsdXM6ICJcdTJBMkUiLCByb3RpbWVzOiAiXHUyQTM1IiwgUm91bmRJbXBsaWVzOiAiXHUyOTcwIiwgcnBhcjogIikiLCBycGFyZ3Q6ICJcdTI5OTQiLCBycHBvbGludDogIlx1MkExMiIsIHJyYXJyOiAiXHUyMUM5IiwgUnJpZ2h0YXJyb3c6ICJcdTIxREIiLCByc2FxdW86ICJcdTIwM0EiLCBSc2NyOiAiXHUyMTFCIiwgcnNjcjogIlx1ezFENEM3fSIsIFJzaDogIlx1MjFCMSIsIHJzaDogIlx1MjFCMSIsIHJzcWI6ICJdIiwgcnNxdW86ICJcdTIwMTkiLCByc3F1b3I6ICJcdTIwMTkiLCBydGhyZWU6ICJcdTIyQ0MiLCBydGltZXM6ICJcdTIyQ0EiLCBydHJpOiAiXHUyNUI5IiwgcnRyaWU6ICJcdTIyQjUiLCBydHJpZjogIlx1MjVCOCIsIHJ0cmlsdHJpOiAiXHUyOUNFIiwgUnVsZURlbGF5ZWQ6ICJcdTI5RjQiLCBydWx1aGFyOiAiXHUyOTY4Iiwgcng6ICJcdTIxMUUiLCBTYWN1dGU6ICJcdTAxNUEiLCBzYWN1dGU6ICJcdTAxNUIiLCBzYnF1bzogIlx1MjAxQSIsIFNjOiAiXHUyQUJDIiwgc2M6ICJcdTIyN0IiLCBzY2FwOiAiXHUyQUI4IiwgU2Nhcm9uOiAiXHUwMTYwIiwgc2Nhcm9uOiAiXHUwMTYxIiwgc2NjdWU6ICJcdTIyN0QiLCBzY0U6ICJcdTJBQjQiLCBzY2U6ICJcdTJBQjAiLCBTY2VkaWw6ICJcdTAxNUUiLCBzY2VkaWw6ICJcdTAxNUYiLCBTY2lyYzogIlx1MDE1QyIsIHNjaXJjOiAiXHUwMTVEIiwgc2NuYXA6ICJcdTJBQkEiLCBzY25FOiAiXHUyQUI2Iiwgc2Nuc2ltOiAiXHUyMkU5Iiwgc2Nwb2xpbnQ6ICJcdTJBMTMiLCBzY3NpbTogIlx1MjI3RiIsIFNjeTogIlx1MDQyMSIsIHNjeTogIlx1MDQ0MSIsIHNkb3Q6ICJcdTIyQzUiLCBzZG90YjogIlx1MjJBMSIsIHNkb3RlOiAiXHUyQTY2Iiwgc2VhcmhrOiAiXHUyOTI1Iiwgc2VBcnI6ICJcdTIxRDgiLCBzZWFycjogIlx1MjE5OCIsIHNlYXJyb3c6ICJcdTIxOTgiLCBzZWN0OiAiXHhBNyIsIHNlbWk6ICI7Iiwgc2Vzd2FyOiAiXHUyOTI5Iiwgc2V0bWludXM6ICJcdTIyMTYiLCBzZXRtbjogIlx1MjIxNiIsIHNleHQ6ICJcdTI3MzYiLCBTZnI6ICJcdXsxRDUxNn0iLCBzZnI6ICJcdXsxRDUzMH0iLCBzZnJvd246ICJcdTIzMjIiLCBzaGFycDogIlx1MjY2RiIsIFNIQ0hjeTogIlx1MDQyOSIsIHNoY2hjeTogIlx1MDQ0OSIsIFNIY3k6ICJcdTA0MjgiLCBzaGN5OiAiXHUwNDQ4IiwgU2hvcnREb3duQXJyb3c6ICJcdTIxOTMiLCBTaG9ydExlZnRBcnJvdzogIlx1MjE5MCIsIHNob3J0bWlkOiAiXHUyMjIzIiwgc2hvcnRwYXJhbGxlbDogIlx1MjIyNSIsIFNob3J0UmlnaHRBcnJvdzogIlx1MjE5MiIsIFNob3J0VXBBcnJvdzogIlx1MjE5MSIsIHNoeTogIlx4QUQiLCBTaWdtYTogIlx1MDNBMyIsIHNpZ21hOiAiXHUwM0MzIiwgc2lnbWFmOiAiXHUwM0MyIiwgc2lnbWF2OiAiXHUwM0MyIiwgc2ltOiAiXHUyMjNDIiwgc2ltZG90OiAiXHUyQTZBIiwgc2ltZTogIlx1MjI0MyIsIHNpbWVxOiAiXHUyMjQzIiwgc2ltZzogIlx1MkE5RSIsIHNpbWdFOiAiXHUyQUEwIiwgc2ltbDogIlx1MkE5RCIsIHNpbWxFOiAiXHUyQTlGIiwgc2ltbmU6ICJcdTIyNDYiLCBzaW1wbHVzOiAiXHUyQTI0Iiwgc2ltcmFycjogIlx1Mjk3MiIsIHNsYXJyOiAiXHUyMTkwIiwgU21hbGxDaXJjbGU6ICJcdTIyMTgiLCBzbWFsbHNldG1pbnVzOiAiXHUyMjE2Iiwgc21hc2hwOiAiXHUyQTMzIiwgc21lcGFyc2w6ICJcdTI5RTQiLCBzbWlkOiAiXHUyMjIzIiwgc21pbGU6ICJcdTIzMjMiLCBzbXQ6ICJcdTJBQUEiLCBzbXRlOiAiXHUyQUFDIiwgc210ZXM6ICJcdTJBQUNcdUZFMDAiLCBTT0ZUY3k6ICJcdTA0MkMiLCBzb2Z0Y3k6ICJcdTA0NEMiLCBzb2w6ICIvIiwgc29sYjogIlx1MjlDNCIsIHNvbGJhcjogIlx1MjMzRiIsIFNvcGY6ICJcdXsxRDU0QX0iLCBzb3BmOiAiXHV7MUQ1NjR9Iiwgc3BhZGVzOiAiXHUyNjYwIiwgc3BhZGVzdWl0OiAiXHUyNjYwIiwgc3BhcjogIlx1MjIyNSIsIHNxY2FwOiAiXHUyMjkzIiwgc3FjYXBzOiAiXHUyMjkzXHVGRTAwIiwgc3FjdXA6ICJcdTIyOTQiLCBzcWN1cHM6ICJcdTIyOTRcdUZFMDAiLCBTcXJ0OiAiXHUyMjFBIiwgc3FzdWI6ICJcdTIyOEYiLCBzcXN1YmU6ICJcdTIyOTEiLCBzcXN1YnNldDogIlx1MjI4RiIsIHNxc3Vic2V0ZXE6ICJcdTIyOTEiLCBzcXN1cDogIlx1MjI5MCIsIHNxc3VwZTogIlx1MjI5MiIsIHNxc3Vwc2V0OiAiXHUyMjkwIiwgc3FzdXBzZXRlcTogIlx1MjI5MiIsIHNxdTogIlx1MjVBMSIsIFNxdWFyZTogIlx1MjVBMSIsIHNxdWFyZTogIlx1MjVBMSIsIFNxdWFyZUludGVyc2VjdGlvbjogIlx1MjI5MyIsIFNxdWFyZVN1YnNldDogIlx1MjI4RiIsIFNxdWFyZVN1YnNldEVxdWFsOiAiXHUyMjkxIiwgU3F1YXJlU3VwZXJzZXQ6ICJcdTIyOTAiLCBTcXVhcmVTdXBlcnNldEVxdWFsOiAiXHUyMjkyIiwgU3F1YXJlVW5pb246ICJcdTIyOTQiLCBzcXVhcmY6ICJcdTI1QUEiLCBzcXVmOiAiXHUyNUFBIiwgc3JhcnI6ICJcdTIxOTIiLCBTc2NyOiAiXHV7MUQ0QUV9Iiwgc3NjcjogIlx1ezFENEM4fSIsIHNzZXRtbjogIlx1MjIxNiIsIHNzbWlsZTogIlx1MjMyMyIsIHNzdGFyZjogIlx1MjJDNiIsIFN0YXI6ICJcdTIyQzYiLCBzdGFyOiAiXHUyNjA2Iiwgc3RhcmY6ICJcdTI2MDUiLCBzdHJhaWdodGVwc2lsb246ICJcdTAzRjUiLCBzdHJhaWdodHBoaTogIlx1MDNENSIsIHN0cm5zOiAiXHhBRiIsIFN1YjogIlx1MjJEMCIsIHN1YjogIlx1MjI4MiIsIHN1YmRvdDogIlx1MkFCRCIsIHN1YkU6ICJcdTJBQzUiLCBzdWJlOiAiXHUyMjg2Iiwgc3ViZWRvdDogIlx1MkFDMyIsIHN1Ym11bHQ6ICJcdTJBQzEiLCBzdWJuRTogIlx1MkFDQiIsIHN1Ym5lOiAiXHUyMjhBIiwgc3VicGx1czogIlx1MkFCRiIsIHN1YnJhcnI6ICJcdTI5NzkiLCBTdWJzZXQ6ICJcdTIyRDAiLCBzdWJzZXQ6ICJcdTIyODIiLCBzdWJzZXRlcTogIlx1MjI4NiIsIHN1YnNldGVxcTogIlx1MkFDNSIsIFN1YnNldEVxdWFsOiAiXHUyMjg2Iiwgc3Vic2V0bmVxOiAiXHUyMjhBIiwgc3Vic2V0bmVxcTogIlx1MkFDQiIsIHN1YnNpbTogIlx1MkFDNyIsIHN1YnN1YjogIlx1MkFENSIsIHN1YnN1cDogIlx1MkFEMyIsIHN1Y2M6ICJcdTIyN0IiLCBzdWNjYXBwcm94OiAiXHUyQUI4Iiwgc3VjY2N1cmx5ZXE6ICJcdTIyN0QiLCBTdWNjZWVkczogIlx1MjI3QiIsIFN1Y2NlZWRzRXF1YWw6ICJcdTJBQjAiLCBTdWNjZWVkc1NsYW50RXF1YWw6ICJcdTIyN0QiLCBTdWNjZWVkc1RpbGRlOiAiXHUyMjdGIiwgc3VjY2VxOiAiXHUyQUIwIiwgc3VjY25hcHByb3g6ICJcdTJBQkEiLCBzdWNjbmVxcTogIlx1MkFCNiIsIHN1Y2Nuc2ltOiAiXHUyMkU5Iiwgc3VjY3NpbTogIlx1MjI3RiIsIFN1Y2hUaGF0OiAiXHUyMjBCIiwgU3VtOiAiXHUyMjExIiwgc3VtOiAiXHUyMjExIiwgc3VuZzogIlx1MjY2QSIsIFN1cDogIlx1MjJEMSIsIHN1cDogIlx1MjI4MyIsIHN1cDE6ICJceEI5Iiwgc3VwMjogIlx4QjIiLCBzdXAzOiAiXHhCMyIsIHN1cGRvdDogIlx1MkFCRSIsIHN1cGRzdWI6ICJcdTJBRDgiLCBzdXBFOiAiXHUyQUM2Iiwgc3VwZTogIlx1MjI4NyIsIHN1cGVkb3Q6ICJcdTJBQzQiLCBTdXBlcnNldDogIlx1MjI4MyIsIFN1cGVyc2V0RXF1YWw6ICJcdTIyODciLCBzdXBoc29sOiAiXHUyN0M5Iiwgc3VwaHN1YjogIlx1MkFENyIsIHN1cGxhcnI6ICJcdTI5N0IiLCBzdXBtdWx0OiAiXHUyQUMyIiwgc3VwbkU6ICJcdTJBQ0MiLCBzdXBuZTogIlx1MjI4QiIsIHN1cHBsdXM6ICJcdTJBQzAiLCBTdXBzZXQ6ICJcdTIyRDEiLCBzdXBzZXQ6ICJcdTIyODMiLCBzdXBzZXRlcTogIlx1MjI4NyIsIHN1cHNldGVxcTogIlx1MkFDNiIsIHN1cHNldG5lcTogIlx1MjI4QiIsIHN1cHNldG5lcXE6ICJcdTJBQ0MiLCBzdXBzaW06ICJcdTJBQzgiLCBzdXBzdWI6ICJcdTJBRDQiLCBzdXBzdXA6ICJcdTJBRDYiLCBzd2FyaGs6ICJcdTI5MjYiLCBzd0FycjogIlx1MjFEOSIsIHN3YXJyOiAiXHUyMTk5Iiwgc3dhcnJvdzogIlx1MjE5OSIsIHN3bndhcjogIlx1MjkyQSIsIHN6bGlnOiAiXHhERiIsIFRhYjogIgkiLCB0YXJnZXQ6ICJcdTIzMTYiLCBUYXU6ICJcdTAzQTQiLCB0YXU6ICJcdTAzQzQiLCB0YnJrOiAiXHUyM0I0IiwgVGNhcm9uOiAiXHUwMTY0IiwgdGNhcm9uOiAiXHUwMTY1IiwgVGNlZGlsOiAiXHUwMTYyIiwgdGNlZGlsOiAiXHUwMTYzIiwgVGN5OiAiXHUwNDIyIiwgdGN5OiAiXHUwNDQyIiwgdGRvdDogIlx1MjBEQiIsIHRlbHJlYzogIlx1MjMxNSIsIFRmcjogIlx1ezFENTE3fSIsIHRmcjogIlx1ezFENTMxfSIsIHRoZXJlNDogIlx1MjIzNCIsIFRoZXJlZm9yZTogIlx1MjIzNCIsIHRoZXJlZm9yZTogIlx1MjIzNCIsIFRoZXRhOiAiXHUwMzk4IiwgdGhldGE6ICJcdTAzQjgiLCB0aGV0YXN5bTogIlx1MDNEMSIsIHRoZXRhdjogIlx1MDNEMSIsIHRoaWNrYXBwcm94OiAiXHUyMjQ4IiwgdGhpY2tzaW06ICJcdTIyM0MiLCBUaGlja1NwYWNlOiAiXHUyMDVGXHUyMDBBIiwgdGhpbnNwOiAiXHUyMDA5IiwgVGhpblNwYWNlOiAiXHUyMDA5IiwgdGhrYXA6ICJcdTIyNDgiLCB0aGtzaW06ICJcdTIyM0MiLCBUSE9STjogIlx4REUiLCB0aG9ybjogIlx4RkUiLCBUaWxkZTogIlx1MjIzQyIsIHRpbGRlOiAiXHUwMkRDIiwgVGlsZGVFcXVhbDogIlx1MjI0MyIsIFRpbGRlRnVsbEVxdWFsOiAiXHUyMjQ1IiwgVGlsZGVUaWxkZTogIlx1MjI0OCIsIHRpbWVzOiAiXHhENyIsIHRpbWVzYjogIlx1MjJBMCIsIHRpbWVzYmFyOiAiXHUyQTMxIiwgdGltZXNkOiAiXHUyQTMwIiwgdGludDogIlx1MjIyRCIsIHRvZWE6ICJcdTI5MjgiLCB0b3A6ICJcdTIyQTQiLCB0b3Bib3Q6ICJcdTIzMzYiLCB0b3BjaXI6ICJcdTJBRjEiLCBUb3BmOiAiXHV7MUQ1NEJ9IiwgdG9wZjogIlx1ezFENTY1fSIsIHRvcGZvcms6ICJcdTJBREEiLCB0b3NhOiAiXHUyOTI5IiwgdHByaW1lOiAiXHUyMDM0IiwgVFJBREU6ICJcdTIxMjIiLCB0cmFkZTogIlx1MjEyMiIsIHRyaWFuZ2xlOiAiXHUyNUI1IiwgdHJpYW5nbGVkb3duOiAiXHUyNUJGIiwgdHJpYW5nbGVsZWZ0OiAiXHUyNUMzIiwgdHJpYW5nbGVsZWZ0ZXE6ICJcdTIyQjQiLCB0cmlhbmdsZXE6ICJcdTIyNUMiLCB0cmlhbmdsZXJpZ2h0OiAiXHUyNUI5IiwgdHJpYW5nbGVyaWdodGVxOiAiXHUyMkI1IiwgdHJpZG90OiAiXHUyNUVDIiwgdHJpZTogIlx1MjI1QyIsIHRyaW1pbnVzOiAiXHUyQTNBIiwgVHJpcGxlRG90OiAiXHUyMERCIiwgdHJpcGx1czogIlx1MkEzOSIsIHRyaXNiOiAiXHUyOUNEIiwgdHJpdGltZTogIlx1MkEzQiIsIHRycGV6aXVtOiAiXHUyM0UyIiwgVHNjcjogIlx1ezFENEFGfSIsIHRzY3I6ICJcdXsxRDRDOX0iLCBUU2N5OiAiXHUwNDI2IiwgdHNjeTogIlx1MDQ0NiIsIFRTSGN5OiAiXHUwNDBCIiwgdHNoY3k6ICJcdTA0NUIiLCBUc3Ryb2s6ICJcdTAxNjYiLCB0c3Ryb2s6ICJcdTAxNjciLCB0d2l4dDogIlx1MjI2QyIsIHR3b2hlYWRsZWZ0YXJyb3c6ICJcdTIxOUUiLCB0d29oZWFkcmlnaHRhcnJvdzogIlx1MjFBMCIsIFVhY3V0ZTogIlx4REEiLCB1YWN1dGU6ICJceEZBIiwgVWFycjogIlx1MjE5RiIsIHVBcnI6ICJcdTIxRDEiLCB1YXJyOiAiXHUyMTkxIiwgVWFycm9jaXI6ICJcdTI5NDkiLCBVYnJjeTogIlx1MDQwRSIsIHVicmN5OiAiXHUwNDVFIiwgVWJyZXZlOiAiXHUwMTZDIiwgdWJyZXZlOiAiXHUwMTZEIiwgVWNpcmM6ICJceERCIiwgdWNpcmM6ICJceEZCIiwgVWN5OiAiXHUwNDIzIiwgdWN5OiAiXHUwNDQzIiwgdWRhcnI6ICJcdTIxQzUiLCBVZGJsYWM6ICJcdTAxNzAiLCB1ZGJsYWM6ICJcdTAxNzEiLCB1ZGhhcjogIlx1Mjk2RSIsIHVmaXNodDogIlx1Mjk3RSIsIFVmcjogIlx1ezFENTE4fSIsIHVmcjogIlx1ezFENTMyfSIsIFVncmF2ZTogIlx4RDkiLCB1Z3JhdmU6ICJceEY5IiwgdUhhcjogIlx1Mjk2MyIsIHVoYXJsOiAiXHUyMUJGIiwgdWhhcnI6ICJcdTIxQkUiLCB1aGJsazogIlx1MjU4MCIsIHVsY29ybjogIlx1MjMxQyIsIHVsY29ybmVyOiAiXHUyMzFDIiwgdWxjcm9wOiAiXHUyMzBGIiwgdWx0cmk6ICJcdTI1RjgiLCBVbWFjcjogIlx1MDE2QSIsIHVtYWNyOiAiXHUwMTZCIiwgdW1sOiAiXHhBOCIsIFVuZGVyQmFyOiAiXyIsIFVuZGVyQnJhY2U6ICJcdTIzREYiLCBVbmRlckJyYWNrZXQ6ICJcdTIzQjUiLCBVbmRlclBhcmVudGhlc2lzOiAiXHUyM0REIiwgVW5pb246ICJcdTIyQzMiLCBVbmlvblBsdXM6ICJcdTIyOEUiLCBVb2dvbjogIlx1MDE3MiIsIHVvZ29uOiAiXHUwMTczIiwgVW9wZjogIlx1ezFENTRDfSIsIHVvcGY6ICJcdXsxRDU2Nn0iLCBVcEFycm93OiAiXHUyMTkxIiwgVXBhcnJvdzogIlx1MjFEMSIsIHVwYXJyb3c6ICJcdTIxOTEiLCBVcEFycm93QmFyOiAiXHUyOTEyIiwgVXBBcnJvd0Rvd25BcnJvdzogIlx1MjFDNSIsIFVwRG93bkFycm93OiAiXHUyMTk1IiwgVXBkb3duYXJyb3c6ICJcdTIxRDUiLCB1cGRvd25hcnJvdzogIlx1MjE5NSIsIFVwRXF1aWxpYnJpdW06ICJcdTI5NkUiLCB1cGhhcnBvb25sZWZ0OiAiXHUyMUJGIiwgdXBoYXJwb29ucmlnaHQ6ICJcdTIxQkUiLCB1cGx1czogIlx1MjI4RSIsIFVwcGVyTGVmdEFycm93OiAiXHUyMTk2IiwgVXBwZXJSaWdodEFycm93OiAiXHUyMTk3IiwgVXBzaTogIlx1MDNEMiIsIHVwc2k6ICJcdTAzQzUiLCB1cHNpaDogIlx1MDNEMiIsIFVwc2lsb246ICJcdTAzQTUiLCB1cHNpbG9uOiAiXHUwM0M1IiwgVXBUZWU6ICJcdTIyQTUiLCBVcFRlZUFycm93OiAiXHUyMUE1IiwgdXB1cGFycm93czogIlx1MjFDOCIsIHVyY29ybjogIlx1MjMxRCIsIHVyY29ybmVyOiAiXHUyMzFEIiwgdXJjcm9wOiAiXHUyMzBFIiwgVXJpbmc6ICJcdTAxNkUiLCB1cmluZzogIlx1MDE2RiIsIHVydHJpOiAiXHUyNUY5IiwgVXNjcjogIlx1ezFENEIwfSIsIHVzY3I6ICJcdXsxRDRDQX0iLCB1dGRvdDogIlx1MjJGMCIsIFV0aWxkZTogIlx1MDE2OCIsIHV0aWxkZTogIlx1MDE2OSIsIHV0cmk6ICJcdTI1QjUiLCB1dHJpZjogIlx1MjVCNCIsIHV1YXJyOiAiXHUyMUM4IiwgVXVtbDogIlx4REMiLCB1dW1sOiAiXHhGQyIsIHV3YW5nbGU6ICJcdTI5QTciLCB2YW5ncnQ6ICJcdTI5OUMiLCB2YXJlcHNpbG9uOiAiXHUwM0Y1IiwgdmFya2FwcGE6ICJcdTAzRjAiLCB2YXJub3RoaW5nOiAiXHUyMjA1IiwgdmFycGhpOiAiXHUwM0Q1IiwgdmFycGk6ICJcdTAzRDYiLCB2YXJwcm9wdG86ICJcdTIyMUQiLCB2QXJyOiAiXHUyMUQ1IiwgdmFycjogIlx1MjE5NSIsIHZhcnJobzogIlx1MDNGMSIsIHZhcnNpZ21hOiAiXHUwM0MyIiwgdmFyc3Vic2V0bmVxOiAiXHUyMjhBXHVGRTAwIiwgdmFyc3Vic2V0bmVxcTogIlx1MkFDQlx1RkUwMCIsIHZhcnN1cHNldG5lcTogIlx1MjI4Qlx1RkUwMCIsIHZhcnN1cHNldG5lcXE6ICJcdTJBQ0NcdUZFMDAiLCB2YXJ0aGV0YTogIlx1MDNEMSIsIHZhcnRyaWFuZ2xlbGVmdDogIlx1MjJCMiIsIHZhcnRyaWFuZ2xlcmlnaHQ6ICJcdTIyQjMiLCBWYmFyOiAiXHUyQUVCIiwgdkJhcjogIlx1MkFFOCIsIHZCYXJ2OiAiXHUyQUU5IiwgVmN5OiAiXHUwNDEyIiwgdmN5OiAiXHUwNDMyIiwgVkRhc2g6ICJcdTIyQUIiLCBWZGFzaDogIlx1MjJBOSIsIHZEYXNoOiAiXHUyMkE4IiwgdmRhc2g6ICJcdTIyQTIiLCBWZGFzaGw6ICJcdTJBRTYiLCBWZWU6ICJcdTIyQzEiLCB2ZWU6ICJcdTIyMjgiLCB2ZWViYXI6ICJcdTIyQkIiLCB2ZWVlcTogIlx1MjI1QSIsIHZlbGxpcDogIlx1MjJFRSIsIFZlcmJhcjogIlx1MjAxNiIsIHZlcmJhcjogInwiLCBWZXJ0OiAiXHUyMDE2IiwgdmVydDogInwiLCBWZXJ0aWNhbEJhcjogIlx1MjIyMyIsIFZlcnRpY2FsTGluZTogInwiLCBWZXJ0aWNhbFNlcGFyYXRvcjogIlx1Mjc1OCIsIFZlcnRpY2FsVGlsZGU6ICJcdTIyNDAiLCBWZXJ5VGhpblNwYWNlOiAiXHUyMDBBIiwgVmZyOiAiXHV7MUQ1MTl9IiwgdmZyOiAiXHV7MUQ1MzN9Iiwgdmx0cmk6ICJcdTIyQjIiLCB2bnN1YjogIlx1MjI4Mlx1MjBEMiIsIHZuc3VwOiAiXHUyMjgzXHUyMEQyIiwgVm9wZjogIlx1ezFENTREfSIsIHZvcGY6ICJcdXsxRDU2N30iLCB2cHJvcDogIlx1MjIxRCIsIHZydHJpOiAiXHUyMkIzIiwgVnNjcjogIlx1ezFENEIxfSIsIHZzY3I6ICJcdXsxRDRDQn0iLCB2c3VibkU6ICJcdTJBQ0JcdUZFMDAiLCB2c3VibmU6ICJcdTIyOEFcdUZFMDAiLCB2c3VwbkU6ICJcdTJBQ0NcdUZFMDAiLCB2c3VwbmU6ICJcdTIyOEJcdUZFMDAiLCBWdmRhc2g6ICJcdTIyQUEiLCB2emlnemFnOiAiXHUyOTlBIiwgV2NpcmM6ICJcdTAxNzQiLCB3Y2lyYzogIlx1MDE3NSIsIHdlZGJhcjogIlx1MkE1RiIsIFdlZGdlOiAiXHUyMkMwIiwgd2VkZ2U6ICJcdTIyMjciLCB3ZWRnZXE6ICJcdTIyNTkiLCB3ZWllcnA6ICJcdTIxMTgiLCBXZnI6ICJcdXsxRDUxQX0iLCB3ZnI6ICJcdXsxRDUzNH0iLCBXb3BmOiAiXHV7MUQ1NEV9Iiwgd29wZjogIlx1ezFENTY4fSIsIHdwOiAiXHUyMTE4Iiwgd3I6ICJcdTIyNDAiLCB3cmVhdGg6ICJcdTIyNDAiLCBXc2NyOiAiXHV7MUQ0QjJ9Iiwgd3NjcjogIlx1ezFENENDfSIsIHhjYXA6ICJcdTIyQzIiLCB4Y2lyYzogIlx1MjVFRiIsIHhjdXA6ICJcdTIyQzMiLCB4ZHRyaTogIlx1MjVCRCIsIFhmcjogIlx1ezFENTFCfSIsIHhmcjogIlx1ezFENTM1fSIsIHhoQXJyOiAiXHUyN0ZBIiwgeGhhcnI6ICJcdTI3RjciLCBYaTogIlx1MDM5RSIsIHhpOiAiXHUwM0JFIiwgeGxBcnI6ICJcdTI3RjgiLCB4bGFycjogIlx1MjdGNSIsIHhtYXA6ICJcdTI3RkMiLCB4bmlzOiAiXHUyMkZCIiwgeG9kb3Q6ICJcdTJBMDAiLCBYb3BmOiAiXHV7MUQ1NEZ9IiwgeG9wZjogIlx1ezFENTY5fSIsIHhvcGx1czogIlx1MkEwMSIsIHhvdGltZTogIlx1MkEwMiIsIHhyQXJyOiAiXHUyN0Y5IiwgeHJhcnI6ICJcdTI3RjYiLCBYc2NyOiAiXHV7MUQ0QjN9IiwgeHNjcjogIlx1ezFENENEfSIsIHhzcWN1cDogIlx1MkEwNiIsIHh1cGx1czogIlx1MkEwNCIsIHh1dHJpOiAiXHUyNUIzIiwgeHZlZTogIlx1MjJDMSIsIHh3ZWRnZTogIlx1MjJDMCIsIFlhY3V0ZTogIlx4REQiLCB5YWN1dGU6ICJceEZEIiwgWUFjeTogIlx1MDQyRiIsIHlhY3k6ICJcdTA0NEYiLCBZY2lyYzogIlx1MDE3NiIsIHljaXJjOiAiXHUwMTc3IiwgWWN5OiAiXHUwNDJCIiwgeWN5OiAiXHUwNDRCIiwgeWVuOiAiXHhBNSIsIFlmcjogIlx1ezFENTFDfSIsIHlmcjogIlx1ezFENTM2fSIsIFlJY3k6ICJcdTA0MDciLCB5aWN5OiAiXHUwNDU3IiwgWW9wZjogIlx1ezFENTUwfSIsIHlvcGY6ICJcdXsxRDU2QX0iLCBZc2NyOiAiXHV7MUQ0QjR9IiwgeXNjcjogIlx1ezFENENFfSIsIFlVY3k6ICJcdTA0MkUiLCB5dWN5OiAiXHUwNDRFIiwgWXVtbDogIlx1MDE3OCIsIHl1bWw6ICJceEZGIiwgWmFjdXRlOiAiXHUwMTc5IiwgemFjdXRlOiAiXHUwMTdBIiwgWmNhcm9uOiAiXHUwMTdEIiwgemNhcm9uOiAiXHUwMTdFIiwgWmN5OiAiXHUwNDE3IiwgemN5OiAiXHUwNDM3IiwgWmRvdDogIlx1MDE3QiIsIHpkb3Q6ICJcdTAxN0MiLCB6ZWV0cmY6ICJcdTIxMjgiLCBaZXJvV2lkdGhTcGFjZTogIlx1MjAwQiIsIFpldGE6ICJcdTAzOTYiLCB6ZXRhOiAiXHUwM0I2IiwgWmZyOiAiXHUyMTI4IiwgemZyOiAiXHV7MUQ1Mzd9IiwgWkhjeTogIlx1MDQxNiIsIHpoY3k6ICJcdTA0MzYiLCB6aWdyYXJyOiAiXHUyMUREIiwgWm9wZjogIlx1MjEyNCIsIHpvcGY6ICJcdXsxRDU2Qn0iLCBac2NyOiAiXHV7MUQ0QjV9IiwgenNjcjogIlx1ezFENENGfSIsIHp3ajogIlx1MjAwRCIsIHp3bmo6ICJcdTIwMEMiIH0sIGUyLk5HU1BfVU5JQ09ERSA9ICJcdUU1MDAiLCBlMi5OQU1FRF9FTlRJVElFUy5uZ3NwID0gZTIuTkdTUF9VTklDT0RFOwogICAgICAgIH0oUWMpLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoWWMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgICBjb25zdCBKYyA9IFFjOwogICAgICAgIGNsYXNzIFpjIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICBsZXQgeyBjbG9zZWRCeUNoaWxkcmVuOiBlMiwgaW1wbGljaXROYW1lc3BhY2VQcmVmaXg6IHQyLCBjb250ZW50VHlwZTogcjIgPSBKYy5UYWdDb250ZW50VHlwZS5QQVJTQUJMRV9EQVRBLCBjbG9zZWRCeVBhcmVudDogbjIgPSBmYWxzZSwgaXNWb2lkOiBpMiA9IGZhbHNlLCBpZ25vcmVGaXJzdExmOiBzMiA9IGZhbHNlIH0gPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICAgICAgICB0aGlzLmNsb3NlZEJ5Q2hpbGRyZW4gPSB7fSwgdGhpcy5jbG9zZWRCeVBhcmVudCA9IGZhbHNlLCB0aGlzLmNhblNlbGZDbG9zZSA9IGZhbHNlLCBlMiAmJiBlMi5sZW5ndGggPiAwICYmIGUyLmZvckVhY2goKGUzKSA9PiB0aGlzLmNsb3NlZEJ5Q2hpbGRyZW5bZTNdID0gdHJ1ZSksIHRoaXMuaXNWb2lkID0gaTIsIHRoaXMuY2xvc2VkQnlQYXJlbnQgPSBuMiB8fCBpMiwgdGhpcy5pbXBsaWNpdE5hbWVzcGFjZVByZWZpeCA9IHQyIHx8IG51bGwsIHRoaXMuY29udGVudFR5cGUgPSByMiwgdGhpcy5pZ25vcmVGaXJzdExmID0gczI7CiAgICAgICAgICB9CiAgICAgICAgICBpc0Nsb3NlZEJ5Q2hpbGQoZTIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNWb2lkIHx8IGUyLnRvTG93ZXJDYXNlKCkgaW4gdGhpcy5jbG9zZWRCeUNoaWxkcmVuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsZXQgS2MsIGVsOwogICAgICAgIFljLkh0bWxUYWdEZWZpbml0aW9uID0gWmMsIFljLmdldEh0bWxUYWdEZWZpbml0aW9uID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiBlbCB8fCAoS2MgPSBuZXcgWmMoKSwgZWwgPSB7IGJhc2U6IG5ldyBaYyh7IGlzVm9pZDogdHJ1ZSB9KSwgbWV0YTogbmV3IFpjKHsgaXNWb2lkOiB0cnVlIH0pLCBhcmVhOiBuZXcgWmMoeyBpc1ZvaWQ6IHRydWUgfSksIGVtYmVkOiBuZXcgWmMoeyBpc1ZvaWQ6IHRydWUgfSksIGxpbms6IG5ldyBaYyh7IGlzVm9pZDogdHJ1ZSB9KSwgaW1nOiBuZXcgWmMoeyBpc1ZvaWQ6IHRydWUgfSksIGlucHV0OiBuZXcgWmMoeyBpc1ZvaWQ6IHRydWUgfSksIHBhcmFtOiBuZXcgWmMoeyBpc1ZvaWQ6IHRydWUgfSksIGhyOiBuZXcgWmMoeyBpc1ZvaWQ6IHRydWUgfSksIGJyOiBuZXcgWmMoeyBpc1ZvaWQ6IHRydWUgfSksIHNvdXJjZTogbmV3IFpjKHsgaXNWb2lkOiB0cnVlIH0pLCB0cmFjazogbmV3IFpjKHsgaXNWb2lkOiB0cnVlIH0pLCB3YnI6IG5ldyBaYyh7IGlzVm9pZDogdHJ1ZSB9KSwgcDogbmV3IFpjKHsgY2xvc2VkQnlDaGlsZHJlbjogWyJhZGRyZXNzIiwgImFydGljbGUiLCAiYXNpZGUiLCAiYmxvY2txdW90ZSIsICJkaXYiLCAiZGwiLCAiZmllbGRzZXQiLCAiZm9vdGVyIiwgImZvcm0iLCAiaDEiLCAiaDIiLCAiaDMiLCAiaDQiLCAiaDUiLCAiaDYiLCAiaGVhZGVyIiwgImhncm91cCIsICJociIsICJtYWluIiwgIm5hdiIsICJvbCIsICJwIiwgInByZSIsICJzZWN0aW9uIiwgInRhYmxlIiwgInVsIl0sIGNsb3NlZEJ5UGFyZW50OiB0cnVlIH0pLCB0aGVhZDogbmV3IFpjKHsgY2xvc2VkQnlDaGlsZHJlbjogWyJ0Ym9keSIsICJ0Zm9vdCJdIH0pLCB0Ym9keTogbmV3IFpjKHsgY2xvc2VkQnlDaGlsZHJlbjogWyJ0Ym9keSIsICJ0Zm9vdCJdLCBjbG9zZWRCeVBhcmVudDogdHJ1ZSB9KSwgdGZvb3Q6IG5ldyBaYyh7IGNsb3NlZEJ5Q2hpbGRyZW46IFsidGJvZHkiXSwgY2xvc2VkQnlQYXJlbnQ6IHRydWUgfSksIHRyOiBuZXcgWmMoeyBjbG9zZWRCeUNoaWxkcmVuOiBbInRyIl0sIGNsb3NlZEJ5UGFyZW50OiB0cnVlIH0pLCB0ZDogbmV3IFpjKHsgY2xvc2VkQnlDaGlsZHJlbjogWyJ0ZCIsICJ0aCJdLCBjbG9zZWRCeVBhcmVudDogdHJ1ZSB9KSwgdGg6IG5ldyBaYyh7IGNsb3NlZEJ5Q2hpbGRyZW46IFsidGQiLCAidGgiXSwgY2xvc2VkQnlQYXJlbnQ6IHRydWUgfSksIGNvbDogbmV3IFpjKHsgaXNWb2lkOiB0cnVlIH0pLCBzdmc6IG5ldyBaYyh7IGltcGxpY2l0TmFtZXNwYWNlUHJlZml4OiAic3ZnIiB9KSwgbWF0aDogbmV3IFpjKHsgaW1wbGljaXROYW1lc3BhY2VQcmVmaXg6ICJtYXRoIiB9KSwgbGk6IG5ldyBaYyh7IGNsb3NlZEJ5Q2hpbGRyZW46IFsibGkiXSwgY2xvc2VkQnlQYXJlbnQ6IHRydWUgfSksIGR0OiBuZXcgWmMoeyBjbG9zZWRCeUNoaWxkcmVuOiBbImR0IiwgImRkIl0gfSksIGRkOiBuZXcgWmMoeyBjbG9zZWRCeUNoaWxkcmVuOiBbImR0IiwgImRkIl0sIGNsb3NlZEJ5UGFyZW50OiB0cnVlIH0pLCByYjogbmV3IFpjKHsgY2xvc2VkQnlDaGlsZHJlbjogWyJyYiIsICJydCIsICJydGMiLCAicnAiXSwgY2xvc2VkQnlQYXJlbnQ6IHRydWUgfSksIHJ0OiBuZXcgWmMoeyBjbG9zZWRCeUNoaWxkcmVuOiBbInJiIiwgInJ0IiwgInJ0YyIsICJycCJdLCBjbG9zZWRCeVBhcmVudDogdHJ1ZSB9KSwgcnRjOiBuZXcgWmMoeyBjbG9zZWRCeUNoaWxkcmVuOiBbInJiIiwgInJ0YyIsICJycCJdLCBjbG9zZWRCeVBhcmVudDogdHJ1ZSB9KSwgcnA6IG5ldyBaYyh7IGNsb3NlZEJ5Q2hpbGRyZW46IFsicmIiLCAicnQiLCAicnRjIiwgInJwIl0sIGNsb3NlZEJ5UGFyZW50OiB0cnVlIH0pLCBvcHRncm91cDogbmV3IFpjKHsgY2xvc2VkQnlDaGlsZHJlbjogWyJvcHRncm91cCJdLCBjbG9zZWRCeVBhcmVudDogdHJ1ZSB9KSwgb3B0aW9uOiBuZXcgWmMoeyBjbG9zZWRCeUNoaWxkcmVuOiBbIm9wdGlvbiIsICJvcHRncm91cCJdLCBjbG9zZWRCeVBhcmVudDogdHJ1ZSB9KSwgcHJlOiBuZXcgWmMoeyBpZ25vcmVGaXJzdExmOiB0cnVlIH0pLCBsaXN0aW5nOiBuZXcgWmMoeyBpZ25vcmVGaXJzdExmOiB0cnVlIH0pLCBzdHlsZTogbmV3IFpjKHsgY29udGVudFR5cGU6IEpjLlRhZ0NvbnRlbnRUeXBlLlJBV19URVhUIH0pLCBzY3JpcHQ6IG5ldyBaYyh7IGNvbnRlbnRUeXBlOiBKYy5UYWdDb250ZW50VHlwZS5SQVdfVEVYVCB9KSwgdGl0bGU6IG5ldyBaYyh7IGNvbnRlbnRUeXBlOiBKYy5UYWdDb250ZW50VHlwZS5FU0NBUEFCTEVfUkFXX1RFWFQgfSksIHRleHRhcmVhOiBuZXcgWmMoeyBjb250ZW50VHlwZTogSmMuVGFnQ29udGVudFR5cGUuRVNDQVBBQkxFX1JBV19URVhULCBpZ25vcmVGaXJzdExmOiB0cnVlIH0pIH0pLCBlbFtlMl0gfHwgS2M7CiAgICAgICAgfTsKICAgICAgICB2YXIgdGwgPSB7fSwgcmwgPSB7fSwgbmwgPSB7fTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmwsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgICBubC5Bc3RQYXRoID0gY2xhc3MgewogICAgICAgICAgY29uc3RydWN0b3IoZTIpIHsKICAgICAgICAgICAgbGV0IHQyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMV0gOiAtMTsKICAgICAgICAgICAgdGhpcy5wYXRoID0gZTIsIHRoaXMucG9zaXRpb24gPSB0MjsKICAgICAgICAgIH0KICAgICAgICAgIGdldCBlbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJuICF0aGlzLnBhdGggfHwgIXRoaXMucGF0aC5sZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgICBnZXQgaGVhZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucGF0aFswXTsKICAgICAgICAgIH0KICAgICAgICAgIGdldCB0YWlsKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wYXRoW3RoaXMucGF0aC5sZW5ndGggLSAxXTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcmVudE9mKGUyKSB7CiAgICAgICAgICAgIHJldHVybiBlMiAmJiB0aGlzLnBhdGhbdGhpcy5wYXRoLmluZGV4T2YoZTIpIC0gMV07CiAgICAgICAgICB9CiAgICAgICAgICBjaGlsZE9mKGUyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhdGhbdGhpcy5wYXRoLmluZGV4T2YoZTIpICsgMV07CiAgICAgICAgICB9CiAgICAgICAgICBmaXJzdChlMikgewogICAgICAgICAgICBmb3IgKGxldCB0MiA9IHRoaXMucGF0aC5sZW5ndGggLSAxOyB0MiA+PSAwOyB0Mi0tKSB7CiAgICAgICAgICAgICAgbGV0IHIyID0gdGhpcy5wYXRoW3QyXTsKICAgICAgICAgICAgICBpZiAocjIgaW5zdGFuY2VvZiBlMikKICAgICAgICAgICAgICAgIHJldHVybiByMjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcHVzaChlMikgewogICAgICAgICAgICB0aGlzLnBhdGgucHVzaChlMik7CiAgICAgICAgICB9CiAgICAgICAgICBwb3AoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhdGgucG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHJsLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgY29uc3QgaWwgPSBubDsKICAgICAgICBybC5UZXh0ID0gY2xhc3MgewogICAgICAgICAgY29uc3RydWN0b3IoZTIsIHQyLCByMikgewogICAgICAgICAgICB0aGlzLnZhbHVlID0gZTIsIHRoaXMuc291cmNlU3BhbiA9IHQyLCB0aGlzLmkxOG4gPSByMiwgdGhpcy50eXBlID0gInRleHQiOwogICAgICAgICAgfQogICAgICAgICAgdmlzaXQoZTIsIHQyKSB7CiAgICAgICAgICAgIHJldHVybiBlMi52aXNpdFRleHQodGhpcywgdDIpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmwuQ0RBVEEgPSBjbGFzcyB7CiAgICAgICAgICBjb25zdHJ1Y3RvcihlMiwgdDIpIHsKICAgICAgICAgICAgdGhpcy52YWx1ZSA9IGUyLCB0aGlzLnNvdXJjZVNwYW4gPSB0MiwgdGhpcy50eXBlID0gImNkYXRhIjsKICAgICAgICAgIH0KICAgICAgICAgIHZpc2l0KGUyLCB0MikgewogICAgICAgICAgICByZXR1cm4gZTIudmlzaXRDZGF0YSh0aGlzLCB0Mik7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBybC5FeHBhbnNpb24gPSBjbGFzcyB7CiAgICAgICAgICBjb25zdHJ1Y3RvcihlMiwgdDIsIHIyLCBuMiwgaTIsIHMyKSB7CiAgICAgICAgICAgIHRoaXMuc3dpdGNoVmFsdWUgPSBlMiwgdGhpcy50eXBlID0gdDIsIHRoaXMuY2FzZXMgPSByMiwgdGhpcy5zb3VyY2VTcGFuID0gbjIsIHRoaXMuc3dpdGNoVmFsdWVTb3VyY2VTcGFuID0gaTIsIHRoaXMuaTE4biA9IHMyOwogICAgICAgICAgfQogICAgICAgICAgdmlzaXQoZTIsIHQyKSB7CiAgICAgICAgICAgIHJldHVybiBlMi52aXNpdEV4cGFuc2lvbih0aGlzLCB0Mik7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBybC5FeHBhbnNpb25DYXNlID0gY2xhc3MgewogICAgICAgICAgY29uc3RydWN0b3IoZTIsIHQyLCByMiwgbjIsIGkyKSB7CiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBlMiwgdGhpcy5leHByZXNzaW9uID0gdDIsIHRoaXMuc291cmNlU3BhbiA9IHIyLCB0aGlzLnZhbHVlU291cmNlU3BhbiA9IG4yLCB0aGlzLmV4cFNvdXJjZVNwYW4gPSBpMjsKICAgICAgICAgIH0KICAgICAgICAgIHZpc2l0KGUyLCB0MikgewogICAgICAgICAgICByZXR1cm4gZTIudmlzaXRFeHBhbnNpb25DYXNlKHRoaXMsIHQyKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHJsLkF0dHJpYnV0ZSA9IGNsYXNzIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKGUyLCB0MiwgcjIpIHsKICAgICAgICAgICAgbGV0IG4yID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbM10gOiBudWxsLCBpMiA9IGFyZ3VtZW50cy5sZW5ndGggPiA0ICYmIGFyZ3VtZW50c1s0XSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzRdIDogbnVsbCwgczIgPSBhcmd1bWVudHMubGVuZ3RoID4gNSAmJiBhcmd1bWVudHNbNV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1s1XSA6IG51bGw7CiAgICAgICAgICAgIHRoaXMubmFtZSA9IGUyLCB0aGlzLnZhbHVlID0gdDIsIHRoaXMuc291cmNlU3BhbiA9IHIyLCB0aGlzLnZhbHVlU3BhbiA9IG4yLCB0aGlzLm5hbWVTcGFuID0gaTIsIHRoaXMuaTE4biA9IHMyLCB0aGlzLnR5cGUgPSAiYXR0cmlidXRlIjsKICAgICAgICAgIH0KICAgICAgICAgIHZpc2l0KGUyLCB0MikgewogICAgICAgICAgICByZXR1cm4gZTIudmlzaXRBdHRyaWJ1dGUodGhpcywgdDIpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY2xhc3Mgc2wgewogICAgICAgICAgY29uc3RydWN0b3IoZTIsIHQyLCByMiwgbjIpIHsKICAgICAgICAgICAgbGV0IGkyID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgJiYgYXJndW1lbnRzWzRdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbNF0gOiBudWxsLCBzMiA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ICYmIGFyZ3VtZW50c1s1XSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzVdIDogbnVsbCwgbzIgPSBhcmd1bWVudHMubGVuZ3RoID4gNiAmJiBhcmd1bWVudHNbNl0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1s2XSA6IG51bGwsIGEyID0gYXJndW1lbnRzLmxlbmd0aCA+IDcgJiYgYXJndW1lbnRzWzddICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbN10gOiBudWxsOwogICAgICAgICAgICB0aGlzLm5hbWUgPSBlMiwgdGhpcy5hdHRycyA9IHQyLCB0aGlzLmNoaWxkcmVuID0gcjIsIHRoaXMuc291cmNlU3BhbiA9IG4yLCB0aGlzLnN0YXJ0U291cmNlU3BhbiA9IGkyLCB0aGlzLmVuZFNvdXJjZVNwYW4gPSBzMiwgdGhpcy5uYW1lU3BhbiA9IG8yLCB0aGlzLmkxOG4gPSBhMiwgdGhpcy50eXBlID0gImVsZW1lbnQiOwogICAgICAgICAgfQogICAgICAgICAgdmlzaXQoZTIsIHQyKSB7CiAgICAgICAgICAgIHJldHVybiBlMi52aXNpdEVsZW1lbnQodGhpcywgdDIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBybC5FbGVtZW50ID0gc2w7CiAgICAgICAgcmwuQ29tbWVudCA9IGNsYXNzIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKGUyLCB0MikgewogICAgICAgICAgICB0aGlzLnZhbHVlID0gZTIsIHRoaXMuc291cmNlU3BhbiA9IHQyLCB0aGlzLnR5cGUgPSAiY29tbWVudCI7CiAgICAgICAgICB9CiAgICAgICAgICB2aXNpdChlMiwgdDIpIHsKICAgICAgICAgICAgcmV0dXJuIGUyLnZpc2l0Q29tbWVudCh0aGlzLCB0Mik7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBvbChlMiwgdDIpIHsKICAgICAgICAgIGxldCByMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzJdIDogbnVsbDsKICAgICAgICAgIGNvbnN0IG4yID0gW10sIGkyID0gZTIudmlzaXQgPyAodDMpID0+IGUyLnZpc2l0KHQzLCByMikgfHwgdDMudmlzaXQoZTIsIHIyKSA6ICh0MykgPT4gdDMudmlzaXQoZTIsIHIyKTsKICAgICAgICAgIHJldHVybiB0Mi5mb3JFYWNoKChlMykgPT4gewogICAgICAgICAgICBjb25zdCB0MyA9IGkyKGUzKTsKICAgICAgICAgICAgdDMgJiYgbjIucHVzaCh0Myk7CiAgICAgICAgICB9KSwgbjI7CiAgICAgICAgfQogICAgICAgIHJsLkRvY1R5cGUgPSBjbGFzcyB7CiAgICAgICAgICBjb25zdHJ1Y3RvcihlMiwgdDIpIHsKICAgICAgICAgICAgdGhpcy52YWx1ZSA9IGUyLCB0aGlzLnNvdXJjZVNwYW4gPSB0MiwgdGhpcy50eXBlID0gImRvY1R5cGUiOwogICAgICAgICAgfQogICAgICAgICAgdmlzaXQoZTIsIHQyKSB7CiAgICAgICAgICAgIHJldHVybiBlMi52aXNpdERvY1R5cGUodGhpcywgdDIpOwogICAgICAgICAgfQogICAgICAgIH0sIHJsLnZpc2l0QWxsID0gb2w7CiAgICAgICAgY2xhc3MgYWwgewogICAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICB9CiAgICAgICAgICB2aXNpdEVsZW1lbnQoZTIsIHQyKSB7CiAgICAgICAgICAgIHRoaXMudmlzaXRDaGlsZHJlbih0MiwgKHQzKSA9PiB7CiAgICAgICAgICAgICAgdDMoZTIuYXR0cnMpLCB0MyhlMi5jaGlsZHJlbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgdmlzaXRBdHRyaWJ1dGUoZTIsIHQyKSB7CiAgICAgICAgICB9CiAgICAgICAgICB2aXNpdFRleHQoZTIsIHQyKSB7CiAgICAgICAgICB9CiAgICAgICAgICB2aXNpdENkYXRhKGUyLCB0MikgewogICAgICAgICAgfQogICAgICAgICAgdmlzaXRDb21tZW50KGUyLCB0MikgewogICAgICAgICAgfQogICAgICAgICAgdmlzaXREb2NUeXBlKGUyLCB0MikgewogICAgICAgICAgfQogICAgICAgICAgdmlzaXRFeHBhbnNpb24oZTIsIHQyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnZpc2l0Q2hpbGRyZW4odDIsICh0MykgPT4gewogICAgICAgICAgICAgIHQzKGUyLmNhc2VzKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICB2aXNpdEV4cGFuc2lvbkNhc2UoZTIsIHQyKSB7CiAgICAgICAgICB9CiAgICAgICAgICB2aXNpdENoaWxkcmVuKGUyLCB0MikgewogICAgICAgICAgICBsZXQgcjIgPSBbXSwgbjIgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gdDIoZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICB0MyAmJiByMi5wdXNoKG9sKG4yLCB0MywgZTIpKTsKICAgICAgICAgICAgfSksIEFycmF5LnByb3RvdHlwZS5jb25jYXQuYXBwbHkoW10sIHIyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdWwoZTIpIHsKICAgICAgICAgIGNvbnN0IHQyID0gZTIuc291cmNlU3Bhbi5zdGFydC5vZmZzZXQ7CiAgICAgICAgICBsZXQgcjIgPSBlMi5zb3VyY2VTcGFuLmVuZC5vZmZzZXQ7CiAgICAgICAgICByZXR1cm4gZTIgaW5zdGFuY2VvZiBzbCAmJiAoZTIuZW5kU291cmNlU3BhbiA/IHIyID0gZTIuZW5kU291cmNlU3Bhbi5lbmQub2Zmc2V0IDogZTIuY2hpbGRyZW4gJiYgZTIuY2hpbGRyZW4ubGVuZ3RoICYmIChyMiA9IHVsKGUyLmNoaWxkcmVuW2UyLmNoaWxkcmVuLmxlbmd0aCAtIDFdKS5lbmQpKSwgeyBzdGFydDogdDIsIGVuZDogcjIgfTsKICAgICAgICB9CiAgICAgICAgcmwuUmVjdXJzaXZlVmlzaXRvciA9IGFsLCBybC5maW5kTm9kZSA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgY29uc3QgcjIgPSBbXSwgbjIgPSBuZXcgY2xhc3MgZXh0ZW5kcyBhbCB7CiAgICAgICAgICAgIHZpc2l0KGUzLCBuMykgewogICAgICAgICAgICAgIGNvbnN0IGkyID0gdWwoZTMpOwogICAgICAgICAgICAgIGlmICghKGkyLnN0YXJ0IDw9IHQyICYmIHQyIDwgaTIuZW5kKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIHIyLnB1c2goZTMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KCk7CiAgICAgICAgICByZXR1cm4gb2wobjIsIGUyKSwgbmV3IGlsLkFzdFBhdGgocjIsIHQyKTsKICAgICAgICB9OwogICAgICAgIHZhciBjbCA9IHt9LCBsbCA9IHt9LCBwbCA9IHt9OwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwbCwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCBwbC5hc3NlcnRBcnJheU9mU3RyaW5ncyA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgaWYgKHQyICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHQyKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkV4cGVjdGVkICciLmNvbmNhdChlMiwgIicgdG8gYmUgYW4gYXJyYXkgb2Ygc3RyaW5ncy4iKSk7CiAgICAgICAgICAgIGZvciAobGV0IHIyID0gMDsgcjIgPCB0Mi5sZW5ndGg7IHIyICs9IDEpCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0MltyMl0gIT0gInN0cmluZyIpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkV4cGVjdGVkICciLmNvbmNhdChlMiwgIicgdG8gYmUgYW4gYXJyYXkgb2Ygc3RyaW5ncy4iKSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBjb25zdCBobCA9IFsvXlxzKiQvLCAvWzw+XS8sIC9eW3t9XSQvLCAvJigjfFthLXpdKS9pLCAvXlwvXC8vXTsKICAgICAgICBwbC5hc3NlcnRJbnRlcnBvbGF0aW9uU3ltYm9scyA9IGZ1bmN0aW9uKGUyLCB0MikgewogICAgICAgICAgaWYgKCEodDIgPT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KHQyKSAmJiB0Mi5sZW5ndGggPT0gMikpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRXhwZWN0ZWQgJyIuY29uY2F0KGUyLCAiJyB0byBiZSBhbiBhcnJheSwgW3N0YXJ0LCBlbmRdLiIpKTsKICAgICAgICAgIGlmICh0MiAhPSBudWxsKSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gdDJbMF0sIHIyID0gdDJbMV07CiAgICAgICAgICAgIGhsLmZvckVhY2goKHQzKSA9PiB7CiAgICAgICAgICAgICAgaWYgKHQzLnRlc3QoZTMpIHx8IHQzLnRlc3QocjIpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJbJyIuY29uY2F0KGUzLCAiJywgJyIpLmNvbmNhdChyMiwgIiddIGNvbnRhaW5zIHVudXNhYmxlIGludGVycG9sYXRpb24gc3ltYm9sLiIpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgICAgY29uc3QgdDIgPSBwbDsKICAgICAgICAgIGNsYXNzIHIyIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoZTMsIHQzKSB7CiAgICAgICAgICAgICAgdGhpcy5zdGFydCA9IGUzLCB0aGlzLmVuZCA9IHQzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRpYyBmcm9tQXJyYXkobjIpIHsKICAgICAgICAgICAgICByZXR1cm4gbjIgPyAodDIuYXNzZXJ0SW50ZXJwb2xhdGlvblN5bWJvbHMoImludGVycG9sYXRpb24iLCBuMiksIG5ldyByMihuMlswXSwgbjJbMV0pKSA6IGUyLkRFRkFVTFRfSU5URVJQT0xBVElPTl9DT05GSUc7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGUyLkludGVycG9sYXRpb25Db25maWcgPSByMiwgZTIuREVGQVVMVF9JTlRFUlBPTEFUSU9OX0NPTkZJRyA9IG5ldyByMigie3siLCAifX0iKTsKICAgICAgICB9KGxsKSwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlMiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgICAgY29uc3QgbjIgPSByLCBpMiA9IHQsIHMyID0gbGwsIG8yID0gUWM7CiAgICAgICAgICB2YXIgYTI7CiAgICAgICAgICAhZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgZTNbZTMuVEFHX09QRU5fU1RBUlQgPSAwXSA9ICJUQUdfT1BFTl9TVEFSVCIsIGUzW2UzLlRBR19PUEVOX0VORCA9IDFdID0gIlRBR19PUEVOX0VORCIsIGUzW2UzLlRBR19PUEVOX0VORF9WT0lEID0gMl0gPSAiVEFHX09QRU5fRU5EX1ZPSUQiLCBlM1tlMy5UQUdfQ0xPU0UgPSAzXSA9ICJUQUdfQ0xPU0UiLCBlM1tlMy5URVhUID0gNF0gPSAiVEVYVCIsIGUzW2UzLkVTQ0FQQUJMRV9SQVdfVEVYVCA9IDVdID0gIkVTQ0FQQUJMRV9SQVdfVEVYVCIsIGUzW2UzLlJBV19URVhUID0gNl0gPSAiUkFXX1RFWFQiLCBlM1tlMy5DT01NRU5UX1NUQVJUID0gN10gPSAiQ09NTUVOVF9TVEFSVCIsIGUzW2UzLkNPTU1FTlRfRU5EID0gOF0gPSAiQ09NTUVOVF9FTkQiLCBlM1tlMy5DREFUQV9TVEFSVCA9IDldID0gIkNEQVRBX1NUQVJUIiwgZTNbZTMuQ0RBVEFfRU5EID0gMTBdID0gIkNEQVRBX0VORCIsIGUzW2UzLkFUVFJfTkFNRSA9IDExXSA9ICJBVFRSX05BTUUiLCBlM1tlMy5BVFRSX1FVT1RFID0gMTJdID0gIkFUVFJfUVVPVEUiLCBlM1tlMy5BVFRSX1ZBTFVFID0gMTNdID0gIkFUVFJfVkFMVUUiLCBlM1tlMy5ET0NfVFlQRV9TVEFSVCA9IDE0XSA9ICJET0NfVFlQRV9TVEFSVCIsIGUzW2UzLkRPQ19UWVBFX0VORCA9IDE1XSA9ICJET0NfVFlQRV9FTkQiLCBlM1tlMy5FWFBBTlNJT05fRk9STV9TVEFSVCA9IDE2XSA9ICJFWFBBTlNJT05fRk9STV9TVEFSVCIsIGUzW2UzLkVYUEFOU0lPTl9DQVNFX1ZBTFVFID0gMTddID0gIkVYUEFOU0lPTl9DQVNFX1ZBTFVFIiwgZTNbZTMuRVhQQU5TSU9OX0NBU0VfRVhQX1NUQVJUID0gMThdID0gIkVYUEFOU0lPTl9DQVNFX0VYUF9TVEFSVCIsIGUzW2UzLkVYUEFOU0lPTl9DQVNFX0VYUF9FTkQgPSAxOV0gPSAiRVhQQU5TSU9OX0NBU0VfRVhQX0VORCIsIGUzW2UzLkVYUEFOU0lPTl9GT1JNX0VORCA9IDIwXSA9ICJFWFBBTlNJT05fRk9STV9FTkQiLCBlM1tlMy5FT0YgPSAyMV0gPSAiRU9GIjsKICAgICAgICAgIH0oYTIgPSBlMi5Ub2tlblR5cGUgfHwgKGUyLlRva2VuVHlwZSA9IHt9KSk7CiAgICAgICAgICBjbGFzcyB1MiB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGUzLCB0MiwgcjIpIHsKICAgICAgICAgICAgICB0aGlzLnR5cGUgPSBlMywgdGhpcy5wYXJ0cyA9IHQyLCB0aGlzLnNvdXJjZVNwYW4gPSByMjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZTIuVG9rZW4gPSB1MjsKICAgICAgICAgIGNsYXNzIGMyIGV4dGVuZHMgaTIuUGFyc2VFcnJvciB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGUzLCB0MiwgcjIpIHsKICAgICAgICAgICAgICBzdXBlcihyMiwgZTMpLCB0aGlzLnRva2VuVHlwZSA9IHQyOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBlMi5Ub2tlbkVycm9yID0gYzI7CiAgICAgICAgICBjbGFzcyBsMiB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGUzLCB0MikgewogICAgICAgICAgICAgIHRoaXMudG9rZW5zID0gZTMsIHRoaXMuZXJyb3JzID0gdDI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGUyLlRva2VuaXplUmVzdWx0ID0gbDIsIGUyLnRva2VuaXplID0gZnVuY3Rpb24oZTMsIHQyLCByMikgewogICAgICAgICAgICBsZXQgbjMgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1szXSA6IHt9OwogICAgICAgICAgICByZXR1cm4gbmV3IGQyKG5ldyBpMi5QYXJzZVNvdXJjZUZpbGUoZTMsIHQyKSwgcjIsIG4zKS50b2tlbml6ZSgpOwogICAgICAgICAgfTsKICAgICAgICAgIGNvbnN0IHAyID0gL1xyXG4/L2c7CiAgICAgICAgICBmdW5jdGlvbiBoMihlMykgewogICAgICAgICAgICBjb25zdCB0MiA9IGUzID09PSBuMi4kRU9GID8gIkVPRiIgOiBTdHJpbmcuZnJvbUNoYXJDb2RlKGUzKTsKICAgICAgICAgICAgcmV0dXJuICdVbmV4cGVjdGVkIGNoYXJhY3RlciAiJy5jb25jYXQodDIsICciJyk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBEMihlMykgewogICAgICAgICAgICByZXR1cm4gJ1Vua25vd24gZW50aXR5ICInLmNvbmNhdChlMywgJyIgLSB1c2UgdGhlICImIzxkZWNpbWFsPjsiIG9yICAiJiN4PGhleD47IiBzeW50YXgnKTsKICAgICAgICAgIH0KICAgICAgICAgIGNsYXNzIGYyIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoZTMpIHsKICAgICAgICAgICAgICB0aGlzLmVycm9yID0gZTM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGNsYXNzIGQyIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoZTMsIHQyLCByMikgewogICAgICAgICAgICAgIHRoaXMuX2dldFRhZ0NvbnRlbnRUeXBlID0gdDIsIHRoaXMuX2N1cnJlbnRUb2tlblN0YXJ0ID0gbnVsbCwgdGhpcy5fY3VycmVudFRva2VuVHlwZSA9IG51bGwsIHRoaXMuX2V4cGFuc2lvbkNhc2VTdGFjayA9IFtdLCB0aGlzLl9pbkludGVycG9sYXRpb24gPSBmYWxzZSwgdGhpcy5fZnVsbE5hbWVTdGFjayA9IFtdLCB0aGlzLnRva2VucyA9IFtdLCB0aGlzLmVycm9ycyA9IFtdLCB0aGlzLl90b2tlbml6ZUljdSA9IHIyLnRva2VuaXplRXhwYW5zaW9uRm9ybXMgfHwgZmFsc2UsIHRoaXMuX2ludGVycG9sYXRpb25Db25maWcgPSByMi5pbnRlcnBvbGF0aW9uQ29uZmlnIHx8IHMyLkRFRkFVTFRfSU5URVJQT0xBVElPTl9DT05GSUcsIHRoaXMuX2xlYWRpbmdUcml2aWFDb2RlUG9pbnRzID0gcjIubGVhZGluZ1RyaXZpYUNoYXJzICYmIHIyLmxlYWRpbmdUcml2aWFDaGFycy5tYXAoKGU0KSA9PiBlNC5jb2RlUG9pbnRBdCgwKSB8fCAwKSwgdGhpcy5fY2FuU2VsZkNsb3NlID0gcjIuY2FuU2VsZkNsb3NlIHx8IGZhbHNlLCB0aGlzLl9hbGxvd0h0bUNvbXBvbmVudENsb3NpbmdUYWdzID0gcjIuYWxsb3dIdG1Db21wb25lbnRDbG9zaW5nVGFncyB8fCBmYWxzZTsKICAgICAgICAgICAgICBjb25zdCBuMyA9IHIyLnJhbmdlIHx8IHsgZW5kUG9zOiBlMy5jb250ZW50Lmxlbmd0aCwgc3RhcnRQb3M6IDAsIHN0YXJ0TGluZTogMCwgc3RhcnRDb2w6IDAgfTsKICAgICAgICAgICAgICB0aGlzLl9jdXJzb3IgPSByMi5lc2NhcGVkU3RyaW5nID8gbmV3IFMyKGUzLCBuMykgOiBuZXcgYjIoZTMsIG4zKTsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdGhpcy5fY3Vyc29yLmluaXQoKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlNCkgewogICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFcnJvcihlNCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9wcm9jZXNzQ2FycmlhZ2VSZXR1cm5zKGUzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUzLnJlcGxhY2UocDIsICJcbiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRva2VuaXplKCkgewogICAgICAgICAgICAgIGZvciAoOyB0aGlzLl9jdXJzb3IucGVlaygpICE9PSBuMi4kRU9GOyApIHsKICAgICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5fY3Vyc29yLmNsb25lKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXR0ZW1wdENoYXJDb2RlKG4yLiRMVCkpCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2F0dGVtcHRDaGFyQ29kZShuMi4kQkFORykpCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdHRlbXB0U3RyKCJbQ0RBVEFbIikgPyB0aGlzLl9jb25zdW1lQ2RhdGEoZTMpIDogdGhpcy5fYXR0ZW1wdFN0cigiLS0iKSA/IHRoaXMuX2NvbnN1bWVDb21tZW50KGUzKSA6IHRoaXMuX2F0dGVtcHRTdHJDYXNlSW5zZW5zaXRpdmUoImRvY3R5cGUiKSA/IHRoaXMuX2NvbnN1bWVEb2NUeXBlKGUzKSA6IHRoaXMuX2NvbnN1bWVCb2d1c0NvbW1lbnQoZTMpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX2F0dGVtcHRDaGFyQ29kZShuMi4kU0xBU0gpKQogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29uc3VtZVRhZ0Nsb3NlKGUzKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5fY3Vyc29yLmNsb25lKCk7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdHRlbXB0Q2hhckNvZGUobjIuJFFVRVNUSU9OKSA/ICh0aGlzLl9jdXJzb3IgPSB0MiwgdGhpcy5fY29uc3VtZUJvZ3VzQ29tbWVudChlMykpIDogdGhpcy5fY29uc3VtZVRhZ09wZW4oZTMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rva2VuaXplSWN1ICYmIHRoaXMuX3Rva2VuaXplRXhwYW5zaW9uRm9ybSgpIHx8IHRoaXMuX2NvbnN1bWVUZXh0KCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlNCkgewogICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVycm9yKGU0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JlZ2luVG9rZW4oYTIuRU9GKSwgdGhpcy5fZW5kVG9rZW4oW10pLCBuZXcgbDIoZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQyID0gW107CiAgICAgICAgICAgICAgICBsZXQgcjI7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBuMyA9IDA7IG4zIDwgZTMubGVuZ3RoOyBuMysrKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGkzID0gZTNbbjNdOwogICAgICAgICAgICAgICAgICByMiAmJiByMi50eXBlID09IGEyLlRFWFQgJiYgaTMudHlwZSA9PSBhMi5URVhUID8gKHIyLnBhcnRzWzBdICs9IGkzLnBhcnRzWzBdLCByMi5zb3VyY2VTcGFuLmVuZCA9IGkzLnNvdXJjZVNwYW4uZW5kKSA6IChyMiA9IGkzLCB0Mi5wdXNoKHIyKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgICAgICAgfSh0aGlzLnRva2VucyksIHRoaXMuZXJyb3JzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfdG9rZW5pemVFeHBhbnNpb25Gb3JtKCkgewogICAgICAgICAgICAgIGlmICh0aGlzLmlzRXhwYW5zaW9uRm9ybVN0YXJ0KCkpCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29uc3VtZUV4cGFuc2lvbkZvcm1TdGFydCgpLCB0cnVlOwogICAgICAgICAgICAgIGlmICgoKGUzID0gdGhpcy5fY3Vyc29yLnBlZWsoKSkgPT09IG4yLiRFUSB8fCBuMi5pc0FzY2lpTGV0dGVyKGUzKSB8fCBuMi5pc0RpZ2l0KGUzKSkgJiYgdGhpcy5faXNJbkV4cGFuc2lvbkZvcm0oKSkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb25zdW1lRXhwYW5zaW9uQ2FzZVN0YXJ0KCksIHRydWU7CiAgICAgICAgICAgICAgdmFyIGUzOwogICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJzb3IucGVlaygpID09PSBuMi4kUkJSQUNFKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNJbkV4cGFuc2lvbkNhc2UoKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnN1bWVFeHBhbnNpb25DYXNlRW5kKCksIHRydWU7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNJbkV4cGFuc2lvbkZvcm0oKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnN1bWVFeHBhbnNpb25Gb3JtRW5kKCksIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfYmVnaW5Ub2tlbihlMykgewogICAgICAgICAgICAgIGxldCB0MiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDogdGhpcy5fY3Vyc29yLmNsb25lKCk7CiAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFRva2VuU3RhcnQgPSB0MiwgdGhpcy5fY3VycmVudFRva2VuVHlwZSA9IGUzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9lbmRUb2tlbihlMykgewogICAgICAgICAgICAgIGxldCB0MiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDogdGhpcy5fY3Vyc29yLmNsb25lKCk7CiAgICAgICAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRUb2tlblN0YXJ0ID09PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IGMyKCJQcm9ncmFtbWluZyBlcnJvciAtIGF0dGVtcHRlZCB0byBlbmQgYSB0b2tlbiB3aGVuIHRoZXJlIHdhcyBubyBzdGFydCB0byB0aGUgdG9rZW4iLCB0aGlzLl9jdXJyZW50VG9rZW5UeXBlLCB0aGlzLl9jdXJzb3IuZ2V0U3Bhbih0MikpOwogICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50VG9rZW5UeXBlID09PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IGMyKCJQcm9ncmFtbWluZyBlcnJvciAtIGF0dGVtcHRlZCB0byBlbmQgYSB0b2tlbiB3aGljaCBoYXMgbm8gdG9rZW4gdHlwZSIsIG51bGwsIHRoaXMuX2N1cnNvci5nZXRTcGFuKHRoaXMuX2N1cnJlbnRUb2tlblN0YXJ0KSk7CiAgICAgICAgICAgICAgY29uc3QgcjIgPSBuZXcgdTIodGhpcy5fY3VycmVudFRva2VuVHlwZSwgZTMsIHRoaXMuX2N1cnNvci5nZXRTcGFuKHRoaXMuX2N1cnJlbnRUb2tlblN0YXJ0LCB0aGlzLl9sZWFkaW5nVHJpdmlhQ29kZVBvaW50cykpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLnRva2Vucy5wdXNoKHIyKSwgdGhpcy5fY3VycmVudFRva2VuU3RhcnQgPSBudWxsLCB0aGlzLl9jdXJyZW50VG9rZW5UeXBlID0gbnVsbCwgcjI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NyZWF0ZUVycm9yKGUzLCB0MikgewogICAgICAgICAgICAgIHRoaXMuX2lzSW5FeHBhbnNpb25Gb3JtKCkgJiYgKGUzICs9IGAgKERvIHlvdSBoYXZlIGFuIHVuZXNjYXBlZCAieyIgaW4geW91ciB0ZW1wbGF0ZT8gVXNlICJ7eyAneycgfX0iKSB0byBlc2NhcGUgaXQuKWApOwogICAgICAgICAgICAgIGNvbnN0IHIyID0gbmV3IGMyKGUzLCB0aGlzLl9jdXJyZW50VG9rZW5UeXBlLCB0Mik7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRUb2tlblN0YXJ0ID0gbnVsbCwgdGhpcy5fY3VycmVudFRva2VuVHlwZSA9IG51bGwsIG5ldyBmMihyMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaGFuZGxlRXJyb3IoZTMpIHsKICAgICAgICAgICAgICBpZiAoZTMgaW5zdGFuY2VvZiBUMiAmJiAoZTMgPSB0aGlzLl9jcmVhdGVFcnJvcihlMy5tc2csIHRoaXMuX2N1cnNvci5nZXRTcGFuKGUzLmN1cnNvcikpKSwgIShlMyBpbnN0YW5jZW9mIGYyKSkKICAgICAgICAgICAgICAgIHRocm93IGUzOwogICAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZTMuZXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9hdHRlbXB0Q2hhckNvZGUoZTMpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3Vyc29yLnBlZWsoKSA9PT0gZTMgJiYgKHRoaXMuX2N1cnNvci5hZHZhbmNlKCksIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9hdHRlbXB0Q2hhckNvZGVDYXNlSW5zZW5zaXRpdmUoZTMpIHsKICAgICAgICAgICAgICByZXR1cm4gdDIgPSB0aGlzLl9jdXJzb3IucGVlaygpLCByMiA9IGUzLCB5Mih0MikgPT0geTIocjIpICYmICh0aGlzLl9jdXJzb3IuYWR2YW5jZSgpLCB0cnVlKTsKICAgICAgICAgICAgICB2YXIgdDIsIHIyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9yZXF1aXJlQ2hhckNvZGUoZTMpIHsKICAgICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuX2N1cnNvci5jbG9uZSgpOwogICAgICAgICAgICAgIGlmICghdGhpcy5fYXR0ZW1wdENoYXJDb2RlKGUzKSkKICAgICAgICAgICAgICAgIHRocm93IHRoaXMuX2NyZWF0ZUVycm9yKGgyKHRoaXMuX2N1cnNvci5wZWVrKCkpLCB0aGlzLl9jdXJzb3IuZ2V0U3Bhbih0MikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9hdHRlbXB0U3RyKGUzKSB7CiAgICAgICAgICAgICAgY29uc3QgdDIgPSBlMy5sZW5ndGg7CiAgICAgICAgICAgICAgaWYgKHRoaXMuX2N1cnNvci5jaGFyc0xlZnQoKSA8IHQyKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5fY3Vyc29yLmNsb25lKCk7CiAgICAgICAgICAgICAgZm9yIChsZXQgbjMgPSAwOyBuMyA8IHQyOyBuMysrKQogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9hdHRlbXB0Q2hhckNvZGUoZTMuY2hhckNvZGVBdChuMykpKQogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3Vyc29yID0gcjIsIGZhbHNlOwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9hdHRlbXB0U3RyQ2FzZUluc2Vuc2l0aXZlKGUzKSB7CiAgICAgICAgICAgICAgZm9yIChsZXQgdDIgPSAwOyB0MiA8IGUzLmxlbmd0aDsgdDIrKykKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fYXR0ZW1wdENoYXJDb2RlQ2FzZUluc2Vuc2l0aXZlKGUzLmNoYXJDb2RlQXQodDIpKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9yZXF1aXJlU3RyKGUzKSB7CiAgICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLl9jdXJzb3IuY2xvbmUoKTsKICAgICAgICAgICAgICBpZiAoIXRoaXMuX2F0dGVtcHRTdHIoZTMpKQogICAgICAgICAgICAgICAgdGhyb3cgdGhpcy5fY3JlYXRlRXJyb3IoaDIodGhpcy5fY3Vyc29yLnBlZWsoKSksIHRoaXMuX2N1cnNvci5nZXRTcGFuKHQyKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3JlcXVpcmVTdHJDYXNlSW5zZW5zaXRpdmUoZTMpIHsKICAgICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuX2N1cnNvci5jbG9uZSgpOwogICAgICAgICAgICAgIGlmICghdGhpcy5fYXR0ZW1wdFN0ckNhc2VJbnNlbnNpdGl2ZShlMykpCiAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLl9jcmVhdGVFcnJvcihoMih0aGlzLl9jdXJzb3IucGVlaygpKSwgdGhpcy5fY3Vyc29yLmdldFNwYW4odDIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfYXR0ZW1wdENoYXJDb2RlVW50aWxGbihlMykgewogICAgICAgICAgICAgIGZvciAoOyAhZTModGhpcy5fY3Vyc29yLnBlZWsoKSk7ICkKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnNvci5hZHZhbmNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3JlcXVpcmVDaGFyQ29kZVVudGlsRm4oZTMsIHQyKSB7CiAgICAgICAgICAgICAgY29uc3QgcjIgPSB0aGlzLl9jdXJzb3IuY2xvbmUoKTsKICAgICAgICAgICAgICB0aGlzLl9hdHRlbXB0Q2hhckNvZGVVbnRpbEZuKGUzKTsKICAgICAgICAgICAgICBpZiAodGhpcy5fY3Vyc29yLmNsb25lKCkuZGlmZihyMikgPCB0MikKICAgICAgICAgICAgICAgIHRocm93IHRoaXMuX2NyZWF0ZUVycm9yKGgyKHRoaXMuX2N1cnNvci5wZWVrKCkpLCB0aGlzLl9jdXJzb3IuZ2V0U3BhbihyMikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9hdHRlbXB0VW50aWxDaGFyKGUzKSB7CiAgICAgICAgICAgICAgZm9yICg7IHRoaXMuX2N1cnNvci5wZWVrKCkgIT09IGUzOyApCiAgICAgICAgICAgICAgICB0aGlzLl9jdXJzb3IuYWR2YW5jZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9yZWFkQ2hhcihlMykgewogICAgICAgICAgICAgIGlmIChlMyAmJiB0aGlzLl9jdXJzb3IucGVlaygpID09PSBuMi4kQU1QRVJTQU5EKQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RlY29kZUVudGl0eSgpOwogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnN0IGU0ID0gU3RyaW5nLmZyb21Db2RlUG9pbnQodGhpcy5fY3Vyc29yLnBlZWsoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3Vyc29yLmFkdmFuY2UoKSwgZTQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9kZWNvZGVFbnRpdHkoKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLl9jdXJzb3IuY2xvbmUoKTsKICAgICAgICAgICAgICBpZiAodGhpcy5fY3Vyc29yLmFkdmFuY2UoKSwgIXRoaXMuX2F0dGVtcHRDaGFyQ29kZShuMi4kSEFTSCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5fY3Vyc29yLmNsb25lKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXR0ZW1wdENoYXJDb2RlVW50aWxGbihDMiksIHRoaXMuX2N1cnNvci5wZWVrKCkgIT0gbjIuJFNFTUlDT0xPTikKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnNvciA9IHQyLCAiJiI7CiAgICAgICAgICAgICAgICBjb25zdCByMiA9IHRoaXMuX2N1cnNvci5nZXRDaGFycyh0Mik7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJzb3IuYWR2YW5jZSgpOwogICAgICAgICAgICAgICAgY29uc3QgaTMgPSBvMi5OQU1FRF9FTlRJVElFU1tyMl07CiAgICAgICAgICAgICAgICBpZiAoIWkzKQogICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLl9jcmVhdGVFcnJvcihEMihyMiksIHRoaXMuX2N1cnNvci5nZXRTcGFuKGUzKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gaTM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5fYXR0ZW1wdENoYXJDb2RlKG4yLiR4KSB8fCB0aGlzLl9hdHRlbXB0Q2hhckNvZGUobjIuJFgpLCByMiA9IHRoaXMuX2N1cnNvci5jbG9uZSgpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2F0dGVtcHRDaGFyQ29kZVVudGlsRm4oRTIpLCB0aGlzLl9jdXJzb3IucGVlaygpICE9IG4yLiRTRU1JQ09MT04pCiAgICAgICAgICAgICAgICAgIHRocm93IHRoaXMuX2NyZWF0ZUVycm9yKGgyKHRoaXMuX2N1cnNvci5wZWVrKCkpLCB0aGlzLl9jdXJzb3IuZ2V0U3BhbigpKTsKICAgICAgICAgICAgICAgIGNvbnN0IGkzID0gdGhpcy5fY3Vyc29yLmdldENoYXJzKHIyKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnNvci5hZHZhbmNlKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICBjb25zdCBlNCA9IHBhcnNlSW50KGkzLCB0MiA/IDE2IDogMTApOwogICAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShlNCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoICh0MykgewogICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLl9jcmVhdGVFcnJvcihEMih0aGlzLl9jdXJzb3IuZ2V0Q2hhcnMoZTMpKSwgdGhpcy5fY3Vyc29yLmdldFNwYW4oKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb25zdW1lUmF3VGV4dChlMywgdDIpIHsKICAgICAgICAgICAgICB0aGlzLl9iZWdpblRva2VuKGUzID8gYTIuRVNDQVBBQkxFX1JBV19URVhUIDogYTIuUkFXX1RFWFQpOwogICAgICAgICAgICAgIGNvbnN0IHIyID0gW107CiAgICAgICAgICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgICAgICAgICBjb25zdCBuMyA9IHRoaXMuX2N1cnNvci5jbG9uZSgpLCBpMyA9IHQyKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3Vyc29yID0gbjMsIGkzKQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIHIyLnB1c2godGhpcy5fcmVhZENoYXIoZTMpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuZFRva2VuKFt0aGlzLl9wcm9jZXNzQ2FycmlhZ2VSZXR1cm5zKHIyLmpvaW4oIiIpKV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb25zdW1lQ29tbWVudChlMykgewogICAgICAgICAgICAgIHRoaXMuX2JlZ2luVG9rZW4oYTIuQ09NTUVOVF9TVEFSVCwgZTMpLCB0aGlzLl9lbmRUb2tlbihbXSksIHRoaXMuX2NvbnN1bWVSYXdUZXh0KGZhbHNlLCAoKSA9PiB0aGlzLl9hdHRlbXB0U3RyKCItLT4iKSksIHRoaXMuX2JlZ2luVG9rZW4oYTIuQ09NTUVOVF9FTkQpLCB0aGlzLl9yZXF1aXJlU3RyKCItLT4iKSwgdGhpcy5fZW5kVG9rZW4oW10pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb25zdW1lQm9ndXNDb21tZW50KGUzKSB7CiAgICAgICAgICAgICAgdGhpcy5fYmVnaW5Ub2tlbihhMi5DT01NRU5UX1NUQVJULCBlMyksIHRoaXMuX2VuZFRva2VuKFtdKSwgdGhpcy5fY29uc3VtZVJhd1RleHQoZmFsc2UsICgpID0+IHRoaXMuX2N1cnNvci5wZWVrKCkgPT09IG4yLiRHVCksIHRoaXMuX2JlZ2luVG9rZW4oYTIuQ09NTUVOVF9FTkQpLCB0aGlzLl9jdXJzb3IuYWR2YW5jZSgpLCB0aGlzLl9lbmRUb2tlbihbXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NvbnN1bWVDZGF0YShlMykgewogICAgICAgICAgICAgIHRoaXMuX2JlZ2luVG9rZW4oYTIuQ0RBVEFfU1RBUlQsIGUzKSwgdGhpcy5fZW5kVG9rZW4oW10pLCB0aGlzLl9jb25zdW1lUmF3VGV4dChmYWxzZSwgKCkgPT4gdGhpcy5fYXR0ZW1wdFN0cigiXV0+IikpLCB0aGlzLl9iZWdpblRva2VuKGEyLkNEQVRBX0VORCksIHRoaXMuX3JlcXVpcmVTdHIoIl1dPiIpLCB0aGlzLl9lbmRUb2tlbihbXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NvbnN1bWVEb2NUeXBlKGUzKSB7CiAgICAgICAgICAgICAgdGhpcy5fYmVnaW5Ub2tlbihhMi5ET0NfVFlQRV9TVEFSVCwgZTMpLCB0aGlzLl9lbmRUb2tlbihbXSksIHRoaXMuX2NvbnN1bWVSYXdUZXh0KGZhbHNlLCAoKSA9PiB0aGlzLl9jdXJzb3IucGVlaygpID09PSBuMi4kR1QpLCB0aGlzLl9iZWdpblRva2VuKGEyLkRPQ19UWVBFX0VORCksIHRoaXMuX2N1cnNvci5hZHZhbmNlKCksIHRoaXMuX2VuZFRva2VuKFtdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfY29uc3VtZVByZWZpeEFuZE5hbWUoKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLl9jdXJzb3IuY2xvbmUoKTsKICAgICAgICAgICAgICBsZXQgdDIgPSAiIjsKICAgICAgICAgICAgICBmb3IgKDsgdGhpcy5fY3Vyc29yLnBlZWsoKSAhPT0gbjIuJENPTE9OICYmICEoKChyMiA9IHRoaXMuX2N1cnNvci5wZWVrKCkpIDwgbjIuJGEgfHwgbjIuJHogPCByMikgJiYgKHIyIDwgbjIuJEEgfHwgbjIuJFogPCByMikgJiYgKHIyIDwgbjIuJDAgfHwgcjIgPiBuMi4kOSkpOyApCiAgICAgICAgICAgICAgICB0aGlzLl9jdXJzb3IuYWR2YW5jZSgpOwogICAgICAgICAgICAgIHZhciByMjsKICAgICAgICAgICAgICBsZXQgaTM7CiAgICAgICAgICAgICAgdGhpcy5fY3Vyc29yLnBlZWsoKSA9PT0gbjIuJENPTE9OID8gKHQyID0gdGhpcy5fY3Vyc29yLmdldENoYXJzKGUzKSwgdGhpcy5fY3Vyc29yLmFkdmFuY2UoKSwgaTMgPSB0aGlzLl9jdXJzb3IuY2xvbmUoKSkgOiBpMyA9IGUzLCB0aGlzLl9yZXF1aXJlQ2hhckNvZGVVbnRpbEZuKG0yLCB0MiA9PT0gIiIgPyAwIDogMSk7CiAgICAgICAgICAgICAgcmV0dXJuIFt0MiwgdGhpcy5fY3Vyc29yLmdldENoYXJzKGkzKV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NvbnN1bWVUYWdPcGVuKGUzKSB7CiAgICAgICAgICAgICAgbGV0IHQyLCByMiwgaTMsIHMzID0gdGhpcy50b2tlbnMubGVuZ3RoOwogICAgICAgICAgICAgIGNvbnN0IHUzID0gdGhpcy5fY3Vyc29yLmNsb25lKCksIGMzID0gW107CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghbjIuaXNBc2NpaUxldHRlcih0aGlzLl9jdXJzb3IucGVlaygpKSkKICAgICAgICAgICAgICAgICAgdGhyb3cgdGhpcy5fY3JlYXRlRXJyb3IoaDIodGhpcy5fY3Vyc29yLnBlZWsoKSksIHRoaXMuX2N1cnNvci5nZXRTcGFuKGUzKSk7CiAgICAgICAgICAgICAgICBmb3IgKGkzID0gdGhpcy5fY29uc3VtZVRhZ09wZW5TdGFydChlMyksIHIyID0gaTMucGFydHNbMF0sIHQyID0gaTMucGFydHNbMV0sIHRoaXMuX2F0dGVtcHRDaGFyQ29kZVVudGlsRm4oZzIpOyB0aGlzLl9jdXJzb3IucGVlaygpICE9PSBuMi4kU0xBU0ggJiYgdGhpcy5fY3Vyc29yLnBlZWsoKSAhPT0gbjIuJEdUOyApIHsKICAgICAgICAgICAgICAgICAgY29uc3QgW2U0LCB0M10gPSB0aGlzLl9jb25zdW1lQXR0cmlidXRlTmFtZSgpOwogICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXR0ZW1wdENoYXJDb2RlVW50aWxGbihnMiksIHRoaXMuX2F0dGVtcHRDaGFyQ29kZShuMi4kRVEpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXR0ZW1wdENoYXJDb2RlVW50aWxGbihnMik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcjMgPSB0aGlzLl9jb25zdW1lQXR0cmlidXRlVmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICBjMy5wdXNoKHsgcHJlZml4OiBlNCwgbmFtZTogdDMsIHZhbHVlOiByMyB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgYzMucHVzaCh7IHByZWZpeDogZTQsIG5hbWU6IHQzIH0pOwogICAgICAgICAgICAgICAgICB0aGlzLl9hdHRlbXB0Q2hhckNvZGVVbnRpbEZuKGcyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2NvbnN1bWVUYWdPcGVuRW5kKCk7CiAgICAgICAgICAgICAgfSBjYXRjaCAodDMpIHsKICAgICAgICAgICAgICAgIGlmICh0MyBpbnN0YW5jZW9mIGYyKQogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3Vyc29yID0gdTMsIGkzICYmICh0aGlzLnRva2Vucy5sZW5ndGggPSBzMyksIHRoaXMuX2JlZ2luVG9rZW4oYTIuVEVYVCwgZTMpLCB2b2lkIHRoaXMuX2VuZFRva2VuKFsiPCJdKTsKICAgICAgICAgICAgICAgIHRocm93IHQzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodGhpcy5fY2FuU2VsZkNsb3NlICYmIHRoaXMudG9rZW5zW3RoaXMudG9rZW5zLmxlbmd0aCAtIDFdLnR5cGUgPT09IGEyLlRBR19PUEVOX0VORF9WT0lEKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIGNvbnN0IGwzID0gdGhpcy5fZ2V0VGFnQ29udGVudFR5cGUodDIsIHIyLCB0aGlzLl9mdWxsTmFtZVN0YWNrLmxlbmd0aCA+IDAsIGMzKTsKICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVGdWxsTmFtZVN0YWNrRm9yVGFnT3BlbihyMiwgdDIpLCBsMyA9PT0gbzIuVGFnQ29udGVudFR5cGUuUkFXX1RFWFQgPyB0aGlzLl9jb25zdW1lUmF3VGV4dFdpdGhUYWdDbG9zZShyMiwgdDIsIGZhbHNlKSA6IGwzID09PSBvMi5UYWdDb250ZW50VHlwZS5FU0NBUEFCTEVfUkFXX1RFWFQgJiYgdGhpcy5fY29uc3VtZVJhd1RleHRXaXRoVGFnQ2xvc2UocjIsIHQyLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfY29uc3VtZVJhd1RleHRXaXRoVGFnQ2xvc2UoZTMsIHQyLCByMikgewogICAgICAgICAgICAgIHRoaXMuX2NvbnN1bWVSYXdUZXh0KHIyLCAoKSA9PiAhIXRoaXMuX2F0dGVtcHRDaGFyQ29kZShuMi4kTFQpICYmICghIXRoaXMuX2F0dGVtcHRDaGFyQ29kZShuMi4kU0xBU0gpICYmICh0aGlzLl9hdHRlbXB0Q2hhckNvZGVVbnRpbEZuKGcyKSwgISF0aGlzLl9hdHRlbXB0U3RyQ2FzZUluc2Vuc2l0aXZlKGUzID8gIiIuY29uY2F0KGUzLCAiOiIpLmNvbmNhdCh0MikgOiB0MikgJiYgKHRoaXMuX2F0dGVtcHRDaGFyQ29kZVVudGlsRm4oZzIpLCB0aGlzLl9hdHRlbXB0Q2hhckNvZGUobjIuJEdUKSkpKSksIHRoaXMuX2JlZ2luVG9rZW4oYTIuVEFHX0NMT1NFKSwgdGhpcy5fcmVxdWlyZUNoYXJDb2RlVW50aWxGbigoZTQpID0+IGU0ID09PSBuMi4kR1QsIDMpLCB0aGlzLl9jdXJzb3IuYWR2YW5jZSgpLCB0aGlzLl9lbmRUb2tlbihbZTMsIHQyXSksIHRoaXMuX2hhbmRsZUZ1bGxOYW1lU3RhY2tGb3JUYWdDbG9zZShlMywgdDIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb25zdW1lVGFnT3BlblN0YXJ0KGUzKSB7CiAgICAgICAgICAgICAgdGhpcy5fYmVnaW5Ub2tlbihhMi5UQUdfT1BFTl9TVEFSVCwgZTMpOwogICAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5fY29uc3VtZVByZWZpeEFuZE5hbWUoKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5kVG9rZW4odDIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb25zdW1lQXR0cmlidXRlTmFtZSgpIHsKICAgICAgICAgICAgICBjb25zdCBlMyA9IHRoaXMuX2N1cnNvci5wZWVrKCk7CiAgICAgICAgICAgICAgaWYgKGUzID09PSBuMi4kU1EgfHwgZTMgPT09IG4yLiREUSkKICAgICAgICAgICAgICAgIHRocm93IHRoaXMuX2NyZWF0ZUVycm9yKGgyKGUzKSwgdGhpcy5fY3Vyc29yLmdldFNwYW4oKSk7CiAgICAgICAgICAgICAgdGhpcy5fYmVnaW5Ub2tlbihhMi5BVFRSX05BTUUpOwogICAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5fY29uc3VtZVByZWZpeEFuZE5hbWUoKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5kVG9rZW4odDIpLCB0MjsKICAgICAgICAgICAgfQogICAgICAgICAgICBfY29uc3VtZUF0dHJpYnV0ZVZhbHVlKCkgewogICAgICAgICAgICAgIGxldCBlMzsKICAgICAgICAgICAgICBpZiAodGhpcy5fY3Vyc29yLnBlZWsoKSA9PT0gbjIuJFNRIHx8IHRoaXMuX2N1cnNvci5wZWVrKCkgPT09IG4yLiREUSkgewogICAgICAgICAgICAgICAgdGhpcy5fYmVnaW5Ub2tlbihhMi5BVFRSX1FVT1RFKTsKICAgICAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5fY3Vyc29yLnBlZWsoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnNvci5hZHZhbmNlKCksIHRoaXMuX2VuZFRva2VuKFtTdHJpbmcuZnJvbUNvZGVQb2ludCh0MildKSwgdGhpcy5fYmVnaW5Ub2tlbihhMi5BVFRSX1ZBTFVFKTsKICAgICAgICAgICAgICAgIGNvbnN0IHIyID0gW107CiAgICAgICAgICAgICAgICBmb3IgKDsgdGhpcy5fY3Vyc29yLnBlZWsoKSAhPT0gdDI7ICkKICAgICAgICAgICAgICAgICAgcjIucHVzaCh0aGlzLl9yZWFkQ2hhcih0cnVlKSk7CiAgICAgICAgICAgICAgICBlMyA9IHRoaXMuX3Byb2Nlc3NDYXJyaWFnZVJldHVybnMocjIuam9pbigiIikpLCB0aGlzLl9lbmRUb2tlbihbZTNdKSwgdGhpcy5fYmVnaW5Ub2tlbihhMi5BVFRSX1FVT1RFKSwgdGhpcy5fY3Vyc29yLmFkdmFuY2UoKSwgdGhpcy5fZW5kVG9rZW4oW1N0cmluZy5mcm9tQ29kZVBvaW50KHQyKV0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9iZWdpblRva2VuKGEyLkFUVFJfVkFMVUUpOwogICAgICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLl9jdXJzb3IuY2xvbmUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVpcmVDaGFyQ29kZVVudGlsRm4obTIsIDEpLCBlMyA9IHRoaXMuX3Byb2Nlc3NDYXJyaWFnZVJldHVybnModGhpcy5fY3Vyc29yLmdldENoYXJzKHQyKSksIHRoaXMuX2VuZFRva2VuKFtlM10pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gZTM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NvbnN1bWVUYWdPcGVuRW5kKCkgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gdGhpcy5fYXR0ZW1wdENoYXJDb2RlKG4yLiRTTEFTSCkgPyBhMi5UQUdfT1BFTl9FTkRfVk9JRCA6IGEyLlRBR19PUEVOX0VORDsKICAgICAgICAgICAgICB0aGlzLl9iZWdpblRva2VuKGUzKSwgdGhpcy5fcmVxdWlyZUNoYXJDb2RlKG4yLiRHVCksIHRoaXMuX2VuZFRva2VuKFtdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfY29uc3VtZVRhZ0Nsb3NlKGUzKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuX2JlZ2luVG9rZW4oYTIuVEFHX0NMT1NFLCBlMyksIHRoaXMuX2F0dGVtcHRDaGFyQ29kZVVudGlsRm4oZzIpLCB0aGlzLl9hbGxvd0h0bUNvbXBvbmVudENsb3NpbmdUYWdzICYmIHRoaXMuX2F0dGVtcHRDaGFyQ29kZShuMi4kU0xBU0gpKQogICAgICAgICAgICAgICAgdGhpcy5fYXR0ZW1wdENoYXJDb2RlVW50aWxGbihnMiksIHRoaXMuX3JlcXVpcmVDaGFyQ29kZShuMi4kR1QpLCB0aGlzLl9lbmRUb2tlbihbXSk7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBbZTQsIHQyXSA9IHRoaXMuX2NvbnN1bWVQcmVmaXhBbmROYW1lKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9hdHRlbXB0Q2hhckNvZGVVbnRpbEZuKGcyKSwgdGhpcy5fcmVxdWlyZUNoYXJDb2RlKG4yLiRHVCksIHRoaXMuX2VuZFRva2VuKFtlNCwgdDJdKSwgdGhpcy5faGFuZGxlRnVsbE5hbWVTdGFja0ZvclRhZ0Nsb3NlKGU0LCB0Mik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jb25zdW1lRXhwYW5zaW9uRm9ybVN0YXJ0KCkgewogICAgICAgICAgICAgIHRoaXMuX2JlZ2luVG9rZW4oYTIuRVhQQU5TSU9OX0ZPUk1fU1RBUlQpLCB0aGlzLl9yZXF1aXJlQ2hhckNvZGUobjIuJExCUkFDRSksIHRoaXMuX2VuZFRva2VuKFtdKSwgdGhpcy5fZXhwYW5zaW9uQ2FzZVN0YWNrLnB1c2goYTIuRVhQQU5TSU9OX0ZPUk1fU1RBUlQpLCB0aGlzLl9iZWdpblRva2VuKGEyLlJBV19URVhUKTsKICAgICAgICAgICAgICBjb25zdCBlMyA9IHRoaXMuX3JlYWRVbnRpbChuMi4kQ09NTUEpOwogICAgICAgICAgICAgIHRoaXMuX2VuZFRva2VuKFtlM10pLCB0aGlzLl9yZXF1aXJlQ2hhckNvZGUobjIuJENPTU1BKSwgdGhpcy5fYXR0ZW1wdENoYXJDb2RlVW50aWxGbihnMiksIHRoaXMuX2JlZ2luVG9rZW4oYTIuUkFXX1RFWFQpOwogICAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5fcmVhZFVudGlsKG4yLiRDT01NQSk7CiAgICAgICAgICAgICAgdGhpcy5fZW5kVG9rZW4oW3QyXSksIHRoaXMuX3JlcXVpcmVDaGFyQ29kZShuMi4kQ09NTUEpLCB0aGlzLl9hdHRlbXB0Q2hhckNvZGVVbnRpbEZuKGcyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfY29uc3VtZUV4cGFuc2lvbkNhc2VTdGFydCgpIHsKICAgICAgICAgICAgICB0aGlzLl9iZWdpblRva2VuKGEyLkVYUEFOU0lPTl9DQVNFX1ZBTFVFKTsKICAgICAgICAgICAgICBjb25zdCBlMyA9IHRoaXMuX3JlYWRVbnRpbChuMi4kTEJSQUNFKS50cmltKCk7CiAgICAgICAgICAgICAgdGhpcy5fZW5kVG9rZW4oW2UzXSksIHRoaXMuX2F0dGVtcHRDaGFyQ29kZVVudGlsRm4oZzIpLCB0aGlzLl9iZWdpblRva2VuKGEyLkVYUEFOU0lPTl9DQVNFX0VYUF9TVEFSVCksIHRoaXMuX3JlcXVpcmVDaGFyQ29kZShuMi4kTEJSQUNFKSwgdGhpcy5fZW5kVG9rZW4oW10pLCB0aGlzLl9hdHRlbXB0Q2hhckNvZGVVbnRpbEZuKGcyKSwgdGhpcy5fZXhwYW5zaW9uQ2FzZVN0YWNrLnB1c2goYTIuRVhQQU5TSU9OX0NBU0VfRVhQX1NUQVJUKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfY29uc3VtZUV4cGFuc2lvbkNhc2VFbmQoKSB7CiAgICAgICAgICAgICAgdGhpcy5fYmVnaW5Ub2tlbihhMi5FWFBBTlNJT05fQ0FTRV9FWFBfRU5EKSwgdGhpcy5fcmVxdWlyZUNoYXJDb2RlKG4yLiRSQlJBQ0UpLCB0aGlzLl9lbmRUb2tlbihbXSksIHRoaXMuX2F0dGVtcHRDaGFyQ29kZVVudGlsRm4oZzIpLCB0aGlzLl9leHBhbnNpb25DYXNlU3RhY2sucG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NvbnN1bWVFeHBhbnNpb25Gb3JtRW5kKCkgewogICAgICAgICAgICAgIHRoaXMuX2JlZ2luVG9rZW4oYTIuRVhQQU5TSU9OX0ZPUk1fRU5EKSwgdGhpcy5fcmVxdWlyZUNoYXJDb2RlKG4yLiRSQlJBQ0UpLCB0aGlzLl9lbmRUb2tlbihbXSksIHRoaXMuX2V4cGFuc2lvbkNhc2VTdGFjay5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfY29uc3VtZVRleHQoKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLl9jdXJzb3IuY2xvbmUoKTsKICAgICAgICAgICAgICB0aGlzLl9iZWdpblRva2VuKGEyLlRFWFQsIGUzKTsKICAgICAgICAgICAgICBjb25zdCB0MiA9IFtdOwogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIHRoaXMuX2ludGVycG9sYXRpb25Db25maWcgJiYgdGhpcy5fYXR0ZW1wdFN0cih0aGlzLl9pbnRlcnBvbGF0aW9uQ29uZmlnLnN0YXJ0KSA/ICh0Mi5wdXNoKHRoaXMuX2ludGVycG9sYXRpb25Db25maWcuc3RhcnQpLCB0aGlzLl9pbkludGVycG9sYXRpb24gPSB0cnVlKSA6IHRoaXMuX2ludGVycG9sYXRpb25Db25maWcgJiYgdGhpcy5faW5JbnRlcnBvbGF0aW9uICYmIHRoaXMuX2F0dGVtcHRTdHIodGhpcy5faW50ZXJwb2xhdGlvbkNvbmZpZy5lbmQpID8gKHQyLnB1c2godGhpcy5faW50ZXJwb2xhdGlvbkNvbmZpZy5lbmQpLCB0aGlzLl9pbkludGVycG9sYXRpb24gPSBmYWxzZSkgOiB0Mi5wdXNoKHRoaXMuX3JlYWRDaGFyKHRydWUpKTsKICAgICAgICAgICAgICB9IHdoaWxlICghdGhpcy5faXNUZXh0RW5kKCkpOwogICAgICAgICAgICAgIHRoaXMuX2VuZFRva2VuKFt0aGlzLl9wcm9jZXNzQ2FycmlhZ2VSZXR1cm5zKHQyLmpvaW4oIiIpKV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9pc1RleHRFbmQoKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuX2N1cnNvci5wZWVrKCkgPT09IG4yLiRMVCB8fCB0aGlzLl9jdXJzb3IucGVlaygpID09PSBuMi4kRU9GKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgaWYgKHRoaXMuX3Rva2VuaXplSWN1ICYmICF0aGlzLl9pbkludGVycG9sYXRpb24pIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRXhwYW5zaW9uRm9ybVN0YXJ0KCkpCiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2N1cnNvci5wZWVrKCkgPT09IG4yLiRSQlJBQ0UgJiYgdGhpcy5faXNJbkV4cGFuc2lvbkNhc2UoKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfcmVhZFVudGlsKGUzKSB7CiAgICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLl9jdXJzb3IuY2xvbmUoKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYXR0ZW1wdFVudGlsQ2hhcihlMyksIHRoaXMuX2N1cnNvci5nZXRDaGFycyh0Mik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2lzSW5FeHBhbnNpb25DYXNlKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9leHBhbnNpb25DYXNlU3RhY2subGVuZ3RoID4gMCAmJiB0aGlzLl9leHBhbnNpb25DYXNlU3RhY2tbdGhpcy5fZXhwYW5zaW9uQ2FzZVN0YWNrLmxlbmd0aCAtIDFdID09PSBhMi5FWFBBTlNJT05fQ0FTRV9FWFBfU1RBUlQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2lzSW5FeHBhbnNpb25Gb3JtKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9leHBhbnNpb25DYXNlU3RhY2subGVuZ3RoID4gMCAmJiB0aGlzLl9leHBhbnNpb25DYXNlU3RhY2tbdGhpcy5fZXhwYW5zaW9uQ2FzZVN0YWNrLmxlbmd0aCAtIDFdID09PSBhMi5FWFBBTlNJT05fRk9STV9TVEFSVDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpc0V4cGFuc2lvbkZvcm1TdGFydCgpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5fY3Vyc29yLnBlZWsoKSAhPT0gbjIuJExCUkFDRSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICBpZiAodGhpcy5faW50ZXJwb2xhdGlvbkNvbmZpZykgewogICAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLl9jdXJzb3IuY2xvbmUoKSwgdDIgPSB0aGlzLl9hdHRlbXB0U3RyKHRoaXMuX2ludGVycG9sYXRpb25Db25maWcuc3RhcnQpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnNvciA9IGUzLCAhdDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9oYW5kbGVGdWxsTmFtZVN0YWNrRm9yVGFnT3BlbihlMywgdDIpIHsKICAgICAgICAgICAgICBjb25zdCByMiA9IG8yLm1lcmdlTnNBbmROYW1lKGUzLCB0Mik7CiAgICAgICAgICAgICAgdGhpcy5fZnVsbE5hbWVTdGFjay5sZW5ndGggIT09IDAgJiYgdGhpcy5fZnVsbE5hbWVTdGFja1t0aGlzLl9mdWxsTmFtZVN0YWNrLmxlbmd0aCAtIDFdICE9PSByMiB8fCB0aGlzLl9mdWxsTmFtZVN0YWNrLnB1c2gocjIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9oYW5kbGVGdWxsTmFtZVN0YWNrRm9yVGFnQ2xvc2UoZTMsIHQyKSB7CiAgICAgICAgICAgICAgY29uc3QgcjIgPSBvMi5tZXJnZU5zQW5kTmFtZShlMywgdDIpOwogICAgICAgICAgICAgIHRoaXMuX2Z1bGxOYW1lU3RhY2subGVuZ3RoICE9PSAwICYmIHRoaXMuX2Z1bGxOYW1lU3RhY2tbdGhpcy5fZnVsbE5hbWVTdGFjay5sZW5ndGggLSAxXSA9PT0gcjIgJiYgdGhpcy5fZnVsbE5hbWVTdGFjay5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gZzIoZTMpIHsKICAgICAgICAgICAgcmV0dXJuICFuMi5pc1doaXRlc3BhY2UoZTMpIHx8IGUzID09PSBuMi4kRU9GOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gbTIoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIG4yLmlzV2hpdGVzcGFjZShlMykgfHwgZTMgPT09IG4yLiRHVCB8fCBlMyA9PT0gbjIuJFNMQVNIIHx8IGUzID09PSBuMi4kU1EgfHwgZTMgPT09IG4yLiREUSB8fCBlMyA9PT0gbjIuJEVROwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gRTIoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzID09IG4yLiRTRU1JQ09MT04gfHwgZTMgPT0gbjIuJEVPRiB8fCAhbjIuaXNBc2NpaUhleERpZ2l0KGUzKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIEMyKGUzKSB7CiAgICAgICAgICAgIHJldHVybiBlMyA9PSBuMi4kU0VNSUNPTE9OIHx8IGUzID09IG4yLiRFT0YgfHwgIW4yLmlzQXNjaWlMZXR0ZXIoZTMpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24geTIoZTMpIHsKICAgICAgICAgICAgcmV0dXJuIGUzID49IG4yLiRhICYmIGUzIDw9IG4yLiR6ID8gZTMgLSBuMi4kYSArIG4yLiRBIDogZTM7CiAgICAgICAgICB9CiAgICAgICAgICBjbGFzcyBiMiB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGUzLCB0MikgewogICAgICAgICAgICAgIGlmIChlMyBpbnN0YW5jZW9mIGIyKQogICAgICAgICAgICAgICAgdGhpcy5maWxlID0gZTMuZmlsZSwgdGhpcy5pbnB1dCA9IGUzLmlucHV0LCB0aGlzLmVuZCA9IGUzLmVuZCwgdGhpcy5zdGF0ZSA9IE9iamVjdC5hc3NpZ24oe30sIGUzLnN0YXRlKTsKICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICghdDIpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUHJvZ3JhbW1pbmcgZXJyb3I6IHRoZSByYW5nZSBhcmd1bWVudCBtdXN0IGJlIHByb3ZpZGVkIHdpdGggYSBmaWxlIGFyZ3VtZW50LiIpOwogICAgICAgICAgICAgICAgdGhpcy5maWxlID0gZTMsIHRoaXMuaW5wdXQgPSBlMy5jb250ZW50LCB0aGlzLmVuZCA9IHQyLmVuZFBvcywgdGhpcy5zdGF0ZSA9IHsgcGVlazogLTEsIG9mZnNldDogdDIuc3RhcnRQb3MsIGxpbmU6IHQyLnN0YXJ0TGluZSwgY29sdW1uOiB0Mi5zdGFydENvbCB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjbG9uZSgpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IGIyKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBlZWsoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUucGVlazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjaGFyc0xlZnQoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW5kIC0gdGhpcy5zdGF0ZS5vZmZzZXQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGlmZihlMykgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLm9mZnNldCAtIGUzLnN0YXRlLm9mZnNldDsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZHZhbmNlKCkgewogICAgICAgICAgICAgIHRoaXMuYWR2YW5jZVN0YXRlKHRoaXMuc3RhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGluaXQoKSB7CiAgICAgICAgICAgICAgdGhpcy51cGRhdGVQZWVrKHRoaXMuc3RhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldFNwYW4oZTMsIHQyKSB7CiAgICAgICAgICAgICAgaWYgKGUzID0gZTMgfHwgdGhpcywgdDIpCiAgICAgICAgICAgICAgICBmb3IgKGUzID0gZTMuY2xvbmUoKTsgdGhpcy5kaWZmKGUzKSA+IDAgJiYgdDIuaW5kZXhPZihlMy5wZWVrKCkpICE9PSAtMTsgKQogICAgICAgICAgICAgICAgICBlMy5hZHZhbmNlKCk7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBpMi5QYXJzZVNvdXJjZVNwYW4obmV3IGkyLlBhcnNlTG9jYXRpb24oZTMuZmlsZSwgZTMuc3RhdGUub2Zmc2V0LCBlMy5zdGF0ZS5saW5lLCBlMy5zdGF0ZS5jb2x1bW4pLCBuZXcgaTIuUGFyc2VMb2NhdGlvbih0aGlzLmZpbGUsIHRoaXMuc3RhdGUub2Zmc2V0LCB0aGlzLnN0YXRlLmxpbmUsIHRoaXMuc3RhdGUuY29sdW1uKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0Q2hhcnMoZTMpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbnB1dC5zdWJzdHJpbmcoZTMuc3RhdGUub2Zmc2V0LCB0aGlzLnN0YXRlLm9mZnNldCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2hhckF0KGUzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXQuY2hhckNvZGVBdChlMyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWR2YW5jZVN0YXRlKGUzKSB7CiAgICAgICAgICAgICAgaWYgKGUzLm9mZnNldCA+PSB0aGlzLmVuZCkKICAgICAgICAgICAgICAgIHRocm93IHRoaXMuc3RhdGUgPSBlMywgbmV3IFQyKCdVbmV4cGVjdGVkIGNoYXJhY3RlciAiRU9GIicsIHRoaXMpOwogICAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5jaGFyQXQoZTMub2Zmc2V0KTsKICAgICAgICAgICAgICB0MiA9PT0gbjIuJExGID8gKGUzLmxpbmUrKywgZTMuY29sdW1uID0gMCkgOiBuMi5pc05ld0xpbmUodDIpIHx8IGUzLmNvbHVtbisrLCBlMy5vZmZzZXQrKywgdGhpcy51cGRhdGVQZWVrKGUzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB1cGRhdGVQZWVrKGUzKSB7CiAgICAgICAgICAgICAgZTMucGVlayA9IGUzLm9mZnNldCA+PSB0aGlzLmVuZCA/IG4yLiRFT0YgOiB0aGlzLmNoYXJBdChlMy5vZmZzZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjbGFzcyBTMiBleHRlbmRzIGIyIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoZTMsIHQyKSB7CiAgICAgICAgICAgICAgZTMgaW5zdGFuY2VvZiBTMiA/IChzdXBlcihlMyksIHRoaXMuaW50ZXJuYWxTdGF0ZSA9IE9iamVjdC5hc3NpZ24oe30sIGUzLmludGVybmFsU3RhdGUpKSA6IChzdXBlcihlMywgdDIpLCB0aGlzLmludGVybmFsU3RhdGUgPSB0aGlzLnN0YXRlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZHZhbmNlKCkgewogICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSB0aGlzLmludGVybmFsU3RhdGUsIHN1cGVyLmFkdmFuY2UoKSwgdGhpcy5wcm9jZXNzRXNjYXBlU2VxdWVuY2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbml0KCkgewogICAgICAgICAgICAgIHN1cGVyLmluaXQoKSwgdGhpcy5wcm9jZXNzRXNjYXBlU2VxdWVuY2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjbG9uZSgpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFMyKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldENoYXJzKGUzKSB7CiAgICAgICAgICAgICAgY29uc3QgdDIgPSBlMy5jbG9uZSgpOwogICAgICAgICAgICAgIGxldCByMiA9ICIiOwogICAgICAgICAgICAgIGZvciAoOyB0Mi5pbnRlcm5hbFN0YXRlLm9mZnNldCA8IHRoaXMuaW50ZXJuYWxTdGF0ZS5vZmZzZXQ7ICkKICAgICAgICAgICAgICAgIHIyICs9IFN0cmluZy5mcm9tQ29kZVBvaW50KHQyLnBlZWsoKSksIHQyLmFkdmFuY2UoKTsKICAgICAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHJvY2Vzc0VzY2FwZVNlcXVlbmNlKCkgewogICAgICAgICAgICAgIGNvbnN0IGUzID0gKCkgPT4gdGhpcy5pbnRlcm5hbFN0YXRlLnBlZWs7CiAgICAgICAgICAgICAgaWYgKGUzKCkgPT09IG4yLiRCQUNLU0xBU0gpCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnRlcm5hbFN0YXRlID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zdGF0ZSksIHRoaXMuYWR2YW5jZVN0YXRlKHRoaXMuaW50ZXJuYWxTdGF0ZSksIGUzKCkgPT09IG4yLiRuKQogICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnBlZWsgPSBuMi4kTEY7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChlMygpID09PSBuMi4kcikKICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5wZWVrID0gbjIuJENSOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoZTMoKSA9PT0gbjIuJHYpCiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUucGVlayA9IG4yLiRWVEFCOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoZTMoKSA9PT0gbjIuJHQpCiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUucGVlayA9IG4yLiRUQUI7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChlMygpID09PSBuMi4kYikKICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5wZWVrID0gbjIuJEJTUEFDRTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGUzKCkgPT09IG4yLiRmKQogICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnBlZWsgPSBuMi4kRkY7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChlMygpID09PSBuMi4kdSkKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWR2YW5jZVN0YXRlKHRoaXMuaW50ZXJuYWxTdGF0ZSksIGUzKCkgPT09IG4yLiRMQlJBQ0UpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFkdmFuY2VTdGF0ZSh0aGlzLmludGVybmFsU3RhdGUpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5jbG9uZSgpOwogICAgICAgICAgICAgICAgICAgIGxldCByMiA9IDA7CiAgICAgICAgICAgICAgICAgICAgZm9yICg7IGUzKCkgIT09IG4yLiRSQlJBQ0U7ICkKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWR2YW5jZVN0YXRlKHRoaXMuaW50ZXJuYWxTdGF0ZSksIHIyKys7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5wZWVrID0gdGhpcy5kZWNvZGVIZXhEaWdpdHModDIsIHIyKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlNCA9IHRoaXMuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFkdmFuY2VTdGF0ZSh0aGlzLmludGVybmFsU3RhdGUpLCB0aGlzLmFkdmFuY2VTdGF0ZSh0aGlzLmludGVybmFsU3RhdGUpLCB0aGlzLmFkdmFuY2VTdGF0ZSh0aGlzLmludGVybmFsU3RhdGUpLCB0aGlzLnN0YXRlLnBlZWsgPSB0aGlzLmRlY29kZUhleERpZ2l0cyhlNCwgNCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGUzKCkgPT09IG4yLiR4KSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuYWR2YW5jZVN0YXRlKHRoaXMuaW50ZXJuYWxTdGF0ZSk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGU0ID0gdGhpcy5jbG9uZSgpOwogICAgICAgICAgICAgICAgICB0aGlzLmFkdmFuY2VTdGF0ZSh0aGlzLmludGVybmFsU3RhdGUpLCB0aGlzLnN0YXRlLnBlZWsgPSB0aGlzLmRlY29kZUhleERpZ2l0cyhlNCwgMik7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG4yLmlzT2N0YWxEaWdpdChlMygpKSkgewogICAgICAgICAgICAgICAgICBsZXQgdDIgPSAiIiwgcjIgPSAwLCBpMyA9IHRoaXMuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgZm9yICg7IG4yLmlzT2N0YWxEaWdpdChlMygpKSAmJiByMiA8IDM7ICkKICAgICAgICAgICAgICAgICAgICBpMyA9IHRoaXMuY2xvbmUoKSwgdDIgKz0gU3RyaW5nLmZyb21Db2RlUG9pbnQoZTMoKSksIHRoaXMuYWR2YW5jZVN0YXRlKHRoaXMuaW50ZXJuYWxTdGF0ZSksIHIyKys7CiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUucGVlayA9IHBhcnNlSW50KHQyLCA4KSwgdGhpcy5pbnRlcm5hbFN0YXRlID0gaTMuaW50ZXJuYWxTdGF0ZTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICBuMi5pc05ld0xpbmUodGhpcy5pbnRlcm5hbFN0YXRlLnBlZWspID8gKHRoaXMuYWR2YW5jZVN0YXRlKHRoaXMuaW50ZXJuYWxTdGF0ZSksIHRoaXMuc3RhdGUgPSB0aGlzLmludGVybmFsU3RhdGUpIDogdGhpcy5zdGF0ZS5wZWVrID0gdGhpcy5pbnRlcm5hbFN0YXRlLnBlZWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVjb2RlSGV4RGlnaXRzKGUzLCB0MikgewogICAgICAgICAgICAgIGNvbnN0IHIyID0gdGhpcy5pbnB1dC5zdWJzdHIoZTMuaW50ZXJuYWxTdGF0ZS5vZmZzZXQsIHQyKSwgbjMgPSBwYXJzZUludChyMiwgMTYpOwogICAgICAgICAgICAgIGlmIChpc05hTihuMykpCiAgICAgICAgICAgICAgICB0aHJvdyBlMy5zdGF0ZSA9IGUzLmludGVybmFsU3RhdGUsIG5ldyBUMigiSW52YWxpZCBoZXhhZGVjaW1hbCBlc2NhcGUgc2VxdWVuY2UiLCBlMyk7CiAgICAgICAgICAgICAgcmV0dXJuIG4zOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjbGFzcyBUMiB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGUzLCB0MikgewogICAgICAgICAgICAgIHRoaXMubXNnID0gZTMsIHRoaXMuY3Vyc29yID0gdDI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGUyLkN1cnNvckVycm9yID0gVDI7CiAgICAgICAgfShjbCksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0bCwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgIGNvbnN0IERsID0gdCwgZmwgPSBybCwgZGwgPSBjbCwgZ2wgPSBRYzsKICAgICAgICBjbGFzcyBtbCBleHRlbmRzIERsLlBhcnNlRXJyb3IgewogICAgICAgICAgY29uc3RydWN0b3IoZTIsIHQyLCByMikgewogICAgICAgICAgICBzdXBlcih0MiwgcjIpLCB0aGlzLmVsZW1lbnROYW1lID0gZTI7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0aWMgY3JlYXRlKGUyLCB0MiwgcjIpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBtbChlMiwgdDIsIHIyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGwuVHJlZUVycm9yID0gbWw7CiAgICAgICAgY2xhc3MgRWwgewogICAgICAgICAgY29uc3RydWN0b3IoZTIsIHQyKSB7CiAgICAgICAgICAgIHRoaXMucm9vdE5vZGVzID0gZTIsIHRoaXMuZXJyb3JzID0gdDI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRsLlBhcnNlVHJlZVJlc3VsdCA9IEVsOwogICAgICAgIHRsLlBhcnNlciA9IGNsYXNzIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKGUyKSB7CiAgICAgICAgICAgIHRoaXMuZ2V0VGFnRGVmaW5pdGlvbiA9IGUyOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2UoZTIsIHQyLCByMikgewogICAgICAgICAgICBsZXQgbjIgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHZvaWQgMCAmJiBhcmd1bWVudHNbM10sIGkyID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgPyBhcmd1bWVudHNbNF0gOiB2b2lkIDA7CiAgICAgICAgICAgIGNvbnN0IHMyID0gKGUzKSA9PiBmdW5jdGlvbih0MykgewogICAgICAgICAgICAgIGZvciAodmFyIHIzID0gYXJndW1lbnRzLmxlbmd0aCwgbjMgPSBuZXcgQXJyYXkocjMgPiAxID8gcjMgLSAxIDogMCksIGkzID0gMTsgaTMgPCByMzsgaTMrKykKICAgICAgICAgICAgICAgIG4zW2kzIC0gMV0gPSBhcmd1bWVudHNbaTNdOwogICAgICAgICAgICAgIHJldHVybiBlMyh0My50b0xvd2VyQ2FzZSgpLCAuLi5uMyk7CiAgICAgICAgICAgIH0sIG8yID0gbjIgPyB0aGlzLmdldFRhZ0RlZmluaXRpb24gOiBzMih0aGlzLmdldFRhZ0RlZmluaXRpb24pLCBhMiA9IChlMykgPT4gbzIoZTMpLmNvbnRlbnRUeXBlLCB1MiA9IG4yID8gaTIgOiBzMihpMiksIGMyID0gaTIgPyAoZTMsIHQzLCByMywgbjMpID0+IHsKICAgICAgICAgICAgICBjb25zdCBpMyA9IHUyKGUzLCB0MywgcjMsIG4zKTsKICAgICAgICAgICAgICByZXR1cm4gaTMgIT09IHZvaWQgMCA/IGkzIDogYTIoZTMpOwogICAgICAgICAgICB9IDogYTIsIGwyID0gZGwudG9rZW5pemUoZTIsIHQyLCBjMiwgcjIpLCBwMiA9IHIyICYmIHIyLmNhblNlbGZDbG9zZSB8fCBmYWxzZSwgaDIgPSByMiAmJiByMi5hbGxvd0h0bUNvbXBvbmVudENsb3NpbmdUYWdzIHx8IGZhbHNlLCBEMiA9IG5ldyBDbChsMi50b2tlbnMsIG8yLCBwMiwgaDIsIG4yKS5idWlsZCgpOwogICAgICAgICAgICByZXR1cm4gbmV3IEVsKEQyLnJvb3ROb2RlcywgbDIuZXJyb3JzLmNvbmNhdChEMi5lcnJvcnMpKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNsYXNzIENsIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKGUyLCB0MiwgcjIsIG4yLCBpMikgewogICAgICAgICAgICB0aGlzLnRva2VucyA9IGUyLCB0aGlzLmdldFRhZ0RlZmluaXRpb24gPSB0MiwgdGhpcy5jYW5TZWxmQ2xvc2UgPSByMiwgdGhpcy5hbGxvd0h0bUNvbXBvbmVudENsb3NpbmdUYWdzID0gbjIsIHRoaXMuaXNUYWdOYW1lQ2FzZVNlbnNpdGl2ZSA9IGkyLCB0aGlzLl9pbmRleCA9IC0xLCB0aGlzLl9yb290Tm9kZXMgPSBbXSwgdGhpcy5fZXJyb3JzID0gW10sIHRoaXMuX2VsZW1lbnRTdGFjayA9IFtdLCB0aGlzLl9hZHZhbmNlKCk7CiAgICAgICAgICB9CiAgICAgICAgICBidWlsZCgpIHsKICAgICAgICAgICAgZm9yICg7IHRoaXMuX3BlZWsudHlwZSAhPT0gZGwuVG9rZW5UeXBlLkVPRjsgKQogICAgICAgICAgICAgIHRoaXMuX3BlZWsudHlwZSA9PT0gZGwuVG9rZW5UeXBlLlRBR19PUEVOX1NUQVJUID8gdGhpcy5fY29uc3VtZVN0YXJ0VGFnKHRoaXMuX2FkdmFuY2UoKSkgOiB0aGlzLl9wZWVrLnR5cGUgPT09IGRsLlRva2VuVHlwZS5UQUdfQ0xPU0UgPyAodGhpcy5fY2xvc2VWb2lkRWxlbWVudCgpLCB0aGlzLl9jb25zdW1lRW5kVGFnKHRoaXMuX2FkdmFuY2UoKSkpIDogdGhpcy5fcGVlay50eXBlID09PSBkbC5Ub2tlblR5cGUuQ0RBVEFfU1RBUlQgPyAodGhpcy5fY2xvc2VWb2lkRWxlbWVudCgpLCB0aGlzLl9jb25zdW1lQ2RhdGEodGhpcy5fYWR2YW5jZSgpKSkgOiB0aGlzLl9wZWVrLnR5cGUgPT09IGRsLlRva2VuVHlwZS5DT01NRU5UX1NUQVJUID8gKHRoaXMuX2Nsb3NlVm9pZEVsZW1lbnQoKSwgdGhpcy5fY29uc3VtZUNvbW1lbnQodGhpcy5fYWR2YW5jZSgpKSkgOiB0aGlzLl9wZWVrLnR5cGUgPT09IGRsLlRva2VuVHlwZS5URVhUIHx8IHRoaXMuX3BlZWsudHlwZSA9PT0gZGwuVG9rZW5UeXBlLlJBV19URVhUIHx8IHRoaXMuX3BlZWsudHlwZSA9PT0gZGwuVG9rZW5UeXBlLkVTQ0FQQUJMRV9SQVdfVEVYVCA/ICh0aGlzLl9jbG9zZVZvaWRFbGVtZW50KCksIHRoaXMuX2NvbnN1bWVUZXh0KHRoaXMuX2FkdmFuY2UoKSkpIDogdGhpcy5fcGVlay50eXBlID09PSBkbC5Ub2tlblR5cGUuRVhQQU5TSU9OX0ZPUk1fU1RBUlQgPyB0aGlzLl9jb25zdW1lRXhwYW5zaW9uKHRoaXMuX2FkdmFuY2UoKSkgOiB0aGlzLl9wZWVrLnR5cGUgPT09IGRsLlRva2VuVHlwZS5ET0NfVFlQRV9TVEFSVCA/IHRoaXMuX2NvbnN1bWVEb2NUeXBlKHRoaXMuX2FkdmFuY2UoKSkgOiB0aGlzLl9hZHZhbmNlKCk7CiAgICAgICAgICAgIHJldHVybiBuZXcgRWwodGhpcy5fcm9vdE5vZGVzLCB0aGlzLl9lcnJvcnMpOwogICAgICAgICAgfQogICAgICAgICAgX2FkdmFuY2UoKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5fcGVlazsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luZGV4IDwgdGhpcy50b2tlbnMubGVuZ3RoIC0gMSAmJiB0aGlzLl9pbmRleCsrLCB0aGlzLl9wZWVrID0gdGhpcy50b2tlbnNbdGhpcy5faW5kZXhdLCBlMjsKICAgICAgICAgIH0KICAgICAgICAgIF9hZHZhbmNlSWYoZTIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BlZWsudHlwZSA9PT0gZTIgPyB0aGlzLl9hZHZhbmNlKCkgOiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgX2NvbnN1bWVDZGF0YShlMikgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuX2FkdmFuY2UoKSwgcjIgPSB0aGlzLl9nZXRUZXh0KHQyKSwgbjIgPSB0aGlzLl9hZHZhbmNlSWYoZGwuVG9rZW5UeXBlLkNEQVRBX0VORCk7CiAgICAgICAgICAgIHRoaXMuX2FkZFRvUGFyZW50KG5ldyBmbC5DREFUQShyMiwgbmV3IERsLlBhcnNlU291cmNlU3BhbihlMi5zb3VyY2VTcGFuLnN0YXJ0LCAobjIgfHwgdDIpLnNvdXJjZVNwYW4uZW5kKSkpOwogICAgICAgICAgfQogICAgICAgICAgX2NvbnN1bWVDb21tZW50KGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5fYWR2YW5jZUlmKGRsLlRva2VuVHlwZS5SQVdfVEVYVCksIHIyID0gdGhpcy5fYWR2YW5jZUlmKGRsLlRva2VuVHlwZS5DT01NRU5UX0VORCksIG4yID0gdDIgIT0gbnVsbCA/IHQyLnBhcnRzWzBdLnRyaW0oKSA6IG51bGwsIGkyID0gbmV3IERsLlBhcnNlU291cmNlU3BhbihlMi5zb3VyY2VTcGFuLnN0YXJ0LCAocjIgfHwgdDIgfHwgZTIpLnNvdXJjZVNwYW4uZW5kKTsKICAgICAgICAgICAgdGhpcy5fYWRkVG9QYXJlbnQobmV3IGZsLkNvbW1lbnQobjIsIGkyKSk7CiAgICAgICAgICB9CiAgICAgICAgICBfY29uc3VtZURvY1R5cGUoZTIpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLl9hZHZhbmNlSWYoZGwuVG9rZW5UeXBlLlJBV19URVhUKSwgcjIgPSB0aGlzLl9hZHZhbmNlSWYoZGwuVG9rZW5UeXBlLkRPQ19UWVBFX0VORCksIG4yID0gdDIgIT0gbnVsbCA/IHQyLnBhcnRzWzBdLnRyaW0oKSA6IG51bGwsIGkyID0gbmV3IERsLlBhcnNlU291cmNlU3BhbihlMi5zb3VyY2VTcGFuLnN0YXJ0LCAocjIgfHwgdDIgfHwgZTIpLnNvdXJjZVNwYW4uZW5kKTsKICAgICAgICAgICAgdGhpcy5fYWRkVG9QYXJlbnQobmV3IGZsLkRvY1R5cGUobjIsIGkyKSk7CiAgICAgICAgICB9CiAgICAgICAgICBfY29uc3VtZUV4cGFuc2lvbihlMikgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuX2FkdmFuY2UoKSwgcjIgPSB0aGlzLl9hZHZhbmNlKCksIG4yID0gW107CiAgICAgICAgICAgIGZvciAoOyB0aGlzLl9wZWVrLnR5cGUgPT09IGRsLlRva2VuVHlwZS5FWFBBTlNJT05fQ0FTRV9WQUxVRTsgKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLl9wYXJzZUV4cGFuc2lvbkNhc2UoKTsKICAgICAgICAgICAgICBpZiAoIWUzKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIG4yLnB1c2goZTMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9wZWVrLnR5cGUgIT09IGRsLlRva2VuVHlwZS5FWFBBTlNJT05fRk9STV9FTkQpCiAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5fZXJyb3JzLnB1c2gobWwuY3JlYXRlKG51bGwsIHRoaXMuX3BlZWsuc291cmNlU3BhbiwgIkludmFsaWQgSUNVIG1lc3NhZ2UuIE1pc3NpbmcgJ30nLiIpKTsKICAgICAgICAgICAgY29uc3QgaTIgPSBuZXcgRGwuUGFyc2VTb3VyY2VTcGFuKGUyLnNvdXJjZVNwYW4uc3RhcnQsIHRoaXMuX3BlZWsuc291cmNlU3Bhbi5lbmQpOwogICAgICAgICAgICB0aGlzLl9hZGRUb1BhcmVudChuZXcgZmwuRXhwYW5zaW9uKHQyLnBhcnRzWzBdLCByMi5wYXJ0c1swXSwgbjIsIGkyLCB0Mi5zb3VyY2VTcGFuKSksIHRoaXMuX2FkdmFuY2UoKTsKICAgICAgICAgIH0KICAgICAgICAgIF9wYXJzZUV4cGFuc2lvbkNhc2UoKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdGhpcy5fYWR2YW5jZSgpOwogICAgICAgICAgICBpZiAodGhpcy5fcGVlay50eXBlICE9PSBkbC5Ub2tlblR5cGUuRVhQQU5TSU9OX0NBU0VfRVhQX1NUQVJUKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lcnJvcnMucHVzaChtbC5jcmVhdGUobnVsbCwgdGhpcy5fcGVlay5zb3VyY2VTcGFuLCAiSW52YWxpZCBJQ1UgbWVzc2FnZS4gTWlzc2luZyAneycuIikpLCBudWxsOwogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuX2FkdmFuY2UoKSwgcjIgPSB0aGlzLl9jb2xsZWN0RXhwYW5zaW9uRXhwVG9rZW5zKHQyKTsKICAgICAgICAgICAgaWYgKCFyMikKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgY29uc3QgbjIgPSB0aGlzLl9hZHZhbmNlKCk7CiAgICAgICAgICAgIHIyLnB1c2gobmV3IGRsLlRva2VuKGRsLlRva2VuVHlwZS5FT0YsIFtdLCBuMi5zb3VyY2VTcGFuKSk7CiAgICAgICAgICAgIGNvbnN0IGkyID0gbmV3IENsKHIyLCB0aGlzLmdldFRhZ0RlZmluaXRpb24sIHRoaXMuY2FuU2VsZkNsb3NlLCB0aGlzLmFsbG93SHRtQ29tcG9uZW50Q2xvc2luZ1RhZ3MsIHRoaXMuaXNUYWdOYW1lQ2FzZVNlbnNpdGl2ZSkuYnVpbGQoKTsKICAgICAgICAgICAgaWYgKGkyLmVycm9ycy5sZW5ndGggPiAwKQogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lcnJvcnMgPSB0aGlzLl9lcnJvcnMuY29uY2F0KGkyLmVycm9ycyksIG51bGw7CiAgICAgICAgICAgIGNvbnN0IHMyID0gbmV3IERsLlBhcnNlU291cmNlU3BhbihlMi5zb3VyY2VTcGFuLnN0YXJ0LCBuMi5zb3VyY2VTcGFuLmVuZCksIG8yID0gbmV3IERsLlBhcnNlU291cmNlU3Bhbih0Mi5zb3VyY2VTcGFuLnN0YXJ0LCBuMi5zb3VyY2VTcGFuLmVuZCk7CiAgICAgICAgICAgIHJldHVybiBuZXcgZmwuRXhwYW5zaW9uQ2FzZShlMi5wYXJ0c1swXSwgaTIucm9vdE5vZGVzLCBzMiwgZTIuc291cmNlU3BhbiwgbzIpOwogICAgICAgICAgfQogICAgICAgICAgX2NvbGxlY3RFeHBhbnNpb25FeHBUb2tlbnMoZTIpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSBbXSwgcjIgPSBbZGwuVG9rZW5UeXBlLkVYUEFOU0lPTl9DQVNFX0VYUF9TVEFSVF07CiAgICAgICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgICAgIGlmICh0aGlzLl9wZWVrLnR5cGUgIT09IGRsLlRva2VuVHlwZS5FWFBBTlNJT05fRk9STV9TVEFSVCAmJiB0aGlzLl9wZWVrLnR5cGUgIT09IGRsLlRva2VuVHlwZS5FWFBBTlNJT05fQ0FTRV9FWFBfU1RBUlQgfHwgcjIucHVzaCh0aGlzLl9wZWVrLnR5cGUpLCB0aGlzLl9wZWVrLnR5cGUgPT09IGRsLlRva2VuVHlwZS5FWFBBTlNJT05fQ0FTRV9FWFBfRU5EKSB7CiAgICAgICAgICAgICAgICBpZiAoIXlsKHIyLCBkbC5Ub2tlblR5cGUuRVhQQU5TSU9OX0NBU0VfRVhQX1NUQVJUKSkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Vycm9ycy5wdXNoKG1sLmNyZWF0ZShudWxsLCBlMi5zb3VyY2VTcGFuLCAiSW52YWxpZCBJQ1UgbWVzc2FnZS4gTWlzc2luZyAnfScuIikpLCBudWxsOwogICAgICAgICAgICAgICAgaWYgKHIyLnBvcCgpLCByMi5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodGhpcy5fcGVlay50eXBlID09PSBkbC5Ub2tlblR5cGUuRVhQQU5TSU9OX0ZPUk1fRU5EKSB7CiAgICAgICAgICAgICAgICBpZiAoIXlsKHIyLCBkbC5Ub2tlblR5cGUuRVhQQU5TSU9OX0ZPUk1fU1RBUlQpKQogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZXJyb3JzLnB1c2gobWwuY3JlYXRlKG51bGwsIGUyLnNvdXJjZVNwYW4sICJJbnZhbGlkIElDVSBtZXNzYWdlLiBNaXNzaW5nICd9Jy4iKSksIG51bGw7CiAgICAgICAgICAgICAgICByMi5wb3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHRoaXMuX3BlZWsudHlwZSA9PT0gZGwuVG9rZW5UeXBlLkVPRikKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lcnJvcnMucHVzaChtbC5jcmVhdGUobnVsbCwgZTIuc291cmNlU3BhbiwgIkludmFsaWQgSUNVIG1lc3NhZ2UuIE1pc3NpbmcgJ30nLiIpKSwgbnVsbDsKICAgICAgICAgICAgICB0Mi5wdXNoKHRoaXMuX2FkdmFuY2UoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIF9nZXRUZXh0KGUyKSB7CiAgICAgICAgICAgIGxldCB0MiA9IGUyLnBhcnRzWzBdOwogICAgICAgICAgICBpZiAodDIubGVuZ3RoID4gMCAmJiB0MlswXSA9PSAiXG4iKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLl9nZXRQYXJlbnRFbGVtZW50KCk7CiAgICAgICAgICAgICAgZTMgIT0gbnVsbCAmJiBlMy5jaGlsZHJlbi5sZW5ndGggPT0gMCAmJiB0aGlzLmdldFRhZ0RlZmluaXRpb24oZTMubmFtZSkuaWdub3JlRmlyc3RMZiAmJiAodDIgPSB0Mi5zdWJzdHJpbmcoMSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICAgIH0KICAgICAgICAgIF9jb25zdW1lVGV4dChlMikgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuX2dldFRleHQoZTIpOwogICAgICAgICAgICB0Mi5sZW5ndGggPiAwICYmIHRoaXMuX2FkZFRvUGFyZW50KG5ldyBmbC5UZXh0KHQyLCBlMi5zb3VyY2VTcGFuKSk7CiAgICAgICAgICB9CiAgICAgICAgICBfY2xvc2VWb2lkRWxlbWVudCgpIHsKICAgICAgICAgICAgY29uc3QgZTIgPSB0aGlzLl9nZXRQYXJlbnRFbGVtZW50KCk7CiAgICAgICAgICAgIGUyICYmIHRoaXMuZ2V0VGFnRGVmaW5pdGlvbihlMi5uYW1lKS5pc1ZvaWQgJiYgdGhpcy5fZWxlbWVudFN0YWNrLnBvcCgpOwogICAgICAgICAgfQogICAgICAgICAgX2NvbnN1bWVTdGFydFRhZyhlMikgewogICAgICAgICAgICBjb25zdCB0MiA9IGUyLnBhcnRzWzBdLCByMiA9IGUyLnBhcnRzWzFdLCBuMiA9IFtdOwogICAgICAgICAgICBmb3IgKDsgdGhpcy5fcGVlay50eXBlID09PSBkbC5Ub2tlblR5cGUuQVRUUl9OQU1FOyApCiAgICAgICAgICAgICAgbjIucHVzaCh0aGlzLl9jb25zdW1lQXR0cih0aGlzLl9hZHZhbmNlKCkpKTsKICAgICAgICAgICAgY29uc3QgaTIgPSB0aGlzLl9nZXRFbGVtZW50RnVsbE5hbWUodDIsIHIyLCB0aGlzLl9nZXRQYXJlbnRFbGVtZW50KCkpOwogICAgICAgICAgICBsZXQgczIgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuX3BlZWsudHlwZSA9PT0gZGwuVG9rZW5UeXBlLlRBR19PUEVOX0VORF9WT0lEKSB7CiAgICAgICAgICAgICAgdGhpcy5fYWR2YW5jZSgpLCBzMiA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSB0aGlzLmdldFRhZ0RlZmluaXRpb24oaTIpOwogICAgICAgICAgICAgIHRoaXMuY2FuU2VsZkNsb3NlIHx8IHQzLmNhblNlbGZDbG9zZSB8fCBnbC5nZXROc1ByZWZpeChpMikgIT09IG51bGwgfHwgdDMuaXNWb2lkIHx8IHRoaXMuX2Vycm9ycy5wdXNoKG1sLmNyZWF0ZShpMiwgZTIuc291cmNlU3BhbiwgJ09ubHkgdm9pZCBhbmQgZm9yZWlnbiBlbGVtZW50cyBjYW4gYmUgc2VsZiBjbG9zZWQgIicuY29uY2F0KGUyLnBhcnRzWzFdLCAnIicpKSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIHRoaXMuX3BlZWsudHlwZSA9PT0gZGwuVG9rZW5UeXBlLlRBR19PUEVOX0VORCAmJiAodGhpcy5fYWR2YW5jZSgpLCBzMiA9IGZhbHNlKTsKICAgICAgICAgICAgY29uc3QgbzIgPSB0aGlzLl9wZWVrLnNvdXJjZVNwYW4uc3RhcnQsIGEyID0gbmV3IERsLlBhcnNlU291cmNlU3BhbihlMi5zb3VyY2VTcGFuLnN0YXJ0LCBvMiksIHUyID0gbmV3IERsLlBhcnNlU291cmNlU3BhbihlMi5zb3VyY2VTcGFuLnN0YXJ0Lm1vdmVCeSgxKSwgZTIuc291cmNlU3Bhbi5lbmQpLCBjMiA9IG5ldyBmbC5FbGVtZW50KGkyLCBuMiwgW10sIGEyLCBhMiwgdm9pZCAwLCB1Mik7CiAgICAgICAgICAgIHRoaXMuX3B1c2hFbGVtZW50KGMyKSwgczIgJiYgKHRoaXMuX3BvcEVsZW1lbnQoaTIpLCBjMi5lbmRTb3VyY2VTcGFuID0gYTIpOwogICAgICAgICAgfQogICAgICAgICAgX3B1c2hFbGVtZW50KGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5fZ2V0UGFyZW50RWxlbWVudCgpOwogICAgICAgICAgICB0MiAmJiB0aGlzLmdldFRhZ0RlZmluaXRpb24odDIubmFtZSkuaXNDbG9zZWRCeUNoaWxkKGUyLm5hbWUpICYmIHRoaXMuX2VsZW1lbnRTdGFjay5wb3AoKSwgdGhpcy5fYWRkVG9QYXJlbnQoZTIpLCB0aGlzLl9lbGVtZW50U3RhY2sucHVzaChlMik7CiAgICAgICAgICB9CiAgICAgICAgICBfY29uc3VtZUVuZFRhZyhlMikgewogICAgICAgICAgICBjb25zdCB0MiA9IHRoaXMuYWxsb3dIdG1Db21wb25lbnRDbG9zaW5nVGFncyAmJiBlMi5wYXJ0cy5sZW5ndGggPT09IDAgPyBudWxsIDogdGhpcy5fZ2V0RWxlbWVudEZ1bGxOYW1lKGUyLnBhcnRzWzBdLCBlMi5wYXJ0c1sxXSwgdGhpcy5fZ2V0UGFyZW50RWxlbWVudCgpKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2dldFBhcmVudEVsZW1lbnQoKSAmJiAodGhpcy5fZ2V0UGFyZW50RWxlbWVudCgpLmVuZFNvdXJjZVNwYW4gPSBlMi5zb3VyY2VTcGFuKSwgdDIgJiYgdGhpcy5nZXRUYWdEZWZpbml0aW9uKHQyKS5pc1ZvaWQpCiAgICAgICAgICAgICAgdGhpcy5fZXJyb3JzLnB1c2gobWwuY3JlYXRlKHQyLCBlMi5zb3VyY2VTcGFuLCAnVm9pZCBlbGVtZW50cyBkbyBub3QgaGF2ZSBlbmQgdGFncyAiJy5jb25jYXQoZTIucGFydHNbMV0sICciJykpKTsKICAgICAgICAgICAgZWxzZSBpZiAoIXRoaXMuX3BvcEVsZW1lbnQodDIpKSB7CiAgICAgICAgICAgICAgY29uc3QgcjIgPSAnVW5leHBlY3RlZCBjbG9zaW5nIHRhZyAiJy5jb25jYXQodDIsICciLiBJdCBtYXkgaGFwcGVuIHdoZW4gdGhlIHRhZyBoYXMgYWxyZWFkeSBiZWVuIGNsb3NlZCBieSBhbm90aGVyIHRhZy4gRm9yIG1vcmUgaW5mbyBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL2h0bWw1L3N5bnRheC5odG1sI2Nsb3NpbmctZWxlbWVudHMtdGhhdC1oYXZlLWltcGxpZWQtZW5kLXRhZ3MnKTsKICAgICAgICAgICAgICB0aGlzLl9lcnJvcnMucHVzaChtbC5jcmVhdGUodDIsIGUyLnNvdXJjZVNwYW4sIHIyKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIF9wb3BFbGVtZW50KGUyKSB7CiAgICAgICAgICAgIGZvciAobGV0IHQyID0gdGhpcy5fZWxlbWVudFN0YWNrLmxlbmd0aCAtIDE7IHQyID49IDA7IHQyLS0pIHsKICAgICAgICAgICAgICBjb25zdCByMiA9IHRoaXMuX2VsZW1lbnRTdGFja1t0Ml07CiAgICAgICAgICAgICAgaWYgKCFlMiB8fCAoZ2wuZ2V0TnNQcmVmaXgocjIubmFtZSkgPyByMi5uYW1lID09IGUyIDogcjIubmFtZS50b0xvd2VyQ2FzZSgpID09IGUyLnRvTG93ZXJDYXNlKCkpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VsZW1lbnRTdGFjay5zcGxpY2UodDIsIHRoaXMuX2VsZW1lbnRTdGFjay5sZW5ndGggLSB0MiksIHRydWU7CiAgICAgICAgICAgICAgaWYgKCF0aGlzLmdldFRhZ0RlZmluaXRpb24ocjIubmFtZSkuY2xvc2VkQnlQYXJlbnQpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgX2NvbnN1bWVBdHRyKGUyKSB7CiAgICAgICAgICAgIGNvbnN0IHQyID0gZ2wubWVyZ2VOc0FuZE5hbWUoZTIucGFydHNbMF0sIGUyLnBhcnRzWzFdKTsKICAgICAgICAgICAgbGV0IHIyLCBuMiwgaTIgPSBlMi5zb3VyY2VTcGFuLmVuZCwgczIgPSAiIjsKICAgICAgICAgICAgaWYgKHRoaXMuX3BlZWsudHlwZSA9PT0gZGwuVG9rZW5UeXBlLkFUVFJfUVVPVEUpIHsKICAgICAgICAgICAgICBuMiA9IHRoaXMuX2FkdmFuY2UoKS5zb3VyY2VTcGFuLnN0YXJ0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9wZWVrLnR5cGUgPT09IGRsLlRva2VuVHlwZS5BVFRSX1ZBTFVFKSB7CiAgICAgICAgICAgICAgY29uc3QgZTMgPSB0aGlzLl9hZHZhbmNlKCk7CiAgICAgICAgICAgICAgczIgPSBlMy5wYXJ0c1swXSwgaTIgPSBlMy5zb3VyY2VTcGFuLmVuZCwgcjIgPSBlMy5zb3VyY2VTcGFuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9wZWVrLnR5cGUgPT09IGRsLlRva2VuVHlwZS5BVFRSX1FVT1RFKSB7CiAgICAgICAgICAgICAgaTIgPSB0aGlzLl9hZHZhbmNlKCkuc291cmNlU3Bhbi5lbmQsIHIyID0gbmV3IERsLlBhcnNlU291cmNlU3BhbihuMiwgaTIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuZXcgZmwuQXR0cmlidXRlKHQyLCBzMiwgbmV3IERsLlBhcnNlU291cmNlU3BhbihlMi5zb3VyY2VTcGFuLnN0YXJ0LCBpMiksIHIyLCBlMi5zb3VyY2VTcGFuKTsKICAgICAgICAgIH0KICAgICAgICAgIF9nZXRQYXJlbnRFbGVtZW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZWxlbWVudFN0YWNrLmxlbmd0aCA+IDAgPyB0aGlzLl9lbGVtZW50U3RhY2tbdGhpcy5fZWxlbWVudFN0YWNrLmxlbmd0aCAtIDFdIDogbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIF9nZXRQYXJlbnRFbGVtZW50U2tpcHBpbmdDb250YWluZXJzKCkgewogICAgICAgICAgICBsZXQgZTIgPSBudWxsOwogICAgICAgICAgICBmb3IgKGxldCB0MiA9IHRoaXMuX2VsZW1lbnRTdGFjay5sZW5ndGggLSAxOyB0MiA+PSAwOyB0Mi0tKSB7CiAgICAgICAgICAgICAgaWYgKCFnbC5pc05nQ29udGFpbmVyKHRoaXMuX2VsZW1lbnRTdGFja1t0Ml0ubmFtZSkpCiAgICAgICAgICAgICAgICByZXR1cm4geyBwYXJlbnQ6IHRoaXMuX2VsZW1lbnRTdGFja1t0Ml0sIGNvbnRhaW5lcjogZTIgfTsKICAgICAgICAgICAgICBlMiA9IHRoaXMuX2VsZW1lbnRTdGFja1t0Ml07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHsgcGFyZW50OiBudWxsLCBjb250YWluZXI6IGUyIH07CiAgICAgICAgICB9CiAgICAgICAgICBfYWRkVG9QYXJlbnQoZTIpIHsKICAgICAgICAgICAgY29uc3QgdDIgPSB0aGlzLl9nZXRQYXJlbnRFbGVtZW50KCk7CiAgICAgICAgICAgIHQyICE9IG51bGwgPyB0Mi5jaGlsZHJlbi5wdXNoKGUyKSA6IHRoaXMuX3Jvb3ROb2Rlcy5wdXNoKGUyKTsKICAgICAgICAgIH0KICAgICAgICAgIF9pbnNlcnRCZWZvcmVDb250YWluZXIoZTIsIHQyLCByMikgewogICAgICAgICAgICBpZiAodDIpIHsKICAgICAgICAgICAgICBpZiAoZTIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG4yID0gZTIuY2hpbGRyZW4uaW5kZXhPZih0Mik7CiAgICAgICAgICAgICAgICBlMi5jaGlsZHJlbltuMl0gPSByMjsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIHRoaXMuX3Jvb3ROb2Rlcy5wdXNoKHIyKTsKICAgICAgICAgICAgICByMi5jaGlsZHJlbi5wdXNoKHQyKSwgdGhpcy5fZWxlbWVudFN0YWNrLnNwbGljZSh0aGlzLl9lbGVtZW50U3RhY2suaW5kZXhPZih0MiksIDAsIHIyKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgdGhpcy5fYWRkVG9QYXJlbnQocjIpLCB0aGlzLl9lbGVtZW50U3RhY2sucHVzaChyMik7CiAgICAgICAgICB9CiAgICAgICAgICBfZ2V0RWxlbWVudEZ1bGxOYW1lKGUyLCB0MiwgcjIpIHsKICAgICAgICAgICAgcmV0dXJuIGUyID09PSAiIiAmJiAoZTIgPSB0aGlzLmdldFRhZ0RlZmluaXRpb24odDIpLmltcGxpY2l0TmFtZXNwYWNlUHJlZml4IHx8ICIiKSA9PT0gIiIgJiYgcjIgIT0gbnVsbCAmJiAoZTIgPSBnbC5nZXROc1ByZWZpeChyMi5uYW1lKSksIGdsLm1lcmdlTnNBbmROYW1lKGUyLCB0Mik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHlsKGUyLCB0MikgewogICAgICAgICAgcmV0dXJuIGUyLmxlbmd0aCA+IDAgJiYgZTJbZTIubGVuZ3RoIC0gMV0gPT09IHQyOwogICAgICAgIH0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV2MsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgICBjb25zdCBibCA9IFljLCBTbCA9IHRsOwogICAgICAgIHZhciBUbCA9IHRsOwogICAgICAgIFdjLlBhcnNlVHJlZVJlc3VsdCA9IFRsLlBhcnNlVHJlZVJlc3VsdCwgV2MuVHJlZUVycm9yID0gVGwuVHJlZUVycm9yOwogICAgICAgIGNsYXNzIF9sIGV4dGVuZHMgU2wuUGFyc2VyIHsKICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICBzdXBlcihibC5nZXRIdG1sVGFnRGVmaW5pdGlvbik7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZShlMiwgdDIsIHIyKSB7CiAgICAgICAgICAgIGxldCBuMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdm9pZCAwICYmIGFyZ3VtZW50c1szXSwgaTIgPSBhcmd1bWVudHMubGVuZ3RoID4gNCA/IGFyZ3VtZW50c1s0XSA6IHZvaWQgMDsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnBhcnNlKGUyLCB0MiwgcjIsIG4yLCBpMik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFdjLkh0bWxQYXJzZXIgPSBfbCwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHpjLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgY29uc3QgdmwgPSBXYywgQWwgPSBRYzsKICAgICAgICB6Yy5UYWdDb250ZW50VHlwZSA9IEFsLlRhZ0NvbnRlbnRUeXBlOwogICAgICAgIGxldCBGbCA9IG51bGw7CiAgICAgICAgY29uc3Qgd2wgPSAoKSA9PiAoRmwgfHwgKEZsID0gbmV3IHZsLkh0bWxQYXJzZXIoKSksIEZsKTsKICAgICAgICB6Yy5wYXJzZSA9IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICBsZXQgdDIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICAgICAgY29uc3QgeyBjYW5TZWxmQ2xvc2U6IHIyID0gZmFsc2UsIGFsbG93SHRtQ29tcG9uZW50Q2xvc2luZ1RhZ3M6IG4yID0gZmFsc2UsIGlzVGFnTmFtZUNhc2VTZW5zaXRpdmU6IGkyID0gZmFsc2UsIGdldFRhZ0NvbnRlbnRUeXBlOiBzMiB9ID0gdDI7CiAgICAgICAgICByZXR1cm4gd2woKS5wYXJzZShlMiwgImFuZ3VsYXItaHRtbC1wYXJzZXIiLCB7IHRva2VuaXplRXhwYW5zaW9uRm9ybXM6IGZhbHNlLCBpbnRlcnBvbGF0aW9uQ29uZmlnOiB2b2lkIDAsIGNhblNlbGZDbG9zZTogcjIsIGFsbG93SHRtQ29tcG9uZW50Q2xvc2luZ1RhZ3M6IG4yIH0sIGkyLCBzMik7CiAgICAgICAgfTsKICAgICAgICBjb25zdCB7IFBhcnNlU291cmNlU3Bhbjoga2wsIFBhcnNlTG9jYXRpb246IE5sLCBQYXJzZVNvdXJjZUZpbGU6IE9sIH0gPSB0LCB4bCA9IEUsIElsID0gQywgUGwgPSB5LCB7IGluZmVyUGFyc2VyQnlMYW5ndWFnZTogUmwgfSA9IEphLCB7IEhUTUxfRUxFTUVOVF9BVFRSSUJVVEVTOiBMbCwgSFRNTF9UQUdTOiBCbCwgaXNVbmtub3duTmFtZXNwYWNlOiBxbCB9ID0gUGMsIHsgaGFzUHJhZ21hOiAkbCB9ID0gUmMsIHsgTm9kZTogTWwgfSA9IFVjLCB7IHBhcnNlSWVDb25kaXRpb25hbENvbW1lbnQ6IGpsIH0gPSBYYywgeyBsb2NTdGFydDogVWwsIGxvY0VuZDogR2wgfSA9IEhjOwogICAgICAgIGZ1bmN0aW9uIFZsKGUyLCByMiwgbjIpIHsKICAgICAgICAgIGxldCB7IHJlY29nbml6ZVNlbGZDbG9zaW5nOiBpMiwgbm9ybWFsaXplVGFnTmFtZTogczIsIG5vcm1hbGl6ZUF0dHJpYnV0ZU5hbWU6IG8yLCBhbGxvd0h0bUNvbXBvbmVudENsb3NpbmdUYWdzOiBhMiwgaXNUYWdOYW1lQ2FzZVNlbnNpdGl2ZTogdTIsIGdldFRhZ0NvbnRlbnRUeXBlOiBjMiB9ID0gcjI7CiAgICAgICAgICBjb25zdCBsMiA9IHpjLCB7IFJlY3Vyc2l2ZVZpc2l0b3I6IHAyLCB2aXNpdEFsbDogaDIgfSA9IHJsLCB7IFBhcnNlU291cmNlU3BhbjogRDIgfSA9IHQsIHsgZ2V0SHRtbFRhZ0RlZmluaXRpb246IGYyIH0gPSBZYzsKICAgICAgICAgIGxldCB7IHJvb3ROb2RlczogZDIsIGVycm9yczogZzIgfSA9IGwyLnBhcnNlKGUyLCB7IGNhblNlbGZDbG9zZTogaTIsIGFsbG93SHRtQ29tcG9uZW50Q2xvc2luZ1RhZ3M6IGEyLCBpc1RhZ05hbWVDYXNlU2Vuc2l0aXZlOiB1MiwgZ2V0VGFnQ29udGVudFR5cGU6IGMyIH0pOwogICAgICAgICAgaWYgKG4yLnBhcnNlciA9PT0gInZ1ZSIpIHsKICAgICAgICAgICAgaWYgKGQyLnNvbWUoKGUzKSA9PiBlMy50eXBlID09PSAiZG9jVHlwZSIgJiYgZTMudmFsdWUgPT09ICJodG1sIiB8fCBlMy50eXBlID09PSAiZWxlbWVudCIgJiYgZTMubmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaHRtbCIpKSB7CiAgICAgICAgICAgICAgaTIgPSB0cnVlLCBzMiA9IHRydWUsIG8yID0gdHJ1ZSwgYTIgPSB0cnVlLCB1MiA9IGZhbHNlOwogICAgICAgICAgICAgIGNvbnN0IHQyID0gbDIucGFyc2UoZTIsIHsgY2FuU2VsZkNsb3NlOiBpMiwgYWxsb3dIdG1Db21wb25lbnRDbG9zaW5nVGFnczogYTIsIGlzVGFnTmFtZUNhc2VTZW5zaXRpdmU6IHUyIH0pOwogICAgICAgICAgICAgIGQyID0gdDIucm9vdE5vZGVzLCBnMiA9IHQyLmVycm9yczsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb25zdCB0MiA9IChlMykgPT4gewogICAgICAgICAgICAgICAgaWYgKCFlMykKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGUzLnR5cGUgIT09ICJlbGVtZW50IiB8fCBlMy5uYW1lICE9PSAidGVtcGxhdGUiKQogICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IGUzLmF0dHJzLmZpbmQoKGU0KSA9PiBlNC5uYW1lID09PSAibGFuZyIpLCByMyA9IHQzICYmIHQzLnZhbHVlOwogICAgICAgICAgICAgICAgcmV0dXJuICFyMyB8fCBSbChyMywgbjIpID09PSAiaHRtbCI7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBpZiAoZDIuc29tZSh0MikpIHsKICAgICAgICAgICAgICAgIGxldCByMzsKICAgICAgICAgICAgICAgIGNvbnN0IG4zID0gKCkgPT4gbDIucGFyc2UoZTIsIHsgY2FuU2VsZkNsb3NlOiBpMiwgYWxsb3dIdG1Db21wb25lbnRDbG9zaW5nVGFnczogYTIsIGlzVGFnTmFtZUNhc2VTZW5zaXRpdmU6IHUyIH0pLCBzMyA9ICgpID0+IHIzIHx8IChyMyA9IG4zKCkpLCBvMyA9IChlMykgPT4gczMoKS5yb290Tm9kZXMuZmluZCgodDMpID0+IHsKICAgICAgICAgICAgICAgICAgbGV0IHsgc3RhcnRTb3VyY2VTcGFuOiByNCB9ID0gdDM7CiAgICAgICAgICAgICAgICAgIHJldHVybiByNCAmJiByNC5zdGFydC5vZmZzZXQgPT09IGUzLnN0YXJ0U291cmNlU3Bhbi5zdGFydC5vZmZzZXQ7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGUzID0gMDsgZTMgPCBkMi5sZW5ndGg7IGUzKyspIHsKICAgICAgICAgICAgICAgICAgY29uc3QgcjQgPSBkMltlM10sIHsgZW5kU291cmNlU3BhbjogbjQsIHN0YXJ0U291cmNlU3BhbjogaTMgfSA9IHI0OwogICAgICAgICAgICAgICAgICBpZiAobjQgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBnMiA9IHMzKCkuZXJyb3JzLCBkMltlM10gPSBvMyhyNCkgfHwgcjQ7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodDIocjQpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdDMgPSBzMygpLCBhMyA9IGkzLmVuZC5vZmZzZXQsIHUzID0gbjQuc3RhcnQub2Zmc2V0OwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZTQgb2YgdDMuZXJyb3JzKSB7CiAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IG9mZnNldDogdDQgfSA9IGU0LnNwYW4uc3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYTMgPCB0NCAmJiB0NCA8IHUzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGcyID0gW2U0XTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGQyW2UzXSA9IG8zKHI0KSB8fCByNDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGcyLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgeyBtc2c6IGUzLCBzcGFuOiB7IHN0YXJ0OiB0MiwgZW5kOiByMyB9IH0gPSBnMlswXTsKICAgICAgICAgICAgdGhyb3cgUGwoZTMsIHsgc3RhcnQ6IHsgbGluZTogdDIubGluZSArIDEsIGNvbHVtbjogdDIuY29sICsgMSB9LCBlbmQ6IHsgbGluZTogcjMubGluZSArIDEsIGNvbHVtbjogcjMuY29sICsgMSB9IH0pOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgbTIgPSAoZTMpID0+IHsKICAgICAgICAgICAgY29uc3QgdDIgPSBlMy5uYW1lLnN0YXJ0c1dpdGgoIjoiKSA/IGUzLm5hbWUuc2xpY2UoMSkuc3BsaXQoIjoiKVswXSA6IG51bGwsIHIzID0gZTMubmFtZVNwYW4udG9TdHJpbmcoKSwgbjMgPSB0MiAhPT0gbnVsbCAmJiByMy5zdGFydHNXaXRoKCIiLmNvbmNhdCh0MiwgIjoiKSksIGkzID0gbjMgPyByMy5zbGljZSh0Mi5sZW5ndGggKyAxKSA6IHIzOwogICAgICAgICAgICBlMy5uYW1lID0gaTMsIGUzLm5hbWVzcGFjZSA9IHQyLCBlMy5oYXNFeHBsaWNpdE5hbWVzcGFjZSA9IG4zOwogICAgICAgICAgfSwgRTIgPSAoZTMsIHQyKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHIzID0gZTMudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgcmV0dXJuIHQyKHIzKSA/IHIzIDogZTM7CiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIGgyKG5ldyBjbGFzcyBleHRlbmRzIHAyIHsKICAgICAgICAgICAgdmlzaXQoZTMpIHsKICAgICAgICAgICAgICAoKGU0KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZTQudHlwZSA9PT0gImVsZW1lbnQiKSB7CiAgICAgICAgICAgICAgICAgIG0yKGU0KTsKICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCB0MiBvZiBlNC5hdHRycykKICAgICAgICAgICAgICAgICAgICBtMih0MiksIHQyLnZhbHVlU3BhbiA/ICh0Mi52YWx1ZSA9IHQyLnZhbHVlU3Bhbi50b1N0cmluZygpLCAvWyInXS8udGVzdCh0Mi52YWx1ZVswXSkgJiYgKHQyLnZhbHVlID0gdDIudmFsdWUuc2xpY2UoMSwgLTEpKSkgOiB0Mi52YWx1ZSA9IG51bGw7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgZTQudHlwZSA9PT0gImNvbW1lbnQiID8gZTQudmFsdWUgPSBlNC5zb3VyY2VTcGFuLnRvU3RyaW5nKCkuc2xpY2UoIjwhLS0iLmxlbmd0aCwgLSItLT4iLmxlbmd0aCkgOiBlNC50eXBlID09PSAidGV4dCIgJiYgKGU0LnZhbHVlID0gZTQuc291cmNlU3Bhbi50b1N0cmluZygpKTsKICAgICAgICAgICAgICB9KShlMyksICgoZTQpID0+IHsKICAgICAgICAgICAgICAgIGlmIChlNC50eXBlID09PSAiZWxlbWVudCIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdDIgPSBmMih1MiA/IGU0Lm5hbWUgOiBlNC5uYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICAgICAgICAhZTQubmFtZXNwYWNlIHx8IGU0Lm5hbWVzcGFjZSA9PT0gdDIuaW1wbGljaXROYW1lc3BhY2VQcmVmaXggfHwgcWwoZTQpID8gZTQudGFnRGVmaW5pdGlvbiA9IHQyIDogZTQudGFnRGVmaW5pdGlvbiA9IGYyKCIiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KShlMyksICgoZTQpID0+IHsKICAgICAgICAgICAgICAgIGlmIChlNC50eXBlID09PSAiZWxlbWVudCIgJiYgKCFzMiB8fCBlNC5uYW1lc3BhY2UgJiYgZTQubmFtZXNwYWNlICE9PSBlNC50YWdEZWZpbml0aW9uLmltcGxpY2l0TmFtZXNwYWNlUHJlZml4ICYmICFxbChlNCkgfHwgKGU0Lm5hbWUgPSBFMihlNC5uYW1lLCAoZTUpID0+IGU1IGluIEJsKSksIG8yKSkgewogICAgICAgICAgICAgICAgICBjb25zdCB0MiA9IExsW2U0Lm5hbWVdIHx8IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHIzIG9mIGU0LmF0dHJzKQogICAgICAgICAgICAgICAgICAgIHIzLm5hbWVzcGFjZSB8fCAocjMubmFtZSA9IEUyKHIzLm5hbWUsIChyNCkgPT4gZTQubmFtZSBpbiBMbCAmJiAocjQgaW4gTGxbIioiXSB8fCByNCBpbiB0MikpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KShlMyksICgoZTQpID0+IHsKICAgICAgICAgICAgICAgIGU0LnNvdXJjZVNwYW4gJiYgZTQuZW5kU291cmNlU3BhbiAmJiAoZTQuc291cmNlU3BhbiA9IG5ldyBEMihlNC5zb3VyY2VTcGFuLnN0YXJ0LCBlNC5lbmRTb3VyY2VTcGFuLmVuZCkpOwogICAgICAgICAgICAgIH0pKGUzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSgpLCBkMiksIGQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBYbChlMiwgdDIsIHIyKSB7CiAgICAgICAgICBsZXQgbjIgPSAhKGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdm9pZCAwKSB8fCBhcmd1bWVudHNbM107CiAgICAgICAgICBjb25zdCB7IGZyb250TWF0dGVyOiBpMiwgY29udGVudDogczIgfSA9IG4yID8geGwoZTIpIDogeyBmcm9udE1hdHRlcjogbnVsbCwgY29udGVudDogZTIgfSwgbzIgPSBuZXcgT2woZTIsIHQyLmZpbGVwYXRoKSwgYTIgPSBuZXcgTmwobzIsIDAsIDAsIDApLCB1MiA9IGEyLm1vdmVCeShlMi5sZW5ndGgpLCBjMiA9IHsgdHlwZTogInJvb3QiLCBzb3VyY2VTcGFuOiBuZXcga2woYTIsIHUyKSwgY2hpbGRyZW46IFZsKHMyLCByMiwgdDIpIH07CiAgICAgICAgICBpZiAoaTIpIHsKICAgICAgICAgICAgY29uc3QgZTMgPSBuZXcgTmwobzIsIDAsIDAsIDApLCB0MyA9IGUzLm1vdmVCeShpMi5yYXcubGVuZ3RoKTsKICAgICAgICAgICAgaTIuc291cmNlU3BhbiA9IG5ldyBrbChlMywgdDMpLCBjMi5jaGlsZHJlbi51bnNoaWZ0KGkyKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGwyID0gbmV3IE1sKGMyKSwgcDIgPSAobjMsIGkzKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHsgb2Zmc2V0OiBzMyB9ID0gaTMsIG8zID0gWGwoZTIuc2xpY2UoMCwgczMpLnJlcGxhY2UoL1teXG5ccl0vZywgIiAiKSArIG4zLCB0MiwgcjIsIGZhbHNlKTsKICAgICAgICAgICAgbzMuc291cmNlU3BhbiA9IG5ldyBrbChpMywgSWwobzMuY2hpbGRyZW4pLnNvdXJjZVNwYW4uZW5kKTsKICAgICAgICAgICAgY29uc3QgYTMgPSBvMy5jaGlsZHJlblswXTsKICAgICAgICAgICAgcmV0dXJuIGEzLmxlbmd0aCA9PT0gczMgPyBvMy5jaGlsZHJlbi5zaGlmdCgpIDogKGEzLnNvdXJjZVNwYW4gPSBuZXcga2woYTMuc291cmNlU3Bhbi5zdGFydC5tb3ZlQnkoczMpLCBhMy5zb3VyY2VTcGFuLmVuZCksIGEzLnZhbHVlID0gYTMudmFsdWUuc2xpY2UoczMpKSwgbzM7CiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIGwyLm1hcCgoZTMpID0+IHsKICAgICAgICAgICAgaWYgKGUzLnR5cGUgPT09ICJjb21tZW50IikgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gamwoZTMsIHAyKTsKICAgICAgICAgICAgICBpZiAodDMpCiAgICAgICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGUzOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEhsKCkgewogICAgICAgICAgbGV0IHsgbmFtZTogZTIsIHJlY29nbml6ZVNlbGZDbG9zaW5nOiB0MiA9IGZhbHNlLCBub3JtYWxpemVUYWdOYW1lOiByMiA9IGZhbHNlLCBub3JtYWxpemVBdHRyaWJ1dGVOYW1lOiBuMiA9IGZhbHNlLCBhbGxvd0h0bUNvbXBvbmVudENsb3NpbmdUYWdzOiBpMiA9IGZhbHNlLCBpc1RhZ05hbWVDYXNlU2Vuc2l0aXZlOiBzMiA9IGZhbHNlLCBnZXRUYWdDb250ZW50VHlwZTogbzIgfSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzBdIDoge307CiAgICAgICAgICByZXR1cm4geyBwYXJzZTogKGEyLCB1MiwgYzIpID0+IFhsKGEyLCBPYmplY3QuYXNzaWduKHsgcGFyc2VyOiBlMiB9LCBjMiksIHsgcmVjb2duaXplU2VsZkNsb3Npbmc6IHQyLCBub3JtYWxpemVUYWdOYW1lOiByMiwgbm9ybWFsaXplQXR0cmlidXRlTmFtZTogbjIsIGFsbG93SHRtQ29tcG9uZW50Q2xvc2luZ1RhZ3M6IGkyLCBpc1RhZ05hbWVDYXNlU2Vuc2l0aXZlOiBzMiwgZ2V0VGFnQ29udGVudFR5cGU6IG8yIH0pLCBoYXNQcmFnbWE6ICRsLCBhc3RGb3JtYXQ6ICJodG1sIiwgbG9jU3RhcnQ6IFVsLCBsb2NFbmQ6IEdsIH07CiAgICAgICAgfQogICAgICAgIHZhciB6bCA9IHsgcGFyc2VyczogeyBodG1sOiBIbCh7IG5hbWU6ICJodG1sIiwgcmVjb2duaXplU2VsZkNsb3Npbmc6IHRydWUsIG5vcm1hbGl6ZVRhZ05hbWU6IHRydWUsIG5vcm1hbGl6ZUF0dHJpYnV0ZU5hbWU6IHRydWUsIGFsbG93SHRtQ29tcG9uZW50Q2xvc2luZ1RhZ3M6IHRydWUgfSksIGFuZ3VsYXI6IEhsKHsgbmFtZTogImFuZ3VsYXIiIH0pLCB2dWU6IEhsKHsgbmFtZTogInZ1ZSIsIHJlY29nbml6ZVNlbGZDbG9zaW5nOiB0cnVlLCBpc1RhZ05hbWVDYXNlU2Vuc2l0aXZlOiB0cnVlLCBnZXRUYWdDb250ZW50VHlwZTogKGUyLCB0MiwgcjIsIG4yKSA9PiB7CiAgICAgICAgICBpZiAoZTIudG9Mb3dlckNhc2UoKSAhPT0gImh0bWwiICYmICFyMiAmJiAoZTIgIT09ICJ0ZW1wbGF0ZSIgfHwgbjIuc29tZSgoZTMpID0+IHsKICAgICAgICAgICAgbGV0IHsgbmFtZTogdDMsIHZhbHVlOiByMyB9ID0gZTM7CiAgICAgICAgICAgIHJldHVybiB0MyA9PT0gImxhbmciICYmIHIzICE9PSAiaHRtbCI7CiAgICAgICAgICB9KSkpCiAgICAgICAgICAgIHJldHVybiB6Yy5UYWdDb250ZW50VHlwZS5SQVdfVEVYVDsKICAgICAgICB9IH0pLCBsd2M6IEhsKHsgbmFtZTogImx3YyIgfSkgfSB9OwogICAgICAgIHJldHVybiB6bDsKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIC8vIC4uLy4uL25vZGVfbW9kdWxlcy9jb21saW5rL2Rpc3QvZXNtL2NvbWxpbmsubWpzCiAgdmFyIHByb3h5TWFya2VyID0gU3ltYm9sKCJDb21saW5rLnByb3h5Iik7CiAgdmFyIGNyZWF0ZUVuZHBvaW50ID0gU3ltYm9sKCJDb21saW5rLmVuZHBvaW50Iik7CiAgdmFyIHJlbGVhc2VQcm94eSA9IFN5bWJvbCgiQ29tbGluay5yZWxlYXNlUHJveHkiKTsKICB2YXIgdGhyb3dNYXJrZXIgPSBTeW1ib2woIkNvbWxpbmsudGhyb3duIik7CiAgdmFyIGlzT2JqZWN0ID0gKHZhbCkgPT4gdHlwZW9mIHZhbCA9PT0gIm9iamVjdCIgJiYgdmFsICE9PSBudWxsIHx8IHR5cGVvZiB2YWwgPT09ICJmdW5jdGlvbiI7CiAgdmFyIHByb3h5VHJhbnNmZXJIYW5kbGVyID0gewogICAgY2FuSGFuZGxlOiAodmFsKSA9PiBpc09iamVjdCh2YWwpICYmIHZhbFtwcm94eU1hcmtlcl0sCiAgICBzZXJpYWxpemUob2JqKSB7CiAgICAgIGNvbnN0IHsgcG9ydDEsIHBvcnQyIH0gPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTsKICAgICAgZXhwb3NlKG9iaiwgcG9ydDEpOwogICAgICByZXR1cm4gW3BvcnQyLCBbcG9ydDJdXTsKICAgIH0sCiAgICBkZXNlcmlhbGl6ZShwb3J0KSB7CiAgICAgIHBvcnQuc3RhcnQoKTsKICAgICAgcmV0dXJuIHdyYXAocG9ydCk7CiAgICB9CiAgfTsKICB2YXIgdGhyb3dUcmFuc2ZlckhhbmRsZXIgPSB7CiAgICBjYW5IYW5kbGU6ICh2YWx1ZSkgPT4gaXNPYmplY3QodmFsdWUpICYmIHRocm93TWFya2VyIGluIHZhbHVlLAogICAgc2VyaWFsaXplKHsgdmFsdWUgfSkgewogICAgICBsZXQgc2VyaWFsaXplZDsKICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgICBzZXJpYWxpemVkID0gewogICAgICAgICAgaXNFcnJvcjogdHJ1ZSwKICAgICAgICAgIHZhbHVlOiB7CiAgICAgICAgICAgIG1lc3NhZ2U6IHZhbHVlLm1lc3NhZ2UsCiAgICAgICAgICAgIG5hbWU6IHZhbHVlLm5hbWUsCiAgICAgICAgICAgIHN0YWNrOiB2YWx1ZS5zdGFjawogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VyaWFsaXplZCA9IHsgaXNFcnJvcjogZmFsc2UsIHZhbHVlIH07CiAgICAgIH0KICAgICAgcmV0dXJuIFtzZXJpYWxpemVkLCBbXV07CiAgICB9LAogICAgZGVzZXJpYWxpemUoc2VyaWFsaXplZCkgewogICAgICBpZiAoc2VyaWFsaXplZC5pc0Vycm9yKSB7CiAgICAgICAgdGhyb3cgT2JqZWN0LmFzc2lnbihuZXcgRXJyb3Ioc2VyaWFsaXplZC52YWx1ZS5tZXNzYWdlKSwgc2VyaWFsaXplZC52YWx1ZSk7CiAgICAgIH0KICAgICAgdGhyb3cgc2VyaWFsaXplZC52YWx1ZTsKICAgIH0KICB9OwogIHZhciB0cmFuc2ZlckhhbmRsZXJzID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoWwogICAgWyJwcm94eSIsIHByb3h5VHJhbnNmZXJIYW5kbGVyXSwKICAgIFsidGhyb3ciLCB0aHJvd1RyYW5zZmVySGFuZGxlcl0KICBdKTsKICBmdW5jdGlvbiBleHBvc2Uob2JqLCBlcCA9IHNlbGYpIHsKICAgIGVwLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBmdW5jdGlvbiBjYWxsYmFjayhldikgewogICAgICBpZiAoIWV2IHx8ICFldi5kYXRhKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IHsgaWQsIHR5cGUsIHBhdGggfSA9IE9iamVjdC5hc3NpZ24oeyBwYXRoOiBbXSB9LCBldi5kYXRhKTsKICAgICAgY29uc3QgYXJndW1lbnRMaXN0ID0gKGV2LmRhdGEuYXJndW1lbnRMaXN0IHx8IFtdKS5tYXAoZnJvbVdpcmVWYWx1ZSk7CiAgICAgIGxldCByZXR1cm5WYWx1ZTsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBwYXJlbnQgPSBwYXRoLnNsaWNlKDAsIC0xKS5yZWR1Y2UoKG9iajIsIHByb3ApID0+IG9iajJbcHJvcF0sIG9iaik7CiAgICAgICAgY29uc3QgcmF3VmFsdWUgPSBwYXRoLnJlZHVjZSgob2JqMiwgcHJvcCkgPT4gb2JqMltwcm9wXSwgb2JqKTsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgIGNhc2UgIkdFVCI6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHJhd1ZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiU0VUIjoKICAgICAgICAgICAgewogICAgICAgICAgICAgIHBhcmVudFtwYXRoLnNsaWNlKC0xKVswXV0gPSBmcm9tV2lyZVZhbHVlKGV2LmRhdGEudmFsdWUpOwogICAgICAgICAgICAgIHJldHVyblZhbHVlID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgIkFQUExZIjoKICAgICAgICAgICAgewogICAgICAgICAgICAgIHJldHVyblZhbHVlID0gcmF3VmFsdWUuYXBwbHkocGFyZW50LCBhcmd1bWVudExpc3QpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiQ09OU1RSVUNUIjoKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbmV3IHJhd1ZhbHVlKC4uLmFyZ3VtZW50TGlzdCk7CiAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBwcm94eSh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJFTkRQT0lOVCI6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb25zdCB7IHBvcnQxLCBwb3J0MiB9ID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7CiAgICAgICAgICAgICAgZXhwb3NlKG9iaiwgcG9ydDIpOwogICAgICAgICAgICAgIHJldHVyblZhbHVlID0gdHJhbnNmZXIocG9ydDEsIFtwb3J0MV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiUkVMRUFTRSI6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHZvaWQgMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuVmFsdWUgPSB7IHZhbHVlLCBbdGhyb3dNYXJrZXJdOiAwIH07CiAgICAgIH0KICAgICAgUHJvbWlzZS5yZXNvbHZlKHJldHVyblZhbHVlKS5jYXRjaCgodmFsdWUpID0+IHsKICAgICAgICByZXR1cm4geyB2YWx1ZSwgW3Rocm93TWFya2VyXTogMCB9OwogICAgICB9KS50aGVuKChyZXR1cm5WYWx1ZTIpID0+IHsKICAgICAgICBjb25zdCBbd2lyZVZhbHVlLCB0cmFuc2ZlcmFibGVzXSA9IHRvV2lyZVZhbHVlKHJldHVyblZhbHVlMik7CiAgICAgICAgZXAucG9zdE1lc3NhZ2UoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB3aXJlVmFsdWUpLCB7IGlkIH0pLCB0cmFuc2ZlcmFibGVzKTsKICAgICAgICBpZiAodHlwZSA9PT0gIlJFTEVBU0UiKSB7CiAgICAgICAgICBlcC5yZW1vdmVFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgY2FsbGJhY2spOwogICAgICAgICAgY2xvc2VFbmRQb2ludChlcCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogICAgaWYgKGVwLnN0YXJ0KSB7CiAgICAgIGVwLnN0YXJ0KCk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGlzTWVzc2FnZVBvcnQoZW5kcG9pbnQpIHsKICAgIHJldHVybiBlbmRwb2ludC5jb25zdHJ1Y3Rvci5uYW1lID09PSAiTWVzc2FnZVBvcnQiOwogIH0KICBmdW5jdGlvbiBjbG9zZUVuZFBvaW50KGVuZHBvaW50KSB7CiAgICBpZiAoaXNNZXNzYWdlUG9ydChlbmRwb2ludCkpCiAgICAgIGVuZHBvaW50LmNsb3NlKCk7CiAgfQogIGZ1bmN0aW9uIHdyYXAoZXAsIHRhcmdldCkgewogICAgcmV0dXJuIGNyZWF0ZVByb3h5KGVwLCBbXSwgdGFyZ2V0KTsKICB9CiAgZnVuY3Rpb24gdGhyb3dJZlByb3h5UmVsZWFzZWQoaXNSZWxlYXNlZCkgewogICAgaWYgKGlzUmVsZWFzZWQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJQcm94eSBoYXMgYmVlbiByZWxlYXNlZCBhbmQgaXMgbm90IHVzZWFibGUiKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gY3JlYXRlUHJveHkoZXAsIHBhdGggPSBbXSwgdGFyZ2V0ID0gZnVuY3Rpb24oKSB7CiAgfSkgewogICAgbGV0IGlzUHJveHlSZWxlYXNlZCA9IGZhbHNlOwogICAgY29uc3QgcHJveHkyID0gbmV3IFByb3h5KHRhcmdldCwgewogICAgICBnZXQoX3RhcmdldCwgcHJvcCkgewogICAgICAgIHRocm93SWZQcm94eVJlbGVhc2VkKGlzUHJveHlSZWxlYXNlZCk7CiAgICAgICAgaWYgKHByb3AgPT09IHJlbGVhc2VQcm94eSkgewogICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHsKICAgICAgICAgICAgICB0eXBlOiAiUkVMRUFTRSIsCiAgICAgICAgICAgICAgcGF0aDogcGF0aC5tYXAoKHApID0+IHAudG9TdHJpbmcoKSkKICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgY2xvc2VFbmRQb2ludChlcCk7CiAgICAgICAgICAgICAgaXNQcm94eVJlbGVhc2VkID0gdHJ1ZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAocHJvcCA9PT0gInRoZW4iKSB7CiAgICAgICAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHsgdGhlbjogKCkgPT4gcHJveHkyIH07CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCByID0gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwgewogICAgICAgICAgICB0eXBlOiAiR0VUIiwKICAgICAgICAgICAgcGF0aDogcGF0aC5tYXAoKHApID0+IHAudG9TdHJpbmcoKSkKICAgICAgICAgIH0pLnRoZW4oZnJvbVdpcmVWYWx1ZSk7CiAgICAgICAgICByZXR1cm4gci50aGVuLmJpbmQocik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjcmVhdGVQcm94eShlcCwgWy4uLnBhdGgsIHByb3BdKTsKICAgICAgfSwKICAgICAgc2V0KF90YXJnZXQsIHByb3AsIHJhd1ZhbHVlKSB7CiAgICAgICAgdGhyb3dJZlByb3h5UmVsZWFzZWQoaXNQcm94eVJlbGVhc2VkKTsKICAgICAgICBjb25zdCBbdmFsdWUsIHRyYW5zZmVyYWJsZXNdID0gdG9XaXJlVmFsdWUocmF3VmFsdWUpOwogICAgICAgIHJldHVybiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCB7CiAgICAgICAgICB0eXBlOiAiU0VUIiwKICAgICAgICAgIHBhdGg6IFsuLi5wYXRoLCBwcm9wXS5tYXAoKHApID0+IHAudG9TdHJpbmcoKSksCiAgICAgICAgICB2YWx1ZQogICAgICAgIH0sIHRyYW5zZmVyYWJsZXMpLnRoZW4oZnJvbVdpcmVWYWx1ZSk7CiAgICAgIH0sCiAgICAgIGFwcGx5KF90YXJnZXQsIF90aGlzQXJnLCByYXdBcmd1bWVudExpc3QpIHsKICAgICAgICB0aHJvd0lmUHJveHlSZWxlYXNlZChpc1Byb3h5UmVsZWFzZWQpOwogICAgICAgIGNvbnN0IGxhc3QgPSBwYXRoW3BhdGgubGVuZ3RoIC0gMV07CiAgICAgICAgaWYgKGxhc3QgPT09IGNyZWF0ZUVuZHBvaW50KSB7CiAgICAgICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwgewogICAgICAgICAgICB0eXBlOiAiRU5EUE9JTlQiCiAgICAgICAgICB9KS50aGVuKGZyb21XaXJlVmFsdWUpOwogICAgICAgIH0KICAgICAgICBpZiAobGFzdCA9PT0gImJpbmQiKSB7CiAgICAgICAgICByZXR1cm4gY3JlYXRlUHJveHkoZXAsIHBhdGguc2xpY2UoMCwgLTEpKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgW2FyZ3VtZW50TGlzdCwgdHJhbnNmZXJhYmxlc10gPSBwcm9jZXNzQXJndW1lbnRzKHJhd0FyZ3VtZW50TGlzdCk7CiAgICAgICAgcmV0dXJuIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHsKICAgICAgICAgIHR5cGU6ICJBUFBMWSIsCiAgICAgICAgICBwYXRoOiBwYXRoLm1hcCgocCkgPT4gcC50b1N0cmluZygpKSwKICAgICAgICAgIGFyZ3VtZW50TGlzdAogICAgICAgIH0sIHRyYW5zZmVyYWJsZXMpLnRoZW4oZnJvbVdpcmVWYWx1ZSk7CiAgICAgIH0sCiAgICAgIGNvbnN0cnVjdChfdGFyZ2V0LCByYXdBcmd1bWVudExpc3QpIHsKICAgICAgICB0aHJvd0lmUHJveHlSZWxlYXNlZChpc1Byb3h5UmVsZWFzZWQpOwogICAgICAgIGNvbnN0IFthcmd1bWVudExpc3QsIHRyYW5zZmVyYWJsZXNdID0gcHJvY2Vzc0FyZ3VtZW50cyhyYXdBcmd1bWVudExpc3QpOwogICAgICAgIHJldHVybiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCB7CiAgICAgICAgICB0eXBlOiAiQ09OU1RSVUNUIiwKICAgICAgICAgIHBhdGg6IHBhdGgubWFwKChwKSA9PiBwLnRvU3RyaW5nKCkpLAogICAgICAgICAgYXJndW1lbnRMaXN0CiAgICAgICAgfSwgdHJhbnNmZXJhYmxlcykudGhlbihmcm9tV2lyZVZhbHVlKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcHJveHkyOwogIH0KICBmdW5jdGlvbiBteUZsYXQoYXJyKSB7CiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmNvbmNhdC5hcHBseShbXSwgYXJyKTsKICB9CiAgZnVuY3Rpb24gcHJvY2Vzc0FyZ3VtZW50cyhhcmd1bWVudExpc3QpIHsKICAgIGNvbnN0IHByb2Nlc3NlZCA9IGFyZ3VtZW50TGlzdC5tYXAodG9XaXJlVmFsdWUpOwogICAgcmV0dXJuIFtwcm9jZXNzZWQubWFwKCh2KSA9PiB2WzBdKSwgbXlGbGF0KHByb2Nlc3NlZC5tYXAoKHYpID0+IHZbMV0pKV07CiAgfQogIHZhciB0cmFuc2ZlckNhY2hlID0gLyogQF9fUFVSRV9fICovIG5ldyBXZWFrTWFwKCk7CiAgZnVuY3Rpb24gdHJhbnNmZXIob2JqLCB0cmFuc2ZlcnMpIHsKICAgIHRyYW5zZmVyQ2FjaGUuc2V0KG9iaiwgdHJhbnNmZXJzKTsKICAgIHJldHVybiBvYmo7CiAgfQogIGZ1bmN0aW9uIHByb3h5KG9iaikgewogICAgcmV0dXJuIE9iamVjdC5hc3NpZ24ob2JqLCB7IFtwcm94eU1hcmtlcl06IHRydWUgfSk7CiAgfQogIGZ1bmN0aW9uIHRvV2lyZVZhbHVlKHZhbHVlKSB7CiAgICBmb3IgKGNvbnN0IFtuYW1lLCBoYW5kbGVyXSBvZiB0cmFuc2ZlckhhbmRsZXJzKSB7CiAgICAgIGlmIChoYW5kbGVyLmNhbkhhbmRsZSh2YWx1ZSkpIHsKICAgICAgICBjb25zdCBbc2VyaWFsaXplZFZhbHVlLCB0cmFuc2ZlcmFibGVzXSA9IGhhbmRsZXIuc2VyaWFsaXplKHZhbHVlKTsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgewogICAgICAgICAgICB0eXBlOiAiSEFORExFUiIsCiAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgIHZhbHVlOiBzZXJpYWxpemVkVmFsdWUKICAgICAgICAgIH0sCiAgICAgICAgICB0cmFuc2ZlcmFibGVzCiAgICAgICAgXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIFsKICAgICAgewogICAgICAgIHR5cGU6ICJSQVciLAogICAgICAgIHZhbHVlCiAgICAgIH0sCiAgICAgIHRyYW5zZmVyQ2FjaGUuZ2V0KHZhbHVlKSB8fCBbXQogICAgXTsKICB9CiAgZnVuY3Rpb24gZnJvbVdpcmVWYWx1ZSh2YWx1ZSkgewogICAgc3dpdGNoICh2YWx1ZS50eXBlKSB7CiAgICAgIGNhc2UgIkhBTkRMRVIiOgogICAgICAgIHJldHVybiB0cmFuc2ZlckhhbmRsZXJzLmdldCh2YWx1ZS5uYW1lKS5kZXNlcmlhbGl6ZSh2YWx1ZS52YWx1ZSk7CiAgICAgIGNhc2UgIlJBVyI6CiAgICAgICAgcmV0dXJuIHZhbHVlLnZhbHVlOwogICAgfQogIH0KICBmdW5jdGlvbiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCBtc2csIHRyYW5zZmVycykgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgIGNvbnN0IGlkID0gZ2VuZXJhdGVVVUlEKCk7CiAgICAgIGVwLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBmdW5jdGlvbiBsKGV2KSB7CiAgICAgICAgaWYgKCFldi5kYXRhIHx8ICFldi5kYXRhLmlkIHx8IGV2LmRhdGEuaWQgIT09IGlkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGVwLnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBsKTsKICAgICAgICByZXNvbHZlKGV2LmRhdGEpOwogICAgICB9KTsKICAgICAgaWYgKGVwLnN0YXJ0KSB7CiAgICAgICAgZXAuc3RhcnQoKTsKICAgICAgfQogICAgICBlcC5wb3N0TWVzc2FnZShPYmplY3QuYXNzaWduKHsgaWQgfSwgbXNnKSwgdHJhbnNmZXJzKTsKICAgIH0pOwogIH0KICBmdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKSB7CiAgICByZXR1cm4gbmV3IEFycmF5KDQpLmZpbGwoMCkubWFwKCgpID0+IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKS50b1N0cmluZygxNikpLmpvaW4oIi0iKTsKICB9CgogIC8vIGpzL3dvcmtlcnMvcHJldHRpZXIud29ya2VyLmpzCiAgdmFyIGltcG9ydF9zdGFuZGFsb25lID0gX190b0VTTShyZXF1aXJlX3N0YW5kYWxvbmUoKSk7CiAgdmFyIGltcG9ydF9wYXJzZXJfYmFiZWwgPSBfX3RvRVNNKHJlcXVpcmVfcGFyc2VyX2JhYmVsKCkpOwogIHZhciBpbXBvcnRfcGFyc2VyX2h0bWwgPSBfX3RvRVNNKHJlcXVpcmVfcGFyc2VyX2h0bWwoKSk7CiAgZnVuY3Rpb24gZm9ybWF0dGVyKGNvZGUpIHsKICAgIGNvbnN0IGZvcm1hdHRlZCA9IGltcG9ydF9zdGFuZGFsb25lLmRlZmF1bHQuZm9ybWF0KGNvZGUsIHsKICAgICAgYXJyb3dQYXJlbnM6ICJhbHdheXMiLAogICAgICBicmFja2V0U3BhY2luZzogdHJ1ZSwKICAgICAgZW1iZWRkZWRMYW5ndWFnZUZvcm1hdHRpbmc6ICJhdXRvIiwKICAgICAgaHRtbFdoaXRlc3BhY2VTZW5zaXRpdml0eTogImNzcyIsCiAgICAgIGluc2VydFByYWdtYTogZmFsc2UsCiAgICAgIGJyYWNrZXRTYW1lTGluZTogdHJ1ZSwKICAgICAganN4U2luZ2xlUXVvdGU6IGZhbHNlLAogICAgICBwcmludFdpZHRoOiA5MCwKICAgICAgcHJvc2VXcmFwOiAicHJlc2VydmUiLAogICAgICBxdW90ZVByb3BzOiAiYXMtbmVlZGVkIiwKICAgICAgcmVxdWlyZVByYWdtYTogZmFsc2UsCiAgICAgIHNlbWk6IHRydWUsCiAgICAgIHNpbmdsZVF1b3RlOiB0cnVlLAogICAgICB0YWJXaWR0aDogMiwKICAgICAgdHJhaWxpbmdDb21tYTogImFsbCIsCiAgICAgIHVzZVRhYnM6IGZhbHNlLAogICAgICBwYXJzZXI6ICJiYWJlbC10cyIsCiAgICAgIHBsdWdpbnM6IFtpbXBvcnRfcGFyc2VyX2JhYmVsLmRlZmF1bHQsIGltcG9ydF9wYXJzZXJfaHRtbC5kZWZhdWx0XQogICAgfSk7CiAgICByZXR1cm4gZm9ybWF0dGVkOwogIH0KICBzZWxmLmFkZEV2ZW50TGlzdGVuZXIoImNvbm5lY3QiLCAoZSkgPT4gZXhwb3NlKGZvcm1hdHRlciwgZS5wb3J0c1swXSkpOwogIHNlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIChldmVudCkgPT4gewogICAgaWYgKGV2ZW50LmRhdGEuY29tbGlua0luaXQpIHsKICAgICAgZXhwb3NlKGZvcm1hdHRlciwgZXZlbnQuZGF0YS5wb3J0KTsKICAgIH0KICB9KTsKfSkoKTsKLyoqCgkgICAqIEBsaWNlbnNlCgkgICAqIENvcHlyaWdodCBHb29nbGUgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLgoJICAgKgoJICAgKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZQoJICAgKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5pby9saWNlbnNlCgkgICAqLwovKioKCSAqIEBsaWNlbnNlCgkgKiBDb3B5cmlnaHQgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KCSAqCgkgKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZQoJICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZQoJICovCg==";

// js/getWorker.mjs
import { wrap } from "https://ga.jspm.io/npm:comlink@4.3.1/dist/umd/comlink.js";
var getWrappedFromWorkerSrc = (url) => {
  const worker = new Worker(url);
  const { port1, port2 } = new MessageChannel();
  const message = {
    comlinkInit: true,
    port: port1
  };
  worker.postMessage(message, [port1]);
  return wrap(port2);
};

// js/formatter.mjs
var format = getWrappedFromWorkerSrc(prettier_worker_default);
var formatter = async (code) => (await format)(code);
export {
  formatter
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vZ2V0V29ya2VyLm1qcyIsICIuLi8uLi9mb3JtYXR0ZXIubWpzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyB3cmFwIH0gZnJvbSBcImNvbWxpbmtcIjtcblxuZXhwb3J0IGNvbnN0IGdldFdyYXBwZWRGcm9tV29ya2VyU3JjID0gKHVybCkgPT4ge1xuICAvLyBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKFxuICAvLyAgIG5ldyBCbG9iKFtzcmNdLCB7IHR5cGU6IFwiYXBwbGljYXRpb24vamF2YXNjcmlwdFwiIH0pLFxuICAvLyApO1xuXG4gIGNvbnN0IHdvcmtlciA9IG5ldyBXb3JrZXIodXJsKTtcbiAgY29uc3QgeyBwb3J0MSwgcG9ydDIgfSA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpO1xuICBjb25zdCBtZXNzYWdlID0ge1xuICAgIGNvbWxpbmtJbml0OiB0cnVlLFxuICAgIHBvcnQ6IHBvcnQxLFxuICB9O1xuXG4gIHdvcmtlci5wb3N0TWVzc2FnZShtZXNzYWdlLCBbcG9ydDFdKTtcblxuICByZXR1cm4gd3JhcChwb3J0Mik7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0V29ya2VyID0gKGZpbGUsIGRpc3QgPSBmYWxzZSkgPT4ge1xuICBsZXQgd29ya2VyU3JjO1xuICBsZXQgZm9yY2VOb3JtYWxXb3JrZXIgPSBmYWxzZTtcbiAgY29uc3QgeyBwYXRobmFtZSB9ID0gd2luZG93LmxvY2F0aW9uO1xuICBpZiAocGF0aG5hbWUuaW5jbHVkZXMoXCIvaXBmcy9cIikpIHtcbiAgICBjb25zdCBjaWQgPSBwYXRobmFtZS5zbGljZSg2LCA1Mik7XG4gICAgZm9yY2VOb3JtYWxXb3JrZXIgPSB0cnVlO1xuICAgIHdvcmtlclNyYyA9IGAvaXBmcy8ke2NpZH0vanMvd29ya2Vycy8ke2ZpbGV9YDtcbiAgfSBlbHNlIGlmIChsb2NhdGlvbi5vcmlnaW4gIT09IFwiaHR0cHM6Ly9zcGlrZS5sYW5kXCIpIHtcbiAgICBmb3JjZU5vcm1hbFdvcmtlciA9IHRydWU7XG4gICAgd29ya2VyU3JjID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoXG4gICAgICBuZXcgQmxvYihbXG4gICAgICAgIGRpc3QgPT09IGZhbHNlXG4gICAgICAgICAgPyBgc2VsZi5pbXBvcnRTY3JpcHRzKFwiLi93b3JrZXJzLyR7ZmlsZX1cIik7YFxuICAgICAgICAgIDogYHNlbGYuaW1wb3J0U2NyaXB0cyhcIi4vZGlzdC93b3JrZXJzL2pzL3dvcmtlcnMvJHtmaWxlfVwiKTtgLFxuICAgICAgXSksXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICB3b3JrZXJTcmMgPSBgL3dvcmtlcnMvJHtmaWxlfWA7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHdvcmtlclNyYyxcbiAgICBmb3JjZU5vcm1hbFdvcmtlcixcbiAgfTtcbn07XG5cbmNvbnN0IHdyYXBwZWQgPSB7fTtcbmV4cG9ydCBjb25zdCBnZXRXcmFwcGVkID0gKGZpbGUpID0+IHtcbiAgaWYgKHdyYXBwZWRbZmlsZV0pIHtcbiAgICByZXR1cm4gd3JhcHBlZFtmaWxlXTtcbiAgfVxuXG4gIGxldCB3b3JrZXJTcmM7XG4gIGxldCBmb3JjZU5vcm1hbFdvcmtlciA9IGZhbHNlO1xuICBjb25zdCB7IHBhdGhuYW1lIH0gPSB3aW5kb3cubG9jYXRpb247XG4gIGlmIChwYXRobmFtZS5pbmNsdWRlcyhcIi9pcGZzL1wiKSkge1xuICAgIGNvbnN0IGNpZCA9IHBhdGhuYW1lLnNsaWNlKDYsIDUyKTtcbiAgICBmb3JjZU5vcm1hbFdvcmtlciA9IHRydWU7XG4gICAgd29ya2VyU3JjID0gYC9pcGZzLyR7Y2lkfS9qcy93b3JrZXJzLyR7ZmlsZX1gO1xuICB9IGVsc2UgaWYgKGxvY2F0aW9uLm9yaWdpbiAhPT0gXCJodHRwczovL3NwaWtlLmxhbmRcIikge1xuICAgIGZvcmNlTm9ybWFsV29ya2VyID0gdHJ1ZTtcbiAgICB3b3JrZXJTcmMgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChcbiAgICAgIG5ldyBCbG9iKFtcbiAgICAgICAgYHNlbGYuaW1wb3J0U2NyaXB0cyhcImh0dHBzOi8vc3Bpa2UubGFuZC93b3JrZXJzLyR7ZmlsZX1cIik7YCxcbiAgICAgIF0pLFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgd29ya2VyU3JjID0gYGh0dHBzOi8vc3Bpa2UubGFuZC93b3JrZXJzLyR7ZmlsZX1gO1xuICB9XG5cbiAgd3JhcHBlZFtmaWxlXSA9IHdyYXBwZWRbd29ya2VyU3JjXSA9IHdyYXBwZWRbd29ya2VyU3JjXSB8fFxuICAgIGluaXQod29ya2VyU3JjLCBmb3JjZU5vcm1hbFdvcmtlcik7XG5cbiAgcmV0dXJuIHdyYXBwZWRbd29ya2VyU3JjXTtcbn07XG5cbmZ1bmN0aW9uIGluaXQod29ya2VyU3JjLCBmb3JjZU5vcm1hbFdvcmtlcikge1xuICBpZiAoZm9yY2VOb3JtYWxXb3JrZXIgfHwgdHlwZW9mIFNoYXJlZFdvcmtlciA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGNvbnN0IHdvcmtlciA9IG5ldyBXb3JrZXIod29ya2VyU3JjKTtcbiAgICBjb25zdCB7IHBvcnQxLCBwb3J0MiB9ID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7XG4gICAgY29uc3QgbWVzc2FnZSA9IHtcbiAgICAgIGNvbWxpbmtJbml0OiB0cnVlLFxuICAgICAgcG9ydDogcG9ydDEsXG4gICAgfTtcblxuICAgIHdvcmtlci5wb3N0TWVzc2FnZShtZXNzYWdlLCBbcG9ydDFdKTtcblxuICAgIHJldHVybiB3cmFwKHBvcnQyKTtcbiAgfVxuXG4gIGNvbnN0IHdvcmtlciA9IG5ldyBTaGFyZWRXb3JrZXIod29ya2VyU3JjKTtcbiAgd29ya2VyLnBvcnQuc3RhcnQoKTtcblxuICByZXR1cm4gd3JhcCh3b3JrZXIucG9ydCk7XG59XG4iLCAiaW1wb3J0IHNyYyBmcm9tIFwiLi9kaXN0L3dvcmtlcnMvanMvd29ya2Vycy9wcmV0dGllci53b3JrZXIuanNcIjtcbmltcG9ydCB7IGdldFdyYXBwZWRGcm9tV29ya2VyU3JjIH0gZnJvbSBcIi4vZ2V0V29ya2VyLm1qc1wiO1xuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb2RlXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fVxuICovXG5cbmNvbnN0IGZvcm1hdCA9IGdldFdyYXBwZWRGcm9tV29ya2VyU3JjKHNyYyk7XG5cbmV4cG9ydCBjb25zdCBmb3JtYXR0ZXIgPSBhc3luYyAoY29kZSkgPT4gKGF3YWl0IGZvcm1hdCkoY29kZSk7XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7QUFBQTtBQUVPLElBQU0sMEJBQTBCLENBQUMsUUFBUTtBQUs5QyxRQUFNLFNBQVMsSUFBSSxPQUFPO0FBQzFCLFFBQU0sRUFBRSxPQUFPLFVBQVUsSUFBSTtBQUM3QixRQUFNLFVBQVU7QUFBQSxJQUNkLGFBQWE7QUFBQSxJQUNiLE1BQU07QUFBQTtBQUdSLFNBQU8sWUFBWSxTQUFTLENBQUM7QUFFN0IsU0FBTyxLQUFLO0FBQUE7OztBQ1JkLElBQU0sU0FBUyx3QkFBd0I7QUFFaEMsSUFBTSxZQUFZLE9BQU8sU0FBVSxPQUFNLFFBQVE7IiwKICAibmFtZXMiOiBbXQp9Cg==
