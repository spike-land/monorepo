import"./chunk-6XRSRXUF.mjs";import{jsx as C}from"https://spike.land/dist/emotion.mjs";var S=(await import("./session-DAWSVOXB.mjs")).default,x=(await import("./prettierEsm-K2KRJTWP.mjs")).formatter;async function T(o){console.log("start monaco with session");let e=document.querySelector("#monacoEditor"),{startMonaco:t}=await import("./editor-EVRFJQH4.mjs"),r=n=>m(a.getModel().getValue(),n.changes,o,++o.i),{editor:a,monaco:c}=await t({language:"typescript",container:e,code:o.code});a.onDidChangeModelContent(r),Object.assign(window,{monaco:c}),o.editor=a,window.sess=o}async function E({monaco:o,editor:e}){if(!o)return[{messageText:"Error with the error checking. Try to reload!"}];let t=e.getModel(),a=await(await o.languages.typescript.getTypeScriptWorker())(t),c=t.uri.toString(),n=a.getSemanticDiagnostics(c),i=a.getCompilerOptionsDiagnostics(c),l=a.getSyntacticDiagnostics(c),d=await Promise.race([n,i,l]);return console.log(d),[]}async function m(o,e=null,t,r){t.changes.push(e);let{babelTransform:a}=await import("./babelEsm-GSWPLLMP.mjs"),c=a;t.errorText="";try{let n=await x(o),i=await c(n),l=!1;if(i.length>0){if(r<t.i)return;try{let{getHtmlAndCss:s}=await import("./renderToString-CAUECEZ5.mjs");if(r<t.i)return;let u=await k(i),{html:p,css:g}=s(u);t.transpiled=i,t.html=p;let w=await U(i);t.setChild(b=>[...b,w]),globalThis.App=w,t.children=w,l=!p,t.code=n,t.codeNonFormatted=o;let f=n;if(t.css=g,t.i!==r)return;let{saveCode:y}=await import("./ws-WBH6WO2F.mjs");y({transpiled:i,code:f,i:r,css:g,html:p});return}catch(s){console.error("EXCEPTION"),console.log({e:s}),l=!0,console.error({restartError:l})}}if(t.i>r)return;let d=await E(t);if(t.i>r)return;l&&d.push({messageText:"Error while starting the app. Check the console!"}),d.length>0&&console.log({err:d})}catch({error:n}){t.errorText=n,console.error({error:n})}}var L=async({code:o})=>{let e={code:o,i:0,changes:[],setChild:()=>{}};await m(o,null,e),await j(e)};async function j(o,e,t){o.children=null;let{renderPreviewWindow:r}=await import("./renderPreviewWindow-YRN64Y3Z.mjs");await r(o,e,t),t||await T(o)}async function U(o,e="window"){let t=e==="window"?o.replace("body{","#zbody{"):o,r=h(t),a=await import(r);return URL.revokeObjectURL(r),C(a.default)}function h(o){let e=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(e)}async function k(o,e="window"){let t=e==="window"?o.replace("body{","#zbody{"):o,r=h(t),a=(await import(r)).default;return URL.revokeObjectURL(r),a}export{S as initSession,x as prettier,j as quickStart,L as startFromCode,T as startMonacoWithSession};
