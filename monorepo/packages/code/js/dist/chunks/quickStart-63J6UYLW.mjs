import"./chunk-6XRSRXUF.mjs";import{jsx as C}from"https://spike.land/dist/emotion.mjs";var m;var w;var S=(await import("./session-DAWSVOXB.mjs")).default,T=(await import("./prettierEsm-K2KRJTWP.mjs")).formatter;async function x(o){console.log("start monaco with session");let a=document.querySelector("#monacoEditor"),{startMonaco:t}=await import("./editor-EVRFJQH4.mjs"),e=c=>h(r.getModel().getValue(),c.changes,o,++o.i),{editor:r,monaco:n}=await t({language:"typescript",container:a,code:o.code});r.onDidChangeModelContent(e),Object.assign(window,{monaco:n}),o.editor=r,window.sess=o}async function E({monaco:o,editor:a}){if(!o)return[{messageText:"Error with the error checking. Try to reload!"}];let t=a.getModel(),r=await(await o.languages.typescript.getTypeScriptWorker())(t),n=t.uri.toString(),c=r.getSemanticDiagnostics(n),i=r.getCompilerOptionsDiagnostics(n),l=r.getSyntacticDiagnostics(n),s=await Promise.race([c,i,l]);return console.log(s),[]}async function h(o,a=null,t,e){t.changes.push(a),w=w||(await import("./babelEsm-T57EWQE2.mjs")).babelTransform,m=w,t.errorText="";try{let r=await T(o),n=await m(r),c=!1;if(n.length>0){if(e<t.i)return;try{let{getHtmlAndCss:l}=await import("./renderToString-CAUECEZ5.mjs");if(e<t.i)return;let s=await k(n),{html:d,css:g}=l(s);t.transpiled=n,t.html=d;let p=await U(n);t.setChild(b=>[...b,p]),globalThis.App=p,t.children=p,c=!d,t.code=r,t.codeNonFormatted=o;let f=r;if(t.css=g,t.i!==e)return;let{saveCode:y}=await import("./ws-7UTC2TKA.mjs");y({transpiled:n,code:f,i:e,css:g,html:d});return}catch(l){console.error("EXCEPTION"),console.log({e:l}),c=!0,console.error({restartError:c})}}if(t.i>e)return;let i=await E(t);if(t.i>e)return;c&&i.push({messageText:"Error while starting the app. Check the console!"}),i.length>0&&console.log({err:i})}catch(r){t.errorText=r.message,console.error(r.message)}}var A=async({code:o})=>{let a={code:o,i:0,changes:[],setChild:()=>{}};await h(o,null,a),await j(a)};async function j(o,a,t){o.children=null;let{renderPreviewWindow:e}=await import("./renderPreviewWindow-YRN64Y3Z.mjs");await e(o,a,t),t||await x(o)}async function U(o,a="window"){let t=a==="window"?o.replace("body{","#zbody{"):o,e=u(t),r=await import(e);return URL.revokeObjectURL(e),C(r.default)}function u(o){let a=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(a)}async function k(o,a="window"){let t=a==="window"?o.replace("body{","#zbody{"):o,e=u(t),r=(await import(e)).default;return URL.revokeObjectURL(e),r}export{S as initSession,T as prettier,j as quickStart,A as startFromCode,x as startMonacoWithSession};
