import{a as f}from"./chunk-X7PW2MHY.mjs";import"./chunk-YUH35O52.mjs";f();import{jsx as E}from"https://spike.land/dist/emotion.mjs";var i,y,m,p;var u,A=async(t,e)=>(u=u||(await import("./session-6PTCDCYU.mjs")).default,u(t,e)),L=async t=>(i=i||(await import("./formatter-47WJO4KP.mjs")).formatter,await i(t));async function v(t){console.log("start monaco with session");let e=document.querySelector("#monacoEditor");m=m||(globalThis.monacoEditorModule&&await globalThis.monacoEditorModule||await import("./editor-EG7OY3HR.mjs")).startMonaco;let o=c=>b(r.getModel().getValue(),c.changes,t,++t.i),{editor:r,monaco:a}=await m({language:"typescript",container:e,code:t.code}),n=(await import("./throttle-EEONOF6C.mjs")).default;r.onDidChangeModelContent(n(o,100)),window.monaco=a,t.editor=r,window.sess=t}async function M({monaco:t,editor:e}){if(!t)return[{messageText:"Error with the error checking. Try to reload!"}];let o=e.getModel(),a=await(await t.languages.typescript.getTypeScriptWorker())(o),n=o.uri.toString(),c=a.getSemanticDiagnostics(n),l=a.getCompilerOptionsDiagnostics(n),d=a.getSyntacticDiagnostics(n),s=await Promise.race([c,l,d]);return console.log(s),[]}async function b(t,e=null,o,r){o.changes.push(e),i=i||(await import("./prettierEsm-5CFG5HAD.mjs")).formatter,p=p||(await import("./babelEsm-EARE4234.mjs")).babelTransform,y=p,o.errorText="";try{let a=await i(t),n=await y(a),c=!1;if(n.length>0){if(r<o.i)return;try{let{getHtmlAndCss:d}=await import("./renderToString-SLLWN25B.mjs");if(r<o.i)return;let s=await j(n),{html:w,css:h}=d(s);o.transpiled=n,o.html=w;let g=await U(n);o.setChild(x=>[...x,g]),globalThis.App=g,o.children=g,c=!w,o.code=a,o.codeNonFormatted=t;let T=a;if(o.css=h,o.i!==r)return;o.saveCode&&await o.saveCode({transpiled:n,code:T,i:r,css:h,html:w});return}catch(d){console.error("EXCEPTION"),console.log({e:d}),c=!0,console.error({restartError:c})}}if(o.i>r)return;let l=await M(o);if(o.i>r)return;c&&l.push({messageText:"Error while starting the app. Check the console!"}),l.length>0&&console.log({err:l})}catch(a){o.errorText=a.message,console.error(a.message)}}var D=async({code:t})=>{let e={code:t,i:0,changes:[],saveCode:()=>{},setChild:()=>{}};await b(t,null,e),await S(e)};async function S(t,e,o,r){t.saveCode=r,t.children=null;let{renderPreviewWindow:a}=globalThis.renderPreviewModule&&await globalThis.renderPreviewModule||await import("./renderPreviewWindow-P4FPFDBY.mjs");await a(t,e,o),o||await v(t)}async function U(t,e="window"){let o=e==="window"?t.replace("body{","#zbody{"):t,r=C(o),a=await import(r);return URL.revokeObjectURL(r),E(a.default)}function C(t){let e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}async function j(t,e="window"){let o=e==="window"?t.replace("body{","#zbody{"):t,r=C(o),a=(await import(r)).default;return URL.revokeObjectURL(r),a}export{A as initSession,L as prettier,S as quickStart,D as startFromCode,v as startMonacoWithSession};
