import"./chunk-AH6KKUH7.mjs";import{jsx as x}from"https://spike.land/dist/emotion.mjs";var g,f,p,m;var u,R=async(t,r)=>(u=u||(await import("./session-4RPROM47.mjs")).default,u(t,r)),E=async t=>(g=g||(await import("./prettierEsm-KIK5ML5W.mjs")).formatter,await g(t));async function v(t){console.log("start monaco with session");let r=document.querySelector("#monacoEditor");p=p||(globalThis.monacoEditorModule&&await globalThis.monacoEditorModule||await import("./editor-Z4N4FFLY.mjs")).startMonaco;let o=c=>y(e.getModel().getValue(),c.changes,t,++t.i),{editor:e,monaco:a}=await p({language:"typescript",container:r,code:t.code}),n=(await import("./throttle-Z6JZ56VC.mjs")).default;e.onDidChangeModelContent(n(o,100)),window.monaco=a,t.editor=e,window.sess=t}async function M({monaco:t,editor:r}){if(!t)return[{messageText:"Error with the error checking. Try to reload!"}];let o=r.getModel(),a=await(await t.languages.typescript.getTypeScriptWorker())(o),n=o.uri.toString(),c=a.getSemanticDiagnostics(n),i=a.getCompilerOptionsDiagnostics(n),l=a.getSyntacticDiagnostics(n),d=await Promise.race([c,i,l]);return console.log(d),[]}async function y(t,r=null,o,e){o.changes.push(r),m=m||(await import("./babelEsm-DBG57OBN.mjs")).babelTransform,f=m,o.errorText="";try{let a=await E(t),n=await f(a),c=!1;if(n.length>0){if(e<o.i)return;try{let{getHtmlAndCss:l}=await import("./renderToString-NN3J2EDG.mjs");if(e<o.i)return;let d=await j(n),{html:s,css:h}=l(d);o.transpiled=n,o.html=s;let w=await U(n);o.setChild(T=>[...T,w]),globalThis.App=w,o.children=w,c=!s,o.code=a,o.codeNonFormatted=t;let C=a;if(o.css=h,o.i!==e)return;o.saveCode&&await o.saveCode({transpiled:n,code:C,i:e,css:h,html:s});return}catch(l){console.error("EXCEPTION"),console.log({e:l}),c=!0,console.error({restartError:c})}}if(o.i>e)return;let i=await M(o);if(o.i>e)return;c&&i.push({messageText:"Error while starting the app. Check the console!"}),i.length>0&&console.log({err:i})}catch(a){o.errorText=a.message,console.error(a.message)}}var A=async({code:t})=>{let r={code:t,i:0,changes:[],saveCode:()=>{},setChild:()=>{}};await y(t,null,r),await S(r)};async function S(t,r,o,e){t.saveCode=e,t.children=null;let{renderPreviewWindow:a}=globalThis.renderPreviewModule&&await globalThis.renderPreviewModule||await import("./renderPreviewWindow-RTHBG5SN.mjs");await a(t,r,o),o||await v(t)}async function U(t,r="window"){let o=r==="window"?t.replace("body{","#zbody{"):t,e=b(o),a=await import(e);return URL.revokeObjectURL(e),x(a.default)}function b(t){let r=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(r)}async function j(t,r="window"){let o=r==="window"?t.replace("body{","#zbody{"):t,e=b(o),a=(await import(e)).default;return URL.revokeObjectURL(e),a}export{R as initSession,E as prettier,S as quickStart,A as startFromCode,v as startMonacoWithSession};
