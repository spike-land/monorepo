import"./chunk-6XRSRXUF.mjs";import{jsx as T}from"https://spike.land/dist/emotion.mjs";var R=(await import("./session-DAWSVOXB.mjs")).default;async function x(o){console.log("start monaco with session");let e=document.querySelector("#monacoEditor"),{startMonaco:t}=await import("./editor-J645PHI2.mjs"),r=a=>h(n.getModel().getValue(),a.changes,o,++o.i),{editor:n,monaco:c}=await t({language:"typescript",container:e,code:o.code});n.onDidChangeModelContent(r),Object.assign(window,{monaco:c}),o.editor=n,window.sess=o}async function E({monaco:o,editor:e}){if(!o)return[{messageText:"Error with the error checking. Try to reload!"}];let t=e.getModel(),n=await(await o.languages.typescript.getTypeScriptWorker())(t),c=t.uri.toString(),a=n.getSemanticDiagnostics(c),l=n.getCompilerOptionsDiagnostics(c),i=n.getSyntacticDiagnostics(c),s=await Promise.race([a,l,i]);return console.log(s),[]}async function h(o,e=null,t,r){t.changes.push(e);let{babelTransform:n}=await import("./babelEsm-E34Y4ZVS.mjs"),c=n;t.errorText="";try{let{prettier:a}=await import("./prettierEsm-EFVGC3SR.mjs"),l=a(o),i=await c(l),s=!1;if(i.length>0){if(r<t.i)return;try{let{getHtmlAndCss:p}=await import("./renderToString-CAUECEZ5.mjs");if(r<t.i)return;let f=await U(i),{html:w,css:m}=p(f);t.transpiled=i,t.html=w;let g=await j(i);t.setChild(C=>[...C,g]),globalThis.App=g,t.children=g,s=!w,t.code=l,t.codeNonFormatted=o;let y=l;if(t.css=m,t.i!==r)return;let{saveCode:b}=await import("./ws-EPZWZ3HE.mjs");b({transpiled:i,code:y,i:r,css:m,html:w});return}catch(p){console.error("EXCEPTION"),console.log({e:p}),s=!0,console.error({restartError:s})}}if(t.i>r)return;let d=await E(t);if(t.i>r)return;s&&d.push({messageText:"Error while starting the app. Check the console!"}),d.length>0&&console.log({err:d})}catch({error:a}){t.errorText=a,console.error({error:a})}}var L=async({code:o})=>{let e={code:o,i:0,changes:[],setChild:()=>{}};await h(o,null,e),await S(e)};async function S(o,e,t){let{renderPreviewWindow:r}=await import("./renderPreviewWindow-3SISHWX2.mjs");await r(o,e,t),t||await x(o)}async function j(o,e="window"){let t=e==="window"?o.replace("body{","#zbody{"):o,r=u(t),n=await import(r);return URL.revokeObjectURL(r),T(n.default)}function u(o){let e=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(e)}async function U(o,e="window"){let t=e==="window"?o.replace("body{","#zbody{"):o,r=u(t),n=(await import(r)).default;return URL.revokeObjectURL(r),n}export{R as initSession,S as quickStart,L as startFromCode,x as startMonacoWithSession};
