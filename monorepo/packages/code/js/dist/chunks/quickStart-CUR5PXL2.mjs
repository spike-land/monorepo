import"./chunk-AH6KKUH7.mjs";import{jsx as x}from"https://spike.land/dist/emotion.mjs";var i,f,m,p;var u,k=async(t,e)=>(u=u||(await import("./session-4RPROM47.mjs")).default,u(t,e)),R=async t=>(i=i||(await import("./formatter-GJZUGQ2A.mjs")).formatter,await i(t));async function E(t){console.log("start monaco with session");let e=document.querySelector("#monacoEditor");m=m||(globalThis.monacoEditorModule&&await globalThis.monacoEditorModule||await import("./editor-FR6IZPEJ.mjs")).startMonaco;let o=c=>y(r.getModel().getValue(),c.changes,t,++t.i),{editor:r,monaco:a}=await m({language:"typescript",container:e,code:t.code}),n=(await import("./throttle-Z6JZ56VC.mjs")).default;r.onDidChangeModelContent(n(o,100)),window.monaco=a,t.editor=r,window.sess=t}async function v({monaco:t,editor:e}){if(!t)return[{messageText:"Error with the error checking. Try to reload!"}];let o=e.getModel(),a=await(await t.languages.typescript.getTypeScriptWorker())(o),n=o.uri.toString(),c=a.getSemanticDiagnostics(n),l=a.getCompilerOptionsDiagnostics(n),d=a.getSyntacticDiagnostics(n),s=await Promise.race([c,l,d]);return console.log(s),[]}async function y(t,e=null,o,r){o.changes.push(e),i=i||(await import("./prettierEsm-KIK5ML5W.mjs")).formatter,p=p||(await import("./babelEsm-VDSDZLXJ.mjs")).babelTransform,f=p,o.errorText="";try{let a=await i(t),n=await f(a),c=!1;if(n.length>0){if(r<o.i)return;try{let{getHtmlAndCss:d}=await import("./renderToString-NN3J2EDG.mjs");if(r<o.i)return;let s=await U(n),{html:w,css:h}=d(s);o.transpiled=n,o.html=w;let g=await S(n);o.setChild(T=>[...T,g]),globalThis.App=g,o.children=g,c=!w,o.code=a,o.codeNonFormatted=t;let C=a;if(o.css=h,o.i!==r)return;o.saveCode&&await o.saveCode({transpiled:n,code:C,i:r,css:h,html:w});return}catch(d){console.error("EXCEPTION"),console.log({e:d}),c=!0,console.error({restartError:c})}}if(o.i>r)return;let l=await v(o);if(o.i>r)return;c&&l.push({messageText:"Error while starting the app. Check the console!"}),l.length>0&&console.log({err:l})}catch(a){o.errorText=a.message,console.error(a.message)}}var A=async({code:t})=>{let e={code:t,i:0,changes:[],saveCode:()=>{},setChild:()=>{}};await y(t,null,e),await M(e)};async function M(t,e,o,r){t.saveCode=r,t.children=null;let{renderPreviewWindow:a}=globalThis.renderPreviewModule&&await globalThis.renderPreviewModule||await import("./renderPreviewWindow-BEIEYYQS.mjs");await a(t,e,o),o||await E(t)}async function S(t,e="window"){let o=e==="window"?t.replace("body{","#zbody{"):t,r=b(o),a=await import(r);return URL.revokeObjectURL(r),x(a.default)}function b(t){let e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}async function U(t,e="window"){let o=e==="window"?t.replace("body{","#zbody{"):t,r=b(o),a=(await import(r)).default;return URL.revokeObjectURL(r),a}export{k as initSession,R as prettier,M as quickStart,A as startFromCode,E as startMonacoWithSession};
