import"./chunk-6XRSRXUF.mjs";import{jsx as C}from"https://spike.land/dist/emotion.mjs";var R=(await import("./session-DAWSVOXB.mjs")).default,x=(await import("./prettierEsm-K2KRJTWP.mjs")).formatter;async function T(o){console.log("start monaco with session");let e=document.querySelector("#monacoEditor"),{startMonaco:t}=await import("./editor-VXL6EVF6.mjs"),r=n=>m(a.getModel().getValue(),n.changes,o,++o.i),{editor:a,monaco:c}=await t({language:"typescript",container:e,code:o.code});a.onDidChangeModelContent(r),Object.assign(window,{monaco:c}),o.editor=a,window.sess=o}async function E({monaco:o,editor:e}){if(!o)return[{messageText:"Error with the error checking. Try to reload!"}];let t=e.getModel(),a=await(await o.languages.typescript.getTypeScriptWorker())(t),c=t.uri.toString(),n=a.getSemanticDiagnostics(c),i=a.getCompilerOptionsDiagnostics(c),s=a.getSyntacticDiagnostics(c),l=await Promise.race([n,i,s]);return console.log(l),[]}async function m(o,e=null,t,r){t.changes.push(e);let{babelTransform:a}=await import("./babelEsm-GSWPLLMP.mjs"),c=a;t.errorText="";try{let n=await x(o),i=await c(n),s=!1;if(i.length>0){if(r<t.i)return;try{let{getHtmlAndCss:d}=await import("./renderToString-CAUECEZ5.mjs");if(r<t.i)return;let h=await U(i),{html:p,css:g}=d(h);t.transpiled=i,t.html=p;let w=await j(i);t.setChild(b=>[...b,w]),globalThis.App=w,t.children=w,s=!p,t.code=n,t.codeNonFormatted=o;let u=n;if(t.css=g,t.i!==r)return;let{saveCode:y}=await import("./ws-CLXLBI7U.mjs");y({transpiled:i,code:u,i:r,css:g,html:p});return}catch(d){console.error("EXCEPTION"),console.log({e:d}),s=!0,console.error({restartError:s})}}if(t.i>r)return;let l=await E(t);if(t.i>r)return;s&&l.push({messageText:"Error while starting the app. Check the console!"}),l.length>0&&console.log({err:l})}catch({error:n}){t.errorText=n,console.error({error:n})}}var L=async({code:o})=>{let e={code:o,i:0,changes:[],setChild:()=>{}};await m(o,null,e),await S(e)};async function S(o,e,t){let{renderPreviewWindow:r}=await import("./renderPreviewWindow-YRN64Y3Z.mjs");await r(o,e,t),t||await T(o)}async function j(o,e="window"){let t=e==="window"?o.replace("body{","#zbody{"):o,r=f(t),a=await import(r);return URL.revokeObjectURL(r),C(a.default)}function f(o){let e=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(e)}async function U(o,e="window"){let t=e==="window"?o.replace("body{","#zbody{"):o,r=f(t),a=(await import(r)).default;return URL.revokeObjectURL(r),a}export{R as initSession,x as prettier,S as quickStart,L as startFromCode,T as startMonacoWithSession};
