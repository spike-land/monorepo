<!DOCTYPE html>
<html lang="en">
<head profile="http://www.w3.org/2005/10/profile">
  <meta http-equiv="Content-Type" content="text/html,charset=utf-8" />
  <meta name="viewport" content="width=device-width" />
  <base href="https://spike.land/">
  <title>Instant React Editor</title>
  <style>
    html,
body,
#root,
#zbody {
  box-sizing: border-box;
  width: 100%;
  height: 100%; 
 }


*, *::before, *::after {
  box-sizing: inherit;
}
body {
  border: 0;
  padding: 0;
  margin: 0;
  background: fixed;
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: cover;
  background-position: top;
  overscroll-behavior-y: contain;
  width: 100%;
  margin: 0;
  padding: 0;
  border: 0;
  min-height: -webkit-fill-available;
  height: 100%;
  position: fixed;
  /* prevent overscroll bounce*/
  overflow-y: scroll;
  --webkit-overflow-scrolling: touch;
  padding-bottom: 0 !important;
  overflow: hidden;
  overflow-x: hidden;
  overflow-y: hidden;
}
#monacoEditor {
  max-width: 640px;
  height: 100vh;
  max-height: 100vh;
}

  </style>
</head>
<body>
  <script>     
  window.process = {
    env: {
      "NODE_ENV": "production"
    }};

  function createJsBlob(code) {
  const file = new File([code], "index.tsx", {
    type: "application/javascript",
  });
  const blobUrl = URL.createObjectURL(file);
  return blobUrl;
  // const actualUrl =
}


const runApp = async () => {


if (!document.getElementById("root")) {
  const container = document.createElement("div");
  container.id = "root";
  container.style.height="100%";
  document.body.append(container);
}
const root = document.getElementById("root");
root.innerHTML =
  `<style>${startState.css}</style><div id="zbody">${startState.html}</div>`;


const AppPromise =  import(createJsBlob(window.startState.transpiled));
globalThis.transpiled = startState.transpiled;

globalThis.App = (await AppPromise).default;
const {App} = globalThis;

const {render} = await import("react-dom");
const newRoot = document.createElement("div");
newRoot.style.height="100%";

render(App(),newRoot );

if (!newRoot.innerHTML) return;




if (!globalThis.currentTarget){
  console.log("currentTarget");

  root.replaceWith(newRoot);
  globalThis.currentTarget =newRoot;
} else {
  globalThis.currentTarget.parentNode?.replaceChildren(newRoot);
  globalThis.currentTarget = newRoot;
 
}

};

    </script>
  <div id="root"></div>
  <script>
runApp();
 import("https://spike.land/starter.mjs")
    .then(
      ({run})=> run()
      )
                .catch(()=>{
                  const s = document.createElement("script");
                  s.async = "async";
                  s.type = "application/javascript";
                  s.src = "https://spike.land/appStarter.js";
                  document.head.appendChild(s);   
                });
  </script>
  <div id="monacoEditor"></div>
  

  <!-- Cloudflare Web Analytics -->
  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "cc7e2ceaa75d4111b26b0ec989795375"}'></script><!-- End Cloudflare Web Analytics -->
</body>
</html>